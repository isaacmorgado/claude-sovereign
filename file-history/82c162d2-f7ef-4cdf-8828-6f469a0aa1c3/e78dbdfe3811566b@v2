// Note: This extracts the CLI from a native installation
// We need to dynamically import the loader since it might have native dependencies

const claudePath = '/opt/homebrew/bin/claude';
const outputPath = '/tmp/claude-cli.js';

async function extract() {
  try {
    console.log('Extracting cli.js from Claude Code binary...');
    console.log(`  Binary path: ${claudePath}`);

    // Dynamic import to handle native dependencies
    const { extractClaudeJsFromNativeInstallation } = await import('/tmp/tweakcc/dist/index.mjs');

    const cliJs = await extractClaudeJsFromNativeInstallation(claudePath);

    if (!cliJs) {
      console.error('Error: extractClaudeJsFromNativeInstallation returned null/undefined');
      process.exit(1);
    }

    console.log(`  Type: ${typeof cliJs}`);
    console.log(`  Is Buffer: ${Buffer.isBuffer(cliJs)}`);
    console.log(`  Length: ${cliJs.length}`);

    const fs = await import('fs');
    fs.writeFileSync(outputPath, cliJs);
    console.log(`âœ“ Extracted cli.js to ${outputPath}`);
    console.log(`  Size: ${(cliJs.length / 1024 / 1024).toFixed(2)} MB`);
  } catch (error) {
    console.error('Error extracting cli.js:', error);
    console.error(error.stack);
    process.exit(1);
  }
}

extract();
