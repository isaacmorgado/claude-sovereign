#!/bin/bash
# Apply tweakcc patch to Claude Code binary
# This script requires sudo access to modify /opt/homebrew/lib/node_modules/@anthropic-ai/claude-code/

set -e

echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "Claude Code Binary Patcher - Multi-Provider Model Support"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "This will add the following models to your /model picker:"
echo ""
echo "  Anthropic:"
echo "    â€¢ Opus 4.5, Sonnet 4.5, Haiku 3.5"
echo ""
echo "  GLM (ZhipuAI):"
echo "    â€¢ ğŸŒ GLM-4 (Agentic coding)"
echo "    â€¢ âš¡ GLM-4-Flash (Fast)"
echo "    â€¢ â˜ï¸ GLM-4-Air (Balanced)"
echo ""
echo "  Google Gemini:"
echo "    â€¢ ğŸ”· Gemini Pro (Research)"
echo "    â€¢ âš¡ Gemini 2.0 Flash (UI/UX)"
echo ""
echo "  Featherless (Uncensored):"
echo "    â€¢ ğŸ”“ Dolphin-3 24B (Security & RE)"
echo "    â€¢ ğŸ”“ Qwen 2.5 72B (Unrestricted Q&A)"
echo "    â€¢ ğŸ”“ WhiteRabbitNeo 8B (Cybersecurity)"
echo "    â€¢ ğŸ”“ Llama-3 70B (Unrestricted coding)"
echo "    â€¢ ğŸ”“ Llama-3 8B v3 (Fast uncensored)"
echo "    â€¢ ğŸ”“ Llama-3 8B v2 (Alternative)"
echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "This requires sudo access to modify:"
echo "  /opt/homebrew/lib/node_modules/@anthropic-ai/claude-code/cli.js"
echo ""
read -p "Continue? [y/N] " -n 1 -r
echo ""

if [[ ! $REPLY =~ ^[Yy]$ ]]; then
    echo "Cancelled."
    exit 1
fi

echo ""
echo "Applying patch..."
cd /tmp/tweakcc

# Run with sudo
sudo bun run dist/index.mjs --apply

echo ""
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo "âœ… Patch applied successfully!"
echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
echo ""
echo "Next steps:"
echo ""
echo "1. Start clauded:"
echo "   $ clauded"
echo ""
echo "2. Open the model picker:"
echo "   /model"
echo ""
echo "3. Select any model - they all support:"
echo "   âœ“ Tool calling (native or emulated)"
echo "   âœ“ Spawning agents in parallel (Task tool)"
echo "   âœ“ MCP servers (browser automation, etc.)"
echo ""
echo "4. Optional: Set API keys for Featherless/Google models:"
echo "   export FEATHERLESS_API_KEY=\"your-key\""
echo "   export GOOGLE_API_KEY=\"your-key\""
echo ""
