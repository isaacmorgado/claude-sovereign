#!/usr/bin/env node
/**
 * Test Featherless models accessibility
 */

const https = require('https');

const API_KEY = 'rc_0d2c186ee945d2e0a15310e7630233b1b3bd5448fdf0d587ab5dc71cf5994fa3';
const BASE_URL = 'https://api.featherless.ai/v1';

// Models to test
const MODELS_TO_TEST = [
  'WhiteRabbitNeo/Llama-3.1-WhiteRabbitNeo-2-70B',
  'dphn/Dolphin-Mistral-24B-Venice-Edition',
  'huihui-ai/Qwen2.5-72B-Instruct-abliterated',
];

async function testModel(modelId) {
  return new Promise((resolve, reject) => {
    const data = JSON.stringify({
      model: modelId,
      messages: [
        { role: 'user', content: 'Hello, respond with just "OK" if you can see this.' }
      ],
      max_tokens: 10,
      temperature: 0.7
    });

    const options = {
      hostname: 'api.featherless.ai',
      port: 443,
      path: '/v1/chat/completions',
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${API_KEY}`,
        'Content-Length': data.length
      }
    };

    const req = https.request(options, (res) => {
      let responseData = '';

      res.on('data', (chunk) => {
        responseData += chunk;
      });

      res.on('end', () => {
        try {
          const response = JSON.parse(responseData);

          if (res.statusCode === 200 && response.choices && response.choices[0]) {
            resolve({
              success: true,
              modelId,
              response: response.choices[0].message.content
            });
          } else {
            resolve({
              success: false,
              modelId,
              error: `Status ${res.statusCode}: ${responseData}`
            });
          }
        } catch (error) {
          resolve({
            success: false,
            modelId,
            error: `Parse error: ${error.message}`
          });
        }
      });
    });

    req.on('error', (error) => {
      resolve({
        success: false,
        modelId,
        error: error.message
      });
    });

    req.write(data);
    req.end();
  });
}

async function main() {
  console.log('Testing Featherless models...\n');

  for (const modelId of MODELS_TO_TEST) {
    console.log(`Testing: ${modelId}`);
    const result = await testModel(modelId);

    if (result.success) {
      console.log(`✓ SUCCESS - Model responded: ${result.response}`);
    } else {
      console.log(`✗ FAILED - ${result.error}`);
    }
    console.log('');
  }
}

main().catch(console.error);
