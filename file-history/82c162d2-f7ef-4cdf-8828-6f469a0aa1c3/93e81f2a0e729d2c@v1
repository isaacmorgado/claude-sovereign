# clauded - Complete Setup Guide

## What You Get

After running the setup, you'll have two commands:

| Command | Description |
|---------|-------------|
| `claude` | **Original Claude Code** - Unchanged, uses your Anthropic API key |
| `clauded` | **Enhanced version** with custom ASCII art + multi-provider proxy |

## Features of `clauded`

### ğŸ¨ Custom Interface
- ASCII art with horns (matrix green theme)
- Visual provider status display
- Available models list on startup

### ğŸ”§ Full Tool Support for ALL Models

**Even abliterated models get:**
- âœ… **Agent Spawning** - Use `/explore`, `/rootcause`, `/build` commands
- âœ… **MCP Servers** - All tools (Read, Write, Bash, Grep, etc.)
- âœ… **Parallel Tool Calls** - Multiple tools in one response
- âœ… **Memory Management** - Context preservation for smaller models

**How it works:**
- Models with native tool support (GLM, Gemini) â†’ Direct pass-through
- Abliterated models (Featherless) â†’ Automatic tool emulation via XML

### ğŸŒ Multi-Provider Access

**14+ Models Across 4 Providers:**

1. **GLM (ZhipuAI)** - Free, native tools
   - `glm/glm-4`
   - `glm/glm-4-plus`

2. **Featherless.ai** - Abliterated, tool emulation
   - `featherless/Llama-3-8B-Instruct-abliterated`
   - `featherless/Llama-3-70B-Instruct-abliterated`
   - `featherless/Qwen2.5-72B-Instruct`
   - `featherless/Llama-3.1-405B-Instruct`
   - + 2 more models

3. **Google Gemini** - OAuth, native tools
   - `google/gemini-2.0-flash`
   - `google/gemini-1.5-pro`
   - + 3 more models

4. **Anthropic** - Your API key, pass-through
   - `anthropic/claude-sonnet-4-5`
   - Or use without prefix

## Installation

Run the setup script:

```bash
bash /tmp/setup-claude-complete.sh
```

**Requirements:** Sudo password (to reinstall Claude Code and create wrapper)

## Usage

### Starting clauded

```bash
clauded
```

You'll see:
```
     â–²                                        â–²
    â–â–ˆâ–Œ                                      â–â–ˆâ–Œ
   â–â–ˆâ–ˆâ–ˆâ–Œ    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•—      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ•—   â–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•— â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
  â–â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–Œ  â–ˆâ–ˆâ•”â•â•â•â•â•â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•—â–ˆâ–ˆâ•”â•â•â•â•â•
   â–â–ˆâ–ˆâ–ˆâ–Œ   â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
    â–â–ˆâ–Œ    â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•‘     â–ˆâ–ˆâ•”â•â•â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘   â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â–ˆâ–ˆâ•”â•â•â•
     â–²     â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—â–ˆâ–ˆâ•‘  â–ˆâ–ˆâ•‘â•šâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•”â•â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ•—
            â•šâ•â•â•â•â•â•â•šâ•â•â•â•â•â•â•â•šâ•â•  â•šâ•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â• â•šâ•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘   Multi-Provider Proxy with Full Tool Support                â•‘
â•‘   âœ“ Tool Calling  âœ“ Agent Spawning  âœ“ MCP Servers  âœ“ Memory  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ“ Proxy started successfully

Available Models (all with full tool support):
...
```

### Switching Models

Inside `clauded`, use the `/model` command:

```
/model glm/glm-4
/model featherless/Llama-3-70B-Instruct-abliterated
/model google/gemini-2.0-flash
```

### Testing Tool Support

**1. File Operations:**
```
Read package.json
```

**2. Agent Spawning:**
```
Spawn an explore agent to analyze the codebase structure
```

**3. Parallel Tools:**
```
Read both config.json and package.json in parallel
```

**4. Git Operations:**
```
Show me the git status and recent commits
```

All these work **even on abliterated models** thanks to tool emulation!

## How Tool Emulation Works

For models without native tool support (abliterated models):

1. **Proxy injects tools** into the system prompt with XML format:
   ```xml
   <tool_call>
   {"name": "Read", "arguments": {"file_path": "file.txt"}}
   </tool_call>
   ```

2. **Model generates** XML tool calls in its response

3. **Proxy parses** XML and converts to Anthropic tool format

4. **Claude Code receives** properly formatted tool calls

5. **MCP servers execute** the tools normally

Result: Abliterated models can use **all** Claude Code features!

## Google OAuth Setup (Optional)

To use Google models without manual API keys:

```bash
node ~/.claude/model-proxy-server.js --gemini-login
```

This will:
1. Open browser for Google sign-in
2. Save OAuth tokens securely
3. Auto-refresh tokens when expired

Then use: `/model google/gemini-2.0-flash`

## Memory for Smaller Models

The proxy automatically provides memory by:

1. **Tool context injection** - Tools explained in system prompt
2. **Conversation history** - Maintained by Claude Code
3. **MCP server state** - Persistent across tool calls

This means even 8B models can:
- Remember previous tool calls
- Chain tool usage logically
- Maintain task context

## Architecture

```
clauded wrapper
    â†“
Starts proxy server (port 3000)
    â†“
Starts Claude Code with ANTHROPIC_BASE_URL=http://127.0.0.1:3000
    â†“
Claude Code sends requests to proxy
    â†“
Proxy routes to provider:
    â”œâ”€ glm/*        â†’ GLM API (native tools)
    â”œâ”€ featherless/* â†’ Featherless API (tool emulation)
    â”œâ”€ google/*     â†’ Google API (OAuth + native tools)
    â””â”€ anthropic/*  â†’ Anthropic API (pass-through)
    â†“
Proxy converts response back to Anthropic format
    â†“
Claude Code receives response + executes tools
```

## Files Created

- `/usr/local/bin/clauded` - Wrapper script (executable)
- `/tmp/claude-proxy.log` - Proxy server logs
- `~/.claude/model-proxy-server.js` - Proxy server (already exists)
- `~/.claude/lib/gemini-oauth.js` - OAuth module (already exists)

## Troubleshooting

### Claude won't start after reinstall
```bash
npm list -g @anthropic-ai/claude-code
claude --version
```

### Proxy fails to start
```bash
tail -f /tmp/claude-proxy.log
node ~/.claude/model-proxy-server.js 3000
```

### Tools not working on abliterated model
Check proxy logs for tool emulation:
```bash
grep "tool emulation" /tmp/claude-proxy.log
```

### Agent spawning not working
Verify Task tool is available:
```
List all available tools
```

Should show Task tool with all agent types.

## Advanced Usage

### Running proxy manually
```bash
node ~/.claude/model-proxy-server.js 3000
```

### Using specific model from command line
```bash
clauded --model glm/glm-4
```

### Checking proxy status
```bash
lsof -i :3000
```

### Viewing real-time proxy logs
```bash
tail -f /tmp/claude-proxy.log
```

## Comparison: claude vs clauded

| Feature | `claude` | `clauded` |
|---------|----------|-----------|
| ASCII Art | Original Clawd | Custom CLAUDE with horns |
| Color Scheme | Orange | Matrix Green |
| Providers | Anthropic only | 4 providers, 14+ models |
| Tool Support | Native only | All models (emulation) |
| Agent Spawning | âœ“ | âœ“ |
| MCP Servers | âœ“ | âœ“ |
| API Key | Your Anthropic key | Multi-provider |
| Startup | Instant | +2s (proxy start) |

## Summary

- âœ… Original `claude` restored and working
- âœ… Enhanced `clauded` with custom branding
- âœ… **Full tool support for ALL models** (even abliterated)
- âœ… Agent spawning works on any model
- âœ… MCP servers integrate seamlessly
- âœ… Memory management for smaller models
- âœ… 14+ models across 4 providers

**You can now use abliterated models with full Claude Code capabilities!**
