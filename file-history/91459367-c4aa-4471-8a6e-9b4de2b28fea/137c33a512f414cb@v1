# SPLICE Test Users Documentation

## Overview

This document contains test user credentials for verifying the full authentication and authorization functionality of the SPLICE platform.

**‚ö†Ô∏è IMPORTANT:** These are test credentials for development/testing only. Never use these in production.

---

## Test User Credentials

### 1. Starter Tier User (Full Credits)

**Purpose:** Test starter tier with full credits
**Email:** `test-starter@splice.video`
**License Key:** `SPLICE-82CF-4ZAQ-66F6`
**Stripe Customer ID:** `cus_test_starter_001`

**Credits:**
- Hours: 4h regular processing
- Isolation Hours: 0h (not available on starter)
- Music Credits: 5/5

**Use Case:** Test basic functionality with starter tier limitations

---

### 2. Pro Tier User (Full Credits)

**Purpose:** Test pro tier with full credits and isolation access
**Email:** `test-pro@splice.video`
**License Key:** `SPLICE-7XWQ-VE7Y-MDJN`
**Stripe Customer ID:** `cus_test_pro_001`

**Credits:**
- Hours: 15h regular processing
- Isolation Hours: 0.75h (45 minutes)
- Music Credits: 20/20

**Use Case:** Test pro features including isolation processing

---

### 3. Team Tier User (Full Credits)

**Purpose:** Test team tier with maximum credits
**Email:** `test-team@splice.video`
**License Key:** `SPLICE-7DVR-4AEU-W8BU`
**Stripe Customer ID:** `cus_test_team_001`

**Credits:**
- Hours: 50h regular processing
- Isolation Hours: 3h (180 minutes)
- Music Credits: 100/100

**Use Case:** Test team features with highest tier limits

---

### 4. Empty Credits User

**Purpose:** Test behavior when user runs out of credits
**Email:** `test-empty@splice.video`
**License Key:** `SPLICE-5AUT-NMS8-5SQ8`
**Stripe Customer ID:** `cus_test_empty_001`

**Credits:**
- Hours: 0h (depleted)
- Isolation Hours: 0h
- Music Credits: 0/5

**Use Case:** Test credit exhaustion, upgrade prompts, overage handling

---

### 5. Cancelled Subscription User

**Purpose:** Test cancelled/inactive subscription state
**Email:** `test-cancelled@splice.video`
**License Key:** `SPLICE-9QHU-F74E-5C4R`
**Stripe Customer ID:** `cus_test_cancelled_001`

**Credits:**
- Hours: 0h
- Isolation Hours: 0h
- Music Credits: 0/0

**Use Case:** Test behavior for cancelled subscriptions

---

## How to Use Test Users

### Frontend Login

1. Navigate to: `http://localhost:3000/login`
2. Enter any of the license keys above
3. Click "Login"
4. You should be authenticated and redirected to the dashboard

### API Authentication

#### 1. Get CSRF Token

```bash
curl -X GET http://localhost:3847/auth/csrf-token \
  -H "Content-Type: application/json" \
  -c cookies.txt
```

Response:
```json
{
  "csrfToken": "abc123..."
}
```

#### 2. Login with License Key

```bash
curl -X POST http://localhost:3847/auth/login \
  -H "Content-Type: application/json" \
  -H "X-CSRF-Token: YOUR_CSRF_TOKEN" \
  -b cookies.txt \
  -d '{
    "licenseKey": "SPLICE-82CF-4ZAQ-66F6"
  }'
```

Response:
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "refreshToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  "user": {
    "stripeCustomerId": "cus_test_starter_001",
    "email": "test-starter@splice.video",
    "tier": "starter",
    "hoursRemaining": 4
  }
}
```

#### 3. Access Protected Endpoints

```bash
curl -X GET http://localhost:3847/billing/credits \
  -H "Authorization: Bearer YOUR_ACCESS_TOKEN"
```

Response:
```json
{
  "hours": 4,
  "isolationHours": 0,
  "musicCredits": 5,
  "tier": "starter"
}
```

---

## Testing Scenarios

### Scenario 1: Successful Authentication
**User:** Any test user with valid license key
**Steps:**
1. Get CSRF token
2. Login with license key
3. Verify JWT token is returned
4. Verify user data is correct
5. Access protected endpoint with token

**Expected:** ‚úÖ All steps succeed

---

### Scenario 2: Invalid License Key
**User:** Any test user
**Steps:**
1. Get CSRF token
2. Login with invalid key: `SPLICE-XXXX-XXXX-XXXX`

**Expected:** ‚ùå 401 Unauthorized, error message "License key not found"

---

### Scenario 3: Credit Exhaustion
**User:** Empty Credits User (`SPLICE-5AUT-NMS8-5SQ8`)
**Steps:**
1. Login successfully
2. Attempt to use video processing endpoint

**Expected:** ‚ùå 403 Forbidden, error message "Insufficient credits"

---

### Scenario 4: Tier-Specific Features
**User:** Starter User (`SPLICE-82CF-4ZAQ-66F6`)
**Steps:**
1. Login successfully
2. Attempt to use isolation processing (Pro+ feature)

**Expected:** ‚ùå 403 Forbidden, error message "Upgrade required"

---

### Scenario 5: Token Refresh
**User:** Any test user
**Steps:**
1. Login and save refresh token
2. Wait for access token to approach expiry (or invalidate it)
3. Call `/auth/refresh` with refresh token
4. Verify new access token is returned

**Expected:** ‚úÖ New access token returned

---

### Scenario 6: Logout and Token Blacklist
**User:** Any test user
**Steps:**
1. Login and save access token
2. Access a protected endpoint (should work)
3. Logout via `/auth/logout`
4. Try to access protected endpoint with same token

**Expected:** ‚ùå 401 Unauthorized, error message "Token has been revoked"

---

### Scenario 7: Cancelled Subscription
**User:** Cancelled User (`SPLICE-9QHU-F74E-5C4R`)
**Steps:**
1. Attempt to login

**Expected:** ‚úÖ Login succeeds (license still valid)

2. Attempt to use any paid feature

**Expected:** ‚ùå 403 Forbidden, error message "Subscription cancelled - please resubscribe"

---

## Automated Testing

### Jest/Supertest Example

```javascript
const request = require('supertest');
const app = require('../server');

describe('Authentication Flow', () => {
  let csrfToken;
  let accessToken;

  it('should get CSRF token', async () => {
    const response = await request(app)
      .get('/auth/csrf-token');

    expect(response.status).toBe(200);
    expect(response.body).toHaveProperty('csrfToken');
    csrfToken = response.body.csrfToken;
  });

  it('should login with starter tier license key', async () => {
    const response = await request(app)
      .post('/auth/login')
      .set('X-CSRF-Token', csrfToken)
      .send({ licenseKey: 'SPLICE-82CF-4ZAQ-66F6' });

    expect(response.status).toBe(200);
    expect(response.body).toHaveProperty('token');
    expect(response.body.user.tier).toBe('starter');
    accessToken = response.body.token;
  });

  it('should access protected endpoint with token', async () => {
    const response = await request(app)
      .get('/billing/credits')
      .set('Authorization', `Bearer ${accessToken}`);

    expect(response.status).toBe(200);
    expect(response.body.hours).toBe(4);
  });
});
```

---

## Recreating Test Users

If you need to recreate test users (e.g., after database reset):

```bash
cd splice-backend
node scripts/create-test-users.js
```

The script will:
- Create or update all 5 test users
- Generate new license keys if needed
- Preserve existing license keys if users already exist
- Display full credentials at the end

---

## Production Notes

**üîí Security Reminders:**

1. **Never use these test credentials in production**
2. All test user emails use `@splice.video` domain
3. All Stripe customer IDs have `cus_test_` prefix for easy identification
4. Test license keys should be periodically rotated
5. In production, implement IP-based rate limiting for login attempts

**üóëÔ∏è Cleanup:**

To remove test users from database:

```sql
-- Delete test users
DELETE FROM users WHERE stripe_customer_id LIKE 'cus_test_%';

-- Delete test license keys
DELETE FROM license_keys WHERE stripe_customer_id LIKE 'cus_test_%';
```

---

## Troubleshooting

### "License key not found"
- Ensure test users script was run successfully
- Check database connection
- Verify license_keys table exists

### "Token has been revoked"
- Token may have been blacklisted from previous logout
- Try logging in again to get a new token
- Check Redis connection for blacklist functionality

### "CSRF token mismatch"
- Ensure you're sending the CSRF token in the `X-CSRF-Token` header
- Ensure cookies are enabled and being sent with requests
- Get a fresh CSRF token before each login attempt

### Can't access protected endpoints
- Verify token is in `Authorization: Bearer <token>` header
- Check token hasn't expired (24h default)
- Ensure user has sufficient credits for the operation

---

## Related Documentation

- [CLAUDE.md](./CLAUDE.md) - Main project documentation
- [splice-backend/README.md](./splice-backend/README.md) - Backend API documentation
- [splice-backend/middleware/auth.js](./splice-backend/middleware/auth.js) - Authentication middleware
- [splice-backend/services/licenseService.js](./splice-backend/services/licenseService.js) - License validation

---

**Last Updated:** 2026-01-12
**Script Location:** `splice-backend/scripts/create-test-users.js`
