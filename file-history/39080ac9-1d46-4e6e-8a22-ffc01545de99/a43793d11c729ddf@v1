---
description: Autonomous feature builder - reads architecture, builds, tests, loops
argument-hint: "[feature-name] [--from architecture.md]"
allowed-tools: ["Bash", "Read", "Write", "Edit", "Glob", "Grep", "Task"]
---

# Autonomous Build Command

Build features autonomously by reading architecture documents, implementing incrementally, and validating after each step.

## Usage

```
/build                           # Continue from buildguide.md next section
/build auth-system               # Build specific feature
/build --from docs/architecture.md   # Use specific architecture doc
```

## Instructions

Parse arguments: $ARGUMENTS

### Step 1: Load Architecture Context

**Find and read architecture documents in this order:**

1. If `--from <file>` specified, read that file
2. Otherwise check these locations:
   - `buildguide.md` (preferred - has implementation plan)
   - `ARCHITECTURE.md`
   - `docs/architecture.md`
   - `.claude/docs/architecture.md`
   - `CLAUDE.md` (fallback)

Extract from architecture:
- **Tech stack** (language, framework, tools)
- **Project structure** (directories, patterns)
- **Quality commands** (lint, typecheck, test commands)
- **Current section** to implement (from buildguide.md checklist)

### Step 2: Determine Build Target

**If feature name provided:**
- Find matching section in buildguide.md
- Read its Implementation Approach

**If no feature name:**
- Find first unchecked `- [ ]` section in buildguide.md
- That's the build target

**Extract from section:**
- What to build (Overview)
- How it fits (Architecture Fit)
- Implementation steps (Implementation Approach)
- Files to create/modify

### Step 3: Create Build Plan

Write a `.claude/current-build.local.md` state file:

```markdown
---
feature: [feature name]
phase: implementing
started: [timestamp]
iteration: 1
---

## Build Target
[What we're building]

## Implementation Steps
1. [ ] Step 1
2. [ ] Step 2
...

## Quality Gates
- [ ] Lint passes
- [ ] Types check
- [ ] Tests pass
- [ ] No regressions

## Files to Modify
- [file list from architecture]
```

### Step 4: Implement Incrementally

For each implementation step:

1. **Announce** what you're implementing
2. **Implement** the code changes
3. **Auto-quality check** runs via PostToolUse hook (lint, types)
4. **If errors**: Fix them immediately before moving on
5. **Mark step complete** in current-build.local.md
6. **Continue** to next step

### Step 5: After Implementation Complete

Run full validation:

```bash
# Detect and run quality commands based on project type
if [[ -f package.json ]]; then
    npm run lint 2>&1 || true
    npm run typecheck 2>&1 || npx tsc --noEmit 2>&1 || true
    npm test 2>&1 || true
elif [[ -f pyproject.toml ]] || [[ -f requirements.txt ]]; then
    ruff check . 2>&1 || pylint **/*.py 2>&1 || true
    mypy . 2>&1 || true
    pytest 2>&1 || true
elif [[ -f go.mod ]]; then
    go vet ./... 2>&1 || true
    staticcheck ./... 2>&1 || true
    go test ./... 2>&1 || true
elif [[ -f Cargo.toml ]]; then
    cargo clippy 2>&1 || true
    cargo test 2>&1 || true
fi
```

### Step 6: Handle Failures

**If any quality gate fails:**

1. Parse error output
2. Group errors by type (lint, type, test)
3. Spawn parallel fix agents:

```
Use the Task tool to spawn 3 agents in parallel:

Agent 1 (if lint errors):
- Fix all lint errors
- Re-run lint to verify

Agent 2 (if type errors):
- Fix all type errors
- Re-run typecheck to verify

Agent 3 (if test failures):
- Analyze test failures
- Fix code or update tests
- Re-run tests to verify
```

4. After agents complete, run validation again
5. Loop until all gates pass (max 3 iterations)

### Step 7: Mark Complete and Continue

When all quality gates pass:

1. **Update current-build.local.md**:
   - Set `phase: complete`
   - Check all quality gates

2. **Update buildguide.md**:
   - Mark section complete: `- [ ]` → `- [x]`

3. **Run /checkpoint**:
   - Saves state to CLAUDE.md
   - Generates continuation prompt
   - Advances to next section

4. **Check context usage**:
   - If < 40%: Continue to next section automatically
   - If >= 40%: Let auto-continue hook handle compaction

5. **Loop**:
   - Find next unchecked section
   - Go back to Step 2
   - Continue until all sections complete or user says "stop"

### Step 8: Completion

When all sections in buildguide.md are checked:

```
✅ Build Complete!

All sections implemented:
- [x] Section 1
- [x] Section 2
...

Quality verified:
- Lint: ✅
- Types: ✅
- Tests: ✅

Run /checkpoint to save final state.
```

## Stopping the Build

Say "stop", "pause", or "hold" to pause autonomous building.
The current state is saved in `.claude/current-build.local.md`.

Resume with `/build` - it will continue from where it stopped.

## Integration

This command integrates with:
- `/collect` - Gathers architecture into buildguide.md
- `/checkpoint` - Saves state after each feature
- Auto-continue hook - Handles context compaction
- PostToolUse hook - Auto-lints after every edit
