---
description: Run all quality gates (lint, typecheck, test) and report status
argument-hint: "[--fix]"
---

# Validate Command

Run comprehensive quality checks and optionally fix issues.

## Usage

```
/validate         # Check only, report issues
/validate --fix   # Check and auto-fix what's possible
```

## Instructions

Parse arguments: $ARGUMENTS

### Step 1: Detect Project Type

Check for project markers:

```bash
# Detect project type
PROJECT_TYPE="unknown"
LINT_CMD=""
TYPE_CMD=""
TEST_CMD=""
FIX_CMD=""

if [[ -f "package.json" ]]; then
    PROJECT_TYPE="node"
    # Check package.json scripts
    if grep -q '"lint"' package.json; then
        LINT_CMD="npm run lint"
        FIX_CMD="npm run lint -- --fix"
    elif [[ -f ".eslintrc.js" ]] || [[ -f ".eslintrc.json" ]] || [[ -f "eslint.config.js" ]]; then
        LINT_CMD="npx eslint ."
        FIX_CMD="npx eslint . --fix"
    fi

    if grep -q '"typecheck"' package.json; then
        TYPE_CMD="npm run typecheck"
    elif [[ -f "tsconfig.json" ]]; then
        TYPE_CMD="npx tsc --noEmit"
    fi

    if grep -q '"test"' package.json; then
        TEST_CMD="npm test"
    fi

elif [[ -f "pyproject.toml" ]] || [[ -f "requirements.txt" ]]; then
    PROJECT_TYPE="python"
    if command -v ruff &> /dev/null; then
        LINT_CMD="ruff check ."
        FIX_CMD="ruff check . --fix && ruff format ."
    elif command -v pylint &> /dev/null; then
        LINT_CMD="pylint **/*.py"
    fi

    if command -v mypy &> /dev/null; then
        TYPE_CMD="mypy ."
    fi

    if command -v pytest &> /dev/null; then
        TEST_CMD="pytest"
    fi

elif [[ -f "go.mod" ]]; then
    PROJECT_TYPE="go"
    LINT_CMD="go vet ./... && staticcheck ./..."
    TYPE_CMD="go build ./..."
    TEST_CMD="go test ./..."
    FIX_CMD="gofmt -w ."

elif [[ -f "Cargo.toml" ]]; then
    PROJECT_TYPE="rust"
    LINT_CMD="cargo clippy -- -D warnings"
    TYPE_CMD="cargo check"
    TEST_CMD="cargo test"
    FIX_CMD="cargo fmt"
fi

echo "Project type: $PROJECT_TYPE"
```

### Step 2: Run Quality Checks

Run each check and collect results:

```bash
echo "## Quality Report"
echo ""

LINT_PASS=true
TYPE_PASS=true
TEST_PASS=true

# Lint check
if [[ -n "$LINT_CMD" ]]; then
    echo "### Lint"
    if $LINT_CMD 2>&1; then
        echo "✅ Lint passed"
    else
        echo "❌ Lint failed"
        LINT_PASS=false
    fi
    echo ""
fi

# Type check
if [[ -n "$TYPE_CMD" ]]; then
    echo "### Types"
    if $TYPE_CMD 2>&1; then
        echo "✅ Types passed"
    else
        echo "❌ Types failed"
        TYPE_PASS=false
    fi
    echo ""
fi

# Test check
if [[ -n "$TEST_CMD" ]]; then
    echo "### Tests"
    if $TEST_CMD 2>&1; then
        echo "✅ Tests passed"
    else
        echo "❌ Tests failed"
        TEST_PASS=false
    fi
    echo ""
fi
```

### Step 3: If --fix Flag

If `$ARGUMENTS` contains `--fix`:

1. Run fix commands where available
2. Re-run validation
3. Report what was fixed vs what remains

### Step 4: Spawn Fix Agents for Remaining Issues

If any checks failed and --fix was specified:

```
Spawn parallel Task agents to fix issues:

If LINT_PASS is false:
  Task agent: "Read the lint errors above. Fix each lint issue in the affected files. Run lint again to verify."

If TYPE_PASS is false:
  Task agent: "Read the type errors above. Fix each type error. Run typecheck again to verify."

If TEST_PASS is false:
  Task agent: "Read the test failures above. Analyze root cause. Fix the code or tests. Run tests again to verify."
```

### Step 5: Final Report

```markdown
## Validation Summary

| Check | Status |
|-------|--------|
| Lint | ✅/❌ |
| Types | ✅/❌ |
| Tests | ✅/❌ |

[If all pass]: Ready for commit!
[If any fail]: Issues remain - see details above.
```

## Integration

- Called automatically by `/build` after each feature
- Can be run standalone anytime
- PostToolUse hook runs subset after each edit
