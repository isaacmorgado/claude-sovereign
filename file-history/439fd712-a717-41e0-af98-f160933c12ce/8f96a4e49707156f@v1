# MultiAgent - Continuation Prompt

## Project Overview

Forking RooCode to create **MultiAgent** - a VS Code extension with:
- Parallel agent execution (like Claude Code's Task tool)
- OAuth authentication for Claude Max and Gemini subscriptions
- Zhipu GLM-4 provider
- All existing RooCode features (40+ providers, MCP, terminal, etc.)

## Repository Location
```
/Users/imorgado/Projects/Roo-Code
```

## What's Already Built (No Changes Needed)

### Authentication
- **Claude Code OAuth**: `src/integrations/claude-code/oauth.ts` - Full PKCE OAuth flow
- **Claude Code Provider**: `src/api/providers/claude-code.ts` - Uses OAuth tokens

### Providers (40+)
- `src/api/providers/anthropic.ts` - Direct Anthropic API
- `src/api/providers/gemini.ts` - Google Gemini (API key)
- `src/api/providers/deepseek.ts` - DeepSeek
- `src/api/providers/openai.ts` - OpenAI
- `src/api/providers/bedrock.ts` - AWS Bedrock
- All others in `src/api/providers/`

### Tools
- `src/core/tools/ExecuteCommandTool.ts` - Terminal/shell commands
- `src/core/tools/RunSlashCommandTool.ts` - Slash commands
- `src/core/tools/NewTaskTool.ts` - Subtask creation (sequential)
- `src/core/tools/UseMcpToolTool.ts` - MCP server tools
- All file operations, browser, search, etc.

---

## Changes Required

### 1. REBRANDING (Easy)
Files to modify:
```
src/package.json                    # name: "multi-agent", displayName, publisher
package.json                        # Root package name
src/assets/icons/                   # New icon
README.md                           # New branding
```

Key changes in `src/package.json`:
```json
{
  "name": "multi-agent",
  "displayName": "MultiAgent",
  "publisher": "YourName",
  "description": "Multi-provider AI coding assistant with parallel agents"
}
```

### 2. PARALLEL EXECUTION (Medium)

#### A. Modify NewTaskTool
**File**: `src/core/tools/NewTaskTool.ts`
```typescript
interface NewTaskParams {
  mode: string
  message: string
  todos?: string
  run_in_background?: boolean  // NEW: Don't block parent
}
```

#### B. Modify Task Types
**File**: `packages/types/src/task.ts`
```typescript
interface TaskLike {
  readonly childTaskIds?: string[]  // Change from childTaskId
  readonly executionMode?: "parallel" | "sequential"
}
```

#### C. Add TaskOutput Tool
**New File**: `src/core/tools/TaskOutputTool.ts`
```typescript
// Like Claude Code's TaskOutput - wait for background task results
interface TaskOutputParams {
  task_id: string
  block?: boolean
  timeout?: number
}
```

#### D. Modify Task Provider
**File**: `src/services/task/TaskProvider.ts`
- Add concurrent task tracking
- Implement `Promise.all()` for parallel execution
- Add task result collection

### 3. ZHIPU GLM-4 PROVIDER (Easy)

**New File**: `src/api/providers/zhipu-glm.ts`
```typescript
import { ApiHandler } from ".."
import { ApiStream } from "../transform/stream"

export class ZhipuGLMHandler implements ApiHandler {
  private apiKey: string
  private baseUrl = "https://open.bigmodel.cn/api/paas/v4"

  async *createMessage(...): ApiStream {
    // GLM-4 API implementation
    // Similar structure to other providers
  }
}
```

**Modify**: `packages/types/src/api.ts`
- Add "zhipu-glm" to ApiProvider enum
- Add ZhipuGLM model definitions

**Modify**: `src/api/index.ts`
- Import and register ZhipuGLMHandler

### 4. GEMINI OAUTH (Medium)

**New File**: `src/integrations/gemini/oauth.ts`
```typescript
// Google OAuth flow for Gemini
// Similar structure to claude-code/oauth.ts
export const GEMINI_OAUTH_CONFIG = {
  authorizationEndpoint: "https://accounts.google.com/o/oauth2/v2/auth",
  tokenEndpoint: "https://oauth2.googleapis.com/token",
  clientId: "YOUR_GOOGLE_CLIENT_ID",
  scopes: "https://www.googleapis.com/auth/generative-language",
}
```

**Modify**: `src/api/providers/gemini.ts`
- Add OAuth option alongside API key

---

## Key Files Summary

### Core Architecture
```
src/extension.ts                           # Extension entry point
src/core/task/Task.ts                      # Task execution logic
src/core/webview/webviewMessageHandler.ts  # UI message handling
src/services/task/TaskProvider.ts          # Task management
packages/types/src/task.ts                 # Task type definitions
packages/types/src/tool.ts                 # Tool type definitions
packages/types/src/api.ts                  # API provider types
```

### Providers
```
src/api/providers/index.ts                 # Provider registry
src/api/providers/base-provider.ts         # Base provider class
src/api/providers/claude-code.ts           # Claude OAuth provider
src/api/providers/anthropic.ts             # Direct Anthropic API
src/api/providers/gemini.ts                # Google Gemini
src/api/providers/deepseek.ts              # DeepSeek
```

### Tools
```
src/core/tools/NewTaskTool.ts              # Subtask creation
src/core/tools/ExecuteCommandTool.ts       # Terminal commands
src/core/tools/RunSlashCommandTool.ts      # Slash commands
src/core/tools/UseMcpToolTool.ts           # MCP tools
```

### Authentication
```
src/integrations/claude-code/oauth.ts      # Claude OAuth (complete)
src/integrations/claude-code/streaming-client.ts  # Claude streaming
webview-ui/src/oauth/                      # OAuth UI components
```

### Configuration
```
src/shared/modes.ts                        # Mode definitions (Orchestrator, Code, etc.)
src/shared/experiments.ts                  # Feature flags
.roomodes                                  # Custom mode definitions
```

---

## Build & Test

```bash
cd /Users/imorgado/Projects/Roo-Code
pnpm install
pnpm build
# Press F5 in VS Code to launch extension in debug mode
```

---

## Continuation Prompt

Copy this to continue in a new session:

```
I'm building MultiAgent, a fork of RooCode at /Users/imorgado/Projects/Roo-Code

Goals:
1. Rebrand from "RooCode" to "MultiAgent"
2. Add parallel agent execution (like Claude Code's Task tool with run_in_background)
3. Add Zhipu GLM-4 provider (Chinese AI model)
4. Add Gemini OAuth (to use my $200/mo subscription)
5. Keep all existing features (Claude OAuth already works, 40+ providers, MCP, terminal, etc.)

Key files for parallel execution:
- src/core/tools/NewTaskTool.ts (add run_in_background param)
- packages/types/src/task.ts (change childTaskId to childTaskIds[])
- src/services/task/TaskProvider.ts (add concurrent task management)
- NEW: src/core/tools/TaskOutputTool.ts (wait for background task results)

Key files for new provider:
- NEW: src/api/providers/zhipu-glm.ts
- packages/types/src/api.ts (add provider type)
- src/api/index.ts (register provider)

Key files for Gemini OAuth:
- NEW: src/integrations/gemini/oauth.ts
- src/api/providers/gemini.ts (add OAuth option)

Key files for rebranding:
- src/package.json (name, displayName, publisher)
- package.json (root)
- src/assets/icons/ (new icon)

The Claude Code OAuth is already complete at src/integrations/claude-code/oauth.ts

Please help me implement these changes starting with [SPECIFY WHAT TO START WITH].
```

---

## Provider Credentials Reference

### Your Existing Subscriptions
- **Claude Max**: OAuth via `src/integrations/claude-code/oauth.ts` (already works!)
- **Gemini $200 plan**: Need OAuth implementation
- **Zhipu GLM-4**: API key at https://open.bigmodel.cn/

### Token Storage
- Claude OAuth: VS Code secrets (`context.secrets`)
- Gemini OAuth: Will use same pattern
- API keys: VS Code settings or secrets
