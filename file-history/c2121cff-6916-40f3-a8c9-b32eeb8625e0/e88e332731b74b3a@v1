# FaceIQ Ethnicity/Gender Integration Plan

## Critical Discovery

After extensive analysis of the FaceIQ HAR capture (396MB, 3,305 entries), I found that **FaceIQ does NOT use different ideal ranges for different ethnicities or genders in their scoring algorithm**.

### Evidence:

1. **API Responses**: The `/api/faces` endpoint returns `gender` and `race` fields but no ethnicity/gender-specific scoring parameters
2. **Client-Side Scoring**: The scoring formula `score = minScore + (maxScore - minScore) * exp(-decayRate * deviation)` uses `t.idealMin` and `t.idealMax` directly from metric config - no gender/race lookup
3. **No Conditional Logic**: Searched all FaceIQ JavaScript (2.2MB) for patterns like `gender === "male"` or `race === "asian"` near ideal values - none found
4. **Landmark-Only Variation**: Found `getFrontLandmarkList(gender, ethnicity)` and `getSideLandmarkList(gender, ethnicity)` - these only affect which landmarks to **display**, not scoring

### What FaceIQ Actually Uses Gender/Race For:

| Feature | Uses Gender/Race? |
|---------|------------------|
| Ideal value ranges | NO - same for all |
| Scoring formula | NO - universal |
| Landmark visualization | YES - different display lists |
| Metric descriptions | YES - text mentions gender differences |
| UI selection | YES - collected but not used in scoring |

## FaceIQ Ethnicities Found (9 total):
- `east_asian`, `south_asian`, `black`, `hispanic`, `middle_eastern`, `native_american`, `pacific_islander`, `white`, `other`

## FaceIQ Genders Found (2):
- `male`, `female`

---

## Implementation Options

### Option A: Match FaceIQ Exactly (User's Request)
Since FaceIQ uses universal scoring, matching them means:
- Keep current universal `idealMin`/`idealMax` values
- Add ethnicity/gender-specific landmark display lists
- No changes to scoring math

**Files to modify:**
- `src/lib/landmarks.ts` - Add `getLandmarkList(gender, ethnicity)` functions
- UI components - Use landmark lists for display

### Option B: Improve Beyond FaceIQ
Implement actual ethnicity/gender-specific ideal ranges based on anthropometric research:
- Create `ETHNICITY_GENDER_OVERRIDES` config
- Modify `calculateScore()` to accept and use demographics
- Research and add scientifically-backed variations

**Files to modify:**
- `src/lib/faceiq-scoring.ts` - Add demographic-specific ideal ranges
- `src/contexts/ResultsContext.tsx` - Pass demographics through pipeline
- Analysis components - Integrate ethnicity from context

---

## Current State of Our Implementation

| Component | Status |
|-----------|--------|
| Gender context | Exists (`GenderContext.tsx`) - UI only |
| Ethnicity context | Exists (`EthnicityContext.tsx`) - 9 options matching FaceIQ |
| Scoring function | Has `gender` param but ignores it: `void gender; // Reserved` |
| Ethnicity in scoring | Not passed at all |

---

## Recommendation

Given the user's request to match FaceIQ "exactly", the answer is that **FaceIQ's current implementation already matches ours** - neither uses ethnicity/gender in scoring.

If the user wants to **improve** on FaceIQ with actual ethnicity/gender-specific scoring, that would require:
1. Anthropometric research for ideal ranges per demographic
2. Creating a lookup table of `{ ethnicity, gender } -> MetricConfig overrides`
3. Modifying scoring pipeline to use these overrides

## Questions for User

1. The HAR analysis shows FaceIQ doesn't actually use different ideal ranges per ethnicity/gender. Do you want me to:
   - **A)** Match FaceIQ exactly (current implementation already does this)
   - **B)** Improve beyond FaceIQ by researching and implementing actual ethnicity/gender-specific ideal ranges

2. If Option B, should I prioritize any specific metrics for ethnicity/gender variation (e.g., nose metrics for different ethnicities, jaw metrics for gender)?
