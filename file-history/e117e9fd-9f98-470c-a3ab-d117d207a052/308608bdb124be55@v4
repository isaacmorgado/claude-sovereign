# SPLICE

AI-powered Premiere Pro UXP plugin for detecting takes, removing silences, and accelerating video editing workflows.

## Current Focus
**Auto-Cutting v3.0** - Fully automatic clip cutting with preview and cross-platform support

## Quick Reference

### UI Layout (v3.0)
```
+----------------------------------------------------------+
|  SPLICE                                      [?] [GEAR]   |
+----------------------------------------------------------+
|  Credits: 47/100                              [Get More]  |
+----------------------------------------------------------+
|  +------------------------------------------------------+ |
|  |  Detection: ( ) Audio Only      (1 credit/min)       | |
|  |             (*) Audio + Dialogue (3 credits/min)     | |
|  |                                                      | |
|  |  [ ] Vocal Isolation (noisy audio) (+2 credits)      | |
|  |                                                      | |
|  |  Sensitivity: [========|=================]           | |
|  |               Less              More                 | |
|  |                                                      | |
|  |  Padding:     [=======|==================]  0.3s     | |
|  |               Less              More                 | |
|  |                                                      | |
|  |              [ ANALYZE ]                             | |
|  +------------------------------------------------------+ |
+----------------------------------------------------------+
```

### Detection Modes
| Mode | Cost | Description |
|------|------|-------------|
| Audio Only | 1 credit/min | FFprobe silence detection (fast) |
| Audio + Dialogue | 3 credits/min | FFprobe + LLM takes (dialogue-heavy) |
| + Vocal Isolation | +2 credits | Isolate voice from noisy audio |

### Key Constraints
- UXP requires Premiere Pro 25.6+
- Use `127.0.0.1` not `localhost` in fetch URLs
- FFprobe required: `brew install ffmpeg`
- Backend runs at https://127.0.0.1:3847
- Cross-platform: macOS (AppleScript) + Windows (PowerShell)

## Key Files

### Plugin (v3.0)
| File | Purpose |
|------|---------|
| `splice-plugin/index.html` | Single action card, credit display, dual sliders |
| `splice-plugin/js/main.js` | Unified workflow with preview step |
| `splice-plugin/js/credits.js` | NEW - Fetch and display credit balance |
| `splice-plugin/js/preview.js` | NEW - Timeline visualization for cut preview |
| `splice-plugin/js/settings.js` | Preferences persistence (localStorage) |
| `splice-plugin/js/slice8-silence.js` | mapSensitivity() utility |

### Backend (v3.0)
| File | Purpose |
|------|---------|
| `splice-backend/server.js` | Express HTTPS + `/analyze`, `/apply-cuts`, `/credits` |
| `splice-backend/services/automator.js` | NEW - Cross-platform router |
| `splice-backend/services/automator-mac.js` | NEW - macOS AppleScript automation |
| `splice-backend/services/automator-win.js` | NEW - Windows PowerShell automation |
| `splice-backend/services/hybridDetection.js` | NEW - Audio + LLM combined detection |
| `splice-backend/services/smartFiltering.js` | NEW - Natural pause preservation |
| `splice-backend/services/usageTracking.js` | NEW - Credit balance, usage logging |
| `splice-backend/middleware/rateLimiter.js` | NEW - Credit check middleware |

## Smart Settings (Always-On)
- **Natural Pause Detection** - Preserves breaths and thinking pauses (<0.5s)
- **Sentence Boundary Respect** - Never cuts mid-sentence (dialogue mode)
- **Minimum Keep Duration** - Never creates clips shorter than 0.3s

## Usage & Billing (80% Margin Target)
| Mode | Our Cost | User Credits |
|------|----------|--------------|
| Audio Only | ~$0.005/min | 1 credit/min |
| Audio + Dialogue | ~$0.02/min | 3 credits/min |
| + Vocal Isolation | +$0.02/run | +2 credits |

## Workflow (v3.0)
1. Pick detection mode and adjust sliders
2. Click **Analyze** - silences detected, preview shown
3. Review preview - see exactly what will be cut
4. Click **Apply Cuts** - XML export → process → import (automatic)
5. Undo if needed - one-click restore

## Implementation Phases

### Phase 1: Usage & Billing System (Backend)
- [ ] Create `usageTracking.js` - credit balance, usage logging
- [ ] Create `rateLimiter.js` - middleware for credit checks
- [ ] Add `/credits` endpoint

### Phase 2: UI Simplification (Frontend)
- [ ] Update `index.html` - single card, credit display
- [ ] Create `credits.js` - fetch/display balance

### Phase 3: Preview Mode
- [ ] Create `preview.js` - timeline visualization
- [ ] Update `main.js` - preview workflow

### Phase 4: Smart Filtering (Backend)
- [ ] Create `smartFiltering.js` - pause preservation, sentence boundaries

### Phase 5: Cross-Platform Automation
- [ ] Create `automator.js` - platform detection router
- [ ] Create `automator-mac.js` - AppleScript automation
- [ ] Create `automator-win.js` - PowerShell automation

### Phase 6: Integration & Polish
- [ ] End-to-end testing (macOS + Windows)
- [ ] Error handling and progress feedback

## Sensitivity Slider Mapping
| Position | dB Threshold | Min Duration | Padding |
|----------|--------------|--------------|---------|
| 0% (Less) | -50dB | 2.0s | 0.2s |
| 50% (Default) | -35dB | 1.15s | 0.125s |
| 100% (More) | -20dB | 0.3s | 0.05s |

---
*Last updated: 2025-12-19*
