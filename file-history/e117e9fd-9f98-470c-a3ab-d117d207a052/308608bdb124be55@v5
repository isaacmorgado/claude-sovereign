# SPLICE

AI-powered Premiere Pro UXP plugin for detecting takes, removing silences, and accelerating video editing workflows.

## Current Focus
**Auto-Cutting v3.0** - Fully automatic clip cutting with preview and cross-platform support

## Quick Reference

### UI Layout (v3.0)
```
+----------------------------------------------------------+
|  SPLICE                                      [?] [GEAR]   |
+----------------------------------------------------------+
|  Pro Plan: 42/50 hours remaining             [Upgrade]    |
+----------------------------------------------------------+
|  +------------------------------------------------------+ |
|  |  Detection: ( ) Audio Only                           | |
|  |             (*) Audio + Dialogue                     | |
|  |                                                      | |
|  |  [ ] Vocal Isolation (for noisy audio)               | |
|  |                                                      | |
|  |  Sensitivity: [========|=================]           | |
|  |               Less              More                 | |
|  |                                                      | |
|  |  Padding:     [=======|==================]  0.3s     | |
|  |               Less              More                 | |
|  |                                                      | |
|  |              [ ANALYZE ]                             | |
|  +------------------------------------------------------+ |
+----------------------------------------------------------+
```

### Pricing Tiers (80%+ Margins)
| Tier | Price | Included Hours | Our Cost | Margin |
|------|-------|----------------|----------|--------|
| **Starter** | $19/mo | 15 hours | $2.40 | 87% |
| **Pro** | $49/mo | 50 hours | $8 | 84% |
| **Team** | $149/mo | 150 hours | $24 | 84% |
| **Overage** | $1/hour | - | $0.16 | 84% |

### Detection Modes
| Mode | Description |
|------|-------------|
| Audio Only | FFprobe silence detection (fast) |
| Audio + Dialogue | FFprobe + LLM takes (dialogue-heavy) |
| + Vocal Isolation | Isolate voice from noisy audio |

### Key Constraints
- UXP requires Premiere Pro 25.6+
- Use `127.0.0.1` not `localhost` in fetch URLs
- FFprobe required: `brew install ffmpeg`
- Backend runs at https://127.0.0.1:3847
- Cross-platform: macOS (AppleScript) + Windows (PowerShell)

## Key Files

### Plugin (v3.0)
| File | Purpose |
|------|---------|
| `splice-plugin/index.html` | Single action card, credit display, dual sliders |
| `splice-plugin/js/main.js` | Unified workflow with preview step |
| `splice-plugin/js/credits.js` | NEW - Fetch and display credit balance |
| `splice-plugin/js/preview.js` | NEW - Timeline visualization for cut preview |
| `splice-plugin/js/settings.js` | Preferences persistence (localStorage) |
| `splice-plugin/js/slice8-silence.js` | mapSensitivity() utility |

### Backend (v3.0)
| File | Purpose |
|------|---------|
| `splice-backend/server.js` | Express HTTPS + `/analyze`, `/apply-cuts`, `/credits` |
| `splice-backend/services/automator.js` | NEW - Cross-platform router |
| `splice-backend/services/automator-mac.js` | NEW - macOS AppleScript automation |
| `splice-backend/services/automator-win.js` | NEW - Windows PowerShell automation |
| `splice-backend/services/hybridDetection.js` | NEW - Audio + LLM combined detection |
| `splice-backend/services/smartFiltering.js` | NEW - Natural pause preservation |
| `splice-backend/services/usageTracking.js` | NEW - Credit balance, usage logging |
| `splice-backend/middleware/rateLimiter.js` | NEW - Credit check middleware |

## Smart Settings (Always-On)
- **Natural Pause Detection** - Preserves breaths and thinking pauses (<0.5s)
- **Sentence Boundary Respect** - Never cuts mid-sentence (dialogue mode)
- **Minimum Keep Duration** - Never creates clips shorter than 0.3s

## Usage & Billing (80%+ Margins Achieved)

### Cost Structure (Batch Processing)
| Component | Our Cost | Notes |
|-----------|----------|-------|
| GPT-4o-mini Transcribe | $0.003/min | 50% cheaper than Whisper |
| GPT-4o-mini Analysis | ~$0.01/hr | Take detection |
| Replicate Vocal Isolation | $0.02/run | T4 GPU |
| **Total per hour** | **$0.16/hr** | With batch processing |

### Referral Program (Credit-Based, NOT Discounts)
| Recipient | Reward | Our Cost |
|-----------|--------|----------|
| Referrer | $15 processing credit | ~$2.40 |
| Referee | $20 credit + 7-day trial | ~$3.20 |
| **Total CAC** | | **$5.60** |

**Why credits, not "50% off first month":**
- Credits have 70-80% redemption (not all used)
- Doesn't train discount expectations
- Drives product engagement
- 50% off = $9.50-$24.50 loss vs $5.60 with credits

## Workflow (v3.0)
1. Pick detection mode and adjust sliders
2. Click **Analyze** - silences detected, preview shown
3. Review preview - see exactly what will be cut
4. Click **Apply Cuts** - XML export → process → import (automatic)
5. Undo if needed - one-click restore

## Implementation Phases

### Phase 1: Usage & Billing System (Backend)
- [ ] Create `usageTracking.js` - credit balance, usage logging
- [ ] Create `rateLimiter.js` - middleware for credit checks
- [ ] Add `/credits` endpoint

### Phase 2: UI Simplification (Frontend)
- [ ] Update `index.html` - single card, credit display
- [ ] Create `credits.js` - fetch/display balance

### Phase 3: Preview Mode
- [ ] Create `preview.js` - timeline visualization
- [ ] Update `main.js` - preview workflow

### Phase 4: Smart Filtering (Backend)
- [ ] Create `smartFiltering.js` - pause preservation, sentence boundaries

### Phase 5: Cross-Platform Automation
- [ ] Create `automator.js` - platform detection router
- [ ] Create `automator-mac.js` - AppleScript automation
- [ ] Create `automator-win.js` - PowerShell automation

### Phase 6: Integration & Polish
- [ ] End-to-end testing (macOS + Windows)
- [ ] Error handling and progress feedback

## Sensitivity Slider Mapping
| Position | dB Threshold | Min Duration | Padding |
|----------|--------------|--------------|---------|
| 0% (Less) | -50dB | 2.0s | 0.2s |
| 50% (Default) | -35dB | 1.15s | 0.125s |
| 100% (More) | -20dB | 0.3s | 0.05s |

---
*Last updated: 2025-12-19*
