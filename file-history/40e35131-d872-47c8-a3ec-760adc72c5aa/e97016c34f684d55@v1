// Generate large transcript for stress testing
const https = require('https');

// Generate 500 words with some repetitions
const words = [];
const phrases = ['I want to say', 'the thing is', 'you know what', 'basically like'];

for (let i = 0; i < 500; i++) {
  // Insert repetition every 50 words
  if (i > 0 && i % 50 === 0) {
    const phrase = phrases[Math.floor(i / 50) % phrases.length].split(' ');
    phrase.forEach((w, j) => {
      words.push({ word: w, start: i + j * 0.3, end: i + (j + 1) * 0.3 });
    });
    // Repeat the phrase
    phrase.forEach((w, j) => {
      words.push({ word: w, start: i + 2 + j * 0.3, end: i + 2 + (j + 1) * 0.3 });
    });
    i += phrase.length * 2;
  } else {
    words.push({ word: `word${i}`, start: i * 0.5, end: i * 0.5 + 0.4 });
  }
}

const data = JSON.stringify({
  transcript: { words },
  options: { mode: 'basic', phraseSize: 4, tolerance: 0.7 }
});

const start = Date.now();

const req = https.request({
  hostname: '127.0.0.1',
  port: 3847,
  path: '/repetitions',
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  rejectUnauthorized: false
}, (res) => {
  let body = '';
  res.on('data', chunk => body += chunk);
  res.on('end', () => {
    const elapsed = Date.now() - start;
    const result = JSON.parse(body);
    console.log('Words processed:', words.length);
    console.log('Time:', elapsed + 'ms');
    console.log('Repetitions found:', (result.repetitions && result.repetitions.length) || 0);
    console.log('Stutters found:', (result.stutters && result.stutters.length) || 0);
    console.log('Removal segments:', (result.removalSegments && result.removalSegments.length) || 0);
    if (elapsed > 1000) {
      console.log('WARNING: Slow performance (>1s)');
    } else {
      console.log('OK: Performance acceptable');
    }
  });
});

req.on('error', e => console.error('Error:', e.message));
req.write(data);
req.end();
