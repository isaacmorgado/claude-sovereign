# LOOKSMAXX

A facial metrics analysis and visualization system with Next.js frontend and MediaPipe-based facial landmark detection.

## Current Focus
Section: Landmark analysis tool - side profile flow
Files: `src/components/LandmarkAnalysisTool.tsx`, `src/lib/landmarks.ts`

## Tech Stack

- **Framework**: Next.js 14 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **Animation**: Framer Motion
- **Face Detection**: MediaPipe Tasks Vision (native WASM)
- **Icons**: Lucide React

## Organization Rules

- Pages/Routes → `src/app/`
- Components → `src/components/`
- Utilities → `src/lib/`
- Types → `src/types/` or co-located

## Code Quality

```bash
cd looksmaxx-app && npm run lint && npx tsc --noEmit
```

## Last Session (2025-12-19)

### Human.js Integration for Side Profile Detection
- Installed `@vladmandic/human` package for better profile face detection
- Created `src/lib/humanDetection.ts` - Human.js service with 468 3D landmarks
- Human.js handles head rotation (yaw/pitch/roll) and works on non-frontal faces
- Detection hierarchy: Human.js → MediaPipe → Edge-based → Manual placement

### Frankfort Horizontal Plane
- Added Frankfort Plane visualization for side profiles (green dashed line)
- Defined by: Orbitale (lowest orbital rim) → Porion (ear canal opening)
- Shows when face is in natural head position (plane should be horizontal)
- Calculated and displayed after successful side profile detection

### Side Profile Edge-Based Detection (Fallback)
- Created `src/lib/sideProfileDetection.ts` - edge detection fallback
- Uses Sobel edge detection to find profile silhouette
- Algorithm: Grayscale → Gaussian blur → Sobel edges → Contour extraction → Anchor points

### Persistent Landmark Dots
- Placed landmarks now show immediately as small 8px colored dots (like FaceIQ)
- Removed "Show All Points" toggle - landmarks are always visible
- Dots have subtle glow effect and white border for visibility

### Side Profile Landmark Update (matches FaceIQ exactly)
- Updated side profile from 31 to **28 landmarks** matching FaceIQ Labs exact naming and order
- FaceIQ side order: `vertex, occiput, pronasale, neckPoint, porion, orbitale, tragus, intertragicNotch, cornealApex, cheekbone, trichion, glabella, nasion, rhinion, supratip, infratip, columella, subnasale, subalare, labraleSuperius, cheilion, labraleInferius, sublabiale, pogonion, menton, cervicalPoint, gonionTop, gonionBottom`

### Files Updated
- `src/lib/humanDetection.ts` - **NEW** Human.js detection service
- `src/lib/sideProfileDetection.ts` - Edge-based side profile detection (fallback)
- `src/lib/mediapipeDetection.ts` - Detection hierarchy with Human.js + Frankfort Plane
- `src/components/LandmarkAnalysisTool.tsx` - Frankfort Plane visualization, persistent dots
- `src/lib/landmarks.ts` - Side profile landmarks and categories
- `src/lib/landmarkImages.ts` - Side landmark image configs with FaceIQ descriptions

### Key Insight
- MediaPipe Face Mesh only works on frontal faces (fails on side profiles)
- Human.js (`@vladmandic/human`) handles head rotation and works better on profiles
- FaceIQ uses a custom server-side model - we use Human.js as client-side alternative
- Frankfort Plane is critical for cephalometric analysis - connects Orbitale and Porion

## Reference Mappings (from FaceIQ landmarkers.js)

```javascript
// Front profile (MediaPipe indices)
{
  cupidsBow: 267,        // peak of cupid's bow
  innerCupidsBow: 0,     // center dip of upper lip
  nasalBase: 290,
  neckLeft: 172,         // with yOffset: 0.05
  neckRight: 397,        // with yOffset: 0.05
  mouthLeft: 61,
  mouthRight: 306,
  mouthMiddle: 14,
  lowerLip: 17,
}
```

## Next Steps

1. Test side profile edge-based detection with various images
2. Fine-tune anchor point detection for better accuracy
3. Add reference images for new side profile landmark IDs
4. Consider background contrast detection for edge detection improvement
