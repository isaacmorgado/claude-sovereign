# LOOKSMAXX

A facial metrics analysis and visualization system with Next.js frontend and MediaPipe-based facial landmark detection.

## Current Focus
Section: Landmark analysis tool - side profile flow
Files: `src/components/LandmarkAnalysisTool.tsx`, `src/lib/landmarks.ts`

## Tech Stack

- **Framework**: Next.js 14 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **Animation**: Framer Motion
- **Face Detection**: MediaPipe Tasks Vision (native WASM)
- **Icons**: Lucide React

## Organization Rules

- Pages/Routes → `src/app/`
- Components → `src/components/`
- Utilities → `src/lib/`
- Types → `src/types/` or co-located

## Code Quality

```bash
cd looksmaxx-app && npm run lint && npx tsc --noEmit
```

## Last Session (2025-12-19)

### Railway Backend Created (`looksmaxx-api/`)
Built unified FastAPI backend for Railway deployment:
- **Auth**: JWT authentication with bcrypt password hashing
- **Detection**: InsightFace side profile detection (106 → 28 cephalometric landmarks)
- **Payments**: Stripe checkout and webhook handling
- **Storage**: PostgreSQL with SQLAlchemy async

### Backend Structure
```
looksmaxx-api/
├── app/
│   ├── main.py           # FastAPI app with lifespan
│   ├── routers/          # auth, detection, analyses, payments
│   ├── services/         # auth (JWT), detection (InsightFace)
│   ├── models/           # User, Analysis, Payment
│   └── schemas/          # Pydantic models
├── Dockerfile
├── railway.json
└── DEPLOY_NOTES.md       # Deployment instructions
```

### Frontend Updates for Railway
- `src/app/api/side-landmarks/route.ts` - Proxies to `/detection/side`
- `src/lib/api.ts` - API client for authenticated requests
- `src/contexts/AuthContext.tsx` - User auth state management
- `src/lib/serverSideDetection.ts` - Calls Railway for side detection

### PENDING: Railway Environment Variables
After deployment, configure in Railway dashboard:
- `JWT_SECRET` - Generate with `openssl rand -hex 32`
- `STRIPE_SECRET_KEY` - From Stripe dashboard
- `STRIPE_WEBHOOK_SECRET` - Create webhook pointing to `/payments/webhook`
- `FRONTEND_URL` - Vercel deployment URL

### Key Architecture Insight
- **Front profile**: MediaPipe (client-side, 478 landmarks)
- **Side profile**: InsightFace on Railway (server-side, 106 → 28 landmarks)
- **Scoring**: ALL calculations happen client-side in `src/lib/scoring.ts`
- Server only returns raw landmarks, client computes ratios/scores

## Reference Mappings (from FaceIQ landmarkers.js)

```javascript
// Front profile (MediaPipe indices)
{
  cupidsBow: 267,        // peak of cupid's bow
  innerCupidsBow: 0,     // center dip of upper lip
  nasalBase: 290,
  neckLeft: 172,         // with yOffset: 0.05
  neckRight: 397,        // with yOffset: 0.05
  mouthLeft: 61,
  mouthRight: 306,
  mouthMiddle: 14,
  lowerLip: 17,
}
```

## Next Steps

1. Deploy `looksmaxx-api` to Railway (see `DEPLOY_NOTES.md`)
2. Configure environment variables in Railway dashboard
3. Update frontend `.env.local` with Railway URL
4. Test end-to-end side profile detection flow
