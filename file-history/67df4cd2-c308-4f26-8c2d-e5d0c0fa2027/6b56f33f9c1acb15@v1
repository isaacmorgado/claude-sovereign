/**
 * Slice 1-2: Timeline Reading
 *
 * Basic timeline clip reading functionality.
 * Demonstrates UXP Premiere Pro API access.
 */

/**
 * Initialize the Read Timeline Clips button
 */
function initTimelineReader() {
  document.getElementById('readClipsBtn').addEventListener('click', async () => {
    const clipsEl = document.getElementById('clips');
    const btn = document.getElementById('readClipsBtn');

    btn.disabled = true;
    setStatus('Reading clips...');
    clipsEl.innerHTML = '';

    try {
      const context = await getActiveSequence();
      if (!context) {
        setStatus('No project or sequence open');
        btn.disabled = false;
        return;
      }

      const { sequence } = context;
      const clipNames = [];
      const numTracks = await sequence.getVideoTrackCount();

      for (let i = 0; i < numTracks; i++) {
        const track = await sequence.getVideoTrack(i);
        if (!track) continue;

        const clips = await track.getTrackItems(ppro.Constants.TrackItemType.CLIP, false);
        if (!clips) continue;

        for (let j = 0; j < clips.length; j++) {
          const clip = clips[j];
          if (!clip) continue;
          const name = await clip.getName();
          clipNames.push(name);
        }
      }

      if (clipNames.length === 0) {
        clipsEl.innerHTML = '<div class="no-clips">No clips in timeline</div>';
        setStatus('No clips found');
      } else {
        clipsEl.innerHTML = clipNames
          .map(name => `<div class="clip-item">${name}</div>`)
          .join('');
        setStatus(`Found ${clipNames.length} clip(s)`);
      }
    } catch (err) {
      setStatus(`Error: ${err.message}`);
      console.error('SPLICE error:', err);
    }

    btn.disabled = false;
  });
}
