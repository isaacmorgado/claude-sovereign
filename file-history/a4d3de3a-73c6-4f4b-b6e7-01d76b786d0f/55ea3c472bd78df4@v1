# Silence Removal Plugin for Premiere Pro UXP

## Executive Summary

A UXP plugin for Premiere Pro 25.6+ that removes silence from video clips using the proven XML export/modify/import workflow employed by commercial tools like TimeBolt, Recut, and AutoPod.

**Why this approach?** After exhaustive research, we confirmed:
- UXP has NO razor/split API (Adobe confirmed)
- QE DOM `razor()` is not accessible from UXP
- ExtendScript support ends September 2026
- Commercial tools use XML workflow successfully

---

## Architecture Overview

```
+---------------------------+          +---------------------------+
|   Premiere Pro UXP Plugin |          |   Node.js Helper Service  |
|   (Settings UI + Control) |<-------->|   (FFprobe Audio Analysis)|
+---------------------------+   HTTP   +---------------------------+
            |                                      |
            v                                      v
    +---------------+                      +----------------+
    | Export FCP XML |                     | FFprobe        |
    | (ExtendScript) |                     | silencedetect  |
    +---------------+                      +----------------+
            |                                      |
            v                                      v
    +--------------------------------------------------+
    |             XML Processing Module               |
    |  (fast-xml-parser: parse -> modify -> rebuild)  |
    +--------------------------------------------------+
            |
            v
    +---------------+
    | Import FCP XML |
    | (new sequence) |
    +---------------+
```

---

## Technology Stack

| Component | Technology | Purpose |
|-----------|------------|---------|
| Plugin UI | UXP + Spectrum Web Components | Settings panel |
| XML Parsing | fast-xml-parser (26KB) | Parse/modify FCP XML |
| Audio Analysis | Node.js + FFprobe | Detect silence timestamps |
| Communication | HTTP localhost:3000 | UXP <-> Helper service |
| XML Export | ExtendScript bridge | sequence.exportAsFinalCutProXML() |
| Bundler | Webpack (target: 'web') | Bundle npm packages for UXP |

---

## Component Breakdown

### 1. UXP Plugin Panel (`/plugin/`)

**Files:**
- `manifest.json` - Manifest v5, Premiere Pro 25.6+
- `index.html` - Main panel UI
- `index.js` - Entry point
- `src/ui/SettingsPanel.js` - Spectrum components
- `src/services/AudioAnalyzer.js` - HTTP client for FFprobe service
- `src/services/XMLProcessor.js` - FCP XML manipulation
- `src/services/PremiereAPI.js` - UXP Premiere API wrapper
- `src/utils/TimeUtils.js` - FCP XML time format conversions

**Key Manifest Permissions:**
```json
{
  "requiredPermissions": {
    "localFileSystem": "fullAccess",
    "network": { "domains": ["localhost", "127.0.0.1"] },
    "clipboard": "readAndWrite",
    "allowCodeGenerationFromStrings": true
  }
}
```

### 2. Node.js Helper Service (`/helper-service/`)

**Files:**
- `package.json` - Express, cors
- `server.js` - HTTP server on localhost:3000
- `ffprobe-runner.js` - Execute FFprobe silencedetect

**API Endpoints:**
- `POST /analyze` - Analyze audio file for silence
- `GET /health` - Service health check

**FFprobe Command:**
```bash
ffprobe -v quiet -print_format json \
  -f lavfi -i "amovie='input.wav',silencedetect=n=-30dB:d=0.5" \
  2>&1
```

### 3. XML Processor Module

**Key Operations:**
1. Parse FCP XML using fast-xml-parser
2. Extract clip timecodes and durations
3. Map silence timestamps to clip boundaries
4. Split clips at silence boundaries in XML structure
5. Remove silent clip segments
6. Rebuild valid FCP XML

**FCP XML Structure:**
```xml
<fcpxml version="1.11">
  <resources>
    <asset id="r2" src="file://..." start="0s" duration="..."/>
  </resources>
  <project name="SilenceRemoved">
    <sequence format="r1" tcStart="0s" duration="...">
      <spine>
        <asset-clip ref="r2" offset="0s" duration="..." name="Clip"/>
      </spine>
    </sequence>
  </project>
</fcpxml>
```

---

## Implementation Steps

### Phase 1: Project Setup

1. **Create plugin folder structure**
   ```
   silence-remover/
   ├── plugin/
   │   ├── manifest.json
   │   ├── index.html
   │   ├── index.js
   │   ├── webpack.config.js
   │   ├── package.json
   │   └── src/
   └── helper-service/
       ├── package.json
       ├── server.js
       └── ffprobe-runner.js
   ```

2. **Configure webpack for UXP**
   - Target: 'web' (not 'node')
   - No Node.js polyfills
   - Bundle fast-xml-parser

3. **Create manifest.json**
   - manifestVersion: 5
   - host: premierepro, minVersion: 25.6.0
   - Panel entrypoint with Spectrum UI

### Phase 2: Helper Service

4. **Build Node.js HTTP service**
   - Express server on localhost:3000
   - CORS enabled for UXP requests
   - FFprobe silencedetect execution
   - Return JSON with silence timestamps

5. **FFprobe integration**
   - Parse silencedetect output
   - Extract silence_start, silence_end timestamps
   - Calculate non-silent segments

### Phase 3: UXP Plugin Core

6. **Build Settings Panel UI**
   - Silence threshold slider (-50dB to -20dB)
   - Minimum duration input (0.1s to 2.0s)
   - Padding buffer input (0.0s to 0.5s)
   - Analyze button
   - Process button
   - Progress indicator

7. **Implement AudioAnalyzer service**
   - HTTP fetch to helper service
   - Send file path, receive silence data
   - Error handling for service unavailable

8. **Implement XMLProcessor module**
   - fast-xml-parser configuration
   - FCP XML time format utilities
   - Clip splitting algorithm
   - Silence segment removal

### Phase 4: Premiere Integration

9. **ExtendScript bridge for XML export**
   - Export active sequence to FCP XML
   - Save to temp folder
   - Return file path to UXP

10. **FCP XML import**
    - Import modified XML as new sequence
    - Or use project.importFiles() if supported

### Phase 5: Integration & Polish

11. **Connect all components**
    - Settings UI -> Audio Analysis -> XML Processing -> Import

12. **Error handling**
    - Service unavailable handling
    - Invalid XML handling
    - User-friendly error messages

13. **User experience**
    - Progress feedback
    - Preview mode (show what will be cut)
    - Undo support (new sequence, original preserved)

---

## Critical Files to Create

### `/plugin/manifest.json`
```json
{
  "manifestVersion": 5,
  "id": "com.silenceremover.premiere",
  "name": "Silence Remover",
  "version": "1.0.0",
  "main": "index.html",
  "host": {
    "app": "premierepro",
    "minVersion": "25.6.0"
  },
  "entrypoints": [{
    "type": "panel",
    "id": "silencePanel",
    "label": { "default": "Silence Remover" },
    "minimumSize": { "width": 350, "height": 500 }
  }],
  "requiredPermissions": {
    "localFileSystem": "fullAccess",
    "network": { "domains": ["localhost", "127.0.0.1"] },
    "allowCodeGenerationFromStrings": true
  }
}
```

### `/plugin/webpack.config.js`
```javascript
module.exports = {
  entry: './src/index.js',
  output: { filename: 'bundle.js' },
  target: 'web',
  resolve: {
    fallback: { fs: false, path: false, stream: false }
  }
};
```

### `/helper-service/server.js`
```javascript
const express = require('express');
const cors = require('cors');
const { analyzeAudio } = require('./ffprobe-runner');

const app = express();
app.use(cors());
app.use(express.json());

app.post('/analyze', async (req, res) => {
  const { filePath, threshold, minDuration } = req.body;
  const result = await analyzeAudio(filePath, threshold, minDuration);
  res.json(result);
});

app.listen(3000, () => console.log('Helper service on :3000'));
```

---

## Key Technical Details

### FCP XML Time Format
```javascript
// "1001/30000s" = 1001/30000 seconds (29.97fps frame)
function toSeconds(timeStr) {
  const match = timeStr.match(/^(\d+)\/(\d+)s$/);
  return match ? parseInt(match[1]) / parseInt(match[2]) : 0;
}

function fromSeconds(seconds, fps = 25) {
  const rates = { 25: { num: 100, den: 2500 }, 29.97: { num: 1001, den: 30000 }};
  const rate = rates[fps];
  const frames = Math.round(seconds * rate.den / rate.num);
  return `${frames * rate.num}/${rate.den}s`;
}
```

### FFprobe Silence Detection
```bash
# Output format:
# [silencedetect @ 0x...] silence_start: 1.234
# [silencedetect @ 0x...] silence_end: 2.567 | silence_duration: 1.333

# Parse to get segments:
# [{start: 0, end: 1.234}, {start: 2.567, end: 5.0}] (non-silent)
```

### UXP File Access
```javascript
const fs = require('uxp').storage.localFileSystem;

// Temp folder (no picker needed)
const tempFolder = await fs.getTemporaryFolder();
const xmlFile = await tempFolder.createFile('export.xml');

// Save picker for output
const outputFile = await fs.getFileForSaving('processed.xml');
```

---

## Dependencies

### Plugin (package.json)
```json
{
  "dependencies": {
    "fast-xml-parser": "^4.3.0"
  },
  "devDependencies": {
    "webpack": "^5.0.0",
    "webpack-cli": "^5.0.0"
  }
}
```

### Helper Service (package.json)
```json
{
  "dependencies": {
    "express": "^4.18.0",
    "cors": "^2.8.5"
  }
}
```

### System Requirements
- FFprobe installed (part of FFmpeg)
- Node.js 18+ for helper service
- Premiere Pro 25.6+

---

## User Workflow

1. Open Premiere Pro and load project
2. Start helper service: `cd helper-service && node server.js`
3. Open Silence Remover panel from Plugins menu
4. Select sequence in timeline
5. Configure settings (threshold, min duration, padding)
6. Click "Analyze" to detect silence
7. Preview detected segments (optional)
8. Click "Process" to create new sequence without silence
9. New sequence appears in project panel

---

## Risks and Mitigations

| Risk | Mitigation |
|------|------------|
| ExtendScript deprecated Sept 2026 | Monitor UXP API updates; may get native export |
| Helper service not running | Show clear error, add auto-start instructions |
| Large files slow to process | Add progress bar, process in chunks |
| XML import changes clip properties | Document known limitations, test thoroughly |

---

## Future Enhancements

- [ ] Package helper service as standalone app (Electron)
- [ ] Add preview waveform visualization
- [ ] Support batch processing multiple sequences
- [ ] Auto-start helper service from plugin
- [ ] Add preset profiles for different content types

---

## Sources

- [Adobe UXP API](https://developer.adobe.com/premiere-pro/uxp/)
- [SequenceEditor Class](https://developer.adobe.com/premiere-pro/uxp/ppro_reference/classes/sequenceeditor/)
- [ExtendScript exportAsFinalCutProXML](https://ppro-scripting.docsforadobe.dev/sequence/sequence/)
- [fast-xml-parser](https://github.com/NaturalIntelligence/fast-xml-parser)
- [FFmpeg silencedetect](https://ffmpeg.org/ffmpeg-filters.html#silencedetect)
- [FCPXML Reference](https://developer.apple.com/documentation/professional-video-applications/fcpxml-reference)
- [Adobe Community - UXP Razor Discussion](https://community.adobe.com/t5/premiere-pro-discussions/uxp-razor-tool-and-marking-clipped-sections/td-p/15547922)
