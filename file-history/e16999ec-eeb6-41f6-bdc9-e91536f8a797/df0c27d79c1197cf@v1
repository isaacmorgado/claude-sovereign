const fs = require('fs');

function extractCurves(filePath) {
  let html = fs.readFileSync(filePath, 'utf8');
  html = html.replace(/\\"/g, '"');

  const results = [];
  const sections = html.split('"name":"');

  for (const section of sections) {
    const nameMatch = section.match(/^([A-Z][a-zA-Z ()]+[^"]*)",/);
    if (!nameMatch) continue;

    const name = nameMatch[1];
    const cpMatch = section.match(/"customPoints":(\[[^\]]+\])/);
    if (!cpMatch) continue;

    try {
      const points = JSON.parse(cpMatch[1]);
      if (points.length > 0 && points[0].x !== undefined) {
        results.push({ name, points });
      }
    } catch(e) {}
  }
  return results;
}

const curves = extractCurves('/Users/imorgado/Desktop/FACEIQCOPY/frontviewratios.html');

// Map metric names to TypeScript keys
const nameToKey = {
  'Total Facial Width to Height Ratio': 'totalFacialWidthToHeight',
  'Middle Third': 'middleThirdProportion',
  'Lower Third': 'lowerThirdProportion',
  'Top Third': 'upperThirdProportion',
  'Eye Separation Ratio': 'eyeSeparationRatio',
  'Eyebrow Low Setedness': 'eyebrowLowSetedness',
  'Recession relative to frankfort plane': 'recessionFromFrankfort',
  'Submental Cervical Angle': 'submentalCervicalAngle',
  'Gonial Angle': 'gonialAngle',
  'Facial Convexity (Glabella)': 'facialConvexityGlabella'
};

function formatPoint(p) {
  const parts = ['x: ' + p.x, 'y: ' + p.y];
  if (p.leftHandleX !== undefined) parts.push('leftHandleX: ' + p.leftHandleX);
  if (p.leftHandleY !== undefined) parts.push('leftHandleY: ' + p.leftHandleY);
  if (p.rightHandleX !== undefined) parts.push('rightHandleX: ' + p.rightHandleX);
  if (p.rightHandleY !== undefined) parts.push('rightHandleY: ' + p.rightHandleY);
  if (p.fixed) parts.push('fixed: true');
  return '{ ' + parts.join(', ') + ' }';
}

console.log('// New curves to add to METRIC_CUSTOM_CURVES:\n');

curves.forEach(curve => {
  const key = nameToKey[curve.name] || curve.name.replace(/\s+/g, '').replace(/[()]/g, '');
  console.log('  ' + key + ': [');
  curve.points.forEach((p, i) => {
    const comma = i < curve.points.length - 1 ? ',' : '';
    console.log('    ' + formatPoint(p) + comma);
  });
  console.log('  ],\n');
});
