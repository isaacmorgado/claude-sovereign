## MultiAgent Continuation Prompt - Phase 6

I'm building MultiAgent, a fork of RooCode at /Users/imorgado/Projects/Roo-Code

## Completed Phases
- Phase 0: Rebranding (RooCode -> MultiAgent)
- Phase 1: Foundation (automation types)
- Phase 2: FileWatcherTrigger
- Phase 3: CronTrigger (node-cron)
- Phase 4: GitHookTrigger (VS Code Git API)
- Phase 5: Multi-Project Support (WorkspaceManager, WorkspaceProvider, UI)
- Phase 8: CLI MCP Servers

## Key Files for Phase 6

### Workspace Types (already defined)
- `packages/types/src/workspace.ts` - Contains:
  - `OrchestrationConfig` - orchestration settings schema
  - `OrchestrationTask` - coordinated cross-project task
  - `OrchestrationSubtask` - task within an orchestration
  - `ProjectDependencies` - maps projects to their dependencies

### Workspace Services (Phase 5)
- `src/services/workspace/WorkspaceManager.ts` - Manages workspace folders
- `src/services/workspace/WorkspaceProvider.ts` - Per-workspace context
- `src/services/workspace/index.ts` - Module exports

### Automation Services
- `src/services/automation/AutomationManager.ts` - Automation orchestration
- `src/services/automation/AutomationExecutor.ts` - Executes automation actions
- `src/services/automation/TriggerRegistry.ts` - Registry for triggers

### Extension Integration
- `src/extension.ts` - WorkspaceManager initialized here
- `src/core/webview/ClineProvider.ts` - Has switchWorkspace method

## Phase 6: Cross-Project Orchestration

### Goal
Implement the CrossProjectOrchestrator that coordinates tasks across multiple workspaces, respecting project dependencies and shared context.

### Tasks
1. Create `src/services/workspace/CrossProjectOrchestrator.ts`:
   - Coordinate tasks across multiple workspaces
   - Respect `projectDependencies` for execution order
   - Propagate shared context between workspaces
   - Track orchestration task status

2. Implement task dependency ordering:
   - Topological sort based on `projectDependencies`
   - Execute dependent tasks first
   - Handle circular dependency detection

3. Implement shared context propagation:
   - Use `sharedContext` patterns from config
   - Pass relevant context between workspace tasks

4. Add orchestration methods to WorkspaceManager:
   - `createOrchestrationTask()`
   - `executeOrchestration()`
   - `getOrchestrationStatus()`

### Types Reference (from packages/types/src/workspace.ts)

```typescript
interface OrchestrationTask {
  id: string
  name: string
  prompt: string
  targetWorkspaces: string[]
  dependencies: ProjectDependencies
  status: "pending" | "running" | "completed" | "failed"
  subtasks: OrchestrationSubtask[]
  startTime?: number
  endTime?: number
}

interface OrchestrationSubtask {
  id: string
  workspacePath: string
  taskId?: string
  prompt: string
  status: "pending" | "waiting_dependency" | "running" | "completed" | "failed"
  dependsOn: string[] // IDs of subtasks this depends on
  result?: string
}

interface OrchestrationConfig {
  enabled: boolean
  orchestratorMode?: string
  projectDependencies?: Record<string, string[]>
  sharedContext?: string[]
}
```

### Example Config (.multiagent/workspaces.yaml)

```yaml
orchestration:
  enabled: true
  orchestratorMode: architect
  projectDependencies:
    "${workspaceFolder}/apps/frontend":
      - "${workspaceFolder}/packages/shared"
      - "${workspaceFolder}/packages/api-client"
    "${workspaceFolder}/apps/backend":
      - "${workspaceFolder}/packages/shared"
  sharedContext:
    - "**/*.d.ts"
    - "**/package.json"
```

## Build Commands
```bash
pnpm run check-types  # TypeScript
pnpm run lint         # ESLint
```

## Plan File
~/.claude/plans/warm-toasting-stonebraker.md

Continue with Phase 6: Cross-Project Orchestration
