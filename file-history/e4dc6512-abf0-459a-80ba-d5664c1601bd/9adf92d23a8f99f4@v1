# LOOKSMAXX

A facial metrics analysis and visualization system with Next.js frontend and MediaPipe-based facial landmark detection. Now with FaceIQ-compatible scoring and results UI.

## Current Focus
Section: FaceIQ-compatible API and Results UI
Files: `looksmaxx-api/app/services/detection.py`, `looksmaxx-app/src/components/results/`

## Tech Stack

- **Framework**: Next.js 14 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **Animation**: Framer Motion
- **Face Detection**: MediaPipe Tasks Vision (client, 478 landmarks) + InsightFace (server, 106 landmarks)
- **Scoring**: FaceIQ-compatible exponential decay with 70+ measurements
- **Icons**: Lucide React
- **Backend**: FastAPI on Railway with PostgreSQL

## Organization Rules

- Pages/Routes → `src/app/`
- Components → `src/components/`
- Utilities → `src/lib/`
- Types → `src/types/`
- Results UI → `src/components/results/`

## Code Quality

```bash
cd looksmaxx-app && npm run lint && npx tsc --noEmit
```

## API Endpoints (FaceIQ-Compatible)

### Side Profile Detection
```
POST /api/side-landmarks
Content-Type: application/json
Body: { "image": "<base64>" }

Response:
{
  "success": true,
  "data": {
    "rotationAngle": -0.29,
    "direction": "right",
    "center": {"x": 1526, "y": 1440},
    "crop": {"x": 204, "y": 445, "width": 2046, "height": 2046, "scale": 0.5},
    "landmarks": [{"x": 1891, "y": 2039}, ...],  // 106 points
    "bbox": [1242, 803, 1954, 2133],
    "namedLandmarks": {"pogonion": {...}, "menton": {...}, ...}
  }
}
```

### Front Profile Detection (server fallback)
```
POST /api/front-landmarks
Response: Normalized 0-1 coordinates
```

### Health Check
```
GET /api/detection/health
```

## Architecture

### Landmark Detection
- **Front profile**: MediaPipe (client-side WASM, 478 landmarks)
- **Side profile**: InsightFace on Railway (server-side, 106 landmarks)

### Scoring System
- **Algorithm**: FaceIQ exponential decay: `score = maxScore × e^(-decayRate × deviation)`
- **Measurements**: 70+ metrics (front + side profiles)
- **Score Range**: 0-10 (converted to 0-100 for legacy compatibility)
- **Quality Tiers**: Ideal, Excellent, Good, Below Average
- **Severity Levels**: Optimal, Minor, Moderate, Major, Severe, Extremely Severe

### Key Files
- `src/lib/faceiq-scoring.ts` - Core scoring with 70+ metrics
- `src/lib/scoring.ts` - Backward compatibility wrapper
- `src/components/results/` - FaceIQ-style results UI
- `src/contexts/ResultsContext.tsx` - Results state management
- `src/types/results.ts` - FaceIQ result types

## Results UI (FaceIQ-Style)

### Navigation Tabs
1. **Overview** - Harmony score, front/side scores, strengths/flaws
2. **Front Ratios** - 33 measurements with expandable details
3. **Side Ratios** - 33 measurements with expandable details
4. **Your Plan** - Personalized recommendations (Foundational/Minimally Invasive/Surgical)
5. **Options** - Settings
6. **Support** - Help/FAQ

### Components
- `ResultsLayout.tsx` - Responsive sidebar + tabs
- `MeasurementCard.tsx` - Expandable ratio cards
- `StrengthFlawCards.tsx` - Strength/Flaw display
- `RecommendationCard.tsx` - Treatment recommendations
- `FaceOverlay.tsx` - Photo with landmark visualization
- `IdealRangeBar.tsx` - Visual range indicator

## Last Session (2025-12-20)

### Implemented FaceIQ-Compatible System
1. **Scoring**: Replicated FaceIQ's exponential decay scoring with 70+ measurements
2. **Results UI**: Built complete 6-tab results page matching FaceIQ design
3. **API**: Added FaceIQ-compatible endpoints `/api/side-landmarks` and `/api/front-landmarks`
4. **InsightFace**: Enabled in requirements.txt with full 106-landmark mapping

### Files Modified
- `looksmaxx-api/requirements.txt` - Enabled insightface + onnxruntime
- `looksmaxx-api/app/services/detection.py` - FaceIQ-compatible response format
- `looksmaxx-api/app/routers/detection.py` - New endpoints
- `looksmaxx-api/app/schemas/detection.py` - Response schemas
- `looksmaxx-app/src/lib/faceiq-scoring.ts` - New scoring system
- `looksmaxx-app/src/components/results/*` - Complete results UI

## Next Steps

1. Deploy updated API to Railway: `cd looksmaxx-api && railway up --service api`
2. Test side profile detection with real images
3. Connect frontend analysis flow to results page
4. Add landmark visualization on face photos
5. Implement recommendation engine with real procedures database
