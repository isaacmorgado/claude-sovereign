/**
 * FaceIQ Parity - Metric to Landmark Mappings
 *
 * Exact mappings of which landmarks are used for each facial metric.
 * Extracted from FaceIQ's codebase for 100% calculation parity.
 */

/**
 * FRONT VIEW METRICS
 * Maps each front view ratio to the landmarks needed for its calculation
 */
export const FACEIQ_FRONT_METRIC_LANDMARKS: Record<string, string[]> = {
  // Face Shape & Proportions
  'Face Width to Height Ratio': [
    'cupidsBow', 'leftBrowHead', 'leftBrowInnerCorner', 'leftCheek',
    'rightBrowHead', 'rightBrowInnerCorner', 'rightCheek'
  ],
  'Total Facial Width to Height Ratio': [
    'chinBottom', 'hairline', 'leftCheek', 'rightCheek'
  ],
  'Bigonial width': [
    'leftCheek', 'leftTopGonion', 'rightCheek', 'rightTopGonion'
  ],
  'Bitemporal Width': [
    'leftCheek', 'leftTemple', 'rightCheek', 'rightTemple'
  ],

  // Thirds & Proportions
  'Top Third': [
    'chinBottom', 'hairline', 'leftBrowHead', 'leftBrowInnerCorner',
    'noseBottom', 'rightBrowHead', 'rightBrowInnerCorner'
  ],
  'Middle Third': [
    'chinBottom', 'hairline', 'leftBrowHead', 'leftBrowInnerCorner',
    'noseBottom', 'rightBrowHead', 'rightBrowInnerCorner'
  ],
  'Lower Third': [
    'chinBottom', 'hairline', 'leftBrowHead', 'leftBrowInnerCorner',
    'noseBottom', 'rightBrowHead', 'rightBrowInnerCorner'
  ],
  'Lower Third Proportion': [
    'chinBottom', 'mouthMiddle', 'noseBottom'
  ],

  // Eye Metrics
  'Eye Aspect Ratio': [
    'leftEyeLateralCanthus', 'leftEyeLowerEyelid', 'leftEyeMedialCanthus', 'leftEyeUpperEyelid',
    'rightEyeLateralCanthus', 'rightEyeLowerEyelid', 'rightEyeMedialCanthus', 'rightEyeUpperEyelid'
  ],
  'Eye Separation Ratio': [
    'leftCheek', 'leftEyePupil', 'rightCheek', 'rightEyePupil'
  ],
  'Lateral Canthal Tilt': [
    'leftBrowInnerCorner', 'leftEyeLateralCanthus', 'leftEyeLowerEyelid', 'leftEyeMedialCanthus', 'leftEyelidHoodEnd',
    'rightBrowInnerCorner', 'rightEyeLateralCanthus', 'rightEyeLowerEyelid', 'rightEyeMedialCanthus', 'rightEyelidHoodEnd'
  ],
  'Upper Eyelid Exposure': [
    'leftEyeLateralCanthus', 'leftEyeLowerEyelid', 'leftEyeMedialCanthus', 'leftEyeUpperEyelid', 'leftUpperEyelidCrease',
    'rightEyeLowerEyelid', 'rightEyeUpperEyelid', 'rightUpperEyelidCrease'
  ],
  'One Eye Apart Test': [
    'leftBrowInnerCorner', 'leftEyeLowerEyelid', 'leftEyeMedialCanthus', 'leftEyelidHoodEnd',
    'rightBrowInnerCorner', 'rightEyeLowerEyelid', 'rightEyeMedialCanthus', 'rightEyelidHoodEnd'
  ],

  // Eyebrow Metrics
  'Brow Length to Face Width Ratio': [
    'leftBrowArch', 'leftBrowInnerCorner', 'leftBrowTail', 'leftCheek',
    'rightBrowArch', 'rightBrowInnerCorner', 'rightBrowTail', 'rightCheek'
  ],
  'Brow Thickness': [
    'leftBrowArch', 'leftBrowInnerCorner', 'leftBrowPeak', 'leftEyelidHoodEnd',
    'rightBrowArch', 'rightBrowInnerCorner', 'rightBrowPeak', 'rightEyelidHoodEnd'
  ],
  'Eyebrow Tilt': [
    'leftBrowArch', 'leftBrowHead', 'leftBrowInnerCorner', 'leftBrowPeak', 'leftEyeLowerEyelid', 'leftEyelidHoodEnd',
    'rightBrowArch', 'rightBrowHead', 'rightBrowInnerCorner', 'rightBrowPeak', 'rightEyeLowerEyelid', 'rightEyelidHoodEnd'
  ],
  'Eyebrow Low Setedness': [
    'leftBrowInnerCorner', 'leftEyeLowerEyelid', 'leftEyePupil', 'leftEyeUpperEyelid', 'leftEyelidHoodEnd',
    'rightBrowInnerCorner', 'rightEyeLowerEyelid', 'rightEyePupil', 'rightEyeUpperEyelid', 'rightEyelidHoodEnd'
  ],

  // Cheekbone & Midface
  'Cheekbone height': [
    'cupidsBow', 'leftBrowInnerCorner', 'leftBrowPeak', 'leftCheek', 'leftEyePupil', 'lowerLip',
    'rightBrowInnerCorner', 'rightBrowPeak', 'rightCheek', 'rightEyePupil'
  ],
  'Midface Ratio': [
    'cupidsBow', 'leftEyePupil', 'rightEyePupil'
  ],

  // Nose Metrics
  'Nose Bridge to Nose Width': [
    'leftNoseBridge', 'noseLeft', 'noseRight', 'rightNoseBridge'
  ],
  'Nose Tip Position': [
    'chinBottom', 'hairline', 'leftEyeLowerEyelid', 'nasalBase', 'noseBottom', 'noseLeft', 'noseRight', 'rightEyeLowerEyelid'
  ],
  'Intercanthal-Nasal Width Ratio': [
    'leftEyeMedialCanthus', 'noseBottom', 'noseLeft', 'noseRight', 'rightEyeMedialCanthus'
  ],
  'Ipsilateral Alar Angle': [
    'leftEyelidHoodEnd', 'noseBottom', 'rightEyelidHoodEnd'
  ],

  // Mouth & Lips
  'Mouth width to nose width ratio': [
    'mouthLeft', 'mouthRight', 'noseLeft', 'noseRight'
  ],
  'Interpupillary-Mouth Width Ratio': [
    'leftEyePupil', 'lowerLip', 'mouthLeft', 'mouthRight', 'rightEyePupil'
  ],
  'Mouth Corner Position': [
    'chinBottom', 'hairline', 'mouthLeft', 'mouthMiddle', 'mouthRight'
  ],
  'Lip Thickness': [
    'chinBottom', 'cupidsBow', 'lowerLip', 'nasalBase'
  ],
  'Lower Lip to Upper Lip Ratio': [
    'cupidsBow', 'lowerLip', 'mouthLeft', 'mouthMiddle', 'mouthRight'
  ],
  "Cupid's Bow Depth": [
    'cupidsBow', 'innerCupidsBow', 'mouthLeft', 'mouthRight'
  ],

  // Chin & Jaw
  'Chin to philtrum ratio': [
    'chinBottom', 'cupidsBow', 'lowerLip', 'nasalBase'
  ],
  'Jaw Frontal Angle': [
    'chinLeft', 'chinRight', 'leftBottomGonion', 'rightBottomGonion'
  ],
  'Jaw Slope': [
    'chinLeft', 'chinRight', 'leftBottomGonion', 'leftCheek', 'leftTopGonion',
    'rightBottomGonion', 'rightCheek', 'rightTopGonion'
  ],
  'Deviation of IAA(Ipsilateral alar angle) & JFA(Jaw frontal angle)': [
    'chinLeft', 'chinRight', 'leftBottomGonion', 'leftEyelidHoodEnd', 'noseBottom', 'rightBottomGonion', 'rightEyelidHoodEnd'
  ],

  // Ear Metrics
  'Ear Protrusion Angle': [
    'leftCheek', 'leftOuterEar', 'mouthMiddle', 'rightCheek', 'rightOuterEar'
  ],
  'Ear Protrusion Ratio': [
    'leftCheek', 'leftOuterEar', 'rightCheek', 'rightOuterEar'
  ],

  // Neck
  'Neck Width': [
    'leftTopGonion', 'neckLeft', 'neckRight', 'rightTopGonion'
  ],
};

/**
 * SIDE VIEW METRICS
 * Maps each side view ratio to the landmarks needed for its calculation
 */
export const FACEIQ_SIDE_METRIC_LANDMARKS: Record<string, string[]> = {
  // Facial Depth & Projection
  'Anterior Facial Depth': [
    'lowerEyelid', 'subalare', 'tragus'
  ],
  'Facial Depth to Height Ratio': [
    'nasion', 'sublabiale', 'subnasale', 'tragus'
  ],

  // Eye Metrics
  'Eye Protrusion': [
    'cornealApex', 'lowerEyelid', 'menton', 'trichion'
  ],
  'Orbital Vector': [
    'cornealApex', 'menton', 'orbitale', 'trichion'
  ],

  // Forehead & Brow
  'Browridge Inclination Angle': [
    'glabella', 'trichion'
  ],
  'Upper Forehead Slope': [
    'forehead', 'glabella', 'trichion'
  ],

  // Nasal Metrics
  'Nasal W to H ratio': [
    'cornealApex', 'pronasale', 'subalare'
  ],
  'Nasal Projection': [
    'nasion', 'pronasale', 'rhinion', 'subalare'
  ],
  'Nasal Tip Angle': [
    'infratip', 'pronasale', 'supratip'
  ],
  'Nasofrontal Angle': [
    'glabella', 'nasion', 'supratip'
  ],
  'Nasolabial Angle': [
    'columella', 'labraleSuperius', 'subnasale'
  ],
  'Nasofacial Angle': [
    'nasion', 'pogonion', 'pronasale'
  ],
  'Nasomental Angle': [
    'nasion', 'pogonion', 'pronasale'
  ],
  'Nose Tip Rotation Angle': [
    'columella', 'cornealApex', 'orbitale', 'porion', 'subnasale'
  ],
  'Frankfort-tip Angle': [
    'cornealApex', 'orbitale', 'porion', 'pronasale', 'subnasale'
  ],

  // Convexity & Profile
  'Facial Convexity (Glabella)': [
    'glabella', 'pogonion', 'subnasale'
  ],
  'Facial Convexity (Nasion)': [
    'nasion', 'pogonion', 'subnasale'
  ],
  'Total Facial Convexity': [
    'glabella', 'pogonion', 'pronasale'
  ],

  // Jaw & Mandible
  'Gonial Angle': [
    'gonionBottom', 'gonionTop', 'intertragicNotch', 'menton'
  ],
  'Mandibular Plane Angle': [
    'gonionBottom', 'gonionTop', 'menton', 'tragus'
  ],
  'Ramus to Mandible Ratio': [
    'gonionBottom', 'gonionTop', 'menton', 'pogonion', 'tragus'
  ],
  'Lower Jaw Prominence': [
    'gonionBottom', 'pogonion', 'tragus'
  ],
  'Upper Jaw Prominence': [
    'gonionBottom', 'subnasale', 'tragus'
  ],

  // Midface
  'Interior Midface Projection Angle': [
    'eyelidEnd', 'subalare'
  ],
  'Midface Prominence': [
    'gonionBottom', 'orbitale', 'tragus'
  ],

  // Lips & Profile Lines
  'Holdaway H Line': [
    'labraleInferius', 'labraleSuperius', 'menton', 'pogonion', 'trichion'
  ],
  'Upper Lip Burstone Line': [
    'labraleSuperius', 'menton', 'pogonion', 'subnasale', 'trichion'
  ],
  'Lower Lip Burstone Line': [
    'labraleInferius', 'menton', 'pogonion', 'subnasale', 'trichion'
  ],
  'Upper Lip E-Line Position': [
    'labraleSuperius', 'menton', 'pogonion', 'pronasale', 'trichion'
  ],
  'Lower Lip E-Line Position': [
    'labraleInferius', 'menton', 'pogonion', 'pronasale', 'trichion'
  ],
  'Upper Lip S-Line Position': [
    'labraleSuperius', 'menton', 'pogonion', 'pronasale', 'subnasale', 'trichion'
  ],
  'Lower Lip S-Line Position': [
    'labraleInferius', 'menton', 'pogonion', 'pronasale', 'subnasale', 'trichion'
  ],
  'Z Angle': [
    'labraleSuperius', 'orbitale', 'pogonion', 'porion'
  ],
  'Mentolabial Angle': [
    'labraleInferius', 'pogonion', 'sublabiale'
  ],

  // Gonion & Mouth
  'Gonion to mouth line': [
    'cheilion', 'gonionBottom', 'gonionTop', 'menton', 'tragus', 'trichion'
  ],

  // Neck
  'Submental Cervical Angle': [
    'cervicalPoint', 'menton', 'neckPoint'
  ],

  // Recession Analysis
  'Recession relative to frankfort plane': [
    'glabella', 'menton', 'nasion', 'neckPoint', 'pogonion', 'pronasale', 'trichion'
  ],
};

/**
 * Get landmarks for a metric by name
 */
export function getFaceIQMetricLandmarks(
  metricName: string,
  profileType: 'front' | 'side'
): string[] {
  const mappings = profileType === 'front'
    ? FACEIQ_FRONT_METRIC_LANDMARKS
    : FACEIQ_SIDE_METRIC_LANDMARKS;

  return mappings[metricName] || [];
}

/**
 * Get all metrics that use a specific landmark
 */
export function getMetricsUsingLandmark(
  landmarkId: string,
  profileType: 'front' | 'side'
): string[] {
  const mappings = profileType === 'front'
    ? FACEIQ_FRONT_METRIC_LANDMARKS
    : FACEIQ_SIDE_METRIC_LANDMARKS;

  return Object.entries(mappings)
    .filter(([_, landmarks]) => landmarks.includes(landmarkId))
    .map(([metricName]) => metricName);
}

/**
 * Get all unique landmarks used in calculations
 */
export function getAllUsedLandmarks(profileType: 'front' | 'side'): string[] {
  const mappings = profileType === 'front'
    ? FACEIQ_FRONT_METRIC_LANDMARKS
    : FACEIQ_SIDE_METRIC_LANDMARKS;

  const allLandmarks = new Set<string>();
  Object.values(mappings).forEach(landmarks => {
    landmarks.forEach(lm => allLandmarks.add(lm));
  });

  return Array.from(allLandmarks).sort();
}

/**
 * Front metric count
 */
export const FRONT_METRIC_COUNT = Object.keys(FACEIQ_FRONT_METRIC_LANDMARKS).length;

/**
 * Side metric count
 */
export const SIDE_METRIC_COUNT = Object.keys(FACEIQ_SIDE_METRIC_LANDMARKS).length;
