/**
 * FaceIQ Parity - Side Profile Landmarks Definition
 *
 * Exact 31 side profile landmarks matching FaceIQ's implementation.
 * Each landmark has:
 * - id: Unique identifier
 * - name: Display name
 * - anatomicalName: Scientific/cephalometric name
 * - description: How to find the landmark
 * - zoomLevel: Recommended zoom for placement (2, 4, or 8)
 * - category: Grouping for UI
 */

export interface SideLandmarkDefinition {
  id: string;
  name: string;
  anatomicalName: string;
  description: string;
  zoomLevel: 2 | 4 | 8;
  category: 'head' | 'forehead' | 'eye' | 'ear' | 'nose' | 'lips' | 'chin' | 'jaw' | 'neck';
  mediapipeIndex?: number; // MediaPipe 478 index if available
  insightfaceIndex?: number; // InsightFace 106 index if available
}

/**
 * FaceIQ's exact 31 side profile landmarks
 * Order matches FaceIQ's UI flow (1 of 31 â†’ 31 of 31)
 */
export const FACEIQ_SIDE_LANDMARKS: SideLandmarkDefinition[] = [
  // Head landmarks (zoom 2x)
  {
    id: 'vertex',
    name: 'Top of Head',
    anatomicalName: 'Vertex',
    description: 'The highest point on the top of the head when looking from the side',
    zoomLevel: 2,
    category: 'head',
  },
  {
    id: 'occiput',
    name: 'Back of Head',
    anatomicalName: 'Occiput',
    description: 'The most posterior point on the back of the head',
    zoomLevel: 2,
    category: 'head',
  },
  {
    id: 'trichion',
    name: 'Hairline',
    anatomicalName: 'Trichion',
    description: 'The point where the hairline meets the forehead in the midline',
    zoomLevel: 2,
    category: 'forehead',
  },
  {
    id: 'forehead',
    name: 'Forehead Point',
    anatomicalName: 'Forehead',
    description: 'The most prominent point on the forehead between hairline and glabella',
    zoomLevel: 2,
    category: 'forehead',
  },

  // Eye landmarks (zoom 4x)
  {
    id: 'glabella',
    name: 'Glabella',
    anatomicalName: 'Glabella',
    description: 'The most prominent point between the eyebrows',
    zoomLevel: 4,
    category: 'forehead',
    mediapipeIndex: 9,
    insightfaceIndex: 51,
  },
  {
    id: 'orbitale',
    name: 'Orbitale',
    anatomicalName: 'Orbitale',
    description: 'The lowest point on the lower edge of the eye socket (orbital rim)',
    zoomLevel: 4,
    category: 'eye',
    mediapipeIndex: 33,
    insightfaceIndex: 66,
  },
  {
    id: 'cornealApex',
    name: 'Corneal Apex',
    anatomicalName: 'Corneal Apex',
    description: 'The most anterior point of the cornea (eyeball)',
    zoomLevel: 4,
    category: 'eye',
    mediapipeIndex: 468,
    insightfaceIndex: 98,
  },
  {
    id: 'eyelidEnd',
    name: 'Eyelid End',
    anatomicalName: 'Lateral Canthus',
    description: 'The outer corner of the eye where upper and lower eyelids meet',
    zoomLevel: 4,
    category: 'eye',
    mediapipeIndex: 33,
    insightfaceIndex: 64,
  },
  {
    id: 'lowerEyelid',
    name: 'Lower Eyelid',
    anatomicalName: 'Lower Palpebra',
    description: 'The lowest point of the lower eyelid margin',
    zoomLevel: 4,
    category: 'eye',
    mediapipeIndex: 145,
    insightfaceIndex: 66,
  },

  // Ear landmarks (zoom 4x) - Critical for Frankfort Plane
  {
    id: 'porion',
    name: 'Porion',
    anatomicalName: 'Porion',
    description: 'The highest point on the upper margin of the external auditory meatus (ear canal opening). Forms the Frankfort Horizontal Plane with Orbitale.',
    zoomLevel: 4,
    category: 'ear',
  },
  {
    id: 'tragus',
    name: 'Tragus',
    anatomicalName: 'Tragus',
    description: 'The small pointed cartilage projection in front of the ear canal',
    zoomLevel: 4,
    category: 'ear',
  },
  {
    id: 'intertragicNotch',
    name: 'Intertragic Notch',
    anatomicalName: 'Intertragic Notch',
    description: 'The depression between the tragus and antitragus of the ear',
    zoomLevel: 4,
    category: 'ear',
  },

  // Cheek (zoom 4x)
  {
    id: 'cheekbone',
    name: 'Cheekbone',
    anatomicalName: 'Zygion',
    description: 'The most lateral point on the zygomatic arch (cheekbone)',
    zoomLevel: 4,
    category: 'eye',
    mediapipeIndex: 234,
    insightfaceIndex: 101,
  },

  // Nose landmarks (zoom 4x)
  {
    id: 'nasion',
    name: 'Nasal Bridge Root',
    anatomicalName: 'Nasion',
    description: 'The deepest point at the bridge of the nose, between the eyes',
    zoomLevel: 4,
    category: 'nose',
    mediapipeIndex: 6,
    insightfaceIndex: 43,
  },
  {
    id: 'rhinion',
    name: 'Nasal Bridge',
    anatomicalName: 'Rhinion',
    description: 'The midpoint on the nasal bridge',
    zoomLevel: 4,
    category: 'nose',
    mediapipeIndex: 4,
    insightfaceIndex: 45,
  },
  {
    id: 'supratip',
    name: 'Supratip',
    anatomicalName: 'Supratip',
    description: 'The point just above the nose tip, on the dorsum',
    zoomLevel: 4,
    category: 'nose',
    mediapipeIndex: 4,
    insightfaceIndex: 47,
  },
  {
    id: 'pronasale',
    name: 'Nose Tip',
    anatomicalName: 'Pronasale',
    description: 'The most anterior point of the nose tip',
    zoomLevel: 4,
    category: 'nose',
    mediapipeIndex: 1,
    insightfaceIndex: 50,
  },
  {
    id: 'infratip',
    name: 'Infratip',
    anatomicalName: 'Infratip',
    description: 'The point just below the nose tip',
    zoomLevel: 4,
    category: 'nose',
  },
  {
    id: 'columella',
    name: 'Columella',
    anatomicalName: 'Columella',
    description: 'The skin bridge between the nostrils',
    zoomLevel: 4,
    category: 'nose',
    mediapipeIndex: 2,
    insightfaceIndex: 53,
  },
  {
    id: 'subnasale',
    name: 'Subnasale',
    anatomicalName: 'Subnasale',
    description: 'The point where the columella meets the upper lip',
    zoomLevel: 4,
    category: 'nose',
    mediapipeIndex: 2,
    insightfaceIndex: 52,
  },
  {
    id: 'subalare',
    name: 'Subalare',
    anatomicalName: 'Subalare',
    description: 'The point where the nostril wing meets the cheek',
    zoomLevel: 4,
    category: 'nose',
    mediapipeIndex: 129,
    insightfaceIndex: 56,
  },

  // Lip landmarks (zoom 4x)
  {
    id: 'labraleSuperius',
    name: 'Upper Lip',
    anatomicalName: 'Labrale Superius',
    description: 'The most anterior point of the upper lip vermilion',
    zoomLevel: 4,
    category: 'lips',
    mediapipeIndex: 0,
    insightfaceIndex: 76,
  },
  {
    id: 'cheilion',
    name: 'Mouth Corner',
    anatomicalName: 'Cheilion',
    description: 'The corner of the mouth where upper and lower lips meet',
    zoomLevel: 4,
    category: 'lips',
    mediapipeIndex: 61,
    insightfaceIndex: 79,
  },
  {
    id: 'labraleInferius',
    name: 'Lower Lip',
    anatomicalName: 'Labrale Inferius',
    description: 'The most anterior point of the lower lip vermilion',
    zoomLevel: 4,
    category: 'lips',
    mediapipeIndex: 17,
    insightfaceIndex: 82,
  },
  {
    id: 'sublabiale',
    name: 'Labiomental Fold',
    anatomicalName: 'Sublabiale',
    description: 'The deepest point of the crease between lower lip and chin',
    zoomLevel: 4,
    category: 'lips',
    mediapipeIndex: 18,
    insightfaceIndex: 83,
  },

  // Chin landmarks (zoom 4x)
  {
    id: 'pogonion',
    name: 'Chin Point',
    anatomicalName: 'Pogonion',
    description: 'The most anterior point of the chin',
    zoomLevel: 4,
    category: 'chin',
    mediapipeIndex: 152,
    insightfaceIndex: 103,
  },
  {
    id: 'menton',
    name: 'Chin Bottom',
    anatomicalName: 'Menton',
    description: 'The lowest point on the chin',
    zoomLevel: 4,
    category: 'chin',
    mediapipeIndex: 152,
    insightfaceIndex: 16,
  },

  // Jaw landmarks (zoom 4x)
  {
    id: 'gonionTop',
    name: 'Upper Jaw Angle',
    anatomicalName: 'Gonion Superior',
    description: 'The upper point of the jaw angle (mandibular angle)',
    zoomLevel: 4,
    category: 'jaw',
    mediapipeIndex: 116,
    insightfaceIndex: 9,
  },
  {
    id: 'gonionBottom',
    name: 'Lower Jaw Angle',
    anatomicalName: 'Gonion Inferior',
    description: 'The lower point of the jaw angle (mandibular angle)',
    zoomLevel: 4,
    category: 'jaw',
    mediapipeIndex: 172,
    insightfaceIndex: 11,
  },

  // Neck landmarks (zoom 2x-4x)
  {
    id: 'cervicalPoint',
    name: 'Cervical Point',
    anatomicalName: 'Cervical Point',
    description: 'The point where the neck meets the underside of the chin',
    zoomLevel: 4,
    category: 'neck',
    mediapipeIndex: 152,
    insightfaceIndex: 104,
  },
  {
    id: 'neckPoint',
    name: 'Neck Point',
    anatomicalName: 'Throat Point',
    description: 'A point on the front of the neck below the chin',
    zoomLevel: 2,
    category: 'neck',
  },
];

/**
 * Get landmark by ID
 */
export function getSideLandmarkById(id: string): SideLandmarkDefinition | undefined {
  return FACEIQ_SIDE_LANDMARKS.find(lm => lm.id === id);
}

/**
 * Get landmarks by category
 */
export function getSideLandmarksByCategory(category: SideLandmarkDefinition['category']): SideLandmarkDefinition[] {
  return FACEIQ_SIDE_LANDMARKS.filter(lm => lm.category === category);
}

/**
 * Get landmark index in the list (1-based for display)
 */
export function getSideLandmarkIndex(id: string): number {
  const index = FACEIQ_SIDE_LANDMARKS.findIndex(lm => lm.id === id);
  return index >= 0 ? index + 1 : -1;
}

/**
 * Get total landmark count
 */
export const SIDE_LANDMARK_COUNT = FACEIQ_SIDE_LANDMARKS.length; // 31

/**
 * Landmark IDs in order (for iteration)
 */
export const SIDE_LANDMARK_IDS = FACEIQ_SIDE_LANDMARKS.map(lm => lm.id);

/**
 * Zoom level mapping for quick lookup
 */
export const SIDE_LANDMARK_ZOOM_LEVELS: Record<string, 2 | 4 | 8> = Object.fromEntries(
  FACEIQ_SIDE_LANDMARKS.map(lm => [lm.id, lm.zoomLevel])
);
