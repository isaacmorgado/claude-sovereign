# DANNY: Run this with Claude Code

## Instructions

1. Open Terminal
2. Navigate to where you want the fix: `cd ~/Desktop`
3. Run Claude Code: `claude`
4. Paste the prompt below

---

## Prompt for Claude Code

```
Fix the SPLICE CEP plugin on my Mac. The UI buttons don't work and diagnostic tests 3-6 fail with "EvalScript error".

Do these steps:

1. Find the installed CEP extension at:
   ~/Library/Application Support/Adobe/CEP/extensions/com.splice.cep/

2. In jsx/hostScript.jsx, find function getActiveSequence() and wrap it in try/catch:

```javascript
function getActiveSequence() {
    try {
        var seq = app.project.activeSequence;
        if (!seq) return JSON.stringify({ error: "No active sequence" });

        var frameRate = null;
        try {
            var settings = seq.getSettings();
            if (settings && settings.videoFrameRate) {
                frameRate = settings.videoFrameRate.seconds;
            }
        } catch (settingsErr) {
            $.writeln('[SPLICE] getActiveSequence: Failed to get settings: ' + settingsErr.message);
        }

        return JSON.stringify({
            name: seq.name || "Unknown",
            id: seq.sequenceID || null,
            duration: seq.end || 0,
            videoTrackCount: seq.videoTracks ? seq.videoTracks.numTracks : 0,
            audioTrackCount: seq.audioTracks ? seq.audioTracks.numTracks : 0,
            frameRate: frameRate,
            width: seq.frameSizeHorizontal || 0,
            height: seq.frameSizeVertical || 0
        });
    } catch (e) {
        $.writeln('[SPLICE] getActiveSequence error: ' + e.message);
        return JSON.stringify({ error: "getActiveSequence failed: " + e.message });
    }
}
```

3. Add this NEW function getAllSequences() right after getActiveSequence():

```javascript
function getAllSequences() {
    try {
        if (!app || !app.project || !app.project.sequences) {
            return JSON.stringify({ error: "No project open" });
        }

        var sequences = [];
        var numSeqs = app.project.sequences.numSequences;

        for (var i = 0; i < numSeqs; i++) {
            var seq = app.project.sequences[i];
            if (seq) {
                sequences.push({
                    name: seq.name || "Unknown",
                    id: seq.sequenceID || null,
                    index: i
                });
            }
        }

        return JSON.stringify(sequences);
    } catch (e) {
        $.writeln('[SPLICE] getAllSequences error: ' + e.message);
        return JSON.stringify({ error: "getAllSequences failed: " + e.message });
    }
}
```

4. In panel/js/main.js, find the Test 5 inline script that looks like:
   `const result = await jsx.evalScript(` followed by an if statement checking app.project.activeSequence

   Wrap it in an IIFE with returns:
   ```javascript
   const result = await jsx.evalScript(`
       (function() {
           try {
               if (app && app.project && app.project.activeSequence) {
                   return JSON.stringify({
                       success: true,
                       name: app.project.activeSequence.name,
                       id: app.project.activeSequence.sequenceID
                   });
               } else {
                   return JSON.stringify({
                       success: false,
                       reason: app ? (app.project ? 'app.project.activeSequence is null' : 'app.project is null') : 'app is null'
                   });
               }
           } catch (e) {
               return JSON.stringify({ success: false, reason: 'Error: ' + e.message });
           }
       })()
   `);
   ```

5. Do the same IIFE wrap for Test 6 (the QE DOM check).

6. After making changes, tell me to restart Premiere Pro.
```

---

## After Claude Code finishes

1. **Quit Premiere Pro completely** (Cmd+Q)
2. **Reopen Premiere Pro**
3. **Open a project with a sequence**
4. **Open SPLICE panel** (Window > Extensions > SPLICE)
5. **Click the debug button** (üîç) and run diagnostics

Tests 3-6 should now pass!
