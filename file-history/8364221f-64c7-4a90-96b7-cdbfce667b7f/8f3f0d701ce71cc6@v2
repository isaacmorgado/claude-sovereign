#!/bin/bash

# Vocal Separation Automation Script
# Usage: ./separate_vocals.sh <input_audio_file>

set -e

# Configuration
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
UVR_DIR="$SCRIPT_DIR/ultimatevocalremovergui"
VENV_PYTHON="$UVR_DIR/venv/bin/python"
INPUT_FILE="${1:-$SCRIPT_DIR/youtube_song.wav}"
OUTPUT_DIR="$SCRIPT_DIR/separated_output"

# Check if input file exists
if [ ! -f "$INPUT_FILE" ]; then
    echo "Error: Input file not found: $INPUT_FILE"
    echo "Usage: $0 <input_audio_file>"
    exit 1
fi

# Create output directory
mkdir -p "$OUTPUT_DIR"

echo "=========================================="
echo "UVR Vocal Separation Automation"
echo "=========================================="
echo "Input file: $INPUT_FILE"
echo "Output directory: $OUTPUT_DIR"
echo "=========================================="

# Run UVR with the Python virtual environment
cd "$UVR_DIR"

# Create a simple Python script to run separation
cat > /tmp/uvr_separate.py << 'PYTHON_SCRIPT'
import sys
import os
sys.path.insert(0, os.getcwd())

# Import UVR modules
import torch
from pathlib import Path

# Simple separation using the command line
input_file = sys.argv[1]
output_dir = sys.argv[2]

print(f"Processing: {input_file}")
print(f"Output to: {output_dir}")

# For now, use the GUI version
print("\nNote: The command-line automation requires the GUI app.")
print("Please use the GUI app at: /Applications/Ultimate Vocal Remover.app")
print("\nTo automate, drag and drop your file:")
print(f"  {input_file}")
print("\nAnd set output folder to:")
print(f"  {output_dir}")

PYTHON_SCRIPT

# Run the Python script
"$VENV_PYTHON" /tmp/uvr_separate.py "$INPUT_FILE" "$OUTPUT_DIR"

echo ""
echo "=========================================="
echo "To complete separation, use the UVR GUI:"
echo "  open '/Applications/Ultimate Vocal Remover.app'"
echo "=========================================="
