'use client';

import Link from 'next/link';
import { MessageSquare, Calendar, Award } from 'lucide-react';
import { ForumUserProfile, getKarmaTier, getKarmaTierColor, getKarmaTierBgColor, getKarmaTierLabel } from '@/types/forum';
import { formatDistanceToNow } from '@/lib/utils';
import { KarmaBadge } from './KarmaBadge';
import { Avatar } from './Avatar';

interface UserProfileCardProps {
  profile: ForumUserProfile;
  variant?: 'full' | 'compact';
}

/**
 * Reusable user profile card component
 * - Full variant: Shows complete profile with karma, post/comment counts
 * - Compact variant: Minimal display for sidebar/inline use
 */
export function UserProfileCard({ profile, variant = 'full' }: UserProfileCardProps) {
  if (variant === 'compact') {
    return (
      <Link
        href={`/forum/user/${profile.id}`}
        className="flex items-center gap-3 p-3 rounded-xl bg-neutral-900/30 border border-white/5 hover:border-cyan-500/20 transition-all group"
      >
        <div className="w-10 h-10 rounded-full bg-gradient-to-br from-cyan-500/20 to-purple-500/20 flex items-center justify-center border border-white/10">
          <User size={18} className="text-cyan-400" />
        </div>
        <div className="flex-1 min-w-0">
          <div className="flex items-center gap-2">
            <p className="text-sm font-bold text-white group-hover:text-cyan-400 transition-colors truncate">
              u/{profile.username}
            </p>
            <KarmaBadge karma={profile.forumKarma} size="xs" />
          </div>
          <p className="text-[10px] text-neutral-500">
            {getKarmaTierLabel(getKarmaTier(profile.forumKarma))} Tier
          </p>
        </div>
      </Link>
    );
  }

  return (
    <div className="rounded-2xl bg-neutral-900/30 border border-white/5 overflow-hidden">
      {/* Header with gradient */}
      <div className="h-24 bg-gradient-to-br from-cyan-500/10 via-purple-500/10 to-pink-500/10 relative">
        <div className="absolute -bottom-8 left-6">
          <div className="w-16 h-16 rounded-full bg-neutral-900 border-4 border-neutral-900 flex items-center justify-center">
            <div className="w-14 h-14 rounded-full bg-gradient-to-br from-cyan-500/20 to-purple-500/20 flex items-center justify-center">
              <User size={28} className="text-cyan-400" />
            </div>
          </div>
        </div>
      </div>

      {/* Content */}
      <div className="px-6 pt-12 pb-6">
        {/* Username */}
        <h2 className="text-xl font-black text-white mb-1">
          u/{profile.username}
        </h2>

        {/* Member since */}
        <div className="flex items-center gap-1.5 text-neutral-500 text-xs mb-6">
          <Calendar size={12} />
          <span>Member since {formatDistanceToNow(profile.memberSince)}</span>
        </div>

        {/* Karma Tier Badge */}
        <div className={`flex items-center gap-3 p-4 rounded-xl border mb-4 ${getKarmaTierBgColor(getKarmaTier(profile.forumKarma))}`}>
          <Award size={24} className={getKarmaTierColor(getKarmaTier(profile.forumKarma))} />
          <div>
            <p className={`text-xl font-black ${getKarmaTierColor(getKarmaTier(profile.forumKarma))}`}>
              {profile.forumKarma.toLocaleString()}
            </p>
            <p className="text-[10px] font-bold uppercase tracking-widest text-neutral-400">
              {getKarmaTierLabel(getKarmaTier(profile.forumKarma))} Tier
            </p>
          </div>
        </div>

        {/* Stats grid */}
        <div className="grid grid-cols-2 gap-4">
          {/* Posts */}
          <div className="text-center p-4 rounded-xl bg-neutral-900/50 border border-white/5">
            <div className="flex items-center justify-center gap-1.5 mb-2">
              <MessageSquare size={16} className="text-purple-400" />
            </div>
            <p className="text-lg font-black text-white">
              {profile.forumPostsCount.toLocaleString()}
            </p>
            <p className="text-[10px] font-medium uppercase tracking-widest text-neutral-500">
              Posts
            </p>
          </div>

          {/* Comments */}
          <div className="text-center p-4 rounded-xl bg-neutral-900/50 border border-white/5">
            <div className="flex items-center justify-center gap-1.5 mb-2">
              <MessageSquare size={16} className="text-emerald-400" />
            </div>
            <p className="text-lg font-black text-white">
              {profile.forumCommentsCount.toLocaleString()}
            </p>
            <p className="text-[10px] font-medium uppercase tracking-widest text-neutral-500">
              Comments
            </p>
          </div>
        </div>
      </div>
    </div>
  );
}

/**
 * Inline username link that navigates to user profile
 */
interface UsernameLinkProps {
  userId: string;
  username: string;
  className?: string;
}

export function UsernameLink({ userId, username, className = '' }: UsernameLinkProps) {
  return (
    <Link
      href={`/forum/user/${userId}`}
      className={`hover:text-cyan-400 transition-colors ${className}`}
    >
      u/{username}
    </Link>
  );
}
