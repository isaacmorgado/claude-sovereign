"use client";

import { motion } from "framer-motion";
import { Card, CardContent, CardHeader, CardTitle } from "@/components/ui/card";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import {
  ArrowLeft,
  ArrowRight,
  Code,
  Copy,
  CheckCircle,
  Volume2,
  Music,
  FileText,
  Users,
  CreditCard,
  Key,
  Youtube,
  Layers,
  Wand2,
  Smartphone,
  Mic,
} from "lucide-react";
import Link from "next/link";
import { Header } from "@/components/landing/Header";
import { Footer } from "@/components/landing/Footer";
import { useState } from "react";

interface Endpoint {
  method: "GET" | "POST" | "DELETE";
  path: string;
  description: string;
  auth?: boolean;
  body?: string;
  response?: string;
}

interface ApiCategory {
  name: string;
  icon: React.ComponentType<{ className?: string }>;
  description: string;
  endpoints: Endpoint[];
}

const apiCategories: ApiCategory[] = [
  {
    name: "Core",
    icon: Code,
    description: "Health checks and system status",
    endpoints: [
      { method: "GET", path: "/", description: "API metadata and version" },
      { method: "GET", path: "/health", description: "Health check endpoint" },
      { method: "GET", path: "/ffprobe-check", description: "FFprobe availability status" },
      { method: "GET", path: "/services-check", description: "External services status" },
    ],
  },
  {
    name: "Audio Analysis",
    icon: Volume2,
    description: "Transcription and silence detection",
    endpoints: [
      { method: "POST", path: "/analyze", description: "Transcription + take detection", auth: true, body: '{ "audioUrl": "string" }' },
      { method: "POST", path: "/silences", description: "Silence detection (transcript gaps)", auth: true },
      { method: "POST", path: "/silences-audio", description: "Silence detection (FFprobe)", auth: true },
      { method: "POST", path: "/silences-rms", description: "Silence detection (RMS analysis)", auth: true, body: '{ "audioUrl": "string", "sensitivity": 50 }' },
      { method: "POST", path: "/isolate-vocals", description: "AI vocal isolation", auth: true },
    ],
  },
  {
    name: "Detection",
    icon: Mic,
    description: "Profanity, repetition, and filler detection",
    endpoints: [
      { method: "POST", path: "/profanity", description: "Profanity detection", auth: true },
      { method: "POST", path: "/profanity/generate-bleeps", description: "Generate bleep audio WAV files", auth: true },
      { method: "GET", path: "/profanity/languages", description: "Supported languages" },
      { method: "GET", path: "/profanity/bleeps", description: "Available bleep sounds" },
      { method: "GET", path: "/profanity/list/:lang", description: "Language profanity list" },
      { method: "POST", path: "/repetitions", description: "Phrase repetition detection", auth: true },
      { method: "POST", path: "/stutters", description: "Single-word stutter detection", auth: true },
      { method: "POST", path: "/fillers", description: "Filler word detection", auth: true },
      { method: "POST", path: "/waveform", description: "Get waveform data for visualization", auth: true },
    ],
  },
  {
    name: "Export",
    icon: FileText,
    description: "Captions and cut list generation",
    endpoints: [
      { method: "POST", path: "/export/captions", description: "Export SRT/VTT/TXT/JSON", auth: true },
      { method: "GET", path: "/export/formats", description: "List available export formats" },
      { method: "POST", path: "/cut-list", description: "Generate v3.5 cut list", auth: true },
      { method: "POST", path: "/cut-list/takes", description: "Generate takes-only cut list", auth: true },
    ],
  },
  {
    name: "Zoom & Chapters",
    icon: Layers,
    description: "Auto zoom and chapter detection",
    endpoints: [
      { method: "POST", path: "/zoom", description: "Generate zoom points from transcript", auth: true },
      { method: "GET", path: "/zoom/presets", description: "Get zoom presets and frequencies" },
      { method: "POST", path: "/chapters", description: "AI-powered chapter detection", auth: true },
      { method: "POST", path: "/chapters/fallback", description: "Detect chapters without AI", auth: true },
      { method: "POST", path: "/chapters/dividers", description: "Generate chapter divider data", auth: true },
      { method: "GET", path: "/chapters/dividers/presets", description: "Get divider styles" },
    ],
  },
  {
    name: "YouTube",
    icon: Youtube,
    description: "SEO content generation",
    endpoints: [
      { method: "POST", path: "/youtube/description", description: "Generate SEO-optimized description", auth: true },
      { method: "POST", path: "/youtube/title", description: "Generate multiple title options", auth: true },
      { method: "POST", path: "/youtube/shorts", description: "Generate Shorts/TikTok/Reels metadata", auth: true },
      { method: "GET", path: "/youtube/options", description: "Get available styles and platforms" },
    ],
  },
  {
    name: "Multitrack",
    icon: Users,
    description: "Multi-speaker analysis",
    endpoints: [
      { method: "POST", path: "/multitrack", description: "Multi-speaker analysis", auth: true },
      { method: "POST", path: "/multitrack/auto-balance", description: "Auto-balance screentime", auth: true },
    ],
  },
  {
    name: "Captions",
    icon: Wand2,
    description: "Animated captions and templates",
    endpoints: [
      { method: "POST", path: "/captions/animate", description: "Generate animated captions", auth: true },
      { method: "GET", path: "/captions/templates", description: "List available templates" },
      { method: "GET", path: "/captions/template/:id", description: "Get specific template" },
      { method: "POST", path: "/captions/detect-keywords", description: "AI keyword detection", auth: true },
      { method: "POST", path: "/captions/insert-emojis", description: "Context-aware emoji insertion", auth: true },
      { method: "POST", path: "/captions/export/mogrt", description: "Export MOGRT-compatible data", auth: true },
    ],
  },
  {
    name: "Text Editing",
    icon: FileText,
    description: "Text-based video editing",
    endpoints: [
      { method: "POST", path: "/text-edit/prepare", description: "Create editable transcript", auth: true },
      { method: "POST", path: "/text-edit/apply", description: "Apply text edits", auth: true },
      { method: "POST", path: "/text-edit/search", description: "Search transcript", auth: true },
      { method: "POST", path: "/text-edit/replace", description: "Search and replace", auth: true },
      { method: "POST", path: "/text-edit/preview", description: "Preview edits", auth: true },
      { method: "POST", path: "/text-edit/cut-list", description: "Generate cut list from edits", auth: true },
    ],
  },
  {
    name: "Social Reframe",
    icon: Smartphone,
    description: "Face tracking and reframing",
    endpoints: [
      { method: "POST", path: "/reframe/analyze", description: "Analyze video with face tracking", auth: true },
      { method: "POST", path: "/reframe/calculate", description: "Calculate crop positions", auth: true },
      { method: "POST", path: "/reframe/motion-path", description: "Generate smooth motion path", auth: true },
      { method: "POST", path: "/reframe/export", description: "Batch export all formats", auth: true },
      { method: "GET", path: "/reframe/platforms", description: "Get available platforms" },
      { method: "POST", path: "/faces/detect", description: "Detect faces in video", auth: true },
      { method: "POST", path: "/faces/track", description: "Track faces throughout video", auth: true },
    ],
  },
  {
    name: "AI Music",
    icon: Music,
    description: "Music generation and library",
    endpoints: [
      { method: "POST", path: "/music/identify", description: "Identify song from YouTube URL", auth: true },
      { method: "POST", path: "/music/generate", description: "Start music generation job", auth: true },
      { method: "POST", path: "/music/generate-scene-aware", description: "Generate with transcript analysis", auth: true },
      { method: "POST", path: "/music/generate-variations", description: "Generate 3 variations", auth: true },
      { method: "GET", path: "/music/status/:jobId", description: "Get job status and progress", auth: true },
      { method: "GET", path: "/music/library", description: "Get user's music library", auth: true },
      { method: "GET", path: "/music/:jobId", description: "Get music with download URL", auth: true },
      { method: "DELETE", path: "/music/:jobId", description: "Delete music from library", auth: true },
      { method: "GET", path: "/music/credits", description: "Get music credit balance", auth: true },
      { method: "GET", path: "/music/moods", description: "Get mood presets" },
      { method: "GET", path: "/music/instruments", description: "Get instrument presets" },
      { method: "POST", path: "/music/align", description: "Align music to target duration", auth: true },
      { method: "POST", path: "/music/generate-timeline", description: "Generate per-chapter music", auth: true },
    ],
  },
  {
    name: "Billing",
    icon: CreditCard,
    description: "Credits and usage tracking",
    endpoints: [
      { method: "GET", path: "/credits", description: "Get credit balance", auth: true },
      { method: "GET", path: "/usage-history", description: "Get usage history", auth: true },
      { method: "POST", path: "/webhooks/stripe", description: "Stripe webhook handler" },
    ],
  },
  {
    name: "License",
    icon: Key,
    description: "License key management",
    endpoints: [
      { method: "POST", path: "/license/activate", description: "Activate license key" },
      { method: "GET", path: "/license/key", description: "Get license key for customer", auth: true },
      { method: "POST", path: "/license/resend", description: "Resend license key email", auth: true },
      { method: "POST", path: "/license/lookup", description: "Look up license by email" },
    ],
  },
];

const exampleCode = {
  analyze: `// Analyze audio for transcription and takes
const response = await fetch('https://splice-api.railway.app/analyze', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer YOUR_LICENSE_KEY'
  },
  body: JSON.stringify({
    audioUrl: 'https://example.com/audio.wav'
  })
});

const data = await response.json();
// Returns: { transcript, takes, words }`,
  silences: `// Detect silences using RMS analysis
const response = await fetch('https://splice-api.railway.app/silences-rms', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer YOUR_LICENSE_KEY'
  },
  body: JSON.stringify({
    audioUrl: 'https://example.com/audio.wav',
    sensitivity: 50,
    minSilenceDuration: 0.5
  })
});

const { silences } = await response.json();
// Returns: { silences: [{ start, end, duration }] }`,
  music: `// Generate AI background music
const response = await fetch('https://splice-api.railway.app/music/generate', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
    'Authorization': 'Bearer YOUR_LICENSE_KEY'
  },
  body: JSON.stringify({
    mood: 'upbeat',
    instruments: 'full-band',
    duration: 60,
    prompt: 'Energetic background for tech video'
  })
});

const { jobId } = await response.json();
// Poll /music/status/:jobId for progress`,
};

export default function ApiReferencePage() {
  const [copiedCode, setCopiedCode] = useState<string | null>(null);

  const copyCode = (code: string, key: string) => {
    navigator.clipboard.writeText(code);
    setCopiedCode(key);
    setTimeout(() => setCopiedCode(null), 2000);
  };

  return (
    <div className="min-h-screen bg-[#060b14] dark">
      <Header />
      <main className="pt-24 pb-16">
        <div className="container mx-auto px-4">
          {/* Back link */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.3 }}
          >
            <Link href="/docs" className="inline-flex items-center text-gray-400 hover:text-[#00D4FF] mb-8">
              <ArrowLeft className="w-4 h-4 mr-2" />
              Back to Documentation
            </Link>
          </motion.div>

          {/* Hero */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5 }}
            className="mb-12"
          >
            <Badge className="mb-4 bg-[#00D4FF]/10 text-[#00D4FF] border-[#00D4FF]/30">
              <Code className="w-3 h-3 mr-1" />
              REST API
            </Badge>
            <h1 className="text-4xl md:text-5xl font-bold mb-4 text-white">
              API Reference
            </h1>
            <p className="text-lg text-gray-400 max-w-2xl">
              Complete API documentation for integrating SPLICE into your workflows.
              All endpoints require authentication unless otherwise noted.
            </p>
          </motion.div>

          {/* Base URL */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5, delay: 0.1 }}
            className="mb-8"
          >
            <Card className="bg-[#0d1420] border-gray-800">
              <CardContent className="p-4">
                <div className="flex items-center justify-between">
                  <div>
                    <span className="text-gray-400 text-sm">Base URL</span>
                    <code className="block text-[#00D4FF] font-mono mt-1">
                      https://splice-api-production.up.railway.app
                    </code>
                  </div>
                  <div>
                    <span className="text-gray-400 text-sm">Development</span>
                    <code className="block text-gray-500 font-mono mt-1">
                      https://127.0.0.1:3847
                    </code>
                  </div>
                </div>
              </CardContent>
            </Card>
          </motion.div>

          {/* Authentication */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5, delay: 0.15 }}
            className="mb-12"
          >
            <h2 className="text-xl font-bold text-white mb-4">Authentication</h2>
            <Card className="bg-[#0d1420] border-gray-800">
              <CardContent className="p-4">
                <p className="text-gray-400 text-sm mb-3">
                  Include your license key in the Authorization header:
                </p>
                <pre className="bg-[#0a0f1a] p-3 rounded-lg text-sm font-mono text-gray-300 overflow-x-auto">
                  Authorization: Bearer YOUR_LICENSE_KEY
                </pre>
              </CardContent>
            </Card>
          </motion.div>

          {/* Example Code */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5, delay: 0.2 }}
            className="mb-12"
          >
            <h2 className="text-xl font-bold text-white mb-4">Quick Examples</h2>
            <Tabs defaultValue="analyze" className="w-full">
              <TabsList className="bg-[#0d1420] border border-gray-800">
                <TabsTrigger value="analyze" className="data-[state=active]:bg-[#00D4FF] data-[state=active]:text-black">
                  Analyze
                </TabsTrigger>
                <TabsTrigger value="silences" className="data-[state=active]:bg-[#00D4FF] data-[state=active]:text-black">
                  Silences
                </TabsTrigger>
                <TabsTrigger value="music" className="data-[state=active]:bg-[#00D4FF] data-[state=active]:text-black">
                  Music
                </TabsTrigger>
              </TabsList>
              {Object.entries(exampleCode).map(([key, code]) => (
                <TabsContent key={key} value={key}>
                  <Card className="bg-[#0d1420] border-gray-800">
                    <CardContent className="p-0 relative">
                      <button
                        className="absolute top-3 right-3 p-1.5 rounded-md hover:bg-white/10 transition-colors"
                        onClick={() => copyCode(code, key)}
                        aria-label="Copy code"
                      >
                        {copiedCode === key ? (
                          <CheckCircle className="w-4 h-4 text-[#00D4FF]" />
                        ) : (
                          <Copy className="w-4 h-4 text-gray-500" />
                        )}
                      </button>
                      <pre className="p-4 text-sm font-mono text-gray-300 overflow-x-auto">
                        {code}
                      </pre>
                    </CardContent>
                  </Card>
                </TabsContent>
              ))}
            </Tabs>
          </motion.div>

          {/* Endpoints by Category */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5, delay: 0.25 }}
          >
            <h2 className="text-xl font-bold text-white mb-6">Endpoints</h2>
            <div className="space-y-6">
              {apiCategories.map((category, categoryIndex) => (
                <motion.div
                  key={category.name}
                  initial={{ opacity: 0, y: 20 }}
                  animate={{ opacity: 1, y: 0 }}
                  transition={{ duration: 0.5, delay: 0.25 + categoryIndex * 0.03 }}
                >
                  <Card className="bg-[#0d1420] border-gray-800">
                    <CardHeader className="pb-2">
                      <div className="flex items-center gap-3">
                        <div className="w-8 h-8 rounded-lg bg-[#00D4FF]/10 flex items-center justify-center">
                          <category.icon className="w-4 h-4 text-[#00D4FF]" />
                        </div>
                        <div>
                          <CardTitle className="text-white text-lg">{category.name}</CardTitle>
                          <p className="text-sm text-gray-500">{category.description}</p>
                        </div>
                      </div>
                    </CardHeader>
                    <CardContent>
                      <div className="space-y-2">
                        {category.endpoints.map((endpoint, index) => (
                          <div
                            key={endpoint.path}
                            className="flex items-center gap-3 py-2 px-3 rounded-lg bg-[#0a0f1a] hover:bg-[#0a0f1a]/80"
                          >
                            <Badge
                              className={`font-mono text-xs ${
                                endpoint.method === "GET"
                                  ? "bg-green-500/20 text-green-400"
                                  : endpoint.method === "POST"
                                  ? "bg-blue-500/20 text-blue-400"
                                  : "bg-red-500/20 text-red-400"
                              }`}
                            >
                              {endpoint.method}
                            </Badge>
                            <code className="text-gray-300 font-mono text-sm flex-1">
                              {endpoint.path}
                            </code>
                            <span className="text-gray-500 text-sm hidden md:block">
                              {endpoint.description}
                            </span>
                            {endpoint.auth && (
                              <Badge variant="outline" className="text-xs border-gray-700 text-gray-400">
                                Auth
                              </Badge>
                            )}
                          </div>
                        ))}
                      </div>
                    </CardContent>
                  </Card>
                </motion.div>
              ))}
            </div>
          </motion.div>

          {/* Rate Limits */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5, delay: 0.5 }}
            className="mt-12"
          >
            <h2 className="text-xl font-bold text-white mb-4">Rate Limits & Credits</h2>
            <Card className="bg-[#0d1420] border-gray-800">
              <CardContent className="p-6">
                <div className="grid md:grid-cols-3 gap-6">
                  <div>
                    <h3 className="font-semibold text-white mb-2">Starter</h3>
                    <ul className="text-sm text-gray-400 space-y-1">
                      <li>12 hours/month</li>
                      <li>5 music credits</li>
                      <li>$1/hour overage</li>
                    </ul>
                  </div>
                  <div>
                    <h3 className="font-semibold text-white mb-2">Pro</h3>
                    <ul className="text-sm text-gray-400 space-y-1">
                      <li>30 hours/month</li>
                      <li>20 music credits</li>
                      <li>45 min vocal isolation</li>
                    </ul>
                  </div>
                  <div>
                    <h3 className="font-semibold text-white mb-2">Team</h3>
                    <ul className="text-sm text-gray-400 space-y-1">
                      <li>100 hours/month</li>
                      <li>100 music credits</li>
                      <li>3 hrs vocal isolation</li>
                    </ul>
                  </div>
                </div>
              </CardContent>
            </Card>
          </motion.div>

          {/* Navigation */}
          <motion.div
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ duration: 0.5, delay: 0.55 }}
            className="mt-16 flex justify-between items-center"
          >
            <Link href="/docs/features" className="text-gray-400 hover:text-[#00D4FF]">
              <ArrowLeft className="w-4 h-4 inline mr-2" />
              Features
            </Link>
            <Link href="/docs/tutorials" className="text-[#00D4FF] hover:underline">
              Tutorials
              <ArrowRight className="w-4 h-4 inline ml-2" />
            </Link>
          </motion.div>
        </div>
      </main>
      <Footer />
    </div>
  );
}
