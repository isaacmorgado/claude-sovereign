/**
 * Example: Generate analysis reports in different formats
 *
 * This example demonstrates how to use the ReportGenerator class
 * to export facial analysis results as JSON, Markdown, and HTML.
 */

import { FacialAnalyzer, ReportGenerator } from '../src/index.js';
import { readFileSync, writeFileSync, mkdirSync } from 'fs';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';

// Get current directory for ES modules
const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

// Load sample landmark data
const sampleDataPath = join(__dirname, '../tests/testData/sampleLandmarks.json');
const sampleData = JSON.parse(readFileSync(sampleDataPath, 'utf-8'));

async function main() {
  console.log('=== Report Generation Demo ===\n');

  // Create analyzer and perform analysis
  const analyzer = new FacialAnalyzer({ gender: 'male' });
  analyzer.setSideLandmarks(sampleData.sideLandmarks);

  console.log('Performing full analysis...');
  const analysis = analyzer.analyze();

  // Create report generator
  const report = new ReportGenerator(analysis);

  // Create output directory
  const outputDir = join(__dirname, 'output');
  try {
    mkdirSync(outputDir, { recursive: true });
  } catch {
    // Directory may already exist
  }

  // Generate JSON report
  console.log('\nGenerating JSON report...');
  const jsonReport = report.toJSON();
  const jsonPath = join(outputDir, 'analysis-report.json');
  writeFileSync(jsonPath, jsonReport);
  console.log(`  Saved to: ${jsonPath}`);

  // Generate Markdown report
  console.log('\nGenerating Markdown report...');
  const mdReport = report.toMarkdown();
  const mdPath = join(outputDir, 'analysis-report.md');
  writeFileSync(mdPath, mdReport);
  console.log(`  Saved to: ${mdPath}`);

  // Generate HTML report
  console.log('\nGenerating HTML report...');
  const htmlReport = report.toHTML();
  const htmlPath = join(outputDir, 'analysis-report.html');
  writeFileSync(htmlPath, htmlReport);
  console.log(`  Saved to: ${htmlPath}`);

  // Display summary
  console.log('\n=== Analysis Summary ===\n');
  console.log(`Gender: ${analysis.gender}`);
  console.log(`Harmony Score: ${analysis.harmonyScore.toFixed(1)}/100`);
  console.log(`Overall Percentile: ${analysis.percentiles.overall.toFixed(1)}%`);

  // Display individual sections
  console.log('\n--- Measurements Section ---');
  console.log(report.getMeasurementsSection().substring(0, 500) + '...');

  console.log('\n--- Scores Section ---');
  console.log(report.getScoresSection().substring(0, 500) + '...');

  console.log('\n--- Recommendations Section ---');
  console.log(report.getRecommendationsSection() || 'No recommendations');

  console.log('\n=== Reports Generated Successfully ===');
  console.log(`\nOpen ${htmlPath} in a browser to view the visual report.`);
}

main().catch(console.error);
