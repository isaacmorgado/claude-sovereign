import type { Gender } from './landmarks.js';

/**
 * Configuration for bell curve scoring
 */
export interface ScoringConfig {
  idealValue: number;
  standardDeviation: number;
  minScore: number;
  maxScore: number;
  weight: number;  // For overall harmony score
  name: string;
  description: string;
}

/**
 * Gender-specific scoring configuration
 */
export interface GenderScoringConfig {
  male: ScoringConfig;
  female: ScoringConfig;
}

/**
 * Population statistics for percentile calculation
 */
export interface PopulationStats {
  mean: number;
  standardDeviation: number;
  sampleSize: number;
}

/**
 * Score result for a single measurement
 */
export interface MeasurementScore {
  name: string;
  value: number;
  score: number;           // 0-100
  idealValue: number;
  deviation: number;       // How far from ideal
  percentile: number;      // 0-100 population percentile
  rating: ScoreRating;
}

/**
 * Score rating categories
 */
export type ScoreRating =
  | 'exceptional'   // 90-100
  | 'excellent'     // 80-89
  | 'good'          // 70-79
  | 'average'       // 50-69
  | 'below_average' // 30-49
  | 'poor';         // 0-29

/**
 * All measurement scores
 */
export interface MeasurementScores {
  // Front face scores
  fwhr?: MeasurementScore;
  canthalTilt?: MeasurementScore;
  facialThirds?: MeasurementScore;
  symmetry?: MeasurementScore;
  goldenRatio?: MeasurementScore;
  nasalIndex?: MeasurementScore;
  lipRatio?: MeasurementScore;

  // Side profile scores
  nasolabialAngle?: MeasurementScore;
  gonialAngle?: MeasurementScore;
  chinProjection?: MeasurementScore;
  noseProjection?: MeasurementScore;
  facialConvexity?: MeasurementScore;

  // Computed
  harmonyScore: number;    // Overall weighted score
}

/**
 * Bell curve data for visualization
 */
export interface BellCurveData {
  points: BellCurvePoint[];
  userValue: number;
  userPercentile: number;
  mean: number;
  standardDeviation: number;
  idealValue: number;
}

/**
 * Single point on bell curve
 */
export interface BellCurvePoint {
  x: number;  // Value
  y: number;  // Probability density
}

/**
 * Percentile results for population comparison
 */
export interface PercentileResults {
  overall: number;
  byMeasurement: Record<string, number>;
}

/**
 * Full analysis report
 */
export interface FullAnalysisReport {
  timestamp: Date;
  gender: Gender;

  // Raw measurements
  measurements: {
    front: import('./measurements.js').FrontFaceMeasurements | null;
    side: import('./measurements.js').SideProfileMeasurements | null;
  };

  // Scores
  scores: MeasurementScores;
  harmonyScore: number;

  // Population comparison
  percentiles: PercentileResults;

  // Bell curve data for visualization
  bellCurves: Record<string, BellCurveData>;

  // Recommendations based on analysis
  recommendations: AnalysisRecommendation[];
}

/**
 * Analysis recommendation
 */
export interface AnalysisRecommendation {
  category: RecommendationCategory;
  measurement: string;
  currentValue: number;
  idealValue: number;
  deviation: number;
  description: string;
  priority: 'low' | 'medium' | 'high';
}

/**
 * Recommendation categories
 */
export type RecommendationCategory =
  | 'proportion'
  | 'symmetry'
  | 'angle'
  | 'projection'
  | 'ratio';
