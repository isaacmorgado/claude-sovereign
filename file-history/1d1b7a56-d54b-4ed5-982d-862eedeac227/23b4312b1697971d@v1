import { Router } from 'express'
import * as audioController from '../controllers/audio-controller.js'
import { authenticate } from '../middleware/auth.js'
import { checkUsageLimit } from '../middleware/usage-limit.js'

const router = Router()

// All audio routes require authentication
router.use(authenticate)

// Pre-flight check if user can submit a job
router.get('/check', audioController.canSubmit)

// List user's jobs
router.get('/jobs', audioController.listJobs)

// Get specific job status
router.get('/jobs/:jobId', audioController.getJob)

// Submit transcription job (requires usage limit check)
router.post('/transcribe', checkUsageLimit, audioController.submitTranscription)

// Submit vocal isolation job (requires usage limit check)
router.post('/isolate-vocals', checkUsageLimit, audioController.submitVocalIsolation)

export default router
