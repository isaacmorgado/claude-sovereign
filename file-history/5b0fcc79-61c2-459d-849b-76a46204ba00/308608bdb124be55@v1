# SPLICE

AI-powered Premiere Pro plugin for detecting takes, removing silences, and accelerating video editing workflows.

## Key Constraints
- **CEP version**: Premiere Pro 14.0-25.9 (wider compatibility)
- **UXP version**: Premiere Pro 25.6+ (modern architecture)
- Use `127.0.0.1` not `localhost` in fetch URLs
- Backend (prod): https://splice-api-production.up.railway.app
- Backend (dev): https://127.0.0.1:3847

## Current Status
**v5.6.1** | Production ready | E2E tests passing

### Recent Bug Fixes (v5.6.1)
- **Fixed**: `/music/moods` and `/music/instruments` endpoints timing out when Redis not configured
  - Root cause: Route ordering issue - `/:jobId` catch-all was matching before specific routes
  - Solution: Moved specific routes (`/moods`, `/instruments`, `/credits`, `/queue-stats`, `/alignment-options`, `/timeline-options`) before `/:jobId` catch-all
- **Fixed**: Lazy loading of music services to prevent Redis dependency from blocking startup
  - `loadMusicGenerationOnly()` for endpoints that don't need Redis
  - `loadMusicServices()` loads Redis-dependent services with error handling

## Project Structure
```
splice-backend/          # Node.js API server
  server.js              # Main entry (3,700 LOC)
  services/              # 30 service files
  tests/                 # 55 test files

splice-plugin/           # UXP Plugin (Premiere 25.6+)
  index.html             # Plugin entry
  js/main.js             # Workflow orchestration
  js/builder.js          # Sequence building
  js/config.js           # Backend URL, fetch utilities

splice-cep/              # CEP Plugin (Premiere 14.0-25.9)
  panel/index.html       # Panel entry
  panel/js/              # Panel JavaScript
  jsx/hostScript.jsx     # ExtendScript host (800+ LOC)

splice-website/          # Next.js 16 marketing site
  src/app/               # Pages and API routes
  src/components/        # React components
```

## Pricing Tiers
| Tier | Price | Hours | Music Credits |
|------|-------|-------|---------------|
| Starter | $19/mo | 12 hrs | 5 songs |
| Pro | $49/mo | 30 hrs | 20 songs |
| Team | $149/mo | 100 hrs | 100 songs |

## Key Services
| Service | Purpose |
|---------|---------|
| `transcription.js` | Whisper API, LRU cache |
| `cutListGenerator.js` | v3.5 JSON cut list |
| `usageTracking.js` | Billing, credits, webhooks |
| `rmsSilenceDetection.js` | RMS audio analysis |
| `musicGeneration.js` | Mureka API integration |
| `chapterDetection.js` | AI chapter detection |
| `animatedCaptions.js` | Caption templates |

## Core API Endpoints
```
POST /analyze           # Transcription + take detection
POST /silences-rms      # Silence detection (RMS)
POST /cut-list          # Generate cut list
POST /music/generate    # AI music generation
POST /chapters          # Chapter detection
GET  /credits           # Credit balance
GET  /health            # Health check
```

## Quick Commands
```bash
# Start server
cd splice-backend && node server.js

# Health check
curl -sk https://127.0.0.1:3847/health

# Run tests
node splice-backend/tests/phase5-e2e.test.js

# Install CEP extension (macOS)
ln -s /Users/imorgado/SPLICE/splice-cep ~/Library/Application\ Support/Adobe/CEP/extensions/com.splice.panel

# Website dev
cd splice-website && npm run dev
```

## Environment Variables
| Variable | Purpose |
|----------|---------|
| `OPENAI_API_KEY` | GPT-4o-mini + Whisper |
| `REPLICATE_API_TOKEN` | Vocal isolation |
| `STRIPE_SECRET_KEY` | Billing |
| `DATABASE_URL` | PostgreSQL |
| `MUREKA_API_KEY` | Music generation |
| `R2_*` | Cloudflare R2 storage |
| `ACRCLOUD_*` | Song identification |

## Cut List Format (v3.5)
```json
{
  "version": "3.5",
  "source": { "name": "...", "path": "...", "duration": 300 },
  "segments": [{
    "type": "speech|silence|best_take|take",
    "inPoint": 0.0,
    "outPoint": 10.5,
    "takeNumber": 1,
    "colorHint": "cerulean"
  }]
}
```

## Preset Profiles
| Preset | Sensitivity | Min Silence | Use Case |
|--------|-------------|-------------|----------|
| podcast | 35 | 0.8s | Conversational |
| interview | 50 | 0.5s | Q&A rhythm |
| reaction | 70 | 0.3s | Fast-paced |
| tutorial | 30 | 1.0s | Teaching pace |
| vlog | 65 | 0.35s | YouTube edits |

## Key Features
- Silence detection (RMS, FFprobe, Whisper)
- Take detection and labeling
- J-Cut/L-Cut support
- Multitrack/multicam analysis
- AI music generation (Mureka)
- Caption export (SRT/VTT)
- Vocal isolation (Replicate)
- Chapter detection (GPT-4o-mini)
- Social reframe (face tracking)
- Text-based editing
