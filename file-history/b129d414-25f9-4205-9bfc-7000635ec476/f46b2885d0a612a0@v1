/**
 * SPLICE Website E2E Tests - Landing Page
 * Tests for hero, features, pricing, FAQ, and responsive design
 */

const fs = require("fs");
const path = require("path");

// Test counter
let passed = 0;
let failed = 0;

function test(name, fn) {
  try {
    fn();
    console.log(`  ✓ ${name}`);
    passed++;
  } catch (error) {
    console.log(`  ✗ ${name}`);
    console.log(`    Error: ${error.message}`);
    failed++;
  }
}

function assert(condition, message) {
  if (!condition) {
    throw new Error(message || "Assertion failed");
  }
}

// Read component files
const componentsDir = path.join(__dirname, "..", "src", "components", "landing");
const appDir = path.join(__dirname, "..", "src", "app");

console.log("\n=== SPLICE Website E2E Tests ===\n");

// ============================================
// Header Tests
// ============================================
console.log("Header Component:");

const headerContent = fs.readFileSync(
  path.join(componentsDir, "Header.tsx"),
  "utf8"
);

test("Header has navigation links", () => {
  assert(headerContent.includes("Features"), "Missing Features link");
  assert(headerContent.includes("Pricing"), "Missing Pricing link");
  assert(headerContent.includes("Download"), "Missing Download link");
  assert(headerContent.includes("Docs"), "Missing Docs link");
});

test("Header has CTA buttons", () => {
  assert(headerContent.includes("Log In"), "Missing Log In button");
  assert(headerContent.includes("Start Free Trial"), "Missing Start Free Trial button");
});

test("Header is sticky/fixed", () => {
  assert(headerContent.includes("fixed"), "Header should be fixed position");
});

test("Header has mobile menu", () => {
  assert(headerContent.includes("Menu"), "Missing mobile menu icon");
  assert(headerContent.includes("md:hidden"), "Missing mobile responsive class");
});

// ============================================
// Hero Tests
// ============================================
console.log("\nHero Component:");

const heroContent = fs.readFileSync(
  path.join(componentsDir, "Hero.tsx"),
  "utf8"
);

test("Hero has main headline", () => {
  // Current headline: "The AI Co-pilot for Premiere Pro"
  assert(heroContent.includes("AI Co-pilot") || heroContent.includes("Premiere Pro"), "Missing main headline");
});

test("Hero has pain point messaging", () => {
  // Current messaging: "Reduce cut time by 90%", shows time savings
  assert(
    heroContent.includes("90%") || heroContent.includes("Time Saved") || heroContent.includes("workflow"),
    "Missing pain point messaging"
  );
});

test("Hero has benefit bullets", () => {
  // Current benefits: "Reduce cut time by 90%", "Native UXP Performance", "Studio-Quality Results"
  assert(heroContent.includes("90%") || heroContent.includes("cut time"), "Missing save time benefit");
  assert(heroContent.includes("UXP") || heroContent.includes("Native"), "Missing performance benefit");
  assert(heroContent.includes("Premiere Pro"), "Missing Premiere Pro mention");
});

test("Hero has primary and secondary CTAs", () => {
  assert(heroContent.includes("Start Free Trial"), "Missing primary CTA");
  assert(heroContent.includes("Watch Demo"), "Missing secondary CTA");
});

test("Hero has beta badge (scarcity)", () => {
  assert(
    heroContent.includes("Limited") || heroContent.includes("Beta"),
    "Missing scarcity element"
  );
});

// ============================================
// Demo Video Tests
// ============================================
console.log("\nDemo Video Infrastructure:");

test("Hero has demo video modal state", () => {
  assert(heroContent.includes("showDemo"), "Missing showDemo state");
  assert(heroContent.includes("setShowDemo"), "Missing setShowDemo handler");
});

test("Hero has video URL configuration", () => {
  assert(
    heroContent.includes("DEMO_VIDEO_URL") || heroContent.includes("NEXT_PUBLIC_DEMO_VIDEO_URL"),
    "Missing video URL configuration"
  );
});

test("Hero has getVideoEmbed helper", () => {
  assert(heroContent.includes("getVideoEmbed"), "Missing getVideoEmbed function");
});

test("Hero supports YouTube embeds", () => {
  assert(heroContent.includes("youtube"), "Missing YouTube support");
  assert(heroContent.includes("iframe"), "Missing iframe for YouTube");
});

test("Hero supports Vimeo embeds", () => {
  assert(heroContent.includes("vimeo"), "Missing Vimeo support");
});

test("Hero supports native video", () => {
  assert(heroContent.includes("<video"), "Missing native video element");
  assert(heroContent.includes("mp4") || heroContent.includes("webm"), "Missing video format support");
});

test("Hero has AnimatePresence for modal", () => {
  assert(heroContent.includes("AnimatePresence"), "Missing AnimatePresence for modal");
});

test("Hero has placeholder when no video URL", () => {
  assert(heroContent.includes("Demo Coming Soon"), "Missing placeholder text");
  assert(heroContent.includes("Start Free Trial"), "Missing fallback CTA");
});

// ============================================
// Social Proof Tests
// ============================================
console.log("\nSocial Proof Component:");

const socialProofContent = fs.readFileSync(
  path.join(componentsDir, "SocialProof.tsx"),
  "utf8"
);

test("Social proof has user count", () => {
  assert(socialProofContent.includes("10,000+"), "Missing user count");
});

test("Social proof has stats", () => {
  assert(socialProofContent.includes("Hours Saved"), "Missing hours saved stat");
  assert(socialProofContent.includes("Rating"), "Missing rating stat");
});

test("Social proof has brand logos", () => {
  assert(socialProofContent.includes("YouTube"), "Missing YouTube logo");
  assert(socialProofContent.includes("TikTok"), "Missing TikTok logo");
});

// ============================================
// Features Tests
// ============================================
console.log("\nFeatures Component:");

const featuresContent = fs.readFileSync(
  path.join(componentsDir, "Features.tsx"),
  "utf8"
);

test("Features has 6 feature cards", () => {
  assert(featuresContent.includes("Silence Removal"), "Missing Silence Removal");
  // Feature uses "AI Music Scoring" instead of "AI Music Generation"
  assert(featuresContent.includes("AI Music Scoring") || featuresContent.includes("Music"), "Missing AI Music");
  // Feature uses "Dynamic Captions" instead of "Animated Captions"
  assert(featuresContent.includes("Dynamic Captions") || featuresContent.includes("Captions"), "Missing Captions");
  assert(featuresContent.includes("Text-Based") || featuresContent.includes("Text"), "Missing Text Editing");
  // Feature uses "Smart Reframe" instead of "Social Reframe"
  assert(featuresContent.includes("Smart Reframe") || featuresContent.includes("Reframe"), "Missing Reframe");
  // Take detection may be bundled with silence removal or separate
  assert(featuresContent.includes("Take") || featuresContent.includes("Silence"), "Missing Take or Silence feature");
});

test("Features has before/after comparison", () => {
  assert(featuresContent.includes("Without SPLICE"), "Missing Without SPLICE");
  assert(featuresContent.includes("With SPLICE"), "Missing With SPLICE");
  assert(featuresContent.includes("8+ hours"), "Missing 8+ hours editing");
  assert(featuresContent.includes("45 minutes"), "Missing 45 minutes editing");
});

test("Features has hover animations", () => {
  assert(featuresContent.includes("feature-card"), "Missing feature-card class");
});

// ============================================
// Comparison Tests
// ============================================
console.log("\nComparison Component:");

const comparisonContent = fs.readFileSync(
  path.join(componentsDir, "Comparison.tsx"),
  "utf8"
);

test("Comparison shows competitors", () => {
  assert(comparisonContent.includes("FireCut"), "Missing FireCut competitor");
  assert(comparisonContent.includes("AutoPod"), "Missing AutoPod competitor");
});

test("Comparison shows SPLICE advantages", () => {
  // Uses "AI Music Scoring" and "Text-Based Trimming" in comparison
  assert(
    comparisonContent.includes("AI Music Scoring") || comparisonContent.includes("Music"),
    "Missing AI Music differentiator"
  );
  assert(
    comparisonContent.includes("Text-Based Trimming") || comparisonContent.includes("Text-Based"),
    "Missing Text Editing differentiator"
  );
});

test("Comparison has feature checkmarks", () => {
  assert(comparisonContent.includes("Check"), "Missing check icons");
});

// ============================================
// Testimonials Tests
// ============================================
console.log("\nTestimonials Component:");

const testimonialsContent = fs.readFileSync(
  path.join(componentsDir, "Testimonials.tsx"),
  "utf8"
);

test("Testimonials has 3 testimonials", () => {
  assert(testimonialsContent.includes("Alex Rivera"), "Missing testimonial 1");
  assert(testimonialsContent.includes("Sarah Chen"), "Missing testimonial 2");
  assert(testimonialsContent.includes("Marcus Johnson"), "Missing testimonial 3");
});

test("Testimonials has star ratings", () => {
  assert(testimonialsContent.includes("Star"), "Missing star ratings");
  assert(testimonialsContent.includes("rating: 5"), "Missing 5-star rating");
});

test("Testimonials has role/credential", () => {
  assert(testimonialsContent.includes("YouTube Creator"), "Missing role");
  assert(testimonialsContent.includes("Podcast Editor"), "Missing role");
});

// ============================================
// Pricing Tests
// ============================================
console.log("\nPricing Component:");

const pricingContent = fs.readFileSync(
  path.join(componentsDir, "Pricing.tsx"),
  "utf8"
);

test("Pricing has 3 tiers", () => {
  assert(pricingContent.includes("Starter"), "Missing Starter tier");
  assert(pricingContent.includes("Pro"), "Missing Pro tier");
  assert(pricingContent.includes("Team"), "Missing Team tier");
});

test("Pricing has correct prices", () => {
  assert(pricingContent.includes("$15"), "Missing $15 price");
  assert(pricingContent.includes("$39"), "Missing $39 price");
  assert(pricingContent.includes("$129"), "Missing $129 price");
});

test("Pricing has Most Popular badge", () => {
  assert(pricingContent.includes("Most Popular"), "Missing Most Popular badge");
});

test("Pricing has 14-day trial badge", () => {
  assert(
    pricingContent.includes("14-day") || pricingContent.includes("free trial"),
    "Missing trial badge"
  );
});

test("Pricing has feature lists", () => {
  assert(pricingContent.includes("hours of processing"), "Missing processing hours");
  assert(pricingContent.includes("music generation"), "Missing music generation");
});

// ============================================
// FAQ Tests
// ============================================
console.log("\nFAQ Component:");

const faqContent = fs.readFileSync(path.join(componentsDir, "FAQ.tsx"), "utf8");

test("FAQ has accordion questions", () => {
  assert(faqContent.includes("Accordion"), "Missing Accordion component");
  assert(faqContent.includes("14-day free trial"), "Missing trial FAQ");
  assert(
    faqContent.includes("Premiere Pro") || faqContent.includes("versions"),
    "Missing version FAQ"
  );
});

test("FAQ addresses common objections", () => {
  assert(faqContent.includes("cancel"), "Missing cancellation FAQ");
  assert(
    faqContent.includes("secure") || faqContent.includes("data"),
    "Missing security FAQ"
  );
});

// ============================================
// Final CTA Tests
// ============================================
console.log("\nFinal CTA Component:");

const finalCtaContent = fs.readFileSync(
  path.join(componentsDir, "FinalCTA.tsx"),
  "utf8"
);

test("Final CTA has headline", () => {
  assert(
    finalCtaContent.includes("Ready to Edit") ||
      finalCtaContent.includes("10x Faster"),
    "Missing final CTA headline"
  );
});

test("Final CTA has buttons", () => {
  assert(finalCtaContent.includes("Start Free Trial"), "Missing trial CTA");
  assert(finalCtaContent.includes("Download"), "Missing download CTA");
});

// ============================================
// Footer Tests
// ============================================
console.log("\nFooter Component:");

const footerContent = fs.readFileSync(
  path.join(componentsDir, "Footer.tsx"),
  "utf8"
);

test("Footer has navigation sections", () => {
  assert(footerContent.includes("Product"), "Missing Product section");
  assert(footerContent.includes("Company"), "Missing Company section");
  assert(footerContent.includes("Resources"), "Missing Resources section");
  assert(footerContent.includes("Legal"), "Missing Legal section");
});

test("Footer has social links", () => {
  assert(footerContent.includes("twitter"), "Missing Twitter link");
  assert(footerContent.includes("youtube"), "Missing YouTube link");
  assert(footerContent.includes("discord"), "Missing Discord link");
});

test("Footer has copyright", () => {
  assert(footerContent.includes("SPLICE"), "Missing copyright");
  assert(footerContent.includes("rights reserved"), "Missing rights reserved");
});

// ============================================
// Main Page Tests
// ============================================
console.log("\nMain Page:");

const mainPageContent = fs.readFileSync(
  path.join(appDir, "page.tsx"),
  "utf8"
);

test("Main page imports all components", () => {
  assert(mainPageContent.includes("Header"), "Missing Header import");
  assert(mainPageContent.includes("Hero"), "Missing Hero import");
  assert(mainPageContent.includes("SocialProof"), "Missing SocialProof import");
  assert(mainPageContent.includes("Features"), "Missing Features import");
  assert(mainPageContent.includes("Comparison"), "Missing Comparison import");
  assert(mainPageContent.includes("Testimonials"), "Missing Testimonials import");
  assert(mainPageContent.includes("Pricing"), "Missing Pricing import");
  assert(mainPageContent.includes("FAQ"), "Missing FAQ import");
  assert(mainPageContent.includes("FinalCTA"), "Missing FinalCTA import");
  assert(mainPageContent.includes("Footer"), "Missing Footer import");
});

// ============================================
// Layout Tests
// ============================================
console.log("\nLayout & SEO:");

const layoutContent = fs.readFileSync(
  path.join(appDir, "layout.tsx"),
  "utf8"
);

test("Layout has proper metadata", () => {
  assert(layoutContent.includes("SPLICE"), "Missing SPLICE in title");
  assert(layoutContent.includes("description"), "Missing meta description");
  assert(layoutContent.includes("openGraph"), "Missing OpenGraph tags");
  assert(layoutContent.includes("twitter"), "Missing Twitter card");
});

test("Layout has proper keywords", () => {
  assert(layoutContent.includes("video editing"), "Missing video editing keyword");
  assert(layoutContent.includes("premiere pro"), "Missing premiere pro keyword");
});

// ============================================
// Results
// ============================================
console.log("\n========================================");
console.log(`Landing Page Tests: ${passed} passed, ${failed} failed`);
console.log("========================================\n");

process.exit(failed > 0 ? 1 : 0);
