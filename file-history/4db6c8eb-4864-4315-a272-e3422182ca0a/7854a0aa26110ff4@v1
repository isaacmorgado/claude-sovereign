/**
 * Slice 8: Silence Detection Service
 *
 * Analyzes Whisper transcription segments to find silent gaps.
 * Returns silence regions for timeline removal.
 */

/**
 * Detect silences (gaps between speech segments)
 * @param {Array} segments - Whisper segments with start/end timestamps
 * @param {number} threshold - Minimum gap duration to count as silence (seconds)
 * @returns {Array<{start: number, end: number, duration: number}>}
 */
function detectSilences(segments, threshold = 0.5) {
  if (!segments || segments.length < 2) {
    return [];
  }

  const silences = [];

  // Check gap before first segment (leading silence)
  if (segments[0].start >= threshold) {
    silences.push({
      start: 0,
      end: segments[0].start,
      duration: segments[0].start
    });
  }

  // Check gaps between segments
  for (let i = 0; i < segments.length - 1; i++) {
    const gap = segments[i + 1].start - segments[i].end;
    if (gap >= threshold) {
      silences.push({
        start: segments[i].end,
        end: segments[i + 1].start,
        duration: gap
      });
    }
  }

  console.log(`[SPLICE] Detected ${silences.length} silence(s) with threshold ${threshold}s`);
  return silences;
}

module.exports = { detectSilences };
