# SPLICE

AI-powered Premiere Pro UXP plugin for detecting takes, removing silences, and accelerating video editing workflows.

---

## Quick Reference

### Pro Workflow (3 Clicks)
```
1. SELECT    → Select clips on timeline
2. ANALYZE   → Click "Detect & Remove Silences"
3. EXECUTE   → Click "Apply"
```

### Key Constraints
- UXP requires Premiere Pro 25.6+
- Use `127.0.0.1` not `localhost` in fetch URLs
- FFprobe required: `brew install ffmpeg`
- XMEML uses frames with `<timebase>` for fps conversion
- Linked clips must be processed together (same start time = linked)

---

## Implementation Status

### Backend Services (`splice-backend/services/`)

| Service | File | Status | Notes |
|---------|------|--------|-------|
| Transcription | `transcription.js` | ✅ Done | Groq Whisper (whisper-large-v3) |
| Take Detection | `takeDetection.js` | ✅ Done | GPT-4o-mini analysis |
| Silence (Whisper) | `silenceDetection.js` | ✅ Done | Transcript gap detection |
| Silence (FFprobe) | `ffprobeSilence.js` | ✅ Done | Audio level detection |
| XML Processor | `xmlProcessor.js` | ✅ Done | XMEML clip splitting |
| Vocal Isolation | `vocalIsolation.js` | ❌ Missing | Demucs via Replicate - CRITICAL |

### API Endpoints (`splice-backend/server.js`)

| Endpoint | Method | Status | Purpose |
|----------|--------|--------|---------|
| `/` | GET | ✅ | API info |
| `/health` | GET | ✅ | Health check |
| `/ffprobe-check` | GET | ✅ | FFprobe availability |
| `/analyze` | POST | ✅ | Full transcription + take detection |
| `/silences` | POST | ✅ | Whisper gap-based silence detection |
| `/silences-audio` | POST | ✅ | FFprobe audio level silence detection |
| `/process-xml` | POST | ✅ | XML clip splitting |
| `/detect-and-remove` | POST | ❌ Missing | Unified endpoint for simplified UI |

### Plugin UI (`splice-plugin/`)

| Feature | Status | Notes |
|---------|--------|-------|
| Timeline clip reading | ✅ Done | Slice 1 |
| Audio export | ✅ Done | Slice 3 |
| Transcription UI | ✅ Done | Slice 4 |
| Take detection UI | ✅ Done | Slice 5-6 |
| Take labeling | ✅ Done | Slice 7 |
| Silence detection | ✅ Done | Slice 8-9 |
| Audio source selector | ❌ Missing | Original/Isolated/Both checkboxes |
| Sensitivity slider | ❌ Missing | Single slider (maps to dB + duration) |
| Unified "Detect & Remove" button | ❌ Missing | Currently 2 separate workflows |

### Critical Missing Features

1. **Vocal Isolation** - Required for noisy audio (60%+ of real-world footage)
2. **Audio Source Selector UI** - Checkbox for Original/Isolated/Both
3. **Simplified Sensitivity Slider** - Single slider instead of separate controls
4. **Rate Limiting** - Prevent API abuse, ensure margins
5. **Referral System** - Commission tracking for growth

---

## Silence Detection Methods

### Method 1: Whisper Gaps (`/silences`)
- Detects gaps between transcribed speech segments
- Cost: $0.001/min (Groq Whisper)
- Best for: Clean audio with clear speech
- Limitation: Can't detect silence during music/noise

### Method 2: FFprobe Audio Levels (`/silences-audio`)
- Uses FFprobe `silencedetect` filter
- Cost: $0 (local processing)
- Current threshold: **-30dB (hardcoded)** ← needs UI slider
- Best for: Clean audio
- Limitation: Background noise = no silence detected

### Method 3: Vocal Isolation + Detection (NOT IMPLEMENTED)
- Required for noisy audio (music, wind, HVAC)
- Workflow: Isolate vocals (Demucs) → FFprobe on clean track
- Cost: ~$0.015/min additional
- This is the **#1 missing feature**

### Audio Quality vs Detection Accuracy

| Scenario | FFprobe | Whisper | With Isolation |
|----------|---------|---------|----------------|
| Clean studio | ✅ Works | ✅ Works | N/A |
| Light noise | ⚠️ Okay | ✅ Works | N/A |
| Loud music | ❌ Fails | ❌ Fails | ✅ Works |
| Wind/outdoor | ❌ Fails | ❌ Fails | ✅ Works |

---

## Simplified UI Design

### Target UI (3-Click Workflow)
```
┌─────────────────────────────────────────────────────────────────┐
│  ─────────── Audio Source ───────────                           │
│                                                                 │
│  [x] Original Audio          (clean recordings)                 │
│  [ ] Isolated Vocals         (noisy audio)         [Creator+]   │
│  [ ] Both                    (compare)             [Creator+]   │
│                                                                 │
│  ─────────── Silence Sensitivity ───────────                    │
│                                                                 │
│  Less ├──────────●──────────────────┤ More                      │
│       (keep pauses)         (remove more)                       │
│                                                                 │
│  [■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■■] Detect & Remove Silences  │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

### Sensitivity Slider Mapping
| Position | dB Threshold | Min Duration | Padding |
|----------|--------------|--------------|---------|
| 0% (Less) | -50dB | 2.0s | 0.2s |
| 50% (Default) | -30dB | 0.5s | 0.1s |
| 100% (More) | -20dB | 0.3s | 0.05s |

---

## Pricing Tiers

### Starter - $14.99/month (85% margin)
*"For clean studio audio"*

| Feature | Included |
|---------|----------|
| Transcription minutes | 500 min/month |
| Vocal Isolation | ✗ (0 min) |
| Silence detection | ✓ |
| Take detection & labeling | ✓ |
| Color coding | ✓ |
| AI quality scoring | ✗ |
| API access | ✗ |

**Target user:** Pro editors with good mics. Pay for speed, don't need isolation.

### Creator - $34.99/month (80% margin)
*"Works on any audio"*

| Feature | Included |
|---------|----------|
| Transcription minutes | 1,500 min/month |
| Vocal Isolation | 200 min/month |
| All Starter features | ✓ |
| AI "best take" suggestions | ✓ |
| Filler word detection | ✓ |
| False start auto-removal | ✓ |
| API access | ✗ |

**Target user:** Creators with varying audio quality. Need isolation for noisy recordings.

### Pro - $69.99/month (80% margin)
*"For power users & teams"*

| Feature | Included |
|---------|----------|
| Transcription minutes | 4,000 min/month |
| Vocal Isolation | 400 min/month |
| All Creator features | ✓ |
| Priority processing | ✓ |
| Script/transcript export | ✓ |
| Custom color schemes | ✓ |
| API access | ✓ |
| Team sharing (coming soon) | ✓ |

**Target user:** Power users, teams, automated workflows.

---

## Unit Economics

### API Costs

| Service | Cost/Min | Notes |
|---------|----------|-------|
| Groq Whisper | $0.001 | Transcription |
| Replicate Demucs | $0.015 | Vocal isolation |
| GPT-4o-mini | ~$0.0001/job | Take analysis |
| Stripe | 2.9% + $0.30 | Payment processing |
| Infrastructure | $1-1.50/mo | Serverless |

### Margin Calculation (Max Usage)

| Tier | Price | Whisper | Demucs | Stripe | Infra | Total Cost | Margin |
|------|-------|---------|--------|--------|-------|------------|--------|
| Starter | $14.99 | $0.50 | $0 | $0.73 | $1.00 | $2.24 | **85%** |
| Creator | $34.99 | $1.50 | $3.00 | $1.31 | $1.25 | $7.06 | **80%** |
| Pro | $69.99 | $4.00 | $6.00 | $2.33 | $1.50 | $13.83 | **80%** |

---

## Rate Limiting

### Per-Tier Limits
```javascript
const LIMITS = {
  starter: {
    transcriptionMinutes: 500,
    isolationMinutes: 0,
    requestsPerHour: 10
  },
  creator: {
    transcriptionMinutes: 1500,
    isolationMinutes: 200,
    requestsPerHour: 30
  },
  pro: {
    transcriptionMinutes: 4000,
    isolationMinutes: 400,
    requestsPerHour: 60
  }
};
```

### Usage Tracking
- Soft warning at 80% usage
- Hard block at 100% until next billing cycle
- Real-time usage displayed in plugin UI

---

## Referral & Commission System

### Commission Structure

| Referrer Type | Commission | Duration | Referee Discount |
|---------------|------------|----------|------------------|
| Regular User | 20% | 3 months | 50% off first month |
| UGC Creator | 25% | 3 months | 50% off first month |

**UGC Creator Bonuses:**
- $25 bonus at 5 conversions
- $100 bonus at 20 conversions

### Why This Structure

| Factor | Benefit |
|--------|---------|
| 50% off first month | Compelling hook, drives conversions |
| Commission for 3 months only | Lower CAC, faster path to full margin |
| Higher % for shorter time | Motivates referrers, limits exposure |

### Commission Tracking Schema
```javascript
const referralSchema = {
  code: "JOHN20",              // Unique referral code
  ownerId: "user_123",         // User who owns the code
  ownerType: "user" | "ugc",   // Type determines commission %
  commission: 20 | 25,         // Percentage based on ownerType
  discountPercent: 50,         // First month discount
  commissionMonths: 3,         // Commission duration
  conversions: [
    {
      userId: "user_456",
      convertedAt: "2024-01-15",
      plan: "creator",
      monthlyValue: 34.99,
      commissionsRemaining: 3
    }
  ],
  totalEarnings: 0,
  bonusesPaid: [],
  payoutHistory: []
};
```

### Commission Examples (Per Referral)

| Referred Plan | Month 1 | Months 2-3 | Total (3mo) |
|---------------|---------|------------|-------------|
| **Regular User (20%)** |
| Starter $14.99 | $1.50 | $6.00 | **$7.50** |
| Creator $34.99 | $3.50 | $14.00 | **$17.50** |
| Pro $69.99 | $7.00 | $28.00 | **$35.00** |
| **UGC Creator (25%)** |
| Starter $14.99 | $1.87 | $7.50 | **$9.37** |
| Creator $34.99 | $4.37 | $17.50 | **$21.87** |
| Pro $69.99 | $8.75 | $35.00 | **$43.75** |

### Year 1 Margins (With Referral)

| Tier | Revenue | COGS | Commission | Profit | Margin |
|------|---------|------|------------|--------|--------|
| Starter | $172.39 | $26.88 | $7.50 | $138.01 | **80%** |
| Creator | $402.39 | $84.72 | $17.50 | $300.17 | **75%** |
| Pro | $804.89 | $165.96 | $35.00 | $603.93 | **75%** |

*After 3 months, full 80%+ margins resume.*

---

## Technical Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                    PREMIERE PRO (UXP Plugin)                    │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │
│  │ Plugin UI   │  │ Timeline    │  │ Audio Export            │  │
│  │ (HTML/JS)   │  │ Manipulation│  │ (temp WAV to /tmp)      │  │
│  └──────┬──────┘  └──────┬──────┘  └──────────┬──────────────┘  │
└─────────┼────────────────┼────────────────────┼─────────────────┘
          │                │                    │
          ▼                ▼                    ▼
┌─────────────────────────────────────────────────────────────────┐
│              SPLICE BACKEND (Express HTTPS :3847)               │
│                                                                 │
│  Implemented:                                                   │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────────────────┐  │
│  │ /analyze    │  │ /silences-  │  │ /process-xml            │  │
│  │ Transcribe  │  │ audio       │  │ Split clips at silences │  │
│  │ + Takes     │  │ FFprobe     │  │                         │  │
│  └──────┬──────┘  └─────────────┘  └─────────────────────────┘  │
│         │                                                       │
│         ▼                                                       │
│  ┌─────────────┐  ┌─────────────┐                               │
│  │ GROQ API    │  │ OPENAI API  │                               │
│  │ Whisper     │  │ GPT-4o-mini │                               │
│  │ $0.001/min  │  │ ~$0.0001/job│                               │
│  └─────────────┘  └─────────────┘                               │
│                                                                 │
│  NOT IMPLEMENTED (Critical):                                    │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ REPLICATE API (Demucs) - Vocal Isolation                │    │
│  │ Required for noisy audio - $0.015/min                   │    │
│  └─────────────────────────────────────────────────────────┘    │
└─────────────────────────────────────────────────────────────────┘
```

---

## Key Files

### Backend
- `splice-backend/server.js` - Express routes, API orchestration
- `splice-backend/services/transcription.js` - Groq Whisper integration
- `splice-backend/services/takeDetection.js` - GPT-4o-mini take analysis
- `splice-backend/services/silenceDetection.js` - Whisper gap detection
- `splice-backend/services/ffprobeSilence.js` - FFprobe silence detection
- `splice-backend/services/xmlProcessor.js` - XMEML clip splitting

### Plugin
- `splice-plugin/index.html` - Main UI
- `splice-plugin/js/main.js` - Entry point
- `splice-plugin/js/slice1-timeline.js` - Timeline reading
- `splice-plugin/js/slice3-export.js` - Audio export
- `splice-plugin/js/slice6-analyze.js` - Backend integration
- `splice-plugin/js/slice7-apply.js` - Apply takes to timeline
- `splice-plugin/js/slice8-silence.js` - Silence detection UI
- `splice-plugin/js/slice9-razor.js` - XML razor workflow

---

## User Personas

### Pro Editors (Starter Tier)
- Good mics, clean recording environment
- Don't need vocal isolation
- Value speed above all else
- Decision driver: "How fast can I get through this edit?"

### Creators (Creator Tier)
- Varying audio quality (home office, outdoors)
- Need vocal isolation to clean up audio
- Price sensitive but recognize value
- Decision driver: "Can this fix my bad audio?"

### Power Users (Pro Tier)
- High volume, multiple projects
- Need API access for automation
- Teams sharing workflows
- Decision driver: "Does this scale with my workflow?"

---

## Competitive Advantage

| Feature | Timebolt | AutoPod | SPLICE |
|---------|----------|---------|--------|
| Silence removal | ✓ | ✓ | ✓ |
| Take detection | ✗ | ✗ | ✓ |
| Semantic labeling | ✗ | ✗ | ✓ |
| Best take suggestion | ✗ | ✗ | ✓ |
| Understands content | ✗ | ✗ | ✓ |
| Vocal isolation | ✗ | ✗ | ✓ (Creator+) |
| Works in Premiere | Export/reimport | ✓ | ✓ |

**Key differentiator:** SPLICE treats editing as a **content problem** (understands what's being said), not just a **waveform problem** (audio levels).

---

## Open Items

### Critical (Pre-Launch)
- [ ] **Vocal Isolation**: Implement Replicate/Demucs integration
- [ ] **Simplified UI**: Single sensitivity slider, audio source checkboxes
- [ ] **Unified Endpoint**: `POST /detect-and-remove`
- [ ] **Rate Limiting**: Implement tier-based limits
- [ ] **User Authentication**: Required for rate limiting

### High Priority
- [ ] dB threshold slider (currently hardcoded -30dB)
- [ ] Referral system backend
- [ ] Usage tracking dashboard
- [ ] Stripe integration for payments

### Medium Priority
- [ ] Commission payout automation
- [ ] UGC creator verification
- [ ] Team sharing features

### Post-MVP
- [ ] Self-hosting evaluation when volume justifies
- [ ] Fine-tuned LLM for take detection
- [ ] After Effects / DaVinci Resolve ports

---

## Current Session

### Focus
Slice 9 - XML Processor + Documentation consolidation

### Last Update (2025-12-19)
- Fixed XML processor bugs (link references, sequence duration, linked clips)
- Discussed pricing strategy for 80%+ margins
- Designed referral/commission system
- Planned simplified 3-click UX
- Consolidated documentation into single CLAUDE.md

### Next Steps
1. Test XML import in Premiere Pro
2. Implement vocal isolation (Demucs/Replicate)
3. Build simplified UI with sensitivity slider
4. Add rate limiting

---

*Last updated: 2025-12-19*
