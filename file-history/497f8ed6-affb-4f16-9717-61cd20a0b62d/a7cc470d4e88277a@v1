#!/usr/bin/env python3
"""
Batch processor using dlib's accurate 68-point facial landmark detector.

This script processes all source images in the Mario_images folder
and generates cropped landmark images with light blue circle markers.

Usage:
    python process_all_images_accurate.py
"""

import subprocess
import sys
from pathlib import Path

# Define the source images and their configurations
SOURCE_IMAGES = [
    # Front-facing images
    {"input": "BLONDEFRONT.png", "prefix": "blonde_front", "side": False},
    {"input": "brownfont.png", "prefix": "brown_front", "side": False},

    # Side profile images
    {"input": "BLONDESIDE.png", "prefix": "blonde_side_left", "side": True},
    {"input": "BLONDESIDERIGHT.png", "prefix": "blonde_side_right", "side": True},
    {"input": "brownside.png", "prefix": "brown_side_left", "side": True},
    {"input": "brownside2.png", "prefix": "brown_side_right", "side": True},
]

def main():
    script_dir = Path(__file__).parent
    script_path = script_dir / "generate_landmark_images_accurate.py"

    print("=" * 70)
    print("Batch Processing with ACCURATE dlib 68-point Facial Landmark Detection")
    print("=" * 70)

    for config in SOURCE_IMAGES:
        input_path = script_dir / config["input"]

        if not input_path.exists():
            print(f"\nSkipping {config['input']} - file not found")
            continue

        # Determine output directory
        if config["side"]:
            output_dir = script_dir / "output_accurate" / "side" / config["prefix"]
        else:
            output_dir = script_dir / "output_accurate" / "front" / config["prefix"]

        print(f"\n{'=' * 70}")
        print(f"Processing: {config['input']}")
        print(f"Output: {output_dir}")
        print(f"Profile type: {'Side' if config['side'] else 'Front'}")
        print("=" * 70)

        cmd = [
            sys.executable,
            str(script_path),
            "--input", str(input_path),
            "--output-dir", str(output_dir),
            "--output-prefix", config["prefix"],
            "--format", "webp"
        ]

        if config["side"]:
            cmd.append("--side-profile")

        try:
            result = subprocess.run(cmd, capture_output=True, text=True)
            print(result.stdout)
            if result.stderr:
                for line in result.stderr.split('\n'):
                    if line.strip():
                        print(f"  {line}")
        except Exception as e:
            print(f"Error processing {config['input']}: {e}")

    print("\n" + "=" * 70)
    print("Batch processing complete!")
    print("=" * 70)

    # Print summary
    print("\nOutput directories created:")
    for config in SOURCE_IMAGES:
        if config["side"]:
            output_dir = script_dir / "output_accurate" / "side" / config["prefix"]
        else:
            output_dir = script_dir / "output_accurate" / "front" / config["prefix"]

        if output_dir.exists():
            count = len(list(output_dir.glob("*.webp")))
            print(f"  {output_dir.relative_to(script_dir)}: {count} images")


if __name__ == "__main__":
    main()
