#!/usr/bin/env python3
"""
Quick test: Verify integrated screencapture CLI fallback works for Adobe Premiere Pro.
"""

import sys

sys.path.insert(0, "/Users/imorgado/Desktop/Development/Projects/visionpilot/src")

from backends.macos_backend import MacOSBackend


def test_capture():
    """Test capturing Premiere Pro window with integrated fallback."""

    # Get Premiere Pro PID (should be running)
    import subprocess

    result = subprocess.run(["pgrep", "-i", "premiere"], capture_output=True, text=True)

    if result.returncode != 0:
        print("âŒ Premiere Pro not running")
        return False

    pid = int(result.stdout.strip().split("\n")[0])
    print(f"Found Premiere Pro PID: {pid}")

    # Create backend and test capture
    backend = MacOSBackend(screenshot_dir="/tmp/test-screenshots")

    print("\nğŸ§ª Testing window capture with integrated CLI fallback...")
    image = backend.capture_window_by_pid(pid)

    if image:
        print(f"âœ… Successfully captured {image.size} image")

        # Save for verification
        output_path = f"/tmp/test_integrated_capture_{pid}.png"
        image.save(output_path)
        print(f"ğŸ“¸ Saved to: {output_path}")
        return True
    else:
        print("âŒ Failed to capture window")
        return False


if __name__ == "__main__":
    success = test_capture()
    sys.exit(0 if success else 1)
