#!/usr/bin/env node
/**
 * Check if workflows table exists
 */

const { Pool } = require('pg');
require('dotenv').config({ path: '/Users/imorgado/SPLICE/splice-backend/.env' });

async function checkTable() {
  const pool = new Pool({
    connectionString: process.env.DATABASE_URL,
    ssl: process.env.NODE_ENV === 'production' ? { rejectUnauthorized: false } : false
  });

  try {
    const client = await pool.connect();

    const result = await client.query(`
      SELECT EXISTS (
        SELECT FROM information_schema.tables
        WHERE table_name = 'workflows'
      );
    `);

    const exists = result.rows[0].exists;
    console.log(exists ? 'WORKFLOWS_TABLE_EXISTS' : 'WORKFLOWS_TABLE_NOT_EXISTS');

    client.release();
    process.exit(0);
  } catch (error) {
    console.error('ERROR:', error.message);
    process.exit(1);
  } finally {
    await pool.end();
  }
}

checkTable();
