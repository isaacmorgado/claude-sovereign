# LOOKSMAXX Personal Coach Feature - Implementation Plan

## Overview

Add a personal looksmaxxing coach with **minimal user friction**:
1. **Short Questionnaire** (3-4 questions only) - Height, goals, hair color, timeline
2. **Auto-Analysis** - Claude Vision + MediaPipe Pose derive everything else from photos
3. **LLM Coach** (Claude) - Personalized advice using harmony score + auto-derived data
4. **Visual Mockups** (Google Nano Banana) - Hairstyle, archetype, style visualizations
5. **Archetype Classification** - Prompt-engineered rules based on existing 70+ metrics

---

## Design Principle: Minimal Friction

**User provides only (3-4 questions):**
- Height (can't derive accurately from photos)
- Goals (what they want to improve)
- Hair color (if dyed)
- Timeline preference

**Auto-derived from FACE photo (existing landmarks):**
- Eye shape, eye color, eyebrow shape
- Nose shape, jawline, cheek hollows
- Face shape, midface length, hairline
- Skin tone, skin clarity
- Facial forward growth
- All 70+ existing metrics

**Auto-derived from BODY photo (new):**
- Shoulder-to-waist ratio (MediaPipe Pose landmarks)
- Frame size, body proportions
- Muscularity level (Claude Vision)
- Leanness estimate (Claude Vision)

---

## Phase 1: Minimal Questionnaire + Body Photo

### Database Changes

**New file:** `/Users/imorgado/LOOKSMAXX/looksmaxx-api/app/models/user_profile.py`
```python
class UserProfile(Base):
    __tablename__ = "user_profiles"

    id: UUID
    user_id: UUID (FK -> users.id, unique)

    # User-provided (minimal)
    height_cm: int
    hair_color: str  # if dyed
    goals: JSONB  # list of improvement goals
    timeline: str  # 3mo, 6mo, 1yr

    # Auto-derived from face (populated after analysis)
    face_metrics_summary: JSONB  # key metrics from analysis
    eye_color_detected: str
    skin_tone_detected: str
    face_shape_detected: str

    # Auto-derived from body photo
    body_photo_url: str
    body_landmarks: JSONB  # MediaPipe Pose 33 keypoints
    shoulder_waist_ratio: float
    frame_classification: str  # narrow, average, broad
    muscularity_level: str  # Claude Vision assessment
    leanness_level: str  # Claude Vision assessment

    # Archetype (computed)
    primary_archetype: str
    secondary_archetype: str
    archetype_scores: JSONB

    created_at, updated_at: datetime
```

### API Endpoints

**New file:** `/Users/imorgado/LOOKSMAXX/looksmaxx-api/app/routers/profile.py`

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/profile/me` | GET | Get user profile with all data |
| `/profile/setup` | POST | Submit minimal questionnaire |
| `/profile/body-photo` | POST | Upload body photo for analysis |
| `/profile/auto-analyze` | POST | Run auto-analysis on photos |

### Frontend Components

**New files:**
- `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/profile-setup/page.tsx` (short form)
- `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/BodyPhotoUpload.tsx`

**User Flow Update:**
```
Signup → Gender → Ethnicity → [NEW: 4-Question Setup] → Upload (face + body) → Analysis → Results + Coach
```

---

## Phase 2: Complete PSL Scoring Engine

### 2.1 Core Philosophy: Halos and Failos

**The Chain Theory:** Attractiveness is like a chain; the weakest link limits the whole.
- Failos typically matter MORE than Halos
- Removing a major flaw increases SMV more than adding a good trait

**Prioritization:**
1. Eliminate high-impact failos (penalties)
2. Stack halos for compounding effect (bonuses)

### 2.2 Claude Vision Feature Extraction

**Run on face photo (auto during analysis):**

```python
CLAUDE_VISION_PROMPT = """
Analyze this face photo and extract features for PSL rating:

HALOS TO DETECT:
- Hunter blue eyes, positive canthal tilt, deep-set eyes
- Straight hairline (Norwood 0), youthful dense hair
- Chiseled jawline, strong bone structure, hollow cheeks
- Clear glowing skin, golden tan
- Heavy brow ridge, high dimorphism

FAILOS TO DETECT:
- Bug eyes, negative canthal tilt, prey eyes
- Receding hairline (Norwood 2+), thinning hair
- Receding chin, weak jaw, asymmetry
- Acne, scarring, pale/unhealthy complexion
- Weak brow ridge, lack of definition

Return structured JSON with:
- halos_detected: [{feature, confidence, description}]
- failos_detected: [{feature, severity: major|minor, description}]
- skin_clarity: 1-10
- skin_tone: classification
- hairline_norwood: 0-7
- eye_color: classification
- cheek_hollowness: 1-10
"""
```

### 2.3 The Mogger Calculation Formula

**Base Formula (75/20/5 Split):**
```
Score_Base = (Face × 0.75) + (Height × 0.20) + (Physique × 0.05)
```

**Component Definitions:**
- **Face (75%)**: Primary driver. First thing noticed, dictates majority of score.
- **Height (20%)**: Shapes perception of presence/status. Instantly obvious.
- **Physique (5%)**: Multiplier. Cannot compensate for weak face/height, but poor physique drags face down.

**Complete Calculation:**
```python
def calculate_psl_score(face: float, height: float, body: float) -> dict:
    # Step 1: Base weighted average
    base_score = (face * 0.75) + (height * 0.20) + (body * 0.05)

    # Step 2: Single trait bonuses (8.5+ in one category)
    bonuses = 0
    if face >= 8.5: bonuses += 0.30
    if height >= 8.5: bonuses += 0.20
    if body >= 8.5: bonuses += 0.10

    # Step 3: Synergy bonuses (8.5+ in two categories)
    synergy = 0
    if face >= 8.5 and height >= 8.5 and body >= 8.5:
        # Triple synergy overrides pair bonuses
        synergy = 0.35
    else:
        if face >= 8.5 and height >= 8.5: synergy += 0.15
        if face >= 8.5 and body >= 8.5: synergy += 0.10
        if height >= 8.5 and body >= 8.5: synergy += 0.05

    # Step 4: Final score (capped at 10)
    final_score = min(base_score + bonuses + synergy, 10.0)

    # Step 5: Determine tier
    tier = get_tier_from_score(final_score)

    return {
        "base_score": base_score,
        "bonuses": bonuses,
        "synergy": synergy,
        "final_score": final_score,
        "tier": tier
    }
```

**Example Calculation (Triple Mogger):**
```
Input: Face=8.5, Height=8.5, Body=8.5

Base = (8.5 × 0.75) + (8.5 × 0.20) + (8.5 × 0.05)
     = 6.375 + 1.70 + 0.425 = 8.5

Bonuses = +0.30 (face) + +0.20 (height) + +0.10 (body) = +0.60
Synergy = +0.35 (triple synergy, overrides pairs)

Final = 8.5 + 0.60 + 0.35 = 9.45 → GIGACHAD tier
```

### 2.4 Bonus System

```python
PSL_BONUSES = {
    # Single Trait Bonuses (8.5+ in one category)
    "face_elite": {"threshold": 8.5, "bonus": 0.30},
    "height_elite": {"threshold": 8.5, "bonus": 0.20},
    "body_elite": {"threshold": 8.5, "bonus": 0.10},

    # Synergies (8.5+ in two categories)
    "face_height_synergy": {"bonus": 0.15},
    "face_body_synergy": {"bonus": 0.10},
    "height_body_synergy": {"bonus": 0.05},

    # Triple Synergy (8.5+ in ALL THREE)
    "true_mogger": {
        "bonus": 0.35,
        "overrides_pair_bonuses": True,
        "description": "Pushes into True Mogger range"
    }
}
```

### 2.5 Constraint Logic (Failo Rules)

```python
FAILO_RULES = {
    # Failo Dominance Rule
    "major_failo_cap": {
        "triggers": ["receding_chin", "deformity", "severe_asymmetry", "bug_eyes"],
        "effect": "max_tier = LTN regardless of other Halos"
    },

    # Physique Perception Rule
    "body_penalty": {
        "condition": "physique_score < 5.0",
        "effect": "Negatively impacts face_score PERCEPTION (not just average)"
    },

    # Height Gatekeeper
    "height_gatekeeper": {
        "threshold": "5'5\"",
        "effect": "Creates massive deficit, drags to MTN even with high face",
        "example": "Josh Hutcherson (5'5\") - Face is HTN but height drags to MTN"
    }
}
```

### 2.6 Halo/Failo Taxonomy

```python
HALOS = {
    "eyes": [
        "hunter_blue_eyes",
        "positive_canthal_tilt",
        "deep_set_eyes",
        "hollow_under_eyes"
    ],
    "hair": [
        "straight_hairline",
        "norwood_0",
        "youthful_dense_hair"
    ],
    "jaw": [
        "chiseled_jawline",
        "superman_jaw",
        "strong_bone_structure",
        "soft_rounded_jaw"  # contextual
    ],
    "skin": [
        "clear_glowing_skin",
        "golden_tan_skin"
    ],
    "body": [
        "capped_delts",
        "sub_10_bodyfat",
        "aesthetic_physique",
        "broad_shoulders"
    ],
    "height": ["6'0\" - 6'4\""],  # The "Sweet Spot"
    "other": [
        "high_sexual_dimorphism",
        "masculine_features"
    ]
}

FAILOS = {
    "eyes": [
        "bug_eyes",
        "negative_canthal_tilt",
        "prey_eyes"
    ],
    "hair": [
        "receding_hairline",
        "low_effort_hairstyle",
        "norwood_3_plus"
    ],
    "jaw": [
        "receding_chin",  # MAJOR FAILO
        "weak_retrusive_bite",
        "undefined_jaw"
    ],
    "skin": [
        "bad_acne",
        "pale_unhealthy_complexion",
        "scarring"
    ],
    "body": [
        "skinny_neck",
        "high_bodyfat",
        "sloppy_posture",
        "narrow_shoulders"
    ],
    "height": ["< 5'7\""],  # Western standards
    "other": [
        "disfigurements",
        "burn_scars",
        "mouth_breathing_indicators"
    ]
}
```

### 2.7 Complete Tier System (Bell Curve)

| Tier | PSL Range | Percentile | Social Dynamic | Examples |
|------|-----------|------------|----------------|----------|
| **Cursed** | -0.5 | ~0% | "Never Began" | Adam Pearson |
| **Deformity** | 0.5-1.0 | 0.01% | "No Go Zone" - requires medical intervention | Quasimodo, severe burns |
| **Subhuman** | 1.25-1.75 | 0.1% | "Very Unattractive" - danger zone, genetic outliers | Sloth (Goonies) |
| **Incel** | 2.0-3.0 | 2.5% | "Involuntary Celibate" - money/status can't compensate | Danny DeVito (4'10"), Chris Farley |
| **LTN** | 3.5-4.5 | 13.59% | "Invisible Majority" - not ugly enough to be pitied, not attractive enough to be noticed | Michael Cera (5'9"), Mark Zuckerberg |
| **MTN** | 4.75-5.25 | 68.26% | "Human equivalent of plain yogurt" - invisible but not repulsive | Joseph Gordon-Levitt, Josh Hutcherson |
| **HTN** | 5.5-6.5 | 13.59% | "The Switch Flip" - become visible to women. Halo Effect unlocks | Ryan Gosling (6'0"), Tom Hardy |
| **Chadlite** | 7.0-8.0 | 2.5% | "Looks Become Subjective" - best looking guy in school/gym | Cristiano Ronaldo (6'1"), Zac Efron (5'8") |
| **Chad** | 8.25-8.75 | 0.1% | "Life on Easy Mode" - best looking in state | Henry Cavill (6'0.5"), Brad Pitt |
| **Gigachad** | 9.0-9.5 | 0.01% | "Near mythical status" | Sean O'Pry (6'0"), Dolph Lundgren |
| **True Mogger** | 9.5+ | Apex | "Unmoggable" | Theoretical |

### 2.8 Height Score Lookup (Western Male)

```python
HEIGHT_SCORES = {
    "< 5'3\"": 1.0,    # Deformity/Subhuman range
    "5'3\" - 5'4\"": 2.0,
    "5'5\" - 5'7\"": 3.5,    # Incel/LTN range
    "5'8\"": 4.5,
    "5'9\" - 5'10\"": 5.5,   # MTN (Average Western Male ~5'9.5")
    "5'11\"": 6.5,
    "5'11.5\" - 6'0.5\"": 7.5,  # HTN range
    "6'1\" - 6'2.5\"": 8.5,  # Chad/Chadlite "Sweet Spot"
    "6'3\" - 6'4\"": 8.0,    # Gigachad territory
    "> 6'4\"": 7.5,    # Diminishing returns
}
```

### 2.9 Physique Score Criteria

```python
PHYSIQUE_SCORES = {
    "deformity_subhuman": {
        "range": "0.5-1.75",
        "criteria": ["morbidly_obese", "untreated_natural", "severe_skeletal_issues"]
    },
    "incel": {
        "range": "2.0-3.0",
        "criteria": ["skinny_fat", "poor_frame", "bad_insertions"]
    },
    "ltn": {
        "range": "3.5-4.5",
        "criteria": ["soft", "no_muscle_definition", "poor_posture"]
    },
    "mtn": {
        "range": "4.75-5.25",
        "criteria": ["average_frame", "barely_trained_natural"]
    },
    "htn": {
        "range": "5.5-6.5",
        "criteria": ["good_frame", "decent_insertions", "trained_natural", "model_physique"]
    },
    "chadlite": {
        "range": "7.0-8.0",
        "criteria": ["great_frame", "high_ffmi", "aesthetic", "sub_12_bf"]
    },
    "chad_gigachad": {
        "range": "8.25-9.5",
        "criteria": ["perfect_frame", "elite_ffmi", "genetic_outlier_or_enhanced", "sub_10_bf"]
    }
}
```

### 2.10 Face Score Criteria

```python
FACE_SCORES = {
    "subhuman_incel": {
        "range": "1.0-3.0",
        "criteria": ["severe_asymmetry", "weak_chin", "bug_eyes", "poor_skin_health"]
    },
    "mtn": {
        "range": "4.75-5.25",
        "criteria": ["average_harmony", "lack_of_definition", "no_standout_features"]
    },
    "htn": {
        "range": "5.5-6.5",
        "criteria": ["good_harmony", "some_definition", "minor_failos_only"]
    },
    "chadlite": {
        "range": "7.0-8.0",
        "criteria": ["strong_features", "clear_skin", "positive_canthal_tilt", "defined_jaw"]
    },
    "chad_gigachad": {
        "range": "8.25-9.5",
        "criteria": ["ideally_masculine_dimorphism", "hollow_cheeks", "hunter_eyes", "heavy_brow_ridge"]
    }
}
```

### 2.11 Transformation Potential

```python
TRANSFORMATION_RULES = {
    "max_natural_improvement": 4.0,  # Most men can improve ~4 points naturally
    "diminishing_returns": "Harder to go Chad→Gigachad than Subhuman→Normie",
    "purpose": "Identify specific Failos to fix to unlock next tier",
    "examples": [
        {"failo": "protruding_ears", "fix": "otoplasty", "tier_unlock": "+0.5-1.0"},
        {"failo": "receding_chin", "fix": "genioplasty", "tier_unlock": "+1.0-2.0"},
        {"failo": "weak_jaw", "fix": "jaw_fillers", "tier_unlock": "+0.5-1.0"},
    ]
}
```

---

## Phase 3: Archetype Classification System

### 3.1 Complete Archetype Taxonomy

```python
ARCHETYPES = {
    # SOFTBOY CATEGORY - Youthful, delicate, neotenous features
    "Softboy": {
        "description": "Youthful, delicate features with neotenous appeal",
        "sub_archetypes": ["K-POP Idol", "Softboy", "Academic"],
        "criteria": {
            "gonial_angle": ">= 125°",
            "eye_area": ">= 7.5",
            "facial_harmony": ">= 70%",
            "dimorphism": "low_to_moderate"
        }
    },

    # PRETTYBOY CATEGORY - Symmetrical, harmonious, effortless cool
    "Prettyboy": {
        "description": "Effortlessly attractive with perfect harmony",
        "sub_archetypes": ["Skater", "Prettyboy", "Surfer"],
        "criteria": {
            "harmony_score": ">= 75%",
            "facial_symmetry": ">= 8.5",
            "positive_canthal_tilt": True,
            "clear_skin": ">= 8.0"
        }
    },

    # ROBUST PRETTYBOY - Pretty features with edge/intensity
    "Robust_Prettyboy": {
        "description": "Pretty boy features with masculine edge or intensity",
        "sub_archetypes": ["Fallen Angel", "Prince", "Bad Boy", "Artist"],
        "criteria": {
            "harmony_score": ">= 70%",
            "eye_intensity": ">= 7.5",
            "gonial_angle": "115-125°",
            "hunter_eyes": True
        }
    },

    # CHAD CATEGORY - Strong masculine features, high dimorphism
    "Chad": {
        "description": "Strong masculine features with high sexual dimorphism",
        "sub_archetypes": ["Vampire", "Superman", "Jock", "Casanova", "Executive", "Pharaoh"],
        "criteria": {
            "gonial_angle": "<= 120°",
            "bigonial_width": ">= 7.5",
            "brow_ridge": "prominent",
            "dimorphism": "high",
            "physique_score": ">= 7.0"
        }
    },

    # HYPERMASCULINE - Extreme masculine features
    "Hypermasculine": {
        "description": "Extreme masculine features, rugged and powerful",
        "sub_archetypes": ["Aquaman", "Hypermasculine", "Outlaw", "Countryman"],
        "criteria": {
            "gonial_angle": "<= 115°",
            "brow_ridge": "very_prominent",
            "height": ">= 6'1\"",
            "physique": ">= 8.0"
        }
    },

    # OGRE - Maximum size and mass, intimidating presence
    "Ogre": {
        "description": "Maximum size and mass, intimidating physical presence",
        "sub_archetypes": ["Viking", "Bodybuilder"],
        "criteria": {
            "height": ">= 6'2\"",
            "physique": ">= 9.0",
            "frame_size": "very_large"
        }
    }
}
```

### 3.2 Complete Training Data for Classification

```python
ARCHETYPE_TRAINING_DATA = {
    # SOFTBOY CATEGORY
    "K-POP Idol": {
        "genetic_precursors": {
            "ethnicity": ["East Asian", "SE Asian"],
            "dimorphism": "low",
            "body_type": "ectomorphic",
            "midface": "flat_or_soft"
        },
        "required_styling": {
            "hair": ["straight", "layered"],
            "facial_hair": "clean_shaven",
            "fit": "slim_tailored",
            "colors": "high_contrast"
        }
    },
    "Softboy": {
        "genetic_precursors": {
            "body_type": "ectomorphic",
            "dimorphism": "low",
            "height": "below_average"
        },
        "required_styling": {
            "hair": "long",
            "facial_hair": "clean_shaven",
            "colors": "light",
            "fit": "oversized"
        }
    },
    "Academic": {
        "genetic_precursors": {
            "body_type": "ectomorphic",
            "dimorphism": "low",
            "hair_texture": "good"
        },
        "required_styling": {
            "hair": "medium_long",
            "facial_hair": "clean_shaven",
            "accessories": "subtle",
            "grooming": "pristine"
        }
    },

    # PRETTYBOY CATEGORY
    "Skater": {
        "genetic_precursors": {
            "dimorphism": "low_balanced",
            "soft_features": "good",
            "skin_quality": "good",
            "body_type": "ectomorphic"
        },
        "required_styling": {
            "hair": "messy",
            "fit": "loose_thrift_streetwear",
            "facial_hair": "clean_shaven",
            "colors": "dark"
        }
    },
    "Prettyboy": {
        "genetic_precursors": {
            "dimorphism": "low_balanced",
            "soft_features": "good",
            "skin_quality": "good",
            "body_type": "ectomorphic"
        },
        "required_styling": {
            "hair": ["clean", "voluminous"],
            "facial_hair": "clean_shaven",
            "fit": ["slim", "oversized"],
            "grooming": "pristine"
        }
    },
    "Surfer": {
        "genetic_precursors": {
            "dimorphism": "balanced",
            "coloring": "light_hair_eyes_skin",
            "body_type": "ecto_mesomorphic",
            "soft_features": "good"
        },
        "required_styling": {
            "skin": "tanned",
            "hair": "long_tousled",
            "fit": "loose_casual"
        }
    },

    # ROBUST PRETTYBOY CATEGORY
    "Fallen Angel": {
        "genetic_precursors": {
            "hair_texture": "good",
            "body_type": "ecto_mesomorphic",
            "soft_features": "good",
            "dimorphism": "balanced"
        },
        "required_styling": {
            "hair": "long_tousled",
            "facial_hair": "clean_shaven",
            "colors": "high_contrast"
        }
    },
    "Prince": {
        "genetic_precursors": {
            "hair_texture": "good",
            "body_type": "ecto_mesomorphic",
            "soft_features": "good",
            "dimorphism": "balanced_above_average"
        },
        "required_styling": {
            "hair": "long_structured",
            "fit": "old_money",
            "grooming": "pristine"
        }
    },
    "Bad Boy": {
        "genetic_precursors": {
            "coloring": "dark_hair_features",
            "dimorphism": "balanced_above_average",
            "body_type": "ecto_mesomorphic"
        },
        "required_styling": {
            "colors": "dark_high_contrast",
            "jacket": "leather",
            "facial_hair": ["clean_shaven", "light_stubble"],
            "hair": "tousled"
        }
    },
    "Artist": {
        "genetic_precursors": {
            "ethnicity": "African",
            "dimorphism": "balanced",
            "body_type": "ecto_mesomorphic"
        },
        "required_styling": {
            "fit": "layered",
            "hair": ["medium_long_braided", "dreadlocks"],
            "accessories": "jewelry",
            "tattoos": True
        }
    },

    # CHAD CATEGORY
    "Vampire": {
        "genetic_precursors": {
            "skin": "pale_light_baseline",
            "bone_structure": "angular",
            "facial_contrast": "high",
            "coloring": "dark_hair_features",
            "body_type": "ecto_mesomorphic"
        },
        "required_styling": {
            "colors": "dark",
            "fit": ["tailored", "suits"],
            "hair": "tousled",
            "facial_hair": "clean_shaven"
        }
    },
    "Superman": {
        "genetic_precursors": {
            "skin": "light_baseline",
            "dimorphism": "high",
            "facial_contrast": "high",
            "coloring": "dark_hair_features",
            "body_type": "mesomorphic"
        },
        "required_styling": {
            "fit": "tight_structured",
            "hair": "clean",
            "colors": "understated",
            "facial_hair": "clean_shaven"
        }
    },
    "Casanova": {
        "genetic_precursors": {
            "ethnicity": "Mediterranean",
            "skin": "olive_tanned",
            "dimorphism": "balanced",
            "body_type": "ecto_mesomorphic"
        },
        "required_styling": {
            "hair": "medium_long",
            "colors": "dark_relaxed_understated",
            "facial_hair": ["light_stubble", "heavy_stubble"]
        }
    },
    "Executive": {
        "genetic_precursors": {
            "skin_quality": "great",
            "dimorphism": "balanced_high",
            "body_type": "ecto_mesomorphic"
        },
        "required_styling": {
            "fit": ["suits", "structured"],
            "hair": ["slicked", "clean"],
            "facial_hair": ["clean_shaven", "light_stubble"]
        }
    },
    "Pharaoh": {
        "genetic_precursors": {
            "ethnicity": "Middle Eastern",
            "skin_quality": "great",
            "dimorphism": "balanced_high",
            "soft_features": "good"
        },
        "required_styling": {
            "grooming": "pristine",
            "hair": "short",
            "facial_hair": ["light_stubble", "beard"]
        }
    },
    "Jock": {
        "genetic_precursors": {
            "skin": "light_baseline",
            "coloring": "light_hair_eyes",
            "dimorphism": "high",
            "body_type": "mesomorphic"
        },
        "required_styling": {
            "fit": "tight_structured",
            "hair": "clean",
            "style": "athletic",
            "facial_hair": "clean_shaven"
        }
    },

    # HYPERMASCULINE CATEGORY
    "Hypermasculine": {
        "genetic_precursors": {
            "frame": "large",
            "body_type": "meso_endomorphic",
            "dimorphism": "very_high",
            "androgen_markers": "high",
            "lower_third": "strong"
        },
        "required_styling": {
            "hair": ["buzzcut", "short"],
            "fit": "tight_fitted",
            "tattoos": "optional"
        }
    },
    "Aquaman": {
        "genetic_precursors": {
            "frame": "large",
            "body_type": "endo_mesomorphic",
            "dimorphism": "high",
            "coloring": "dark_hair_features",
            "ethnicity": "Pacific Islander"
        },
        "required_styling": {
            "hair": "long",
            "facial_hair": ["heavy_stubble", "beard"],
            "tattoos": "traditional",
            "fit": ["loose", "tight_fitted"]
        }
    },
    "Outlaw": {
        "genetic_precursors": {
            "frame": "large",
            "body_type": "ecto_mesomorphic",
            "dimorphism": "balanced",
            "skin": "light_baseline",
            "height": "tall"
        },
        "required_styling": {
            "hair": ["bleached", "long"],
            "facial_hair": "clean_shaven",
            "style": "grunge",
            "accessories": "jewelry",
            "tattoos": True
        }
    },
    "Countryman": {
        "genetic_precursors": {
            "ethnicity": "European",
            "frame": "large",
            "body_type": "mesomorphic",
            "dimorphism": "balanced"
        },
        "required_styling": {
            "style": "rugged",
            "facial_hair": ["stubble", "beard"],
            "clothing": ["boots", "denim", "tanks"],
            "accessories": "jewelry"
        }
    },

    # OGRE CATEGORY
    "Viking": {
        "genetic_precursors": {
            "frame": "very_large",
            "dimorphism": "high",
            "body_type": "endo_mesomorphic",
            "size_acquisition": "efficient",
            "skin": "light_baseline"
        },
        "required_styling": {
            "hair": ["very_short", "long"],
            "facial_hair": ["heavy_beard", "long_stubble"],
            "tattoos": "optional"
        }
    },
    "Bodybuilder": {
        "genetic_precursors": {
            "frame": "very_large",
            "dimorphism": "high",
            "body_type": "endo_mesomorphic",
            "size_acquisition": "efficient"
        },
        "required_styling": {
            "fit": "tight_fitted",
            "tattoos": "optional"
        }
    }
}
```

### 3.3 Body Type Classification

```python
BODY_TYPES = {
    "ectomorphic": {"shoulder_waist_ratio": "< 1.35"},
    "mesomorphic": {"shoulder_waist_ratio": "1.35-1.50"},
    "endomorphic": {"shoulder_waist_ratio": "> 1.50 or high bf%"},
    "ecto_mesomorphic": {"shoulder_waist_ratio": "1.40-1.55"},
    "endo_mesomorphic": {"shoulder_waist_ratio": "> 1.50 with high muscle"},
    "meso_endomorphic": {"shoulder_waist_ratio": "> 1.45 with moderate bf%"}
}

def classify_body_type(body_metrics: dict) -> str:
    sw_ratio = body_metrics.get("shoulder_waist_ratio", 1.4)
    bf_percent = body_metrics.get("body_fat_percent", 15)
    muscle_mass = body_metrics.get("muscularity_score", 5)

    if sw_ratio < 1.35 and bf_percent < 15:
        return "ectomorphic"
    elif sw_ratio >= 1.50 and muscle_mass >= 8 and bf_percent < 12:
        return "endo_mesomorphic"
    elif sw_ratio >= 1.45 and muscle_mass >= 7:
        return "meso_endomorphic"
    elif sw_ratio >= 1.40 and muscle_mass >= 6 and bf_percent < 15:
        return "ecto_mesomorphic"
    elif sw_ratio >= 1.35 and bf_percent < 18:
        return "mesomorphic"
    else:
        return "endomorphic"
```

### 3.4 Dimorphism Classification

```python
DIMORPHISM_LEVELS = {
    "low": {"gonial_angle": ">= 130°"},
    "low_balanced": {"gonial_angle": "125-130°"},
    "balanced": {"gonial_angle": "118-125°"},
    "balanced_above_average": {"gonial_angle": "115-120°"},
    "high": {"gonial_angle": "110-118°"},
    "very_high": {"gonial_angle": "< 110°"}
}
```

---

## Phase 4: LLM Coach (Claude)

### Backend Service

**New file:** `/Users/imorgado/LOOKSMAXX/looksmaxx-api/app/services/llm_coach.py`

```python
class LLMCoachService:
    def __init__(self):
        self.client = anthropic.Anthropic()
        self.archetype_classifier = ArchetypeClassifier()

    async def analyze_and_coach(self, context: CoachContext) -> CoachResult:
        return CoachResult(
            archetype=self.archetype_classifier.classify(context.face_metrics),
            hairstyle_recs=await self._get_hairstyle_recs(context),
            skincare_routine=await self._get_skincare(context),
            action_plan=await self._get_action_plan(context)
        )
```

### Context Object

```python
@dataclass
class CoachContext:
    # From existing analysis
    harmony_score: float
    face_metrics: dict
    strengths: List[str]
    flaws: List[str]
    face_shape_detected: str

    # From body analysis
    body_metrics: dict
    muscularity_level: str
    leanness_level: str

    # From minimal questionnaire
    height_cm: int
    goals: List[str]
    timeline: str
    hair_color: str

    # Computed
    archetype: ArchetypeResult
```

### API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/coach/analyze` | POST | Full analysis (archetype + recommendations) |
| `/coach/hairstyle` | GET | Hairstyle recommendations |
| `/coach/skincare` | GET | Skincare routine |
| `/coach/action-plan` | GET | Personalized action plan |
| `/coach/chat` | POST | Chat message |
| `/coach/chat/stream` | POST | Streaming chat responses |

---

## Phase 5: Visual Mockups (Nano Banana)

### Technology

Use **Google Nano Banana (Gemini 2.5 Flash Image)** via Vertex AI:
- Best-in-class identity preservation
- Native hairstyle editing support
- 8x faster than alternatives
- Up to 4K output

### Backend Service

```python
class MockupGenerator:
    async def generate_hairstyle(user_photo, hairstyle_prompt) -> MockupResult
    async def generate_archetype_visualization(user_photo, archetype) -> MockupResult
    async def generate_style_mockup(user_photo, style_category) -> MockupResult
    async def generate_transformation_preview(user_photo, procedures) -> MockupResult
```

### API Endpoints

| Endpoint | Method | Description |
|----------|--------|-------------|
| `/mockups/hairstyle` | POST | Generate hairstyle mockup |
| `/mockups/archetype` | POST | Generate archetype visualization |
| `/mockups/style` | POST | Generate outfit/style mockup |
| `/mockups/transformation` | POST | Generate before/after preview |

---

## Implementation Order

### Phase 1: Foundation + Profile Setup (Days 1-3)
- [ ] Create `UserProfile` model + migration
- [ ] Create `/profile/setup` endpoint (height, goals, timeline)
- [ ] Create profile setup page (minimal questionnaire)
- [ ] Update user flow navigation

### Phase 2: Claude Vision Feature Extraction (Days 4-6)
- [ ] Create `ClaudeVisionService` for face photo analysis
- [ ] Extract: skin clarity, skin tone, hairline quality, eye color, cheek hollowness
- [ ] Store extracted features in `UserProfile`
- [ ] Run auto-analysis after face photo upload

### Phase 3: PSL Scoring Engine (Days 7-10)
- [ ] Create `PSLScoringEngine` with base formula
- [ ] Implement bonus system (single, synergy, triple mogger)
- [ ] Implement Failo constraint logic
- [ ] Create Halo/Failo taxonomy classification
- [ ] Implement tier classification (Subhuman → Gigachad)

### Phase 4: Body Photo Analysis (Days 11-13)
- [ ] Add MediaPipe Pose to backend (body landmarks)
- [ ] Create body photo upload endpoint
- [ ] Integrate Claude Vision for muscularity/leanness
- [ ] Feed body score into PSL formula

### Phase 5: Archetype Classification (Days 14-16)
- [ ] Create `ArchetypeClassifier` service with rules
- [ ] Map existing metrics to archetype criteria
- [ ] Add Claude fallback for edge cases
- [ ] Store archetype results in UserProfile

### Phase 6: LLM Coach Service (Days 17-21)
- [ ] Create `LLMCoachService` with Claude integration
- [ ] Implement hairstyle recommendations
- [ ] Implement skincare routine
- [ ] Create action plan generator
- [ ] Build streaming chat endpoint

### Phase 7: Coach UI (Days 22-26)
- [ ] Create CoachTab component
- [ ] Build PSL score display with tier badge
- [ ] Build archetype display card
- [ ] Create hairstyle carousel
- [ ] Implement chat interface

### Phase 8: Nano Banana Mockups (Days 27-31)
- [ ] Integrate Nano Banana API (Vertex AI)
- [ ] Implement hairstyle mockup generation
- [ ] Create MockupViewer with before/after slider
- [ ] Add "Try This Look" functionality

### Phase 9: Polish & Integration (Days 32-35)
- [ ] Connect all components end-to-end
- [ ] Add caching for expensive LLM calls
- [ ] Error handling and fallbacks
- [ ] End-to-end testing with celebrity ground truth

---

## Cost Estimates

| Service | Cost | Volume |
|---------|------|--------|
| Claude 3.5 Sonnet | ~$0.01/analysis | Per coach session |
| Nano Banana | ~$0.02/image | Per mockup |
| MediaPipe Pose | Free | Client-side processing |
| S3 Storage | ~$0.02/GB | Mockup storage |

**Estimated monthly cost for 1000 active users:** $100-200

---

## Summary

This plan achieves **minimal user friction** with **comprehensive PSL scoring**:

### Data Collection (Minimal Friction)
1. **User provides only:** Height, goals, timeline (3 questions)
2. **Auto-derived from face photo:** 70+ landmark metrics + Claude Vision
3. **Auto-derived from body photo:** MediaPipe Pose + Claude Vision

### Scoring System (Comprehensive)
1. **PSL Formula:** Face (75%) + Height (20%) + Body (5%)
2. **Bonus System:** Single category, synergy, and "True Mogger" bonuses
3. **Failo Rules:** Dominance rule, body penalty, height gatekeeper
4. **Tier Classification:** Subhuman → Gigachad (11 tiers with percentiles)

### AI Coach Features
1. **Archetype Classification:** 6 categories, 20 sub-archetypes (rule-based + Claude fallback)
2. **Personalized Recommendations:** Hairstyle, skincare, action plan based on flaws
3. **Visual Mockups:** Nano Banana for hairstyle try-on with identity preservation
4. **Chat Interface:** Ask questions about their score and recommendations

### Celebrity Ground Truth
Validation against known celebrity ratings (Josh Hutcherson, Zac Efron, Henry Cavill, etc.)
