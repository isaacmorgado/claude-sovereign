/**
 * Automation Templates
 *
 * Pre-defined automation configurations that users can use as starting points.
 * These templates cover common development workflows.
 */

export interface AutomationTemplate {
	id: string
	name: string
	description: string
	category: "testing" | "linting" | "git" | "review" | "custom"
	yamlConfig: string
}

/**
 * Auto Test Runner - Runs tests when test files are saved
 */
export const autoTestRunner: AutomationTemplate = {
	id: "auto-test-runner",
	name: "Auto Test Runner",
	description: "Automatically run tests when test files are saved",
	category: "testing",
	yamlConfig: `  - id: auto-test-runner
    name: Auto Test Runner
    description: Run tests when test files change
    enabled: true
    trigger:
      type: file_watcher
      patterns:
        - "**/*.test.ts"
        - "**/*.test.tsx"
        - "**/*.spec.ts"
        - "**/*.spec.tsx"
        - "**/*.test.js"
        - "**/*.spec.js"
      events: [save]
      debounceMs: 1000
    action:
      mode: code
      prompt: |
        Run the tests for the changed file: {{triggerFile}}

        1. Identify the test framework being used
        2. Run only the affected tests
        3. Report any failures with clear explanations
        4. Suggest fixes if tests fail
      autoApprove: true`,
}

/**
 * Lint on Save - Runs linter when files are saved
 */
export const lintOnSave: AutomationTemplate = {
	id: "lint-on-save",
	name: "Lint on Save",
	description: "Automatically run linter when source files are saved",
	category: "linting",
	yamlConfig: `  - id: lint-on-save
    name: Lint on Save
    description: Run linter when source files change
    enabled: true
    trigger:
      type: file_watcher
      patterns:
        - "src/**/*.ts"
        - "src/**/*.tsx"
        - "src/**/*.js"
        - "src/**/*.jsx"
      events: [save]
      debounceMs: 500
    action:
      mode: code
      prompt: |
        Run the linter on {{triggerFile}} and fix any issues.

        1. Detect the linting tool (ESLint, Biome, etc.)
        2. Run lint with auto-fix if available
        3. Report remaining issues that need manual attention
      autoApprove: true`,
}

/**
 * Pre-commit Check - Validates staged changes before commit
 */
export const preCommitCheck: AutomationTemplate = {
	id: "pre-commit-check",
	name: "Pre-commit Check",
	description: "Validate staged changes before committing",
	category: "git",
	yamlConfig: `  - id: pre-commit-check
    name: Pre-commit Check
    description: Validate code before commit
    enabled: true
    trigger:
      type: git_hook
      hook: pre-commit
    action:
      mode: code
      prompt: |
        Review the staged changes for this commit:

        1. Check for any obvious bugs or issues
        2. Verify code follows project conventions
        3. Ensure no sensitive data (API keys, passwords) is being committed
        4. Run type checking if TypeScript
        5. Run linting checks

        If issues are found, reject the commit with clear explanations.
      autoApprove: false`,
}

/**
 * Daily Code Review - Scheduled review of recent changes
 */
export const dailyReview: AutomationTemplate = {
	id: "daily-review",
	name: "Daily Code Review",
	description: "Scheduled review of code changes from the past 24 hours",
	category: "review",
	yamlConfig: `  - id: daily-review
    name: Daily Code Review
    description: Review code changes from the past 24 hours
    enabled: true
    trigger:
      type: cron
      schedule: "0 9 * * 1-5"  # 9 AM on weekdays
    action:
      mode: architect
      prompt: |
        Perform a code review of changes from the past 24 hours:

        1. Use git log to find recent commits
        2. Review each commit for:
           - Code quality and best practices
           - Potential bugs or issues
           - Missing tests
           - Documentation updates needed
        3. Create a summary report with recommendations
        4. Prioritize issues by severity
      autoApprove: false`,
}

/**
 * Build Watcher - Rebuilds when source files change
 */
export const buildWatcher: AutomationTemplate = {
	id: "build-watcher",
	name: "Build Watcher",
	description: "Automatically rebuild when source files change",
	category: "custom",
	yamlConfig: `  - id: build-watcher
    name: Build Watcher
    description: Rebuild project when source files change
    enabled: true
    trigger:
      type: file_watcher
      patterns:
        - "src/**/*.ts"
        - "src/**/*.tsx"
      events: [save]
      debounceMs: 2000
    action:
      mode: code
      prompt: |
        The source file {{triggerFile}} was modified.

        1. Run the project build command
        2. Report any compilation errors
        3. If build succeeds, confirm completion
      autoApprove: true`,
}

/**
 * Documentation Generator - Updates docs when code changes
 */
export const docGenerator: AutomationTemplate = {
	id: "doc-generator",
	name: "Documentation Generator",
	description: "Update documentation when code changes",
	category: "custom",
	yamlConfig: `  - id: doc-generator
    name: Documentation Generator
    description: Update documentation for changed files
    enabled: true
    trigger:
      type: file_watcher
      patterns:
        - "src/**/*.ts"
        - "src/**/*.tsx"
      events: [save]
      debounceMs: 3000
    action:
      mode: code
      prompt: |
        The file {{triggerFile}} was modified.

        1. Check if the file has JSDoc comments
        2. If exports are added or changed, update or add documentation
        3. Ensure all public APIs are documented
        4. Update any related README or docs files if needed
      autoApprove: false`,
}

/**
 * Type Check on Save - Runs TypeScript type checking
 */
export const typeCheckOnSave: AutomationTemplate = {
	id: "type-check-on-save",
	name: "Type Check on Save",
	description: "Run TypeScript type checking when files are saved",
	category: "linting",
	yamlConfig: `  - id: type-check-on-save
    name: Type Check on Save
    description: Run TypeScript type checking when TS files change
    enabled: true
    trigger:
      type: file_watcher
      patterns:
        - "**/*.ts"
        - "**/*.tsx"
      events: [save]
      debounceMs: 1000
    action:
      mode: code
      prompt: |
        Run TypeScript type checking on the project:

        1. Run tsc --noEmit to check for type errors
        2. If errors are found, explain each error clearly
        3. Suggest fixes for type errors
        4. Focus on errors related to {{triggerFile}}
      autoApprove: true`,
}

/**
 * Commit Message Generator - Generates commit messages
 */
export const commitMessageGenerator: AutomationTemplate = {
	id: "commit-message-generator",
	name: "Commit Message Generator",
	description: "Generate commit messages based on staged changes",
	category: "git",
	yamlConfig: `  - id: commit-message-generator
    name: Commit Message Generator
    description: Generate commit messages for staged changes
    enabled: true
    trigger:
      type: git_hook
      hook: prepare-commit-msg
    action:
      mode: code
      prompt: |
        Generate a commit message for the staged changes:

        1. Analyze git diff --staged
        2. Create a concise, descriptive commit message
        3. Follow conventional commits format (feat:, fix:, docs:, etc.)
        4. Include scope if applicable
        5. Add body with details if changes are complex
      autoApprove: false`,
}

/**
 * All available templates
 */
export const automationTemplates: AutomationTemplate[] = [
	autoTestRunner,
	lintOnSave,
	preCommitCheck,
	dailyReview,
	buildWatcher,
	docGenerator,
	typeCheckOnSave,
	commitMessageGenerator,
]

/**
 * Get template by ID
 */
export function getTemplateById(id: string): AutomationTemplate | undefined {
	return automationTemplates.find((t) => t.id === id)
}

/**
 * Get templates by category
 */
export function getTemplatesByCategory(category: AutomationTemplate["category"]): AutomationTemplate[] {
	return automationTemplates.filter((t) => t.category === category)
}

/**
 * Generate a complete automation config YAML with selected templates
 */
export function generateAutomationConfig(templateIds: string[]): string {
	const selectedTemplates = templateIds
		.map((id) => getTemplateById(id))
		.filter((t): t is AutomationTemplate => t !== undefined)

	const automationsYaml = selectedTemplates.map((t) => t.yamlConfig).join("\n\n")

	return `version: "1.0"
automations:
${automationsYaml}
`
}
