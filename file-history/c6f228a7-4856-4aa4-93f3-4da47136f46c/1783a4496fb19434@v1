/**
 * Sets up click listeners for long/short chapter title tabs
 */
function set_chapter_title_desc_long_short_tab_listener() {
    const ACTIVE_TAB_CLASS = 'bg-shorts-400 border-shorts-400 text-shorts-100 w-1/2 border px-4 py-1 text-xs font-medium outline-none';
    const INACTIVE_TAB_CLASS = 'hover:bg-shorts-500 active:bg-shorts-400 w-1/2 border-none bg-transparent px-4 py-1 text-xs font-medium outline-none transition-colors duration-100';

    // Long tab click handler
    $('#chapters-show-long').on('click', function() {
        $('#chapters-show-long').attr('class', ACTIVE_TAB_CLASS);
        $('#chapters-show-short').attr('class', INACTIVE_TAB_CLASS);
        $('#chapters-titles-descriptions-long').removeClass('hidden');
        $('#chapters-titles-descriptions-short').addClass('hidden');
    });

    // Short tab click handler
    $('#chapters-show-short').on('click', function() {
        $('#chapters-show-short').attr('class', ACTIVE_TAB_CLASS);
        $('#chapters-show-long').attr('class', INACTIVE_TAB_CLASS);
        $('#chapters-titles-descriptions-long').addClass('hidden');
        $('#chapters-titles-descriptions-short').removeClass('hidden');
    });
}

/**
 * Sets up click listeners for copy title/description buttons
 */
function set_copy_title_desc_listeners() {
    $('[data-copy-id]').on('click', function() {
        const copyId = $(this).data('copy-id');
        const content = $('#' + copyId).html();
        copy_to_clipboard(content);
    });
}

/**
 * Sets up click listeners for chapter delete buttons
 */
function set_chapter_delete_listeners() {
    $('.button-chapter-delete').on('click', function() {
        const chapterNumber = parseInt($(this).parent().parent().attr('chapter-number'));
        chapter_markers_delete_chapter(chapterNumber);
    });
}

/**
 * Sets up click listener for clearing chapter results
 */
function set_chapter_clear_results_listener() {
    $('#chapters-clear-results-button').on('click', function(event) {
        set_double_range_listeners();
        $('#chapters-result').addClass('hidden');
        $('#chapters-start').removeClass('hidden');
    });
}

/**
 * Sets up click listeners for chapter clip selection grid
 */
function set_chapter_clip_selection_listeners() {
    $('.chapters-add-clips-selection-grid-element').on('click', function(event) {
        // Hide all selection indicators
        $('.chapters-add-clips-selection-grid-element div div').addClass('hidden');
        // Show selection indicator for clicked element
        $(this).find('div div').removeClass('hidden');
    });
}

/**
 * Sets up click listener for adding new chapters
 */
function set_chapter_add_listeners() {
    $('#button-chapter-add').on('click', function() {
        chapter_markers_add_chapter();
    });
}

/**
 * Sets up input and reset listeners for the chapters count slider
 */
function set_chapters_count_slider_listeners() {
    set_double_range_listeners();

    const rangeElement = $('#range-chapters-count');

    // Initialize slider values from data attributes
    if (rangeElement.length) {
        const minValue = parseInt(rangeElement.attr('data-min'));
        const maxValue = parseInt(rangeElement.attr('data-max'));
        rangeElement.attr('data-value-min', String(minValue));
        rangeElement.attr('data-value-max', String(maxValue));
    }

    // Input handler - update display text based on selected range
    $('#range-chapters-count').off('input');
    $('#range-chapters-count').on('input', function() {
        const slider = $('#range-chapters-count');
        const minBound = parseInt(slider.attr('data-min'));
        const maxBound = parseInt(slider.attr('data-max'));
        const currentMin = parseInt(slider.attr('data-value-min'));
        const currentMax = parseInt(slider.attr('data-value-max'));

        const isAtMinBound = currentMin === minBound;
        const isAtMaxBound = currentMax === maxBound;

        let displayText = 'Auto';

        if (!isAtMinBound && isAtMaxBound) {
            displayText = currentMin + '+';
        } else if (isAtMinBound && !isAtMaxBound) {
            displayText = 'up to ' + currentMax;
        } else if (!isAtMinBound && !isAtMaxBound) {
            displayText = currentMin + '-' + currentMax;
        }

        $('#value-chapters-count').text(displayText);
    });

    // Reset button handler
    $('#reset-chapters-count').off('click');
    $('#reset-chapters-count').on('click', function() {
        const slider = $('#range-chapters-count');
        const minBound = parseInt(slider.attr('data-min'));
        const maxBound = parseInt(slider.attr('data-max'));

        slider.attr('data-value-min', String(minBound));
        slider.attr('data-value-max', String(maxBound));

        set_double_range_listeners();
        $('#range-chapters-count').trigger('input');
    });

    // Trigger initial input event to set display
    $('#range-chapters-count').trigger('input');
}

/**
 * Positions the colour picker selection circle based on current HSL values
 */
function place_colour_select_circle() {
    let containerWidth = $('#chapters-colour-select').width();
    let containerHeight = $('#chapters-colour-select').height();

    // Calculate default dimensions if container not visible
    if (containerWidth === 0) {
        containerWidth = $(window).width() - 48 - (2 * 48);
    }
    if (containerHeight === 0) {
        containerHeight = 160;
    }

    const circleRadius = 2 / 2;

    // Position circle based on hue (x-axis) and lightness (y-axis)
    $('#chapter-colour-select-circle').css({
        'left': (colour_picker_selection.hue / 360) * containerWidth - circleRadius,
        'top': ((100 - colour_picker_selection.lightness) / 100) * containerHeight - circleRadius
    });

    // Set circle background color to match selection
    $('#chapter-colour-select-circle').css({
        'background-color': 'hsl(' + colour_picker_selection.hue + ', 96%, ' + colour_picker_selection.lightness + '%)'
    });
}
