# SPLICE

AI-powered Premiere Pro UXP plugin for detecting takes, removing silences, and accelerating video editing workflows.

## Current Focus
**Auto-Cutting v3.3** - Take-Aware Unified Workflow

## Quick Reference

### Pricing Tiers
| Tier | Price | Hours | Stripe Price ID |
|------|-------|-------|-----------------|
| Starter | $19/mo | 15 hrs | price_1SgH4m2L5BseYEbCih347qfr |
| Pro | $49/mo | 50 hrs | price_1SgH4o2L5BseYEbCIoR19lhQ |
| Team | $149/mo | 150 hrs | price_1SgH4q2L5BseYEbCYTlimb5M |
| Overage | $1/hr | - | price_1SgH4y2L5BseYEbClZuxNRu8 |

### Key Constraints
- UXP requires Premiere Pro 25.6+
- Use `127.0.0.1` not `localhost` in fetch URLs
- Backend (prod): https://splice-api-production.up.railway.app

## Key Files

| File | Purpose |
|------|---------|
| `splice-backend/server.js` | Express + all endpoints + webhook handler |
| `splice-backend/services/usageTracking.js` | Credit balance, usage logging |
| `splice-plugin/js/credits.js` | Fetch/display credit balance |
| `splice-plugin/js/main.js` | Plugin initialization + workflows |
| `splice-plugin/index.html` | UI with credit badge in header |

## Implementation Phases

- Phase 1: Backend billing ✅
- Phase 2: Frontend credits ✅
- Phase 3: Preview Mode ✅
- Phase 4-6: Smart Filtering, Automation, Polish

## Last Session (2025-12-20)

**Phase 3.3 - Take-Aware Unified Workflow:**

Merged separate "Remove Silences" and "Detect Takes" into single "SPLICE" workflow that automatically protects speech segments.

**Architecture:**
```
Audio Timeline:
|----SILENCE----|---TAKE 1---|--SILENCE--|---TAKE 2---|--SILENCE--|

After Analysis:
|====RED====|---BLUE---|==YELLOW==|---BLUE---|====RED====|
  (remove)    (keep)   (protected)   (keep)     (remove)
```

**UI Changes:**
- Single "SPLICE" action card (removed separate "Detect Takes" card)
- Combined preview with color-coded markers:
  - Red = silences safe to remove
  - Blue = takes (speech segments)
  - Yellow = silences protected by takes (won't be removed)
- Settings modal: "Detect takes (protects speech)" checkbox
- Legend showing silence/take counts

**Core Functions:**
- `initUnifiedWorkflow()` - Single GO button triggers both detections
- `filterSilencesByTakes(silences, takes)` - Protects silences overlapping speech
- `showCombinedPreview(safe, protected, takes)` - Color-coded timeline view
- `Promise.all([detectSilences(), transcribeAudio()])` - Parallel detection

**Exported API (updated):**
- `window.splicePreviewState.getSelectedSilences()` - Returns safe silences only
- `window.splicePreviewState.getSelectedTakes()` - Returns detected takes
- `window.splicePreviewState.hasPreview()` - Check if preview is active

**Stopped at:** Phase 3.3 complete, plugin v3.3 ready

## Previous Session (2025-12-19)

**Phase 3.2 - Performance Optimizations & Takes Preview:**
- CSS performance (contain, will-change, 44px touch targets)
- JS performance (DOM caching, event delegation, DocumentFragment)
- Error handling (double-click protection, validation, race conditions)
- Keyboard shortcuts (Enter, Escape, Cmd+A/D/I)

## Next Steps
1. Virtual scrolling for 200+ silences
2. Add customer ID input in settings modal
3. Usage history display
4. Batch undo support

---
*Last updated: 2025-12-20*
