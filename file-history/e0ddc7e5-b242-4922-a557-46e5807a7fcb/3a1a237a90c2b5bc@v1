# Splice v3

Cloud-powered SaaS for Adobe Premiere Pro with AI-driven auto-cutting, take detection, and subscription billing.

## Monorepo Structure

```
/                         # Root
├── src/                  # Premiere Pro UXP Plugin
│   ├── components/
│   │   ├── panels/       # PluginApp (main container)
│   │   └── common/       # UI: Header, SelectionPanel, AIToolsPanel, AuthPanel, CuttingPanel
│   ├── types/            # TypeScript: plugin, api, premiere, audio, take-detection
│   ├── utils/
│   │   ├── api/          # premiere.ts, backend-client.ts, audio-processor.ts
│   │   └── helpers/      # formatters, validators
│   └── styles/           # Global CSS, Spectrum theming
│
├── backend/              # Node.js + Express API
│   └── src/
│       ├── routes/       # auth, billing, jobs, audio, usage
│       ├── controllers/  # Route handlers
│       ├── services/     # Business logic
│       ├── workers/      # BullMQ job processors (transcription, vocal isolation)
│       ├── db/           # migrations/, repositories/
│       └── middleware/   # auth, rate-limit, usage-limit
│
├── dashboard/            # Next.js Web Dashboard
│   └── app/              # login, signup, dashboard (usage, billing, settings)
│
├── tests/                # Vitest unit + Playwright e2e
└── public/               # manifest.json, icons
```

## Tech Stack

| Layer | Stack |
|-------|-------|
| Plugin | Lit 3.2 + Spectrum Web Components + TypeScript |
| Backend | Node.js + Express + PostgreSQL + BullMQ/Redis |
| Dashboard | Next.js + React |
| Audio | Whisper/Deepgram (transcription) + Demucs/Dolby (vocal isolation) |
| Payments | Stripe |

## Code Quality - Zero Tolerance

After editing ANY file, run:

```bash
npm run lint
npm run typecheck
```

Fix ALL errors/warnings before continuing.

## Organization Rules

- **Plugin components** → `src/components/`, one per file
- **Backend routes** → `backend/src/routes/`, one per resource
- **Types** → `src/types/` or `backend/src/types/`, grouped by domain
- **Tests** → `tests/unit/` and `tests/e2e/`

## UXP API Constraints

**Available:** `createSetNameAction`, `createInsertProjectItemAction`, `createRemoveItemsAction`, `createSetInPointAction/OutPointAction`, `ProjectItem.setColorLabel`

**NOT Available:** Razor/split (use remove+re-insert workaround), TrackItem colors (set on ProjectItem before insert), Audio waveforms (use FFmpeg externally)

## Pricing Tiers

| Plan | Price | Limit | Margin |
|------|-------|-------|--------|
| Free Trial | $0 | 10 min total | — |
| Pro | $29.99/mo | 300 min/mo | 85% |
| Enterprise | $69.99/mo | 500 min/mo | 82% |

## Current Focus
Section: Phase 1 - Backend & Authentication (auth complete, billing next)
Files: `backend/src/routes/`, `backend/src/services/`

## Last Session (2025-12-16)
- Completed full auth system: register, login, refresh, logout endpoints
- Created backend infrastructure: package.json, docker-compose.yml, TypeScript/ESLint configs
- Implemented JWT auth with Redis refresh token storage
- Database migration for users table with subscription tiers
- All lint/typecheck passing
- Stopped at: Auth complete, ready for Stripe billing integration

## Next Steps
1. Copy `.env.example` to `.env` and configure secrets
2. Run `docker-compose up -d` then execute migration SQL
3. Implement Stripe webhook handling (`backend/src/routes/billing-routes.ts`)
4. Create usage tracking middleware and endpoints
