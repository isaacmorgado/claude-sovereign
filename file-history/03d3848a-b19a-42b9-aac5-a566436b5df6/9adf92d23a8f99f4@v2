# LOOKSMAXX

A facial metrics analysis and visualization system with Next.js frontend and MediaPipe-based facial landmark detection. Now with FaceIQ-compatible scoring and results UI.

## Live URLs

- **Frontend**: https://looksmaxx-app.vercel.app
- **API**: https://api-production-6148.up.railway.app

## Tech Stack

- **Framework**: Next.js 14 (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **Animation**: Framer Motion
- **Face Detection**: MediaPipe Tasks Vision (client, 478 landmarks) + InsightFace (server, 106 landmarks)
- **Scoring**: FaceIQ-compatible exponential decay with 70+ measurements
- **Backend**: FastAPI on Railway with PostgreSQL
- **Email**: SendGrid for transactional emails
- **Frontend Hosting**: Vercel

## Code Quality

```bash
cd looksmaxx-app && npm run lint && npx tsc --noEmit
```

## Completed Features

### Username & T&C System (2025-12-23) ✅
Full implementation deployed and tested end-to-end:
- User registration with unique username (3-30 chars, alphanumeric + underscore)
- Terms & Conditions acceptance required for signup
- Leaderboard displays usernames instead of anonymous IDs
- Username availability check endpoint
- DB migrations applied on Railway

### FaceIQ Parity ✅
| Feature | File | Details |
|---------|------|---------|
| **All 66 Bezier Curves** | `looksmaxx-app/src/lib/faceiq-bezier-curves.ts` | Complete cubic Bezier interpolation |
| **30 Procedure Impact Tables** | `looksmaxx-app/src/lib/advice-engine.ts` | Quantitative % changes per metric |
| **Potential Score Prediction** | `looksmaxx-app/src/lib/recommendations/severity.ts` | `estimatePotentialPSL()` with diminishing returns |
| **Multi-Procedure Plans** | `looksmaxx-app/src/lib/recommendations/engine.ts` | `generateRecommendationPlan()` with 5-phase ordering |
| **Order of Operations** | `looksmaxx-app/src/lib/recommendations/engine.ts` | `generateOrderOfOperations()` with prerequisites |
| **16 Ethnicity Overrides** | `looksmaxx-app/src/lib/insights-engine.ts` | 8 male + 8 female with full scoring params |

### Female Analysis ✅
- 8 ethnicity overrides with distinct ideal ranges
- Sexual dimorphism (narrower jaws, softer angles, larger eyes)
- Female-specific treatments (V-line surgery, Masseter Botox)
- Gender filtering in recommendation engine

## Key Files

### Backend (`looksmaxx-api/`)
- `app/routers/auth.py` - Registration, login, password reset endpoints
- `app/routers/referrals.py` - Influencer referral code management
- `app/routers/leaderboard.py` - Leaderboard with usernames
- `app/services/email.py` - SendGrid email service (password reset, welcome emails)
- `app/models/user.py` - User model with username/terms fields
- `app/schemas/user.py` - Validation schemas

### Frontend (`looksmaxx-app/`)
- `src/app/signup/page.tsx` - Signup with username, T&C, referral code
- `src/app/terms/page.tsx` - Terms & Conditions page
- `src/app/login/page.tsx` - Email/password login
- `src/app/forgot-password/page.tsx` - Password reset request
- `src/app/reset-password/page.tsx` - Password reset form
- `src/lib/api.ts` - API client methods

## PostgreSQL Access (Debug)

```bash
export PATH="/opt/homebrew/opt/postgresql@16/bin:$PATH"
psql "postgresql://postgres:pCADzvPqsoWVWCozIwkjPybkTRUzwbZu@shortline.proxy.rlwy.net:10999/railway"
```

### Auth System (2025-12-23) ✅
- Email/password login (replaced Google OAuth)
- Forgot password flow with secure token
- SendGrid-powered password reset emails
- Password reset page with token validation
- Referral code field on signup with Stripe promotion code integration

### Referral System (2025-12-23) ✅
- Influencer referral codes stored in `referral_codes` table
- Linked to Stripe promotion codes for automatic discounts
- Validation endpoint for real-time code checking
- Usage tracking and analytics
- Admin endpoints for managing codes

### Infrastructure Fixes (2025-12-24) ✅
- Fixed Railway OOM crashes with lazy-loaded InsightFace model
- SendGrid integration for transactional emails

## Remaining Tasks

1. Create influencer referral codes via `/referrals/create` endpoint (requires Stripe promo code IDs)
2. Wire up welcome email on signup (`email_service.send_welcome_email` exists but not called)
3. Test full payment flow with referral discount applied
4. Debug blank results page issue
5. Implement supplement/product e-commerce layer (see `supplement_implementation.md`)
6. (Optional) Remove debug logging from `looksmaxx-api/app/routers/leaderboard.py`
7. (Optional) Clean up test users from database
