# SPLICE

AI-powered Premiere Pro UXP plugin for detecting takes, removing silences, and accelerating video editing workflows.

## Current Focus
**Auto-Cutting v3.5** - Direct DOM Reconstruction (Zero Manual Steps)

## Quick Reference

### Pricing Tiers
| Tier | Price | Hours | Isolation | Stripe Price ID |
|------|-------|-------|-----------|-----------------|
| Starter | $19/mo | 15 hrs | ❌ None | price_1SgH4m2L5BseYEbCih347qfr |
| Pro | $49/mo | 50 hrs | 45 min included | price_1SgH4o2L5BseYEbCIoR19lhQ |
| Team | $149/mo | 150 hrs | 3 hrs included | price_1SgH4q2L5BseYEbCYTlimb5M |
| Overage | $1/hr | - | $0.10/min | price_1SgH4y2L5BseYEbClZuxNRu8 |

### Isolation Pricing (v3.4)
- **Starter**: No access (upgrade required)
- **Pro**: 45 min included, then $0.10/min overage
- **Team**: 3 hrs included, then $0.10/min overage
- **Our cost**: $0.015/min → **85% margin on overage**
- **Worst-case margin**: 80%+ (sized to maintain margins at full utilization)

### Key Constraints
- UXP requires Premiere Pro 25.6+
- Use `127.0.0.1` not `localhost` in fetch URLs
- Backend (prod): https://splice-api-production.up.railway.app

## Key Files

| File | Purpose |
|------|---------|
| `splice-backend/server.js` | Express + all endpoints + webhook handler |
| `splice-backend/services/usageTracking.js` | Credit balance, usage logging |
| `splice-backend/services/cutListGenerator.js` | v3.5 JSON cut list generator |
| `splice-plugin/js/main.js` | Plugin initialization + workflows |
| `splice-plugin/js/builder.js` | v3.5 Direct DOM sequence builder |
| `splice-plugin/js/settings.js` | Settings + Persistent Token |
| `splice-plugin/js/credits.js` | Fetch/display credit balance |
| `splice-plugin/index.html` | UI with credit badge in header |

## Implementation Phases

- Phase 1: Backend billing ✅
- Phase 2: Frontend credits ✅
- Phase 3: Preview Mode ✅
- Phase 4: v3.5 Direct DOM Reconstruction ✅

## v3.5 Architecture (Implemented)

**Zero-manual-step workflow using UXP DOM APIs:**

1. Detect silences/takes (existing workflow)
2. Backend generates JSON cut list via `/cut-list` endpoint
3. Plugin builds sequence directly using `builder.js`
4. New sequence created with `_SPLICE` suffix

**Core UXP APIs:**
- `SequenceEditor.createInsertProjectItemAction()` - Insert clips at timecode
- `ProjectItem.createSetColorLabelAction(index)` - Color clips (set BEFORE insert)
- `TrackItem.createSetInPointAction/OutPointAction()` - Set in/out points
- `project.executeTransaction(actions)` - Batch execute atomically
- `fs.createPersistentToken(folder)` - Silent file access

**New Endpoints:**
- `POST /cut-list` - Generate JSON cut list from silences/takes
- `POST /cut-list/takes` - Generate cut list keeping only takes

**Key Functions:**
- `buildSequenceFromCutList(cutList)` - Build sequence from backend cut list
- `buildSequenceFromDetection(silences, takes, source)` - Direct build from detection
- `setupMediaFolder()` - Set up persistent token for media access
- `generateCutList(options)` - Backend cut list generation

**Legacy (Deprecated):**
- `splice-plugin/js/slice9-razor.js` - Old XML workflow (still available)
- `splice-backend/services/xmlProcessor.js` - Old XML processor

## Last Session (2025-12-21)

Fixed critical UXP API issues in v3.5 Direct DOM Reconstruction implementation.

**API Fixes Applied:**
- ❌ Replaced non-existent `SequenceFactory` with `sequence.createCloneAction()`
- ✅ Fixed TickTime usage - now using `TickTime.createWithTicks()` instead of raw numbers
- ✅ Fixed in/out point setting to use TickTime objects
- ✅ Added `clearSequence()` helper to clear cloned sequence content
- ✅ Fixed transaction execution to create actions inside callbacks (UXP requirement)
- ✅ Updated insert action to be created within executeTransaction

**Files Modified:**
- `splice-plugin/js/builder.js` - Fixed all UXP API calls for v3.5
- `splice-plugin/manifest.json` - Updated version to 3.5.0

**Status:** Ready for testing in Premiere Pro 25.6+

**Testing Blockers Resolved:**
All API mismatches fixed. Code should now execute without runtime errors.

## Previous Session (2025-12-20)

Implemented v3.5 Direct DOM Reconstruction architecture (zero manual steps).

**Files Created:**
- `splice-plugin/js/builder.js` - Direct DOM sequence builder
- `splice-backend/services/cutListGenerator.js` - JSON cut list generator

**Files Modified:**
- `server.js` - Added `/cut-list` endpoints
- `settings.js` - Added persistent token management
- `main.js` - Added v3.5 integration functions
- `index.html` - Added builder.js, media folder settings

## Next Steps

1. **IMMEDIATE**: Test v3.5 workflow end-to-end in Premiere Pro 25.6+
2. Add "Build New Sequence" button to UI for direct access
3. Wire detection workflow to builder for seamless UX

---
*Last updated: 2025-12-21*
