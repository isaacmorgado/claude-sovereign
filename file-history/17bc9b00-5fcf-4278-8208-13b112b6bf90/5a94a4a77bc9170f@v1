# SPLICE v3.5 Testing Guide

## What Was Fixed

All critical UXP API issues have been resolved:

### API Corrections Made:
1. **Sequence Creation**: Replaced non-existent `SequenceFactory.createSequence()` with `sequence.createCloneAction()`
2. **TickTime Objects**: Fixed all time conversions to use `TickTime.createWithTicks()` instead of raw numbers
3. **Action Execution**: Moved action creation inside `executeTransaction()` callbacks (UXP requirement)
4. **Sequence Clearing**: Added `clearSequence()` helper to remove clips from cloned sequence
5. **In/Out Points**: Fixed to use TickTime objects for `createSetInPointAction()`

## Prerequisites

- **Premiere Pro 25.6+** (UXP support required)
- Backend server running locally or accessible at production URL
- Sample video file in a Premiere Pro project

## Testing Steps

### 1. Start Backend Server

```bash
cd splice-backend
npm install  # If not already installed
node server.js
```

Expected output:
```
[SPLICE] Server running on https://127.0.0.1:3847
```

### 2. Load Plugin in Premiere Pro

1. Open Premiere Pro 25.6 or later
2. Go to **Window > Extensions (UXP) > SPLICE**
3. The plugin panel should load and display the UI

### 3. Test Detection Workflow (Existing)

1. Create a new project and sequence
2. Import a video clip with speech and silences
3. Place the clip on the timeline
4. In SPLICE panel, click **GO**
5. Verify:
   - Audio export completes
   - Silence detection runs
   - Preview shows detected silences

### 4. Test v3.5 Sequence Builder (New)

Currently there are two ways to test the builder:

#### Option A: Via Browser Console (Quick Test)

1. Open the UXP Developer Tool for SPLICE
2. In the console, run:

```javascript
// Assuming you have silences detected and in preview
const silences = [
  { start: 5.0, end: 8.0, duration: 3.0 },
  { start: 15.0, end: 18.0, duration: 3.0 }
];

const takes = [
  { start: 0, end: 5.0, text: "First take", isBest: true },
  { start: 8.0, end: 15.0, text: "Second take", isBest: false },
  { start: 18.0, end: 25.0, text: "Third take", isBest: false }
];

// Call the builder function
buildSequenceV35(silences, takes)
  .then(result => console.log('Build result:', result))
  .catch(err => console.error('Build failed:', err));
```

#### Option B: Via Backend Cut List (Full Workflow)

1. After detection completes, call the backend:

```javascript
// In UXP console
buildSequenceWithCutList()
  .then(result => console.log('Build result:', result))
  .catch(err => console.error('Build failed:', err));
```

### 5. Verify Results

Check that:
1. âœ… New sequence created with `_SPLICE` suffix
2. âœ… Sequence contains only speech segments (silences removed)
3. âœ… Clips are colored:
   - Green for speech segments
   - Light blue for best takes
4. âœ… In/out points are set correctly on each clip
5. âœ… Timeline plays smoothly without gaps

## Expected Behavior

### Success Indicators:
- Console shows: `[SPLICE Builder] Built sequence with N clips`
- New sequence appears in Project panel
- Sequence name ends with `_SPLICE`
- Timeline contains trimmed clips with proper coloring

### Error Scenarios:

**Error: "Builder not initialized"**
- Fix: Ensure `builder.js` loaded before `main.js` (check index.html script order)

**Error: "Failed to create new sequence"**
- Fix: Ensure you have an active sequence open
- Check Premiere Pro version is 25.6+

**Error: "Script action failed to execute"**
- This should be fixed now, but if it occurs, check:
  - Actions are created inside `executeTransaction()` callback
  - TickTime objects used instead of raw numbers

**Error: "Source not found"**
- Ensure source clip is in the project bin
- Check that media paths are correct

## API References Used

Based on research, these UXP APIs were confirmed working:

- [Project.createSequence()](https://developer.adobe.com/premiere-pro/uxp/ppro_reference/classes/project/) - Create new sequence
- [Sequence.createCloneAction()](https://developer.adobe.com/premiere-pro/uxp/ppro_reference/classes/sequence/) - Clone sequence
- [SequenceEditor.createInsertProjectItemAction()](https://community.adobe.com/t5/premiere-pro-discussions/help-with-the-new-uxp-createinsertprojectitemaction-method-quot-script-action-failed-to-execute-quot/m-p/15239302) - Insert clips
- [TickTime.createWithTicks()](https://github.com/AdobeDocs/uxp-premiere-pro/blob/main/src/pages/ppro_reference/types.d.ts) - Time conversion

## Debugging Tips

### Enable Verbose Logging:

Add this to builder.js (after line 14):

```javascript
const DEBUG = true;
function log(...args) {
  if (DEBUG) console.log('[SPLICE Builder]', ...args);
}
```

### Check Transaction Execution:

Wrap executeTransaction in try/catch:

```javascript
try {
  await project.executeTransaction((compoundAction) => {
    console.log('Transaction started');
    // ... actions
    console.log('Transaction completed');
  }, 'SPLICE: Build Sequence');
} catch (err) {
  console.error('Transaction failed:', err);
  throw err;
}
```

## Next Steps After Successful Test

1. **Add UI Button**: Create "Build New Sequence" button in index.html
2. **Wire to Detection**: Auto-trigger builder after detection completes
3. **Add Progress UI**: Show build progress in plugin panel
4. **Error Handling**: Improve user-facing error messages

## Reporting Issues

If you encounter errors:

1. Note the exact error message
2. Check UXP Developer Tool console for stack traces
3. Verify Premiere Pro version (must be 25.6+)
4. Check which API call failed
5. Document the sequence of steps that led to the error

## Success Criteria

v3.5 is ready for production when:
- âœ… Sequence creation works without errors
- âœ… Clips are inserted with correct timing
- âœ… In/out points are set accurately
- âœ… Color labels are applied correctly
- âœ… No manual XML export/import needed
- âœ… Full workflow completes in <5 seconds for typical video

---

Good luck with testing! ðŸŽ¬
