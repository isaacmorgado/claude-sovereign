/**
 * CSInterface - Adobe Common Extensibility Platform Interface
 * Minimal implementation for SPLICE CEP panel
 */

function CSInterface() {
    this.hostEnvironment = null;
}

/**
 * Returns the host environment information
 */
CSInterface.prototype.getHostEnvironment = function() {
    if (!this.hostEnvironment) {
        try {
            this.hostEnvironment = JSON.parse(window.__adobe_cep__.getHostEnvironment());
        } catch (e) {
            this.hostEnvironment = {
                appName: 'PPRO',
                appVersion: '25.0',
                appLocale: 'en_US',
                isAppOffline: false
            };
        }
    }
    return this.hostEnvironment;
};

/**
 * Evaluates a script in the host application (Premiere Pro)
 * @param {string} script - The ExtendScript to evaluate
 * @param {function} callback - Callback function with result
 */
CSInterface.prototype.evalScript = function(script, callback) {
    if (window.__adobe_cep__) {
        window.__adobe_cep__.evalScript(script, callback || function() {});
    } else {
        // Development mode - mock responses
        console.warn('[CSInterface] Running in development mode - no CEP runtime');
        if (callback) {
            callback(JSON.stringify({ error: 'CEP runtime not available' }));
        }
    }
};

/**
 * Gets the system path for a given type
 * @param {string} pathType - Type of path (EXTENSION, USER_DATA, etc.)
 */
CSInterface.prototype.getSystemPath = function(pathType) {
    if (window.__adobe_cep__) {
        return window.__adobe_cep__.getSystemPath(pathType);
    }
    return '';
};

/**
 * Opens a URL in the default browser
 * @param {string} url - URL to open
 */
CSInterface.prototype.openURLInDefaultBrowser = function(url) {
    if (window.__adobe_cep__) {
        window.__adobe_cep__.openURLInDefaultBrowser(url);
    } else {
        window.open(url, '_blank');
    }
};

/**
 * Requests opening of an extension
 * @param {string} extensionId - Extension ID to open
 */
CSInterface.prototype.requestOpenExtension = function(extensionId) {
    if (window.__adobe_cep__) {
        window.__adobe_cep__.requestOpenExtension(extensionId);
    }
};

/**
 * Closes the extension
 */
CSInterface.prototype.closeExtension = function() {
    if (window.__adobe_cep__) {
        window.__adobe_cep__.closeExtension();
    }
};

/**
 * Gets the extension ID
 */
CSInterface.prototype.getExtensionId = function() {
    if (window.__adobe_cep__) {
        return window.__adobe_cep__.getExtensionId();
    }
    return 'com.splice.panel.main';
};

/**
 * Registers a callback for extension events
 * @param {string} type - Event type
 * @param {function} listener - Event listener
 */
CSInterface.prototype.addEventListener = function(type, listener) {
    if (window.__adobe_cep__) {
        window.__adobe_cep__.addEventListener(type, listener);
    }
};

/**
 * Removes an event listener
 * @param {string} type - Event type
 * @param {function} listener - Event listener
 */
CSInterface.prototype.removeEventListener = function(type, listener) {
    if (window.__adobe_cep__) {
        window.__adobe_cep__.removeEventListener(type, listener);
    }
};

/**
 * Dispatches an event
 * @param {object} event - Event object
 */
CSInterface.prototype.dispatchEvent = function(event) {
    if (window.__adobe_cep__) {
        window.__adobe_cep__.dispatchEvent(event);
    }
};

// System path constants
CSInterface.prototype.EXTENSION_PATH = 'extension';
CSInterface.prototype.USER_DATA_PATH = 'userData';
CSInterface.prototype.COMMON_FILES_PATH = 'commonFiles';
CSInterface.prototype.HOST_APPLICATION_PATH = 'hostApplication';

// Color theme
CSInterface.prototype.getTheme = function() {
    var env = this.getHostEnvironment();
    if (env && env.appSkinInfo) {
        return env.appSkinInfo.baseFontSize > 12 ? 'dark' : 'light';
    }
    return 'dark';
};

// Export for use
window.CSInterface = CSInterface;
