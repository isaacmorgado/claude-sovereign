# SPLICE

AI-powered Premiere Pro UXP plugin for detecting takes, removing silences, and accelerating video editing workflows.

## Current Focus
**Auto-Cutting v3.0** - Phase 2 complete (Frontend credit display)

## Quick Reference

### Pricing Tiers (80%+ Margins)
| Tier | Price | Hours | Stripe Price ID |
|------|-------|-------|-----------------|
| Starter | $19/mo | 15 hrs | price_1SgH4m2L5BseYEbCih347qfr |
| Pro | $49/mo | 50 hrs | price_1SgH4o2L5BseYEbCIoR19lhQ |
| Team | $149/mo | 150 hrs | price_1SgH4q2L5BseYEbCYTlimb5M |
| Overage | $1/hr | - | price_1SgH4y2L5BseYEbClZuxNRu8 |

### Key Constraints
- UXP requires Premiere Pro 25.6+
- Use `127.0.0.1` not `localhost` in fetch URLs
- Backend (local): https://127.0.0.1:3847
- Backend (prod): https://splice-api-production.up.railway.app
- Railway project: `splice-backend` with PostgreSQL

## Key Files

### Backend (v3.0)
| File | Purpose |
|------|---------|
| `splice-backend/server.js` | Express HTTP/HTTPS + all endpoints + webhook handler |
| `splice-backend/services/usageTracking.js` | Credit balance, usage logging, idempotency |
| `splice-backend/middleware/rateLimiter.js` | Credit check middleware |

### Endpoints
| Endpoint | Purpose |
|----------|---------|
| `GET /credits` | User's hour balance (x-stripe-customer-id header) |
| `GET /usage-history` | Usage log |
| `POST /webhooks/stripe` | Subscription events (idempotent) |

## Implementation Phases

### Phase 1: Usage & Billing System (Backend) âœ… COMPLETE
- [x] usageTracking.js, rateLimiter.js, /credits endpoint
- [x] Railway + PostgreSQL deployment
- [x] Stripe products + webhook integration

### Phase 2: UI Simplification (Frontend)
- [ ] Update `index.html` - credit display
- [ ] Create `credits.js` - fetch/display balance

### Phase 3-6: Preview Mode, Smart Filtering, Automation, Polish
- [ ] Remaining phases

## Last Session (2025-12-19)

**Deployed backend to Railway + hardened Stripe webhooks:**
- Deployed `splice-api` service to Railway (https://splice-api-production.up.railway.app)
- Created Stripe webhook endpoint (`we_1SgHWx2L5BseYEbCN9Lc8KQj`)
- Fixed `cancelled` tier to properly set 0 hours (JavaScript falsy bug with `||` operator)
- Added idempotency handling (webhook_events table, isEventProcessed/recordWebhookEvent)
- Added unknown priceId logging, customerId null validation
- Fixed division by zero in getBalance when hoursTotal=0

**Stopped at:** Phase 1 100% complete, webhook integration production-ready

## Next Steps
1. Start Phase 2: Add credit display to plugin UI
2. Create `splice-plugin/js/credits.js` to fetch balance from `/credits`
3. Update `index.html` to show hours remaining

---
*Last updated: 2025-12-19*
