#!/bin/bash
# Test clauded with debug output

echo "=== Testing clauded model loading ==="
echo "ANTHROPIC_BASE_URL will be set to: http://127.0.0.1:3000"
echo ""

# Run node with the CLI directly, same as clauded wrapper does
ANTHROPIC_BASE_URL=http://127.0.0.1:3000 node -e "
// Add debug logging before loading CLI
console.log('[DEBUG] ANTHROPIC_BASE_URL:', process.env.ANTHROPIC_BASE_URL);
console.log('[DEBUG] Loading CLI...');

// Patch the global object to intercept when models are set
Object.defineProperty(global, '__CLAUDED_PROXY_MODELS', {
  set: function(value) {
    console.log('[DEBUG] ✓ Models being set! Count:', value.length);
    this._CLAUDED_PROXY_MODELS = value;
  },
  get: function() {
    return this._CLAUDED_PROXY_MODELS;
  },
  configurable: true
});

// Load the CLI
require('$HOME/.claude/clauded-cli/cli.js');

// Give it a moment to initialize
setTimeout(() => {
  if (global.__CLAUDED_PROXY_MODELS) {
    console.log('[DEBUG] ✓ Final check: Models loaded:', global.__CLAUDED_PROXY_MODELS.length);
  } else {
    console.log('[DEBUG] ✗ Final check: Models NOT loaded');
  }
  process.exit(0);
}, 2000);
"
