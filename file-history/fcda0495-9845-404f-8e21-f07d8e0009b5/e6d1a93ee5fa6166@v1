-- Migration: Add archetype to forum mappings
-- Date: 2025-12-25
-- Description: Maps user archetypes to recommended forum categories

-- ============== ARCHETYPE TO FORUM MAPPING TABLE ==============
CREATE TABLE IF NOT EXISTS archetype_forum_mappings (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    archetype_category VARCHAR(50) NOT NULL,  -- "Softboy", "Prettyboy", "RobustPrettyboy", "Chad", "Hypermasculine", "Exotic"
    issue_category_id UUID NOT NULL REFERENCES forum_issue_categories(id) ON DELETE CASCADE,
    priority INTEGER DEFAULT 0,  -- Higher = more relevant
    reason TEXT,  -- "Style tips for masculine frames"
    created_at TIMESTAMP DEFAULT NOW(),
    UNIQUE(archetype_category, issue_category_id)
);

CREATE INDEX IF NOT EXISTS idx_archetype_mapping_category ON archetype_forum_mappings(archetype_category);

-- ============== SEED ARCHETYPE MAPPINGS ==============

-- Softboy → Fashion (styling for softer features), Anxiety (social confidence)
INSERT INTO archetype_forum_mappings (archetype_category, issue_category_id, priority, reason) VALUES
    ('Softboy', (SELECT id FROM forum_issue_categories WHERE slug='fashion'), 10, 'Style tips that enhance soft, approachable features'),
    ('Softboy', (SELECT id FROM forum_issue_categories WHERE slug='anxiety'), 8, 'Build confidence while maintaining authentic personality'),
    ('Softboy', (SELECT id FROM forum_issue_categories WHERE slug='poor-skin'), 6, 'Skincare routines for clear, youthful appearance')
ON CONFLICT (archetype_category, issue_category_id) DO NOTHING;

-- Prettyboy → Fashion, Poor Skin (grooming emphasis), Social Media
INSERT INTO archetype_forum_mappings (archetype_category, issue_category_id, priority, reason) VALUES
    ('Prettyboy', (SELECT id FROM forum_issue_categories WHERE slug='fashion'), 10, 'High-fashion styling to match refined features'),
    ('Prettyboy', (SELECT id FROM forum_issue_categories WHERE slug='poor-skin'), 9, 'Flawless skin is essential for prettyboy aesthetic'),
    ('Prettyboy', (SELECT id FROM forum_issue_categories WHERE slug='social-media'), 7, 'Leverage your aesthetics on social platforms'),
    ('Prettyboy', (SELECT id FROM forum_issue_categories WHERE slug='hair-loss'), 5, 'Hair is key to the prettyboy look')
ON CONFLICT (archetype_category, issue_category_id) DO NOTHING;

-- RobustPrettyboy → Body Composition, Fashion
INSERT INTO archetype_forum_mappings (archetype_category, issue_category_id, priority, reason) VALUES
    ('RobustPrettyboy', (SELECT id FROM forum_issue_categories WHERE slug='body-composition'), 10, 'Balance aesthetics with a more muscular physique'),
    ('RobustPrettyboy', (SELECT id FROM forum_issue_categories WHERE slug='fashion'), 8, 'Styling that emphasizes both features and frame'),
    ('RobustPrettyboy', (SELECT id FROM forum_issue_categories WHERE slug='poor-skin'), 6, 'Maintain clear skin alongside training')
ON CONFLICT (archetype_category, issue_category_id) DO NOTHING;

-- Chad → Body Composition (frame building), Height/Frame
INSERT INTO archetype_forum_mappings (archetype_category, issue_category_id, priority, reason) VALUES
    ('Chad', (SELECT id FROM forum_issue_categories WHERE slug='body-composition'), 10, 'Build the muscular frame that defines the Chad archetype'),
    ('Chad', (SELECT id FROM forum_issue_categories WHERE slug='height-frame'), 9, 'Maximize frame development and presence'),
    ('Chad', (SELECT id FROM forum_issue_categories WHERE slug='weak-bone-structure'), 7, 'Enhance already strong jaw and bone structure'),
    ('Chad', (SELECT id FROM forum_issue_categories WHERE slug='fashion'), 5, 'Simple, masculine styling that showcases physique')
ON CONFLICT (archetype_category, issue_category_id) DO NOTHING;

-- Hypermasculine (Warrior) → Body Composition, Height/Frame, Weak Bone Structure
INSERT INTO archetype_forum_mappings (archetype_category, issue_category_id, priority, reason) VALUES
    ('Hypermasculine', (SELECT id FROM forum_issue_categories WHERE slug='body-composition'), 10, 'Maximize size and strength for warrior physique'),
    ('Hypermasculine', (SELECT id FROM forum_issue_categories WHERE slug='height-frame'), 10, 'Frame is everything for the hypermasculine look'),
    ('Hypermasculine', (SELECT id FROM forum_issue_categories WHERE slug='weak-bone-structure'), 8, 'Enhance prominent masculine bone structure'),
    ('Hypermasculine', (SELECT id FROM forum_issue_categories WHERE slug='fashion'), 4, 'Rugged, utilitarian styling')
ON CONFLICT (archetype_category, issue_category_id) DO NOTHING;

-- Exotic → Fashion (unique styling opportunities), Social Media
INSERT INTO archetype_forum_mappings (archetype_category, issue_category_id, priority, reason) VALUES
    ('Exotic', (SELECT id FROM forum_issue_categories WHERE slug='fashion'), 10, 'Unique styling that embraces distinctive features'),
    ('Exotic', (SELECT id FROM forum_issue_categories WHERE slug='social-media'), 9, 'Stand out with your unique look on social platforms'),
    ('Exotic', (SELECT id FROM forum_issue_categories WHERE slug='poor-skin'), 6, 'Skincare tailored to your skin type'),
    ('Exotic', (SELECT id FROM forum_issue_categories WHERE slug='hair-loss'), 5, 'Hair styling for unique face shapes')
ON CONFLICT (archetype_category, issue_category_id) DO NOTHING;

-- ============== VERIFY MIGRATION ==============
SELECT 'archetype_forum_mappings' as table_name, COUNT(*) as count FROM archetype_forum_mappings;
