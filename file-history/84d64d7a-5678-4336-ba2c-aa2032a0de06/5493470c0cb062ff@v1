/**
 * Validation script for MediaPipe landmark mappings
 * Run with: npx tsx src/lib/validateMappings.ts
 */

import { MEDIAPIPE_FRONT_MAPPING, MEDIAPIPE_SIDE_MAPPING } from './mediapipeDetection';

console.log('=== MediaPipe Landmark Mapping Validation ===\n');

// Check for duplicates
const indices = Object.entries(MEDIAPIPE_FRONT_MAPPING);
const indexCounts: Record<number, string[]> = {};

for (const [name, index] of indices) {
  if (!indexCounts[index]) {
    indexCounts[index] = [];
  }
  indexCounts[index].push(name);
}

console.log('1. DUPLICATE CHECK');
console.log('-------------------');
let hasDuplicates = false;
for (const [index, names] of Object.entries(indexCounts)) {
  if (names.length > 1) {
    // Allow nasion/nasal_base alias
    if (names.includes('nasion') && names.includes('nasal_base') && names.length === 2) {
      console.log(`   ✓ Index ${index}: ${names.join(', ')} (allowed alias)`);
    } else {
      console.log(`   ✗ DUPLICATE Index ${index}: ${names.join(', ')}`);
      hasDuplicates = true;
    }
  }
}

if (!hasDuplicates) {
  console.log('   ✓ No unexpected duplicates found!');
}

console.log('\n2. KEY LANDMARK VERIFICATION');
console.log('----------------------------');

// Pupil check
const leftPupil = MEDIAPIPE_FRONT_MAPPING.left_pupila;
const rightPupil = MEDIAPIPE_FRONT_MAPPING.right_pupila;
console.log(`   Pupils: left=${leftPupil} (expect 468), right=${rightPupil} (expect 473)`);
console.log(`   ${leftPupil === 468 && rightPupil === 473 ? '✓' : '✗'} Pupil indices correct`);

// Glabella check
const glabella = MEDIAPIPE_FRONT_MAPPING.glabella;
console.log(`   Glabella: ${glabella} (expect 9)`);
console.log(`   ${glabella === 9 ? '✓' : '✗'} Glabella index correct`);

// Nose check
const nasion = MEDIAPIPE_FRONT_MAPPING.nasion;
const nasalBase = MEDIAPIPE_FRONT_MAPPING.nasal_base;
const leftAla = MEDIAPIPE_FRONT_MAPPING.left_ala_nasi;
const rightAla = MEDIAPIPE_FRONT_MAPPING.right_ala_nasi;
console.log(`   Nasion: ${nasion} (expect 6), Nasal Base: ${nasalBase} (expect 6)`);
console.log(`   Nostrils: left=${leftAla} (expect 129), right=${rightAla} (expect 358)`);
console.log(`   ${nasion === 6 && leftAla === 129 && rightAla === 358 ? '✓' : '✗'} Nose indices correct`);

console.log('\n3. EYELID UNIQUENESS CHECK');
console.log('--------------------------');

// Left eye eyelid indices
const leftEyelidIndices = [
  MEDIAPIPE_FRONT_MAPPING.left_palpebra_superior,
  MEDIAPIPE_FRONT_MAPPING.left_palpebra_inferior,
  MEDIAPIPE_FRONT_MAPPING.left_sulcus_palpebralis_lateralis,
  MEDIAPIPE_FRONT_MAPPING.left_pretarsal_skin_crease,
];
const uniqueLeft = new Set(leftEyelidIndices);
console.log(`   Left eye eyelid indices: ${leftEyelidIndices.join(', ')}`);
console.log(`   ${uniqueLeft.size === leftEyelidIndices.length ? '✓' : '✗'} All left eyelid indices unique`);

// Right eye eyelid indices
const rightEyelidIndices = [
  MEDIAPIPE_FRONT_MAPPING.right_palpebra_superior,
  MEDIAPIPE_FRONT_MAPPING.right_palpebra_inferior,
  MEDIAPIPE_FRONT_MAPPING.right_sulcus_palpebralis_lateralis,
  MEDIAPIPE_FRONT_MAPPING.right_pretarsal_skin_crease,
];
const uniqueRight = new Set(rightEyelidIndices);
console.log(`   Right eye eyelid indices: ${rightEyelidIndices.join(', ')}`);
console.log(`   ${uniqueRight.size === rightEyelidIndices.length ? '✓' : '✗'} All right eyelid indices unique`);

console.log('\n4. NECK VS JAW CHECK');
console.log('--------------------');
const leftNeck = MEDIAPIPE_FRONT_MAPPING.left_cervical_lateralis;
const leftJaw = MEDIAPIPE_FRONT_MAPPING.left_gonion_inferior;
const rightNeck = MEDIAPIPE_FRONT_MAPPING.right_cervical_lateralis;
const rightJaw = MEDIAPIPE_FRONT_MAPPING.right_gonion_inferior;
console.log(`   Left: neck=${leftNeck}, jaw=${leftJaw}`);
console.log(`   Right: neck=${rightNeck}, jaw=${rightJaw}`);
console.log(`   ${leftNeck !== leftJaw && rightNeck !== rightJaw ? '✓' : '✗'} Neck and jaw indices are distinct`);

console.log('\n5. INDEX RANGE CHECK');
console.log('--------------------');
let allInRange = true;
for (const [name, index] of Object.entries(MEDIAPIPE_FRONT_MAPPING)) {
  if (index < 0 || index >= 478) {
    console.log(`   ✗ ${name}: ${index} is OUT OF RANGE`);
    allInRange = false;
  }
}
console.log(`   ${allInRange ? '✓' : '✗'} All indices within 0-477 range`);

console.log('\n=== VALIDATION COMPLETE ===');
console.log(`Total front landmarks: ${Object.keys(MEDIAPIPE_FRONT_MAPPING).length}`);
console.log(`Total side landmarks: ${Object.keys(MEDIAPIPE_SIDE_MAPPING).length}`);
