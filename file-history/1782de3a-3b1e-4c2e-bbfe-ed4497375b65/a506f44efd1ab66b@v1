"""
Supplement and Product schemas for API requests/responses
"""

from pydantic import BaseModel, Field
from typing import Optional, List, Dict
from enum import Enum


# === ENUMS ===

class SupplementCategory(str, Enum):
    SKIN = "skin"
    HAIR = "hair"
    ANTI_AGING = "anti-aging"
    HORMONAL = "hormonal"
    BONE = "bone"
    GENERAL = "general"


class EvidenceLevel(str, Enum):
    STRONG = "strong"
    MODERATE = "moderate"
    WEAK = "weak"


class RiskLevel(str, Enum):
    VERY_LOW = "very_low"
    LOW = "low"
    MODERATE = "moderate"
    HIGH = "high"


class AffiliateType(str, Enum):
    AMAZON = "amazon"
    DIRECT = "direct"


class RecommendationState(str, Enum):
    FLAW = "flaw"       # Corrective - user has weak metric
    IDEAL = "ideal"     # Maintenance - user has strong metric


class Urgency(str, Enum):
    HIGH = "high"
    MEDIUM = "medium"
    LOW = "low"


# === SUPPLEMENT SCHEMAS ===

class CostRange(BaseModel):
    min: int
    max: int


class Supplement(BaseModel):
    id: str
    name: str
    category: SupplementCategory
    description: str
    dosage: str
    frequency: str
    timing: str
    effectiveness: int = Field(..., ge=1, le=10)
    evidenceLevel: EvidenceLevel
    costPerMonth: CostRange
    timelineToResults: str
    riskLevel: RiskLevel
    sideEffects: List[str] = []
    interactions: List[str] = []
    contraindications: List[str] = []
    targetBenefits: List[str] = []
    requiresPrescription: bool = False
    notes: List[str] = []
    sources: List[str] = []


class SupplementListResponse(BaseModel):
    supplements: List[Supplement]
    total: int


# === PRODUCT SCHEMAS ===

class Product(BaseModel):
    id: str
    name: str
    brand: str
    category: SupplementCategory
    affiliateLink: str
    affiliateType: AffiliateType
    supplementId: str  # Reference to supplement
    priority: int = Field(..., ge=1, le=10)
    baseStackItem: bool = False


class ProductListResponse(BaseModel):
    products: List[Product]
    total: int


# === DAILY STACK SCHEMAS ===

class DailyStackTiming(BaseModel):
    morning: List[Product]
    evening: List[Product]
    anytime: List[Product]


class DailyStack(BaseModel):
    products: List[Product]
    totalCostPerMonth: CostRange
    timing: DailyStackTiming
    rationale: str


class DailyStackRequest(BaseModel):
    gender: str = Field(..., pattern="^(male|female)$")
    age: Optional[int] = Field(None, ge=13, le=100)


# === PRODUCT RECOMMENDATION SCHEMAS ===

class ProductRecommendation(BaseModel):
    product: Product
    state: RecommendationState
    targetMetric: str
    message: str
    urgency: Urgency
    matchedMetrics: List[str]
    supplement: Optional[Supplement] = None  # Full supplement details


class ProductRecommendationsRequest(BaseModel):
    metricsDict: Dict[str, float]
    severityDict: Dict[str, str]
    gender: str = Field(..., pattern="^(male|female)$")
    ethnicity: Optional[str] = None


class ProductRecommendationsResponse(BaseModel):
    recommendations: List[ProductRecommendation]
    dailyStack: Optional[DailyStack] = None
    flawCount: int
    idealCount: int
