/* eslint-disable @next/next/no-img-element */
import React, { forwardRef } from 'react';
import { Analysis } from '@/lib/api';
import { Gauge, Trophy, Brain, Zap, AlertTriangle } from 'lucide-react';
import { FaceOverlay } from '../visualization/FaceOverlay';

interface AnalysisReportProps {
    analysis: any; // Using 'any' to facilitate flexible data passing
    results: any;
    userName?: string;
    isUnlocked?: boolean;
}

export const AnalysisReport = forwardRef<HTMLDivElement, AnalysisReportProps>(
    ({ analysis, results, userName = 'User' }, ref) => {
        // ... (dates and colors helpers remain)

        return (
            <div ref={ref} className="bg-neutral-950 text-white w-[794px] min-h-[1123px] relative overflow-hidden font-sans">
                {/* ... (background and header remain) ... */}

                {/* -- PHOTOS -- */}
                <div className="px-12 mb-10">
                    <h3 className="text-sm font-bold text-neutral-400 uppercase tracking-widest mb-6 border-l-2 border-cyan-500 pl-3">
                        Analysis Scans
                    </h3>
                    <div className="grid grid-cols-2 gap-6">
                        {/* Front Photo */}
                        <div className="relative rounded-xl overflow-hidden border border-neutral-800 bg-black aspect-[3/4]">
                            {analysis?.front_image_url ? (
                                <FaceOverlay
                                    photo={analysis.front_image_url}
                                    landmarks={analysis.front_landmarks || []}
                                    selectedRatio={null}
                                    profileType="front"
                                    showAllLandmarks={true}
                                />
                            ) : (
                                <div className="flex items-center justify-center h-full text-neutral-600">No Image</div>
                            )}
                            <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4 z-10 pointer-events-none">
                                <span className="text-white text-sm font-medium">Front Profile</span>
                            </div>
                        </div>

                        {/* Side Photo */}
                        <div className="relative rounded-xl overflow-hidden border border-neutral-800 bg-black aspect-[3/4]">
                            {analysis?.side_image_url ? (
                                <FaceOverlay
                                    photo={analysis.side_image_url}
                                    landmarks={analysis.side_landmarks || []}
                                    selectedRatio={null}
                                    profileType="side"
                                    showAllLandmarks={true}
                                />
                            ) : (
                                <div className="flex items-center justify-center h-full text-neutral-600">No Image</div>
                            )}
                            <div className="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4 z-10 pointer-events-none">
                                <span className="text-white text-sm font-medium">Side Profile</span>
                            </div>
                        </div>
                    </div>
                    <p className="text-xs text-neutral-600 mt-2 italic text-center">
                        * Landmark analysis data processed securely.
                    </p>
                </div>


                {/* -- DETAILED BREAKDOWN -- */}
                <div className="px-12 grid grid-cols-2 gap-12">

                    {/* Strengths */}
                    <div>
                        <h3 className="text-sm font-bold text-neutral-400 uppercase tracking-widest mb-4 border-l-2 border-green-500 pl-3 flex items-center gap-2">
                            <Zap size={16} className="text-green-500" />
                            Key Strengths
                        </h3>
                        <div className="space-y-3">
                            {results?.pslRating?.breakdown?.face?.raw > 0 && (
                                <div className="p-4 bg-neutral-900/30 border border-neutral-800 rounded-lg">
                                    <span className="text-green-400 font-medium block mb-1">Facial Harmony</span>
                                    <span className="text-neutral-400 text-sm">Strong overall facial balance and symmetry.</span>
                                </div>
                            )}
                            {/* Placeholder Logic if specific strings aren't available immediately in this context */}
                            {(results?.analysis?.scores?.masculinity > 50 || results?.analysis?.scores?.femininity > 50) && (
                                <div className="p-4 bg-neutral-900/30 border border-neutral-800 rounded-lg">
                                    <span className="text-green-400 font-medium block mb-1">Dimorphism</span>
                                    <span className="text-neutral-400 text-sm">High sexual dimorphism traits detected.</span>
                                </div>
                            )}
                            <div className="p-4 bg-neutral-900/30 border border-neutral-800 rounded-lg">
                                <span className="text-green-400 font-medium block mb-1">Overall Structure</span>
                                <span className="text-neutral-400 text-sm">Positive bone structure development relative to average.</span>
                            </div>
                        </div>
                    </div>

                    {/* Flaws / Improvements */}
                    <div>
                        <h3 className="text-sm font-bold text-neutral-400 uppercase tracking-widest mb-4 border-l-2 border-yellow-500 pl-3 flex items-center gap-2">
                            <AlertTriangle size={16} className="text-yellow-500" />
                            Areas to Improve
                        </h3>
                        <div className="space-y-3">
                            <div className="p-4 bg-neutral-900/30 border border-neutral-800 rounded-lg">
                                <span className="text-yellow-400 font-medium block mb-1">Skin Quality</span>
                                <span className="text-neutral-400 text-sm">Texture and clarity improvements recommended.</span>
                            </div>
                            <div className="p-4 bg-neutral-900/30 border border-neutral-800 rounded-lg">
                                <span className="text-yellow-400 font-medium block mb-1">Body Composition</span>
                                <span className="text-neutral-400 text-sm">Optimization of lean mass could improve overall rating.</span>
                            </div>
                        </div>
                    </div>

                </div>

                {/* -- FOOTER -- */}
                <div className="absolute bottom-0 left-0 right-0 p-8 border-t border-neutral-800 bg-neutral-950 flex justify-between items-center">
                    <div className="text-xs text-neutral-600">
                        Generated by <span className="text-cyan-600 font-bold">LooksMaxx AI</span>
                        <br />
                        looksmaxx.app
                    </div>
                    <div className="flex gap-2">
                        <div className="w-2 h-2 rounded-full bg-cyan-500" />
                        <div className="w-2 h-2 rounded-full bg-purple-500" />
                        <div className="w-2 h-2 rounded-full bg-green-500" />
                    </div>
                </div>

            </div>
        );
    }
);

AnalysisReport.displayName = 'AnalysisReport';
