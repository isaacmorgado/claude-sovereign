#!/bin/bash

echo "üî® REBUILDING KOMPLETE-KONTROL WITH UNIQUE IDs"
echo "==============================================="
echo ""
echo "This build includes:"
echo "  ‚úÖ All command IDs changed from 'roo-cline' to 'komplete-kontrol'"
echo "  ‚úÖ All view IDs changed to be unique"
echo "  ‚úÖ No conflicts with old Roo Code extension"
echo ""
echo "Starting build..."
echo ""

cd /Users/imorgado/Projects/Roo-Code

# Clean old builds
echo "üßπ Cleaning old builds..."
pnpm clean
echo ""

# Build new version
echo "üî® Building extension..."
pnpm run vsix

if [ $? -ne 0 ]; then
    echo ""
    echo "‚ùå Build failed!"
    exit 1
fi

echo ""
echo "‚úÖ BUILD COMPLETE!"
echo ""

VSIX_PATH="./bin/komplete-kontrol-3.38.1.vsix"

if [ -f "$VSIX_PATH" ]; then
    SIZE=$(ls -lh "$VSIX_PATH" | awk '{print $5}')
    echo "üì¶ VSIX created:"
    echo "   Location: $VSIX_PATH"
    echo "   Size: $SIZE"
    echo ""
else
    echo "‚ùå VSIX file not found!"
    exit 1
fi

echo "==============================================="
echo "üéØ NEXT STEPS:"
echo "==============================================="
echo ""
echo "1. UNINSTALL OLD EXTENSIONS:"
echo "   Run: ./DIAGNOSE_AND_FIX.sh"
echo ""
echo "2. Or manually install:"
echo "   - Quit VSCode completely (Cmd+Q)"
echo "   - Remove old extensions:"
echo "     rm -rf ~/.vscode/extensions/rooveterinaryinc.roo-cline-*"
echo "     rm -rf ~/.vscode/extensions/kompletekontrol.komplete-kontrol-*"
echo "   - Open VSCode"
echo "   - Extensions ‚Üí ... ‚Üí Install from VSIX"
echo "   - Select: $VSIX_PATH"
echo ""
echo "3. This version will NOT conflict with Roo Code!"
echo "   - Different command IDs (komplete-kontrol.*)"
echo "   - Different view IDs"
echo "   - Can run independently"
echo ""
echo "==============================================="
echo ""
