# SPLICE Phase 5 Continuation

## Status
Phase 4 complete. Billing fully wired. 177 tests passing.

## Key Files
- `splice-backend/server.js` - 1800+ LOC, all endpoints
- `splice-backend/services/usageTracking.js` - billing, credits, webhooks
- `splice-backend/middleware/rateLimiter.js` - requireCredits middleware
- `splice-plugin/js/main.js` - 2300+ LOC, UI orchestration
- `splice-plugin/js/settings.js` - presets, login, customer ID storage
- `splice-backend/tests/phase4-production.test.js` - 42 tests

## Pending Tasks

### 1. Referral/Invite Code System
Implement user-specific codes like FireCut:
- Generate unique codes per customer (e.g., `SPLICE-ABC123`)
- POST `/referral/validate` - validate code, apply discount
- Track referrals in PostgreSQL: `referrer_id`, `referee_id`, `code`, `redeemed_at`
- Referrer gets: 1 free month or bonus hours
- Referee gets: 20% off first month

### 2. Address Agent Findings
Review outputs from:
- load-profiler: Performance bottlenecks
- validator: Requirements gaps
- red-teamer: Security vulnerabilities
- secrets-hunter: Exposed credentials
- build-researcher: FireCut referral research

### 3. Remaining Gaps
- Batch processing UI (API exists, no plugin UI)
- Builder UXP testing in Premiere Pro 25.6+
- Chunked audio processing for long clips

## Commands
```bash
cd /Users/imorgado/SPLICE/splice-backend
node server.js                    # Start server
node tests/phase4-production.test.js  # Run Phase 4 tests
```

## Database Schema Addition (referrals)
```sql
CREATE TABLE referral_codes (
  id SERIAL PRIMARY KEY,
  user_id INTEGER REFERENCES users(id),
  code VARCHAR(20) UNIQUE NOT NULL,
  uses_remaining INTEGER DEFAULT 10,
  discount_percent INTEGER DEFAULT 20,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

CREATE TABLE referral_redemptions (
  id SERIAL PRIMARY KEY,
  code_id INTEGER REFERENCES referral_codes(id),
  referee_stripe_id VARCHAR(255),
  redeemed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```
