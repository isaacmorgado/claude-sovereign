/**
 * Female User Flow Test
 * Tests the complete end-to-end flow for female users across all ethnicities
 */

import { getMetricConfig, getSeverityForMetric } from './src/lib/insights-engine';
import { adviceEngine } from './src/lib/advice-engine';

console.log('ğŸ§ª TESTING FEMALE USER FLOW\n');
console.log('=' .repeat(80));

// ============================================
// TEST 1: Female White - Soft Jaw
// ============================================
console.log('\nğŸ“‹ TEST 1: Female White - Soft Jaw (128Â°)');
console.log('-'.repeat(80));

const femaleWhiteJaw = getMetricConfig('gonial_angle', 'female', 'white');
console.log('Config:', femaleWhiteJaw);
console.log('Expected ideal range: [122.0, 130.0]');

if (femaleWhiteJaw) {
  const severity = getSeverityForMetric('gonial_angle', 128, 'female', 'white');
  console.log(`\nValue: 128Â°`);
  console.log(`Severity: ${severity}`);
  console.log(`Expected: 'ideal' (within 122-130 range)`);
  console.log(`âœ… PASS: ${severity === 'ideal' ? 'CORRECT' : 'âŒ FAILED'}`);
} else {
  console.log('âŒ FAIL: Config not found for female_white gonial_angle');
}

// ============================================
// TEST 2: Female Black - Full Lips
// ============================================
console.log('\n\nğŸ“‹ TEST 2: Female Black - Full Lips (1.4)');
console.log('-'.repeat(80));

const femaleBlackLips = getMetricConfig('lip_size_volume', 'female', 'black');
console.log('Config:', femaleBlackLips);
console.log('Expected ideal range: [1.3, 1.6]');

if (femaleBlackLips) {
  const severity = getSeverityForMetric('lip_size_volume', 1.4, 'female', 'black');
  console.log(`\nValue: 1.4`);
  console.log(`Severity: ${severity}`);
  console.log(`Expected: 'ideal' (within 1.3-1.6 range)`);
  console.log(`âœ… PASS: ${severity === 'ideal' ? 'CORRECT' : 'âŒ FAILED'}`);

  // Test advice engine respects ideal status
  console.log('\nğŸ” Testing Advice Engine:');
  const metricsDict = { 'Lip Size/Volume': 1.4 };
  const severityDict = { 'Lip Size/Volume': 'ideal' };

  const recommendations = adviceEngine.getRecommendations(metricsDict, severityDict);
  console.log(`Recommendations for IDEAL lip volume: ${recommendations.length === 0 ? 'âœ… None (correct)' : 'âŒ ' + recommendations.length + ' suggestions (wrong)'}`);

  if (recommendations.length > 0) {
    console.log('Unexpected recommendations:', recommendations.map(r => r.title));
  }
} else {
  console.log('âŒ FAIL: Config not found for female_black lip_size_volume');
}

// ============================================
// TEST 3: Female East Asian - Wide-Set Eyes
// ============================================
console.log('\n\nğŸ“‹ TEST 3: Female East Asian - Wide-Set Eyes (46.8%)');
console.log('-'.repeat(80));

const femaleEastAsianEyes = getMetricConfig('eye_separation_ratio', 'female', 'east_asian');
console.log('Config:', femaleEastAsianEyes);
console.log('Expected ideal range: [46.3, 47.5]');

if (femaleEastAsianEyes) {
  const severity = getSeverityForMetric('eye_separation_ratio', 46.8, 'female', 'east_asian');
  console.log(`\nValue: 46.8%`);
  console.log(`Severity: ${severity}`);
  console.log(`Expected: 'ideal' (within 46.3-47.5 neotenous range)`);
  console.log(`âœ… PASS: ${severity === 'ideal' ? 'CORRECT' : 'âŒ FAILED'}`);
} else {
  console.log('âŒ FAIL: Config not found for female_east_asian eye_separation_ratio');
}

// ============================================
// TEST 4: Female South Asian - Tear Trough
// ============================================
console.log('\n\nğŸ“‹ TEST 4: Female South Asian - Tear Trough (0.4mm)');
console.log('-'.repeat(80));

const femaleSouthAsianTears = getMetricConfig('tear_trough_depth', 'female', 'south_asian');
console.log('Config:', femaleSouthAsianTears);
console.log('Expected ideal range: [0.0, 0.5]');

if (femaleSouthAsianTears) {
  const severity = getSeverityForMetric('tear_trough_depth', 0.4, 'female', 'south_asian');
  console.log(`\nValue: 0.4mm`);
  console.log(`Severity: ${severity}`);
  console.log(`Expected: 'ideal' (within 0.0-0.5 strict range)`);
  console.log(`âœ… PASS: ${severity === 'ideal' ? 'CORRECT' : 'âŒ FAILED'}`);
} else {
  console.log('âŒ FAIL: Config not found for female_south_asian tear_trough_depth');
}

// ============================================
// TEST 5: Female Hispanic - FWHR
// ============================================
console.log('\n\nğŸ“‹ TEST 5: Female Hispanic - Face Width to Height (1.56)');
console.log('-'.repeat(80));

const femaleHispanicFWHR = getMetricConfig('fwhr', 'female', 'hispanic');
console.log('Config:', femaleHispanicFWHR);
console.log('Expected ideal range: [1.50, 1.62]');

if (femaleHispanicFWHR) {
  const severity = getSeverityForMetric('fwhr', 1.56, 'female', 'hispanic');
  console.log(`\nValue: 1.56`);
  console.log(`Severity: ${severity}`);
  console.log(`Expected: 'ideal' (Mestiza tolerance)`);
  console.log(`âœ… PASS: ${severity === 'ideal' ? 'CORRECT' : 'âŒ FAILED'}`);
} else {
  console.log('âŒ FAIL: Config not found for female_hispanic fwhr');
}

// ============================================
// TEST 6: Female Middle Eastern - Canthal Tilt
// ============================================
console.log('\n\nğŸ“‹ TEST 6: Female Middle Eastern - Canthal Tilt (7Â°)');
console.log('-'.repeat(80));

const femaleMiddleEasternTilt = getMetricConfig('canthal_tilt', 'female', 'middle_eastern');
console.log('Config:', femaleMiddleEasternTilt);
console.log('Expected ideal range: [5.0, 10.0]');

if (femaleMiddleEasternTilt) {
  const severity = getSeverityForMetric('canthal_tilt', 7, 'female', 'middle_eastern');
  console.log(`\nValue: 7Â°`);
  console.log(`Severity: ${severity}`);
  console.log(`Expected: 'ideal' (Foxy/Hunter feminine)`);
  console.log(`âœ… PASS: ${severity === 'ideal' ? 'CORRECT' : 'âŒ FAILED'}`);
} else {
  console.log('âŒ FAIL: Config not found for female_middle_eastern canthal_tilt');
}

// ============================================
// TEST 7: Female Native American - FWHR
// ============================================
console.log('\n\nğŸ“‹ TEST 7: Female Native American - FWHR (1.60)');
console.log('-'.repeat(80));

const femaleNativeAmericanFWHR = getMetricConfig('fwhr', 'female', 'native_american');
console.log('Config:', femaleNativeAmericanFWHR);
console.log('Expected ideal range: [1.52, 1.65]');

if (femaleNativeAmericanFWHR) {
  const severity = getSeverityForMetric('fwhr', 1.60, 'female', 'native_american');
  console.log(`\nValue: 1.60`);
  console.log(`Severity: ${severity}`);
  console.log(`Expected: 'ideal' (Wide/High Cheekbone structure)`);
  console.log(`âœ… PASS: ${severity === 'ideal' ? 'CORRECT' : 'âŒ FAILED'}`);
} else {
  console.log('âŒ FAIL: Config not found for female_native_american fwhr');
}

// ============================================
// TEST 8: Female Pacific Islander - Cheek Fullness
// ============================================
console.log('\n\nğŸ“‹ TEST 8: Female Pacific Islander - Cheek Fullness (1.8)');
console.log('-'.repeat(80));

const femalePacificIslanderCheeks = getMetricConfig('cheek_fullness', 'female', 'pacific_islander');
console.log('Config:', femalePacificIslanderCheeks);
console.log('Expected ideal range: [1.2, 2.5]');

if (femalePacificIslanderCheeks) {
  const severity = getSeverityForMetric('cheek_fullness', 1.8, 'female', 'pacific_islander');
  console.log(`\nValue: 1.8`);
  console.log(`Severity: ${severity}`);
  console.log(`Expected: 'ideal' (High volume/softness)`);
  console.log(`âœ… PASS: ${severity === 'ideal' ? 'CORRECT' : 'âŒ FAILED'}`);
} else {
  console.log('âŒ FAIL: Config not found for female_pacific_islander cheek_fullness');
}

// ============================================
// TEST 9: Advice Engine - Ideal vs Flaw
// ============================================
console.log('\n\nğŸ“‹ TEST 9: Advice Engine - Ideal Status Filtering');
console.log('-'.repeat(80));

// Test case: Black female with wide nose (IDEAL for her ethnicity)
const blackFemaleNoseIdeal = {
  'Nose Width': 48  // IDEAL for Black females (40-50mm)
};

const blackFemaleNoseSeverity = {
  'Nose Width': 'ideal'
};

const idealRecommendations = adviceEngine.getRecommendations(blackFemaleNoseIdeal, blackFemaleNoseSeverity);
console.log('Test: Black Female, 48mm nose (IDEAL)');
console.log(`Recommendations: ${idealRecommendations.length}`);
console.log(`Expected: 0 (no rhinoplasty for ideal nose)`);
console.log(`âœ… PASS: ${idealRecommendations.length === 0 ? 'CORRECT - No inappropriate surgery suggestions' : 'âŒ FAILED - ' + idealRecommendations.length + ' suggestions'}`);

// Test case: White female with wide nose (MODERATE for her ethnicity)
const whiteFemaleNoseModerate = {
  'Nose Width': 48  // MODERATE for White females (ideal: 33-42mm)
};

const whiteFemaleNoseSeverity = {
  'Nose Width': 'moderate'
};

const moderateRecommendations = adviceEngine.getRecommendations(whiteFemaleNoseModerate, whiteFemaleNoseSeverity);
console.log('\nTest: White Female, 48mm nose (MODERATE)');
console.log(`Recommendations: ${moderateRecommendations.length}`);
console.log(`Expected: >0 (rhinoplasty may be suggested)`);
console.log(`âœ… PASS: ${moderateRecommendations.length > 0 ? 'CORRECT - Appropriate suggestions shown' : 'âŒ FAILED - No suggestions'}`);

// ============================================
// SUMMARY
// ============================================
console.log('\n\n' + '='.repeat(80));
console.log('ğŸ“Š TEST SUMMARY');
console.log('='.repeat(80));

const allTests = [
  femaleWhiteJaw,
  femaleBlackLips,
  femaleEastAsianEyes,
  femaleSouthAsianTears,
  femaleHispanicFWHR,
  femaleMiddleEasternTilt,
  femaleNativeAmericanFWHR,
  femalePacificIslanderCheeks
];

const passedTests = allTests.filter(t => t !== undefined).length;
const totalTests = 8;

console.log(`\nCore Metrics: ${passedTests}/${totalTests} female demographics working`);
console.log(`Advice Engine: ${idealRecommendations.length === 0 && moderateRecommendations.length > 0 ? 'âœ… PASS' : 'âŒ FAIL'}`);

if (passedTests === totalTests) {
  console.log('\nğŸ‰ ALL TESTS PASSED - Female flow is production ready!');
  console.log('\nâœ… Female users can now:');
  console.log('   1. Select "Female" gender (UI already enabled)');
  console.log('   2. Choose any of 8 ethnicities');
  console.log('   3. Get culturally appropriate, gender-specific scores');
  console.log('   4. Receive appropriate advice (no surgery for ideal features)');
  console.log('\nğŸš€ Ready to deploy!');
} else {
  console.log(`\nâš ï¸  ${totalTests - passedTests} tests failed - review issues above`);
}

console.log('\n' + '='.repeat(80));
