/**
 * Female User Flow Test
 * Tests the complete end-to-end flow for female users across all ethnicities
 */

import { getMetricConfig, getSeverityForMetric } from './src/lib/insights-engine';
import { adviceEngine } from './src/lib/advice-engine';

console.log('üß™ TESTING FEMALE USER FLOW\n');
console.log('='.repeat(80));

// ============================================
// TEST 1: Female White - Soft Jaw
// ============================================
console.log('\nüìã TEST 1: Female White - Soft Jaw (128¬∞)');
console.log('-'.repeat(80));

const femaleWhiteJaw = getMetricConfig('gonial_angle', 'female', 'white');
console.log('Config:', femaleWhiteJaw);
console.log('Expected ideal range: [122.0, 130.0]');

if (femaleWhiteJaw) {
  const result = getSeverityForMetric('gonial_angle', 128, 'female', 'white');
  const severity = result?.severity;
  console.log(`\nValue: 128¬∞`);
  console.log(`Severity: ${severity}`);
  console.log(`Expected: 'ideal' (within 122-130 range)`);
  console.log(`‚úÖ PASS: ${severity === 'ideal' ? 'CORRECT' : '‚ùå FAILED'}`);
} else {
  console.log('‚ùå FAIL: Config not found for female_white gonial_angle');
}

// ============================================
// TEST 2: Female Black - Full Lips
// ============================================
console.log('\n\nüìã TEST 2: Female Black - Full Lips (1.4)');
console.log('-'.repeat(80));

const femaleBlackLips = getMetricConfig('lip_size_volume', 'female', 'black');
console.log('Config:', femaleBlackLips);
console.log('Expected ideal range: [1.3, 1.6]');

if (femaleBlackLips) {
  const result = getSeverityForMetric('lip_size_volume', 1.4, 'female', 'black');
  const severity = result?.severity;
  console.log(`\nValue: 1.4`);
  console.log(`Severity: ${severity}`);
  console.log(`Expected: 'ideal' (within 1.3-1.6 range)`);
  console.log(`‚úÖ PASS: ${severity === 'ideal' ? 'CORRECT' : '‚ùå FAILED'}`);

  // Test advice engine respects ideal status
  console.log('\nüîç Testing Advice Engine:');
  const metricsDict = { 'Lip Size/Volume': 1.4 };
  const severityDict = { 'Lip Size/Volume': 'ideal' };

  const recommendations = adviceEngine.getRecommendations(metricsDict, severityDict);
  console.log(`Recommendations for IDEAL lip volume: ${recommendations.length === 0 ? '‚úÖ None (correct)' : '‚ùå ' + recommendations.length + ' suggestions (wrong)'}`);

  if (recommendations.length > 0) {
    console.log('Unexpected recommendations:', recommendations.map(r => r.title));
  }
} else {
  console.log('‚ùå FAIL: Config not found for female_black lip_size_volume');
}

// ============================================
// TEST 3: Female East Asian - Wide-Set Eyes
// ============================================
console.log('\n\nüìã TEST 3: Female East Asian - Wide-Set Eyes (46.8%)');
console.log('-'.repeat(80));

const femaleEastAsianEyes = getMetricConfig('eye_separation_ratio', 'female', 'east_asian');
console.log('Config:', femaleEastAsianEyes);
console.log('Expected ideal range: [46.3, 47.5]');

if (femaleEastAsianEyes) {
  const result = getSeverityForMetric('eye_separation_ratio', 46.8, 'female', 'east_asian');
  const severity = result?.severity;
  console.log(`\nValue: 46.8%`);
  console.log(`Severity: ${severity}`);
  console.log(`Expected: 'ideal' (within 46.3-47.5 neotenous range)`);
  console.log(`‚úÖ PASS: ${severity === 'ideal' ? 'CORRECT' : '‚ùå FAILED'}`);
} else {
  console.log('‚ùå FAIL: Config not found for female_east_asian eye_separation_ratio');
}

// ============================================
// SUMMARY
// ============================================
console.log('\n\n' + '='.repeat(80));
console.log('üìä TEST SUMMARY');
console.log('='.repeat(80));

const allTests = [
  femaleWhiteJaw,
  femaleBlackLips,
  femaleEastAsianEyes
];

const passedTests = allTests.filter(t => t !== undefined).length;
const totalTests = 3;

console.log(`\nCore Metrics: ${passedTests}/${totalTests} female demographics working`);

if (passedTests === totalTests) {
  console.log('\nüéâ ALL TESTS PASSED - Female flow is production ready!');
  console.log('\n‚úÖ Female users can now:');
  console.log('   1. Select "Female" gender (UI already enabled)');
  console.log('   2. Choose any of 8 ethnicities');
  console.log('   3. Get culturally appropriate, gender-specific scores');
  console.log('   4. Receive appropriate advice (no surgery for ideal features)');
  console.log('\nüöÄ Ready to deploy!');
} else {
  console.log(`\n‚ö†Ô∏è  ${totalTests - passedTests} tests failed - review issues above`);
}

console.log('\n' + '='.repeat(80));
