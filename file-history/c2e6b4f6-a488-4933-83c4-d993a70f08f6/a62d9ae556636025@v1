-- Migration: Forum enhancements - Female-specific, Grooming & Hygiene, Photography
-- Date: 2025-12-26
-- Description: Adds female-specific category, grooming/hygiene, and photography forums

-- ============== STEP 1: Add Female-Specific Category ==============
INSERT INTO forum_issue_categories (name, slug, description, icon, display_order) VALUES
    ('Female-Specific', 'female', 'Women''s beauty, hormonal health, and feminine optimization', 'üë©', 6)
ON CONFLICT (slug) DO UPDATE SET
    name = EXCLUDED.name,
    description = EXCLUDED.description,
    icon = EXCLUDED.icon,
    display_order = EXCLUDED.display_order;

-- Add Grooming & Hygiene category
INSERT INTO forum_issue_categories (name, slug, description, icon, display_order) VALUES
    ('Grooming & Hygiene', 'grooming-hygiene', 'Daily routines, oral care, and personal maintenance', 'üß¥', 7)
ON CONFLICT (slug) DO UPDATE SET
    name = EXCLUDED.name,
    description = EXCLUDED.description,
    icon = EXCLUDED.icon,
    display_order = EXCLUDED.display_order;

-- ============== STEP 2: Add Female-Specific Sub-forums ==============
INSERT INTO forum_sub_forums (issue_category_id, name, slug, description, icon, display_order) VALUES
    ((SELECT id FROM forum_issue_categories WHERE slug='female'), 'Hormonal Health', 'hormonal', 'PCOS, hormonal acne, and hormone balance', 'üíä', 1),
    ((SELECT id FROM forum_issue_categories WHERE slug='female'), 'Body Contouring', 'body-contouring', 'Gluteal augmentation, waist definition, and body shape', 'üçë', 2),
    ((SELECT id FROM forum_issue_categories WHERE slug='female'), 'Anti-Aging', 'anti-aging', 'Preventive aging, skincare, and treatments', '‚ú®', 3),
    ((SELECT id FROM forum_issue_categories WHERE slug='female'), 'Hair & Nails', 'hair-nails', 'Hair growth, extensions, and nail care', 'üíÖ', 4),
    ((SELECT id FROM forum_issue_categories WHERE slug='female'), 'Facial Feminization', 'feminization', 'Soft features, lip fillers, and feminine aesthetics', 'üëÑ', 5),
    ((SELECT id FROM forum_issue_categories WHERE slug='female'), 'Makeup & Lashes', 'makeup', 'Makeup techniques, lash extensions, and enhancement', 'üíÑ', 6)
ON CONFLICT (issue_category_id, slug) DO UPDATE SET
    name = EXCLUDED.name,
    description = EXCLUDED.description,
    icon = EXCLUDED.icon;

-- ============== STEP 3: Add Grooming & Hygiene Sub-forums ==============
INSERT INTO forum_sub_forums (issue_category_id, name, slug, description, icon, display_order) VALUES
    ((SELECT id FROM forum_issue_categories WHERE slug='grooming-hygiene'), 'Daily Routine', 'daily-routine', 'Morning and evening routines, habits', 'üåÖ', 1),
    ((SELECT id FROM forum_issue_categories WHERE slug='grooming-hygiene'), 'Oral Care', 'oral-care', 'Teeth whitening, breath, tongue scraping', 'ü¶∑', 2),
    ((SELECT id FROM forum_issue_categories WHERE slug='grooming-hygiene'), 'Body Odor', 'body-odor', 'Deodorant, sweating, and scent', 'üßº', 3),
    ((SELECT id FROM forum_issue_categories WHERE slug='grooming-hygiene'), 'Manscaping', 'manscaping', 'Body hair grooming and removal', '‚úÇÔ∏è', 4),
    ((SELECT id FROM forum_issue_categories WHERE slug='grooming-hygiene'), 'Eyebrows', 'eyebrows', 'Eyebrow shaping, microblading, and grooming', 'üëÅÔ∏è', 5)
ON CONFLICT (issue_category_id, slug) DO UPDATE SET
    name = EXCLUDED.name,
    description = EXCLUDED.description,
    icon = EXCLUDED.icon;

-- ============== STEP 4: Rename Sub-forums for Clarity ==============

-- Update naming in Facial Structure for clarity
UPDATE forum_sub_forums
SET name = 'Mewing & Jawline', description = 'Mewing technique, jaw exercises, gonial angle, and jaw development'
WHERE slug = 'jawline' AND issue_category_id = (SELECT id FROM forum_issue_categories WHERE slug='facial-structure');

-- Update Skin & Hair naming
UPDATE forum_sub_forums
SET name = 'Beard Growth'
WHERE slug = 'beard' AND issue_category_id = (SELECT id FROM forum_issue_categories WHERE slug='skin-hair');

UPDATE forum_sub_forums
SET name = 'Hair Loss & Treatments'
WHERE slug = 'hairloss' AND issue_category_id = (SELECT id FROM forum_issue_categories WHERE slug='skin-hair');

-- Update Medical naming
UPDATE forum_sub_forums
SET name = 'Facial Fillers'
WHERE slug = 'fillers' AND issue_category_id = (SELECT id FROM forum_issue_categories WHERE slug='medical');

-- Update Lifestyle naming
UPDATE forum_sub_forums
SET name = 'Photo Optimization', description = 'Photography, angles, lighting, and looking good in photos'
WHERE slug = 'photogenic' AND issue_category_id = (SELECT id FROM forum_issue_categories WHERE slug='lifestyle-style');

UPDATE forum_sub_forums
SET name = 'Social Skills & Confidence'
WHERE slug = 'confidence' AND issue_category_id = (SELECT id FROM forum_issue_categories WHERE slug='lifestyle-style');

-- ============== STEP 5: Add Missing High-Priority Sub-forums ==============

-- Add Styling Strategies to Skin & Hair (for hair loss styling)
INSERT INTO forum_sub_forums (issue_category_id, name, slug, description, icon, display_order) VALUES
    ((SELECT id FROM forum_issue_categories WHERE slug='skin-hair'), 'Hair Styling', 'hair-styling', 'Hairstyles, cuts, and styling for thinning hair', 'üíá‚Äç‚ôÇÔ∏è', 7)
ON CONFLICT (issue_category_id, slug) DO UPDATE SET
    name = EXCLUDED.name,
    description = EXCLUDED.description;

-- Add Posture & Breathing to Physique (already exists but ensure it's there)
INSERT INTO forum_sub_forums (issue_category_id, name, slug, description, icon, display_order) VALUES
    ((SELECT id FROM forum_issue_categories WHERE slug='physique-frame'), 'Posture & Breathing', 'posture-breathing', 'Posture correction, nasal breathing, and forward head posture', 'üßò', 8)
ON CONFLICT (issue_category_id, slug) DO UPDATE SET
    name = EXCLUDED.name,
    description = EXCLUDED.description;

-- ============== VERIFY ==============
SELECT 'Total Active Categories' as info, COUNT(*) as count FROM forum_issue_categories WHERE is_active = TRUE
UNION ALL
SELECT 'Total Sub-forums', COUNT(*) FROM forum_sub_forums sf
JOIN forum_issue_categories c ON sf.issue_category_id = c.id WHERE c.is_active = TRUE
UNION ALL
SELECT 'Female-Specific Subs', COUNT(*) FROM forum_sub_forums sf
JOIN forum_issue_categories c ON sf.issue_category_id = c.id WHERE c.slug = 'female';
