# Splice v3

Cloud-powered SaaS for Adobe Premiere Pro with AI-driven auto-cutting, take detection, and subscription billing.

## Monorepo Structure

```
/                         # Root
├── src/                  # Premiere Pro UXP Plugin
│   ├── components/
│   │   ├── panels/       # PluginApp (main container)
│   │   └── common/       # UI: Header, SelectionPanel, AIToolsPanel, AuthPanel, CuttingPanel
│   ├── types/            # TypeScript: plugin, api, premiere, audio, take-detection
│   ├── utils/
│   │   ├── api/          # premiere.ts, backend-client.ts, audio-processor.ts
│   │   └── helpers/      # formatters, validators
│   └── styles/           # Global CSS, Spectrum theming
│
├── backend/              # Node.js + Express API
│   └── src/
│       ├── routes/       # auth, billing, jobs, audio, usage
│       ├── controllers/  # Route handlers
│       ├── services/     # Business logic
│       ├── workers/      # BullMQ job processors (transcription, vocal isolation)
│       ├── db/           # migrations/, repositories/
│       └── middleware/   # auth, rate-limit, usage-limit
│
├── dashboard/            # Next.js Web Dashboard
│   └── app/              # login, signup, dashboard (usage, billing, settings)
│
├── tests/                # Vitest unit + Playwright e2e
└── public/               # manifest.json, icons
```

## Tech Stack

| Layer     | Stack                                                             |
| --------- | ----------------------------------------------------------------- |
| Plugin    | Lit 3.2 + Spectrum Web Components + TypeScript                    |
| Backend   | Node.js + Express + PostgreSQL + BullMQ/Redis                     |
| Dashboard | Next.js + React                                                   |
| Audio     | Whisper/Deepgram (transcription) + Demucs/Dolby (vocal isolation) |
| Payments  | Stripe                                                            |

## Code Quality - Zero Tolerance

After editing ANY file, run:

```bash
npm run lint
npm run typecheck
```

Fix ALL errors/warnings before continuing.

## Organization Rules

- **Plugin components** → `src/components/`, one per file
- **Backend routes** → `backend/src/routes/`, one per resource
- **Types** → `src/types/` or `backend/src/types/`, grouped by domain
- **Tests** → `tests/unit/` and `tests/e2e/`
- **Max file length: 300 lines** — Split into separate modules when exceeded

## UXP API Constraints

**Available:** `createSetNameAction`, `createInsertProjectItemAction`, `createRemoveItemsAction`, `createSetInPointAction/OutPointAction`, `ProjectItem.setColorLabel`

**NOT Available:** Razor/split (use remove+re-insert workaround), TrackItem colors (set on ProjectItem before insert), Audio waveforms (use FFmpeg externally)

## Pricing Tiers

| Plan       | Monthly   | Yearly (17% off) | Limit        |
| ---------- | --------- | ---------------- | ------------ |
| Free Trial | $0        | —                | 10 min total |
| Pro        | $29.99/mo | $298.70/yr       | 300 min/mo   |
| Enterprise | $69.99/mo | $697.10/yr       | 500 min/mo   |

## Stripe Configuration

| Item               | Value                            |
| ------------------ | -------------------------------- |
| Pro Monthly        | `price_1Sf3te2L5BseYEbCr6dUdwrD` |
| Pro Yearly         | `price_1Sf3vE2L5BseYEbC2v1whC72` |
| Enterprise Monthly | `price_1Sf3tg2L5BseYEbCMkv9AgVD` |
| Enterprise Yearly  | `price_1Sf3vG2L5BseYEbCkACPluoj` |

## Current Focus

Section: Phase 2 - Plugin Integration
Files: `src/utils/api/backend-client.ts`, `src/components/common/AuthPanel.ts`

## Last Session (2025-12-16)

- Built complete Next.js dashboard with auth, billing, and usage pages
- Fixed critical API response wrapper mismatch (backend returns `{success, data}`)
- Fixed UsageStats type mismatch (`currentUsage` vs `used`)
- Added monthly/yearly billing toggle to billing page
- Dashboard runs on port 3000, backend on port 3001
- Stopped at: Dashboard complete, ready for plugin integration

## Dashboard Pages

| Page | Route | Features |
|------|-------|----------|
| Login | `/login` | Email/password auth, JWT tokens |
| Signup | `/signup` | Registration with password validation |
| Overview | `/dashboard` | Usage stats, plan status, quick actions |
| Usage | `/dashboard/usage` | Detailed usage stats, reset date |
| Billing | `/dashboard/billing` | Monthly/yearly toggle, Stripe checkout |
| Settings | `/dashboard/settings` | Profile, logout, danger zone |

## Audio API Endpoints

| Endpoint                     | Method | Auth     | Description                             |
| ---------------------------- | ------ | -------- | --------------------------------------- |
| `/api/audio/check?minutes=N` | GET    | Required | Pre-flight check if user can submit job |
| `/api/audio/jobs`            | GET    | Required | List user's audio jobs                  |
| `/api/audio/jobs/:jobId`     | GET    | Required | Get specific job status                 |
| `/api/audio/transcribe`      | POST   | Required | Submit transcription job                |
| `/api/audio/isolate-vocals`  | POST   | Required | Submit vocal isolation job              |

## Environment Variables (Audio)

```
DEEPGRAM_API_KEY=     # For cloud transcription
DOLBY_API_KEY=        # For vocal isolation
WHISPER_API_URL=      # Self-hosted Whisper (optional)
DEMUCS_API_URL=       # Self-hosted Demucs (optional)
```

## Next Steps

1. Create plugin backend client (`src/utils/api/backend-client.ts`)
2. Add auth UI to plugin (`src/components/common/AuthPanel.ts`)
3. Add file upload support for audio (S3 or similar)
4. Add job progress notifications (WebSocket or polling)
