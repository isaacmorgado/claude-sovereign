/**
 * SPLICE Website E2E Tests - Download Page
 * Tests for plugin downloads and installation guides
 */

const fs = require("fs");
const path = require("path");

let passed = 0;
let failed = 0;

function test(name, fn) {
  try {
    fn();
    console.log(`  ✓ ${name}`);
    passed++;
  } catch (error) {
    console.log(`  ✗ ${name}`);
    console.log(`    Error: ${error.message}`);
    failed++;
  }
}

function assert(condition, message) {
  if (!condition) {
    throw new Error(message || "Assertion failed");
  }
}

console.log("\n=== Download Page E2E Tests ===\n");

const downloadPage = fs.readFileSync(
  path.join(__dirname, "..", "src", "app", "download", "page.tsx"),
  "utf8"
);

// ============================================
// Version Tests
// ============================================
console.log("Plugin Versions:");

test("Shows UXP version", () => {
  assert(downloadPage.includes("SPLICE for UXP"), "Missing UXP version");
  assert(downloadPage.includes("v5.6.0"), "Missing version number");
});

test("Shows CEP version", () => {
  assert(downloadPage.includes("SPLICE for CEP"), "Missing CEP version");
});

test("UXP marked as recommended", () => {
  assert(downloadPage.includes("Recommended"), "Missing Recommended badge");
});

test("Shows compatibility info", () => {
  assert(downloadPage.includes("Premiere Pro 25.6+"), "Missing UXP compatibility");
  assert(downloadPage.includes("Premiere Pro 14.0"), "Missing CEP compatibility");
});

test("Has download URLs", () => {
  assert(downloadPage.includes("downloadUrl"), "Missing download URLs");
  assert(downloadPage.includes(".zip"), "Missing ZIP format");
});

test("Lists version features", () => {
  assert(downloadPage.includes("Faster performance"), "Missing UXP feature");
  assert(downloadPage.includes("Future-proof"), "Missing future-proof mention");
  assert(downloadPage.includes("legacy"), "Missing legacy mention for CEP");
});

// ============================================
// Installation Guide Tests
// ============================================
console.log("\nInstallation Guide:");

test("Has OS selector", () => {
  assert(downloadPage.includes("macOS"), "Missing macOS option");
  assert(downloadPage.includes("Windows"), "Missing Windows option");
});

test("Has version selector", () => {
  assert(downloadPage.includes("selectedVersion"), "Missing version selector");
  assert(downloadPage.includes("uxp") && downloadPage.includes("cep"), "Missing version options");
});

test("Has numbered steps", () => {
  assert(downloadPage.includes("step: 1"), "Missing step 1");
  assert(downloadPage.includes("step: 2"), "Missing step 2");
  assert(downloadPage.includes("step: 3"), "Missing step 3");
  assert(downloadPage.includes("step: 4"), "Missing step 4");
});

test("UXP mac has correct steps", () => {
  assert(downloadPage.includes("Download and extract"), "Missing download step");
  assert(downloadPage.includes("UXP Developer Tool"), "Missing UXP dev tool step");
  assert(downloadPage.includes("Activate your license"), "Missing activation step");
});

test("CEP mac has terminal commands", () => {
  assert(
    downloadPage.includes("cp -r splice-cep"),
    "Missing copy command"
  );
  assert(
    downloadPage.includes("defaults write"),
    "Missing debug mode command"
  );
});

test("CEP mentions CSXS debug mode", () => {
  assert(downloadPage.includes("PlayerDebugMode"), "Missing PlayerDebugMode");
  assert(downloadPage.includes("unsigned extensions"), "Missing unsigned extensions");
});

test("Has copy to clipboard for commands", () => {
  assert(downloadPage.includes("copyToClipboard"), "Missing copy function");
  assert(downloadPage.includes("Copy"), "Missing Copy icon");
});

test("Has code blocks with terminal commands", () => {
  assert(downloadPage.includes("<pre"), "Missing pre tags");
  assert(downloadPage.includes("font-mono"), "Missing monospace font");
});

// ============================================
// Help Section Tests
// ============================================
console.log("\nHelp Section:");

test("Has help callout", () => {
  assert(downloadPage.includes("Need help"), "Missing help callout");
});

test("Links to documentation", () => {
  assert(downloadPage.includes("/docs/installation"), "Missing docs link");
});

test("Has support email", () => {
  assert(downloadPage.includes("support@"), "Missing support email");
});

// ============================================
// CTA Tests
// ============================================
console.log("\nCTAs:");

test("Has download buttons", () => {
  assert(downloadPage.includes("Download"), "Missing download buttons");
});

test("Has pricing link for non-licensed users", () => {
  assert(downloadPage.includes("/pricing"), "Missing pricing link");
  assert(
    downloadPage.includes("license yet") || downloadPage.includes("View Pricing"),
    "Missing license CTA"
  );
});

// ============================================
// UI Components Tests
// ============================================
console.log("\nUI Components:");

test("Has proper icons", () => {
  assert(downloadPage.includes("Download"), "Missing Download icon");
  assert(downloadPage.includes("Apple"), "Missing Apple icon");
  assert(downloadPage.includes("CheckCircle"), "Missing CheckCircle icon");
});

test("Has Card components", () => {
  assert(downloadPage.includes("Card"), "Missing Card component");
  assert(downloadPage.includes("CardHeader"), "Missing CardHeader");
  assert(downloadPage.includes("CardContent"), "Missing CardContent");
});

test("Has proper badges", () => {
  assert(downloadPage.includes("Badge"), "Missing Badge component");
  assert(downloadPage.includes("badgeColor"), "Missing badge colors");
});

test("Uses Framer Motion", () => {
  assert(downloadPage.includes("motion"), "Missing motion animations");
});

// ============================================
// Results
// ============================================
console.log("\n========================================");
console.log(`Download Page Tests: ${passed} passed, ${failed} failed`);
console.log("========================================\n");

process.exit(failed > 0 ? 1 : 0);
