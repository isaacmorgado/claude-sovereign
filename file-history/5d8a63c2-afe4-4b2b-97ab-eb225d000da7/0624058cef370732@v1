# Feature Implementation Prompt Template

Use this prompt to implement new features with full E2E testing, bottleneck detection, and optimization.

---

## The Prompt

```
Implement [FEATURE_NAME] following this systematic process:

## Phase 1: Backend Implementation

### Step 1: Architecture Review
1. Read the feature specification from [SPEC_FILE_PATH]
2. Explore the current codebase architecture to understand patterns
3. Check existing models, schemas, routers for patterns to follow
4. Identify which files need to be created/modified

### Step 2: Database Layer
1. Create database models in `app/models/[feature].py`
2. Add any required enums or types
3. Create SQL migration file in `migrations/XXX_add_[feature]_tables.sql`
4. Include seed data if required
5. Run migration on Railway database

### Step 3: API Layer
1. Create Pydantic schemas in `app/schemas/[feature].py`
2. Create router with all endpoints in `app/routers/[feature].py`
3. Update `app/models/__init__.py` to export new models
4. Update `app/routers/__init__.py` to export new router
5. Register router in `app/main.py`

### Step 4: E2E Test - Database
After each database change:
1. Verify migration ran successfully
2. Query database to confirm tables and seed data exist
3. Check indexes are created

### Step 5: E2E Test - API Endpoints
1. Test all public endpoints (no auth required)
2. Test authentication is required where expected
3. Test 404 handling for non-existent resources
4. Test validation (bad input returns 400/422)
5. Test authorization (moderator-only endpoints)

### Step 6: Performance Analysis
Run load profiling on critical endpoints:
1. Measure baseline latency (single request, 5 samples)
2. Measure concurrent load (10, 25, 50, 100 parallel requests)
3. Identify N+1 query patterns
4. Check response payload sizes
5. Look for missing indexes

### Step 7: Bottleneck Fixes
For each bottleneck found:
1. Document the issue (location, impact, root cause)
2. Implement the fix
3. Re-run performance test to verify improvement
4. Only proceed when performance targets are met

Performance Targets:
- Single request: <200ms
- 10 concurrent: <500ms average
- 100 concurrent: <1s average
- Success rate: 100%

### Step 8: Final Validation
1. Run complete E2E test suite
2. Verify all endpoints working
3. Confirm no regressions
4. Commit with descriptive message
5. Deploy to production
6. Verify deployment with production tests

---

## Phase 2: Frontend Implementation

### Step 1: Types
1. Create TypeScript types in `src/types/[feature].ts`
2. Match backend Pydantic schemas exactly

### Step 2: API Client
1. Add API methods to `src/lib/api.ts`
2. Follow existing patterns for auth headers

### Step 3: Context (if needed)
1. Create `src/contexts/[Feature]Context.tsx`
2. Add provider to `src/components/Providers.tsx`

### Step 4: Pages
1. Create page routes in `src/app/[feature]/`
2. Follow Next.js 14 App Router patterns

### Step 5: Components
1. Create components in `src/components/[feature]/`
2. Use Tailwind CSS with existing theme
3. Use Framer Motion for animations

### Step 6: E2E Test - UI
1. Test all pages render correctly
2. Test navigation flows
3. Check for console errors
4. Verify API calls succeed
5. Test error states

### Step 7: Performance
1. Run Lighthouse audit
2. Check bundle size impact
3. Verify lazy loading works

---

## Output Requirements

After implementation, provide:
1. List of all files created/modified
2. Summary of database changes
3. API endpoints created with test results
4. Bottlenecks found and fixed
5. Performance before/after metrics
6. Deployment status
```

---

## Example Usage

### For Forum Feature:
```
Implement the Reddit-style community forum following this systematic process:

## Phase 1: Backend Implementation

Read the feature specification from /Users/imorgado/LOOKSMAXX/forum.md
[... rest of prompt ...]
```

### For E-commerce Feature:
```
Implement the supplement e-commerce layer following this systematic process:

## Phase 1: Backend Implementation

Read the feature specification from /Users/imorgado/LOOKSMAXX/supplement_implementation.md
[... rest of prompt ...]
```

---

## Key Principles

1. **Test after each step** - Don't batch testing
2. **Fix bottlenecks immediately** - Don't proceed with poor performance
3. **Use existing patterns** - Follow codebase conventions
4. **Document everything** - Leave clear commit messages
5. **Verify in production** - Don't assume local = production

---

## Performance Thresholds

| Metric | Target | Action if Exceeded |
|--------|--------|-------------------|
| Single request latency | <200ms | Optimize queries |
| 10 concurrent avg | <500ms | Check connection pool |
| 100 concurrent avg | <1s | Add caching |
| Response size | <50KB | Add pagination/compression |
| DB queries per request | <5 | Fix N+1 patterns |
| Success rate | 100% | Debug failures |

---

## Bottleneck Patterns to Check

### Database
- [ ] N+1 query patterns (use batch queries)
- [ ] Missing indexes on WHERE/JOIN columns
- [ ] Large result sets without pagination
- [ ] Connection pool exhaustion

### API
- [ ] No caching headers
- [ ] No gzip compression
- [ ] Synchronous operations that could be async
- [ ] Missing rate limiting

### Frontend
- [ ] Large bundle sizes
- [ ] No lazy loading
- [ ] Unoptimized images
- [ ] Too many re-renders
