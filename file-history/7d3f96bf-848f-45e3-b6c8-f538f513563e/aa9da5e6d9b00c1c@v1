# Forum Implementation Plan: Personalized Looksmaxxing Community

## Overview

Build a personalized forum/guides system where users are recommended specific forums based on their detected flaws/issues from the facial analysis. The forum covers the complete looksmaxxing spectrum beyond just facial metrics.

---

## Forum Structure (12 Main Categories + Sub-Forums)

### Issue Categories â†’ Sub-Forums

| # | Issue Category | Sub-Forums | Maps From Analysis |
|---|----------------|------------|-------------------|
| 1 | **Skinny/Fat (Body Composition)** | Nutrition, Training, Pharma, Frame | *(New - not in current analysis)* |
| 2 | **Weak Bone Structure** | Teeth, Jawline, Sculpting, Surgery | Weak Jaw, Narrow Jaw, Recessed Chin, Mandibular Recession |
| 3 | **Poor Skin Complexion** | Nutrition, Skincare, Pharma | *(New - not in current analysis)* |
| 4 | **Teeth/Smile Issues** | Teeth, Surgery | *(New - limited in current analysis)* |
| 5 | **Weak Eye Area** | Eyebrows, Eyelashes, Eyes, Aesthetics, Surgery | Negative Canthal Tilt, Small Eyes, Low-Set Eyebrows |
| 6 | **Short Height/Narrow Frame** | Frame, Biohacking, Pharma, Surgery | *(New - not in current analysis)* |
| 7 | **Bloated/Face Fat** | Nutrition, Sculpting, Surgery | Flat Midface, Long Face *(partial)* |
| 8 | **Poor Fashion Sense** | Archetype, Styling, Appeal | *(New - not in current analysis)* |
| 9 | **Hair Thinning/Recession** | Hairstyle, Pharma, Surgery | *(New - not in current analysis)* |
| 10 | **Narrow/Thin Lips** | Lips, Aesthetics, Surgery | Thin Lip Profile, Long Philtrum |
| 11 | **Anxiety/High Inhibition** | Charisma, Aesthetics, Surgery | *(New - not in current analysis)* |
| 12 | **Low Social Media Presence** | Charisma, Appeal, Frauding, Dynamics | *(New - not in current analysis)* |

---

## Database Schema

### Tables

```sql
-- Main issue categories (the 12 categories)
forum_issue_categories (
  id UUID PRIMARY KEY,
  name VARCHAR(100),           -- "Weak Bone Structure"
  slug VARCHAR(50) UNIQUE,     -- "weak-bone-structure"
  description TEXT,
  icon VARCHAR(10),            -- Emoji
  display_order INT,
  is_active BOOLEAN DEFAULT TRUE
)

-- Sub-forums under each issue category
forum_sub_forums (
  id UUID PRIMARY KEY,
  issue_category_id UUID REFERENCES forum_issue_categories(id),
  name VARCHAR(100),           -- "Jawline"
  slug VARCHAR(50),            -- "jawline"
  description TEXT,
  icon VARCHAR(10),
  display_order INT,
  is_active BOOLEAN DEFAULT TRUE,
  UNIQUE(issue_category_id, slug)
)

-- Mapping: Analysis flaws â†’ Issue categories
flaw_to_forum_mapping (
  id UUID PRIMARY KEY,
  flaw_id VARCHAR(100),        -- "weak_jaw", "negative_canthal_tilt"
  issue_category_id UUID REFERENCES forum_issue_categories(id),
  priority INT DEFAULT 1       -- Primary (1) vs secondary (2) recommendation
)

-- Posts in sub-forums
forum_posts (
  id UUID PRIMARY KEY,
  sub_forum_id UUID REFERENCES forum_sub_forums(id),
  author_id UUID REFERENCES users(id),
  title VARCHAR(200),
  content TEXT,
  is_pinned BOOLEAN DEFAULT FALSE,
  is_guide BOOLEAN DEFAULT FALSE,
  vote_count INT DEFAULT 0,
  comment_count INT DEFAULT 0,
  created_at TIMESTAMP,
  updated_at TIMESTAMP
)

-- Comments, Votes, Reports (same as forum.md)
```

### Seed Data: Issue Categories

```sql
INSERT INTO forum_issue_categories (name, slug, icon, display_order) VALUES
('Skinny/Fat (Body Composition)', 'body-composition', 'ğŸ’ª', 1),
('Weak Bone Structure', 'weak-bone-structure', 'ğŸ¦´', 2),
('Poor Skin Complexion', 'poor-skin', 'âœ¨', 3),
('Teeth/Smile Issues', 'teeth-smile', 'ğŸ˜', 4),
('Weak Eye Area', 'weak-eyes', 'ğŸ‘ï¸', 5),
('Short Height/Narrow Frame', 'height-frame', 'ğŸ“', 6),
('Bloated/Face Fat', 'face-fat', 'ğŸ’§', 7),
('Poor Fashion Sense', 'fashion', 'ğŸ‘”', 8),
('Hair Thinning/Recession', 'hair-loss', 'ğŸ’‡', 9),
('Narrow/Thin Lips', 'thin-lips', 'ğŸ‘„', 10),
('Anxiety/High Inhibition', 'anxiety', 'ğŸ§ ', 11),
('Low Social Media Presence', 'social-media', 'ğŸ“±', 12);
```

### Seed Data: Sub-Forums

```sql
-- Body Composition
INSERT INTO forum_sub_forums (issue_category_id, name, slug, display_order) VALUES
((SELECT id FROM forum_issue_categories WHERE slug='body-composition'), 'Nutrition', 'nutrition', 1),
((SELECT id FROM forum_issue_categories WHERE slug='body-composition'), 'Training', 'training', 2),
((SELECT id FROM forum_issue_categories WHERE slug='body-composition'), 'Pharma', 'pharma', 3),
((SELECT id FROM forum_issue_categories WHERE slug='body-composition'), 'Frame', 'frame', 4);

-- Weak Bone Structure
INSERT INTO forum_sub_forums (issue_category_id, name, slug, display_order) VALUES
((SELECT id FROM forum_issue_categories WHERE slug='weak-bone-structure'), 'Teeth', 'teeth', 1),
((SELECT id FROM forum_issue_categories WHERE slug='weak-bone-structure'), 'Jawline', 'jawline', 2),
((SELECT id FROM forum_issue_categories WHERE slug='weak-bone-structure'), 'Sculpting', 'sculpting', 3),
((SELECT id FROM forum_issue_categories WHERE slug='weak-bone-structure'), 'Surgery', 'surgery', 4);

-- ... (continue for all 12 categories)
```

---

## Flaw â†’ Forum Mapping

Map existing analysis flaws to forum categories:

```sql
-- Weak Bone Structure mappings
INSERT INTO flaw_to_forum_mapping (flaw_id, issue_category_id, priority) VALUES
('weak_jaw', (SELECT id FROM forum_issue_categories WHERE slug='weak-bone-structure'), 1),
('narrow_jaw', (SELECT id FROM forum_issue_categories WHERE slug='weak-bone-structure'), 1),
('recessed_chin', (SELECT id FROM forum_issue_categories WHERE slug='weak-bone-structure'), 1),
('mandibular_recession', (SELECT id FROM forum_issue_categories WHERE slug='weak-bone-structure'), 1),
('steep_mandibular_plane', (SELECT id FROM forum_issue_categories WHERE slug='weak-bone-structure'), 2);

-- Weak Eye Area mappings
INSERT INTO flaw_to_forum_mapping (flaw_id, issue_category_id, priority) VALUES
('negative_canthal_tilt', (SELECT id FROM forum_issue_categories WHERE slug='weak-eyes'), 1),
('small_eyes', (SELECT id FROM forum_issue_categories WHERE slug='weak-eyes'), 1),
('low_set_eyebrows', (SELECT id FROM forum_issue_categories WHERE slug='weak-eyes'), 1),
('wide_set_eyes', (SELECT id FROM forum_issue_categories WHERE slug='weak-eyes'), 2),
('close_set_eyes', (SELECT id FROM forum_issue_categories WHERE slug='weak-eyes'), 2);

-- Thin Lips mappings
INSERT INTO flaw_to_forum_mapping (flaw_id, issue_category_id, priority) VALUES
('thin_lip_profile', (SELECT id FROM forum_issue_categories WHERE slug='thin-lips'), 1),
('long_philtrum', (SELECT id FROM forum_issue_categories WHERE slug='thin-lips'), 2);

-- Face Fat/Bloating mappings
INSERT INTO flaw_to_forum_mapping (flaw_id, issue_category_id, priority) VALUES
('flat_midface', (SELECT id FROM forum_issue_categories WHERE slug='face-fat'), 2),
('long_face', (SELECT id FROM forum_issue_categories WHERE slug='face-fat'), 2);
```

---

## API Endpoints

### New Endpoints

| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | `/forum/issue-categories` | List all 12 issue categories with sub-forum counts |
| GET | `/forum/issue-categories/{slug}` | Get category details with sub-forums |
| GET | `/forum/issue-categories/{slug}/sub-forums/{subSlug}/posts` | Posts in sub-forum |
| GET | `/forum/recommended` | **Personalized recommendations based on user's flaws** |
| GET | `/forum/guides` | Featured guides across all categories |

### Personalized Recommendations Endpoint

```python
@router.get("/forum/recommended")
async def get_recommended_forums(
    current_user: User = Depends(get_current_user),
    db: AsyncSession = Depends(get_db),
):
    """
    Returns forum categories recommended based on user's detected flaws.

    1. Get user's latest analysis
    2. Extract detected flaws
    3. Map flaws â†’ issue categories via flaw_to_forum_mapping
    4. Return ranked list of recommended categories + sub-forums
    """
    # Get user's latest analysis
    analysis = await get_latest_analysis(current_user.id, db)

    if not analysis:
        # Return all categories if no analysis
        return await list_all_categories(db)

    # Extract flaw IDs from analysis
    flaws = analysis.flaws or []
    flaw_ids = [f['id'] for f in flaws]

    # Get mapped issue categories
    query = (
        select(ForumIssueCategory, FlawToForumMapping.priority)
        .join(FlawToForumMapping)
        .where(FlawToForumMapping.flaw_id.in_(flaw_ids))
        .order_by(FlawToForumMapping.priority, ForumIssueCategory.display_order)
    )

    result = await db.execute(query)

    return {
        "recommended": [...],  # Matched categories
        "other": [...]         # Remaining categories
    }
```

---

## Frontend Routes

```
/forum                                    - Forum home (recommended + browse)
/forum/category/[slug]                    - Issue category (shows sub-forums)
/forum/category/[slug]/[subSlug]          - Sub-forum posts list
/forum/category/[slug]/[subSlug]/post/[id] - Single post
/forum/new?category=...&subforum=...      - Create post
```

---

## UI Layout

### Forum Home (`/forum`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ¯ RECOMMENDED FOR YOU                                     â”‚
â”‚  Based on your analysis results                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”‚
â”‚ â”‚ ğŸ¦´ Weak     â”‚ â”‚ ğŸ‘ï¸ Weak Eye â”‚ â”‚ ğŸ‘„ Thin    â”‚            â”‚
â”‚ â”‚ Bone        â”‚ â”‚ Area        â”‚ â”‚ Lips       â”‚            â”‚
â”‚ â”‚ Structure   â”‚ â”‚             â”‚ â”‚            â”‚            â”‚
â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚ â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ â”‚            â”‚
â”‚ â”‚ â€¢ Jawline  â”‚ â”‚ â€¢ Eyes     â”‚ â”‚ â€¢ Lips     â”‚            â”‚
â”‚ â”‚ â€¢ Surgery  â”‚ â”‚ â€¢ Eyebrows â”‚ â”‚ â€¢ Surgery  â”‚            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“š BROWSE ALL CATEGORIES                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ [Grid of all 12 categories with icons]                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Category Page (`/forum/category/weak-bone-structure`)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¦´ Weak Bone Structure                                      â”‚
â”‚ Improve your jaw, facial structure, and bone development   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  SUB-FORUMS                                                 â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ ğŸ¦· Teeth   â”‚ â”‚ ğŸ’ª Jawline â”‚ â”‚ ğŸ¨ Sculptingâ”‚ â”‚ğŸ”ªSurgeryâ”‚â”‚
â”‚ â”‚ 42 posts   â”‚ â”‚ 128 posts  â”‚ â”‚ 67 posts   â”‚ â”‚ 89 postsâ”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ğŸ“Œ PINNED GUIDES                                           â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚ â”‚ â­ Complete Jawline Guide 2024 | â–² 234 | ğŸ’¬ 56         â”‚â”‚
â”‚ â”‚ â­ Mewing Technique Masterclass | â–² 189 | ğŸ’¬ 43        â”‚â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Implementation Steps

### Phase 1: Backend Schema & Migration
1. Create `forum_issue_categories` table
2. Create `forum_sub_forums` table
3. Create `flaw_to_forum_mapping` table
4. Update `forum_posts` to reference `sub_forum_id`
5. Seed all 12 categories + sub-forums
6. Seed flaw â†’ category mappings

### Phase 2: Backend API
1. Issue categories CRUD endpoints
2. Sub-forum endpoints
3. **Personalized `/forum/recommended` endpoint**
4. Update existing forum endpoints for new structure

### Phase 3: Frontend
1. Update forum types for new structure
2. Create `RecommendedSection` component
3. Create `IssueCategoryCard` component
4. Create `SubForumGrid` component
5. Update routing for new URL structure

### Phase 4: Integration
1. Connect Results page â†’ Forum recommendations
2. Add "Get Help" CTA on flaw cards â†’ links to relevant forum
3. Show recommended forums on user dashboard

---

## Critical Files to Modify

### Backend
- `looksmaxx-api/app/models/forum.py` - Add new models
- `looksmaxx-api/app/routers/forum.py` - Add new endpoints
- `looksmaxx-api/app/schemas/forum.py` - Add new schemas
- `looksmaxx-api/migrations/` - New migration file

### Frontend
- `looksmaxx-app/src/types/forum.ts` - Update types
- `looksmaxx-app/src/lib/api.ts` - Add API methods
- `looksmaxx-app/src/contexts/ForumContext.tsx` - Update state
- `looksmaxx-app/src/app/forum/` - Update pages
- `looksmaxx-app/src/components/forum/` - New components

---

## Questions for User

1. Should users see ALL categories or only recommended ones initially?
2. Should non-analyzed users (no analysis yet) still access forums?
3. Priority of implementation: personalized recommendations vs basic forum first?
