# SPLICE Project Guidelines

## Coding Standards
- Use modern JavaScript/TypeScript patterns.
- Ensure all error handling is verbose and descriptive.
- Prefer functional components for React parts.

## Development Environment
- This is a local development environment.
- All code is executed in a sandboxed simulation.
- Mock APIs are available in `mock-api.js`.

## Output Preferences
- When providing code, prefer complete files over snippets to facilitate copy-pasting.
- Focus on technical implementation details.

---

## Security Audit Status (2025-12-29)

### Backend Authentication
| Item | Status | Location |
|------|--------|----------|
| JWT token generation | ✅ Done | `middleware/auth.js:33-56` |
| Token verification | ✅ Done | `middleware/auth.js:61-74` |
| Login endpoint | ✅ Done | `routes/auth.js:30-80` |
| Refresh token endpoint | ✅ Done | `routes/auth.js:85-120` |
| Token blacklisting | ❌ Pending | `routes/auth.js:137` - TODO comment |
| Revocation check in middleware | ❌ Pending | `middleware/auth.js:128-175` |

### Frontend Authentication
| Item | Status | Location |
|------|--------|----------|
| Login page UI | ✅ Done | `splice-website/src/app/login/page.tsx` |
| Real auth integration | ❌ Demo | Shows alert "This is a demo login page" |
| Token storage | ❌ Pending | No implementation |
| Auth context/provider | ❌ Pending | Not created |

### Music Credits - Race Conditions
| Item | Status | Location |
|------|--------|----------|
| `deductMusicCredit` | ✅ Safe | `usageTracking.js:1007-1075` - uses SELECT...FOR UPDATE |
| `deductVariationsCredit` | ✅ Safe | `usageTracking.js:1229-1311` |
| `deductSceneAwareCredit` | ✅ Safe | `usageTracking.js:1339-1421` |
| `addMusicCredits` | ❌ Race condition | `usageTracking.js:1102-1120` - no transaction |
| `resetMusicCredits` | ❌ Race condition | `usageTracking.js:1082-1093` - no transaction |

### Contact Form
| Item | Status | Location |
|------|--------|----------|
| Contact form UI | ✅ Done | `splice-website/src/app/contact/page.tsx` |
| Form submission handler | ❌ Console only | Line 49-54 only logs |
| API endpoint | ❌ Missing | No `/api/contact/route.ts` |
| Email notification | ✅ Ready | `emailService.js` has `sendEmail()` |

### Email Service
| Item | Status | Location |
|------|--------|----------|
| SendGrid implementation | ✅ Done | `services/emailService.js` |
| AWS SES fallback | ✅ Done | `services/emailService.js` |
| Email templates | ✅ Done | License, Payment Warning, Sign-in Code |
| ENV variables documented | ❌ Missing | `.env.template` lacks EMAIL_PROVIDER, SENDGRID_API_KEY |
| Production configuration | ❌ Not set | Currently in 'console' mode |

### Required ENV Variables for Email
```
EMAIL_PROVIDER=sendgrid
SENDGRID_API_KEY=SG_your_key_here
EMAIL_FROM=SPLICE <noreply@splice.video>
EMAIL_REPLY_TO=support@splice.video
```
