#!/bin/bash

# MediaVault Quick Download Script
# Usage: ./download.sh [VIDEO_URL] [type]
# Types: mp3, mp4, both

VAULT_DIR="$HOME/Desktop/MediaVault"
URL=$1
TYPE=${2:-mp3}  # Default to mp3

if [ -z "$URL" ]; then
    echo "‚ùå Error: Please provide a YouTube URL"
    echo ""
    echo "Usage:"
    echo "  ./download.sh [VIDEO_URL] [type]"
    echo ""
    echo "Types:"
    echo "  mp3  - Download audio only (default)"
    echo "  mp4  - Download video only"
    echo "  both - Download both audio and video"
    echo ""
    echo "Examples:"
    echo "  ./download.sh 'https://youtube.com/watch?v=...' mp3"
    echo "  ./download.sh 'https://youtube.com/watch?v=...' both"
    exit 1
fi

echo "üé¨ MediaVault Downloader"
echo "========================"
echo "URL: $URL"
echo "Type: $TYPE"
echo ""

# Download MP3
if [ "$TYPE" == "mp3" ] || [ "$TYPE" == "both" ]; then
    echo "üéµ Downloading MP3..."
    yt-dlp -x --audio-format mp3 \
        -o "$VAULT_DIR/Audio/MP3/%(title)s.%(ext)s" \
        --write-auto-sub --write-sub \
        --sub-format srt --convert-subs srt \
        --write-description \
        --write-info-json \
        --write-thumbnail \
        "$URL"
    echo ""
fi

# Download MP4
if [ "$TYPE" == "mp4" ] || [ "$TYPE" == "both" ]; then
    echo "üé• Downloading MP4..."
    yt-dlp -f "bestvideo[ext=mp4]+bestaudio[ext=m4a]/best[ext=mp4]" \
        -o "$VAULT_DIR/Video/MP4/%(title)s.%(ext)s" \
        --write-auto-sub --write-sub \
        --sub-format srt --convert-subs srt \
        --write-description \
        --write-info-json \
        --write-thumbnail \
        "$URL"
    echo ""
fi

# Auto-organize
echo "üóÇÔ∏è  Organizing files..."
"$VAULT_DIR/organize-downloads.sh"

echo ""
echo "‚úÖ Download complete!"
echo "üìÅ Check your MediaVault folder"
