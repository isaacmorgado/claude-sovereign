#!/usr/bin/env python3
"""
Simple wrapper to call RunPod models from command line
Usage: python runpod-wrapper.py architect "Design a REST API"
"""

import os
import sys
import requests
import json

# Configuration
ENDPOINTS = {
    "architect": {
        "id": "YOUR_ENDPOINT_ID_1",
        "model": "huihui-ai/DeepSeek-R1-Distill-Qwen-32B-abliterated",
        "description": "Architecture, debugging, reverse engineering"
    },
    "code": {
        "id": "YOUR_ENDPOINT_ID_2",
        "model": "huihui-ai/Huihui-Qwen3-Coder-30B-A3B-Instruct-abliterated",
        "description": "Code implementation"
    },
    "research": {
        "id": "YOUR_ENDPOINT_ID_3",
        "model": "huihui-ai/Huihui-Qwen3-Next-80B-A3B-Thinking-Abliterated",
        "description": "Deep research and analysis"
    },
    "quick": {
        "id": "YOUR_ENDPOINT_ID_4",
        "model": "DavidAU/Qwen3-4B-Thinking-2507-Claude-4.5-Opus-High-Reasoning-Distill-Heretic-Abliterated",
        "description": "Quick questions"
    }
}

RUNPOD_API_KEY = os.getenv("RUNPOD_API_KEY", "YOUR_RUNPOD_API_KEY")


def call_model(mode: str, prompt: str, temperature: float = 0.7):
    """Call a RunPod model endpoint"""

    if mode not in ENDPOINTS:
        print(f"Error: Unknown mode '{mode}'")
        print(f"Available modes: {', '.join(ENDPOINTS.keys())}")
        sys.exit(1)

    endpoint = ENDPOINTS[mode]
    url = f"https://api.runpod.ai/v2/{endpoint['id']}/openai/v1/chat/completions"

    headers = {
        "Authorization": f"Bearer {RUNPOD_API_KEY}",
        "Content-Type": "application/json"
    }

    data = {
        "model": endpoint["model"],
        "messages": [
            {"role": "user", "content": prompt}
        ],
        "temperature": temperature,
        "stream": False
    }

    print(f"üîÑ Calling {mode} mode ({endpoint['description']})...")
    print(f"üìù Prompt: {prompt[:100]}...")
    print()

    try:
        response = requests.post(url, headers=headers, json=data, timeout=120)
        response.raise_for_status()

        result = response.json()
        answer = result["choices"][0]["message"]["content"]

        print("‚úÖ Response:")
        print("-" * 80)
        print(answer)
        print("-" * 80)

        return answer

    except requests.exceptions.Timeout:
        print("‚ùå Error: Request timed out (cold start? try again)")
        sys.exit(1)
    except requests.exceptions.RequestException as e:
        print(f"‚ùå Error: {e}")
        if hasattr(e.response, 'text'):
            print(f"Details: {e.response.text}")
        sys.exit(1)


def main():
    if len(sys.argv) < 3:
        print("Usage: python runpod-wrapper.py <mode> <prompt>")
        print()
        print("Available modes:")
        for mode, info in ENDPOINTS.items():
            print(f"  {mode:12} - {info['description']}")
        print()
        print("Examples:")
        print('  python runpod-wrapper.py architect "Design a REST API"')
        print('  python runpod-wrapper.py code "Write a Python JWT function"')
        print('  python runpod-wrapper.py research "Compare Redis vs Memcached"')
        print('  python runpod-wrapper.py quick "Python list comprehension syntax"')
        sys.exit(1)

    mode = sys.argv[1]
    prompt = " ".join(sys.argv[2:])

    call_model(mode, prompt)


if __name__ == "__main__":
    main()
