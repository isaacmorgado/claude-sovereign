# Music V2 Features - Continuation

## Completed
- Feature 1: 3 Song Variations (100 tests passing)

## Next: Feature 2 - Scene-Aware Music
Create `splice-backend/services/sceneAnalysis.js`:
- GPT-4o-mini sentiment analysis on transcript segments
- Energy timeline extraction (0-100 scale per segment)
- Enhanced prompt building with scene context

Key files:
- `services/sceneAnalysis.js` (new)
- `services/musicGeneration.js` (add scene-aware prompt building)
- `server.js` (add `/music/generate-scene-aware` endpoint)
- `splice-plugin/js/music.js` (add scene-aware UI toggle)

Pricing: 1.5 credits (75% margin)

## Then: Feature 3 - Music-to-Cut Alignment
Create `splice-backend/services/musicAlignment.js`:
- FFmpeg `aubio` beat detection
- Trim audio at nearest beat boundary
- Fade out generation

## Then: Feature 4 - Mood Timeline
Create `splice-backend/services/musicTimeline.js`:
- Per-chapter mood assignment using `chapterDetection.js`
- FFmpeg crossfade assembly between segments
- `POST /music/generate-timeline` endpoint

## Testing
After each feature: E2E test → fix bugs → verify → next feature
