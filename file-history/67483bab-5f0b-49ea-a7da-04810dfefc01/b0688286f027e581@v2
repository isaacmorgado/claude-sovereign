# MultiAgent: Automations & Multi-Project Support

## Overview
Add automation triggers (file watchers, cron, git hooks) and multi-project support (parallel agents, cross-project orchestration, project switching) to MultiAgent.

## Status: Phase 2 Complete

### Completed Phases
- [x] **Phase 0: Rebranding** - All package names, commands, publisher updated
- [x] **Phase 1: Foundation** - Type definitions, task extensions
- [x] **Phase 2: File Watcher Automation** - Full implementation complete

### Remaining Phases
- [ ] Phase 3: Cron/Scheduled Automation
- [ ] Phase 4: Git Hook Integration
- [ ] Phase 5: Multi-Project Support
- [ ] Phase 6: Cross-Project Orchestration
- [ ] Phase 7: UI & Integration

---

## Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                    AutomationManager                         │
│  ┌──────────────┐ ┌──────────────┐ ┌──────────────┐        │
│  │FileWatcher   │ │CronScheduler │ │GitHookListener│        │
│  │Trigger ✓     │ │(pending)     │ │(pending)      │        │
│  └──────┬───────┘ └──────┬───────┘ └──────┬───────┘        │
└─────────┼────────────────┼────────────────┼─────────────────┘
          │                │                │
          v                v                v
┌─────────────────────────────────────────────────────────────┐
│                    WorkspaceManager (pending)                │
│  ┌────────────────┐  ┌────────────────┐  ┌────────────────┐ │
│  │ClineProvider   │  │ClineProvider   │  │ClineProvider   │ │
│  │(workspace-1)   │  │(workspace-2)   │  │(workspace-N)   │ │
│  └────────────────┘  └────────────────┘  └────────────────┘ │
└─────────────────────────────────────────────────────────────┘
          │
          v
┌─────────────────────────────────────────────────────────────┐
│              CrossProjectOrchestrator (pending)              │
│  - Coordinates tasks across workspaces                       │
│  - Manages shared context and dependencies                   │
└─────────────────────────────────────────────────────────────┘
```

## Configuration (YAML files)

### `.multiagent/automations.yaml`
```yaml
version: "1.0"
automations:
  - id: auto-test-runner
    name: Auto Test Runner
    trigger:
      type: file_watcher
      patterns: ["**/*.test.ts"]
      events: [save]
      debounceMs: 1000
    action:
      mode: test
      prompt: "Run tests for {{triggerFile}}"
      autoApprove: true

  - id: daily-review
    name: Daily Code Review
    trigger:
      type: cron
      schedule: "0 9 * * 1-5"
    action:
      mode: code
      prompt: "Review uncommitted changes"

  - id: pre-commit-lint
    trigger:
      type: git_hook
      hook: pre-commit
    action:
      mode: code
      prompt: "Lint staged files"
```

---

## Files Created/Modified

### New Files Created ✓

| File | Purpose | Status |
|------|---------|--------|
| `packages/types/src/automation.ts` | Automation type definitions | ✓ Complete |
| `packages/types/src/workspace.ts` | Multi-project types | ✓ Complete |
| `src/services/automation/AutomationManager.ts` | Main automation orchestrator | ✓ Complete |
| `src/services/automation/TriggerRegistry.ts` | Registry for all triggers | ✓ Complete |
| `src/services/automation/triggers/BaseTrigger.ts` | Abstract base class | ✓ Complete |
| `src/services/automation/triggers/FileWatcherTrigger.ts` | File change triggers | ✓ Complete |
| `src/services/automation/AutomationConfigLoader.ts` | YAML config loader | ✓ Complete |
| `src/services/automation/AutomationExecutor.ts` | Executes automation actions | ✓ Complete |
| `src/services/automation/index.ts` | Module exports | ✓ Complete |
| `src/services/automation/triggers/index.ts` | Trigger exports | ✓ Complete |
| `docs/automations.md` | Automation documentation | ✓ Complete |
| `.multiagent/automations.example.yaml` | Sample config | ✓ Complete |

### Files Modified ✓

| File | Changes | Status |
|------|---------|--------|
| `packages/types/src/task.ts` | Extended TaskLike with automation fields | ✓ Complete |
| `packages/types/src/index.ts` | Export new types | ✓ Complete |
| `README.md` | Updated with automation features | ✓ Complete |
| `MULTIAGENT_CONTINUATION.md` | Updated with progress | ✓ Complete |

### Files Pending

| File | Purpose | Status |
|------|---------|--------|
| `src/services/automation/triggers/CronTrigger.ts` | Scheduled triggers | Pending |
| `src/services/automation/triggers/GitHookTrigger.ts` | Git event triggers | Pending |
| `src/services/workspace/WorkspaceManager.ts` | Per-workspace providers | Pending |
| `src/services/workspace/CrossProjectOrchestrator.ts` | Multi-project coordination | Pending |
| `src/extension.ts` | Initialize AutomationManager | Pending |

---

## Implementation Phases

### Phase 1: Foundation ✓ COMPLETE
- [x] Create type definitions in `packages/types/src/automation.ts`
- [x] Create type definitions in `packages/types/src/workspace.ts`
- [x] Implement `AutomationConfigLoader.ts` (YAML parsing)
- [x] Add `automationId` and `workspacePath` to Task types

### Phase 2: File Watcher Automation ✓ COMPLETE
- [x] Implement `BaseTrigger.ts` abstract class
- [x] Implement `FileWatcherTrigger.ts` using `vscode.workspace.createFileSystemWatcher`
- [x] Implement `TriggerRegistry.ts`
- [x] Implement `AutomationExecutor.ts`
- [x] Implement `AutomationManager.ts`

### Phase 3: Cron/Scheduled Automation (PENDING)
- [ ] Add `node-cron` dependency
- [ ] Implement `CronTrigger.ts`
- [ ] Add cron expression validation

### Phase 4: Git Hook Integration (PENDING)
- [ ] Implement `GitHookTrigger.ts`
- [ ] Integrate with VS Code Git extension API
- [ ] Add branch filtering

### Phase 5: Multi-Project Support (PENDING)
- [ ] Implement `WorkspaceManager.ts`
- [ ] Create per-workspace ClineProvider instances
- [ ] Add workspace selector UI in webview
- [ ] Context isolation between workspaces

### Phase 6: Cross-Project Orchestration (PENDING)
- [ ] Implement `CrossProjectOrchestrator.ts`
- [ ] Task dependency ordering
- [ ] Shared context propagation

### Phase 7: UI & Integration (PENDING)
- [ ] Wire up AutomationManager in extension.ts
- [ ] Add VS Code settings for automation configuration
- [ ] Visual automation builder in webview
- [ ] Automation templates
- [ ] Execution history/logs

---

## Dependencies

### Already Available
- `yaml` - YAML parsing (already in project)
- `zod` - Schema validation (already in project)
- `ignore` - Gitignore-style pattern matching (already in project)

### To Add
```json
{
  "dependencies": {
    "node-cron": "^3.0.3"
  },
  "devDependencies": {
    "@types/node-cron": "^3.0.11"
  }
}
```

## VS Code Settings to Add

```json
{
  "multi-agent.automations.enabled": true,
  "multi-agent.automations.configPath": ".multiagent/automations.yaml",
  "multi-agent.multiProject.enabled": false,
  "multi-agent.multiProject.autoCreateAgents": true
}
```

---

## Notes
- All features are opt-in (backward compatible)
- Single-workspace behavior preserved when multi-project disabled
- Existing task history and settings unaffected
- Configuration files are version-controllable
- TypeScript compiles successfully with all changes
