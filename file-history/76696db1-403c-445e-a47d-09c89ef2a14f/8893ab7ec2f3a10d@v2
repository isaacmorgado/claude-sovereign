import asyncio
from crawl4ai import AsyncWebCrawler, CrawlerRunConfig, LLMExtractionStrategy, LLMConfig

GEMINI_API_KEY = "AIzaSyCwpp0YtdHB56WZ1bhtWdWrPqPS005I6U8"


async def crawl_librechat_docs():
    llm_config = LLMConfig(
        provider="gemini/gemini-2.0-flash-exp",
        api_token=GEMINI_API_KEY,
        temperature=0.3,  # Lower temperature for technical docs
    )

    extraction_strategy = LLMExtractionStrategy(
        llm_config=llm_config,
        instruction="""
        Extract the complete documentation about custom endpoint configuration.
        Focus on:
        1. The exact YAML structure and hierarchy
        2. Where the 'fetch' parameter should be positioned (inside models object or at endpoint level?)
        3. Required vs optional parameters
        4. Example configurations showing proper indentation
        5. Common mistakes or troubleshooting tips
        6. How models.default should be structured (array format)

        Preserve all code examples with exact indentation.
        """,
    )

    async with AsyncWebCrawler() as crawler:
        result = await crawler.arun(
            url="https://www.librechat.ai/docs/configuration/librechat_yaml/object_structure/custom_endpoint",
            config=CrawlerRunConfig(
                extraction_strategy=extraction_strategy,
                word_count_threshold=10,
                verbose=True,
            ),
        )

        output_file = "/tmp/claude/-Users-imorgado/76696db1-403c-445e-a47d-09c89ef2a14f/scratchpad/librechat_custom_endpoint_docs.md"

        with open(output_file, "w", encoding="utf-8") as f:
            f.write("# LibreChat Custom Endpoint Configuration Documentation\n\n")
            f.write(
                "Source: https://www.librechat.ai/docs/configuration/librechat_yaml/object_structure/custom_endpoint\n\n"
            )
            f.write(result.markdown)

        print(f"‚úÖ Saved to {output_file}")
        print(f"üìä Extracted {len(result.markdown)} characters")

        return output_file


if __name__ == "__main__":
    output_path = asyncio.run(crawl_librechat_docs())
    print(f"\nüìÅ Documentation saved to: {output_path}")
