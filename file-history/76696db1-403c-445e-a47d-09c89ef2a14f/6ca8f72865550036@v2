#!/usr/bin/env python3
import asyncio
from crawl4ai import AsyncWebCrawler, CrawlerRunConfig, LLMExtractionStrategy, LLMConfig

GEMINI_API_KEY = "AIzaSyCwpp0YtdHB56WZ1bhtWdWrPqPS005I6U8"


async def crawl_librechat_docs():
    llm_config = LLMConfig(
        provider="gemini/gemini-2.0-flash-exp",
        api_token=GEMINI_API_KEY,
        temperature=0.3,  # Lower temperature for factual extraction
    )

    extraction_strategy = LLMExtractionStrategy(
        llm_config=llm_config,
        instruction="""
        Extract detailed information about:
        1. How to properly configure model names in the 'models.default' array
        2. The difference between 'fetch: true' and 'fetch: false'
        3. Common issues with model names not being found or recognized
        4. How LibreChat validates model names against the API
        5. Examples of working model configurations
        6. Troubleshooting steps when models don't appear in the UI
        7. Any specific formatting requirements for model IDs

        Focus on Featherless.ai and OpenAI-compatible endpoints.
        Include code examples if available.
        """,
    )

    async with AsyncWebCrawler(verbose=True) as crawler:
        result = await crawler.arun(
            url="https://www.librechat.ai/docs/configuration/librechat_yaml/object_structure/custom_endpoint",
            config=CrawlerRunConfig(
                extraction_strategy=extraction_strategy,
                word_count_threshold=10,
                verbose=True,
            ),
        )

        # Save to markdown
        output_file = (
            "/Users/imorgado/Desktop/Tools/crawl4ai-scripts/librechat_model_config.md"
        )
        with open(output_file, "w", encoding="utf-8") as f:
            f.write("# LibreChat Custom Endpoint Model Configuration\n\n")
            f.write(
                "Source: https://www.librechat.ai/docs/configuration/librechat_yaml/object_structure/custom_endpoint\n\n"
            )
            f.write("---\n\n")
            f.write(result.markdown)

        print(f"âœ… Saved to {output_file}")
        print(f"ðŸ“Š Extracted {len(result.markdown)} characters")


asyncio.run(crawl_librechat_docs())
