# SPLICE Phase 3: Custom Presets Enhancements

## Phase 1 & 2 Complete
61 tests passing. Features implemented:

### Phase 1 (settings.js)
- `createCustomPreset({name, description?, icon?, settings?})` → `{success, id}`
- `updateCustomPreset(id, {name?, description?, settings?})` → `{success}`
- `deleteCustomPreset(id)` → `{success}`
- `getAllPresets()` → array with `isBuiltIn` flag
- `getPresetById(id)` → preset object with `isBuiltIn` flag
- `isBuiltInPreset(id)` → boolean

### Phase 2 (index.html + main.js)
- "+" save button next to preset dropdown → opens save modal
- "..." manage button → opens manage modal with edit/delete
- Save/Edit Preset modal with name, description, icon picker
- Manage Presets modal listing all presets (built-in grayed, custom editable)
- Dropdown dynamically refreshes after CRUD operations
- Custom presets apply settings when selected

## Phase 3 Tasks

| # | Feature | File | Description |
|---|---------|------|-------------|
| 3.1 | Update settings in edit modal | index.html, main.js | Allow changing sensitivity/threshold in edit modal |
| 3.2 | Duplicate preset | main.js | "Duplicate" button creates copy with "(Copy)" suffix |
| 3.3 | Reorder presets | settings.js, main.js | Drag-and-drop or up/down buttons to reorder custom presets |
| 3.4 | Export/Import presets | settings.js, main.js | Export to JSON file, import from JSON file |
| 3.5 | Keyboard shortcuts | main.js | Cmd+1-9 to apply presets quickly |

## Protocol
Each feature: implement → test → fix issues → retest → next.
End of phase: comprehensive test → update CLAUDE.md.

## Key Files
- `splice-plugin/index.html` - UI components
- `splice-plugin/js/main.js` - Event handlers, UI logic
- `splice-plugin/js/settings.js` - CRUD functions, presets data
- `splice-backend/tests/custom-presets.test.js` - Tests

## Prompt
```
Continue SPLICE. Phase 2 done (61 tests). Implement Phase 3: Custom Presets Enhancements.

Priority features:
1. Add "Duplicate" button in manage modal (creates copy with "-copy" suffix)
2. Allow editing settings (sensitivity, threshold) in edit preset modal
3. Export/Import presets as JSON file for sharing

After each feature: E2E test, fix, retest. End: comprehensive test + update CLAUDE.md.
```

## Implementation Notes

### 3.1 Settings in Edit Modal
- Add sensitivity slider to preset modal
- Add threshold input field
- On edit, populate with preset's stored settings
- On save, capture current settings from modal (not from main UI)

### 3.2 Duplicate Preset
```javascript
function duplicatePreset(id) {
  const original = getPresetById(id);
  if (!original || original.isBuiltIn) return { success: false };

  return createCustomPreset({
    name: `${original.name} (Copy)`,
    description: original.description,
    icon: original.icon,
    settings: { ...original.settings }
  });
}
```

### 3.3 Reorder Presets
```javascript
function reorderPreset(id, direction) {
  const data = loadCustomPresets();
  const idx = data.order.indexOf(id);
  if (idx === -1) return false;

  const newIdx = direction === 'up' ? idx - 1 : idx + 1;
  if (newIdx < 0 || newIdx >= data.order.length) return false;

  [data.order[idx], data.order[newIdx]] = [data.order[newIdx], data.order[idx]];
  return saveCustomPresets(data);
}
```

### 3.4 Export/Import Presets
```javascript
function exportPresets() {
  const data = loadCustomPresets();
  return JSON.stringify(data, null, 2);
}

function importPresets(jsonString, merge = true) {
  try {
    const imported = JSON.parse(jsonString);
    if (merge) {
      const existing = loadCustomPresets();
      // Merge imported into existing, avoiding ID conflicts
    } else {
      // Replace all custom presets
    }
  } catch (e) {
    return { success: false, error: 'Invalid JSON' };
  }
}
```
