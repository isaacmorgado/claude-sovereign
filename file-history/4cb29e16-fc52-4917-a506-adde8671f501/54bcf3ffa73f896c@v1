import { VSCodeCheckbox } from "@vscode/webview-ui-toolkit/react"
import { Wrench } from "lucide-react"
import { HTMLAttributes } from "react"

import { useAppTranslation } from "@/i18n/TranslationContext"

import { Section } from "./Section"
import { SectionHeader } from "./SectionHeader"
import { SetCachedStateField } from "./types"

type BrowserMcpToolsEnabled = {
	mitmproxy?: boolean
	screenshotToCode?: boolean
	claudeInChrome?: boolean
	httpie?: boolean
}

type BrowserToolsPanelProps = HTMLAttributes<HTMLDivElement> & {
	browserMcpToolsEnabled?: BrowserMcpToolsEnabled
	setCachedStateField: SetCachedStateField<"browserMcpToolsEnabled">
}

const BROWSER_MCP_TOOLS = [
	{
		id: "claudeInChrome" as const,
		nameKey: "settings:browserTools.claudeInChrome.name",
		descriptionKey: "settings:browserTools.claudeInChrome.description",
	},
	{
		id: "mitmproxy" as const,
		nameKey: "settings:browserTools.mitmproxy.name",
		descriptionKey: "settings:browserTools.mitmproxy.description",
	},
	{
		id: "screenshotToCode" as const,
		nameKey: "settings:browserTools.screenshotToCode.name",
		descriptionKey: "settings:browserTools.screenshotToCode.description",
	},
	{
		id: "httpie" as const,
		nameKey: "settings:browserTools.httpie.name",
		descriptionKey: "settings:browserTools.httpie.description",
	},
]

export const BrowserToolsPanel = ({
	browserMcpToolsEnabled = {},
	setCachedStateField,
	...props
}: BrowserToolsPanelProps) => {
	const { t } = useAppTranslation()

	const handleToolToggle = (toolId: keyof BrowserMcpToolsEnabled, checked: boolean) => {
		setCachedStateField("browserMcpToolsEnabled", {
			...browserMcpToolsEnabled,
			[toolId]: checked,
		})
	}

	return (
		<div {...props}>
			<SectionHeader>
				<div className="flex items-center gap-2">
					<Wrench className="w-4" />
					<div>{t("settings:sections.browserTools")}</div>
				</div>
			</SectionHeader>

			<Section>
				<div className="text-vscode-descriptionForeground text-sm mb-3">
					{t("settings:browserTools.description")}
				</div>

				<div className="flex flex-col gap-3">
					{BROWSER_MCP_TOOLS.map((tool) => (
						<div key={tool.id}>
							<VSCodeCheckbox
								checked={browserMcpToolsEnabled[tool.id] ?? false}
								onChange={(e: any) => handleToolToggle(tool.id, e.target.checked)}>
								<span className="font-medium">{t(tool.nameKey)}</span>
							</VSCodeCheckbox>
							<div className="text-vscode-descriptionForeground text-sm mt-1 ml-6">
								{t(tool.descriptionKey)}
							</div>
						</div>
					))}
				</div>
			</Section>
		</div>
	)
}
