import React from "react"
import { type ProviderSettings } from "@multi-agent/types"
import { useAppTranslation } from "@src/i18n/TranslationContext"
import { Select, SelectTrigger, SelectValue, SelectContent, SelectItem, Input } from "@src/components/ui"

interface ClaudeSubscriptionProps {
	apiConfiguration: ProviderSettings
	setApiConfigurationField: (field: keyof ProviderSettings, value: ProviderSettings[keyof ProviderSettings]) => void
	simplifySettings?: boolean
}

const CLAUDE_SUBSCRIPTION_MODELS = [
	{ value: "sonnet", label: "Claude Sonnet" },
	{ value: "opus", label: "Claude Opus" },
	{ value: "haiku", label: "Claude Haiku" },
]

export const ClaudeSubscription: React.FC<ClaudeSubscriptionProps> = ({
	apiConfiguration,
	setApiConfigurationField,
	simplifySettings,
}) => {
	const { t } = useAppTranslation()

	const currentModel = apiConfiguration.claudeSubscriptionModel ?? "sonnet"
	const currentTimeout = apiConfiguration.claudeSubscriptionTimeout ?? 120000

	return (
		<div className="flex flex-col gap-4">
			{/* Info Section */}
			<div className="text-sm text-vscode-descriptionForeground">
				{t("settings:providers.claudeSubscription.description", {
					defaultValue:
						"Use your Claude Pro/Max subscription via the Claude CLI. Requires the CLI to be installed and authenticated.",
				})}
			</div>

			{/* Installation Instructions */}
			<div className="text-sm">
				<span className="font-medium">
					{t("settings:providers.claudeSubscription.installTitle", { defaultValue: "Setup:" })}
				</span>
				<ol className="list-decimal list-inside mt-1 space-y-1 text-vscode-descriptionForeground">
					<li>
						{t("settings:providers.claudeSubscription.installStep1", {
							defaultValue: "Install CLI: npm i -g @anthropic-ai/claude-code",
						})}
					</li>
					<li>
						{t("settings:providers.claudeSubscription.installStep2", {
							defaultValue: "Run 'claude' in terminal to authenticate",
						})}
					</li>
				</ol>
			</div>

			{/* Model Picker */}
			<div>
				<label className="block font-medium mb-1">
					{t("settings:providers.model", { defaultValue: "Model" })}
				</label>
				<Select
					value={currentModel}
					onValueChange={(value) =>
						setApiConfigurationField("claudeSubscriptionModel", value as "sonnet" | "opus" | "haiku")
					}>
					<SelectTrigger className="w-full">
						<SelectValue placeholder={t("settings:common.select", { defaultValue: "Select..." })} />
					</SelectTrigger>
					<SelectContent>
						{CLAUDE_SUBSCRIPTION_MODELS.map((model) => (
							<SelectItem key={model.value} value={model.value}>
								{model.label}
							</SelectItem>
						))}
					</SelectContent>
				</Select>
			</div>

			{/* Timeout Setting (only show in advanced mode) */}
			{!simplifySettings && (
				<div>
					<label className="block font-medium mb-1">
						{t("settings:providers.claudeSubscription.timeout", {
							defaultValue: "Timeout (seconds)",
						})}
					</label>
					<Input
						type="number"
						min={30}
						max={600}
						value={Math.floor(currentTimeout / 1000)}
						onChange={(e) => {
							const seconds = parseInt(e.target.value, 10)
							if (!isNaN(seconds) && seconds >= 30 && seconds <= 600) {
								setApiConfigurationField("claudeSubscriptionTimeout", seconds * 1000)
							}
						}}
						className="w-full"
					/>
					<div className="text-xs text-vscode-descriptionForeground mt-1">
						{t("settings:providers.claudeSubscription.timeoutDescription", {
							defaultValue: "Maximum time to wait for CLI response (30-600 seconds)",
						})}
					</div>
				</div>
			)}
		</div>
	)
}
