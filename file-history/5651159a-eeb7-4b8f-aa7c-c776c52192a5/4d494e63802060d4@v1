/**
 * Slice 6: Backend Integration Utilities (CEP Port)
 *
 * Provides utility functions for takes data management.
 * Port of UXP slice6-analyze.js for CEP compatibility.
 */

// Store takes data for applying to timeline
let currentTakesData = null;

/**
 * Get current takes data (for use by other slices)
 * @returns {Array|null} Current takes array
 */
function getCurrentTakes() {
    // Check window.currentTakes first (set by main.js workflow)
    if (window.currentTakes) {
        return window.currentTakes;
    }
    return currentTakesData;
}

/**
 * Set current takes data
 * @param {Array} takes - Takes array
 */
function setCurrentTakes(takes) {
    currentTakesData = takes;
    window.currentTakes = takes;
}

/**
 * Clear current takes data
 */
function clearCurrentTakes() {
    currentTakesData = null;
    window.currentTakes = null;
}

/**
 * Get takes statistics
 * @returns {Object} Statistics about current takes
 */
function getTakesStats() {
    const takes = getCurrentTakes();
    if (!takes || takes.length === 0) {
        return {
            count: 0,
            bestCount: 0,
            totalDuration: 0
        };
    }

    let bestCount = 0;
    let totalDuration = 0;

    for (const take of takes) {
        if (take.isBest || take.userMarkedBest) {
            bestCount++;
        }
        const start = take.start || take.startTime || 0;
        const end = take.end || take.endTime || 0;
        totalDuration += (end - start);
    }

    return {
        count: takes.length,
        bestCount,
        totalDuration
    };
}

// Legacy init function - no longer needed
function initAnalyzer() {
    // Workflow is now handled by main.js initTakesWorkflow()
}

// Legacy render function - kept for compatibility
function renderTakes() {
    // Rendering is now handled by main.js showTakesResults()
}

// Export for window access
window.getCurrentTakes = getCurrentTakes;
window.setCurrentTakes = setCurrentTakes;
window.clearCurrentTakes = clearCurrentTakes;
window.getTakesStats = getTakesStats;
