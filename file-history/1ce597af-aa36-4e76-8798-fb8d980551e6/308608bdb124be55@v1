# SPLICE
AI-powered Premiere Pro UXP plugin for detecting takes, removing silences, and accelerating video editing workflows.

## Current Focus
Section: Slice 7 - Apply takes to timeline (WORKING!)
Files: splice-plugin/js/slice7-apply.js

## Last Session (2025-12-19)
- **FIXED**: Label Clips on Timeline now works!
- **Root cause**: UXP action pattern requires creating actions INSIDE `executeTransaction()`, not before
- **TickTime fix**: `getStartTime()` returns TickTime object, use `.ticks` property
- **No remove API**: Clips are disabled instead of removed (no `createRemoveAction` in UXP)

## UXP Action Pattern (CRITICAL)
```javascript
// CORRECT: Create action INSIDE executeTransaction
const project = await ppro.Project.getActiveProject();
project.lockedAccess(() => {
  project.executeTransaction((compoundAction) => {
    const action = clip.createSetNameAction(label);  // CREATE HERE
    compoundAction.addAction(action);
  }, 'Undo Label');
});

// WRONG: This causes "Script action failed to execute"
const action = clip.createSetNameAction(label);  // DON'T create outside
project.lockedAccess(() => { ... });
```

## API Endpoint
- `POST https://127.0.0.1:3847/analyze` with `{ "wavPath": "/tmp/splice_audio_export.wav" }`
- Returns: `{ success, wavPath, transcript: { text, segments[], duration }, takes: { takes[], analysis } }`

## Architecture Decisions
- **HTTPS required**: Premiere Pro 25.6.x UXP bug blocks HTTP requests
- **Modular slices**: Each slice in separate file for maintainability
- **Timebase constant**: 254016000000 ticks/second (UXP API lacks getter)
- **No razor API**: `razorAllTracksAtTime` not available in UXP
- **TickTime objects**: Use `.ticks` property to get numeric value
- **Action pattern**: Always create actions inside `executeTransaction()`

## Key Constraints
- UXP requires Premiere Pro 25.6+ or Beta
- Manifest v5: host must be array `[{ "app": "premierepro" }]`
- Use `127.0.0.1` not `localhost` in fetch URLs
- Plugin caches JS files - must reload via UXP Dev Tools

## Available TrackItem Methods
createSetNameAction, createSetDisabledAction, createMoveAction, createSetInPointAction, createSetOutPointAction, createSetStartAction, createSetEndAction, getStartTime, getEndTime, getDuration, getName, getProjectItem, isDisabled

## Next Steps
1. Test "Keep Best Takes" button (now disables non-best clips)
2. Slice 8: Silence detection and removal

## Project Structure
```
splice-plugin/js/ (config, utils, slice1-timeline, slice3-export, slice6-analyze, slice7-apply, main)
splice-backend/ (server.js, services/transcription.js, services/takeDetection.js)
```
