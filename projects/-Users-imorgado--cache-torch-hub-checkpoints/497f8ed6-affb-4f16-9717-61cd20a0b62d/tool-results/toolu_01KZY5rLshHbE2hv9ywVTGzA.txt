The file /Users/imorgado/Desktop/Mario_images/generate_landmark_images.py has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
     1→#!/usr/bin/env python3
     2→"""
     3→Facial Landmark Image Generator
     4→
     5→This script takes face images and generates cropped images with light blue circle
     6→markers at specific facial landmarks, similar to the male_white reference images.
     7→
     8→Usage:
     9→    python generate_landmark_images.py --input BLONDEFRONT.png --output-prefix blonde_front
    10→"""
    11→
    12→import cv2
    13→import mediapipe as mp
    14→from mediapipe.tasks import python
    15→from mediapipe.tasks.python import vision
    16→import numpy as np
    17→from pathlib import Path
    18→import argparse
    19→import urllib.request
    20→import os
    21→
    22→# Model file path
    23→MODEL_PATH = Path(__file__).parent / "face_landmarker.task"
    24→MODEL_URL = "https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task"
    25→
    26→
    27→def download_model():
    28→    """Download the face landmarker model if not present."""
    29→    if not MODEL_PATH.exists():
    30→        print(f"Downloading face landmarker model...")
    31→        urllib.request.urlretrieve(MODEL_URL, MODEL_PATH)
    32→        print(f"Model downloaded to {MODEL_PATH}")
    33→
    34→
    35→# MediaPipe landmark indices mapped to anatomical points
    36→# These indices are based on the 478-point face mesh model (468 + 10 iris landmarks)
    37→FRONT_LANDMARKS = {
    38→    # Eyes - Left (from viewer's perspective, subject's right)
    39→    "leftEyePupil": 468,  # Left iris center
    40→    "leftEyeMedialCanthus": 133,  # Inner corner of left eye
    41→    "leftEyeLateralCanthus": 33,  # Outer corner of left eye
    42→    "leftEyeUpperEyelid": 159,  # Upper eyelid center
    43→    "leftEyeLowerEyelid": 145,  # Lower eyelid center
    44→    "leftUpperEyelidCrease": 157,  # Upper eyelid crease
    45→    "leftEyelidHoodEnd": 130,  # Eyelid hood end
    46→
    47→    # Eyes - Right (from viewer's perspective, subject's left)
    48→    "rightEyePupil": 473,  # Right iris center
    49→    "rightEyeMedialCanthus": 362,  # Inner corner of right eye
    50→    "rightEyeLateralCanthus": 263,  # Outer corner of right eye
    51→    "rightEyeUpperEyelid": 386,  # Upper eyelid center
    52→    "rightEyeLowerEyelid": 374,  # Lower eyelid center
    53→    "rightUpperEyelidCrease": 384,  # Upper eyelid crease
    54→    "rightEyelidHoodEnd": 359,  # Eyelid hood end
    55→
    56→    # Eyebrows - Left
    57→    "leftBrowHead": 107,  # Inner start of left brow
    58→    "leftBrowInnerCorner": 66,  # Inner corner
    59→    "leftBrowArch": 105,  # Arch of brow
    60→    "leftBrowPeak": 63,  # Peak/highest point
    61→    "leftBrowTail": 70,  # Outer end of brow
    62→
    63→    # Eyebrows - Right
    64→    "rightBrowHead": 336,  # Inner start of right brow
    65→    "rightBrowInnerCorner": 296,  # Inner corner
    66→    "rightBrowArch": 334,  # Arch of brow
    67→    "rightBrowPeak": 293,  # Peak/highest point
    68→    "rightBrowTail": 300,  # Outer end of brow
    69→
    70→    # Nose
    71→    "leftNoseBridge": 122,  # Left side of nose bridge
    72→    "rightNoseBridge": 351,  # Right side of nose bridge
    73→    "noseBottom": 2,  # Tip of nose / bottom
    74→    "noseLeft": 240,  # Left nostril
    75→    "noseRight": 460,  # Right nostril
    76→    "nasalBase": 4,  # Base of nose (columella base)
    77→
    78→    # Mouth
    79→    "cupidsBow": 0,  # Center of upper lip (cupid's bow)
    80→    "innerCupidsBow": 13,  # Inner cupid's bow
    81→    "mouthLeft": 61,  # Left corner of mouth
    82→    "mouthRight": 291,  # Right corner of mouth
    83→    "mouthMiddle": 14,  # Middle of lips
    84→    "lowerLip": 17,  # Center of lower lip
    85→
    86→    # Chin
    87→    "chinBottom": 152,  # Bottom of chin (menton)
    88→    "chinLeft": 172,  # Left side of chin
    89→    "chinRight": 397,  # Right side of chin
    90→
    91→    # Jaw/Gonion
    92→    "leftTopGonion": 116,  # Left jaw angle top
    93→    "leftBottomGonion": 135,  # Left jaw angle bottom
    94→    "rightTopGonion": 345,  # Right jaw angle top
    95→    "rightBottomGonion": 364,  # Right jaw angle bottom
    96→
    97→    # Cheeks
    98→    "leftCheek": 50,  # Left cheekbone area
    99→    "rightCheek": 280,  # Right cheekbone area
   100→
   101→    # Temples
   102→    "leftTemple": 54,  # Left temple
   103→    "rightTemple": 284,  # Right temple
   104→
   105→    # Ears (approximate - face mesh doesn't have precise ear points)
   106→    "leftOuterEar": 127,  # Near left ear
   107→    "rightOuterEar": 356,  # Near right ear
   108→
   109→    # Forehead/Hairline
   110→    "hairline": 10,  # Center of forehead/hairline
   111→
   112→    # Neck (approximate using chin landmarks)
   113→    "neckLeft": 214,  # Left neck area
   114→    "neckRight": 434,  # Right neck area
   115→}
   116→
   117→SIDE_LANDMARKS = {
   118→    # Side profile landmarks - these work best with side-facing images
   119→    "glabella": 9,  # Between eyebrows
   120→    "nasion": 168,  # Bridge of nose (top)
   121→    "forehead": 10,  # Forehead center
   122→    "cornealApex": 468,  # Eye/cornea (use iris center)
   123→    "orbitale": 145,  # Lower eye orbit
   124→    "cheekbone": 50,  # Cheekbone prominence
   125→    "columella": 4,  # Base of nose
   126→    "infratip": 5,  # Below nose tip
   127→    "labraleSuperius": 0,  # Upper lip
   128→    "labraleInferius": 17,  # Lower lip
   129→    "cheilion": 61,  # Corner of mouth
   130→    "menton": 152,  # Chin bottom
   131→    "gonionTop": 116,  # Jaw angle top
   132→    "gonionBottom": 135,  # Jaw angle bottom
   133→    "cervicalPoint": 152,  # Neck/chin junction (approximate)
   134→    "neckPoint": 175,  # Neck area
   135→    "intertragicNotch": 127,  # Ear area
   136→    "occiput": 10,  # Back of head (approximate)
   137→    "upperEyelid": 159,  # Upper eyelid
   138→    "lowerEyelid": 145,  # Lower eyelid
   139→    "eyelidEnd": 33,  # Outer eyelid
   140→}
   141→
   142→# Crop regions for each landmark (x_offset, y_offset, width, height as ratios of face size)
   143→CROP_CONFIGS = {
   144→    # Eye regions - smaller crops focused on eyes
   145→    "leftEyePupil": {"size": 0.25, "aspect": 1.3},
   146→    "rightEyePupil": {"size": 0.25, "aspect": 1.3},
   147→    "leftEyeMedialCanthus": {"size": 0.2, "aspect": 1.2},
   148→    "rightEyeMedialCanthus": {"size": 0.2, "aspect": 1.2},
   149→    "leftEyeLateralCanthus": {"size": 0.2, "aspect": 1.2},
   150→    "rightEyeLateralCanthus": {"size": 0.2, "aspect": 1.2},
   151→    "leftEyeUpperEyelid": {"size": 0.22, "aspect": 1.3},
   152→    "rightEyeUpperEyelid": {"size": 0.22, "aspect": 1.3},
   153→    "leftEyeLowerEyelid": {"size": 0.22, "aspect": 1.3},
   154→    "rightEyeLowerEyelid": {"size": 0.22, "aspect": 1.3},
   155→    "leftUpperEyelidCrease": {"size": 0.25, "aspect": 1.3},
   156→    "rightUpperEyelidCrease": {"size": 0.25, "aspect": 1.3},
   157→    "leftEyelidHoodEnd": {"size": 0.25, "aspect": 1.3},
   158→    "rightEyelidHoodEnd": {"size": 0.25, "aspect": 1.3},
   159→
   160→    # Brow regions
   161→    "leftBrowHead": {"size": 0.22, "aspect": 1.2},
   162→    "rightBrowHead": {"size": 0.22, "aspect": 1.2},
   163→    "leftBrowInnerCorner": {"size": 0.22, "aspect": 1.2},
   164→    "rightBrowInnerCorner": {"size": 0.22, "aspect": 1.2},
   165→    "leftBrowArch": {"size": 0.22, "aspect": 1.2},
   166→    "rightBrowArch": {"size": 0.22, "aspect": 1.2},
   167→    "leftBrowPeak": {"size": 0.22, "aspect": 1.2},
   168→    "rightBrowPeak": {"size": 0.22, "aspect": 1.2},
   169→    "leftBrowTail": {"size": 0.25, "aspect": 1.3},
   170→    "rightBrowTail": {"size": 0.25, "aspect": 1.3},
   171→
   172→    # Nose regions
   173→    "leftNoseBridge": {"size": 0.25, "aspect": 1.2},
   174→    "rightNoseBridge": {"size": 0.25, "aspect": 1.2},
   175→    "noseBottom": {"size": 0.2, "aspect": 1.0},
   176→    "noseLeft": {"size": 0.18, "aspect": 1.0},
   177→    "noseRight": {"size": 0.18, "aspect": 1.0},
   178→    "nasalBase": {"size": 0.22, "aspect": 1.1},
   179→
   180→    # Mouth regions
   181→    "cupidsBow": {"size": 0.18, "aspect": 1.2},
   182→    "innerCupidsBow": {"size": 0.25, "aspect": 1.4},
   183→    "mouthLeft": {"size": 0.18, "aspect": 1.1},
   184→    "mouthRight": {"size": 0.18, "aspect": 1.1},
   185→    "mouthMiddle": {"size": 0.18, "aspect": 1.2},
   186→    "lowerLip": {"size": 0.18, "aspect": 1.2},
   187→
   188→    # Chin regions
   189→    "chinBottom": {"size": 0.2, "aspect": 1.1},
   190→    "chinLeft": {"size": 0.18, "aspect": 1.0},
   191→    "chinRight": {"size": 0.18, "aspect": 1.0},
   192→
   193→    # Jaw regions
   194→    "leftTopGonion": {"size": 0.2, "aspect": 1.1},
   195→    "leftBottomGonion": {"size": 0.2, "aspect": 1.1},
   196→    "rightTopGonion": {"size": 0.2, "aspect": 1.1},
   197→    "rightBottomGonion": {"size": 0.2, "aspect": 1.1},
   198→
   199→    # Cheek regions
   200→    "leftCheek": {"size": 0.25, "aspect": 1.2},
   201→    "rightCheek": {"size": 0.25, "aspect": 1.2},
   202→
   203→    # Temple regions
   204→    "leftTemple": {"size": 0.28, "aspect": 1.3},
   205→    "rightTemple": {"size": 0.28, "aspect": 1.3},
   206→
   207→    # Ear regions
   208→    "leftOuterEar": {"size": 0.28, "aspect": 1.2},
   209→    "rightOuterEar": {"size": 0.28, "aspect": 1.2},
   210→
   211→    # Hairline
   212→    "hairline": {"size": 0.35, "aspect": 1.4},
   213→
   214→    # Neck regions
   215→    "neckLeft": {"size": 0.22, "aspect": 1.0},
   216→    "neckRight": {"size": 0.22, "aspect": 1.0},
   217→
   218→    # Side profile defaults
   219→    "glabella": {"size": 0.25, "aspect": 1.2},
   220→    "nasion": {"size": 0.25, "aspect": 1.2},
   221→    "forehead": {"size": 0.3, "aspect": 1.3},
   222→    "cornealApex": {"size": 0.25, "aspect": 1.2},
   223→    "orbitale": {"size": 0.22, "aspect": 1.2},
   224→    "cheekbone": {"size": 0.25, "aspect": 1.2},
   225→    "columella": {"size": 0.22, "aspect": 1.1},
   226→    "infratip": {"size": 0.2, "aspect": 1.0},
   227→    "labraleSuperius": {"size": 0.2, "aspect": 1.1},
   228→    "labraleInferius": {"size": 0.2, "aspect": 1.1},
   229→    "cheilion": {"size": 0.2, "aspect": 1.1},
   230→    "menton": {"size": 0.22, "aspect": 1.1},
   231→    "gonionTop": {"size": 0.22, "aspect": 1.1},
   232→    "gonionBottom": {"size": 0.22, "aspect": 1.1},
   233→    "cervicalPoint": {"size": 0.22, "aspect": 1.0},
   234→    "neckPoint": {"size": 0.22, "aspect": 1.0},
   235→    "intertragicNotch": {"size": 0.25, "aspect": 1.2},
   236→    "occiput": {"size": 0.3, "aspect": 1.3},
   237→    "upperEyelid": {"size": 0.22, "aspect": 1.3},
   238→    "lowerEyelid": {"size": 0.22, "aspect": 1.3},
   239→    "eyelidEnd": {"size": 0.22, "aspect": 1.2},
   240→}
   241→
   242→
   243→def detect_landmarks(image_path: str, is_side_profile: bool = False):
   244→    """
   245→    Detect facial landmarks in the given image using MediaPipe Tasks API.
   246→
   247→    Args:
   248→        image_path: Path to the image file
   249→        is_side_profile: Whether the image is a side profile
   250→
   251→    Returns:
   252→        Tuple of (image, landmarks_dict, image_height, image_width)
   253→    """
   254→    # Ensure model is downloaded
   255→    download_model()
   256→
   257→    # Create FaceLandmarker
   258→    base_options = python.BaseOptions(model_asset_path=str(MODEL_PATH))
   259→    options = vision.FaceLandmarkerOptions(
   260→        base_options=base_options,
   261→        output_face_blendshapes=False,
   262→        output_facial_transformation_matrixes=False,
   263→        num_faces=1
   264→    )
   265→    detector = vision.FaceLandmarker.create_from_options(options)
   266→
   267→    # Load image
   268→    image = cv2.imread(str(image_path))
   269→    if image is None:
   270→        raise ValueError(f"Could not load image: {image_path}")
   271→
   272→    h, w = image.shape[:2]
   273→
   274→    # Convert to MediaPipe Image format
   275→    mp_image = mp.Image(image_format=mp.ImageFormat.SRGB, data=cv2.cvtColor(image, cv2.COLOR_BGR2RGB))
   276→
   277→    # Detect landmarks
   278→    detection_result = detector.detect(mp_image)
   279→
   280→    if not detection_result.face_landmarks:
   281→        raise ValueError(f"No face detected in {image_path}")
   282→
   283→    face_landmarks = detection_result.face_landmarks[0]
   284→
   285→    # Convert landmarks to pixel coordinates
   286→    landmarks_dict = {}
   287→    landmark_mapping = SIDE_LANDMARKS if is_side_profile else FRONT_LANDMARKS
   288→
   289→    for name, idx in landmark_mapping.items():
   290→        if idx < len(face_landmarks):
   291→            lm = face_landmarks[idx]
   292→            x = int(lm.x * w)
   293→            y = int(lm.y * h)
   294→            landmarks_dict[name] = (x, y)
   295→
   296→    return image, landmarks_dict, h, w
   297→
   298→
   299→def create_cropped_image(image, landmark_pos, landmark_name, img_height, img_width,
   300→                         circle_color=(255, 191, 0), circle_radius=8, circle_thickness=-1):
   301→    """
   302→    Create a cropped image around a landmark with a circle marker.
   303→
   304→    Args:
   305→        image: Original image (BGR)
   306→        landmark_pos: (x, y) position of the landmark
   307→        landmark_name: Name of the landmark for crop configuration
   308→        img_height: Height of original image
   309→        img_width: Width of original image
   310→        circle_color: BGR color for the circle (default: light blue)
   311→        circle_radius: Radius of the circle marker
   312→        circle_thickness: Thickness of circle (-1 for filled)
   313→
   314→    Returns:
   315→        Cropped image with circle marker
   316→    """
   317→    x, y = landmark_pos
   318→
   319→    # Get crop configuration
   320→    config = CROP_CONFIGS.get(landmark_name, {"size": 0.25, "aspect": 1.2})
   321→    size_ratio = config["size"]
   322→    aspect_ratio = config["aspect"]
   323→
   324→    # Calculate crop dimensions based on face size
   325→    face_size = min(img_height, img_width)
   326→    crop_height = int(face_size * size_ratio)
   327→    crop_width = int(crop_height * aspect_ratio)
   328→
   329→    # Calculate crop boundaries centered on landmark
   330→    x1 = max(0, x - crop_width // 2)
   331→    y1 = max(0, y - crop_height // 2)
   332→    x2 = min(img_width, x1 + crop_width)
   333→    y2 = min(img_height, y1 + crop_height)
   334→
   335→    # Adjust if crop goes beyond image boundaries
   336→    if x2 - x1 < crop_width:
   337→        x1 = max(0, x2 - crop_width)
   338→    if y2 - y1 < crop_height:
   339→        y1 = max(0, y2 - crop_height)
   340→
   341→    # Create a copy of the image and draw the circle
   342→    image_with_marker = image.copy()
   343→    cv2.circle(image_with_marker, (x, y), circle_radius, circle_color, circle_thickness)
   344→
   345→    # Crop the image
   346→    cropped = image_with_marker[y1:y2, x1:x2]
   347→
   348→    return cropped
   349→
   350→
   351→def process_image(input_path: str, output_dir: str, output_prefix: str,
   352→                  is_side_profile: bool = False, output_format: str = "webp"):
   353→    """
   354→    Process a single image and generate all landmark crops.
   355→
   356→    Args:
   357→        input_path: Path to input image
   358→        output_dir: Directory to save output images
   359→        output_prefix: Prefix for output filenames
   360→        is_side_profile: Whether the image is a side profile
   361→        output_format: Output image format (webp, png, jpg)
   362→    """
   363→    output_path = Path(output_dir)
   364→    output_path.mkdir(parents=True, exist_ok=True)
   365→
   366→    print(f"Processing: {input_path}")
   367→
   368→    # Detect landmarks
   369→    image, landmarks, h, w = detect_landmarks(input_path, is_side_profile)
   370→
   371→    print(f"  Detected {len(landmarks)} landmarks")
   372→
   373→    # Light blue color in BGR format
   374→    light_blue = (255, 191, 0)  # BGR for light blue
   375→
   376→    # Generate cropped images for each landmark
   377→    for landmark_name, pos in landmarks.items():
   378→        try:
   379→            cropped = create_cropped_image(
   380→                image, pos, landmark_name, h, w,
   381→                circle_color=light_blue,
   382→                circle_radius=8,
   383→                circle_thickness=-1  # Filled circle
   384→            )
   385→
   386→            output_filename = f"{output_prefix}_{landmark_name}.{output_format}"
   387→            output_file = output_path / output_filename
   388→
   389→            cv2.imwrite(str(output_file), cropped)
   390→            print(f"  Created: {output_filename}")
   391→
   392→        except Exception as e:
   393→            print(f"  Error processing {landmark_name}: {e}")
   394→
   395→    print(f"  Completed: {len(landmarks)} images generated")
   396→
   397→
   398→def main():
   399→    parser = argparse.ArgumentParser(
   400→        description="Generate facial landmark images with markers"
   401→    )
   402→    parser.add_argument(
   403→        "--input", "-i",
   404→        required=True,
   405→        help="Input image path"
   406→    )
   407→    parser.add_argument(
   408→        "--output-dir", "-o",
   409→        default="./output",
   410→        help="Output directory (default: ./output)"
   411→    )
   412→    parser.add_argument(
   413→        "--output-prefix", "-p",
   414→        required=True,
   415→        help="Prefix for output filenames (e.g., 'blonde_front')"
   416→    )
   417→    parser.add_argument(
   418→        "--side-profile", "-s",
   419→        action="store_true",
   420→        help="Process as side profile image"
   421→    )
   422→    parser.add_argument(
   423→        "--format", "-f",
   424→        default="webp",
   425→        choices=["webp", "png", "jpg"],
   426→        help="Output image format (default: webp)"
   427→    )
   428→
   429→    args = parser.parse_args()
   430→
   431→    process_image(
   432→        args.input,
   433→        args.output_dir,
   434→        args.output_prefix,
   435→        args.side_profile,
   436→        args.format
   437→    )
   438→
   439→
   440→if __name__ == "__main__":
   441→    main()
   442→