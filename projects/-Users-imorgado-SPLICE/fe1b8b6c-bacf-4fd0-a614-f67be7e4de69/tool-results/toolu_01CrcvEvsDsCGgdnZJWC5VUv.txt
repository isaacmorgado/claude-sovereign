     1→# macOS Code Signing Setup Guide
     2→
     3→This guide walks you through setting up all the credentials needed to sign and notarize the SPLICE macOS installer.
     4→
     5→## Overview
     6→
     7→To distribute a signed and notarized PKG installer, you need:
     8→
     9→1. **Developer ID Installer Certificate** - For signing the PKG
    10→2. **Apple ID with App-Specific Password** - For notarization
    11→3. **Team ID** - Your Apple Developer Team identifier
    12→
    13→## Prerequisites
    14→
    15→- Active [Apple Developer Program](https://developer.apple.com/programs/) membership ($99/year)
    16→- macOS with Keychain Access
    17→- Xcode Command Line Tools (`xcode-select --install`)
    18→
    19→---
    20→
    21→## Step 1: Create a Developer ID Installer Certificate
    22→
    23→### 1.1 Check for Existing Certificates
    24→
    25→First, check if you already have a Developer ID Installer certificate:
    26→
    27→```bash
    28→security find-identity -v -p basic | grep "Developer ID Installer"
    29→```
    30→
    31→If you see output like:
    32→```
    33→1) ABC123... "Developer ID Installer: Your Name (TEAMID)"
    34→```
    35→
    36→You already have the certificate! Skip to Step 2.
    37→
    38→### 1.2 Create a Certificate Signing Request (CSR)
    39→
    40→If no certificate exists, create one:
    41→
    42→1. Open **Keychain Access** (Applications → Utilities → Keychain Access)
    43→
    44→2. From the menu bar, select:
    45→   **Keychain Access → Certificate Assistant → Request a Certificate From a Certificate Authority**
    46→
    47→3. Fill in the form:
    48→   - **User Email Address**: Your Apple Developer email (isaacfmor@gmail.com)
    49→   - **Common Name**: Your name or company name
    50→   - **CA Email Address**: Leave blank
    51→   - **Request is**: Select **"Saved to disk"**
    52→
    53→4. Click **Continue** and save the `.certSigningRequest` file to your Desktop
    54→
    55→### 1.3 Create the Certificate in Apple Developer Portal
    56→
    57→1. Go to [Apple Developer Certificates](https://developer.apple.com/account/resources/certificates/list)
    58→
    59→2. Sign in with your Apple ID
    60→
    61→3. Click the **+** button to create a new certificate
    62→
    63→4. Under "Software", select **"Developer ID Installer"**
    64→   
    65→   > ⚠️ **IMPORTANT**: Select "Developer ID Installer", NOT "Developer ID Application"
    66→   > 
    67→   > - **Developer ID Application** - For signing .app bundles
    68→   > - **Developer ID Installer** - For signing .pkg installers ← This one!
    69→
    70→5. Click **Continue**
    71→
    72→6. Upload the CSR file you created in Step 1.2
    73→
    74→7. Click **Continue**
    75→
    76→8. **Download** the certificate (it will be named something like `developerID_installer.cer`)
    77→
    78→### 1.4 Install the Certificate
    79→
    80→1. Double-click the downloaded `.cer` file
    81→
    82→2. Keychain Access will open and install the certificate
    83→
    84→3. The certificate should appear in the "login" keychain under "My Certificates"
    85→
    86→4. Verify installation:
    87→   ```bash
    88→   security find-identity -v -p basic | grep "Developer ID Installer"
    89→   ```
    90→
    91→   You should see:
    92→   ```
    93→   1) <HASH> "Developer ID Installer: Your Name (TEAM_ID)"
    94→   ```
    95→
    96→---
    97→
    98→## Step 2: Create an App-Specific Password
    99→
   100→App-specific passwords are required for notarization because Apple requires two-factor authentication, and regular passwords can't be used in scripts.
   101→
   102→### 2.1 Generate the Password
   103→
   104→1. Go to [appleid.apple.com](https://appleid.apple.com)
   105→
   106→2. Sign in with your Apple ID (isaacfmor@gmail.com)
   107→
   108→3. Navigate to **Sign-In and Security** → **App-Specific Passwords**
   109→
   110→4. Click **Generate an app-specific password** (or the + button)
   111→
   112→5. Enter a label: **"SPLICE Notarization"**
   113→
   114→6. Click **Create**
   115→
   116→7. **Copy the generated password** (format: `xxxx-xxxx-xxxx-xxxx`)
   117→
   118→   > ⚠️ **IMPORTANT**: Save this password securely! It will only be shown once.
   119→
   120→### 2.2 Store the Password Securely (Recommended)
   121→
   122→Instead of putting the password in scripts, store it in the macOS Keychain:
   123→
   124→```bash
   125→xcrun notarytool store-credentials "AC_PASSWORD" \
   126→    --apple-id "isaacfmor@gmail.com" \
   127→    --team-id "YOUR_TEAM_ID" \
   128→    --password "xxxx-xxxx-xxxx-xxxx"
   129→```
   130→
   131→Then reference it in the signing script with:
   132→```bash
   133→--password "@keychain:AC_PASSWORD"
   134→```
   135→
   136→---
   137→
   138→## Step 3: Find Your Team ID
   139→
   140→Your Team ID is displayed:
   141→
   142→1. In the certificate name: `Developer ID Installer: Your Name (TEAM_ID)`
   143→
   144→2. In the [Apple Developer Membership](https://developer.apple.com/account#MembershipDetailsCard) page
   145→
   146→3. Via command line:
   147→   ```bash
   148→   security find-identity -v -p basic | grep "Developer ID Installer" | sed 's/.*(\([A-Z0-9]*\)).*/\1/'
   149→   ```
   150→
   151→---
   152→
   153→## Step 4: Test Your Setup
   154→
   155→### 4.1 Verify Certificate
   156→
   157→```bash
   158→# List all Developer ID certificates
   159→security find-identity -v -p basic | grep "Developer ID"
   160→
   161→# Should show:
   162→# "Developer ID Installer: Your Name (TEAM_ID)"
   163→```
   164→
   165→### 4.2 Test Signing (without notarization)
   166→
   167→```bash
   168→cd /Users/imorgado/Desktop/SPLICE/installer
   169→
   170→# Sign the PKG (replace with your actual certificate name)
   171→./macos/sign-and-notarize.sh \
   172→    --no-notarize \
   173→    dist/SPLICE-Installer-6.0.3.pkg
   174→```
   175→
   176→### 4.3 Test Full Signing + Notarization
   177→
   178→```bash
   179→# Using stored keychain credentials
   180→./macos/sign-and-notarize.sh \
   181→    --apple-id "isaacfmor@gmail.com" \
   182→    --team-id "YOUR_TEAM_ID" \
   183→    --password "@keychain:AC_PASSWORD" \
   184→    dist/SPLICE-Installer-6.0.3.pkg
   185→
   186→# Or using environment variables
   187→export APPLE_ID="isaacfmor@gmail.com"
   188→export TEAM_ID="YOUR_TEAM_ID"
   189→export APP_PASSWORD="xxxx-xxxx-xxxx-xxxx"
   190→
   191→./macos/sign-and-notarize.sh dist/SPLICE-Installer-6.0.3.pkg
   192→```
   193→
   194→---
   195→
   196→## Verification Commands
   197→
   198→### Check PKG Signature
   199→
   200→```bash
   201→pkgutil --check-signature dist/SPLICE-Installer-6.0.3-signed.pkg
   202→```
   203→
   204→Expected output:
   205→```
   206→Package "SPLICE-Installer-6.0.3-signed.pkg":
   207→   Status: signed by a developer certificate issued by Apple for distribution
   208→   Signed with a trusted timestamp on: 2026-01-07 01:20:00 +0000
   209→   Certificate Chain:
   210→    1. Developer ID Installer: Your Name (TEAM_ID)
   211→       Expires: 2031-02-01 22:12:15 +0000
   212→       SHA256 Fingerprint: ...
   213→    2. Developer ID Certification Authority
   214→       ...
   215→    3. Apple Root CA
   216→       ...
   217→```
   218→
   219→### Check Gatekeeper Assessment
   220→
   221→```bash
   222→spctl --assess -vv --type install dist/SPLICE-Installer-6.0.3-signed.pkg
   223→```
   224→
   225→Expected output:
   226→```
   227→dist/SPLICE-Installer-6.0.3-signed.pkg: accepted
   228→source=Notarized Developer ID
   229→```
   230→
   231→### Check Notarization Status
   232→
   233→```bash
   234→xcrun stapler validate dist/SPLICE-Installer-6.0.3-signed.pkg
   235→```
   236→
   237→Expected output:
   238→```
   239→Processing: dist/SPLICE-Installer-6.0.3-signed.pkg
   240→The validate action worked!
   241→```
   242→
   243→---
   244→
   245→## Troubleshooting
   246→
   247→### "No Developer ID Installer certificate found"
   248→
   249→1. Verify you created "Developer ID **Installer**" not "Developer ID Application"
   250→2. Make sure you downloaded and double-clicked the certificate
   251→3. Check it appears in Keychain Access under "My Certificates"
   252→
   253→### "Unable to process... verify both Apple ID and app-specific password are correct"
   254→
   255→1. Verify your Apple ID email is correct
   256→2. Generate a new app-specific password
   257→3. Make sure two-factor authentication is enabled on your Apple ID
   258→
   259→### "Team ID is not associated with this Apple ID"
   260→
   261→1. Your Team ID might be different from what you're using
   262→2. Check your Team ID at developer.apple.com/account
   263→3. If you have multiple teams, select the correct one
   264→
   265→### "Certificate has been revoked"
   266→
   267→1. Check the certificate status in Apple Developer Portal
   268→2. If revoked, create a new Developer ID Installer certificate
   269→3. Delete the old certificate from Keychain Access
   270→
   271→### Notarization Takes Too Long
   272→
   273→- Normal notarization takes 5-15 minutes
   274→- If it takes longer, check Apple's [System Status](https://developer.apple.com/system-status/)
   275→- The notary service can be slow during high-traffic periods
   276→
   277→---
   278→
   279→## Environment Variables Reference
   280→
   281→For CI/CD or automated builds, set these environment variables:
   282→
   283→```bash
   284→# Required for signing
   285→export SIGNING_IDENTITY="Developer ID Installer: Your Name (TEAM_ID)"
   286→
   287→# Required for notarization
   288→export APPLE_ID="your@email.com"
   289→export TEAM_ID="YOUR_TEAM_ID"
   290→export APP_PASSWORD="xxxx-xxxx-xxxx-xxxx"
   291→```
   292→
   293→Or use the signing script options:
   294→```bash
   295→./macos/sign-and-notarize.sh \
   296→    --identity "Developer ID Installer: Your Name (TEAM_ID)" \
   297→    --apple-id "your@email.com" \
   298→    --team-id "YOUR_TEAM_ID" \
   299→    --password "xxxx-xxxx-xxxx-xxxx" \
   300→    dist/SPLICE-Installer-6.0.3.pkg
   301→```
   302→
   303→---
   304→
   305→## Security Best Practices
   306→
   307→1. **Never commit credentials** to version control
   308→2. **Use keychain** for local development
   309→3. **Use GitHub Secrets** for CI/CD
   310→4. **Rotate app-specific passwords** periodically
   311→5. **Keep certificates secure** - back up your Keychain
   312→
   313→---
   314→
   315→## Quick Reference
   316→
   317→| Item | Where to Get |
   318→|------|-------------|
   319→| Developer ID Installer Certificate | [developer.apple.com/account/resources/certificates](https://developer.apple.com/account/resources/certificates) |
   320→| App-Specific Password | [appleid.apple.com](https://appleid.apple.com) → Sign-In and Security |
   321→| Team ID | Certificate name or [developer.apple.com/account](https://developer.apple.com/account) |
   322→

</system-reminder>
