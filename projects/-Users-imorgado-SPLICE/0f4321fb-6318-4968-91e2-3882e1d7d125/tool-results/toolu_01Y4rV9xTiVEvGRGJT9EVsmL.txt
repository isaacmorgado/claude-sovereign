     1→/**
     2→ * SPLICE CEP Browser Simulation
     3→ * Mocks Adobe CEP environment and Backend APIs for full feature testing in browser.
     4→ */
     5→
     6→(function () {
     7→    console.log('%c [SPLICE SIMULATION] Initializing... ', 'background: #00d1b2; color: black; font-weight: bold;');
     8→
     9→    // ============================================================================
    10→    // 0. MOCK window.__adobe_cep__ (MUST BE FIRST)
    11→    // ============================================================================
    12→    // This enables CSInterface.js to work in browser mode
    13→    if (!window.__adobe_cep__) {
    14→        window.__adobe_cep__ = {
    15→            evalScript: function(script, callback) {
    16→                console.log(`%c[JSX Mock] ${script.substring(0, 60)}${script.length > 60 ? '...' : ''}`, 'color: #aaa');
    17→
    18→                const cmd = script.split('(')[0];
    19→
    20→                setTimeout(() => {
    21→                    let result = 'true';
    22→
    23→                    // Core mocks
    24→                    if (cmd === 'checkSequenceOpen') {
    25→                        result = 'true';
    26→                    } else if (cmd === 'getActiveSequence') {
    27→                        result = JSON.stringify({
    28→                            name: 'Mock Sequence 01',
    29→                            id: 'seq-123',
    30→                            audioPath: '/mock/exported/audio.wav',
    31→                            treePath: '/Mock Project/Mock Sequence 01',
    32→                            duration: 120.0
    33→                        });
    34→                    } else if (cmd === 'exportSequenceAudioForAnalysis') {
    35→                        result = JSON.stringify({
    36→                            outputPath: '/mock/temp/exported_audio.wav',
    37→                            success: true
    38→                        });
    39→                    } else if (cmd === 'getFirstClipAudioPath') {
    40→                        result = JSON.stringify({ path: '/mock/source/clip_01.wav' });
    41→                    } else if (cmd === 'getSequenceDuration') {
    42→                        result = JSON.stringify({ duration: 120.0 });
    43→                    } else if (cmd === 'getVersion') {
    44→                        result = '6.0.3-mock';
    45→                    } else if (cmd === 'buildSequenceFromCutList') {
    46→                        console.log('[JSX Mock] Building sequence from cut list...');
    47→                        result = JSON.stringify({ success: true, stats: { clipsInserted: 15 } });
    48→                    } else if (cmd === 'getSequenceSettings') {
    49→                        result = JSON.stringify({
    50→                            videoFrameRate: 24,
    51→                            videoFrameWidth: 1920,
    52→                            videoFrameHeight: 1080
    53→                        });
    54→                    }
    55→
    56→                    if (callback) callback(result);
    57→                }, 50);
    58→            },
    59→            getHostEnvironment: function() {
    60→                return JSON.stringify({
    61→                    appName: 'PPRO',
    62→                    appVersion: '25.0.0',
    63→                    appLocale: 'en_US',
    64→                    isAppOffline: false
    65→                });
    66→            },
    67→            getSystemPath: function() { return '/mock/path'; },
    68→            openURLInDefaultBrowser: function(url) { window.open(url, '_blank'); }
    69→        };
    70→        console.log('[SPLICE SIMULATION] window.__adobe_cep__ mock installed');
    71→    }
    72→
    73→    // ============================================================================
    74→    // 1. GLOBAL STATE MOCKS
    75→    // ============================================================================
    76→    window.spliceState = {
    77→        currentVideoPath: '/mock/path/to/video.mp4',
    78→        activeSequence: {
    79→            name: 'Mock Sequence 01',
    80→            id: 'seq-123',
    81→            projectItem: {
    82→                treePath: '/Mock Project/Mock Sequence 01'
    83→            }
    84→        },
    85→        lastTranscript: {
    86→            words: Array.from({ length: 50 }, (_, i) => ({
    87→                word: ['Hello', 'world', 'this', 'is', 'a', 'mock', 'transcript', 'generated', 'for', 'testing'][i % 10],
    88→                start: i * 0.5,
    89→                end: i * 0.5 + 0.4
    90→            })),
    91→            text: "Hello world this is a mock transcript generated for testing. ".repeat(5),
    92→            segments: [
    93→                { start: 0, end: 10, text: "Scene 1: Introduction to the mock video." },
    94→                { start: 10, end: 20, text: "Scene 2: Demonstrating feature capabilities." },
    95→                { start: 20, end: 30, text: "Scene 3: Conclusion and happy ending." }
    96→            ]
    97→        }
    98→    };
    99→
   100→    // Helper to get random ID
   101→    const uuid = () => 'mock-' + Math.random().toString(36).substr(2, 9);
   102→
   103→    // ============================================================================
   104→    // 2. FAVICON INJECTION
   105→    // ============================================================================
   106→    const link = document.createElement('link');
   107→    link.rel = 'icon';
   108→    link.href = 'data:image/x-icon;base64,AAABAAEAEBAAAAEAIABoBAAAFgAAACgAAAAQAAAAIAAAAAEAIAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAAAAD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A////AP///wD///8A//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAA==';
   109→    document.head.appendChild(link);
   110→
   111→    // ============================================================================
   112→    // 3. CSINTERFACE & JSX MOCKS
   113→    // ============================================================================
   114→    if (!window.CSInterface) {
   115→        window.CSInterface = function () { };
   116→        window.CSInterface.prototype.evalScript = function (script, callback) {
   117→            console.log(`%c[JSX Mock] ${script.substring(0, 50)}${script.length > 50 ? '...' : ''}`, 'color: #aaa');
   118→
   119→            // Normalize script call
   120→            const cmd = script.split('(')[0];
   121→
   122→            setTimeout(() => {
   123→                let result = 'true';
   124→
   125→                // --- Core Mocks ---
   126→                if (cmd === 'checkSequenceOpen') {
   127→                    // Return 'true' string as expected by main.js checkSequenceOpen()
   128→                    result = 'true';
   129→                } else if (cmd === 'getActiveSequence') {
   130→                    result = JSON.stringify({
   131→                        name: 'Mock Sequence 01',
   132→                        id: 'seq-123',
   133→                        audioPath: '/mock/exported/audio.wav',
   134→                        treePath: '/Mock Project/Mock Sequence 01',
   135→                        duration: 120.0
   136→                    });
   137→                } else if (cmd === 'exportSequenceAudioForAnalysis') {
   138→                    result = JSON.stringify({
   139→                        outputPath: '/mock/temp/exported_audio.wav',
   140→                        success: true
   141→                    });
   142→                } else if (cmd === 'getFirstClipAudioPath') {
   143→                    result = JSON.stringify({ path: '/mock/source/clip_01.wav' });
   144→                } else if (cmd === 'getSequenceDuration') {
   145→                    result = JSON.stringify({ duration: 120.0 });
   146→                }
   147→
   148→                // --- Multitrack Mocks ---
   149→                else if (cmd === 'importFiles') {
   150→                    console.log('[JSX Mock] Imported files');
   151→                    result = 'true';
   152→                } else if (cmd === 'buildSequenceFromCutList') {
   153→                    console.log('[JSX Mock] Building sequence from cut list...');
   154→                    result = JSON.stringify({ success: true, stats: { clipsInserted: 15 } });
   155→                }
   156→
   157→                // --- Captions Mocks ---
   158→                else if (cmd === 'createMarker') {
   159→                    console.log('[JSX Mock] Created marker');
   160→                    result = 'true';
   161→                }
   162→
   163→                // --- System Mocks ---
   164→                else if (cmd === 'getVersion') {
   165→                    result = '1.0.0-mock';
   166→                }
   167→
   168→                // --- Missing Mocks Added for Verification ---
   169→                else if (cmd === 'getAllProjectItems') {
   170→                    result = JSON.stringify([
   171→                        { name: 'Mock Sequence 01', type: 1, treePath: '/Mock Project/Mock Sequence 01' },
   172→                        { name: 'Footage.mp4', type: 2, treePath: '/Mock Project/Footage.mp4' }
   173→                    ]);
   174→                } else if (cmd === 'addChapterMarker') {
   175→                    console.log(`[JSX Mock] Added chapter marker`);
   176→                    result = 'true';
   177→                } else if (cmd === 'addZoomMarker') {
   178→                    console.log(`[JSX Mock] Added zoom marker`);
   179→                    result = 'true';
   180→                } else if (cmd === 'deleteMarkersByName') {
   181→                    console.log(`[JSX Mock] Deleted markers`);
   182→                    result = 'true';
   183→                } else if (cmd === 'getVideoFrameRateInSeconds') {
   184→                    result = '0.041666'; // 24fps
   185→                } else if (cmd === 'razorSequenceAtFramesArray') {
   186→                    console.log(`[JSX Mock] Razored sequence at frames`);
   187→                    result = 'true';
   188→                } else if (cmd === 'cloneSequence') {
   189→                    console.log(`[JSX Mock] Cloned sequence`);
   190→                    result = 'true';
   191→                } else if (cmd === 'undo') {
   192→                    console.log(`[JSX Mock] Undo performed`);
   193→                    result = 'true';
   194→                } else if (cmd === 'seekToTime') {
   195→                    console.log(`[JSX Mock] Seek to time`);
   196→                    result = 'true';
   197→                } else if (cmd === 'getSequenceSettings') {
   198→                    result = JSON.stringify({
   199→                        videoFrameRate: 24,
   200→                        videoFrameWidth: 1920,
   201→                        videoFrameHeight: 1080
   202→                    });
   203→                } else if (cmd === 'getNumTracks') {
   204→                    result = '4';
   205→                } else if (cmd === 'razorSequenceAtSeconds') {
   206→                    console.log(`[JSX Mock] Razored sequence at seconds`);
   207→                    result = 'true';
   208→                } else if (cmd === 'getClipsInTrack') {
   209→                    result = JSON.stringify([]);
   210→                } else if (cmd === 'removeClipByIndex') {
   211→                    console.log(`[JSX Mock] Removed clip`);
   212→                    result = 'true';
   213→                }
   214→
   215→                if (callback) {
   216→                    // Start of JSON if applicable
   217→                    if (typeof result === 'object') {
   218→                        callback(JSON.stringify(result));
   219→                    } else {
   220→                        callback(result);
   221→                    }
   222→                }
   223→            }, 100);
   224→        };
   225→
   226→        window.CSInterface.prototype.getHostEnvironment = function () {
   227→            return JSON.stringify({
   228→                appId: 'PPRO',
   229→                appVersion: '24.0.0',
   230→                appLocale: 'en_US',
   231→                appSkinInfo: {
   232→                    panelBackgroundColor: { color: { red: 30, green: 30, blue: 30 } },
   233→                    baseFontSize: 12
   234→                }
   235→            });
   236→        };
   237→
   238→        // Mock active sequence state on window
   239→        window.isSequenceOpen = true;
   240→    }
   241→
   242→    // ============================================================================
   243→    // 5. MOCK STATE (MUSIC)
   244→    // ============================================================================
   245→    window.mockMusicLibrary = [
   246→        { id: 'song-1', title: 'Cyberpunk City', style: 'Electronic', duration: 120, mood: 'Energetic' },
   247→        { id: 'song-2', title: 'Summer Breeze', style: 'Acoustic', duration: 180, mood: 'Relaxed' }
   248→    ];
   249→    window.mockJobRegistry = new Map();
   250→
   251→    // ============================================================================
   252→    // 6. FETCH API MOCKS (BACKEND)
   253→    // ============================================================================
   254→    const originalFetch = window.fetch;
   255→    window.fetch = async function (url, options) {
   256→        console.log(`%c[Fetch Mock] ${options?.method || 'GET'} ${url}`, 'color: #4ecdc4');
   257→
   258→        // Helper to delay response
   259→        const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));
   260→        await delay(300); // Simulate network latency
   261→
   262→        // -------------------------
   263→        // CORE ROUTES
   264→        // -------------------------
   265→        if (url.includes('/silences-rms')) {
   266→            return new Response(JSON.stringify({
   267→                silences: [
   268→                    { start: 5.5, end: 7.2 },
   269→                    { start: 15.0, end: 16.5 },
   270→                    { start: 45.2, end: 48.0 }
   271→                ]
   272→            }), { status: 200 });
   273→        }
   274→
   275→        if (url.includes('/analyze')) { // Takes detection
   276→            return new Response(JSON.stringify({
   277→                takes: [
   278→                    { start: 10, end: 20, score: 0.85, label: 'Take 1' },
   279→                    { start: 22, end: 32, score: 0.92, label: 'Take 2 (Best)' },
   280→                    { start: 35, end: 45, score: 0.76, label: 'Take 3' }
   281→                ]
   282→            }), { status: 200 });
   283→        }
   284→
   285→        if (url.includes('/cut-list')) {
   286→            return new Response(JSON.stringify({
   287→                version: '3.5',
   288→                source: {
   289→                    name: 'Mock Sequence 01',
   290→                    path: '/mock/path/to/sequence',
   291→                    duration: 120
   292→                },
   293→                segments: [
   294→                    { type: 'speech', inPoint: 0, outPoint: 5.5, takeNumber: null },
   295→                    { type: 'silence', inPoint: 5.5, outPoint: 7.2 },
   296→                    { type: 'best_take', inPoint: 10, outPoint: 20, takeNumber: 1, colorHint: 'cerulean' },
   297→                    { type: 'speech', inPoint: 20, outPoint: 45.2 },
   298→                    { type: 'silence', inPoint: 45.2, outPoint: 48.0 }
   299→                ]
   300→            }), { status: 200 });
   301→        }
   302→
   303→        // -------------------------
   304→        // MULTITRACK
   305→        // -------------------------
   306→        if (url.includes('/multitrack/auto-balance')) {
   307→            return new Response(JSON.stringify({
   308→                metadata: {
   309→                    speakerPercentages: { 'Speaker 1': 45, 'Speaker 2': 55 },
   310→                    averageShotDuration: 3.5
   311→                },
   312→                levels: { 'Speaker 1': -14, 'Speaker 2': -16 },
   313→                finalError: 1.2
   314→            }), { status: 200 });
   315→        }
   316→
   317→        if (url.includes('/multitrack')) {
   318→            return new Response(JSON.stringify({
   319→                decisions: Array.from({ length: 20 }, (_, i) => ({
   320→                    startTime: i * 5,
   321→                    endTime: (i + 1) * 5,
   322→                    speakerName: i % 2 === 0 ? 'Speaker 1' : 'Speaker 2',
   323→                    speakerIndex: i % 2,
   324→                    isWideShot: i % 5 === 0,
   325→                    reason: 'Active speaker'
   326→                })),
   327→                metadata: {
   328→                    speakerPercentages: { 'Speaker 1': 40, 'Speaker 2': 40, 'Wide': 20 },
   329→                    wideShotPercentage: 20,
   330→                    averageShotDuration: 5.0
   331→                }
   332→            }), { status: 200 });
   333→        }
   334→
   335→        // -------------------------
   336→        // CAPTIONS
   337→        // -------------------------
   338→        if (url.includes('/captions/templates')) {
   339→            return new Response(JSON.stringify({
   340→                templates: [
   341→                    { id: 'mrbeast', name: 'MrBeast', description: 'Bold, yellow/black' },
   342→                    { id: 'hormozi', name: 'Hormozi', description: 'Impactful, moving' },
   343→                    { id: 'karaoke', name: 'Karaoke', description: 'Sing-along style' }
   344→                ]
   345→            }), { status: 200 });
   346→        }
   347→
   348→        if (url.includes('/captions/animate')) {
   349→            return new Response(JSON.stringify({
   350→                totalCaptions: 15,
   351→                totalWords: 120,
   352→                duration: 60,
   353→                keywords: ['mock', 'test', 'feature'],
   354→                captions: Array.from({ length: 15 }, (_, i) => ({
   355→                    start: i * 4,
   356→                    end: i * 4 + 3.5,
   357→                    text: `This is mock caption line ${i + 1}`,
   358→                    words: [
   359→                        { word: "This", start: i * 4, end: i * 4 + 0.5 },
   360→                        { word: "is", start: i * 4 + 0.5, end: i * 4 + 1 },
   361→                        { word: "mock", start: i * 4 + 1, end: i * 4 + 2, isKeyword: true },
   362→                        { word: "caption", start: i * 4 + 2, end: i * 4 + 3 }
   363→                    ]
   364→                }))
   365→            }), { status: 200 });
   366→        }
   367→
   368→        if (url.includes('/captions/apply-template')) {
   369→            return new Response(JSON.stringify({
   370→                captions: JSON.parse(options.body).captionData.captions
   371→            }), { status: 200 });
   372→        }
   373→
   374→        if (url.includes('/captions/export') || url.includes('/export/captions')) {
   375→            return new Response(JSON.stringify({
   376→                content: "Mock Export Content",
   377→                data: { mock: "mogrt data" }
   378→            }), { status: 200 });
   379→        }
   380→
   381→        // -------------------------
   382→        // TEXT EDITOR
   383→        // -------------------------
   384→        if (url.includes('/text-edit/prepare')) {
   385→            return new Response(JSON.stringify({
   386→                editableTranscript: {
   387→                    plainText: "Hello world this is a mock transcript.\nIt has multiple lines.\nYou can edit this.",
   388→                    totalWords: 15,
   389→                    duration: 10
   390→                }
   391→            }), { status: 200 });
   392→        }
   393→
   394→        if (url.includes('/text-edit/search')) {
   395→            const body = JSON.parse(options.body);
   396→            return new Response(JSON.stringify({
   397→                matches: [{ start: 0, text: body.searchText }],
   398→                totalMatches: 1
   399→            }), { status: 200 });
   400→        }
   401→
   402→        if (url.includes('/text-edit/preview')) {
   403→            return new Response(JSON.stringify({
   404→                summary: { deletions: 1, reorderings: 0 },
   405→                impact: { percentageRemoved: 5 },
   406→                changes: [{ type: 'deletion', description: 'Removed text', timeRange: '0:00-0:05' }]
   407→            }), { status: 200 });
   408→        }
   409→
   410→        if (url.includes('/text-edit/apply')) {
   411→            return new Response(JSON.stringify({
   412→                stats: { deletions: 1 },
   413→                operations: []
   414→            }), { status: 200 });
   415→        }
   416→
   417→        if (url.includes('/text-edit/cut-list')) {
   418→            return new Response(JSON.stringify({
   419→                cutList: { segments: [] },
   420→                summary: { segmentCount: 5 }
   421→            }), { status: 200 });
   422→        }
   423→
   424→        // -------------------------
   425→        // SOCIAL REFRAME
   426→        // -------------------------
   427→        if (url.includes('/reframe/platforms')) {
   428→            return new Response(JSON.stringify({
   429→                platforms: [
   430→                    { id: 'tiktok', name: 'TikTok', aspectRatio: 'portrait' },
   431→                    { id: 'instagram', name: 'Instagram', aspectRatio: 'square' }
   432→                ],
   433→                aspectRatios: [
   434→                    { id: 'portrait', name: '9:16', ratio: 0.5625 },
   435→                    { id: 'square', name: '1:1', ratio: 1.0 }
   436→                ]
   437→            }), { status: 200 });
   438→        }
   439→
   440→        if (url.includes('/reframe/safe-zones')) {
   441→            return new Response(JSON.stringify({
   442→                safeZone: { top: 0.1, bottom: 0.2, left: 0.05, right: 0.15 }
   443→            }), { status: 200 });
   444→        }
   445→
   446→        if (url.includes('/reframe/analyze')) {
   447→            return new Response(JSON.stringify({
   448→                status: 'success',
   449→                tracksFound: [{ id: 1, name: 'Main Subject', confidence: 0.95 }],
   450→                best_crop: { x: 100, y: 0, width: 607, height: 1080 }, // Support both formats
   451→                faceTracking: { tracksFound: 1, tracks: [{ positions: [{ x: 0.4, y: 0.3, width: 0.2, height: 0.2 }] }] },
   452→                videoInfo: { width: 1920, height: 1080, duration: 60 },
   453→                suggestions: {
   454→                    portrait: { method: 'face-track', static: true, crop: { x: 0.25, y: 0, width: 0.5625, height: 1 } },
   455→                    square: { method: 'center', static: true, crop: { x: 0.2, y: 0, width: 1, height: 1 } }
   456→                }
   457→            }), { status: 200 });
   458→        }
   459→
   460→        if (url.includes('/reframe/export')) {
   461→            return new Response(JSON.stringify({
   462→                status: 'success',
   463→                totalFormats: 1,
   464→                exports: [{
   465→                    name: 'TikTok',
   466→                    platform: 'TikTok',
   467→                    dimensions: { width: 1080, height: 1920 },
   468→                    ffmpegFilter: 'crop=...',
   469→                    status: 'ready',
   470→                    crop: { x: 100, y: 0, width: 607, height: 1080 }
   471→                }]
   472→            }), { status: 200 });
   473→        }
   474→
   475→        // -------------------------
   476→        // MUSIC (STATEFUL)
   477→        // -------------------------
   478→        if (url.includes('/music/library')) {
   479→            return new Response(JSON.stringify(window.mockMusicLibrary), { status: 200 });
   480→        }
   481→
   482→        if (url.includes('/music/credits')) {
   483→            return new Response(JSON.stringify({
   484→                remaining: 50,
   485→                total: 100
   486→            }), { status: 200 });
   487→        }
   488→
   489→        if (url.includes('/music/identify')) {
   490→            return new Response(JSON.stringify({
   491→                identified: true,
   492→                title: 'Never Gonna Give You Up',
   493→                artist: 'Rick Astley',
   494→                bpm: 113,
   495→                key: 'Bb Major',
   496→                mood: 'Happy',
   497→                sourceUrl: 'https://youtube.com/watch?v=dQw4w9WgXcQ'
   498→            }), { status: 200 });
   499→        }
   500→
   501→        if (url.includes('/music/generate')) {
   502→            const body = JSON.parse(options.body || '{}');
   503→            const jobId = uuid();
   504→            window.mockJobRegistry.set(jobId, {
   505→                status: 'processing',
   506→                progress: 0,
   507→                details: body, // Store mood, prompt, youtubeUrl
   508→                result: null
   509→            });
   510→            return new Response(JSON.stringify({
   511→                jobId: jobId,
   512→                status: 'queued'
   513→            }), { status: 200 });
   514→        }
   515→
   516→        if (url.includes('/music/status') || url.includes('/music/variations/status')) {
   517→            // Extract jobId from URL: /music/status/{jobId}
   518→            const parts = url.split('/');
   519→            const jobId = parts[parts.length - 1];
   520→
   521→            const job = window.mockJobRegistry.get(jobId);
   522→
   523→            if (job) {
   524→                // Advance progress
   525→                job.progress = Math.min(100, job.progress + 20);
   526→
   527→                if (job.progress >= 100 && job.status !== 'completed') {
   528→                    job.status = 'completed';
   529→                    // --- SYNC TO LIBRARY LOGIC ---
   530→                    const newSong = {
   531→                        id: `song-${Date.now()}`,
   532→                        title: job.details.youtubeUrl ? 'Never Gonna Give You Up (AI Version)' : 'Generated Track',
   533→                        style: job.details.instruments?.[0] || 'Electronic',
   534→                        duration: job.details.duration || 60,
   535→                        mood: job.details.mood || 'Neutral',
   536→                        date: new Date().toISOString()
   537→                    };
   538→                    window.mockMusicLibrary.unshift(newSong);
   539→                    // -----------------------------
   540→                }
   541→
   542→                return new Response(JSON.stringify({
   543→                    state: job.status === 'completed' ? 'completed' : 'processing',
   544→                    progress: job.progress,
   545→                    result: job.status === 'completed' ? { file: 'mock_music.mp3' } : null
   546→                }), { status: 200 });
   547→            } else {
   548→                return new Response(JSON.stringify({ error: 'Job not found' }), { status: 404 });
   549→            }
   550→        }
   551→
   552→        if (url.includes('/music/generate-scene-aware')) {
   553→            return new Response(JSON.stringify({
   554→                jobId: uuid(),
   555→                status: 'queued'
   556→            }), { status: 200 });
   557→        }
   558→
   559→        if (url.includes('/music/generate-timeline')) {
   560→            return new Response(JSON.stringify({
   561→                jobId: uuid(),
   562→                status: 'queued'
   563→            }), { status: 200 });
   564→        }
   565→
   566→        if (url.includes('/music/timeline-estimate')) {
   567→            return new Response(JSON.stringify({
   568→                estimatedChapters: 5,
   569→                estimatedMinutes: 3,
   570→                estimatedTimeDisplay: '3 minutes'
   571→            }), { status: 200 });
   572→        }
   573→
   574→        // --- MUSIC ALIGNMENT MOCKS ---
   575→        if (url.includes('/music/alignment-options')) {
   576→            return new Response(JSON.stringify({
   577→                minAudioDuration: 5,
   578→                fadeDuration: { default: 2.0, min: 0.5, max: 5.0 }
   579→            }), { status: 200 });
   580→        }
   581→
   582→        if (url.includes('/music/analyze-beats')) {
   583→            return new Response(JSON.stringify({
   584→                duration: 120,
   585→                bpm: 113,
   586→                beatCount: 226,
   587→                beats: []
   588→            }), { status: 200 });
   589→        }
   590→
   591→        if (url.includes('/music/align')) {
   592→            return new Response(JSON.stringify({
   593→                status: 'success',
   594→                message: 'Aligned and trimmed music to sequence.'
   595→            }), { status: 200 });
   596→        }
   597→
   598→        // -------------------------
   599→        // HEALTH CHECK
   600→        // -------------------------
   601→        if (url.includes('/health')) {
   602→            return new Response(JSON.stringify({
   603→                status: 'ok',
   604→                version: '6.0.2-mock',
   605→                uptime: 12345
   606→            }), { status: 200 });
   607→        }
   608→
   609→        // Default 404 for unhandled mocks
   610→        console.warn(`[Fetch Mock] Unhandled URL: ${url}`);
   611→        return new Response(JSON.stringify({ error: 'Mock endpoint not found' }), { status: 404 });
   612→    };
   613→
   614→    console.log('[SPLICE SIMULATION] Ready. "Go" button and all modules should function.');
   615→})();
   616→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
