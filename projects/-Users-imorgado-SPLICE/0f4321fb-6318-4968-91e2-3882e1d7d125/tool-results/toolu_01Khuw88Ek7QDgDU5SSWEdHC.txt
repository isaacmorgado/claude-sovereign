     1→/**
     2→ * SPLICE CEP Social Reframe Module
     3→ *
     4→ * Auto-crops video to vertical/square formats for social media.
     5→ * Supports TikTok, Instagram Reels, YouTube Shorts with face tracking.
     6→ */
     7→
     8→// ============================================================================
     9→// STATE
    10→// ============================================================================
    11→
    12→const socialReframeState = {
    13→  platforms: [],
    14→  aspectRatios: [],
    15→  selectedPlatform: 'tiktok',
    16→  selectedAspectRatio: 'portrait',
    17→  analysis: null,
    18→  exportQueue: [],
    19→  isAnalyzing: false,
    20→  isExporting: false,
    21→  currentVideoPath: null,
    22→  safeZones: null,
    23→  showSafeZones: false
    24→};
    25→
    26→// ============================================================================
    27→// DOM ELEMENT CACHE
    28→// ============================================================================
    29→
    30→const reframeElements = {
    31→  panel: null,
    32→  platformSelector: null,
    33→  aspectSelector: null,
    34→  analysisResults: null,
    35→  previewCanvas: null,
    36→  exportResults: null,
    37→  status: null,
    38→  analyzeBtn: null,
    39→  exportBtn: null,
    40→  exportAllBtn: null,
    41→  toggleSafeZonesBtn: null,
    42→  smoothingSlider: null,
    43→  smoothingDisplay: null
    44→};
    45→
    46→/**
    47→ * Cache DOM elements for social reframe
    48→ */
    49→function cacheReframeElements() {
    50→  reframeElements.panel = document.getElementById('social-reframe-panel');
    51→  reframeElements.platformSelector = document.getElementById('reframe-platform-selector');
    52→  reframeElements.aspectSelector = document.getElementById('reframe-aspect-selector');
    53→  reframeElements.analysisResults = document.getElementById('reframe-analysis-results');
    54→  reframeElements.previewCanvas = document.getElementById('reframe-preview-canvas');
    55→  reframeElements.exportResults = document.getElementById('reframe-export-results');
    56→  reframeElements.status = document.getElementById('reframe-status');
    57→  reframeElements.analyzeBtn = document.getElementById('analyze-reframe-btn');
    58→  reframeElements.exportBtn = document.getElementById('export-reframe-btn');
    59→  reframeElements.exportAllBtn = document.getElementById('export-all-formats-btn');
    60→  reframeElements.toggleSafeZonesBtn = document.getElementById('toggle-safe-zones-btn');
    61→  reframeElements.smoothingSlider = document.getElementById('motion-smoothing-slider');
    62→  reframeElements.smoothingDisplay = document.getElementById('smoothing-value-display');
    63→}
    64→
    65→// ============================================================================
    66→// INITIALIZATION
    67→// ============================================================================
    68→
    69→/**
    70→ * Initialize social reframe module
    71→ */
    72→async function initSocialReframe() {
    73→  console.log('[SPLICE] Initializing social reframe module');
    74→
    75→  // Cache DOM elements
    76→  cacheReframeElements();
    77→
    78→  // Load platforms and aspect ratios
    79→  await loadPlatformPresets();
    80→
    81→  // Setup event listeners
    82→  setupReframeEventListeners();
    83→
    84→  // Render platform buttons
    85→  renderPlatformSelector();
    86→
    87→  console.log('[SPLICE] Social reframe module initialized');
    88→}
    89→
    90→/**
    91→ * Load platform presets from backend
    92→ */
    93→async function loadPlatformPresets() {
    94→  try {
    95→    const backendUrl = getBackendUrl();
    96→    const fetchFn = typeof fetchWithTimeout === 'function' ? fetchWithTimeout : fetch;
    97→
    98→    const response = await fetchFn(`${backendUrl}/reframe/platforms`, {
    99→      method: 'GET',
   100→      headers: { 'Content-Type': 'application/json' }
   101→    });
   102→
   103→    if (response.ok) {
   104→      const data = await response.json();
   105→      socialReframeState.platforms = data.platforms || [];
   106→      socialReframeState.aspectRatios = data.aspectRatios || [];
   107→      console.log(`[SPLICE] Loaded ${socialReframeState.platforms.length} platforms`);
   108→    }
   109→  } catch (err) {
   110→    console.error('[SPLICE] Failed to load platform presets:', err);
   111→    // Use fallback presets
   112→    socialReframeState.platforms = [
   113→      { id: 'tiktok', name: 'TikTok', aspectRatio: 'portrait', maxDuration: 180 },
   114→      { id: 'reels', name: 'Instagram Reels', aspectRatio: 'portrait', maxDuration: 90 },
   115→      { id: 'shorts', name: 'YouTube Shorts', aspectRatio: 'portrait', maxDuration: 60 },
   116→      { id: 'instagram_feed', name: 'Instagram Feed', aspectRatio: 'square', maxDuration: 60 }
   117→    ];
   118→    socialReframeState.aspectRatios = [
   119→      { id: 'portrait', name: 'Portrait (9:16)', ratio: 0.5625 },
   120→      { id: 'square', name: 'Square (1:1)', ratio: 1 },
   121→      { id: 'portrait_4_5', name: 'Portrait (4:5)', ratio: 0.8 }
   122→    ];
   123→  }
   124→}
   125→
   126→/**
   127→ * Setup event listeners
   128→ */
   129→function setupReframeEventListeners() {
   130→  document.addEventListener('click', (e) => {
   131→    // Platform selection
   132→    if (e.target.closest('.reframe-platform-btn')) {
   133→      const btn = e.target.closest('.reframe-platform-btn');
   134→      const platformId = btn.dataset.platformId;
   135→      selectPlatform(platformId);
   136→    }
   137→
   138→    // Aspect ratio selection
   139→    if (e.target.closest('.reframe-aspect-btn')) {
   140→      const btn = e.target.closest('.reframe-aspect-btn');
   141→      const aspectId = btn.dataset.aspectId;
   142→      selectAspectRatio(aspectId);
   143→    }
   144→
   145→    // Analyze button
   146→    if (e.target.id === 'analyze-reframe-btn') {
   147→      analyzeForReframe();
   148→    }
   149→
   150→    // Export buttons
   151→    if (e.target.id === 'export-reframe-btn') {
   152→      exportReframe();
   153→    }
   154→    if (e.target.id === 'export-all-formats-btn') {
   155→      exportAllFormats();
   156→    }
   157→
   158→    // Preview toggle
   159→    if (e.target.id === 'toggle-safe-zones-btn') {
   160→      toggleSafeZones();
   161→    }
   162→
   163→    // Toggle panel collapse
   164→    if (e.target.closest('.reframe-header')) {
   165→      const panel = document.getElementById('social-reframe-panel');
   166→      if (panel) {
   167→        const isCollapsed = panel.classList.toggle('collapsed');
   168→        const icon = e.target.closest('.section-toggle')?.querySelector('.toggle-icon');
   169→        if (icon) {
   170→          icon.textContent = isCollapsed ? '+' : '-';
   171→        }
   172→      }
   173→    }
   174→  });
   175→
   176→  // Motion smoothing slider
   177→  document.addEventListener('input', (e) => {
   178→    if (e.target.id === 'motion-smoothing-slider') {
   179→      updateSmoothingValue(e.target.value);
   180→    }
   181→  });
   182→}
   183→
   184→// ============================================================================
   185→// PLATFORM & ASPECT RATIO SELECTION
   186→// ============================================================================
   187→
   188→/**
   189→ * SECURITY: Escape HTML to prevent XSS
   190→ */
   191→function escapeHtmlReframe(str) {
   192→  if (!str) return '';
   193→  const div = document.createElement('div');
   194→  div.textContent = str;
   195→  return div.innerHTML;
   196→}
   197→
   198→/**
   199→ * Render platform selector buttons
   200→ */
   201→function renderPlatformSelector() {
   202→  const container = reframeElements.platformSelector || document.getElementById('reframe-platform-selector');
   203→  if (!container) return;
   204→
   205→  // SECURITY: Escape platform data to prevent XSS
   206→  const html = socialReframeState.platforms.map(platform => {
   207→    const safeId = escapeHtmlReframe(platform.id);
   208→    const safeName = escapeHtmlReframe(platform.name);
   209→    return `
   210→    <button class="reframe-platform-btn ${socialReframeState.selectedPlatform === platform.id ? 'selected' : ''}"
   211→            data-platform-id="${safeId}"
   212→            aria-label="Select ${safeName}">
   213→      <span class="platform-icon platform-icon-${safeId}"></span>
   214→      <span class="platform-name">${safeName}</span>
   215→    </button>
   216→  `;
   217→  }).join('');
   218→
   219→  container.innerHTML = html;
   220→
   221→  // Also render aspect ratio buttons
   222→  renderAspectRatioSelector();
   223→}
   224→
   225→/**
   226→ * Render aspect ratio selector
   227→ */
   228→function renderAspectRatioSelector() {
   229→  const container = reframeElements.aspectSelector || document.getElementById('reframe-aspect-selector');
   230→  if (!container) return;
   231→
   232→  // SECURITY: Escape aspect ratio data to prevent XSS
   233→  const html = socialReframeState.aspectRatios.map(aspect => {
   234→    const safeId = escapeHtmlReframe(aspect.id);
   235→    const safeName = escapeHtmlReframe(aspect.name);
   236→    return `
   237→    <button class="reframe-aspect-btn ${socialReframeState.selectedAspectRatio === aspect.id ? 'selected' : ''}"
   238→            data-aspect-id="${safeId}"
   239→            aria-label="Select ${safeName}">
   240→      <span class="aspect-preview aspect-preview-${safeId}"></span>
   241→      <span class="aspect-name">${safeName}</span>
   242→    </button>
   243→  `;
   244→  }).join('');
   245→
   246→  container.innerHTML = html;
   247→}
   248→
   249→/**
   250→ * Select platform
   251→ */
   252→function selectPlatform(platformId) {
   253→  const platform = socialReframeState.platforms.find(p => p.id === platformId);
   254→  if (!platform) return;
   255→
   256→  socialReframeState.selectedPlatform = platformId;
   257→  socialReframeState.selectedAspectRatio = platform.aspectRatio;
   258→
   259→  // Update UI
   260→  document.querySelectorAll('.reframe-platform-btn').forEach(btn => {
   261→    btn.classList.toggle('selected', btn.dataset.platformId === platformId);
   262→  });
   263→
   264→  renderAspectRatioSelector();
   265→  loadSafeZones(platformId);
   266→
   267→  console.log(`[SPLICE] Selected platform: ${platform.name}`);
   268→}
   269→
   270→/**
   271→ * Select aspect ratio
   272→ */
   273→function selectAspectRatio(aspectId) {
   274→  socialReframeState.selectedAspectRatio = aspectId;
   275→
   276→  document.querySelectorAll('.reframe-aspect-btn').forEach(btn => {
   277→    btn.classList.toggle('selected', btn.dataset.aspectId === aspectId);
   278→  });
   279→
   280→  // Update preview if available
   281→  if (socialReframeState.analysis) {
   282→    updateCropPreview();
   283→  }
   284→
   285→  console.log(`[SPLICE] Selected aspect ratio: ${aspectId}`);
   286→}
   287→
   288→/**
   289→ * Load safe zones for platform
   290→ */
   291→async function loadSafeZones(platformId) {
   292→  try {
   293→    const backendUrl = getBackendUrl();
   294→    const fetchFn = typeof fetchWithTimeout === 'function' ? fetchWithTimeout : fetch;
   295→
   296→    const response = await fetchFn(`${backendUrl}/reframe/safe-zones/${platformId}`, {
   297→      method: 'GET',
   298→      headers: { 'Content-Type': 'application/json' }
   299→    });
   300→
   301→    if (response.ok) {
   302→      const data = await response.json();
   303→      socialReframeState.safeZones = data;
   304→      renderSafeZoneOverlay();
   305→    }
   306→  } catch (err) {
   307→    console.error('[SPLICE] Failed to load safe zones:', err);
   308→  }
   309→}
   310→
   311→// ============================================================================
   312→// ANALYSIS
   313→// ============================================================================
   314→
   315→/**
   316→ * Analyze current video for reframe
   317→ */
   318→async function analyzeForReframe() {
   319→  const videoPath = getCurrentVideoPath();
   320→  if (!videoPath) {
   321→    showReframeStatus('No video selected', 'error');
   322→    return;
   323→  }
   324→
   325→  socialReframeState.isAnalyzing = true;
   326→  updateAnalyzeButton(true);
   327→  showReframeStatus('Analyzing video for face tracking...', 'info');
   328→
   329→  try {
   330→    const backendUrl = getBackendUrl();
   331→    const headers = typeof getAuthHeaders === 'function' ? getAuthHeaders() : { 'Content-Type': 'application/json' };
   332→    const fetchFn = typeof fetchWithTimeout === 'function' ? fetchWithTimeout : fetch;
   333→
   334→    const slider = reframeElements.smoothingSlider || document.getElementById('motion-smoothing-slider');
   335→    const smoothing = slider?.value || 0.3;
   336→
   337→    const response = await fetchFn(`${backendUrl}/reframe/analyze`, {
   338→      method: 'POST',
   339→      headers,
   340→      body: JSON.stringify({
   341→        videoPath,
   342→        options: {
   343→          sampleRate: 0.5,
   344→          smoothing: parseFloat(smoothing)
   345→        }
   346→      })
   347→    });
   348→
   349→    if (!response.ok) {
   350→      const err = await response.json();
   351→      throw new Error(err.error || 'Analysis failed');
   352→    }
   353→
   354→    const data = await response.json();
   355→    socialReframeState.analysis = data;
   356→    socialReframeState.currentVideoPath = videoPath;
   357→
   358→    // Update UI
   359→    renderAnalysisResults(data);
   360→    updateCropPreview();
   361→    showReframeStatus(`Found ${data.faceTracking.tracksFound} face(s)`, 'success');
   362→
   363→  } catch (err) {
   364→    console.error('[SPLICE] Reframe analysis error:', err);
   365→    showReframeStatus(err.message, 'error');
   366→  } finally {
   367→    socialReframeState.isAnalyzing = false;
   368→    updateAnalyzeButton(false);
   369→  }
   370→}
   371→
   372→/**
   373→ * Get current video path from main module or JSX
   374→ */
   375→function getCurrentVideoPath() {
   376→  // Try to get from main module state
   377→  if (window.spliceState?.currentVideoPath) {
   378→    return window.spliceState.currentVideoPath;
   379→  }
   380→
   381→  // Try from active sequence
   382→  if (window.spliceState?.activeSequence?.projectItem?.treePath) {
   383→    return window.spliceState.activeSequence.projectItem.treePath;
   384→  }
   385→
   386→  return socialReframeState.currentVideoPath;
   387→}
   388→
   389→/**
   390→ * Set video path for reframe
   391→ */
   392→function setVideoPath(videoPath) {
   393→  socialReframeState.currentVideoPath = videoPath;
   394→}
   395→
   396→/**
   397→ * Render analysis results
   398→ */
   399→function renderAnalysisResults(analysis) {
   400→  const container = reframeElements.analysisResults || document.getElementById('reframe-analysis-results');
   401→  if (!container) return;
   402→
   403→  // SECURITY: Escape analysis data to prevent XSS
   404→  const html = `
   405→    <div class="analysis-summary">
   406→      <div class="analysis-stat">
   407→        <span class="stat-label">Faces Found</span>
   408→        <span class="stat-value">${escapeHtmlReframe(String(analysis.faceTracking.tracksFound))}</span>
   409→      </div>
   410→      <div class="analysis-stat">
   411→        <span class="stat-label">Video Duration</span>
   412→        <span class="stat-value">${escapeHtmlReframe(formatDuration(analysis.videoInfo.duration))}</span>
   413→      </div>
   414→      <div class="analysis-stat">
   415→        <span class="stat-label">Resolution</span>
   416→        <span class="stat-value">${escapeHtmlReframe(String(analysis.videoInfo.width))}x${escapeHtmlReframe(String(analysis.videoInfo.height))}</span>
   417→      </div>
   418→    </div>
   419→    <div class="analysis-formats">
   420→      ${Object.entries(analysis.suggestions).map(([key, suggestion]) => `
   421→        <div class="format-suggestion" data-format="${escapeHtmlReframe(key)}">
   422→          <span class="format-name">${escapeHtmlReframe(getAspectRatioName(key))}</span>
   423→          <span class="format-method">${escapeHtmlReframe(suggestion.method)}</span>
   424→          <span class="format-keyframes">${escapeHtmlReframe(String(suggestion.totalKeyframes || 0))} keyframes</span>
   425→        </div>
   426→      `).join('')}
   427→    </div>
   428→  `;
   429→
   430→  container.innerHTML = html;
   431→}
   432→
   433→/**
   434→ * Get aspect ratio name
   435→ */
   436→function getAspectRatioName(id) {
   437→  const aspect = socialReframeState.aspectRatios.find(a => a.id === id);
   438→  return aspect?.name || id;
   439→}
   440→
   441→// ============================================================================
   442→// PREVIEW
   443→// ============================================================================
   444→
   445→/**
   446→ * Update crop preview canvas
   447→ */
   448→function updateCropPreview() {
   449→  const canvas = reframeElements.previewCanvas || document.getElementById('reframe-preview-canvas');
   450→  if (!canvas || !socialReframeState.analysis) return;
   451→
   452→  const ctx = canvas.getContext('2d');
   453→  const { videoInfo, suggestions } = socialReframeState.analysis;
   454→  const aspectId = socialReframeState.selectedAspectRatio;
   455→  const suggestion = suggestions[aspectId];
   456→
   457→  if (!suggestion) return;
   458→
   459→  // Clear canvas
   460→  ctx.clearRect(0, 0, canvas.width, canvas.height);
   461→
   462→  // Draw video frame representation
   463→  const scale = Math.min(canvas.width / videoInfo.width, canvas.height / videoInfo.height);
   464→  const videoW = videoInfo.width * scale;
   465→  const videoH = videoInfo.height * scale;
   466→  const videoX = (canvas.width - videoW) / 2;
   467→  const videoY = (canvas.height - videoH) / 2;
   468→
   469→  // Draw video background
   470→  ctx.fillStyle = '#333';
   471→  ctx.fillRect(videoX, videoY, videoW, videoH);
   472→
   473→  // Draw crop region
   474→  const crop = suggestion.static ? suggestion.crop : suggestion.keyframes[0]?.crop;
   475→  if (crop) {
   476→    ctx.strokeStyle = '#00ff00';
   477→    ctx.lineWidth = 2;
   478→    ctx.strokeRect(
   479→      videoX + crop.x * videoW,
   480→      videoY + crop.y * videoH,
   481→      crop.width * videoW,
   482→      crop.height * videoH
   483→    );
   484→
   485→    // Draw face indicator
   486→    if (socialReframeState.analysis.faceTracking.tracks[0]) {
   487→      const face = socialReframeState.analysis.faceTracking.tracks[0].positions[0];
   488→      if (face) {
   489→        ctx.fillStyle = 'rgba(255, 0, 0, 0.3)';
   490→        ctx.fillRect(
   491→          videoX + face.x * videoW,
   492→          videoY + face.y * videoH,
   493→          face.width * videoW,
   494→          face.height * videoH
   495→        );
   496→      }
   497→    }
   498→  }
   499→
   500→  // Draw safe zones if enabled
   501→  if (socialReframeState.showSafeZones && socialReframeState.safeZones) {
   502→    renderSafeZoneOnCanvas(ctx, videoX, videoY, videoW, videoH);
   503→  }
   504→}
   505→
   506→/**
   507→ * Render safe zone overlay on canvas
   508→ */
   509→function renderSafeZoneOnCanvas(ctx, x, y, width, height) {
   510→  const sz = socialReframeState.safeZones.safeZone;
   511→  if (!sz) return;
   512→
   513→  ctx.fillStyle = 'rgba(255, 0, 0, 0.15)';
   514→
   515→  // Top safe zone
   516→  ctx.fillRect(x, y, width, height * sz.top);
   517→
   518→  // Bottom safe zone
   519→  ctx.fillRect(x, y + height * (1 - sz.bottom), width, height * sz.bottom);
   520→
   521→  // Left safe zone
   522→  ctx.fillRect(x, y, width * sz.left, height);
   523→
   524→  // Right safe zone
   525→  ctx.fillRect(x + width * (1 - sz.right), y, width * sz.right, height);
   526→}
   527→
   528→/**
   529→ * Render safe zone overlay
   530→ */
   531→function renderSafeZoneOverlay() {
   532→  updateCropPreview();
   533→}
   534→
   535→/**
   536→ * Toggle safe zones visibility
   537→ */
   538→function toggleSafeZones() {
   539→  socialReframeState.showSafeZones = !socialReframeState.showSafeZones;
   540→  updateCropPreview();
   541→
   542→  const btn = reframeElements.toggleSafeZonesBtn || document.getElementById('toggle-safe-zones-btn');
   543→  if (btn) {
   544→    btn.classList.toggle('active', socialReframeState.showSafeZones);
   545→  }
   546→}
   547→
   548→// ============================================================================
   549→// EXPORT
   550→// ============================================================================
   551→
   552→/**
   553→ * Export for selected format
   554→ */
   555→async function exportReframe() {
   556→  if (!socialReframeState.analysis) {
   557→    showReframeStatus('Analyze video first', 'error');
   558→    return;
   559→  }
   560→
   561→  socialReframeState.isExporting = true;
   562→  updateExportButton(true);
   563→  showReframeStatus('Generating export data...', 'info');
   564→
   565→  try {
   566→    const backendUrl = getBackendUrl();
   567→    const headers = typeof getAuthHeaders === 'function' ? getAuthHeaders() : { 'Content-Type': 'application/json' };
   568→    const fetchFn = typeof fetchWithTimeout === 'function' ? fetchWithTimeout : fetch;
   569→
   570→    const slider = reframeElements.smoothingSlider || document.getElementById('motion-smoothing-slider');
   571→    const smoothing = slider?.value || 0.3;
   572→
   573→    const response = await fetchFn(`${backendUrl}/reframe/export`, {
   574→      method: 'POST',
   575→      headers,
   576→      body: JSON.stringify({
   577→        videoPath: socialReframeState.currentVideoPath,
   578→        formats: [socialReframeState.selectedAspectRatio],
   579→        settings: {
   580→          quality: 'high',
   581→          motionSmoothing: parseFloat(smoothing)
   582→        }
   583→      })
   584→    });
   585→
   586→    if (!response.ok) {
   587→      const err = await response.json();
   588→      throw new Error(err.error || 'Export failed');
   589→    }
   590→
   591→    const data = await response.json();
   592→    renderExportResults(data);
   593→    showReframeStatus('Export data generated', 'success');
   594→
   595→  } catch (err) {
   596→    console.error('[SPLICE] Reframe export error:', err);
   597→    showReframeStatus(err.message, 'error');
   598→  } finally {
   599→    socialReframeState.isExporting = false;
   600→    updateExportButton(false);
   601→  }
   602→}
   603→
   604→/**
   605→ * Export all formats at once
   606→ */
   607→async function exportAllFormats() {
   608→  if (!socialReframeState.analysis) {
   609→    showReframeStatus('Analyze video first', 'error');
   610→    return;
   611→  }
   612→
   613→  const allFormats = socialReframeState.aspectRatios.map(a => a.id);
   614→
   615→  socialReframeState.isExporting = true;
   616→  updateExportButton(true);
   617→  showReframeStatus('Generating all formats...', 'info');
   618→
   619→  try {
   620→    const backendUrl = getBackendUrl();
   621→    const headers = typeof getAuthHeaders === 'function' ? getAuthHeaders() : { 'Content-Type': 'application/json' };
   622→    const fetchFn = typeof fetchWithTimeout === 'function' ? fetchWithTimeout : fetch;
   623→
   624→    const response = await fetchFn(`${backendUrl}/reframe/export`, {
   625→      method: 'POST',
   626→      headers,
   627→      body: JSON.stringify({
   628→        videoPath: socialReframeState.currentVideoPath,
   629→        formats: allFormats,
   630→        settings: { quality: 'high' }
   631→      })
   632→    });
   633→
   634→    if (!response.ok) {
   635→      const err = await response.json();
   636→      throw new Error(err.error || 'Export failed');
   637→    }
   638→
   639→    const data = await response.json();
   640→    renderExportResults(data);
   641→    showReframeStatus(`Generated ${data.totalFormats} formats`, 'success');
   642→
   643→  } catch (err) {
   644→    console.error('[SPLICE] Reframe batch export error:', err);
   645→    showReframeStatus(err.message, 'error');
   646→  } finally {
   647→    socialReframeState.isExporting = false;
   648→    updateExportButton(false);
   649→  }
   650→}
   651→
   652→/**
   653→ * Render export results
   654→ */
   655→function renderExportResults(data) {
   656→  const container = reframeElements.exportResults || document.getElementById('reframe-export-results');
   657→  if (!container) return;
   658→
   659→  // SECURITY: Escape export data to prevent XSS
   660→  const html = `
   661→    <div class="export-summary">
   662→      <span class="export-count">${escapeHtmlReframe(String(data.totalFormats))} format(s) ready</span>
   663→    </div>
   664→    <div class="export-list">
   665→      ${data.exports.map(exp => `
   666→        <div class="export-item">
   667→          <span class="export-format">${escapeHtmlReframe(exp.name)}</span>
   668→          <span class="export-dims">${escapeHtmlReframe(String(exp.dimensions.width))}x${escapeHtmlReframe(String(exp.dimensions.height))}</span>
   669→          <button class="copy-ffmpeg-btn btn btn-small" data-filter="${encodeURIComponent(exp.ffmpegFilter)}">
   670→            Copy FFmpeg
   671→          </button>
   672→        </div>
   673→      `).join('')}
   674→    </div>
   675→  `;
   676→
   677→  container.innerHTML = html;
   678→
   679→  // Add copy handlers
   680→  container.querySelectorAll('.copy-ffmpeg-btn').forEach(btn => {
   681→    btn.addEventListener('click', () => {
   682→      const filter = decodeURIComponent(btn.dataset.filter);
   683→      navigator.clipboard.writeText(filter).then(() => {
   684→        btn.textContent = 'Copied!';
   685→        setTimeout(() => btn.textContent = 'Copy FFmpeg', 2000);
   686→      });
   687→    });
   688→  });
   689→}
   690→
   691→// ============================================================================
   692→// UI HELPERS
   693→// ============================================================================
   694→
   695→/**
   696→ * Show status message
   697→ */
   698→function showReframeStatus(message, type = 'info') {
   699→  const statusEl = reframeElements.status || document.getElementById('reframe-status');
   700→  if (!statusEl) return;
   701→
   702→  statusEl.textContent = message;
   703→  statusEl.className = `reframe-status reframe-status-${type}`;
   704→
   705→  if (type !== 'error') {
   706→    setTimeout(() => {
   707→      statusEl.textContent = '';
   708→      statusEl.className = 'reframe-status';
   709→    }, 5000);
   710→  }
   711→}
   712→
   713→/**
   714→ * Update analyze button state
   715→ */
   716→function updateAnalyzeButton(isAnalyzing) {
   717→  const btn = reframeElements.analyzeBtn || document.getElementById('analyze-reframe-btn');
   718→  if (!btn) return;
   719→
   720→  btn.disabled = isAnalyzing;
   721→  btn.textContent = isAnalyzing ? 'Analyzing...' : 'Analyze Video';
   722→}
   723→
   724→/**
   725→ * Update export button state
   726→ */
   727→function updateExportButton(isExporting) {
   728→  const btn = reframeElements.exportBtn || document.getElementById('export-reframe-btn');
   729→  if (!btn) return;
   730→
   731→  btn.disabled = isExporting;
   732→  btn.textContent = isExporting ? 'Exporting...' : 'Export';
   733→}
   734→
   735→/**
   736→ * Update smoothing value display
   737→ */
   738→function updateSmoothingValue(value) {
   739→  const display = reframeElements.smoothingDisplay || document.getElementById('smoothing-value-display');
   740→  if (display) {
   741→    display.textContent = parseFloat(value).toFixed(2);
   742→  }
   743→}
   744→
   745→/**
   746→ * Format duration for display
   747→ */
   748→function formatDuration(seconds) {
   749→  const mins = Math.floor(seconds / 60);
   750→  const secs = Math.floor(seconds % 60);
   751→  return `${mins}:${secs.toString().padStart(2, '0')}`;
   752→}
   753→
   754→// ============================================================================
   755→// EXPORTS
   756→// ============================================================================
   757→
   758→// Export for global access
   759→window.spliceSocialReframe = {
   760→  init: initSocialReframe,
   761→  analyze: analyzeForReframe,
   762→  setVideoPath: setVideoPath,
   763→  selectPlatform: selectPlatform,
   764→  selectAspectRatio: selectAspectRatio,
   765→  export: exportReframe,
   766→  exportAll: exportAllFormats,
   767→  toggleSafeZones: toggleSafeZones,
   768→  getState: () => ({ ...socialReframeState })
   769→};
   770→
   771→// Also expose individual functions for direct access
   772→window.initSocialReframe = initSocialReframe;
   773→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
