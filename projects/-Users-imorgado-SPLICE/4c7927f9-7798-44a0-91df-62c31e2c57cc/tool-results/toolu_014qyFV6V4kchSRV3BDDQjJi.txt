     1â†’/**
     2â†’ * SPLICE Email Service
     3â†’ *
     4â†’ * Handles email delivery for license keys, payment notifications, etc.
     5â†’ * Supports multiple providers: SendGrid (primary), AWS SES (fallback)
     6â†’ *
     7â†’ * Required env vars:
     8â†’ * - EMAIL_PROVIDER: 'sendgrid' | 'ses' | 'console' (default: 'console' for dev)
     9â†’ * - SENDGRID_API_KEY: SendGrid API key
    10â†’ * - AWS_SES_REGION: AWS SES region (default: 'us-east-1')
    11â†’ * - AWS_ACCESS_KEY_ID: AWS access key (for SES)
    12â†’ * - AWS_SECRET_ACCESS_KEY: AWS secret (for SES)
    13â†’ * - EMAIL_FROM: Sender email address (default: 'noreply@splice.video')
    14â†’ */
    15â†’
    16â†’// ============================================================================
    17â†’// CONFIGURATION
    18â†’// ============================================================================
    19â†’
    20â†’const EMAIL_CONFIG = {
    21â†’  provider: process.env.EMAIL_PROVIDER || 'console',
    22â†’  from: process.env.EMAIL_FROM || 'SPLICE <noreply@splice.video>',
    23â†’  replyTo: process.env.EMAIL_REPLY_TO || 'support@splice.video',
    24â†’  sendgrid: {
    25â†’    apiKey: process.env.SENDGRID_API_KEY
    26â†’  },
    27â†’  ses: {
    28â†’    region: process.env.AWS_SES_REGION || 'us-east-1'
    29â†’  }
    30â†’};
    31â†’
    32â†’// SendGrid Dynamic Template IDs
    33â†’const TEMPLATE_IDS = {
    34â†’  signinCode: 'd-8ba02a0aacf0425da03610dce44fd08d',
    35â†’  emailVerification: null // Add SendGrid template ID when available
    36â†’};
    37â†’
    38â†’// Email templates
    39â†’const TEMPLATES = {
    40â†’  licenseKey: {
    41â†’    subject: 'Welcome to SPLICE! Your License Key + Quick Start Guide',
    42â†’    html: (data) => `
    43â†’<!DOCTYPE html>
    44â†’<html>
    45â†’<head>
    46â†’  <meta charset="utf-8">
    47â†’  <style>
    48â†’    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; background: #f5f5f5; margin: 0; padding: 0; }
    49â†’    .container { max-width: 600px; margin: 0 auto; padding: 40px 20px; background: white; }
    50â†’    .header { text-align: center; margin-bottom: 30px; }
    51â†’    .logo { font-size: 32px; font-weight: bold; color: #00D4FF; }
    52â†’    .tagline { color: #6b7280; font-size: 14px; margin-top: 5px; }
    53â†’    .hero-cta { background: linear-gradient(135deg, #00D4FF, #00A8CC); border-radius: 12px; padding: 30px; text-align: center; margin: 30px 0; }
    54â†’    .hero-cta h2 { color: white; margin: 0 0 15px 0; font-size: 22px; }
    55â†’    .hero-cta p { color: rgba(255,255,255,0.9); margin: 0 0 20px 0; }
    56â†’    .button-primary { display: inline-block; background: white; color: #00A8CC; padding: 14px 32px; border-radius: 8px; text-decoration: none; font-weight: bold; font-size: 16px; box-shadow: 0 4px 15px rgba(0,0,0,0.15); }
    57â†’    .button-primary:hover { background: #f0f0f0; }
    58â†’    .license-box { background: #f8fafc; border: 2px dashed #cbd5e1; border-radius: 8px; padding: 20px; text-align: center; margin: 30px 0; }
    59â†’    .license-key { font-family: monospace; font-size: 22px; font-weight: bold; color: #1e293b; letter-spacing: 2px; }
    60â†’    .tier-badge { display: inline-block; background: #00D4FF; color: white; padding: 4px 12px; border-radius: 20px; font-size: 14px; margin-top: 10px; }
    61â†’    .quick-wins { background: #f0fdf4; border: 1px solid #86efac; border-radius: 8px; padding: 20px; margin: 20px 0; }
    62â†’    .quick-wins h3 { color: #166534; margin-top: 0; }
    63â†’    .quick-wins ul { margin: 0; padding-left: 20px; }
    64â†’    .quick-wins li { margin: 8px 0; color: #15803d; }
    65â†’    .instructions { background: #f9fafb; padding: 20px; border-radius: 8px; margin: 20px 0; }
    66â†’    .instructions h3 { margin-top: 0; color: #374151; }
    67â†’    .instructions ol { margin: 0; padding-left: 20px; }
    68â†’    .instructions li { margin: 8px 0; }
    69â†’    .resources { display: table; width: 100%; margin: 20px 0; }
    70â†’    .resource-item { display: table-cell; text-align: center; padding: 15px; width: 33%; }
    71â†’    .resource-item a { display: block; color: #00A8CC; text-decoration: none; font-weight: 500; }
    72â†’    .resource-item span { display: block; font-size: 12px; color: #6b7280; margin-top: 5px; }
    73â†’    .footer { text-align: center; margin-top: 40px; padding-top: 20px; border-top: 1px solid #e5e7eb; color: #6b7280; font-size: 14px; }
    74â†’    .button { display: inline-block; background: #00D4FF; color: white; padding: 12px 24px; border-radius: 6px; text-decoration: none; margin: 10px 0; }
    75â†’  </style>
    76â†’</head>
    77â†’<body>
    78â†’  <div class="container">
    79â†’    <div class="header">
    80â†’      <div class="logo">SPLICE</div>
    81â†’      <p class="tagline">Cut Your Editing Time in Half. Automatically.</p>
    82â†’    </div>
    83â†’
    84â†’    <div class="hero-cta">
    85â†’      <h2>ğŸ‰ You're In! Let's Get Started</h2>
    86â†’      <p>Download SPLICE and make your first AI-powered edit in under 2 minutes.</p>
    87â†’      <a href="https://splice.video/download" class="button-primary">Download SPLICE â†’</a>
    88â†’    </div>
    89â†’
    90â†’    <div class="license-box">
    91â†’      <p style="margin: 0 0 10px; color: #6b7280; font-size: 12px; text-transform: uppercase; letter-spacing: 1px;">Your License Key</p>
    92â†’      <div class="license-key">${escapeHtml(data.licenseKey)}</div>
    93â†’      <div class="tier-badge">${escapeHtml(data.tier.toUpperCase())} Plan</div>
    94â†’    </div>
    95â†’
    96â†’    <div class="quick-wins">
    97â†’      <h3>âš¡ Your First 5-Minute Win</h3>
    98â†’      <ul>
    99â†’        <li><strong>Open any project</strong> in Premiere Pro</li>
   100â†’        <li><strong>Click GO</strong> in the SPLICE panel</li>
   101â†’        <li><strong>Watch silences vanish</strong> automatically</li>
   102â†’      </ul>
   103â†’      <p style="margin-bottom: 0; font-size: 14px;">Most editors save <strong>2+ hours per video</strong> on their first use!</p>
   104â†’    </div>
   105â†’
   106â†’    <div class="instructions">
   107â†’      <h3>ğŸ“‹ Setup Instructions</h3>
   108â†’      <ol>
   109â†’        <li>Open Adobe Premiere Pro (2023 or later)</li>
   110â†’        <li>Go to <strong>Window â†’ Extensions â†’ SPLICE</strong></li>
   111â†’        <li>Click the Login button and enter your license key</li>
   112â†’        <li>You're ready! Open any sequence and hit <strong>GO</strong></li>
   113â†’      </ol>
   114â†’    </div>
   115â†’
   116â†’    <p>Your ${escapeHtml(data.tier)} plan includes:</p>
   117â†’    <ul>
   118â†’      <li><strong>${escapeHtml(String(data.hours))} hours</strong> of AI processing per month</li>
   119â†’      <li><strong>${escapeHtml(String(data.musicCredits))} music credits</strong> per month</li>
   120â†’      <li>14-day free trial - cancel anytime</li>
   121â†’    </ul>
   122â†’
   123â†’    <div class="resources">
   124â†’      <div class="resource-item">
   125â†’        <a href="https://splice.video/docs/tutorials">ğŸ“š Tutorials</a>
   126â†’        <span>Step-by-step guides</span>
   127â†’      </div>
   128â†’      <div class="resource-item">
   129â†’        <a href="https://splice.video/docs/faq">â“ FAQ</a>
   130â†’        <span>Common questions</span>
   131â†’      </div>
   132â†’      <div class="resource-item">
   133â†’        <a href="mailto:support@splice.video">ğŸ’¬ Support</a>
   134â†’        <span>We're here to help</span>
   135â†’      </div>
   136â†’    </div>
   137â†’
   138â†’    <div class="footer">
   139â†’      <p>Questions? Just reply to this email - we read every message!</p>
   140â†’      <p style="font-size: 12px;">&copy; ${new Date().getFullYear()} SPLICE. All rights reserved.</p>
   141â†’    </div>
   142â†’  </div>
   143â†’</body>
   144â†’</html>
   145â†’    `,
   146â†’    text: (data) => `
   147â†’SPLICE - Welcome! Your License Key + Quick Start Guide
   148â†’=======================================================
   149â†’
   150â†’ğŸ‰ YOU'RE IN! LET'S GET STARTED
   151â†’
   152â†’Download SPLICE: https://splice.video/download
   153â†’
   154â†’YOUR LICENSE KEY:
   155â†’${data.licenseKey}
   156â†’Plan: ${data.tier.toUpperCase()}
   157â†’
   158â†’âš¡ YOUR FIRST 5-MINUTE WIN:
   159â†’1. Open any project in Premiere Pro
   160â†’2. Click GO in the SPLICE panel
   161â†’3. Watch silences vanish automatically
   162â†’
   163â†’Most editors save 2+ hours per video on their first use!
   164â†’
   165â†’ğŸ“‹ SETUP INSTRUCTIONS:
   166â†’1. Open Adobe Premiere Pro (2023 or later)
   167â†’2. Go to Window â†’ Extensions â†’ SPLICE
   168â†’3. Click the Login button and enter your license key
   169â†’4. You're ready! Open any sequence and hit GO
   170â†’
   171â†’YOUR ${data.tier.toUpperCase()} PLAN INCLUDES:
   172â†’- ${data.hours} hours of AI processing per month
   173â†’- ${data.musicCredits} music credits per month
   174â†’- 14-day free trial - cancel anytime
   175â†’
   176â†’HELPFUL RESOURCES:
   177â†’ğŸ“š Tutorials: https://splice.video/docs/tutorials
   178â†’â“ FAQ: https://splice.video/docs/faq
   179â†’ğŸ’¬ Support: support@splice.video
   180â†’
   181â†’Questions? Just reply to this email - we read every message!
   182â†’
   183â†’Â© ${new Date().getFullYear()} SPLICE. All rights reserved.
   184â†’    `
   185â†’  },
   186â†’
   187â†’  paymentWarning: {
   188â†’    subject: 'Action Required: Payment Failed for SPLICE',
   189â†’    html: (data) => `
   190â†’<!DOCTYPE html>
   191â†’<html>
   192â†’<head>
   193â†’  <meta charset="utf-8">
   194â†’  <style>
   195â†’    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; }
   196â†’    .container { max-width: 600px; margin: 0 auto; padding: 40px 20px; }
   197â†’    .header { text-align: center; margin-bottom: 30px; }
   198â†’    .logo { font-size: 32px; font-weight: bold; color: #7c3aed; }
   199â†’    .warning-box { background: #fef2f2; border: 2px solid #ef4444; border-radius: 8px; padding: 20px; margin: 20px 0; }
   200â†’    .warning-icon { font-size: 48px; text-align: center; }
   201â†’    .button { display: inline-block; background: #7c3aed; color: white; padding: 12px 24px; border-radius: 6px; text-decoration: none; margin: 10px 0; }
   202â†’    .footer { text-align: center; margin-top: 40px; color: #6b7280; font-size: 14px; }
   203â†’  </style>
   204â†’</head>
   205â†’<body>
   206â†’  <div class="container">
   207â†’    <div class="header">
   208â†’      <div class="logo">SPLICE</div>
   209â†’    </div>
   210â†’
   211â†’    <div class="warning-box">
   212â†’      <div class="warning-icon">âš ï¸</div>
   213â†’      <h2 style="text-align: center; color: #dc2626; margin: 10px 0;">Payment Failed</h2>
   214â†’      <p>We were unable to process your payment for your SPLICE subscription. This was attempt ${escapeHtml(String(data.attemptCount))} of 3.</p>
   215â†’    </div>
   216â†’
   217â†’    <p>To keep your subscription active and avoid interruption to your service, please update your payment method:</p>
   218â†’
   219â†’    <p style="text-align: center;">
   220â†’      <a href="https://splice.video/account/billing" class="button">Update Payment Method</a>
   221â†’    </p>
   222â†’
   223â†’    <p><strong>What happens next?</strong></p>
   224â†’    <ul>
   225â†’      <li>We'll automatically retry the payment in a few days</li>
   226â†’      <li>If all payment attempts fail, your subscription will be cancelled</li>
   227â†’      <li>You'll lose access to premium features</li>
   228â†’    </ul>
   229â†’
   230â†’    <p>If you have any questions or need assistance, please don't hesitate to reach out.</p>
   231â†’
   232â†’    <div class="footer">
   233â†’      <p>Need help? Reply to this email or visit <a href="https://splice.video/support">splice.video/support</a></p>
   234â†’      <p>&copy; ${new Date().getFullYear()} SPLICE. All rights reserved.</p>
   235â†’    </div>
   236â†’  </div>
   237â†’</body>
   238â†’</html>
   239â†’    `,
   240â†’    text: (data) => `
   241â†’SPLICE - Payment Failed
   242â†’
   243â†’We were unable to process your payment for your SPLICE subscription.
   244â†’This was attempt ${data.attemptCount} of 3.
   245â†’
   246â†’To keep your subscription active, please update your payment method:
   247â†’https://splice.video/account/billing
   248â†’
   249â†’WHAT HAPPENS NEXT:
   250â†’- We'll automatically retry the payment in a few days
   251â†’- If all payment attempts fail, your subscription will be cancelled
   252â†’- You'll lose access to premium features
   253â†’
   254â†’If you have any questions, please reply to this email.
   255â†’
   256â†’Â© ${new Date().getFullYear()} SPLICE. All rights reserved.
   257â†’    `
   258â†’  },
   259â†’
   260â†’  licenseLookup: {
   261â†’    subject: 'Your SPLICE License Key',
   262â†’    html: (data) => `
   263â†’<!DOCTYPE html>
   264â†’<html>
   265â†’<head>
   266â†’  <meta charset="utf-8">
   267â†’  <style>
   268â†’    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; line-height: 1.6; color: #333; }
   269â†’    .container { max-width: 600px; margin: 0 auto; padding: 40px 20px; }
   270â†’    .header { text-align: center; margin-bottom: 30px; }
   271â†’    .logo { font-size: 32px; font-weight: bold; color: #7c3aed; }
   272â†’    .license-box { background: #f8f5ff; border: 2px solid #7c3aed; border-radius: 8px; padding: 20px; text-align: center; margin: 30px 0; }
   273â†’    .license-key { font-family: monospace; font-size: 24px; font-weight: bold; color: #7c3aed; letter-spacing: 2px; }
   274â†’    .footer { text-align: center; margin-top: 40px; color: #6b7280; font-size: 14px; }
   275â†’  </style>
   276â†’</head>
   277â†’<body>
   278â†’  <div class="container">
   279â†’    <div class="header">
   280â†’      <div class="logo">SPLICE</div>
   281â†’    </div>
   282â†’
   283â†’    <h2>License Key Lookup</h2>
   284â†’    <p>You requested your SPLICE license key. Here it is:</p>
   285â†’
   286â†’    <div class="license-box">
   287â†’      <div class="license-key">${escapeHtml(data.licenseKey)}</div>
   288â†’    </div>
   289â†’
   290â†’    <p>If you didn't request this, you can safely ignore this email.</p>
   291â†’
   292â†’    <div class="footer">
   293â†’      <p>Need help? Reply to this email or visit <a href="https://splice.video/support">splice.video/support</a></p>
   294â†’      <p>&copy; ${new Date().getFullYear()} SPLICE. All rights reserved.</p>
   295â†’    </div>
   296â†’  </div>
   297â†’</body>
   298â†’</html>
   299â†’    `,
   300â†’    text: (data) => `
   301â†’SPLICE - License Key Lookup
   302â†’
   303â†’You requested your SPLICE license key. Here it is:
   304â†’
   305â†’${data.licenseKey}
   306â†’
   307â†’If you didn't request this, you can safely ignore this email.
   308â†’
   309â†’Need help? Visit https://splice.video/support
   310â†’
   311â†’Â© ${new Date().getFullYear()} SPLICE. All rights reserved.
   312â†’    `
   313â†’  },
   314â†’
   315â†’  // Sign-in code email (passwordless auth)
   316â†’  signinCode: {
   317â†’    subject: 'Your SPLICE Sign-In Code: {{code}}',
   318â†’    html: (data) => `
   319â†’<!DOCTYPE html>
   320â†’<html lang="en">
   321â†’<head>
   322â†’  <meta charset="UTF-8">
   323â†’  <meta name="viewport" content="width=device-width, initial-scale=1.0">
   324â†’  <meta http-equiv="X-UA-Compatible" content="IE=edge">
   325â†’  <title>Your SPLICE Sign-In Code</title>
   326â†’  <!--[if mso]>
   327â†’  <noscript>
   328â†’    <xml>
   329â†’      <o:OfficeDocumentSettings>
   330â†’        <o:PixelsPerInch>96</o:PixelsPerInch>
   331â†’      </o:OfficeDocumentSettings>
   332â†’    </xml>
   333â†’  </noscript>
   334â†’  <![endif]-->
   335â†’  <style>
   336â†’    body, table, td, p, a, li { -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; }
   337â†’    table, td { mso-table-lspace: 0pt; mso-table-rspace: 0pt; }
   338â†’    img { -ms-interpolation-mode: bicubic; border: 0; outline: none; text-decoration: none; }
   339â†’    body { margin: 0; padding: 0; width: 100%; background-color: #060b14; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }
   340â†’    @media only screen and (max-width: 600px) {
   341â†’      .container { width: 100% !important; padding: 16px !important; }
   342â†’      .code-box { font-size: 28px !important; letter-spacing: 6px !important; }
   343â†’    }
   344â†’  </style>
   345â†’</head>
   346â†’<body style="margin: 0; padding: 0; background-color: #060b14;">
   347â†’  <div style="display: none; max-height: 0; overflow: hidden; font-size: 1px; line-height: 1px; color: #060b14;">Your SPLICE sign-in code is inside. Start editing 10x faster today!</div>
   348â†’  <table role="presentation" cellpadding="0" cellspacing="0" width="100%" style="background-color: #060b14;">
   349â†’    <tr>
   350â†’      <td align="center" style="padding: 40px 20px;">
   351â†’        <table role="presentation" class="container" cellpadding="0" cellspacing="0" width="560" style="max-width: 560px;">
   352â†’          <tr>
   353â†’            <td align="center" style="padding-bottom: 32px;">
   354â†’              <table role="presentation" cellpadding="0" cellspacing="0">
   355â†’                <tr>
   356â†’                  <td style="vertical-align: middle; padding-right: 10px;">
   357â†’                    <img src="https://splice.video/images/logo.jpg" alt="SPLICE" width="40" height="40" style="display: block; border-radius: 8px;">
   358â†’                  </td>
   359â†’                  <td style="vertical-align: middle;">
   360â†’                    <span style="font-size: 26px; font-weight: 700; color: #ffffff; letter-spacing: -0.5px;">SPLICE</span>
   361â†’                  </td>
   362â†’                </tr>
   363â†’              </table>
   364â†’            </td>
   365â†’          </tr>
   366â†’          <tr>
   367â†’            <td>
   368â†’              <table role="presentation" cellpadding="0" cellspacing="0" width="100%" style="background: linear-gradient(180deg, #0f1629 0%, #0a0f1a 100%); border-radius: 16px; border: 1px solid rgba(0, 212, 255, 0.15); box-shadow: 0 0 40px rgba(0, 212, 255, 0.08);">
   369â†’                <tr>
   370â†’                  <td align="center" style="padding: 40px 40px 24px 40px;">
   371â†’                    <h1 style="margin: 0; font-size: 28px; font-weight: 600; color: #ffffff; line-height: 1.3;">Welcome to the future of editing âœ¨</h1>
   372â†’                  </td>
   373â†’                </tr>
   374â†’                <tr>
   375â†’                  <td align="center" style="padding: 0 40px 32px 40px;">
   376â†’                    <p style="margin: 0; font-size: 16px; color: #94a3b8; line-height: 1.6;">You're one step away from editing 10x faster. Use this code to sign in:</p>
   377â†’                  </td>
   378â†’                </tr>
   379â†’                <tr>
   380â†’                  <td align="center" style="padding: 0 40px 32px 40px;">
   381â†’                    <table role="presentation" cellpadding="0" cellspacing="0" style="background: linear-gradient(135deg, rgba(0, 212, 255, 0.1) 0%, rgba(0, 168, 204, 0.05) 100%); border-radius: 12px; border: 2px solid #00D4FF; box-shadow: 0 0 24px rgba(0, 212, 255, 0.25);">
   382â†’                      <tr>
   383â†’                        <td align="center" style="padding: 24px 48px;">
   384â†’                          <span class="code-box" style="font-family: 'SF Mono', Monaco, 'Courier New', monospace; font-size: 36px; font-weight: 700; color: #00D4FF; letter-spacing: 10px; text-shadow: 0 0 20px rgba(0, 212, 255, 0.5);">${escapeHtml(data.code)}</span>
   385â†’                        </td>
   386â†’                      </tr>
   387â†’                    </table>
   388â†’                  </td>
   389â†’                </tr>
   390â†’                <tr>
   391â†’                  <td align="center" style="padding: 0 40px 40px 40px;">
   392â†’                    <p style="margin: 0; font-size: 14px; color: #64748b;">â±ï¸ This code expires in <strong style="color: #ffffff;">10 minutes</strong></p>
   393â†’                  </td>
   394â†’                </tr>
   395â†’                <tr>
   396â†’                  <td style="padding: 0 40px;">
   397â†’                    <table role="presentation" cellpadding="0" cellspacing="0" width="100%">
   398â†’                      <tr><td style="border-top: 1px solid rgba(148, 163, 184, 0.1);"></td></tr>
   399â†’                    </table>
   400â†’                  </td>
   401â†’                </tr>
   402â†’                <tr>
   403â†’                  <td style="padding: 40px;">
   404â†’                    <h2 style="margin: 0 0 24px 0; font-size: 18px; font-weight: 600; color: #ffffff;">ğŸš€ What you'll unlock:</h2>
   405â†’                    <table role="presentation" cellpadding="0" cellspacing="0" width="100%">
   406â†’                      <tr>
   407â†’                        <td width="50%" style="padding: 8px 8px 8px 0; vertical-align: top;">
   408â†’                          <table role="presentation" cellpadding="0" cellspacing="0">
   409â†’                            <tr>
   410â†’                              <td style="padding-right: 12px; vertical-align: top;"><span style="font-size: 20px;">âš¡</span></td>
   411â†’                              <td style="vertical-align: top;">
   412â†’                                <p style="margin: 0; font-size: 14px; color: #e2e8f0; font-weight: 500;">AI Silence Removal</p>
   413â†’                                <p style="margin: 4px 0 0 0; font-size: 13px; color: #64748b;">Auto-trim dead air</p>
   414â†’                              </td>
   415â†’                            </tr>
   416â†’                          </table>
   417â†’                        </td>
   418â†’                        <td width="50%" style="padding: 8px 0 8px 8px; vertical-align: top;">
   419â†’                          <table role="presentation" cellpadding="0" cellspacing="0">
   420â†’                            <tr>
   421â†’                              <td style="padding-right: 12px; vertical-align: top;"><span style="font-size: 20px;">ğŸ¬</span></td>
   422â†’                              <td style="vertical-align: top;">
   423â†’                                <p style="margin: 0; font-size: 14px; color: #e2e8f0; font-weight: 500;">Smart Take Detection</p>
   424â†’                                <p style="margin: 4px 0 0 0; font-size: 13px; color: #64748b;">Find best takes fast</p>
   425â†’                              </td>
   426â†’                            </tr>
   427â†’                          </table>
   428â†’                        </td>
   429â†’                      </tr>
   430â†’                      <tr>
   431â†’                        <td width="50%" style="padding: 8px 8px 8px 0; vertical-align: top;">
   432â†’                          <table role="presentation" cellpadding="0" cellspacing="0">
   433â†’                            <tr>
   434â†’                              <td style="padding-right: 12px; vertical-align: top;"><span style="font-size: 20px;">ğŸµ</span></td>
   435â†’                              <td style="vertical-align: top;">
   436â†’                                <p style="margin: 0; font-size: 14px; color: #e2e8f0; font-weight: 500;">AI Music Generation</p>
   437â†’                                <p style="margin: 4px 0 0 0; font-size: 13px; color: #64748b;">Royalty-free tracks</p>
   438â†’                              </td>
   439â†’                            </tr>
   440â†’                          </table>
   441â†’                        </td>
   442â†’                        <td width="50%" style="padding: 8px 0 8px 8px; vertical-align: top;">
   443â†’                          <table role="presentation" cellpadding="0" cellspacing="0">
   444â†’                            <tr>
   445â†’                              <td style="padding-right: 12px; vertical-align: top;"><span style="font-size: 20px;">ğŸ“±</span></td>
   446â†’                              <td style="vertical-align: top;">
   447â†’                                <p style="margin: 0; font-size: 14px; color: #e2e8f0; font-weight: 500;">Social Reframe</p>
   448â†’                                <p style="margin: 4px 0 0 0; font-size: 13px; color: #64748b;">Export to any platform</p>
   449â†’                              </td>
   450â†’                            </tr>
   451â†’                          </table>
   452â†’                        </td>
   453â†’                      </tr>
   454â†’                    </table>
   455â†’                  </td>
   456â†’                </tr>
   457â†’                <tr>
   458â†’                  <td align="center" style="padding: 0 40px 40px 40px;">
   459â†’                    <table role="presentation" cellpadding="0" cellspacing="0">
   460â†’                      <tr>
   461â†’                        <td align="center" style="background: linear-gradient(135deg, #00D4FF 0%, #0099CC 100%); border-radius: 10px; box-shadow: 0 0 20px rgba(0, 212, 255, 0.4);">
   462â†’                          <a href="https://splice.video/download" target="_blank" style="display: inline-block; padding: 16px 40px; font-size: 16px; font-weight: 600; color: #060b14; text-decoration: none; letter-spacing: -0.3px;">Download SPLICE Now â†’</a>
   463â†’                        </td>
   464â†’                      </tr>
   465â†’                    </table>
   466â†’                  </td>
   467â†’                </tr>
   468â†’              </table>
   469â†’            </td>
   470â†’          </tr>
   471â†’          <tr>
   472â†’            <td align="center" style="padding: 40px 0 24px 0;">
   473â†’              <p style="margin: 0; font-size: 14px; color: #64748b;">Need help getting started?</p>
   474â†’            </td>
   475â†’          </tr>
   476â†’          <tr>
   477â†’            <td align="center" style="padding-bottom: 40px;">
   478â†’              <table role="presentation" cellpadding="0" cellspacing="0">
   479â†’                <tr>
   480â†’                  <td style="padding: 0 12px;"><a href="https://splice.video/docs/quickstart" style="font-size: 14px; color: #00D4FF; text-decoration: none;">Quick Start Guide</a></td>
   481â†’                  <td style="color: #334155;">|</td>
   482â†’                  <td style="padding: 0 12px;"><a href="https://discord.gg/splice" style="font-size: 14px; color: #00D4FF; text-decoration: none;">Join Discord</a></td>
   483â†’                  <td style="color: #334155;">|</td>
   484â†’                  <td style="padding: 0 12px;"><a href="mailto:support@splice.video" style="font-size: 14px; color: #00D4FF; text-decoration: none;">Contact Support</a></td>
   485â†’                </tr>
   486â†’              </table>
   487â†’            </td>
   488â†’          </tr>
   489â†’          <tr>
   490â†’            <td align="center" style="padding: 24px 0; border-top: 1px solid rgba(148, 163, 184, 0.1);">
   491â†’              <p style="margin: 0 0 8px 0; font-size: 13px; color: #475569;">You received this email because you signed up for SPLICE.</p>
   492â†’              <p style="margin: 0; font-size: 13px; color: #475569;">Â© ${new Date().getFullYear()} SPLICE. All rights reserved.</p>
   493â†’            </td>
   494â†’          </tr>
   495â†’        </table>
   496â†’      </td>
   497â†’    </tr>
   498â†’  </table>
   499â†’</body>
   500â†’</html>
   501â†’    `,
   502â†’    text: (data) => `
   503â†’Welcome to SPLICE!
   504â†’
   505â†’Your sign-in code is: ${data.code}
   506â†’
   507â†’This code expires in 10 minutes.
   508â†’
   509â†’What you'll unlock:
   510â†’- âš¡ AI Silence Removal - Auto-trim dead air
   511â†’- ğŸ¬ Smart Take Detection - Find best takes fast
   512â†’- ğŸµ AI Music Generation - Royalty-free tracks
   513â†’- ğŸ“± Social Reframe - Export to any platform
   514â†’
   515â†’Download SPLICE: https://splice.video/download
   516â†’
   517â†’Need help?
   518â†’- Quick Start Guide: https://splice.video/docs/quickstart
   519â†’- Join Discord: https://discord.gg/splice
   520â†’- Contact Support: support@splice.video
   521â†’
   522â†’Â© ${new Date().getFullYear()} SPLICE. All rights reserved.
   523â†’    `
   524â†’  },
   525â†’
   526â†’  // Email verification template
   527â†’  emailVerification: {
   528â†’    subject: 'Verify Your SPLICE Email: {{code}}',
   529â†’    html: (data) => `
   530â†’<!DOCTYPE html>
   531â†’<html lang="en">
   532â†’<head>
   533â†’  <meta charset="UTF-8">
   534â†’  <meta name="viewport" content="width=device-width, initial-scale=1.0">
   535â†’  <meta http-equiv="X-UA-Compatible" content="IE=edge">
   536â†’  <title>Verify Your SPLICE Email</title>
   537â†’  <!--[if mso]>
   538â†’  <noscript>
   539â†’    <xml>
   540â†’      <o:OfficeDocumentSettings>
   541â†’        <o:PixelsPerInch>96</o:PixelsPerInch>
   542â†’      </o:OfficeDocumentSettings>
   543â†’    </xml>
   544â†’  </noscript>
   545â†’  <![endif]-->
   546â†’  <style>
   547â†’    body, table, td, p, a, li { -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; }
   548â†’    table, td { mso-table-lspace: 0pt; mso-table-rspace: 0pt; }
   549â†’    img { -ms-interpolation-mode: bicubic; border: 0; outline: none; text-decoration: none; }
   550â†’    body { margin: 0; padding: 0; width: 100%; background-color: #060b14; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif; }
   551â†’    @media only screen and (max-width: 600px) {
   552â†’      .container { width: 100% !important; padding: 16px !important; }
   553â†’      .code-box { font-size: 28px !important; letter-spacing: 6px !important; }
   554â†’    }
   555â†’  </style>
   556â†’</head>
   557â†’<body style="margin: 0; padding: 0; background-color: #060b14;">
   558â†’  <div style="display: none; max-height: 0; overflow: hidden; font-size: 1px; line-height: 1px; color: #060b14;">Verify your email to complete your SPLICE account setup.</div>
   559â†’  <table role="presentation" cellpadding="0" cellspacing="0" width="100%" style="background-color: #060b14;">
   560â†’    <tr>
   561â†’      <td align="center" style="padding: 40px 20px;">
   562â†’        <table role="presentation" class="container" cellpadding="0" cellspacing="0" width="560" style="max-width: 560px;">
   563â†’          <tr>
   564â†’            <td align="center" style="padding-bottom: 32px;">
   565â†’              <table role="presentation" cellpadding="0" cellspacing="0">
   566â†’                <tr>
   567â†’                  <td style="vertical-align: middle; padding-right: 10px;">
   568â†’                    <img src="https://splice.video/images/logo.jpg" alt="SPLICE" width="40" height="40" style="display: block; border-radius: 8px;">
   569â†’                  </td>
   570â†’                  <td style="vertical-align: middle;">
   571â†’                    <span style="font-size: 26px; font-weight: 700; color: #ffffff; letter-spacing: -0.5px;">SPLICE</span>
   572â†’                  </td>
   573â†’                </tr>
   574â†’              </table>
   575â†’            </td>
   576â†’          </tr>
   577â†’          <tr>
   578â†’            <td>
   579â†’              <table role="presentation" cellpadding="0" cellspacing="0" width="100%" style="background: linear-gradient(180deg, #0f1629 0%, #0a0f1a 100%); border-radius: 16px; border: 1px solid rgba(0, 212, 255, 0.15); box-shadow: 0 0 40px rgba(0, 212, 255, 0.08);">
   580â†’                <tr>
   581â†’                  <td align="center" style="padding: 40px 40px 24px 40px;">
   582â†’                    <h1 style="margin: 0; font-size: 28px; font-weight: 600; color: #ffffff; line-height: 1.3;">Verify Your Email</h1>
   583â†’                  </td>
   584â†’                </tr>
   585â†’                <tr>
   586â†’                  <td align="center" style="padding: 0 40px 32px 40px;">
   587â†’                    <p style="margin: 0; font-size: 16px; color: #94a3b8; line-height: 1.6;">Enter this verification code to confirm your email address:</p>
   588â†’                  </td>
   589â†’                </tr>
   590â†’                <tr>
   591â†’                  <td align="center" style="padding: 0 40px 32px 40px;">
   592â†’                    <table role="presentation" cellpadding="0" cellspacing="0" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1) 0%, rgba(22, 163, 74, 0.05) 100%); border-radius: 12px; border: 2px solid #22c55e; box-shadow: 0 0 24px rgba(34, 197, 94, 0.25);">
   593â†’                      <tr>
   594â†’                        <td align="center" style="padding: 24px 48px;">
   595â†’                          <span class="code-box" style="font-family: 'SF Mono', Monaco, 'Courier New', monospace; font-size: 36px; font-weight: 700; color: #22c55e; letter-spacing: 10px; text-shadow: 0 0 20px rgba(34, 197, 94, 0.5);">${escapeHtml(data.code)}</span>
   596â†’                        </td>
   597â†’                      </tr>
   598â†’                    </table>
   599â†’                  </td>
   600â†’                </tr>
   601â†’                <tr>
   602â†’                  <td align="center" style="padding: 0 40px 40px 40px;">
   603â†’                    <p style="margin: 0; font-size: 14px; color: #64748b;">This code expires in <strong style="color: #ffffff;">${escapeHtml(String(data.expiresInMinutes || 10))} minutes</strong></p>
   604â†’                  </td>
   605â†’                </tr>
   606â†’                <tr>
   607â†’                  <td style="padding: 0 40px;">
   608â†’                    <table role="presentation" cellpadding="0" cellspacing="0" width="100%">
   609â†’                      <tr><td style="border-top: 1px solid rgba(148, 163, 184, 0.1);"></td></tr>
   610â†’                    </table>
   611â†’                  </td>
   612â†’                </tr>
   613â†’                <tr>
   614â†’                  <td align="center" style="padding: 32px 40px;">
   615â†’                    <p style="margin: 0; font-size: 14px; color: #64748b; line-height: 1.6;">If you didn't request this verification, you can safely ignore this email.</p>
   616â†’                  </td>
   617â†’                </tr>
   618â†’              </table>
   619â†’            </td>
   620â†’          </tr>
   621â†’          <tr>
   622â†’            <td align="center" style="padding: 24px 0; border-top: 1px solid rgba(148, 163, 184, 0.1);">
   623â†’              <p style="margin: 0 0 8px 0; font-size: 13px; color: #475569;">You received this email because someone used this address to sign up for SPLICE.</p>
   624â†’              <p style="margin: 0; font-size: 13px; color: #475569;">&copy; ${new Date().getFullYear()} SPLICE. All rights reserved.</p>
   625â†’            </td>
   626â†’          </tr>
   627â†’        </table>
   628â†’      </td>
   629â†’    </tr>
   630â†’  </table>
   631â†’</body>
   632â†’</html>
   633â†’    `,
   634â†’    text: (data) => `
   635â†’Verify Your SPLICE Email
   636â†’
   637â†’Your verification code is: ${data.code}
   638â†’
   639â†’This code expires in ${data.expiresInMinutes || 10} minutes.
   640â†’
   641â†’If you didn't request this verification, you can safely ignore this email.
   642â†’
   643â†’Â© ${new Date().getFullYear()} SPLICE. All rights reserved.
   644â†’    `
   645â†’  }
   646â†’};
   647â†’
   648â†’// ============================================================================
   649â†’// HELPER FUNCTIONS
   650â†’// ============================================================================
   651â†’
   652â†’/**
   653â†’ * Escape HTML to prevent XSS in email content
   654â†’ */
   655â†’function escapeHtml(str) {
   656â†’  if (str === null || str === undefined) return '';
   657â†’  if (typeof str !== 'string') str = String(str);
   658â†’
   659â†’  const escapeMap = {
   660â†’    '&': '&amp;',
   661â†’    '<': '&lt;',
   662â†’    '>': '&gt;',
   663â†’    '"': '&quot;',
   664â†’    "'": '&#x27;'
   665â†’  };
   666â†’
   667â†’  return str.replace(/[&<>"']/g, char => escapeMap[char]);
   668â†’}
   669â†’
   670â†’/**
   671â†’ * Get tier details for email
   672â†’ */
   673â†’function getTierDetails(tier) {
   674â†’  const tiers = {
   675â†’    starter: { hours: 4, musicCredits: 2 },
   676â†’    pro: { hours: 15, musicCredits: 10 },
   677â†’    team: { hours: 50, musicCredits: 50 }
   678â†’  };
   679â†’  return tiers[tier] || tiers.starter;
   680â†’}
   681â†’
   682â†’// ============================================================================
   683â†’// EMAIL PROVIDERS
   684â†’// ============================================================================
   685â†’
   686â†’/**
   687â†’ * Send email via SendGrid
   688â†’ */
   689â†’async function sendViaSendGrid(to, subject, html, text) {
   690â†’  if (!EMAIL_CONFIG.sendgrid.apiKey) {
   691â†’    throw new Error('SENDGRID_API_KEY not configured');
   692â†’  }
   693â†’
   694â†’  const response = await fetch('https://api.sendgrid.com/v3/mail/send', {
   695â†’    method: 'POST',
   696â†’    headers: {
   697â†’      'Authorization': `Bearer ${EMAIL_CONFIG.sendgrid.apiKey}`,
   698â†’      'Content-Type': 'application/json'
   699â†’    },
   700â†’    body: JSON.stringify({
   701â†’      personalizations: [{ to: [{ email: to }] }],
   702â†’      from: { email: EMAIL_CONFIG.from.match(/<(.+)>/)?.[1] || EMAIL_CONFIG.from, name: 'SPLICE' },
   703â†’      reply_to: { email: EMAIL_CONFIG.replyTo },
   704â†’      subject,
   705â†’      content: [
   706â†’        { type: 'text/plain', value: text },
   707â†’        { type: 'text/html', value: html }
   708â†’      ]
   709â†’    })
   710â†’  });
   711â†’
   712â†’  if (!response.ok) {
   713â†’    const error = await response.text();
   714â†’    throw new Error(`SendGrid error: ${response.status} - ${error}`);
   715â†’  }
   716â†’
   717â†’  return { provider: 'sendgrid', messageId: response.headers.get('x-message-id') };
   718â†’}
   719â†’
   720â†’/**
   721â†’ * Send email via SendGrid Dynamic Template
   722â†’ * @param {string} to - Recipient email
   723â†’ * @param {string} templateId - SendGrid dynamic template ID
   724â†’ * @param {Object} dynamicData - Template variables
   725â†’ */
   726â†’async function sendViaSendGridTemplate(to, templateId, dynamicData = {}) {
   727â†’  if (!EMAIL_CONFIG.sendgrid.apiKey) {
   728â†’    throw new Error('SENDGRID_API_KEY not configured');
   729â†’  }
   730â†’
   731â†’  const response = await fetch('https://api.sendgrid.com/v3/mail/send', {
   732â†’    method: 'POST',
   733â†’    headers: {
   734â†’      'Authorization': `Bearer ${EMAIL_CONFIG.sendgrid.apiKey}`,
   735â†’      'Content-Type': 'application/json'
   736â†’    },
   737â†’    body: JSON.stringify({
   738â†’      personalizations: [{
   739â†’        to: [{ email: to }],
   740â†’        dynamic_template_data: dynamicData
   741â†’      }],
   742â†’      from: { email: EMAIL_CONFIG.from.match(/<(.+)>/)?.[1] || EMAIL_CONFIG.from, name: 'SPLICE' },
   743â†’      reply_to: { email: EMAIL_CONFIG.replyTo },
   744â†’      template_id: templateId
   745â†’    })
   746â†’  });
   747â†’
   748â†’  if (!response.ok) {
   749â†’    const error = await response.text();
   750â†’    throw new Error(`SendGrid error: ${response.status} - ${error}`);
   751â†’  }
   752â†’
   753â†’  return { provider: 'sendgrid-template', messageId: response.headers.get('x-message-id'), templateId };
   754â†’}
   755â†’
   756â†’/**
   757â†’ * Send email via AWS SES
   758â†’ */
   759â†’async function sendViaSES(to, subject, html, text) {
   760â†’  // Dynamically import AWS SDK to avoid loading if not needed
   761â†’  try {
   762â†’    const { SESClient, SendEmailCommand } = await import('@aws-sdk/client-ses');
   763â†’
   764â†’    const client = new SESClient({ region: EMAIL_CONFIG.ses.region });
   765â†’
   766â†’    const command = new SendEmailCommand({
   767â†’      Source: EMAIL_CONFIG.from,
   768â†’      Destination: { ToAddresses: [to] },
   769â†’      ReplyToAddresses: [EMAIL_CONFIG.replyTo],
   770â†’      Message: {
   771â†’        Subject: { Data: subject, Charset: 'UTF-8' },
   772â†’        Body: {
   773â†’          Html: { Data: html, Charset: 'UTF-8' },
   774â†’          Text: { Data: text, Charset: 'UTF-8' }
   775â†’        }
   776â†’      }
   777â†’    });
   778â†’
   779â†’    const result = await client.send(command);
   780â†’    return { provider: 'ses', messageId: result.MessageId };
   781â†’  } catch (err) {
   782â†’    if (err.code === 'ERR_MODULE_NOT_FOUND') {
   783â†’      throw new Error('AWS SDK not installed. Run: npm install @aws-sdk/client-ses');
   784â†’    }
   785â†’    throw err;
   786â†’  }
   787â†’}
   788â†’
   789â†’/**
   790â†’ * Log email to console (development mode)
   791â†’ */
   792â†’function sendViaConsole(to, subject, html, text) {
   793â†’  console.log('\n========== EMAIL (CONSOLE MODE) ==========');
   794â†’  console.log(`To: ${to}`);
   795â†’  console.log(`Subject: ${subject}`);
   796â†’  console.log(`From: ${EMAIL_CONFIG.from}`);
   797â†’  console.log('--- TEXT VERSION ---');
   798â†’  console.log(text);
   799â†’  console.log('==========================================\n');
   800â†’
   801â†’  return { provider: 'console', messageId: `console-${Date.now()}` };
   802â†’}
   803â†’
   804â†’// ============================================================================
   805â†’// PUBLIC API
   806â†’// ============================================================================
   807â†’
   808â†’/**
   809â†’ * Send an email using the configured provider
   810â†’ * @param {string} to - Recipient email
   811â†’ * @param {string} subject - Email subject
   812â†’ * @param {string} html - HTML content
   813â†’ * @param {string} text - Plain text content
   814â†’ * @returns {Promise<{provider: string, messageId: string}>}
   815â†’ */
   816â†’async function sendEmail(to, subject, html, text) {
   817â†’  const provider = EMAIL_CONFIG.provider.toLowerCase();
   818â†’
   819â†’  console.log(`[SPLICE Email] Sending to ${to} via ${provider}`);
   820â†’
   821â†’  try {
   822â†’    let result;
   823â†’
   824â†’    switch (provider) {
   825â†’      case 'sendgrid':
   826â†’        result = await sendViaSendGrid(to, subject, html, text);
   827â†’        break;
   828â†’      case 'ses':
   829â†’        result = await sendViaSES(to, subject, html, text);
   830â†’        break;
   831â†’      case 'console':
   832â†’      default:
   833â†’        result = sendViaConsole(to, subject, html, text);
   834â†’        break;
   835â†’    }
   836â†’
   837â†’    console.log(`[SPLICE Email] Sent successfully via ${result.provider}: ${result.messageId}`);
   838â†’    return result;
   839â†’  } catch (err) {
   840â†’    console.error(`[SPLICE Email] Failed to send via ${provider}:`, err.message);
   841â†’    throw err;
   842â†’  }
   843â†’}
   844â†’
   845â†’/**
   846â†’ * Send license key email to customer
   847â†’ * @param {string} email - Customer email
   848â†’ * @param {string} licenseKey - The license key
   849â†’ * @param {string} tier - Subscription tier (starter/pro/team)
   850â†’ */
   851â†’async function sendLicenseKeyEmail(email, licenseKey, tier) {
   852â†’  const tierDetails = getTierDetails(tier);
   853â†’  const template = TEMPLATES.licenseKey;
   854â†’
   855â†’  const data = {
   856â†’    licenseKey,
   857â†’    tier,
   858â†’    hours: tierDetails.hours,
   859â†’    musicCredits: tierDetails.musicCredits
   860â†’  };
   861â†’
   862â†’  return sendEmail(
   863â†’    email,
   864â†’    template.subject,
   865â†’    template.html(data),
   866â†’    template.text(data)
   867â†’  );
   868â†’}
   869â†’
   870â†’/**
   871â†’ * Send payment warning email to customer
   872â†’ * @param {string} email - Customer email
   873â†’ * @param {number} attemptCount - Which payment attempt failed (1-3)
   874â†’ */
   875â†’async function sendPaymentWarningEmail(email, attemptCount) {
   876â†’  const template = TEMPLATES.paymentWarning;
   877â†’  const data = { attemptCount };
   878â†’
   879â†’  return sendEmail(
   880â†’    email,
   881â†’    template.subject,
   882â†’    template.html(data),
   883â†’    template.text(data)
   884â†’  );
   885â†’}
   886â†’
   887â†’/**
   888â†’ * Send license key lookup email
   889â†’ * @param {string} email - Customer email
   890â†’ * @param {string} licenseKey - The license key
   891â†’ */
   892â†’async function sendLicenseLookupEmail(email, licenseKey) {
   893â†’  const template = TEMPLATES.licenseLookup;
   894â†’  const data = { licenseKey };
   895â†’
   896â†’  return sendEmail(
   897â†’    email,
   898â†’    template.subject,
   899â†’    template.html(data),
   900â†’    template.text(data)
   901â†’  );
   902â†’}
   903â†’
   904â†’/**
   905â†’ * Send sign-in code email (passwordless authentication)
   906â†’ * @param {string} email - User email
   907â†’ * @param {string} code - The sign-in code (e.g., 6-digit code)
   908â†’ * @param {number} expiresInMinutes - How long until the code expires (default: 10)
   909â†’ */
   910â†’async function sendSignInCodeEmail(email, code, expiresInMinutes = 10) {
   911â†’  const provider = EMAIL_CONFIG.provider.toLowerCase();
   912â†’
   913â†’  // Use SendGrid Dynamic Template when available
   914â†’  if (provider === 'sendgrid' && TEMPLATE_IDS.signinCode && EMAIL_CONFIG.sendgrid.apiKey) {
   915â†’    console.log(`[SPLICE Email] Sending sign-in code to ${email} via SendGrid Dynamic Template`);
   916â†’    return sendViaSendGridTemplate(email, TEMPLATE_IDS.signinCode, {
   917â†’      code: code,
   918â†’      expiresInMinutes: expiresInMinutes
   919â†’    });
   920â†’  }
   921â†’
   922â†’  // Fallback to inline template
   923â†’  const template = TEMPLATES.signinCode;
   924â†’  const data = { code, expiresInMinutes };
   925â†’  const subject = template.subject.replace('{{code}}', code);
   926â†’
   927â†’  return sendEmail(
   928â†’    email,
   929â†’    subject,
   930â†’    template.html(data),
   931â†’    template.text(data)
   932â†’  );
   933â†’}
   934â†’
   935â†’/**
   936â†’ * Send email verification code
   937â†’ * @param {string} email - User email
   938â†’ * @param {string} code - The 6-digit verification code
   939â†’ * @param {number} expiresInMinutes - How long until the code expires (default: 10)
   940â†’ */
   941â†’async function sendEmailVerificationCode(email, code, expiresInMinutes = 10) {
   942â†’  const provider = EMAIL_CONFIG.provider.toLowerCase();
   943â†’
   944â†’  // Use SendGrid Dynamic Template when available
   945â†’  if (provider === 'sendgrid' && TEMPLATE_IDS.emailVerification && EMAIL_CONFIG.sendgrid.apiKey) {
   946â†’    console.log(`[SPLICE Email] Sending verification code to ${email} via SendGrid Dynamic Template`);
   947â†’    return sendViaSendGridTemplate(email, TEMPLATE_IDS.emailVerification, {
   948â†’      code: code,
   949â†’      expiresInMinutes: expiresInMinutes
   950â†’    });
   951â†’  }
   952â†’
   953â†’  // Fallback to inline template
   954â†’  const template = TEMPLATES.emailVerification;
   955â†’  const data = { code, expiresInMinutes };
   956â†’  const subject = template.subject.replace('{{code}}', code);
   957â†’
   958â†’  return sendEmail(
   959â†’    email,
   960â†’    subject,
   961â†’    template.html(data),
   962â†’    template.text(data)
   963â†’  );
   964â†’}
   965â†’
   966â†’/**
   967â†’ * Check if email service is configured for production use
   968â†’ */
   969â†’function isEmailConfigured() {
   970â†’  const provider = EMAIL_CONFIG.provider.toLowerCase();
   971â†’
   972â†’  if (provider === 'sendgrid') {
   973â†’    return !!EMAIL_CONFIG.sendgrid.apiKey;
   974â†’  }
   975â†’
   976â†’  if (provider === 'ses') {
   977â†’    return !!(process.env.AWS_ACCESS_KEY_ID && process.env.AWS_SECRET_ACCESS_KEY);
   978â†’  }
   979â†’
   980â†’  // Console mode is always "configured" (for dev)
   981â†’  return true;
   982â†’}
   983â†’
   984â†’// ============================================================================
   985â†’// EXPORTS
   986â†’// ============================================================================
   987â†’
   988â†’module.exports = {
   989â†’  sendEmail,
   990â†’  sendLicenseKeyEmail,
   991â†’  sendPaymentWarningEmail,
   992â†’  sendLicenseLookupEmail,
   993â†’  sendSignInCodeEmail,
   994â†’  sendEmailVerificationCode,
   995â†’  isEmailConfigured,
   996â†’  EMAIL_CONFIG
   997â†’};
   998â†’

</system-reminder>
