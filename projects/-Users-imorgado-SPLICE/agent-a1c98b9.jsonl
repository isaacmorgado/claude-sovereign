{"parentUuid":null,"isSidechain":true,"userType":"external","cwd":"/Users/imorgado/SPLICE","sessionId":"5f015cfc-0476-4608-91d9-cf0946100ba2","version":"2.0.76","gitBranch":"main","agentId":"a1c98b9","slug":"fizzy-hatching-flame","type":"user","message":{"role":"user","content":"Look for JavaScript errors that could prevent the CEP panel from initializing properly.\n\nRead splice-cep/panel/js/main.js and check:\n1. The DOMContentLoaded handler - any syntax errors?\n2. All function calls in init sequence - any undefined functions?\n3. Any missing imports or dependencies?\n4. Check for circular dependencies or load order issues\n\nAlso check:\n- splice-cep/panel/js/config.js - the jsx object and evalScript wrapper\n- splice-cep/panel/index.html - script load order\n\nReport any errors that would prevent buttons from working."},"uuid":"ab689ecf-a0d2-48df-802c-d92c0878e940","timestamp":"2026-01-12T09:17:43.441Z"}
{"parentUuid":"ab689ecf-a0d2-48df-802c-d92c0878e940","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/SPLICE","sessionId":"5f015cfc-0476-4608-91d9-cf0946100ba2","version":"2.0.76","gitBranch":"main","agentId":"a1c98b9","slug":"fizzy-hatching-flame","message":{"model":"claude-opus-4-5-20251101","id":"msg_01PpmFfqwddMDEqJKESopnsT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01EqTUF9bZH8kkvfg8qB3WYK","name":"Read","input":{"file_path":"/Users/imorgado/SPLICE/splice-cep/panel/js/main.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":28739,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":28739,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CX3EUyGjTBJEHjC5whsyF","type":"assistant","uuid":"d2b670c8-f914-41ed-8cc5-2259ed510d0b","timestamp":"2026-01-12T09:17:47.635Z"}
{"parentUuid":"d2b670c8-f914-41ed-8cc5-2259ed510d0b","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/SPLICE","sessionId":"5f015cfc-0476-4608-91d9-cf0946100ba2","version":"2.0.76","gitBranch":"main","agentId":"a1c98b9","slug":"fizzy-hatching-flame","message":{"model":"claude-opus-4-5-20251101","id":"msg_01PpmFfqwddMDEqJKESopnsT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015F8iCgsqrVySUFH5mZfndB","name":"Read","input":{"file_path":"/Users/imorgado/SPLICE/splice-cep/panel/js/config.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":28739,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":28739,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CX3EUyGjTBJEHjC5whsyF","type":"assistant","uuid":"2d5e8074-5a3d-486b-b13a-e9acc4e6edfb","timestamp":"2026-01-12T09:17:48.003Z"}
{"parentUuid":"2d5e8074-5a3d-486b-b13a-e9acc4e6edfb","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/SPLICE","sessionId":"5f015cfc-0476-4608-91d9-cf0946100ba2","version":"2.0.76","gitBranch":"main","agentId":"a1c98b9","slug":"fizzy-hatching-flame","message":{"model":"claude-opus-4-5-20251101","id":"msg_01PpmFfqwddMDEqJKESopnsT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CpqzcgDi5BctoFZXuew5ib","name":"Read","input":{"file_path":"/Users/imorgado/SPLICE/splice-cep/panel/index.html"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":28739,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":28739,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CX3EUyGjTBJEHjC5whsyF","type":"assistant","uuid":"53f8341c-802a-432a-bd0c-87119806a225","timestamp":"2026-01-12T09:17:48.330Z"}
{"parentUuid":"53f8341c-802a-432a-bd0c-87119806a225","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/SPLICE","sessionId":"5f015cfc-0476-4608-91d9-cf0946100ba2","version":"2.0.76","gitBranch":"main","agentId":"a1c98b9","slug":"fizzy-hatching-flame","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015F8iCgsqrVySUFH5mZfndB","type":"tool_result","content":"     1→/**\n     2→ * SPLICE CEP Panel Configuration\n     3→ * Backend URLs, paths, and utility functions\n     4→ */\n     5→\n     6→// ============================================================================\n     7→// DEBUG MODE CONFIGURATION\n     8→// ============================================================================\n     9→\n    10→/**\n    11→ * Debug mode flag - enables verbose diagnostic logging\n    12→ * Can be enabled via localStorage for troubleshooting:\n    13→ *   localStorage.setItem('spliceDebugMode', 'true');\n    14→ *\n    15→ * Default: false (production mode - minimal logging)\n    16→ */\n    17→const SPLICE_DEBUG = localStorage.getItem('spliceDebugMode') === 'true';\n    18→\n    19→/**\n    20→ * Debug logging function - only outputs when debug mode is enabled\n    21→ * Use this for diagnostic/development logging that should be silent in production\n    22→ * @param {...any} args - Arguments to log (prefixed with [SPLICE DEBUG])\n    23→ */\n    24→function debugLog(...args) {\n    25→    if (SPLICE_DEBUG) {\n    26→        console.log('[SPLICE DEBUG]', ...args);\n    27→    }\n    28→}\n    29→\n    30→/**\n    31→ * Debug fetch logging - verbose fetch request/response logging\n    32→ * @param {...any} args - Arguments to log (prefixed with [SPLICE FETCH])\n    33→ */\n    34→function debugFetch(...args) {\n    35→    if (SPLICE_DEBUG) {\n    36→        console.log('[SPLICE FETCH]', ...args);\n    37→    }\n    38→}\n    39→\n    40→// ============================================================================\n    41→// BACKEND CONFIGURATION\n    42→// ============================================================================\n    43→const SPLICE_CONFIG = {\n    44→    VERSION: '6.0.3',\n    45→    BACKEND_PROD: 'https://splice-api-production.up.railway.app',\n    46→    BACKEND_DEV: 'https://127.0.0.1:3847',\n    47→    FETCH_TIMEOUT: 120000, // 2 minutes\n    48→    RETRY_ATTEMPTS: 3,\n    49→    RETRY_DELAY: 1000\n    50→};\n    51→\n    52→/**\n    53→ * Get the backend URL based on environment\n    54→ * FIXED: CEP panels always run from file://, so we default to PROD\n    55→ * Use localStorage to override for local development if needed\n    56→ */\n    57→function getBackendUrl() {\n    58→    // Priority 1: Allow override via localStorage (for local dev testing)\n    59→    const customUrl = localStorage.getItem('spliceBackendUrl');\n    60→    if (customUrl) {\n    61→        debugLog('Using custom backend URL from localStorage:', customUrl);\n    62→        return customUrl;\n    63→    }\n    64→\n    65→    // Priority 2: Default to production backend\n    66→    // (CEP panels always run from file://, so can't reliably detect dev mode)\n    67→    debugLog('Using production backend URL:', SPLICE_CONFIG.BACKEND_PROD);\n    68→    return SPLICE_CONFIG.BACKEND_PROD;\n    69→}\n    70→\n    71→// ============================================================================\n    72→// JSX BRIDGE - Communicate with Premiere Pro\n    73→// ============================================================================\n    74→const jsx = {\n    75→    cs: null,\n    76→    _initPromise: null,\n    77→    _initialized: false,\n    78→\n    79→    /**\n    80→     * Initialize the CSInterface\n    81→     * Returns a promise that resolves when ready (true/false)\n    82→     * Does NOT reject - gracefully handles missing CEP environment\n    83→     */\n    84→    init: function() {\n    85→        if (this._initPromise) return this._initPromise;\n    86→\n    87→        this._initPromise = new Promise((resolve) => {\n    88→            try {\n    89→                if (typeof CSInterface !== 'undefined') {\n    90→                    this.cs = new CSInterface();\n    91→                    // Verify we're in a real CEP environment by checking for __adobe_cep__\n    92→                    if (window.__adobe_cep__) {\n    93→                        this._initialized = true;\n    94→                        debugLog('[JSX] CSInterface initialized successfully (CEP environment detected)');\n    95→                    } else {\n    96→                        // CSInterface exists but no CEP runtime - browser/dev mode\n    97→                        this._initialized = true;\n    98→                        debugLog('[JSX] CSInterface initialized (development/browser mode)');\n    99→                    }\n   100→                } else {\n   101→                    console.warn('[JSX] CSInterface not available - panel may not function correctly');\n   102→                    this._initialized = false;\n   103→                }\n   104→            } catch (err) {\n   105→                console.error('[JSX] Failed to initialize CSInterface:', err);\n   106→                this._initialized = false;\n   107→            }\n   108→            resolve(this._initialized);\n   109→        });\n   110→\n   111→        return this._initPromise;\n   112→    },\n   113→\n   114→    /**\n   115→     * Ensure JSX is initialized before making calls\n   116→     */\n   117→    ensureInitialized: async function() {\n   118→        if (!this._initialized) {\n   119→            await this.init();\n   120→        }\n   121→        if (!this.cs) {\n   122→            throw new Error('CSInterface not initialized. Make sure you are running in CEP environment.');\n   123→        }\n   124→    },\n   125→\n   126→    /**\n   127→     * Execute ExtendScript in Premiere Pro\n   128→     * @param {string} script - ExtendScript to execute\n   129→     * @returns {Promise<any>} - Parsed result\n   130→     */\n   131→    evalScript: async function(script) {\n   132→        await this.ensureInitialized();\n   133→\n   134→        return new Promise((resolve, reject) => {\n   135→            this.cs.evalScript(script, (result) => {\n   136→                if (result === 'undefined' || result === undefined) {\n   137→                    resolve(null);\n   138→                    return;\n   139→                }\n   140→\n   141→                // Check for EvalScript error or ExtendScript runtime errors\n   142→                if (typeof result === 'string' && (\n   143→                    result.indexOf('EvalScript error') !== -1 ||\n   144→                    result.indexOf('Error:') !== -1 ||\n   145→                    result.indexOf('TypeError:') !== -1 ||\n   146→                    result.indexOf('ReferenceError:') !== -1\n   147→                )) {\n   148→                    reject(new Error(result));\n   149→                    return;\n   150→                }\n   151→\n   152→                // Try to parse JSON\n   153→                try {\n   154→                    const parsed = JSON.parse(result);\n   155→                    if (parsed.error) {\n   156→                        reject(new Error(parsed.error));\n   157→                    } else {\n   158→                        resolve(parsed);\n   159→                    }\n   160→                } catch (e) {\n   161→                    // Return as-is if not JSON\n   162→                    resolve(result);\n   163→                }\n   164→            });\n   165→        });\n   166→    },\n   167→\n   168→    /**\n   169→     * Call a JSX function with arguments\n   170→     * @param {string} funcName - Function name\n   171→     * @param {...any} args - Arguments to pass\n   172→     * @returns {Promise<any>}\n   173→     */\n   174→    call: async function(funcName, ...args) {\n   175→        await this.ensureInitialized();\n   176→\n   177→        const escapedArgs = args.map(arg => {\n   178→            if (arg === null || arg === undefined) return 'null';\n   179→            if (typeof arg === 'string') {\n   180→                // Escape backslashes first, then other special chars\n   181→                return `'${arg\n   182→                    .replace(/\\\\/g, '\\\\\\\\')\n   183→                    .replace(/'/g, \"\\\\'\")\n   184→                    .replace(/\\r/g, '\\\\r')\n   185→                    .replace(/\\n/g, '\\\\n')\n   186→                    .replace(/\\t/g, '\\\\t')}'`;\n   187→            }\n   188→            if (typeof arg === 'object') {\n   189→                return `'${JSON.stringify(arg)\n   190→                    .replace(/\\\\/g, '\\\\\\\\')\n   191→                    .replace(/'/g, \"\\\\'\")}'`;\n   192→            }\n   193→            return String(arg);\n   194→        });\n   195→\n   196→        const script = `${funcName}(${escapedArgs.join(', ')})`;\n   197→        return this.evalScript(script);\n   198→    }\n   199→};\n   200→\n   201→// ============================================================================\n   202→// FETCH UTILITIES\n   203→// ============================================================================\n   204→\n   205→/**\n   206→ * Fetch with timeout support\n   207→ * @param {string} url - URL to fetch\n   208→ * @param {object} options - Fetch options\n   209→ * @param {number} timeout - Timeout in ms\n   210→ */\n   211→async function fetchWithTimeout(url, options = {}, timeout = SPLICE_CONFIG.FETCH_TIMEOUT) {\n   212→    // DIAGNOSTIC: Log fetch request details (debug mode only)\n   213→    debugFetch('=== FETCH REQUEST START ===');\n   214→    debugFetch('URL:', url);\n   215→    debugFetch('Method:', options?.method || 'GET');\n   216→    debugFetch('Headers:', options?.headers);\n   217→    debugFetch('Timeout:', timeout);\n   218→    debugFetch('Is CEP environment:', typeof CSInterface !== 'undefined');\n   219→    debugFetch('=================================');\n   220→\n   221→    const controller = new AbortController();\n   222→    const timeoutId = setTimeout(() => controller.abort(), timeout);\n   223→\n   224→    try {\n   225→        const response = await fetch(url, {\n   226→            ...options,\n   227→            signal: controller.signal\n   228→        });\n   229→        clearTimeout(timeoutId);\n   230→\n   231→        // DIAGNOSTIC: Log successful response (debug mode only)\n   232→        debugFetch('=== FETCH RESPONSE SUCCESS ===');\n   233→        debugFetch('Status:', response.status);\n   234→        debugFetch('OK:', response.ok);\n   235→        debugFetch('=================================');\n   236→\n   237→        return response;\n   238→    } catch (error) {\n   239→        clearTimeout(timeoutId);\n   240→\n   241→        // DIAGNOSTIC: Log raw fetch error (debug mode only)\n   242→        debugFetch('=== FETCH ERROR CAUGHT ===');\n   243→        debugFetch('Error name:', error?.name);\n   244→        debugFetch('Error message:', error?.message);\n   245→        debugFetch('Error type:', typeof error);\n   246→        debugFetch('Error constructor:', error?.constructor?.name);\n   247→        debugFetch('Is AbortError:', error.name === 'AbortError');\n   248→        debugFetch('Is TypeError:', error.name === 'TypeError');\n   249→        debugFetch('Full error object:', JSON.stringify(error, Object.getOwnPropertyNames(error)));\n   250→        debugFetch('=================================');\n   251→\n   252→        if (error.name === 'AbortError') {\n   253→            throw new Error(`Request timeout after ${timeout}ms`);\n   254→        }\n   255→        throw error;\n   256→    }\n   257→}\n   258→\n   259→/**\n   260→ * Parse error response from backend\n   261→ * @param {Response} response - Fetch response\n   262→ */\n   263→async function parseErrorResponse(response) {\n   264→    try {\n   265→        const data = await response.json();\n   266→        return data.error || data.message || `HTTP ${response.status}`;\n   267→    } catch {\n   268→        return `HTTP ${response.status}: ${response.statusText}`;\n   269→    }\n   270→}\n   271→\n   272→/**\n   273→ * Get auth headers for API requests\n   274→ * Uses JWT Bearer token if available, with legacy fallback\n   275→ */\n   276→function getAuthHeaders() {\n   277→    const headers = { 'Content-Type': 'application/json' };\n   278→    const settings = getSettings();\n   279→\n   280→    // Prefer JWT Bearer token (modern auth)\n   281→    if (settings.accessToken) {\n   282→        headers['Authorization'] = `Bearer ${settings.accessToken}`;\n   283→        return headers;\n   284→    }\n   285→\n   286→    // Legacy fallback for backwards compatibility\n   287→    // This will be removed after 2026-04-11\n   288→    if (settings.customerId) {\n   289→        headers['x-stripe-customer-id'] = settings.customerId;\n   290→        console.warn('[SPLICE] Using deprecated x-stripe-customer-id header. Please re-login to upgrade to JWT auth.');\n   291→    }\n   292→\n   293→    return headers;\n   294→}\n   295→\n   296→/**\n   297→ * Check if the access token is expired or about to expire\n   298→ * @returns {boolean} True if token needs refresh\n   299→ */\n   300→function isTokenExpired() {\n   301→    const settings = getSettings();\n   302→    if (!settings.tokenExpiry) return true;\n   303→\n   304→    // Refresh if less than 5 minutes remaining\n   305→    const bufferMs = 5 * 60 * 1000;\n   306→    return Date.now() >= (settings.tokenExpiry - bufferMs);\n   307→}\n   308→\n   309→/**\n   310→ * Refresh the access token using the refresh token\n   311→ * @returns {Promise<boolean>} True if refresh succeeded\n   312→ */\n   313→async function refreshAccessToken() {\n   314→    const settings = getSettings();\n   315→\n   316→    if (!settings.refreshToken) {\n   317→        debugLog('[Auth] No refresh token available');\n   318→        return false;\n   319→    }\n   320→\n   321→    try {\n   322→        debugLog('[Auth] Refreshing access token...');\n   323→\n   324→        const response = await fetchWithTimeout(`${getBackendUrl()}/auth/refresh`, {\n   325→            method: 'POST',\n   326→            headers: { 'Content-Type': 'application/json' },\n   327→            body: JSON.stringify({ refreshToken: settings.refreshToken })\n   328→        }, 30000);\n   329→\n   330→        if (!response.ok) {\n   331→            const errorMsg = await parseErrorResponse(response);\n   332→            console.error('[Auth] Token refresh failed:', errorMsg);\n   333→\n   334→            // If refresh token is invalid, clear auth and require re-login\n   335→            if (response.status === 401) {\n   336→                clearAuthTokens();\n   337→            }\n   338→            return false;\n   339→        }\n   340→\n   341→        const data = await response.json();\n   342→\n   343→        // Save new access token\n   344→        const expiresInMs = (data.expiresIn || 86400) * 1000; // Default 24h\n   345→        saveSettings({\n   346→            accessToken: data.token,\n   347→            tokenExpiry: Date.now() + expiresInMs\n   348→        });\n   349→\n   350→        debugLog('[Auth] Access token refreshed successfully');\n   351→        return true;\n   352→    } catch (err) {\n   353→        console.error('[Auth] Token refresh error:', err);\n   354→        return false;\n   355→    }\n   356→}\n   357→\n   358→/**\n   359→ * Clear all auth tokens (call on logout or auth failure)\n   360→ */\n   361→function clearAuthTokens() {\n   362→    saveSettings({\n   363→        accessToken: null,\n   364→        refreshToken: null,\n   365→        tokenExpiry: null\n   366→    });\n   367→    debugLog('[Auth] Auth tokens cleared');\n   368→}\n   369→\n   370→/**\n   371→ * Ensure we have a valid access token, refreshing if needed\n   372→ * @returns {Promise<boolean>} True if we have a valid token\n   373→ */\n   374→async function ensureValidToken() {\n   375→    const settings = getSettings();\n   376→\n   377→    // No token at all - need to login\n   378→    if (!settings.accessToken) {\n   379→        return false;\n   380→    }\n   381→\n   382→    // Token not expired - good to go\n   383→    if (!isTokenExpired()) {\n   384→        return true;\n   385→    }\n   386→\n   387→    // Try to refresh\n   388→    return await refreshAccessToken();\n   389→}\n   390→\n   391→// ============================================================================\n   392→// SETTINGS MANAGEMENT\n   393→// ============================================================================\n   394→\n   395→const DEFAULT_SETTINGS = {\n   396→    sensitivity: 50,\n   397→    minSilenceLength: 0.5,\n   398→    sourceIsolated: false,\n   399→    enableTakesDetection: true,\n   400→    enableJCut: false,\n   401→    jcutLeadIn: 0.3,\n   402→    jcutLeadOut: 0.2,\n   403→    enableZoom: false,\n   404→    zoomFrequency: 'medium',\n   405→    zoomPreset: 'medium',\n   406→    zoomPlacement: 'sentence_start',\n   407→    enableChapters: false,\n   408→    maxChapters: 10,\n   409→    minChapterLength: 60,\n   410→    enableProfanity: false,\n   411→    profanityLanguage: 'en',\n   412→    bleepType: 'standard',\n   413→    // Authentication\n   414→    customerId: null,\n   415→    licenseKey: null,\n   416→    accessToken: null,\n   417→    refreshToken: null,\n   418→    tokenExpiry: null,\n   419→    // UI State\n   420→    expandedOptions: false,\n   421→    activePreset: 'podcast',\n   422→    rememberOptions: false\n   423→};\n   424→\n   425→// Current storage version for future migrations\n   426→const SETTINGS_STORAGE_VERSION = 2;\n   427→\n   428→// Fields that contain sensitive data and should be encrypted\n   429→const SENSITIVE_FIELDS = ['customerId', 'licenseKey', 'accessToken', 'refreshToken'];\n   430→\n   431→// ============================================================================\n   432→// ENCRYPTION HELPERS FOR SENSITIVE DATA (CEP-CRIT-002 FIX)\n   433→// Uses AES-GCM encryption via Web Crypto API for proper security\n   434→// ============================================================================\n   435→\n   436→// Encryption constants\n   437→const SPLICE_ENCRYPTION = {\n   438→    ALGORITHM: 'AES-GCM',\n   439→    KEY_LENGTH: 256,\n   440→    IV_LENGTH: 12,\n   441→    TAG_LENGTH: 128,\n   442→    SALT: 'SPLICE_PANEL_SALT_v1', // Static salt for key derivation\n   443→    ITERATIONS: 100000,\n   444→    PREFIX: 'ENC:v1:'  // Prefix to identify encrypted values\n   445→};\n   446→\n   447→// Cached encryption key (derived once per session)\n   448→let _encryptionKey = null;\n   449→\n   450→/**\n   451→ * Get or derive the encryption key from a machine-specific identifier\n   452→ * Uses PBKDF2 to derive a strong key from available identifiers\n   453→ * @returns {Promise<CryptoKey>} The derived encryption key\n   454→ */\n   455→async function getEncryptionKey() {\n   456→    if (_encryptionKey) {\n   457→        return _encryptionKey;\n   458→    }\n   459→\n   460→    try {\n   461→        // Use a combination of identifiers for key derivation\n   462→        // In CEP, we use localStorage ID + app version as the key material\n   463→        let keyMaterial = localStorage.getItem('splice_device_id');\n   464→        if (!keyMaterial) {\n   465→            // Generate a random device ID on first use\n   466→            keyMaterial = crypto.randomUUID ? crypto.randomUUID() :\n   467→                'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n   468→                    const r = Math.random() * 16 | 0;\n   469→                    const v = c === 'x' ? r : (r & 0x3 | 0x8);\n   470→                    return v.toString(16);\n   471→                });\n   472→            localStorage.setItem('splice_device_id', keyMaterial);\n   473→        }\n   474→\n   475→        const encoder = new TextEncoder();\n   476→        const keyData = encoder.encode(keyMaterial + SPLICE_ENCRYPTION.SALT);\n   477→\n   478→        // Import the key material for PBKDF2\n   479→        const baseKey = await crypto.subtle.importKey(\n   480→            'raw',\n   481→            keyData,\n   482→            'PBKDF2',\n   483→            false,\n   484→            ['deriveKey']\n   485→        );\n   486→\n   487→        // Derive the actual AES key\n   488→        _encryptionKey = await crypto.subtle.deriveKey(\n   489→            {\n   490→                name: 'PBKDF2',\n   491→                salt: encoder.encode(SPLICE_ENCRYPTION.SALT),\n   492→                iterations: SPLICE_ENCRYPTION.ITERATIONS,\n   493→                hash: 'SHA-256'\n   494→            },\n   495→            baseKey,\n   496→            {\n   497→                name: SPLICE_ENCRYPTION.ALGORITHM,\n   498→                length: SPLICE_ENCRYPTION.KEY_LENGTH\n   499→            },\n   500→            false,\n   501→            ['encrypt', 'decrypt']\n   502→        );\n   503→\n   504→        return _encryptionKey;\n   505→    } catch (e) {\n   506→        debugLog('[Config] Key derivation error:', e);\n   507→        return null;\n   508→    }\n   509→}\n   510→\n   511→/**\n   512→ * Encrypt data for secure localStorage storage using AES-GCM\n   513→ *\n   514→ * @param {any} data - Data to encrypt\n   515→ * @returns {Promise<string|null>} Encrypted string with prefix or null on error\n   516→ */\n   517→async function encryptForStorageAsync(data) {\n   518→    try {\n   519→        if (data === null || data === undefined) {\n   520→            return null;\n   521→        }\n   522→\n   523→        const key = await getEncryptionKey();\n   524→        if (!key) {\n   525→            // Fallback to legacy encoding if crypto not available\n   526→            debugLog('[Config] Crypto not available, using legacy encoding');\n   527→            return legacyEncode(data);\n   528→        }\n   529→\n   530→        const encoder = new TextEncoder();\n   531→        const jsonStr = JSON.stringify(data);\n   532→        const plaintext = encoder.encode(jsonStr);\n   533→\n   534→        // Generate random IV\n   535→        const iv = crypto.getRandomValues(new Uint8Array(SPLICE_ENCRYPTION.IV_LENGTH));\n   536→\n   537→        // Encrypt\n   538→        const ciphertext = await crypto.subtle.encrypt(\n   539→            {\n   540→                name: SPLICE_ENCRYPTION.ALGORITHM,\n   541→                iv: iv,\n   542→                tagLength: SPLICE_ENCRYPTION.TAG_LENGTH\n   543→            },\n   544→            key,\n   545→            plaintext\n   546→        );\n   547→\n   548→        // Combine IV + ciphertext and encode as base64\n   549→        const combined = new Uint8Array(iv.length + ciphertext.byteLength);\n   550→        combined.set(iv);\n   551→        combined.set(new Uint8Array(ciphertext), iv.length);\n   552→\n   553→        // Convert to base64 with prefix\n   554→        const base64 = btoa(String.fromCharCode(...combined));\n   555→        return SPLICE_ENCRYPTION.PREFIX + base64;\n   556→    } catch (e) {\n   557→        debugLog('[Config] Encryption error:', e);\n   558→        return legacyEncode(data);\n   559→    }\n   560→}\n   561→\n   562→/**\n   563→ * Decrypt data from localStorage using AES-GCM\n   564→ *\n   565→ * @param {string} data - Encrypted string\n   566→ * @returns {Promise<any|null>} Decrypted data or null on error\n   567→ */\n   568→async function decryptFromStorageAsync(data) {\n   569→    try {\n   570→        if (!data || typeof data !== 'string') {\n   571→            return null;\n   572→        }\n   573→\n   574→        // Check if this is the new encrypted format\n   575→        if (!data.startsWith(SPLICE_ENCRYPTION.PREFIX)) {\n   576→            // Try legacy decoding for backward compatibility\n   577→            return legacyDecode(data);\n   578→        }\n   579→\n   580→        const key = await getEncryptionKey();\n   581→        if (!key) {\n   582→            debugLog('[Config] Crypto not available for decryption');\n   583→            return null;\n   584→        }\n   585→\n   586→        // Remove prefix and decode base64\n   587→        const base64Data = data.slice(SPLICE_ENCRYPTION.PREFIX.length);\n   588→        const combined = Uint8Array.from(atob(base64Data), c => c.charCodeAt(0));\n   589→\n   590→        // Extract IV and ciphertext\n   591→        const iv = combined.slice(0, SPLICE_ENCRYPTION.IV_LENGTH);\n   592→        const ciphertext = combined.slice(SPLICE_ENCRYPTION.IV_LENGTH);\n   593→\n   594→        // Decrypt\n   595→        const plaintext = await crypto.subtle.decrypt(\n   596→            {\n   597→                name: SPLICE_ENCRYPTION.ALGORITHM,\n   598→                iv: iv,\n   599→                tagLength: SPLICE_ENCRYPTION.TAG_LENGTH\n   600→            },\n   601→            key,\n   602→            ciphertext\n   603→        );\n   604→\n   605→        const decoder = new TextDecoder();\n   606→        const jsonStr = decoder.decode(plaintext);\n   607→        return JSON.parse(jsonStr);\n   608→    } catch (e) {\n   609→        // Try legacy decoding as fallback\n   610→        return legacyDecode(data);\n   611→    }\n   612→}\n   613→\n   614→/**\n   615→ * Legacy encoding (Base64) for backward compatibility\n   616→ * @param {any} data - Data to encode\n   617→ * @returns {string|null} Encoded string\n   618→ */\n   619→function legacyEncode(data) {\n   620→    try {\n   621→        if (data === null || data === undefined) {\n   622→            return null;\n   623→        }\n   624→        const jsonStr = JSON.stringify(data);\n   625→        const encoded = encodeURIComponent(jsonStr);\n   626→        return btoa(encoded);\n   627→    } catch (e) {\n   628→        return null;\n   629→    }\n   630→}\n   631→\n   632→/**\n   633→ * Legacy decoding (Base64) for backward compatibility\n   634→ * @param {string} data - Encoded string\n   635→ * @returns {any|null} Decoded data\n   636→ */\n   637→function legacyDecode(data) {\n   638→    try {\n   639→        if (!data || typeof data !== 'string') {\n   640→            return null;\n   641→        }\n   642→        // Skip if it has the encryption prefix\n   643→        if (data.startsWith(SPLICE_ENCRYPTION.PREFIX)) {\n   644→            return null;\n   645→        }\n   646→        const decoded = atob(data);\n   647→        const jsonStr = decodeURIComponent(decoded);\n   648→        return JSON.parse(jsonStr);\n   649→    } catch (e) {\n   650→        return null;\n   651→    }\n   652→}\n   653→\n   654→/**\n   655→ * Synchronous wrapper for encryption (starts async operation)\n   656→ * For backward compatibility with existing sync code\n   657→ * @param {any} data - Data to encode\n   658→ * @returns {string|null} Encoded string (legacy format until async completes)\n   659→ */\n   660→function encryptForStorage(data) {\n   661→    // Return legacy encoding synchronously\n   662→    // The async version should be preferred for new code\n   663→    return legacyEncode(data);\n   664→}\n   665→\n   666→/**\n   667→ * Synchronous wrapper for decryption\n   668→ * For backward compatibility with existing sync code\n   669→ * @param {string} data - Encoded string\n   670→ * @returns {any|null} Decoded data\n   671→ */\n   672→function decryptFromStorage(data) {\n   673→    // Handle new encrypted format by returning null (needs async)\n   674→    if (data && data.startsWith(SPLICE_ENCRYPTION.PREFIX)) {\n   675→        debugLog('[Config] Encrypted data requires async decryption');\n   676→        return null;\n   677→    }\n   678→    return legacyDecode(data);\n   679→}\n   680→\n   681→/**\n   682→ * Check if a value appears to be encrypted\n   683→ *\n   684→ * @param {any} value - Value to check\n   685→ * @returns {boolean} True if value appears to be encrypted\n   686→ */\n   687→function isEncryptedValue(value) {\n   688→    if (!value || typeof value !== 'string') {\n   689→        return false;\n   690→    }\n   691→    // New encryption format\n   692→    if (value.startsWith(SPLICE_ENCRYPTION.PREFIX)) {\n   693→        return true;\n   694→    }\n   695→    // Unencrypted values typically start with known patterns\n   696→    if (value.startsWith('cus_') || value.startsWith('SPLICE-')) {\n   697→        return false;\n   698→    }\n   699→    // Check if it's legacy base64 encoded JSON\n   700→    try {\n   701→        const decoded = atob(value);\n   702→        const jsonStr = decodeURIComponent(decoded);\n   703→        JSON.parse(jsonStr);\n   704→        return true;\n   705→    } catch {\n   706→        return false;\n   707→    }\n   708→}\n   709→\n   710→/**\n   711→ * Encrypt sensitive fields in settings object\n   712→ *\n   713→ * @param {Object} settings - Settings object with plaintext sensitive fields\n   714→ * @returns {Object} Settings with encrypted sensitive fields\n   715→ */\n   716→function encryptSensitiveFields(settings) {\n   717→    const encrypted = { ...settings };\n   718→\n   719→    for (const field of SENSITIVE_FIELDS) {\n   720→        if (encrypted[field] !== null && encrypted[field] !== undefined) {\n   721→            // Only encrypt if not already encrypted\n   722→            if (!isEncryptedValue(encrypted[field])) {\n   723→                encrypted[field] = encryptForStorage(encrypted[field]);\n   724→                debugLog(`[Config] Encrypted field: ${field}`);\n   725→            }\n   726→        }\n   727→    }\n   728→\n   729→    return encrypted;\n   730→}\n   731→\n   732→/**\n   733→ * Decrypt sensitive fields in settings object\n   734→ *\n   735→ * @param {Object} settings - Settings object with encrypted sensitive fields\n   736→ * @returns {Object} Settings with decrypted sensitive fields\n   737→ */\n   738→function decryptSensitiveFields(settings) {\n   739→    const decrypted = { ...settings };\n   740→\n   741→    for (const field of SENSITIVE_FIELDS) {\n   742→        if (decrypted[field] !== null && decrypted[field] !== undefined) {\n   743→            // Check if it looks encrypted before attempting to decrypt\n   744→            if (isEncryptedValue(decrypted[field])) {\n   745→                const decryptedValue = decryptFromStorage(decrypted[field]);\n   746→                if (decryptedValue !== null) {\n   747→                    decrypted[field] = decryptedValue;\n   748→                    debugLog(`[Config] Decrypted field: ${field}`);\n   749→                }\n   750→            }\n   751→            // If not encrypted (legacy data), keep the original value\n   752→        }\n   753→    }\n   754→\n   755→    return decrypted;\n   756→}\n   757→\n   758→/**\n   759→ * Internal save function to avoid recursion during migration\n   760→ * @private\n   761→ */\n   762→function _saveSettingsInternal(settings) {\n   763→    try {\n   764→        // Encrypt sensitive fields before storing\n   765→        const toStore = encryptSensitiveFields(settings);\n   766→\n   767→        // Add version marker for future migrations\n   768→        toStore._storageVersion = SETTINGS_STORAGE_VERSION;\n   769→\n   770→        localStorage.setItem('spliceSettings', JSON.stringify(toStore));\n   771→        return true;\n   772→    } catch (e) {\n   773→        console.warn('[Config] Error saving settings:', e);\n   774→        return false;\n   775→    }\n   776→}\n   777→\n   778→/**\n   779→ * Get settings from localStorage\n   780→ * Handles migration from unencrypted to encrypted storage format\n   781→ */\n   782→function getSettings() {\n   783→    try {\n   784→        const stored = localStorage.getItem('spliceSettings');\n   785→        if (stored) {\n   786→            const parsed = JSON.parse(stored);\n   787→\n   788→            // Decrypt sensitive fields (handles both encrypted and legacy unencrypted data)\n   789→            const decrypted = decryptSensitiveFields(parsed);\n   790→\n   791→            // Check if migration is needed (no version marker = legacy data)\n   792→            if (!parsed._storageVersion) {\n   793→                // Migrate legacy data: save with encryption and version marker\n   794→                debugLog('[Config] Migrating legacy settings to encrypted format');\n   795→                const migratedSettings = { ...DEFAULT_SETTINGS, ...decrypted };\n   796→                // Use internal save to avoid infinite recursion\n   797→                _saveSettingsInternal(migratedSettings);\n   798→            }\n   799→\n   800→            // Return merged settings without internal fields\n   801→            const result = { ...DEFAULT_SETTINGS, ...decrypted };\n   802→            delete result._storageVersion;\n   803→            return result;\n   804→        }\n   805→    } catch (e) {\n   806→        console.warn('[Config] Error loading settings:', e);\n   807→    }\n   808→    return { ...DEFAULT_SETTINGS };\n   809→}\n   810→\n   811→/**\n   812→ * Save settings to localStorage\n   813→ * Encrypts sensitive fields before storing\n   814→ */\n   815→function saveSettings(settings) {\n   816→    try {\n   817→        // Get current settings (decrypted) and merge with new settings\n   818→        const current = getSettings();\n   819→        const merged = { ...current, ...settings };\n   820→\n   821→        return _saveSettingsInternal(merged);\n   822→    } catch (e) {\n   823→        console.warn('[Config] Error saving settings:', e);\n   824→        return false;\n   825→    }\n   826→}\n   827→\n   828→/**\n   829→ * Clear specific setting\n   830→ */\n   831→function clearSetting(key) {\n   832→    const settings = getSettings();\n   833→    delete settings[key];\n   834→    _saveSettingsInternal(settings);\n   835→}\n   836→\n   837→// ============================================================================\n   838→// OFFLINE DETECTION\n   839→// ============================================================================\n   840→\n   841→let isOnlineState = true;\n   842→let offlineCheckInterval = null;\n   843→\n   844→/**\n   845→ * Check if online\n   846→ */\n   847→function isOnline() {\n   848→    return isOnlineState && navigator.onLine;\n   849→}\n   850→\n   851→/**\n   852→ * Initialize offline detection\n   853→ */\n   854→function initOfflineDetection() {\n   855→    // Browser events\n   856→    window.addEventListener('online', () => {\n   857→        isOnlineState = true;\n   858→        updateOfflineUI(true);\n   859→    });\n   860→\n   861→    window.addEventListener('offline', () => {\n   862→        isOnlineState = false;\n   863→        updateOfflineUI(false);\n   864→    });\n   865→\n   866→    // Periodic check\n   867→    offlineCheckInterval = setInterval(async () => {\n   868→        try {\n   869→            const response = await fetchWithTimeout(\n   870→                `${getBackendUrl()}/health`,\n   871→                { method: 'GET' },\n   872→                5000\n   873→            );\n   874→            isOnlineState = response.ok;\n   875→        } catch {\n   876→            isOnlineState = false;\n   877→        }\n   878→        updateOfflineUI(isOnlineState);\n   879→    }, 30000);\n   880→}\n   881→\n   882→/**\n   883→ * Update UI based on online state\n   884→ */\n   885→function updateOfflineUI(online) {\n   886→    const goBtn = document.getElementById('goBtn');\n   887→    const status = document.getElementById('status');\n   888→\n   889→    if (goBtn) {\n   890→        goBtn.disabled = !online;\n   891→    }\n   892→\n   893→    if (status) {\n   894→        if (!online) {\n   895→            status.textContent = 'Offline - Check your connection';\n   896→            status.style.color = '#dc3545';\n   897→        } else {\n   898→            // Reset status when back online\n   899→            status.textContent = 'Ready';\n   900→            status.style.color = '#888';\n   901→        }\n   902→    }\n   903→}\n   904→\n   905→// ============================================================================\n   906→// UTILITY FUNCTIONS\n   907→// ============================================================================\n   908→\n   909→/**\n   910→ * SECURITY: Escape HTML to prevent XSS attacks\n   911→ * Use this when inserting untrusted content into innerHTML\n   912→ * @param {string} str - String to escape\n   913→ * @returns {string} Escaped string safe for innerHTML\n   914→ */\n   915→function escapeHtml(str) {\n   916→    if (str === null || str === undefined) return '';\n   917→    if (typeof str !== 'string') str = String(str);\n   918→\n   919→    const escapeMap = {\n   920→        '&': '&amp;',\n   921→        '<': '&lt;',\n   922→        '>': '&gt;',\n   923→        '\"': '&quot;',\n   924→        \"'\": '&#x27;',\n   925→        '/': '&#x2F;',\n   926→        '`': '&#x60;'\n   927→    };\n   928→\n   929→    return str.replace(/[&<>\"'\\/`]/g, char => escapeMap[char]);\n   930→}\n   931→\n   932→/**\n   933→ * SECURITY: Create safe HTML from template with escaped values\n   934→ * @param {TemplateStringsArray} strings - Template strings\n   935→ * @param {...any} values - Values to escape\n   936→ * @returns {string} HTML with escaped values\n   937→ */\n   938→function safeHtml(strings, ...values) {\n   939→    return strings.reduce((result, str, i) => {\n   940→        const value = values[i - 1];\n   941→        const escaped = escapeHtml(value);\n   942→        return result + escaped + str;\n   943→    });\n   944→}\n   945→\n   946→/**\n   947→ * Format time in MM:SS or HH:MM:SS\n   948→ */\n   949→function formatTime(seconds) {\n   950→    if (isNaN(seconds) || seconds < 0) return '0:00';\n   951→\n   952→    const hours = Math.floor(seconds / 3600);\n   953→    const minutes = Math.floor((seconds % 3600) / 60);\n   954→    const secs = Math.floor(seconds % 60);\n   955→\n   956→    if (hours > 0) {\n   957→        return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n   958→    }\n   959→    return `${minutes}:${secs.toString().padStart(2, '0')}`;\n   960→}\n   961→\n   962→/**\n   963→ * Set status message\n   964→ */\n   965→function setStatus(message, isError = false) {\n   966→    const status = document.getElementById('status');\n   967→    if (status) {\n   968→        status.textContent = message;\n   969→        status.style.color = isError ? '#dc3545' : '#888';\n   970→    }\n   971→}\n   972→\n   973→/**\n   974→ * Debounce function calls\n   975→ */\n   976→function debounce(func, wait) {\n   977→    let timeout;\n   978→    return function executedFunction(...args) {\n   979→        const later = () => {\n   980→            clearTimeout(timeout);\n   981→            func(...args);\n   982→        };\n   983→        clearTimeout(timeout);\n   984→        timeout = setTimeout(later, wait);\n   985→    };\n   986→}\n   987→\n   988→// ============================================================================\n   989→// PRESET PROFILES\n   990→// ============================================================================\n   991→\n   992→/**\n   993→ * Detection presets for different content types.\n   994→ * Each preset defines optimal settings for a specific use case.\n   995→ */\n   996→const PRESETS = {\n   997→    // Custom - user-defined settings (default)\n   998→    custom: {\n   999→        name: 'Custom',\n  1000→        description: 'Your custom settings',\n  1001→        icon: 'settings',\n  1002→        settings: null // Uses current user settings\n  1003→    },\n  1004→\n  1005→    // Podcast - longer pauses are natural, be conservative\n  1006→    podcast: {\n  1007→        name: 'Podcast',\n  1008→        description: 'Longer natural pauses, J-Cuts enabled',\n  1009→        icon: 'mic',\n  1010→        settings: {\n  1011→            sensitivity: 35,\n  1012→            threshold: -35,\n  1013→            minSilenceLength: 0.8,\n  1014→            paddingStart: 0.15,\n  1015→            paddingEnd: 0.15,\n  1016→            enableTakesDetection: true,\n  1017→            enableJCut: true,\n  1018→            jCutLeadIn: 0.3,\n  1019→            jCutLeadOut: 0.2\n  1020→        }\n  1021→    },\n  1022→\n  1023→    // Interview - balanced, respects speaker pauses\n  1024→    interview: {\n  1025→        name: 'Interview',\n  1026→        description: 'Balanced cuts, J-Cuts for smooth transitions',\n  1027→        icon: 'people',\n  1028→        settings: {\n  1029→            sensitivity: 50,\n  1030→            threshold: -32,\n  1031→            minSilenceLength: 0.5,\n  1032→            paddingStart: 0.12,\n  1033→            paddingEnd: 0.08,\n  1034→            enableTakesDetection: true,\n  1035→            enableJCut: true,\n  1036→            jCutLeadIn: 0.25,\n  1037→            jCutLeadOut: 0.15\n  1038→        }\n  1039→    },\n  1040→\n  1041→    // Reaction video - fast pacing, quick cuts\n  1042→    reaction: {\n  1043→        name: 'Reaction',\n  1044→        description: 'Fast-paced, tight cuts for energy',\n  1045→        icon: 'bolt',\n  1046→        settings: {\n  1047→            sensitivity: 70,\n  1048→            threshold: -28,\n  1049→            minSilenceLength: 0.3,\n  1050→            paddingStart: 0.05,\n  1051→            paddingEnd: 0.03,\n  1052→            enableTakesDetection: false,\n  1053→            enableJCut: false,\n  1054→            jCutLeadIn: 0,\n  1055→            jCutLeadOut: 0\n  1056→        }\n  1057→    },\n  1058→\n  1059→    // Tutorial/Educational - preserve thinking pauses\n  1060→    tutorial: {\n  1061→        name: 'Tutorial',\n  1062→        description: 'Preserves teaching pace, J-Cuts enabled',\n  1063→        icon: 'school',\n  1064→        settings: {\n  1065→            sensitivity: 30,\n  1066→            threshold: -38,\n  1067→            minSilenceLength: 1.0,\n  1068→            paddingStart: 0.2,\n  1069→            paddingEnd: 0.15,\n  1070→            enableTakesDetection: true,\n  1071→            enableJCut: true,\n  1072→            jCutLeadIn: 0.35,\n  1073→            jCutLeadOut: 0.25\n  1074→        }\n  1075→    },\n  1076→\n  1077→    // Vlog/YouTube - punchy edits, engagement-focused\n  1078→    vlog: {\n  1079→        name: 'Vlog',\n  1080→        description: 'Punchy edits for YouTube engagement',\n  1081→        icon: 'videocam',\n  1082→        settings: {\n  1083→            sensitivity: 65,\n  1084→            threshold: -30,\n  1085→            minSilenceLength: 0.35,\n  1086→            paddingStart: 0.08,\n  1087→            paddingEnd: 0.05,\n  1088→            enableTakesDetection: true,\n  1089→            enableJCut: false,\n  1090→            jCutLeadIn: 0,\n  1091→            jCutLeadOut: 0\n  1092→        }\n  1093→    }\n  1094→};\n  1095→\n  1096→/**\n  1097→ * List of built-in preset IDs\n  1098→ */\n  1099→const BUILT_IN_PRESET_IDS = ['custom', 'podcast', 'interview', 'reaction', 'tutorial', 'vlog'];\n  1100→\n  1101→/**\n  1102→ * Get all available presets\n  1103→ * @returns {Object} All preset definitions\n  1104→ */\n  1105→function getPresets() {\n  1106→    return { ...PRESETS };\n  1107→}\n  1108→\n  1109→/**\n  1110→ * Get a specific preset by name\n  1111→ * @param {string} presetName - Name of the preset\n  1112→ * @returns {Object|null} Preset definition or null if not found\n  1113→ */\n  1114→function getPreset(presetName) {\n  1115→    return PRESETS[presetName] || null;\n  1116→}\n  1117→\n  1118→/**\n  1119→ * Check if a preset is a built-in preset\n  1120→ * @param {string} id - Preset ID to check\n  1121→ * @returns {boolean} True if built-in, false if custom\n  1122→ */\n  1123→function isBuiltInPreset(id) {\n  1124→    return BUILT_IN_PRESET_IDS.includes(id);\n  1125→}\n  1126→\n  1127→/**\n  1128→ * Apply a preset to current settings\n  1129→ * @param {string} presetName - Name of the preset to apply\n  1130→ * @returns {Object} The applied settings\n  1131→ */\n  1132→function applyPreset(presetName) {\n  1133→    const preset = PRESETS[presetName];\n  1134→\n  1135→    if (!preset) {\n  1136→        console.warn(`[SPLICE] Unknown preset: ${presetName}`);\n  1137→        return getSettings();\n  1138→    }\n  1139→\n  1140→    // Custom preset uses current settings\n  1141→    if (presetName === 'custom' || !preset.settings) {\n  1142→        saveSettings({ activePreset: 'custom' });\n  1143→        return getSettings();\n  1144→    }\n  1145→\n  1146→    // Apply preset settings\n  1147→    const newSettings = {\n  1148→        ...preset.settings,\n  1149→        activePreset: presetName\n  1150→    };\n  1151→\n  1152→    saveSettings(newSettings);\n  1153→    debugLog(`Applied preset: ${preset.name}`);\n  1154→\n  1155→    return getSettings();\n  1156→}\n  1157→\n  1158→/**\n  1159→ * Get the currently active preset\n  1160→ * @returns {string} Active preset name\n  1161→ */\n  1162→function getActivePreset() {\n  1163→    const settings = getSettings();\n  1164→    return settings.activePreset || 'custom';\n  1165→}\n  1166→\n  1167→/**\n  1168→ * Initialize preset selector\n  1169→ */\n  1170→function initPresetSelector() {\n  1171→    const presetSelector = document.getElementById('presetSelector');\n  1172→    const sensitivitySlider = document.getElementById('sensitivitySlider');\n  1173→\n  1174→    if (!presetSelector) return;\n  1175→\n  1176→    // Set initial value from settings\n  1177→    const settings = getSettings();\n  1178→    presetSelector.value = settings.activePreset || 'podcast';\n  1179→\n  1180→    // Handle preset change\n  1181→    presetSelector.addEventListener('change', () => {\n  1182→        const presetId = presetSelector.value;\n  1183→        const appliedSettings = applyPreset(presetId);\n  1184→\n  1185→        // Update sensitivity slider to match preset\n  1186→        if (sensitivitySlider && appliedSettings.sensitivity !== undefined) {\n  1187→            sensitivitySlider.value = appliedSettings.sensitivity;\n  1188→            // Update display value\n  1189→            const sensitivityValue = document.getElementById('sensitivityValue');\n  1190→            if (sensitivityValue) {\n  1191→                sensitivityValue.textContent = appliedSettings.sensitivity;\n  1192→            }\n  1193→        }\n  1194→\n  1195→        // Update takes detection checkbox\n  1196→        const enableTakesDetection = document.getElementById('enableTakesDetection');\n  1197→        if (enableTakesDetection && appliedSettings.enableTakesDetection !== undefined) {\n  1198→            enableTakesDetection.checked = appliedSettings.enableTakesDetection;\n  1199→        }\n  1200→\n  1201→        // Update J-Cut checkbox\n  1202→        const enableJCut = document.getElementById('enableJCut');\n  1203→        if (enableJCut && appliedSettings.enableJCut !== undefined) {\n  1204→            enableJCut.checked = appliedSettings.enableJCut;\n  1205→            // Toggle J-Cut settings visibility\n  1206→            const jcutSettings = document.getElementById('jcutSettings');\n  1207→            if (jcutSettings) {\n  1208→                jcutSettings.classList.toggle('collapsed', !appliedSettings.enableJCut);\n  1209→            }\n  1210→        }\n  1211→\n  1212→        const preset = getPreset(presetId);\n  1213→        if (preset) {\n  1214→            setStatus(`Preset: ${preset.name} - ${preset.description}`);\n  1215→        }\n  1216→    });\n  1217→\n  1218→    // Switch to custom when user manually changes sensitivity\n  1219→    if (sensitivitySlider) {\n  1220→        sensitivitySlider.addEventListener('change', () => {\n  1221→            if (presetSelector.value !== 'custom') {\n  1222→                presetSelector.value = 'custom';\n  1223→                saveSettings({ activePreset: 'custom' });\n  1224→            }\n  1225→        });\n  1226→    }\n  1227→}\n  1228→\n  1229→// ============================================================================\n  1230→// LOGIN MODAL\n  1231→// ============================================================================\n  1232→\n  1233→/**\n  1234→ * Validate license key format: SPLICE-XXXX-XXXX-XXXX\n  1235→ * Character set excludes confusing chars: 0/O, 1/I/L\n  1236→ */\n  1237→function isValidLicenseKeyFormat(key) {\n  1238→    if (!key || typeof key !== 'string') return false;\n  1239→    const normalized = key.toUpperCase().trim();\n  1240→    const pattern = /^SPLICE-[ABCDEFGHJKMNPQRSTUVWXYZ23456789]{4}-[ABCDEFGHJKMNPQRSTUVWXYZ23456789]{4}-[ABCDEFGHJKMNPQRSTUVWXYZ23456789]{4}$/;\n  1241→    return pattern.test(normalized);\n  1242→}\n  1243→\n  1244→/**\n  1245→ * Initialize login modal handlers\n  1246→ */\n  1247→function initLoginModal() {\n  1248→    const loginModal = document.getElementById('loginModal');\n  1249→    const closeLoginBtn = document.getElementById('closeLoginBtn');\n  1250→    const saveLoginBtn = document.getElementById('saveLoginBtn');\n  1251→    const licenseKeyInput = document.getElementById('licenseKeyInput');\n  1252→    const creditBadge = document.getElementById('creditBadge');\n  1253→\n  1254→    // Handle credit badge click - retry on error, or show login modal\n  1255→    if (creditBadge) {\n  1256→        creditBadge.addEventListener('click', async () => {\n  1257→            if (creditBadge.classList.contains('error')) {\n  1258→                creditBadge.textContent = '...';\n  1259→                if (typeof refreshCredits === 'function') {\n  1260→                    await refreshCredits();\n  1261→                }\n  1262→                return;\n  1263→            }\n  1264→            showLoginModal();\n  1265→        });\n  1266→    }\n  1267→\n  1268→    // Close login modal\n  1269→    if (closeLoginBtn && loginModal) {\n  1270→        closeLoginBtn.addEventListener('click', () => {\n  1271→            loginModal.classList.add('hidden');\n  1272→        });\n  1273→    }\n  1274→\n  1275→    // Close on backdrop click\n  1276→    if (loginModal) {\n  1277→        loginModal.addEventListener('click', (e) => {\n  1278→            if (e.target === loginModal) {\n  1279→                loginModal.classList.add('hidden');\n  1280→            }\n  1281→        });\n  1282→    }\n  1283→\n  1284→    // Activate license key\n  1285→    if (saveLoginBtn) {\n  1286→        saveLoginBtn.addEventListener('click', async () => {\n  1287→            const licenseKey = licenseKeyInput?.value?.trim()?.toUpperCase();\n  1288→\n  1289→            if (!licenseKey) {\n  1290→                showLoginError('Please enter your license key');\n  1291→                return;\n  1292→            }\n  1293→\n  1294→            if (!isValidLicenseKeyFormat(licenseKey)) {\n  1295→                showLoginError('Invalid format. Expected: SPLICE-XXXX-XXXX-XXXX');\n  1296→                return;\n  1297→            }\n  1298→\n  1299→            saveLoginBtn.disabled = true;\n  1300→            saveLoginBtn.textContent = 'Activating...';\n  1301→\n  1302→            try {\n  1303→                // Use /auth/login endpoint which returns JWT tokens\n  1304→                const response = await fetchWithTimeout(`${getBackendUrl()}/auth/login`, {\n  1305→                    method: 'POST',\n  1306→                    headers: { 'Content-Type': 'application/json' },\n  1307→                    body: JSON.stringify({ licenseKey: licenseKey })\n  1308→                }, SPLICE_CONFIG.FETCH_TIMEOUT);\n  1309→\n  1310→                const result = await response.json();\n  1311→\n  1312→                if (!result.success) {\n  1313→                    showLoginError(result.error || 'Activation failed');\n  1314→                    return;\n  1315→                }\n  1316→\n  1317→                // Store JWT tokens and customer info\n  1318→                const expiresInMs = (result.expiresIn || 86400) * 1000; // Default 24h\n  1319→                saveSettings({\n  1320→                    customerId: result.customerId,\n  1321→                    accessToken: result.token,\n  1322→                    refreshToken: result.refreshToken,\n  1323→                    tokenExpiry: Date.now() + expiresInMs,\n  1324→                    licenseKey: licenseKey // Keep for re-authentication\n  1325→                });\n  1326→\n  1327→                loginModal?.classList.add('hidden');\n  1328→\n  1329→                if (typeof refreshCredits === 'function') {\n  1330→                    await refreshCredits();\n  1331→                }\n  1332→\n  1333→                const tierName = result.tier ? result.tier.charAt(0).toUpperCase() + result.tier.slice(1) : 'Unknown';\n  1334→                setStatus(`License activated! ${tierName} tier`);\n  1335→            } catch (err) {\n  1336→                console.error('[SPLICE] License activation error:', err);\n  1337→\n  1338→                // DIAGNOSTIC LOGGING: Capture exact error details (debug mode only)\n  1339→                debugLog('=== CEP LICENSE ACTIVATION ERROR DIAGNOSTICS ===');\n  1340→                debugLog('Error name:', err?.name);\n  1341→                debugLog('Error message:', err?.message);\n  1342→                debugLog('Error stack:', err?.stack);\n  1343→                debugLog('Backend URL:', getBackendUrl());\n  1344→                debugLog('Fetch timeout:', SPLICE_CONFIG.FETCH_TIMEOUT);\n  1345→                debugLog('Is CEP environment:', typeof CSInterface !== 'undefined');\n  1346→                debugLog('User agent:', navigator?.userAgent);\n  1347→                debugLog('Error constructor:', err?.constructor?.name);\n  1348→                debugLog('Is TypeError:', err?.name === 'TypeError');\n  1349→                debugLog('Message contains \"Failed to fetch\":', err?.message?.includes('Failed to fetch'));\n  1350→                debugLog('Message contains \"fetch\":', err?.message?.toLowerCase()?.includes('fetch'));\n  1351→                debugLog('Message contains \"network\":', err?.message?.toLowerCase()?.includes('network'));\n  1352→                debugLog('Message contains \"CORS\":', err?.message?.toLowerCase()?.includes('cors'));\n  1353→                debugLog('Message contains \"SSL\":', err?.message?.toLowerCase()?.includes('ssl'));\n  1354→                debugLog('Message contains \"certificate\":', err?.message?.toLowerCase()?.includes('certificate'));\n  1355→                debugLog('Full error object:', JSON.stringify(err, Object.getOwnPropertyNames(err)));\n  1356→                debugLog('================================================');\n  1357→\n  1358→                // Provide detailed error message based on error type\n  1359→                let errorMessage = 'Connection error. ';\n  1360→\n  1361→                if (err.message === 'Request timed out') {\n  1362→                    errorMessage += 'Server is not responding. Check if backend is running.';\n  1363→                } else if (err.message?.includes('Failed to fetch') || err.name === 'TypeError') {\n  1364→                    errorMessage += `Cannot reach ${getBackendUrl()}. Check network/firewall.`;\n  1365→                } else if (err.message?.includes('CORS')) {\n  1366→                    errorMessage += 'CORS error. Contact support.';\n  1367→                } else if (err.message?.includes('SSL') || err.message?.includes('certificate')) {\n  1368→                    errorMessage += 'SSL certificate error. Try updating your system certificates.';\n  1369→                } else if (err.message) {\n  1370→                    errorMessage += err.message;\n  1371→                } else {\n  1372→                    errorMessage += 'Unknown error. Check console for details.';\n  1373→                }\n  1374→\n  1375→                debugLog('Final error message shown to user:', errorMessage);\n  1376→                showLoginError(errorMessage);\n  1377→            } finally {\n  1378→                saveLoginBtn.disabled = false;\n  1379→                saveLoginBtn.textContent = 'Activate';\n  1380→            }\n  1381→        });\n  1382→    }\n  1383→\n  1384→    // Email lookup\n  1385→    const lookupLicenseBtn = document.getElementById('lookupLicenseBtn');\n  1386→    const lookupEmailInput = document.getElementById('lookupEmailInput');\n  1387→\n  1388→    if (lookupLicenseBtn) {\n  1389→        lookupLicenseBtn.addEventListener('click', async () => {\n  1390→            const email = lookupEmailInput?.value?.trim()?.toLowerCase();\n  1391→\n  1392→            if (!email) {\n  1393→                showLoginError('Please enter your email address');\n  1394→                return;\n  1395→            }\n  1396→\n  1397→            const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  1398→            if (!emailRegex.test(email)) {\n  1399→                showLoginError('Please enter a valid email address');\n  1400→                return;\n  1401→            }\n  1402→\n  1403→            lookupLicenseBtn.disabled = true;\n  1404→            lookupLicenseBtn.textContent = 'Looking up...';\n  1405→\n  1406→            try {\n  1407→                const response = await fetchWithTimeout(`${getBackendUrl()}/license/lookup`, {\n  1408→                    method: 'POST',\n  1409→                    headers: { 'Content-Type': 'application/json' },\n  1410→                    body: JSON.stringify({ email })\n  1411→                }, 30000);\n  1412→\n  1413→                const result = await response.json();\n  1414→\n  1415→                // Note: For security, the backend does NOT return the license key directly.\n  1416→                // It sends the key via email to prevent enumeration attacks.\n  1417→                if (result.success) {\n  1418→                    setStatus(result.message || 'If a license exists, it will be sent to your email.');\n  1419→                } else {\n  1420→                    showLoginError(result.error || 'Lookup failed. Please try again.');\n  1421→                }\n  1422→            } catch (err) {\n  1423→                console.error('[SPLICE] License lookup error:', err);\n  1424→                showLoginError('Failed to look up license. Please try again.');\n  1425→            } finally {\n  1426→                lookupLicenseBtn.disabled = false;\n  1427→                lookupLicenseBtn.textContent = 'Lookup';\n  1428→            }\n  1429→        });\n  1430→    }\n  1431→\n  1432→    // Handle external URL buttons\n  1433→    // CEP panels cannot use target=\"_blank\" for security reasons.\n  1434→    // Must use CSInterface.openURLInDefaultBrowser() instead.\n  1435→    initExternalLinkButtons();\n  1436→}\n  1437→\n  1438→/**\n  1439→ * Initialize all external link buttons that need CSInterface.openURLInDefaultBrowser()\n  1440→ * CEP panels cannot use target=\"_blank\" due to security restrictions\n  1441→ */\n  1442→function initExternalLinkButtons() {\n  1443→    // Check if CSInterface is available\n  1444→    if (typeof CSInterface === 'undefined') {\n  1445→        console.warn('[SPLICE] CSInterface not available - external links disabled');\n  1446→        return;\n  1447→    }\n  1448→\n  1449→    let cs;\n  1450→    try {\n  1451→        cs = new CSInterface();\n  1452→    } catch (e) {\n  1453→        console.warn('[SPLICE] Failed to create CSInterface:', e.message);\n  1454→        return;\n  1455→    }\n  1456→\n  1457→    // Buy a License button\n  1458→    const buyLicenseBtn = document.querySelector('.btn-buy-license');\n  1459→\n  1460→    if (buyLicenseBtn) {\n  1461→        buyLicenseBtn.addEventListener('click', (e) => {\n  1462→            e.preventDefault();\n  1463→            e.stopPropagation();\n  1464→\n  1465→            // Visual feedback\n  1466→            buyLicenseBtn.textContent = 'Opening...';\n  1467→            buyLicenseBtn.style.backgroundColor = '#28a745';\n  1468→\n  1469→            try {\n  1470→                cs.openURLInDefaultBrowser('https://spliceclips.com/pricing');\n  1471→\n  1472→                // Reset button after a delay\n  1473→                setTimeout(() => {\n  1474→                    buyLicenseBtn.textContent = 'Buy License';\n  1475→                    buyLicenseBtn.style.backgroundColor = '';\n  1476→                }, 2000);\n  1477→            } catch (err) {\n  1478→                console.error('[SPLICE] Failed to open URL:', err.message);\n  1479→                buyLicenseBtn.textContent = 'Error';\n  1480→                buyLicenseBtn.style.backgroundColor = '#dc3545';\n  1481→            }\n  1482→        });\n  1483→    }\n  1484→    \n  1485→    // View Plans button (in upgrade modal)\n  1486→    const viewPlansBtn = document.querySelector('.btn-view-plans');\n  1487→    if (viewPlansBtn) {\n  1488→        viewPlansBtn.addEventListener('click', (e) => {\n  1489→            e.preventDefault();\n  1490→            e.stopPropagation();\n  1491→            const url = viewPlansBtn.dataset.url || 'https://spliceclips.com/pricing';\n  1492→            cs.openURLInDefaultBrowser(url);\n  1493→        });\n  1494→    }\n  1495→    \n  1496→    // Referral link button\n  1497→    const referralBtn = document.querySelector('.btn-referral');\n  1498→    if (referralBtn) {\n  1499→        referralBtn.addEventListener('click', (e) => {\n  1500→            e.preventDefault();\n  1501→            e.stopPropagation();\n  1502→            const url = referralBtn.dataset.url || 'https://splice.video/referrals';\n  1503→            cs.openURLInDefaultBrowser(url);\n  1504→        });\n  1505→    }\n  1506→}\n  1507→\n  1508→/**\n  1509→ * Show login modal\n  1510→ */\n  1511→function showLoginModal() {\n  1512→    const loginModal = document.getElementById('loginModal');\n  1513→    const loginError = document.getElementById('loginError');\n  1514→    if (loginError) loginError.style.display = 'none';\n  1515→    if (loginModal) loginModal.classList.remove('hidden');\n  1516→}\n  1517→\n  1518→/**\n  1519→ * Show login error message\n  1520→ */\n  1521→function showLoginError(message) {\n  1522→    const loginError = document.getElementById('loginError');\n  1523→    if (loginError) {\n  1524→        loginError.textContent = message;\n  1525→        loginError.style.display = 'block';\n  1526→    }\n  1527→}\n  1528→\n  1529→/**\n  1530→ * Check if user is logged in\n  1531→ */\n  1532→function isLoggedIn() {\n  1533→    const settings = getSettings();\n  1534→    return !!settings.customerId;\n  1535→}\n  1536→\n  1537→/**\n  1538→ * Logout - clear all auth data\n  1539→ */\n  1540→function logout() {\n  1541→    // Clear all auth-related settings\n  1542→    saveSettings({\n  1543→        customerId: null,\n  1544→        accessToken: null,\n  1545→        refreshToken: null,\n  1546→        tokenExpiry: null,\n  1547→        licenseKey: null\n  1548→    });\n  1549→\n  1550→    if (typeof clearCreditsCache === 'function') {\n  1551→        clearCreditsCache();\n  1552→    }\n  1553→    if (typeof updateCreditDisplay === 'function') {\n  1554→        updateCreditDisplay(null);\n  1555→    }\n  1556→    setStatus('Logged out');\n  1557→}\n  1558→\n  1559→// Initialize JSX bridge when loaded\n  1560→document.addEventListener('DOMContentLoaded', () => {\n  1561→    jsx.init();\n  1562→});\n  1563→\n  1564→// Export for modules\n  1565→window.SPLICE_CONFIG = SPLICE_CONFIG;\n  1566→window.SPLICE_DEBUG = SPLICE_DEBUG;\n  1567→window.debugLog = debugLog;\n  1568→window.debugFetch = debugFetch;\n  1569→window.getBackendUrl = getBackendUrl;\n  1570→window.fetchWithTimeout = fetchWithTimeout;\n  1571→window.parseErrorResponse = parseErrorResponse;\n  1572→window.getAuthHeaders = getAuthHeaders;\n  1573→window.getSettings = getSettings;\n  1574→window.saveSettings = saveSettings;\n  1575→window.clearSetting = clearSetting;\n  1576→window.isOnline = isOnline;\n  1577→window.initOfflineDetection = initOfflineDetection;\n  1578→window.formatTime = formatTime;\n  1579→window.setStatus = setStatus;\n  1580→window.debounce = debounce;\n  1581→window.jsx = jsx;\n  1582→window.PRESETS = PRESETS;\n  1583→window.getPresets = getPresets;\n  1584→window.getPreset = getPreset;\n  1585→window.applyPreset = applyPreset;\n  1586→window.getActivePreset = getActivePreset;\n  1587→window.isBuiltInPreset = isBuiltInPreset;\n  1588→window.initPresetSelector = initPresetSelector;\n  1589→window.initLoginModal = initLoginModal;\n  1590→window.showLoginModal = showLoginModal;\n  1591→window.isLoggedIn = isLoggedIn;\n  1592→window.logout = logout;\n  1593→window.escapeHtml = escapeHtml;\n  1594→window.safeHtml = safeHtml;\n  1595→// JWT Auth functions\n  1596→window.isTokenExpired = isTokenExpired;\n  1597→window.refreshAccessToken = refreshAccessToken;\n  1598→window.clearAuthTokens = clearAuthTokens;\n  1599→window.ensureValidToken = ensureValidToken;\n  1600→\n\n</system-reminder>\n"}]},"uuid":"9e61291d-42c2-4675-a9e8-1e6bdbdcfa79","timestamp":"2026-01-12T09:17:48.494Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/SPLICE/splice-cep/panel/js/config.js","content":"/**\n * SPLICE CEP Panel Configuration\n * Backend URLs, paths, and utility functions\n */\n\n// ============================================================================\n// DEBUG MODE CONFIGURATION\n// ============================================================================\n\n/**\n * Debug mode flag - enables verbose diagnostic logging\n * Can be enabled via localStorage for troubleshooting:\n *   localStorage.setItem('spliceDebugMode', 'true');\n *\n * Default: false (production mode - minimal logging)\n */\nconst SPLICE_DEBUG = localStorage.getItem('spliceDebugMode') === 'true';\n\n/**\n * Debug logging function - only outputs when debug mode is enabled\n * Use this for diagnostic/development logging that should be silent in production\n * @param {...any} args - Arguments to log (prefixed with [SPLICE DEBUG])\n */\nfunction debugLog(...args) {\n    if (SPLICE_DEBUG) {\n        console.log('[SPLICE DEBUG]', ...args);\n    }\n}\n\n/**\n * Debug fetch logging - verbose fetch request/response logging\n * @param {...any} args - Arguments to log (prefixed with [SPLICE FETCH])\n */\nfunction debugFetch(...args) {\n    if (SPLICE_DEBUG) {\n        console.log('[SPLICE FETCH]', ...args);\n    }\n}\n\n// ============================================================================\n// BACKEND CONFIGURATION\n// ============================================================================\nconst SPLICE_CONFIG = {\n    VERSION: '6.0.3',\n    BACKEND_PROD: 'https://splice-api-production.up.railway.app',\n    BACKEND_DEV: 'https://127.0.0.1:3847',\n    FETCH_TIMEOUT: 120000, // 2 minutes\n    RETRY_ATTEMPTS: 3,\n    RETRY_DELAY: 1000\n};\n\n/**\n * Get the backend URL based on environment\n * FIXED: CEP panels always run from file://, so we default to PROD\n * Use localStorage to override for local development if needed\n */\nfunction getBackendUrl() {\n    // Priority 1: Allow override via localStorage (for local dev testing)\n    const customUrl = localStorage.getItem('spliceBackendUrl');\n    if (customUrl) {\n        debugLog('Using custom backend URL from localStorage:', customUrl);\n        return customUrl;\n    }\n\n    // Priority 2: Default to production backend\n    // (CEP panels always run from file://, so can't reliably detect dev mode)\n    debugLog('Using production backend URL:', SPLICE_CONFIG.BACKEND_PROD);\n    return SPLICE_CONFIG.BACKEND_PROD;\n}\n\n// ============================================================================\n// JSX BRIDGE - Communicate with Premiere Pro\n// ============================================================================\nconst jsx = {\n    cs: null,\n    _initPromise: null,\n    _initialized: false,\n\n    /**\n     * Initialize the CSInterface\n     * Returns a promise that resolves when ready (true/false)\n     * Does NOT reject - gracefully handles missing CEP environment\n     */\n    init: function() {\n        if (this._initPromise) return this._initPromise;\n\n        this._initPromise = new Promise((resolve) => {\n            try {\n                if (typeof CSInterface !== 'undefined') {\n                    this.cs = new CSInterface();\n                    // Verify we're in a real CEP environment by checking for __adobe_cep__\n                    if (window.__adobe_cep__) {\n                        this._initialized = true;\n                        debugLog('[JSX] CSInterface initialized successfully (CEP environment detected)');\n                    } else {\n                        // CSInterface exists but no CEP runtime - browser/dev mode\n                        this._initialized = true;\n                        debugLog('[JSX] CSInterface initialized (development/browser mode)');\n                    }\n                } else {\n                    console.warn('[JSX] CSInterface not available - panel may not function correctly');\n                    this._initialized = false;\n                }\n            } catch (err) {\n                console.error('[JSX] Failed to initialize CSInterface:', err);\n                this._initialized = false;\n            }\n            resolve(this._initialized);\n        });\n\n        return this._initPromise;\n    },\n\n    /**\n     * Ensure JSX is initialized before making calls\n     */\n    ensureInitialized: async function() {\n        if (!this._initialized) {\n            await this.init();\n        }\n        if (!this.cs) {\n            throw new Error('CSInterface not initialized. Make sure you are running in CEP environment.');\n        }\n    },\n\n    /**\n     * Execute ExtendScript in Premiere Pro\n     * @param {string} script - ExtendScript to execute\n     * @returns {Promise<any>} - Parsed result\n     */\n    evalScript: async function(script) {\n        await this.ensureInitialized();\n\n        return new Promise((resolve, reject) => {\n            this.cs.evalScript(script, (result) => {\n                if (result === 'undefined' || result === undefined) {\n                    resolve(null);\n                    return;\n                }\n\n                // Check for EvalScript error or ExtendScript runtime errors\n                if (typeof result === 'string' && (\n                    result.indexOf('EvalScript error') !== -1 ||\n                    result.indexOf('Error:') !== -1 ||\n                    result.indexOf('TypeError:') !== -1 ||\n                    result.indexOf('ReferenceError:') !== -1\n                )) {\n                    reject(new Error(result));\n                    return;\n                }\n\n                // Try to parse JSON\n                try {\n                    const parsed = JSON.parse(result);\n                    if (parsed.error) {\n                        reject(new Error(parsed.error));\n                    } else {\n                        resolve(parsed);\n                    }\n                } catch (e) {\n                    // Return as-is if not JSON\n                    resolve(result);\n                }\n            });\n        });\n    },\n\n    /**\n     * Call a JSX function with arguments\n     * @param {string} funcName - Function name\n     * @param {...any} args - Arguments to pass\n     * @returns {Promise<any>}\n     */\n    call: async function(funcName, ...args) {\n        await this.ensureInitialized();\n\n        const escapedArgs = args.map(arg => {\n            if (arg === null || arg === undefined) return 'null';\n            if (typeof arg === 'string') {\n                // Escape backslashes first, then other special chars\n                return `'${arg\n                    .replace(/\\\\/g, '\\\\\\\\')\n                    .replace(/'/g, \"\\\\'\")\n                    .replace(/\\r/g, '\\\\r')\n                    .replace(/\\n/g, '\\\\n')\n                    .replace(/\\t/g, '\\\\t')}'`;\n            }\n            if (typeof arg === 'object') {\n                return `'${JSON.stringify(arg)\n                    .replace(/\\\\/g, '\\\\\\\\')\n                    .replace(/'/g, \"\\\\'\")}'`;\n            }\n            return String(arg);\n        });\n\n        const script = `${funcName}(${escapedArgs.join(', ')})`;\n        return this.evalScript(script);\n    }\n};\n\n// ============================================================================\n// FETCH UTILITIES\n// ============================================================================\n\n/**\n * Fetch with timeout support\n * @param {string} url - URL to fetch\n * @param {object} options - Fetch options\n * @param {number} timeout - Timeout in ms\n */\nasync function fetchWithTimeout(url, options = {}, timeout = SPLICE_CONFIG.FETCH_TIMEOUT) {\n    // DIAGNOSTIC: Log fetch request details (debug mode only)\n    debugFetch('=== FETCH REQUEST START ===');\n    debugFetch('URL:', url);\n    debugFetch('Method:', options?.method || 'GET');\n    debugFetch('Headers:', options?.headers);\n    debugFetch('Timeout:', timeout);\n    debugFetch('Is CEP environment:', typeof CSInterface !== 'undefined');\n    debugFetch('=================================');\n\n    const controller = new AbortController();\n    const timeoutId = setTimeout(() => controller.abort(), timeout);\n\n    try {\n        const response = await fetch(url, {\n            ...options,\n            signal: controller.signal\n        });\n        clearTimeout(timeoutId);\n\n        // DIAGNOSTIC: Log successful response (debug mode only)\n        debugFetch('=== FETCH RESPONSE SUCCESS ===');\n        debugFetch('Status:', response.status);\n        debugFetch('OK:', response.ok);\n        debugFetch('=================================');\n\n        return response;\n    } catch (error) {\n        clearTimeout(timeoutId);\n\n        // DIAGNOSTIC: Log raw fetch error (debug mode only)\n        debugFetch('=== FETCH ERROR CAUGHT ===');\n        debugFetch('Error name:', error?.name);\n        debugFetch('Error message:', error?.message);\n        debugFetch('Error type:', typeof error);\n        debugFetch('Error constructor:', error?.constructor?.name);\n        debugFetch('Is AbortError:', error.name === 'AbortError');\n        debugFetch('Is TypeError:', error.name === 'TypeError');\n        debugFetch('Full error object:', JSON.stringify(error, Object.getOwnPropertyNames(error)));\n        debugFetch('=================================');\n\n        if (error.name === 'AbortError') {\n            throw new Error(`Request timeout after ${timeout}ms`);\n        }\n        throw error;\n    }\n}\n\n/**\n * Parse error response from backend\n * @param {Response} response - Fetch response\n */\nasync function parseErrorResponse(response) {\n    try {\n        const data = await response.json();\n        return data.error || data.message || `HTTP ${response.status}`;\n    } catch {\n        return `HTTP ${response.status}: ${response.statusText}`;\n    }\n}\n\n/**\n * Get auth headers for API requests\n * Uses JWT Bearer token if available, with legacy fallback\n */\nfunction getAuthHeaders() {\n    const headers = { 'Content-Type': 'application/json' };\n    const settings = getSettings();\n\n    // Prefer JWT Bearer token (modern auth)\n    if (settings.accessToken) {\n        headers['Authorization'] = `Bearer ${settings.accessToken}`;\n        return headers;\n    }\n\n    // Legacy fallback for backwards compatibility\n    // This will be removed after 2026-04-11\n    if (settings.customerId) {\n        headers['x-stripe-customer-id'] = settings.customerId;\n        console.warn('[SPLICE] Using deprecated x-stripe-customer-id header. Please re-login to upgrade to JWT auth.');\n    }\n\n    return headers;\n}\n\n/**\n * Check if the access token is expired or about to expire\n * @returns {boolean} True if token needs refresh\n */\nfunction isTokenExpired() {\n    const settings = getSettings();\n    if (!settings.tokenExpiry) return true;\n\n    // Refresh if less than 5 minutes remaining\n    const bufferMs = 5 * 60 * 1000;\n    return Date.now() >= (settings.tokenExpiry - bufferMs);\n}\n\n/**\n * Refresh the access token using the refresh token\n * @returns {Promise<boolean>} True if refresh succeeded\n */\nasync function refreshAccessToken() {\n    const settings = getSettings();\n\n    if (!settings.refreshToken) {\n        debugLog('[Auth] No refresh token available');\n        return false;\n    }\n\n    try {\n        debugLog('[Auth] Refreshing access token...');\n\n        const response = await fetchWithTimeout(`${getBackendUrl()}/auth/refresh`, {\n            method: 'POST',\n            headers: { 'Content-Type': 'application/json' },\n            body: JSON.stringify({ refreshToken: settings.refreshToken })\n        }, 30000);\n\n        if (!response.ok) {\n            const errorMsg = await parseErrorResponse(response);\n            console.error('[Auth] Token refresh failed:', errorMsg);\n\n            // If refresh token is invalid, clear auth and require re-login\n            if (response.status === 401) {\n                clearAuthTokens();\n            }\n            return false;\n        }\n\n        const data = await response.json();\n\n        // Save new access token\n        const expiresInMs = (data.expiresIn || 86400) * 1000; // Default 24h\n        saveSettings({\n            accessToken: data.token,\n            tokenExpiry: Date.now() + expiresInMs\n        });\n\n        debugLog('[Auth] Access token refreshed successfully');\n        return true;\n    } catch (err) {\n        console.error('[Auth] Token refresh error:', err);\n        return false;\n    }\n}\n\n/**\n * Clear all auth tokens (call on logout or auth failure)\n */\nfunction clearAuthTokens() {\n    saveSettings({\n        accessToken: null,\n        refreshToken: null,\n        tokenExpiry: null\n    });\n    debugLog('[Auth] Auth tokens cleared');\n}\n\n/**\n * Ensure we have a valid access token, refreshing if needed\n * @returns {Promise<boolean>} True if we have a valid token\n */\nasync function ensureValidToken() {\n    const settings = getSettings();\n\n    // No token at all - need to login\n    if (!settings.accessToken) {\n        return false;\n    }\n\n    // Token not expired - good to go\n    if (!isTokenExpired()) {\n        return true;\n    }\n\n    // Try to refresh\n    return await refreshAccessToken();\n}\n\n// ============================================================================\n// SETTINGS MANAGEMENT\n// ============================================================================\n\nconst DEFAULT_SETTINGS = {\n    sensitivity: 50,\n    minSilenceLength: 0.5,\n    sourceIsolated: false,\n    enableTakesDetection: true,\n    enableJCut: false,\n    jcutLeadIn: 0.3,\n    jcutLeadOut: 0.2,\n    enableZoom: false,\n    zoomFrequency: 'medium',\n    zoomPreset: 'medium',\n    zoomPlacement: 'sentence_start',\n    enableChapters: false,\n    maxChapters: 10,\n    minChapterLength: 60,\n    enableProfanity: false,\n    profanityLanguage: 'en',\n    bleepType: 'standard',\n    // Authentication\n    customerId: null,\n    licenseKey: null,\n    accessToken: null,\n    refreshToken: null,\n    tokenExpiry: null,\n    // UI State\n    expandedOptions: false,\n    activePreset: 'podcast',\n    rememberOptions: false\n};\n\n// Current storage version for future migrations\nconst SETTINGS_STORAGE_VERSION = 2;\n\n// Fields that contain sensitive data and should be encrypted\nconst SENSITIVE_FIELDS = ['customerId', 'licenseKey', 'accessToken', 'refreshToken'];\n\n// ============================================================================\n// ENCRYPTION HELPERS FOR SENSITIVE DATA (CEP-CRIT-002 FIX)\n// Uses AES-GCM encryption via Web Crypto API for proper security\n// ============================================================================\n\n// Encryption constants\nconst SPLICE_ENCRYPTION = {\n    ALGORITHM: 'AES-GCM',\n    KEY_LENGTH: 256,\n    IV_LENGTH: 12,\n    TAG_LENGTH: 128,\n    SALT: 'SPLICE_PANEL_SALT_v1', // Static salt for key derivation\n    ITERATIONS: 100000,\n    PREFIX: 'ENC:v1:'  // Prefix to identify encrypted values\n};\n\n// Cached encryption key (derived once per session)\nlet _encryptionKey = null;\n\n/**\n * Get or derive the encryption key from a machine-specific identifier\n * Uses PBKDF2 to derive a strong key from available identifiers\n * @returns {Promise<CryptoKey>} The derived encryption key\n */\nasync function getEncryptionKey() {\n    if (_encryptionKey) {\n        return _encryptionKey;\n    }\n\n    try {\n        // Use a combination of identifiers for key derivation\n        // In CEP, we use localStorage ID + app version as the key material\n        let keyMaterial = localStorage.getItem('splice_device_id');\n        if (!keyMaterial) {\n            // Generate a random device ID on first use\n            keyMaterial = crypto.randomUUID ? crypto.randomUUID() :\n                'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {\n                    const r = Math.random() * 16 | 0;\n                    const v = c === 'x' ? r : (r & 0x3 | 0x8);\n                    return v.toString(16);\n                });\n            localStorage.setItem('splice_device_id', keyMaterial);\n        }\n\n        const encoder = new TextEncoder();\n        const keyData = encoder.encode(keyMaterial + SPLICE_ENCRYPTION.SALT);\n\n        // Import the key material for PBKDF2\n        const baseKey = await crypto.subtle.importKey(\n            'raw',\n            keyData,\n            'PBKDF2',\n            false,\n            ['deriveKey']\n        );\n\n        // Derive the actual AES key\n        _encryptionKey = await crypto.subtle.deriveKey(\n            {\n                name: 'PBKDF2',\n                salt: encoder.encode(SPLICE_ENCRYPTION.SALT),\n                iterations: SPLICE_ENCRYPTION.ITERATIONS,\n                hash: 'SHA-256'\n            },\n            baseKey,\n            {\n                name: SPLICE_ENCRYPTION.ALGORITHM,\n                length: SPLICE_ENCRYPTION.KEY_LENGTH\n            },\n            false,\n            ['encrypt', 'decrypt']\n        );\n\n        return _encryptionKey;\n    } catch (e) {\n        debugLog('[Config] Key derivation error:', e);\n        return null;\n    }\n}\n\n/**\n * Encrypt data for secure localStorage storage using AES-GCM\n *\n * @param {any} data - Data to encrypt\n * @returns {Promise<string|null>} Encrypted string with prefix or null on error\n */\nasync function encryptForStorageAsync(data) {\n    try {\n        if (data === null || data === undefined) {\n            return null;\n        }\n\n        const key = await getEncryptionKey();\n        if (!key) {\n            // Fallback to legacy encoding if crypto not available\n            debugLog('[Config] Crypto not available, using legacy encoding');\n            return legacyEncode(data);\n        }\n\n        const encoder = new TextEncoder();\n        const jsonStr = JSON.stringify(data);\n        const plaintext = encoder.encode(jsonStr);\n\n        // Generate random IV\n        const iv = crypto.getRandomValues(new Uint8Array(SPLICE_ENCRYPTION.IV_LENGTH));\n\n        // Encrypt\n        const ciphertext = await crypto.subtle.encrypt(\n            {\n                name: SPLICE_ENCRYPTION.ALGORITHM,\n                iv: iv,\n                tagLength: SPLICE_ENCRYPTION.TAG_LENGTH\n            },\n            key,\n            plaintext\n        );\n\n        // Combine IV + ciphertext and encode as base64\n        const combined = new Uint8Array(iv.length + ciphertext.byteLength);\n        combined.set(iv);\n        combined.set(new Uint8Array(ciphertext), iv.length);\n\n        // Convert to base64 with prefix\n        const base64 = btoa(String.fromCharCode(...combined));\n        return SPLICE_ENCRYPTION.PREFIX + base64;\n    } catch (e) {\n        debugLog('[Config] Encryption error:', e);\n        return legacyEncode(data);\n    }\n}\n\n/**\n * Decrypt data from localStorage using AES-GCM\n *\n * @param {string} data - Encrypted string\n * @returns {Promise<any|null>} Decrypted data or null on error\n */\nasync function decryptFromStorageAsync(data) {\n    try {\n        if (!data || typeof data !== 'string') {\n            return null;\n        }\n\n        // Check if this is the new encrypted format\n        if (!data.startsWith(SPLICE_ENCRYPTION.PREFIX)) {\n            // Try legacy decoding for backward compatibility\n            return legacyDecode(data);\n        }\n\n        const key = await getEncryptionKey();\n        if (!key) {\n            debugLog('[Config] Crypto not available for decryption');\n            return null;\n        }\n\n        // Remove prefix and decode base64\n        const base64Data = data.slice(SPLICE_ENCRYPTION.PREFIX.length);\n        const combined = Uint8Array.from(atob(base64Data), c => c.charCodeAt(0));\n\n        // Extract IV and ciphertext\n        const iv = combined.slice(0, SPLICE_ENCRYPTION.IV_LENGTH);\n        const ciphertext = combined.slice(SPLICE_ENCRYPTION.IV_LENGTH);\n\n        // Decrypt\n        const plaintext = await crypto.subtle.decrypt(\n            {\n                name: SPLICE_ENCRYPTION.ALGORITHM,\n                iv: iv,\n                tagLength: SPLICE_ENCRYPTION.TAG_LENGTH\n            },\n            key,\n            ciphertext\n        );\n\n        const decoder = new TextDecoder();\n        const jsonStr = decoder.decode(plaintext);\n        return JSON.parse(jsonStr);\n    } catch (e) {\n        // Try legacy decoding as fallback\n        return legacyDecode(data);\n    }\n}\n\n/**\n * Legacy encoding (Base64) for backward compatibility\n * @param {any} data - Data to encode\n * @returns {string|null} Encoded string\n */\nfunction legacyEncode(data) {\n    try {\n        if (data === null || data === undefined) {\n            return null;\n        }\n        const jsonStr = JSON.stringify(data);\n        const encoded = encodeURIComponent(jsonStr);\n        return btoa(encoded);\n    } catch (e) {\n        return null;\n    }\n}\n\n/**\n * Legacy decoding (Base64) for backward compatibility\n * @param {string} data - Encoded string\n * @returns {any|null} Decoded data\n */\nfunction legacyDecode(data) {\n    try {\n        if (!data || typeof data !== 'string') {\n            return null;\n        }\n        // Skip if it has the encryption prefix\n        if (data.startsWith(SPLICE_ENCRYPTION.PREFIX)) {\n            return null;\n        }\n        const decoded = atob(data);\n        const jsonStr = decodeURIComponent(decoded);\n        return JSON.parse(jsonStr);\n    } catch (e) {\n        return null;\n    }\n}\n\n/**\n * Synchronous wrapper for encryption (starts async operation)\n * For backward compatibility with existing sync code\n * @param {any} data - Data to encode\n * @returns {string|null} Encoded string (legacy format until async completes)\n */\nfunction encryptForStorage(data) {\n    // Return legacy encoding synchronously\n    // The async version should be preferred for new code\n    return legacyEncode(data);\n}\n\n/**\n * Synchronous wrapper for decryption\n * For backward compatibility with existing sync code\n * @param {string} data - Encoded string\n * @returns {any|null} Decoded data\n */\nfunction decryptFromStorage(data) {\n    // Handle new encrypted format by returning null (needs async)\n    if (data && data.startsWith(SPLICE_ENCRYPTION.PREFIX)) {\n        debugLog('[Config] Encrypted data requires async decryption');\n        return null;\n    }\n    return legacyDecode(data);\n}\n\n/**\n * Check if a value appears to be encrypted\n *\n * @param {any} value - Value to check\n * @returns {boolean} True if value appears to be encrypted\n */\nfunction isEncryptedValue(value) {\n    if (!value || typeof value !== 'string') {\n        return false;\n    }\n    // New encryption format\n    if (value.startsWith(SPLICE_ENCRYPTION.PREFIX)) {\n        return true;\n    }\n    // Unencrypted values typically start with known patterns\n    if (value.startsWith('cus_') || value.startsWith('SPLICE-')) {\n        return false;\n    }\n    // Check if it's legacy base64 encoded JSON\n    try {\n        const decoded = atob(value);\n        const jsonStr = decodeURIComponent(decoded);\n        JSON.parse(jsonStr);\n        return true;\n    } catch {\n        return false;\n    }\n}\n\n/**\n * Encrypt sensitive fields in settings object\n *\n * @param {Object} settings - Settings object with plaintext sensitive fields\n * @returns {Object} Settings with encrypted sensitive fields\n */\nfunction encryptSensitiveFields(settings) {\n    const encrypted = { ...settings };\n\n    for (const field of SENSITIVE_FIELDS) {\n        if (encrypted[field] !== null && encrypted[field] !== undefined) {\n            // Only encrypt if not already encrypted\n            if (!isEncryptedValue(encrypted[field])) {\n                encrypted[field] = encryptForStorage(encrypted[field]);\n                debugLog(`[Config] Encrypted field: ${field}`);\n            }\n        }\n    }\n\n    return encrypted;\n}\n\n/**\n * Decrypt sensitive fields in settings object\n *\n * @param {Object} settings - Settings object with encrypted sensitive fields\n * @returns {Object} Settings with decrypted sensitive fields\n */\nfunction decryptSensitiveFields(settings) {\n    const decrypted = { ...settings };\n\n    for (const field of SENSITIVE_FIELDS) {\n        if (decrypted[field] !== null && decrypted[field] !== undefined) {\n            // Check if it looks encrypted before attempting to decrypt\n            if (isEncryptedValue(decrypted[field])) {\n                const decryptedValue = decryptFromStorage(decrypted[field]);\n                if (decryptedValue !== null) {\n                    decrypted[field] = decryptedValue;\n                    debugLog(`[Config] Decrypted field: ${field}`);\n                }\n            }\n            // If not encrypted (legacy data), keep the original value\n        }\n    }\n\n    return decrypted;\n}\n\n/**\n * Internal save function to avoid recursion during migration\n * @private\n */\nfunction _saveSettingsInternal(settings) {\n    try {\n        // Encrypt sensitive fields before storing\n        const toStore = encryptSensitiveFields(settings);\n\n        // Add version marker for future migrations\n        toStore._storageVersion = SETTINGS_STORAGE_VERSION;\n\n        localStorage.setItem('spliceSettings', JSON.stringify(toStore));\n        return true;\n    } catch (e) {\n        console.warn('[Config] Error saving settings:', e);\n        return false;\n    }\n}\n\n/**\n * Get settings from localStorage\n * Handles migration from unencrypted to encrypted storage format\n */\nfunction getSettings() {\n    try {\n        const stored = localStorage.getItem('spliceSettings');\n        if (stored) {\n            const parsed = JSON.parse(stored);\n\n            // Decrypt sensitive fields (handles both encrypted and legacy unencrypted data)\n            const decrypted = decryptSensitiveFields(parsed);\n\n            // Check if migration is needed (no version marker = legacy data)\n            if (!parsed._storageVersion) {\n                // Migrate legacy data: save with encryption and version marker\n                debugLog('[Config] Migrating legacy settings to encrypted format');\n                const migratedSettings = { ...DEFAULT_SETTINGS, ...decrypted };\n                // Use internal save to avoid infinite recursion\n                _saveSettingsInternal(migratedSettings);\n            }\n\n            // Return merged settings without internal fields\n            const result = { ...DEFAULT_SETTINGS, ...decrypted };\n            delete result._storageVersion;\n            return result;\n        }\n    } catch (e) {\n        console.warn('[Config] Error loading settings:', e);\n    }\n    return { ...DEFAULT_SETTINGS };\n}\n\n/**\n * Save settings to localStorage\n * Encrypts sensitive fields before storing\n */\nfunction saveSettings(settings) {\n    try {\n        // Get current settings (decrypted) and merge with new settings\n        const current = getSettings();\n        const merged = { ...current, ...settings };\n\n        return _saveSettingsInternal(merged);\n    } catch (e) {\n        console.warn('[Config] Error saving settings:', e);\n        return false;\n    }\n}\n\n/**\n * Clear specific setting\n */\nfunction clearSetting(key) {\n    const settings = getSettings();\n    delete settings[key];\n    _saveSettingsInternal(settings);\n}\n\n// ============================================================================\n// OFFLINE DETECTION\n// ============================================================================\n\nlet isOnlineState = true;\nlet offlineCheckInterval = null;\n\n/**\n * Check if online\n */\nfunction isOnline() {\n    return isOnlineState && navigator.onLine;\n}\n\n/**\n * Initialize offline detection\n */\nfunction initOfflineDetection() {\n    // Browser events\n    window.addEventListener('online', () => {\n        isOnlineState = true;\n        updateOfflineUI(true);\n    });\n\n    window.addEventListener('offline', () => {\n        isOnlineState = false;\n        updateOfflineUI(false);\n    });\n\n    // Periodic check\n    offlineCheckInterval = setInterval(async () => {\n        try {\n            const response = await fetchWithTimeout(\n                `${getBackendUrl()}/health`,\n                { method: 'GET' },\n                5000\n            );\n            isOnlineState = response.ok;\n        } catch {\n            isOnlineState = false;\n        }\n        updateOfflineUI(isOnlineState);\n    }, 30000);\n}\n\n/**\n * Update UI based on online state\n */\nfunction updateOfflineUI(online) {\n    const goBtn = document.getElementById('goBtn');\n    const status = document.getElementById('status');\n\n    if (goBtn) {\n        goBtn.disabled = !online;\n    }\n\n    if (status) {\n        if (!online) {\n            status.textContent = 'Offline - Check your connection';\n            status.style.color = '#dc3545';\n        } else {\n            // Reset status when back online\n            status.textContent = 'Ready';\n            status.style.color = '#888';\n        }\n    }\n}\n\n// ============================================================================\n// UTILITY FUNCTIONS\n// ============================================================================\n\n/**\n * SECURITY: Escape HTML to prevent XSS attacks\n * Use this when inserting untrusted content into innerHTML\n * @param {string} str - String to escape\n * @returns {string} Escaped string safe for innerHTML\n */\nfunction escapeHtml(str) {\n    if (str === null || str === undefined) return '';\n    if (typeof str !== 'string') str = String(str);\n\n    const escapeMap = {\n        '&': '&amp;',\n        '<': '&lt;',\n        '>': '&gt;',\n        '\"': '&quot;',\n        \"'\": '&#x27;',\n        '/': '&#x2F;',\n        '`': '&#x60;'\n    };\n\n    return str.replace(/[&<>\"'\\/`]/g, char => escapeMap[char]);\n}\n\n/**\n * SECURITY: Create safe HTML from template with escaped values\n * @param {TemplateStringsArray} strings - Template strings\n * @param {...any} values - Values to escape\n * @returns {string} HTML with escaped values\n */\nfunction safeHtml(strings, ...values) {\n    return strings.reduce((result, str, i) => {\n        const value = values[i - 1];\n        const escaped = escapeHtml(value);\n        return result + escaped + str;\n    });\n}\n\n/**\n * Format time in MM:SS or HH:MM:SS\n */\nfunction formatTime(seconds) {\n    if (isNaN(seconds) || seconds < 0) return '0:00';\n\n    const hours = Math.floor(seconds / 3600);\n    const minutes = Math.floor((seconds % 3600) / 60);\n    const secs = Math.floor(seconds % 60);\n\n    if (hours > 0) {\n        return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;\n    }\n    return `${minutes}:${secs.toString().padStart(2, '0')}`;\n}\n\n/**\n * Set status message\n */\nfunction setStatus(message, isError = false) {\n    const status = document.getElementById('status');\n    if (status) {\n        status.textContent = message;\n        status.style.color = isError ? '#dc3545' : '#888';\n    }\n}\n\n/**\n * Debounce function calls\n */\nfunction debounce(func, wait) {\n    let timeout;\n    return function executedFunction(...args) {\n        const later = () => {\n            clearTimeout(timeout);\n            func(...args);\n        };\n        clearTimeout(timeout);\n        timeout = setTimeout(later, wait);\n    };\n}\n\n// ============================================================================\n// PRESET PROFILES\n// ============================================================================\n\n/**\n * Detection presets for different content types.\n * Each preset defines optimal settings for a specific use case.\n */\nconst PRESETS = {\n    // Custom - user-defined settings (default)\n    custom: {\n        name: 'Custom',\n        description: 'Your custom settings',\n        icon: 'settings',\n        settings: null // Uses current user settings\n    },\n\n    // Podcast - longer pauses are natural, be conservative\n    podcast: {\n        name: 'Podcast',\n        description: 'Longer natural pauses, J-Cuts enabled',\n        icon: 'mic',\n        settings: {\n            sensitivity: 35,\n            threshold: -35,\n            minSilenceLength: 0.8,\n            paddingStart: 0.15,\n            paddingEnd: 0.15,\n            enableTakesDetection: true,\n            enableJCut: true,\n            jCutLeadIn: 0.3,\n            jCutLeadOut: 0.2\n        }\n    },\n\n    // Interview - balanced, respects speaker pauses\n    interview: {\n        name: 'Interview',\n        description: 'Balanced cuts, J-Cuts for smooth transitions',\n        icon: 'people',\n        settings: {\n            sensitivity: 50,\n            threshold: -32,\n            minSilenceLength: 0.5,\n            paddingStart: 0.12,\n            paddingEnd: 0.08,\n            enableTakesDetection: true,\n            enableJCut: true,\n            jCutLeadIn: 0.25,\n            jCutLeadOut: 0.15\n        }\n    },\n\n    // Reaction video - fast pacing, quick cuts\n    reaction: {\n        name: 'Reaction',\n        description: 'Fast-paced, tight cuts for energy',\n        icon: 'bolt',\n        settings: {\n            sensitivity: 70,\n            threshold: -28,\n            minSilenceLength: 0.3,\n            paddingStart: 0.05,\n            paddingEnd: 0.03,\n            enableTakesDetection: false,\n            enableJCut: false,\n            jCutLeadIn: 0,\n            jCutLeadOut: 0\n        }\n    },\n\n    // Tutorial/Educational - preserve thinking pauses\n    tutorial: {\n        name: 'Tutorial',\n        description: 'Preserves teaching pace, J-Cuts enabled',\n        icon: 'school',\n        settings: {\n            sensitivity: 30,\n            threshold: -38,\n            minSilenceLength: 1.0,\n            paddingStart: 0.2,\n            paddingEnd: 0.15,\n            enableTakesDetection: true,\n            enableJCut: true,\n            jCutLeadIn: 0.35,\n            jCutLeadOut: 0.25\n        }\n    },\n\n    // Vlog/YouTube - punchy edits, engagement-focused\n    vlog: {\n        name: 'Vlog',\n        description: 'Punchy edits for YouTube engagement',\n        icon: 'videocam',\n        settings: {\n            sensitivity: 65,\n            threshold: -30,\n            minSilenceLength: 0.35,\n            paddingStart: 0.08,\n            paddingEnd: 0.05,\n            enableTakesDetection: true,\n            enableJCut: false,\n            jCutLeadIn: 0,\n            jCutLeadOut: 0\n        }\n    }\n};\n\n/**\n * List of built-in preset IDs\n */\nconst BUILT_IN_PRESET_IDS = ['custom', 'podcast', 'interview', 'reaction', 'tutorial', 'vlog'];\n\n/**\n * Get all available presets\n * @returns {Object} All preset definitions\n */\nfunction getPresets() {\n    return { ...PRESETS };\n}\n\n/**\n * Get a specific preset by name\n * @param {string} presetName - Name of the preset\n * @returns {Object|null} Preset definition or null if not found\n */\nfunction getPreset(presetName) {\n    return PRESETS[presetName] || null;\n}\n\n/**\n * Check if a preset is a built-in preset\n * @param {string} id - Preset ID to check\n * @returns {boolean} True if built-in, false if custom\n */\nfunction isBuiltInPreset(id) {\n    return BUILT_IN_PRESET_IDS.includes(id);\n}\n\n/**\n * Apply a preset to current settings\n * @param {string} presetName - Name of the preset to apply\n * @returns {Object} The applied settings\n */\nfunction applyPreset(presetName) {\n    const preset = PRESETS[presetName];\n\n    if (!preset) {\n        console.warn(`[SPLICE] Unknown preset: ${presetName}`);\n        return getSettings();\n    }\n\n    // Custom preset uses current settings\n    if (presetName === 'custom' || !preset.settings) {\n        saveSettings({ activePreset: 'custom' });\n        return getSettings();\n    }\n\n    // Apply preset settings\n    const newSettings = {\n        ...preset.settings,\n        activePreset: presetName\n    };\n\n    saveSettings(newSettings);\n    debugLog(`Applied preset: ${preset.name}`);\n\n    return getSettings();\n}\n\n/**\n * Get the currently active preset\n * @returns {string} Active preset name\n */\nfunction getActivePreset() {\n    const settings = getSettings();\n    return settings.activePreset || 'custom';\n}\n\n/**\n * Initialize preset selector\n */\nfunction initPresetSelector() {\n    const presetSelector = document.getElementById('presetSelector');\n    const sensitivitySlider = document.getElementById('sensitivitySlider');\n\n    if (!presetSelector) return;\n\n    // Set initial value from settings\n    const settings = getSettings();\n    presetSelector.value = settings.activePreset || 'podcast';\n\n    // Handle preset change\n    presetSelector.addEventListener('change', () => {\n        const presetId = presetSelector.value;\n        const appliedSettings = applyPreset(presetId);\n\n        // Update sensitivity slider to match preset\n        if (sensitivitySlider && appliedSettings.sensitivity !== undefined) {\n            sensitivitySlider.value = appliedSettings.sensitivity;\n            // Update display value\n            const sensitivityValue = document.getElementById('sensitivityValue');\n            if (sensitivityValue) {\n                sensitivityValue.textContent = appliedSettings.sensitivity;\n            }\n        }\n\n        // Update takes detection checkbox\n        const enableTakesDetection = document.getElementById('enableTakesDetection');\n        if (enableTakesDetection && appliedSettings.enableTakesDetection !== undefined) {\n            enableTakesDetection.checked = appliedSettings.enableTakesDetection;\n        }\n\n        // Update J-Cut checkbox\n        const enableJCut = document.getElementById('enableJCut');\n        if (enableJCut && appliedSettings.enableJCut !== undefined) {\n            enableJCut.checked = appliedSettings.enableJCut;\n            // Toggle J-Cut settings visibility\n            const jcutSettings = document.getElementById('jcutSettings');\n            if (jcutSettings) {\n                jcutSettings.classList.toggle('collapsed', !appliedSettings.enableJCut);\n            }\n        }\n\n        const preset = getPreset(presetId);\n        if (preset) {\n            setStatus(`Preset: ${preset.name} - ${preset.description}`);\n        }\n    });\n\n    // Switch to custom when user manually changes sensitivity\n    if (sensitivitySlider) {\n        sensitivitySlider.addEventListener('change', () => {\n            if (presetSelector.value !== 'custom') {\n                presetSelector.value = 'custom';\n                saveSettings({ activePreset: 'custom' });\n            }\n        });\n    }\n}\n\n// ============================================================================\n// LOGIN MODAL\n// ============================================================================\n\n/**\n * Validate license key format: SPLICE-XXXX-XXXX-XXXX\n * Character set excludes confusing chars: 0/O, 1/I/L\n */\nfunction isValidLicenseKeyFormat(key) {\n    if (!key || typeof key !== 'string') return false;\n    const normalized = key.toUpperCase().trim();\n    const pattern = /^SPLICE-[ABCDEFGHJKMNPQRSTUVWXYZ23456789]{4}-[ABCDEFGHJKMNPQRSTUVWXYZ23456789]{4}-[ABCDEFGHJKMNPQRSTUVWXYZ23456789]{4}$/;\n    return pattern.test(normalized);\n}\n\n/**\n * Initialize login modal handlers\n */\nfunction initLoginModal() {\n    const loginModal = document.getElementById('loginModal');\n    const closeLoginBtn = document.getElementById('closeLoginBtn');\n    const saveLoginBtn = document.getElementById('saveLoginBtn');\n    const licenseKeyInput = document.getElementById('licenseKeyInput');\n    const creditBadge = document.getElementById('creditBadge');\n\n    // Handle credit badge click - retry on error, or show login modal\n    if (creditBadge) {\n        creditBadge.addEventListener('click', async () => {\n            if (creditBadge.classList.contains('error')) {\n                creditBadge.textContent = '...';\n                if (typeof refreshCredits === 'function') {\n                    await refreshCredits();\n                }\n                return;\n            }\n            showLoginModal();\n        });\n    }\n\n    // Close login modal\n    if (closeLoginBtn && loginModal) {\n        closeLoginBtn.addEventListener('click', () => {\n            loginModal.classList.add('hidden');\n        });\n    }\n\n    // Close on backdrop click\n    if (loginModal) {\n        loginModal.addEventListener('click', (e) => {\n            if (e.target === loginModal) {\n                loginModal.classList.add('hidden');\n            }\n        });\n    }\n\n    // Activate license key\n    if (saveLoginBtn) {\n        saveLoginBtn.addEventListener('click', async () => {\n            const licenseKey = licenseKeyInput?.value?.trim()?.toUpperCase();\n\n            if (!licenseKey) {\n                showLoginError('Please enter your license key');\n                return;\n            }\n\n            if (!isValidLicenseKeyFormat(licenseKey)) {\n                showLoginError('Invalid format. Expected: SPLICE-XXXX-XXXX-XXXX');\n                return;\n            }\n\n            saveLoginBtn.disabled = true;\n            saveLoginBtn.textContent = 'Activating...';\n\n            try {\n                // Use /auth/login endpoint which returns JWT tokens\n                const response = await fetchWithTimeout(`${getBackendUrl()}/auth/login`, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ licenseKey: licenseKey })\n                }, SPLICE_CONFIG.FETCH_TIMEOUT);\n\n                const result = await response.json();\n\n                if (!result.success) {\n                    showLoginError(result.error || 'Activation failed');\n                    return;\n                }\n\n                // Store JWT tokens and customer info\n                const expiresInMs = (result.expiresIn || 86400) * 1000; // Default 24h\n                saveSettings({\n                    customerId: result.customerId,\n                    accessToken: result.token,\n                    refreshToken: result.refreshToken,\n                    tokenExpiry: Date.now() + expiresInMs,\n                    licenseKey: licenseKey // Keep for re-authentication\n                });\n\n                loginModal?.classList.add('hidden');\n\n                if (typeof refreshCredits === 'function') {\n                    await refreshCredits();\n                }\n\n                const tierName = result.tier ? result.tier.charAt(0).toUpperCase() + result.tier.slice(1) : 'Unknown';\n                setStatus(`License activated! ${tierName} tier`);\n            } catch (err) {\n                console.error('[SPLICE] License activation error:', err);\n\n                // DIAGNOSTIC LOGGING: Capture exact error details (debug mode only)\n                debugLog('=== CEP LICENSE ACTIVATION ERROR DIAGNOSTICS ===');\n                debugLog('Error name:', err?.name);\n                debugLog('Error message:', err?.message);\n                debugLog('Error stack:', err?.stack);\n                debugLog('Backend URL:', getBackendUrl());\n                debugLog('Fetch timeout:', SPLICE_CONFIG.FETCH_TIMEOUT);\n                debugLog('Is CEP environment:', typeof CSInterface !== 'undefined');\n                debugLog('User agent:', navigator?.userAgent);\n                debugLog('Error constructor:', err?.constructor?.name);\n                debugLog('Is TypeError:', err?.name === 'TypeError');\n                debugLog('Message contains \"Failed to fetch\":', err?.message?.includes('Failed to fetch'));\n                debugLog('Message contains \"fetch\":', err?.message?.toLowerCase()?.includes('fetch'));\n                debugLog('Message contains \"network\":', err?.message?.toLowerCase()?.includes('network'));\n                debugLog('Message contains \"CORS\":', err?.message?.toLowerCase()?.includes('cors'));\n                debugLog('Message contains \"SSL\":', err?.message?.toLowerCase()?.includes('ssl'));\n                debugLog('Message contains \"certificate\":', err?.message?.toLowerCase()?.includes('certificate'));\n                debugLog('Full error object:', JSON.stringify(err, Object.getOwnPropertyNames(err)));\n                debugLog('================================================');\n\n                // Provide detailed error message based on error type\n                let errorMessage = 'Connection error. ';\n\n                if (err.message === 'Request timed out') {\n                    errorMessage += 'Server is not responding. Check if backend is running.';\n                } else if (err.message?.includes('Failed to fetch') || err.name === 'TypeError') {\n                    errorMessage += `Cannot reach ${getBackendUrl()}. Check network/firewall.`;\n                } else if (err.message?.includes('CORS')) {\n                    errorMessage += 'CORS error. Contact support.';\n                } else if (err.message?.includes('SSL') || err.message?.includes('certificate')) {\n                    errorMessage += 'SSL certificate error. Try updating your system certificates.';\n                } else if (err.message) {\n                    errorMessage += err.message;\n                } else {\n                    errorMessage += 'Unknown error. Check console for details.';\n                }\n\n                debugLog('Final error message shown to user:', errorMessage);\n                showLoginError(errorMessage);\n            } finally {\n                saveLoginBtn.disabled = false;\n                saveLoginBtn.textContent = 'Activate';\n            }\n        });\n    }\n\n    // Email lookup\n    const lookupLicenseBtn = document.getElementById('lookupLicenseBtn');\n    const lookupEmailInput = document.getElementById('lookupEmailInput');\n\n    if (lookupLicenseBtn) {\n        lookupLicenseBtn.addEventListener('click', async () => {\n            const email = lookupEmailInput?.value?.trim()?.toLowerCase();\n\n            if (!email) {\n                showLoginError('Please enter your email address');\n                return;\n            }\n\n            const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n            if (!emailRegex.test(email)) {\n                showLoginError('Please enter a valid email address');\n                return;\n            }\n\n            lookupLicenseBtn.disabled = true;\n            lookupLicenseBtn.textContent = 'Looking up...';\n\n            try {\n                const response = await fetchWithTimeout(`${getBackendUrl()}/license/lookup`, {\n                    method: 'POST',\n                    headers: { 'Content-Type': 'application/json' },\n                    body: JSON.stringify({ email })\n                }, 30000);\n\n                const result = await response.json();\n\n                // Note: For security, the backend does NOT return the license key directly.\n                // It sends the key via email to prevent enumeration attacks.\n                if (result.success) {\n                    setStatus(result.message || 'If a license exists, it will be sent to your email.');\n                } else {\n                    showLoginError(result.error || 'Lookup failed. Please try again.');\n                }\n            } catch (err) {\n                console.error('[SPLICE] License lookup error:', err);\n                showLoginError('Failed to look up license. Please try again.');\n            } finally {\n                lookupLicenseBtn.disabled = false;\n                lookupLicenseBtn.textContent = 'Lookup';\n            }\n        });\n    }\n\n    // Handle external URL buttons\n    // CEP panels cannot use target=\"_blank\" for security reasons.\n    // Must use CSInterface.openURLInDefaultBrowser() instead.\n    initExternalLinkButtons();\n}\n\n/**\n * Initialize all external link buttons that need CSInterface.openURLInDefaultBrowser()\n * CEP panels cannot use target=\"_blank\" due to security restrictions\n */\nfunction initExternalLinkButtons() {\n    // Check if CSInterface is available\n    if (typeof CSInterface === 'undefined') {\n        console.warn('[SPLICE] CSInterface not available - external links disabled');\n        return;\n    }\n\n    let cs;\n    try {\n        cs = new CSInterface();\n    } catch (e) {\n        console.warn('[SPLICE] Failed to create CSInterface:', e.message);\n        return;\n    }\n\n    // Buy a License button\n    const buyLicenseBtn = document.querySelector('.btn-buy-license');\n\n    if (buyLicenseBtn) {\n        buyLicenseBtn.addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n\n            // Visual feedback\n            buyLicenseBtn.textContent = 'Opening...';\n            buyLicenseBtn.style.backgroundColor = '#28a745';\n\n            try {\n                cs.openURLInDefaultBrowser('https://spliceclips.com/pricing');\n\n                // Reset button after a delay\n                setTimeout(() => {\n                    buyLicenseBtn.textContent = 'Buy License';\n                    buyLicenseBtn.style.backgroundColor = '';\n                }, 2000);\n            } catch (err) {\n                console.error('[SPLICE] Failed to open URL:', err.message);\n                buyLicenseBtn.textContent = 'Error';\n                buyLicenseBtn.style.backgroundColor = '#dc3545';\n            }\n        });\n    }\n    \n    // View Plans button (in upgrade modal)\n    const viewPlansBtn = document.querySelector('.btn-view-plans');\n    if (viewPlansBtn) {\n        viewPlansBtn.addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            const url = viewPlansBtn.dataset.url || 'https://spliceclips.com/pricing';\n            cs.openURLInDefaultBrowser(url);\n        });\n    }\n    \n    // Referral link button\n    const referralBtn = document.querySelector('.btn-referral');\n    if (referralBtn) {\n        referralBtn.addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            const url = referralBtn.dataset.url || 'https://splice.video/referrals';\n            cs.openURLInDefaultBrowser(url);\n        });\n    }\n}\n\n/**\n * Show login modal\n */\nfunction showLoginModal() {\n    const loginModal = document.getElementById('loginModal');\n    const loginError = document.getElementById('loginError');\n    if (loginError) loginError.style.display = 'none';\n    if (loginModal) loginModal.classList.remove('hidden');\n}\n\n/**\n * Show login error message\n */\nfunction showLoginError(message) {\n    const loginError = document.getElementById('loginError');\n    if (loginError) {\n        loginError.textContent = message;\n        loginError.style.display = 'block';\n    }\n}\n\n/**\n * Check if user is logged in\n */\nfunction isLoggedIn() {\n    const settings = getSettings();\n    return !!settings.customerId;\n}\n\n/**\n * Logout - clear all auth data\n */\nfunction logout() {\n    // Clear all auth-related settings\n    saveSettings({\n        customerId: null,\n        accessToken: null,\n        refreshToken: null,\n        tokenExpiry: null,\n        licenseKey: null\n    });\n\n    if (typeof clearCreditsCache === 'function') {\n        clearCreditsCache();\n    }\n    if (typeof updateCreditDisplay === 'function') {\n        updateCreditDisplay(null);\n    }\n    setStatus('Logged out');\n}\n\n// Initialize JSX bridge when loaded\ndocument.addEventListener('DOMContentLoaded', () => {\n    jsx.init();\n});\n\n// Export for modules\nwindow.SPLICE_CONFIG = SPLICE_CONFIG;\nwindow.SPLICE_DEBUG = SPLICE_DEBUG;\nwindow.debugLog = debugLog;\nwindow.debugFetch = debugFetch;\nwindow.getBackendUrl = getBackendUrl;\nwindow.fetchWithTimeout = fetchWithTimeout;\nwindow.parseErrorResponse = parseErrorResponse;\nwindow.getAuthHeaders = getAuthHeaders;\nwindow.getSettings = getSettings;\nwindow.saveSettings = saveSettings;\nwindow.clearSetting = clearSetting;\nwindow.isOnline = isOnline;\nwindow.initOfflineDetection = initOfflineDetection;\nwindow.formatTime = formatTime;\nwindow.setStatus = setStatus;\nwindow.debounce = debounce;\nwindow.jsx = jsx;\nwindow.PRESETS = PRESETS;\nwindow.getPresets = getPresets;\nwindow.getPreset = getPreset;\nwindow.applyPreset = applyPreset;\nwindow.getActivePreset = getActivePreset;\nwindow.isBuiltInPreset = isBuiltInPreset;\nwindow.initPresetSelector = initPresetSelector;\nwindow.initLoginModal = initLoginModal;\nwindow.showLoginModal = showLoginModal;\nwindow.isLoggedIn = isLoggedIn;\nwindow.logout = logout;\nwindow.escapeHtml = escapeHtml;\nwindow.safeHtml = safeHtml;\n// JWT Auth functions\nwindow.isTokenExpired = isTokenExpired;\nwindow.refreshAccessToken = refreshAccessToken;\nwindow.clearAuthTokens = clearAuthTokens;\nwindow.ensureValidToken = ensureValidToken;\n","numLines":1600,"startLine":1,"totalLines":1600}}}
{"parentUuid":"9e61291d-42c2-4675-a9e8-1e6bdbdcfa79","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/SPLICE","sessionId":"5f015cfc-0476-4608-91d9-cf0946100ba2","version":"2.0.76","gitBranch":"main","agentId":"a1c98b9","slug":"fizzy-hatching-flame","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01EqTUF9bZH8kkvfg8qB3WYK","type":"tool_result","content":"     1→/**\n     2→ * SPLICE CEP Panel - Main Entry Point\n     3→ * v4.0.0 - CEP Migration\n     4→ */\n     5→\n     6→// ============================================================================\n     7→// CACHED DOM ELEMENTS\n     8→// ============================================================================\n     9→const ui = {};\n    10→\n    11→function cacheUIElements() {\n    12→    ui.status = document.getElementById('status');\n    13→    ui.goBtn = document.getElementById('goBtn');\n    14→    ui.optionsToggle = document.getElementById('optionsToggle');\n    15→    ui.optionsPanel = document.getElementById('optionsPanel');\n    16→\n    17→    // DIAGNOSTIC: Log critical element status immediately\n    18→    const criticalElements = {\n    19→        'status': ui.status,\n    20→        'goBtn': ui.goBtn,\n    21→        'optionsToggle': ui.optionsToggle,\n    22→        'optionsPanel': ui.optionsPanel\n    23→    };\n    24→    const missingCritical = Object.entries(criticalElements)\n    25→        .filter(([name, el]) => !el)\n    26→        .map(([name]) => name);\n    27→\n    28→    if (missingCritical.length > 0) {\n    29→        console.error('[SPLICE] CRITICAL: Missing UI elements during cache:', missingCritical);\n    30→        console.error('[SPLICE] DOM readyState:', document.readyState);\n    31→    }\n    32→\n    33→    // Sliders and options\n    34→    ui.sensitivitySlider = document.getElementById('sensitivitySlider');\n    35→    ui.sensitivityValue = document.getElementById('sensitivityValue');\n    36→    ui.sourceOriginal = document.getElementById('sourceOriginal');\n    37→    ui.sourceIsolated = document.getElementById('sourceIsolated');\n    38→\n    39→    // Feature toggles\n    40→    ui.enableTakesDetection = document.getElementById('enableTakesDetection');\n    41→    ui.enableJCut = document.getElementById('enableJCut');\n    42→    ui.jcutSettings = document.getElementById('jcutSettings');\n    43→    ui.jcutLeadIn = document.getElementById('jcutLeadIn');\n    44→    ui.jcutLeadInValue = document.getElementById('jcutLeadInValue');\n    45→    ui.jcutLeadOut = document.getElementById('jcutLeadOut');\n    46→    ui.jcutLeadOutValue = document.getElementById('jcutLeadOutValue');\n    47→\n    48→    // Zoom settings\n    49→    ui.enableZoom = document.getElementById('enableZoom');\n    50→    ui.zoomSettings = document.getElementById('zoomSettings');\n    51→    ui.zoomFrequency = document.getElementById('zoomFrequency');\n    52→    ui.zoomPreset = document.getElementById('zoomPreset');\n    53→    ui.zoomPlacement = document.getElementById('zoomPlacement');\n    54→\n    55→    // Chapter settings\n    56→    ui.enableChapters = document.getElementById('enableChapters');\n    57→    ui.chapterSettings = document.getElementById('chapterSettings');\n    58→    ui.maxChapters = document.getElementById('maxChapters');\n    59→    ui.minChapterLength = document.getElementById('minChapterLength');\n    60→\n    61→    // Profanity settings\n    62→    ui.enableProfanity = document.getElementById('enableProfanity');\n    63→    ui.profanitySettings = document.getElementById('profanitySettings');\n    64→\n    65→    // Filler word settings\n    66→    ui.enableFillerDetection = document.getElementById('enableFillerDetection');\n    67→    ui.fillerSettings = document.getElementById('fillerSettings');\n    68→\n    69→    // Progress\n    70→    ui.progressContainer = document.getElementById('progressContainer');\n    71→    ui.progressBar = document.getElementById('progressBar');\n    72→    ui.progressText = document.getElementById('progressText');\n    73→    ui.resultsEmpty = document.getElementById('resultsEmpty');\n    74→\n    75→    // Preview\n    76→    ui.combinedPreview = document.getElementById('combinedPreview');\n    77→    ui.previewList = document.getElementById('previewList');\n    78→    ui.silenceCount = document.getElementById('silenceCount');\n    79→    ui.takeCount = document.getElementById('takeCount');\n    80→    ui.selectedCount = document.getElementById('selectedCount');\n    81→    ui.selectAllSilences = document.getElementById('selectAllSilences');\n    82→    ui.applyPreviewBtn = document.getElementById('applyPreviewBtn');\n    83→    ui.cancelPreviewBtn = document.getElementById('cancelPreviewBtn');\n    84→    ui.buildSequenceBtn = document.getElementById('buildSequenceBtn');\n    85→\n    86→    // Results\n    87→    ui.zoomResults = document.getElementById('zoomResults');\n    88→    ui.zoomList = document.getElementById('zoomList');\n    89→    ui.chapterResults = document.getElementById('chapterResults');\n    90→    ui.chapterList = document.getElementById('chapterList');\n    91→    ui.copyYouTubeBtn = document.getElementById('copyYouTubeBtn');\n    92→    ui.addChapterMarkersBtn = document.getElementById('addChapterMarkersBtn');\n    93→\n    94→    // Modals\n    95→    ui.settingsBtn = document.getElementById('settingsBtn');\n    96→    ui.settingsModal = document.getElementById('settingsModal');\n    97→    ui.closeSettingsBtn = document.getElementById('closeSettingsBtn');\n    98→    ui.loginModal = document.getElementById('loginModal');\n    99→    ui.closeLoginBtn = document.getElementById('closeLoginBtn');\n   100→    ui.licenseKeyInput = document.getElementById('licenseKeyInput');\n   101→    ui.saveLoginBtn = document.getElementById('saveLoginBtn');\n   102→\n   103→    // Debug modal\n   104→    ui.debugBtn = document.getElementById('debugBtn');\n   105→    ui.debugModal = document.getElementById('debugModal');\n   106→    ui.closeDebugBtn = document.getElementById('closeDebugBtn');\n   107→    ui.debugQuickDiagnosis = document.getElementById('debugQuickDiagnosis');\n   108→    ui.debugLogs = document.getElementById('debugLogs');\n   109→    ui.runDiagnosticsBtn = document.getElementById('runDiagnosticsBtn');\n   110→    ui.copyDiagnosticsBtn = document.getElementById('copyDiagnosticsBtn');\n   111→\n   112→    // Credit badge\n   113→    ui.creditBadge = document.getElementById('creditBadge');\n   114→\n   115→    // Preset selector\n   116→    ui.presetSelector = document.getElementById('presetSelector');\n   117→}\n   118→\n   119→// ============================================================================\n   120→// STATE MANAGEMENT\n   121→// ============================================================================\n   122→let previewSilences = [];\n   123→let previewTakes = [];\n   124→let currentChapters = [];\n   125→let currentZooms = [];\n   126→let currentProfanity = [];\n   127→let selectedSilenceIndices = new Set();\n   128→let isOperationInProgress = false;\n   129→let lastDetectionResult = null;\n   130→let currentAudioPath = null;\n   131→let currentSequenceInfo = null;\n   132→let currentTranscript = null;\n   133→\n   134→// Global state for captions/reframe modules\n   135→window.spliceState = {\n   136→    lastTranscript: null,\n   137→    currentVideoPath: null,\n   138→    activeSequence: null,\n   139→    audioPath: null\n   140→};\n   141→\n   142→// Also expose transcript globally for music module\n   143→window.currentTranscript = null;\n   144→\n   145→// ============================================================================\n   146→// INITIALIZATION\n   147→// ============================================================================\n   148→document.addEventListener('DOMContentLoaded', async () => {\n   149→    // Premium Loading Experience\n   150→    setTimeout(() => {\n   151→        const loader = document.getElementById('loading-overlay');\n   152→        if (loader) loader.classList.add('hidden');\n   153→    }, 800); // Small delay for smooth perception\n   154→    debugLog('Initializing CEP panel...');\n   155→\n   156→    // Debug: Show init started\n   157→    const statusEl = document.getElementById('status');\n   158→    if (statusEl) statusEl.textContent = 'Initializing...';\n   159→\n   160→    // Cache DOM elements\n   161→    cacheUIElements();\n   162→\n   163→    // Load settings\n   164→    loadSettingsToUI();\n   165→\n   166→    // Initialize UI handlers\n   167→    initOptionsToggle();\n   168→    initSliders();\n   169→    initFeatureToggles();\n   170→    initPresetSelector();\n   171→    initGoButton();\n   172→    initPreviewHandlers();\n   173→    initModals();\n   174→    initLoginModal();\n   175→    initCredits();\n   176→    initHelpButton();\n   177→    initDebugModal();\n   178→\n   179→    // Initialize offline detection\n   180→    if (typeof initOfflineDetection === 'function') {\n   181→        initOfflineDetection();\n   182→    }\n   183→\n   184→    // Initialize multitrack UI\n   185→    if (typeof initMultitrackUI === 'function') {\n   186→        initMultitrackUI();\n   187→    }\n   188→\n   189→    // Initialize animated captions UI\n   190→    if (typeof initAnimatedCaptions === 'function') {\n   191→        initAnimatedCaptions();\n   192→    }\n   193→\n   194→    // Initialize text editor UI\n   195→    if (typeof initTextEditor === 'function') {\n   196→        initTextEditor();\n   197→    }\n   198→\n   199→    // Initialize text editor section toggle\n   200→    initTextEditorToggle();\n   201→\n   202→    // Initialize social reframe UI\n   203→    if (typeof initSocialReframe === 'function') {\n   204→        initSocialReframe();\n   205→    }\n   206→\n   207→    // Initialize social reframe section toggle\n   208→    initSocialReframeToggle();\n   209→\n   210→    // Initialize music UI\n   211→    if (typeof initMusicModule === 'function') {\n   212→        initMusicModule();\n   213→    }\n   214→\n   215→    // Initialize music section toggle\n   216→    initMusicToggle();\n   217→\n   218→    // Initialize JSX bridge first, then check connection\n   219→    // This ensures jsx.init() completes before checkJSXConnection() uses it\n   220→    await jsx.init();\n   221→    await checkJSXConnection();\n   222→\n   223→    // Initialize sequence event listeners for real-time state updates\n   224→    initSequenceEventListeners();\n   225→\n   226→    // DIAGNOSTIC: Verify all critical UI elements are properly initialized\n   227→    verifyUIInitialization();\n   228→\n   229→    setStatus('Ready');\n   230→    debugLog('CEP panel initialized');\n   231→});\n   232→\n   233→/**\n   234→ * Post-initialization diagnostic to verify all critical UI elements\n   235→ * are properly cached and event listeners are attached\n   236→ */\n   237→function verifyUIInitialization() {\n   238→    const criticalElements = {\n   239→        'goBtn': { el: ui.goBtn, desc: 'GO button (main action)' },\n   240→        'settingsBtn': { el: ui.settingsBtn, desc: 'Settings button' },\n   241→        'debugBtn': { el: ui.debugBtn, desc: 'Debug button' },\n   242→        'creditBadge': { el: ui.creditBadge, desc: 'Credit badge' },\n   243→        'status': { el: ui.status, desc: 'Status bar' },\n   244→        'optionsToggle': { el: ui.optionsToggle, desc: 'Options toggle' },\n   245→        'optionsPanel': { el: ui.optionsPanel, desc: 'Options panel' }\n   246→    };\n   247→\n   248→    const missingElements = [];\n   249→    const presentElements = [];\n   250→\n   251→    Object.entries(criticalElements).forEach(([id, { el, desc }]) => {\n   252→        if (!el) {\n   253→            missingElements.push(`#${id} (${desc})`);\n   254→        } else {\n   255→            presentElements.push(id);\n   256→        }\n   257→    });\n   258→\n   259→    if (missingElements.length > 0) {\n   260→        console.error('[SPLICE] ⚠️ UI INITIALIZATION INCOMPLETE');\n   261→        console.error('[SPLICE] Missing critical elements:', missingElements);\n   262→        console.error('[SPLICE] Panel may not function correctly. Check index.html structure.');\n   263→\n   264→        // Show error in status bar if available\n   265→        const statusEl = document.getElementById('status');\n   266→        if (statusEl) {\n   267→            statusEl.textContent = 'Init error: ' + missingElements.length + ' UI elements missing';\n   268→            statusEl.classList.add('error');\n   269→        }\n   270→    } else {\n   271→        console.log('[SPLICE] ✓ All critical UI elements initialized:', presentElements.join(', '));\n   272→    }\n   273→\n   274→    // Verify GO button has click listener\n   275→    if (ui.goBtn) {\n   276→        const listeners = getEventListeners ? getEventListeners(ui.goBtn) : null;\n   277→        if (!listeners || !listeners.click || listeners.click.length === 0) {\n   278→            // Can't check in production, but log that we tried\n   279→            console.log('[SPLICE] GO button present - click handler should be attached');\n   280→        }\n   281→    }\n   282→}\n   283→\n   284→// ============================================================================\n   285→// SEQUENCE EVENT LISTENERS\n   286→// ============================================================================\n   287→/**\n   288→ * Initialize event listeners for sequence state changes\n   289→ * This provides real-time updates when sequences are activated/deactivated\n   290→ */\n   291→function initSequenceEventListeners() {\n   292→    if (!jsx.cs) {\n   293→        console.warn('[SPLICE] Cannot init sequence listeners - CSInterface not available');\n   294→        return;\n   295→    }\n   296→\n   297→    try {\n   298→        // Listen for sequence activation events\n   299→        jsx.cs.addEventListener('com.adobe.csxs.events.SequenceActivated', async (event) => {\n   300→            debugLog('Sequence activated event received');\n   301→            try {\n   302→                const seqInfo = await jsx.call('getActiveSequence');\n   303→                if (seqInfo && !seqInfo.error) {\n   304→                    window.spliceState.activeSequence = seqInfo;\n   305→                    setStatus('Sequence: ' + (seqInfo.name || 'Unknown'));\n   306→                    debugLog('Active sequence updated:', seqInfo.name);\n   307→                }\n   308→            } catch (e) {\n   309→                console.warn('[SPLICE] Failed to get sequence info on activation:', e.message);\n   310→            }\n   311→        });\n   312→\n   313→        // Listen for sequence close/deactivation\n   314→        jsx.cs.addEventListener('com.adobe.csxs.events.SequenceDeactivated', () => {\n   315→            debugLog('Sequence deactivated event');\n   316→            window.spliceState.activeSequence = null;\n   317→            setStatus('No sequence open', true);\n   318→        });\n   319→\n   320→        // Listen for project item selection changes (includes sequences)\n   321→        jsx.cs.addEventListener('com.adobe.csxs.events.SelectionChanged', async () => {\n   322→            // Debounce rapid selection changes\n   323→            if (window._selectionChangeTimeout) {\n   324→                clearTimeout(window._selectionChangeTimeout);\n   325→            }\n   326→            window._selectionChangeTimeout = setTimeout(async () => {\n   327→                try {\n   328→                    const hasSequence = await checkSequenceOpen(0, 0); // Quick check, no retries\n   329→                    if (hasSequence && !window.spliceState.activeSequence) {\n   330→                        const seqInfo = await jsx.call('getActiveSequence');\n   331→                        if (seqInfo && !seqInfo.error) {\n   332→                            window.spliceState.activeSequence = seqInfo;\n   333→                            debugLog('Sequence detected via selection change:', seqInfo.name);\n   334→                        }\n   335→                    }\n   336→                } catch (e) {\n   337→                    // Ignore errors during selection change - it's just for proactive updates\n   338→                }\n   339→            }, 200);\n   340→        });\n   341→\n   342→        debugLog('Sequence event listeners initialized');\n   343→    } catch (e) {\n   344→        console.error('[SPLICE] Failed to init sequence event listeners:', e.message);\n   345→    }\n   346→}\n   347→\n   348→// ============================================================================\n   349→// JSX CONNECTION CHECK\n   350→// ============================================================================\n   351→async function checkJSXConnection() {\n   352→    try {\n   353→        const result = await jsx.call('getVersion');\n   354→        debugLog('JSX connection OK, version:', result);\n   355→        return true;\n   356→    } catch (e) {\n   357→        console.warn('[SPLICE] JSX connection failed:', e.message);\n   358→        setStatus('Premiere Pro connection failed', true);\n   359→        return false;\n   360→    }\n   361→}\n   362→\n   363→/**\n   364→ * Check if a sequence is currently open in the Timeline\n   365→ * Enhanced with logging and retry logic\n   366→ * @param {number} retries - Number of retry attempts (default: 2)\n   367→ * @param {number} delayMs - Delay between retries in ms (default: 300)\n   368→ * @returns {Promise<boolean>} true if sequence is open\n   369→ */\n   370→async function checkSequenceOpen(retries = 2, delayMs = 300) {\n   371→    console.log('[SPLICE] ========== checkSequenceOpen DIAGNOSTIC START ==========');\n   372→    console.log('[SPLICE] checkSequenceOpen: retries=' + retries + ', delayMs=' + delayMs);\n   373→    console.log('[SPLICE] checkSequenceOpen: window.spliceState.activeSequence =', window.spliceState.activeSequence);\n   374→    \n   375→    for (let attempt = 0; attempt <= retries; attempt++) {\n   376→        try {\n   377→            console.log('[SPLICE] checkSequenceOpen: Attempt ' + (attempt + 1) + ' of ' + (retries + 1));\n   378→            console.log('[SPLICE] checkSequenceOpen: Calling jsx.call(\"checkSequenceOpen\")...');\n   379→            const result = await jsx.call('checkSequenceOpen');\n   380→            console.log('[SPLICE] checkSequenceOpen: JSX call returned');\n   381→            console.log('[SPLICE] checkSequenceOpen: result =', result, '(type:', typeof result + ')');\n   382→            debugLog('checkSequenceOpen attempt', attempt + 1, 'result:', result, 'type:', typeof result);\n   383→\n   384→            if (result === true || result === 'true') {\n   385→                console.log('[SPLICE] checkSequenceOpen: Returning TRUE - sequence is open');\n   386→                console.log('[SPLICE] ========== checkSequenceOpen DIAGNOSTIC END (TRUE) ==========');\n   387→                return true;\n   388→            }\n   389→\n   390→            // If false, wait and retry (sequence might be loading)\n   391→            if (attempt < retries) {\n   392→                console.log('[SPLICE] checkSequenceOpen: No sequence found, retrying in', delayMs, 'ms...');\n   393→                debugLog('checkSequenceOpen: No sequence found, retrying in', delayMs, 'ms...');\n   394→                await new Promise(r => setTimeout(r, delayMs));\n   395→            }\n   396→        } catch (error) {\n   397→            console.error('[SPLICE] checkSequenceOpen: Attempt', attempt + 1, 'failed with exception:', error.message);\n   398→            console.error('[SPLICE] checkSequenceOpen: Error stack:', error.stack);\n   399→\n   400→            // On last attempt, return false but log the actual error\n   401→            if (attempt === retries) {\n   402→                console.error('[SPLICE] checkSequenceOpen: All attempts failed. Last error:', error.message);\n   403→                // Store error for diagnostics\n   404→                window.spliceState.lastSequenceCheckError = error.message;\n   405→                console.log('[SPLICE] checkSequenceOpen: Stored error in window.spliceState.lastSequenceCheckError:', error.message);\n   406→                console.log('[SPLICE] ========== checkSequenceOpen DIAGNOSTIC END (ERROR) ==========');\n   407→                return false;\n   408→            }\n   409→\n   410→            // Wait before retry\n   411→            console.log('[SPLICE] checkSequenceOpen: Waiting', delayMs, 'ms before retry...');\n   412→            await new Promise(r => setTimeout(r, delayMs));\n   413→        }\n   414→    }\n   415→    console.log('[SPLICE] checkSequenceOpen: All attempts completed without finding sequence');\n   416→    console.log('[SPLICE] ========== checkSequenceOpen DIAGNOSTIC END (FALSE) ==========');\n   417→    return false;\n   418→}\n   419→\n   420→// ============================================================================\n   421→// OPTIONS TOGGLE\n   422→// ============================================================================\n   423→function initOptionsToggle() {\n   424→    debugLog('initOptionsToggle - toggle:', !!ui.optionsToggle, 'panel:', !!ui.optionsPanel);\n   425→    if (ui.optionsToggle && ui.optionsPanel) {\n   426→        ui.optionsToggle.addEventListener('click', () => {\n   427→            debugLog('Options toggle clicked');\n   428→            // Check current state BEFORE toggling\n   429→            const wasCollapsed = ui.optionsPanel.classList.contains('collapsed');\n   430→            ui.optionsPanel.classList.toggle('collapsed');\n   431→            // If it was collapsed, it's now expanded (show 'expanded' class)\n   432→            ui.optionsToggle.classList.toggle('expanded', wasCollapsed);\n   433→            saveSettings({ expandedOptions: wasCollapsed });\n   434→        });\n   435→\n   436→        // Restore state\n   437→        const settings = getSettings();\n   438→        if (!settings.expandedOptions) {\n   439→            ui.optionsPanel.classList.add('collapsed');\n   440→            ui.optionsToggle.classList.remove('expanded');\n   441→        } else {\n   442→            ui.optionsToggle.classList.add('expanded');\n   443→            ui.optionsPanel.classList.remove('collapsed');\n   444→        }\n   445→    }\n   446→}\n   447→\n   448→// ============================================================================\n   449→// TEXT EDITOR TOGGLE\n   450→// ============================================================================\n   451→function initTextEditorToggle() {\n   452→    const toggle = document.getElementById('textEditorToggle');\n   453→    const panel = document.getElementById('text-editor-panel');\n   454→    debugLog('initTextEditorToggle - toggle:', !!toggle, 'panel:', !!panel);\n   455→\n   456→    if (toggle && panel) {\n   457→        toggle.addEventListener('click', (e) => {\n   458→            e.preventDefault();\n   459→            e.stopPropagation();\n   460→            debugLog('Text Editor toggle clicked');\n   461→            setStatus('Text Editor: ' + (panel.classList.contains('collapsed') ? 'Opening' : 'Closing'));\n   462→            // Check state BEFORE toggling\n   463→            const wasCollapsed = panel.classList.contains('collapsed');\n   464→            panel.classList.toggle('collapsed');\n   465→            const icon = toggle.querySelector('.toggle-icon');\n   466→            debugLog('wasCollapsed:', wasCollapsed, 'icon:', !!icon);\n   467→            if (icon) {\n   468→                // If it was collapsed, it's now expanded (show -)\n   469→                icon.textContent = wasCollapsed ? '-' : '+';\n   470→            }\n   471→        });\n   472→    } else {\n   473→        console.error('[SPLICE] Text Editor toggle elements not found!');\n   474→    }\n   475→}\n   476→\n   477→// ============================================================================\n   478→// SOCIAL REFRAME TOGGLE\n   479→// ============================================================================\n   480→function initSocialReframeToggle() {\n   481→    const toggle = document.getElementById('socialReframeToggle');\n   482→    const panel = document.getElementById('social-reframe-panel');\n   483→    debugLog('initSocialReframeToggle - toggle:', !!toggle, 'panel:', !!panel);\n   484→\n   485→    if (toggle && panel) {\n   486→        toggle.addEventListener('click', () => {\n   487→            debugLog('Social Reframe toggle clicked');\n   488→            // Check state BEFORE toggling\n   489→            const wasCollapsed = panel.classList.contains('collapsed');\n   490→            panel.classList.toggle('collapsed');\n   491→            const icon = toggle.querySelector('.toggle-icon');\n   492→            if (icon) {\n   493→                // If it was collapsed, it's now expanded (show -)\n   494→                icon.textContent = wasCollapsed ? '-' : '+';\n   495→            }\n   496→        });\n   497→    } else {\n   498→        console.error('[SPLICE] Social Reframe toggle elements not found!');\n   499→    }\n   500→}\n   501→\n   502→// ============================================================================\n   503→// MUSIC TOGGLE\n   504→// ============================================================================\n   505→function initMusicToggle() {\n   506→    const toggle = document.getElementById('musicToggle');\n   507→    const panel = document.getElementById('music-panel');\n   508→    debugLog('initMusicToggle - toggle:', !!toggle, 'panel:', !!panel);\n   509→\n   510→    if (toggle && panel) {\n   511→        toggle.addEventListener('click', () => {\n   512→            debugLog('Music toggle clicked');\n   513→            // Check state BEFORE toggling\n   514→            const wasCollapsed = panel.classList.contains('collapsed');\n   515→            panel.classList.toggle('collapsed');\n   516→            const icon = toggle.querySelector('.toggle-icon');\n   517→            if (icon) {\n   518→                // If it was collapsed, it's now expanded (show -)\n   519→                icon.textContent = wasCollapsed ? '-' : '+';\n   520→            }\n   521→        });\n   522→    } else {\n   523→        console.error('[SPLICE] Music toggle elements not found!');\n   524→    }\n   525→}\n   526→\n   527→// ============================================================================\n   528→// SLIDERS\n   529→// ============================================================================\n   530→function initSliders() {\n   531→    // Sensitivity slider\n   532→    if (ui.sensitivitySlider && ui.sensitivityValue) {\n   533→        ui.sensitivitySlider.addEventListener('input', () => {\n   534→            ui.sensitivityValue.textContent = ui.sensitivitySlider.value;\n   535→            saveSettings({ sensitivity: parseInt(ui.sensitivitySlider.value) });\n   536→        });\n   537→    }\n   538→\n   539→    // J-Cut sliders\n   540→    if (ui.jcutLeadIn && ui.jcutLeadInValue) {\n   541→        ui.jcutLeadIn.addEventListener('input', () => {\n   542→            const val = (ui.jcutLeadIn.value / 100).toFixed(2);\n   543→            ui.jcutLeadInValue.textContent = val + 's';\n   544→            saveSettings({ jcutLeadIn: parseFloat(val) });\n   545→        });\n   546→    }\n   547→\n   548→    if (ui.jcutLeadOut && ui.jcutLeadOutValue) {\n   549→        ui.jcutLeadOut.addEventListener('input', () => {\n   550→            const val = (ui.jcutLeadOut.value / 100).toFixed(2);\n   551→            ui.jcutLeadOutValue.textContent = val + 's';\n   552→            saveSettings({ jcutLeadOut: parseFloat(val) });\n   553→        });\n   554→    }\n   555→}\n   556→\n   557→// ============================================================================\n   558→// FEATURE TOGGLES\n   559→// ============================================================================\n   560→function initFeatureToggles() {\n   561→    // J-Cut toggle\n   562→    if (ui.enableJCut && ui.jcutSettings) {\n   563→        ui.enableJCut.addEventListener('change', () => {\n   564→            ui.jcutSettings.classList.toggle('collapsed', !ui.enableJCut.checked);\n   565→            saveSettings({ enableJCut: ui.enableJCut.checked });\n   566→        });\n   567→    }\n   568→\n   569→    // Zoom toggle\n   570→    if (ui.enableZoom && ui.zoomSettings) {\n   571→        ui.enableZoom.addEventListener('change', () => {\n   572→            ui.zoomSettings.classList.toggle('collapsed', !ui.enableZoom.checked);\n   573→            saveSettings({ enableZoom: ui.enableZoom.checked });\n   574→        });\n   575→    }\n   576→\n   577→    // Chapters toggle\n   578→    if (ui.enableChapters && ui.chapterSettings) {\n   579→        ui.enableChapters.addEventListener('change', () => {\n   580→            ui.chapterSettings.classList.toggle('collapsed', !ui.enableChapters.checked);\n   581→            saveSettings({ enableChapters: ui.enableChapters.checked });\n   582→        });\n   583→    }\n   584→\n   585→    // Takes detection toggle\n   586→    if (ui.enableTakesDetection) {\n   587→        ui.enableTakesDetection.addEventListener('change', () => {\n   588→            saveSettings({ enableTakesDetection: ui.enableTakesDetection.checked });\n   589→        });\n   590→    }\n   591→\n   592→    // Profanity detection toggle\n   593→    if (ui.enableProfanity && ui.profanitySettings) {\n   594→        ui.enableProfanity.addEventListener('change', () => {\n   595→            ui.profanitySettings.classList.toggle('collapsed', !ui.enableProfanity.checked);\n   596→            saveSettings({ enableProfanity: ui.enableProfanity.checked });\n   597→        });\n   598→    }\n   599→\n   600→    // Filler word detection toggle\n   601→    if (ui.enableFillerDetection && ui.fillerSettings) {\n   602→        ui.enableFillerDetection.addEventListener('change', () => {\n   603→            ui.fillerSettings.classList.toggle('collapsed', !ui.enableFillerDetection.checked);\n   604→            saveSettings({ enableFillerDetection: ui.enableFillerDetection.checked });\n   605→        });\n   606→    }\n   607→}\n   608→\n   609→// ============================================================================\n   610→// PRESET SELECTOR\n   611→// ============================================================================\n   612→// PRESETS is defined in config.js\n   613→\n   614→function initPresetSelector() {\n   615→    if (!ui.presetSelector) return;\n   616→\n   617→    ui.presetSelector.addEventListener('change', () => {\n   618→        const presetId = ui.presetSelector.value;\n   619→        applyPreset(presetId);\n   620→    });\n   621→\n   622→    // Load current preset\n   623→    const settings = getSettings();\n   624→    if (settings.activePreset) {\n   625→        ui.presetSelector.value = settings.activePreset;\n   626→    }\n   627→}\n   628→\n   629→function applyPreset(presetId) {\n   630→    const preset = PRESETS[presetId];\n   631→    if (!preset) return;\n   632→\n   633→    // Custom preset - keep current settings\n   634→    if (presetId === 'custom' || !preset.settings) {\n   635→        saveSettings({ activePreset: 'custom' });\n   636→        setStatus('Using custom settings');\n   637→        return;\n   638→    }\n   639→\n   640→    const settings = preset.settings;\n   641→\n   642→    // Apply to UI\n   643→    if (ui.sensitivitySlider && settings.sensitivity !== undefined) {\n   644→        ui.sensitivitySlider.value = settings.sensitivity;\n   645→        if (ui.sensitivityValue) ui.sensitivityValue.textContent = settings.sensitivity;\n   646→    }\n   647→\n   648→    if (ui.enableJCut) {\n   649→        ui.enableJCut.checked = settings.enableJCut || false;\n   650→        if (ui.jcutSettings) {\n   651→            ui.jcutSettings.classList.toggle('collapsed', !settings.enableJCut);\n   652→        }\n   653→    }\n   654→\n   655→    if (settings.jCutLeadIn !== undefined && ui.jcutLeadIn) {\n   656→        ui.jcutLeadIn.value = Math.round(settings.jCutLeadIn * 100);\n   657→        if (ui.jcutLeadInValue) ui.jcutLeadInValue.textContent = settings.jCutLeadIn + 's';\n   658→    }\n   659→\n   660→    if (settings.jCutLeadOut !== undefined && ui.jcutLeadOut) {\n   661→        ui.jcutLeadOut.value = Math.round(settings.jCutLeadOut * 100);\n   662→        if (ui.jcutLeadOutValue) ui.jcutLeadOutValue.textContent = settings.jCutLeadOut + 's';\n   663→    }\n   664→\n   665→    // Save merged settings\n   666→    saveSettings({\n   667→        activePreset: presetId,\n   668→        sensitivity: settings.sensitivity,\n   669→        threshold: settings.threshold,\n   670→        minSilenceLength: settings.minSilenceLength,\n   671→        paddingStart: settings.paddingStart,\n   672→        paddingEnd: settings.paddingEnd,\n   673→        enableTakesDetection: settings.enableTakesDetection,\n   674→        enableJCut: settings.enableJCut || false,\n   675→        jcutLeadIn: settings.jCutLeadIn || 0.3,\n   676→        jcutLeadOut: settings.jCutLeadOut || 0.2\n   677→    });\n   678→\n   679→    setStatus(`Applied ${preset.name} preset`);\n   680→}\n   681→\n   682→// ============================================================================\n   683→// LOAD SETTINGS TO UI\n   684→// ============================================================================\n   685→function loadSettingsToUI() {\n   686→    const settings = getSettings();\n   687→\n   688→    if (ui.sensitivitySlider) {\n   689→        ui.sensitivitySlider.value = settings.sensitivity;\n   690→        if (ui.sensitivityValue) ui.sensitivityValue.textContent = settings.sensitivity;\n   691→    }\n   692→\n   693→    if (ui.enableTakesDetection) ui.enableTakesDetection.checked = settings.enableTakesDetection;\n   694→    if (ui.enableJCut) ui.enableJCut.checked = settings.enableJCut;\n   695→    if (ui.enableZoom) ui.enableZoom.checked = settings.enableZoom;\n   696→    if (ui.enableChapters) ui.enableChapters.checked = settings.enableChapters;\n   697→\n   698→    if (ui.jcutSettings) ui.jcutSettings.classList.toggle('collapsed', !settings.enableJCut);\n   699→    if (ui.zoomSettings) ui.zoomSettings.classList.toggle('collapsed', !settings.enableZoom);\n   700→    if (ui.chapterSettings) ui.chapterSettings.classList.toggle('collapsed', !settings.enableChapters);\n   701→\n   702→    if (ui.jcutLeadIn) {\n   703→        ui.jcutLeadIn.value = Math.round(settings.jcutLeadIn * 100);\n   704→        if (ui.jcutLeadInValue) ui.jcutLeadInValue.textContent = settings.jcutLeadIn + 's';\n   705→    }\n   706→    if (ui.jcutLeadOut) {\n   707→        ui.jcutLeadOut.value = Math.round(settings.jcutLeadOut * 100);\n   708→        if (ui.jcutLeadOutValue) ui.jcutLeadOutValue.textContent = settings.jcutLeadOut + 's';\n   709→    }\n   710→\n   711→    if (ui.presetSelector && settings.activePreset) {\n   712→        ui.presetSelector.value = settings.activePreset;\n   713→    }\n   714→}\n   715→\n   716→// ============================================================================\n   717→// GO BUTTON - MAIN WORKFLOW\n   718→// ============================================================================\n   719→function initGoButton() {\n   720→    if (!ui.goBtn) {\n   721→        console.error('[SPLICE] initGoButton FAILED: #goBtn element not found in DOM');\n   722→        console.error('[SPLICE] Check that index.html contains <button id=\"goBtn\">');\n   723→        return;\n   724→    }\n   725→\n   726→    ui.goBtn.addEventListener('click', async () => {\n   727→        if (isOperationInProgress) return;\n   728→        await runDetection();\n   729→    });\n   730→    console.log('[SPLICE] initGoButton: GO button initialized successfully');\n   731→}\n   732→\n   733→async function runDetection() {\n   734→    if (isOperationInProgress) return;\n   735→\n   736→    // Check sequence with enhanced error messaging\n   737→    const hasSequence = await checkSequenceOpen();\n   738→    if (!hasSequence) {\n   739→        // Check if there was a communication error vs just no sequence\n   740→        const lastError = window.spliceState.lastSequenceCheckError;\n   741→        if (lastError && (lastError.includes('CEP') || lastError.includes('communication') || lastError.includes('evalScript'))) {\n   742→            setStatus('Premiere Pro connection issue - try reopening panel', true);\n   743→            console.error('[SPLICE] runDetection: JSX communication failure:', lastError);\n   744→        } else {\n   745→            setStatus('Please open a sequence in the Timeline first', true);\n   746→            debugLog('runDetection: No active sequence in Timeline');\n   747→        }\n   748→        // Clear the error for next check\n   749→        window.spliceState.lastSequenceCheckError = null;\n   750→        return;\n   751→    }\n   752→\n   753→    // Check online\n   754→    if (!isOnline()) {\n   755→        setStatus('Offline - Check your connection', true);\n   756→        return;\n   757→    }\n   758→\n   759→    isOperationInProgress = true;\n   760→    ui.goBtn.disabled = true;\n   761→    showProgress('Detecting silences...');\n   762→\n   763→    try {\n   764→        const settings = getSettings();\n   765→\n   766→        // Get sequence info\n   767→        const seqInfo = await jsx.call('getActiveSequence');\n   768→        debugLog('Sequence info:', seqInfo);\n   769→\n   770→        // Store sequence info for later use\n   771→        currentSequenceInfo = seqInfo;\n   772→        window.spliceState.activeSequence = seqInfo;\n   773→        if (seqInfo && seqInfo.videoPath) {\n   774→            window.spliceState.currentVideoPath = seqInfo.videoPath;\n   775→        }\n   776→\n   777→        // Export audio via JSX for silence detection\n   778→        updateProgress(10, 'Exporting audio...');\n   779→\n   780→        let audioFilePath = null;\n   781→        try {\n   782→            // Get sequence info for audio export\n   783→            const exportResult = await jsx.call('exportSequenceAudioForAnalysis');\n   784→            if (exportResult && exportResult.success && exportResult.outputPath) {\n   785→                audioFilePath = exportResult.outputPath;\n   786→                debugLog('Audio exported to:', audioFilePath);\n   787→            } else if (exportResult && exportResult.error) {\n   788→                throw new Error(exportResult.error);\n   789→            }\n   790→        } catch (exportError) {\n   791→            console.warn('[SPLICE] Audio export failed, trying fallback:', exportError.message);\n   792→            // Try to get audio from first clip in timeline\n   793→            try {\n   794→                const clipInfo = await jsx.call('getFirstClipAudioPath');\n   795→                if (clipInfo && clipInfo.path) {\n   796→                    audioFilePath = clipInfo.path;\n   797→                    debugLog('Using clip audio path:', audioFilePath);\n   798→                }\n   799→            } catch (clipError) {\n   800→                console.warn('[SPLICE] Fallback audio path failed:', clipError.message);\n   801→            }\n   802→        }\n   803→\n   804→        if (!audioFilePath) {\n   805→            throw new Error('Could not export or locate audio file. Please ensure sequence has audio tracks.');\n   806→        }\n   807→\n   808→        // Store audio path globally for other modules\n   809→        currentAudioPath = audioFilePath;\n   810→        window.spliceState.audioPath = audioFilePath;\n   811→\n   812→        // Call backend for silence detection with audio file path\n   813→        updateProgress(30, 'Detecting silences...');\n   814→        const silenceResponse = await fetchWithTimeout(\n   815→            `${getBackendUrl()}/silences-rms`,\n   816→            {\n   817→                method: 'POST',\n   818→                headers: getAuthHeaders(),\n   819→                body: JSON.stringify({\n   820→                    wavPath: audioFilePath,\n   821→                    sensitivity: settings.sensitivity,\n   822→                    minSilenceLength: settings.minSilenceLength || 0.5\n   823→                })\n   824→            }\n   825→        );\n   826→\n   827→        if (!silenceResponse.ok) {\n   828→            throw new Error(await parseErrorResponse(silenceResponse));\n   829→        }\n   830→\n   831→        const silenceData = await silenceResponse.json();\n   832→        previewSilences = silenceData.silences || [];\n   833→\n   834→        // Detect takes if enabled\n   835→        if (settings.enableTakesDetection) {\n   836→            updateProgress(60, 'Detecting takes...');\n   837→            try {\n   838→                const analyzeResponse = await fetchWithTimeout(\n   839→                    `${getBackendUrl()}/analyze`,\n   840→                    {\n   841→                        method: 'POST',\n   842→                        headers: getAuthHeaders(),\n   843→                        body: JSON.stringify({\n   844→                            wavPath: audioFilePath,\n   845→                            detectTakes: true\n   846→                        })\n   847→                    }\n   848→                );\n   849→\n   850→                if (analyzeResponse.ok) {\n   851→                    const analyzeData = await analyzeResponse.json();\n   852→                    previewTakes = analyzeData.takes || [];\n   853→\n   854→                    // Store transcript for captions/music modules\n   855→                    if (analyzeData.transcript) {\n   856→                        currentTranscript = analyzeData.transcript;\n   857→                        window.currentTranscript = analyzeData.transcript;\n   858→                        window.spliceState.lastTranscript = analyzeData.transcript;\n   859→                    }\n   860→                } else {\n   861→                    // Handle specific error codes\n   862→                    const errorMsg = await parseErrorResponse(analyzeResponse);\n   863→                    if (analyzeResponse.status === 402) {\n   864→                        console.warn('[SPLICE] Takes detection skipped: insufficient credits');\n   865→                        setStatus('Takes detection skipped: insufficient credits', true);\n   866→                    } else if (analyzeResponse.status === 401) {\n   867→                        console.warn('[SPLICE] Takes detection skipped: authentication required');\n   868→                    } else {\n   869→                        console.warn('[SPLICE] Takes detection failed:', errorMsg);\n   870→                    }\n   871→                }\n   872→            } catch (e) {\n   873→                console.warn('[SPLICE] Takes detection failed:', e.message);\n   874→            }\n   875→        }\n   876→\n   877→        // Detect profanity if enabled\n   878→        if (settings.enableProfanity) {\n   879→            updateProgress(65, 'Detecting profanity...');\n   880→            try {\n   881→                const profanityResponse = await fetchWithTimeout(\n   882→                    `${getBackendUrl()}/profanity`,\n   883→                    {\n   884→                        method: 'POST',\n   885→                        headers: getAuthHeaders(),\n   886→                        body: JSON.stringify({\n   887→                            wavPath: audioFilePath,\n   888→                            language: settings.profanityLanguage || 'en',\n   889→                            bleepType: settings.bleepType || 'standard'\n   890→                        })\n   891→                    }\n   892→                );\n   893→\n   894→                if (profanityResponse.ok) {\n   895→                    const profanityData = await profanityResponse.json();\n   896→                    // Backend returns 'words' array, not 'instances'\n   897→                    currentProfanity = profanityData.words || profanityData.instances || [];\n   898→                    if (currentProfanity.length > 0) {\n   899→                        debugLog(`Found ${currentProfanity.length} profanity instances`);\n   900→                    }\n   901→                } else {\n   902→                    console.warn('[SPLICE] Profanity detection failed:', await parseErrorResponse(profanityResponse));\n   903→                }\n   904→            } catch (e) {\n   905→                console.warn('[SPLICE] Profanity detection failed:', e.message);\n   906→            }\n   907→        }\n   908→\n   909→        // Detect chapters if enabled\n   910→        if (settings.enableChapters) {\n   911→            updateProgress(80, 'Detecting chapters...');\n   912→            try {\n   913→                const chapterResponse = await fetchWithTimeout(\n   914→                    `${getBackendUrl()}/chapters`,\n   915→                    {\n   916→                        method: 'POST',\n   917→                        headers: getAuthHeaders(),\n   918→                        body: JSON.stringify({\n   919→                            wavPath: audioFilePath,\n   920→                            transcript: currentTranscript,\n   921→                            maxChapters: settings.maxChapters || 10,\n   922→                            minChapterLength: settings.minChapterLength || 60\n   923→                        })\n   924→                    }\n   925→                );\n   926→\n   927→                if (chapterResponse.ok) {\n   928→                    const chapterData = await chapterResponse.json();\n   929→                    currentChapters = chapterData.chapters || [];\n   930→                } else {\n   931→                    const errorMsg = await parseErrorResponse(chapterResponse);\n   932→                    console.warn('[SPLICE] Chapter detection failed:', errorMsg);\n   933→                    // Don't block workflow, just notify user\n   934→                    setStatus('Chapter detection skipped: ' + errorMsg, true);\n   935→                }\n   936→            } catch (e) {\n   937→                console.warn('[SPLICE] Chapter detection failed:', e);\n   938→                setStatus('Chapter detection failed - continuing without chapters', true);\n   939→            }\n   940→        }\n   941→\n   942→        // Detect zoom points if enabled\n   943→        if (settings.enableZoom) {\n   944→            updateProgress(90, 'Detecting zoom points...');\n   945→            try {\n   946→                const zoomResponse = await fetchWithTimeout(\n   947→                    `${getBackendUrl()}/zoom`,\n   948→                    {\n   949→                        method: 'POST',\n   950→                        headers: getAuthHeaders(),\n   951→                        body: JSON.stringify({\n   952→                            wavPath: audioFilePath,\n   953→                            transcript: currentTranscript,\n   954→                            frequency: settings.zoomFrequency || 'medium',\n   955→                            preset: settings.zoomPreset || 'medium',\n   956→                            placement: settings.zoomPlacement || 'sentence_start'\n   957→                        })\n   958→                    }\n   959→                );\n   960→\n   961→                if (zoomResponse.ok) {\n   962→                    const zoomData = await zoomResponse.json();\n   963→                    currentZooms = zoomData.zoomPoints || [];\n   964→                } else {\n   965→                    const errorMsg = await parseErrorResponse(zoomResponse);\n   966→                    console.warn('[SPLICE] Zoom detection failed:', errorMsg);\n   967→                    setStatus('Zoom detection skipped: ' + errorMsg, true);\n   968→                }\n   969→            } catch (e) {\n   970→                console.warn('[SPLICE] Zoom detection failed:', e);\n   971→                setStatus('Zoom detection failed - continuing without zoom points', true);\n   972→            }\n   973→        }\n   974→\n   975→        // Store results\n   976→        lastDetectionResult = {\n   977→            silences: previewSilences,\n   978→            takes: previewTakes,\n   979→            chapters: currentChapters,\n   980→            zooms: currentZooms\n   981→        };\n   982→\n   983→        // Show preview\n   984→        hideProgress();\n   985→        showCombinedPreview();\n   986→        setStatus(`Found ${previewSilences.length} silences, ${previewTakes.length} takes`);\n   987→\n   988→    } catch (error) {\n   989→        console.error('[SPLICE] Detection error:', error);\n   990→        setStatus('Detection failed: ' + error.message, true);\n   991→        hideProgress();\n   992→    } finally {\n   993→        isOperationInProgress = false;\n   994→        ui.goBtn.disabled = false;\n   995→    }\n   996→}\n   997→\n   998→// ============================================================================\n   999→// PROGRESS UI\n  1000→// ============================================================================\n  1001→function showProgress(message) {\n  1002→    if (ui.progressContainer) ui.progressContainer.classList.remove('hidden');\n  1003→    if (ui.resultsEmpty) ui.resultsEmpty.classList.add('hidden');\n  1004→    if (ui.combinedPreview) ui.combinedPreview.classList.add('hidden');\n  1005→    updateProgress(0, message);\n  1006→}\n  1007→\n  1008→function updateProgress(percent, message) {\n  1009→    if (ui.progressBar) ui.progressBar.style.width = percent + '%';\n  1010→    if (ui.progressText) ui.progressText.textContent = message || '';\n  1011→}\n  1012→\n  1013→function hideProgress() {\n  1014→    if (ui.progressContainer) ui.progressContainer.classList.add('hidden');\n  1015→}\n  1016→\n  1017→// ============================================================================\n  1018→// COMBINED PREVIEW\n  1019→// ============================================================================\n  1020→function showCombinedPreview() {\n  1021→    if (!ui.combinedPreview) return;\n  1022→\n  1023→    ui.combinedPreview.classList.remove('hidden');\n  1024→    if (ui.resultsEmpty) ui.resultsEmpty.classList.add('hidden');\n  1025→\n  1026→    // Update counts\n  1027→    if (ui.silenceCount) ui.silenceCount.textContent = previewSilences.length;\n  1028→    if (ui.takeCount) ui.takeCount.textContent = previewTakes.length;\n  1029→\n  1030→    // Select all by default\n  1031→    selectedSilenceIndices.clear();\n  1032→    previewSilences.forEach((_, i) => selectedSilenceIndices.add(i));\n  1033→    updateSelectedCount();\n  1034→\n  1035→    // Render preview list\n  1036→    renderPreviewList();\n  1037→\n  1038→    // Show chapter results if available\n  1039→    if (currentChapters.length > 0 && ui.chapterResults) {\n  1040→        ui.chapterResults.classList.remove('hidden');\n  1041→        renderChapterList();\n  1042→    }\n  1043→\n  1044→    // Show zoom results if available\n  1045→    if (currentZooms.length > 0 && ui.zoomResults) {\n  1046→        ui.zoomResults.classList.remove('hidden');\n  1047→    }\n  1048→}\n  1049→\n  1050→function renderPreviewList() {\n  1051→    if (!ui.previewList) return;\n  1052→\n  1053→    const html = [];\n  1054→\n  1055→    // Render silences\n  1056→    previewSilences.forEach((silence, i) => {\n  1057→        const isSelected = selectedSilenceIndices.has(i);\n  1058→        const duration = silence.end - silence.start;\n  1059→        html.push(`\n  1060→            <div class=\"preview-item ${isSelected ? '' : 'excluded'}\" data-index=\"${i}\" data-type=\"silence\">\n  1061→                <input type=\"checkbox\" class=\"preview-item-check\" ${isSelected ? 'checked' : ''}>\n  1062→                <div class=\"preview-item-info\">\n  1063→                    <div class=\"preview-item-time\">${formatTime(silence.start)} - ${formatTime(silence.end)}</div>\n  1064→                    <div class=\"preview-item-duration\">${duration.toFixed(2)}s silence</div>\n  1065→                </div>\n  1066→            </div>\n  1067→        `);\n  1068→    });\n  1069→\n  1070→    // Render takes\n  1071→    previewTakes.forEach((take, i) => {\n  1072→        // SECURITY: Escape take label to prevent XSS\n  1073→        const safeLabel = escapeHtml(take.label || 'Take ' + (take.takeNumber || i + 1));\n  1074→        html.push(`\n  1075→            <div class=\"preview-item take-item\" data-index=\"${i}\" data-type=\"take\">\n  1076→                <div class=\"preview-item-icon\">🎬</div>\n  1077→                <div class=\"preview-item-info\">\n  1078→                    <div class=\"preview-item-time\">${formatTime(take.start)} - ${formatTime(take.end)}</div>\n  1079→                    <div class=\"preview-item-label\">${safeLabel}</div>\n  1080→                </div>\n  1081→            </div>\n  1082→        `);\n  1083→    });\n  1084→\n  1085→    ui.previewList.innerHTML = html.join('');\n  1086→\n  1087→    // Add click handlers\n  1088→    ui.previewList.querySelectorAll('.preview-item').forEach(item => {\n  1089→        item.addEventListener('click', (e) => {\n  1090→            const index = parseInt(item.dataset.index);\n  1091→            const type = item.dataset.type;\n  1092→\n  1093→            if (e.target.classList.contains('preview-item-check')) {\n  1094→                // Checkbox clicked\n  1095→                toggleSilenceSelection(index);\n  1096→            } else {\n  1097→                // Item clicked - seek to time\n  1098→                const data = type === 'silence' ? previewSilences[index] : previewTakes[index];\n  1099→                seekToTime(data.start);\n  1100→            }\n  1101→        });\n  1102→    });\n  1103→}\n  1104→\n  1105→function toggleSilenceSelection(index) {\n  1106→    if (selectedSilenceIndices.has(index)) {\n  1107→        selectedSilenceIndices.delete(index);\n  1108→    } else {\n  1109→        selectedSilenceIndices.add(index);\n  1110→    }\n  1111→    updateSelectedCount();\n  1112→    renderPreviewList();\n  1113→}\n  1114→\n  1115→function updateSelectedCount() {\n  1116→    if (ui.selectedCount) {\n  1117→        ui.selectedCount.textContent = selectedSilenceIndices.size;\n  1118→    }\n  1119→    if (ui.selectAllSilences) {\n  1120→        ui.selectAllSilences.checked = selectedSilenceIndices.size === previewSilences.length;\n  1121→    }\n  1122→}\n  1123→\n  1124→async function seekToTime(seconds) {\n  1125→    try {\n  1126→        // Check if there's an active sequence before seeking\n  1127→        if (!app?.project?.activeSequence) {\n  1128→            debugLog('No active sequence to seek in');\n  1129→            return;\n  1130→        }\n  1131→        // Use JSX to set playhead position\n  1132→        // Note: setPlayerPosition expects ticks as a string without quotes around the number value\n  1133→        const ticks = Math.round(seconds * 254016000000);\n  1134→        await jsx.evalScript(`app.project.activeSequence.setPlayerPosition(${ticks})`);\n  1135→    } catch (e) {\n  1136→        console.warn('[SPLICE] Seek failed:', e);\n  1137→    }\n  1138→}\n  1139→\n  1140→// ============================================================================\n  1141→// CHAPTER LIST\n  1142→// ============================================================================\n  1143→function renderChapterList() {\n  1144→    if (!ui.chapterList) return;\n  1145→\n  1146→    const html = currentChapters.map((chapter, i) => {\n  1147→        // SECURITY: Escape chapter title to prevent XSS\n  1148→        const safeTitle = escapeHtml(chapter.title);\n  1149→        return `\n  1150→            <div class=\"chapter-item\" data-index=\"${i}\">\n  1151→                <div class=\"chapter-time\">${formatTime(chapter.startTime)}</div>\n  1152→                <div class=\"chapter-title\">${safeTitle}</div>\n  1153→            </div>\n  1154→        `;\n  1155→    }).join('');\n  1156→\n  1157→    ui.chapterList.innerHTML = html;\n  1158→\n  1159→    // Add click handlers\n  1160→    ui.chapterList.querySelectorAll('.chapter-item').forEach(item => {\n  1161→        item.addEventListener('click', () => {\n  1162→            const index = parseInt(item.dataset.index);\n  1163→            seekToTime(currentChapters[index].startTime);\n  1164→        });\n  1165→    });\n  1166→}\n  1167→\n  1168→// ============================================================================\n  1169→// PREVIEW HANDLERS\n  1170→// ============================================================================\n  1171→function initPreviewHandlers() {\n  1172→    // Select all checkbox\n  1173→    if (ui.selectAllSilences) {\n  1174→        ui.selectAllSilences.addEventListener('change', () => {\n  1175→            if (ui.selectAllSilences.checked) {\n  1176→                previewSilences.forEach((_, i) => selectedSilenceIndices.add(i));\n  1177→            } else {\n  1178→                selectedSilenceIndices.clear();\n  1179→            }\n  1180→            updateSelectedCount();\n  1181→            renderPreviewList();\n  1182→        });\n  1183→    }\n  1184→\n  1185→    // Apply button\n  1186→    if (ui.applyPreviewBtn) {\n  1187→        ui.applyPreviewBtn.addEventListener('click', applyPreviewAndMarkers);\n  1188→    }\n  1189→\n  1190→    // Cancel button\n  1191→    if (ui.cancelPreviewBtn) {\n  1192→        ui.cancelPreviewBtn.addEventListener('click', hidePreview);\n  1193→    }\n  1194→\n  1195→    // Build sequence button\n  1196→    if (ui.buildSequenceBtn) {\n  1197→        ui.buildSequenceBtn.addEventListener('click', buildSequence);\n  1198→    }\n  1199→\n  1200→    // Copy YouTube timestamps\n  1201→    if (ui.copyYouTubeBtn) {\n  1202→        ui.copyYouTubeBtn.addEventListener('click', copyYouTubeTimestamps);\n  1203→    }\n  1204→\n  1205→    // Add chapter markers\n  1206→    if (ui.addChapterMarkersBtn) {\n  1207→        ui.addChapterMarkersBtn.addEventListener('click', addChapterMarkers);\n  1208→    }\n  1209→\n  1210→    // Apply zoom markers\n  1211→    const applyZoomsBtn = document.getElementById('applyZoomsBtn');\n  1212→    if (applyZoomsBtn) {\n  1213→        applyZoomsBtn.addEventListener('click', applyZoomMarkers);\n  1214→    }\n  1215→}\n  1216→\n  1217→async function applyPreviewAndMarkers() {\n  1218→    if (isOperationInProgress) return;\n  1219→\n  1220→    isOperationInProgress = true;\n  1221→    setStatus('Adding markers...');\n  1222→\n  1223→    try {\n  1224→        // Add silence markers\n  1225→        const selectedSilences = previewSilences.filter((_, i) => selectedSilenceIndices.has(i));\n  1226→        for (const silence of selectedSilences) {\n  1227→            await jsx.call('createMarker', silence.start, 'SPLICE: Silence', silence.end - silence.start, null, 1);\n  1228→        }\n  1229→\n  1230→        // Add take markers\n  1231→        for (const take of previewTakes) {\n  1232→            await jsx.call('createMarker', take.start, take.label || `Take ${take.takeNumber}`, take.end - take.start, null, 5);\n  1233→        }\n  1234→\n  1235→        setStatus(`Added ${selectedSilences.length + previewTakes.length} markers`);\n  1236→    } catch (error) {\n  1237→        setStatus('Failed to add markers: ' + error.message, true);\n  1238→    } finally {\n  1239→        isOperationInProgress = false;\n  1240→    }\n  1241→}\n  1242→\n  1243→function hidePreview() {\n  1244→    if (ui.combinedPreview) ui.combinedPreview.classList.add('hidden');\n  1245→    if (ui.chapterResults) ui.chapterResults.classList.add('hidden');\n  1246→    if (ui.zoomResults) ui.zoomResults.classList.add('hidden');\n  1247→    if (ui.resultsEmpty) ui.resultsEmpty.classList.remove('hidden');\n  1248→    previewSilences = [];\n  1249→    previewTakes = [];\n  1250→    selectedSilenceIndices.clear();\n  1251→}\n  1252→\n  1253→async function buildSequence() {\n  1254→    if (isOperationInProgress) return;\n  1255→\n  1256→    isOperationInProgress = true;\n  1257→    setStatus('Building sequence...');\n  1258→\n  1259→    try {\n  1260→        const settings = getSettings();\n  1261→\n  1262→        // Ensure we have sequence info\n  1263→        if (!currentSequenceInfo) {\n  1264→            currentSequenceInfo = await jsx.call('getActiveSequence');\n  1265→        }\n  1266→\n  1267→        // Create cut list from selected silences\n  1268→        const selectedSilences = previewSilences.filter((_, i) => selectedSilenceIndices.has(i));\n  1269→\n  1270→        // Calculate total duration from sequence info or last silence\n  1271→        let duration = 0;\n  1272→        if (currentSequenceInfo && currentSequenceInfo.duration) {\n  1273→            duration = currentSequenceInfo.duration;\n  1274→        } else if (previewSilences.length > 0) {\n  1275→            const lastSilence = previewSilences[previewSilences.length - 1];\n  1276→            duration = lastSilence.end + 10; // Add buffer\n  1277→        }\n  1278→\n  1279→        // Call backend to generate cut list\n  1280→        const cutListResponse = await fetchWithTimeout(\n  1281→            `${getBackendUrl()}/cut-list`,\n  1282→            {\n  1283→                method: 'POST',\n  1284→                headers: getAuthHeaders(),\n  1285→                body: JSON.stringify({\n  1286→                    sourceName: currentSequenceInfo?.name || 'Untitled Sequence',\n  1287→                    sourcePath: currentSequenceInfo?.treePath || currentSequenceInfo?.name || 'Untitled',\n  1288→                    duration: duration,\n  1289→                    silences: selectedSilences,\n  1290→                    takes: previewTakes,\n  1291→                    enableTakes: settings.enableTakesDetection,\n  1292→                    jCutOffset: settings.enableJCut ? settings.jcutLeadIn : 0,\n  1293→                    lCutOffset: settings.enableJCut ? settings.jcutLeadOut : 0\n  1294→                })\n  1295→            }\n  1296→        );\n  1297→\n  1298→        if (!cutListResponse.ok) {\n  1299→            throw new Error(await parseErrorResponse(cutListResponse));\n  1300→        }\n  1301→\n  1302→        const cutList = await cutListResponse.json();\n  1303→\n  1304→        // Build sequence via JSX\n  1305→        const result = await jsx.call('buildSequenceFromCutList', JSON.stringify(cutList));\n  1306→\n  1307→        if (result && result.success) {\n  1308→            setStatus(`Built sequence: ${result.sequenceName}`);\n  1309→            hidePreview();\n  1310→        } else {\n  1311→            throw new Error(result?.error || 'Build failed');\n  1312→        }\n  1313→    } catch (error) {\n  1314→        setStatus('Build failed: ' + error.message, true);\n  1315→    } finally {\n  1316→        isOperationInProgress = false;\n  1317→    }\n  1318→}\n  1319→\n  1320→function copyYouTubeTimestamps() {\n  1321→    if (currentChapters.length === 0) return;\n  1322→\n  1323→    const timestamps = currentChapters.map(ch =>\n  1324→        `${formatTime(ch.startTime)} ${ch.title}`\n  1325→    ).join('\\n');\n  1326→\n  1327→    navigator.clipboard.writeText(timestamps).then(() => {\n  1328→        setStatus('Copied YouTube timestamps');\n  1329→    }).catch(() => {\n  1330→        setStatus('Failed to copy', true);\n  1331→    });\n  1332→}\n  1333→\n  1334→async function addChapterMarkers() {\n  1335→    if (isOperationInProgress || currentChapters.length === 0) return;\n  1336→\n  1337→    isOperationInProgress = true;\n  1338→    setStatus('Adding chapter markers...');\n  1339→\n  1340→    try {\n  1341→        for (const chapter of currentChapters) {\n  1342→            await jsx.call('addChapterMarker', chapter.startTime, chapter.title, chapter.description);\n  1343→        }\n  1344→        setStatus(`Added ${currentChapters.length} chapter markers`);\n  1345→    } catch (error) {\n  1346→        setStatus('Failed to add markers: ' + error.message, true);\n  1347→    } finally {\n  1348→        isOperationInProgress = false;\n  1349→    }\n  1350→}\n  1351→\n  1352→/**\n  1353→ * Apply zoom point markers to the timeline\n  1354→ */\n  1355→async function applyZoomMarkers() {\n  1356→    if (isOperationInProgress || currentZooms.length === 0) return;\n  1357→\n  1358→    isOperationInProgress = true;\n  1359→    setStatus('Adding zoom markers...');\n  1360→\n  1361→    try {\n  1362→        for (const zoom of currentZooms) {\n  1363→            // Create a marker for each zoom point with zoom intensity info\n  1364→            const comment = `Zoom ${zoom.intensity || 'medium'} - ${zoom.reason || 'emphasis'}`;\n  1365→            await jsx.call('createMarker', zoom.time, 'SPLICE: Zoom', 0.5, comment, 3);\n  1366→        }\n  1367→        setStatus(`Added ${currentZooms.length} zoom markers`);\n  1368→    } catch (error) {\n  1369→        setStatus('Failed to add zoom markers: ' + error.message, true);\n  1370→    } finally {\n  1371→        isOperationInProgress = false;\n  1372→    }\n  1373→}\n  1374→\n  1375→// ============================================================================\n  1376→// MODALS\n  1377→// ============================================================================\n  1378→function initModals() {\n  1379→    // Settings modal\n  1380→    if (ui.settingsBtn && ui.settingsModal) {\n  1381→        ui.settingsBtn.addEventListener('click', () => {\n  1382→            ui.settingsModal.classList.remove('hidden');\n  1383→            // Sync remember options checkbox with current settings\n  1384→            const rememberOptions = document.getElementById('rememberOptions');\n  1385→            if (rememberOptions) {\n  1386→                rememberOptions.checked = getSettings().rememberOptions;\n  1387→            }\n  1388→        });\n  1389→        console.log('[SPLICE] initModals: Settings button initialized');\n  1390→    } else {\n  1391→        console.error('[SPLICE] initModals: Settings modal FAILED -',\n  1392→            !ui.settingsBtn ? '#settingsBtn missing' : '',\n  1393→            !ui.settingsModal ? '#settingsModal missing' : '');\n  1394→    }\n  1395→\n  1396→    if (ui.closeSettingsBtn && ui.settingsModal) {\n  1397→        ui.closeSettingsBtn.addEventListener('click', () => {\n  1398→            ui.settingsModal.classList.add('hidden');\n  1399→        });\n  1400→    }\n  1401→\n  1402→    // Remember options checkbox\n  1403→    const rememberOptions = document.getElementById('rememberOptions');\n  1404→    if (rememberOptions) {\n  1405→        rememberOptions.addEventListener('change', () => {\n  1406→            saveSettings({ rememberOptions: rememberOptions.checked });\n  1407→            if (rememberOptions.checked) {\n  1408→                setStatus('Options will be remembered');\n  1409→            } else {\n  1410→                setStatus('Options will reset to defaults');\n  1411→            }\n  1412→        });\n  1413→    }\n  1414→\n  1415→    // Credit badge click handler (handles login, retry, and refresh)\n  1416→    if (ui.creditBadge) {\n  1417→        ui.creditBadge.addEventListener('click', () => {\n  1418→            // Use the centralized handler from credits.js\n  1419→            if (typeof handleCreditBadgeClick === 'function') {\n  1420→                handleCreditBadgeClick();\n  1421→            } else {\n  1422→                // Fallback if credits.js not loaded yet\n  1423→                const settings = getSettings();\n  1424→                if (!settings.customerId) {\n  1425→                    showLoginModal();\n  1426→                }\n  1427→            }\n  1428→        });\n  1429→        console.log('[SPLICE] initModals: Credit badge initialized');\n  1430→    } else {\n  1431→        console.error('[SPLICE] initModals: Credit badge FAILED - #creditBadge missing');\n  1432→    }\n  1433→\n  1434→    if (ui.closeLoginBtn && ui.loginModal) {\n  1435→        ui.closeLoginBtn.addEventListener('click', () => {\n  1436→            ui.loginModal.classList.add('hidden');\n  1437→        });\n  1438→    }\n  1439→\n  1440→    // Note: saveLoginBtn handler is registered in initLoginModal() (config.js)\n  1441→    // to avoid duplicate event listeners\n  1442→\n  1443→    // License lookup button\n  1444→    const lookupLicenseBtn = document.getElementById('lookupLicenseBtn');\n  1445→    if (lookupLicenseBtn) {\n  1446→        lookupLicenseBtn.addEventListener('click', lookupLicense);\n  1447→    }\n  1448→\n  1449→    // Close modals on backdrop click\n  1450→    document.querySelectorAll('.modal').forEach(modal => {\n  1451→        modal.addEventListener('click', (e) => {\n  1452→            if (e.target === modal) {\n  1453→                modal.classList.add('hidden');\n  1454→            }\n  1455→        });\n  1456→    });\n  1457→\n  1458→    // ACCESSIBILITY: Close modals on Escape key press\n  1459→    document.addEventListener('keydown', (e) => {\n  1460→        if (e.key === 'Escape') {\n  1461→            const openModal = document.querySelector('.modal:not(.hidden)');\n  1462→            if (openModal) {\n  1463→                openModal.classList.add('hidden');\n  1464→                // Announce to screen readers\n  1465→                announceToScreenReader('Dialog closed');\n  1466→            }\n  1467→        }\n  1468→    });\n  1469→}\n  1470→\n  1471→/**\n  1472→ * ACCESSIBILITY: Announce message to screen readers via ARIA live region\n  1473→ * @param {string} message - Message to announce\n  1474→ * @param {string} priority - 'polite' or 'assertive'\n  1475→ */\n  1476→function announceToScreenReader(message, priority = 'polite') {\n  1477→    // Use existing status element or create temporary one\n  1478→    const statusEl = document.getElementById('status');\n  1479→    if (statusEl && priority === 'polite') {\n  1480→        const originalText = statusEl.textContent;\n  1481→        statusEl.textContent = message;\n  1482→        // Restore after announcement\n  1483→        setTimeout(() => {\n  1484→            if (statusEl.textContent === message) {\n  1485→                statusEl.textContent = originalText;\n  1486→            }\n  1487→        }, 1000);\n  1488→        return;\n  1489→    }\n  1490→\n  1491→    // Create temporary live region for assertive announcements\n  1492→    const liveRegion = document.createElement('div');\n  1493→    liveRegion.setAttribute('role', 'alert');\n  1494→    liveRegion.setAttribute('aria-live', priority);\n  1495→    liveRegion.setAttribute('aria-atomic', 'true');\n  1496→    liveRegion.className = 'sr-only';\n  1497→    liveRegion.style.cssText = 'position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0;';\n  1498→    liveRegion.textContent = message;\n  1499→    document.body.appendChild(liveRegion);\n  1500→\n  1501→    // Remove after announcement\n  1502→    setTimeout(() => liveRegion.remove(), 1000);\n  1503→}\n  1504→\n  1505→function showLoginModal() {\n  1506→    if (ui.loginModal) ui.loginModal.classList.remove('hidden');\n  1507→}\n  1508→\n  1509→/**\n  1510→ * Show upgrade modal when user tries to access a gated feature\n  1511→ * @param {string} featureName - Display name of the feature\n  1512→ * @param {string} requiredTier - Required tier (Pro, Team)\n  1513→ */\n  1514→function showUpgradeModal(featureName, requiredTier = 'Pro') {\n  1515→    const modal = document.getElementById('upgradeModal');\n  1516→    const featureText = document.getElementById('upgradeFeatureName');\n  1517→    const tierText = document.getElementById('upgradeRequiredTier');\n  1518→\n  1519→    if (featureText) {\n  1520→        featureText.textContent = featureName;\n  1521→    }\n  1522→    if (tierText) {\n  1523→        tierText.textContent = requiredTier;\n  1524→    }\n  1525→    if (modal) {\n  1526→        modal.classList.remove('hidden');\n  1527→    }\n  1528→}\n  1529→\n  1530→/**\n  1531→ * Close the upgrade modal\n  1532→ */\n  1533→function closeUpgradeModal() {\n  1534→    const modal = document.getElementById('upgradeModal');\n  1535→    if (modal) {\n  1536→        modal.classList.add('hidden');\n  1537→    }\n  1538→}\n  1539→\n  1540→// Expose showUpgradeModal and closeUpgradeModal globally for feature modules\n  1541→window.showUpgradeModal = showUpgradeModal;\n  1542→window.closeUpgradeModal = closeUpgradeModal;\n  1543→\n  1544→async function activateLicense() {\n  1545→    if (!ui.licenseKeyInput) return;\n  1546→\n  1547→    const licenseKey = ui.licenseKeyInput.value.trim();\n  1548→    if (!licenseKey) {\n  1549→        setStatus('Please enter a license key', true);\n  1550→        return;\n  1551→    }\n  1552→\n  1553→    try {\n  1554→        const response = await fetchWithTimeout(\n  1555→            `${getBackendUrl()}/license/activate`,\n  1556→            {\n  1557→                method: 'POST',\n  1558→                headers: { 'Content-Type': 'application/json' },\n  1559→                body: JSON.stringify({ key: licenseKey })\n  1560→            }\n  1561→        );\n  1562→\n  1563→        if (!response.ok) {\n  1564→            throw new Error(await parseErrorResponse(response));\n  1565→        }\n  1566→\n  1567→        const data = await response.json();\n  1568→        saveSettings({\n  1569→            customerId: data.customerId,\n  1570→            licenseKey: licenseKey\n  1571→        });\n  1572→\n  1573→        if (ui.loginModal) ui.loginModal.classList.add('hidden');\n  1574→        setStatus('License activated');\n  1575→        updateCredits();\n  1576→    } catch (error) {\n  1577→        setStatus('Activation failed: ' + error.message, true);\n  1578→    }\n  1579→}\n  1580→\n  1581→/**\n  1582→ * Look up license key by email address\n  1583→ */\n  1584→async function lookupLicense() {\n  1585→    const lookupEmailInput = document.getElementById('lookupEmailInput');\n  1586→    const licenseKeyInput = document.getElementById('licenseKeyInput');\n  1587→\n  1588→    if (!lookupEmailInput) return;\n  1589→\n  1590→    const email = lookupEmailInput.value.trim().toLowerCase();\n  1591→    if (!email) {\n  1592→        setStatus('Please enter your email address', true);\n  1593→        return;\n  1594→    }\n  1595→\n  1596→    // Basic email validation\n  1597→    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n  1598→    if (!emailRegex.test(email)) {\n  1599→        setStatus('Please enter a valid email address', true);\n  1600→        return;\n  1601→    }\n  1602→\n  1603→    const lookupBtn = document.getElementById('lookupLicenseBtn');\n  1604→    if (lookupBtn) {\n  1605→        lookupBtn.disabled = true;\n  1606→        lookupBtn.textContent = 'Looking up...';\n  1607→    }\n  1608→\n  1609→    try {\n  1610→        const response = await fetchWithTimeout(\n  1611→            `${getBackendUrl()}/license/lookup`,\n  1612→            {\n  1613→                method: 'POST',\n  1614→                headers: { 'Content-Type': 'application/json' },\n  1615→                body: JSON.stringify({ email })\n  1616→            },\n  1617→            30000\n  1618→        );\n  1619→\n  1620→        const result = await response.json();\n  1621→\n  1622→        // Note: For security, the backend does NOT return the license key directly.\n  1623→        // It sends the key via email to prevent enumeration attacks.\n  1624→        if (result.success) {\n  1625→            setStatus(result.message || 'If a license exists, it has been sent to your email.');\n  1626→        } else {\n  1627→            setStatus(result.error || 'Lookup failed. Please try again.', true);\n  1628→        }\n  1629→    } catch (error) {\n  1630→        setStatus('Lookup failed: ' + error.message, true);\n  1631→    } finally {\n  1632→        if (lookupBtn) {\n  1633→            lookupBtn.disabled = false;\n  1634→            lookupBtn.textContent = 'Lookup';\n  1635→        }\n  1636→    }\n  1637→}\n  1638→\n  1639→// ============================================================================\n  1640→// CREDITS\n  1641→// ============================================================================\n  1642→function initCredits() {\n  1643→    updateCredits();\n  1644→}\n  1645→\n  1646→async function updateCredits() {\n  1647→    if (!ui.creditBadge) return;\n  1648→\n  1649→    const settings = getSettings();\n  1650→    if (!settings.customerId) {\n  1651→        ui.creditBadge.className = 'credit-badge login';\n  1652→        ui.creditBadge.textContent = 'Login';\n  1653→        ui.creditBadge.style.display = 'flex';\n  1654→        return;\n  1655→    }\n  1656→\n  1657→    try {\n  1658→        const response = await fetchWithTimeout(\n  1659→            `${getBackendUrl()}/credits`,\n  1660→            {\n  1661→                method: 'GET',\n  1662→                headers: getAuthHeaders()\n  1663→            }\n  1664→        );\n  1665→\n  1666→        if (response.ok) {\n  1667→            const data = await response.json();\n  1668→            // Backend returns hoursRemaining (not remainingMinutes)\n  1669→            const hours = (data.hoursRemaining || 0).toFixed(1);\n  1670→            ui.creditBadge.textContent = `${hours}h`;\n  1671→            // Low warning when less than 1 hour remaining\n  1672→            ui.creditBadge.className = data.hoursRemaining < 1 ? 'credit-badge low' : 'credit-badge ok';\n  1673→            ui.creditBadge.style.display = 'flex';\n  1674→        } else {\n  1675→            ui.creditBadge.className = 'credit-badge error';\n  1676→            ui.creditBadge.textContent = 'Error';\n  1677→            ui.creditBadge.style.display = 'flex';\n  1678→        }\n  1679→    } catch {\n  1680→        ui.creditBadge.className = 'credit-badge error';\n  1681→        ui.creditBadge.textContent = 'Offline';\n  1682→        ui.creditBadge.style.display = 'flex';\n  1683→    }\n  1684→}\n  1685→\n  1686→// ============================================================================\n  1687→// HELP BUTTON\n  1688→// ============================================================================\n  1689→function initHelpButton() {\n  1690→    const helpBtn = document.getElementById('helpBtn');\n  1691→    if (helpBtn) {\n  1692→        helpBtn.addEventListener('click', () => {\n  1693→            setStatus('Silence: removes quiet gaps | Takes: detects repeated content | Chapters: AI topic segmentation');\n  1694→        });\n  1695→    }\n  1696→}\n  1697→\n  1698→// ============================================================================\n  1699→// DEBUG MODAL\n  1700→// ============================================================================\n  1701→function initDebugModal() {\n  1702→    if (!ui.debugBtn || !ui.debugModal) {\n  1703→        console.error('[SPLICE] initDebugModal FAILED: Missing elements -',\n  1704→            !ui.debugBtn ? '#debugBtn' : '',\n  1705→            !ui.debugModal ? '#debugModal' : '');\n  1706→        return;\n  1707→    }\n  1708→\n  1709→    // Open debug modal\n  1710→    ui.debugBtn.addEventListener('click', () => {\n  1711→        ui.debugModal.classList.remove('hidden');\n  1712→        // Clear previous logs and show placeholder\n  1713→        if (ui.debugLogs) {\n  1714→            ui.debugLogs.innerHTML = '<p class=\"debug-placeholder\">Click \"Run Diagnostics\" to collect diagnostic information.</p>';\n  1715→        }\n  1716→        if (ui.debugQuickDiagnosis) {\n  1717→            ui.debugQuickDiagnosis.textContent = 'Click \"Run Diagnostics\" to check';\n  1718→        }\n  1719→    });\n  1720→\n  1721→    // Close debug modal\n  1722→    if (ui.closeDebugBtn) {\n  1723→        ui.closeDebugBtn.addEventListener('click', () => {\n  1724→            ui.debugModal.classList.add('hidden');\n  1725→        });\n  1726→    }\n  1727→\n  1728→    // Run diagnostics button\n  1729→    if (ui.runDiagnosticsBtn) {\n  1730→        ui.runDiagnosticsBtn.addEventListener('click', async () => {\n  1731→            await runDiagnostics();\n  1732→        });\n  1733→    }\n  1734→\n  1735→    // Copy diagnostics button\n  1736→    if (ui.copyDiagnosticsBtn) {\n  1737→        ui.copyDiagnosticsBtn.addEventListener('click', () => {\n  1738→            copyDiagnosticsToClipboard();\n  1739→        });\n  1740→    }\n  1741→}\n  1742→\n  1743→// ============================================================================\n  1744→// DIAGNOSTICS\n  1745→// ============================================================================\n  1746→let diagnosticLogs = [];\n  1747→\n  1748→async function runDiagnostics() {\n  1749→    if (!ui.debugLogs || !ui.debugQuickDiagnosis) return;\n  1750→\n  1751→    diagnosticLogs = [];\n  1752→    ui.debugLogs.innerHTML = '<p class=\"debug-running\">Running diagnostics... Please wait...</p>';\n  1753→\n  1754→    try {\n  1755→        // Test 0: Check CEP environment\n  1756→        addDiagnosticLog('Test 0: Checking CEP environment...');\n  1757→        if (window.__adobe_cep__) {\n  1758→            addDiagnosticLog('✓ CEP runtime detected (window.__adobe_cep__ exists)');\n  1759→        } else {\n  1760→            addDiagnosticLog('✗ CEP runtime NOT detected - running in browser mode');\n  1761→        }\n  1762→\n  1763→        // Test 0.5: Basic ExtendScript test (doesn't require hostScript.jsx)\n  1764→        addDiagnosticLog('Test 0.5: Testing basic ExtendScript...');\n  1765→        try {\n  1766→            const basicResult = await jsx.evalScript('1 + 1');\n  1767→            addDiagnosticLog('✓ Basic ExtendScript works: 1+1 = ' + basicResult);\n  1768→        } catch (e) {\n  1769→            addDiagnosticLog('✗ Basic ExtendScript FAILED: ' + e.message);\n  1770→            addDiagnosticLog('  → This means Premiere Pro cannot run ANY ExtendScript');\n  1771→            addDiagnosticLog('  → Make sure CEP debug mode is enabled and Premiere was restarted');\n  1772→        }\n  1773→\n  1774→        // Test 0.6: Check if hostScript.jsx functions are loaded\n  1775→        addDiagnosticLog('Test 0.6: Checking if hostScript.jsx is loaded...');\n  1776→        try {\n  1777→            const typeofGetVersion = await jsx.evalScript('typeof getVersion');\n  1778→            if (typeofGetVersion === 'function') {\n  1779→                addDiagnosticLog('✓ hostScript.jsx is loaded (getVersion exists)');\n  1780→            } else {\n  1781→                addDiagnosticLog('✗ hostScript.jsx NOT loaded (getVersion type: ' + typeofGetVersion + ')');\n  1782→                addDiagnosticLog('  → The JSX file may not be in the correct location');\n  1783→            }\n  1784→        } catch (e) {\n  1785→            addDiagnosticLog('✗ hostScript check FAILED: ' + e.message);\n  1786→        }\n  1787→\n  1788→        // Test 1: JSX Connection\n  1789→        addDiagnosticLog('Test 1: Checking JSX connection...');\n  1790→        try {\n  1791→            const version = await jsx.call('getVersion');\n  1792→            addDiagnosticLog('✓ JSX connection OK, version: ' + version);\n  1793→        } catch (e) {\n  1794→            addDiagnosticLog('✗ JSX connection FAILED: ' + e.message);\n  1795→        }\n  1796→\n  1797→        // Test 2: Check for active sequence\n  1798→        addDiagnosticLog('Test 2: Checking for active sequence...');\n  1799→        try {\n  1800→            const hasSequence = await checkSequenceOpen(0, 0); // No retries for diagnostics\n  1801→            addDiagnosticLog('✓ checkSequenceOpen() returned: ' + hasSequence);\n  1802→        } catch (e) {\n  1803→            addDiagnosticLog('✗ checkSequenceOpen() FAILED: ' + e.message);\n  1804→        }\n  1805→\n  1806→        // Test 3: Get sequence info\n  1807→        addDiagnosticLog('Test 3: Getting sequence info...');\n  1808→        try {\n  1809→            const seqInfo = await jsx.call('getActiveSequence');\n  1810→            if (seqInfo && !seqInfo.error) {\n  1811→                addDiagnosticLog('✓ Sequence found: ' + (seqInfo.name || 'Unknown'));\n  1812→                addDiagnosticLog('  - Sequence ID: ' + (seqInfo.sequenceID || 'N/A'));\n  1813→                addDiagnosticLog('  - Duration: ' + (seqInfo.duration || 'N/A'));\n  1814→                addDiagnosticLog('  - Frame size: ' + (seqInfo.frameSizeHorizontal || 'N/A') + 'x' + (seqInfo.frameSizeVertical || 'N/A'));\n  1815→            } else {\n  1816→                addDiagnosticLog('✗ No active sequence found');\n  1817→            }\n  1818→        } catch (e) {\n  1819→            addDiagnosticLog('✗ getActiveSequence() FAILED: ' + e.message);\n  1820→        }\n  1821→\n  1822→        // Test 4: Check project sequences\n  1823→        addDiagnosticLog('Test 4: Checking all project sequences...');\n  1824→        try {\n  1825→            const sequences = await jsx.call('getAllSequences');\n  1826→            if (sequences && sequences.length > 0) {\n  1827→                addDiagnosticLog('✓ Total sequences in project: ' + sequences.length);\n  1828→                sequences.forEach((seq, i) => {\n  1829→                    addDiagnosticLog('  - Sequence ' + i + ': ' + (seq.name || 'Unnamed'));\n  1830→                });\n  1831→            } else {\n  1832→                addDiagnosticLog('✗ No sequences found in project');\n  1833→            }\n  1834→        } catch (e) {\n  1835→            addDiagnosticLog('✗ getAllSequences() FAILED: ' + e.message);\n  1836→        }\n  1837→\n  1838→        // Test 5: Check for active sequence via DOM\n  1839→        addDiagnosticLog('Test 5: Checking app.project.activeSequence...');\n  1840→        try {\n  1841→            const result = await jsx.evalScript(`\n  1842→                (function() {\n  1843→                    try {\n  1844→                        if (app && app.project && app.project.activeSequence) {\n  1845→                            return JSON.stringify({\n  1846→                                success: true,\n  1847→                                name: app.project.activeSequence.name,\n  1848→                                id: app.project.activeSequence.sequenceID\n  1849→                            });\n  1850→                        } else {\n  1851→                            return JSON.stringify({\n  1852→                                success: false,\n  1853→                                reason: app ? (app.project ? 'app.project.activeSequence is null' : 'app.project is null') : 'app is null'\n  1854→                            });\n  1855→                        }\n  1856→                    } catch (e) {\n  1857→                        return JSON.stringify({ success: false, reason: 'Error: ' + e.message });\n  1858→                    }\n  1859→                })()\n  1860→            `);\n  1861→            const data = JSON.parse(result);\n  1862→            if (data.success) {\n  1863→                addDiagnosticLog('✓ app.project.activeSequence found: ' + data.name + ' (ID: ' + data.id + ')');\n  1864→            } else {\n  1865→                addDiagnosticLog('✗ app.project.activeSequence NOT found: ' + data.reason);\n  1866→            }\n  1867→        } catch (e) {\n  1868→            addDiagnosticLog('✗ DOM check FAILED: ' + e.message);\n  1869→        }\n  1870→\n  1871→        // Test 6: Check QE DOM availability\n  1872→        addDiagnosticLog('Test 6: Checking QE DOM availability...');\n  1873→        try {\n  1874→            const qeResult = await jsx.evalScript(`\n  1875→                (function() {\n  1876→                    try {\n  1877→                        if (typeof qe !== 'undefined' && qe !== null) {\n  1878→                            return JSON.stringify({ available: true });\n  1879→                        } else {\n  1880→                            return JSON.stringify({ available: false });\n  1881→                        }\n  1882→                    } catch (e) {\n  1883→                        return JSON.stringify({ available: false, error: e.message });\n  1884→                    }\n  1885→                })()\n  1886→            `);\n  1887→            const qeData = JSON.parse(qeResult);\n  1888→            if (qeData.available) {\n  1889→                addDiagnosticLog('✓ QE DOM is available');\n  1890→            } else {\n  1891→                addDiagnosticLog('✗ QE DOM is NOT available' + (qeData.error ? ': ' + qeData.error : ''));\n  1892→            }\n  1893→        } catch (e) {\n  1894→            addDiagnosticLog('✗ QE DOM check FAILED: ' + e.message);\n  1895→        }\n  1896→\n  1897→        // Display quick diagnosis\n  1898→        updateQuickDiagnosis();\n  1899→\n  1900→        // Display all logs\n  1901→        displayDiagnosticLogs();\n  1902→\n  1903→    } catch (error) {\n  1904→        addDiagnosticLog('DIAGNOSTICS ERROR: ' + error.message);\n  1905→        displayDiagnosticLogs();\n  1906→    }\n  1907→}\n  1908→\n  1909→function addDiagnosticLog(message) {\n  1910→    diagnosticLogs.push(message);\n  1911→    console.log('[SPLICE DEBUG] ' + message);\n  1912→}\n  1913→\n  1914→function displayDiagnosticLogs() {\n  1915→    if (!ui.debugLogs) return;\n  1916→\n  1917→    const html = diagnosticLogs.map(log => {\n  1918→        return `<div class=\"debug-log-entry\">${escapeHtml(log)}</div>`;\n  1919→    }).join('');\n  1920→\n  1921→    ui.debugLogs.innerHTML = html;\n  1922→}\n  1923→\n  1924→function updateQuickDiagnosis() {\n  1925→    if (!ui.debugQuickDiagnosis) return;\n  1926→\n  1927→    const logs = diagnosticLogs.join(' ');\n  1928→    let diagnosis = '';\n  1929→    let solution = '';\n  1930→\n  1931→    // Analyze logs for common issues\n  1932→    if (logs.includes('JSX connection FAILED')) {\n  1933→        diagnosis = '❌ JSX Connection Failed';\n  1934→        solution = 'The panel cannot communicate with Premiere Pro. Try: 1) Close and reopen the panel, 2) Restart Premiere Pro, 3) Check if plugin is properly installed.';\n  1935→    } else if (logs.includes('checkSequenceOpen() returned: false') && logs.includes('No active sequence found')) {\n  1936→        diagnosis = '❌ No Active Sequence';\n  1937→        solution = 'No sequence is active in the Timeline. Double-click a sequence in the Project panel to open it in the Timeline.';\n  1938→    } else if (logs.includes('app.project.activeSequence NOT found') && logs.includes('Sequence found')) {\n  1939→        diagnosis = '❌ Sequence Not Active';\n  1940→        solution = 'A sequence exists but is not the active sequence. Click on the sequence tab in the Timeline to make it active.';\n  1941→    } else if (logs.includes('checkSequenceOpen() returned: true') && logs.includes('app.project.activeSequence found')) {\n  1942→        diagnosis = '✅ Everything Looks Good';\n  1943→        solution = 'The plugin is working correctly. The sequence is detected and active. Try pressing GO again.';\n  1944→    } else if (logs.includes('No sequences found in project')) {\n  1945→        diagnosis = '❌ No Sequences in Project';\n  1946→        solution = 'Create a sequence in Premiere Pro first (File > New > Sequence), then open it in the Timeline.';\n  1947→    } else {\n  1948→        diagnosis = '⚠️ Unknown Issue';\n  1949→        solution = 'Copy the diagnostic logs below and send them to support for further assistance.';\n  1950→    }\n  1951→\n  1952→    ui.debugQuickDiagnosis.innerHTML = `\n  1953→        <div class=\"diagnosis-result\">\n  1954→            <div class=\"diagnosis-title\">${diagnosis}</div>\n  1955→            <div class=\"diagnosis-solution\">${solution}</div>\n  1956→        </div>\n  1957→    `;\n  1958→}\n  1959→\n  1960→function copyDiagnosticsToClipboard() {\n  1961→    const text = diagnosticLogs.join('\\n');\n  1962→    navigator.clipboard.writeText(text).then(() => {\n  1963→        if (ui.copyDiagnosticsBtn) {\n  1964→            ui.copyDiagnosticsBtn.textContent = 'Copied!';\n  1965→            setTimeout(() => {\n  1966→                ui.copyDiagnosticsBtn.textContent = 'Copy to Clipboard';\n  1967→            }, 2000);\n  1968→        }\n  1969→    }).catch(err => {\n  1970→        setStatus('Failed to copy: ' + err.message, true);\n  1971→    });\n  1972→}\n  1973→\n  1974→// Export for debugging\n  1975→window.spliceDebug = {\n  1976→    getState: () => ({\n  1977→        silences: previewSilences,\n  1978→        takes: previewTakes,\n  1979→        chapters: currentChapters,\n  1980→        zooms: currentZooms,\n  1981→        selected: Array.from(selectedSilenceIndices)\n  1982→    }),\n  1983→    jsx,\n  1984→    runDetection\n  1985→};\n  1986→\n\n</system-reminder>\n"}]},"uuid":"4702be7d-7c58-46f4-9c1f-14dd72615394","timestamp":"2026-01-12T09:17:48.515Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/SPLICE/splice-cep/panel/js/main.js","content":"/**\n * SPLICE CEP Panel - Main Entry Point\n * v4.0.0 - CEP Migration\n */\n\n// ============================================================================\n// CACHED DOM ELEMENTS\n// ============================================================================\nconst ui = {};\n\nfunction cacheUIElements() {\n    ui.status = document.getElementById('status');\n    ui.goBtn = document.getElementById('goBtn');\n    ui.optionsToggle = document.getElementById('optionsToggle');\n    ui.optionsPanel = document.getElementById('optionsPanel');\n\n    // DIAGNOSTIC: Log critical element status immediately\n    const criticalElements = {\n        'status': ui.status,\n        'goBtn': ui.goBtn,\n        'optionsToggle': ui.optionsToggle,\n        'optionsPanel': ui.optionsPanel\n    };\n    const missingCritical = Object.entries(criticalElements)\n        .filter(([name, el]) => !el)\n        .map(([name]) => name);\n\n    if (missingCritical.length > 0) {\n        console.error('[SPLICE] CRITICAL: Missing UI elements during cache:', missingCritical);\n        console.error('[SPLICE] DOM readyState:', document.readyState);\n    }\n\n    // Sliders and options\n    ui.sensitivitySlider = document.getElementById('sensitivitySlider');\n    ui.sensitivityValue = document.getElementById('sensitivityValue');\n    ui.sourceOriginal = document.getElementById('sourceOriginal');\n    ui.sourceIsolated = document.getElementById('sourceIsolated');\n\n    // Feature toggles\n    ui.enableTakesDetection = document.getElementById('enableTakesDetection');\n    ui.enableJCut = document.getElementById('enableJCut');\n    ui.jcutSettings = document.getElementById('jcutSettings');\n    ui.jcutLeadIn = document.getElementById('jcutLeadIn');\n    ui.jcutLeadInValue = document.getElementById('jcutLeadInValue');\n    ui.jcutLeadOut = document.getElementById('jcutLeadOut');\n    ui.jcutLeadOutValue = document.getElementById('jcutLeadOutValue');\n\n    // Zoom settings\n    ui.enableZoom = document.getElementById('enableZoom');\n    ui.zoomSettings = document.getElementById('zoomSettings');\n    ui.zoomFrequency = document.getElementById('zoomFrequency');\n    ui.zoomPreset = document.getElementById('zoomPreset');\n    ui.zoomPlacement = document.getElementById('zoomPlacement');\n\n    // Chapter settings\n    ui.enableChapters = document.getElementById('enableChapters');\n    ui.chapterSettings = document.getElementById('chapterSettings');\n    ui.maxChapters = document.getElementById('maxChapters');\n    ui.minChapterLength = document.getElementById('minChapterLength');\n\n    // Profanity settings\n    ui.enableProfanity = document.getElementById('enableProfanity');\n    ui.profanitySettings = document.getElementById('profanitySettings');\n\n    // Filler word settings\n    ui.enableFillerDetection = document.getElementById('enableFillerDetection');\n    ui.fillerSettings = document.getElementById('fillerSettings');\n\n    // Progress\n    ui.progressContainer = document.getElementById('progressContainer');\n    ui.progressBar = document.getElementById('progressBar');\n    ui.progressText = document.getElementById('progressText');\n    ui.resultsEmpty = document.getElementById('resultsEmpty');\n\n    // Preview\n    ui.combinedPreview = document.getElementById('combinedPreview');\n    ui.previewList = document.getElementById('previewList');\n    ui.silenceCount = document.getElementById('silenceCount');\n    ui.takeCount = document.getElementById('takeCount');\n    ui.selectedCount = document.getElementById('selectedCount');\n    ui.selectAllSilences = document.getElementById('selectAllSilences');\n    ui.applyPreviewBtn = document.getElementById('applyPreviewBtn');\n    ui.cancelPreviewBtn = document.getElementById('cancelPreviewBtn');\n    ui.buildSequenceBtn = document.getElementById('buildSequenceBtn');\n\n    // Results\n    ui.zoomResults = document.getElementById('zoomResults');\n    ui.zoomList = document.getElementById('zoomList');\n    ui.chapterResults = document.getElementById('chapterResults');\n    ui.chapterList = document.getElementById('chapterList');\n    ui.copyYouTubeBtn = document.getElementById('copyYouTubeBtn');\n    ui.addChapterMarkersBtn = document.getElementById('addChapterMarkersBtn');\n\n    // Modals\n    ui.settingsBtn = document.getElementById('settingsBtn');\n    ui.settingsModal = document.getElementById('settingsModal');\n    ui.closeSettingsBtn = document.getElementById('closeSettingsBtn');\n    ui.loginModal = document.getElementById('loginModal');\n    ui.closeLoginBtn = document.getElementById('closeLoginBtn');\n    ui.licenseKeyInput = document.getElementById('licenseKeyInput');\n    ui.saveLoginBtn = document.getElementById('saveLoginBtn');\n\n    // Debug modal\n    ui.debugBtn = document.getElementById('debugBtn');\n    ui.debugModal = document.getElementById('debugModal');\n    ui.closeDebugBtn = document.getElementById('closeDebugBtn');\n    ui.debugQuickDiagnosis = document.getElementById('debugQuickDiagnosis');\n    ui.debugLogs = document.getElementById('debugLogs');\n    ui.runDiagnosticsBtn = document.getElementById('runDiagnosticsBtn');\n    ui.copyDiagnosticsBtn = document.getElementById('copyDiagnosticsBtn');\n\n    // Credit badge\n    ui.creditBadge = document.getElementById('creditBadge');\n\n    // Preset selector\n    ui.presetSelector = document.getElementById('presetSelector');\n}\n\n// ============================================================================\n// STATE MANAGEMENT\n// ============================================================================\nlet previewSilences = [];\nlet previewTakes = [];\nlet currentChapters = [];\nlet currentZooms = [];\nlet currentProfanity = [];\nlet selectedSilenceIndices = new Set();\nlet isOperationInProgress = false;\nlet lastDetectionResult = null;\nlet currentAudioPath = null;\nlet currentSequenceInfo = null;\nlet currentTranscript = null;\n\n// Global state for captions/reframe modules\nwindow.spliceState = {\n    lastTranscript: null,\n    currentVideoPath: null,\n    activeSequence: null,\n    audioPath: null\n};\n\n// Also expose transcript globally for music module\nwindow.currentTranscript = null;\n\n// ============================================================================\n// INITIALIZATION\n// ============================================================================\ndocument.addEventListener('DOMContentLoaded', async () => {\n    // Premium Loading Experience\n    setTimeout(() => {\n        const loader = document.getElementById('loading-overlay');\n        if (loader) loader.classList.add('hidden');\n    }, 800); // Small delay for smooth perception\n    debugLog('Initializing CEP panel...');\n\n    // Debug: Show init started\n    const statusEl = document.getElementById('status');\n    if (statusEl) statusEl.textContent = 'Initializing...';\n\n    // Cache DOM elements\n    cacheUIElements();\n\n    // Load settings\n    loadSettingsToUI();\n\n    // Initialize UI handlers\n    initOptionsToggle();\n    initSliders();\n    initFeatureToggles();\n    initPresetSelector();\n    initGoButton();\n    initPreviewHandlers();\n    initModals();\n    initLoginModal();\n    initCredits();\n    initHelpButton();\n    initDebugModal();\n\n    // Initialize offline detection\n    if (typeof initOfflineDetection === 'function') {\n        initOfflineDetection();\n    }\n\n    // Initialize multitrack UI\n    if (typeof initMultitrackUI === 'function') {\n        initMultitrackUI();\n    }\n\n    // Initialize animated captions UI\n    if (typeof initAnimatedCaptions === 'function') {\n        initAnimatedCaptions();\n    }\n\n    // Initialize text editor UI\n    if (typeof initTextEditor === 'function') {\n        initTextEditor();\n    }\n\n    // Initialize text editor section toggle\n    initTextEditorToggle();\n\n    // Initialize social reframe UI\n    if (typeof initSocialReframe === 'function') {\n        initSocialReframe();\n    }\n\n    // Initialize social reframe section toggle\n    initSocialReframeToggle();\n\n    // Initialize music UI\n    if (typeof initMusicModule === 'function') {\n        initMusicModule();\n    }\n\n    // Initialize music section toggle\n    initMusicToggle();\n\n    // Initialize JSX bridge first, then check connection\n    // This ensures jsx.init() completes before checkJSXConnection() uses it\n    await jsx.init();\n    await checkJSXConnection();\n\n    // Initialize sequence event listeners for real-time state updates\n    initSequenceEventListeners();\n\n    // DIAGNOSTIC: Verify all critical UI elements are properly initialized\n    verifyUIInitialization();\n\n    setStatus('Ready');\n    debugLog('CEP panel initialized');\n});\n\n/**\n * Post-initialization diagnostic to verify all critical UI elements\n * are properly cached and event listeners are attached\n */\nfunction verifyUIInitialization() {\n    const criticalElements = {\n        'goBtn': { el: ui.goBtn, desc: 'GO button (main action)' },\n        'settingsBtn': { el: ui.settingsBtn, desc: 'Settings button' },\n        'debugBtn': { el: ui.debugBtn, desc: 'Debug button' },\n        'creditBadge': { el: ui.creditBadge, desc: 'Credit badge' },\n        'status': { el: ui.status, desc: 'Status bar' },\n        'optionsToggle': { el: ui.optionsToggle, desc: 'Options toggle' },\n        'optionsPanel': { el: ui.optionsPanel, desc: 'Options panel' }\n    };\n\n    const missingElements = [];\n    const presentElements = [];\n\n    Object.entries(criticalElements).forEach(([id, { el, desc }]) => {\n        if (!el) {\n            missingElements.push(`#${id} (${desc})`);\n        } else {\n            presentElements.push(id);\n        }\n    });\n\n    if (missingElements.length > 0) {\n        console.error('[SPLICE] ⚠️ UI INITIALIZATION INCOMPLETE');\n        console.error('[SPLICE] Missing critical elements:', missingElements);\n        console.error('[SPLICE] Panel may not function correctly. Check index.html structure.');\n\n        // Show error in status bar if available\n        const statusEl = document.getElementById('status');\n        if (statusEl) {\n            statusEl.textContent = 'Init error: ' + missingElements.length + ' UI elements missing';\n            statusEl.classList.add('error');\n        }\n    } else {\n        console.log('[SPLICE] ✓ All critical UI elements initialized:', presentElements.join(', '));\n    }\n\n    // Verify GO button has click listener\n    if (ui.goBtn) {\n        const listeners = getEventListeners ? getEventListeners(ui.goBtn) : null;\n        if (!listeners || !listeners.click || listeners.click.length === 0) {\n            // Can't check in production, but log that we tried\n            console.log('[SPLICE] GO button present - click handler should be attached');\n        }\n    }\n}\n\n// ============================================================================\n// SEQUENCE EVENT LISTENERS\n// ============================================================================\n/**\n * Initialize event listeners for sequence state changes\n * This provides real-time updates when sequences are activated/deactivated\n */\nfunction initSequenceEventListeners() {\n    if (!jsx.cs) {\n        console.warn('[SPLICE] Cannot init sequence listeners - CSInterface not available');\n        return;\n    }\n\n    try {\n        // Listen for sequence activation events\n        jsx.cs.addEventListener('com.adobe.csxs.events.SequenceActivated', async (event) => {\n            debugLog('Sequence activated event received');\n            try {\n                const seqInfo = await jsx.call('getActiveSequence');\n                if (seqInfo && !seqInfo.error) {\n                    window.spliceState.activeSequence = seqInfo;\n                    setStatus('Sequence: ' + (seqInfo.name || 'Unknown'));\n                    debugLog('Active sequence updated:', seqInfo.name);\n                }\n            } catch (e) {\n                console.warn('[SPLICE] Failed to get sequence info on activation:', e.message);\n            }\n        });\n\n        // Listen for sequence close/deactivation\n        jsx.cs.addEventListener('com.adobe.csxs.events.SequenceDeactivated', () => {\n            debugLog('Sequence deactivated event');\n            window.spliceState.activeSequence = null;\n            setStatus('No sequence open', true);\n        });\n\n        // Listen for project item selection changes (includes sequences)\n        jsx.cs.addEventListener('com.adobe.csxs.events.SelectionChanged', async () => {\n            // Debounce rapid selection changes\n            if (window._selectionChangeTimeout) {\n                clearTimeout(window._selectionChangeTimeout);\n            }\n            window._selectionChangeTimeout = setTimeout(async () => {\n                try {\n                    const hasSequence = await checkSequenceOpen(0, 0); // Quick check, no retries\n                    if (hasSequence && !window.spliceState.activeSequence) {\n                        const seqInfo = await jsx.call('getActiveSequence');\n                        if (seqInfo && !seqInfo.error) {\n                            window.spliceState.activeSequence = seqInfo;\n                            debugLog('Sequence detected via selection change:', seqInfo.name);\n                        }\n                    }\n                } catch (e) {\n                    // Ignore errors during selection change - it's just for proactive updates\n                }\n            }, 200);\n        });\n\n        debugLog('Sequence event listeners initialized');\n    } catch (e) {\n        console.error('[SPLICE] Failed to init sequence event listeners:', e.message);\n    }\n}\n\n// ============================================================================\n// JSX CONNECTION CHECK\n// ============================================================================\nasync function checkJSXConnection() {\n    try {\n        const result = await jsx.call('getVersion');\n        debugLog('JSX connection OK, version:', result);\n        return true;\n    } catch (e) {\n        console.warn('[SPLICE] JSX connection failed:', e.message);\n        setStatus('Premiere Pro connection failed', true);\n        return false;\n    }\n}\n\n/**\n * Check if a sequence is currently open in the Timeline\n * Enhanced with logging and retry logic\n * @param {number} retries - Number of retry attempts (default: 2)\n * @param {number} delayMs - Delay between retries in ms (default: 300)\n * @returns {Promise<boolean>} true if sequence is open\n */\nasync function checkSequenceOpen(retries = 2, delayMs = 300) {\n    console.log('[SPLICE] ========== checkSequenceOpen DIAGNOSTIC START ==========');\n    console.log('[SPLICE] checkSequenceOpen: retries=' + retries + ', delayMs=' + delayMs);\n    console.log('[SPLICE] checkSequenceOpen: window.spliceState.activeSequence =', window.spliceState.activeSequence);\n    \n    for (let attempt = 0; attempt <= retries; attempt++) {\n        try {\n            console.log('[SPLICE] checkSequenceOpen: Attempt ' + (attempt + 1) + ' of ' + (retries + 1));\n            console.log('[SPLICE] checkSequenceOpen: Calling jsx.call(\"checkSequenceOpen\")...');\n            const result = await jsx.call('checkSequenceOpen');\n            console.log('[SPLICE] checkSequenceOpen: JSX call returned');\n            console.log('[SPLICE] checkSequenceOpen: result =', result, '(type:', typeof result + ')');\n            debugLog('checkSequenceOpen attempt', attempt + 1, 'result:', result, 'type:', typeof result);\n\n            if (result === true || result === 'true') {\n                console.log('[SPLICE] checkSequenceOpen: Returning TRUE - sequence is open');\n                console.log('[SPLICE] ========== checkSequenceOpen DIAGNOSTIC END (TRUE) ==========');\n                return true;\n            }\n\n            // If false, wait and retry (sequence might be loading)\n            if (attempt < retries) {\n                console.log('[SPLICE] checkSequenceOpen: No sequence found, retrying in', delayMs, 'ms...');\n                debugLog('checkSequenceOpen: No sequence found, retrying in', delayMs, 'ms...');\n                await new Promise(r => setTimeout(r, delayMs));\n            }\n        } catch (error) {\n            console.error('[SPLICE] checkSequenceOpen: Attempt', attempt + 1, 'failed with exception:', error.message);\n            console.error('[SPLICE] checkSequenceOpen: Error stack:', error.stack);\n\n            // On last attempt, return false but log the actual error\n            if (attempt === retries) {\n                console.error('[SPLICE] checkSequenceOpen: All attempts failed. Last error:', error.message);\n                // Store error for diagnostics\n                window.spliceState.lastSequenceCheckError = error.message;\n                console.log('[SPLICE] checkSequenceOpen: Stored error in window.spliceState.lastSequenceCheckError:', error.message);\n                console.log('[SPLICE] ========== checkSequenceOpen DIAGNOSTIC END (ERROR) ==========');\n                return false;\n            }\n\n            // Wait before retry\n            console.log('[SPLICE] checkSequenceOpen: Waiting', delayMs, 'ms before retry...');\n            await new Promise(r => setTimeout(r, delayMs));\n        }\n    }\n    console.log('[SPLICE] checkSequenceOpen: All attempts completed without finding sequence');\n    console.log('[SPLICE] ========== checkSequenceOpen DIAGNOSTIC END (FALSE) ==========');\n    return false;\n}\n\n// ============================================================================\n// OPTIONS TOGGLE\n// ============================================================================\nfunction initOptionsToggle() {\n    debugLog('initOptionsToggle - toggle:', !!ui.optionsToggle, 'panel:', !!ui.optionsPanel);\n    if (ui.optionsToggle && ui.optionsPanel) {\n        ui.optionsToggle.addEventListener('click', () => {\n            debugLog('Options toggle clicked');\n            // Check current state BEFORE toggling\n            const wasCollapsed = ui.optionsPanel.classList.contains('collapsed');\n            ui.optionsPanel.classList.toggle('collapsed');\n            // If it was collapsed, it's now expanded (show 'expanded' class)\n            ui.optionsToggle.classList.toggle('expanded', wasCollapsed);\n            saveSettings({ expandedOptions: wasCollapsed });\n        });\n\n        // Restore state\n        const settings = getSettings();\n        if (!settings.expandedOptions) {\n            ui.optionsPanel.classList.add('collapsed');\n            ui.optionsToggle.classList.remove('expanded');\n        } else {\n            ui.optionsToggle.classList.add('expanded');\n            ui.optionsPanel.classList.remove('collapsed');\n        }\n    }\n}\n\n// ============================================================================\n// TEXT EDITOR TOGGLE\n// ============================================================================\nfunction initTextEditorToggle() {\n    const toggle = document.getElementById('textEditorToggle');\n    const panel = document.getElementById('text-editor-panel');\n    debugLog('initTextEditorToggle - toggle:', !!toggle, 'panel:', !!panel);\n\n    if (toggle && panel) {\n        toggle.addEventListener('click', (e) => {\n            e.preventDefault();\n            e.stopPropagation();\n            debugLog('Text Editor toggle clicked');\n            setStatus('Text Editor: ' + (panel.classList.contains('collapsed') ? 'Opening' : 'Closing'));\n            // Check state BEFORE toggling\n            const wasCollapsed = panel.classList.contains('collapsed');\n            panel.classList.toggle('collapsed');\n            const icon = toggle.querySelector('.toggle-icon');\n            debugLog('wasCollapsed:', wasCollapsed, 'icon:', !!icon);\n            if (icon) {\n                // If it was collapsed, it's now expanded (show -)\n                icon.textContent = wasCollapsed ? '-' : '+';\n            }\n        });\n    } else {\n        console.error('[SPLICE] Text Editor toggle elements not found!');\n    }\n}\n\n// ============================================================================\n// SOCIAL REFRAME TOGGLE\n// ============================================================================\nfunction initSocialReframeToggle() {\n    const toggle = document.getElementById('socialReframeToggle');\n    const panel = document.getElementById('social-reframe-panel');\n    debugLog('initSocialReframeToggle - toggle:', !!toggle, 'panel:', !!panel);\n\n    if (toggle && panel) {\n        toggle.addEventListener('click', () => {\n            debugLog('Social Reframe toggle clicked');\n            // Check state BEFORE toggling\n            const wasCollapsed = panel.classList.contains('collapsed');\n            panel.classList.toggle('collapsed');\n            const icon = toggle.querySelector('.toggle-icon');\n            if (icon) {\n                // If it was collapsed, it's now expanded (show -)\n                icon.textContent = wasCollapsed ? '-' : '+';\n            }\n        });\n    } else {\n        console.error('[SPLICE] Social Reframe toggle elements not found!');\n    }\n}\n\n// ============================================================================\n// MUSIC TOGGLE\n// ============================================================================\nfunction initMusicToggle() {\n    const toggle = document.getElementById('musicToggle');\n    const panel = document.getElementById('music-panel');\n    debugLog('initMusicToggle - toggle:', !!toggle, 'panel:', !!panel);\n\n    if (toggle && panel) {\n        toggle.addEventListener('click', () => {\n            debugLog('Music toggle clicked');\n            // Check state BEFORE toggling\n            const wasCollapsed = panel.classList.contains('collapsed');\n            panel.classList.toggle('collapsed');\n            const icon = toggle.querySelector('.toggle-icon');\n            if (icon) {\n                // If it was collapsed, it's now expanded (show -)\n                icon.textContent = wasCollapsed ? '-' : '+';\n            }\n        });\n    } else {\n        console.error('[SPLICE] Music toggle elements not found!');\n    }\n}\n\n// ============================================================================\n// SLIDERS\n// ============================================================================\nfunction initSliders() {\n    // Sensitivity slider\n    if (ui.sensitivitySlider && ui.sensitivityValue) {\n        ui.sensitivitySlider.addEventListener('input', () => {\n            ui.sensitivityValue.textContent = ui.sensitivitySlider.value;\n            saveSettings({ sensitivity: parseInt(ui.sensitivitySlider.value) });\n        });\n    }\n\n    // J-Cut sliders\n    if (ui.jcutLeadIn && ui.jcutLeadInValue) {\n        ui.jcutLeadIn.addEventListener('input', () => {\n            const val = (ui.jcutLeadIn.value / 100).toFixed(2);\n            ui.jcutLeadInValue.textContent = val + 's';\n            saveSettings({ jcutLeadIn: parseFloat(val) });\n        });\n    }\n\n    if (ui.jcutLeadOut && ui.jcutLeadOutValue) {\n        ui.jcutLeadOut.addEventListener('input', () => {\n            const val = (ui.jcutLeadOut.value / 100).toFixed(2);\n            ui.jcutLeadOutValue.textContent = val + 's';\n            saveSettings({ jcutLeadOut: parseFloat(val) });\n        });\n    }\n}\n\n// ============================================================================\n// FEATURE TOGGLES\n// ============================================================================\nfunction initFeatureToggles() {\n    // J-Cut toggle\n    if (ui.enableJCut && ui.jcutSettings) {\n        ui.enableJCut.addEventListener('change', () => {\n            ui.jcutSettings.classList.toggle('collapsed', !ui.enableJCut.checked);\n            saveSettings({ enableJCut: ui.enableJCut.checked });\n        });\n    }\n\n    // Zoom toggle\n    if (ui.enableZoom && ui.zoomSettings) {\n        ui.enableZoom.addEventListener('change', () => {\n            ui.zoomSettings.classList.toggle('collapsed', !ui.enableZoom.checked);\n            saveSettings({ enableZoom: ui.enableZoom.checked });\n        });\n    }\n\n    // Chapters toggle\n    if (ui.enableChapters && ui.chapterSettings) {\n        ui.enableChapters.addEventListener('change', () => {\n            ui.chapterSettings.classList.toggle('collapsed', !ui.enableChapters.checked);\n            saveSettings({ enableChapters: ui.enableChapters.checked });\n        });\n    }\n\n    // Takes detection toggle\n    if (ui.enableTakesDetection) {\n        ui.enableTakesDetection.addEventListener('change', () => {\n            saveSettings({ enableTakesDetection: ui.enableTakesDetection.checked });\n        });\n    }\n\n    // Profanity detection toggle\n    if (ui.enableProfanity && ui.profanitySettings) {\n        ui.enableProfanity.addEventListener('change', () => {\n            ui.profanitySettings.classList.toggle('collapsed', !ui.enableProfanity.checked);\n            saveSettings({ enableProfanity: ui.enableProfanity.checked });\n        });\n    }\n\n    // Filler word detection toggle\n    if (ui.enableFillerDetection && ui.fillerSettings) {\n        ui.enableFillerDetection.addEventListener('change', () => {\n            ui.fillerSettings.classList.toggle('collapsed', !ui.enableFillerDetection.checked);\n            saveSettings({ enableFillerDetection: ui.enableFillerDetection.checked });\n        });\n    }\n}\n\n// ============================================================================\n// PRESET SELECTOR\n// ============================================================================\n// PRESETS is defined in config.js\n\nfunction initPresetSelector() {\n    if (!ui.presetSelector) return;\n\n    ui.presetSelector.addEventListener('change', () => {\n        const presetId = ui.presetSelector.value;\n        applyPreset(presetId);\n    });\n\n    // Load current preset\n    const settings = getSettings();\n    if (settings.activePreset) {\n        ui.presetSelector.value = settings.activePreset;\n    }\n}\n\nfunction applyPreset(presetId) {\n    const preset = PRESETS[presetId];\n    if (!preset) return;\n\n    // Custom preset - keep current settings\n    if (presetId === 'custom' || !preset.settings) {\n        saveSettings({ activePreset: 'custom' });\n        setStatus('Using custom settings');\n        return;\n    }\n\n    const settings = preset.settings;\n\n    // Apply to UI\n    if (ui.sensitivitySlider && settings.sensitivity !== undefined) {\n        ui.sensitivitySlider.value = settings.sensitivity;\n        if (ui.sensitivityValue) ui.sensitivityValue.textContent = settings.sensitivity;\n    }\n\n    if (ui.enableJCut) {\n        ui.enableJCut.checked = settings.enableJCut || false;\n        if (ui.jcutSettings) {\n            ui.jcutSettings.classList.toggle('collapsed', !settings.enableJCut);\n        }\n    }\n\n    if (settings.jCutLeadIn !== undefined && ui.jcutLeadIn) {\n        ui.jcutLeadIn.value = Math.round(settings.jCutLeadIn * 100);\n        if (ui.jcutLeadInValue) ui.jcutLeadInValue.textContent = settings.jCutLeadIn + 's';\n    }\n\n    if (settings.jCutLeadOut !== undefined && ui.jcutLeadOut) {\n        ui.jcutLeadOut.value = Math.round(settings.jCutLeadOut * 100);\n        if (ui.jcutLeadOutValue) ui.jcutLeadOutValue.textContent = settings.jCutLeadOut + 's';\n    }\n\n    // Save merged settings\n    saveSettings({\n        activePreset: presetId,\n        sensitivity: settings.sensitivity,\n        threshold: settings.threshold,\n        minSilenceLength: settings.minSilenceLength,\n        paddingStart: settings.paddingStart,\n        paddingEnd: settings.paddingEnd,\n        enableTakesDetection: settings.enableTakesDetection,\n        enableJCut: settings.enableJCut || false,\n        jcutLeadIn: settings.jCutLeadIn || 0.3,\n        jcutLeadOut: settings.jCutLeadOut || 0.2\n    });\n\n    setStatus(`Applied ${preset.name} preset`);\n}\n\n// ============================================================================\n// LOAD SETTINGS TO UI\n// ============================================================================\nfunction loadSettingsToUI() {\n    const settings = getSettings();\n\n    if (ui.sensitivitySlider) {\n        ui.sensitivitySlider.value = settings.sensitivity;\n        if (ui.sensitivityValue) ui.sensitivityValue.textContent = settings.sensitivity;\n    }\n\n    if (ui.enableTakesDetection) ui.enableTakesDetection.checked = settings.enableTakesDetection;\n    if (ui.enableJCut) ui.enableJCut.checked = settings.enableJCut;\n    if (ui.enableZoom) ui.enableZoom.checked = settings.enableZoom;\n    if (ui.enableChapters) ui.enableChapters.checked = settings.enableChapters;\n\n    if (ui.jcutSettings) ui.jcutSettings.classList.toggle('collapsed', !settings.enableJCut);\n    if (ui.zoomSettings) ui.zoomSettings.classList.toggle('collapsed', !settings.enableZoom);\n    if (ui.chapterSettings) ui.chapterSettings.classList.toggle('collapsed', !settings.enableChapters);\n\n    if (ui.jcutLeadIn) {\n        ui.jcutLeadIn.value = Math.round(settings.jcutLeadIn * 100);\n        if (ui.jcutLeadInValue) ui.jcutLeadInValue.textContent = settings.jcutLeadIn + 's';\n    }\n    if (ui.jcutLeadOut) {\n        ui.jcutLeadOut.value = Math.round(settings.jcutLeadOut * 100);\n        if (ui.jcutLeadOutValue) ui.jcutLeadOutValue.textContent = settings.jcutLeadOut + 's';\n    }\n\n    if (ui.presetSelector && settings.activePreset) {\n        ui.presetSelector.value = settings.activePreset;\n    }\n}\n\n// ============================================================================\n// GO BUTTON - MAIN WORKFLOW\n// ============================================================================\nfunction initGoButton() {\n    if (!ui.goBtn) {\n        console.error('[SPLICE] initGoButton FAILED: #goBtn element not found in DOM');\n        console.error('[SPLICE] Check that index.html contains <button id=\"goBtn\">');\n        return;\n    }\n\n    ui.goBtn.addEventListener('click', async () => {\n        if (isOperationInProgress) return;\n        await runDetection();\n    });\n    console.log('[SPLICE] initGoButton: GO button initialized successfully');\n}\n\nasync function runDetection() {\n    if (isOperationInProgress) return;\n\n    // Check sequence with enhanced error messaging\n    const hasSequence = await checkSequenceOpen();\n    if (!hasSequence) {\n        // Check if there was a communication error vs just no sequence\n        const lastError = window.spliceState.lastSequenceCheckError;\n        if (lastError && (lastError.includes('CEP') || lastError.includes('communication') || lastError.includes('evalScript'))) {\n            setStatus('Premiere Pro connection issue - try reopening panel', true);\n            console.error('[SPLICE] runDetection: JSX communication failure:', lastError);\n        } else {\n            setStatus('Please open a sequence in the Timeline first', true);\n            debugLog('runDetection: No active sequence in Timeline');\n        }\n        // Clear the error for next check\n        window.spliceState.lastSequenceCheckError = null;\n        return;\n    }\n\n    // Check online\n    if (!isOnline()) {\n        setStatus('Offline - Check your connection', true);\n        return;\n    }\n\n    isOperationInProgress = true;\n    ui.goBtn.disabled = true;\n    showProgress('Detecting silences...');\n\n    try {\n        const settings = getSettings();\n\n        // Get sequence info\n        const seqInfo = await jsx.call('getActiveSequence');\n        debugLog('Sequence info:', seqInfo);\n\n        // Store sequence info for later use\n        currentSequenceInfo = seqInfo;\n        window.spliceState.activeSequence = seqInfo;\n        if (seqInfo && seqInfo.videoPath) {\n            window.spliceState.currentVideoPath = seqInfo.videoPath;\n        }\n\n        // Export audio via JSX for silence detection\n        updateProgress(10, 'Exporting audio...');\n\n        let audioFilePath = null;\n        try {\n            // Get sequence info for audio export\n            const exportResult = await jsx.call('exportSequenceAudioForAnalysis');\n            if (exportResult && exportResult.success && exportResult.outputPath) {\n                audioFilePath = exportResult.outputPath;\n                debugLog('Audio exported to:', audioFilePath);\n            } else if (exportResult && exportResult.error) {\n                throw new Error(exportResult.error);\n            }\n        } catch (exportError) {\n            console.warn('[SPLICE] Audio export failed, trying fallback:', exportError.message);\n            // Try to get audio from first clip in timeline\n            try {\n                const clipInfo = await jsx.call('getFirstClipAudioPath');\n                if (clipInfo && clipInfo.path) {\n                    audioFilePath = clipInfo.path;\n                    debugLog('Using clip audio path:', audioFilePath);\n                }\n            } catch (clipError) {\n                console.warn('[SPLICE] Fallback audio path failed:', clipError.message);\n            }\n        }\n\n        if (!audioFilePath) {\n            throw new Error('Could not export or locate audio file. Please ensure sequence has audio tracks.');\n        }\n\n        // Store audio path globally for other modules\n        currentAudioPath = audioFilePath;\n        window.spliceState.audioPath = audioFilePath;\n\n        // Call backend for silence detection with audio file path\n        updateProgress(30, 'Detecting silences...');\n        const silenceResponse = await fetchWithTimeout(\n            `${getBackendUrl()}/silences-rms`,\n            {\n                method: 'POST',\n                headers: getAuthHeaders(),\n                body: JSON.stringify({\n                    wavPath: audioFilePath,\n                    sensitivity: settings.sensitivity,\n                    minSilenceLength: settings.minSilenceLength || 0.5\n                })\n            }\n        );\n\n        if (!silenceResponse.ok) {\n            throw new Error(await parseErrorResponse(silenceResponse));\n        }\n\n        const silenceData = await silenceResponse.json();\n        previewSilences = silenceData.silences || [];\n\n        // Detect takes if enabled\n        if (settings.enableTakesDetection) {\n            updateProgress(60, 'Detecting takes...');\n            try {\n                const analyzeResponse = await fetchWithTimeout(\n                    `${getBackendUrl()}/analyze`,\n                    {\n                        method: 'POST',\n                        headers: getAuthHeaders(),\n                        body: JSON.stringify({\n                            wavPath: audioFilePath,\n                            detectTakes: true\n                        })\n                    }\n                );\n\n                if (analyzeResponse.ok) {\n                    const analyzeData = await analyzeResponse.json();\n                    previewTakes = analyzeData.takes || [];\n\n                    // Store transcript for captions/music modules\n                    if (analyzeData.transcript) {\n                        currentTranscript = analyzeData.transcript;\n                        window.currentTranscript = analyzeData.transcript;\n                        window.spliceState.lastTranscript = analyzeData.transcript;\n                    }\n                } else {\n                    // Handle specific error codes\n                    const errorMsg = await parseErrorResponse(analyzeResponse);\n                    if (analyzeResponse.status === 402) {\n                        console.warn('[SPLICE] Takes detection skipped: insufficient credits');\n                        setStatus('Takes detection skipped: insufficient credits', true);\n                    } else if (analyzeResponse.status === 401) {\n                        console.warn('[SPLICE] Takes detection skipped: authentication required');\n                    } else {\n                        console.warn('[SPLICE] Takes detection failed:', errorMsg);\n                    }\n                }\n            } catch (e) {\n                console.warn('[SPLICE] Takes detection failed:', e.message);\n            }\n        }\n\n        // Detect profanity if enabled\n        if (settings.enableProfanity) {\n            updateProgress(65, 'Detecting profanity...');\n            try {\n                const profanityResponse = await fetchWithTimeout(\n                    `${getBackendUrl()}/profanity`,\n                    {\n                        method: 'POST',\n                        headers: getAuthHeaders(),\n                        body: JSON.stringify({\n                            wavPath: audioFilePath,\n                            language: settings.profanityLanguage || 'en',\n                            bleepType: settings.bleepType || 'standard'\n                        })\n                    }\n                );\n\n                if (profanityResponse.ok) {\n                    const profanityData = await profanityResponse.json();\n                    // Backend returns 'words' array, not 'instances'\n                    currentProfanity = profanityData.words || profanityData.instances || [];\n                    if (currentProfanity.length > 0) {\n                        debugLog(`Found ${currentProfanity.length} profanity instances`);\n                    }\n                } else {\n                    console.warn('[SPLICE] Profanity detection failed:', await parseErrorResponse(profanityResponse));\n                }\n            } catch (e) {\n                console.warn('[SPLICE] Profanity detection failed:', e.message);\n            }\n        }\n\n        // Detect chapters if enabled\n        if (settings.enableChapters) {\n            updateProgress(80, 'Detecting chapters...');\n            try {\n                const chapterResponse = await fetchWithTimeout(\n                    `${getBackendUrl()}/chapters`,\n                    {\n                        method: 'POST',\n                        headers: getAuthHeaders(),\n                        body: JSON.stringify({\n                            wavPath: audioFilePath,\n                            transcript: currentTranscript,\n                            maxChapters: settings.maxChapters || 10,\n                            minChapterLength: settings.minChapterLength || 60\n                        })\n                    }\n                );\n\n                if (chapterResponse.ok) {\n                    const chapterData = await chapterResponse.json();\n                    currentChapters = chapterData.chapters || [];\n                } else {\n                    const errorMsg = await parseErrorResponse(chapterResponse);\n                    console.warn('[SPLICE] Chapter detection failed:', errorMsg);\n                    // Don't block workflow, just notify user\n                    setStatus('Chapter detection skipped: ' + errorMsg, true);\n                }\n            } catch (e) {\n                console.warn('[SPLICE] Chapter detection failed:', e);\n                setStatus('Chapter detection failed - continuing without chapters', true);\n            }\n        }\n\n        // Detect zoom points if enabled\n        if (settings.enableZoom) {\n            updateProgress(90, 'Detecting zoom points...');\n            try {\n                const zoomResponse = await fetchWithTimeout(\n                    `${getBackendUrl()}/zoom`,\n                    {\n                        method: 'POST',\n                        headers: getAuthHeaders(),\n                        body: JSON.stringify({\n                            wavPath: audioFilePath,\n                            transcript: currentTranscript,\n                            frequency: settings.zoomFrequency || 'medium',\n                            preset: settings.zoomPreset || 'medium',\n                            placement: settings.zoomPlacement || 'sentence_start'\n                        })\n                    }\n                );\n\n                if (zoomResponse.ok) {\n                    const zoomData = await zoomResponse.json();\n                    currentZooms = zoomData.zoomPoints || [];\n                } else {\n                    const errorMsg = await parseErrorResponse(zoomResponse);\n                    console.warn('[SPLICE] Zoom detection failed:', errorMsg);\n                    setStatus('Zoom detection skipped: ' + errorMsg, true);\n                }\n            } catch (e) {\n                console.warn('[SPLICE] Zoom detection failed:', e);\n                setStatus('Zoom detection failed - continuing without zoom points', true);\n            }\n        }\n\n        // Store results\n        lastDetectionResult = {\n            silences: previewSilences,\n            takes: previewTakes,\n            chapters: currentChapters,\n            zooms: currentZooms\n        };\n\n        // Show preview\n        hideProgress();\n        showCombinedPreview();\n        setStatus(`Found ${previewSilences.length} silences, ${previewTakes.length} takes`);\n\n    } catch (error) {\n        console.error('[SPLICE] Detection error:', error);\n        setStatus('Detection failed: ' + error.message, true);\n        hideProgress();\n    } finally {\n        isOperationInProgress = false;\n        ui.goBtn.disabled = false;\n    }\n}\n\n// ============================================================================\n// PROGRESS UI\n// ============================================================================\nfunction showProgress(message) {\n    if (ui.progressContainer) ui.progressContainer.classList.remove('hidden');\n    if (ui.resultsEmpty) ui.resultsEmpty.classList.add('hidden');\n    if (ui.combinedPreview) ui.combinedPreview.classList.add('hidden');\n    updateProgress(0, message);\n}\n\nfunction updateProgress(percent, message) {\n    if (ui.progressBar) ui.progressBar.style.width = percent + '%';\n    if (ui.progressText) ui.progressText.textContent = message || '';\n}\n\nfunction hideProgress() {\n    if (ui.progressContainer) ui.progressContainer.classList.add('hidden');\n}\n\n// ============================================================================\n// COMBINED PREVIEW\n// ============================================================================\nfunction showCombinedPreview() {\n    if (!ui.combinedPreview) return;\n\n    ui.combinedPreview.classList.remove('hidden');\n    if (ui.resultsEmpty) ui.resultsEmpty.classList.add('hidden');\n\n    // Update counts\n    if (ui.silenceCount) ui.silenceCount.textContent = previewSilences.length;\n    if (ui.takeCount) ui.takeCount.textContent = previewTakes.length;\n\n    // Select all by default\n    selectedSilenceIndices.clear();\n    previewSilences.forEach((_, i) => selectedSilenceIndices.add(i));\n    updateSelectedCount();\n\n    // Render preview list\n    renderPreviewList();\n\n    // Show chapter results if available\n    if (currentChapters.length > 0 && ui.chapterResults) {\n        ui.chapterResults.classList.remove('hidden');\n        renderChapterList();\n    }\n\n    // Show zoom results if available\n    if (currentZooms.length > 0 && ui.zoomResults) {\n        ui.zoomResults.classList.remove('hidden');\n    }\n}\n\nfunction renderPreviewList() {\n    if (!ui.previewList) return;\n\n    const html = [];\n\n    // Render silences\n    previewSilences.forEach((silence, i) => {\n        const isSelected = selectedSilenceIndices.has(i);\n        const duration = silence.end - silence.start;\n        html.push(`\n            <div class=\"preview-item ${isSelected ? '' : 'excluded'}\" data-index=\"${i}\" data-type=\"silence\">\n                <input type=\"checkbox\" class=\"preview-item-check\" ${isSelected ? 'checked' : ''}>\n                <div class=\"preview-item-info\">\n                    <div class=\"preview-item-time\">${formatTime(silence.start)} - ${formatTime(silence.end)}</div>\n                    <div class=\"preview-item-duration\">${duration.toFixed(2)}s silence</div>\n                </div>\n            </div>\n        `);\n    });\n\n    // Render takes\n    previewTakes.forEach((take, i) => {\n        // SECURITY: Escape take label to prevent XSS\n        const safeLabel = escapeHtml(take.label || 'Take ' + (take.takeNumber || i + 1));\n        html.push(`\n            <div class=\"preview-item take-item\" data-index=\"${i}\" data-type=\"take\">\n                <div class=\"preview-item-icon\">🎬</div>\n                <div class=\"preview-item-info\">\n                    <div class=\"preview-item-time\">${formatTime(take.start)} - ${formatTime(take.end)}</div>\n                    <div class=\"preview-item-label\">${safeLabel}</div>\n                </div>\n            </div>\n        `);\n    });\n\n    ui.previewList.innerHTML = html.join('');\n\n    // Add click handlers\n    ui.previewList.querySelectorAll('.preview-item').forEach(item => {\n        item.addEventListener('click', (e) => {\n            const index = parseInt(item.dataset.index);\n            const type = item.dataset.type;\n\n            if (e.target.classList.contains('preview-item-check')) {\n                // Checkbox clicked\n                toggleSilenceSelection(index);\n            } else {\n                // Item clicked - seek to time\n                const data = type === 'silence' ? previewSilences[index] : previewTakes[index];\n                seekToTime(data.start);\n            }\n        });\n    });\n}\n\nfunction toggleSilenceSelection(index) {\n    if (selectedSilenceIndices.has(index)) {\n        selectedSilenceIndices.delete(index);\n    } else {\n        selectedSilenceIndices.add(index);\n    }\n    updateSelectedCount();\n    renderPreviewList();\n}\n\nfunction updateSelectedCount() {\n    if (ui.selectedCount) {\n        ui.selectedCount.textContent = selectedSilenceIndices.size;\n    }\n    if (ui.selectAllSilences) {\n        ui.selectAllSilences.checked = selectedSilenceIndices.size === previewSilences.length;\n    }\n}\n\nasync function seekToTime(seconds) {\n    try {\n        // Check if there's an active sequence before seeking\n        if (!app?.project?.activeSequence) {\n            debugLog('No active sequence to seek in');\n            return;\n        }\n        // Use JSX to set playhead position\n        // Note: setPlayerPosition expects ticks as a string without quotes around the number value\n        const ticks = Math.round(seconds * 254016000000);\n        await jsx.evalScript(`app.project.activeSequence.setPlayerPosition(${ticks})`);\n    } catch (e) {\n        console.warn('[SPLICE] Seek failed:', e);\n    }\n}\n\n// ============================================================================\n// CHAPTER LIST\n// ============================================================================\nfunction renderChapterList() {\n    if (!ui.chapterList) return;\n\n    const html = currentChapters.map((chapter, i) => {\n        // SECURITY: Escape chapter title to prevent XSS\n        const safeTitle = escapeHtml(chapter.title);\n        return `\n            <div class=\"chapter-item\" data-index=\"${i}\">\n                <div class=\"chapter-time\">${formatTime(chapter.startTime)}</div>\n                <div class=\"chapter-title\">${safeTitle}</div>\n            </div>\n        `;\n    }).join('');\n\n    ui.chapterList.innerHTML = html;\n\n    // Add click handlers\n    ui.chapterList.querySelectorAll('.chapter-item').forEach(item => {\n        item.addEventListener('click', () => {\n            const index = parseInt(item.dataset.index);\n            seekToTime(currentChapters[index].startTime);\n        });\n    });\n}\n\n// ============================================================================\n// PREVIEW HANDLERS\n// ============================================================================\nfunction initPreviewHandlers() {\n    // Select all checkbox\n    if (ui.selectAllSilences) {\n        ui.selectAllSilences.addEventListener('change', () => {\n            if (ui.selectAllSilences.checked) {\n                previewSilences.forEach((_, i) => selectedSilenceIndices.add(i));\n            } else {\n                selectedSilenceIndices.clear();\n            }\n            updateSelectedCount();\n            renderPreviewList();\n        });\n    }\n\n    // Apply button\n    if (ui.applyPreviewBtn) {\n        ui.applyPreviewBtn.addEventListener('click', applyPreviewAndMarkers);\n    }\n\n    // Cancel button\n    if (ui.cancelPreviewBtn) {\n        ui.cancelPreviewBtn.addEventListener('click', hidePreview);\n    }\n\n    // Build sequence button\n    if (ui.buildSequenceBtn) {\n        ui.buildSequenceBtn.addEventListener('click', buildSequence);\n    }\n\n    // Copy YouTube timestamps\n    if (ui.copyYouTubeBtn) {\n        ui.copyYouTubeBtn.addEventListener('click', copyYouTubeTimestamps);\n    }\n\n    // Add chapter markers\n    if (ui.addChapterMarkersBtn) {\n        ui.addChapterMarkersBtn.addEventListener('click', addChapterMarkers);\n    }\n\n    // Apply zoom markers\n    const applyZoomsBtn = document.getElementById('applyZoomsBtn');\n    if (applyZoomsBtn) {\n        applyZoomsBtn.addEventListener('click', applyZoomMarkers);\n    }\n}\n\nasync function applyPreviewAndMarkers() {\n    if (isOperationInProgress) return;\n\n    isOperationInProgress = true;\n    setStatus('Adding markers...');\n\n    try {\n        // Add silence markers\n        const selectedSilences = previewSilences.filter((_, i) => selectedSilenceIndices.has(i));\n        for (const silence of selectedSilences) {\n            await jsx.call('createMarker', silence.start, 'SPLICE: Silence', silence.end - silence.start, null, 1);\n        }\n\n        // Add take markers\n        for (const take of previewTakes) {\n            await jsx.call('createMarker', take.start, take.label || `Take ${take.takeNumber}`, take.end - take.start, null, 5);\n        }\n\n        setStatus(`Added ${selectedSilences.length + previewTakes.length} markers`);\n    } catch (error) {\n        setStatus('Failed to add markers: ' + error.message, true);\n    } finally {\n        isOperationInProgress = false;\n    }\n}\n\nfunction hidePreview() {\n    if (ui.combinedPreview) ui.combinedPreview.classList.add('hidden');\n    if (ui.chapterResults) ui.chapterResults.classList.add('hidden');\n    if (ui.zoomResults) ui.zoomResults.classList.add('hidden');\n    if (ui.resultsEmpty) ui.resultsEmpty.classList.remove('hidden');\n    previewSilences = [];\n    previewTakes = [];\n    selectedSilenceIndices.clear();\n}\n\nasync function buildSequence() {\n    if (isOperationInProgress) return;\n\n    isOperationInProgress = true;\n    setStatus('Building sequence...');\n\n    try {\n        const settings = getSettings();\n\n        // Ensure we have sequence info\n        if (!currentSequenceInfo) {\n            currentSequenceInfo = await jsx.call('getActiveSequence');\n        }\n\n        // Create cut list from selected silences\n        const selectedSilences = previewSilences.filter((_, i) => selectedSilenceIndices.has(i));\n\n        // Calculate total duration from sequence info or last silence\n        let duration = 0;\n        if (currentSequenceInfo && currentSequenceInfo.duration) {\n            duration = currentSequenceInfo.duration;\n        } else if (previewSilences.length > 0) {\n            const lastSilence = previewSilences[previewSilences.length - 1];\n            duration = lastSilence.end + 10; // Add buffer\n        }\n\n        // Call backend to generate cut list\n        const cutListResponse = await fetchWithTimeout(\n            `${getBackendUrl()}/cut-list`,\n            {\n                method: 'POST',\n                headers: getAuthHeaders(),\n                body: JSON.stringify({\n                    sourceName: currentSequenceInfo?.name || 'Untitled Sequence',\n                    sourcePath: currentSequenceInfo?.treePath || currentSequenceInfo?.name || 'Untitled',\n                    duration: duration,\n                    silences: selectedSilences,\n                    takes: previewTakes,\n                    enableTakes: settings.enableTakesDetection,\n                    jCutOffset: settings.enableJCut ? settings.jcutLeadIn : 0,\n                    lCutOffset: settings.enableJCut ? settings.jcutLeadOut : 0\n                })\n            }\n        );\n\n        if (!cutListResponse.ok) {\n            throw new Error(await parseErrorResponse(cutListResponse));\n        }\n\n        const cutList = await cutListResponse.json();\n\n        // Build sequence via JSX\n        const result = await jsx.call('buildSequenceFromCutList', JSON.stringify(cutList));\n\n        if (result && result.success) {\n            setStatus(`Built sequence: ${result.sequenceName}`);\n            hidePreview();\n        } else {\n            throw new Error(result?.error || 'Build failed');\n        }\n    } catch (error) {\n        setStatus('Build failed: ' + error.message, true);\n    } finally {\n        isOperationInProgress = false;\n    }\n}\n\nfunction copyYouTubeTimestamps() {\n    if (currentChapters.length === 0) return;\n\n    const timestamps = currentChapters.map(ch =>\n        `${formatTime(ch.startTime)} ${ch.title}`\n    ).join('\\n');\n\n    navigator.clipboard.writeText(timestamps).then(() => {\n        setStatus('Copied YouTube timestamps');\n    }).catch(() => {\n        setStatus('Failed to copy', true);\n    });\n}\n\nasync function addChapterMarkers() {\n    if (isOperationInProgress || currentChapters.length === 0) return;\n\n    isOperationInProgress = true;\n    setStatus('Adding chapter markers...');\n\n    try {\n        for (const chapter of currentChapters) {\n            await jsx.call('addChapterMarker', chapter.startTime, chapter.title, chapter.description);\n        }\n        setStatus(`Added ${currentChapters.length} chapter markers`);\n    } catch (error) {\n        setStatus('Failed to add markers: ' + error.message, true);\n    } finally {\n        isOperationInProgress = false;\n    }\n}\n\n/**\n * Apply zoom point markers to the timeline\n */\nasync function applyZoomMarkers() {\n    if (isOperationInProgress || currentZooms.length === 0) return;\n\n    isOperationInProgress = true;\n    setStatus('Adding zoom markers...');\n\n    try {\n        for (const zoom of currentZooms) {\n            // Create a marker for each zoom point with zoom intensity info\n            const comment = `Zoom ${zoom.intensity || 'medium'} - ${zoom.reason || 'emphasis'}`;\n            await jsx.call('createMarker', zoom.time, 'SPLICE: Zoom', 0.5, comment, 3);\n        }\n        setStatus(`Added ${currentZooms.length} zoom markers`);\n    } catch (error) {\n        setStatus('Failed to add zoom markers: ' + error.message, true);\n    } finally {\n        isOperationInProgress = false;\n    }\n}\n\n// ============================================================================\n// MODALS\n// ============================================================================\nfunction initModals() {\n    // Settings modal\n    if (ui.settingsBtn && ui.settingsModal) {\n        ui.settingsBtn.addEventListener('click', () => {\n            ui.settingsModal.classList.remove('hidden');\n            // Sync remember options checkbox with current settings\n            const rememberOptions = document.getElementById('rememberOptions');\n            if (rememberOptions) {\n                rememberOptions.checked = getSettings().rememberOptions;\n            }\n        });\n        console.log('[SPLICE] initModals: Settings button initialized');\n    } else {\n        console.error('[SPLICE] initModals: Settings modal FAILED -',\n            !ui.settingsBtn ? '#settingsBtn missing' : '',\n            !ui.settingsModal ? '#settingsModal missing' : '');\n    }\n\n    if (ui.closeSettingsBtn && ui.settingsModal) {\n        ui.closeSettingsBtn.addEventListener('click', () => {\n            ui.settingsModal.classList.add('hidden');\n        });\n    }\n\n    // Remember options checkbox\n    const rememberOptions = document.getElementById('rememberOptions');\n    if (rememberOptions) {\n        rememberOptions.addEventListener('change', () => {\n            saveSettings({ rememberOptions: rememberOptions.checked });\n            if (rememberOptions.checked) {\n                setStatus('Options will be remembered');\n            } else {\n                setStatus('Options will reset to defaults');\n            }\n        });\n    }\n\n    // Credit badge click handler (handles login, retry, and refresh)\n    if (ui.creditBadge) {\n        ui.creditBadge.addEventListener('click', () => {\n            // Use the centralized handler from credits.js\n            if (typeof handleCreditBadgeClick === 'function') {\n                handleCreditBadgeClick();\n            } else {\n                // Fallback if credits.js not loaded yet\n                const settings = getSettings();\n                if (!settings.customerId) {\n                    showLoginModal();\n                }\n            }\n        });\n        console.log('[SPLICE] initModals: Credit badge initialized');\n    } else {\n        console.error('[SPLICE] initModals: Credit badge FAILED - #creditBadge missing');\n    }\n\n    if (ui.closeLoginBtn && ui.loginModal) {\n        ui.closeLoginBtn.addEventListener('click', () => {\n            ui.loginModal.classList.add('hidden');\n        });\n    }\n\n    // Note: saveLoginBtn handler is registered in initLoginModal() (config.js)\n    // to avoid duplicate event listeners\n\n    // License lookup button\n    const lookupLicenseBtn = document.getElementById('lookupLicenseBtn');\n    if (lookupLicenseBtn) {\n        lookupLicenseBtn.addEventListener('click', lookupLicense);\n    }\n\n    // Close modals on backdrop click\n    document.querySelectorAll('.modal').forEach(modal => {\n        modal.addEventListener('click', (e) => {\n            if (e.target === modal) {\n                modal.classList.add('hidden');\n            }\n        });\n    });\n\n    // ACCESSIBILITY: Close modals on Escape key press\n    document.addEventListener('keydown', (e) => {\n        if (e.key === 'Escape') {\n            const openModal = document.querySelector('.modal:not(.hidden)');\n            if (openModal) {\n                openModal.classList.add('hidden');\n                // Announce to screen readers\n                announceToScreenReader('Dialog closed');\n            }\n        }\n    });\n}\n\n/**\n * ACCESSIBILITY: Announce message to screen readers via ARIA live region\n * @param {string} message - Message to announce\n * @param {string} priority - 'polite' or 'assertive'\n */\nfunction announceToScreenReader(message, priority = 'polite') {\n    // Use existing status element or create temporary one\n    const statusEl = document.getElementById('status');\n    if (statusEl && priority === 'polite') {\n        const originalText = statusEl.textContent;\n        statusEl.textContent = message;\n        // Restore after announcement\n        setTimeout(() => {\n            if (statusEl.textContent === message) {\n                statusEl.textContent = originalText;\n            }\n        }, 1000);\n        return;\n    }\n\n    // Create temporary live region for assertive announcements\n    const liveRegion = document.createElement('div');\n    liveRegion.setAttribute('role', 'alert');\n    liveRegion.setAttribute('aria-live', priority);\n    liveRegion.setAttribute('aria-atomic', 'true');\n    liveRegion.className = 'sr-only';\n    liveRegion.style.cssText = 'position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);border:0;';\n    liveRegion.textContent = message;\n    document.body.appendChild(liveRegion);\n\n    // Remove after announcement\n    setTimeout(() => liveRegion.remove(), 1000);\n}\n\nfunction showLoginModal() {\n    if (ui.loginModal) ui.loginModal.classList.remove('hidden');\n}\n\n/**\n * Show upgrade modal when user tries to access a gated feature\n * @param {string} featureName - Display name of the feature\n * @param {string} requiredTier - Required tier (Pro, Team)\n */\nfunction showUpgradeModal(featureName, requiredTier = 'Pro') {\n    const modal = document.getElementById('upgradeModal');\n    const featureText = document.getElementById('upgradeFeatureName');\n    const tierText = document.getElementById('upgradeRequiredTier');\n\n    if (featureText) {\n        featureText.textContent = featureName;\n    }\n    if (tierText) {\n        tierText.textContent = requiredTier;\n    }\n    if (modal) {\n        modal.classList.remove('hidden');\n    }\n}\n\n/**\n * Close the upgrade modal\n */\nfunction closeUpgradeModal() {\n    const modal = document.getElementById('upgradeModal');\n    if (modal) {\n        modal.classList.add('hidden');\n    }\n}\n\n// Expose showUpgradeModal and closeUpgradeModal globally for feature modules\nwindow.showUpgradeModal = showUpgradeModal;\nwindow.closeUpgradeModal = closeUpgradeModal;\n\nasync function activateLicense() {\n    if (!ui.licenseKeyInput) return;\n\n    const licenseKey = ui.licenseKeyInput.value.trim();\n    if (!licenseKey) {\n        setStatus('Please enter a license key', true);\n        return;\n    }\n\n    try {\n        const response = await fetchWithTimeout(\n            `${getBackendUrl()}/license/activate`,\n            {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ key: licenseKey })\n            }\n        );\n\n        if (!response.ok) {\n            throw new Error(await parseErrorResponse(response));\n        }\n\n        const data = await response.json();\n        saveSettings({\n            customerId: data.customerId,\n            licenseKey: licenseKey\n        });\n\n        if (ui.loginModal) ui.loginModal.classList.add('hidden');\n        setStatus('License activated');\n        updateCredits();\n    } catch (error) {\n        setStatus('Activation failed: ' + error.message, true);\n    }\n}\n\n/**\n * Look up license key by email address\n */\nasync function lookupLicense() {\n    const lookupEmailInput = document.getElementById('lookupEmailInput');\n    const licenseKeyInput = document.getElementById('licenseKeyInput');\n\n    if (!lookupEmailInput) return;\n\n    const email = lookupEmailInput.value.trim().toLowerCase();\n    if (!email) {\n        setStatus('Please enter your email address', true);\n        return;\n    }\n\n    // Basic email validation\n    const emailRegex = /^[^\\s@]+@[^\\s@]+\\.[^\\s@]+$/;\n    if (!emailRegex.test(email)) {\n        setStatus('Please enter a valid email address', true);\n        return;\n    }\n\n    const lookupBtn = document.getElementById('lookupLicenseBtn');\n    if (lookupBtn) {\n        lookupBtn.disabled = true;\n        lookupBtn.textContent = 'Looking up...';\n    }\n\n    try {\n        const response = await fetchWithTimeout(\n            `${getBackendUrl()}/license/lookup`,\n            {\n                method: 'POST',\n                headers: { 'Content-Type': 'application/json' },\n                body: JSON.stringify({ email })\n            },\n            30000\n        );\n\n        const result = await response.json();\n\n        // Note: For security, the backend does NOT return the license key directly.\n        // It sends the key via email to prevent enumeration attacks.\n        if (result.success) {\n            setStatus(result.message || 'If a license exists, it has been sent to your email.');\n        } else {\n            setStatus(result.error || 'Lookup failed. Please try again.', true);\n        }\n    } catch (error) {\n        setStatus('Lookup failed: ' + error.message, true);\n    } finally {\n        if (lookupBtn) {\n            lookupBtn.disabled = false;\n            lookupBtn.textContent = 'Lookup';\n        }\n    }\n}\n\n// ============================================================================\n// CREDITS\n// ============================================================================\nfunction initCredits() {\n    updateCredits();\n}\n\nasync function updateCredits() {\n    if (!ui.creditBadge) return;\n\n    const settings = getSettings();\n    if (!settings.customerId) {\n        ui.creditBadge.className = 'credit-badge login';\n        ui.creditBadge.textContent = 'Login';\n        ui.creditBadge.style.display = 'flex';\n        return;\n    }\n\n    try {\n        const response = await fetchWithTimeout(\n            `${getBackendUrl()}/credits`,\n            {\n                method: 'GET',\n                headers: getAuthHeaders()\n            }\n        );\n\n        if (response.ok) {\n            const data = await response.json();\n            // Backend returns hoursRemaining (not remainingMinutes)\n            const hours = (data.hoursRemaining || 0).toFixed(1);\n            ui.creditBadge.textContent = `${hours}h`;\n            // Low warning when less than 1 hour remaining\n            ui.creditBadge.className = data.hoursRemaining < 1 ? 'credit-badge low' : 'credit-badge ok';\n            ui.creditBadge.style.display = 'flex';\n        } else {\n            ui.creditBadge.className = 'credit-badge error';\n            ui.creditBadge.textContent = 'Error';\n            ui.creditBadge.style.display = 'flex';\n        }\n    } catch {\n        ui.creditBadge.className = 'credit-badge error';\n        ui.creditBadge.textContent = 'Offline';\n        ui.creditBadge.style.display = 'flex';\n    }\n}\n\n// ============================================================================\n// HELP BUTTON\n// ============================================================================\nfunction initHelpButton() {\n    const helpBtn = document.getElementById('helpBtn');\n    if (helpBtn) {\n        helpBtn.addEventListener('click', () => {\n            setStatus('Silence: removes quiet gaps | Takes: detects repeated content | Chapters: AI topic segmentation');\n        });\n    }\n}\n\n// ============================================================================\n// DEBUG MODAL\n// ============================================================================\nfunction initDebugModal() {\n    if (!ui.debugBtn || !ui.debugModal) {\n        console.error('[SPLICE] initDebugModal FAILED: Missing elements -',\n            !ui.debugBtn ? '#debugBtn' : '',\n            !ui.debugModal ? '#debugModal' : '');\n        return;\n    }\n\n    // Open debug modal\n    ui.debugBtn.addEventListener('click', () => {\n        ui.debugModal.classList.remove('hidden');\n        // Clear previous logs and show placeholder\n        if (ui.debugLogs) {\n            ui.debugLogs.innerHTML = '<p class=\"debug-placeholder\">Click \"Run Diagnostics\" to collect diagnostic information.</p>';\n        }\n        if (ui.debugQuickDiagnosis) {\n            ui.debugQuickDiagnosis.textContent = 'Click \"Run Diagnostics\" to check';\n        }\n    });\n\n    // Close debug modal\n    if (ui.closeDebugBtn) {\n        ui.closeDebugBtn.addEventListener('click', () => {\n            ui.debugModal.classList.add('hidden');\n        });\n    }\n\n    // Run diagnostics button\n    if (ui.runDiagnosticsBtn) {\n        ui.runDiagnosticsBtn.addEventListener('click', async () => {\n            await runDiagnostics();\n        });\n    }\n\n    // Copy diagnostics button\n    if (ui.copyDiagnosticsBtn) {\n        ui.copyDiagnosticsBtn.addEventListener('click', () => {\n            copyDiagnosticsToClipboard();\n        });\n    }\n}\n\n// ============================================================================\n// DIAGNOSTICS\n// ============================================================================\nlet diagnosticLogs = [];\n\nasync function runDiagnostics() {\n    if (!ui.debugLogs || !ui.debugQuickDiagnosis) return;\n\n    diagnosticLogs = [];\n    ui.debugLogs.innerHTML = '<p class=\"debug-running\">Running diagnostics... Please wait...</p>';\n\n    try {\n        // Test 0: Check CEP environment\n        addDiagnosticLog('Test 0: Checking CEP environment...');\n        if (window.__adobe_cep__) {\n            addDiagnosticLog('✓ CEP runtime detected (window.__adobe_cep__ exists)');\n        } else {\n            addDiagnosticLog('✗ CEP runtime NOT detected - running in browser mode');\n        }\n\n        // Test 0.5: Basic ExtendScript test (doesn't require hostScript.jsx)\n        addDiagnosticLog('Test 0.5: Testing basic ExtendScript...');\n        try {\n            const basicResult = await jsx.evalScript('1 + 1');\n            addDiagnosticLog('✓ Basic ExtendScript works: 1+1 = ' + basicResult);\n        } catch (e) {\n            addDiagnosticLog('✗ Basic ExtendScript FAILED: ' + e.message);\n            addDiagnosticLog('  → This means Premiere Pro cannot run ANY ExtendScript');\n            addDiagnosticLog('  → Make sure CEP debug mode is enabled and Premiere was restarted');\n        }\n\n        // Test 0.6: Check if hostScript.jsx functions are loaded\n        addDiagnosticLog('Test 0.6: Checking if hostScript.jsx is loaded...');\n        try {\n            const typeofGetVersion = await jsx.evalScript('typeof getVersion');\n            if (typeofGetVersion === 'function') {\n                addDiagnosticLog('✓ hostScript.jsx is loaded (getVersion exists)');\n            } else {\n                addDiagnosticLog('✗ hostScript.jsx NOT loaded (getVersion type: ' + typeofGetVersion + ')');\n                addDiagnosticLog('  → The JSX file may not be in the correct location');\n            }\n        } catch (e) {\n            addDiagnosticLog('✗ hostScript check FAILED: ' + e.message);\n        }\n\n        // Test 1: JSX Connection\n        addDiagnosticLog('Test 1: Checking JSX connection...');\n        try {\n            const version = await jsx.call('getVersion');\n            addDiagnosticLog('✓ JSX connection OK, version: ' + version);\n        } catch (e) {\n            addDiagnosticLog('✗ JSX connection FAILED: ' + e.message);\n        }\n\n        // Test 2: Check for active sequence\n        addDiagnosticLog('Test 2: Checking for active sequence...');\n        try {\n            const hasSequence = await checkSequenceOpen(0, 0); // No retries for diagnostics\n            addDiagnosticLog('✓ checkSequenceOpen() returned: ' + hasSequence);\n        } catch (e) {\n            addDiagnosticLog('✗ checkSequenceOpen() FAILED: ' + e.message);\n        }\n\n        // Test 3: Get sequence info\n        addDiagnosticLog('Test 3: Getting sequence info...');\n        try {\n            const seqInfo = await jsx.call('getActiveSequence');\n            if (seqInfo && !seqInfo.error) {\n                addDiagnosticLog('✓ Sequence found: ' + (seqInfo.name || 'Unknown'));\n                addDiagnosticLog('  - Sequence ID: ' + (seqInfo.sequenceID || 'N/A'));\n                addDiagnosticLog('  - Duration: ' + (seqInfo.duration || 'N/A'));\n                addDiagnosticLog('  - Frame size: ' + (seqInfo.frameSizeHorizontal || 'N/A') + 'x' + (seqInfo.frameSizeVertical || 'N/A'));\n            } else {\n                addDiagnosticLog('✗ No active sequence found');\n            }\n        } catch (e) {\n            addDiagnosticLog('✗ getActiveSequence() FAILED: ' + e.message);\n        }\n\n        // Test 4: Check project sequences\n        addDiagnosticLog('Test 4: Checking all project sequences...');\n        try {\n            const sequences = await jsx.call('getAllSequences');\n            if (sequences && sequences.length > 0) {\n                addDiagnosticLog('✓ Total sequences in project: ' + sequences.length);\n                sequences.forEach((seq, i) => {\n                    addDiagnosticLog('  - Sequence ' + i + ': ' + (seq.name || 'Unnamed'));\n                });\n            } else {\n                addDiagnosticLog('✗ No sequences found in project');\n            }\n        } catch (e) {\n            addDiagnosticLog('✗ getAllSequences() FAILED: ' + e.message);\n        }\n\n        // Test 5: Check for active sequence via DOM\n        addDiagnosticLog('Test 5: Checking app.project.activeSequence...');\n        try {\n            const result = await jsx.evalScript(`\n                (function() {\n                    try {\n                        if (app && app.project && app.project.activeSequence) {\n                            return JSON.stringify({\n                                success: true,\n                                name: app.project.activeSequence.name,\n                                id: app.project.activeSequence.sequenceID\n                            });\n                        } else {\n                            return JSON.stringify({\n                                success: false,\n                                reason: app ? (app.project ? 'app.project.activeSequence is null' : 'app.project is null') : 'app is null'\n                            });\n                        }\n                    } catch (e) {\n                        return JSON.stringify({ success: false, reason: 'Error: ' + e.message });\n                    }\n                })()\n            `);\n            const data = JSON.parse(result);\n            if (data.success) {\n                addDiagnosticLog('✓ app.project.activeSequence found: ' + data.name + ' (ID: ' + data.id + ')');\n            } else {\n                addDiagnosticLog('✗ app.project.activeSequence NOT found: ' + data.reason);\n            }\n        } catch (e) {\n            addDiagnosticLog('✗ DOM check FAILED: ' + e.message);\n        }\n\n        // Test 6: Check QE DOM availability\n        addDiagnosticLog('Test 6: Checking QE DOM availability...');\n        try {\n            const qeResult = await jsx.evalScript(`\n                (function() {\n                    try {\n                        if (typeof qe !== 'undefined' && qe !== null) {\n                            return JSON.stringify({ available: true });\n                        } else {\n                            return JSON.stringify({ available: false });\n                        }\n                    } catch (e) {\n                        return JSON.stringify({ available: false, error: e.message });\n                    }\n                })()\n            `);\n            const qeData = JSON.parse(qeResult);\n            if (qeData.available) {\n                addDiagnosticLog('✓ QE DOM is available');\n            } else {\n                addDiagnosticLog('✗ QE DOM is NOT available' + (qeData.error ? ': ' + qeData.error : ''));\n            }\n        } catch (e) {\n            addDiagnosticLog('✗ QE DOM check FAILED: ' + e.message);\n        }\n\n        // Display quick diagnosis\n        updateQuickDiagnosis();\n\n        // Display all logs\n        displayDiagnosticLogs();\n\n    } catch (error) {\n        addDiagnosticLog('DIAGNOSTICS ERROR: ' + error.message);\n        displayDiagnosticLogs();\n    }\n}\n\nfunction addDiagnosticLog(message) {\n    diagnosticLogs.push(message);\n    console.log('[SPLICE DEBUG] ' + message);\n}\n\nfunction displayDiagnosticLogs() {\n    if (!ui.debugLogs) return;\n\n    const html = diagnosticLogs.map(log => {\n        return `<div class=\"debug-log-entry\">${escapeHtml(log)}</div>`;\n    }).join('');\n\n    ui.debugLogs.innerHTML = html;\n}\n\nfunction updateQuickDiagnosis() {\n    if (!ui.debugQuickDiagnosis) return;\n\n    const logs = diagnosticLogs.join(' ');\n    let diagnosis = '';\n    let solution = '';\n\n    // Analyze logs for common issues\n    if (logs.includes('JSX connection FAILED')) {\n        diagnosis = '❌ JSX Connection Failed';\n        solution = 'The panel cannot communicate with Premiere Pro. Try: 1) Close and reopen the panel, 2) Restart Premiere Pro, 3) Check if plugin is properly installed.';\n    } else if (logs.includes('checkSequenceOpen() returned: false') && logs.includes('No active sequence found')) {\n        diagnosis = '❌ No Active Sequence';\n        solution = 'No sequence is active in the Timeline. Double-click a sequence in the Project panel to open it in the Timeline.';\n    } else if (logs.includes('app.project.activeSequence NOT found') && logs.includes('Sequence found')) {\n        diagnosis = '❌ Sequence Not Active';\n        solution = 'A sequence exists but is not the active sequence. Click on the sequence tab in the Timeline to make it active.';\n    } else if (logs.includes('checkSequenceOpen() returned: true') && logs.includes('app.project.activeSequence found')) {\n        diagnosis = '✅ Everything Looks Good';\n        solution = 'The plugin is working correctly. The sequence is detected and active. Try pressing GO again.';\n    } else if (logs.includes('No sequences found in project')) {\n        diagnosis = '❌ No Sequences in Project';\n        solution = 'Create a sequence in Premiere Pro first (File > New > Sequence), then open it in the Timeline.';\n    } else {\n        diagnosis = '⚠️ Unknown Issue';\n        solution = 'Copy the diagnostic logs below and send them to support for further assistance.';\n    }\n\n    ui.debugQuickDiagnosis.innerHTML = `\n        <div class=\"diagnosis-result\">\n            <div class=\"diagnosis-title\">${diagnosis}</div>\n            <div class=\"diagnosis-solution\">${solution}</div>\n        </div>\n    `;\n}\n\nfunction copyDiagnosticsToClipboard() {\n    const text = diagnosticLogs.join('\\n');\n    navigator.clipboard.writeText(text).then(() => {\n        if (ui.copyDiagnosticsBtn) {\n            ui.copyDiagnosticsBtn.textContent = 'Copied!';\n            setTimeout(() => {\n                ui.copyDiagnosticsBtn.textContent = 'Copy to Clipboard';\n            }, 2000);\n        }\n    }).catch(err => {\n        setStatus('Failed to copy: ' + err.message, true);\n    });\n}\n\n// Export for debugging\nwindow.spliceDebug = {\n    getState: () => ({\n        silences: previewSilences,\n        takes: previewTakes,\n        chapters: currentChapters,\n        zooms: currentZooms,\n        selected: Array.from(selectedSilenceIndices)\n    }),\n    jsx,\n    runDetection\n};\n","numLines":1986,"startLine":1,"totalLines":1986}}}
{"parentUuid":"4702be7d-7c58-46f4-9c1f-14dd72615394","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/SPLICE","sessionId":"5f015cfc-0476-4608-91d9-cf0946100ba2","version":"2.0.76","gitBranch":"main","agentId":"a1c98b9","slug":"fizzy-hatching-flame","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CpqzcgDi5BctoFZXuew5ib","type":"tool_result","content":"     1→<!DOCTYPE html>\n     2→<html lang=\"en\">\n     3→\n     4→<head>\n     5→    <meta charset=\"utf-8\">\n     6→    <title>SPLICE - AI Video Editor</title>\n     7→    <link rel=\"stylesheet\" href=\"css/style.css\">\n     8→</head>\n     9→\n    10→<body>\n    11→    <!-- Loading Overlay -->\n    12→    <div id=\"loading-overlay\">\n    13→        <div class=\"loader-logo\"></div>\n    14→        <div class=\"loader-text\">Initializing Antigravity...</div>\n    15→    </div>\n    16→    <!-- Header -->\n    17→    <div class=\"header\">\n    18→        <h1>SPLICE</h1>\n    19→        <div class=\"header-actions\">\n    20→            <div id=\"creditBadge\" class=\"credit-badge login\">Login</div>\n    21→            <button id=\"debugBtn\" class=\"icon-btn\" title=\"Debug\">🔍</button>\n    22→            <button id=\"helpBtn\" class=\"icon-btn\" title=\"Help\">?</button>\n    23→            <button id=\"settingsBtn\" class=\"icon-btn\" title=\"Settings\">⚙</button>\n    24→        </div>\n    25→    </div>\n    26→\n    27→    <!-- Status Bar -->\n    28→    <div id=\"status\" role=\"status\" aria-live=\"polite\">Ready</div>\n    29→\n    30→    <!-- Main Action Card -->\n    31→    <div class=\"action-card\">\n    32→        <h2>Quick Edit</h2>\n    33→\n    34→        <!-- GO Button -->\n    35→        <button id=\"goBtn\" class=\"go-btn\" aria-label=\"Start detection\">GO</button>\n    36→\n    37→        <!-- Options Toggle -->\n    38→        <button id=\"optionsToggle\" class=\"options-toggle\" aria-expanded=\"false\">Options</button>\n    39→\n    40→        <!-- Options Panel -->\n    41→        <div id=\"optionsPanel\" class=\"options-panel collapsed\">\n    42→            <!-- Preset Selector -->\n    43→            <div class=\"form-group\">\n    44→                <label for=\"presetSelector\">Preset</label>\n    45→                <select id=\"presetSelector\">\n    46→                    <option value=\"podcast\">Podcast</option>\n    47→                    <option value=\"interview\">Interview</option>\n    48→                    <option value=\"reaction\">Reaction</option>\n    49→                    <option value=\"tutorial\">Tutorial</option>\n    50→                    <option value=\"vlog\">Vlog</option>\n    51→                    <option value=\"custom\">Custom</option>\n    52→                </select>\n    53→            </div>\n    54→\n    55→            <!-- Sensitivity Slider -->\n    56→            <div class=\"slider-container\">\n    57→                <label for=\"sensitivitySlider\">Sensitivity: <span id=\"sensitivityValue\">50</span></label>\n    58→                <input type=\"range\" id=\"sensitivitySlider\" min=\"0\" max=\"100\" value=\"50\">\n    59→                <div class=\"slider-labels\">\n    60→                    <span>Less cuts</span>\n    61→                    <span>More cuts</span>\n    62→                </div>\n    63→            </div>\n    64→\n    65→            <!-- Audio Source -->\n    66→            <div class=\"audio-source-group\">\n    67→                <label>Audio Source</label>\n    68→                <label class=\"checkbox-label\">\n    69→                    <input type=\"checkbox\" id=\"sourceOriginal\" checked>\n    70→                    Original Audio\n    71→                </label>\n    72→                <label class=\"checkbox-label\">\n    73→                    <input type=\"checkbox\" id=\"sourceIsolated\">\n    74→                    Isolated Vocals <span class=\"tier-badge\">PRO</span>\n    75→                </label>\n    76→            </div>\n    77→\n    78→            <!-- Feature Toggles -->\n    79→            <div class=\"feature-toggles\">\n    80→                <label class=\"checkbox-label\">\n    81→                    <input type=\"checkbox\" id=\"enableTakesDetection\" checked>\n    82→                    Detect Takes\n    83→                </label>\n    84→\n    85→                <label class=\"checkbox-label\">\n    86→                    <input type=\"checkbox\" id=\"enableJCut\">\n    87→                    J-Cut / L-Cut\n    88→                </label>\n    89→                <div id=\"jcutSettings\" class=\"sub-options collapsed\">\n    90→                    <div class=\"slider-container small\">\n    91→                        <label>Lead In: <span id=\"jcutLeadInValue\">0.30s</span></label>\n    92→                        <input type=\"range\" id=\"jcutLeadIn\" min=\"0\" max=\"100\" value=\"30\">\n    93→                    </div>\n    94→                    <div class=\"slider-container small\">\n    95→                        <label>Lead Out: <span id=\"jcutLeadOutValue\">0.20s</span></label>\n    96→                        <input type=\"range\" id=\"jcutLeadOut\" min=\"0\" max=\"100\" value=\"20\">\n    97→                    </div>\n    98→                </div>\n    99→\n   100→                <label class=\"checkbox-label\">\n   101→                    <input type=\"checkbox\" id=\"enableZoom\">\n   102→                    Auto Zoom\n   103→                </label>\n   104→                <div id=\"zoomSettings\" class=\"sub-options collapsed\">\n   105→                    <div class=\"form-group small\">\n   106→                        <label>Frequency</label>\n   107→                        <select id=\"zoomFrequency\">\n   108→                            <option value=\"low\">Low (~1/min)</option>\n   109→                            <option value=\"medium\" selected>Medium (~2/min)</option>\n   110→                            <option value=\"high\">High (~4/min)</option>\n   111→                        </select>\n   112→                    </div>\n   113→                    <div class=\"form-group small\">\n   114→                        <label>Intensity</label>\n   115→                        <select id=\"zoomPreset\">\n   116→                            <option value=\"subtle\">Subtle (110%)</option>\n   117→                            <option value=\"medium\" selected>Medium (120%)</option>\n   118→                            <option value=\"dramatic\">Dramatic (140%)</option>\n   119→                        </select>\n   120→                    </div>\n   121→                    <div class=\"form-group small\">\n   122→                        <label>Placement</label>\n   123→                        <select id=\"zoomPlacement\">\n   124→                            <option value=\"sentence_start\" selected>Sentence Starts</option>\n   125→                            <option value=\"keywords\">Keywords</option>\n   126→                            <option value=\"random\">Random</option>\n   127→                        </select>\n   128→                    </div>\n   129→                </div>\n   130→\n   131→                <label class=\"checkbox-label\">\n   132→                    <input type=\"checkbox\" id=\"enableChapters\">\n   133→                    Detect Chapters\n   134→                </label>\n   135→                <div id=\"chapterSettings\" class=\"sub-options collapsed\">\n   136→                    <div class=\"form-group small\">\n   137→                        <label>Max Chapters</label>\n   138→                        <input type=\"number\" id=\"maxChapters\" min=\"1\" max=\"50\" value=\"10\">\n   139→                    </div>\n   140→                    <div class=\"form-group small\">\n   141→                        <label>Min Length (s)</label>\n   142→                        <input type=\"number\" id=\"minChapterLength\" min=\"30\" max=\"600\" value=\"60\">\n   143→                    </div>\n   144→                </div>\n   145→\n   146→                <!-- Profanity Bleeping (Feature 1: Firecut Parity) -->\n   147→                <label class=\"checkbox-label\">\n   148→                    <input type=\"checkbox\" id=\"enableProfanity\">\n   149→                    Profanity Detection\n   150→                </label>\n   151→                <div id=\"profanitySettings\" class=\"sub-options collapsed\">\n   152→                    <div class=\"form-group small\">\n   153→                        <label>Bleep Type</label>\n   154→                        <select id=\"bleepType\">\n   155→                            <option value=\"standard\">Standard (1kHz)</option>\n   156→                            <option value=\"tv\">TV Bleep</option>\n   157→                            <option value=\"radio\">Radio Bleep</option>\n   158→                            <option value=\"duck\">Duck Audio</option>\n   159→                            <option value=\"mute\">Mute</option>\n   160→                        </select>\n   161→                    </div>\n   162→                    <div class=\"form-group small\">\n   163→                        <label>Volume</label>\n   164→                        <input type=\"range\" id=\"bleepVolume\" min=\"0\" max=\"100\" value=\"50\">\n   165→                    </div>\n   166→                    <label class=\"checkbox-label\">\n   167→                        <input type=\"checkbox\" id=\"enableBleepInsertion\">\n   168→                        Auto-insert bleeps\n   169→                    </label>\n   170→                </div>\n   171→\n   172→                <!-- Filler Word Detection (Feature 2: Firecut Parity) -->\n   173→                <label class=\"checkbox-label\">\n   174→                    <input type=\"checkbox\" id=\"enableFillerDetection\">\n   175→                    Filler Word Detection\n   176→                </label>\n   177→                <div id=\"fillerSettings\" class=\"sub-options collapsed\">\n   178→                    <div class=\"form-group small\">\n   179→                        <label>Custom Fillers</label>\n   180→                        <input type=\"text\" id=\"customFillers\" placeholder=\"basically, literally\">\n   181→                    </div>\n   182→                    <button id=\"detectFillersBtn\" class=\"btn btn-small\">Detect Fillers</button>\n   183→                    <button id=\"removeFillersBtn\" class=\"btn btn-small btn-secondary\" disabled>Remove Fillers</button>\n   184→                </div>\n   185→            </div>\n   186→        </div>\n   187→    </div>\n   188→\n   189→    <!-- Multitrack Section -->\n   190→    <div id=\"multitrackSection\" class=\"multitrack-section\">\n   191→        <div id=\"multitrackToggle\" class=\"section-toggle\">\n   192→            <span class=\"toggle-icon\">+</span>\n   193→            <span>Multitrack / Multi-Speaker</span>\n   194→        </div>\n   195→        <div id=\"multitrackPanel\" class=\"multitrack-panel collapsed\">\n   196→            <!-- Speaker Configuration -->\n   197→            <div class=\"speaker-config\">\n   198→                <div class=\"speaker-config-header\">\n   199→                    <span>Speakers</span>\n   200→                    <button id=\"addSpeakerBtn\" class=\"btn btn-small\">+ Add</button>\n   201→                </div>\n   202→                <div id=\"speakerList\" class=\"speaker-list\">\n   203→                    <div class=\"speaker-item speaker-0\" data-speaker-index=\"0\">\n   204→                        <input type=\"text\" class=\"speaker-name\" value=\"Speaker 1\" placeholder=\"Name\"\n   205→                            aria-label=\"Speaker 1 name\">\n   206→                        <select class=\"speaker-track\" aria-label=\"Speaker 1 video track\">\n   207→                            <option value=\"0\" selected>V1</option>\n   208→                            <option value=\"1\">V2</option>\n   209→                            <option value=\"2\">V3</option>\n   210→                            <option value=\"3\">V4</option>\n   211→                        </select>\n   212→                        <button class=\"speaker-remove-btn\" title=\"Remove speaker\" aria-label=\"Remove speaker 1\"\n   213→                            style=\"display: none;\">x</button>\n   214→                    </div>\n   215→                    <div class=\"speaker-item speaker-1\" data-speaker-index=\"1\">\n   216→                        <input type=\"text\" class=\"speaker-name\" value=\"Speaker 2\" placeholder=\"Name\"\n   217→                            aria-label=\"Speaker 2 name\">\n   218→                        <select class=\"speaker-track\" aria-label=\"Speaker 2 video track\">\n   219→                            <option value=\"0\">V1</option>\n   220→                            <option value=\"1\" selected>V2</option>\n   221→                            <option value=\"2\">V3</option>\n   222→                            <option value=\"3\">V4</option>\n   223→                        </select>\n   224→                        <button class=\"speaker-remove-btn\" title=\"Remove speaker\" aria-label=\"Remove speaker 2\"\n   225→                            style=\"display: none;\">x</button>\n   226→                    </div>\n   227→                </div>\n   228→            </div>\n   229→\n   230→            <!-- Parameters -->\n   231→            <div class=\"multitrack-params\">\n   232→                <div class=\"slider-container small\">\n   233→                    <label>Min Shot Duration: <span id=\"minShotDurationValue\">2.0s</span></label>\n   234→                    <input type=\"range\" id=\"minShotDuration\" min=\"0.5\" max=\"10\" step=\"0.5\" value=\"2\">\n   235→                </div>\n   236→                <div class=\"slider-container small\">\n   237→                    <label>Wide Shot %: <span id=\"wideShotPercentValue\">20%</span></label>\n   238→                    <input type=\"range\" id=\"wideShotPercent\" min=\"0\" max=\"50\" step=\"5\" value=\"20\">\n   239→                </div>\n   240→                <div class=\"slider-container small\">\n   241→                    <label>Switching Frequency: <span id=\"switchingFrequencyValue\">50</span></label>\n   242→                    <input type=\"range\" id=\"switchingFrequency\" min=\"10\" max=\"100\" step=\"10\" value=\"50\">\n   243→                </div>\n   244→                <label class=\"checkbox-label\">\n   245→                    <input type=\"checkbox\" id=\"enableWideShotDetection\" checked>\n   246→                    Enable Wide Shot Detection\n   247→                </label>\n   248→                <div class=\"form-group small\">\n   249→                    <label>Wide Shot Track</label>\n   250→                    <select id=\"wideShotTrack\">\n   251→                        <option value=\"-1\">None</option>\n   252→                        <option value=\"0\">V1</option>\n   253→                        <option value=\"1\">V2</option>\n   254→                        <option value=\"2\">V3</option>\n   255→                        <option value=\"3\">V4</option>\n   256→                    </select>\n   257→                </div>\n   258→            </div>\n   259→\n   260→            <!-- Action Buttons -->\n   261→            <div class=\"multitrack-actions\">\n   262→                <button id=\"analyzeMultitrackBtn\" class=\"btn btn-primary\">Analyze</button>\n   263→                <button id=\"autoBalanceBtn\" class=\"btn btn-secondary\">Auto-Balance</button>\n   264→            </div>\n   265→\n   266→            <!-- Results Preview -->\n   267→            <div id=\"multitrackPreview\" class=\"multitrack-preview hidden\">\n   268→                <div class=\"distribution-chart-container\">\n   269→                    <label>Speaker Distribution</label>\n   270→                    <div id=\"distributionChart\" class=\"distribution-chart\"></div>\n   271→                </div>\n   272→                <div id=\"speakerStats\" class=\"speaker-stats\"></div>\n   273→                <div class=\"decision-list-header\">\n   274→                    <span>Switching Decisions (<span id=\"decisionCount\">0</span>)</span>\n   275→                </div>\n   276→                <div id=\"decisionList\" class=\"decision-list\"></div>\n   277→                <div class=\"multitrack-preview-actions\">\n   278→                    <button id=\"applyMultitrackBtn\" class=\"btn btn-primary\" disabled>Apply</button>\n   279→                </div>\n   280→            </div>\n   281→        </div>\n   282→    </div>\n   283→\n   284→    <!-- Animated Captions Section -->\n   285→    <div id=\"captionsSection\" class=\"captions-section\">\n   286→        <div id=\"captionsToggle\" class=\"section-toggle\">\n   287→            <span class=\"toggle-icon\">+</span>\n   288→            <span>Animated Captions</span>\n   289→        </div>\n   290→        <div id=\"captionsPanel\" class=\"captions-panel collapsed\">\n   291→            <!-- Template Gallery -->\n   292→            <div class=\"caption-templates\">\n   293→                <label>Template Style</label>\n   294→                <div id=\"captionTemplateGallery\" class=\"caption-template-gallery\"></div>\n   295→            </div>\n   296→\n   297→            <!-- Settings -->\n   298→            <div class=\"caption-settings\">\n   299→                <div class=\"form-group small\">\n   300→                    <label>Words per Line</label>\n   301→                    <select id=\"captionWordsPerLine\">\n   302→                        <option value=\"2\">2 words</option>\n   303→                        <option value=\"3\">3 words</option>\n   304→                        <option value=\"4\" selected>4 words</option>\n   305→                        <option value=\"5\">5 words</option>\n   306→                    </select>\n   307→                </div>\n   308→                <label class=\"checkbox-label\">\n   309→                    <input type=\"checkbox\" id=\"captionHighlightKeywords\" checked>\n   310→                    Highlight Keywords\n   311→                </label>\n   312→                <label class=\"checkbox-label\">\n   313→                    <input type=\"checkbox\" id=\"captionInsertEmojis\">\n   314→                    Insert Emojis\n   315→                </label>\n   316→                <div class=\"form-group small\" id=\"emojiFrequencyGroup\" style=\"display: none;\">\n   317→                    <label>Emoji Frequency</label>\n   318→                    <select id=\"captionEmojiFrequency\">\n   319→                        <option value=\"low\">Low</option>\n   320→                        <option value=\"medium\" selected>Medium</option>\n   321→                        <option value=\"high\">High</option>\n   322→                    </select>\n   323→                </div>\n   324→            </div>\n   325→\n   326→            <!-- Action Buttons -->\n   327→            <div class=\"caption-actions\">\n   328→                <button id=\"generateCaptionsBtn\" class=\"btn btn-primary\">Generate Captions</button>\n   329→            </div>\n   330→\n   331→            <!-- Stats -->\n   332→            <div id=\"captionStats\" class=\"caption-stats\"></div>\n   333→\n   334→            <!-- Status -->\n   335→            <div id=\"captionStatus\" class=\"caption-status\"></div>\n   336→\n   337→            <!-- Preview -->\n   338→            <div id=\"captionPreviewContainer\" class=\"caption-preview-container\"></div>\n   339→\n   340→            <!-- Export Actions -->\n   341→            <div class=\"caption-export-actions hidden\" id=\"captionExportActions\">\n   342→                <button id=\"exportCaptionsSrtBtn\" class=\"btn btn-small btn-secondary\">Export SRT</button>\n   343→                <button id=\"exportCaptionsMogrtBtn\" class=\"btn btn-small btn-secondary\">Export MOGRT</button>\n   344→                <button id=\"copyCaptionsBtn\" class=\"btn btn-small btn-secondary\">Copy</button>\n   345→                <button id=\"applyCaptionsBtn\" class=\"btn btn-small btn-primary\">Add Markers</button>\n   346→            </div>\n   347→        </div>\n   348→    </div>\n   349→\n   350→    <!-- Text Editor Section -->\n   351→    <div id=\"textEditorSection\" class=\"text-editor-section\">\n   352→        <div id=\"textEditorToggle\" class=\"section-toggle\">\n   353→            <span class=\"toggle-icon\">+</span>\n   354→            <span>Text-Based Editing</span>\n   355→        </div>\n   356→        <div id=\"text-editor-panel\" class=\"text-editor-panel collapsed\">\n   357→            <!-- Status Bar -->\n   358→            <div class=\"text-editor-bar\">\n   359→                <span id=\"text-editor-word-count\" class=\"text-editor-word-count\">0 words</span>\n   360→                <span id=\"text-editor-dirty\" class=\"text-editor-dirty\" style=\"display: none;\">*</span>\n   361→                <span id=\"text-editor-status\" class=\"text-editor-status\"></span>\n   362→            </div>\n   363→\n   364→            <!-- Toolbar -->\n   365→            <div class=\"text-editor-toolbar\">\n   366→                <button id=\"text-editor-undo-btn\" class=\"btn btn-small btn-icon\" title=\"Undo (Ctrl+Z)\"\n   367→                    disabled>↶</button>\n   368→                <button id=\"text-editor-redo-btn\" class=\"btn btn-small btn-icon\" title=\"Redo (Ctrl+Y)\"\n   369→                    disabled>↷</button>\n   370→                <div class=\"toolbar-divider\"></div>\n   371→                <button id=\"text-editor-reset-btn\" class=\"btn btn-small btn-secondary\">Reset</button>\n   372→            </div>\n   373→\n   374→            <!-- Editor Content -->\n   375→            <div class=\"text-editor-content-wrapper\">\n   376→                <textarea id=\"text-editor-content\" class=\"text-editor-content\"\n   377→                    placeholder=\"Load a transcript to begin editing...\"></textarea>\n   378→            </div>\n   379→\n   380→            <!-- Search & Replace -->\n   381→            <div class=\"text-editor-search\">\n   382→                <div class=\"search-row\">\n   383→                    <input type=\"text\" id=\"text-search-input\" class=\"search-input\" placeholder=\"Search text...\">\n   384→                    <button id=\"text-search-btn\" class=\"btn btn-small\">Search</button>\n   385→                    <button id=\"text-search-prev-btn\" class=\"btn btn-small btn-icon\" title=\"Previous\">◀</button>\n   386→                    <button id=\"text-search-next-btn\" class=\"btn btn-small btn-icon\" title=\"Next\">▶</button>\n   387→                    <span id=\"text-search-results\" class=\"search-results\">0/0</span>\n   388→                </div>\n   389→                <div class=\"replace-row\">\n   390→                    <input type=\"text\" id=\"text-replace-input\" class=\"search-input\" placeholder=\"Replace with...\">\n   391→                    <button id=\"text-replace-btn\" class=\"btn btn-small btn-secondary\">Replace</button>\n   392→                    <button id=\"text-replace-all-btn\" class=\"btn btn-small btn-secondary\">Replace All</button>\n   393→                </div>\n   394→            </div>\n   395→\n   396→            <!-- Preview Panel -->\n   397→            <div id=\"text-editor-preview\" class=\"text-editor-preview\"></div>\n   398→\n   399→            <!-- Action Buttons -->\n   400→            <div class=\"text-editor-actions\">\n   401→                <button id=\"preview-text-edits-btn\" class=\"btn btn-secondary\">Preview Changes</button>\n   402→                <button id=\"apply-text-edits-btn\" class=\"btn btn-primary\">Apply Edits</button>\n   403→                <button id=\"text-editor-build-btn\" class=\"btn btn-primary\" disabled>Build Sequence</button>\n   404→            </div>\n   405→        </div>\n   406→    </div>\n   407→\n   408→    <!-- Social Reframe Section -->\n   409→    <div id=\"socialReframeSection\" class=\"social-reframe-section\">\n   410→        <div id=\"socialReframeToggle\" class=\"section-toggle\">\n   411→            <span class=\"toggle-icon\">+</span>\n   412→            <span>Social Reframe</span>\n   413→        </div>\n   414→        <div id=\"social-reframe-panel\" class=\"social-reframe-panel collapsed\">\n   415→            <!-- Platform Selector -->\n   416→            <div class=\"reframe-platforms\">\n   417→                <label>Platform</label>\n   418→                <div id=\"reframe-platform-selector\" class=\"reframe-platform-selector\"></div>\n   419→            </div>\n   420→\n   421→            <!-- Aspect Ratio Selector -->\n   422→            <div class=\"reframe-aspects\">\n   423→                <label>Aspect Ratio</label>\n   424→                <div id=\"reframe-aspect-selector\" class=\"reframe-aspect-selector\"></div>\n   425→            </div>\n   426→\n   427→            <!-- Settings -->\n   428→            <div class=\"reframe-settings\">\n   429→                <div class=\"slider-container small\">\n   430→                    <label>Motion Smoothing: <span id=\"smoothing-value-display\">0.30</span></label>\n   431→                    <input type=\"range\" id=\"motion-smoothing-slider\" min=\"0\" max=\"1\" step=\"0.05\" value=\"0.3\">\n   432→                </div>\n   433→            </div>\n   434→\n   435→            <!-- Action Buttons -->\n   436→            <div class=\"reframe-actions\">\n   437→                <button id=\"analyze-reframe-btn\" class=\"btn btn-primary\">Analyze Video</button>\n   438→                <button id=\"toggle-safe-zones-btn\" class=\"btn btn-small btn-secondary\">Safe Zones</button>\n   439→            </div>\n   440→\n   441→            <!-- Status -->\n   442→            <div id=\"reframe-status\" class=\"reframe-status\"></div>\n   443→\n   444→            <!-- Analysis Results -->\n   445→            <div id=\"reframe-analysis-results\" class=\"reframe-analysis-results\"></div>\n   446→\n   447→            <!-- Preview Canvas -->\n   448→            <div class=\"reframe-preview-wrapper\">\n   449→                <canvas id=\"reframe-preview-canvas\" class=\"reframe-preview-canvas\" width=\"280\" height=\"160\"></canvas>\n   450→            </div>\n   451→\n   452→            <!-- Export Buttons -->\n   453→            <div class=\"reframe-export-actions\">\n   454→                <button id=\"export-reframe-btn\" class=\"btn btn-secondary\">Export</button>\n   455→                <button id=\"export-all-formats-btn\" class=\"btn btn-secondary\">Export All</button>\n   456→            </div>\n   457→\n   458→            <!-- Export Results -->\n   459→            <div id=\"reframe-export-results\" class=\"reframe-export-results\"></div>\n   460→        </div>\n   461→    </div>\n   462→\n   463→    <!-- Music Section -->\n   464→    <div id=\"musicSection\" class=\"music-section\">\n   465→        <div id=\"musicToggle\" class=\"section-toggle\">\n   466→            <span class=\"toggle-icon\">+</span>\n   467→            <span>AI Music</span>\n   468→            <span id=\"music-credits-badge\" class=\"music-credits-badge\"></span>\n   469→        </div>\n   470→        <div id=\"music-panel\" class=\"music-panel collapsed\">\n   471→            <!-- Tab Navigation -->\n   472→            <div class=\"music-tabs\">\n   473→                <button class=\"music-tab active\" data-tab=\"generate\">Generate</button>\n   474→                <button class=\"music-tab\" data-tab=\"identify\">Identify</button>\n   475→                <button class=\"music-tab\" data-tab=\"library\">Library</button>\n   476→            </div>\n   477→\n   478→            <!-- Generate Tab -->\n   479→            <div id=\"music-tab-generate\" class=\"music-tab-content active\">\n   480→                <!-- Mood Selection -->\n   481→                <div class=\"music-mood-section\">\n   482→                    <label>Mood</label>\n   483→                    <div id=\"music-mood-selector\" class=\"music-mood-selector\"></div>\n   484→                </div>\n   485→\n   486→                <!-- Instrument Selection -->\n   487→                <div class=\"music-instrument-section\">\n   488→                    <label>Instruments</label>\n   489→                    <div id=\"music-instrument-selector\" class=\"music-instrument-selector\"></div>\n   490→                </div>\n   491→\n   492→                <!-- Duration Slider -->\n   493→                <div class=\"slider-container small\">\n   494→                    <label>Duration: <span id=\"music-duration-value\">60</span>s</label>\n   495→                    <input type=\"range\" id=\"music-duration-slider\" min=\"30\" max=\"180\" step=\"15\" value=\"60\">\n   496→                </div>\n   497→\n   498→                <!-- Custom Prompt -->\n   499→                <div class=\"form-group small\">\n   500→                    <label>Custom Prompt (optional)</label>\n   501→                    <textarea id=\"music-custom-prompt\" class=\"music-custom-prompt\"\n   502→                        placeholder=\"Add specific instructions...\"></textarea>\n   503→                </div>\n   504→\n   505→                <!-- Generation Options -->\n   506→                <div class=\"music-options\">\n   507→                    <label class=\"checkbox-label\">\n   508→                        <input type=\"checkbox\" id=\"music-scene-aware\">\n   509→                        Scene-Aware (uses transcript)\n   510→                    </label>\n   511→                    <span id=\"sceneAwareIndicator\" class=\"scene-aware-indicator\" style=\"display: none;\">Analyzing\n   512→                        transcript...</span>\n   513→                    <label class=\"checkbox-label\">\n   514→                        <input type=\"checkbox\" id=\"music-variations\">\n   515→                        Generate 3 Variations\n   516→                    </label>\n   517→                </div>\n   518→\n   519→                <!-- Generate Button -->\n   520→                <div class=\"music-generate-actions\">\n   521→                    <button id=\"music-generate-btn\" class=\"btn btn-primary\">Generate Music</button>\n   522→                    <button id=\"music-timeline-btn\" class=\"btn btn-secondary\">Generate Timeline</button>\n   523→                </div>\n   524→            </div>\n   525→\n   526→            <!-- Identify Tab -->\n   527→            <div id=\"music-tab-identify\" class=\"music-tab-content\">\n   528→                <div class=\"form-group\">\n   529→                    <label>YouTube URL</label>\n   530→                    <input type=\"text\" id=\"music-youtube-url\" placeholder=\"https://youtube.com/watch?v=...\">\n   531→                </div>\n   532→                <button id=\"music-identify-btn\" class=\"btn btn-primary\">Identify Song</button>\n   533→                <div id=\"music-identify-result\" class=\"music-identify-result\"></div>\n   534→            </div>\n   535→\n   536→            <!-- Library Tab -->\n   537→            <div id=\"music-tab-library\" class=\"music-tab-content\">\n   538→                <div id=\"music-library-list\" class=\"music-library-list\">\n   539→                    <div class=\"music-library-empty\">No music generated yet</div>\n   540→                </div>\n   541→            </div>\n   542→\n   543→            <!-- Status -->\n   544→            <div id=\"music-status\" class=\"music-status\"></div>\n   545→\n   546→            <!-- Active Jobs List -->\n   547→            <div id=\"music-jobs-list\" class=\"music-jobs-list\"></div>\n   548→\n   549→            <!-- Progress -->\n   550→            <div id=\"music-progress\" class=\"music-progress hidden\">\n   551→                <div class=\"music-progress-bar-container\">\n   552→                    <div id=\"music-progress-bar\" class=\"music-progress-bar\" style=\"width: 0%\"></div>\n   553→                </div>\n   554→                <div id=\"music-progress-text\" class=\"music-progress-text\">Generating...</div>\n   555→            </div>\n   556→\n   557→            <!-- Variations Selection UI -->\n   558→            <div id=\"music-variations-panel\" class=\"music-variations-panel hidden\">\n   559→                <label>Select a Variation</label>\n   560→                <div id=\"music-variations-list\" class=\"music-variations-list\"></div>\n   561→            </div>\n   562→\n   563→            <!-- Audio Preview -->\n   564→            <div id=\"music-preview\" class=\"music-preview hidden\">\n   565→                <div class=\"music-preview-header\">\n   566→                    <span id=\"music-preview-title\">Preview</span>\n   567→                    <button id=\"music-preview-close\" class=\"btn btn-small btn-ghost\">×</button>\n   568→                </div>\n   569→                <audio id=\"music-audio-player\" controls></audio>\n   570→                <div class=\"music-preview-actions\">\n   571→                    <button id=\"music-download-btn\" class=\"btn btn-small btn-secondary\">Download</button>\n   572→                    <button id=\"music-import-btn\" class=\"btn btn-small btn-primary\">Import to Timeline</button>\n   573→                </div>\n   574→            </div>\n   575→\n   576→            <!-- Alignment Modal Trigger (hidden, triggered from library) -->\n   577→            <div id=\"music-align-modal\" class=\"music-align-modal hidden\">\n   578→                <div class=\"music-align-content\">\n   579→                    <div class=\"music-align-header\">\n   580→                        <span>Align to Video</span>\n   581→                        <button id=\"music-align-close\" class=\"btn btn-small btn-ghost\">×</button>\n   582→                    </div>\n   583→                    <div id=\"music-align-info\" class=\"music-align-info\"></div>\n   584→                    <div class=\"form-group small\">\n   585→                        <label>Target Duration (seconds)</label>\n   586→                        <input type=\"number\" id=\"music-align-target\" min=\"5\" max=\"3600\" value=\"60\">\n   587→                        <button id=\"music-align-match-seq\" class=\"btn btn-small btn-secondary\">Match Sequence</button>\n   588→                    </div>\n   589→                    <div class=\"slider-container small\">\n   590→                        <label>Fade Duration: <span id=\"music-fade-value\">2.0</span>s</label>\n   591→                        <input type=\"range\" id=\"music-fade-slider\" min=\"0.5\" max=\"5\" step=\"0.5\" value=\"2\">\n   592→                    </div>\n   593→                    <label class=\"checkbox-label\">\n   594→                        <input type=\"checkbox\" id=\"music-beat-align\" checked>\n   595→                        Align to nearest beat\n   596→                    </label>\n   597→                    <div class=\"music-align-actions\">\n   598→                        <button id=\"music-align-btn\" class=\"btn btn-primary\">Align & Trim</button>\n   599→                    </div>\n   600→                </div>\n   601→            </div>\n   602→\n   603→            <!-- Timeline Modal -->\n   604→            <div id=\"music-timeline-modal\" class=\"music-timeline-modal hidden\">\n   605→                <div class=\"music-timeline-content\">\n   606→                    <div class=\"music-timeline-header\">\n   607→                        <span>Generate Timeline Music</span>\n   608→                        <button id=\"music-timeline-close\" class=\"btn btn-small btn-ghost\">×</button>\n   609→                    </div>\n   610→                    <div id=\"music-timeline-info\" class=\"music-timeline-info\">\n   611→                        <span>Generates mood-matched music for each chapter</span>\n   612→                    </div>\n   613→                    <div class=\"form-group small\">\n   614→                        <label>Max Chapters</label>\n   615→                        <input type=\"number\" id=\"music-timeline-max-chapters\" min=\"1\" max=\"20\" value=\"10\">\n   616→                    </div>\n   617→                    <div class=\"form-group small\">\n   618→                        <label>Min Segment Length (seconds)</label>\n   619→                        <input type=\"number\" id=\"music-timeline-min-length\" min=\"15\" max=\"120\" value=\"30\">\n   620→                    </div>\n   621→                    <div class=\"slider-container small\">\n   622→                        <label>Crossfade: <span id=\"music-crossfade-value\">2.0</span>s</label>\n   623→                        <input type=\"range\" id=\"music-crossfade-slider\" min=\"0.5\" max=\"5\" step=\"0.5\" value=\"2\">\n   624→                    </div>\n   625→                    <div class=\"music-timeline-actions\">\n   626→                        <button id=\"music-timeline-generate-btn\" class=\"btn btn-primary\">Generate</button>\n   627→                    </div>\n   628→                </div>\n   629→            </div>\n   630→        </div>\n   631→    </div>\n   632→\n   633→    <!-- Results Area -->\n   634→    <div class=\"results-area\">\n   635→        <!-- Progress -->\n   636→        <div id=\"progressContainer\" class=\"progress-container hidden\" role=\"progressbar\" aria-live=\"polite\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\">\n   637→            <div class=\"progress-bar-container\">\n   638→                <div id=\"progressBar\" class=\"progress-bar\" style=\"width: 0%\"></div>\n   639→            </div>\n   640→            <div id=\"progressText\" class=\"progress-text\" aria-live=\"polite\">Detecting silences...</div>\n   641→        </div>\n   642→\n   643→        <!-- Empty State -->\n   644→        <div id=\"resultsEmpty\" class=\"results-empty\">\n   645→            <p>Ready to save 2 hours? Open a sequence and click GO to let AI handle the rough cut.</p>\n   646→        </div>\n   647→\n   648→        <!-- Combined Preview -->\n   649→        <div id=\"combinedPreview\" class=\"preview-section hidden\">\n   650→            <div class=\"preview-header\">\n   651→                <h3>Preview</h3>\n   652→                <div class=\"preview-counts\">\n   653→                    <span><span id=\"silenceCount\">0</span> silences</span>\n   654→                    <span><span id=\"takeCount\">0</span> takes</span>\n   655→                </div>\n   656→            </div>\n   657→\n   658→            <div class=\"preview-controls\">\n   659→                <label class=\"checkbox-label\">\n   660→                    <input type=\"checkbox\" id=\"selectAllSilences\" checked>\n   661→                    Select All (<span id=\"selectedCount\">0</span> selected)\n   662→                </label>\n   663→            </div>\n   664→\n   665→            <div id=\"previewList\" class=\"preview-list\"></div>\n   666→\n   667→            <div class=\"preview-actions\">\n   668→                <button id=\"applyPreviewBtn\" class=\"btn btn-secondary\">Add Markers</button>\n   669→                <button id=\"buildSequenceBtn\" class=\"btn btn-primary\">Build Sequence</button>\n   670→                <button id=\"cancelPreviewBtn\" class=\"btn btn-ghost\">Cancel</button>\n   671→            </div>\n   672→        </div>\n   673→\n   674→        <!-- Chapter Results -->\n   675→        <div id=\"chapterResults\" class=\"chapter-results hidden\">\n   676→            <div class=\"chapter-header\">\n   677→                <h3>Chapters</h3>\n   678→                <div class=\"chapter-actions\">\n   679→                    <button id=\"copyYouTubeBtn\" class=\"btn btn-small\">Copy YouTube</button>\n   680→                    <button id=\"addChapterMarkersBtn\" class=\"btn btn-small btn-primary\">Add Markers</button>\n   681→                </div>\n   682→            </div>\n   683→            <div id=\"chapterList\" class=\"chapter-list\"></div>\n   684→        </div>\n   685→\n   686→        <!-- Zoom Results -->\n   687→        <div id=\"zoomResults\" class=\"zoom-results hidden\">\n   688→            <div class=\"zoom-header\">\n   689→                <h3>Zoom Points</h3>\n   690→                <button id=\"applyZoomsBtn\" class=\"btn btn-small btn-primary\">Apply Zooms</button>\n   691→            </div>\n   692→            <div id=\"zoomList\" class=\"zoom-list\"></div>\n   693→        </div>\n   694→    </div>\n   695→\n   696→    <!-- Settings Modal -->\n   697→    <div id=\"settingsModal\" class=\"modal hidden\" role=\"dialog\" aria-modal=\"true\">\n   698→        <div class=\"modal-content\">\n   699→            <div class=\"modal-header\">\n   700→                <h2>Settings</h2>\n   701→                <button id=\"closeSettingsBtn\" class=\"close-btn\">&times;</button>\n   702→            </div>\n   703→            <div class=\"modal-body\">\n   704→                <div class=\"form-group\">\n   705→                    <label>Backend URL</label>\n   706→                    <input type=\"text\" id=\"backendUrlInput\" placeholder=\"Auto-detect\">\n   707→                </div>\n   708→                <div class=\"form-group\">\n   709→                    <label class=\"checkbox-label\">\n   710→                        <input type=\"checkbox\" id=\"rememberOptions\">\n   711→                        Remember Options\n   712→                    </label>\n   713→                </div>\n   714→            </div>\n   715→        </div>\n   716→    </div>\n   717→\n   718→    <!-- Login Modal -->\n   719→    <div id=\"loginModal\" class=\"modal hidden\" role=\"dialog\" aria-modal=\"true\">\n   720→        <div class=\"modal-content\">\n   721→            <div class=\"modal-header\">\n   722→                <h2>Login</h2>\n   723→                <button id=\"closeLoginBtn\" class=\"close-btn\">&times;</button>\n   724→            </div>\n   725→            <div class=\"modal-body\">\n   726→                <p>Enter your license key to activate SPLICE</p>\n   727→                <div id=\"loginError\" class=\"login-error\" role=\"alert\" aria-live=\"assertive\" style=\"display: none;\"></div>\n   728→                <div class=\"form-group\">\n   729→                    <label for=\"licenseKeyInput\">License Key</label>\n   730→                    <input type=\"text\" id=\"licenseKeyInput\" placeholder=\"SPLICE-XXXX-XXXX-XXXX\">\n   731→                </div>\n   732→                <div class=\"form-group\">\n   733→                    <label for=\"lookupEmailInput\">Or lookup by email</label>\n   734→                    <input type=\"email\" id=\"lookupEmailInput\" placeholder=\"your@email.com\">\n   735→                    <button id=\"lookupLicenseBtn\" class=\"btn btn-secondary\">Lookup</button>\n   736→                </div>\n   737→                <button id=\"saveLoginBtn\" class=\"btn btn-primary\">Activate</button>\n   738→                <div class=\"login-divider\">\n   739→                    <span>Don't have a license?</span>\n   740→                </div>\n   741→                <button type=\"button\" class=\"btn btn-secondary btn-buy-license\">\n   742→                    Buy License\n   743→                </button>\n   744→            </div>\n   745→        </div>\n   746→    </div>\n   747→\n   748→    <!-- Upgrade Modal (shown when user tries to access a gated feature) -->\n   749→    <div id=\"upgradeModal\" class=\"modal hidden\" role=\"dialog\" aria-modal=\"true\">\n   750→        <div class=\"modal-content\">\n   751→            <div class=\"modal-header\">\n   752→                <h2>Upgrade Required</h2>\n   753→                <button id=\"closeUpgradeBtn\" class=\"close-btn\" onclick=\"closeUpgradeModal()\">&times;</button>\n   754→            </div>\n   755→            <div class=\"modal-body upgrade-modal-body\">\n   756→                <p><strong><span id=\"upgradeFeatureName\">This feature</span></strong> requires a <span\n   757→                        id=\"upgradeRequiredTier\">Pro</span> plan or higher.</p>\n   758→                <p class=\"upgrade-description\">Upgrade your plan to unlock this feature and many more!</p>\n   759→                <div class=\"upgrade-actions\">\n   760→                    <button type=\"button\" class=\"btn btn-primary btn-view-plans\" data-url=\"https://splice.video/pricing\">View Plans</button>\n   761→                    <button class=\"btn btn-secondary\" onclick=\"closeUpgradeModal()\">Maybe Later</button>\n   762→                </div>\n   763→            </div>\n   764→        </div>\n   765→    </div>\n   766→\n   767→    <!-- Debug Modal -->\n   768→    <div id=\"debugModal\" class=\"modal hidden\" role=\"dialog\" aria-modal=\"true\">\n   769→        <div class=\"modal-content debug-modal-content\">\n   770→            <div class=\"modal-header\">\n   771→                <h2>Debug Information</h2>\n   772→                <button id=\"closeDebugBtn\" class=\"close-btn\">&times;</button>\n   773→            </div>\n   774→            <div class=\"modal-body debug-modal-body\">\n   775→                <div class=\"debug-section\">\n   776→                    <h3>Quick Diagnosis</h3>\n   777→                    <div id=\"debugQuickDiagnosis\" class=\"debug-info\">Click \"Run Diagnostics\" to check</div>\n   778→                </div>\n   779→                <div class=\"debug-section\">\n   780→                    <h3>Actions</h3>\n   781→                    <button id=\"runDiagnosticsBtn\" class=\"btn btn-primary\">Run Diagnostics</button>\n   782→                    <button id=\"copyDiagnosticsBtn\" class=\"btn btn-secondary\">Copy to Clipboard</button>\n   783→                </div>\n   784→                <div class=\"debug-section\">\n   785→                    <h3>Detailed Logs</h3>\n   786→                    <div id=\"debugLogs\" class=\"debug-logs\">\n   787→                        <p class=\"debug-placeholder\">No logs collected yet. Click \"Run Diagnostics\" to collect diagnostic information.</p>\n   788→                    </div>\n   789→                </div>\n   790→            </div>\n   791→        </div>\n   792→    </div>\n   793→\n   794→    <!-- Referral Promo Footer (visible when logged in) -->\n   795→    <div id=\"referralPromo\" class=\"referral-promo hidden\">\n   796→        <div class=\"referral-promo-content\">\n   797→            <span class=\"referral-icon\">&#127873;</span>\n   798→            <span class=\"referral-text\">Share SPLICE, get <strong>1 free hour</strong> per referral</span>\n   799→            <button type=\"button\" class=\"referral-link btn-referral\" data-url=\"https://splice.video/referrals\">Learn More</button>\n   800→        </div>\n   801→    </div>\n   802→\n   803→    <!-- Scripts -->\n   804→    <!-- Browser simulation MUST load first to mock window.__adobe_cep__ before CSInterface checks for it -->\n   805→    <script src=\"js/browser-simulation.js\"></script>\n   806→    <script src=\"js/CSInterface.js\"></script>\n   807→    <script src=\"js/config.js\"></script>\n   808→    <script src=\"js/credits.js\"></script>\n   809→    <script src=\"js/slice6-analyze.js\"></script>\n   810→    <script src=\"js/slice7-apply.js\"></script>\n   811→    <script src=\"js/slice8-silence.js\"></script>\n   812→    <script src=\"js/builder.js\"></script>\n   813→    <script src=\"js/multitrack.js\"></script>\n   814→    <script src=\"js/animatedCaptions.js\"></script>\n   815→    <script src=\"js/textEditor.js\"></script>\n   816→    <script src=\"js/socialReframe.js\"></script>\n   817→    <script src=\"js/music.js\"></script>\n   818→    <script src=\"js/main.js\"></script>\n   819→</body>\n   820→\n   821→</html>\n\n</system-reminder>\n"}]},"uuid":"89294b56-4639-4bd0-99dc-64b5fec0efa7","timestamp":"2026-01-12T09:17:48.543Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/SPLICE/splice-cep/panel/index.html","content":"<!DOCTYPE html>\n<html lang=\"en\">\n\n<head>\n    <meta charset=\"utf-8\">\n    <title>SPLICE - AI Video Editor</title>\n    <link rel=\"stylesheet\" href=\"css/style.css\">\n</head>\n\n<body>\n    <!-- Loading Overlay -->\n    <div id=\"loading-overlay\">\n        <div class=\"loader-logo\"></div>\n        <div class=\"loader-text\">Initializing Antigravity...</div>\n    </div>\n    <!-- Header -->\n    <div class=\"header\">\n        <h1>SPLICE</h1>\n        <div class=\"header-actions\">\n            <div id=\"creditBadge\" class=\"credit-badge login\">Login</div>\n            <button id=\"debugBtn\" class=\"icon-btn\" title=\"Debug\">🔍</button>\n            <button id=\"helpBtn\" class=\"icon-btn\" title=\"Help\">?</button>\n            <button id=\"settingsBtn\" class=\"icon-btn\" title=\"Settings\">⚙</button>\n        </div>\n    </div>\n\n    <!-- Status Bar -->\n    <div id=\"status\" role=\"status\" aria-live=\"polite\">Ready</div>\n\n    <!-- Main Action Card -->\n    <div class=\"action-card\">\n        <h2>Quick Edit</h2>\n\n        <!-- GO Button -->\n        <button id=\"goBtn\" class=\"go-btn\" aria-label=\"Start detection\">GO</button>\n\n        <!-- Options Toggle -->\n        <button id=\"optionsToggle\" class=\"options-toggle\" aria-expanded=\"false\">Options</button>\n\n        <!-- Options Panel -->\n        <div id=\"optionsPanel\" class=\"options-panel collapsed\">\n            <!-- Preset Selector -->\n            <div class=\"form-group\">\n                <label for=\"presetSelector\">Preset</label>\n                <select id=\"presetSelector\">\n                    <option value=\"podcast\">Podcast</option>\n                    <option value=\"interview\">Interview</option>\n                    <option value=\"reaction\">Reaction</option>\n                    <option value=\"tutorial\">Tutorial</option>\n                    <option value=\"vlog\">Vlog</option>\n                    <option value=\"custom\">Custom</option>\n                </select>\n            </div>\n\n            <!-- Sensitivity Slider -->\n            <div class=\"slider-container\">\n                <label for=\"sensitivitySlider\">Sensitivity: <span id=\"sensitivityValue\">50</span></label>\n                <input type=\"range\" id=\"sensitivitySlider\" min=\"0\" max=\"100\" value=\"50\">\n                <div class=\"slider-labels\">\n                    <span>Less cuts</span>\n                    <span>More cuts</span>\n                </div>\n            </div>\n\n            <!-- Audio Source -->\n            <div class=\"audio-source-group\">\n                <label>Audio Source</label>\n                <label class=\"checkbox-label\">\n                    <input type=\"checkbox\" id=\"sourceOriginal\" checked>\n                    Original Audio\n                </label>\n                <label class=\"checkbox-label\">\n                    <input type=\"checkbox\" id=\"sourceIsolated\">\n                    Isolated Vocals <span class=\"tier-badge\">PRO</span>\n                </label>\n            </div>\n\n            <!-- Feature Toggles -->\n            <div class=\"feature-toggles\">\n                <label class=\"checkbox-label\">\n                    <input type=\"checkbox\" id=\"enableTakesDetection\" checked>\n                    Detect Takes\n                </label>\n\n                <label class=\"checkbox-label\">\n                    <input type=\"checkbox\" id=\"enableJCut\">\n                    J-Cut / L-Cut\n                </label>\n                <div id=\"jcutSettings\" class=\"sub-options collapsed\">\n                    <div class=\"slider-container small\">\n                        <label>Lead In: <span id=\"jcutLeadInValue\">0.30s</span></label>\n                        <input type=\"range\" id=\"jcutLeadIn\" min=\"0\" max=\"100\" value=\"30\">\n                    </div>\n                    <div class=\"slider-container small\">\n                        <label>Lead Out: <span id=\"jcutLeadOutValue\">0.20s</span></label>\n                        <input type=\"range\" id=\"jcutLeadOut\" min=\"0\" max=\"100\" value=\"20\">\n                    </div>\n                </div>\n\n                <label class=\"checkbox-label\">\n                    <input type=\"checkbox\" id=\"enableZoom\">\n                    Auto Zoom\n                </label>\n                <div id=\"zoomSettings\" class=\"sub-options collapsed\">\n                    <div class=\"form-group small\">\n                        <label>Frequency</label>\n                        <select id=\"zoomFrequency\">\n                            <option value=\"low\">Low (~1/min)</option>\n                            <option value=\"medium\" selected>Medium (~2/min)</option>\n                            <option value=\"high\">High (~4/min)</option>\n                        </select>\n                    </div>\n                    <div class=\"form-group small\">\n                        <label>Intensity</label>\n                        <select id=\"zoomPreset\">\n                            <option value=\"subtle\">Subtle (110%)</option>\n                            <option value=\"medium\" selected>Medium (120%)</option>\n                            <option value=\"dramatic\">Dramatic (140%)</option>\n                        </select>\n                    </div>\n                    <div class=\"form-group small\">\n                        <label>Placement</label>\n                        <select id=\"zoomPlacement\">\n                            <option value=\"sentence_start\" selected>Sentence Starts</option>\n                            <option value=\"keywords\">Keywords</option>\n                            <option value=\"random\">Random</option>\n                        </select>\n                    </div>\n                </div>\n\n                <label class=\"checkbox-label\">\n                    <input type=\"checkbox\" id=\"enableChapters\">\n                    Detect Chapters\n                </label>\n                <div id=\"chapterSettings\" class=\"sub-options collapsed\">\n                    <div class=\"form-group small\">\n                        <label>Max Chapters</label>\n                        <input type=\"number\" id=\"maxChapters\" min=\"1\" max=\"50\" value=\"10\">\n                    </div>\n                    <div class=\"form-group small\">\n                        <label>Min Length (s)</label>\n                        <input type=\"number\" id=\"minChapterLength\" min=\"30\" max=\"600\" value=\"60\">\n                    </div>\n                </div>\n\n                <!-- Profanity Bleeping (Feature 1: Firecut Parity) -->\n                <label class=\"checkbox-label\">\n                    <input type=\"checkbox\" id=\"enableProfanity\">\n                    Profanity Detection\n                </label>\n                <div id=\"profanitySettings\" class=\"sub-options collapsed\">\n                    <div class=\"form-group small\">\n                        <label>Bleep Type</label>\n                        <select id=\"bleepType\">\n                            <option value=\"standard\">Standard (1kHz)</option>\n                            <option value=\"tv\">TV Bleep</option>\n                            <option value=\"radio\">Radio Bleep</option>\n                            <option value=\"duck\">Duck Audio</option>\n                            <option value=\"mute\">Mute</option>\n                        </select>\n                    </div>\n                    <div class=\"form-group small\">\n                        <label>Volume</label>\n                        <input type=\"range\" id=\"bleepVolume\" min=\"0\" max=\"100\" value=\"50\">\n                    </div>\n                    <label class=\"checkbox-label\">\n                        <input type=\"checkbox\" id=\"enableBleepInsertion\">\n                        Auto-insert bleeps\n                    </label>\n                </div>\n\n                <!-- Filler Word Detection (Feature 2: Firecut Parity) -->\n                <label class=\"checkbox-label\">\n                    <input type=\"checkbox\" id=\"enableFillerDetection\">\n                    Filler Word Detection\n                </label>\n                <div id=\"fillerSettings\" class=\"sub-options collapsed\">\n                    <div class=\"form-group small\">\n                        <label>Custom Fillers</label>\n                        <input type=\"text\" id=\"customFillers\" placeholder=\"basically, literally\">\n                    </div>\n                    <button id=\"detectFillersBtn\" class=\"btn btn-small\">Detect Fillers</button>\n                    <button id=\"removeFillersBtn\" class=\"btn btn-small btn-secondary\" disabled>Remove Fillers</button>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Multitrack Section -->\n    <div id=\"multitrackSection\" class=\"multitrack-section\">\n        <div id=\"multitrackToggle\" class=\"section-toggle\">\n            <span class=\"toggle-icon\">+</span>\n            <span>Multitrack / Multi-Speaker</span>\n        </div>\n        <div id=\"multitrackPanel\" class=\"multitrack-panel collapsed\">\n            <!-- Speaker Configuration -->\n            <div class=\"speaker-config\">\n                <div class=\"speaker-config-header\">\n                    <span>Speakers</span>\n                    <button id=\"addSpeakerBtn\" class=\"btn btn-small\">+ Add</button>\n                </div>\n                <div id=\"speakerList\" class=\"speaker-list\">\n                    <div class=\"speaker-item speaker-0\" data-speaker-index=\"0\">\n                        <input type=\"text\" class=\"speaker-name\" value=\"Speaker 1\" placeholder=\"Name\"\n                            aria-label=\"Speaker 1 name\">\n                        <select class=\"speaker-track\" aria-label=\"Speaker 1 video track\">\n                            <option value=\"0\" selected>V1</option>\n                            <option value=\"1\">V2</option>\n                            <option value=\"2\">V3</option>\n                            <option value=\"3\">V4</option>\n                        </select>\n                        <button class=\"speaker-remove-btn\" title=\"Remove speaker\" aria-label=\"Remove speaker 1\"\n                            style=\"display: none;\">x</button>\n                    </div>\n                    <div class=\"speaker-item speaker-1\" data-speaker-index=\"1\">\n                        <input type=\"text\" class=\"speaker-name\" value=\"Speaker 2\" placeholder=\"Name\"\n                            aria-label=\"Speaker 2 name\">\n                        <select class=\"speaker-track\" aria-label=\"Speaker 2 video track\">\n                            <option value=\"0\">V1</option>\n                            <option value=\"1\" selected>V2</option>\n                            <option value=\"2\">V3</option>\n                            <option value=\"3\">V4</option>\n                        </select>\n                        <button class=\"speaker-remove-btn\" title=\"Remove speaker\" aria-label=\"Remove speaker 2\"\n                            style=\"display: none;\">x</button>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Parameters -->\n            <div class=\"multitrack-params\">\n                <div class=\"slider-container small\">\n                    <label>Min Shot Duration: <span id=\"minShotDurationValue\">2.0s</span></label>\n                    <input type=\"range\" id=\"minShotDuration\" min=\"0.5\" max=\"10\" step=\"0.5\" value=\"2\">\n                </div>\n                <div class=\"slider-container small\">\n                    <label>Wide Shot %: <span id=\"wideShotPercentValue\">20%</span></label>\n                    <input type=\"range\" id=\"wideShotPercent\" min=\"0\" max=\"50\" step=\"5\" value=\"20\">\n                </div>\n                <div class=\"slider-container small\">\n                    <label>Switching Frequency: <span id=\"switchingFrequencyValue\">50</span></label>\n                    <input type=\"range\" id=\"switchingFrequency\" min=\"10\" max=\"100\" step=\"10\" value=\"50\">\n                </div>\n                <label class=\"checkbox-label\">\n                    <input type=\"checkbox\" id=\"enableWideShotDetection\" checked>\n                    Enable Wide Shot Detection\n                </label>\n                <div class=\"form-group small\">\n                    <label>Wide Shot Track</label>\n                    <select id=\"wideShotTrack\">\n                        <option value=\"-1\">None</option>\n                        <option value=\"0\">V1</option>\n                        <option value=\"1\">V2</option>\n                        <option value=\"2\">V3</option>\n                        <option value=\"3\">V4</option>\n                    </select>\n                </div>\n            </div>\n\n            <!-- Action Buttons -->\n            <div class=\"multitrack-actions\">\n                <button id=\"analyzeMultitrackBtn\" class=\"btn btn-primary\">Analyze</button>\n                <button id=\"autoBalanceBtn\" class=\"btn btn-secondary\">Auto-Balance</button>\n            </div>\n\n            <!-- Results Preview -->\n            <div id=\"multitrackPreview\" class=\"multitrack-preview hidden\">\n                <div class=\"distribution-chart-container\">\n                    <label>Speaker Distribution</label>\n                    <div id=\"distributionChart\" class=\"distribution-chart\"></div>\n                </div>\n                <div id=\"speakerStats\" class=\"speaker-stats\"></div>\n                <div class=\"decision-list-header\">\n                    <span>Switching Decisions (<span id=\"decisionCount\">0</span>)</span>\n                </div>\n                <div id=\"decisionList\" class=\"decision-list\"></div>\n                <div class=\"multitrack-preview-actions\">\n                    <button id=\"applyMultitrackBtn\" class=\"btn btn-primary\" disabled>Apply</button>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Animated Captions Section -->\n    <div id=\"captionsSection\" class=\"captions-section\">\n        <div id=\"captionsToggle\" class=\"section-toggle\">\n            <span class=\"toggle-icon\">+</span>\n            <span>Animated Captions</span>\n        </div>\n        <div id=\"captionsPanel\" class=\"captions-panel collapsed\">\n            <!-- Template Gallery -->\n            <div class=\"caption-templates\">\n                <label>Template Style</label>\n                <div id=\"captionTemplateGallery\" class=\"caption-template-gallery\"></div>\n            </div>\n\n            <!-- Settings -->\n            <div class=\"caption-settings\">\n                <div class=\"form-group small\">\n                    <label>Words per Line</label>\n                    <select id=\"captionWordsPerLine\">\n                        <option value=\"2\">2 words</option>\n                        <option value=\"3\">3 words</option>\n                        <option value=\"4\" selected>4 words</option>\n                        <option value=\"5\">5 words</option>\n                    </select>\n                </div>\n                <label class=\"checkbox-label\">\n                    <input type=\"checkbox\" id=\"captionHighlightKeywords\" checked>\n                    Highlight Keywords\n                </label>\n                <label class=\"checkbox-label\">\n                    <input type=\"checkbox\" id=\"captionInsertEmojis\">\n                    Insert Emojis\n                </label>\n                <div class=\"form-group small\" id=\"emojiFrequencyGroup\" style=\"display: none;\">\n                    <label>Emoji Frequency</label>\n                    <select id=\"captionEmojiFrequency\">\n                        <option value=\"low\">Low</option>\n                        <option value=\"medium\" selected>Medium</option>\n                        <option value=\"high\">High</option>\n                    </select>\n                </div>\n            </div>\n\n            <!-- Action Buttons -->\n            <div class=\"caption-actions\">\n                <button id=\"generateCaptionsBtn\" class=\"btn btn-primary\">Generate Captions</button>\n            </div>\n\n            <!-- Stats -->\n            <div id=\"captionStats\" class=\"caption-stats\"></div>\n\n            <!-- Status -->\n            <div id=\"captionStatus\" class=\"caption-status\"></div>\n\n            <!-- Preview -->\n            <div id=\"captionPreviewContainer\" class=\"caption-preview-container\"></div>\n\n            <!-- Export Actions -->\n            <div class=\"caption-export-actions hidden\" id=\"captionExportActions\">\n                <button id=\"exportCaptionsSrtBtn\" class=\"btn btn-small btn-secondary\">Export SRT</button>\n                <button id=\"exportCaptionsMogrtBtn\" class=\"btn btn-small btn-secondary\">Export MOGRT</button>\n                <button id=\"copyCaptionsBtn\" class=\"btn btn-small btn-secondary\">Copy</button>\n                <button id=\"applyCaptionsBtn\" class=\"btn btn-small btn-primary\">Add Markers</button>\n            </div>\n        </div>\n    </div>\n\n    <!-- Text Editor Section -->\n    <div id=\"textEditorSection\" class=\"text-editor-section\">\n        <div id=\"textEditorToggle\" class=\"section-toggle\">\n            <span class=\"toggle-icon\">+</span>\n            <span>Text-Based Editing</span>\n        </div>\n        <div id=\"text-editor-panel\" class=\"text-editor-panel collapsed\">\n            <!-- Status Bar -->\n            <div class=\"text-editor-bar\">\n                <span id=\"text-editor-word-count\" class=\"text-editor-word-count\">0 words</span>\n                <span id=\"text-editor-dirty\" class=\"text-editor-dirty\" style=\"display: none;\">*</span>\n                <span id=\"text-editor-status\" class=\"text-editor-status\"></span>\n            </div>\n\n            <!-- Toolbar -->\n            <div class=\"text-editor-toolbar\">\n                <button id=\"text-editor-undo-btn\" class=\"btn btn-small btn-icon\" title=\"Undo (Ctrl+Z)\"\n                    disabled>↶</button>\n                <button id=\"text-editor-redo-btn\" class=\"btn btn-small btn-icon\" title=\"Redo (Ctrl+Y)\"\n                    disabled>↷</button>\n                <div class=\"toolbar-divider\"></div>\n                <button id=\"text-editor-reset-btn\" class=\"btn btn-small btn-secondary\">Reset</button>\n            </div>\n\n            <!-- Editor Content -->\n            <div class=\"text-editor-content-wrapper\">\n                <textarea id=\"text-editor-content\" class=\"text-editor-content\"\n                    placeholder=\"Load a transcript to begin editing...\"></textarea>\n            </div>\n\n            <!-- Search & Replace -->\n            <div class=\"text-editor-search\">\n                <div class=\"search-row\">\n                    <input type=\"text\" id=\"text-search-input\" class=\"search-input\" placeholder=\"Search text...\">\n                    <button id=\"text-search-btn\" class=\"btn btn-small\">Search</button>\n                    <button id=\"text-search-prev-btn\" class=\"btn btn-small btn-icon\" title=\"Previous\">◀</button>\n                    <button id=\"text-search-next-btn\" class=\"btn btn-small btn-icon\" title=\"Next\">▶</button>\n                    <span id=\"text-search-results\" class=\"search-results\">0/0</span>\n                </div>\n                <div class=\"replace-row\">\n                    <input type=\"text\" id=\"text-replace-input\" class=\"search-input\" placeholder=\"Replace with...\">\n                    <button id=\"text-replace-btn\" class=\"btn btn-small btn-secondary\">Replace</button>\n                    <button id=\"text-replace-all-btn\" class=\"btn btn-small btn-secondary\">Replace All</button>\n                </div>\n            </div>\n\n            <!-- Preview Panel -->\n            <div id=\"text-editor-preview\" class=\"text-editor-preview\"></div>\n\n            <!-- Action Buttons -->\n            <div class=\"text-editor-actions\">\n                <button id=\"preview-text-edits-btn\" class=\"btn btn-secondary\">Preview Changes</button>\n                <button id=\"apply-text-edits-btn\" class=\"btn btn-primary\">Apply Edits</button>\n                <button id=\"text-editor-build-btn\" class=\"btn btn-primary\" disabled>Build Sequence</button>\n            </div>\n        </div>\n    </div>\n\n    <!-- Social Reframe Section -->\n    <div id=\"socialReframeSection\" class=\"social-reframe-section\">\n        <div id=\"socialReframeToggle\" class=\"section-toggle\">\n            <span class=\"toggle-icon\">+</span>\n            <span>Social Reframe</span>\n        </div>\n        <div id=\"social-reframe-panel\" class=\"social-reframe-panel collapsed\">\n            <!-- Platform Selector -->\n            <div class=\"reframe-platforms\">\n                <label>Platform</label>\n                <div id=\"reframe-platform-selector\" class=\"reframe-platform-selector\"></div>\n            </div>\n\n            <!-- Aspect Ratio Selector -->\n            <div class=\"reframe-aspects\">\n                <label>Aspect Ratio</label>\n                <div id=\"reframe-aspect-selector\" class=\"reframe-aspect-selector\"></div>\n            </div>\n\n            <!-- Settings -->\n            <div class=\"reframe-settings\">\n                <div class=\"slider-container small\">\n                    <label>Motion Smoothing: <span id=\"smoothing-value-display\">0.30</span></label>\n                    <input type=\"range\" id=\"motion-smoothing-slider\" min=\"0\" max=\"1\" step=\"0.05\" value=\"0.3\">\n                </div>\n            </div>\n\n            <!-- Action Buttons -->\n            <div class=\"reframe-actions\">\n                <button id=\"analyze-reframe-btn\" class=\"btn btn-primary\">Analyze Video</button>\n                <button id=\"toggle-safe-zones-btn\" class=\"btn btn-small btn-secondary\">Safe Zones</button>\n            </div>\n\n            <!-- Status -->\n            <div id=\"reframe-status\" class=\"reframe-status\"></div>\n\n            <!-- Analysis Results -->\n            <div id=\"reframe-analysis-results\" class=\"reframe-analysis-results\"></div>\n\n            <!-- Preview Canvas -->\n            <div class=\"reframe-preview-wrapper\">\n                <canvas id=\"reframe-preview-canvas\" class=\"reframe-preview-canvas\" width=\"280\" height=\"160\"></canvas>\n            </div>\n\n            <!-- Export Buttons -->\n            <div class=\"reframe-export-actions\">\n                <button id=\"export-reframe-btn\" class=\"btn btn-secondary\">Export</button>\n                <button id=\"export-all-formats-btn\" class=\"btn btn-secondary\">Export All</button>\n            </div>\n\n            <!-- Export Results -->\n            <div id=\"reframe-export-results\" class=\"reframe-export-results\"></div>\n        </div>\n    </div>\n\n    <!-- Music Section -->\n    <div id=\"musicSection\" class=\"music-section\">\n        <div id=\"musicToggle\" class=\"section-toggle\">\n            <span class=\"toggle-icon\">+</span>\n            <span>AI Music</span>\n            <span id=\"music-credits-badge\" class=\"music-credits-badge\"></span>\n        </div>\n        <div id=\"music-panel\" class=\"music-panel collapsed\">\n            <!-- Tab Navigation -->\n            <div class=\"music-tabs\">\n                <button class=\"music-tab active\" data-tab=\"generate\">Generate</button>\n                <button class=\"music-tab\" data-tab=\"identify\">Identify</button>\n                <button class=\"music-tab\" data-tab=\"library\">Library</button>\n            </div>\n\n            <!-- Generate Tab -->\n            <div id=\"music-tab-generate\" class=\"music-tab-content active\">\n                <!-- Mood Selection -->\n                <div class=\"music-mood-section\">\n                    <label>Mood</label>\n                    <div id=\"music-mood-selector\" class=\"music-mood-selector\"></div>\n                </div>\n\n                <!-- Instrument Selection -->\n                <div class=\"music-instrument-section\">\n                    <label>Instruments</label>\n                    <div id=\"music-instrument-selector\" class=\"music-instrument-selector\"></div>\n                </div>\n\n                <!-- Duration Slider -->\n                <div class=\"slider-container small\">\n                    <label>Duration: <span id=\"music-duration-value\">60</span>s</label>\n                    <input type=\"range\" id=\"music-duration-slider\" min=\"30\" max=\"180\" step=\"15\" value=\"60\">\n                </div>\n\n                <!-- Custom Prompt -->\n                <div class=\"form-group small\">\n                    <label>Custom Prompt (optional)</label>\n                    <textarea id=\"music-custom-prompt\" class=\"music-custom-prompt\"\n                        placeholder=\"Add specific instructions...\"></textarea>\n                </div>\n\n                <!-- Generation Options -->\n                <div class=\"music-options\">\n                    <label class=\"checkbox-label\">\n                        <input type=\"checkbox\" id=\"music-scene-aware\">\n                        Scene-Aware (uses transcript)\n                    </label>\n                    <span id=\"sceneAwareIndicator\" class=\"scene-aware-indicator\" style=\"display: none;\">Analyzing\n                        transcript...</span>\n                    <label class=\"checkbox-label\">\n                        <input type=\"checkbox\" id=\"music-variations\">\n                        Generate 3 Variations\n                    </label>\n                </div>\n\n                <!-- Generate Button -->\n                <div class=\"music-generate-actions\">\n                    <button id=\"music-generate-btn\" class=\"btn btn-primary\">Generate Music</button>\n                    <button id=\"music-timeline-btn\" class=\"btn btn-secondary\">Generate Timeline</button>\n                </div>\n            </div>\n\n            <!-- Identify Tab -->\n            <div id=\"music-tab-identify\" class=\"music-tab-content\">\n                <div class=\"form-group\">\n                    <label>YouTube URL</label>\n                    <input type=\"text\" id=\"music-youtube-url\" placeholder=\"https://youtube.com/watch?v=...\">\n                </div>\n                <button id=\"music-identify-btn\" class=\"btn btn-primary\">Identify Song</button>\n                <div id=\"music-identify-result\" class=\"music-identify-result\"></div>\n            </div>\n\n            <!-- Library Tab -->\n            <div id=\"music-tab-library\" class=\"music-tab-content\">\n                <div id=\"music-library-list\" class=\"music-library-list\">\n                    <div class=\"music-library-empty\">No music generated yet</div>\n                </div>\n            </div>\n\n            <!-- Status -->\n            <div id=\"music-status\" class=\"music-status\"></div>\n\n            <!-- Active Jobs List -->\n            <div id=\"music-jobs-list\" class=\"music-jobs-list\"></div>\n\n            <!-- Progress -->\n            <div id=\"music-progress\" class=\"music-progress hidden\">\n                <div class=\"music-progress-bar-container\">\n                    <div id=\"music-progress-bar\" class=\"music-progress-bar\" style=\"width: 0%\"></div>\n                </div>\n                <div id=\"music-progress-text\" class=\"music-progress-text\">Generating...</div>\n            </div>\n\n            <!-- Variations Selection UI -->\n            <div id=\"music-variations-panel\" class=\"music-variations-panel hidden\">\n                <label>Select a Variation</label>\n                <div id=\"music-variations-list\" class=\"music-variations-list\"></div>\n            </div>\n\n            <!-- Audio Preview -->\n            <div id=\"music-preview\" class=\"music-preview hidden\">\n                <div class=\"music-preview-header\">\n                    <span id=\"music-preview-title\">Preview</span>\n                    <button id=\"music-preview-close\" class=\"btn btn-small btn-ghost\">×</button>\n                </div>\n                <audio id=\"music-audio-player\" controls></audio>\n                <div class=\"music-preview-actions\">\n                    <button id=\"music-download-btn\" class=\"btn btn-small btn-secondary\">Download</button>\n                    <button id=\"music-import-btn\" class=\"btn btn-small btn-primary\">Import to Timeline</button>\n                </div>\n            </div>\n\n            <!-- Alignment Modal Trigger (hidden, triggered from library) -->\n            <div id=\"music-align-modal\" class=\"music-align-modal hidden\">\n                <div class=\"music-align-content\">\n                    <div class=\"music-align-header\">\n                        <span>Align to Video</span>\n                        <button id=\"music-align-close\" class=\"btn btn-small btn-ghost\">×</button>\n                    </div>\n                    <div id=\"music-align-info\" class=\"music-align-info\"></div>\n                    <div class=\"form-group small\">\n                        <label>Target Duration (seconds)</label>\n                        <input type=\"number\" id=\"music-align-target\" min=\"5\" max=\"3600\" value=\"60\">\n                        <button id=\"music-align-match-seq\" class=\"btn btn-small btn-secondary\">Match Sequence</button>\n                    </div>\n                    <div class=\"slider-container small\">\n                        <label>Fade Duration: <span id=\"music-fade-value\">2.0</span>s</label>\n                        <input type=\"range\" id=\"music-fade-slider\" min=\"0.5\" max=\"5\" step=\"0.5\" value=\"2\">\n                    </div>\n                    <label class=\"checkbox-label\">\n                        <input type=\"checkbox\" id=\"music-beat-align\" checked>\n                        Align to nearest beat\n                    </label>\n                    <div class=\"music-align-actions\">\n                        <button id=\"music-align-btn\" class=\"btn btn-primary\">Align & Trim</button>\n                    </div>\n                </div>\n            </div>\n\n            <!-- Timeline Modal -->\n            <div id=\"music-timeline-modal\" class=\"music-timeline-modal hidden\">\n                <div class=\"music-timeline-content\">\n                    <div class=\"music-timeline-header\">\n                        <span>Generate Timeline Music</span>\n                        <button id=\"music-timeline-close\" class=\"btn btn-small btn-ghost\">×</button>\n                    </div>\n                    <div id=\"music-timeline-info\" class=\"music-timeline-info\">\n                        <span>Generates mood-matched music for each chapter</span>\n                    </div>\n                    <div class=\"form-group small\">\n                        <label>Max Chapters</label>\n                        <input type=\"number\" id=\"music-timeline-max-chapters\" min=\"1\" max=\"20\" value=\"10\">\n                    </div>\n                    <div class=\"form-group small\">\n                        <label>Min Segment Length (seconds)</label>\n                        <input type=\"number\" id=\"music-timeline-min-length\" min=\"15\" max=\"120\" value=\"30\">\n                    </div>\n                    <div class=\"slider-container small\">\n                        <label>Crossfade: <span id=\"music-crossfade-value\">2.0</span>s</label>\n                        <input type=\"range\" id=\"music-crossfade-slider\" min=\"0.5\" max=\"5\" step=\"0.5\" value=\"2\">\n                    </div>\n                    <div class=\"music-timeline-actions\">\n                        <button id=\"music-timeline-generate-btn\" class=\"btn btn-primary\">Generate</button>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Results Area -->\n    <div class=\"results-area\">\n        <!-- Progress -->\n        <div id=\"progressContainer\" class=\"progress-container hidden\" role=\"progressbar\" aria-live=\"polite\" aria-valuenow=\"0\" aria-valuemin=\"0\" aria-valuemax=\"100\">\n            <div class=\"progress-bar-container\">\n                <div id=\"progressBar\" class=\"progress-bar\" style=\"width: 0%\"></div>\n            </div>\n            <div id=\"progressText\" class=\"progress-text\" aria-live=\"polite\">Detecting silences...</div>\n        </div>\n\n        <!-- Empty State -->\n        <div id=\"resultsEmpty\" class=\"results-empty\">\n            <p>Ready to save 2 hours? Open a sequence and click GO to let AI handle the rough cut.</p>\n        </div>\n\n        <!-- Combined Preview -->\n        <div id=\"combinedPreview\" class=\"preview-section hidden\">\n            <div class=\"preview-header\">\n                <h3>Preview</h3>\n                <div class=\"preview-counts\">\n                    <span><span id=\"silenceCount\">0</span> silences</span>\n                    <span><span id=\"takeCount\">0</span> takes</span>\n                </div>\n            </div>\n\n            <div class=\"preview-controls\">\n                <label class=\"checkbox-label\">\n                    <input type=\"checkbox\" id=\"selectAllSilences\" checked>\n                    Select All (<span id=\"selectedCount\">0</span> selected)\n                </label>\n            </div>\n\n            <div id=\"previewList\" class=\"preview-list\"></div>\n\n            <div class=\"preview-actions\">\n                <button id=\"applyPreviewBtn\" class=\"btn btn-secondary\">Add Markers</button>\n                <button id=\"buildSequenceBtn\" class=\"btn btn-primary\">Build Sequence</button>\n                <button id=\"cancelPreviewBtn\" class=\"btn btn-ghost\">Cancel</button>\n            </div>\n        </div>\n\n        <!-- Chapter Results -->\n        <div id=\"chapterResults\" class=\"chapter-results hidden\">\n            <div class=\"chapter-header\">\n                <h3>Chapters</h3>\n                <div class=\"chapter-actions\">\n                    <button id=\"copyYouTubeBtn\" class=\"btn btn-small\">Copy YouTube</button>\n                    <button id=\"addChapterMarkersBtn\" class=\"btn btn-small btn-primary\">Add Markers</button>\n                </div>\n            </div>\n            <div id=\"chapterList\" class=\"chapter-list\"></div>\n        </div>\n\n        <!-- Zoom Results -->\n        <div id=\"zoomResults\" class=\"zoom-results hidden\">\n            <div class=\"zoom-header\">\n                <h3>Zoom Points</h3>\n                <button id=\"applyZoomsBtn\" class=\"btn btn-small btn-primary\">Apply Zooms</button>\n            </div>\n            <div id=\"zoomList\" class=\"zoom-list\"></div>\n        </div>\n    </div>\n\n    <!-- Settings Modal -->\n    <div id=\"settingsModal\" class=\"modal hidden\" role=\"dialog\" aria-modal=\"true\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h2>Settings</h2>\n                <button id=\"closeSettingsBtn\" class=\"close-btn\">&times;</button>\n            </div>\n            <div class=\"modal-body\">\n                <div class=\"form-group\">\n                    <label>Backend URL</label>\n                    <input type=\"text\" id=\"backendUrlInput\" placeholder=\"Auto-detect\">\n                </div>\n                <div class=\"form-group\">\n                    <label class=\"checkbox-label\">\n                        <input type=\"checkbox\" id=\"rememberOptions\">\n                        Remember Options\n                    </label>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Login Modal -->\n    <div id=\"loginModal\" class=\"modal hidden\" role=\"dialog\" aria-modal=\"true\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h2>Login</h2>\n                <button id=\"closeLoginBtn\" class=\"close-btn\">&times;</button>\n            </div>\n            <div class=\"modal-body\">\n                <p>Enter your license key to activate SPLICE</p>\n                <div id=\"loginError\" class=\"login-error\" role=\"alert\" aria-live=\"assertive\" style=\"display: none;\"></div>\n                <div class=\"form-group\">\n                    <label for=\"licenseKeyInput\">License Key</label>\n                    <input type=\"text\" id=\"licenseKeyInput\" placeholder=\"SPLICE-XXXX-XXXX-XXXX\">\n                </div>\n                <div class=\"form-group\">\n                    <label for=\"lookupEmailInput\">Or lookup by email</label>\n                    <input type=\"email\" id=\"lookupEmailInput\" placeholder=\"your@email.com\">\n                    <button id=\"lookupLicenseBtn\" class=\"btn btn-secondary\">Lookup</button>\n                </div>\n                <button id=\"saveLoginBtn\" class=\"btn btn-primary\">Activate</button>\n                <div class=\"login-divider\">\n                    <span>Don't have a license?</span>\n                </div>\n                <button type=\"button\" class=\"btn btn-secondary btn-buy-license\">\n                    Buy License\n                </button>\n            </div>\n        </div>\n    </div>\n\n    <!-- Upgrade Modal (shown when user tries to access a gated feature) -->\n    <div id=\"upgradeModal\" class=\"modal hidden\" role=\"dialog\" aria-modal=\"true\">\n        <div class=\"modal-content\">\n            <div class=\"modal-header\">\n                <h2>Upgrade Required</h2>\n                <button id=\"closeUpgradeBtn\" class=\"close-btn\" onclick=\"closeUpgradeModal()\">&times;</button>\n            </div>\n            <div class=\"modal-body upgrade-modal-body\">\n                <p><strong><span id=\"upgradeFeatureName\">This feature</span></strong> requires a <span\n                        id=\"upgradeRequiredTier\">Pro</span> plan or higher.</p>\n                <p class=\"upgrade-description\">Upgrade your plan to unlock this feature and many more!</p>\n                <div class=\"upgrade-actions\">\n                    <button type=\"button\" class=\"btn btn-primary btn-view-plans\" data-url=\"https://splice.video/pricing\">View Plans</button>\n                    <button class=\"btn btn-secondary\" onclick=\"closeUpgradeModal()\">Maybe Later</button>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Debug Modal -->\n    <div id=\"debugModal\" class=\"modal hidden\" role=\"dialog\" aria-modal=\"true\">\n        <div class=\"modal-content debug-modal-content\">\n            <div class=\"modal-header\">\n                <h2>Debug Information</h2>\n                <button id=\"closeDebugBtn\" class=\"close-btn\">&times;</button>\n            </div>\n            <div class=\"modal-body debug-modal-body\">\n                <div class=\"debug-section\">\n                    <h3>Quick Diagnosis</h3>\n                    <div id=\"debugQuickDiagnosis\" class=\"debug-info\">Click \"Run Diagnostics\" to check</div>\n                </div>\n                <div class=\"debug-section\">\n                    <h3>Actions</h3>\n                    <button id=\"runDiagnosticsBtn\" class=\"btn btn-primary\">Run Diagnostics</button>\n                    <button id=\"copyDiagnosticsBtn\" class=\"btn btn-secondary\">Copy to Clipboard</button>\n                </div>\n                <div class=\"debug-section\">\n                    <h3>Detailed Logs</h3>\n                    <div id=\"debugLogs\" class=\"debug-logs\">\n                        <p class=\"debug-placeholder\">No logs collected yet. Click \"Run Diagnostics\" to collect diagnostic information.</p>\n                    </div>\n                </div>\n            </div>\n        </div>\n    </div>\n\n    <!-- Referral Promo Footer (visible when logged in) -->\n    <div id=\"referralPromo\" class=\"referral-promo hidden\">\n        <div class=\"referral-promo-content\">\n            <span class=\"referral-icon\">&#127873;</span>\n            <span class=\"referral-text\">Share SPLICE, get <strong>1 free hour</strong> per referral</span>\n            <button type=\"button\" class=\"referral-link btn-referral\" data-url=\"https://splice.video/referrals\">Learn More</button>\n        </div>\n    </div>\n\n    <!-- Scripts -->\n    <!-- Browser simulation MUST load first to mock window.__adobe_cep__ before CSInterface checks for it -->\n    <script src=\"js/browser-simulation.js\"></script>\n    <script src=\"js/CSInterface.js\"></script>\n    <script src=\"js/config.js\"></script>\n    <script src=\"js/credits.js\"></script>\n    <script src=\"js/slice6-analyze.js\"></script>\n    <script src=\"js/slice7-apply.js\"></script>\n    <script src=\"js/slice8-silence.js\"></script>\n    <script src=\"js/builder.js\"></script>\n    <script src=\"js/multitrack.js\"></script>\n    <script src=\"js/animatedCaptions.js\"></script>\n    <script src=\"js/textEditor.js\"></script>\n    <script src=\"js/socialReframe.js\"></script>\n    <script src=\"js/music.js\"></script>\n    <script src=\"js/main.js\"></script>\n</body>\n\n</html>","numLines":821,"startLine":1,"totalLines":821}}}
{"parentUuid":"89294b56-4639-4bd0-99dc-64b5fec0efa7","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/SPLICE","sessionId":"5f015cfc-0476-4608-91d9-cf0946100ba2","version":"2.0.76","gitBranch":"main","agentId":"a1c98b9","slug":"fizzy-hatching-flame","message":{"model":"claude-opus-4-5-20251101","id":"msg_01CNja14YNUbwiU4BZfaWpEx","type":"message","role":"assistant","content":[{"type":"text","text":"Now I have a complete view of the three files. Let me analyze them for JavaScript errors that could prevent the CEP panel from initializing properly.\n\n## Bug Analysis Report\n\n### Summary\nAfter analyzing the code, I found **no syntax errors** that would prevent the panel from initializing. However, I identified several potential issues that could cause buttons to not work:\n\n---\n\n### 1. DOMContentLoaded Handler (main.js lines 148-231) - NO SYNTAX ERRORS\n\nThe handler is correctly structured as an async function. The initialization sequence is:\n\n```javascript\ndocument.addEventListener('DOMContentLoaded', async () => {\n    // 1. Show loading overlay\n    // 2. Cache DOM elements\n    // 3. Load settings\n    // 4. Initialize UI handlers\n    // 5. Initialize JSX bridge\n    // 6. Check connection\n    // 7. Set status \"Ready\"\n});\n```\n\n**Verdict:** No syntax errors in the DOMContentLoaded handler.\n\n---\n\n### 2. Script Load Order (index.html lines 803-818) - CORRECT\n\nThe script load order is:\n1. `browser-simulation.js` - Mock CEP environment (loads first as intended)\n2. `CSInterface.js` - Adobe CEP interface\n3. `config.js` - Contains `jsx` object, `debugLog`, etc.\n4. `credits.js` - Credit badge management\n5. Various feature modules\n6. `main.js` - Main initialization (loads last, correct)\n\n**Verdict:** Script load order is correct. `config.js` loads before `main.js`, so `jsx` will be defined.\n\n---\n\n### 3. Undefined Function Checks - POTENTIAL ISSUE\n\nThe code does proper safety checks for optional modules:\n\n```javascript\n// Line 180-213 - All optional modules are guarded\nif (typeof initOfflineDetection === 'function') { initOfflineDetection(); }\nif (typeof initMultitrackUI === 'function') { initMultitrackUI(); }\nif (typeof initAnimatedCaptions === 'function') { initAnimatedCaptions(); }\n// etc.\n```\n\n**Verdict:** Safe guards are in place.\n\n---\n\n### 4. Critical Functions Called Without Guards - POTENTIAL ISSUE\n\nThese functions are called WITHOUT checking if they exist:\n\n| Function | File | Line | Issue |\n|----------|------|------|-------|\n| `debugLog()` | main.js | 154 | Defined in config.js - OK if config.js loads first |\n| `cacheUIElements()` | main.js | 161 | Defined in main.js itself - OK |\n| `loadSettingsToUI()` | main.js | 164 | Defined in main.js - OK |\n| `initOptionsToggle()` | main.js | 167 | Defined in main.js - OK |\n| `initCredits()` | main.js | 175 | Defined in main.js - OK |\n| `getSettings()` | main.js | various | Defined in config.js - OK |\n\n**Verdict:** All critical functions are defined in either `main.js` or `config.js` (which loads first).\n\n---\n\n### 5. POTENTIAL ISSUE: `getEventListeners` is a DevTools-only API\n\n**File:** `/Users/imorgado/SPLICE/splice-cep/panel/js/main.js`\n**Line:** 276\n\n```javascript\nif (ui.goBtn) {\n    const listeners = getEventListeners ? getEventListeners(ui.goBtn) : null;\n    // ...\n}\n```\n\n`getEventListeners` is only available in Chrome DevTools console, not in regular JavaScript. In production, this will throw a `ReferenceError` if not properly guarded.\n\n**However**, the ternary check `getEventListeners ? ...` should prevent the error because it checks truthiness before calling. This is a minor issue that won't break initialization.\n\n---\n\n### 6. POTENTIAL ISSUE: `app` Reference Without CEP Context\n\n**File:** `/Users/imorgado/SPLICE/splice-cep/panel/js/main.js`\n**Line:** 1127\n\n```javascript\nasync function seekToTime(seconds) {\n    try {\n        // Check if there's an active sequence before seeking\n        if (!app?.project?.activeSequence) {  // <-- BUG: 'app' is not defined in CEP panel JavaScript\n            debugLog('No active sequence to seek in');\n            return;\n        }\n```\n\n**ROOT CAUSE FOUND:** The `app` object is the **Premiere Pro ExtendScript DOM**, which is only available in JSX context, NOT in the CEP panel JavaScript. This reference will always be `undefined` in the panel, causing the function to silently return early.\n\nThis doesn't break initialization, but it does break the seek-to-time functionality.\n\n---\n\n### 7. POTENTIAL ISSUE: Async/Await in JSX Bridge\n\n**File:** `/Users/imorgado/SPLICE/splice-cep/panel/js/config.js`\n**Lines:** 131-166\n\nThe `jsx.evalScript` function wraps the callback-based `CSInterface.evalScript` in a Promise. This is correct. However, if the JSX connection fails, errors may be swallowed.\n\nThe `jsx.init()` on line 220 of main.js is properly awaited:\n```javascript\nawait jsx.init();\nawait checkJSXConnection();\n```\n\n**Verdict:** JSX bridge implementation is correct.\n\n---\n\n### 8. Missing DOM Elements Could Break Initialization\n\nIf any required DOM element is missing, the code will log errors but continue. The `verifyUIInitialization()` function (lines 237-282) checks for critical elements and updates the status bar if any are missing.\n\nFrom `cacheUIElements()`, the critical elements are:\n- `#status`\n- `#goBtn`\n- `#optionsToggle`\n- `#optionsPanel`\n- `#settingsBtn`\n- `#settingsModal`\n- `#debugBtn`\n- `#debugModal`\n- `#creditBadge`\n\nAll these elements exist in `index.html`.\n\n**Verdict:** All required DOM elements are present.\n\n---\n\n### 9. Circular Dependencies - NONE FOUND\n\nThe modules don't import each other in ways that would create circular dependencies. `main.js` uses functions from `config.js`, and `config.js` exports to `window`.\n\n---\n\n## ROOT CAUSE SUMMARY\n\nThe CEP panel initialization should work correctly. The buttons should work if:\n\n1. **CSInterface** is available (Adobe CEP environment)\n2. **JSX connection** succeeds (Premiere Pro is running)\n3. **All DOM elements** are present (they are)\n\n### Minor Issues Found:\n\n| Issue | Severity | Location | Description |\n|-------|----------|----------|-------------|\n| `app` reference | Medium | main.js:1127 | Uses ExtendScript DOM in panel JS - will always be undefined |\n| `getEventListeners` | Low | main.js:276 | DevTools-only API, but guarded |\n\n### The `app` Bug Fix:\n\n**File:** `/Users/imorgado/SPLICE/splice-cep/panel/js/main.js`\n**Line:** 1127\n\nThe check `if (!app?.project?.activeSequence)` should be removed or replaced with a JSX call since `app` doesn't exist in CEP panel context.\n\n```javascript\n// BEFORE (buggy - app doesn't exist in CEP panel)\nasync function seekToTime(seconds) {\n    try {\n        if (!app?.project?.activeSequence) {\n            debugLog('No active sequence to seek in');\n            return;\n        }\n        // ...\n\n// AFTER (correct - uses JSX bridge)\nasync function seekToTime(seconds) {\n    try {\n        // The JSX call will fail gracefully if no sequence is open\n        // ...\n```\n\n---\n\n## Conclusion\n\n**The CEP panel should initialize correctly.** There are no blocking JavaScript errors in the initialization sequence. The identified `app` reference bug affects seek-to-time functionality but does not prevent buttons from working.\n\nIf buttons are not working, the issue is likely:\n1. **Not running in CEP environment** (CSInterface not available)\n2. **JSX connection failure** (Premiere Pro not communicating)\n3. **CSS issues** (buttons visually hidden or not clickable)\n\nWould you like me to investigate the CSS file or check for specific button click handler issues?"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":59639,"cache_read_input_tokens":28739,"cache_creation":{"ephemeral_5m_input_tokens":59639,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CX3EVLpXSrTmVCWo1uvfA","type":"assistant","uuid":"44b22e81-bf7a-449b-9e76-e1058c4ed2fb","timestamp":"2026-01-12T09:18:30.970Z"}
