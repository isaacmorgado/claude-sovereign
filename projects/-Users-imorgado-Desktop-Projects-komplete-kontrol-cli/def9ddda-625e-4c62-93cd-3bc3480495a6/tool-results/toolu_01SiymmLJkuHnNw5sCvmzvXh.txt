`).map((J)=>J.trim()).filter((J)=>/^\S+\.\w+$/.test(J));if(Y.length<5)return[];return Y}catch(A){return s(A),[]}}var Jo5=604800000,Ol2,Ml2;var uq0=w(()=>{IQ();h3();G2();WY();V6();f1();X9();O$A();hI();Ol2=W0(()=>{let A=JG(),Q=A.exampleFiles?.length?ch(A.exampleFiles):"<filepath>",B=["fix lint errors","fix typecheck errors",`how does ${Q} work?`,`refactor ${Q}`,"how do I log an error?",`edit ${Q} to...`,`write a test for ${Q}`,"create a util logging.py that..."];return`Try "${ch(B)}"`}),Ml2=W0(async()=>{let A=JG(),Q=Date.now(),B=A.exampleFilesGeneratedAt??0;if(Q-B>Jo5)A.exampleFiles=[];if(!A.exampleFiles?.length)Yo5().then((G)=>{if(G.length)tG((Z)=>({...Z,exampleFiles:G,exampleFilesGeneratedAt:Date.now()}))})})});function _l2({input:A,submitCount:Q}){let[{queuedCommands:B,promptSuggestionEnabled:G}]=e0();return Rl2.useMemo(()=>{if(A!=="")return;if(B.length>0&&(R1().queuedCommandUpHintCount||0)<Xo5)return"Press up to edit queued messages";if(Q<1&&G)return Ol2()},[A,B,Q,G])}var Rl2,Xo5=3;var jl2=w(()=>{uB();IQ();uq0();Rl2=c(JA(),1)});function Wo5(){return}function Do5({isLoading:A,agentName:Q,themeColor:B}){let G=B,Z=!1,Y=G??void 0,J=Q?`[${Q}]`:"";return Ax.createElement($,{color:Y,dimColor:A},J,tA.pointer," ")}function mq0({mode:A,isLoading:Q,hideAgentPrefix:B}){let G=Wo5(),Z=void 0;return Ax.createElement(T,{alignItems:"flex-start",alignSelf:"flex-start",flexWrap:"nowrap",justifyContent:"flex-start"},A==="bash"?Ax.createElement($,{color:"bashBorder",dimColor:Q},"! "):A==="background"?Ax.createElement($,{color:"background",dimColor:Q},"& "):Ax.createElement(Do5,{isLoading:Q,agentName:void 0,...{}}))}var Ax,Io5=null;var Tl2=w(()=>{I2();kA();YS();Ax=c(JA(),1)});function Sl2({isFirst:A,children:Q}){let B=qf.useMemo(()=>({isQueued:!0,isFirst:A,paddingWidth:Vo5}),[A]);return qf.createElement(Ko5.Provider,{value:B},qf.createElement(T,{paddingX:Pl2},Q))}var qf,Ko5,Pl2=2,Vo5;var xl2=w(()=>{kA();qf=c(JA(),1),Ko5=qf.createContext(void 0),Vo5=Pl2*2});function yl2(){let[{queuedCommands:A}]=e0();if(A.length===0)return null;let Q=a7(A.map((B)=>C0({content:B.value,imagePasteIds:B.imagePasteIds})));return a6A.createElement(T,{marginTop:1,flexDirection:"column"},Q.map((B,G)=>a6A.createElement(Sl2,{key:G,isFirst:G===0},a6A.createElement(VO,{message:B,messages:[],addMargin:!1,tools:[],commands:[],verbose:!1,erroredToolUseIDs:dq0,inProgressToolUseIDs:dq0,resolvedToolUseIDs:dq0,progressMessagesForMessage:[],shouldAnimate:!1,shouldShowDot:!1,isTranscriptMode:!1,isStatic:!0}))))}var a6A,dq0;var vl2=w(()=>{uB();kA();A6A();eQ();xl2();a6A=c(JA(),1),dq0=new Set});function kl2({hasStash:A}){if(!A)return null;return ebA.createElement(T,{paddingLeft:2},ebA.createElement($,{dimColor:!0},tA.pointerSmall," Stashed (auto-restores after submit)"))}var ebA;var bl2=w(()=>{kA();I2();ebA=c(JA(),1)});var AfA;var QfA=w(()=>{AfA={serverNamePatterns:["figma"],screenshotTool:"get_screenshot",displayName:"Figma",inputPlaceholder:"Paste Figma link with node-id",exampleFormat:"https://figma.com/design/.../...?node-id=63-367"}});import{pathToFileURL as Fo5}from"url";function fl2({imageId:A,backgroundColor:Q,isSelected:B=!1}){let G=HI1(A),Z=`[Image #${A}]`;if(G&&Fk()){let Y=Fo5(G).href;return Nf.createElement(Q9,{url:Y,fallback:Nf.createElement($,{backgroundColor:Q,inverse:B},Z)},Nf.createElement($,{backgroundColor:Q,inverse:B,bold:B},Z))}return Nf.createElement($,{backgroundColor:Q,inverse:B},Z)}var Nf;var hl2=w(()=>{kA();OIA();CFA();LIA();Nf=c(JA(),1)});function gl2({pastedContents:A,linkedAttachments:Q=[],isSelected:B=!1,selectedIndex:G=0,showTip:Z=!1,terminalWidth:Y=80}){let J=Object.values(A).filter((z)=>z.type==="image"),X=Q.filter((z)=>z.type==="ticket"),I=Q.filter((z)=>z.type==="figma-mockup"),W=J.length>0,D=X.length>0,K=I.length>0,V=J.length+X.length+I.length;if(V===0)return null;let F=B?V>1?"(←/→ select · backspace remove · ↓ cancel)":"(backspace remove · ↓ cancel)":"(↑ to select)",H=null;if(Z){if(K&&!D)H="Tip: use /ticket to link a ticket";else if(D||W)H="Tip: use /mockup to attach a Figma mockup"}if(H){let z=J.length*12,C=X.length*11,O=I.length*9,L=z+C+O,M=F.length,_=H.length,j=2,P=2;if(L+M+2+_+2>Y)H=null}let E=0;return ZU.createElement(T,{flexDirection:"row",gap:1,paddingX:1,flexWrap:"wrap"},J.map((z)=>{let C=E++;return ZU.createElement(fl2,{key:z.id,imageId:z.id,isSelected:B&&C===G})}),X.map((z)=>{let C=E++,O=B&&C===G;return ZU.createElement($,{key:z.id,inverse:O,bold:O},"[Ticket ",z.ticketData?.ticketId,"]")}),I.map((z)=>{let C=E++,O=B&&C===G;return ZU.createElement($,{key:z.id,inverse:O,bold:O},"[Mockup]")}),ZU.createElement(T,{flexGrow:1,justifyContent:"space-between",flexDirection:"row"},ZU.createElement($,{dimColor:!0},F),H&&ZU.createElement($,{dimColor:!0,italic:!0},H)))}function pq0(A,Q){return Object.values(A).filter((G)=>G.type==="image").length+Q.length}function ul2(A,Q,B){let G=Object.values(A).filter((I)=>I.type==="image"),Z=Q.filter((I)=>I.type==="ticket"),Y=Q.filter((I)=>I.type==="figma-mockup");if(B<G.length)return{type:"image",id:G[B].id};let J=B-G.length;if(J<Z.length)return{type:"ticket",id:Z[J].id};let X=J-Z.length;if(X<Y.length)return{type:"mockup",id:Y[X].id};return null}var ZU;var cq0=w(()=>{kA();hl2();ZU=c(JA(),1)});function ml2(A,Q,B,G,Z,Y,J,X,I,W,D){let[K,V]=rY.useState(""),[F,H]=rY.useState(!1),[E,z]=rY.useState(""),[C,O]=rY.useState(0),[L,M]=rY.useState("prompt"),[_,j]=rY.useState({}),[P,y]=rY.useState(void 0),v=rY.useRef(void 0),m=rY.useRef(new Set),h=rY.useRef(null),e=rY.useCallback(()=>{if(v.current)v.current.return(void 0),v.current=void 0},[]),t=rY.useCallback(()=>{I(!1),V(""),H(!1),z(""),O(0),M("prompt"),j({}),y(void 0),e(),m.current.clear()},[I,e]),b=rY.useCallback(async(yA,FA)=>{if(!X)return;if(K.length===0){e(),m.current.clear(),y(void 0),H(!1),B(E),G(C),Y(L),W(_);return}if(!yA)e(),v.current=NQ0(),m.current.clear();if(!v.current)return;while(!0){if(FA?.aborted)return;let GA=await v.current.next();if(GA.done){H(!0);return}let AA=GA.value.display,EA=AA.lastIndexOf(K);if(EA!==-1&&!m.current.has(AA)){m.current.add(AA),y(GA.value),H(!1);let $A=au(AA);Y($A),B(AA),W(GA.value.pastedContents);let r=TBA(AA).lastIndexOf(K);G(r!==-1?r:EA);return}}},[X,K,e,B,G,Y,W,E,C,L,_]),l=rY.useCallback(()=>{y9("history-search"),I(!0),z(Q),O(Z),M(J),j(D),v.current=NQ0(),m.current.clear()},[I,Q,Z,J,D]),QA=rY.useCallback(()=>{b(!0)},[b]),WA=rY.useCallback(()=>{if(P){let yA=au(P.display),FA=TBA(P.display);B(FA),Y(yA),W(P.pastedContents)}else W(_);t()},[P,B,Y,W,_,t]),wA=rY.useCallback(()=>{B(E),G(C),W(_),t()},[B,G,W,E,C,_,t]),_A=rY.useCallback(()=>{if(K.length===0)A({display:E,pastedContents:_});else if(P){let yA=au(P.display),FA=TBA(P.display);Y(yA),A({display:FA,pastedContents:P.pastedContents})}t()},[K,P,A,Y,E,_,t]);A2("history:search",l,{context:"Global",isActive:!X});let hA=rY.useMemo(()=>({"historySearch:next":QA,"historySearch:accept":WA,"historySearch:cancel":wA,"historySearch:execute":_A}),[QA,WA,wA,_A]);lD(hA,{context:"HistorySearch",isActive:X}),Y0((yA,FA)=>{if(FA.backspace&&K==="")wA()},{isActive:X});let jA=rY.useRef(b);return jA.current=b,rY.useEffect(()=>{h.current?.abort();let yA=new AbortController;return h.current=yA,jA.current(!1,yA.signal),()=>{yA.abort()}},[K]),{historyQuery:K,setHistoryQuery:V,historyMatch:P,historyFailedMatch:F}}var rY;var dl2=w(()=>{kA();nu();QZ();_6();rY=c(JA(),1)});function cl2({inputValue:A,isAssistantResponding:Q}){let[B,G]=e0(),{text:Z,promptId:Y,shownAt:J,acceptedAt:X,generationRequestId:I}=B.promptSuggestion,W=Q||A.length>0?null:Z,D=Z&&J>0,K=BfA.useCallback(()=>{G((E)=>({...E,promptSuggestion:{text:null,promptId:null,shownAt:0,acceptedAt:0,generationRequestId:null}}))},[G]),V=BfA.useCallback(()=>{if(!D)return;G((E)=>({...E,promptSuggestion:{...E.promptSuggestion,acceptedAt:Date.now()}}))},[D,G]),F=BfA.useCallback(()=>{if(W&&J===0)G((E)=>({...E,promptSuggestion:{...E.promptSuggestion,shownAt:Date.now()}}))},[W,J,G]),H=BfA.useCallback((E)=>{if(!D)return;let z=X>J,C=z||E===Z,O=C?X||Date.now():Date.now();p("tengu_prompt_suggestion",{outcome:C?"accepted":"ignored",prompt_id:Y,...I&&{generationRequestId:I},...C&&{acceptMethod:z?"tab":"enter"},...C&&{timeToAcceptMs:O-J},...!C&&{timeToIgnoreMs:O-J},similarity:Math.round(E.length/(Z?.length||1)*100)/100,...!1}),K()},[D,X,J,Z,Y,I,K]);return{suggestion:W,markAccepted:V,markShown:F,logOutcomeAtSubmission:H}}var BfA,pl2="↵ send";var ll2=w(()=>{uB();Z0();BfA=c(JA(),1)});function iq0(A){return A.toLowerCase().includes("opus-4-5")||!1}function lq0(A){return Number.isInteger(A)}function il2(A){if(typeof A==="string"&&A!=="unset")return A;if(typeof A==="number"){if(A<=30)return"low";if(A<=60)return"medium";return"high"}return"medium"}function o6A(){let A=process.env.CLAUDE_CODE_EFFORT_LEVEL;if(A){if(A==="unset")return;let G=parseInt(A,10);if(!isNaN(G)&&lq0(G))return G;if(["low","medium","high"].includes(A))return A}let B=NQ().effortLevel;if(B==="unset")return;if(B!==void 0){if(typeof B==="number"&&lq0(B))return B;if(typeof B==="string"&&["low","medium","high"].includes(B))return B}return}var rHA=w(()=>{GB()});function sHA({initial:A,sessionModel:Q,onSelect:B,onCancel:G,isStandaloneCommand:Z}){let Y=A===null?nq0:A,J=10,X=_Q(),I=!1,[W,D]=Pp.useState(()=>Ho5()),[K,V]=Pp.useState(!1),[F,H]=Pp.useState(Y),E=Pp.useMemo(()=>HJA(),[]),z=Pp.useMemo(()=>{if(A!==null&&!E.some((y)=>y.value===A))return[...E,{value:A,label:vT(A),description:"Current model"}];return E},[E,A]),C=Pp.useMemo(()=>z.map((y)=>({...y,value:y.value===null?nq0:y.value})),[z]),O=Pp.useMemo(()=>C.some((y)=>y.value===Y)?Y:C[0]?.value??void 0,[C,Y]),L=Math.min(10,C.length),M=Math.max(0,C.length-L),_=C.find((y)=>y.value===F)?.label,j=!1;Y0((y,v)=>{return});function P(y){if(y===nq0){B(null,void 0);return}B(y,void 0)}return X8.createElement(T,{flexDirection:"column",width:"100%"},Z&&X8.createElement(B8,{dividerColor:"permission",dividerDimColor:!1}),X8.createElement(T,{flexDirection:"column",paddingX:Z?1:0},X8.createElement(T,{flexDirection:"column"},X8.createElement(T,{marginBottom:1,flexDirection:"column"},X8.createElement($,{color:"remember",bold:!0},"Select model"),X8.createElement($,{dimColor:!0},"Switch between Claude models. Applies to this session and future Claude Code sessions. For other/previous model names, specify with --model."),Q&&X8.createElement($,{dimColor:!0},"Currently using ",vT(Q)," for this session (set by plan mode). Selecting a model will undo this.")),X8.createElement(T,{flexDirection:"column",marginBottom:1},X8.createElement(T,{flexDirection:"column"},X8.createElement(x0,{defaultValue:Y,defaultFocusValue:O,options:C,onChange:P,onFocus:H,onCancel:G??(()=>{}),visibleOptionCount:L})),M>0&&X8.createElement(T,{paddingLeft:3},X8.createElement($,{dimColor:!0},"and ",M," more…"))),!1),Z&&X8.createElement($,{dimColor:!0,italic:!0},X.pending?X8.createElement(X8.Fragment,null,"Press ",X.keyName," again to exit"):X8.createElement(YB,null,X8.createElement(y0,{shortcut:"Enter",action:"confirm"}),X8.createElement(DB,{action:"confirm:no",context:"Confirmation",fallback:"Esc",description:"exit"})))))}function Ho5(){let A=o6A();if(A===void 0)return"high";return il2(A)}var X8,Pp,nq0="__NO_PREFERENCE__";var CV1=w(()=>{kA();m2();rHA();GB();b8();U9();gW();e4();Z5();T3();Z0();X8=c(JA(),1),Pp=c(JA(),1)});function nl2({currentValue:A,onSelect:Q,onCancel:B,isMidConversation:G}){let Z=_Q(),Y=[{value:"true",label:"Enabled",description:"Claude will think before responding"},{value:"false",label:"Disabled",description:"Claude will respond without extended thinking"}];return A2("confirm:no",()=>{B?.()},{context:"Confirmation"}),X7.createElement(T,{flexDirection:"column",width:"100%"},X7.createElement(B8,{dividerColor:"permission",dividerDimColor:!1}),X7.createElement(T,{flexDirection:"column",paddingX:1},X7.createElement(T,{flexDirection:"column"},X7.createElement(T,{marginBottom:1,flexDirection:"column"},X7.createElement($,{color:"remember",bold:!0},"Toggle thinking mode"),X7.createElement($,{dimColor:!0},"Enable or disable thinking for this session."),G&&X7.createElement($,{color:"warning"},"Changing mid-conversation may reduce quality. For best results, set this at the start of a session.")),X7.createElement(T,{flexDirection:"column",marginBottom:1},X7.createElement(x0,{defaultValue:A?"true":"false",defaultFocusValue:A?"true":"false",options:Y,onChange:(J)=>Q(J==="true"),onCancel:B??(()=>{}),visibleOptionCount:2}))),X7.createElement($,{dimColor:!0,italic:!0},Z.pending?X7.createElement(X7.Fragment,null,"Press ",Z.keyName," again to exit"):X7.createElement(YB,null,X7.createElement(y0,{shortcut:"Enter",action:"confirm"}),X7.createElement(DB,{action:"confirm:no",context:"Confirmation",fallback:"Esc",description:"exit"})))))}var X7;var al2=w(()=>{kA();b8();U9();gW();e4();Z5();T3();_6();X7=c(JA(),1)});import*as ol2 from"path";function Uo5({debug:A,ideSelection:Q,toolPermissionContext:B,setToolPermissionContext:G,apiKeyStatus:Z,commands:Y,agents:J,isLoading:X,verbose:I,messages:W,onAutoUpdaterResult:D,autoUpdaterResult:K,input:V,onInputChange:F,mode:H,onModeChange:E,stashedPrompt:z,setStashedPrompt:C,submitCount:O,onShowMessageSelector:L,mcpClients:M,pastedContents:_,setPastedContents:j,vimMode:P,setVimMode:y,showBashesDialog:v,setShowBashesDialog:m,showDiffDialog:h,setShowDiffDialog:e,tasksSelected:t,setTasksSelected:b,diffSelected:l,setDiffSelected:QA,onForegroundTask:WA,onExit:wA,getToolUseContext:_A,onSubmit:hA,isSearchingHistory:jA,setIsSearchingHistory:yA,helpOpen:FA,setHelpOpen:GA}){let AA=Js(),[EA,$A]=N4.useState(!1),[MA,r]=N4.useState({show:!1}),[VA,XA]=N4.useState(V.length),[IA,NA]=e0(),{historyQuery:RA,setHistoryQuery:gA,historyMatch:mA,historyFailedMatch:Z1}=ml2((S0)=>{j(S0.pastedContents),HZ(S0.display)},V,F,XA,VA,E,H,jA,yA,j,_),F1=N4.useRef(qo5(W)),[PA,eA]=N4.useState(!1),[s1,v1]=N4.useState(!1),[L0,TQ]=N4.useState(!1),[ZQ,$Q]=N4.useState(!1),[S1,WQ]=N4.useState(!1),[J1,$1]=N4.useState(!1),[x1,_0]=N4.useState(!1),[p0,l0]=N4.useState(0),CA=N4.useMemo(()=>{let S0=V.indexOf(`
`);if(S0===-1)return!0;return VA<=S0},[V,VA]),OA=N4.useMemo(()=>{return[]},[IA.teamContext]),I1=IA.linkedAttachments,w1=N4.useCallback((S0)=>{NA((KQ)=>({...KQ,linkedAttachments:KQ.linkedAttachments.filter((VB)=>VB.id!==S0)}))},[NA]),H1=N4.useCallback((S0)=>{NA((KQ)=>({...KQ,linkedAttachments:KQ.linkedAttachments.filter((VB)=>VB.id!==S0)}))},[NA]),{suggestion:D1,markAccepted:t1,logOutcomeAtSubmission:Q0,markShown:g0}=cl2({inputValue:V,isAssistantResponding:X}),DQ=N4.useMemo(()=>jA&&mA?TBA(typeof mA==="string"?mA:mA.display):V,[jA,mA,V]),qB=N4.useMemo(()=>SIA(DQ),[DQ]),BB=N4.useMemo(()=>bp2(DQ),[DQ]),d2=N4.useMemo(()=>{return Yd2(DQ).filter((KQ)=>{let VB=DQ.slice(KQ.start+1,KQ.end);return od(VB,Y)})},[DQ,Y]),i0=N4.useMemo(()=>{let S0=[];if(jA&&mA&&!Z1)S0.push({start:VA,end:VA+RA.length,style:{type:"solid",color:"warning"},priority:20});if(qB.length>0){let KQ=x_A(DQ);if(KQ.level!=="none"){let VB=w21[KQ.level],sB=cOB[KQ.level];for(let d9 of qB)S0.push({start:d9.start,end:d9.end,style:L21(d9.word)?{type:"rainbow",useShimmer:!0}:{type:"shimmer",baseColor:VB,shimmerColor:sB},priority:10})}}for(let KQ of BB)S0.push({start:KQ.start,end:KQ.end,style:{type:"solid",color:"warning"},priority:15});for(let KQ of d2)S0.push({start:KQ.start,end:KQ.end,style:{type:"solid",color:"suggestion"},priority:5});return S0},[jA,RA,mA,Z1,VA,qB,BB,d2,DQ]),{addNotification:F0,removeNotification:r0}=C6();N4.useEffect(()=>{if(!qB.length)return;if(qB.length&&!IA.thinkingEnabled)F0({key:"thinking-toggled-via-keyword",jsx:_2.createElement($,{color:"suggestion"},"Thinking on"),priority:"immediate",timeoutMs:3000})},[F0,IA.thinkingEnabled,NA,qB.length]);let yB=N4.useRef(V.length),p2=N4.useRef(V.length),Y9=N4.useCallback(()=>{r0("stash-hint")},[r0]);N4.useEffect(()=>{let S0=yB.current,KQ=p2.current,VB=V.length;if(yB.current=VB,VB>KQ){p2.current=VB;return}if(VB===0){p2.current=0;return}let sB=KQ>=20&&VB<=5,d9=S0>=20&&VB<=5;if(sB&&!d9){if(!R1().hasUsedStash)F0({key:"stash-hint",jsx:_2.createElement($,{dimColor:!0},"Tip:"," ",_2.createElement(DB,{action:"chat:stash",context:"Chat",fallback:"ctrl+s",description:"stash"})),priority:"immediate",timeoutMs:NK1});p2.current=VB}},[V.length,F0]);let{pushToBuffer:cQ,undo:$2,canUndo:c4,clearBuffer:a6}=vp2({maxBufferSize:50,debounceMs:1000});Nl2({input:V,pastedContents:_,onInputChange:F,setCursorOffset:XA,setPastedContents:j});let w6=_l2({input:V,submitCount:O}),G3=N4.useCallback((S0)=>{if(S0==="?"){p("tengu_help_toggled",{}),GA((M8)=>!M8);return}GA(!1),Y9(),tl2();let KQ=S0.length===V.length+1,VB=VA===0,sB=au(S0);if(KQ&&VB&&sB!=="prompt"){E(sB);return}let d9=S0.replaceAll("\t","    ");if(V!==d9)cQ(V,VA,_);b(!1),QA(!1),eA(!1),F(d9)},[F,E,V,VA,cQ,_,b,QA,eA,Y9]),{resetHistory:SQ,onHistoryUp:u2,onHistoryDown:V4,dismissSearchHint:L6,historyIndex:T2}=km2((S0,KQ,VB)=>{G3(S0),E(KQ),j(VB)},V,_,XA);N4.useEffect(()=>{if(jA)L6()},[jA,L6]);function B9(S0){b(S0==="tasks"),QA(S0==="diff")}function D7(){if(H5.length>1)return;if(IA.queuedCommands.some((VB)=>bG1(VB.mode))){x5();return}if(l){if(Object.values(IA.tasks).filter((sB)=>sB.status==="running").length>0)B9("tasks");else if(OA.length>0)eA(!0),B9("none");else B9("none");return}if(PA){let VB=Object.values(IA.tasks).filter((sB)=>sB.status==="running").length;eA(!1),B9(VB>0?"tasks":"none");return}if(t){B9("none");return}let KQ=pq0(_,I1);if(CA&&KQ>0&&!x1){_0(!0),l0(KQ-1);return}u2()}function K7(){if(H5.length>1)return;if(x1)return;let S0=Object.values(IA.tasks).filter((sB)=>sB.status==="running").length;if(t){if(OA.length>0)eA(!0),B9("none");return}if(PA)return;if(l)return;let KQ=V4(),VB=OA.length>0;if(KQ){if(S0>0){if(B9("tasks"),eA(!1),!R1().hasSeenTasksHint)h0((d9)=>{if(d9.hasSeenTasksHint===!0)return d9;return{...d9,hasSeenTasksHint:!0}})}else if(VB)eA(!0),B9("none")}}let[FZ,mZ]=N4.useState({suggestions:[],selectedSuggestion:-1,commandArgumentHint:void 0}),c5=N4.useCallback(()=>{return""},[I1]),HZ=N4.useCallback(async(S0,KQ=!1)=>{if(t||PA||l)return;if(S0.trim()===""&&IA.promptSuggestion.text&&IA.promptSuggestion.shownAt>0)t1(),S0=IA.promptSuggestion.text;let VB=Object.values(_).some((y5)=>y5.type==="image");if(S0.trim()===""&&!VB)return;let sB=FZ.suggestions.length>0&&FZ.suggestions.every((y5)=>y5.description==="directory");if(FZ.suggestions.length>0&&!KQ&&!sB)return;if(IA.promptSuggestion.text&&IA.promptSuggestion.shownAt>0)Q0(S0);r0("stash-hint");let M8=c5()+S0;if(I1.length>0)NA((y5)=>({...y5,linkedAttachments:[]}));await hA(M8,{setCursorOffset:XA,clearBuffer:a6,resetHistory:SQ})},[IA.promptSuggestion,t,PA,l,FZ.suggestions,hA,a6,SQ,Q0,c5,NA,t1,_,r0,I1.length]),{suggestions:H5,selectedSuggestion:RY,commandArgumentHint:V7,inlineGhostText:dZ,maxColumnWidth:y3}=kd2({commands:Y,onInputChange:F,onSubmit:HZ,setCursorOffset:XA,input:V,cursorOffset:VA,mode:H,agents:J,setSuggestionsState:mZ,suggestionsState:FZ,suppressSuggestions:jA||T2>0,markAccepted:t1}),pZ=H==="prompt"&&H5.length===0&&D1;if(pZ)g0();if(IA.promptSuggestion.text&&!D1&&IA.promptSuggestion.shownAt===0)Qx("timing",IA.promptSuggestion.text),NA((S0)=>({...S0,promptSuggestion:{text:null,promptId:null,shownAt:0,acceptedAt:0,generationRequestId:null}}));function Z3(S0,KQ,VB,sB,d9){p("tengu_paste_image",{}),E("prompt");let M8=F1.current++,y5={id:M8,type:"image",content:S0,mediaType:KQ||"image/png",filename:VB||"Pasted image",dimensions:sB,sourcePath:d9};J_2(y5),setTimeout(()=>fH0(y5),0),j((nJ)=>({...nJ,[M8]:y5}))}function CI(S0){let KQ=RZ(S0).replace(/\r/g,`
`).replaceAll("\t","    "),VB=F21(KQ),sB=Math.min(p1-10,2);if(KQ.length>a81||VB>sB){let d9=F1.current++,M8={id:d9,type:"text",content:KQ};j((y5)=>({...y5,[d9]:M8})),EZ(OOB(d9,VB))}else EZ(KQ)}function EZ(S0){cQ(V,VA,_);let KQ=V.slice(0,VA)+S0+V.slice(VA);F(KQ),XA(VA+S0.length)}let S5=EP(()=>{},()=>L()),x5=N4.useCallback(async()=>{let S0=await fG1(V,VA,async()=>new Promise((KQ)=>NA((VB)=>{return KQ(VB),VB})),NA);if(!S0)return!1;if(F(S0.text),E("prompt"),XA(S0.cursorOffset),S0.images.length>0)j((KQ)=>{let VB={...KQ};for(let sB of S0.images)VB[sB.id]=sB;return VB});return!0},[NA,F,E,V,VA,j]);xp2(M,function(S0){p("tengu_ext_at_mentioned",{});let KQ,VB=ol2.relative(c1(),S0.filePath);if(S0.lineStart&&S0.lineEnd)KQ=S0.lineStart===S0.lineEnd?`@${VB}#L${S0.lineStart} `:`@${VB}#L${S0.lineStart}-${S0.lineEnd} `;else KQ=`@${VB} `;let sB=V[VA-1]??" ";if(!/\s/.test(sB))KQ=` ${KQ}`;EZ(KQ)});let KA=N4.useCallback(()=>{if(c4){y9("ctrl-underscore");let S0=$2();if(S0)F(S0.text),XA(S0.cursorOffset),j(S0.pastedContents)}},[c4,$2,F,j]),YA=N4.useCallback(()=>{p("tengu_external_editor_used",{}),y9("external-editor"),$Q(!0);let S0=rD1(V);if($Q(!1),S0!==null&&S0!==V)cQ(V,VA,_),F(S0),XA(S0.length)},[V,VA,_,cQ,F]),vA=N4.useCallback(()=>{if(V.trim()===""&&z!==void 0)F(z.text),XA(z.cursorOffset),C(void 0);else if(V.trim()!=="")C({text:V,cursorOffset:VA}),F(""),XA(0),y9("prompt-stash"),h0((S0)=>{if(S0.hasUsedStash)return S0;return{...S0,hasUsedStash:!0}})},[V,VA,z,F,C]),uA=N4.useCallback(()=>{if(WQ((S0)=>!S0),FA)GA(!1)},[FA]),dA=N4.useCallback(()=>{if($1((S0)=>!S0),FA)GA(!1)},[FA]),C1=N4.useCallback(()=>{let S0=Hp2(B,IA.teamContext);if(p("tengu_mode_cycle",{to:S0}),B.mode==="plan"&&S0!=="plan")EM(!0);if(zy(B.mode,S0),B.mode==="delegate"&&S0!=="delegate")Ok0(!0),SmA(!0);if(S0==="plan")h0((VB)=>({...VB,lastPlanModeUse:Date.now()}));if(S0==="acceptEdits")y9("auto-accept-mode");let KQ=eX(B,{type:"setMode",mode:S0,destination:"session"});if(G(KQ),zo5(S0,IA.teamContext?.teamName),FA)GA(!1)},[B,IA.teamContext,G,FA]),T1=N4.useCallback(()=>{o81().then((S0)=>{if(S0)y9("image-paste"),Z3(S0.base64,S0.mediaType);else{let KQ=gq("chat:imagePaste","Chat","ctrl+v"),VB=n0.isSSH()?"No image found in clipboard. You're SSH'd; try scp?":`No image found in clipboard. Use ${KQ} to paste images.`;F0({key:"no-image-in-clipboard",text:VB,priority:"immediate",timeoutMs:1000})}})},[F0,Z3]),h1=N4.useMemo(()=>({"chat:undo":KA,"chat:externalEditor":YA,"chat:stash":vA,"chat:modelPicker":uA,"chat:thinkingToggle":dA,"chat:cycleMode":C1,"chat:imagePaste":T1}),[KA,YA,vA,uA,dA,C1,T1]);lD(h1,{context:"Chat"}),A2("help:dismiss",()=>{GA(!1)},{context:"Help",isActive:FA}),Y0((S0,KQ)=>{if(h)return;if(LQ()==="macos"&&S0 in A$0){let VB=A$0[S0],sB=VOB();F0({key:"option-meta-hint",jsx:sB?_2.createElement($,{dimColor:!0},"To enable ",VB,", set ",_2.createElement($,{bold:!0},"Option as Meta")," in"," ",sB," preferences (⌘,)"):_2.createElement($,{dimColor:!0},"To enable ",VB,", run /terminal-setup"),priority:"immediate",timeoutMs:5000})}if(x1){let VB=pq0(_,I1);if(KQ.leftArrow){l0((sB)=>sB>0?sB-1:VB-1);return}if(KQ.rightArrow){l0((sB)=>sB<VB-1?sB+1:0);return}if(KQ.backspace||KQ.delete){let sB=ul2(_,I1,p0);if(sB){if(sB.type==="image")j((M8)=>{let y5={...M8};return delete y5[sB.id],y5});else if(sB.type==="ticket")w1(sB.id);else if(sB.type==="mockup")H1(sB.id)}let d9=VB-1;if(d9===0)_0(!1),l0(0);else l0((M8)=>M8>=d9?d9-1:M8);return}if(KQ.downArrow||KQ.escape){_0(!1);return}return}if(KQ.return&&t){m(!0),B9("none");return}if(KQ.return,KQ.return&&PA){v1(!0),eA(!1);return}if(t&&KQ.rightArrow){if(OA.length>0){b(!1),eA(!0);return}}if(PA&&KQ.leftArrow){if(Object.values(IA.tasks).filter((sB)=>sB.status==="running").length>0){eA(!1),b(!0);return}}if(VA===0&&(KQ.escape||KQ.backspace||KQ.delete))E("prompt"),GA(!1);if(FA&&V===""&&(KQ.backspace||KQ.delete))GA(!1);if(KQ.escape){if(FA){GA(!1);return}if(t||PA||l){B9("none"),eA(!1);return}if(IA.queuedCommands.some((sB)=>bG1(sB.mode))){x5();return}if(W.length>0&&!V&&!X)S5()}if(KQ.return&&FA)GA(!1)});let{columns:n1,rows:p1}=XB(),N0=n1-3,MQ=$o5(),vB=35,a2=(()=>{if(!pZ||!D1)return w6;let S0=pl2,KQ=RZ(D1).length,VB=RZ(S0).length,sB=3,d9=N0;if(KQ+VB+sB>d9)return D1;let M8=d9-KQ-VB;return D1+" ".repeat(M8)+W1.dim(S0)})(),c2=N4.useMemo(()=>{let S0=V.split(`
`);if(S0.length>1)return!0;let KQ=S0[0]?.length??0,VB=N0-vB;if(KQ>VB)return!0;return!1},[V,N0]),Q4=N4.useCallback((S0,KQ)=>{NA((VB)=>({...VB,mainLoopModel:S0,mainLoopModelForSession:null})),WQ(!1),p("tengu_model_picker_hotkey",{model:S0})},[NA]),q3=N4.useCallback(()=>{WQ(!1)},[]),zZ=N4.useMemo(()=>{if(!S1)return null;return _2.createElement(T,{flexDirection:"column",marginTop:1},_2.createElement(sHA,{initial:IA.mainLoopModel,sessionModel:IA.mainLoopModelForSession,onSelect:Q4,onCancel:q3,isStandaloneCommand:!0}))},[S1,IA.mainLoopModel,IA.mainLoopModelForSession,Q4,q3]),P7=N4.useCallback((S0)=>{NA((KQ)=>({...KQ,thinkingEnabled:S0})),$1(!1),p("tengu_thinking_toggled_hotkey",{enabled:S0}),F0({key:"thinking-toggled-hotkey",jsx:_2.createElement($,{color:S0?"suggestion":void 0,dimColor:!S0},"Thinking ",S0?"on":"off"),priority:"immediate",timeoutMs:3000})},[NA,F0]),BJ=N4.useCallback(()=>{$1(!1)},[]),GJ=N4.useMemo(()=>{if(!J1)return null;return _2.createElement(T,{flexDirection:"column",marginTop:1},_2.createElement(nl2,{currentValue:IA.thinkingEnabled,onSelect:P7,onCancel:BJ,isMidConversation:W.some((S0)=>S0.type==="assistant")}))},[J1,IA.thinkingEnabled,P7,BJ,W.length]);if(v)return _2.createElement(zV1,{onDone:()=>{m(!1)},onForegroundTask:WA?(S0)=>{m(!1),WA(S0)}:void 0,toolUseContext:_A(W,[],new AbortController,[],void 0,AA)});if(zZ)return zZ;if(GJ)return GJ;let LK={multiline:!0,onSubmit:HZ,onChange:G3,value:mA?TBA(typeof mA==="string"?mA:mA.display):V,onHistoryUp:D7,onHistoryDown:K7,onHistoryReset:SQ,placeholder:a2,onExit:wA,onExitMessage:(S0,KQ)=>r({show:S0,key:KQ}),onImagePaste:Z3,columns:N0,disableCursorMovementForUpDownKeys:H5.length>0,cursorOffset:VA,onChangeCursorOffset:XA,onPaste:CI,onIsPastingChange:TQ,focus:!jA&&!x1,showCursor:!t&&!PA&&!l&&!jA&&!x1,argumentHint:V7,onUndo:c4?()=>{let S0=$2();if(S0)F(S0.text),XA(S0.cursorOffset),j(S0.pastedContents)}:void 0,highlights:i0,inlineGhostText:dZ},iJ=()=>{let S0={bash:"bashBorder",background:"background"};if(S0[H])return S0[H];let KQ=Eo5();if(KQ&&Ub.includes(KQ))return zr[KQ];return"promptBorder"};if(ZQ)return _2.createElement(T,{flexDirection:"row",alignItems:"center",justifyContent:"center",borderColor:iJ(),borderDimColor:!0,borderStyle:"round",borderLeft:!1,borderRight:!1,borderBottom:!0,width:"100%"},_2.createElement($,{dimColor:!0,italic:!0},"Save and close editor to continue..."));let DD=ts()?_2.createElement(Zq0,{...LK,initialMode:P,onModeChange:y,isLoading:X}):_2.createElement(d4,{...LK});return _2.createElement(T,{flexDirection:"column",marginTop:1},_2.createElement(yl2,null),_2.createElement(Co5,null),_2.createElement(kl2,{hasStash:z!==void 0}),_2.createElement(gl2,{pastedContents:_,linkedAttachments:I1,isSelected:x1,selectedIndex:p0,showTip:!1,terminalWidth:n1}),MQ?_2.createElement(_2.Fragment,null,_2.createElement($,{color:MQ.bgColor},"─".repeat(Math.max(0,n1-MQ.text.length-4)),_2.createElement($,{backgroundColor:MQ.bgColor,color:"inverseText"}," ",MQ.text," "),"──"),_2.createElement(T,{flexDirection:"row",width:"100%"},_2.createElement(mq0,{mode:H,isLoading:X,hideAgentPrefix:!0}),_2.createElement(T,{flexGrow:1,flexShrink:1},DD)),_2.createElement($,{color:MQ.bgColor},"─".repeat(n1))):_2.createElement(T,{flexDirection:"row",alignItems:"flex-start",justifyContent:"flex-start",borderColor:iJ(),borderDimColor:!0,borderStyle:"round",borderLeft:!1,borderRight:!1,borderBottom:!0,width:"100%"},_2.createElement(mq0,{mode:H,isLoading:X}),_2.createElement(T,{flexGrow:1,flexShrink:1},DD)),_2.createElement(Pp2,{apiKeyStatus:Z,debug:A,exitMessage:MA,vimMode:P,mode:H,autoUpdaterResult:K,isAutoUpdating:EA,verbose:I,onAutoUpdaterResult:D,onChangeIsUpdating:$A,suggestions:H5,selectedSuggestion:RY,maxColumnWidth:y3,toolPermissionContext:B,helpOpen:FA,suppressHint:V.length>0,tasksSelected:t,teamsSelected:PA,diffSelected:l,ideSelection:Q,mcpClients:M,isPasting:L0,isInputWrapped:c2,messages:W,isSearching:jA,historyQuery:RA,setHistoryQuery:gA,historyFailedMatch:Z1}))}function qo5(A){let Q=0;for(let B of A)if(B.type==="user"){if(B.imagePasteIds){for(let G of B.imagePasteIds)if(G>Q)Q=G}if(Array.isArray(B.message.content)){for(let G of B.message.content)if(G.type==="text"){let Z=H21(G.text);for(let Y of Z)if(Y.id>Q)Q=Y.id}}}return Q+1}var _2,N4,Eo5=()=>null,zo5=()=>null,Co5=()=>null,$o5=()=>null,rl2;var sl2=w(()=>{kA();vR();t6();_6();bm2();wK1();bd2();IQ();nu();KY();Vp2();uHA();JV();j4();yvA();dK();q0();Sp2();QZ();N_A();Z0();tPA();h3();ZY();w6A();f3();_BA();yp2();G2();kp2();pR();rK1();TU0();hq0();Cl2();a$0();YS();uB();wl2();jl2();Tl2();vl2();oL();bl2();Z5();QfA();cq0();dl2();PJ();ll2();GfA();CV1();al2();cq0();CFA();_2=c(JA(),1),N4=c(JA(),1);rl2=_2.memo(Uo5)});function el2(){No5=[]}var No5;var Ai2=w(()=>{No5=[]});async function Qi2(){return}function Oo5(){el2(),Lo5="",h0((A)=>({...A,coachingTipsThisSession:0}))}function Bi2(){return R1().coachingMode??"off"}var wo5=!1,Lo5="";var ZfA=w(()=>{Ks();eQ();q0();IQ();Z0();f1();Ai2()});function Gi2({inputValue:A,isAssistantResponding:Q}){let[B,G]=e0(),Z=!0,Y=!0,J=null,X=r6A.useRef(!1);r6A.useEffect(()=>{},[!0,B.promptCoaching.tip]);let I=r6A.useCallback((W="dismissed")=>{return},[!0,G]);return r6A.useEffect(()=>{return},[!0,B.promptCoaching.tip,A,Q,I]),{tip:null,dismissTip:()=>{}};return{tip:null,dismissTip:()=>I("dismissed")}}var r6A;var Zi2=w(()=>{uB();Z0();ZfA();r6A=c(JA(),1)});var Mo5;var Yi2=w(()=>{kA();Mo5=c(JA(),1)});function $V1({mainThreadAgentDefinition:A,toolUseContext:Q,customSystemPrompt:B,defaultSystemPrompt:G,appendSystemPrompt:Z}){let Y=A?u_(A)?A.getSystemPrompt({toolUseContext:{options:Q.options}}):A.getSystemPrompt():void 0;return[...Y?[Y]:B?[B]:G,...Z?[Z]:[]]}var aq0=w(()=>{dS()});function Xi2(){Ji2.useEffect(()=>{let A=Math.round(process.uptime()*1000);p("tengu_timer",{event:"startup",durationMs:A})},[])}var Ji2;var Ii2=w(()=>{Z0();Ji2=c(JA(),1)});function Wi2(){let[A,Q]=JfA.useState(()=>{let Y=uw();if(!Pq()||OB())return"valid";if(Y)return"loading";return"missing"}),[B,G]=JfA.useState(null),Z=JfA.useCallback(async()=>{if(!Pq()||OB()){Q("valid");return}let Y=uw();if(!Y){Q("missing");return}try{let X=await Ki2(Y,!1)?"valid":"invalid";Q(X);return}catch(J){G(J),Q("error");return}},[]);return{status:A,reverify:Z,error:B}}var JfA;var Di2=w(()=>{WY();eB();JfA=c(JA(),1)});function oq0({screen:A,setScreen:Q,setScreenToggleId:B,setShowAllInTranscript:G,clearTerminal:Z,onEnterTranscript:Y,onExitTranscript:J,todos:X}){let I=s6A.useContext(mq),[W,D]=e0(),K=s6A.useCallback(()=>{p("tengu_toggle_todos",{is_expanded:W.showExpandedTodos,has_todos:X&&X.length>0}),D((z)=>({...z,showExpandedTodos:!z.showExpandedTodos}))},[W.showExpandedTodos,X,D]),V=s6A.useCallback(async()=>{let z=A!=="transcript";if(Q((C)=>C==="transcript"?"prompt":"transcript"),B((C)=>C+1),G(!1),z&&Y)Y();if(!z&&J)J();if(!I)await Z()},[A,Q,B,G,Y,J,I,Z]),F=s6A.useCallback(async()=>{if(G((z)=>!z),B((z)=>z+1),!I)await Z()},[G,B,I,Z]),H=s6A.useCallback(async()=>{if(Q("prompt"),B((z)=>z+1),G(!1),J)J();if(!I)await Z()},[Q,B,G,J,I,Z]);A2("app:toggleTodos",K,{context:"Global"}),A2("app:toggleTranscript",V,{context:"Global"});let E=A==="transcript";return A2("transcript:toggleShowAll",F,{context:"Transcript",isActive:E}),A2("transcript:exit",H,{context:"Transcript",isActive:E}),null}var s6A;var Vi2=w(()=>{Da();_6();uB();Z0();s6A=c(JA(),1)});function rq0({setToolUseConfirmQueue:A,onCancel:Q,isMessageSelectorVisible:B,screen:G,abortSignal:Z,popCommandFromQueue:Y,vimMode:J,isLocalJSXCommand:X,isSearchingHistory:I,isHelpOpen:W}){let[{queuedCommands:D}]=e0(),K=Fi2.useCallback(()=>{if(D.length>0){if(Y){Y();return}}p("tengu_cancel",{}),A(()=>[]),Q()},[D,Y,A,Q]),V=G!=="transcript"&&!I&&!B&&!X&&!W&&!(ts()&&J==="INSERT")&&Z!==void 0&&!Z.aborted;return A2("chat:cancel",K,{context:"Chat",isActive:V}),A2("app:interrupt",K,{context:"Global",isActive:V}),null}var Fi2;var Hi2=w(()=>{Z0();uHA();uB();_6();Fi2=c(JA(),1)});function UV1(A){return Ro5.includes(A)}function qV1(A,Q,B,G){if(!A.toolDecisions)A.toolDecisions=new Map;A.toolDecisions.set(Q,{source:G,decision:B,timestamp:Date.now()})}function NV1(A,Q,B,G){let Z;if(A.getPath&&Q){let Y=A.inputSchema.safeParse(Q);if(Y.success){let J=A.getPath(Y.data);if(J)Z=xs(J)}}return{decision:B,source:G,tool_name:A.name,...Z&&{language:Z}}}async function wV1(A,Q,B){await LF("tool_decision",{decision:Q,source:B,tool_name:f9(A)})}function Ei2(A,Q,B,G,Z){if(p("tengu_tool_use_granted_in_config",{messageID:G,toolName:f9(A.name),sandboxEnabled:JB.isSandboxingEnabled()}),UV1(A.name)){let Y=NV1(A,Q,"accept","config");lCA()?.add(1,Y)}qV1(B,Z,"accept","config"),wV1(A.name,"accept","config")}function _o5(A){switch(A.type){case"hook":return"hook";case"user":return A.permanent?"user_permanent":"user_temporary"}}function zi2(A,Q,B,G,Z,Y,J){let X=J!==void 0?Date.now()-J:void 0;switch(Y.type){case"user":p(Y.permanent?"tengu_tool_use_granted_in_prompt_permanent":"tengu_tool_use_granted_in_prompt_temporary",{messageID:G,toolName:f9(A.name),sandboxEnabled:JB.isSandboxingEnabled(),...X!==void 0&&{waiting_for_user_permission_ms:X}});break;case"hook":p("tengu_tool_use_granted_by_permission_hook",{messageID:G,toolName:f9(A.name),sandboxEnabled:JB.isSandboxingEnabled(),permanent:Y.permanent??!1,...X!==void 0&&{waiting_for_user_permission_ms:X}});break}let I=_o5(Y);if(UV1(A.name)){let W=NV1(A,Q,"accept",I);lCA()?.add(1,W)}qV1(B,Z,"accept",I),wV1(A.name,"accept",I)}function sq0(A,Q,B,G,Z,Y,J){let X=Y.type==="hook",I=X?"hook":Y.type,W=J!==void 0?Date.now()-J:void 0;if(X)p("tengu_tool_use_rejected_in_prompt",{messageID:G,toolName:f9(A.name),sandboxEnabled:JB.isSandboxingEnabled(),isHook:!0,...W!==void 0&&{waiting_for_user_permission_ms:W}});else{let D=Y.type==="user_reject"?Y.hasFeedback:!1;p("tengu_tool_use_rejected_in_prompt",{messageID:G,toolName:f9(A.name),sandboxEnabled:JB.isSandboxingEnabled(),hasFeedback:D,...W!==void 0&&{waiting_for_user_permission_ms:W}})}if(UV1(A.name)){let D=NV1(A,Q,"reject",I);lCA()?.add(1,D)}qV1(B,Z,"reject",I),wV1(A.name,"reject",I)}function jo5(A,Q){return Ci2.useCallback(async(B,G,Z,Y,J,X)=>{return new Promise((I)=>{function W(){p("tengu_tool_use_cancelled",{messageID:Y.message.id,toolName:f9(B.name)})}function D(V,F){let H=!!Z.agentId,C=V?`${H?Ni2:txA}${V}`:H?qi2:X4A;if(I({behavior:"ask",message:C}),F||!V&&!H)Z.abortController.abort()}if(Z.abortController.signal.aborted){W(),D(void 0,!0);return}return(X!==void 0?Promise.resolve(X):FC(B,G,Z,Y,J)).then(async(V)=>{if(V.behavior==="allow"){Ei2(B,G,Z,Y.message.id,J),I({...V,updatedInput:G,userModified:!1});return}let F=await Z.getAppState(),H=await B.description(G,{isNonInteractiveSession:Z.options.isNonInteractiveSession,toolPermissionContext:F.toolPermissionContext,tools:Z.options.tools});if(Z.abortController.signal.aborted){W(),D(void 0,!0);return}switch(V.behavior){case"deny":{if(p("tengu_tool_use_denied_in_config",{messageID:Y.message.id,toolName:f9(B.name),sandboxEnabled:JB.isSandboxingEnabled()}),UV1(B.name)){let E=NV1(B,G,"reject","config");lCA()?.add(1,E)}qV1(Z,J,"reject","config"),wV1(B.name,"reject","config"),I(V);return}case"ask":{let E=!1,z=Date.now();A((O)=>[...O,{assistantMessage:Y,tool:B,description:H,input:G,toolUseContext:Z,toolUseID:J,permissionResult:V,permissionPromptStartTimeMs:z,onAbort(){if(E)return;E=!0,W(),sq0(B,G,Z,Y.message.id,J,{type:"user_abort"},z),D(void 0,!0)},async onAllow(L,M,_){if(E)return;E=!0,sOA(M);let j=await Z.getAppState(),P=bn(j.toolPermissionContext,M);Q(P);let y=M.some((h)=>q11(h.destination));zi2(B,L,Z,Y.message.id,J,{type:"user",permanent:y},z);let v=B.inputsEquivalent?!B.inputsEquivalent(G,L):!1,m=_?.trim();I({behavior:"allow",updatedInput:L,userModified:v,acceptFeedback:m||void 0})},onReject(L){if(E)return;E=!0,sq0(B,G,Z,Y.message.id,J,{type:"user_reject",hasFeedback:!!L},z),D(L)},async recheckPermission(){if(E)return;let L=await FC(B,G,Z,Y,J);if(L.behavior==="allow")A((M)=>M.filter((_)=>_.toolUseID!==J)),Ei2(B,G,Z,Y.message.id,J),E=!0,I({behavior:"allow",updatedInput:L.updatedInput||G,userModified:!1})}}]);let C=await Z.getAppState();(async()=>{for await(let O of iKA([tq0(B.name,J,G,Z,C.toolPermissionContext.mode,V.suggestions,Z.abortController.signal)])){if(E)return;if(O.permissionRequestResult&&(O.permissionRequestResult.behavior==="allow"||O.permissionRequestResult.behavior==="deny")){E=!0,A((M)=>M.filter((_)=>_.toolUseID!==J));let L=O.permissionRequestResult;if(L.behavior==="allow"){let M=L.updatedInput||G,_=L.updatedPermissions??[];if(_.length>0){sOA(_);let P=await Z.getAppState(),y=bn(P.toolPermissionContext,_);Q(y)}let j=_.some((P)=>q11(P.destination));zi2(B,M,Z,Y.message.id,J,{type:"hook",permanent:j},z),I({behavior:"allow",updatedInput:M,userModified:!1,decisionReason:{type:"hook",hookName:"PermissionRequest"}});return}else if(L.behavior==="deny"){if(sq0(B,G,Z,Y.message.id,J,{type:"hook"},z),I({behavior:"deny",message:L.message||"Permission denied by hook",decisionReason:{type:"hook",hookName:"PermissionRequest",reason:L.message}}),L.interrupt)Z.abortController.abort();return}}}})();return}}}).catch((V)=>{if(V instanceof VJ)W(),D(void 0,!0);else s(V)})})},[A,Q])}var Ci2,Ro5,$i2;var Ui2=w(()=>{AZ();Z0();hD();eQ();YX();f1();q0();Vr();L9();dK();zJ();AO();Hr();e1();Ci2=c(JA(),1),Ro5=["Edit","Write","NotebookEdit"];$i2=jo5});function Li2(A){return wi2.useMemo(()=>{let Q=x_A(A);return{level:Q.level,tokens:Q.tokens}},[A])}var wi2;var Oi2=w(()=>{pR();wi2=c(JA(),1)});function BN0(){if(!eq0)eq0=qA("perf_hooks").performance;return eq0}function _i2(){if(!XfA)return;BN0().clearMarks(),QN0.clear(),AN0=null,Ri2++,S6("query_user_input_received")}function S6(A){if(!XfA)return;let Q=BN0();if(Q.mark(A),QN0.set(A,process.memoryUsage()),A==="query_first_chunk_received"&&AN0===null){let B=Q.getEntriesByType("mark");if(B.length>0)AN0=B[B.length-1]?.startTime??0}}function ji2(){if(!XfA)return;S6("query_profile_end")}function Bt(A){return A.toFixed(3)}function Mi2(A){return(A/1024/1024).toFixed(2)}function To5(A,Q){if(Q==="query_user_input_received")return"";if(A>1000)return" ⚠️  VERY SLOW";if(A>100)return" ⚠️  SLOW";if(Q.includes("git_status")&&A>50)return" ⚠️  git status";if(Q.includes("tool_schema")&&A>50)return" ⚠️  tool schemas";if(Q.includes("client_creation")&&A>50)return" ⚠️  client creation";return""}function Po5(){if(!XfA)return"Query profiling not enabled (set CLAUDE_CODE_PROFILE_QUERY=1)";let Q=BN0().getEntriesByType("mark");if(Q.length===0)return"No query profiling checkpoints recorded";let B=[];B.push("=".repeat(80)),B.push(`QUERY PROFILING REPORT - Query #${Ri2}`),B.push("=".repeat(80)),B.push("");let G=Q[0]?.startTime??0,Z=G,Y=0,J=0;for(let W of Q){let D=W.startTime-G,K=Bt(D),V=W.startTime-Z,F=Bt(V),H=QN0.get(W.name),E=To5(V,W.name),z=H?` | RSS: ${Mi2(H.rss)}MB, Heap: ${Mi2(H.heapUsed)}MB`:"";if(B.push(`[+${K.padStart(10)}ms] (+${F.padStart(9)}ms) ${W.name}${E}${z}`),W.name==="query_api_request_sent")Y=D;if(W.name==="query_first_chunk_received")J=D;Z=W.startTime}let X=Q[Q.length-1],I=X?X.startTime-G:0;if(B.push(""),B.push("-".repeat(80)),J>0){let W=Y,D=J-Y,K=(W/J*100).toFixed(1),V=(D/J*100).toFixed(1);B.push(`Total TTFT: ${Bt(J)}ms`),B.push(`  - Pre-request overhead: ${Bt(W)}ms (${K}%)`),B.push(`  - Network latency: ${Bt(D)}ms (${V}%)`)}else B.push(`Total time: ${Bt(I)}ms`);return B.push(So5(Q,G)),B.push("=".repeat(80)),B.join(`
`)}function So5(A,Q){let B=[{name:"Context loading",start:"query_context_loading_start",end:"query_context_loading_end"},{name:"Microcompact",start:"query_microcompact_start",end:"query_microcompact_end"},{name:"Autocompact",start:"query_autocompact_start",end:"query_autocompact_end"},{name:"Query setup",start:"query_setup_start",end:"query_setup_end"},{name:"Tool schemas",start:"query_tool_schema_build_start",end:"query_tool_schema_build_end"},{name:"Message normalization",start:"query_message_normalization_start",end:"query_message_normalization_end"},{name:"Client creation",start:"query_client_creation_start",end:"query_client_creation_end"},{name:"Network TTFB",start:"query_api_request_sent",end:"query_first_chunk_received"},{name:"Tool execution",start:"query_tool_execution_start",end:"query_tool_execution_end"}],G=new Map(A.map((J)=>[J.name,J.startTime-Q])),Z=[];Z.push(""),Z.push("PHASE BREAKDOWN:");for(let J of B){let X=G.get(J.start),I=G.get(J.end);if(X!==void 0&&I!==void 0){let W=I-X,D="█".repeat(Math.min(Math.ceil(W/10),50));Z.push(`  ${J.name.padEnd(22)} ${Bt(W).padStart(10)}ms ${D}`)}}let Y=G.get("query_api_request_sent");if(Y!==void 0)Z.push(""),Z.push(`  ${"Total pre-API overhead".padEnd(22)} ${Bt(Y).padStart(10)}ms`);return Z.join(`
`)}function Ti2(){if(!XfA)return;k(Po5())}var XfA=!1,QN0,Ri2=0,AN0=null,eq0=null;var tHA=w(()=>{y1();QN0=new Map});function xo5(){XSA(),TG0(""),P6(0)}async function LV1(A){let{input:Q,helpers:B,isLoading:G,mode:Z,commands:Y,onInputChange:J,setPastedContents:X,setIsLoading:I,setToolJSX:W,getToolUseContext:D,messages:K,mainLoopModel:V,pastedContents:F,ideSelection:H,setUserInputOnProcessing:E,setAbortController:z,onQuery:C,resetLoadingState:O,thinkingTokens:L,thinkingEnabled:M,setAppState:_,onBeforeQuery:j,onSideQuestion:P,isSideQuestionProcessing:y,canUseTool:v}=A,{setCursorOffset:m,clearBuffer:h,resetHistory:e}=B,t=Object.values(F).some((wA)=>wA.type==="image");if(Q.trim()===""&&!t)return;let b=oK1(Q.trim());if(b.isBtw&&P){if(y||!b.question)return;J(""),m(0),h(),await P(b.question);return}if(["exit","quit",":q",":q!",":wq",":wq!"].includes(Q.trim())){if(Y.find((_A)=>_A.name==="exit"))LV1({...A,input:"/exit"});else xo5();return}let l=Q,QA=H21(Q),WA=0;for(let wA of QA){let _A=F[wA.id];if(_A&&_A.type==="text")l=l.replace(wA.match,_A.content),WA++}if(p("tengu_paste_text",{pastedTextCount:WA}),G){if(Z!=="prompt")return;let wA,_A;if(t)wA=bo5(l,F),_A=Object.values(F).filter((hA)=>hA.type==="image").map((hA)=>hA.id);else wA=l.trim();NF({value:wA,mode:"prompt",imagePasteIds:_A},_),J(""),m(0),X({}),e(),h();return}_i2(),await yo5({input:l,mode:Z,messages:K,mainLoopModel:V,pastedContents:F,ideSelection:H,thinkingTokens:L,thinkingEnabled:M,querySource:A.querySource,commands:Y,isLoading:G,setIsLoading:I,setToolJSX:W,getToolUseContext:D,setUserInputOnProcessing:E,setAbortController:z,onQuery:C,resetLoadingState:O,setAppState:_,onBeforeQuery:j,resetHistory:e,canUseTool:v})}async function yo5(A){let{input:Q,mode:B,messages:G,mainLoopModel:Z,pastedContents:Y,ideSelection:J,thinkingTokens:X,thinkingEnabled:I,querySource:W,isLoading:D,setIsLoading:K,setToolJSX:V,getToolUseContext:F,setUserInputOnProcessing:H,setAbortController:E,onQuery:z,setAppState:C,onBeforeQuery:O,resetHistory:L,canUseTool:M}=A,_=!D,j=l9();if(_)E(j);try{let P=vo5(B,X,Q,I);S6("query_process_user_input_start");let{messages:y,shouldQuery:v,allowedTools:m,maxThinkingTokens:h,model:e}=await Gt({input:Q,mode:B,setIsLoading:K,setToolJSX:V,context:F(G,[],j,[],void 0,Z),pastedContents:Y,ideSelection:J,messages:G,setUserInputOnProcessing:H,isAlreadyProcessing:D,thinkingMetadata:P,querySource:W,canUseTool:M});if(S6("query_process_user_input_end"),yG())S6("query_file_history_snapshot_start"),y.filter(lkA).forEach((t)=>{vFA((b)=>{C((l)=>({...l,fileHistory:b(l.fileHistory)}))},t.uuid)}),S6("query_file_history_snapshot_end");if(V(null),y.length)L(),await z(y,j,v,m??[],e??Z,h,B==="prompt"?O:void 0,Q);else if(L(),!D)E(null)}finally{K(!1)}}function vo5(A,Q,B,G){if(A!=="prompt")return;let Z=Q>0,Y=Z?SIA(B):[],J=!G&&!Z;return{level:J?"none":"high",disabled:J,triggers:Y.map((I)=>({start:I.start,end:I.end,text:B.slice(I.start,I.end)}))}}function ko5(A){return A==="image/jpeg"||A==="image/png"||A==="image/gif"||A==="image/webp"}function bo5(A,Q){let B=[],G=A.trim();if(G)B.push({type:"text",text:G});for(let Z of Object.values(Q))if(Z.type==="image"&&ko5(Z.mediaType))B.push({type:"image",source:{type:"base64",media_type:Z.mediaType,data:Z.content}});if(B.length===0)B.push({type:"text",text:A});return B}var Pi2=w(()=>{oL();nu();Z0();nZ();pR();rK1();IfA();yN();CD1();dm();jJ();tHA()});function fo5(A,Q){let B=[],G={},Z=Q;for(let Y of A)if(Y.type==="text")B.push(Y.text);else if(Y.type==="image"&&Y.source.type==="base64"){let J=Z++;G[J]={id:J,type:"image",content:Y.source.data,mediaType:Y.source.media_type}}return{text:B.join(" ").trim(),pastedContents:G,nextPasteId:Z}}async function Si2({getAppState:A,setAppState:Q,executeInput:B}){let G=await O42(A,Q);if(G.length===0)return{processed:!1};let Z=[],Y={},J=1;for(let I of G)if(typeof I.value==="string")Z.push(I.value);else{let W=fo5(I.value,J);Z.push(W.text),Object.assign(Y,W.pastedContents),J=W.nextPasteId}let X=Z.join(`
--
`});function KV9(){let{updateWizardData:A,goBack:Q,goToStep:B,wizardData:G}=lJ(),[Z,Y]=ID.useState(G.generationPrompt||""),[J,X]=ID.useState(!1),[I,W]=ID.useState(null),[D,K]=ID.useState(Z.length),V=Js(),F=ID.useRef(null);Y0((z,C)=>{if(C.escape){if(J&&F.current)F.current.abort(),F.current=null,X(!1),W("Generation cancelled");else if(!J)A({generationPrompt:"",agentType:"",systemPrompt:"",whenToUse:"",generatedAgent:void 0,wasGenerated:!1}),Y(""),W(null),Q()}});let H=async()=>{let z=Z.trim();if(!z){W("Please describe what the agent should do");return}W(null),X(!0),A({generationPrompt:z,isGenerating:!0});let C=l9();F.current=C;try{let O=await WV9(z,V,[],C.signal);A({agentType:O.identifier,whenToUse:O.whenToUse,systemPrompt:O.systemPrompt,generatedAgent:O,isGenerating:!1,wasGenerated:!0}),B(6)}catch(O){if(O instanceof Error&&!O.message.includes("No assistant message found"))W(O.message||"Failed to generate agent");A({isGenerating:!1})}finally{X(!1),F.current=null}},E="Describe what this agent should do and when it should be used (be comprehensive for best results)";if(J)return ID.default.createElement(DW,{subtitle:E,footerText:ID.default.createElement(DB,{action:"confirm:no",context:"Confirmation",fallback:"Esc",description:"cancel"})},ID.default.createElement(T,{marginTop:1,flexDirection:"row",alignItems:"center"},ID.default.createElement(_9,null),ID.default.createElement($,{color:"suggestion"}," Generating agent from description...")));return ID.default.createElement(DW,{subtitle:E,footerText:ID.default.createElement(YB,null,ID.default.createElement(DB,{action:"confirm:yes",context:"Confirmation",fallback:"Enter",description:"submit"}),ID.default.createElement(DB,{action:"confirm:no",context:"Confirmation",fallback:"Esc",description:"go back"}))},ID.default.createElement(T,{flexDirection:"column",marginTop:1},I&&ID.default.createElement(T,{marginBottom:1},ID.default.createElement($,{color:"error"},I)),ID.default.createElement(d4,{value:Z,onChange:Y,onSubmit:H,placeholder:"e.g., Help me write unit tests for my code...",columns:80,cursorOffset:D,onChangeCursorOffset:K,focus:!0,showCursor:!0})))}var ID;var VV9=w(()=>{kA();kA();KY();Cj();mO();xG();DV9();yvA();nZ();Z5();T3();ID=c(JA(),1)});function wT0(A){if(!A)return"Agent type is required";if(!/^[a-zA-Z0-9][a-zA-Z0-9-]*[a-zA-Z0-9]$/.test(A))return"Agent type must start and end with alphanumeric characters and contain only letters, numbers, and hyphens";if(A.length<3)return"Agent type must be at least 3 characters long";if(A.length>50)return"Agent type must be less than 50 characters";return null}function FV9(A,Q,B){let G=[],Z=[];if(!A.agentType)G.push("Agent type is required");else{let J=wT0(A.agentType);if(J)G.push(J);let X=B.find((I)=>I.agentType===A.agentType&&I.source!==A.source);if(X)G.push(`Agent type "${A.agentType}" already exists in ${kzA(X.source)}`)}if(!A.whenToUse)G.push("Description (description) is required");else if(A.whenToUse.length<10)Z.push("Description should be more descriptive (at least 10 characters)");else if(A.whenToUse.length>5000)Z.push("Description is very long (over 5000 characters)");if(A.tools!==void 0&&!Array.isArray(A.tools))G.push("Tools must be an array");else{if(A.tools===void 0)Z.push("Agent has access to all tools");else if(A.tools.length===0)Z.push("No tools selected - agent will have very limited capabilities");let J=Ts(A,Q,!1);if(J.invalidTools.length>0)G.push(`Invalid tools: ${J.invalidTools.join(", ")}`)}let Y=A.getSystemPrompt();if(!Y)G.push("System prompt is required");else if(Y.length<20)G.push("System prompt is too short (minimum 20 characters)");else if(Y.length>1e4)Z.push("System prompt is very long (over 10,000 characters)");return{isValid:G.length===0,errors:G,warnings:Z}}var LT0=w(()=>{$6A();az1()});function HV9(A){let{goNext:Q,goBack:B,updateWizardData:G,wizardData:Z}=lJ(),[Y,J]=LC.useState(Z.agentType||""),[X,I]=LC.useState(null),[W,D]=LC.useState(Y.length);return A2("confirm:no",B,{context:"Confirmation"}),LC.default.createElement(DW,{subtitle:"Agent type (identifier)",footerText:LC.default.createElement(YB,null,LC.default.createElement(y0,{shortcut:"Type",action:"enter text"}),LC.default.createElement(y0,{shortcut:"Enter",action:"continue"}),LC.default.createElement(DB,{action:"confirm:no",context:"Confirmation",fallback:"Esc",description:"go back"}))},LC.default.createElement(T,{flexDirection:"column",marginTop:1},LC.default.createElement($,null,"Enter a unique identifier for your agent:"),LC.default.createElement(T,{marginTop:1},LC.default.createElement(d4,{value:Y,onChange:J,onSubmit:(V)=>{let F=V.trim(),H=wT0(F);if(H){I(H);return}I(null),G({agentType:F}),Q()},placeholder:"e.g., test-runner, tech-lead, etc",columns:60,cursorOffset:W,onChangeCursorOffset:D,focus:!0,showCursor:!0})),X&&LC.default.createElement(T,{marginTop:1},LC.default.createElement($,{color:"error"},X))))}var LC;var EV9=w(()=>{kA();KY();Cj();mO();LT0();e4();Z5();T3();_6();LC=c(JA(),1)});function zV9(){let{goNext:A,goBack:Q,updateWizardData:B,wizardData:G}=lJ(),[Z,Y]=bE.useState(G.systemPrompt||""),[J,X]=bE.useState(Z.length),[I,W]=bE.useState(null);return A2("confirm:no",Q,{context:"Confirmation"}),bE.default.createElement(DW,{subtitle:"System prompt",footerText:bE.default.createElement(YB,null,bE.default.createElement(y0,{shortcut:"Type",action:"enter text"}),bE.default.createElement(y0,{shortcut:"Enter",action:"continue"}),bE.default.createElement(DB,{action:"confirm:no",context:"Confirmation",fallback:"Esc",description:"go back"}))},bE.default.createElement(T,{flexDirection:"column",marginTop:1},bE.default.createElement($,null,"Enter the system prompt for your agent:"),bE.default.createElement($,{dimColor:!0},"Be comprehensive for best results"),bE.default.createElement(T,{marginTop:1},bE.default.createElement(d4,{value:Z,onChange:Y,onSubmit:()=>{let K=Z.trim();if(!K){W("System prompt is required");return}W(null),B({systemPrompt:K}),A()},placeholder:"You are a helpful code reviewer who...",columns:80,cursorOffset:J,onChangeCursorOffset:X,focus:!0,showCursor:!0})),I&&bE.default.createElement(T,{marginTop:1},bE.default.createElement($,{color:"error"},I))))}var bE;var CV9=w(()=>{kA();KY();Cj();mO();e4();Z5();T3();_6();bE=c(JA(),1)});function $V9(){let{goNext:A,goBack:Q,updateWizardData:B,wizardData:G}=lJ(),[Z,Y]=OC.useState(G.whenToUse||""),[J,X]=OC.useState(Z.length),[I,W]=OC.useState(null);return A2("confirm:no",Q,{context:"Confirmation"}),OC.default.createElement(DW,{subtitle:"Description (tell Claude when to use this agent)",footerText:OC.default.createElement(YB,null,OC.default.createElement(y0,{shortcut:"Type",action:"enter text"}),OC.default.createElement(y0,{shortcut:"Enter",action:"continue"}),OC.default.createElement(DB,{action:"confirm:no",context:"Confirmation",fallback:"Esc",description:"go back"}))},OC.default.createElement(T,{flexDirection:"column",marginTop:1},OC.default.createElement($,null,"When should Claude use this agent?"),OC.default.createElement(T,{marginTop:1},OC.default.createElement(d4,{value:Z,onChange:Y,onSubmit:(K)=>{let V=K.trim();if(!V){W("Description is required");return}W(null),B({whenToUse:V}),A()},placeholder:"e.g., use this agent after you're done writing code...",columns:80,cursorOffset:J,onChangeCursorOffset:X,focus:!0,showCursor:!0})),I&&OC.default.createElement(T,{marginTop:1},OC.default.createElement($,{color:"error"},I))))}var OC;var UV9=w(()=>{kA();KY();Cj();mO();e4();Z5();T3();_6();OC=c(JA(),1)});function MH7(A){let Q=new Map;return A.forEach((B)=>{if(Vj(B)){let G=UF(B.name);if(G?.serverName){let Z=Q.get(G.serverName)||[];Z.push(B),Q.set(G.serverName,Z)}}}),Array.from(Q.entries()).map(([B,G])=>({serverName:B,tools:G})).sort((B,G)=>B.serverName.localeCompare(G.serverName))}function oz1({tools:A,initialTools:Q,onComplete:B,onCancel:G}){let Z=NK.useMemo(()=>aC0({tools:A,isBuiltIn:!1,isAsync:!1}),[A]),Y=!Q||Q.includes("*")?Z.map((v)=>v.name):Q,[J,X]=NK.useState(Y),[I,W]=NK.useState(0),[D,K]=NK.useState(!1),V=NK.useMemo(()=>{let v=new Set(Z.map((m)=>m.name));return J.filter((m)=>v.has(m))},[J,Z]),F=new Set(V),H=V.length===Z.length&&Z.length>0,E=(v)=>{if(!v)return;X((m)=>m.includes(v)?m.filter((h)=>h!==v):[...m,v])},z=(v,m)=>{X((h)=>{if(m){let e=v.filter((t)=>!h.includes(t));return[...h,...e]}else return h.filter((e)=>!v.includes(e))})},C=()=>{let v=Z.map((e)=>e.name),h=V.length===v.length&&v.every((e)=>V.includes(e))?void 0:V;B(h)},O=NK.useMemo(()=>{let v=qV9(),m={readOnly:[],edit:[],execution:[],mcp:[],other:[]};return Z.forEach((h)=>{if(Vj(h))m.mcp.push(h);else if(v.READ_ONLY.toolNames.has(h.name))m.readOnly.push(h);else if(v.EDIT.toolNames.has(h.name))m.edit.push(h);else if(v.EXECUTION.toolNames.has(h.name))m.execution.push(h);else if(h.name!==j3)m.other.push(h)}),m},[Z]),L=(v)=>{let h=v.filter((e)=>F.has(e.name)).length<v.length;return()=>{let e=v.map((t)=>t.name);z(e,h)}},M=[];M.push({id:"continue",label:"Continue",action:C,isContinue:!0}),M.push({id:"bucket-all",label:`${H?tA.checkboxOn:tA.checkboxOff} All tools`,action:()=>{let v=Z.map((m)=>m.name);z(v,!H)}});let _=qV9();[{id:"bucket-readonly",name:_.READ_ONLY.name,tools:O.readOnly},{id:"bucket-edit",name:_.EDIT.name,tools:O.edit},{id:"bucket-execution",name:_.EXECUTION.name,tools:O.execution},{id:"bucket-mcp",name:_.MCP.name,tools:O.mcp},{id:"bucket-other",name:_.OTHER.name,tools:O.other}].forEach(({id:v,name:m,tools:h})=>{if(h.length===0)return;let t=h.filter((b)=>F.has(b.name)).length===h.length;M.push({id:v,label:`${t?tA.checkboxOn:tA.checkboxOff} ${m}`,action:L(h)})});let P=M.length;M.push({id:"toggle-individual",label:D?"Hide advanced options":"Show advanced options",action:()=>{if(K(!D),D&&I>P)W(P)},isToggle:!0});let y=NK.useMemo(()=>MH7(Z),[Z]);if(D){if(y.length>0)M.push({id:"mcp-servers-header",label:"MCP Servers:",action:()=>{},isHeader:!0}),y.forEach(({serverName:v,tools:m})=>{let e=m.filter((t)=>F.has(t.name)).length===m.length;M.push({id:`mcp-server-${v}`,label:`${e?tA.checkboxOn:tA.checkboxOff} ${v} (${m.length} tool${m.length===1?"":"s"})`,action:()=>{let t=m.map((b)=>b.name);z(t,!e)}})}),M.push({id:"tools-header",label:"Individual Tools:",action:()=>{},isHeader:!0});Z.forEach((v)=>{let m=v.name;if(v.name.startsWith("mcp__")){let h=UF(v.name);m=h?`${h.toolName} (${h.serverName})`:v.name}M.push({id:`tool-${v.name}`,label:`${F.has(v.name)?tA.checkboxOn:tA.checkboxOff} ${m}`,action:()=>E(v.name)})})}return Y0((v,m)=>{if(m.return){let h=M[I];if(h&&!h.isHeader)h.action()}else if(m.escape)if(G)G();else B(Q);else if(m.upArrow){let h=I-1;while(h>0&&M[h]?.isHeader)h--;W(Math.max(0,h))}else if(m.downArrow){let h=I+1;while(h<M.length-1&&M[h]?.isHeader)h++;W(Math.min(M.length-1,h))}}),NK.default.createElement(T,{flexDirection:"column",marginTop:1},NK.default.createElement($,{color:I===0?"suggestion":void 0,bold:I===0},I===0?`${tA.pointer} `:"  ","[ Continue ]"),NK.default.createElement($,{dimColor:!0},"─".repeat(40)),M.slice(1).map((v,m)=>{let h=m+1===I,e=v.isToggle,t=v.isHeader;return NK.default.createElement(NK.default.Fragment,{key:v.id},e&&NK.default.createElement($,{dimColor:!0},"─".repeat(40)),t&&m>0&&NK.default.createElement(T,{marginTop:1}),NK.default.createElement($,{color:t?void 0:h?"suggestion":void 0,dimColor:t,bold:e&&h},t?"":h?`${tA.pointer} `:"  ",e?`[ ${v.label} ]`:v.label))}),NK.default.createElement(T,{marginTop:1,flexDirection:"column"},NK.default.createElement($,{dimColor:!0},H?"All tools selected":`${F.size} of ${Z.length} tools selected`)))}var NK,qV9=()=>({READ_ONLY:{name:"Read-only tools",toolNames:new Set([Ls.name,Bp.name,XC.name,M5.name,fF.name,TW.name,YD1.name,QD1.name,GD1.name,Ad.name,Qd.name])},EDIT:{name:"Edit tools",toolNames:new Set([QC.name,BC.name,Af.name])},EXECUTION:{name:"Execution tools",toolNames:new Set([Z9.name,void 0].filter(Boolean))},MCP:{name:"MCP tools",toolNames:new Set,isMcp:!0},OTHER:{name:"Other tools",toolNames:new Set}});var OT0=w(()=>{kA();kA();I2();MJ();zW1();EkA();gkA();F_();QHA();oXA();kC0();SC0();yC0();EG1();zG1();Ns();Qp();I6A();ZK();$6A();NK=c(JA(),1)});function NV9({tools:A}){let{goNext:Q,goBack:B,updateWizardData:G,wizardData:Z}=lJ(),Y=(X)=>{G({selectedTools:X}),Q()},J=Z.selectedTools;return s3A.default.createElement(DW,{subtitle:"Select tools",footerText:s3A.default.createElement(YB,null,s3A.default.createElement(y0,{shortcut:"Enter",action:"toggle selection"}),s3A.default.createElement(y0,{shortcut:"↑↓",action:"navigate"}),s3A.default.createElement(DB,{action:"confirm:no",context:"Confirmation",fallback:"Esc",description:"go back"}))},s3A.default.createElement(oz1,{tools:A,initialTools:J,onComplete:Y,onCancel:B}))}var s3A;var wV9=w(()=>{OT0();Cj();mO();e4();Z5();T3();s3A=c(JA(),1)});function rz1({initialModel:A,onComplete:Q,onCancel:B}){let G=$j.useMemo(()=>OsQ(),[]),Z=$j.useMemo(()=>{if(A&&G.some((Y)=>Y.value===A))return A;return"sonnet"},[A,G]);return $j.createElement(T,{flexDirection:"column"},$j.createElement(T,{marginBottom:1},$j.createElement($,{dimColor:!0},"Model determines the agent's reasoning capabilities and speed.")),$j.createElement(x0,{options:G,defaultValue:Z,onChange:(Y)=>{Q(Y)},onCancel:()=>B?B():Q(A)}))}var $j;var MT0=w(()=>{kA();Q8();m2();$j=c(JA(),1)});function LV9(){let{goNext:A,goBack:Q,updateWizardData:B,wizardData:G}=lJ(),Z=(Y)=>{B({selectedModel:Y}),A()};return t3A.default.createElement(DW,{subtitle:"Select model",footerText:t3A.default.createElement(YB,null,t3A.default.createElement(y0,{shortcut:"↑↓",action:"navigate"}),t3A.default.createElement(y0,{shortcut:"Enter",action:"select"}),t3A.default.createElement(DB,{action:"confirm:no",context:"Confirmation",fallback:"Esc",description:"go back"}))},t3A.default.createElement(rz1,{initialModel:G.selectedModel,onComplete:Z,onCancel:Q}))}var t3A;var OV9=w(()=>{MT0();Cj();mO();e4();Z5();T3();t3A=c(JA(),1)});function sz1({agentName:A,currentColor:Q="automatic",onConfirm:B}){let[G,Z]=_U.useState(Math.max(0,bzA.findIndex((J)=>J===Q)));Y0((J,X)=>{if(X.upArrow)Z((I)=>I>0?I-1:bzA.length-1);else if(X.downArrow)Z((I)=>I<bzA.length-1?I+1:0);else if(X.return){let I=bzA[G];B(I==="automatic"?void 0:I)}});let Y=bzA[G];return _U.default.createElement(T,{flexDirection:"column",gap:1},_U.default.createElement(T,{flexDirection:"column"},bzA.map((J,X)=>{let I=X===G;return _U.default.createElement(T,{key:J,flexDirection:"row",gap:1},_U.default.createElement($,{color:I?"suggestion":void 0},I?tA.pointer:" "),J==="automatic"?_U.default.createElement($,{bold:I},"Automatic color"):_U.default.createElement(T,{gap:1},_U.default.createElement($,{backgroundColor:zr[J],color:"inverseText"}," "),_U.default.createElement($,{bold:I},J.charAt(0).toUpperCase()+J.slice(1))))})),_U.default.createElement(T,{marginTop:1},_U.default.createElement($,null,"Preview: "),Y===void 0||Y==="automatic"?_U.default.createElement($,{inverse:!0,bold:!0}," ",A," "):_U.default.createElement($,{backgroundColor:zr[Y],color:"inverseText",bold:!0}," ",A," ")))}var _U,bzA;var RT0=w(()=>{kA();YS();I2();_U=c(JA(),1),bzA=["automatic",...Ub]});function MV9(){let{goNext:A,goBack:Q,updateWizardData:B,wizardData:G}=lJ();A2("confirm:no",Q,{context:"Confirmation"});let Z=(Y)=>{B({selectedColor:Y,finalAgent:{agentType:G.agentType,whenToUse:G.whenToUse,getSystemPrompt:()=>G.systemPrompt,tools:G.selectedTools,...G.selectedModel?{model:G.selectedModel}:{},...Y?{color:Y}:{},source:G.location}}),A()};return Ce.default.createElement(DW,{subtitle:"Choose background color",footerText:Ce.default.createElement(YB,null,Ce.default.createElement(y0,{shortcut:"↑↓",action:"navigate"}),Ce.default.createElement(y0,{shortcut:"Enter",action:"select"}),Ce.default.createElement(DB,{action:"confirm:no",context:"Confirmation",fallback:"Esc",description:"go back"}))},Ce.default.createElement(T,{marginTop:1},Ce.default.createElement(sz1,{agentName:G.agentType||"agent",currentColor:"automatic",onConfirm:Z})))}var Ce;var RV9=w(()=>{kA();RT0();Cj();mO();e4();Z5();T3();_6();Ce=c(JA(),1)});function _V9({tools:A,existingAgents:Q,onSave:B,onSaveAndEdit:G,error:Z}){let{goBack:Y,wizardData:J}=lJ();Y0((D,K)=>{if(K.escape)Y();else if(D==="s"||K.return)B();else if(D==="e")G()});let X=J.finalAgent,I=FV9(X,A,Q),W=(D)=>{if(D===void 0)return"All tools";if(D.length===0)return"None";if(D.length===1)return D[0]||"None";if(D.length===2)return D.join(" and ");return`${D.slice(0,-1).join(", ")}, and ${D[D.length-1]}`};return m8.default.createElement(DW,{subtitle:"Confirm and save",footerText:m8.default.createElement(YB,null,m8.default.createElement(y0,{shortcut:"s/Enter",action:"save"}),m8.default.createElement(y0,{shortcut:"e",action:"edit in your editor"}),m8.default.createElement(DB,{action:"confirm:no",context:"Confirmation",fallback:"Esc",description:"cancel"}))},m8.default.createElement(T,{flexDirection:"column",marginTop:1},m8.default.createElement($,null,m8.default.createElement($,{bold:!0},"Name"),": ",X.agentType),m8.default.createElement($,null,m8.default.createElement($,{bold:!0},"Location"),":"," ",tK9({source:J.location,agentType:X.agentType})),m8.default.createElement($,null,m8.default.createElement($,{bold:!0},"Tools"),": ",W(X.tools)),m8.default.createElement($,null,m8.default.createElement($,{bold:!0},"Model"),": ",YeA(X.model)),m8.default.createElement(T,{marginTop:1},m8.default.createElement($,null,m8.default.createElement($,{bold:!0},"Description")," (tells Claude when to use this agent):")),m8.default.createElement(T,{marginLeft:2,marginTop:1},m8.default.createElement($,null,X.whenToUse.length>240?X.whenToUse.slice(0,240)+"…":X.whenToUse)),m8.default.createElement(T,{marginTop:1},m8.default.createElement($,null,m8.default.createElement($,{bold:!0},"System prompt"),":")),m8.default.createElement(T,{marginLeft:2,marginTop:1},m8.default.createElement($,null,(()=>{let D=X.getSystemPrompt();return D.length>240?D.slice(0,240)+"…":D})())),I.warnings.length>0&&m8.default.createElement(T,{marginTop:1,flexDirection:"column"},m8.default.createElement($,{color:"warning"},"Warnings:"),I.warnings.map((D,K)=>m8.default.createElement($,{key:K,dimColor:!0}," ","• ",D))),I.errors.length>0&&m8.default.createElement(T,{marginTop:1,flexDirection:"column"},m8.default.createElement($,{color:"error"},"Errors:"),I.errors.map((D,K)=>m8.default.createElement($,{key:K,color:"error"}," ","• ",D))),Z&&m8.default.createElement(T,{marginTop:1},m8.default.createElement($,{color:"error"},Z)),m8.default.createElement(T,{marginTop:2},m8.default.createElement($,{color:"success"},"Press ",m8.default.createElement($,{bold:!0},"s")," or ",m8.default.createElement($,{bold:!0},"Enter")," to save,"," ",m8.default.createElement($,{bold:!0},"e")," to save and edit"))))}var m8;var jV9=w(()=>{kA();kA();Cj();mO();LT0();vzA();m2();e4();Z5();T3();m8=c(JA(),1)});function TV9({tools:A,existingAgents:Q,onComplete:B}){let{wizardData:G}=lJ(),[Z,Y]=e3A.useState(null),[,J]=e0(),X=e3A.useCallback(async()=>{if(!G?.finalAgent)return;try{await HT0(G.location,G.finalAgent.agentType,G.finalAgent.whenToUse,G.finalAgent.tools,G.finalAgent.getSystemPrompt(),!0,G.finalAgent.color,G.finalAgent.model),J((W)=>{if(!G.finalAgent)return W;let D=W.agentDefinitions.allAgents.concat(G.finalAgent);return{...W,agentDefinitions:{...W.agentDefinitions,activeAgents:Yf(D),allAgents:D}}}),p("tengu_agent_created",{agent_type:G.finalAgent.agentType,generation_method:G.wasGenerated?"generated":"manual",source:G.location,tool_count:G.finalAgent.tools?.length??"all",has_custom_model:!!G.finalAgent.model,has_custom_color:!!G.finalAgent.color}),B(`Created agent: ${W1.bold(G.finalAgent.agentType)}`)}catch(W){Y(W instanceof Error?W.message:"Failed to save agent")}},[G,B,J]),I=e3A.useCallback(async()=>{if(!G?.finalAgent)return;try{await HT0(G.location,G.finalAgent.agentType,G.finalAgent.whenToUse,G.finalAgent.tools,G.finalAgent.getSystemPrompt(),!0,G.finalAgent.color,G.finalAgent.model),J((D)=>{if(!G.finalAgent)return D;let K=D.agentDefinitions.allAgents.concat(G.finalAgent);return{...D,agentDefinitions:{...D.agentDefinitions,activeAgents:Yf(K),allAgents:K}}});let W=FT0({source:G.location,agentType:G.finalAgent.agentType});await ls(W),p("tengu_agent_created",{agent_type:G.finalAgent.agentType,generation_method:G.wasGenerated?"generated":"manual",source:G.location,tool_count:G.finalAgent.tools?.length??"all",has_custom_model:!!G.finalAgent.model,has_custom_color:!!G.finalAgent.color,opened_in_editor:!0}),B(`Created agent: ${W1.bold(G.finalAgent.agentType)} and opened in editor. If you made edits, restart to load the latest version.`)}catch(W){Y(W instanceof Error?W.message:"Failed to save agent")}},[G,B,J]);return e3A.default.createElement(_V9,{tools:A,existingAgents:Q,onSave:X,onSaveAndEdit:I,error:Z})}var e3A;var PV9=w(()=>{t6();mO();jV9();vzA();dS();is();Z0();uB();e3A=c(JA(),1)});function SV9({tools:A,existingAgents:Q,onComplete:B,onCancel:G}){return lgA.default.createElement(CT0,{steps:[YV9,XV9,KV9,()=>lgA.default.createElement(HV9,{existingAgents:Q}),zV9,$V9,()=>lgA.default.createElement(NV9,{tools:A}),LV9,MV9,()=>lgA.default.createElement(TV9,{tools:A,existingAgents:Q,onComplete:B})],initialData:{},onComplete:()=>{},onCancel:G,title:"Create new agent",showStepCounter:!1})}var lgA;var xV9=w(()=>{mO();JV9();IV9();VV9();EV9();CV9();UV9();wV9();OV9();RV9();PV9();lgA=c(JA(),1)});function yV9({agent:A,tools:Q,onSaved:B,onBack:G}){let[,Z]=e0(),[Y,J]=Uj.useState("menu"),[X,I]=Uj.useState(0),[W,D]=Uj.useState(null),[K,V]=Uj.useState(A.color),F=Uj.useCallback(async()=>{try{let L=nz1(A);await ls(L),B(`Opened ${A.agentType} in editor. If you made edits, restart to load the latest version.`)}catch(L){D(L instanceof Error?L.message:"Failed to open editor")}},[A,B]),H=Uj.useCallback(async(L={})=>{let{tools:M,color:_,model:j}=L,P=_??K,y=M!==void 0,v=j!==void 0,m=P!==A.color;if(!y&&!v&&!m)return!1;try{if(!Zh2(A)&&!HD1(A))return!1;if(await AV9(A,A.whenToUse,M??A.tools,A.getSystemPrompt(),P,j??A.model),m&&P)oKA(A.agentType,P);return Z((h)=>{let e=h.agentDefinitions.allAgents.map((t)=>t.agentType===A.agentType?{...t,tools:M??t.tools,color:P,model:j??t.model}:t);return{...h,agentDefinitions:{...h.agentDefinitions,activeAgents:Yf(e),allAgents:e}}}),B(`Updated agent: ${W1.bold(A.agentType)}`),!0}catch(h){return D(h instanceof Error?h.message:"Failed to save agent"),!1}},[A,K,B,Z]),E=Uj.useMemo(()=>[{label:"Open in editor",action:F},{label:"Edit tools",action:()=>J("edit-tools")},{label:"Edit model",action:()=>J("edit-model")},{label:"Edit color",action:()=>J("edit-color")}],[F]),z=Uj.useCallback(()=>{if(D(null),Y==="menu")G();else J("menu")},[Y,G]),C=Uj.useCallback((L)=>{if(L.upArrow)I((M)=>Math.max(0,M-1));else if(L.downArrow)I((M)=>Math.min(E.length-1,M+1));else if(L.return){let M=E[X];if(M)M.action()}},[E,X]);Y0((L,M)=>{if(M.escape){z();return}if(Y==="menu")C(M)});let O=()=>$V.createElement(T,{flexDirection:"column"},$V.createElement($,{dimColor:!0},"Source: ",kzA(A.source)),$V.createElement(T,{marginTop:1,flexDirection:"column"},E.map((L,M)=>$V.createElement($,{key:L.label,color:M===X?"suggestion":void 0},M===X?`${tA.pointer} `:"  ",L.label))),W&&$V.createElement(T,{marginTop:1},$V.createElement($,{color:"error"},W)));switch(Y){case"menu":return O();case"edit-tools":return $V.createElement(oz1,{tools:Q,initialTools:A.tools,onComplete:async(L)=>{J("menu"),await H({tools:L})}});case"edit-color":return $V.createElement(sz1,{agentName:A.agentType,currentColor:K||A.color||"automatic",onConfirm:async(L)=>{V(L),J("menu"),await H({color:L})}});case"edit-model":return $V.createElement(rz1,{initialModel:A.model,onComplete:async(L)=>{J("menu"),await H({model:L})}});default:return null}}var $V,Uj;var vV9=w(()=>{kA();t6();dS();OT0();RT0();MT0();vzA();is();YS();I2();az1();uB();$V=c(JA(),1),Uj=c(JA(),1)});function kV9({agent:A,tools:Q,onBack:B}){let G=Ts(A,Q,!1),Z=eK9(A),Y=aKA(A.agentType);Y0((X,I)=>{if(I.escape||I.return)B()});function J(){if(G.hasWildcard)return j9.createElement($,null,"All tools");if(!A.tools||A.tools.length===0)return j9.createElement($,null,"None");return j9.createElement(j9.Fragment,null,G.validTools.length>0&&j9.createElement($,null,G.validTools.join(", ")),G.invalidTools.length>0&&j9.createElement($,{color:"warning"},tA.warning," Unrecognized:"," ",G.invalidTools.join(", ")))}return j9.createElement(T,{flexDirection:"column",gap:1},j9.createElement($,{dimColor:!0},Z),j9.createElement(T,{flexDirection:"column"},j9.createElement($,null,j9.createElement($,{bold:!0},"Description")," (tells Claude when to use this agent):"),j9.createElement(T,{marginLeft:2},j9.createElement($,null,A.whenToUse))),j9.createElement(T,null,j9.createElement($,null,j9.createElement($,{bold:!0},"Tools"),":"," "),J()),j9.createElement($,null,j9.createElement($,{bold:!0},"Model"),": ",YeA(A.model)),Y&&j9.createElement(T,null,j9.createElement($,null,j9.createElement($,{bold:!0},"Color"),":"," ",j9.createElement($,{backgroundColor:Y,color:"inverseText"}," ",A.agentType," "))),!u_(A)&&j9.createElement(j9.Fragment,null,j9.createElement(T,null,j9.createElement($,null,j9.createElement($,{bold:!0},"System prompt"),":")),j9.createElement(T,{marginLeft:2,marginRight:2},j9.createElement(QV,null,A.getSystemPrompt()))))}var j9;var bV9=w(()=>{kA();I2();dS();$6A();Mb();vzA();YS();m2();j9=c(JA(),1)});function fzA({instructions:A="Press ↑↓ to navigate · Enter to select · Esc to go back"}){let Q=_Q();return igA.createElement(T,{marginLeft:3},igA.createElement($,{dimColor:!0},Q.pending?`Press ${Q.keyName} again to exit`:A))}var igA;var fV9=w(()=>{kA();U9();igA=c(JA(),1)});function hV9({tools:A,onExit:Q}){let[B,G]=$e.useState({mode:"list-agents",source:"all"}),[Z,Y]=e0(),{allAgents:J,activeAgents:X}=Z.agentDefinitions,[I,W]=$e.useState([]),D=RV1(A,Z.mcp.tools,Z.toolPermissionContext);_Q();let K=$e.useMemo(()=>({"built-in":J.filter((H)=>H.source==="built-in"),userSettings:J.filter((H)=>H.source==="userSettings"),projectSettings:J.filter((H)=>H.source==="projectSettings"),policySettings:J.filter((H)=>H.source==="policySettings"),localSettings:J.filter((H)=>H.source==="localSettings"),flagSettings:J.filter((H)=>H.source==="flagSettings"),plugin:J.filter((H)=>H.source==="plugin"),all:J}),[J]);Y0((H,E)=>{if(!E.escape)return;let z=I.length>0?`Agent changes:
${I.join(`
`)}`:void 0;switch(B.mode){case"list-agents":Q(z??"Agents dialog dismissed",{display:I.length===0?"system":void 0});break;case"create-agent":return;case"view-agent":return;default:if("previousMode"in B)G(B.previousMode)}});let V=$e.useCallback((H)=>{W((E)=>[...E,H]),G({mode:"list-agents",source:"all"})},[]),F=$e.useCallback(async(H)=>{try{await QV9(H),Y((E)=>{let z=E.agentDefinitions.allAgents.filter((C)=>!(C.agentType===H.agentType&&C.source===H.source));return{...E,agentDefinitions:{...E.agentDefinitions,allAgents:z,activeAgents:Yf(z)}}}),W((E)=>[...E,`Deleted agent: ${W1.bold(H.agentType)}`]),G({mode:"list-agents",source:"all"})}catch(E){s(E instanceof Error?E:Error("Failed to delete agent"))}},[]);switch(B.mode){case"list-agents":{let H=B.source==="all"?[...K["built-in"],...K.userSettings,...K.projectSettings,...K.policySettings,...K.flagSettings,...K.plugin]:K[B.source],E=new Map;X.forEach((C)=>E.set(C.agentType,C));let z=H.map((C)=>{let O=E.get(C.agentType),L=O&&O.source!==C.source?O.source:void 0;return{...C,overriddenBy:L}});return g2.createElement(g2.Fragment,null,g2.createElement(BV9,{source:B.source,agents:z,onBack:()=>{let C=I.length>0?`Agent changes:
${I.join(`
`)}`:void 0;Q(C??"Agents dialog dismissed",{display:I.length===0?"system":void 0})},onSelect:(C)=>G({mode:"agent-menu",agent:C,previousMode:B}),onCreateNew:()=>G({mode:"create-agent"}),changes:I}),g2.createElement(fzA,null))}case"create-agent":return g2.createElement(SV9,{tools:D,existingAgents:X,onComplete:V,onCancel:()=>G({mode:"list-agents",source:"all"})});case"agent-menu":{let E=J.find((L)=>L.agentType===B.agent.agentType&&L.source===B.agent.source)||B.agent,z=E.source==="built-in",C=[{label:"View agent",value:"view"},...!z?[{label:"Edit agent",value:"edit"},{label:"Delete agent",value:"delete"}]:[],{label:"Back",value:"back"}],O=(L)=>{switch(L){case"view":G({mode:"view-agent",agent:E,previousMode:B.previousMode});break;case"edit":G({mode:"edit-agent",agent:E,previousMode:B});break;case"delete":G({mode:"delete-confirm",agent:E,previousMode:B});break;case"back":G(B.previousMode);break}};return g2.createElement(g2.Fragment,null,g2.createElement(He,{title:B.agent.agentType},g2.createElement(T,{flexDirection:"column",marginTop:1},g2.createElement(x0,{options:C,onChange:O,onCancel:()=>G(B.previousMode)}),I.length>0&&g2.createElement(T,{marginTop:1},g2.createElement($,{dimColor:!0},I[I.length-1])))),g2.createElement(fzA,null))}case"view-agent":{let E=J.find((z)=>z.agentType===B.agent.agentType&&z.source===B.agent.source)||B.agent;return g2.createElement(g2.Fragment,null,g2.createElement(He,{title:E.agentType},g2.createElement(kV9,{agent:E,tools:D,allAgents:J,onBack:()=>G({mode:"agent-menu",agent:E,previousMode:B.previousMode})})),g2.createElement(fzA,{instructions:"Press Enter or Esc to go back"}))}case"delete-confirm":{let H=[{label:"Yes, delete",value:"yes"},{label:"No, cancel",value:"no"}];return g2.createElement(g2.Fragment,null,g2.createElement(He,{title:"Delete agent",titleColor:"error",borderColor:"error"},g2.createElement($,null,"Are you sure you want to delete the agent"," ",g2.createElement($,{bold:!0},B.agent.agentType),"?"),g2.createElement(T,{marginTop:1},g2.createElement($,{dimColor:!0},"Source: ",B.agent.source)),g2.createElement(T,{marginTop:1},g2.createElement(x0,{options:H,onChange:(E)=>{if(E==="yes")F(B.agent);else if("previousMode"in B)G(B.previousMode)},onCancel:()=>{if("previousMode"in B)G(B.previousMode)}}))),g2.createElement(fzA,{instructions:"Press ↑↓ to navigate, Enter to select, Esc to cancel"}))}case"edit-agent":{let E=J.find((z)=>z.agentType===B.agent.agentType&&z.source===B.agent.source)||B.agent;return g2.createElement(g2.Fragment,null,g2.createElement(He,{title:`Edit agent: ${E.agentType}`},g2.createElement(yV9,{agent:E,tools:D,onSaved:(z)=>{V(z),G(B.previousMode)},onBack:()=>G(B.previousMode)})),g2.createElement(fzA,null))}default:return null}}var g2,$e;var gV9=w(()=>{kA();kA();t6();U9();dS();vzA();Q8();GV9();xV9();vV9();bV9();f1();fV9();ET0();uB();ZN0();g2=c(JA(),1),$e=c(JA(),1)});var _T0,RH7,uV9;var mV9=w(()=>{gV9();ME();_T0=c(JA(),1),RH7={type:"local-jsx",name:"agents",description:"Manage agent configurations",isEnabled:()=>!0,isHidden:!1,async call(A,Q){let G=(await Q.getAppState()).toolPermissionContext,Z=IC(G);return _T0.createElement(hV9,{tools:Z,onExit:A})},userFacingName(){return"agents"}},uV9=RH7});var jT0,_H7,dV9;var pV9=w(()=>{r_0();jT0=c(JA(),1),_H7={type:"local-jsx",name:"plugin",aliases:["plugins","marketplace"],description:"Manage Claude Code plugins",isEnabled:()=>!0,isHidden:!1,async call(A,Q,B){return jT0.createElement(oX9,{onComplete:A,args:B})},userFacingName(){return"plugin"}},dV9=_H7});var jH7,cV9;var lV9=w(()=>{QZ();jH7={description:"Restore the code and/or conversation to a previous point",name:"rewind",aliases:["checkpoint"],userFacingName:()=>"rewind",argumentHint:"",isEnabled:()=>!0,type:"local",isHidden:!1,supportsNonInteractive:!1,async call(A,Q){if(y9("rewind"),Q.openMessageSelector)Q.openMessageSelector();return{type:"skip"}}},cV9=jH7});var iV9=w(()=>{q0();V6();rZ();eB();f1();y1();e1()});var nV9=w(()=>{iV9()});var TH7,PH7;var aV9=w(()=>{kA();b8();aiA();TH7=c(JA(),1),PH7=c(JA(),1)});function SH7(A,Q){let B=0,G=Q===null||Q===void 0;for(let Z of A){if(!G){if(Z.uuid===Q)G=!0;continue}if(Z.type==="assistant"){let J=Z.message.content;if(Array.isArray(J))B+=J.filter((X)=>X.type==="tool_use").length}}return B}function xH7(A){let B=[...A].reverse().find((I)=>I.type==="assistant")?.uuid;if(B&&B!==rV9){let I=nK(A);if(I>0)on2(I);let W=GtB(A);if(W>0)rn2(W);rV9=B}if(!tn2()){if(!Aa2())return!1;en2()}let G=Qa2(),Y=SH7(A,oV9)>=Ba2(),J=ngA(A);if(G&&Y||G&&!J){let I=A[A.length-1];if(I?.uuid)oV9=I.uuid;return!0}return!1}async function yH7(A){let Q=xA(),B=tz1();if(!Q.existsSync(B))Q.mkdirSync(B,{mode:448});let G=MfA();if(!Q.existsSync(G)){let X=await vN0();bB(G,X,{encoding:"utf-8",flush:!1,mode:384})}let Z=await M5.call({file_path:G},A),Y="",J=Z.data;if(J.type==="text")Y=J.file.content;return{memoryPath:G,currentMemory:Y}}async function sV9(){if(!Np())return;if(await WeA("tengu_session_memory")){let A=await Uu("tengu_sm_config",{}),Q={minimumMessageTokensToInit:A.minimumMessageTokensToInit&&A.minimumMessageTokensToInit>0?A.minimumMessageTokensToInit:LfA.minimumMessageTokensToInit,minimumTokensBetweenUpdate:A.minimumTokensBetweenUpdate&&A.minimumTokensBetweenUpdate>0?A.minimumTokensBetweenUpdate:LfA.minimumTokensBetweenUpdate,toolCallsBetweenUpdates:A.toolCallsBetweenUpdates&&A.toolCallsBetweenUpdates>0?A.toolCallsBetweenUpdates:LfA.toolCallsBetweenUpdates};nn2(Q),iE1(vH7)}}function kH7(A){return async(Q,B)=>{if(Q.name===t3&&typeof B==="object"&&B!==null&&"file_path"in B){if(B.file_path===A)return{behavior:"allow",updatedInput:B}}return{behavior:"deny",message:`only ${t3} on ${A} is allowed`,decisionReason:{type:"other",reason:`only ${t3} on ${A} is allowed`}}}}function bH7(A){if(!ngA(A)){let Q=A[A.length-1];if(Q?.uuid)YEA(Q.uuid)}}var oV9,rV9,vH7;var TT0=w(()=>{fY();EQ();e1();F_();kN0();Ks();BgA();VX();M3();Z0();rs();eQ();OfA();S$();yp();TS();vH7=uv(async function(A){let{messages:Q,toolUseContext:B,querySource:G}=A;if(G!=="repl_main_thread")return;if(!xH7(Q))return;pn2();let Z=lfA(B),{memoryPath:Y,currentMemory:J}=await yH7(Z),X=await Ja2(J,Y);await d6A({promptMessages:[C0({content:X})],cacheSafeParams:YfA(A),canUseTool:kH7(Y),querySource:"session_memory",forkLabel:"session_memory",overrides:{readFileState:Z.readFileState}});let I=Q[Q.length-1],W=I?mm(I):void 0,D=an2();p("tengu_session_memory_extraction",{input_tokens:W?.input_tokens,output_tokens:W?.output_tokens,cache_read_input_tokens:W?.cache_read_input_tokens??void 0,cache_creation_input_tokens:W?.cache_creation_input_tokens??void 0,config_min_message_tokens_to_init:D.minimumMessageTokensToInit,config_min_tokens_between_update:D.minimumTokensBetweenUpdate,config_tool_calls_between_updates:D.toolCallsBetweenUpdates}),sn2(),bH7(Q),cn2()})});var tV9=w(()=>{TT0();fY();_I0()});var fH7;var eV9=w(()=>{ZX();kA();gk();eB();y1();wz();f1();b8();H_0();gW();q0();e1();fH7=c(JA(),1)});var AF9=()=>{};function QF9(){if(!JB.isSandboxingEnabled())return N6.createElement(T,{flexDirection:"column",paddingY:1},N6.createElement($,{color:"subtle"},"Sandbox is not enabled"));let Q=JB.getFsReadConfig(),B=JB.getFsWriteConfig(),G=JB.getNetworkRestrictionConfig(),Z=JB.getAllowUnixSockets(),Y=JB.getExcludedCommands(),J=JB.getLinuxGlobPatternWarnings();return N6.createElement(T,{flexDirection:"column",paddingY:1},N6.createElement(T,{flexDirection:"column"},N6.createElement($,{bold:!0,color:"permission"},"Excluded Commands:"),N6.createElement($,{dimColor:!0},Y.length>0?Y.join(", "):"None")),Q.denyOnly.length>0&&N6.createElement(T,{marginTop:1,flexDirection:"column"},N6.createElement($,{bold:!0,color:"permission"},"Filesystem Read Restrictions:"),N6.createElement($,{dimColor:!0},"Denied: ",Q.denyOnly.join(", "))),B.allowOnly.length>0&&N6.createElement(T,{marginTop:1,flexDirection:"column"},N6.createElement($,{bold:!0,color:"permission"},"Filesystem Write Restrictions:"),N6.createElement($,{dimColor:!0},"Allowed: ",B.allowOnly.join(", ")),B.denyWithinAllow.length>0&&N6.createElement($,{dimColor:!0},"Denied within allowed: ",B.denyWithinAllow.join(", "))),(G.allowedHosts&&G.allowedHosts.length>0||G.deniedHosts&&G.deniedHosts.length>0)&&N6.createElement(T,{marginTop:1,flexDirection:"column"},N6.createElement($,{bold:!0,color:"permission"},"Network Restrictions:"),G.allowedHosts&&G.allowedHosts.length>0&&N6.createElement($,{dimColor:!0},"Allowed: ",G.allowedHosts.join(", ")),G.deniedHosts&&G.deniedHosts.length>0&&N6.createElement($,{dimColor:!0},"Denied: ",G.deniedHosts.join(", "))),Z&&Z.length>0&&N6.createElement(T,{marginTop:1,flexDirection:"column"},N6.createElement($,{bold:!0,color:"permission"},"Allowed Unix Sockets:"),N6.createElement($,{dimColor:!0},Z.join(", "))),J.length>0&&N6.createElement(T,{marginTop:1,flexDirection:"column"},N6.createElement($,{bold:!0,color:"warning"},"⚠ Warning: Glob patterns not fully supported on Linux"),N6.createElement($,{dimColor:!0},"The following patterns will be ignored:"," ",J.slice(0,3).join(", "),J.length>3&&` (${J.length-3} more)`)))}var N6;var BF9=w(()=>{kA();zJ();N6=c(JA(),1)});function GF9({onComplete:A}){let[Q]=aB(),B=JB.isSandboxingEnabled(),G=JB.areUnsandboxedCommandsAllowed(),Z=JB.areSandboxSettingsLockedByPolicy(),Y=G?"open":"closed",J=rQ("success",Q)("(current)"),X=[{label:Y==="open"?`Allow unsandboxed fallback ${J}`:"Allow unsandboxed fallback",value:"open"},{label:Y==="closed"?`Strict sandbox mode ${J}`:"Strict sandbox mode",value:"closed"}];async function I(W){let D=W;await JB.setSandboxSettings({allowUnsandboxedCommands:D==="open"}),A(D==="open"?"✓ Unsandboxed fallback allowed - commands can run outside sandbox when necessary":"✓ Strict sandbox mode - all commands must run in sandbox or be excluded via the `excludedCommands` option")}if(Y0((W,D)=>{if(D.escape)A()}),!B)return AH.default.createElement(T,{flexDirection:"column",paddingY:1},AH.default.createElement($,{color:"subtle"},"Sandbox is not enabled. Enable sandbox to configure override settings."));if(Z)return AH.default.createElement(T,{flexDirection:"column",paddingY:1},AH.default.createElement($,{color:"subtle"},"Override settings are managed by a higher-priority configuration and cannot be changed locally."),AH.default.createElement(T,{marginTop:1},AH.default.createElement($,{dimColor:!0},"Current setting:"," ",Y==="closed"?"Strict sandbox mode":"Allow unsandboxed fallback")));return AH.default.createElement(T,{flexDirection:"column",paddingY:1},AH.default.createElement(T,{marginBottom:1},AH.default.createElement($,{bold:!0},"Configure Overrides:")),AH.default.createElement(x0,{options:X,onChange:I,onCancel:()=>A()}),AH.default.createElement(T,{flexDirection:"column",marginTop:1,gap:1},AH.default.createElement($,{dimColor:!0},AH.default.createElement($,{bold:!0,dimColor:!0},"Allow unsandboxed fallback:")," ","When a command fails due to sandbox restrictions, Claude can retry with dangerouslyDisableSandbox to run outside the sandbox (falling back to default permissions)."),AH.default.createElement($,{dimColor:!0},AH.default.createElement($,{bold:!0,dimColor:!0},"Strict sandbox mode:")," ","All bash commands invoked by the model must run in the sandbox unless they are explicitly listed in excludedCommands."),AH.default.createElement($,{dimColor:!0},"Learn more:"," ",AH.default.createElement(Q9,{url:"https://code.claude.com/docs/en/sandboxing#configure-sandboxing"},"code.claude.com/docs/en/sandboxing#configure-sandboxing"))))}var AH;var ZF9=w(()=>{kA();Q8();zJ();kA();AH=c(JA(),1)});function YF9({onComplete:A}){let[Q]=aB(),B=JB.isSandboxingEnabled(),G=JB.isAutoAllowBashIfSandboxedEnabled(),Y=(()=>{if(!B)return"disabled";if(G)return"auto-allow";return"regular"})(),J=rQ("success",Q)("(current)"),X=[{label:Y==="auto-allow"?`Sandbox BashTool, with auto-allow ${J}`:"Sandbox BashTool, with auto-allow",value:"auto-allow"},{label:Y==="regular"?`Sandbox BashTool, with regular permissions ${J}`:"Sandbox BashTool, with regular permissions",value:"regular"},{label:Y==="disabled"?`No Sandbox ${J}`:"No Sandbox",value:"disabled"}];async function I(W){switch(W){case"auto-allow":await JB.setSandboxSettings({enabled:!0,autoAllowBashIfSandboxed:!0}),A("✓ Sandbox enabled with auto-allow for bash commands");break;case"regular":await JB.setSandboxSettings({enabled:!0,autoAllowBashIfSandboxed:!1}),A("✓ Sandbox enabled with regular bash permissions");break;case"disabled":await JB.setSandboxSettings({enabled:!1,autoAllowBashIfSandboxed:!1}),A("○ Sandbox disabled");break}}return Y0((W,D)=>{if(D.escape)A()}),UV.default.createElement(T,{flexDirection:"column"},UV.default.createElement(B8,{dividerColor:"permission",dividerDimColor:!0}),UV.default.createElement(T,{marginX:1},UV.default.createElement(Fj,{title:"Sandbox:",color:"permission",defaultTab:"Mode"},UV.default.createElement(SX,{key:"mode",title:"Mode"},UV.default.createElement(T,{flexDirection:"column",paddingY:1},UV.default.createElement(T,{marginBottom:1},UV.default.createElement($,{bold:!0},"Configure Mode:")),UV.default.createElement(x0,{options:X,onChange:I,onCancel:()=>A()}),UV.default.createElement(T,{flexDirection:"column",marginTop:1,gap:1},UV.default.createElement($,{dimColor:!0},UV.default.createElement($,{bold:!0,dimColor:!0},"Auto-allow mode:")," ","Commands will try to run in the sandbox automatically, and attempts to run outside of the sandbox fallback to regular permissions. Explicit ask/deny rules are always respected."),UV.default.createElement($,{dimColor:!0},"Learn more:"," ",UV.default.createElement(Q9,{url:"https://code.claude.com/docs/en/sandboxing"},"code.claude.com/docs/en/sandboxing"))))),UV.default.createElement(SX,{key:"overrides",title:"Overrides"},UV.default.createElement(GF9,{onComplete:A})),UV.default.createElement(SX,{key:"config",title:"Config"},UV.default.createElement(QF9,null)))))}var UV;var JF9=w(()=>{kA();Q8();zJ();y3A();gW();kA();BF9();ZF9();UV=c(JA(),1)});import*as XF9 from"path";async function hH7(A,Q,B){let Z=NQ().theme||"light";if(!JB.isSupportedPlatform(LQ())){let J=rQ("error",Z)("Error: Sandboxing is currently only supported on macOS and Linux");return A(J),null}if(!JB.checkDependencies()){let X=LQ()==="linux"?"Error: Sandbox requires socat and bubblewrap. Please install these packages.":"Error: Sandbox dependencies are not available on this system.",I=rQ("error",Z)(X);return A(I),null}if(JB.areSandboxSettingsLockedByPolicy()){let J=rQ("error",Z)("Error: Sandbox settings are overridden by a higher-priority configuration and cannot be changed locally.");return A(J),null}let Y=B?.trim()||"";if(!Y)return IF9.default.createElement(YF9,{onComplete:A});if(Y){let X=Y.split(" ")[0];if(X==="exclude"){let I=Y.slice(8).trim();if(!I){let F=rQ("error",Z)('Error: Please provide a command pattern to exclude (e.g., /sandbox exclude "npm run test:*")');return A(F),null}let W=I.replace(/^["']|["']$/g,"");aFB(W);let D=yH("localSettings"),K=D?XF9.relative(E5A(),D):".claude/settings.local.json",V=rQ("success",Z)(`Added "${W}" to excluded commands in ${K}`);return A(V),null}else{let I=rQ("error",Z)(`Error: Unknown subcommand "${X}". Available subcommand: exclude`);return A(I),null}}return null}var IF9,gH7,WF9;var DF9=w(()=>{zJ();kA();GB();zJ();GB();q0();JF9();f3();IF9=c(JA(),1);gH7={name:"sandbox",get description(){let A=JB.isSandboxingEnabled(),Q=JB.isAutoAllowBashIfSandboxedEnabled(),B=JB.areUnsandboxedCommandsAllowed(),G=JB.areSandboxSettingsLockedByPolicy(),Z=A?"✓":"○",Y="sandbox disabled";if(A)Y=Q?"sandbox enabled (auto-allow)":"sandbox enabled",Y+=B?", fallback allowed":"";if(G)Y+=" (managed)";return`${Z} ${Y} (⏎ to configure)`},argumentHint:'exclude "command pattern"',isEnabled:()=>!0,isHidden:!JB.isSupportedPlatform(LQ()),type:"local-jsx",userFacingName:()=>"sandbox",call:hH7},WF9=gH7});function pH7({onDone:A,isExtensionInstalled:Q,configEnabled:B,isClaudeAISubscriber:G,isWSL:Z}){let[Y]=e0(),[J,X]=d8.useState(0),[I,W]=d8.useState(B??!1),[D,K]=d8.useState(!1),[V,F]=d8.useState(Q),E=Y.mcp.clients.find((M)=>M.name===t_)?.type==="connected";function z(M){switch(M){case"install-extension":X((_)=>_+1),K(!0),WEA(uH7);break;case"reconnect":X((_)=>_+1),Ft().then((_)=>{if(F(_),_)K(!1)}),WEA(dH7);break;case"manage-permissions":X((_)=>_+1),WEA(mH7);break;case"toggle-default":{let _=!I;h0((j)=>({...j,claudeInChromeDefaultEnabled:_})),W(_);break}}}let C=[],O=V?"":" (requires extension)";if(!V)C.push({label:"Install Chrome extension",value:"install-extension"});return C.push({label:d8.default.createElement(d8.default.Fragment,null,d8.default.createElement($,null,"Manage permissions"),d8.default.createElement($,{dimColor:!0},O)),value:"manage-permissions"},{label:d8.default.createElement(d8.default.Fragment,null,d8.default.createElement($,null,"Reconnect extension"),d8.default.createElement($,{dimColor:!0},O)),value:"reconnect"},{label:`Enabled by default: ${I?"Yes":"No"}`,value:"toggle-default"}),d8.default.createElement(t9,{title:"Claude in Chrome (Beta)",onCancel:()=>A(),color:"chromeYellow"},d8.default.createElement(T,{flexDirection:"column",gap:1},d8.default.createElement($,null,"Claude in Chrome works with the Chrome extension to let you control your browser directly from Claude Code. Navigate websites, fill forms, capture screenshots, record GIFs, and debug with console logs and network requests."),Z&&d8.default.createElement($,{color:"error"},"Claude in Chrome is not supported in WSL at this time."),!G&&d8.default.createElement($,{color:"error"},"Claude in Chrome requires a claude.ai subscription."),!(Z||!G)&&d8.default.createElement(d8.default.Fragment,null,d8.default.createElement(T,{flexDirection:"column"},d8.default.createElement($,null,"Status:"," ",E?d8.default.createElement($,{color:"success"},"Enabled"):d8.default.createElement($,{color:"inactive"},"Disabled")),d8.default.createElement($,null,"Extension:"," ",V?d8.default.createElement($,{color:"success"},"Installed"):d8.default.createElement($,{color:"warning"},"Not detected"))),d8.default.createElement(x0,{key:J,options:C,onChange:z,hideIndexes:!0}),D&&d8.default.createElement($,{color:"warning"},"Once installed, select ",'"Reconnect extension"'," to connect."),d8.default.createElement($,null,d8.default.createElement($,{dimColor:!0},"Usage: "),d8.default.createElement($,null,"claude --chrome"),d8.default.createElement($,{dimColor:!0}," or "),d8.default.createElement($,null,"claude --no-chrome")),d8.default.createElement($,{dimColor:!0},"Site-level permissions are inherited from the Chrome extension. Manage permissions in the Chrome extension settings to control which sites Claude can browse, click, and type on.")),d8.default.createElement($,{dimColor:!0},"Learn more: https://code.claude.com/docs/en/chrome")))}async function cH7(A){let Q=await Ft(),B=R1(),G=OB(),Z=n0.isWslEnvironment();return d8.default.createElement(pH7,{onDone:A,isExtensionInstalled:Q,configEnabled:B.claudeInChromeDefaultEnabled,isClaudeAISubscriber:G,isWSL:Z})}var d8,uH7="https://claude.ai/chrome",mH7="https://clau.de/chrome/permissions",dH7="https://clau.de/chrome/reconnect",lH7,KF9;var VF9=w(()=>{kA();DEA();Zx();IQ();q0();iY();Q8();uB();eB();h3();d8=c(JA(),1);lH7={name:"chrome",description:"Claude in Chrome (Beta) settings",isEnabled:()=>!n2(),isHidden:!1,type:"local-jsx",userFacingName:()=>"chrome",call:cH7},KF9=lH7});var iH7,FF9;var HF9=w(()=>{zN();iH7={type:"local",name:"stickers",description:"Order Claude Code stickers",isEnabled:()=>!0,isHidden:!1,supportsNonInteractive:!1,async call(){if(await i7("https://www.stickermule.com/claudecode"))return{type:"text",value:"Opening sticker page in browser…"};else return{type:"text",value:"Failed to open browser. Visit: https://www.stickermule.com/claudecode"}},userFacingName(){return"stickers"}},FF9=iH7});var ez1=()=>{};var PT0;var EF9=w(()=>{kA();KY();j4();U9();ez1();PT0=c(JA(),1)});var ST0;var zF9=w(()=>{kA();U9();ez1();VC();e1();ST0=c(JA(),1)});var xT0;var yT0=w(()=>{kA();U9();xG();zKA();Cf();Z0();xT0=c(JA(),1)});var oH7;var CF9=w(()=>{ez1();oH7=c(JA(),1)});var vT0;var $F9=w(()=>{q0();uB();Z0();EF9();zF9();yT0();CF9();vT0=c(JA(),1)});var UF9;var qF9=w(()=>{kA();KY();j4();U9();QfA();UF9=c(JA(),1)});var kT0;var NF9=w(()=>{kA();U9();QfA();VC();e1();kT0=c(JA(),1)});var eH7;var wF9=w(()=>{QfA();eH7=c(JA(),1)});var bT0;var LF9=w(()=>{q0();uB();Z0();qF9();NF9();yT0();wF9();bT0=c(JA(),1)});function MF9(A){let Q={type:"prompt",name:A.name,description:A.description,hasUserSpecifiedDescription:!0,allowedTools:A.allowedTools??[],argumentHint:A.argumentHint,whenToUse:A.whenToUse,model:A.model,disableModelInvocation:A.disableModelInvocation??!1,userInvocable:A.userInvocable??!0,contentLength:0,source:"bundled",loadedFrom:"bundled",hooks:A.hooks,context:A.context,agent:A.agent,isEnabled:()=>!0,isHidden:!(A.userInvocable??!0),progressMessage:"running",userFacingName:()=>A.name,getPromptForCommand:A.getPromptForCommand};OF9.push(Q)}function RF9(){return[...OF9]}var OF9;var fT0=w(()=>{OF9=[]});import{join as AE7}from"path";function _F9({content:A,defaultFilename:Q,onDone:B}){let[,G]=T7.useState(null),[Z,Y]=T7.useState(Q),[J,X]=T7.useState(Q.length),[I,W]=T7.useState(!1),D=_Q(),K=T7.useCallback(()=>{if(I)W(!1),G(null);else B({success:!1,message:"Export cancelled"})},[I,B]);return A2("confirm:no",K,{context:"Confirmation"}),T7.default.createElement(T,{width:"100%",flexDirection:"column"},T7.default.createElement(T,{borderStyle:"round",borderColor:"permission",flexDirection:"column",padding:1,width:"100%"},T7.default.createElement(T,null,T7.default.createElement($,{color:"permission",bold:!0},"Export Conversation")),!I?T7.default.createElement(T7.default.Fragment,null,T7.default.createElement(T,{marginTop:1},T7.default.createElement($,{dimColor:!0},"Select export method:")),T7.default.createElement(T,{flexDirection:"column",marginTop:1},T7.default.createElement(x0,{options:[{label:"Copy to clipboard",value:"clipboard",description:"Copy the conversation to your system clipboard"},{label:"Save to file",value:"file",description:"Save the conversation to a file in the current directory"}],onChange:async(E)=>{if(E==="clipboard")if(await sp(A))B({success:!0,message:"Conversation copied to clipboard"});else B({success:!1,message:DgA()});else if(E==="file")G("file"),W(!0)},onCancel:()=>B({success:!1,message:"Export cancelled"})}))):T7.default.createElement(T,{flexDirection:"column",marginTop:1},T7.default.createElement($,null,"Enter filename:"),T7.default.createElement(T,{flexDirection:"row",gap:1,marginTop:1},T7.default.createElement($,null,">"),T7.default.createElement(d4,{value:Z,onChange:Y,onSubmit:()=>{let E=Z.endsWith(".txt")?Z:Z.replace(/\.[^.]+$/,"")+".txt",z=AE7(c1(),E);try{bB(z,A,{encoding:"utf-8",flush:!0}),B({success:!0,message:`Conversation exported to: ${E}`})}catch(C){B({success:!1,message:`Failed to export conversation: ${C instanceof Error?C.message:"Unknown error"}`})}},focus:!0,showCursor:!0,columns:process.stdout.columns||80,cursorOffset:J,onChangeCursorOffset:X})))),T7.default.createElement(T,{marginLeft:2},I?T7.default.createElement($,{dimColor:!0},T7.default.createElement(YB,null,T7.default.createElement(y0,{shortcut:"Enter",action:"save"}),T7.default.createElement(DB,{action:"confirm:no",context:"Confirmation",fallback:"Esc",description:"go back"}))):T7.default.createElement(T7.default.Fragment,null,D.pending?T7.default.createElement($,{dimColor:!0},"Press ",D.keyName," again to exit"):T7.default.createElement($,{dimColor:!0},T7.default.createElement(DB,{action:"confirm:no",context:"Confirmation",fallback:"Esc",description:"cancel"})))))}var T7;var jF9=w(()=>{kA();Q8();KY();U9();G2();e1();EzA();e4();Z5();T3();_6();T7=c(JA(),1)});async function TF9(A,Q=[]){return qzA(AC1.default.createElement(()=>AC1.default.createElement(_5,null,AC1.default.createElement(Qt,{messages:A,normalizedMessageHistory:[],tools:Q,commands:[],verbose:!1,toolJSX:null,toolUseConfirmQueue:[],inProgressToolUseIDs:new Set,isMessageSelectorVisible:!1,conversationId:"export",screen:"prompt",screenToggleId:0,streamingToolUses:[],showAllInTranscript:!0,isLoading:!1})),null))}var AC1;var hT0=w(()=>{EgA();rbA();uB();AC1=c(JA(),1)});import{join as QE7}from"path";function BE7(A){let Q=A.getFullYear(),B=String(A.getMonth()+1).padStart(2,"0"),G=String(A.getDate()).padStart(2,"0"),Z=String(A.getHours()).padStart(2,"0"),Y=String(A.getMinutes()).padStart(2,"0"),J=String(A.getSeconds()).padStart(2,"0");return`${Q}-${B}-${G}-${Z}${Y}${J}`}function GE7(A){let Q=A.find((Z)=>Z.type==="user");if(!Q||Q.type!=="user")return"";let B=Q.message?.content,G="";if(typeof B==="string")G=B.trim();else if(Array.isArray(B)){let Z=B.find((Y)=>Y.type==="text");if(Z&&"text"in Z)G=Z.text.trim()}if(G=G.split(`
`)[0]||"",G.length>50)G=G.substring(0,50)+"...";return G}function ZE7(A){return A.toLowerCase().replace(/[^a-z0-9\s-]/g,"").replace(/\s+/g,"-").replace(/-+/g,"-").replace(/^-|-$/g,"")}async function YE7(A){let Q=A.options.tools||[];return TF9(A.messages,Q)}var PF9,JE7,SF9;var xF9=w(()=>{jF9();hT0();G2();e1();QZ();PF9=c(JA(),1);JE7={type:"local-jsx",name:"export",description:"Export the current conversation to a file or clipboard",isEnabled:()=>!0,isHidden:!1,argumentHint:"[filename]",async call(A,Q,B){y9("export");let G=await YE7(Q);if(B.trim()){let X=B.trim(),I=X.endsWith(".txt")?X:X.replace(/\.[^.]+$/,"")+".txt",W=QE7(c1(),I);try{return bB(W,G,{encoding:"utf-8",flush:!0}),A(`Conversation exported to: ${I}`),null}catch(D){return A(`Failed to export conversation: ${D instanceof Error?D.message:"Unknown error"}`),null}}let Z=GE7(Q.messages),Y=BE7(new Date),J;if(Z){let X=ZE7(Z);J=X?`${Y.substring(0,10)}-${X}.txt`:`conversation-${Y}.txt`}else J=`conversation-${Y}.txt`;return PF9.default.createElement(_F9,{content:G,defaultFilename:J,onDone:(X)=>{A(X.message)}})},userFacingName(){return"export"}},SF9=JE7});function XE7({onDone:A}){let[{mainLoopModel:Q,mainLoopModelForSession:B},G]=e0();A2("confirm:no",()=>{p("tengu_model_command_menu",{action:"cancel"});let Y=Q??Fn().label;A(`Kept model as ${W1.bold(Y)}`,{display:"system"})},{context:"Confirmation"});function Z(Y,J){p("tengu_model_command_menu",{action:Y,from_model:Q,to_model:Y}),G((I)=>({...I,mainLoopModel:Y,mainLoopModelForSession:null}));let X=`Set model to ${W1.bold(vT(Y))}`;if(J!==void 0)X+=` with ${W1.bold(J)} effort`;A(X)}return Mx.createElement(sHA,{initial:Q,sessionModel:B,onSelect:Z,isStandaloneCommand:!0})}function IE7({args:A,onDone:Q}){let[B,G]=e0(),Z=A==="default"?null:A;return Mx.useEffect(()=>{async function Y(){if(Z&&DE7(Z)){let X=Iu()?"turn on /extra-usage or ":"";Q(`Your plan doesn't include Opus in Claude Code. You can ${X}/upgrade to Max to access it.`,{display:"system"});return}if(!Z){J(null);return}if(WE7(Z)){J(Z);return}try{let{valid:X,error:I}=await cC0(Z);if(X)J(Z);else Q(I||`Model '${Z}' not found`,{display:"system"})}catch(X){Q(`Failed to validate model: ${X.message}`,{display:"system"})}}function J(X){G((I)=>({...I,mainLoopModel:X,mainLoopModelForSession:null})),Q(`Set model to ${W1.bold(vT(X))}`)}Y()},[Z,Q,G]),null}function WE7(A){return DJA.includes(A.toLowerCase().trim())}function DE7(A){return OB()&&!DR()&&A.toLowerCase().includes("opus")}function KE7({onDone:A}){let[{mainLoopModel:Q,mainLoopModelForSession:B}]=e0(),G=Q??Fn().label,Z=o6A(),Y=Z!==void 0&&Z!=="unset"?` (effort: ${Z})`:"";if(B)A(`Current model: ${W1.bold(vT(B))} (session override from plan mode)