     1→#!/bin/bash
     2→# Multi-Agent Orchestrator - Coordinate specialist agents
     3→# Based on: ragapp AgentOrchestrator, mistralai agent patterns
     4→# Implements specialist swarm with task routing
     5→
     6→set -eo pipefail
     7→
     8→CLAUDE_DIR="${HOME}/.claude"
     9→AGENTS_DIR="${CLAUDE_DIR}/agents"
    10→LOG_FILE="${CLAUDE_DIR}/multi-agent-orchestrator.log"
    11→
    12→mkdir -p "$AGENTS_DIR"
    13→
    14→log() {
    15→    echo "[$(date '+%Y-%m-%d %H:%M:%S')] $1" >> "$LOG_FILE"
    16→}
    17→
    18→# Agent registry
    19→get_agent_registry() {
    20→    cat << 'EOF'
    21→{
    22→    "agents": {
    23→        "code_writer": {
    24→            "expertise": ["implementation", "coding", "refactoring"],
    25→            "description": "Focused on writing high-quality code",
    26→            "priority_for": ["implement", "code", "write", "refactor"]
    27→        },
    28→        "test_engineer": {
    29→            "expertise": ["testing", "validation", "quality_assurance"],
    30→            "description": "Focused on writing and running tests",
    31→            "priority_for": ["test", "validate", "check", "verify"]
    32→        },
    33→        "security_auditor": {
    34→            "expertise": ["security", "vulnerabilities", "auditing"],
    35→            "description": "Focused on finding security issues",
    36→            "priority_for": ["security", "vulnerability", "audit", "exploit"]
    37→        },
    38→        "performance_optimizer": {
    39→            "expertise": ["performance", "optimization", "profiling"],
    40→            "description": "Focused on improving performance",
    41→            "priority_for": ["performance", "optimize", "speed", "profile"]
    42→        },
    43→        "documentation_writer": {
    44→            "expertise": ["documentation", "explanations", "guides"],
    45→            "description": "Focused on creating clear documentation",
    46→            "priority_for": ["document", "explain", "guide", "readme"]
    47→        },
    48→        "debugger": {
    49→            "expertise": ["debugging", "troubleshooting", "root_cause"],
    50→            "description": "Focused on finding and fixing bugs",
    51→            "priority_for": ["debug", "fix", "bug", "error", "troubleshoot"]
    52→        }
    53→    }
    54→}
    55→EOF
    56→}
    57→
    58→# Route task to appropriate agent
    59→route_task() {
    60→    local task="$1"
    61→
    62→    log "Routing task: $task"
    63→
    64→    local registry
    65→    registry=$(get_agent_registry)
    66→
    67→    # Find best matching agent
    68→    local best_agent="code_writer"
    69→    local best_score=0
    70→
    71→    while IFS= read -r agent_name; do
    72→        local keywords
    73→        keywords=$(echo "$registry" | jq -r ".agents.$agent_name.priority_for[]" 2>/dev/null)
    74→
    75→        local score=0
    76→        while IFS= read -r keyword; do
    77→            if echo "$task" | grep -qi "$keyword"; then
    78→                score=$((score + 1))
    79→            fi
    80→        done <<< "$keywords"
    81→
    82→        if (( score > best_score )); then
    83→            best_score=$score
    84→            best_agent="$agent_name"
    85→        fi
    86→    done < <(echo "$registry" | jq -r '.agents | keys[]')
    87→
    88→    echo "$registry" | jq --arg agent "$best_agent" '{
    89→        selected_agent: $agent,
    90→        agent_info: .agents[$agent],
    91→        routing_confidence: (if '"$best_score"' > 0 then '"$best_score"' * 20 else 10 end)
    92→    }'
    93→}
    94→
    95→# Orchestrate multi-agent collaboration
    96→orchestrate() {
    97→    local task="$1"
    98→    local require_all="${2:-false}"
    99→
   100→    log "Orchestrating multi-agent task: $task"
   101→
   102→    cat << EOF
   103→{
   104→    "task": "$task",
   105→    "orchestration_strategy": "$(if [[ "$require_all" == "true" ]]; then echo "parallel_all"; else echo "sequential_specialists"; fi)",
   106→    "workflow": [
   107→        {
   108→            "phase": "planning",
   109→            "agents": ["code_writer"],
   110→            "action": "Break down task into subtasks"
   111→        },
   112→        {
   113→            "phase": "implementation",
   114→            "agents": ["code_writer", "debugger"],
   115→            "action": "Implement solution with error handling"
   116→        },
   117→        {
   118→            "phase": "validation",
   119→            "agents": ["test_engineer", "security_auditor"],
   120→            "action": "Run tests and security checks in parallel",
   121→            "parallel": true
   122→        },
   123→        {
   124→            "phase": "optimization",
   125→            "agents": ["performance_optimizer"],
   126→            "action": "Profile and optimize if needed",
   127→            "conditional": "if performance issues detected"
   128→        },
   129→        {
   130→            "phase": "documentation",
   131→            "agents": ["documentation_writer"],
   132→            "action": "Document completed feature"
   133→        }
   134→    ]
   135→}
   136→EOF
   137→}
   138→
   139→case "${1:-help}" in
   140→    route)
   141→        route_task "${2:-task}"
   142→        ;;
   143→    orchestrate)
   144→        orchestrate "${2:-task}" "${3:-false}"
   145→        ;;
   146→    agents)
   147→        get_agent_registry
   148→        ;;
   149→    help|*)
   150→        echo "Multi-Agent Orchestrator"
   151→        echo "Usage: $0 <command> [args]"
   152→        echo "  route <task>              - Route task to best agent"
   153→        echo "  orchestrate <task> [all]  - Coordinate multi-agent workflow"
   154→        echo "  agents                    - List available agents"
   155→        ;;
   156→esac
   157→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
