     1→"""
     2→Forum schemas for request/response validation
     3→"""
     4→
     5→from pydantic import BaseModel, Field
     6→from typing import Optional, List
     7→from datetime import datetime
     8→from uuid import UUID
     9→from enum import Enum
    10→
    11→
    12→# === ENUMS ===
    13→
    14→class VoteType(str, Enum):
    15→    UP = "up"
    16→    DOWN = "down"
    17→
    18→
    19→class TargetType(str, Enum):
    20→    POST = "post"
    21→    COMMENT = "comment"
    22→
    23→
    24→class ReportReason(str, Enum):
    25→    SPAM = "spam"
    26→    HARASSMENT = "harassment"
    27→    MISINFORMATION = "misinformation"
    28→    OFF_TOPIC = "off_topic"
    29→    INAPPROPRIATE = "inappropriate"
    30→    OTHER = "other"
    31→
    32→
    33→class SortOrder(str, Enum):
    34→    HOT = "hot"  # vote_count DESC, recent bias
    35→    NEW = "new"  # created_at DESC
    36→    TOP = "top"  # vote_count DESC
    37→
    38→
    39→# === SUB-FORUM SCHEMAS ===
    40→
    41→class SubForumResponse(BaseModel):
    42→    id: UUID
    43→    name: str
    44→    slug: str
    45→    description: Optional[str]
    46→    icon: Optional[str]
    47→    display_order: int
    48→    post_count: int = 0
    49→
    50→    class Config:
    51→        from_attributes = True
    52→
    53→
    54→# === CATEGORY SCHEMAS ===
    55→
    56→class CategoryResponse(BaseModel):
    57→    id: UUID
    58→    name: str
    59→    slug: str
    60→    description: Optional[str]
    61→    icon: Optional[str]
    62→    display_order: int
    63→    post_count: int = 0
    64→    sub_forums: List[SubForumResponse] = []
    65→
    66→    class Config:
    67→        from_attributes = True
    68→
    69→
    70→class CategoryListResponse(BaseModel):
    71→    id: UUID
    72→    name: str
    73→    slug: str
    74→    description: Optional[str]
    75→    icon: Optional[str]
    76→    display_order: int
    77→    post_count: int = 0
    78→
    79→    class Config:
    80→        from_attributes = True
    81→
    82→
    83→# === POST SCHEMAS ===
    84→
    85→class PostCreate(BaseModel):
    86→    title: str = Field(..., min_length=5, max_length=200)
    87→    content: str = Field(..., min_length=10, max_length=10000)
    88→    sub_forum_id: UUID
    89→
    90→
    91→class PostUpdate(BaseModel):
    92→    title: Optional[str] = Field(None, min_length=5, max_length=200)
    93→    content: Optional[str] = Field(None, min_length=10, max_length=10000)
    94→
    95→
    96→class PostAuthor(BaseModel):
    97→    id: UUID
    98→    username: str
    99→
   100→    class Config:
   101→        from_attributes = True
   102→
   103→
   104→class PostResponse(BaseModel):
   105→    id: UUID
   106→    title: str
   107→    content: str
   108→    sub_forum_id: UUID
   109→    sub_forum_slug: str
   110→    category_slug: str
   111→    author: PostAuthor
   112→    is_pinned: bool
   113→    is_guide: bool
   114→    vote_count: int
   115→    comment_count: int
   116→    user_vote: Optional[VoteType] = None  # Current user's vote
   117→    created_at: datetime
   118→    updated_at: datetime
   119→
   120→    class Config:
   121→        from_attributes = True
   122→
   123→
   124→class PostListItem(BaseModel):
   125→    """Lighter version for list views"""
   126→    id: UUID
   127→    title: str
   128→    content_preview: str  # First 200 chars
   129→    sub_forum_slug: str
   130→    category_slug: str
   131→    author: PostAuthor
   132→    is_pinned: bool
   133→    is_guide: bool
   134→    vote_count: int
   135→    comment_count: int
   136→    user_vote: Optional[VoteType] = None
   137→    created_at: datetime
   138→
   139→    class Config:
   140→        from_attributes = True
   141→
   142→
   143→class PostListResponse(BaseModel):
   144→    posts: List[PostListItem]
   145→    total_count: int
   146→    has_more: bool
   147→
   148→
   149→# === COMMENT SCHEMAS ===
   150→
   151→class CommentCreate(BaseModel):
   152→    content: str = Field(..., min_length=1, max_length=5000)
   153→    parent_id: Optional[UUID] = None
   154→
   155→
   156→class CommentUpdate(BaseModel):
   157→    content: str = Field(..., min_length=1, max_length=5000)
   158→
   159→
   160→class CommentResponse(BaseModel):
   161→    id: UUID
   162→    content: str
   163→    post_id: UUID
   164→    author: PostAuthor
   165→    parent_id: Optional[UUID]
   166→    vote_count: int
   167→    user_vote: Optional[VoteType] = None
   168→    depth: int
   169→    replies: List["CommentResponse"] = []
   170→    created_at: datetime
   171→    updated_at: datetime
   172→
   173→    class Config:
   174→        from_attributes = True
   175→
   176→
   177→# Needed for self-referential model
   178→CommentResponse.model_rebuild()
   179→
   180→
   181→# === VOTE SCHEMAS ===
   182→
   183→class VoteRequest(BaseModel):
   184→    vote_type: VoteType
   185→
   186→
   187→class VoteResponse(BaseModel):
   188→    success: bool
   189→    new_vote_count: int
   190→    user_vote: Optional[VoteType]
   191→
   192→
   193→# === REPORT SCHEMAS ===
   194→
   195→class ReportCreate(BaseModel):
   196→    target_type: TargetType
   197→    target_id: UUID
   198→    reason: ReportReason
   199→    details: Optional[str] = Field(None, max_length=1000)
   200→
   201→
   202→class ReportResponse(BaseModel):
   203→    id: UUID
   204→    target_type: TargetType
   205→    target_id: UUID
   206→    reason: ReportReason
   207→    status: str
   208→    created_at: datetime
   209→
   210→    class Config:
   211→        from_attributes = True
   212→
   213→
   214→# === GUIDE SECTION ===
   215→
   216→class GuideSectionResponse(BaseModel):
   217→    """Guides grouped by category for the top section"""
   218→    category: CategoryListResponse
   219→    guides: List[PostListItem]
   220→
   221→
   222→# === RECOMMENDED FORUMS ===
   223→
   224→class RecommendedForumResponse(BaseModel):
   225→    """Forums recommended based on user's detected flaws"""
   226→    category: CategoryListResponse
   227→    matched_flaws: List[str]  # Which flaws matched this category
   228→    priority: int  # 1 = primary, 2 = secondary
   229→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
