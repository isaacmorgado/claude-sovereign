{"parentUuid":null,"isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":"Implement confidence levels (confirmed/likely/possible) for flaw detection.\n\n**Key files to modify:**\n- `looksmaxx-app/src/lib/insights-engine.ts` - Add confidence calculation\n- `looksmaxx-app/src/lib/scoring/types.ts` - Add ConfidenceLevel type\n- `looksmaxx-app/src/types/results.ts` - Update InsightResult type\n\n**Reference FaceIQ logic from:**\n- `/Users/imorgado/LOOKSMAXX/FACEIQPAID/LOGIC/logic_report.md`\n- `/Users/imorgado/LOOKSMAXX/FACEIQPAID/b4ddc3c6-8702-4c39-8400-b68071bf91d6/faceiq_spec.md`\n\n**Implementation:**\n1. Add type: `ConfidenceLevel = 'confirmed' | 'likely' | 'possible'`\n2. Calculate confidence based on:\n   - Z-score magnitude: |z| >= 2 = confirmed, 1-2 = likely, 0.5-1 = possible\n   - Measurement quality/consistency\n3. Add `confidence` field to InsightResult/flaw objects\n4. Update UI components that display flaws to show confidence badge\n\nWrite the code. Do NOT just plan - actually implement it."},"uuid":"457bae31-719b-4ef9-84b0-6cfeb559d993","timestamp":"2025-12-26T14:49:42.181Z"}
{"parentUuid":"457bae31-719b-4ef9-84b0-6cfeb559d993","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01G1FyRjLbADBpMVpNCUuH5h","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017gbnkLtGxGKMpnsvH2wF4s","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/FACEIQPAID/LOGIC/logic_report.md"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":26722,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":26722,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWVV3gxtCB6yY1yEjMLyM","type":"assistant","uuid":"903b9527-76bd-4361-9e43-de350840b904","timestamp":"2025-12-26T14:49:53.105Z"}
{"parentUuid":"903b9527-76bd-4361-9e43-de350840b904","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01G1FyRjLbADBpMVpNCUuH5h","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011bemhVM3noqWufLMevNm9E","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/FACEIQPAID/b4ddc3c6-8702-4c39-8400-b68071bf91d6/faceiq_spec.md"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":26722,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":26722,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWVV3gxtCB6yY1yEjMLyM","type":"assistant","uuid":"d99d028b-9f16-4b4e-8a8c-ee81a91c4582","timestamp":"2025-12-26T14:49:54.066Z"}
{"parentUuid":"d99d028b-9f16-4b4e-8a8c-ee81a91c4582","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01G1FyRjLbADBpMVpNCUuH5h","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PAsJVuPSVgEPaA7hL7b3Rh","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":26722,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":26722,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWVV3gxtCB6yY1yEjMLyM","type":"assistant","uuid":"b7dfea53-5d73-4aea-96cf-20dc4ac5dc25","timestamp":"2025-12-26T14:49:54.797Z"}
{"parentUuid":"b7dfea53-5d73-4aea-96cf-20dc4ac5dc25","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01G1FyRjLbADBpMVpNCUuH5h","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017be16PEzB9kbHUKs3iquUZ","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring/types.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":26722,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":26722,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWVV3gxtCB6yY1yEjMLyM","type":"assistant","uuid":"037daa42-ba49-4259-8223-5044e2e6ae8b","timestamp":"2025-12-26T14:49:55.474Z"}
{"parentUuid":"037daa42-ba49-4259-8223-5044e2e6ae8b","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01G1FyRjLbADBpMVpNCUuH5h","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01B6G8e5u5TZYe6J8vcfN25z","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/types/results.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":26722,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":26722,"ephemeral_1h_input_tokens":0},"output_tokens":358,"service_tier":"standard"}},"requestId":"req_011CWVV3gxtCB6yY1yEjMLyM","type":"assistant","uuid":"6b6f9f32-50a4-48f4-a03c-521cea60b31f","timestamp":"2025-12-26T14:49:56.096Z"}
{"parentUuid":"6b6f9f32-50a4-48f4-a03c-521cea60b31f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011bemhVM3noqWufLMevNm9E","type":"tool_result","content":"     1→# FaceIQ Implementation Specification\n     2→\n     3→## 1. Core measurements & Inputs\n     4→### Landmarks\n     5→The system uses MediaPipe Face Landmarker. Key landmarks required for specific ratios:\n     6→*   **Glabella**: Midpoint between eyebrows.\n     7→*   **Subnasale**: Base of the nose.\n     8→*   **Pogonion**: Most forward point of the chin.\n     9→*   **Nasion**: Root of the nose.\n    10→*   (Full list to be populated)\n    11→\n    12→### Full Ratio & Landmark Definitions\n    13→(Extracted from client source code `j2.js`)\n    14→\n    15→| Ratio Name | Input Landmarks |\n    16→| :--- | :--- |\n    17→| **Facial Convexity (Glabella)** | `glabella`, `pogonion`, `subnasale` |\n    18→| **Facial Convexity (Nasion)** | `nasion`, `pogonion`, `subnasale` |\n    19→| **Total Facial Convexity** | `glabella`, `pogonion`, `pronasale` |\n    20→| **Nasolabial Angle** | `columella`, `labraleSuperius`, `subnasale` |\n    21→| **Nasomental Angle** | `nasion`, `pogonion`, `pronasale` |\n    22→| **Gonial Angle** | `gonionBottom`, `gonionTop`, `intertragicNotch`, `menton` |\n    23→| **Z Angle** | `labraleSuperius`, `orbitale`, `pogonion`, `porion` |\n    24→| **Chin to Philtrum Ratio** | `chinBottom`, `cupidsBow`, `lowerLip`, `nasalBase` |\n    25→| **Upper Lip E-Line Position** | `labraleSuperius`, `menton`, `pogonion`, `pronasale`, `trichion` |\n    26→| **Lower Lip E-Line Position** | `labraleInferius`, `menton`, `pogonion`, `pronasale`, `trichion` |\n    27→| **Nasal Projection** | `nasion`, `pronasale`, `rhinion`, `subalare` |\n    28→| **Eye Protrusion** | `cornealApex`, `lowerEyelid`, `menton`, `trichion` |\n    29→| **Orbital Vector** | `cornealApex`, `menton`, `orbitale`, `trichion` |\n    30→| **Browridge Inclination Angle** | `glabella`, `trichion` |\n    31→\n    32→## 2. Scoring Standards (The \"Ideals\")\n    33→Extracted from server configuration. These values are hardcoded benchmarks.\n    34→\n    35→### Ideal Ranges Table\n    36→| Metric | Ideal Min | Ideal Max | Unit |\n    37→| :--- | :--- | :--- | :--- |\n    38→| **Facial Convexity (Glabella)** | 169 | 174 | Degrees |\n    39→| **Nasolabial Angle** | 99 | 116 | Degrees |\n    40→| **Gonial Angle** | 115 | 121 | Degrees |\n    41→| **Z Angle** | 78 | 82 | Degrees |\n    42→\n    43→## 3. Recommendation Engine (\"The Plan\")\n    44→**Mechanism**: Hardcoded Client-Side Flaw Detection -> Server-Side Treatment Retrieval.\n    45→The system defines \"Flaws\" as rulesets in the client code (`j2.js`).\n    46→\n    47→### Flaw Detection Rules\n    48→*   **Narrow Jaw**\n    49→    *   **Trigger**: `Bigonial width` < `idealMin`\n    50→    *   **Description**: \"The jaw is too slim, creating a delicate or less robust lower face appearance.\"\n    51→*   **Overly wide or bloated jaw**\n    52→    *   **Trigger**: `Bigonial width` > `idealMax`\n    53→    *   **Description**: \"The jaw appears excessively broad, often due to muscle bulk or fat.\"\n    54→*   **Recessed Chin** (Inferred)\n    55→    *   **Trigger**: `Nasomental Angle` < `idealMin`\n    56→\n    57→### Treatment Mapping (Logic Only)\n    58→The system uses a **Retrieval Architecture**.\n    59→1.  **Client-Side**: Detects Flaw (e.g., \"Narrow Jaw\").\n    60→2.  **Lookup**: Maps Flaw to Treatment IDs (e.g., `[\"SUR-17\", \"NST-05\"]`).\n    61→3.  **Server-Side**: Fetches content for `SUR-17` (Title, Description, Timeline).\n    62→\n    63→*Note: The actual content database (e.g., \"SUR-17\" = \"Jaw Implants\") is not in the client code and wasn't captured in the session, confirming it is securely hosted on the server and fetched only when needed.*\n    64→\n    65→### Known mappings (from `j2.js`)\n    66→*   **Narrow Jaw** -> `[\"SUR-17\", \"SUR-07\", \"SUR-34\", \"NST-05\", \"SUR-09\", \"SUR-20\"]`\n    67→*   **Recessed Chin** -> `[\"SUR-07\", \"SUR-20\", \"SUR-09\"]`\n    68→\n    69→\n    70→## 4. Integration Logic\n    71→```javascript\n    72→// 1. Calculate Ratio\n    73→const ratioValue = calculateRatio(landmarks); // e.g., 105 degrees\n    74→\n    75→// 2. Score & Deviate\n    76→const idealMin = 115, idealMax = 121;\n    77→if (ratioValue < idealMin) {\n    78→   score = decay(ratioValue, idealMin); \n    79→   deviation = \"belowIdeal\";\n    80→}\n    81→\n    82→// 3. Trigger Flaw\n    83→const flaws = [];\n    84→if (deviation === \"belowIdeal\" && ratioName === \"Gonial Angle\") {\n    85→   flaws.push(\"steep_jaw\"); // Internal ID\n    86→}\n    87→\n    88→// 4. Get Plan\n    89→const plan = flaws.map(flaw => database.getTreatments(flaw));\n    90→```\n    91→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"46c14434-d3b8-4b2f-a78c-85d2f58cd4a0","timestamp":"2025-12-26T14:49:56.162Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/FACEIQPAID/b4ddc3c6-8702-4c39-8400-b68071bf91d6/faceiq_spec.md","content":"# FaceIQ Implementation Specification\n\n## 1. Core measurements & Inputs\n### Landmarks\nThe system uses MediaPipe Face Landmarker. Key landmarks required for specific ratios:\n*   **Glabella**: Midpoint between eyebrows.\n*   **Subnasale**: Base of the nose.\n*   **Pogonion**: Most forward point of the chin.\n*   **Nasion**: Root of the nose.\n*   (Full list to be populated)\n\n### Full Ratio & Landmark Definitions\n(Extracted from client source code `j2.js`)\n\n| Ratio Name | Input Landmarks |\n| :--- | :--- |\n| **Facial Convexity (Glabella)** | `glabella`, `pogonion`, `subnasale` |\n| **Facial Convexity (Nasion)** | `nasion`, `pogonion`, `subnasale` |\n| **Total Facial Convexity** | `glabella`, `pogonion`, `pronasale` |\n| **Nasolabial Angle** | `columella`, `labraleSuperius`, `subnasale` |\n| **Nasomental Angle** | `nasion`, `pogonion`, `pronasale` |\n| **Gonial Angle** | `gonionBottom`, `gonionTop`, `intertragicNotch`, `menton` |\n| **Z Angle** | `labraleSuperius`, `orbitale`, `pogonion`, `porion` |\n| **Chin to Philtrum Ratio** | `chinBottom`, `cupidsBow`, `lowerLip`, `nasalBase` |\n| **Upper Lip E-Line Position** | `labraleSuperius`, `menton`, `pogonion`, `pronasale`, `trichion` |\n| **Lower Lip E-Line Position** | `labraleInferius`, `menton`, `pogonion`, `pronasale`, `trichion` |\n| **Nasal Projection** | `nasion`, `pronasale`, `rhinion`, `subalare` |\n| **Eye Protrusion** | `cornealApex`, `lowerEyelid`, `menton`, `trichion` |\n| **Orbital Vector** | `cornealApex`, `menton`, `orbitale`, `trichion` |\n| **Browridge Inclination Angle** | `glabella`, `trichion` |\n\n## 2. Scoring Standards (The \"Ideals\")\nExtracted from server configuration. These values are hardcoded benchmarks.\n\n### Ideal Ranges Table\n| Metric | Ideal Min | Ideal Max | Unit |\n| :--- | :--- | :--- | :--- |\n| **Facial Convexity (Glabella)** | 169 | 174 | Degrees |\n| **Nasolabial Angle** | 99 | 116 | Degrees |\n| **Gonial Angle** | 115 | 121 | Degrees |\n| **Z Angle** | 78 | 82 | Degrees |\n\n## 3. Recommendation Engine (\"The Plan\")\n**Mechanism**: Hardcoded Client-Side Flaw Detection -> Server-Side Treatment Retrieval.\nThe system defines \"Flaws\" as rulesets in the client code (`j2.js`).\n\n### Flaw Detection Rules\n*   **Narrow Jaw**\n    *   **Trigger**: `Bigonial width` < `idealMin`\n    *   **Description**: \"The jaw is too slim, creating a delicate or less robust lower face appearance.\"\n*   **Overly wide or bloated jaw**\n    *   **Trigger**: `Bigonial width` > `idealMax`\n    *   **Description**: \"The jaw appears excessively broad, often due to muscle bulk or fat.\"\n*   **Recessed Chin** (Inferred)\n    *   **Trigger**: `Nasomental Angle` < `idealMin`\n\n### Treatment Mapping (Logic Only)\nThe system uses a **Retrieval Architecture**.\n1.  **Client-Side**: Detects Flaw (e.g., \"Narrow Jaw\").\n2.  **Lookup**: Maps Flaw to Treatment IDs (e.g., `[\"SUR-17\", \"NST-05\"]`).\n3.  **Server-Side**: Fetches content for `SUR-17` (Title, Description, Timeline).\n\n*Note: The actual content database (e.g., \"SUR-17\" = \"Jaw Implants\") is not in the client code and wasn't captured in the session, confirming it is securely hosted on the server and fetched only when needed.*\n\n### Known mappings (from `j2.js`)\n*   **Narrow Jaw** -> `[\"SUR-17\", \"SUR-07\", \"SUR-34\", \"NST-05\", \"SUR-09\", \"SUR-20\"]`\n*   **Recessed Chin** -> `[\"SUR-07\", \"SUR-20\", \"SUR-09\"]`\n\n\n## 4. Integration Logic\n```javascript\n// 1. Calculate Ratio\nconst ratioValue = calculateRatio(landmarks); // e.g., 105 degrees\n\n// 2. Score & Deviate\nconst idealMin = 115, idealMax = 121;\nif (ratioValue < idealMin) {\n   score = decay(ratioValue, idealMin); \n   deviation = \"belowIdeal\";\n}\n\n// 3. Trigger Flaw\nconst flaws = [];\nif (deviation === \"belowIdeal\" && ratioName === \"Gonial Angle\") {\n   flaws.push(\"steep_jaw\"); // Internal ID\n}\n\n// 4. Get Plan\nconst plan = flaws.map(flaw => database.getTreatments(flaw));\n```\n","numLines":91,"startLine":1,"totalLines":91}}}
{"parentUuid":"46c14434-d3b8-4b2f-a78c-85d2f58cd4a0","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017be16PEzB9kbHUKs3iquUZ","type":"tool_result","content":"     1→/**\n     2→ * Scoring System Type Definitions\n     3→ * Extracted from harmony-scoring.ts for better modularity\n     4→ */\n     5→\n     6→// Re-export LandmarkPoint from landmarks module\n     7→export type { LandmarkPoint } from '@/lib/landmarks';\n     8→\n     9→// ============================================\n    10→// CORE TYPES\n    11→// ============================================\n    12→\n    13→export interface Point {\n    14→  x: number;\n    15→  y: number;\n    16→}\n    17→\n    18→export type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\n    19→export type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\n    20→export type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n    21→\n    22→/**\n    23→ * Polarity defines how deviation from the ideal range is interpreted:\n    24→ * - 'balanced': Default. Deviation in either direction is equally bad.\n    25→ * - 'higher_is_better': Values above the ideal are still good. Only values below\n    26→ *   the 'safeFloor' are true weaknesses. E.g., Canthal Tilt (positive tilt is good)\n    27→ * - 'lower_is_better': Values below the ideal are still good. Only values above\n    28→ *   the 'safeCeiling' are true weaknesses. E.g., Philtrum length (shorter is better)\n    29→ */\n    30→export type MetricPolarity = 'balanced' | 'higher_is_better' | 'lower_is_better';\n    31→\n    32→export interface MetricConfig {\n    33→  id: string;\n    34→  name: string;\n    35→  category: string;\n    36→  unit: MeasurementUnit;\n    37→  idealMin: number;\n    38→  idealMax: number;\n    39→  rangeMin: number;\n    40→  rangeMax: number;\n    41→  decayRate: number;\n    42→  maxScore: number;\n    43→  weight: number;\n    44→  description: string;\n    45→  profileType: 'front' | 'side';\n    46→  customCurve?: BezierCurveConfig;\n    47→  /**\n    48→   * Polarity for directional/dimorphic scoring.\n    49→   * Defaults to 'balanced' if not specified.\n    50→   */\n    51→  polarity?: MetricPolarity;\n    52→  /**\n    53→   * For 'higher_is_better': minimum value that's still acceptable.\n    54→   * Values above this but below idealMin get a passing score (softFloorScore).\n    55→   * Values below this are true weaknesses.\n    56→   */\n    57→  safeFloor?: number;\n    58→  /**\n    59→   * For 'lower_is_better': maximum value that's still acceptable.\n    60→   * Values below this but above idealMax get a passing score (softCeilingScore).\n    61→   * Values above this are true weaknesses.\n    62→   */\n    63→  safeCeiling?: number;\n    64→  /**\n    65→   * Score given to values in the \"acceptable but not ideal\" zone.\n    66→   * Defaults to 8.0 (Good). Range: 6.0-9.0\n    67→   */\n    68→  softZoneScore?: number;\n    69→}\n    70→\n    71→export interface BezierCurveConfig {\n    72→  mode: 'custom' | 'exponential';\n    73→  points: CurvePoint[];\n    74→}\n    75→\n    76→export interface CurvePoint {\n    77→  x: number;\n    78→  y: number;\n    79→  leftHandleX?: number;\n    80→  leftHandleY?: number;\n    81→  rightHandleX?: number;\n    82→  rightHandleY?: number;\n    83→  fixed?: boolean;\n    84→}\n    85→\n    86→export interface MetricScoreResult {\n    87→  metricId: string;\n    88→  name: string;\n    89→  value: number;\n    90→  score: number;  // 0-10 scale\n    91→  standardizedScore: number;\n    92→  qualityTier: QualityTier;\n    93→  severity: SeverityLevel;\n    94→  idealMin: number;\n    95→  idealMax: number;\n    96→  deviation: number;\n    97→  deviationDirection: 'above' | 'below' | 'within';\n    98→  unit: MeasurementUnit;\n    99→  category: string;\n   100→  percentile?: number;\n   101→}\n   102→\n   103→export interface HarmonyAnalysis {\n   104→  overallScore: number;  // 0-10 scale\n   105→  standardizedScore: number;\n   106→  qualityTier: QualityTier;\n   107→  percentile: number;\n   108→  frontScore: number;\n   109→  sideScore: number;\n   110→  categoryScores: Record<string, number>;\n   111→  measurements: MetricScoreResult[];\n   112→  flaws: FlawAssessment[];\n   113→  strengths: StrengthAssessment[];\n   114→}\n   115→\n   116→export interface FlawAssessment {\n   117→  category: string;\n   118→  metricId: string;\n   119→  metricName: string;\n   120→  severity: SeverityLevel;\n   121→  deviation: string;\n   122→  reasoning: string;\n   123→  confidence: 'confirmed' | 'likely' | 'possible';\n   124→}\n   125→\n   126→export interface StrengthAssessment {\n   127→  category: string;\n   128→  metricId: string;\n   129→  metricName: string;\n   130→  qualityTier: QualityTier;\n   131→  value: number;\n   132→  reasoning: string;\n   133→}\n   134→\n   135→// ============================================\n   136→// DEMOGRAPHIC TYPES\n   137→// ============================================\n   138→\n   139→export type Ethnicity =\n   140→  | 'east_asian'\n   141→  | 'south_asian'\n   142→  | 'black'\n   143→  | 'hispanic'\n   144→  | 'middle_eastern'\n   145→  | 'native_american'\n   146→  | 'pacific_islander'\n   147→  | 'white'\n   148→  | 'other';\n   149→\n   150→export type Gender = 'male' | 'female';\n   151→\n   152→export type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n   153→\n   154→export interface DemographicOverride {\n   155→  idealMin: number;\n   156→  idealMax: number;\n   157→}\n   158→\n   159→export interface DemographicOptions {\n   160→  gender?: Gender;\n   161→  ethnicity?: Ethnicity;\n   162→}\n   163→\n   164→// ============================================\n   165→// FLAW MAPPING TYPES\n   166→// ============================================\n   167→\n   168→export interface FlawMapping {\n   169→  category: string;\n   170→  flawName: string;\n   171→  confidence: 'confirmed' | 'likely' | 'possible';\n   172→  reasoning: string;\n   173→}\n   174→\n   175→// ============================================\n   176→// PROFILE RESULT TYPES\n   177→// ============================================\n   178→\n   179→export interface FrontProfileResults {\n   180→  measurements: MetricScoreResult[];\n   181→  overallScore: number;\n   182→  standardizedScore: number;\n   183→  qualityTier: QualityTier;\n   184→  categoryScores: Record<string, number>;\n   185→}\n   186→\n   187→export interface SideProfileResults {\n   188→  measurements: MetricScoreResult[];\n   189→  overallScore: number;\n   190→  standardizedScore: number;\n   191→  qualityTier: QualityTier;\n   192→  categoryScores: Record<string, number>;\n   193→}\n   194→\n   195→// ============================================\n   196→// PSL RATING TYPES\n   197→// ============================================\n   198→\n   199→export interface PSLRating {\n   200→  score: number;\n   201→  tier: string;\n   202→  percentile: number;\n   203→  description: string;\n   204→}\n   205→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"b1eadec1-6147-4ce1-b974-8b189f3a7fdf","timestamp":"2025-12-26T14:49:56.162Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring/types.ts","content":"/**\n * Scoring System Type Definitions\n * Extracted from harmony-scoring.ts for better modularity\n */\n\n// Re-export LandmarkPoint from landmarks module\nexport type { LandmarkPoint } from '@/lib/landmarks';\n\n// ============================================\n// CORE TYPES\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\n/**\n * Polarity defines how deviation from the ideal range is interpreted:\n * - 'balanced': Default. Deviation in either direction is equally bad.\n * - 'higher_is_better': Values above the ideal are still good. Only values below\n *   the 'safeFloor' are true weaknesses. E.g., Canthal Tilt (positive tilt is good)\n * - 'lower_is_better': Values below the ideal are still good. Only values above\n *   the 'safeCeiling' are true weaknesses. E.g., Philtrum length (shorter is better)\n */\nexport type MetricPolarity = 'balanced' | 'higher_is_better' | 'lower_is_better';\n\nexport interface MetricConfig {\n  id: string;\n  name: string;\n  category: string;\n  unit: MeasurementUnit;\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  decayRate: number;\n  maxScore: number;\n  weight: number;\n  description: string;\n  profileType: 'front' | 'side';\n  customCurve?: BezierCurveConfig;\n  /**\n   * Polarity for directional/dimorphic scoring.\n   * Defaults to 'balanced' if not specified.\n   */\n  polarity?: MetricPolarity;\n  /**\n   * For 'higher_is_better': minimum value that's still acceptable.\n   * Values above this but below idealMin get a passing score (softFloorScore).\n   * Values below this are true weaknesses.\n   */\n  safeFloor?: number;\n  /**\n   * For 'lower_is_better': maximum value that's still acceptable.\n   * Values below this but above idealMax get a passing score (softCeilingScore).\n   * Values above this are true weaknesses.\n   */\n  safeCeiling?: number;\n  /**\n   * Score given to values in the \"acceptable but not ideal\" zone.\n   * Defaults to 8.0 (Good). Range: 6.0-9.0\n   */\n  softZoneScore?: number;\n}\n\nexport interface BezierCurveConfig {\n  mode: 'custom' | 'exponential';\n  points: CurvePoint[];\n}\n\nexport interface CurvePoint {\n  x: number;\n  y: number;\n  leftHandleX?: number;\n  leftHandleY?: number;\n  rightHandleX?: number;\n  rightHandleY?: number;\n  fixed?: boolean;\n}\n\nexport interface MetricScoreResult {\n  metricId: string;\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  severity: SeverityLevel;\n  idealMin: number;\n  idealMax: number;\n  deviation: number;\n  deviationDirection: 'above' | 'below' | 'within';\n  unit: MeasurementUnit;\n  category: string;\n  percentile?: number;\n}\n\nexport interface HarmonyAnalysis {\n  overallScore: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  percentile: number;\n  frontScore: number;\n  sideScore: number;\n  categoryScores: Record<string, number>;\n  measurements: MetricScoreResult[];\n  flaws: FlawAssessment[];\n  strengths: StrengthAssessment[];\n}\n\nexport interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n}\n\nexport interface StrengthAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  qualityTier: QualityTier;\n  value: number;\n  reasoning: string;\n}\n\n// ============================================\n// DEMOGRAPHIC TYPES\n// ============================================\n\nexport type Ethnicity =\n  | 'east_asian'\n  | 'south_asian'\n  | 'black'\n  | 'hispanic'\n  | 'middle_eastern'\n  | 'native_american'\n  | 'pacific_islander'\n  | 'white'\n  | 'other';\n\nexport type Gender = 'male' | 'female';\n\nexport type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n\nexport interface DemographicOverride {\n  idealMin: number;\n  idealMax: number;\n}\n\nexport interface DemographicOptions {\n  gender?: Gender;\n  ethnicity?: Ethnicity;\n}\n\n// ============================================\n// FLAW MAPPING TYPES\n// ============================================\n\nexport interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n  reasoning: string;\n}\n\n// ============================================\n// PROFILE RESULT TYPES\n// ============================================\n\nexport interface FrontProfileResults {\n  measurements: MetricScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\nexport interface SideProfileResults {\n  measurements: MetricScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n// ============================================\n// PSL RATING TYPES\n// ============================================\n\nexport interface PSLRating {\n  score: number;\n  tier: string;\n  percentile: number;\n  description: string;\n}\n","numLines":205,"startLine":1,"totalLines":205}}}
{"parentUuid":"b1eadec1-6147-4ce1-b974-8b189f3a7fdf","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01B6G8e5u5TZYe6J8vcfN25z","type":"tool_result","content":"     1→/**\n     2→ * Harmony-Style Results Page Types\n     3→ * Complete type definitions for the results UI\n     4→ */\n     5→\n     6→import { QualityTier, SeverityLevel, MeasurementUnit } from '@/lib/harmony-scoring';\n     7→\n     8→// ============================================\n     9→// ILLUSTRATION TYPES\n    10→// ============================================\n    11→\n    12→export interface IllustrationPoint {\n    13→  type: 'landmark' | 'calculated';\n    14→  landmarkId?: string;\n    15→  x?: number;\n    16→  y?: number;\n    17→  label?: string;\n    18→}\n    19→\n    20→export interface IllustrationLine {\n    21→  from: string;\n    22→  to: string;\n    23→  color: string;\n    24→  style?: 'solid' | 'dashed';\n    25→  label?: string;\n    26→  labelColor?: string;\n    27→  labelPosition?: 'start' | 'middle' | 'end';\n    28→}\n    29→\n    30→export interface RatioIllustration {\n    31→  points: Record<string, IllustrationPoint>;\n    32→  lines: Record<string, IllustrationLine>;\n    33→}\n    34→\n    35→// ============================================\n    36→// RATIO/MEASUREMENT TYPES\n    37→// ============================================\n    38→\n    39→export interface Ratio {\n    40→  id: string;\n    41→  name: string;\n    42→  value: number | string;\n    43→  score: number | string;  // 0-10 scale or Greek text\n    44→  standardizedScore: number | string;\n    45→  unit: 'x' | 'mm' | '%' | '°';\n    46→  idealMin: number;\n    47→  idealMax: number;\n    48→  rangeMin: number;\n    49→  rangeMax: number;\n    50→  description: string;\n    51→  category: string;\n    52→  qualityLevel: QualityTier;\n    53→  severity: SeverityLevel;\n    54→  illustration: RatioIllustration;\n    55→  mayIndicateFlaws: string[];\n    56→  mayIndicateStrengths: string[];\n    57→  usedLandmarks: string[];\n    58→  scoringCurveConfig?: {\n    59→    decayRate: number;\n    60→    maxScore: number;\n    61→  };\n    62→  // Harmony Taxonomy classification\n    63→  taxonomyPrimary?: string;    // 'harmony' | 'dimorphism' | 'angularity' | 'features'\n    64→  taxonomySecondary?: string;  // Subcategory ID\n    65→}\n    66→\n    67→// ============================================\n    68→// STRENGTH/FLAW TYPES\n    69→// ============================================\n    70→\n    71→export interface ResponsibleRatio {\n    72→  ratioName: string;\n    73→  ratioId: string;\n    74→  score: number | string;\n    75→  value: number | string;\n    76→  isObfuscated?: boolean;\n    77→  // Additional properties for AI descriptions\n    78→  idealMin: number;\n    79→  idealMax: number;\n    80→  unit: string;\n    81→  category?: string;\n    82→}\n    83→\n    84→export interface Strength {\n    85→  id: string;\n    86→  strengthName: string;\n    87→  summary: string;\n    88→  avgScore: number | string;\n    89→  qualityLevel: QualityTier;\n    90→  categoryName: string;\n    91→  responsibleRatios: ResponsibleRatio[];\n    92→}\n    93→\n    94→export interface Flaw {\n    95→  id: string;\n    96→  flawName: string;\n    97→  summary: string;\n    98→  harmonyPercentageLost: number;\n    99→  standardizedImpact: number;\n   100→  categoryName: string;\n   101→  isOther?: boolean;\n   102→  responsibleRatios: ResponsibleRatio[];\n   103→  rollingPointsDeducted?: number;\n   104→  rollingHarmonyPercentageLost?: number;\n   105→  rollingStandardizedImpact?: number;\n   106→}\n   107→\n   108→// ============================================\n   109→// RECOMMENDATION TYPES\n   110→// ============================================\n   111→\n   112→export type RecommendationPhase = 'Surgical' | 'Minimally Invasive' | 'Foundational';\n   113→\n   114→export interface RecommendationTimeline {\n   115→  effect_start: 'immediate' | 'delayed' | 'gradual';\n   116→  full_results_weeks: number;\n   117→  full_results_weeks_max?: number;\n   118→}\n   119→\n   120→export interface RecommendationCost {\n   121→  type: 'flat' | 'per_month' | 'per_session';\n   122→  min: number;\n   123→  max: number;\n   124→  currency: string;\n   125→}\n   126→\n   127→export interface RatioImpact {\n   128→  ratioId: string;\n   129→  ratioName: string;\n   130→  direction: 'increase' | 'decrease' | 'both';\n   131→  percentageEffect: number;\n   132→}\n   133→\n   134→export interface Recommendation {\n   135→  ref_id: string;\n   136→  name: string;\n   137→  description: string;\n   138→  phase: RecommendationPhase;\n   139→  impact: number;  // 0-1 effectiveness score\n   140→  coverage: number;  // Number of metrics improved\n   141→  percentage: string;  // e.g., \"10-20%\"\n   142→  expectedImprovementRange?: { min: number; max: number };\n   143→  matchedFlaws: string[];\n   144→  matchedRatios: string[];\n   145→  ratios_impacted: RatioImpact[];\n   146→  timeline: RecommendationTimeline;\n   147→  cost: RecommendationCost;\n   148→  risks_side_effects: string | null;\n   149→  warnings: string[];\n   150→  gender: 'male' | 'female' | 'both';\n   151→}\n   152→\n   153→// ============================================\n   154→// HARMONY ANALYSIS TYPES\n   155→// ============================================\n   156→\n   157→export interface ProfileAnalysis {\n   158→  standardizedScore: number;\n   159→  ratios: Ratio[];\n   160→  overallAIDescription?: string | null;\n   161→}\n   162→\n   163→export interface FullHarmonyAnalysis {\n   164→  standardizedScore: number;\n   165→  front: ProfileAnalysis;\n   166→  side: ProfileAnalysis;\n   167→  strengths: Strength[];\n   168→  flaws: Flaw[];\n   169→}\n   170→\n   171→// ============================================\n   172→// FACE DATA TYPES\n   173→// ============================================\n   174→\n   175→export interface FaceData {\n   176→  id: string;\n   177→  userId?: string;\n   178→  frontPhotoUrl: string;\n   179→  sidePhotoUrl?: string;\n   180→  harmonyScore: number | null;\n   181→  frontHarmonyScore: number | null;\n   182→  sideHarmonyScore: number | null;\n   183→  gender: 'male' | 'female';\n   184→  race?: string;\n   185→  unlocked: boolean;\n   186→  actionPlanUnlocked: boolean;\n   187→  harmonyAnalysis: FullHarmonyAnalysis;\n   188→}\n   189→\n   190→// ============================================\n   191→// UI STATE TYPES\n   192→// ============================================\n   193→\n   194→export type ResultsTab =\n   195→  | 'overview'\n   196→  | 'front-ratios'\n   197→  | 'side-ratios'\n   198→  | 'leaderboard'\n   199→  | 'psl'\n   200→  | 'archetype'\n   201→  | 'plan'\n   202→  | 'guides'\n   203→  | 'community'\n   204→  | 'referrals'\n   205→  | 'options'\n   206→  | 'support';\n   207→\n   208→// ============================================\n   209→// LEADERBOARD TYPES\n   210→// ============================================\n   211→\n   212→export interface UserRank {\n   213→  userId: string;\n   214→  score: number;\n   215→  globalRank: number;\n   216→  genderRank: number;\n   217→  percentile: number;\n   218→  totalUsers: number;\n   219→  genderTotal: number;\n   220→  anonymousName: string;\n   221→  updatedAt: string;\n   222→}\n   223→\n   224→export interface LeaderboardEntry {\n   225→  userId: string;\n   226→  rank: number;\n   227→  score: number;\n   228→  anonymousName: string;\n   229→  gender: 'male' | 'female';\n   230→  facePhotoUrl: string | null;\n   231→  isCurrentUser: boolean;\n   232→  topStrengths: string[];\n   233→  topImprovements: string[];\n   234→}\n   235→\n   236→export interface UserProfile extends Omit<LeaderboardEntry, 'isCurrentUser'> {\n   237→  topStrengths: string[];\n   238→  topImprovements: string[];\n   239→}\n   240→\n   241→export interface LeaderboardData {\n   242→  entries: LeaderboardEntry[];\n   243→  totalCount: number;\n   244→  userRank: UserRank | null;\n   245→}\n   246→\n   247→export interface ResultsUIState {\n   248→  activeTab: ResultsTab;\n   249→  expandedMeasurementId: string | null;\n   250→  selectedVisualizationMetric: string | null;\n   251→  categoryFilter: string | null;\n   252→  showLandmarkOverlay: boolean;\n   253→}\n   254→\n   255→// ============================================\n   256→// CATEGORY TYPES\n   257→// ============================================\n   258→\n   259→export interface MeasurementCategory {\n   260→  id: string;\n   261→  name: string;\n   262→  color: string;\n   263→  description: string;\n   264→}\n   265→\n   266→export const MEASUREMENT_CATEGORIES: MeasurementCategory[] = [\n   267→  { id: 'midface', name: 'Midface/Face Shape', color: '#67e8f9', description: 'Facial proportions and overall shape' },\n   268→  { id: 'jaw-growth', name: 'Occlusion/Jaw Growth', color: '#a78bfa', description: 'Jaw development and bite alignment' },\n   269→  { id: 'jaw-shape', name: 'Jaw Shape', color: '#f97316', description: 'Jawline contour and angles' },\n   270→  { id: 'upper-third', name: 'Upper Third', color: '#84cc16', description: 'Forehead and hairline proportions' },\n   271→  { id: 'eyes', name: 'Eyes', color: '#06b6d4', description: 'Eye shape, spacing, and canthal tilt' },\n   272→  { id: 'nose', name: 'Nose', color: '#fbbf24', description: 'Nasal proportions and angles' },\n   273→  { id: 'lips', name: 'Lips', color: '#ec4899', description: 'Lip proportions and projection' },\n   274→  { id: 'chin', name: 'Chin', color: '#ef4444', description: 'Chin projection and shape' },\n   275→  { id: 'neck', name: 'Neck', color: '#14b8a6', description: 'Neck angle and throat definition' },\n   276→  { id: 'other', name: 'Other', color: '#6b7280', description: 'Additional measurements' },\n   277→];\n   278→\n   279→// ============================================\n   280→// SCORE COLOR HELPERS\n   281→// ============================================\n   282→\n   283→export function getScoreColor(score: number): string {\n   284→  if (score >= 8) return '#67e8f9';  // Cyan - ideal\n   285→  if (score >= 6) return '#22c55e';  // Green - good\n   286→  if (score >= 4) return '#fbbf24';  // Yellow - fair\n   287→  return 'rgb(227, 67, 67)';         // Red - poor\n   288→}\n   289→\n   290→export function getQualityColor(quality: QualityTier): string {\n   291→  switch (quality) {\n   292→    case 'ideal': return '#67e8f9';\n   293→    case 'excellent': return '#22c55e';\n   294→    case 'good': return '#fbbf24';\n   295→    case 'below_average': return 'rgb(227, 67, 67)';\n   296→    default: return '#6b7280';\n   297→  }\n   298→}\n   299→\n   300→export function getSeverityColor(severity: SeverityLevel): string {\n   301→  switch (severity) {\n   302→    case 'optimal': return '#67e8f9';\n   303→    case 'minor': return '#22c55e';\n   304→    case 'moderate': return '#fbbf24';\n   305→    case 'major': return '#f97316';\n   306→    case 'severe': return '#ef4444';\n   307→    case 'extremely_severe': return '#dc2626';\n   308→    default: return '#6b7280';\n   309→  }\n   310→}\n   311→\n   312→export function getCategoryColor(categoryName: string): string {\n   313→  const cat = MEASUREMENT_CATEGORIES.find(c =>\n   314→    c.name.toLowerCase().includes(categoryName.toLowerCase()) ||\n   315→    categoryName.toLowerCase().includes(c.name.toLowerCase())\n   316→  );\n   317→  return cat?.color || '#6b7280';\n   318→}\n   319→\n   320→// ============================================\n   321→// UNIT FORMATTING\n   322→// ============================================\n   323→\n   324→export function formatUnit(unit: 'x' | 'mm' | '%' | '°' | MeasurementUnit): string {\n   325→  switch (unit) {\n   326→    case 'x':\n   327→    case 'ratio': return 'x';\n   328→    case 'mm': return 'mm';\n   329→    case '%':\n   330→    case 'percent': return '%';\n   331→    case '°':\n   332→    case 'degrees': return '°';\n   333→    default: return '';\n   334→  }\n   335→}\n   336→\n   337→export function formatValue(value: number | string, unit: 'x' | 'mm' | '%' | '°' | MeasurementUnit): string {\n   338→  // Handle obfuscated string values\n   339→  if (typeof value === 'string') {\n   340→    return value;\n   341→  }\n   342→  const unitStr = formatUnit(unit);\n   343→  if (unit === '%' || unit === 'percent') {\n   344→    return `${value.toFixed(1)}${unitStr}`;\n   345→  }\n   346→  if (unit === '°' || unit === 'degrees') {\n   347→    return `${value.toFixed(1)}${unitStr}`;\n   348→  }\n   349→  return `${value.toFixed(2)}${unitStr}`;\n   350→}\n   351→\n   352→// ============================================\n   353→// PRODUCT & SUPPLEMENT TYPES\n   354→// ============================================\n   355→\n   356→export interface Product {\n   357→  id: string;\n   358→  name: string;\n   359→  brand: string;\n   360→  category: \"skin\" | \"hair\" | \"anti-aging\" | \"hormonal\" | \"bone\" | \"general\" | \"jawline\" | \"tools\" | \"dental\";\n   361→  affiliateLink: string;\n   362→  affiliateType: \"amazon\" | \"direct\";\n   363→  supplementId: string;\n   364→  priority: number;\n   365→  baseStackItem?: boolean;\n   366→  description?: string;\n   367→}\n   368→\n   369→export interface ProductRecommendation {\n   370→  product: Product;\n   371→  state: \"flaw\" | \"ideal\";\n   372→  targetMetric: string;\n   373→  message: string;\n   374→  urgency: \"high\" | \"medium\" | \"low\";\n   375→  matchedMetrics: string[];\n   376→}\n   377→\n   378→export interface DailyStack {\n   379→  products: Product[];\n   380→  totalCostPerMonth: { min: number; max: number };\n   381→  timing: {\n   382→    morning: Product[];\n   383→    evening: Product[];\n   384→    anytime: Product[];\n   385→  };\n   386→  rationale: string;\n   387→}\n   388→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"9de507b7-7993-4495-a36c-de9eabcacdae","timestamp":"2025-12-26T14:49:56.162Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/types/results.ts","content":"/**\n * Harmony-Style Results Page Types\n * Complete type definitions for the results UI\n */\n\nimport { QualityTier, SeverityLevel, MeasurementUnit } from '@/lib/harmony-scoring';\n\n// ============================================\n// ILLUSTRATION TYPES\n// ============================================\n\nexport interface IllustrationPoint {\n  type: 'landmark' | 'calculated';\n  landmarkId?: string;\n  x?: number;\n  y?: number;\n  label?: string;\n}\n\nexport interface IllustrationLine {\n  from: string;\n  to: string;\n  color: string;\n  style?: 'solid' | 'dashed';\n  label?: string;\n  labelColor?: string;\n  labelPosition?: 'start' | 'middle' | 'end';\n}\n\nexport interface RatioIllustration {\n  points: Record<string, IllustrationPoint>;\n  lines: Record<string, IllustrationLine>;\n}\n\n// ============================================\n// RATIO/MEASUREMENT TYPES\n// ============================================\n\nexport interface Ratio {\n  id: string;\n  name: string;\n  value: number | string;\n  score: number | string;  // 0-10 scale or Greek text\n  standardizedScore: number | string;\n  unit: 'x' | 'mm' | '%' | '°';\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  description: string;\n  category: string;\n  qualityLevel: QualityTier;\n  severity: SeverityLevel;\n  illustration: RatioIllustration;\n  mayIndicateFlaws: string[];\n  mayIndicateStrengths: string[];\n  usedLandmarks: string[];\n  scoringCurveConfig?: {\n    decayRate: number;\n    maxScore: number;\n  };\n  // Harmony Taxonomy classification\n  taxonomyPrimary?: string;    // 'harmony' | 'dimorphism' | 'angularity' | 'features'\n  taxonomySecondary?: string;  // Subcategory ID\n}\n\n// ============================================\n// STRENGTH/FLAW TYPES\n// ============================================\n\nexport interface ResponsibleRatio {\n  ratioName: string;\n  ratioId: string;\n  score: number | string;\n  value: number | string;\n  isObfuscated?: boolean;\n  // Additional properties for AI descriptions\n  idealMin: number;\n  idealMax: number;\n  unit: string;\n  category?: string;\n}\n\nexport interface Strength {\n  id: string;\n  strengthName: string;\n  summary: string;\n  avgScore: number | string;\n  qualityLevel: QualityTier;\n  categoryName: string;\n  responsibleRatios: ResponsibleRatio[];\n}\n\nexport interface Flaw {\n  id: string;\n  flawName: string;\n  summary: string;\n  harmonyPercentageLost: number;\n  standardizedImpact: number;\n  categoryName: string;\n  isOther?: boolean;\n  responsibleRatios: ResponsibleRatio[];\n  rollingPointsDeducted?: number;\n  rollingHarmonyPercentageLost?: number;\n  rollingStandardizedImpact?: number;\n}\n\n// ============================================\n// RECOMMENDATION TYPES\n// ============================================\n\nexport type RecommendationPhase = 'Surgical' | 'Minimally Invasive' | 'Foundational';\n\nexport interface RecommendationTimeline {\n  effect_start: 'immediate' | 'delayed' | 'gradual';\n  full_results_weeks: number;\n  full_results_weeks_max?: number;\n}\n\nexport interface RecommendationCost {\n  type: 'flat' | 'per_month' | 'per_session';\n  min: number;\n  max: number;\n  currency: string;\n}\n\nexport interface RatioImpact {\n  ratioId: string;\n  ratioName: string;\n  direction: 'increase' | 'decrease' | 'both';\n  percentageEffect: number;\n}\n\nexport interface Recommendation {\n  ref_id: string;\n  name: string;\n  description: string;\n  phase: RecommendationPhase;\n  impact: number;  // 0-1 effectiveness score\n  coverage: number;  // Number of metrics improved\n  percentage: string;  // e.g., \"10-20%\"\n  expectedImprovementRange?: { min: number; max: number };\n  matchedFlaws: string[];\n  matchedRatios: string[];\n  ratios_impacted: RatioImpact[];\n  timeline: RecommendationTimeline;\n  cost: RecommendationCost;\n  risks_side_effects: string | null;\n  warnings: string[];\n  gender: 'male' | 'female' | 'both';\n}\n\n// ============================================\n// HARMONY ANALYSIS TYPES\n// ============================================\n\nexport interface ProfileAnalysis {\n  standardizedScore: number;\n  ratios: Ratio[];\n  overallAIDescription?: string | null;\n}\n\nexport interface FullHarmonyAnalysis {\n  standardizedScore: number;\n  front: ProfileAnalysis;\n  side: ProfileAnalysis;\n  strengths: Strength[];\n  flaws: Flaw[];\n}\n\n// ============================================\n// FACE DATA TYPES\n// ============================================\n\nexport interface FaceData {\n  id: string;\n  userId?: string;\n  frontPhotoUrl: string;\n  sidePhotoUrl?: string;\n  harmonyScore: number | null;\n  frontHarmonyScore: number | null;\n  sideHarmonyScore: number | null;\n  gender: 'male' | 'female';\n  race?: string;\n  unlocked: boolean;\n  actionPlanUnlocked: boolean;\n  harmonyAnalysis: FullHarmonyAnalysis;\n}\n\n// ============================================\n// UI STATE TYPES\n// ============================================\n\nexport type ResultsTab =\n  | 'overview'\n  | 'front-ratios'\n  | 'side-ratios'\n  | 'leaderboard'\n  | 'psl'\n  | 'archetype'\n  | 'plan'\n  | 'guides'\n  | 'community'\n  | 'referrals'\n  | 'options'\n  | 'support';\n\n// ============================================\n// LEADERBOARD TYPES\n// ============================================\n\nexport interface UserRank {\n  userId: string;\n  score: number;\n  globalRank: number;\n  genderRank: number;\n  percentile: number;\n  totalUsers: number;\n  genderTotal: number;\n  anonymousName: string;\n  updatedAt: string;\n}\n\nexport interface LeaderboardEntry {\n  userId: string;\n  rank: number;\n  score: number;\n  anonymousName: string;\n  gender: 'male' | 'female';\n  facePhotoUrl: string | null;\n  isCurrentUser: boolean;\n  topStrengths: string[];\n  topImprovements: string[];\n}\n\nexport interface UserProfile extends Omit<LeaderboardEntry, 'isCurrentUser'> {\n  topStrengths: string[];\n  topImprovements: string[];\n}\n\nexport interface LeaderboardData {\n  entries: LeaderboardEntry[];\n  totalCount: number;\n  userRank: UserRank | null;\n}\n\nexport interface ResultsUIState {\n  activeTab: ResultsTab;\n  expandedMeasurementId: string | null;\n  selectedVisualizationMetric: string | null;\n  categoryFilter: string | null;\n  showLandmarkOverlay: boolean;\n}\n\n// ============================================\n// CATEGORY TYPES\n// ============================================\n\nexport interface MeasurementCategory {\n  id: string;\n  name: string;\n  color: string;\n  description: string;\n}\n\nexport const MEASUREMENT_CATEGORIES: MeasurementCategory[] = [\n  { id: 'midface', name: 'Midface/Face Shape', color: '#67e8f9', description: 'Facial proportions and overall shape' },\n  { id: 'jaw-growth', name: 'Occlusion/Jaw Growth', color: '#a78bfa', description: 'Jaw development and bite alignment' },\n  { id: 'jaw-shape', name: 'Jaw Shape', color: '#f97316', description: 'Jawline contour and angles' },\n  { id: 'upper-third', name: 'Upper Third', color: '#84cc16', description: 'Forehead and hairline proportions' },\n  { id: 'eyes', name: 'Eyes', color: '#06b6d4', description: 'Eye shape, spacing, and canthal tilt' },\n  { id: 'nose', name: 'Nose', color: '#fbbf24', description: 'Nasal proportions and angles' },\n  { id: 'lips', name: 'Lips', color: '#ec4899', description: 'Lip proportions and projection' },\n  { id: 'chin', name: 'Chin', color: '#ef4444', description: 'Chin projection and shape' },\n  { id: 'neck', name: 'Neck', color: '#14b8a6', description: 'Neck angle and throat definition' },\n  { id: 'other', name: 'Other', color: '#6b7280', description: 'Additional measurements' },\n];\n\n// ============================================\n// SCORE COLOR HELPERS\n// ============================================\n\nexport function getScoreColor(score: number): string {\n  if (score >= 8) return '#67e8f9';  // Cyan - ideal\n  if (score >= 6) return '#22c55e';  // Green - good\n  if (score >= 4) return '#fbbf24';  // Yellow - fair\n  return 'rgb(227, 67, 67)';         // Red - poor\n}\n\nexport function getQualityColor(quality: QualityTier): string {\n  switch (quality) {\n    case 'ideal': return '#67e8f9';\n    case 'excellent': return '#22c55e';\n    case 'good': return '#fbbf24';\n    case 'below_average': return 'rgb(227, 67, 67)';\n    default: return '#6b7280';\n  }\n}\n\nexport function getSeverityColor(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'optimal': return '#67e8f9';\n    case 'minor': return '#22c55e';\n    case 'moderate': return '#fbbf24';\n    case 'major': return '#f97316';\n    case 'severe': return '#ef4444';\n    case 'extremely_severe': return '#dc2626';\n    default: return '#6b7280';\n  }\n}\n\nexport function getCategoryColor(categoryName: string): string {\n  const cat = MEASUREMENT_CATEGORIES.find(c =>\n    c.name.toLowerCase().includes(categoryName.toLowerCase()) ||\n    categoryName.toLowerCase().includes(c.name.toLowerCase())\n  );\n  return cat?.color || '#6b7280';\n}\n\n// ============================================\n// UNIT FORMATTING\n// ============================================\n\nexport function formatUnit(unit: 'x' | 'mm' | '%' | '°' | MeasurementUnit): string {\n  switch (unit) {\n    case 'x':\n    case 'ratio': return 'x';\n    case 'mm': return 'mm';\n    case '%':\n    case 'percent': return '%';\n    case '°':\n    case 'degrees': return '°';\n    default: return '';\n  }\n}\n\nexport function formatValue(value: number | string, unit: 'x' | 'mm' | '%' | '°' | MeasurementUnit): string {\n  // Handle obfuscated string values\n  if (typeof value === 'string') {\n    return value;\n  }\n  const unitStr = formatUnit(unit);\n  if (unit === '%' || unit === 'percent') {\n    return `${value.toFixed(1)}${unitStr}`;\n  }\n  if (unit === '°' || unit === 'degrees') {\n    return `${value.toFixed(1)}${unitStr}`;\n  }\n  return `${value.toFixed(2)}${unitStr}`;\n}\n\n// ============================================\n// PRODUCT & SUPPLEMENT TYPES\n// ============================================\n\nexport interface Product {\n  id: string;\n  name: string;\n  brand: string;\n  category: \"skin\" | \"hair\" | \"anti-aging\" | \"hormonal\" | \"bone\" | \"general\" | \"jawline\" | \"tools\" | \"dental\";\n  affiliateLink: string;\n  affiliateType: \"amazon\" | \"direct\";\n  supplementId: string;\n  priority: number;\n  baseStackItem?: boolean;\n  description?: string;\n}\n\nexport interface ProductRecommendation {\n  product: Product;\n  state: \"flaw\" | \"ideal\";\n  targetMetric: string;\n  message: string;\n  urgency: \"high\" | \"medium\" | \"low\";\n  matchedMetrics: string[];\n}\n\nexport interface DailyStack {\n  products: Product[];\n  totalCostPerMonth: { min: number; max: number };\n  timing: {\n    morning: Product[];\n    evening: Product[];\n    anytime: Product[];\n  };\n  rationale: string;\n}\n","numLines":388,"startLine":1,"totalLines":388}}}
{"parentUuid":"9de507b7-7993-4495-a36c-de9eabcacdae","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PAsJVuPSVgEPaA7hL7b3Rh","type":"tool_result","content":"     1→/**\n     2→ * Insights Engine\n     3→ *\n     4→ * Processes insight definitions from insights.json and classifies them\n     5→ * as strengths or areas of improvement based on user's metric scores.\n     6→ *\n     7→ * Logic:\n     8→ * - For each insight definition, calculate average score of affected metrics\n     9→ * - Weakness: if avg score < threshold → classify with severity label\n    10→ * - Strength: if avg score > threshold → classify with grade label\n    11→ *\n    12→ * Z-Score Based 5-Tier Severity Logic:\n    13→ * - Ideal (Green): User is inside the ideal range\n    14→ * - Good (Blue): Within 0.5 Standard Deviation of the mean (|z| < 0.5)\n    15→ * - Fair (Cyan): Between 0.5 and 1 Standard Deviation (0.5 ≤ |z| < 1)\n    16→ * - Moderate (Yellow): Between 1 and 2 Standard Deviations (1 ≤ |z| < 2)\n    17→ * - Severe (Red): More than 2 Standard Deviations away (|z| ≥ 2)\n    18→ *\n    19→ * Severity Labels (Weaknesses):\n    20→ *   0-3 = \"Severe\"\n    21→ *   3-5 = \"Moderate\"\n    22→ *   5-7 = \"Minor\"\n    23→ *\n    24→ * Grade Labels (Strengths):\n    25→ *   8-9   = \"Good\"\n    26→ *   9-9.5 = \"Excellent\"\n    27→ *   9.5-10 = \"Ideal\"\n    28→ */\n    29→\n    30→import { Strength, Flaw } from '@/types/results';\n    31→import { MetricScoreResult, METRIC_CONFIGS, isValueAcceptable } from '@/lib/harmony-scoring';\n    32→\n    33→// ============================================\n    34→// MASTER SCORING DATABASE (Z-Score Based)\n    35→// ============================================\n    36→\n    37→export type SeverityLevel = 'ideal' | 'good' | 'fair' | 'moderate' | 'severe';\n    38→export type Gender = 'male' | 'female';\n    39→export type Ethnicity = 'white' | 'black' | 'east_asian' | 'south_asian' | 'hispanic' | 'middle_eastern' | 'native_american' | 'pacific_islander';\n    40→\n    41→export interface MasterMetricConfig {\n    42→  ideal: [number, number];  // [min, max] ideal range\n    43→  mean: number;             // Population mean\n    44→  std_dev: number;          // Standard deviation\n    45→  flaws?: {\n    46→    low?: string[];         // Flaws when value is too low\n    47→    high?: string[];        // Flaws when value is too high\n    48→  };\n    49→}\n    50→\n    51→// Base/Default standards (White Male baseline)\n    52→export const MASTER_SCORING_DB: Record<string, MasterMetricConfig> = {\n    53→  // MIDFACE & PROPORTIONS\n    54→  \"midface_ratio\": {\n    55→    ideal: [0.97, 1.00],\n    56→    mean: 1.0,\n    57→    std_dev: 0.115,\n    58→    flaws: { low: [\"Long midface\", \"Long upper jaw\"] }\n    59→  },\n    60→  \"faceWidthToHeight\": {\n    61→    ideal: [1.30, 1.45],\n    62→    mean: 1.38,\n    63→    std_dev: 0.08,\n    64→    flaws: {\n    65→      low: [\"Overly long face\", \"Narrow face\"],\n    66→      high: [\"Wide face\", \"Short face\"]\n    67→    }\n    68→  },\n    69→  \"totalFacialWidthToHeight\": {\n    70→    ideal: [1.25, 1.40],\n    71→    mean: 1.33,\n    72→    std_dev: 0.075,\n    73→    flaws: {\n    74→      low: [\"Long face shape\"],\n    75→      high: [\"Wide face shape\"]\n    76→    }\n    77→  },\n    78→  \"upperThirdProportion\": {\n    79→    ideal: [0.30, 0.36],\n    80→    mean: 0.33,\n    81→    std_dev: 0.03,\n    82→    flaws: {\n    83→      low: [\"Short forehead\"],\n    84→      high: [\"Long forehead\"]\n    85→    }\n    86→  },\n    87→  \"middleThirdProportion\": {\n    88→    ideal: [0.30, 0.36],\n    89→    mean: 0.33,\n    90→    std_dev: 0.03,\n    91→    flaws: {\n    92→      low: [\"Short midface\"],\n    93→      high: [\"Long midface\"]\n    94→    }\n    95→  },\n    96→  \"lowerThirdProportion\": {\n    97→    ideal: [0.30, 0.36],\n    98→    mean: 0.33,\n    99→    std_dev: 0.03,\n   100→    flaws: {\n   101→      low: [\"Short lower face\"],\n   102→      high: [\"Long lower face\"]\n   103→    }\n   104→  },\n   105→\n   106→  // EYE SPACING & IPD\n   107→  \"eye_separation_ratio\": {\n   108→    ideal: [0.45, 0.47],\n   109→    mean: 0.46,\n   110→    std_dev: 0.03,\n   111→    flaws: {\n   112→      low: [\"Close-set eyes\"],\n   113→      high: [\"Wide-set eyes\"]\n   114→    }\n   115→  },\n   116→  \"interpupillaryRatio\": {\n   117→    ideal: [0.44, 0.48],\n   118→    mean: 0.46,\n   119→    std_dev: 0.025,\n   120→    flaws: {\n   121→      low: [\"Close-set eyes\"],\n   122→      high: [\"Wide-set eyes\"]\n   123→    }\n   124→  },\n   125→  \"oneEyeApartTest\": {\n   126→    ideal: [0.95, 1.05],\n   127→    mean: 1.0,\n   128→    std_dev: 0.08,\n   129→    flaws: {\n   130→      low: [\"Close-set eyes\"],\n   131→      high: [\"Wide-set eyes\"]\n   132→    }\n   133→  },\n   134→  \"intercanthalWidth\": {\n   135→    ideal: [30, 35],\n   136→    mean: 32.5,\n   137→    std_dev: 2.5,\n   138→    flaws: {\n   139→      low: [\"Narrow eye spacing\"],\n   140→      high: [\"Wide eye spacing\"]\n   141→    }\n   142→  },\n   143→\n   144→  // EYE SHAPE & FEATURES\n   145→  \"lateralCanthalTilt\": {\n   146→    ideal: [6, 8],\n   147→    mean: 5.0,\n   148→    std_dev: 3.5,\n   149→    flaws: {\n   150→      low: [\"Negative canthal tilt\", \"Downturned eyes\"],\n   151→      high: [\"Excessively upturned eyes\"]\n   152→    }\n   153→  },\n   154→  \"eyeAspectRatio\": {\n   155→    ideal: [0.30, 0.35],\n   156→    mean: 0.32,\n   157→    std_dev: 0.04,\n   158→    flaws: {\n   159→      low: [\"Narrow eyes\"],\n   160→      high: [\"Round eyes\"]\n   161→    }\n   162→  },\n   163→  \"palpebralFissureLength\": {\n   164→    ideal: [28, 32],\n   165→    mean: 30.0,\n   166→    std_dev: 2.5,\n   167→    flaws: {\n   168→      low: [\"Small eyes\"],\n   169→      high: [\"Large eyes\"]\n   170→    }\n   171→  },\n   172→  \"eyeWidth\": {\n   173→    ideal: [28, 32],\n   174→    mean: 30.0,\n   175→    std_dev: 2.0,\n   176→    flaws: {\n   177→      low: [\"Narrow eyes\"],\n   178→      high: [\"Wide eyes\"]\n   179→    }\n   180→  },\n   181→  \"upperEyelidExposure\": {\n   182→    ideal: [0.5, 1.2],\n   183→    mean: 0.85,\n   184→    std_dev: 0.35,\n   185→    flaws: {\n   186→      low: [\"Hooded eyes\"],\n   187→      high: [\"Excessive upper lid exposure\"]\n   188→    }\n   189→  },\n   190→  \"tearTroughDepth\": {\n   191→    ideal: [0.0, 0.3],\n   192→    mean: 0.15,\n   193→    std_dev: 0.15,\n   194→    flaws: {\n   195→      high: [\"Dark circles / Tear troughs\", \"Under-eye hollowness\"]\n   196→    }\n   197→  },\n   198→\n   199→  // JAW ANGLES & STRUCTURE\n   200→  \"gonial_angle\": {\n   201→    ideal: [115, 125],\n   202→    mean: 118.0,\n   203→    std_dev: 6.5,\n   204→    flaws: {\n   205→      high: [\"Weak/soft jaw structure\", \"Rounded jaw\"]\n   206→    }\n   207→  },\n   208→  \"mandibularPlaneAngle\": {\n   209→    ideal: [20, 28],\n   210→    mean: 24.0,\n   211→    std_dev: 4.0,\n   212→    flaws: {\n   213→      low: [\"Flat mandibular plane\"],\n   214→      high: [\"Steep mandibular plane\", \"Hyper-divergent jaw\"]\n   215→    }\n   216→  },\n   217→  \"jawFrontalAngle\": {\n   218→    ideal: [125, 135],\n   219→    mean: 130.0,\n   220→    std_dev: 5.0,\n   221→    flaws: {\n   222→      low: [\"Steep jaw\"],\n   223→      high: [\"Flat jaw angle\"]\n   224→    }\n   225→  },\n   226→  \"jawSlope\": {\n   227→    ideal: [25, 35],\n   228→    mean: 30.0,\n   229→    std_dev: 5.0,\n   230→    flaws: {\n   231→      low: [\"Flat jawline\"],\n   232→      high: [\"Steep jawline\"]\n   233→    }\n   234→  },\n   235→\n   236→  // JAW WIDTH\n   237→  \"jawWidthRatio\": {\n   238→    ideal: [0.85, 0.95],\n   239→    mean: 0.90,\n   240→    std_dev: 0.05,\n   241→    flaws: {\n   242→      low: [\"Narrow jaw\"],\n   243→      high: [\"Wide jaw\"]\n   244→    }\n   245→  },\n   246→  \"bigonialWidth\": {\n   247→    ideal: [110, 125],\n   248→    mean: 117.5,\n   249→    std_dev: 7.5,\n   250→    flaws: {\n   251→      low: [\"Narrow jaw width\"],\n   252→      high: [\"Excessively wide jaw\"]\n   253→    }\n   254→  },\n   255→\n   256→  // CHEEKBONES\n   257→  \"cheekbone_height\": {\n   258→    ideal: [83.0, 100.0],\n   259→    mean: 85.0,\n   260→    std_dev: 5.0,\n   261→    flaws: {\n   262→      low: [\"Low-set cheekbones\", \"Flat midface\"]\n   263→    }\n   264→  },\n   265→  \"cheekboneWidth\": {\n   266→    ideal: [130, 145],\n   267→    mean: 137.5,\n   268→    std_dev: 7.5,\n   269→    flaws: {\n   270→      low: [\"Narrow cheekbones\"],\n   271→      high: [\"Wide cheekbones\"]\n   272→    }\n   273→  },\n   274→\n   275→  // CHIN\n   276→  \"chinPhiltrumRatio\": {\n   277→    ideal: [1.8, 2.2],\n   278→    mean: 2.0,\n   279→    std_dev: 0.2,\n   280→    flaws: {\n   281→      low: [\"Recessed chin\", \"Short chin\"],\n   282→      high: [\"Long chin\", \"Projected chin\"]\n   283→    }\n   284→  },\n   285→  \"chinHeight\": {\n   286→    ideal: [35, 45],\n   287→    mean: 40.0,\n   288→    std_dev: 5.0,\n   289→    flaws: {\n   290→      low: [\"Short chin\"],\n   291→      high: [\"Long chin\"]\n   292→    }\n   293→  },\n   294→  \"chinWidth\": {\n   295→    ideal: [35, 45],\n   296→    mean: 40.0,\n   297→    std_dev: 5.0,\n   298→    flaws: {\n   299→      low: [\"Pointed/Narrow chin\"],\n   300→      high: [\"Wide chin\"]\n   301→    }\n   302→  },\n   303→\n   304→  // NOSE ANGLES\n   305→  \"nasalTipAngle\": {\n   306→    ideal: [95, 115],\n   307→    mean: 105.0,\n   308→    std_dev: 10.0,\n   309→    flaws: {\n   310→      low: [\"Droopy nasal tip\"],\n   311→      high: [\"Upturned nasal tip\"]\n   312→    }\n   313→  },\n   314→  \"nasolabialAngle\": {\n   315→    ideal: [95, 110],\n   316→    mean: 102.5,\n   317→    std_dev: 7.5,\n   318→    flaws: {\n   319→      low: [\"Droopy nasal tip\"],\n   320→      high: [\"Upturned nose\"]\n   321→    }\n   322→  },\n   323→  \"nasofrontalAngle\": {\n   324→    ideal: [115, 135],\n   325→    mean: 125.0,\n   326→    std_dev: 10.0,\n   327→    flaws: {\n   328→      low: [\"Deep nasal root\"],\n   329→      high: [\"Flat nasal root\"]\n   330→    }\n   331→  },\n   332→  \"nasofacialAngle\": {\n   333→    ideal: [30, 40],\n   334→    mean: 35.0,\n   335→    std_dev: 5.0,\n   336→    flaws: {\n   337→      low: [\"Flat nose profile\"],\n   338→      high: [\"Overprojected nose\"]\n   339→    }\n   340→  },\n   341→  \"nasomentaAngle\": {\n   342→    ideal: [120, 135],\n   343→    mean: 127.5,\n   344→    std_dev: 7.5,\n   345→    flaws: {\n   346→      low: [\"Convex profile\"],\n   347→      high: [\"Concave profile\"]\n   348→    }\n   349→  },\n   350→\n   351→  // NOSE WIDTH & PROPORTIONS\n   352→  \"nasalIndex\": {\n   353→    ideal: [65, 75],\n   354→    mean: 70.0,\n   355→    std_dev: 5.0,\n   356→    flaws: {\n   357→      low: [\"Narrow nose\"],\n   358→      high: [\"Wide nose\", \"Bulbous nose\"]\n   359→    }\n   360→  },\n   361→  \"noseWidth\": {\n   362→    ideal: [35, 42],\n   363→    mean: 38.5,\n   364→    std_dev: 3.5,\n   365→    flaws: {\n   366→      low: [\"Narrow nose\"],\n   367→      high: [\"Wide nasal base\"]\n   368→    }\n   369→  },\n   370→  \"noseBridgeWidth\": {\n   371→    ideal: [12, 18],\n   372→    mean: 15.0,\n   373→    std_dev: 3.0,\n   374→    flaws: {\n   375→      low: [\"Narrow nose bridge\"],\n   376→      high: [\"Wide nose bridge\"]\n   377→    }\n   378→  },\n   379→  \"nasalProjection\": {\n   380→    ideal: [16, 22],\n   381→    mean: 19.0,\n   382→    std_dev: 3.0,\n   383→    flaws: {\n   384→      low: [\"Underprojected nose\"],\n   385→      high: [\"Overprojected nose\"]\n   386→    }\n   387→  },\n   388→  \"noseLengthRatio\": {\n   389→    ideal: [0.45, 0.55],\n   390→    mean: 0.50,\n   391→    std_dev: 0.05,\n   392→    flaws: {\n   393→      low: [\"Short nose\"],\n   394→      high: [\"Long nose\"]\n   395→    }\n   396→  },\n   397→\n   398→  // LIPS & PHILTRUM\n   399→  \"lipRatio\": {\n   400→    ideal: [1.4, 1.6],\n   401→    mean: 1.5,\n   402→    std_dev: 0.15,\n   403→    flaws: {\n   404→      low: [\"Thin upper lip\"],\n   405→      high: [\"Thick upper lip\"]\n   406→    }\n   407→  },\n   408→  \"philtrumLength\": {\n   409→    ideal: [11, 15],\n   410→    mean: 13.0,\n   411→    std_dev: 2.0,\n   412→    flaws: {\n   413→      low: [\"Short philtrum\"],\n   414→      high: [\"Long philtrum\"]\n   415→    }\n   416→  },\n   417→  \"upperLipHeight\": {\n   418→    ideal: [18, 24],\n   419→    mean: 21.0,\n   420→    std_dev: 3.0,\n   421→    flaws: {\n   422→      low: [\"Thin upper lip\"],\n   423→      high: [\"Thick upper lip\"]\n   424→    }\n   425→  },\n   426→  \"lipChinDistance\": {\n   427→    ideal: [40, 50],\n   428→    mean: 45.0,\n   429→    std_dev: 5.0,\n   430→    flaws: {\n   431→      low: [\"Short lower third\"],\n   432→      high: [\"Long lower third\"]\n   433→    }\n   434→  },\n   435→  \"upperLipProjection\": {\n   436→    ideal: [-2, 2],\n   437→    mean: 0.0,\n   438→    std_dev: 2.0,\n   439→    flaws: {\n   440→      low: [\"Recessed upper lip\"],\n   441→      high: [\"Protruding upper lip\"]\n   442→    }\n   443→  },\n   444→  \"lowerLipProjection\": {\n   445→    ideal: [-1, 3],\n   446→    mean: 1.0,\n   447→    std_dev: 2.0,\n   448→    flaws: {\n   449→      low: [\"Recessed lower lip\"],\n   450→      high: [\"Protruding lower lip\"]\n   451→    }\n   452→  },\n   453→  \"cupidsBowDepth\": {\n   454→    ideal: [3, 6],\n   455→    mean: 4.5,\n   456→    std_dev: 1.5,\n   457→    flaws: {\n   458→      low: [\"Flat cupid's bow\"],\n   459→      high: [\"Pronounced cupid's bow\"]\n   460→    }\n   461→  },\n   462→\n   463→  // EYEBROWS\n   464→  \"eyebrowHeight\": {\n   465→    ideal: [8, 14],\n   466→    mean: 11.0,\n   467→    std_dev: 3.0,\n   468→    flaws: {\n   469→      low: [\"Low-set eyebrows\"],\n   470→      high: [\"High eyebrows\"]\n   471→    }\n   472→  },\n   473→  \"browLengthRatio\": {\n   474→    ideal: [0.50, 0.60],\n   475→    mean: 0.55,\n   476→    std_dev: 0.05,\n   477→    flaws: {\n   478→      low: [\"Short eyebrows\"],\n   479→      high: [\"Long eyebrows\"]\n   480→    }\n   481→  },\n   482→  \"browLengthToFaceWidth\": {\n   483→    ideal: [0.30, 0.38],\n   484→    mean: 0.34,\n   485→    std_dev: 0.04,\n   486→    flaws: {\n   487→      low: [\"Short eyebrows\"],\n   488→      high: [\"Long eyebrows\"]\n   489→    }\n   490→  },\n   491→  \"browridgeInclinationAngle\": {\n   492→    ideal: [10, 20],\n   493→    mean: 15.0,\n   494→    std_dev: 5.0,\n   495→    flaws: {\n   496→      low: [\"Flat brow ridge\"],\n   497→      high: [\"Prominent brow ridge\"]\n   498→    }\n   499→  },\n   500→  \"eyebrowThickness\": {\n   501→    ideal: [1.5, 3.0],\n   502→    mean: 2.25,\n   503→    std_dev: 0.75,\n   504→    flaws: {\n   505→      low: [\"Sparse/Weak eyebrows\"],\n   506→      high: [\"Overly thick eyebrows\"]\n   507→    }\n   508→  },\n   509→\n   510→  // FOREHEAD\n   511→  \"foreheadHeight\": {\n   512→    ideal: [55, 70],\n   513→    mean: 62.5,\n   514→    std_dev: 7.5,\n   515→    flaws: {\n   516→      low: [\"Short forehead\"],\n   517→      high: [\"Tall forehead\"]\n   518→    }\n   519→  },\n   520→  \"bitemporalWidth\": {\n   521→    ideal: [120, 135],\n   522→    mean: 127.5,\n   523→    std_dev: 7.5,\n   524→    flaws: {\n   525→      low: [\"Narrow forehead\"],\n   526→      high: [\"Wide forehead\"]\n   527→    }\n   528→  },\n   529→\n   530→  // PROFILE & DEPTH\n   531→  \"facialDepthToHeight\": {\n   532→    ideal: [0.75, 0.85],\n   533→    mean: 0.80,\n   534→    std_dev: 0.05,\n   535→    flaws: {\n   536→      low: [\"Flat facial profile\"],\n   537→      high: [\"Overprojected profile\"]\n   538→    }\n   539→  },\n   540→  \"anteriorFacialDepth\": {\n   541→    ideal: [115, 130],\n   542→    mean: 122.5,\n   543→    std_dev: 7.5,\n   544→    flaws: {\n   545→      low: [\"Shallow face depth\"],\n   546→      high: [\"Deep face projection\"]\n   547→    }\n   548→  },\n   549→  \"totalProfileAngle\": {\n   550→    ideal: [165, 175],\n   551→    mean: 170.0,\n   552→    std_dev: 5.0,\n   553→    flaws: {\n   554→      low: [\"Convex profile\"],\n   555→      high: [\"Concave profile\"]\n   556→    }\n   557→  },\n   558→\n   559→  // ASYMMETRY\n   560→  \"facialAsymmetryIndex\": {\n   561→    ideal: [0, 3],\n   562→    mean: 2.0,\n   563→    std_dev: 1.5,\n   564→    flaws: {\n   565→      high: [\"Facial asymmetry\"]\n   566→    }\n   567→  },\n   568→  \"eyeAsymmetry\": {\n   569→    ideal: [0, 2],\n   570→    mean: 1.0,\n   571→    std_dev: 1.0,\n   572→    flaws: {\n   573→      high: [\"Eye asymmetry\"]\n   574→    }\n   575→  },\n   576→  \"jawAsymmetry\": {\n   577→    ideal: [0, 3],\n   578→    mean: 1.5,\n   579→    std_dev: 1.5,\n   580→    flaws: {\n   581→      high: [\"Jaw asymmetry\"]\n   582→    }\n   583→  },\n   584→\n   585→  // OTHER\n   586→  \"recessionFrankfort\": {\n   587→    ideal: [-2, 2],\n   588→    mean: 0.0,\n   589→    std_dev: 2.0,\n   590→    flaws: {\n   591→      low: [\"Maxillary recession\"],\n   592→      high: [\"Maxillary protrusion\"]\n   593→    }\n   594→  },\n   595→  \"neckWidth\": {\n   596→    ideal: [110, 130],\n   597→    mean: 120.0,\n   598→    std_dev: 10.0,\n   599→    flaws: {\n   600→      low: [\"Narrow neck\"],\n   601→      high: [\"Wide neck\"]\n   602→    }\n   603→  },\n   604→  \"neckToJawRatio\": {\n   605→    ideal: [0.90, 1.10],\n   606→    mean: 1.0,\n   607→    std_dev: 0.10,\n   608→    flaws: {\n   609→      low: [\"Narrow neck\"],\n   610→      high: [\"Thick neck\"]\n   611→    }\n   612→  }\n   613→};\n   614→\n   615→// ============================================\n   616→// ETHNICITY-SPECIFIC OVERRIDES\n   617→// ============================================\n   618→\n   619→/**\n   620→ * Ethnicity and gender-specific metric standards\n   621→ * These override the base MASTER_SCORING_DB values for specific populations\n   622→ */\n   623→export const ETHNICITY_OVERRIDES: Record<string, Record<string, Partial<MasterMetricConfig>>> = {\n   624→  // ========================================\n   625→  // MALE WHITE STANDARDS (Neoclassical Baseline)\n   626→  // ========================================\n   627→  \"male_white\": {\n   628→    // NOSE WIDTH - Strict 1:1 ratio (Eye Width = Nose Width)\n   629→    \"noseWidth\": {\n   630→      ideal: [35, 42],  // Corresponds to alar_base_ratio [0.98, 1.05]\n   631→      mean: 38.5,\n   632→      std_dev: 3.5,\n   633→      flaws: {\n   634→        high: [\"Wide nasal base\"]\n   635→      }\n   636→    },\n   637→\n   638→    // MIDFACE - Prefers compact midface (Hunter look)\n   639→    \"midface_ratio\": {\n   640→      ideal: [0.95, 1.02],\n   641→      mean: 0.985,\n   642→      std_dev: 0.035,\n   643→      flaws: {\n   644→        low: [\"Long midface\"]\n   645→      }\n   646→    },\n   647→\n   648→    // JAW - Square/Robust jaw preference\n   649→    \"gonial_angle\": {\n   650→      ideal: [115.0, 125.0],\n   651→      mean: 120.0,\n   652→      std_dev: 5.0,\n   653→      flaws: {\n   654→        high: [\"Weak/Soft jaw structure\"]\n   655→      }\n   656→    },\n   657→\n   658→    // FACE WIDTH - Standard Mesoprosopic range\n   659→    \"faceWidthToHeight\": {\n   660→      ideal: [1.90, 2.05],\n   661→      mean: 1.975,\n   662→      std_dev: 0.075,\n   663→      flaws: {\n   664→        low: [\"Narrow face\"],\n   665→        high: [\"Short/Wide face\"]\n   666→      }\n   667→    },\n   668→\n   669→    // EYE TILT - Neutral to slightly positive\n   670→    \"lateralCanthalTilt\": {\n   671→      ideal: [4.0, 8.0],\n   672→      mean: 6.0,\n   673→      std_dev: 2.0,\n   674→      flaws: {\n   675→        low: [\"Negative canthal tilt\"]\n   676→      }\n   677→    },\n   678→\n   679→    // LOWER FACE BALANCE\n   680→    \"chinPhiltrumRatio\": {\n   681→      ideal: [2.10, 2.30],\n   682→      mean: 2.20,\n   683→      std_dev: 0.10,\n   684→      flaws: {\n   685→        low: [\"Long philtrum / Short chin\"]\n   686→      }\n   687→    }\n   688→  },\n   689→\n   690→  // ========================================\n   691→  // MALE BLACK / AFRICAN STANDARDS\n   692→  // ========================================\n   693→  \"male_black\": {\n   694→    // NOSE WIDTH - Significantly wider tolerance\n   695→    \"noseWidth\": {\n   696→      ideal: [40, 50],  // Wider range (corresponds to alar_base_ratio [1.12, 1.25])\n   697→      mean: 45.0,\n   698→      std_dev: 5.0,\n   699→      flaws: {\n   700→        high: [\"Wide nasal base\"]\n   701→      }\n   702→    },\n   703→    \"nasalIndex\": {\n   704→      ideal: [80, 95],  // Wider nasal index\n   705→      mean: 87.5,\n   706→      std_dev: 7.5,\n   707→      flaws: {\n   708→        high: [\"Wide nose\"]\n   709→      }\n   710→    },\n   711→\n   712→    // LIPS - Prefers fuller lips\n   713→    \"lipRatio\": {\n   714→      ideal: [1.2, 1.5],\n   715→      mean: 1.35,\n   716→      std_dev: 0.15,\n   717→      flaws: {\n   718→        low: [\"Thin lips\"]\n   719→      }\n   720→    },\n   721→\n   722→    // PHILTRUM - Shorter visible philtrum is ideal\n   723→    \"philtrumLength\": {\n   724→      ideal: [11.0, 14.0],\n   725→      mean: 12.5,\n   726→      std_dev: 1.5,\n   727→      flaws: {\n   728→        high: [\"Long philtrum\"]\n   729→      }\n   730→    },\n   731→\n   732→    // CHIN - Adjusts for natural forward mouth projection (Prognathism)\n   733→    \"chinPhiltrumRatio\": {\n   734→      ideal: [1.80, 2.10],  // Lower range to account for prognathism\n   735→      mean: 1.95,\n   736→      std_dev: 0.15,\n   737→      flaws: {\n   738→        low: [\"Recessed chin\"]\n   739→      }\n   740→    }\n   741→  },\n   742→\n   743→  // ========================================\n   744→  // MALE EAST ASIAN STANDARDS\n   745→  // ========================================\n   746→  \"male_east_asian\": {\n   747→    // EYE SPACING - Shifted WIDER for East Asian males\n   748→    \"eye_separation_ratio\": {\n   749→      ideal: [0.48, 0.53],  // Shifted wider (0.46 is \"close-set\" here)\n   750→      mean: 0.505,\n   751→      std_dev: 0.025,\n   752→      flaws: {\n   753→        low: [\"Close-set eyes\"],\n   754→        high: [\"Wide-set eyes\"]\n   755→      }\n   756→    },\n   757→    \"interpupillaryRatio\": {\n   758→      ideal: [0.48, 0.53],\n   759→      mean: 0.505,\n   760→      std_dev: 0.025,\n   761→      flaws: {\n   762→        low: [\"Close-set eyes\"],\n   763→        high: [\"Wide-set eyes\"]\n   764→      }\n   765→    },\n   766→\n   767→    // EYE SHAPE - Prefers narrower/longer eyes (Hunter Eyes)\n   768→    \"eyeAspectRatio\": {\n   769→      ideal: [0.25, 0.29],  // Lower ratio = more elongated\n   770→      mean: 0.27,\n   771→      std_dev: 0.02,\n   772→      flaws: {\n   773→        low: [\"Overly narrow eyes\"],\n   774→        high: [\"Overly round eye shape\"]\n   775→      }\n   776→    },\n   777→    \"palpebralFissureLength\": {\n   778→      ideal: [29, 33],\n   779→      mean: 31.0,\n   780→      std_dev: 2.0,\n   781→      flaws: {\n   782→        low: [\"Small eyes\"],\n   783→        high: [\"Large eyes\"]\n   784→      }\n   785→    },\n   786→\n   787→    // NOSE - Asian noses typically allowed to be wider\n   788→    \"nasalIndex\": {\n   789→      ideal: [75, 85],\n   790→      mean: 80.0,\n   791→      std_dev: 5.0,\n   792→      flaws: {\n   793→        high: [\"Wide nose\"]\n   794→      }\n   795→    },\n   796→    \"noseWidth\": {\n   797→      ideal: [38, 45],\n   798→      mean: 41.5,\n   799→      std_dev: 3.5,\n   800→      flaws: {\n   801→        low: [\"Narrow nose\"],\n   802→        high: [\"Very wide nasal base\"]\n   803→      }\n   804→    },\n   805→    \"noseBridgeWidth\": {\n   806→      ideal: [14, 20],\n   807→      mean: 17.0,\n   808→      std_dev: 3.0,\n   809→      flaws: {\n   810→        low: [\"Narrow nose bridge\"],\n   811→        high: [\"Wide nose bridge\"]\n   812→      }\n   813→    },\n   814→\n   815→    // CHEEKS - Rewards slightly fuller cheeks (Youth/K-Pop aesthetic)\n   816→    \"cheekbone_height\": {\n   817→      ideal: [80.0, 95.0],\n   818→      mean: 87.5,\n   819→      std_dev: 7.5,\n   820→      flaws: {\n   821→        low: [\"Gaunt/Hollow face\"]\n   822→      }\n   823→    },\n   824→\n   825→    // JAW - Slightly softer angles acceptable\n   826→    \"gonial_angle\": {\n   827→      ideal: [118, 128],\n   828→      mean: 123.0,\n   829→      std_dev: 5.0,\n   830→      flaws: {\n   831→        high: [\"Weak/soft jaw structure\"]\n   832→      }\n   833→    },\n   834→    \"mandibularPlaneAngle\": {\n   835→      ideal: [20, 30],\n   836→      mean: 25.0,\n   837→      std_dev: 5.0,\n   838→      flaws: {\n   839→        low: [\"Flat mandibular plane\"],\n   840→        high: [\"Steep mandibular plane\"]\n   841→      }\n   842→    },\n   843→\n   844→    // FACIAL PROPORTIONS - Wider faces more common\n   845→    \"faceWidthToHeight\": {\n   846→      ideal: [1.35, 1.50],\n   847→      mean: 1.425,\n   848→      std_dev: 0.075,\n   849→      flaws: {\n   850→        low: [\"Long face\"],\n   851→        high: [\"Very wide face\"]\n   852→      }\n   853→    },\n   854→    \"totalFacialWidthToHeight\": {\n   855→      ideal: [1.30, 1.45],\n   856→      mean: 1.375,\n   857→      std_dev: 0.075,\n   858→      flaws: {\n   859→        low: [\"Long face shape\"],\n   860→        high: [\"Wide face shape\"]\n   861→      }\n   862→    }\n   863→  },\n   864→\n   865→  // ========================================\n   866→  // MALE SOUTH ASIAN STANDARDS\n   867→  // ========================================\n   868→  \"male_south_asian\": {\n   869→    // NOSE WIDTH - Slightly wider tolerance than White\n   870→    \"noseWidth\": {\n   871→      ideal: [36, 43],  // alar_base_ratio [1.00, 1.08]\n   872→      mean: 39.5,\n   873→      std_dev: 3.5,\n   874→      flaws: {\n   875→        high: [\"Wide nasal base\"]\n   876→      }\n   877→    },\n   878→\n   879→    // TEAR TROUGH - VERY STRICT. High penalty for dark circles\n   880→    \"tearTroughDepth\": {\n   881→      ideal: [0.0, 0.5],\n   882→      mean: 0.25,\n   883→      std_dev: 0.25,\n   884→      flaws: {\n   885→        high: [\"Dark circles / Tear troughs\"]\n   886→      }\n   887→    },\n   888→\n   889→    // UPPER EYELID - Often prefers visible lid platform\n   890→    \"upperEyelidExposure\": {\n   891→      ideal: [0.5, 2.0],\n   892→      mean: 1.25,\n   893→      std_dev: 0.75,\n   894→      flaws: {\n   895→        low: [\"Hooded eyes\"]\n   896→      }\n   897→    },\n   898→\n   899→    // CHEEKS - Penalizes \"Gaunt\" looks heavily\n   900→    \"cheekbone_height\": {\n   901→      ideal: [83.0, 95.0],\n   902→      mean: 89.0,\n   903→      std_dev: 6.0,\n   904→      flaws: {\n   905→        low: [\"Volume loss / Gauntness\"]\n   906→      }\n   907→    }\n   908→  },\n   909→\n   910→  // ========================================\n   911→  // MALE HISPANIC STANDARDS (\"The Bridge Model\")\n   912→  // ========================================\n   913→  \"male_hispanic\": {\n   914→    // FACE WIDTH - Rewards broader, more robust face shapes (Mestizo)\n   915→    \"faceWidthToHeight\": {\n   916→      ideal: [1.95, 2.10],\n   917→      mean: 2.025,\n   918→      std_dev: 0.075,\n   919→      flaws: {\n   920→        low: [\"Long/Narrow face\"]\n   921→      }\n   922→    },\n   923→\n   924→    // NOSE WIDTH - Bridge tolerance (Wider than White, narrower than Black)\n   925→    \"noseWidth\": {\n   926→      ideal: [36, 44],  // alar_base_ratio [1.00, 1.12]\n   927→      mean: 40.0,\n   928→      std_dev: 4.0,\n   929→      flaws: {\n   930→        high: [\"Wide nasal base\"]\n   931→      }\n   932→    },\n   933→\n   934→    // EYE TILT - Strong preference for positive tilt\n   935→    \"lateralCanthalTilt\": {\n   936→      ideal: [6.0, 12.0],\n   937→      mean: 9.0,\n   938→      std_dev: 3.0,\n   939→      flaws: {\n   940→        low: [\"Negative/Neutral canthal tilt\"]\n   941→      }\n   942→    }\n   943→  },\n   944→\n   945→  // ========================================\n   946→  // MALE MIDDLE EASTERN STANDARDS\n   947→  // ========================================\n   948→  \"male_middle_eastern\": {\n   949→    // EYEBROW THICKNESS - Prefers significantly thicker/darker brows\n   950→    \"eyebrowThickness\": {\n   951→      ideal: [2.0, 4.0],\n   952→      mean: 3.0,\n   953→      std_dev: 1.0,\n   954→      flaws: {\n   955→        low: [\"Sparse/Weak eyebrows\"],\n   956→        high: [\"Unibrow\"]\n   957→      }\n   958→    },\n   959→\n   960→    // NASOLABIAL ANGLE - Penalizes droopy tip (<90) or hooked noses\n   961→    \"nasolabialAngle\": {\n   962→      ideal: [90.0, 100.0],\n   963→      mean: 95.0,\n   964→      std_dev: 5.0,\n   965→      flaws: {\n   966→        low: [\"Droopy nose tip / Hooked nose\"]\n   967→      }\n   968→    },\n   969→\n   970→    // EYE TILT - Strong preference for Almond/Hunter eye shape\n   971→    \"lateralCanthalTilt\": {\n   972→      ideal: [4.0, 10.0],\n   973→      mean: 7.0,\n   974→      std_dev: 3.0,\n   975→      flaws: {\n   976→        low: [\"Downturned eyes\"]\n   977→      }\n   978→    },\n   979→\n   980→    // MIDFACE - Similar to White model (Compact is better)\n   981→    \"midface_ratio\": {\n   982→      ideal: [0.95, 1.02],\n   983→      mean: 0.985,\n   984→      std_dev: 0.035,\n   985→      flaws: {\n   986→        low: [\"Long midface\"]\n   987→      }\n   988→    }\n   989→  },\n   990→\n   991→  // ========================================\n   992→  // MALE PACIFIC ISLANDER STANDARDS (\"The Warrior Skull\")\n   993→  // ========================================\n   994→  \"male_pacific_islander\": {\n   995→    // FACE WIDTH - The Highest Width Standard (Very broad)\n   996→    \"faceWidthToHeight\": {\n   997→      ideal: [2.10, 2.30],\n   998→      mean: 2.20,\n   999→      std_dev: 0.10,\n  1000→      flaws: {\n  1001→        low: [\"Narrow/Long face\"]\n  1002→      }\n  1003→    },\n  1004→\n  1005→    // NOSE WIDTH - Wide tolerance\n  1006→    \"noseWidth\": {\n  1007→      ideal: [38, 48],  // alar_base_ratio [1.05, 1.20]\n  1008→      mean: 43.0,\n  1009→      std_dev: 5.0,\n  1010→      flaws: {\n  1011→        high: [\"Wide nasal base\"]\n  1012→      }\n  1013→    },\n  1014→\n  1015→    // CHEEKS - Rewards high mass/robustness\n  1016→    \"cheekbone_height\": {\n  1017→      ideal: [85.0, 100.0],\n  1018→      mean: 92.5,\n  1019→      std_dev: 7.5,\n  1020→      flaws: {\n  1021→        low: [\"Gaunt/Weak face structure\"]\n  1022→      }\n  1023→    },\n  1024→\n  1025→    // CHIN WIDTH - Prefers a very broad, square chin\n  1026→    \"chinWidth\": {\n  1027→      ideal: [40.0, 50.0],\n  1028→      mean: 45.0,\n  1029→      std_dev: 5.0,\n  1030→      flaws: {\n  1031→        low: [\"Pointed/Narrow chin\"]\n  1032→      }\n  1033→    }\n  1034→  },\n  1035→\n  1036→  \"male_native_american\": {\n  1037→    \"faceWidthToHeight\": {\n  1038→      ideal: [2.00, 2.20],\n  1039→      mean: 2.10,\n  1040→      std_dev: 0.10,\n  1041→      flaws: {\n  1042→        low: [\"Narrow face\"],\n  1043→        high: [\"Wide face\"]\n  1044→      }\n  1045→    },\n  1046→\n  1047→    \"nasalIndex\": {\n  1048→      ideal: [75, 90],\n  1049→      mean: 82.5,\n  1050→      std_dev: 7.5,\n  1051→      flaws: {\n  1052→        low: [\"Narrow nose\"],\n  1053→        high: [\"Wide nose\"]\n  1054→      }\n  1055→    },\n  1056→\n  1057→    \"cheekbone_height\": {\n  1058→      ideal: [80.0, 95.0],\n  1059→      mean: 87.5,\n  1060→      std_dev: 7.5,\n  1061→      flaws: {\n  1062→        low: [\"Flat cheekbones\"]\n  1063→      }\n  1064→    },\n  1065→\n  1066→    \"gonialAngle\": {\n  1067→      ideal: [115, 125],\n  1068→      mean: 120,\n  1069→      std_dev: 5,\n  1070→      flaws: {\n  1071→        low: [\"Weak jaw\"],\n  1072→        high: [\"Harsh jaw angle\"]\n  1073→      }\n  1074→    },\n  1075→\n  1076→    \"chinWidth\": {\n  1077→      ideal: [38.0, 48.0],\n  1078→      mean: 43.0,\n  1079→      std_dev: 5.0,\n  1080→      flaws: {\n  1081→        low: [\"Narrow chin\"]\n  1082→      }\n  1083→    }\n  1084→  },\n  1085→\n  1086→  // ========================================\n  1087→  // FEMALE ETHNICITIES (The \"Missing Link\")\n  1088→  // ========================================\n  1089→\n  1090→  \"female_white\": {\n  1091→    // NOSE WIDTH - Strict Rule of Fifths for feminine harmony\n  1092→    \"alar_base_ratio\": {\n  1093→      ideal: [0.98, 1.05],\n  1094→      mean: 1.015,\n  1095→      std_dev: 0.035,\n  1096→      flaws: {\n  1097→        high: [\"Wide nasal base\"]\n  1098→      }\n  1099→    },\n  1100→\n  1101→    // FACE WIDTH - Prefers oval/narrow feminine proportions\n  1102→    \"fwhr\": {\n  1103→      ideal: [1.45, 1.53],\n  1104→      mean: 1.49,\n  1105→      std_dev: 0.04,\n  1106→      flaws: {\n  1107→        low: [\"Long/Narrow face\"],\n  1108→        high: [\"Wide face\"]\n  1109→      }\n  1110→    },\n  1111→\n  1112→    // JAW - Soft, tapered feminine jawline\n  1113→    \"gonial_angle\": {\n  1114→      ideal: [122.0, 130.0],\n  1115→      mean: 126.0,\n  1116→      std_dev: 4.0,\n  1117→      flaws: {\n  1118→        low: [\"Sharp/Masculine jaw angle\"],\n  1119→        high: [\"Weak/Overly soft jawline\"]\n  1120→      }\n  1121→    },\n  1122→\n  1123→    // EYE TILT - Neutral to positive preferred\n  1124→    \"canthal_tilt\": {\n  1125→      ideal: [4.0, 9.0],\n  1126→      mean: 6.5,\n  1127→      std_dev: 2.5,\n  1128→      flaws: {\n  1129→        low: [\"Negative/Downturned eyes\"]\n  1130→      }\n  1131→    },\n  1132→\n  1133→    // CHIN-PHILTRUM - Golden Ratio balance\n  1134→    \"chin_philtrum_ratio\": {\n  1135→      ideal: [2.0, 2.2],\n  1136→      mean: 2.1,\n  1137→      std_dev: 0.1,\n  1138→      flaws: {\n  1139→        low: [\"Recessed chin\"],\n  1140→        high: [\"Protruding chin\"]\n  1141→      }\n  1142→    }\n  1143→  },\n  1144→\n  1145→  \"female_black\": {\n  1146→    // LIPS - High volume preference (fuller lips)\n  1147→    \"lipRatio\": {\n  1148→      ideal: [1.3, 1.6],\n  1149→      mean: 1.45,\n  1150→      std_dev: 0.15,\n  1151→      flaws: {\n  1152→        low: [\"Thin lips\"]\n  1153→      }\n  1154→    },\n  1155→\n  1156→    // NOSE WIDTH - Wider tolerance for ethnic variation\n  1157→    \"alar_base_ratio\": {\n  1158→      ideal: [1.05, 1.15],\n  1159→      mean: 1.10,\n  1160→      std_dev: 0.05,\n  1161→      flaws: {\n  1162→        high: [\"Very wide nasal base\"]\n  1163→      }\n  1164→    },\n  1165→\n  1166→    // CHIN - Allows forward projection (natural prognathism)\n  1167→    \"chin_projection\": {\n  1168→      ideal: [0.0, 5.0],\n  1169→      mean: 2.5,\n  1170→      std_dev: 2.5,\n  1171→      flaws: {\n  1172→        high: [\"Excessive chin projection\"]\n  1173→      }\n  1174→    },\n  1175→\n  1176→    // JAW - Soft feminine jawline\n  1177→    \"gonial_angle\": {\n  1178→      ideal: [120.0, 130.0],\n  1179→      mean: 125.0,\n  1180→      std_dev: 5.0,\n  1181→      flaws: {\n  1182→        low: [\"Sharp jaw angle\"],\n  1183→        high: [\"Weak jawline\"]\n  1184→      }\n  1185→    }\n  1186→  },\n  1187→\n  1188→  \"female_east_asian\": {\n  1189→    // EYE SPACING - Wide-set neotenous preference\n  1190→    \"eye_separation_ratio\": {\n  1191→      ideal: [46.3, 47.5],\n  1192→      mean: 46.9,\n  1193→      std_dev: 0.6,\n  1194→      flaws: {\n  1195→        low: [\"Close-set eyes\"],\n  1196→        high: [\"Very wide-set eyes\"]\n  1197→      }\n  1198→    },\n  1199→\n  1200→    // JAW - Tapered V-shape feminine ideal\n  1201→    \"gonial_angle\": {\n  1202→      ideal: [120.0, 126.0],\n  1203→      mean: 123.0,\n  1204→      std_dev: 3.0,\n  1205→      flaws: {\n  1206→        low: [\"Sharp V-line jaw\"],\n  1207→        high: [\"Weak/Square jawline\"]\n  1208→      }\n  1209→    },\n  1210→\n  1211→    // EYEBROWS - Higher set brows (youthful feminine)\n  1212→    \"eyebrow_height\": {\n  1213→      ideal: [0.85, 1.30],\n  1214→      mean: 1.075,\n  1215→      std_dev: 0.225,\n  1216→      flaws: {\n  1217→        low: [\"Low-set/Heavy brows\"],\n  1218→        high: [\"Very high-arched brows\"]\n  1219→      }\n  1220→    },\n  1221→\n  1222→    // LOWER FACE - Compact lower third (neotenous)\n  1223→    \"lower_third_ratio\": {\n  1224→      ideal: [29.6, 32.7],\n  1225→      mean: 31.15,\n  1226→      std_dev: 1.55,\n  1227→      flaws: {\n  1228→        low: [\"Very short lower face\"],\n  1229→        high: [\"Long lower face\"]\n  1230→      }\n  1231→    }\n  1232→  },\n  1233→\n  1234→  \"female_south_asian\": {\n  1235→    // TEAR TROUGHS - Very strict on dark circles\n  1236→    \"tear_trough_depth\": {\n  1237→      ideal: [0.0, 0.5],\n  1238→      mean: 0.25,\n  1239→      std_dev: 0.25,\n  1240→      flaws: {\n  1241→        high: [\"Dark circles / Deep tear troughs\"]\n  1242→      }\n  1243→    },\n  1244→\n  1245→    // CHEEKS - Rewards midface volume (youthful fullness)\n  1246→    \"cheek_fullness\": {\n  1247→      ideal: [1.0, 2.0],\n  1248→      mean: 1.5,\n  1249→      std_dev: 0.5,\n  1250→      flaws: {\n  1251→        low: [\"Gaunt/Hollow cheeks\"]\n  1252→      }\n  1253→    },\n  1254→\n  1255→    // SKIN - High penalty for uneven skin tone\n  1256→    \"skin_uniformity\": {\n  1257→      ideal: [0.92, 1.0],\n  1258→      mean: 0.96,\n  1259→      std_dev: 0.04,\n  1260→      flaws: {\n  1261→        low: [\"Uneven skin tone / Pigmentation\"]\n  1262→      }\n  1263→    },\n  1264→\n  1265→    // NOSE WIDTH - Intermediate tolerance\n  1266→    \"alar_base_ratio\": {\n  1267→      ideal: [1.00, 1.08],\n  1268→      mean: 1.04,\n  1269→      std_dev: 0.04,\n  1270→      flaws: {\n  1271→        high: [\"Wide nasal base\"]\n  1272→      }\n  1273→    }\n  1274→  },\n  1275→\n  1276→  \"female_hispanic\": {\n  1277→    // FACE WIDTH - Broader Mestiza tolerance\n  1278→    \"fwhr\": {\n  1279→      ideal: [1.50, 1.62],\n  1280→      mean: 1.56,\n  1281→      std_dev: 0.06,\n  1282→      flaws: {\n  1283→        low: [\"Long/Narrow face\"],\n  1284→        high: [\"Very wide face\"]\n  1285→      }\n  1286→    },\n  1287→\n  1288→    // EYE TILT - Strong almond eye preference\n  1289→    \"canthal_tilt\": {\n  1290→      ideal: [6.0, 12.0],\n  1291→      mean: 9.0,\n  1292→      std_dev: 3.0,\n  1293→      flaws: {\n  1294→        low: [\"Neutral/Downturned eyes\"]\n  1295→      }\n  1296→    },\n  1297→\n  1298→    // NOSE WIDTH - Intermediate width tolerance\n  1299→    \"alar_base_ratio\": {\n  1300→      ideal: [1.00, 1.10],\n  1301→      mean: 1.05,\n  1302→      std_dev: 0.05,\n  1303→      flaws: {\n  1304→        high: [\"Wide nasal base\"]\n  1305→      }\n  1306→    },\n  1307→\n  1308→    // LIPS - Voluptuous preference\n  1309→    \"lipRatio\": {\n  1310→      ideal: [1.1, 1.35],\n  1311→      mean: 1.225,\n  1312→      std_dev: 0.125,\n  1313→      flaws: {\n  1314→        low: [\"Thin lips\"]\n  1315→      }\n  1316→    }\n  1317→  },\n  1318→\n  1319→  \"female_middle_eastern\": {\n  1320→    // EYEBROWS - Dense/Thick brows preference\n  1321→    \"eyebrow_thickness\": {\n  1322→      ideal: [1.5, 3.0],\n  1323→      mean: 2.25,\n  1324→      std_dev: 0.75,\n  1325→      flaws: {\n  1326→        low: [\"Sparse/Thin eyebrows\"],\n  1327→        high: [\"Unibrow\"]\n  1328→      }\n  1329→    },\n  1330→\n  1331→    // NOSE - Refined/Upturned tip\n  1332→    \"nasolabial_angle\": {\n  1333→      ideal: [95.0, 105.0],\n  1334→      mean: 100.0,\n  1335→      std_dev: 5.0,\n  1336→      flaws: {\n  1337→        low: [\"Droopy nose tip\"],\n  1338→        high: [\"Overly upturned nose\"]\n  1339→      }\n  1340→    },\n  1341→\n  1342→    // EYE TILT - Foxy/Hunter feminine eye shape\n  1343→    \"canthal_tilt\": {\n  1344→      ideal: [5.0, 10.0],\n  1345→      mean: 7.5,\n  1346→      std_dev: 2.5,\n  1347→      flaws: {\n  1348→        low: [\"Downturned eyes\"]\n  1349→      }\n  1350→    },\n  1351→\n  1352→    // EYELID - Low exposure preferred\n  1353→    \"upper_eyelid_exposure\": {\n  1354→      ideal: [0.5, 1.5],\n  1355→      mean: 1.0,\n  1356→      std_dev: 0.5,\n  1357→      flaws: {\n  1358→        low: [\"Hooded eyes\"],\n  1359→        high: [\"Excessive eyelid exposure\"]\n  1360→      }\n  1361→    }\n  1362→  },\n  1363→\n  1364→  \"female_native_american\": {\n  1365→    // FACE WIDTH - Wide/High cheekbone structure\n  1366→    \"fwhr\": {\n  1367→      ideal: [1.52, 1.65],\n  1368→      mean: 1.585,\n  1369→      std_dev: 0.065,\n  1370→      flaws: {\n  1371→        low: [\"Narrow face\"],\n  1372→        high: [\"Very wide face\"]\n  1373→      }\n  1374→    },\n  1375→\n  1376→    // CHEEKBONES - High definition/prominence\n  1377→    \"cheekbone_prominence\": {\n  1378→      ideal: [1.5, 2.5],\n  1379→      mean: 2.0,\n  1380→      std_dev: 0.5,\n  1381→      flaws: {\n  1382→        low: [\"Flat cheekbones\"],\n  1383→        high: [\"Overly prominent cheekbones\"]\n  1384→      }\n  1385→    },\n  1386→\n  1387→    // JAW - Stronger jaw tolerance\n  1388→    \"gonial_angle\": {\n  1389→      ideal: [115.0, 125.0],\n  1390→      mean: 120.0,\n  1391→      std_dev: 5.0,\n  1392→      flaws: {\n  1393→        low: [\"Very sharp jaw\"],\n  1394→        high: [\"Weak jawline\"]\n  1395→      }\n  1396→    },\n  1397→\n  1398→    // EYE TILT - Positive tilt preference\n  1399→    \"canthal_tilt\": {\n  1400→      ideal: [5.0, 11.0],\n  1401→      mean: 8.0,\n  1402→      std_dev: 3.0,\n  1403→      flaws: {\n  1404→        low: [\"Downturned eyes\"]\n  1405→      }\n  1406→    }\n  1407→  },\n  1408→\n  1409→  \"female_pacific_islander\": {\n  1410→    // FACE WIDTH - Widest/Robust facial structure\n  1411→    \"fwhr\": {\n  1412→      ideal: [1.55, 1.70],\n  1413→      mean: 1.625,\n  1414→      std_dev: 0.075,\n  1415→      flaws: {\n  1416→        low: [\"Narrow face\"],\n  1417→        high: [\"Very wide face\"]\n  1418→      }\n  1419→    },\n  1420→\n  1421→    // CHEEKS - High volume/softness preference\n  1422→    \"cheek_fullness\": {\n  1423→      ideal: [1.2, 2.5],\n  1424→      mean: 1.85,\n  1425→      std_dev: 0.65,\n  1426→      flaws: {\n  1427→        low: [\"Gaunt/Hollow cheeks\"]\n  1428→      }\n  1429→    },\n  1430→\n  1431→    // NOSE WIDTH - Wide nose tolerance\n  1432→    \"alar_base_ratio\": {\n  1433→      ideal: [1.05, 1.15],\n  1434→      mean: 1.10,\n  1435→      std_dev: 0.05,\n  1436→      flaws: {\n  1437→        high: [\"Very wide nasal base\"]\n  1438→      }\n  1439→    },\n  1440→\n  1441→    // LIPS - Full lips preference\n  1442→    \"lipRatio\": {\n  1443→      ideal: [1.25, 1.50],\n  1444→      mean: 1.375,\n  1445→      std_dev: 0.125,\n  1446→      flaws: {\n  1447→        low: [\"Thin lips\"]\n  1448→      }\n  1449→    }\n  1450→  }\n  1451→};\n  1452→\n  1453→/**\n  1454→ * Get the appropriate metric configuration for a given gender and ethnicity\n  1455→ * Falls back to base config if no override exists\n  1456→ */\n  1457→export function getMetricConfig(\n  1458→  metricId: string,\n  1459→  gender: Gender = 'male',\n  1460→  ethnicity: Ethnicity = 'white'\n  1461→): MasterMetricConfig | undefined {\n  1462→  const key = `${gender}_${ethnicity}`;\n  1463→  const override = ETHNICITY_OVERRIDES[key]?.[metricId];\n  1464→  const baseConfig = MASTER_SCORING_DB[metricId];\n  1465→\n  1466→  if (!baseConfig) return undefined;\n  1467→\n  1468→  // Merge override with base config\n  1469→  if (override) {\n  1470→    return {\n  1471→      ...baseConfig,\n  1472→      ...override,\n  1473→      flaws: {\n  1474→        ...baseConfig.flaws,\n  1475→        ...override.flaws\n  1476→      }\n  1477→    } as MasterMetricConfig;\n  1478→  }\n  1479→\n  1480→  return baseConfig;\n  1481→}\n  1482→\n  1483→// ============================================\n  1484→// Z-SCORE SEVERITY FUNCTIONS\n  1485→// ============================================\n  1486→\n  1487→/**\n  1488→ * Calculate Z-score for a given value\n  1489→ * Z = (value - mean) / std_dev\n  1490→ */\n  1491→export function calculateZScore(value: number, mean: number, stdDev: number): number {\n  1492→  if (stdDev === 0) return 0;\n  1493→  return Math.abs((value - mean) / stdDev);\n  1494→}\n  1495→\n  1496→/**\n  1497→ * Determine severity level based on Z-score and ideal range (5-tier system)\n  1498→ * - Ideal: Value is within ideal range\n  1499→ * - Good: |z| < 0.5 (within 0.5 standard deviation)\n  1500→ * - Fair: 0.5 ≤ |z| < 1 (between 0.5-1 standard deviations)\n  1501→ * - Moderate: 1 ≤ |z| < 2 (between 1-2 standard deviations)\n  1502→ * - Severe: |z| ≥ 2 (more than 2 standard deviations away)\n  1503→ */\n  1504→export function getSeverityFromZScore(\n  1505→  value: number,\n  1506→  config: MasterMetricConfig\n  1507→): { severity: SeverityLevel; zScore: number; isInIdeal: boolean } {\n  1508→  const { ideal, mean, std_dev } = config;\n  1509→  const isInIdeal = value >= ideal[0] && value <= ideal[1];\n  1510→  const zScore = calculateZScore(value, mean, std_dev);\n  1511→\n  1512→  let severity: SeverityLevel;\n  1513→  if (isInIdeal) {\n  1514→    severity = 'ideal';\n  1515→  } else if (zScore < 0.5) {\n  1516→    severity = 'good';\n  1517→  } else if (zScore < 1) {\n  1518→    severity = 'fair';\n  1519→  } else if (zScore < 2) {\n  1520→    severity = 'moderate';\n  1521→  } else {\n  1522→    severity = 'severe';\n  1523→  }\n  1524→\n  1525→  return { severity, zScore, isInIdeal };\n  1526→}\n  1527→\n  1528→/**\n  1529→ * Get severity for a metric value with ethnicity/gender awareness\n  1530→ */\n  1531→export function getSeverityForMetric(\n  1532→  metricId: string,\n  1533→  value: number,\n  1534→  gender: Gender = 'male',\n  1535→  ethnicity: Ethnicity = 'white'\n  1536→): { severity: SeverityLevel; zScore: number; isInIdeal: boolean; config: MasterMetricConfig } | null {\n  1537→  const config = getMetricConfig(metricId, gender, ethnicity);\n  1538→  if (!config) return null;\n  1539→\n  1540→  const result = getSeverityFromZScore(value, config);\n  1541→  return { ...result, config };\n  1542→}\n  1543→\n  1544→/**\n  1545→ * Get badge color for severity level (5-tier)\n  1546→ */\n  1547→export function getSeverityColor(severity: SeverityLevel): string {\n  1548→  switch (severity) {\n  1549→    case 'ideal': return 'green';\n  1550→    case 'good': return 'blue';\n  1551→    case 'fair': return 'cyan';\n  1552→    case 'moderate': return 'yellow';\n  1553→    case 'severe': return 'red';\n  1554→    default: return 'gray';\n  1555→  }\n  1556→}\n  1557→\n  1558→/**\n  1559→ * Get severity label for display (5-tier)\n  1560→ */\n  1561→export function getSeverityLabel(severity: SeverityLevel): string {\n  1562→  switch (severity) {\n  1563→    case 'ideal': return 'Ideal';\n  1564→    case 'good': return 'Good';\n  1565→    case 'fair': return 'Fair';\n  1566→    case 'moderate': return 'Moderate';\n  1567→    case 'severe': return 'Severe';\n  1568→    default: return 'Unknown';\n  1569→  }\n  1570→}\n  1571→\n  1572→// ============================================\n  1573→// INSIGHT DEFINITION TYPES\n  1574→// ============================================\n  1575→\n  1576→export interface InsightSeverityLogic {\n  1577→  metrics: string[];  // Display names of metrics (e.g., \"Face Width to Height Ratio\")\n  1578→  threshold: number;  // Score threshold for classification\n  1579→}\n  1580→\n  1581→export interface WeaknessSeverityLabels {\n  1582→  minor: string;\n  1583→  moderate: string;\n  1584→  severe: string;\n  1585→}\n  1586→\n  1587→export interface StrengthGradeLabels {\n  1588→  good: string;\n  1589→  excellent: string;\n  1590→  ideal: string;\n  1591→}\n  1592→\n  1593→export interface InsightContent {\n  1594→  description: string;\n  1595→  severity_labels?: WeaknessSeverityLabels;  // For weaknesses\n  1596→  grade_labels?: StrengthGradeLabels;        // For strengths\n  1597→}\n  1598→\n  1599→export interface InsightDefinition {\n  1600→  id: string;\n  1601→  title: string;\n  1602→  type: 'weakness' | 'strength';\n  1603→  severity_logic: InsightSeverityLogic;\n  1604→  content: InsightContent;\n  1605→}\n  1606→\n  1607→// ============================================\n  1608→// CLASSIFICATION RESULT TYPES\n  1609→// ============================================\n  1610→\n  1611→export type WeaknessSeverity = 'severe' | 'moderate' | 'minor';\n  1612→export type StrengthGrade = 'ideal' | 'excellent' | 'good';\n  1613→\n  1614→export interface ClassifiedWeakness {\n  1615→  insightId: string;\n  1616→  title: string;\n  1617→  description: string;\n  1618→  severity: WeaknessSeverity;\n  1619→  severityLabel: string;  // Custom label from definition (e.g., \"Extremely Long\")\n  1620→  avgScore: number;\n  1621→  matchedMetrics: MatchedMetric[];\n  1622→}\n  1623→\n  1624→export interface ClassifiedStrength {\n  1625→  insightId: string;\n  1626→  title: string;\n  1627→  description: string;\n  1628→  grade: StrengthGrade;\n  1629→  gradeLabel: string;  // Custom label from definition (e.g., \"Ideal\")\n  1630→  avgScore: number;\n  1631→  matchedMetrics: MatchedMetric[];\n  1632→}\n  1633→\n  1634→export interface MatchedMetric {\n  1635→  metricId: string;\n  1636→  metricName: string;\n  1637→  score: number;\n  1638→  value: number;\n  1639→  idealMin: number;\n  1640→  idealMax: number;\n  1641→  unit: string;\n  1642→  category: string;\n  1643→}\n  1644→\n  1645→export interface InsightClassificationResult {\n  1646→  strengths: ClassifiedStrength[];\n  1647→  weaknesses: ClassifiedWeakness[];\n  1648→}\n  1649→\n  1650→// ============================================\n  1651→// INSIGHTS DATABASE\n  1652→// ============================================\n  1653→\n  1654→export const INSIGHTS_DEFINITIONS: InsightDefinition[] = [\n  1655→  {\n  1656→    id: \"long_midface\",\n  1657→    title: \"Long Midface\",\n  1658→    type: \"weakness\",\n  1659→    severity_logic: {\n  1660→      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\", \"Ipsilateral Alar Angle\"],\n  1661→      threshold: 6.0\n  1662→    },\n  1663→    content: {\n  1664→      description: \"The middle of the face is elongated, creating an unbalanced vertical proportion.\",\n  1665→      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Extremely Long\" }\n  1666→    }\n  1667→  },\n  1668→  {\n  1669→    id: \"short_midface\",\n  1670→    title: \"Short Midface\",\n  1671→    type: \"strength\",\n  1672→    severity_logic: {\n  1673→      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\"],\n  1674→      threshold: 8.0\n  1675→    },\n  1676→    content: {\n  1677→      description: \"The midface has ideal vertical proportions, contributing to facial harmony.\",\n  1678→      grade_labels: { good: \"Proportionate\", excellent: \"Well-Balanced\", ideal: \"Ideal\" }\n  1679→    }\n  1680→  },\n  1681→  {\n  1682→    id: \"weak_jaw\",\n  1683→    title: \"Weak/Soft Jaw Structure\",\n  1684→    type: \"weakness\",\n  1685→    severity_logic: {\n  1686→      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Chin to Philtrum Ratio\", \"Jaw Slope\"],\n  1687→      threshold: 5.0\n  1688→    },\n  1689→    content: {\n  1690→      description: \"The jaw has a softer, rounder shape, often less angular and robust than the ideal.\",\n  1691→      severity_labels: { minor: \"Soft\", moderate: \"Recessed\", severe: \"Weak\" }\n  1692→    }\n  1693→  },\n  1694→  {\n  1695→    id: \"strong_jaw\",\n  1696→    title: \"Strong Jaw Definition\",\n  1697→    type: \"strength\",\n  1698→    severity_logic: {\n  1699→      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Jaw Width Ratio\", \"Bigonial Width\"],\n  1700→      threshold: 8.0\n  1701→    },\n  1702→    content: {\n  1703→      description: \"The jaw displays strong definition with well-defined angles and proportionate width.\",\n  1704→      grade_labels: { good: \"Defined\", excellent: \"Strong\", ideal: \"Ideal Angular\" }\n  1705→    }\n  1706→  },\n  1707→  {\n  1708→    id: \"refined_nasal_tip\",\n  1709→    title: \"Refined Nasal Tip\",\n  1710→    type: \"strength\",\n  1711→    severity_logic: {\n  1712→      metrics: [\"Nasal Tip Angle\", \"Nose Tip Position\", \"Frankfort-tip Angle\"],\n  1713→      threshold: 8.5\n  1714→    },\n  1715→    content: {\n  1716→      description: \"This contributes to a harmonious nasal profile due to the nasal tip being well-defined and proportionate.\",\n  1717→      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n  1718→    }\n  1719→  },\n  1720→  {\n  1721→    id: \"bulbous_nose\",\n  1722→    title: \"Bulbous Nasal Tip\",\n  1723→    type: \"weakness\",\n  1724→    severity_logic: {\n  1725→      metrics: [\"Nasal Index\", \"Nose Width\", \"Nasal Tip Angle\"],\n  1726→      threshold: 5.5\n  1727→    },\n  1728→    content: {\n  1729→      description: \"The nasal tip appears rounded and less defined, affecting nasal aesthetics.\",\n  1730→      severity_labels: { minor: \"Slightly Rounded\", moderate: \"Rounded\", severe: \"Bulbous\" }\n  1731→    }\n  1732→  },\n  1733→  {\n  1734→    id: \"ideal_upper_lip\",\n  1735→    title: \"Well-Positioned Upper Lip\",\n  1736→    type: \"strength\",\n  1737→    severity_logic: {\n  1738→      metrics: [\"Upper Lip E-Line Position\", \"Upper Lip S-Line Position\", \"Nasolabial Angle\"],\n  1739→      threshold: 9.0\n  1740→    },\n  1741→    content: {\n  1742→      description: \"This contributes to a harmonious mouth region due to the upper lip sitting neither too far forward nor too far back.\",\n  1743→      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n  1744→    }\n  1745→  },\n  1746→  {\n  1747→    id: \"negative_canthal_tilt\",\n  1748→    title: \"Negative Canthal Tilt\",\n  1749→    type: \"weakness\",\n  1750→    severity_logic: {\n  1751→      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n  1752→      threshold: 5.0\n  1753→    },\n  1754→    content: {\n  1755→      description: \"The outer corners of the eyes sit lower than the inner corners, creating a downturned appearance.\",\n  1756→      severity_labels: { minor: \"Slight Downturn\", moderate: \"Noticeable\", severe: \"Pronounced\" }\n  1757→    }\n  1758→  },\n  1759→  {\n  1760→    id: \"positive_canthal_tilt\",\n  1761→    title: \"Positive Canthal Tilt\",\n  1762→    type: \"strength\",\n  1763→    severity_logic: {\n  1764→      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n  1765→      threshold: 8.0\n  1766→    },\n  1767→    content: {\n  1768→      description: \"The outer corners of the eyes are elevated, creating an attractive upswept eye shape.\",\n  1769→      grade_labels: { good: \"Slight Upturn\", excellent: \"Well-Tilted\", ideal: \"Hunter Eyes\" }\n  1770→    }\n  1771→  },\n  1772→  {\n  1773→    id: \"balanced_facial_thirds\",\n  1774→    title: \"Balanced Facial Thirds\",\n  1775→    type: \"strength\",\n  1776→    severity_logic: {\n  1777→      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n  1778→      threshold: 8.5\n  1779→    },\n  1780→    content: {\n  1781→      description: \"The face displays well-balanced vertical proportions across all three facial thirds.\",\n  1782→      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfectly Proportioned\" }\n  1783→    }\n  1784→  },\n  1785→  {\n  1786→    id: \"imbalanced_thirds\",\n  1787→    title: \"Facial Third Imbalance\",\n  1788→    type: \"weakness\",\n  1789→    severity_logic: {\n  1790→      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n  1791→      threshold: 5.5\n  1792→    },\n  1793→    content: {\n  1794→      description: \"The vertical face proportions show imbalance between the three facial thirds.\",\n  1795→      severity_labels: { minor: \"Slight Imbalance\", moderate: \"Noticeable Disproportion\", severe: \"Significant Imbalance\" }\n  1796→    }\n  1797→  },\n  1798→  {\n  1799→    id: \"high_cheekbones\",\n  1800→    title: \"High Cheekbones\",\n  1801→    type: \"strength\",\n  1802→    severity_logic: {\n  1803→      metrics: [\"Cheekbone Height\", \"Cheekbone Width\", \"Midface Ratio\"],\n  1804→      threshold: 8.5\n  1805→    },\n  1806→    content: {\n  1807→      description: \"Well-positioned cheekbones that create attractive facial contours and catch light beautifully.\",\n  1808→      grade_labels: { good: \"Visible\", excellent: \"Prominent\", ideal: \"Model-Tier\" }\n  1809→    }\n  1810→  },\n  1811→  {\n  1812→    id: \"flat_midface\",\n  1813→    title: \"Flat Midface\",\n  1814→    type: \"weakness\",\n  1815→    severity_logic: {\n  1816→      metrics: [\"Cheekbone Height\", \"Midface Ratio\", \"Total Facial Width to Height\"],\n  1817→      threshold: 5.0\n  1818→    },\n  1819→    content: {\n  1820→      description: \"The midface lacks forward projection, resulting in flatter facial contours.\",\n  1821→      severity_labels: { minor: \"Slightly Flat\", moderate: \"Underprojected\", severe: \"Recessed\" }\n  1822→    }\n  1823→  },\n  1824→  {\n  1825→    id: \"ideal_lip_ratio\",\n  1826→    title: \"Ideal Lip Proportions\",\n  1827→    type: \"strength\",\n  1828→    severity_logic: {\n  1829→      metrics: [\"Lip Ratio\", \"Philtrum Length\", \"Lip Chin Distance\"],\n  1830→      threshold: 8.5\n  1831→    },\n  1832→    content: {\n  1833→      description: \"The lips demonstrate excellent proportions with balanced upper-to-lower lip ratio.\",\n  1834→      grade_labels: { good: \"Balanced\", excellent: \"Well-Proportioned\", ideal: \"Perfect Ratio\" }\n  1835→    }\n  1836→  },\n  1837→  {\n  1838→    id: \"thin_lips\",\n  1839→    title: \"Thin Lip Profile\",\n  1840→    type: \"weakness\",\n  1841→    severity_logic: {\n  1842→      metrics: [\"Lip Ratio\", \"Upper Lip Projection\", \"Lower Lip Projection\"],\n  1843→      threshold: 5.0\n  1844→    },\n  1845→    content: {\n  1846→      description: \"The lips appear thinner than ideal proportions, affecting lower face harmony.\",\n  1847→      severity_labels: { minor: \"Slightly Thin\", moderate: \"Thin\", severe: \"Very Thin\" }\n  1848→    }\n  1849→  },\n  1850→  {\n  1851→    id: \"ideal_ipd\",\n  1852→    title: \"Ideal Eye Spacing\",\n  1853→    type: \"strength\",\n  1854→    severity_logic: {\n  1855→      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n  1856→      threshold: 8.5\n  1857→    },\n  1858→    content: {\n  1859→      description: \"The eyes are ideally spaced, creating facial balance and attractiveness.\",\n  1860→      grade_labels: { good: \"Good Spacing\", excellent: \"Ideal Distance\", ideal: \"Perfect IPD\" }\n  1861→    }\n  1862→  },\n  1863→  {\n  1864→    id: \"wide_set_eyes\",\n  1865→    title: \"Wide-Set Eyes\",\n  1866→    type: \"weakness\",\n  1867→    severity_logic: {\n  1868→      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n  1869→      threshold: 5.5\n  1870→    },\n  1871→    content: {\n  1872→      description: \"The eyes are spaced wider apart than the aesthetic ideal.\",\n  1873→      severity_labels: { minor: \"Slightly Wide\", moderate: \"Noticeably Wide\", severe: \"Very Wide\" }\n  1874→    }\n  1875→  },\n  1876→  {\n  1877→    id: \"close_set_eyes\",\n  1878→    title: \"Close-Set Eyes\",\n  1879→    type: \"weakness\",\n  1880→    severity_logic: {\n  1881→      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"Intercanthal Width\"],\n  1882→      threshold: 5.5\n  1883→    },\n  1884→    content: {\n  1885→      description: \"The eyes are positioned closer together than the aesthetic ideal.\",\n  1886→      severity_labels: { minor: \"Slightly Close\", moderate: \"Noticeably Close\", severe: \"Very Close\" }\n  1887→    }\n  1888→  },\n  1889→  {\n  1890→    id: \"ideal_nose_projection\",\n  1891→    title: \"Ideal Nasal Projection\",\n  1892→    type: \"strength\",\n  1893→    severity_logic: {\n  1894→      metrics: [\"Nasofrontal Angle\", \"Nasofacial Angle\", \"Nasomenta Angle\"],\n  1895→      threshold: 8.5\n  1896→    },\n  1897→    content: {\n  1898→      description: \"The nose has ideal forward projection relative to the face, creating profile harmony.\",\n  1899→      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect Projection\" }\n  1900→    }\n  1901→  },\n  1902→  {\n  1903→    id: \"recessed_chin\",\n  1904→    title: \"Recessed Chin\",\n  1905→    type: \"weakness\",\n  1906→    severity_logic: {\n  1907→      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Facial Depth to Height\"],\n  1908→      threshold: 5.0\n  1909→    },\n  1910→    content: {\n  1911→      description: \"The chin sits behind the ideal position, affecting profile balance.\",\n  1912→      severity_labels: { minor: \"Slightly Recessed\", moderate: \"Recessed\", severe: \"Severely Recessed\" }\n  1913→    }\n  1914→  },\n  1915→  {\n  1916→    id: \"ideal_chin_projection\",\n  1917→    title: \"Ideal Chin Projection\",\n  1918→    type: \"strength\",\n  1919→    severity_logic: {\n  1920→      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Anterior Facial Depth\"],\n  1921→      threshold: 8.5\n  1922→    },\n  1923→    content: {\n  1924→      description: \"The chin demonstrates ideal projection and proportions relative to the face.\",\n  1925→      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect\" }\n  1926→    }\n  1927→  },\n  1928→  {\n  1929→    id: \"long_philtrum\",\n  1930→    title: \"Long Philtrum\",\n  1931→    type: \"weakness\",\n  1932→    severity_logic: {\n  1933→      metrics: [\"Philtrum Length\", \"Lip Chin Distance\", \"Upper Lip Height\"],\n  1934→      threshold: 5.5\n  1935→    },\n  1936→    content: {\n  1937→      description: \"The distance between nose and upper lip is longer than ideal.\",\n  1938→      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n  1939→    }\n  1940→  },\n  1941→  {\n  1942→    id: \"short_philtrum\",\n  1943→    title: \"Short Philtrum\",\n  1944→    type: \"strength\",\n  1945→    severity_logic: {\n  1946→      metrics: [\"Philtrum Length\", \"Upper Lip Height\"],\n  1947→      threshold: 8.0\n  1948→    },\n  1949→    content: {\n  1950→      description: \"The philtrum has ideal or shorter length, considered youthful and attractive.\",\n  1951→      grade_labels: { good: \"Good Length\", excellent: \"Short\", ideal: \"Ideal\" }\n  1952→    }\n  1953→  },\n  1954→  {\n  1955→    id: \"wide_nose\",\n  1956→    title: \"Wide Nasal Base\",\n  1957→    type: \"weakness\",\n  1958→    severity_logic: {\n  1959→      metrics: [\"Nasal Index\", \"Intercanthal Nasal Ratio\", \"Nose Bridge Width\"],\n  1960→      threshold: 5.0\n  1961→    },\n  1962→    content: {\n  1963→      description: \"The base of the nose is wider than the aesthetic ideal for facial harmony.\",\n  1964→      severity_labels: { minor: \"Slightly Wide\", moderate: \"Wide\", severe: \"Very Wide\" }\n  1965→    }\n  1966→  },\n  1967→  {\n  1968→    id: \"ideal_brow_position\",\n  1969→    title: \"Ideal Brow Position\",\n  1970→    type: \"strength\",\n  1971→    severity_logic: {\n  1972→      metrics: [\"Eyebrow Height\", \"Brow Length Ratio\"],\n  1973→      threshold: 8.0\n  1974→    },\n  1975→    content: {\n  1976→      description: \"The eyebrows are ideally positioned relative to the eyes and facial structure.\",\n  1977→      grade_labels: { good: \"Good Position\", excellent: \"Well-Arched\", ideal: \"Perfect Frame\" }\n  1978→    }\n  1979→  },\n  1980→  {\n  1981→    id: \"narrow_jaw\",\n  1982→    title: \"Narrow Jaw\",\n  1983→    type: \"weakness\",\n  1984→    severity_logic: {\n  1985→      metrics: [\"Jaw Width Ratio\", \"Bigonial Width\", \"Jaw Frontal Angle\"],\n  1986→      threshold: 5.0\n  1987→    },\n  1988→    content: {\n  1989→      description: \"The jaw is narrower than ideal, affecting lower face width and definition.\",\n  1990→      severity_labels: { minor: \"Slightly Narrow\", moderate: \"Narrow\", severe: \"Very Narrow\" }\n  1991→    }\n  1992→  },\n  1993→  {\n  1994→    id: \"steep_mandibular_plane\",\n  1995→    title: \"Steep Mandibular Plane\",\n  1996→    type: \"weakness\",\n  1997→    severity_logic: {\n  1998→      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n  1999→      threshold: 5.0\n  2000→    },\n  2001→    content: {\n  2002→      description: \"The mandibular plane angle is steeper than ideal, often indicating vertical growth pattern.\",\n  2003→      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n  2004→    }\n  2005→  },\n  2006→  // ============================================\n  2007→  // INSIGHT DEFINITIONS (element.html / element1.html)\n  2008→  // ============================================\n  2009→  // --- WEAKNESSES ---\n  2010→  {\n  2011→    id: \"steep_jaw\",\n  2012→    title: \"Steep Jaw\",\n  2013→    type: \"weakness\",\n  2014→    severity_logic: {\n  2015→      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Jaw Frontal Angle\"],\n  2016→      threshold: 6.0\n  2017→    },\n  2018→    content: {\n  2019→      description: \"The jaw angles sharply downward, creating a narrow or pointed chin effect.\",\n  2020→      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n  2021→    }\n  2022→  },\n  2023→  {\n  2024→    id: \"maxillary_recession\",\n  2025→    title: \"Maxillary Recession\",\n  2026→    type: \"weakness\",\n  2027→    severity_logic: {\n  2028→      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Facial Depth to Height Ratio\"],\n  2029→      threshold: 6.0\n  2030→    },\n  2031→    content: {\n  2032→      description: \"The upper jaw is less forward than ideal, reducing midface projection and facial harmony.\",\n  2033→      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n  2034→    }\n  2035→  },\n  2036→  {\n  2037→    id: \"mandibular_recession\",\n  2038→    title: \"Mandibular Recession\",\n  2039→    type: \"weakness\",\n  2040→    severity_logic: {\n  2041→      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\"],\n  2042→      threshold: 6.0\n  2043→    },\n  2044→    content: {\n  2045→      description: \"The lower jaw is set back, creating a less prominent chin and an unbalanced profile.\",\n  2046→      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n  2047→    }\n  2048→  },\n  2049→  {\n  2050→    id: \"underprojected_chin\",\n  2051→    title: \"Underprojected Chin\",\n  2052→    type: \"weakness\",\n  2053→    severity_logic: {\n  2054→      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\", \"Chin Height\"],\n  2055→      threshold: 6.0\n  2056→    },\n  2057→    content: {\n  2058→      description: \"The chin lacks forward projection, creating a weak lower face appearance.\",\n  2059→      severity_labels: { minor: \"Slightly Weak\", moderate: \"Underprojected\", severe: \"Severely Underprojected\" }\n  2060→    }\n  2061→  },\n  2062→  {\n  2063→    id: \"overly_long_face\",\n  2064→    title: \"Overly Long Face Shape\",\n  2065→    type: \"weakness\",\n  2066→    severity_logic: {\n  2067→      metrics: [\"Total Facial Width to Height Ratio\", \"Face Width to Height Ratio\"],\n  2068→      threshold: 6.0\n  2069→    },\n  2070→    content: {\n  2071→      description: \"The face is excessively tall and narrow, creating an elongated appearance.\",\n  2072→      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n  2073→    }\n  2074→  },\n  2075→  {\n  2076→    id: \"hyper_divergent_jaw\",\n  2077→    title: \"Hyper-Divergent Jaw Growth\",\n  2078→    type: \"weakness\",\n  2079→    severity_logic: {\n  2080→      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n  2081→      threshold: 5.5\n  2082→    },\n  2083→    content: {\n  2084→      description: \"The jaw grows with an overly steep angle, resulting in a long or narrow lower face. This can indicate malocclusion.\",\n  2085→      severity_labels: { minor: \"Mildly Divergent\", moderate: \"Divergent\", severe: \"Hyper-Divergent\" }\n  2086→    }\n  2087→  },\n  2088→  {\n  2089→    id: \"weak_brow_ridge\",\n  2090→    title: \"Soft/Weak Brow Ridge\",\n  2091→    type: \"weakness\",\n  2092→    severity_logic: {\n  2093→      metrics: [\"Browridge Inclination Angle\", \"Eyebrow Height\"],\n  2094→      threshold: 5.5\n  2095→    },\n  2096→    content: {\n  2097→      description: \"The forehead has a softer, less prominent ridge than the ideal, reducing masculine definition.\",\n  2098→      severity_labels: { minor: \"Slightly Soft\", moderate: \"Soft\", severe: \"Very Weak\" }\n  2099→    }\n  2100→  },\n  2101→  {\n  2102→    id: \"droopy_nasal_tip\",\n  2103→    title: \"Droopy Nasal Tip\",\n  2104→    type: \"weakness\",\n  2105→    severity_logic: {\n  2106→      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\", \"Nasofacial Angle\"],\n  2107→      threshold: 5.5\n  2108→    },\n  2109→    content: {\n  2110→      description: \"The nasal tip points downward more than ideal, creating a drooping appearance.\",\n  2111→      severity_labels: { minor: \"Slightly Droopy\", moderate: \"Droopy\", severe: \"Very Droopy\" }\n  2112→    }\n  2113→  },\n  2114→  {\n  2115→    id: \"overprojected_nose\",\n  2116→    title: \"Overprojected Nose\",\n  2117→    type: \"weakness\",\n  2118→    severity_logic: {\n  2119→      metrics: [\"Nasal Projection\", \"Nasofacial Angle\", \"Nose Length Ratio\"],\n  2120→      threshold: 5.5\n  2121→    },\n  2122→    content: {\n  2123→      description: \"The nose projects too far forward relative to the face, creating imbalance.\",\n  2124→      severity_labels: { minor: \"Slightly Projected\", moderate: \"Overprojected\", severe: \"Very Overprojected\" }\n  2125→    }\n  2126→  },\n  2127→  {\n  2128→    id: \"small_eyes\",\n  2129→    title: \"Small Eyes\",\n  2130→    type: \"weakness\",\n  2131→    severity_logic: {\n  2132→      metrics: [\"Eye Aspect Ratio\", \"Palpebral Fissure Length\", \"Eye Width\"],\n  2133→      threshold: 5.5\n  2134→    },\n  2135→    content: {\n  2136→      description: \"The eyes appear smaller than the aesthetic ideal relative to the face.\",\n  2137→      severity_labels: { minor: \"Slightly Small\", moderate: \"Small\", severe: \"Very Small\" }\n  2138→    }\n  2139→  },\n  2140→  {\n  2141→    id: \"low_set_eyebrows\",\n  2142→    title: \"Low-Set Eyebrows\",\n  2143→    type: \"weakness\",\n  2144→    severity_logic: {\n  2145→      metrics: [\"Eyebrow Height\", \"Brow to Hairline Distance\"],\n  2146→      threshold: 5.5\n  2147→    },\n  2148→    content: {\n  2149→      description: \"The eyebrows sit lower than ideal, reducing the visible upper eyelid space.\",\n  2150→      severity_labels: { minor: \"Slightly Low\", moderate: \"Low\", severe: \"Very Low\" }\n  2151→    }\n  2152→  },\n  2153→  {\n  2154→    id: \"asymmetrical_face\",\n  2155→    title: \"Facial Asymmetry\",\n  2156→    type: \"weakness\",\n  2157→    severity_logic: {\n  2158→      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n  2159→      threshold: 5.5\n  2160→    },\n  2161→    content: {\n  2162→      description: \"The left and right sides of the face show noticeable differences in proportion or position.\",\n  2163→      severity_labels: { minor: \"Slight Asymmetry\", moderate: \"Noticeable Asymmetry\", severe: \"Significant Asymmetry\" }\n  2164→    }\n  2165→  },\n  2166→  // --- STRENGTHS ---\n  2167→  {\n  2168→    id: \"good_jaw_width\",\n  2169→    title: \"Good Jaw Width\",\n  2170→    type: \"strength\",\n  2171→    severity_logic: {\n  2172→      metrics: [\"Bigonial Width\", \"Jaw Width Ratio\", \"Jaw Frontal Angle\"],\n  2173→      threshold: 8.5\n  2174→    },\n  2175→    content: {\n  2176→      description: \"This contributes to a pleasant jaw contour due to the jaw being neither too wide nor too narrow.\",\n  2177→      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n  2178→    }\n  2179→  },\n  2180→  {\n  2181→    id: \"good_forehead_slope\",\n  2182→    title: \"Good Forehead Slope\",\n  2183→    type: \"strength\",\n  2184→    severity_logic: {\n  2185→      metrics: [\"Browridge Inclination Angle\", \"Forehead Height\"],\n  2186→      threshold: 8.5\n  2187→    },\n  2188→    content: {\n  2189→      description: \"This contributes to a pleasant forehead contour by indicating that the forehead is neither too steep nor too flat.\",\n  2190→      grade_labels: { good: \"Good Slope\", excellent: \"Well-Angled\", ideal: \"Ideal Slope\" }\n  2191→    }\n  2192→  },\n  2193→  {\n  2194→    id: \"good_cupids_bow\",\n  2195→    title: \"Good Cupid's Bow Depth\",\n  2196→    type: \"strength\",\n  2197→    severity_logic: {\n  2198→      metrics: [\"Cupids Bow Depth\", \"Upper Lip Height\"],\n  2199→      threshold: 8.5\n  2200→    },\n  2201→    content: {\n  2202→      description: \"This contributes to a harmonious lip region due to the cupid's bow having ideal definition and depth.\",\n  2203→      grade_labels: { good: \"Defined\", excellent: \"Well-Defined\", ideal: \"Perfectly Defined\" }\n  2204→    }\n  2205→  },\n  2206→  {\n  2207→    id: \"good_eyebrow_length\",\n  2208→    title: \"Good Eyebrow Length\",\n  2209→    type: \"strength\",\n  2210→    severity_logic: {\n  2211→      metrics: [\"Brow Length to Face Width Ratio\", \"Brow Length Ratio\"],\n  2212→      threshold: 8.5\n  2213→    },\n  2214→    content: {\n  2215→      description: \"This contributes to a harmonious eye region due to the eyebrows having ideal horizontal length relative to face width.\",\n  2216→      grade_labels: { good: \"Good Length\", excellent: \"Well-Proportioned\", ideal: \"Ideal Length\" }\n  2217→    }\n  2218→  },\n  2219→  {\n  2220→    id: \"good_neck_width\",\n  2221→    title: \"Good Neck Width\",\n  2222→    type: \"strength\",\n  2223→    severity_logic: {\n  2224→      metrics: [\"Neck Width\", \"Neck to Jaw Ratio\"],\n  2225→      threshold: 8.5\n  2226→    },\n  2227→    content: {\n  2228→      description: \"This contributes to a harmonious lower face due to the neck being neither too wide nor too thin.\",\n  2229→      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n  2230→    }\n  2231→  },\n  2232→  {\n  2233→    id: \"ideal_nasolabial_angle\",\n  2234→    title: \"Ideal Nasolabial Angle\",\n  2235→    type: \"strength\",\n  2236→    severity_logic: {\n  2237→      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\"],\n  2238→      threshold: 8.5\n  2239→    },\n  2240→    content: {\n  2241→      description: \"The angle between nose and upper lip is in the ideal range, creating profile harmony.\",\n  2242→      grade_labels: { good: \"Good Angle\", excellent: \"Well-Angled\", ideal: \"Perfect Angle\" }\n  2243→    }\n  2244→  },\n  2245→  {\n  2246→    id: \"ideal_facial_depth\",\n  2247→    title: \"Ideal Facial Depth\",\n  2248→    type: \"strength\",\n  2249→    severity_logic: {\n  2250→      metrics: [\"Facial Depth to Height Ratio\", \"Anterior Facial Depth\"],\n  2251→      threshold: 8.5\n  2252→    },\n  2253→    content: {\n  2254→      description: \"The face has ideal forward projection creating attractive three-dimensional contours.\",\n  2255→      grade_labels: { good: \"Good Depth\", excellent: \"Well-Projected\", ideal: \"Ideal Projection\" }\n  2256→    }\n  2257→  },\n  2258→  {\n  2259→    id: \"ideal_eye_shape\",\n  2260→    title: \"Ideal Eye Shape\",\n  2261→    type: \"strength\",\n  2262→    severity_logic: {\n  2263→      metrics: [\"Eye Aspect Ratio\", \"Lateral Canthal Tilt\", \"Palpebral Fissure Length\"],\n  2264→      threshold: 8.5\n  2265→    },\n  2266→    content: {\n  2267→      description: \"The eyes have an attractive almond shape with ideal proportions and tilt.\",\n  2268→      grade_labels: { good: \"Attractive\", excellent: \"Well-Shaped\", ideal: \"Hunter Eyes\" }\n  2269→    }\n  2270→  },\n  2271→  {\n  2272→    id: \"harmonious_profile\",\n  2273→    title: \"Harmonious Profile\",\n  2274→    type: \"strength\",\n  2275→    severity_logic: {\n  2276→      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Total Profile Angle\"],\n  2277→      threshold: 8.5\n  2278→    },\n  2279→    content: {\n  2280→      description: \"The facial profile shows excellent balance between nose, lips, and chin positions.\",\n  2281→      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfect Profile\" }\n  2282→    }\n  2283→  },\n  2284→  {\n  2285→    id: \"good_facial_symmetry\",\n  2286→    title: \"Good Facial Symmetry\",\n  2287→    type: \"strength\",\n  2288→    severity_logic: {\n  2289→      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n  2290→      threshold: 8.5\n  2291→    },\n  2292→    content: {\n  2293→      description: \"The face displays excellent bilateral symmetry, a key component of attractiveness.\",\n  2294→      grade_labels: { good: \"Symmetric\", excellent: \"Very Symmetric\", ideal: \"Near-Perfect Symmetry\" }\n  2295→    }\n  2296→  }\n  2297→];\n  2298→\n  2299→// ============================================\n  2300→// METRIC NAME MAPPING\n  2301→// ============================================\n  2302→\n  2303→// Map display names to metric IDs for lookup\n  2304→const METRIC_NAME_TO_ID: Record<string, string> = {\n  2305→  // Face Shape/Proportions\n  2306→  \"Face Width to Height Ratio\": \"faceWidthToHeight\",\n  2307→  \"Total Facial Width to Height\": \"totalFacialWidthToHeight\",\n  2308→  \"Total Facial Width to Height Ratio\": \"totalFacialWidthToHeight\",\n  2309→  \"Midface Ratio\": \"midfaceRatio\",\n  2310→  \"Upper Third Proportion\": \"upperThirdProportion\",\n  2311→  \"Middle Third Proportion\": \"middleThirdProportion\",\n  2312→  \"Lower Third Proportion\": \"lowerThirdProportion\",\n  2313→  \"Cheekbone Height\": \"cheekboneHeight\",\n  2314→  \"Cheekbone Width\": \"cheekboneWidth\",\n  2315→  \"Bitemporal Width\": \"bitemporalWidth\",\n  2316→  \"Forehead Height\": \"foreheadHeight\",\n  2317→  \"Facial Asymmetry Index\": \"facialAsymmetryIndex\",\n  2318→\n  2319→  // Jaw\n  2320→  \"Gonial Angle\": \"gonialAngle\",\n  2321→  \"Mandibular Plane Angle\": \"mandibularPlaneAngle\",\n  2322→  \"Jaw Width Ratio\": \"jawWidthRatio\",\n  2323→  \"Bigonial Width\": \"bigonialWidth\",\n  2324→  \"Jaw Frontal Angle\": \"jawFrontalAngle\",\n  2325→  \"Jaw Slope\": \"jawSlope\",\n  2326→  \"Jaw Asymmetry\": \"jawAsymmetry\",\n  2327→\n  2328→  // Chin\n  2329→  \"Chin to Philtrum Ratio\": \"chinPhiltrumRatio\",\n  2330→  \"Chin Height\": \"chinHeight\",\n  2331→  \"Facial Depth to Height\": \"facialDepthToHeight\",\n  2332→  \"Facial Depth to Height Ratio\": \"facialDepthToHeight\",\n  2333→  \"Anterior Facial Depth\": \"anteriorFacialDepth\",\n  2334→  \"Recession Relative to Frankfort Plane\": \"recessionFrankfort\",\n  2335→\n  2336→  // Eyes\n  2337→  \"Lateral Canthal Tilt\": \"lateralCanthalTilt\",\n  2338→  \"Eye Aspect Ratio\": \"eyeAspectRatio\",\n  2339→  \"Eye Separation Ratio\": \"eyeSeparationRatio\",\n  2340→  \"Interpupillary Ratio\": \"interpupillaryRatio\",\n  2341→  \"One Eye Apart Test\": \"oneEyeApartTest\",\n  2342→  \"Intercanthal Width\": \"intercanthalWidth\",\n  2343→  \"Eyebrow Height\": \"eyebrowHeight\",\n  2344→  \"Brow Length Ratio\": \"browLengthRatio\",\n  2345→  \"Brow Length to Face Width Ratio\": \"browLengthToFaceWidth\",\n  2346→  \"Palpebral Fissure Length\": \"palpebralFissureLength\",\n  2347→  \"Eye Width\": \"eyeWidth\",\n  2348→  \"Eye Asymmetry\": \"eyeAsymmetry\",\n  2349→  \"Brow to Hairline Distance\": \"browToHairlineDistance\",\n  2350→\n  2351→  // Brow\n  2352→  \"Browridge Inclination Angle\": \"browridgeInclinationAngle\",\n  2353→\n  2354→  // Nose\n  2355→  \"Nasal Index\": \"nasalIndex\",\n  2356→  \"Nasal Tip Angle\": \"nasalTipAngle\",\n  2357→  \"Nose Tip Position\": \"noseTipPosition\",\n  2358→  \"Frankfort-tip Angle\": \"frankfortTipAngle\",\n  2359→  \"Nasofrontal Angle\": \"nasofrontalAngle\",\n  2360→  \"Nasofacial Angle\": \"nasofacialAngle\",\n  2361→  \"Nasomenta Angle\": \"nasomentaAngle\",\n  2362→  \"Nasomental Angle\": \"nasomentaAngle\",\n  2363→  \"Intercanthal Nasal Ratio\": \"intercanthalNasalRatio\",\n  2364→  \"Nose Bridge Width\": \"noseBridgeWidth\",\n  2365→  \"Nose Width\": \"noseWidth\",\n  2366→  \"Nasal Projection\": \"nasalProjection\",\n  2367→  \"Nose Length Ratio\": \"noseLengthRatio\",\n  2368→  \"Ipsilateral Alar Angle\": \"ipsilateralAlarAngle\",\n  2369→\n  2370→  // Lips\n  2371→  \"Lip Ratio\": \"lipRatio\",\n  2372→  \"Philtrum Length\": \"philtrumLength\",\n  2373→  \"Upper Lip Projection\": \"upperLipProjection\",\n  2374→  \"Lower Lip Projection\": \"lowerLipProjection\",\n  2375→  \"Lip Chin Distance\": \"lipChinDistance\",\n  2376→  \"Upper Lip Height\": \"upperLipHeight\",\n  2377→  \"Upper Lip E-Line Position\": \"upperLipELine\",\n  2378→  \"Upper Lip S-Line Position\": \"upperLipSLine\",\n  2379→  \"Nasolabial Angle\": \"nasolabialAngle\",\n  2380→  \"Cupids Bow Depth\": \"cupidsBowDepth\",\n  2381→\n  2382→  // Neck\n  2383→  \"Neck Width\": \"neckWidth\",\n  2384→  \"Neck to Jaw Ratio\": \"neckToJawRatio\",\n  2385→\n  2386→  // Profile\n  2387→  \"Total Profile Angle\": \"totalProfileAngle\",\n  2388→};\n  2389→\n  2390→// ============================================\n  2391→// CLASSIFICATION FUNCTIONS\n  2392→// ============================================\n  2393→\n  2394→/**\n  2395→ * Get weakness severity based on average score\n  2396→ * 0-3 = \"Severe\", 3-5 = \"Moderate\", 5-7 = \"Minor\"\n  2397→ */\n  2398→function getWeaknessSeverity(avgScore: number): WeaknessSeverity {\n  2399→  if (avgScore <= 3) return 'severe';\n  2400→  if (avgScore <= 5) return 'moderate';\n  2401→  return 'minor';\n  2402→}\n  2403→\n  2404→/**\n  2405→ * Get strength grade based on average score\n  2406→ * 8-9 = \"Good\", 9-9.5 = \"Excellent\", 9.5-10 = \"Ideal\"\n  2407→ */\n  2408→function getStrengthGrade(avgScore: number): StrengthGrade {\n  2409→  if (avgScore >= 9.5) return 'ideal';\n  2410→  if (avgScore >= 9) return 'excellent';\n  2411→  return 'good';\n  2412→}\n  2413→\n  2414→/**\n  2415→ * Find metric by display name from measurements array\n  2416→ */\n  2417→function findMetricByName(\n  2418→  metricName: string,\n  2419→  measurements: MetricScoreResult[]\n  2420→): MetricScoreResult | undefined {\n  2421→  // First try direct ID mapping\n  2422→  const metricId = METRIC_NAME_TO_ID[metricName];\n  2423→  if (metricId) {\n  2424→    return measurements.find(m => m.metricId === metricId);\n  2425→  }\n  2426→\n  2427→  // Fallback: try fuzzy matching on name\n  2428→  const normalizedName = metricName.toLowerCase().replace(/[^a-z0-9]/g, '');\n  2429→  return measurements.find(m => {\n  2430→    const normalizedMetricName = m.name.toLowerCase().replace(/[^a-z0-9]/g, '');\n  2431→    return normalizedMetricName.includes(normalizedName) ||\n  2432→           normalizedName.includes(normalizedMetricName);\n  2433→  });\n  2434→}\n  2435→\n  2436→/**\n  2437→ * Check if a metric should be considered a \"false positive\" weakness.\n  2438→ * This handles directional/dimorphic metrics where low scores don't mean weakness.\n  2439→ *\n  2440→ * Example: Canthal Tilt of 3° gets a low score (not in 6-8° ideal range)\n  2441→ * but is still a POSITIVE trait, not a weakness.\n  2442→ */\n  2443→function isFalsePositiveWeakness(metric: MatchedMetric): boolean {\n  2444→  const config = METRIC_CONFIGS[metric.metricId];\n  2445→  if (!config) return false;\n  2446→\n  2447→  // Check if the value is actually acceptable based on polarity\n  2448→  const { acceptable } = isValueAcceptable(metric.value, config);\n  2449→  return acceptable;\n  2450→}\n  2451→\n  2452→/**\n  2453→ * Process all insight definitions against user's measurements\n  2454→ */\n  2455→export function classifyInsights(\n  2456→  measurements: MetricScoreResult[],\n  2457→  insightDefinitions: InsightDefinition[] = INSIGHTS_DEFINITIONS\n  2458→): InsightClassificationResult {\n  2459→  const strengths: ClassifiedStrength[] = [];\n  2460→  const weaknesses: ClassifiedWeakness[] = [];\n  2461→\n  2462→  for (const insight of insightDefinitions) {\n  2463→    const { metrics, threshold } = insight.severity_logic;\n  2464→\n  2465→    // Find matching measurements for this insight\n  2466→    const matchedMetrics: MatchedMetric[] = [];\n  2467→    for (const metricName of metrics) {\n  2468→      const measurement = findMetricByName(metricName, measurements);\n  2469→      if (measurement) {\n  2470→        matchedMetrics.push({\n  2471→          metricId: measurement.metricId,\n  2472→          metricName: measurement.name,\n  2473→          score: measurement.score,\n  2474→          value: measurement.value,\n  2475→          idealMin: measurement.idealMin,\n  2476→          idealMax: measurement.idealMax,\n  2477→          unit: measurement.unit,\n  2478→          category: measurement.category,\n  2479→        });\n  2480→      }\n  2481→    }\n  2482→\n  2483→    // Skip if no metrics matched (need at least 1)\n  2484→    if (matchedMetrics.length === 0) continue;\n  2485→\n  2486→    // Calculate average score\n  2487→    const avgScore = matchedMetrics.reduce((sum, m) => sum + m.score, 0) / matchedMetrics.length;\n  2488→\n  2489→    // Classify based on type and threshold\n  2490→    if (insight.type === 'weakness') {\n  2491→      // Weakness: avg < threshold → add to areas of improvement\n  2492→      if (avgScore < threshold) {\n  2493→        // ========== FALSE POSITIVE CHECK ==========\n  2494→        // Before adding to weaknesses, check if ANY of the matched metrics\n  2495→        // are actually in an \"acceptable\" zone based on their polarity.\n  2496→        // If so, this is a false positive and should be skipped or reclassified.\n  2497→        const falsePositiveMetrics = matchedMetrics.filter(isFalsePositiveWeakness);\n  2498→\n  2499→        // If ALL matched metrics are false positives, skip this weakness entirely\n  2500→        if (falsePositiveMetrics.length === matchedMetrics.length) {\n  2501→          // This is a false positive weakness - the values are actually acceptable\n  2502→          // Consider adding to strengths if scores are decent\n  2503→          if (avgScore >= 6) {\n  2504→            strengths.push({\n  2505→              insightId: `${insight.id}_acceptable`,\n  2506→              title: insight.title.replace('Negative', 'Neutral').replace('Weak', 'Moderate'),\n  2507→              description: `While not in the peak ideal range, the measured values are within acceptable limits.`,\n  2508→              grade: 'good',\n  2509→              gradeLabel: 'Acceptable',\n  2510→              avgScore,\n  2511→              matchedMetrics,\n  2512→            });\n  2513→          }\n  2514→          continue; // Skip adding as weakness\n  2515→        }\n  2516→\n  2517→        // If SOME metrics are false positives, filter them out\n  2518→        const trueWeaknessMetrics = matchedMetrics.filter(m => !isFalsePositiveWeakness(m));\n  2519→        if (trueWeaknessMetrics.length === 0) continue;\n  2520→\n  2521→        // Recalculate average with only true weakness metrics\n  2522→        const trueAvgScore = trueWeaknessMetrics.reduce((sum, m) => sum + m.score, 0) / trueWeaknessMetrics.length;\n  2523→\n  2524→        // Only add as weakness if true average is still below threshold\n  2525→        if (trueAvgScore < threshold) {\n  2526→          const severity = getWeaknessSeverity(trueAvgScore);\n  2527→          const labels = insight.content.severity_labels;\n  2528→          const severityLabel = labels?.[severity] || severity;\n  2529→\n  2530→          weaknesses.push({\n  2531→            insightId: insight.id,\n  2532→            title: insight.title,\n  2533→            description: insight.content.description,\n  2534→            severity,\n  2535→            severityLabel,\n  2536→            avgScore: trueAvgScore,\n  2537→            matchedMetrics: trueWeaknessMetrics,\n  2538→          });\n  2539→        }\n  2540→      }\n  2541→    } else {\n  2542→      // Strength: avg > threshold → add to key strengths\n  2543→      if (avgScore > threshold) {\n  2544→        const grade = getStrengthGrade(avgScore);\n  2545→        const labels = insight.content.grade_labels;\n  2546→        const gradeLabel = labels?.[grade] || grade;\n  2547→\n  2548→        strengths.push({\n  2549→          insightId: insight.id,\n  2550→          title: insight.title,\n  2551→          description: insight.content.description,\n  2552→          grade,\n  2553→          gradeLabel,\n  2554→          avgScore,\n  2555→          matchedMetrics,\n  2556→        });\n  2557→      }\n  2558→    }\n  2559→  }\n  2560→\n  2561→  // Sort by score (weaknesses by lowest score first, strengths by highest first)\n  2562→  weaknesses.sort((a, b) => a.avgScore - b.avgScore);\n  2563→  strengths.sort((a, b) => b.avgScore - a.avgScore);\n  2564→\n  2565→  return { strengths, weaknesses };\n  2566→}\n  2567→\n  2568→/**\n  2569→ * Convert ClassifiedStrength to Strength type for UI compatibility\n  2570→ */\n  2571→export function convertToStrength(classified: ClassifiedStrength): Strength {\n  2572→  return {\n  2573→    id: `insight_strength_${classified.insightId}`,\n  2574→    strengthName: `${classified.title} (${classified.gradeLabel})`,\n  2575→    summary: classified.description,\n  2576→    avgScore: Math.max(0, Math.min(10, classified.avgScore)),  // Clamp to 0-10\n  2577→    qualityLevel: classified.grade === 'ideal' ? 'ideal' :\n  2578→                  classified.grade === 'excellent' ? 'excellent' : 'good',\n  2579→    categoryName: classified.matchedMetrics[0]?.category || 'General',\n  2580→    responsibleRatios: classified.matchedMetrics.map(m => ({\n  2581→      ratioName: m.metricName,\n  2582→      ratioId: m.metricId,\n  2583→      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n  2584→      value: m.value,\n  2585→      idealMin: m.idealMin,\n  2586→      idealMax: m.idealMax,\n  2587→      unit: m.unit,\n  2588→      category: m.category,\n  2589→    })),\n  2590→  };\n  2591→}\n  2592→\n  2593→/**\n  2594→ * Convert ClassifiedWeakness to Flaw type for UI compatibility\n  2595→ */\n  2596→export function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  2597→  const impact = (10 - classified.avgScore) * 0.5;\n  2598→  const newRollingLost = rollingLost + impact;\n  2599→\n  2600→  return {\n  2601→    id: `insight_flaw_${classified.insightId}`,\n  2602→    flawName: `${classified.title} (${classified.severityLabel})`,\n  2603→    summary: classified.description,\n  2604→    harmonyPercentageLost: impact,\n  2605→    standardizedImpact: impact / 10,\n  2606→    categoryName: classified.matchedMetrics[0]?.category || 'General',\n  2607→    responsibleRatios: classified.matchedMetrics.map(m => ({\n  2608→      ratioName: m.metricName,\n  2609→      ratioId: m.metricId,\n  2610→      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n  2611→      value: m.value,\n  2612→      idealMin: m.idealMin,\n  2613→      idealMax: m.idealMax,\n  2614→      unit: m.unit,\n  2615→      category: m.category,\n  2616→    })),\n  2617→    rollingPointsDeducted: newRollingLost,\n  2618→    rollingHarmonyPercentageLost: newRollingLost,\n  2619→    rollingStandardizedImpact: newRollingLost / 10,\n  2620→  };\n  2621→}\n  2622→\n  2623→/**\n  2624→ * Main function: Generate strengths and flaws from measurements using insights\n  2625→ */\n  2626→export function generateInsightBasedResults(\n  2627→  measurements: MetricScoreResult[]\n  2628→): { strengths: Strength[]; flaws: Flaw[] } {\n  2629→  const { strengths: classifiedStrengths, weaknesses: classifiedWeaknesses } = classifyInsights(measurements);\n  2630→\n  2631→  // Convert to UI-compatible types\n  2632→  const strengths = classifiedStrengths.map((s) => convertToStrength(s));\n  2633→\n  2634→  let rollingLost = 0;\n  2635→  const flaws = classifiedWeaknesses.map((w, i) => {\n  2636→    const flaw = convertToFlaw(w, i, rollingLost);\n  2637→    rollingLost = flaw.rollingPointsDeducted || 0;\n  2638→    return flaw;\n  2639→  });\n  2640→\n  2641→  return { strengths, flaws };\n  2642→}\n  2643→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"7c84fc6b-830d-4a0f-acb7-0d823caa187f","timestamp":"2025-12-26T14:49:56.312Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","content":"/**\n * Insights Engine\n *\n * Processes insight definitions from insights.json and classifies them\n * as strengths or areas of improvement based on user's metric scores.\n *\n * Logic:\n * - For each insight definition, calculate average score of affected metrics\n * - Weakness: if avg score < threshold → classify with severity label\n * - Strength: if avg score > threshold → classify with grade label\n *\n * Z-Score Based 5-Tier Severity Logic:\n * - Ideal (Green): User is inside the ideal range\n * - Good (Blue): Within 0.5 Standard Deviation of the mean (|z| < 0.5)\n * - Fair (Cyan): Between 0.5 and 1 Standard Deviation (0.5 ≤ |z| < 1)\n * - Moderate (Yellow): Between 1 and 2 Standard Deviations (1 ≤ |z| < 2)\n * - Severe (Red): More than 2 Standard Deviations away (|z| ≥ 2)\n *\n * Severity Labels (Weaknesses):\n *   0-3 = \"Severe\"\n *   3-5 = \"Moderate\"\n *   5-7 = \"Minor\"\n *\n * Grade Labels (Strengths):\n *   8-9   = \"Good\"\n *   9-9.5 = \"Excellent\"\n *   9.5-10 = \"Ideal\"\n */\n\nimport { Strength, Flaw } from '@/types/results';\nimport { MetricScoreResult, METRIC_CONFIGS, isValueAcceptable } from '@/lib/harmony-scoring';\n\n// ============================================\n// MASTER SCORING DATABASE (Z-Score Based)\n// ============================================\n\nexport type SeverityLevel = 'ideal' | 'good' | 'fair' | 'moderate' | 'severe';\nexport type Gender = 'male' | 'female';\nexport type Ethnicity = 'white' | 'black' | 'east_asian' | 'south_asian' | 'hispanic' | 'middle_eastern' | 'native_american' | 'pacific_islander';\n\nexport interface MasterMetricConfig {\n  ideal: [number, number];  // [min, max] ideal range\n  mean: number;             // Population mean\n  std_dev: number;          // Standard deviation\n  flaws?: {\n    low?: string[];         // Flaws when value is too low\n    high?: string[];        // Flaws when value is too high\n  };\n}\n\n// Base/Default standards (White Male baseline)\nexport const MASTER_SCORING_DB: Record<string, MasterMetricConfig> = {\n  // MIDFACE & PROPORTIONS\n  \"midface_ratio\": {\n    ideal: [0.97, 1.00],\n    mean: 1.0,\n    std_dev: 0.115,\n    flaws: { low: [\"Long midface\", \"Long upper jaw\"] }\n  },\n  \"faceWidthToHeight\": {\n    ideal: [1.30, 1.45],\n    mean: 1.38,\n    std_dev: 0.08,\n    flaws: {\n      low: [\"Overly long face\", \"Narrow face\"],\n      high: [\"Wide face\", \"Short face\"]\n    }\n  },\n  \"totalFacialWidthToHeight\": {\n    ideal: [1.25, 1.40],\n    mean: 1.33,\n    std_dev: 0.075,\n    flaws: {\n      low: [\"Long face shape\"],\n      high: [\"Wide face shape\"]\n    }\n  },\n  \"upperThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short forehead\"],\n      high: [\"Long forehead\"]\n    }\n  },\n  \"middleThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short midface\"],\n      high: [\"Long midface\"]\n    }\n  },\n  \"lowerThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short lower face\"],\n      high: [\"Long lower face\"]\n    }\n  },\n\n  // EYE SPACING & IPD\n  \"eye_separation_ratio\": {\n    ideal: [0.45, 0.47],\n    mean: 0.46,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"interpupillaryRatio\": {\n    ideal: [0.44, 0.48],\n    mean: 0.46,\n    std_dev: 0.025,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"oneEyeApartTest\": {\n    ideal: [0.95, 1.05],\n    mean: 1.0,\n    std_dev: 0.08,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"intercanthalWidth\": {\n    ideal: [30, 35],\n    mean: 32.5,\n    std_dev: 2.5,\n    flaws: {\n      low: [\"Narrow eye spacing\"],\n      high: [\"Wide eye spacing\"]\n    }\n  },\n\n  // EYE SHAPE & FEATURES\n  \"lateralCanthalTilt\": {\n    ideal: [6, 8],\n    mean: 5.0,\n    std_dev: 3.5,\n    flaws: {\n      low: [\"Negative canthal tilt\", \"Downturned eyes\"],\n      high: [\"Excessively upturned eyes\"]\n    }\n  },\n  \"eyeAspectRatio\": {\n    ideal: [0.30, 0.35],\n    mean: 0.32,\n    std_dev: 0.04,\n    flaws: {\n      low: [\"Narrow eyes\"],\n      high: [\"Round eyes\"]\n    }\n  },\n  \"palpebralFissureLength\": {\n    ideal: [28, 32],\n    mean: 30.0,\n    std_dev: 2.5,\n    flaws: {\n      low: [\"Small eyes\"],\n      high: [\"Large eyes\"]\n    }\n  },\n  \"eyeWidth\": {\n    ideal: [28, 32],\n    mean: 30.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Narrow eyes\"],\n      high: [\"Wide eyes\"]\n    }\n  },\n  \"upperEyelidExposure\": {\n    ideal: [0.5, 1.2],\n    mean: 0.85,\n    std_dev: 0.35,\n    flaws: {\n      low: [\"Hooded eyes\"],\n      high: [\"Excessive upper lid exposure\"]\n    }\n  },\n  \"tearTroughDepth\": {\n    ideal: [0.0, 0.3],\n    mean: 0.15,\n    std_dev: 0.15,\n    flaws: {\n      high: [\"Dark circles / Tear troughs\", \"Under-eye hollowness\"]\n    }\n  },\n\n  // JAW ANGLES & STRUCTURE\n  \"gonial_angle\": {\n    ideal: [115, 125],\n    mean: 118.0,\n    std_dev: 6.5,\n    flaws: {\n      high: [\"Weak/soft jaw structure\", \"Rounded jaw\"]\n    }\n  },\n  \"mandibularPlaneAngle\": {\n    ideal: [20, 28],\n    mean: 24.0,\n    std_dev: 4.0,\n    flaws: {\n      low: [\"Flat mandibular plane\"],\n      high: [\"Steep mandibular plane\", \"Hyper-divergent jaw\"]\n    }\n  },\n  \"jawFrontalAngle\": {\n    ideal: [125, 135],\n    mean: 130.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Steep jaw\"],\n      high: [\"Flat jaw angle\"]\n    }\n  },\n  \"jawSlope\": {\n    ideal: [25, 35],\n    mean: 30.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat jawline\"],\n      high: [\"Steep jawline\"]\n    }\n  },\n\n  // JAW WIDTH\n  \"jawWidthRatio\": {\n    ideal: [0.85, 0.95],\n    mean: 0.90,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Narrow jaw\"],\n      high: [\"Wide jaw\"]\n    }\n  },\n  \"bigonialWidth\": {\n    ideal: [110, 125],\n    mean: 117.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow jaw width\"],\n      high: [\"Excessively wide jaw\"]\n    }\n  },\n\n  // CHEEKBONES\n  \"cheekbone_height\": {\n    ideal: [83.0, 100.0],\n    mean: 85.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Low-set cheekbones\", \"Flat midface\"]\n    }\n  },\n  \"cheekboneWidth\": {\n    ideal: [130, 145],\n    mean: 137.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow cheekbones\"],\n      high: [\"Wide cheekbones\"]\n    }\n  },\n\n  // CHIN\n  \"chinPhiltrumRatio\": {\n    ideal: [1.8, 2.2],\n    mean: 2.0,\n    std_dev: 0.2,\n    flaws: {\n      low: [\"Recessed chin\", \"Short chin\"],\n      high: [\"Long chin\", \"Projected chin\"]\n    }\n  },\n  \"chinHeight\": {\n    ideal: [35, 45],\n    mean: 40.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Short chin\"],\n      high: [\"Long chin\"]\n    }\n  },\n  \"chinWidth\": {\n    ideal: [35, 45],\n    mean: 40.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Pointed/Narrow chin\"],\n      high: [\"Wide chin\"]\n    }\n  },\n\n  // NOSE ANGLES\n  \"nasalTipAngle\": {\n    ideal: [95, 115],\n    mean: 105.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Droopy nasal tip\"],\n      high: [\"Upturned nasal tip\"]\n    }\n  },\n  \"nasolabialAngle\": {\n    ideal: [95, 110],\n    mean: 102.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Droopy nasal tip\"],\n      high: [\"Upturned nose\"]\n    }\n  },\n  \"nasofrontalAngle\": {\n    ideal: [115, 135],\n    mean: 125.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Deep nasal root\"],\n      high: [\"Flat nasal root\"]\n    }\n  },\n  \"nasofacialAngle\": {\n    ideal: [30, 40],\n    mean: 35.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat nose profile\"],\n      high: [\"Overprojected nose\"]\n    }\n  },\n  \"nasomentaAngle\": {\n    ideal: [120, 135],\n    mean: 127.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Convex profile\"],\n      high: [\"Concave profile\"]\n    }\n  },\n\n  // NOSE WIDTH & PROPORTIONS\n  \"nasalIndex\": {\n    ideal: [65, 75],\n    mean: 70.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Narrow nose\"],\n      high: [\"Wide nose\", \"Bulbous nose\"]\n    }\n  },\n  \"noseWidth\": {\n    ideal: [35, 42],\n    mean: 38.5,\n    std_dev: 3.5,\n    flaws: {\n      low: [\"Narrow nose\"],\n      high: [\"Wide nasal base\"]\n    }\n  },\n  \"noseBridgeWidth\": {\n    ideal: [12, 18],\n    mean: 15.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Narrow nose bridge\"],\n      high: [\"Wide nose bridge\"]\n    }\n  },\n  \"nasalProjection\": {\n    ideal: [16, 22],\n    mean: 19.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Underprojected nose\"],\n      high: [\"Overprojected nose\"]\n    }\n  },\n  \"noseLengthRatio\": {\n    ideal: [0.45, 0.55],\n    mean: 0.50,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Short nose\"],\n      high: [\"Long nose\"]\n    }\n  },\n\n  // LIPS & PHILTRUM\n  \"lipRatio\": {\n    ideal: [1.4, 1.6],\n    mean: 1.5,\n    std_dev: 0.15,\n    flaws: {\n      low: [\"Thin upper lip\"],\n      high: [\"Thick upper lip\"]\n    }\n  },\n  \"philtrumLength\": {\n    ideal: [11, 15],\n    mean: 13.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Short philtrum\"],\n      high: [\"Long philtrum\"]\n    }\n  },\n  \"upperLipHeight\": {\n    ideal: [18, 24],\n    mean: 21.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Thin upper lip\"],\n      high: [\"Thick upper lip\"]\n    }\n  },\n  \"lipChinDistance\": {\n    ideal: [40, 50],\n    mean: 45.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Short lower third\"],\n      high: [\"Long lower third\"]\n    }\n  },\n  \"upperLipProjection\": {\n    ideal: [-2, 2],\n    mean: 0.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Recessed upper lip\"],\n      high: [\"Protruding upper lip\"]\n    }\n  },\n  \"lowerLipProjection\": {\n    ideal: [-1, 3],\n    mean: 1.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Recessed lower lip\"],\n      high: [\"Protruding lower lip\"]\n    }\n  },\n  \"cupidsBowDepth\": {\n    ideal: [3, 6],\n    mean: 4.5,\n    std_dev: 1.5,\n    flaws: {\n      low: [\"Flat cupid's bow\"],\n      high: [\"Pronounced cupid's bow\"]\n    }\n  },\n\n  // EYEBROWS\n  \"eyebrowHeight\": {\n    ideal: [8, 14],\n    mean: 11.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Low-set eyebrows\"],\n      high: [\"High eyebrows\"]\n    }\n  },\n  \"browLengthRatio\": {\n    ideal: [0.50, 0.60],\n    mean: 0.55,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Short eyebrows\"],\n      high: [\"Long eyebrows\"]\n    }\n  },\n  \"browLengthToFaceWidth\": {\n    ideal: [0.30, 0.38],\n    mean: 0.34,\n    std_dev: 0.04,\n    flaws: {\n      low: [\"Short eyebrows\"],\n      high: [\"Long eyebrows\"]\n    }\n  },\n  \"browridgeInclinationAngle\": {\n    ideal: [10, 20],\n    mean: 15.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat brow ridge\"],\n      high: [\"Prominent brow ridge\"]\n    }\n  },\n  \"eyebrowThickness\": {\n    ideal: [1.5, 3.0],\n    mean: 2.25,\n    std_dev: 0.75,\n    flaws: {\n      low: [\"Sparse/Weak eyebrows\"],\n      high: [\"Overly thick eyebrows\"]\n    }\n  },\n\n  // FOREHEAD\n  \"foreheadHeight\": {\n    ideal: [55, 70],\n    mean: 62.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Short forehead\"],\n      high: [\"Tall forehead\"]\n    }\n  },\n  \"bitemporalWidth\": {\n    ideal: [120, 135],\n    mean: 127.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow forehead\"],\n      high: [\"Wide forehead\"]\n    }\n  },\n\n  // PROFILE & DEPTH\n  \"facialDepthToHeight\": {\n    ideal: [0.75, 0.85],\n    mean: 0.80,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Flat facial profile\"],\n      high: [\"Overprojected profile\"]\n    }\n  },\n  \"anteriorFacialDepth\": {\n    ideal: [115, 130],\n    mean: 122.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Shallow face depth\"],\n      high: [\"Deep face projection\"]\n    }\n  },\n  \"totalProfileAngle\": {\n    ideal: [165, 175],\n    mean: 170.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Convex profile\"],\n      high: [\"Concave profile\"]\n    }\n  },\n\n  // ASYMMETRY\n  \"facialAsymmetryIndex\": {\n    ideal: [0, 3],\n    mean: 2.0,\n    std_dev: 1.5,\n    flaws: {\n      high: [\"Facial asymmetry\"]\n    }\n  },\n  \"eyeAsymmetry\": {\n    ideal: [0, 2],\n    mean: 1.0,\n    std_dev: 1.0,\n    flaws: {\n      high: [\"Eye asymmetry\"]\n    }\n  },\n  \"jawAsymmetry\": {\n    ideal: [0, 3],\n    mean: 1.5,\n    std_dev: 1.5,\n    flaws: {\n      high: [\"Jaw asymmetry\"]\n    }\n  },\n\n  // OTHER\n  \"recessionFrankfort\": {\n    ideal: [-2, 2],\n    mean: 0.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Maxillary recession\"],\n      high: [\"Maxillary protrusion\"]\n    }\n  },\n  \"neckWidth\": {\n    ideal: [110, 130],\n    mean: 120.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Narrow neck\"],\n      high: [\"Wide neck\"]\n    }\n  },\n  \"neckToJawRatio\": {\n    ideal: [0.90, 1.10],\n    mean: 1.0,\n    std_dev: 0.10,\n    flaws: {\n      low: [\"Narrow neck\"],\n      high: [\"Thick neck\"]\n    }\n  }\n};\n\n// ============================================\n// ETHNICITY-SPECIFIC OVERRIDES\n// ============================================\n\n/**\n * Ethnicity and gender-specific metric standards\n * These override the base MASTER_SCORING_DB values for specific populations\n */\nexport const ETHNICITY_OVERRIDES: Record<string, Record<string, Partial<MasterMetricConfig>>> = {\n  // ========================================\n  // MALE WHITE STANDARDS (Neoclassical Baseline)\n  // ========================================\n  \"male_white\": {\n    // NOSE WIDTH - Strict 1:1 ratio (Eye Width = Nose Width)\n    \"noseWidth\": {\n      ideal: [35, 42],  // Corresponds to alar_base_ratio [0.98, 1.05]\n      mean: 38.5,\n      std_dev: 3.5,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // MIDFACE - Prefers compact midface (Hunter look)\n    \"midface_ratio\": {\n      ideal: [0.95, 1.02],\n      mean: 0.985,\n      std_dev: 0.035,\n      flaws: {\n        low: [\"Long midface\"]\n      }\n    },\n\n    // JAW - Square/Robust jaw preference\n    \"gonial_angle\": {\n      ideal: [115.0, 125.0],\n      mean: 120.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Weak/Soft jaw structure\"]\n      }\n    },\n\n    // FACE WIDTH - Standard Mesoprosopic range\n    \"faceWidthToHeight\": {\n      ideal: [1.90, 2.05],\n      mean: 1.975,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Short/Wide face\"]\n      }\n    },\n\n    // EYE TILT - Neutral to slightly positive\n    \"lateralCanthalTilt\": {\n      ideal: [4.0, 8.0],\n      mean: 6.0,\n      std_dev: 2.0,\n      flaws: {\n        low: [\"Negative canthal tilt\"]\n      }\n    },\n\n    // LOWER FACE BALANCE\n    \"chinPhiltrumRatio\": {\n      ideal: [2.10, 2.30],\n      mean: 2.20,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Long philtrum / Short chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE BLACK / AFRICAN STANDARDS\n  // ========================================\n  \"male_black\": {\n    // NOSE WIDTH - Significantly wider tolerance\n    \"noseWidth\": {\n      ideal: [40, 50],  // Wider range (corresponds to alar_base_ratio [1.12, 1.25])\n      mean: 45.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n    \"nasalIndex\": {\n      ideal: [80, 95],  // Wider nasal index\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        high: [\"Wide nose\"]\n      }\n    },\n\n    // LIPS - Prefers fuller lips\n    \"lipRatio\": {\n      ideal: [1.2, 1.5],\n      mean: 1.35,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    },\n\n    // PHILTRUM - Shorter visible philtrum is ideal\n    \"philtrumLength\": {\n      ideal: [11.0, 14.0],\n      mean: 12.5,\n      std_dev: 1.5,\n      flaws: {\n        high: [\"Long philtrum\"]\n      }\n    },\n\n    // CHIN - Adjusts for natural forward mouth projection (Prognathism)\n    \"chinPhiltrumRatio\": {\n      ideal: [1.80, 2.10],  // Lower range to account for prognathism\n      mean: 1.95,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Recessed chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE EAST ASIAN STANDARDS\n  // ========================================\n  \"male_east_asian\": {\n    // EYE SPACING - Shifted WIDER for East Asian males\n    \"eye_separation_ratio\": {\n      ideal: [0.48, 0.53],  // Shifted wider (0.46 is \"close-set\" here)\n      mean: 0.505,\n      std_dev: 0.025,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Wide-set eyes\"]\n      }\n    },\n    \"interpupillaryRatio\": {\n      ideal: [0.48, 0.53],\n      mean: 0.505,\n      std_dev: 0.025,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Wide-set eyes\"]\n      }\n    },\n\n    // EYE SHAPE - Prefers narrower/longer eyes (Hunter Eyes)\n    \"eyeAspectRatio\": {\n      ideal: [0.25, 0.29],  // Lower ratio = more elongated\n      mean: 0.27,\n      std_dev: 0.02,\n      flaws: {\n        low: [\"Overly narrow eyes\"],\n        high: [\"Overly round eye shape\"]\n      }\n    },\n    \"palpebralFissureLength\": {\n      ideal: [29, 33],\n      mean: 31.0,\n      std_dev: 2.0,\n      flaws: {\n        low: [\"Small eyes\"],\n        high: [\"Large eyes\"]\n      }\n    },\n\n    // NOSE - Asian noses typically allowed to be wider\n    \"nasalIndex\": {\n      ideal: [75, 85],\n      mean: 80.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nose\"]\n      }\n    },\n    \"noseWidth\": {\n      ideal: [38, 45],\n      mean: 41.5,\n      std_dev: 3.5,\n      flaws: {\n        low: [\"Narrow nose\"],\n        high: [\"Very wide nasal base\"]\n      }\n    },\n    \"noseBridgeWidth\": {\n      ideal: [14, 20],\n      mean: 17.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Narrow nose bridge\"],\n        high: [\"Wide nose bridge\"]\n      }\n    },\n\n    // CHEEKS - Rewards slightly fuller cheeks (Youth/K-Pop aesthetic)\n    \"cheekbone_height\": {\n      ideal: [80.0, 95.0],\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Gaunt/Hollow face\"]\n      }\n    },\n\n    // JAW - Slightly softer angles acceptable\n    \"gonial_angle\": {\n      ideal: [118, 128],\n      mean: 123.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Weak/soft jaw structure\"]\n      }\n    },\n    \"mandibularPlaneAngle\": {\n      ideal: [20, 30],\n      mean: 25.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Flat mandibular plane\"],\n        high: [\"Steep mandibular plane\"]\n      }\n    },\n\n    // FACIAL PROPORTIONS - Wider faces more common\n    \"faceWidthToHeight\": {\n      ideal: [1.35, 1.50],\n      mean: 1.425,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n    \"totalFacialWidthToHeight\": {\n      ideal: [1.30, 1.45],\n      mean: 1.375,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long face shape\"],\n        high: [\"Wide face shape\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE SOUTH ASIAN STANDARDS\n  // ========================================\n  \"male_south_asian\": {\n    // NOSE WIDTH - Slightly wider tolerance than White\n    \"noseWidth\": {\n      ideal: [36, 43],  // alar_base_ratio [1.00, 1.08]\n      mean: 39.5,\n      std_dev: 3.5,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // TEAR TROUGH - VERY STRICT. High penalty for dark circles\n    \"tearTroughDepth\": {\n      ideal: [0.0, 0.5],\n      mean: 0.25,\n      std_dev: 0.25,\n      flaws: {\n        high: [\"Dark circles / Tear troughs\"]\n      }\n    },\n\n    // UPPER EYELID - Often prefers visible lid platform\n    \"upperEyelidExposure\": {\n      ideal: [0.5, 2.0],\n      mean: 1.25,\n      std_dev: 0.75,\n      flaws: {\n        low: [\"Hooded eyes\"]\n      }\n    },\n\n    // CHEEKS - Penalizes \"Gaunt\" looks heavily\n    \"cheekbone_height\": {\n      ideal: [83.0, 95.0],\n      mean: 89.0,\n      std_dev: 6.0,\n      flaws: {\n        low: [\"Volume loss / Gauntness\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE HISPANIC STANDARDS (\"The Bridge Model\")\n  // ========================================\n  \"male_hispanic\": {\n    // FACE WIDTH - Rewards broader, more robust face shapes (Mestizo)\n    \"faceWidthToHeight\": {\n      ideal: [1.95, 2.10],\n      mean: 2.025,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long/Narrow face\"]\n      }\n    },\n\n    // NOSE WIDTH - Bridge tolerance (Wider than White, narrower than Black)\n    \"noseWidth\": {\n      ideal: [36, 44],  // alar_base_ratio [1.00, 1.12]\n      mean: 40.0,\n      std_dev: 4.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // EYE TILT - Strong preference for positive tilt\n    \"lateralCanthalTilt\": {\n      ideal: [6.0, 12.0],\n      mean: 9.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Negative/Neutral canthal tilt\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE MIDDLE EASTERN STANDARDS\n  // ========================================\n  \"male_middle_eastern\": {\n    // EYEBROW THICKNESS - Prefers significantly thicker/darker brows\n    \"eyebrowThickness\": {\n      ideal: [2.0, 4.0],\n      mean: 3.0,\n      std_dev: 1.0,\n      flaws: {\n        low: [\"Sparse/Weak eyebrows\"],\n        high: [\"Unibrow\"]\n      }\n    },\n\n    // NASOLABIAL ANGLE - Penalizes droopy tip (<90) or hooked noses\n    \"nasolabialAngle\": {\n      ideal: [90.0, 100.0],\n      mean: 95.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Droopy nose tip / Hooked nose\"]\n      }\n    },\n\n    // EYE TILT - Strong preference for Almond/Hunter eye shape\n    \"lateralCanthalTilt\": {\n      ideal: [4.0, 10.0],\n      mean: 7.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    },\n\n    // MIDFACE - Similar to White model (Compact is better)\n    \"midface_ratio\": {\n      ideal: [0.95, 1.02],\n      mean: 0.985,\n      std_dev: 0.035,\n      flaws: {\n        low: [\"Long midface\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE PACIFIC ISLANDER STANDARDS (\"The Warrior Skull\")\n  // ========================================\n  \"male_pacific_islander\": {\n    // FACE WIDTH - The Highest Width Standard (Very broad)\n    \"faceWidthToHeight\": {\n      ideal: [2.10, 2.30],\n      mean: 2.20,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Narrow/Long face\"]\n      }\n    },\n\n    // NOSE WIDTH - Wide tolerance\n    \"noseWidth\": {\n      ideal: [38, 48],  // alar_base_ratio [1.05, 1.20]\n      mean: 43.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // CHEEKS - Rewards high mass/robustness\n    \"cheekbone_height\": {\n      ideal: [85.0, 100.0],\n      mean: 92.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Gaunt/Weak face structure\"]\n      }\n    },\n\n    // CHIN WIDTH - Prefers a very broad, square chin\n    \"chinWidth\": {\n      ideal: [40.0, 50.0],\n      mean: 45.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Pointed/Narrow chin\"]\n      }\n    }\n  },\n\n  \"male_native_american\": {\n    \"faceWidthToHeight\": {\n      ideal: [2.00, 2.20],\n      mean: 2.10,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Wide face\"]\n      }\n    },\n\n    \"nasalIndex\": {\n      ideal: [75, 90],\n      mean: 82.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Narrow nose\"],\n        high: [\"Wide nose\"]\n      }\n    },\n\n    \"cheekbone_height\": {\n      ideal: [80.0, 95.0],\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Flat cheekbones\"]\n      }\n    },\n\n    \"gonialAngle\": {\n      ideal: [115, 125],\n      mean: 120,\n      std_dev: 5,\n      flaws: {\n        low: [\"Weak jaw\"],\n        high: [\"Harsh jaw angle\"]\n      }\n    },\n\n    \"chinWidth\": {\n      ideal: [38.0, 48.0],\n      mean: 43.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Narrow chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // FEMALE ETHNICITIES (The \"Missing Link\")\n  // ========================================\n\n  \"female_white\": {\n    // NOSE WIDTH - Strict Rule of Fifths for feminine harmony\n    \"alar_base_ratio\": {\n      ideal: [0.98, 1.05],\n      mean: 1.015,\n      std_dev: 0.035,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // FACE WIDTH - Prefers oval/narrow feminine proportions\n    \"fwhr\": {\n      ideal: [1.45, 1.53],\n      mean: 1.49,\n      std_dev: 0.04,\n      flaws: {\n        low: [\"Long/Narrow face\"],\n        high: [\"Wide face\"]\n      }\n    },\n\n    // JAW - Soft, tapered feminine jawline\n    \"gonial_angle\": {\n      ideal: [122.0, 130.0],\n      mean: 126.0,\n      std_dev: 4.0,\n      flaws: {\n        low: [\"Sharp/Masculine jaw angle\"],\n        high: [\"Weak/Overly soft jawline\"]\n      }\n    },\n\n    // EYE TILT - Neutral to positive preferred\n    \"canthal_tilt\": {\n      ideal: [4.0, 9.0],\n      mean: 6.5,\n      std_dev: 2.5,\n      flaws: {\n        low: [\"Negative/Downturned eyes\"]\n      }\n    },\n\n    // CHIN-PHILTRUM - Golden Ratio balance\n    \"chin_philtrum_ratio\": {\n      ideal: [2.0, 2.2],\n      mean: 2.1,\n      std_dev: 0.1,\n      flaws: {\n        low: [\"Recessed chin\"],\n        high: [\"Protruding chin\"]\n      }\n    }\n  },\n\n  \"female_black\": {\n    // LIPS - High volume preference (fuller lips)\n    \"lipRatio\": {\n      ideal: [1.3, 1.6],\n      mean: 1.45,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    },\n\n    // NOSE WIDTH - Wider tolerance for ethnic variation\n    \"alar_base_ratio\": {\n      ideal: [1.05, 1.15],\n      mean: 1.10,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Very wide nasal base\"]\n      }\n    },\n\n    // CHIN - Allows forward projection (natural prognathism)\n    \"chin_projection\": {\n      ideal: [0.0, 5.0],\n      mean: 2.5,\n      std_dev: 2.5,\n      flaws: {\n        high: [\"Excessive chin projection\"]\n      }\n    },\n\n    // JAW - Soft feminine jawline\n    \"gonial_angle\": {\n      ideal: [120.0, 130.0],\n      mean: 125.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Sharp jaw angle\"],\n        high: [\"Weak jawline\"]\n      }\n    }\n  },\n\n  \"female_east_asian\": {\n    // EYE SPACING - Wide-set neotenous preference\n    \"eye_separation_ratio\": {\n      ideal: [46.3, 47.5],\n      mean: 46.9,\n      std_dev: 0.6,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Very wide-set eyes\"]\n      }\n    },\n\n    // JAW - Tapered V-shape feminine ideal\n    \"gonial_angle\": {\n      ideal: [120.0, 126.0],\n      mean: 123.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Sharp V-line jaw\"],\n        high: [\"Weak/Square jawline\"]\n      }\n    },\n\n    // EYEBROWS - Higher set brows (youthful feminine)\n    \"eyebrow_height\": {\n      ideal: [0.85, 1.30],\n      mean: 1.075,\n      std_dev: 0.225,\n      flaws: {\n        low: [\"Low-set/Heavy brows\"],\n        high: [\"Very high-arched brows\"]\n      }\n    },\n\n    // LOWER FACE - Compact lower third (neotenous)\n    \"lower_third_ratio\": {\n      ideal: [29.6, 32.7],\n      mean: 31.15,\n      std_dev: 1.55,\n      flaws: {\n        low: [\"Very short lower face\"],\n        high: [\"Long lower face\"]\n      }\n    }\n  },\n\n  \"female_south_asian\": {\n    // TEAR TROUGHS - Very strict on dark circles\n    \"tear_trough_depth\": {\n      ideal: [0.0, 0.5],\n      mean: 0.25,\n      std_dev: 0.25,\n      flaws: {\n        high: [\"Dark circles / Deep tear troughs\"]\n      }\n    },\n\n    // CHEEKS - Rewards midface volume (youthful fullness)\n    \"cheek_fullness\": {\n      ideal: [1.0, 2.0],\n      mean: 1.5,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Gaunt/Hollow cheeks\"]\n      }\n    },\n\n    // SKIN - High penalty for uneven skin tone\n    \"skin_uniformity\": {\n      ideal: [0.92, 1.0],\n      mean: 0.96,\n      std_dev: 0.04,\n      flaws: {\n        low: [\"Uneven skin tone / Pigmentation\"]\n      }\n    },\n\n    // NOSE WIDTH - Intermediate tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.00, 1.08],\n      mean: 1.04,\n      std_dev: 0.04,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    }\n  },\n\n  \"female_hispanic\": {\n    // FACE WIDTH - Broader Mestiza tolerance\n    \"fwhr\": {\n      ideal: [1.50, 1.62],\n      mean: 1.56,\n      std_dev: 0.06,\n      flaws: {\n        low: [\"Long/Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // EYE TILT - Strong almond eye preference\n    \"canthal_tilt\": {\n      ideal: [6.0, 12.0],\n      mean: 9.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Neutral/Downturned eyes\"]\n      }\n    },\n\n    // NOSE WIDTH - Intermediate width tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.00, 1.10],\n      mean: 1.05,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // LIPS - Voluptuous preference\n    \"lipRatio\": {\n      ideal: [1.1, 1.35],\n      mean: 1.225,\n      std_dev: 0.125,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    }\n  },\n\n  \"female_middle_eastern\": {\n    // EYEBROWS - Dense/Thick brows preference\n    \"eyebrow_thickness\": {\n      ideal: [1.5, 3.0],\n      mean: 2.25,\n      std_dev: 0.75,\n      flaws: {\n        low: [\"Sparse/Thin eyebrows\"],\n        high: [\"Unibrow\"]\n      }\n    },\n\n    // NOSE - Refined/Upturned tip\n    \"nasolabial_angle\": {\n      ideal: [95.0, 105.0],\n      mean: 100.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Droopy nose tip\"],\n        high: [\"Overly upturned nose\"]\n      }\n    },\n\n    // EYE TILT - Foxy/Hunter feminine eye shape\n    \"canthal_tilt\": {\n      ideal: [5.0, 10.0],\n      mean: 7.5,\n      std_dev: 2.5,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    },\n\n    // EYELID - Low exposure preferred\n    \"upper_eyelid_exposure\": {\n      ideal: [0.5, 1.5],\n      mean: 1.0,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Hooded eyes\"],\n        high: [\"Excessive eyelid exposure\"]\n      }\n    }\n  },\n\n  \"female_native_american\": {\n    // FACE WIDTH - Wide/High cheekbone structure\n    \"fwhr\": {\n      ideal: [1.52, 1.65],\n      mean: 1.585,\n      std_dev: 0.065,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // CHEEKBONES - High definition/prominence\n    \"cheekbone_prominence\": {\n      ideal: [1.5, 2.5],\n      mean: 2.0,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Flat cheekbones\"],\n        high: [\"Overly prominent cheekbones\"]\n      }\n    },\n\n    // JAW - Stronger jaw tolerance\n    \"gonial_angle\": {\n      ideal: [115.0, 125.0],\n      mean: 120.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Very sharp jaw\"],\n        high: [\"Weak jawline\"]\n      }\n    },\n\n    // EYE TILT - Positive tilt preference\n    \"canthal_tilt\": {\n      ideal: [5.0, 11.0],\n      mean: 8.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    }\n  },\n\n  \"female_pacific_islander\": {\n    // FACE WIDTH - Widest/Robust facial structure\n    \"fwhr\": {\n      ideal: [1.55, 1.70],\n      mean: 1.625,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // CHEEKS - High volume/softness preference\n    \"cheek_fullness\": {\n      ideal: [1.2, 2.5],\n      mean: 1.85,\n      std_dev: 0.65,\n      flaws: {\n        low: [\"Gaunt/Hollow cheeks\"]\n      }\n    },\n\n    // NOSE WIDTH - Wide nose tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.05, 1.15],\n      mean: 1.10,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Very wide nasal base\"]\n      }\n    },\n\n    // LIPS - Full lips preference\n    \"lipRatio\": {\n      ideal: [1.25, 1.50],\n      mean: 1.375,\n      std_dev: 0.125,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    }\n  }\n};\n\n/**\n * Get the appropriate metric configuration for a given gender and ethnicity\n * Falls back to base config if no override exists\n */\nexport function getMetricConfig(\n  metricId: string,\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'white'\n): MasterMetricConfig | undefined {\n  const key = `${gender}_${ethnicity}`;\n  const override = ETHNICITY_OVERRIDES[key]?.[metricId];\n  const baseConfig = MASTER_SCORING_DB[metricId];\n\n  if (!baseConfig) return undefined;\n\n  // Merge override with base config\n  if (override) {\n    return {\n      ...baseConfig,\n      ...override,\n      flaws: {\n        ...baseConfig.flaws,\n        ...override.flaws\n      }\n    } as MasterMetricConfig;\n  }\n\n  return baseConfig;\n}\n\n// ============================================\n// Z-SCORE SEVERITY FUNCTIONS\n// ============================================\n\n/**\n * Calculate Z-score for a given value\n * Z = (value - mean) / std_dev\n */\nexport function calculateZScore(value: number, mean: number, stdDev: number): number {\n  if (stdDev === 0) return 0;\n  return Math.abs((value - mean) / stdDev);\n}\n\n/**\n * Determine severity level based on Z-score and ideal range (5-tier system)\n * - Ideal: Value is within ideal range\n * - Good: |z| < 0.5 (within 0.5 standard deviation)\n * - Fair: 0.5 ≤ |z| < 1 (between 0.5-1 standard deviations)\n * - Moderate: 1 ≤ |z| < 2 (between 1-2 standard deviations)\n * - Severe: |z| ≥ 2 (more than 2 standard deviations away)\n */\nexport function getSeverityFromZScore(\n  value: number,\n  config: MasterMetricConfig\n): { severity: SeverityLevel; zScore: number; isInIdeal: boolean } {\n  const { ideal, mean, std_dev } = config;\n  const isInIdeal = value >= ideal[0] && value <= ideal[1];\n  const zScore = calculateZScore(value, mean, std_dev);\n\n  let severity: SeverityLevel;\n  if (isInIdeal) {\n    severity = 'ideal';\n  } else if (zScore < 0.5) {\n    severity = 'good';\n  } else if (zScore < 1) {\n    severity = 'fair';\n  } else if (zScore < 2) {\n    severity = 'moderate';\n  } else {\n    severity = 'severe';\n  }\n\n  return { severity, zScore, isInIdeal };\n}\n\n/**\n * Get severity for a metric value with ethnicity/gender awareness\n */\nexport function getSeverityForMetric(\n  metricId: string,\n  value: number,\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'white'\n): { severity: SeverityLevel; zScore: number; isInIdeal: boolean; config: MasterMetricConfig } | null {\n  const config = getMetricConfig(metricId, gender, ethnicity);\n  if (!config) return null;\n\n  const result = getSeverityFromZScore(value, config);\n  return { ...result, config };\n}\n\n/**\n * Get badge color for severity level (5-tier)\n */\nexport function getSeverityColor(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'green';\n    case 'good': return 'blue';\n    case 'fair': return 'cyan';\n    case 'moderate': return 'yellow';\n    case 'severe': return 'red';\n    default: return 'gray';\n  }\n}\n\n/**\n * Get severity label for display (5-tier)\n */\nexport function getSeverityLabel(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'Ideal';\n    case 'good': return 'Good';\n    case 'fair': return 'Fair';\n    case 'moderate': return 'Moderate';\n    case 'severe': return 'Severe';\n    default: return 'Unknown';\n  }\n}\n\n// ============================================\n// INSIGHT DEFINITION TYPES\n// ============================================\n\nexport interface InsightSeverityLogic {\n  metrics: string[];  // Display names of metrics (e.g., \"Face Width to Height Ratio\")\n  threshold: number;  // Score threshold for classification\n}\n\nexport interface WeaknessSeverityLabels {\n  minor: string;\n  moderate: string;\n  severe: string;\n}\n\nexport interface StrengthGradeLabels {\n  good: string;\n  excellent: string;\n  ideal: string;\n}\n\nexport interface InsightContent {\n  description: string;\n  severity_labels?: WeaknessSeverityLabels;  // For weaknesses\n  grade_labels?: StrengthGradeLabels;        // For strengths\n}\n\nexport interface InsightDefinition {\n  id: string;\n  title: string;\n  type: 'weakness' | 'strength';\n  severity_logic: InsightSeverityLogic;\n  content: InsightContent;\n}\n\n// ============================================\n// CLASSIFICATION RESULT TYPES\n// ============================================\n\nexport type WeaknessSeverity = 'severe' | 'moderate' | 'minor';\nexport type StrengthGrade = 'ideal' | 'excellent' | 'good';\n\nexport interface ClassifiedWeakness {\n  insightId: string;\n  title: string;\n  description: string;\n  severity: WeaknessSeverity;\n  severityLabel: string;  // Custom label from definition (e.g., \"Extremely Long\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n}\n\nexport interface ClassifiedStrength {\n  insightId: string;\n  title: string;\n  description: string;\n  grade: StrengthGrade;\n  gradeLabel: string;  // Custom label from definition (e.g., \"Ideal\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n}\n\nexport interface MatchedMetric {\n  metricId: string;\n  metricName: string;\n  score: number;\n  value: number;\n  idealMin: number;\n  idealMax: number;\n  unit: string;\n  category: string;\n}\n\nexport interface InsightClassificationResult {\n  strengths: ClassifiedStrength[];\n  weaknesses: ClassifiedWeakness[];\n}\n\n// ============================================\n// INSIGHTS DATABASE\n// ============================================\n\nexport const INSIGHTS_DEFINITIONS: InsightDefinition[] = [\n  {\n    id: \"long_midface\",\n    title: \"Long Midface\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\", \"Ipsilateral Alar Angle\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The middle of the face is elongated, creating an unbalanced vertical proportion.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Extremely Long\" }\n    }\n  },\n  {\n    id: \"short_midface\",\n    title: \"Short Midface\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The midface has ideal vertical proportions, contributing to facial harmony.\",\n      grade_labels: { good: \"Proportionate\", excellent: \"Well-Balanced\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"weak_jaw\",\n    title: \"Weak/Soft Jaw Structure\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Chin to Philtrum Ratio\", \"Jaw Slope\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The jaw has a softer, rounder shape, often less angular and robust than the ideal.\",\n      severity_labels: { minor: \"Soft\", moderate: \"Recessed\", severe: \"Weak\" }\n    }\n  },\n  {\n    id: \"strong_jaw\",\n    title: \"Strong Jaw Definition\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Jaw Width Ratio\", \"Bigonial Width\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The jaw displays strong definition with well-defined angles and proportionate width.\",\n      grade_labels: { good: \"Defined\", excellent: \"Strong\", ideal: \"Ideal Angular\" }\n    }\n  },\n  {\n    id: \"refined_nasal_tip\",\n    title: \"Refined Nasal Tip\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasal Tip Angle\", \"Nose Tip Position\", \"Frankfort-tip Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious nasal profile due to the nasal tip being well-defined and proportionate.\",\n      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"bulbous_nose\",\n    title: \"Bulbous Nasal Tip\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Index\", \"Nose Width\", \"Nasal Tip Angle\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nasal tip appears rounded and less defined, affecting nasal aesthetics.\",\n      severity_labels: { minor: \"Slightly Rounded\", moderate: \"Rounded\", severe: \"Bulbous\" }\n    }\n  },\n  {\n    id: \"ideal_upper_lip\",\n    title: \"Well-Positioned Upper Lip\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Upper Lip E-Line Position\", \"Upper Lip S-Line Position\", \"Nasolabial Angle\"],\n      threshold: 9.0\n    },\n    content: {\n      description: \"This contributes to a harmonious mouth region due to the upper lip sitting neither too far forward nor too far back.\",\n      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"negative_canthal_tilt\",\n    title: \"Negative Canthal Tilt\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The outer corners of the eyes sit lower than the inner corners, creating a downturned appearance.\",\n      severity_labels: { minor: \"Slight Downturn\", moderate: \"Noticeable\", severe: \"Pronounced\" }\n    }\n  },\n  {\n    id: \"positive_canthal_tilt\",\n    title: \"Positive Canthal Tilt\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The outer corners of the eyes are elevated, creating an attractive upswept eye shape.\",\n      grade_labels: { good: \"Slight Upturn\", excellent: \"Well-Tilted\", ideal: \"Hunter Eyes\" }\n    }\n  },\n  {\n    id: \"balanced_facial_thirds\",\n    title: \"Balanced Facial Thirds\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face displays well-balanced vertical proportions across all three facial thirds.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfectly Proportioned\" }\n    }\n  },\n  {\n    id: \"imbalanced_thirds\",\n    title: \"Facial Third Imbalance\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The vertical face proportions show imbalance between the three facial thirds.\",\n      severity_labels: { minor: \"Slight Imbalance\", moderate: \"Noticeable Disproportion\", severe: \"Significant Imbalance\" }\n    }\n  },\n  {\n    id: \"high_cheekbones\",\n    title: \"High Cheekbones\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Cheekbone Height\", \"Cheekbone Width\", \"Midface Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"Well-positioned cheekbones that create attractive facial contours and catch light beautifully.\",\n      grade_labels: { good: \"Visible\", excellent: \"Prominent\", ideal: \"Model-Tier\" }\n    }\n  },\n  {\n    id: \"flat_midface\",\n    title: \"Flat Midface\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Cheekbone Height\", \"Midface Ratio\", \"Total Facial Width to Height\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The midface lacks forward projection, resulting in flatter facial contours.\",\n      severity_labels: { minor: \"Slightly Flat\", moderate: \"Underprojected\", severe: \"Recessed\" }\n    }\n  },\n  {\n    id: \"ideal_lip_ratio\",\n    title: \"Ideal Lip Proportions\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Lip Ratio\", \"Philtrum Length\", \"Lip Chin Distance\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The lips demonstrate excellent proportions with balanced upper-to-lower lip ratio.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Well-Proportioned\", ideal: \"Perfect Ratio\" }\n    }\n  },\n  {\n    id: \"thin_lips\",\n    title: \"Thin Lip Profile\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Lip Ratio\", \"Upper Lip Projection\", \"Lower Lip Projection\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The lips appear thinner than ideal proportions, affecting lower face harmony.\",\n      severity_labels: { minor: \"Slightly Thin\", moderate: \"Thin\", severe: \"Very Thin\" }\n    }\n  },\n  {\n    id: \"ideal_ipd\",\n    title: \"Ideal Eye Spacing\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The eyes are ideally spaced, creating facial balance and attractiveness.\",\n      grade_labels: { good: \"Good Spacing\", excellent: \"Ideal Distance\", ideal: \"Perfect IPD\" }\n    }\n  },\n  {\n    id: \"wide_set_eyes\",\n    title: \"Wide-Set Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes are spaced wider apart than the aesthetic ideal.\",\n      severity_labels: { minor: \"Slightly Wide\", moderate: \"Noticeably Wide\", severe: \"Very Wide\" }\n    }\n  },\n  {\n    id: \"close_set_eyes\",\n    title: \"Close-Set Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"Intercanthal Width\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes are positioned closer together than the aesthetic ideal.\",\n      severity_labels: { minor: \"Slightly Close\", moderate: \"Noticeably Close\", severe: \"Very Close\" }\n    }\n  },\n  {\n    id: \"ideal_nose_projection\",\n    title: \"Ideal Nasal Projection\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasofrontal Angle\", \"Nasofacial Angle\", \"Nasomenta Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The nose has ideal forward projection relative to the face, creating profile harmony.\",\n      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect Projection\" }\n    }\n  },\n  {\n    id: \"recessed_chin\",\n    title: \"Recessed Chin\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Facial Depth to Height\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The chin sits behind the ideal position, affecting profile balance.\",\n      severity_labels: { minor: \"Slightly Recessed\", moderate: \"Recessed\", severe: \"Severely Recessed\" }\n    }\n  },\n  {\n    id: \"ideal_chin_projection\",\n    title: \"Ideal Chin Projection\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Anterior Facial Depth\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The chin demonstrates ideal projection and proportions relative to the face.\",\n      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect\" }\n    }\n  },\n  {\n    id: \"long_philtrum\",\n    title: \"Long Philtrum\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Philtrum Length\", \"Lip Chin Distance\", \"Upper Lip Height\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The distance between nose and upper lip is longer than ideal.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n    }\n  },\n  {\n    id: \"short_philtrum\",\n    title: \"Short Philtrum\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Philtrum Length\", \"Upper Lip Height\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The philtrum has ideal or shorter length, considered youthful and attractive.\",\n      grade_labels: { good: \"Good Length\", excellent: \"Short\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"wide_nose\",\n    title: \"Wide Nasal Base\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Index\", \"Intercanthal Nasal Ratio\", \"Nose Bridge Width\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The base of the nose is wider than the aesthetic ideal for facial harmony.\",\n      severity_labels: { minor: \"Slightly Wide\", moderate: \"Wide\", severe: \"Very Wide\" }\n    }\n  },\n  {\n    id: \"ideal_brow_position\",\n    title: \"Ideal Brow Position\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Eyebrow Height\", \"Brow Length Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The eyebrows are ideally positioned relative to the eyes and facial structure.\",\n      grade_labels: { good: \"Good Position\", excellent: \"Well-Arched\", ideal: \"Perfect Frame\" }\n    }\n  },\n  {\n    id: \"narrow_jaw\",\n    title: \"Narrow Jaw\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Jaw Width Ratio\", \"Bigonial Width\", \"Jaw Frontal Angle\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The jaw is narrower than ideal, affecting lower face width and definition.\",\n      severity_labels: { minor: \"Slightly Narrow\", moderate: \"Narrow\", severe: \"Very Narrow\" }\n    }\n  },\n  {\n    id: \"steep_mandibular_plane\",\n    title: \"Steep Mandibular Plane\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The mandibular plane angle is steeper than ideal, often indicating vertical growth pattern.\",\n      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n    }\n  },\n  // ============================================\n  // INSIGHT DEFINITIONS (element.html / element1.html)\n  // ============================================\n  // --- WEAKNESSES ---\n  {\n    id: \"steep_jaw\",\n    title: \"Steep Jaw\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Jaw Frontal Angle\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The jaw angles sharply downward, creating a narrow or pointed chin effect.\",\n      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n    }\n  },\n  {\n    id: \"maxillary_recession\",\n    title: \"Maxillary Recession\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Facial Depth to Height Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The upper jaw is less forward than ideal, reducing midface projection and facial harmony.\",\n      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n    }\n  },\n  {\n    id: \"mandibular_recession\",\n    title: \"Mandibular Recession\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The lower jaw is set back, creating a less prominent chin and an unbalanced profile.\",\n      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n    }\n  },\n  {\n    id: \"underprojected_chin\",\n    title: \"Underprojected Chin\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\", \"Chin Height\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The chin lacks forward projection, creating a weak lower face appearance.\",\n      severity_labels: { minor: \"Slightly Weak\", moderate: \"Underprojected\", severe: \"Severely Underprojected\" }\n    }\n  },\n  {\n    id: \"overly_long_face\",\n    title: \"Overly Long Face Shape\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Total Facial Width to Height Ratio\", \"Face Width to Height Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The face is excessively tall and narrow, creating an elongated appearance.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n    }\n  },\n  {\n    id: \"hyper_divergent_jaw\",\n    title: \"Hyper-Divergent Jaw Growth\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The jaw grows with an overly steep angle, resulting in a long or narrow lower face. This can indicate malocclusion.\",\n      severity_labels: { minor: \"Mildly Divergent\", moderate: \"Divergent\", severe: \"Hyper-Divergent\" }\n    }\n  },\n  {\n    id: \"weak_brow_ridge\",\n    title: \"Soft/Weak Brow Ridge\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Browridge Inclination Angle\", \"Eyebrow Height\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The forehead has a softer, less prominent ridge than the ideal, reducing masculine definition.\",\n      severity_labels: { minor: \"Slightly Soft\", moderate: \"Soft\", severe: \"Very Weak\" }\n    }\n  },\n  {\n    id: \"droopy_nasal_tip\",\n    title: \"Droopy Nasal Tip\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\", \"Nasofacial Angle\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nasal tip points downward more than ideal, creating a drooping appearance.\",\n      severity_labels: { minor: \"Slightly Droopy\", moderate: \"Droopy\", severe: \"Very Droopy\" }\n    }\n  },\n  {\n    id: \"overprojected_nose\",\n    title: \"Overprojected Nose\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Projection\", \"Nasofacial Angle\", \"Nose Length Ratio\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nose projects too far forward relative to the face, creating imbalance.\",\n      severity_labels: { minor: \"Slightly Projected\", moderate: \"Overprojected\", severe: \"Very Overprojected\" }\n    }\n  },\n  {\n    id: \"small_eyes\",\n    title: \"Small Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Eye Aspect Ratio\", \"Palpebral Fissure Length\", \"Eye Width\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes appear smaller than the aesthetic ideal relative to the face.\",\n      severity_labels: { minor: \"Slightly Small\", moderate: \"Small\", severe: \"Very Small\" }\n    }\n  },\n  {\n    id: \"low_set_eyebrows\",\n    title: \"Low-Set Eyebrows\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Eyebrow Height\", \"Brow to Hairline Distance\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyebrows sit lower than ideal, reducing the visible upper eyelid space.\",\n      severity_labels: { minor: \"Slightly Low\", moderate: \"Low\", severe: \"Very Low\" }\n    }\n  },\n  {\n    id: \"asymmetrical_face\",\n    title: \"Facial Asymmetry\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The left and right sides of the face show noticeable differences in proportion or position.\",\n      severity_labels: { minor: \"Slight Asymmetry\", moderate: \"Noticeable Asymmetry\", severe: \"Significant Asymmetry\" }\n    }\n  },\n  // --- STRENGTHS ---\n  {\n    id: \"good_jaw_width\",\n    title: \"Good Jaw Width\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Bigonial Width\", \"Jaw Width Ratio\", \"Jaw Frontal Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a pleasant jaw contour due to the jaw being neither too wide nor too narrow.\",\n      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n    }\n  },\n  {\n    id: \"good_forehead_slope\",\n    title: \"Good Forehead Slope\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Browridge Inclination Angle\", \"Forehead Height\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a pleasant forehead contour by indicating that the forehead is neither too steep nor too flat.\",\n      grade_labels: { good: \"Good Slope\", excellent: \"Well-Angled\", ideal: \"Ideal Slope\" }\n    }\n  },\n  {\n    id: \"good_cupids_bow\",\n    title: \"Good Cupid's Bow Depth\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Cupids Bow Depth\", \"Upper Lip Height\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious lip region due to the cupid's bow having ideal definition and depth.\",\n      grade_labels: { good: \"Defined\", excellent: \"Well-Defined\", ideal: \"Perfectly Defined\" }\n    }\n  },\n  {\n    id: \"good_eyebrow_length\",\n    title: \"Good Eyebrow Length\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Brow Length to Face Width Ratio\", \"Brow Length Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious eye region due to the eyebrows having ideal horizontal length relative to face width.\",\n      grade_labels: { good: \"Good Length\", excellent: \"Well-Proportioned\", ideal: \"Ideal Length\" }\n    }\n  },\n  {\n    id: \"good_neck_width\",\n    title: \"Good Neck Width\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Neck Width\", \"Neck to Jaw Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious lower face due to the neck being neither too wide nor too thin.\",\n      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n    }\n  },\n  {\n    id: \"ideal_nasolabial_angle\",\n    title: \"Ideal Nasolabial Angle\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The angle between nose and upper lip is in the ideal range, creating profile harmony.\",\n      grade_labels: { good: \"Good Angle\", excellent: \"Well-Angled\", ideal: \"Perfect Angle\" }\n    }\n  },\n  {\n    id: \"ideal_facial_depth\",\n    title: \"Ideal Facial Depth\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Facial Depth to Height Ratio\", \"Anterior Facial Depth\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face has ideal forward projection creating attractive three-dimensional contours.\",\n      grade_labels: { good: \"Good Depth\", excellent: \"Well-Projected\", ideal: \"Ideal Projection\" }\n    }\n  },\n  {\n    id: \"ideal_eye_shape\",\n    title: \"Ideal Eye Shape\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Eye Aspect Ratio\", \"Lateral Canthal Tilt\", \"Palpebral Fissure Length\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The eyes have an attractive almond shape with ideal proportions and tilt.\",\n      grade_labels: { good: \"Attractive\", excellent: \"Well-Shaped\", ideal: \"Hunter Eyes\" }\n    }\n  },\n  {\n    id: \"harmonious_profile\",\n    title: \"Harmonious Profile\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Total Profile Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The facial profile shows excellent balance between nose, lips, and chin positions.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfect Profile\" }\n    }\n  },\n  {\n    id: \"good_facial_symmetry\",\n    title: \"Good Facial Symmetry\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face displays excellent bilateral symmetry, a key component of attractiveness.\",\n      grade_labels: { good: \"Symmetric\", excellent: \"Very Symmetric\", ideal: \"Near-Perfect Symmetry\" }\n    }\n  }\n];\n\n// ============================================\n// METRIC NAME MAPPING\n// ============================================\n\n// Map display names to metric IDs for lookup\nconst METRIC_NAME_TO_ID: Record<string, string> = {\n  // Face Shape/Proportions\n  \"Face Width to Height Ratio\": \"faceWidthToHeight\",\n  \"Total Facial Width to Height\": \"totalFacialWidthToHeight\",\n  \"Total Facial Width to Height Ratio\": \"totalFacialWidthToHeight\",\n  \"Midface Ratio\": \"midfaceRatio\",\n  \"Upper Third Proportion\": \"upperThirdProportion\",\n  \"Middle Third Proportion\": \"middleThirdProportion\",\n  \"Lower Third Proportion\": \"lowerThirdProportion\",\n  \"Cheekbone Height\": \"cheekboneHeight\",\n  \"Cheekbone Width\": \"cheekboneWidth\",\n  \"Bitemporal Width\": \"bitemporalWidth\",\n  \"Forehead Height\": \"foreheadHeight\",\n  \"Facial Asymmetry Index\": \"facialAsymmetryIndex\",\n\n  // Jaw\n  \"Gonial Angle\": \"gonialAngle\",\n  \"Mandibular Plane Angle\": \"mandibularPlaneAngle\",\n  \"Jaw Width Ratio\": \"jawWidthRatio\",\n  \"Bigonial Width\": \"bigonialWidth\",\n  \"Jaw Frontal Angle\": \"jawFrontalAngle\",\n  \"Jaw Slope\": \"jawSlope\",\n  \"Jaw Asymmetry\": \"jawAsymmetry\",\n\n  // Chin\n  \"Chin to Philtrum Ratio\": \"chinPhiltrumRatio\",\n  \"Chin Height\": \"chinHeight\",\n  \"Facial Depth to Height\": \"facialDepthToHeight\",\n  \"Facial Depth to Height Ratio\": \"facialDepthToHeight\",\n  \"Anterior Facial Depth\": \"anteriorFacialDepth\",\n  \"Recession Relative to Frankfort Plane\": \"recessionFrankfort\",\n\n  // Eyes\n  \"Lateral Canthal Tilt\": \"lateralCanthalTilt\",\n  \"Eye Aspect Ratio\": \"eyeAspectRatio\",\n  \"Eye Separation Ratio\": \"eyeSeparationRatio\",\n  \"Interpupillary Ratio\": \"interpupillaryRatio\",\n  \"One Eye Apart Test\": \"oneEyeApartTest\",\n  \"Intercanthal Width\": \"intercanthalWidth\",\n  \"Eyebrow Height\": \"eyebrowHeight\",\n  \"Brow Length Ratio\": \"browLengthRatio\",\n  \"Brow Length to Face Width Ratio\": \"browLengthToFaceWidth\",\n  \"Palpebral Fissure Length\": \"palpebralFissureLength\",\n  \"Eye Width\": \"eyeWidth\",\n  \"Eye Asymmetry\": \"eyeAsymmetry\",\n  \"Brow to Hairline Distance\": \"browToHairlineDistance\",\n\n  // Brow\n  \"Browridge Inclination Angle\": \"browridgeInclinationAngle\",\n\n  // Nose\n  \"Nasal Index\": \"nasalIndex\",\n  \"Nasal Tip Angle\": \"nasalTipAngle\",\n  \"Nose Tip Position\": \"noseTipPosition\",\n  \"Frankfort-tip Angle\": \"frankfortTipAngle\",\n  \"Nasofrontal Angle\": \"nasofrontalAngle\",\n  \"Nasofacial Angle\": \"nasofacialAngle\",\n  \"Nasomenta Angle\": \"nasomentaAngle\",\n  \"Nasomental Angle\": \"nasomentaAngle\",\n  \"Intercanthal Nasal Ratio\": \"intercanthalNasalRatio\",\n  \"Nose Bridge Width\": \"noseBridgeWidth\",\n  \"Nose Width\": \"noseWidth\",\n  \"Nasal Projection\": \"nasalProjection\",\n  \"Nose Length Ratio\": \"noseLengthRatio\",\n  \"Ipsilateral Alar Angle\": \"ipsilateralAlarAngle\",\n\n  // Lips\n  \"Lip Ratio\": \"lipRatio\",\n  \"Philtrum Length\": \"philtrumLength\",\n  \"Upper Lip Projection\": \"upperLipProjection\",\n  \"Lower Lip Projection\": \"lowerLipProjection\",\n  \"Lip Chin Distance\": \"lipChinDistance\",\n  \"Upper Lip Height\": \"upperLipHeight\",\n  \"Upper Lip E-Line Position\": \"upperLipELine\",\n  \"Upper Lip S-Line Position\": \"upperLipSLine\",\n  \"Nasolabial Angle\": \"nasolabialAngle\",\n  \"Cupids Bow Depth\": \"cupidsBowDepth\",\n\n  // Neck\n  \"Neck Width\": \"neckWidth\",\n  \"Neck to Jaw Ratio\": \"neckToJawRatio\",\n\n  // Profile\n  \"Total Profile Angle\": \"totalProfileAngle\",\n};\n\n// ============================================\n// CLASSIFICATION FUNCTIONS\n// ============================================\n\n/**\n * Get weakness severity based on average score\n * 0-3 = \"Severe\", 3-5 = \"Moderate\", 5-7 = \"Minor\"\n */\nfunction getWeaknessSeverity(avgScore: number): WeaknessSeverity {\n  if (avgScore <= 3) return 'severe';\n  if (avgScore <= 5) return 'moderate';\n  return 'minor';\n}\n\n/**\n * Get strength grade based on average score\n * 8-9 = \"Good\", 9-9.5 = \"Excellent\", 9.5-10 = \"Ideal\"\n */\nfunction getStrengthGrade(avgScore: number): StrengthGrade {\n  if (avgScore >= 9.5) return 'ideal';\n  if (avgScore >= 9) return 'excellent';\n  return 'good';\n}\n\n/**\n * Find metric by display name from measurements array\n */\nfunction findMetricByName(\n  metricName: string,\n  measurements: MetricScoreResult[]\n): MetricScoreResult | undefined {\n  // First try direct ID mapping\n  const metricId = METRIC_NAME_TO_ID[metricName];\n  if (metricId) {\n    return measurements.find(m => m.metricId === metricId);\n  }\n\n  // Fallback: try fuzzy matching on name\n  const normalizedName = metricName.toLowerCase().replace(/[^a-z0-9]/g, '');\n  return measurements.find(m => {\n    const normalizedMetricName = m.name.toLowerCase().replace(/[^a-z0-9]/g, '');\n    return normalizedMetricName.includes(normalizedName) ||\n           normalizedName.includes(normalizedMetricName);\n  });\n}\n\n/**\n * Check if a metric should be considered a \"false positive\" weakness.\n * This handles directional/dimorphic metrics where low scores don't mean weakness.\n *\n * Example: Canthal Tilt of 3° gets a low score (not in 6-8° ideal range)\n * but is still a POSITIVE trait, not a weakness.\n */\nfunction isFalsePositiveWeakness(metric: MatchedMetric): boolean {\n  const config = METRIC_CONFIGS[metric.metricId];\n  if (!config) return false;\n\n  // Check if the value is actually acceptable based on polarity\n  const { acceptable } = isValueAcceptable(metric.value, config);\n  return acceptable;\n}\n\n/**\n * Process all insight definitions against user's measurements\n */\nexport function classifyInsights(\n  measurements: MetricScoreResult[],\n  insightDefinitions: InsightDefinition[] = INSIGHTS_DEFINITIONS\n): InsightClassificationResult {\n  const strengths: ClassifiedStrength[] = [];\n  const weaknesses: ClassifiedWeakness[] = [];\n\n  for (const insight of insightDefinitions) {\n    const { metrics, threshold } = insight.severity_logic;\n\n    // Find matching measurements for this insight\n    const matchedMetrics: MatchedMetric[] = [];\n    for (const metricName of metrics) {\n      const measurement = findMetricByName(metricName, measurements);\n      if (measurement) {\n        matchedMetrics.push({\n          metricId: measurement.metricId,\n          metricName: measurement.name,\n          score: measurement.score,\n          value: measurement.value,\n          idealMin: measurement.idealMin,\n          idealMax: measurement.idealMax,\n          unit: measurement.unit,\n          category: measurement.category,\n        });\n      }\n    }\n\n    // Skip if no metrics matched (need at least 1)\n    if (matchedMetrics.length === 0) continue;\n\n    // Calculate average score\n    const avgScore = matchedMetrics.reduce((sum, m) => sum + m.score, 0) / matchedMetrics.length;\n\n    // Classify based on type and threshold\n    if (insight.type === 'weakness') {\n      // Weakness: avg < threshold → add to areas of improvement\n      if (avgScore < threshold) {\n        // ========== FALSE POSITIVE CHECK ==========\n        // Before adding to weaknesses, check if ANY of the matched metrics\n        // are actually in an \"acceptable\" zone based on their polarity.\n        // If so, this is a false positive and should be skipped or reclassified.\n        const falsePositiveMetrics = matchedMetrics.filter(isFalsePositiveWeakness);\n\n        // If ALL matched metrics are false positives, skip this weakness entirely\n        if (falsePositiveMetrics.length === matchedMetrics.length) {\n          // This is a false positive weakness - the values are actually acceptable\n          // Consider adding to strengths if scores are decent\n          if (avgScore >= 6) {\n            strengths.push({\n              insightId: `${insight.id}_acceptable`,\n              title: insight.title.replace('Negative', 'Neutral').replace('Weak', 'Moderate'),\n              description: `While not in the peak ideal range, the measured values are within acceptable limits.`,\n              grade: 'good',\n              gradeLabel: 'Acceptable',\n              avgScore,\n              matchedMetrics,\n            });\n          }\n          continue; // Skip adding as weakness\n        }\n\n        // If SOME metrics are false positives, filter them out\n        const trueWeaknessMetrics = matchedMetrics.filter(m => !isFalsePositiveWeakness(m));\n        if (trueWeaknessMetrics.length === 0) continue;\n\n        // Recalculate average with only true weakness metrics\n        const trueAvgScore = trueWeaknessMetrics.reduce((sum, m) => sum + m.score, 0) / trueWeaknessMetrics.length;\n\n        // Only add as weakness if true average is still below threshold\n        if (trueAvgScore < threshold) {\n          const severity = getWeaknessSeverity(trueAvgScore);\n          const labels = insight.content.severity_labels;\n          const severityLabel = labels?.[severity] || severity;\n\n          weaknesses.push({\n            insightId: insight.id,\n            title: insight.title,\n            description: insight.content.description,\n            severity,\n            severityLabel,\n            avgScore: trueAvgScore,\n            matchedMetrics: trueWeaknessMetrics,\n          });\n        }\n      }\n    } else {\n      // Strength: avg > threshold → add to key strengths\n      if (avgScore > threshold) {\n        const grade = getStrengthGrade(avgScore);\n        const labels = insight.content.grade_labels;\n        const gradeLabel = labels?.[grade] || grade;\n\n        strengths.push({\n          insightId: insight.id,\n          title: insight.title,\n          description: insight.content.description,\n          grade,\n          gradeLabel,\n          avgScore,\n          matchedMetrics,\n        });\n      }\n    }\n  }\n\n  // Sort by score (weaknesses by lowest score first, strengths by highest first)\n  weaknesses.sort((a, b) => a.avgScore - b.avgScore);\n  strengths.sort((a, b) => b.avgScore - a.avgScore);\n\n  return { strengths, weaknesses };\n}\n\n/**\n * Convert ClassifiedStrength to Strength type for UI compatibility\n */\nexport function convertToStrength(classified: ClassifiedStrength): Strength {\n  return {\n    id: `insight_strength_${classified.insightId}`,\n    strengthName: `${classified.title} (${classified.gradeLabel})`,\n    summary: classified.description,\n    avgScore: Math.max(0, Math.min(10, classified.avgScore)),  // Clamp to 0-10\n    qualityLevel: classified.grade === 'ideal' ? 'ideal' :\n                  classified.grade === 'excellent' ? 'excellent' : 'good',\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n  };\n}\n\n/**\n * Convert ClassifiedWeakness to Flaw type for UI compatibility\n */\nexport function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  const impact = (10 - classified.avgScore) * 0.5;\n  const newRollingLost = rollingLost + impact;\n\n  return {\n    id: `insight_flaw_${classified.insightId}`,\n    flawName: `${classified.title} (${classified.severityLabel})`,\n    summary: classified.description,\n    harmonyPercentageLost: impact,\n    standardizedImpact: impact / 10,\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n    rollingPointsDeducted: newRollingLost,\n    rollingHarmonyPercentageLost: newRollingLost,\n    rollingStandardizedImpact: newRollingLost / 10,\n  };\n}\n\n/**\n * Main function: Generate strengths and flaws from measurements using insights\n */\nexport function generateInsightBasedResults(\n  measurements: MetricScoreResult[]\n): { strengths: Strength[]; flaws: Flaw[] } {\n  const { strengths: classifiedStrengths, weaknesses: classifiedWeaknesses } = classifyInsights(measurements);\n\n  // Convert to UI-compatible types\n  const strengths = classifiedStrengths.map((s) => convertToStrength(s));\n\n  let rollingLost = 0;\n  const flaws = classifiedWeaknesses.map((w, i) => {\n    const flaw = convertToFlaw(w, i, rollingLost);\n    rollingLost = flaw.rollingPointsDeducted || 0;\n    return flaw;\n  });\n\n  return { strengths, flaws };\n}\n","numLines":2643,"startLine":1,"totalLines":2643}}}
{"parentUuid":"7c84fc6b-830d-4a0f-acb7-0d823caa187f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017gbnkLtGxGKMpnsvH2wF4s","type":"tool_result","content":"     1→# FaceIQ Comprehensive Logic Report\n     2→\n     3→This report details the logic used by the application to recommend treatments, including Surgeries, Soft-Maxes (NST), and Lifestyle changes. It also documents the specific impacts these treatments have on facial scoring.\n     4→\n     5→## 1. Trigger Logic Map (Flaw -> Treatments)\n     6→The following table maps specific Flaws to recommended Treatments.\n     7→\n     8→| Flaw (Trigger) | Recommended Treatment | Category |\n     9→| :--- | :--- | :--- |\n    10→| Disproportionate lower face (long chin or short philtrum) | Lip filler | NST |\n    11→| Disproportionate lower face (short chin or long philtrum) | Jaw fillers | NST |\n    12→| Disproportionate lower face (short chin or long philtrum) | Lip filler | NST |\n    13→| Double chin | Cryolipolysis (fat freezing) | NST |\n    14→| Double chin | Kybella (double chin removal) | NST |\n    15→| Flat & small cheekbones | Cheekbone fillers | NST |\n    16→| Flat jaw | Jaw fillers | NST |\n    17→| High submental fat | Cryolipolysis (fat freezing) | NST |\n    18→| High submental fat | Kybella (double chin removal) | NST |\n    19→| Lacking Ogee curve | Cheekbone fillers | NST |\n    20→| Lacking cupid's bow | Lip filler | NST |\n    21→| Long midface | Cheekbone fillers | NST |\n    22→| Long midface | Lip filler | NST |\n    23→| Low-set cheekbones | Cheekbone fillers | NST |\n    24→| Mandibular recession | Jaw fillers | NST |\n    25→| Medium-set cheekbones | Cheekbone fillers | NST |\n    26→| Mouth asymmetry | Lip filler | NST |\n    27→| Narrow jaw | Jaw fillers | NST |\n    28→| Overly long face shape | Cheekbone fillers | NST |\n    29→| Overly retruded lower lip | Lip filler | NST |\n    30→| Overly retruded upper lip | Lip filler | NST |\n    31→| Round neck region | Cryolipolysis (fat freezing) | NST |\n    32→| Rounder convex facial profile | Jaw fillers | NST |\n    33→| Short lower third | Jaw fillers | NST |\n    34→| Short ramus | Jaw fillers | NST |\n    35→| Steep jaw | Jaw fillers | NST |\n    36→| Thin lower lip | Lip filler | NST |\n    37→| Thin upper lip | Lip filler | NST |\n    38→| Undefined jawline | Cryolipolysis (fat freezing) | NST |\n    39→| Undefined jawline | Jaw fillers | NST |\n    40→| Undefined jawline | Kybella (double chin removal) | NST |\n    41→| Underprojected chin | Jaw fillers | NST |\n    42→| Weak/soft jaw structure | Jaw fillers | NST |\n    43→| Wide-set eyes | Cheekbone fillers | NST |\n    44→\n    45→---\n    46→\n    47→## 2. Comprehensive Treatment Library\n    48→### Surgical Procedures\n    49→\n    50→#### **Facial liposuction** (`SUR-36`)\n    51→> **Description**: Removes excess fat from face for contouring, often chin/jawline/temples.\n    52→\n    53→- **Risks/Side Effects**: ÎÎ§Î¼ÏÏÎ¨Î£Î£ Î¸Î©ÎÎºÏÎ½ ÏÎ²ÏÎ ÎÎ¤Î¦Î½Î² Î¼ÎÎµÎÎÎ¿ÎÎ ÎµÎ·Ï Î¦ÎÎÏÎÎ¨ ÏÏÎ¦Î Î¤ÎÏÏÎ§Î§ ÏÎÏÎ¡ ÏÏÎ Î© ÎÎ¾Î Î³ÎÏ ÎÎ¹Î¥ÎÎ Î©ÎÎ¥ Î·ÏÎÎ¶ÎÎÎ± Î¦Î¹Î³ÏÏ ÏÎ¦ÏÎÎµÏÎ© ÎÎ¨ÏÎ¨ Î·ÏÎÏ Î³ÎÏÎ¨Î¾Î²Î»Î» Î£Î©Î¦Î¡ ÏÎµÎ»Î¹Î ÎÎ ÎµÎ¥Î·Îº Î¥Î Î¸ÏÏÎ¨Î· ÎÎÎ±ÎÎ·Î´Ï Î\n    54→- **Logic Rules (Triggers & Impacts)**:\n    55→\n    56→#### **Unknown Treatment** (`???`)\n    57→> **Description**: \n    58→\n    59→\n    60→#### **Unknown Treatment** (`???`)\n    61→> **Description**: \n    62→\n    63→\n    64→#### **Canthopexy** (`SUR-33`)\n    65→> **Description**: Tightens lower eyelid to prevent sagging and support eye shape.\n    66→\n    67→- **Risks/Side Effects**: ÏÏÏÎ¹ÎÎ¡ÎÎ¿ Î¹Î¨Ï Î¶ÏÏ ÎÎ²ÏÎÎ¥ ÏÎÎ ÎÎ¦ÎºÏÎ ÎÏÎº Î·Î£Î» ÎÎ¾Î Î§ÎºÎ Î±Î½ÎÎÎ¹Î½Î£ ÏÎÎ²ÏÎ»ÎÎ§Î Î½Î¦ÎÏ ÎÏÏÎ ÎÎÎÎ ÏÎÎ¾ÎÎ£ÎÎ Î¨ÎºÎÎµÎ ÎÎÎ¥Î·Î Î¹ÎÎ¤Î¨Î¨ Î½ÏÎÎÎÎ¹Î ÏÎÎ ÏÎ¨ÎÎÎ¸Î³Î¶Î¦ ÏÎÎ¾Î³ Î©Î¡ÏÎ±Î½Î¸Î·Î½ ÎÎ¿Î¿ ÎÎµÎ² ÏÏÎÎ¹Î³ ÏÎ§Î¹ ÏÏ\n    68→- **Logic Rules (Triggers & Impacts)**:\n    69→\n    70→#### **Unknown Treatment** (`???`)\n    71→> **Description**: \n    72→\n    73→\n    74→#### **Unknown Treatment** (`???`)\n    75→> **Description**: \n    76→\n    77→\n    78→#### **Canthoplasty** (`SUR-25`)\n    79→> **Description**: Targets the corners of the eye to alter the shape, tilt, and size of the eyes.\n    80→\n    81→- **Risks/Side Effects**: ÏÎÏÎÎ¦ÎÎ Î Î¸Î·ÎÎÏÎÎºÏ ÏÏÎÎ²Î¿Î»Ï Î¡ÏÎÎÏÏÏÎ¥ ÏÏÎÎÎ  ÎÎºÎ¦Ï Î ÏÎ¹ÎÏÎ» Î³Î¤Î Î Î¡ÎÎ»Î Î³Î¸Î´Î£Î ÏÎ³ÎÎ§Î¿ ÏÎ¼ÎÎ²Î·Î ÎÎÎ¸ÎÎ¡ÏÎ¼ ÎÎ¤Î¦ Î¥ÎÎ¶Î ÎµÎ´ÎÎÎ© ÎÎÎÎ±Î±Î¦ÎÎ ÎÎÏÎ¥ÎÎ Î³ Î¶ÏÎ ÎÎÎ± ÎÎÎ©Î©ÎÎÎ²Î\n    82→- **Logic Rules (Triggers & Impacts)**:\n    83→\n    84→#### **Unknown Treatment** (`???`)\n    85→> **Description**: \n    86→\n    87→\n    88→#### **Unknown Treatment** (`???`)\n    89→> **Description**: \n    90→\n    91→\n    92→#### **Unknown Treatment** (`???`)\n    93→> **Description**: \n    94→\n    95→\n    96→#### **Unknown Treatment** (`???`)\n    97→> **Description**: \n    98→\n    99→\n   100→#### **ÏÏÎ¿ÎÏÎ ÎÎ½Î¾ ÎÎÎ¤ÎÎÏÎ** (`SUR-35`)\n   101→> **Description**: Î½ÏÎ Î ÎÎÎ¥Î Î¨Î¼Ï ÏÎ´ÎÎ¸Î¤Î¿ ÏÎ Ï ÏÏÎºÎÎÏ Î³ÎÎ¸ÎÏÎÎ±Î Î Î±ÏÎÎÎ²Î£Î ÎºÎ²Î§Î»ÎÎ¶Ï Î³Î³Î±ÎÎºÎ³ÎÎ¨ Î½ÎÎºÎÎ ÎÎ¼Î Î¦ÎÎ ÏÎ¾Î³Î·Î¼Î ÏÏÎÎÏÎÎ  Î ÎÏÏÎ ÏÎ³ ÏÏÎ½Î¸Î\n   102→\n   103→- **Risks/Side Effects**: Î·Î¿ÏÎÎ Î³ÎÎ² Î¾ÎÎ Î´Î¼ÎÎÎ ÎÎ¤Îµ ÎÎ¿ÎÎ·ÏÎÎ¤Î¤ Î³Î»Ï Î£ÏÎ¸ÎÎ½ÏÎ§Î ÏÏÎ¦ ÏÏÏÎ¹Î Î·ÏÎÏÎ Î£Î¤Î Î¼ Î¶Î¨Î¤ Î±ÎÎ¹Î¹Î± ÏÎÎÎ£ÏÏÏÎ ÎÎ»ÏÎÎ ÎÏÎ² ÎÎ¸ÎÎ¤Î±Î Î Î¡ÏÎ¨ÎÎÎ³ Î±Î½Î²Î Î±ÏÎ¤ÏÎ¿ Î¨Î¿Î¦Î¹Î¾ ÏÏÎÎ¶ ÏÎ¹ÏÏÎ´ÏÎ¹Î ÎÎ¹ÎÎ¼ Î Î¹Ï ÎÎÎ£Î±ÎÎ ÎÏÎ¾\n   104→- **Logic Rules (Triggers & Impacts)**:\n   105→\n   106→#### **Chin implants** (`SUR-07`)\n   107→> **Description**: Implants to specifically enhance chin projection and shape.\n   108→\n   109→- **Risks/Side Effects**: ÏÎ¸Î¨Î²Î½Î¤Î¦Î± Î¾ÎµÎ§Î´Î¹ÎÏ ÏÎÎÎ ÎÎÎ¨ Î§ÎÎÎÎÎ¶Î¸ ÏÏÎÎ¤Î¦ ÎÏÎ¤ ÎºÎÎ©ÎÎ£Î¶Î» Î¤ÏÎ³ÎÎ©Î± Î¡ÎÎ¨Î¡Î§Î¡ Î¶Î²Î³ÏÎ¿Î Î£ÏÎ¨Î Î§Î±Î¹Î£ÎÎ»Ï Î´Î³ÎÎÎ¤Î Î¡ ÏÎÎ ÎÎÏÏÎÏ Î·Î©Î¥ÏÏ Î£Î¾Î¹ÎÎ·Ï ÏÎ¡ÎÎ¤ÏÏÎ¨Î¦ Î´ÎÏÎÎ· ÎÎÎÏÎ»\n   110→- **Logic Rules (Triggers & Impacts)**:\n   111→\n   112→#### **Fat grafting** (`SUR-09`)\n   113→> **Description**: Fat is harvested from the patient and processed. Microfat is for volume enhancement. Nanofat is for facial/skin rejuvenation.\n   114→\n   115→- **Risks/Side Effects**: ÎµÎÎÎÎ¡Î¾ÎÎ Î¸Î¾Î¸Î£Î³ÏÎÏ Î¼ÎÎ¤Î£ÏÎ¨Î·Î Î·Î±Î·ÎÎ Î³Î»Î§ÎÎ¡ Î¥Î·Î§ÎÎÏÎµÏ ÎÎÎÎÎ¨ÏÎ§ Î©ÏÏÎº ÏÎÎ± ÏÎ©ÎÎÎ¶Î¶ÎÎ§ Î»Î Î ÏÎ¤Î  Î²Î©Î¶Î» Î£Î¤ÎÎ¥Î´Î¤Î ÎÎ¥Î½Î±Î¿Ï Î½Î¥ÎÎ¸Î Î¶Î±Î¥Î¶Î¤ÎÏÎ¸ Î¼ÎµÎ¦Î»Î¸ÎÎÎ¥ ÏÎ»ÏÎ¿ÎÏÎ»Î£ Î´ÏÎ¥Î ÏÏÎÎ¨ÎÎ²Î ÎÎÎ Î»Î Î¿Î¥ÎÏÏÎ¿Î±Ï ÎÎ¿Î¸ÎÎÎ ÎÎ¥ÏÎ¼ÎºÎµ Î¸ÎÎ¤ÏÎ ÏÎÏÎ¾ÎÏÎ Î½Î©ÎÎ¤ Î©Î¥ÎÎ¼ÎÎÏÎ¤ ÎÎÎ·Î¦Î ÎÎ±ÎÎ²ÏÎÎºÎ© Î¦Î²ÎÎÏÎ» ÏÏÎ§ÏÎ§Î¾ Î·Î³Î¤ÎÎ¤Î§ Î¥Î¸Î´Î¼Î³ÎÎ· ÎÎ©ÏÏÎ ÏÎ§Î¸Î Î¾Î¼Î¾Î©ÎÎ´Î» ÎµÎ§ÎÏÎ¸Î ÎÎ¡ÏÎÎ¶Î¿Î¶Î ÎÎ¡ÎºÎ¿ÏÎ Î³Ï Î¡ÏÎÏÎ§ Î²ÎÏÎ¹ÎÎ¶ ÎÏÎ»ÏÎ¡ ÎÎÎ´ Î¶ÏÎ¹ÏÎ¦Î Î¹ Î¼Î£ÎÏ ÏÎ¡Î¦Î»ÏÎ½ÏÎ¡ ÎÎ©Î±ÎÎ½ÎÎ³Ï ÏÎ·Î¿ÎÎ¥ ÏÎ§Î ÎÎ\n   116→- **Logic Rules (Triggers & Impacts)**:\n   117→\n   118→#### **Unknown Treatment** (`???`)\n   119→> **Description**: \n   120→\n   121→\n   122→#### **Jaw implants** (`SUR-17`)\n   123→> **Description**: Implants to enhance/ augment jaw bone for a prominent jawline.\n   124→\n   125→- **Risks/Side Effects**: Î¨ÏÎÏÎµÎ¾ÏÎ Î»Î¶ÎÎ Î Î¿Î¦Î¥Î´ ÎÎ¡Î¥ÎÎµÎ¾Î¹ Î»ÎÎÏÎ ÏÎÎ¸Î¾ ÎÎ¾ÎÎ¨Î³ÏÎÎ ÎÎ§ÏÎ Î³ÎÎ¥ÏÎ¥ÏÎ Î¾Î³ÏÏÎÏÏÎ\n   126→- **Logic Rules (Triggers & Impacts)**:\n   127→\n   128→#### **Jaw reduction surgery** (`SUR-34`)\n   129→> **Description**: Reshapes jawbone to slim and contour the lower face, often for V-line effect.\n   130→\n   131→- **Risks/Side Effects**: ÎºÎ©ÏÎ Î²Î¡ÏÏ Î¼ÎÎ§ÎµÎ¡Î¼ ÎÎ³Î£ ÏÎ¥Îµ ÎÎ·ÎÎºÎ·ÎÎÎ ÎÏÎÏ ÎµÏÎ Î¸Î¸Î¦ Î¡Î´Î²ÏÎ¼Î Î¨ÎÎ¸ÎÎ´Î§ Î¡ÎÏÎ¶Î Ï Î´Î»ÏÎ¾ ÏÏÎ¡ÏÎ² ÏÎÏÏ ÎÏÎ£Î±ÎµÎ·Î²Î Î¿ÏÏÎ¸Î´Î  ÎÎ´ÏÎÎÎº Î¶ÎÎÏÎ¨ÎÎ ÏÏÎÎ©Î»ÎºÎ ÎÏÎ¤ÎÎ¥ÎÎÎ ÏÎ¾ÎÎÏÏ Î¦Î·ÎÎ¸ÏÎÎ» ÎÎÏÎ±Î ÎÎ§Î Î´ Î±Î¡ÎÏÎ Î·ÎÎ¿ÎÎ·ÏÎ¤Î¶ Î»ÎÎÎ±Î·Î¿ ÏÎÎ Î¿Î²Î ÎÎ¦Î£Î ÎÎ¦ÎÎÎ»ÎÏÎ ÎÎ¸Î¼ÏÎ§Ï Î»Î»ÏÎ§Îº ÏÎ¦ÎÎ¡Î¦ÎÎ©Ï Î¤Î´Î¾Î¦ Î ÏÎÎ¦ÎºÎ¦ Î·ÎÎ¨ÎµÏ ÎÎÎ·Î Î¨Î¥Ï ÎÎ¤ÎÎ´ÎÎÎ»Î¼ ÏÎ¶Î»ÎÎ¥Ï Î´ÎÎÏÎÎÏÎ¡ ÎÏÏÎÎ¹ÎÎ¿ ÏÎ ÏÎ¸Î¸Î¾ÏÎ½\n   132→- **Logic Rules (Triggers & Impacts)**:\n   133→\n   134→#### **Unknown Treatment** (`???`)\n   135→> **Description**: \n   136→\n   137→\n   138→#### **Unknown Treatment** (`???`)\n   139→> **Description**: \n   140→\n   141→\n   142→#### **Bimaxillary osteotomy** (`SUR-13`)\n   143→> **Description**: Reposition both the jaws for facial balance and remove any misalignment.\n   144→\n   145→- **Risks/Side Effects**: ÎÎ Î¦Î Î·ÎÎ¾Î· Î»ÏÎÎ Î¼ÏÎ¹ÎÎ¾ Î¶ÎÎÎ· ÏÎÎ³Î¿ Î¦Î²ÎÎÏ ÎÎ½Î´ Î¤ÏÎÎ¨Î¨ÎÎÎ¸ ÏÎÎÎ¦Î·Î¡ÎÎ¨ ÎÏÏÎ¨ÎÎÎ¶ ÎÎÎ¤ÏÏÎÏ Î½Î¥ÏÎ·ÎÎÎ§Î¨ Î¿ÏÎ§Î¥ Î ÎÎÎ¹Î¦Î¥Î» ÏÎ¿Î·Î¦ÏÎ³ ÏÎ¿Î ÎÎÎ ÎµÎ³ÎÎÎÎ Î¹Î¹ÏÎ§Î§ ÎÎÎÎÎÎ¡ Î¡ÏÎ·Î¡Î\n   146→- **Logic Rules (Triggers & Impacts)**:\n   147→\n   148→#### **Unknown Treatment** (`???`)\n   149→> **Description**: \n   150→\n   151→\n   152→#### **Unknown Treatment** (`???`)\n   153→> **Description**: \n   154→\n   155→\n   156→#### **Neck lift** (`SUR-21`)\n   157→> **Description**: Comprehensive procedure that removes excess skin and lifts the neck skin May include “Submental Tuck” (muscle/skin tightening) or “Submental Liposuction” (fat removal)\n   158→\n   159→- **Risks/Side Effects**: Î¤ÎÎÎ¾Î¤ÎÎÏ Î½Î¤ÏÎ¥Î±Î¼ÎÎ© Î¼ÎÎ½Î²ÎÏÎÎ Î¤Î£Î Î³ÏÎ¸Î ÎÎÏÎÎ¸ Î´ÎÏÏ Î¼Î¨Î¹Î¨ÎÏÎ¨Î Î¤Î±ÎÎÎÎµÎ Î¸Î¤Î©Î¹Î¼ Î©ÎÎÎÎÎÏÎ Î¼ÏÎ¼Î·ÎÎ±Î  ÎÏÎ´Î·ÎÎÎ¡Î½ Î¸ÎÎ¶Î£Î£ ÎºÎÎ¾ÎÎ¤Î\n   160→- **Logic Rules (Triggers & Impacts)**:\n   161→\n   162→#### **Midface implants** (`SUR-06`)\n   163→> **Description**: Implants to enhance and augment midface projection.\n   164→\n   165→- **Risks/Side Effects**: ÏÎÎ·Î¿Î©ÏÎÎµ Î¼ÏÎ·ÏÎ¥Î¼Î± ÎºÎÎºÎ±Î§Î½Ï Î±ÏÎÎ³Î Î¤ÏÎ¨ÏÎÎ¡ ÎÎ§Î´ÏÏÎ½ Î§Î¨Î³ Î§Î±ÏÎ ÎÏÎºÎ»ÎÎµÎÎ¦ ÎÎ¹Î¾Î¿Î Î¦ÎÎµÎ Î·Î²Î£ ÎÎ¼ÎÎÎÎÎ¡ ÎÎ¹ÎÎ Î¼ÏÎÏÎ¸Î§Î Î¿Î£Î§ÎÎ§ÎÎÎ© Î¿Î½Î³ÎÎ¥\n   166→- **Logic Rules (Triggers & Impacts)**:\n   167→\n   168→#### **Unknown Treatment** (`???`)\n   169→> **Description**: \n   170→\n   171→\n   172→#### **Î¶Î¿ÎÎÎ¶Ï Î¸ÏÎ»ÎµÎÎÎÎ³ ÎÏ** (`SUR-39`)\n   173→> **Description**: Î¨Î»Î½Î ÎÎ½Î¿ÎÎ»ÎÎ¼ Î¸Î¥Î Î¤ Î³Î¥ÎµÎÏ Î¾ÎÎÎÎ¿ÎÎ¦ ÎÎ¨Î¼ÎÎµÎ¶Î Î¦Î±ÏÎ¿ ÎÎ¿Î´ÏÎÎ¦ÎÎ ÎÎ½ÎºÎ²Î¹ÏÎ¤ ÎÏÎÎ¾Î£ ÏÎ¿ÏÎÎÎÎ¶Ï ÏÎµÎµÎ¥ ÎµÏÎ¦Î±ÎÎÎ¡ ÎÎ½ÏÎ ÎÎÎ¡Î³ÎÏÎ£Î¿ ÏÏÏÏÎ¨ÏÎ§Î¦ ÏÎÎ¸Î Î£ÎÎ¾ÎÏ Î£ÏÎÎ¶ÎÎ£ Î¥Î¾Î ÎÎ¿ ÎÎÎ¹Î¦Î²Î¨Î£ Î©ÏÎ³ÏÎ³ÏÎ³Î§ Î´Î¹ÎÎ±ÎÎ¹ÎÎ Î²Î¹ÎÎÎÎ§ ÏÎ½ÎÎÎ ÏÎÎµÎ Ï ÎÎÎ©Î ÎÏÎ¦Î Î Î£ÏÎÎÏÎ Î¡ÎµÎ´Î¡Ï Î¹Î»ÏÎ¤ÏÎ£ÎÏ ÎÏÎÎ± Î¤ÎÎÏ Î¸ÏÎÎ©Î½ ÏÎ§Î§ÎÎº ÎÎ§Î´Î·ÎÎ ÏÎ£ÎºÎÎÎ³Î±Îµ ÏÏÎÎ²ÏÎ ÏÎ¥ÎÎ¶ÎÎ£Î¨Î  Î ÎÎºÎ³\n   174→\n   175→- **Risks/Side Effects**: Î¡Î¶ÎÎÎÎ±ÏÏ Î»Î¾ÎÎºÎÎÏ ÏÎ¹ÎºÏÏÏÎ£Î¾ ÏÎ¡Î½Î©ÏÎ¹ ÏÏÎÏÎÎ Ï ÎÏÎÎ»Î¸Î ÏÎÎ´ Î²ÎÎ¾ Î¹Î ÎÎ³Î ÏÎµÎ¾Î¸ÏÎ¨ ÎÎÎ Î¶Î¥Î ÎºÎ£ÏÎ´ÎµÎ¹Î¹Î¶ Î¹Î¨Î¸Î¨ Î²Î²ÎÎ½ÎÎ¾Î¹ Î Î£ÏÎ´Î±Î² ÎÎ¿ÏÏÏÏÎº Î»ÎÎÎ¨ Î¦ÎÎÎ¶ÎÎ¼ Î¼ÎÎ ÎÎ»Î Î¼Î¿ ÎÎ§ÎÎÎÎ² ÎÎºÎ£ÎÎÏ Î¤ÏÎ³Î¾ÎÎ·ÎºÎ½ Î¶Î¸Î¶Î Î²Î´Î¶ÏÏÎ¥Î´Î ÏÎ¤Î¦ÎÎÎÎ Î¿ÏÎÎ½ ÎÎ¾ÎÎÎ¦Î¥ ÏÎÏÎ¼ÎÏ ÏÎÎ³Î Î¿ÎÎ´Î±Î¾ ÎºÎ²Î² ÎÏ\n   176→- **Logic Rules (Triggers & Impacts)**:\n   177→\n   178→#### **Supraorbital rim implants** (`SUR-22`)\n   179→> **Description**: Implant to enhance the upper orbital hollows for proper orbital definition.\n   180→\n   181→- **Risks/Side Effects**: ÎÎ¡Î±Î³ÏÎÎÏ Î¼ÏÎ»Î© ÎÎ§ÏÎÎÎÏ Î¡ÎºÎºÏÎ¸ÎÎ© Î Î²ÏÎ ÎÎÎ¡ÏÎ¼ ÎÎ§ÎÎÎÎ² ÎÎºÏÎ©Î Î©Î±Ï ÏÎÎ¨ÎÏÎ·ÏÎ Î¸ÎÎºÎ¦Î©Î² ÎÎ¤ÎÎÎ Î¡ÎÎ¥ ÎÎ¾Î¡Î» Î´ÎÎµÎÏ ÎÎ£ÏÎ¸ÎºÎ½Î½Î» ÏÏÏÎ´ÎµÎ» Î¨Î³Î¸ÏÏ Î±ÎÏÏÎ ÎµÎ¹ Î¾ÎÎ±ÎÎ¹ ÎÎÎ¡Î´Î  Î¸Î¸ÎÏ ÏÎ Î¼Î¦Î³ÎÎÎ ÎÏÎÎ²Î±ÏÎÎ± ÎÎ¤ÏÎ±Î½Î\n   182→- **Logic Rules (Triggers & Impacts)**:\n   183→\n   184→#### **Unknown Treatment** (`???`)\n   185→> **Description**: \n   186→\n   187→\n   188→#### **Submental liposuction** (`SUR-38`)\n   189→> **Description**: Removes excess fat beneath the chin to refine the jawline and improve neck contour.\n   190→\n   191→- **Risks/Side Effects**: ÎÎ»Î¶Î¶Î£Î¼Î¥Îº Î¸Î Î ÏÎÎ³Î¼Î Î¹Î¿ÎµÏÎÎ´Ï Î±ÎÎÎ»ÎÎ¼Ï ÏÎÎ ÏÎÎ¦ÏÎ²Î  Î¨ÏÎÎ¹Îº Î©Î¨ÎÎ³ Î²ÏÎ§Î¨Î²Î ÎÎ¦ÎÏÏÎ¨ ÏÏÎÏÎ¹ ÎÏÎÎÎ¦Î¾ ÎÎÏÎ ÏÎÎÎ¶Îº ÎÎ¨ÏÎ¨Î¤Î£Î¼Î¡ Î Î¿ÏÏ Î¦Î±ÏÎÎ´Î· ÎÎ½ÎÏÎÎÏÎ ÏÎÎ§Î¨Î·Îµ Î¨ÎºÎÎÎ¾Î¦Î¤ ÎÎ¾ÎÎ¤Î Î´ Î·ÎÎ¹Î¼ÏÎ©Î© ÎÎÎ´Î·ÎÏ ÎÏÏÎÏÎ ÎÎÎÎ¼Ï ÎÎÎºÎÎ¥Î¥Î¿Î½ ÏÎ¿ÎÎ¥ÎÎÏÎ ÎµÏÏÏÏÎ ÎÎÎµÎµÎÎ  ÏÏÏÎ¤Î\n   192→- **Logic Rules (Triggers & Impacts)**:\n   193→\n   194→#### **Unknown Treatment** (`???`)\n   195→> **Description**: \n   196→\n   197→\n   198→#### **Submental tuck (submentoplasty)** (`SUR-11`)\n   199→> **Description**: Direct excision of submental skin/fat with platysma plication; tightens central neck muscles and removes excess tissue and fat. Also called cervicoplasty. Targets submental fullness and laxity via small incision under chin.\n   200→\n   201→- **Risks/Side Effects**: ÎÎÎ¨Î£ÏÎÎ§Î Î¹ÎÎ¡ÏÏÎ½Î© Î¹Î·ÎÎÎÎ³ÏÎ¥ Î¼ÎÎÎ¹ÎÎ¥ Î²ÎÏÏÎ¹Î±ÎÏ Î©ÎÎ³ÎµÎ² ÎÏÎÎÎµÏÎ¼ ÏÎ¶Î½ ÏÎÎºÎ³ ÏÎÎÎ¼Î»ÎÏÎ\n   202→- **Logic Rules (Triggers & Impacts)**:\n   203→\n   204→#### **Lip reduction surgery (reduction cheiloplasty)** (`SUR-40`)\n   205→> **Description**: Surgically removes excess lip tissue to reduce lip volume and projection, improving proportion between the lips and surrounding features.\n   206→\n   207→- **Risks/Side Effects**: Î¦ÎÎ¡ÎÎ ÎÎ©Î¡ Î¹ÎÎ§Î¶ ÎÎ¥Î± Î²Î©Î¦Î·Î ÎÏÎ²ÎÎÎÎ³Î³ ÎÎÏ ÎÎÎ²Î±Î¼ÎÎ·Î¿ ÎµÎ¿Î¦ Î¨Î¹ÎºÎ¤ÎÎ¿ ÎºÎ´Î¹ÎÏÎ¤ÏÎ£ ÎÎ´Î´ÏÎ¦Î¿Î£Î¼ Î¥Î¦Î Î»Î³Î¸Î£Î»Î¸ Î¨ÎÎÎ¸ÎÎ½Î¿Ï ÎÎ¡Î·Î¶ ÎÎ£Î¤ÏÎ½Î§Î¿Î§ Î¡Î´ÎºÎ´\n   208→- **Logic Rules (Triggers & Impacts)**:\n   209→\n   210→#### **Unknown Treatment** (`???`)\n   211→> **Description**: \n   212→\n   213→\n   214→#### **Cheekbone implants** (`SUR-05`)\n   215→> **Description**: Implants to enhance zygomatic prominence.\n   216→\n   217→- **Risks/Side Effects**: Î´ÎÎÎ´ÎÎÏÎ¶ Î»Î¨Î¡ÏÎÎÎ»Î  Î¨Î©Î´Ï Î¿Î¦ÎÎ© Î¹Î´Î¹ÏÎÎ¡ÏÎ ÎÏÎ²Î©Î¥ ÎÎÎ½ÎÎµÎ¡Îº Î²Î¼ÎÎ¹Î Î©Î·Î¾ÏÎ§Î ÎÎ±ÏÎÏÎ·Î´Ï ÎÎºÏÎ¶Î¿Î¹ ÏÏÎÎ¦ ÏÎÎ³ÎÎÎÎÎ» ÏÎÎ¸Î§Î£ÎÎ Î·ÎºÏ ÎÎ¥Î¨ÏÏ ÏÏÎÎÎÏÎ Î½Î²Ï ÏÏÏÎ ÏÎ¶Î±ÎÏ Î±ÎÏÎ¡ÏÎ²Î ÎµÎ¤Î»ÏÎÎµÎ¹Ï Î£ÎÎµÏÎ¥ÎµÎ Î\n   218→- **Logic Rules (Triggers & Impacts)**:\n   219→\n   220→#### **Genioplasty** (`SUR-20`)\n   221→> **Description**: Osteotomy of chin bone to reshape the chin for symmetry and facial balance.\n   222→\n   223→- **Risks/Side Effects**: Î¼ÎÎ¼ÎÎ¿ÏÎ Ï Î¾ÏÎÎÎ¶Î ÎÎ»Î¥Î© ÎÏÎÎ¶Î´Î¦Î¼Î Î¿Î£Î©Î¦ ÎÎÎ¥Î¦Î³ ÎÎÎµÎµÎ£ÏÎ¥ ÎÎÎ¥Î¾ ÎÎÎÎÎ»ÏÎ» ÎÎ¸ÏÎ½ÎµÏ ÎÎ»ÏÏÎ¥ÎÎ² Î¡ÎÎÎÏ ÎÎ´Î¶ÏÏ\n   224→- **Logic Rules (Triggers & Impacts)**:\n   225→\n   226→#### **Lip lift** (`SUR-29`)\n   227→> **Description**: Shorten philtrum by skin removal under nose.\n   228→\n   229→- **Risks/Side Effects**: Î»Î´ÎÏÏÎÎÎ¨ Î¸Î¶Î¼ÎÎµ ÏÎ½Î·Î·Î§ÎºÏ ÎÎ§Î¸ Î¥Î¨ÎÎ³ ÎÎÎºÎ§ÏÏ ÎºÎ¡Î¶Î¶Î¾ÎÎÏ Î Î±Î·Î´Î´ÎÏ ÎºÏÎ¼ Î¡Î´Î½ Î¶Î Î¨Î¹ÎÏÏÎ ÎµÎ£ÎÎÏÎ³Î Î¸Î¾Î©Î¨Î³Î·Î¦\n   230→- **Logic Rules (Triggers & Impacts)**:\n   231→\n   232→### Non-Surgical Treatments (Soft-Maxes)\n   233→\n   234→#### **Jaw fillers** (`NST-05`)\n   235→> **Description**: Injectable fillers to enhance jawline definition, width, and projection.\n   236→\n   237→- **Risks/Side Effects**: Temporary swelling, bruising, asymmetry, lumps, infection, vascular occlusion (rare but vision/necrosis risk), blueish discolouration (if superficial), migration.\n   238→- **Logic Rules (Triggers & Impacts)**:\n   239→    - **Trigger**: \"Weak/soft jaw structure\"\n   240→      - **Impacts**:\n   241→        - `Bigonial width`: increase (2%)\n   242→        - `Ramus to Mandible Ratio`: increase (2%)\n   243→        - `Recession relative to frankfort plane`: increase (2%)\n   244→        - `Lower Third`: increase (2%)\n   245→        - `Lower Third Proportion`: decrease (2%)\n   246→        - `Chin to philtrum ratio`: increase (2%)\n   247→        - `Total Facial Width to Height Ratio`: increase (2%)\n   248→        - `Facial Convexity (Glabella)`: increase (2%)\n   249→        - `Facial Convexity (Nasion)`: increase (2%)\n   250→        - `Total Facial Convexity`: increase (2%)\n   251→        - `Jaw Frontal Angle`: both (2%)\n   252→        - `Nasofacial Angle`: decrease (2%)\n   253→        - `Nasomental Angle`: increase (2%)\n   254→        - `Mentolabial angle`: decrease (2%)\n   255→        - `Gonion to mouth line`: increase (2%)\n   256→        - `Upper Lip S-Line Position`: both (2%)\n   257→        - `Lower Lip S-Line Position`: both (2%)\n   258→        - `Upper Lip E-Line Position`: both (2%)\n   259→        - `Lower Lip E-Line Position`: both (2%)\n   260→        - `Upper Lip Burstone Line`: both (2%)\n   261→        - `Lower Lip Burstone Line`: both (2%)\n   262→        - `Holdaway H Line`: both (2%)\n   263→        - `Jaw Slope`: decrease (2%)\n   264→    - **Trigger**: \"Narrow jaw\"\n   265→      - **Impacts**:\n   266→        - `Bigonial width`: increase (2%)\n   267→        - `Jaw Frontal Angle`: increase (2%)\n   268→        - `Neck Width`: decrease (2%)\n   269→    - **Trigger**: \"Flat jaw\"\n   270→      - **Impacts**:\n   271→        - `Jaw Frontal Angle`: decrease (2%)\n   272→        - `Lower Third`: increase (2%)\n   273→        - `Lower Third Proportion`: decrease (2%)\n   274→        - `Chin to philtrum ratio`: increase (2%)\n   275→        - `Mandibular Plane Angle`: increase (2%)\n   276→        - `Gonial Angle`: increase (2%)\n   277→        - `Jaw Slope`: increase (2%)\n   278→    - **Trigger**: \"Undefined jawline\"\n   279→    - **Trigger**: \"Mandibular recession\"\n   280→      - **Impacts**:\n   281→        - `Recession relative to frankfort plane`: increase (2%)\n   282→        - `Facial Convexity (Glabella)`: increase (2%)\n   283→        - `Facial Convexity (Nasion)`: increase (2%)\n   284→        - `Total Facial Convexity`: increase (2%)\n   285→        - `Upper Lip S-Line Position`: both (2%)\n   286→        - `Lower Lip S-Line Position`: both (2%)\n   287→        - `Upper Lip E-Line Position`: both (2%)\n   288→        - `Lower Lip E-Line Position`: both (2%)\n   289→        - `Upper Lip Burstone Line`: both (2%)\n   290→        - `Lower Lip Burstone Line`: both (2%)\n   291→        - `Holdaway H Line`: both (2%)\n   292→        - `Nasofacial Angle`: decrease (2%)\n   293→        - `Nasomental Angle`: increase (2%)\n   294→        - `Mentolabial angle`: decrease (2%)\n   295→        - `Z Angle`: increase (2%)\n   296→    - **Trigger**: \"Rounder convex facial profile\"\n   297→      - **Impacts**:\n   298→        - `Recession relative to frankfort plane`: increase (2%)\n   299→        - `Facial Convexity (Glabella)`: increase (2%)\n   300→        - `Facial Convexity (Nasion)`: increase (2%)\n   301→        - `Total Facial Convexity`: increase (2%)\n   302→        - `Upper Lip S-Line Position`: both (2%)\n   303→        - `Lower Lip S-Line Position`: both (2%)\n   304→        - `Upper Lip E-Line Position`: both (2%)\n   305→        - `Lower Lip E-Line Position`: both (2%)\n   306→        - `Upper Lip Burstone Line`: both (2%)\n   307→        - `Lower Lip Burstone Line`: both (2%)\n   308→        - `Holdaway H Line`: both (2%)\n   309→        - `Nasofacial Angle`: decrease (2%)\n   310→        - `Nasomental Angle`: increase (2%)\n   311→        - `Mentolabial angle`: decrease (2%)\n   312→    - **Trigger**: \"Underprojected chin\"\n   313→      - **Impacts**:\n   314→        - `Recession relative to frankfort plane`: increase (2%)\n   315→        - `Facial Convexity (Glabella)`: increase (2%)\n   316→        - `Facial Convexity (Nasion)`: increase (2%)\n   317→        - `Total Facial Convexity`: increase (2%)\n   318→        - `Upper Lip S-Line Position`: both (2%)\n   319→        - `Lower Lip S-Line Position`: both (2%)\n   320→        - `Upper Lip E-Line Position`: both (2%)\n   321→        - `Lower Lip E-Line Position`: both (2%)\n   322→        - `Upper Lip Burstone Line`: both (2%)\n   323→        - `Lower Lip Burstone Line`: both (2%)\n   324→        - `Holdaway H Line`: both (2%)\n   325→        - `Nasofacial Angle`: decrease (2%)\n   326→        - `Nasomental Angle`: increase (2%)\n   327→        - `Mentolabial angle`: decrease (2%)\n   328→    - **Trigger**: \"Steep jaw\"\n   329→      - **Impacts**:\n   330→        - `Jaw Frontal Angle`: increase (2%)\n   331→        - `Mandibular Plane Angle`: decrease (2%)\n   332→        - `Gonial Angle`: decrease (2%)\n   333→    - **Trigger**: \"Short ramus\"\n   334→      - **Impacts**:\n   335→        - `Ramus to Mandible Ratio`: increase (2%)\n   336→        - `Gonion to mouth line`: increase (2%)\n   337→        - `Mandibular Plane Angle`: decrease (2%)\n   338→        - `Gonial Angle`: decrease (2%)\n   339→    - **Trigger**: \"Disproportionate lower face (short chin or long philtrum)\"\n   340→      - **Impacts**:\n   341→        - `Total Facial Width to Height Ratio`: increase (2%)\n   342→        - `Chin to philtrum ratio`: increase (2%)\n   343→        - `Lower Third`: increase (2%)\n   344→        - `Lower Third Proportion`: decrease (2%)\n   345→        - `Jaw Frontal Angle`: decrease (2%)\n   346→        - `Mandibular Plane Angle`: increase (2%)\n   347→        - `Gonial Angle`: increase (2%)\n   348→    - **Trigger**: \"Short lower third\"\n   349→      - **Impacts**:\n   350→        - `Ramus to Mandible Ratio`: both (2%)\n   351→        - `Recession relative to frankfort plane`: increase (2%)\n   352→        - `Total Facial Width to Height Ratio`: increase (2%)\n   353→        - `Lower Third`: increase (2%)\n   354→        - `Lower Third Proportion`: decrease (2%)\n   355→        - `Chin to philtrum ratio`: increase (2%)\n   356→        - `Facial Convexity (Glabella)`: increase (2%)\n   357→        - `Facial Convexity (Nasion)`: increase (2%)\n   358→        - `Total Facial Convexity`: increase (2%)\n   359→        - `Jaw Frontal Angle`: decrease (2%)\n   360→        - `Nasofacial Angle`: decrease (2%)\n   361→        - `Nasomental Angle`: increase (2%)\n   362→        - `Mentolabial angle`: decrease (2%)\n   363→        - `Upper lip E-line position`: increase (2%)\n   364→        - `Lower lip E-line position`: increase (2%)\n   365→        - `Upper lip S-line position`: increase (2%)\n   366→        - `Lower lip S-line position`: increase (2%)\n   367→        - `Upper lip Burstone line`: increase (2%)\n   368→        - `Lower lip Burstone line`: increase (2%)\n   369→        - `Holdaway H line`: increase (2%)\n   370→\n   371→#### **Unknown Treatment** (`???`)\n   372→> **Description**: \n   373→\n   374→\n   375→#### **Unknown Treatment** (`???`)\n   376→> **Description**: \n   377→\n   378→\n   379→#### **Kybella (double chin removal)** (`NST-01`)\n   380→> **Description**: Injectable deoxycholic acid to dissolve submental fat.\n   381→\n   382→- **Risks/Side Effects**: Swelling, bruising, numbness, pain, nerve injury, asymmetry.\n   383→- **Logic Rules (Triggers & Impacts)**:\n   384→    - **Trigger**: \"Double chin\"\n   385→      - **Impacts**:\n   386→        - `Submental Cervical Angle`: decrease (2%)\n   387→    - **Trigger**: \"High submental fat\"\n   388→      - **Impacts**:\n   389→        - `Submental Cervical Angle`: decrease (2%)\n   390→    - **Trigger**: \"Undefined jawline\"\n   391→      - **Impacts**:\n   392→        - `Submental Cervical Angle`: decrease (2%)\n   393→\n   394→#### **Cheekbone fillers** (`NST-06`)\n   395→> **Description**: Enhances cheekbone prominence for better facial angularity, harmony, and prominence.\n   396→\n   397→- **Risks/Side Effects**: Temporary swelling, asymmetry risk, bruising, lumps, infection, vascular compromise to retina (rare), nodules/biofilm.\n   398→- **Logic Rules (Triggers & Impacts)**:\n   399→    - **Trigger**: \"Flat & small cheekbones\"\n   400→      - **Impacts**:\n   401→        - `Cheekbone height`: increase (2%)\n   402→        - `Facial width to height ratio`: increase (2%)\n   403→        - `Total Facial Width to Height Ratio`: decrease (2%)\n   404→        - `Bigonial width`: decrease (2%)\n   405→        - `Eye Separation Ratio`: decrease (1%)\n   406→        - `Bitemporal width`: decrease (2%)\n   407→    - **Trigger**: \"Lacking Ogee curve\"\n   408→      - **Impacts**:\n   409→        - `Cheekbone height`: increase (2%)\n   410→        - `Facial width to height ratio`: increase (2%)\n   411→        - `Total Facial Width to Height Ratio`: decrease (2%)\n   412→        - `Bigonial width`: decrease (2%)\n   413→        - `Eye Separation Ratio`: decrease (1%)\n   414→        - `Bitemporal width`: decrease (2%)\n   415→    - **Trigger**: \"Low-set cheekbones\"\n   416→      - **Impacts**:\n   417→        - `Cheekbone height`: increase (2%)\n   418→        - `Facial width to height ratio`: increase (2%)\n   419→        - `Total Facial Width to Height Ratio`: decrease (2%)\n   420→        - `Bigonial width`: decrease (2%)\n   421→        - `Eye Separation Ratio`: decrease (1%)\n   422→        - `Bitemporal width`: decrease (2%)\n   423→    - **Trigger**: \"Medium-set cheekbones\"\n   424→      - **Impacts**:\n   425→        - `Cheekbone height`: increase (2%)\n   426→        - `Facial width to height ratio`: increase (2%)\n   427→        - `Total Facial Width to Height Ratio`: decrease (2%)\n   428→        - `Bigonial width`: decrease (2%)\n   429→        - `Eye Separation Ratio`: decrease (1%)\n   430→        - `Bitemporal width`: decrease (2%)\n   431→    - **Trigger**: \"Overly long face shape\"\n   432→      - **Impacts**:\n   433→        - `Cheekbone height`: increase (2%)\n   434→        - `Facial width to height ratio`: increase (2%)\n   435→        - `Total Facial Width to Height Ratio`: decrease (2%)\n   436→        - `Bigonial width`: decrease (2%)\n   437→        - `Eye Separation Ratio`: decrease (1%)\n   438→        - `Bitemporal width`: decrease (2%)\n   439→    - **Trigger**: \"Long midface\"\n   440→      - **Impacts**:\n   441→        - `Cheekbone height`: increase (2%)\n   442→        - `Facial width to height ratio`: increase (2%)\n   443→        - `Total Facial Width to Height Ratio`: decrease (2%)\n   444→        - `Bigonial width`: decrease (2%)\n   445→        - `Eye Separation Ratio`: decrease (1%)\n   446→        - `Bitemporal width`: decrease (2%)\n   447→    - **Trigger**: \"Wide-set eyes\"\n   448→      - **Impacts**:\n   449→        - `Cheekbone height`: increase (2%)\n   450→        - `Facial width to height ratio`: increase (2%)\n   451→        - `Total Facial Width to Height Ratio`: decrease (2%)\n   452→        - `Bigonial width`: decrease (2%)\n   453→        - `Eye Separation Ratio`: decrease (1%)\n   454→        - `Bitemporal width`: decrease (2%)\n   455→\n   456→#### **Cryolipolysis (fat freezing)** (`NST-04`)\n   457→> **Description**: Noninvasive fat reduction via controlled cooling (e.g., CoolSculpting); targets stubborn subcutaneous fat without surgery. FDA-cleared for abdomen, flanks, thighs, arms, back, and submental area.\n   458→\n   459→- **Risks/Side Effects**: Temporary erythema/swelling, bruising, numbness/paresthesia, pain, edema, paradoxical adipose hyperplasia, frostbite, hyperpigmentation.\n   460→- **Logic Rules (Triggers & Impacts)**:\n   461→    - **Trigger**: \"Double chin\"\n   462→      - **Impacts**:\n   463→        - `Submental Cervical Angle`: decrease (2%)\n   464→    - **Trigger**: \"High submental fat\"\n   465→      - **Impacts**:\n   466→        - `Submental Cervical Angle`: decrease (2%)\n   467→    - **Trigger**: \"Undefined jawline\"\n   468→      - **Impacts**:\n   469→        - `Submental Cervical Angle`: decrease (2%)\n   470→    - **Trigger**: \"Round neck region\"\n   471→      - **Impacts**:\n   472→        - `Submental Cervical Angle`: decrease (2%)\n   473→\n   474→#### **Lip filler** (`NST-08`)\n   475→> **Description**: injectable filler to enhance lip volume, contour and correct asymmetry.\n   476→\n   477→- **Risks/Side Effects**: Swelling, lumps, bruising, asymmetry, vascular occlusion, vascular occlusion; mucosal ulceration if over-filled.\n   478→- **Logic Rules (Triggers & Impacts)**:\n   479→    - **Trigger**: \"Thin upper lip\"\n   480→      - **Impacts**:\n   481→        - `Lip Thickness`: increase (2%)\n   482→        - `Lower Lip to Upper Lip Ratio`: decrease (2%)\n   483→        - `Upper Lip S-Line Position`: decrease (2%)\n   484→        - `Upper Lip E-Line Position`: decrease (2%)\n   485→        - `Upper Lip Burstone Line`: decrease (2%)\n   486→        - `Holdaway H Line`: increase (2%)\n   487→        - `Nasolabial angle`: decrease (2%)\n   488→        - `Chin to philtrum ratio`: increase (2%)\n   489→        - `Midface Ratio`: increase (2%)\n   490→        - `Facial Width to Height Ratio`: increase (2%)\n   491→        - `Cupid's Bow Depth`: increase (2%)\n   492→        - `Z Angle`: decrease (2%)\n   493→    - **Trigger**: \"Lacking cupid's bow\"\n   494→      - **Impacts**:\n   495→        - `Cupid's Bow Depth`: increase (2%)\n   496→        - `Lip Thickness`: increase (2%)\n   497→        - `Lower Lip to Upper Lip Ratio`: decrease (2%)\n   498→        - `Upper Lip S-Line Position`: decrease (2%)\n   499→        - `Upper Lip E-Line Position`: decrease (2%)\n   500→        - `Upper Lip Burstone Line`: decrease (2%)\n   501→        - `Holdaway H Line`: increase (2%)\n   502→        - `Nasolabial angle`: decrease (2%)\n   503→        - `Chin to philtrum ratio`: increase (2%)\n   504→        - `Midface Ratio`: increase (2%)\n   505→        - `Facial Width to Height Ratio`: increase (2%)\n   506→        - `Z Angle`: decrease (2%)\n   507→    - **Trigger**: \"Thin lower lip\"\n   508→      - **Impacts**:\n   509→        - `Lip Thickness`: increase (2%)\n   510→        - `Lower Lip to Upper Lip Ratio`: increase (2%)\n   511→        - `Lower Lip S-Line Position`: decrease (2%)\n   512→        - `Lower Lip E-Line Position`: decrease (2%)\n   513→        - `Lower Lip Burstone Line`: decrease (2%)\n   514→        - `Holdaway H Line`: decrease (2%)\n   515→        - `Mentolabial angle`: decrease (2%)\n   516→        - `Chin to philtrum ratio`: decrease (2%)\n   517→    - **Trigger**: \"Overly retruded upper lip\"\n   518→      - **Impacts**:\n   519→        - `Lip Thickness`: increase (2%)\n   520→        - `Lower Lip to Upper Lip Ratio`: decrease (2%)\n   521→        - `Upper Lip S-Line Position`: decrease (2%)\n   522→        - `Upper Lip E-Line Position`: decrease (2%)\n   523→        - `Upper Lip Burstone Line`: decrease (2%)\n   524→        - `Holdaway H Line`: increase (2%)\n   525→        - `Nasolabial angle`: decrease (2%)\n   526→        - `Chin to philtrum ratio`: increase (2%)\n   527→        - `Midface Ratio`: increase (2%)\n   528→        - `Facial Width to Height Ratio`: increase (2%)\n   529→        - `Cupid's Bow Depth`: increase (2%)\n   530→        - `Z Angle`: decrease (2%)\n   531→    - **Trigger**: \"Overly retruded lower lip\"\n   532→      - **Impacts**:\n   533→        - `Lip Thickness`: increase (2%)\n   534→        - `Lower Lip to Upper Lip Ratio`: increase (2%)\n   535→        - `Lower Lip S-Line Position`: decrease (2%)\n   536→        - `Lower Lip E-Line Position`: decrease (2%)\n   537→        - `Lower Lip Burstone Line`: decrease (2%)\n   538→        - `Holdaway H Line`: decrease (2%)\n   539→        - `Mentolabial angle`: decrease (2%)\n   540→        - `Chin to philtrum ratio`: decrease (2%)\n   541→    - **Trigger**: \"Mouth asymmetry\"\n   542→    - **Trigger**: \"Disproportionate lower face (short chin or long philtrum)\"\n   543→      - **Impacts**:\n   544→        - `Lip Thickness`: increase (2%)\n   545→        - `Lower Lip to Upper Lip Ratio`: decrease (2%)\n   546→        - `Upper Lip S-Line Position`: decrease (2%)\n   547→        - `Upper Lip E-Line Position`: decrease (2%)\n   548→        - `Upper Lip Burstone Line`: decrease (2%)\n   549→        - `Holdaway H Line`: increase (2%)\n   550→        - `Nasolabial angle`: decrease (2%)\n   551→        - `Chin to philtrum ratio`: increase (2%)\n   552→        - `Midface Ratio`: increase (2%)\n   553→        - `Facial Width to Height Ratio`: increase (2%)\n   554→    - **Trigger**: \"Disproportionate lower face (long chin or short philtrum)\"\n   555→      - **Impacts**:\n   556→        - `Lip Thickness`: increase (2%)\n   557→        - `Lower Lip to Upper Lip Ratio`: increase (2%)\n   558→        - `Lower Lip S-Line Position`: decrease (2%)\n   559→        - `Lower Lip E-Line Position`: decrease (2%)\n   560→        - `Lower Lip Burstone Line`: decrease (2%)\n   561→        - `Holdaway H Line`: decrease (2%)\n   562→        - `Mentolabial angle`: decrease (2%)\n   563→        - `Chin to philtrum ratio`: decrease (2%)\n   564→    - **Trigger**: \"Long midface\"\n   565→      - **Impacts**:\n   566→        - `Lip Thickness`: increase (2%)\n   567→        - `Lower Lip to Upper Lip Ratio`: decrease (2%)\n   568→        - `Upper Lip S-Line Position`: decrease (2%)\n   569→        - `Upper Lip E-Line Position`: decrease (2%)\n   570→        - `Upper Lip Burstone Line`: decrease (2%)\n   571→        - `Holdaway H Line`: increase (2%)\n   572→        - `Nasolabial angle`: decrease (2%)\n   573→        - `Chin to philtrum ratio`: increase (2%)\n   574→        - `Midface Ratio`: increase (2%)\n   575→        - `Facial Width to Height Ratio`: increase (2%)\n   576→\n   577→### Lifestyle & Habits\n   578→\n   579→#### **Unknown Treatment** (`???`)\n   580→> **Description**: \n   581→\n   582→\n   583→#### **Unknown Treatment** (`???`)\n   584→> **Description**: \n   585→\n   586→\n   587→#### **Unknown Treatment** (`???`)\n   588→> **Description**: \n   589→\n   590→\n   591→#### **Unknown Treatment** (`???`)\n   592→> **Description**: \n   593→\n   594→\n   595→#### **Unknown Treatment** (`???`)\n   596→> **Description**: \n   597→\n   598→\n   599→#### **Unknown Treatment** (`???`)\n   600→> **Description**: \n   601→\n   602→\n   603→#### **Unknown Treatment** (`???`)\n   604→> **Description**: \n   605→\n   606→\n   607→### Cosmetics & Enhancement\n   608→\n   609→#### **Unknown Treatment** (`???`)\n   610→> **Description**: \n   611→\n   612→\n   613→#### **Unknown Treatment** (`???`)\n   614→> **Description**: \n   615→\n   616→\n   617→#### **Unknown Treatment** (`???`)\n   618→> **Description**: \n   619→\n   620→\n   621→#### **Unknown Treatment** (`???`)\n   622→> **Description**: \n   623→\n   624→\n   625→#### **Unknown Treatment** (`???`)\n   626→> **Description**: \n   627→\n   628→\n   629→### Hair Restoration\n   630→\n   631→#### **Unknown Treatment** (`???`)\n   632→> **Description**: \n   633→\n   634→\n   635→#### **Unknown Treatment** (`???`)\n   636→> **Description**: \n   637→\n   638→\n   639→#### **Unknown Treatment** (`???`)\n   640→> **Description**: \n   641→\n   642→\n   643→#### **Unknown Treatment** (`???`)\n   644→> **Description**: \n   645→\n   646→\n   647→#### **Unknown Treatment** (`???`)\n   648→> **Description**: \n   649→\n   650→\n   651→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"a7fe1a7e-3d48-4c85-b8e5-a80c2289a4b0","timestamp":"2025-12-26T14:49:56.339Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/FACEIQPAID/LOGIC/logic_report.md","content":"# FaceIQ Comprehensive Logic Report\n\nThis report details the logic used by the application to recommend treatments, including Surgeries, Soft-Maxes (NST), and Lifestyle changes. It also documents the specific impacts these treatments have on facial scoring.\n\n## 1. Trigger Logic Map (Flaw -> Treatments)\nThe following table maps specific Flaws to recommended Treatments.\n\n| Flaw (Trigger) | Recommended Treatment | Category |\n| :--- | :--- | :--- |\n| Disproportionate lower face (long chin or short philtrum) | Lip filler | NST |\n| Disproportionate lower face (short chin or long philtrum) | Jaw fillers | NST |\n| Disproportionate lower face (short chin or long philtrum) | Lip filler | NST |\n| Double chin | Cryolipolysis (fat freezing) | NST |\n| Double chin | Kybella (double chin removal) | NST |\n| Flat & small cheekbones | Cheekbone fillers | NST |\n| Flat jaw | Jaw fillers | NST |\n| High submental fat | Cryolipolysis (fat freezing) | NST |\n| High submental fat | Kybella (double chin removal) | NST |\n| Lacking Ogee curve | Cheekbone fillers | NST |\n| Lacking cupid's bow | Lip filler | NST |\n| Long midface | Cheekbone fillers | NST |\n| Long midface | Lip filler | NST |\n| Low-set cheekbones | Cheekbone fillers | NST |\n| Mandibular recession | Jaw fillers | NST |\n| Medium-set cheekbones | Cheekbone fillers | NST |\n| Mouth asymmetry | Lip filler | NST |\n| Narrow jaw | Jaw fillers | NST |\n| Overly long face shape | Cheekbone fillers | NST |\n| Overly retruded lower lip | Lip filler | NST |\n| Overly retruded upper lip | Lip filler | NST |\n| Round neck region | Cryolipolysis (fat freezing) | NST |\n| Rounder convex facial profile | Jaw fillers | NST |\n| Short lower third | Jaw fillers | NST |\n| Short ramus | Jaw fillers | NST |\n| Steep jaw | Jaw fillers | NST |\n| Thin lower lip | Lip filler | NST |\n| Thin upper lip | Lip filler | NST |\n| Undefined jawline | Cryolipolysis (fat freezing) | NST |\n| Undefined jawline | Jaw fillers | NST |\n| Undefined jawline | Kybella (double chin removal) | NST |\n| Underprojected chin | Jaw fillers | NST |\n| Weak/soft jaw structure | Jaw fillers | NST |\n| Wide-set eyes | Cheekbone fillers | NST |\n\n---\n\n## 2. Comprehensive Treatment Library\n### Surgical Procedures\n\n#### **Facial liposuction** (`SUR-36`)\n> **Description**: Removes excess fat from face for contouring, often chin/jawline/temples.\n\n- **Risks/Side Effects**: ÎÎ§Î¼ÏÏÎ¨Î£Î£ Î¸Î©ÎÎºÏÎ½ ÏÎ²ÏÎ ÎÎ¤Î¦Î½Î² Î¼ÎÎµÎÎÎ¿ÎÎ ÎµÎ·Ï Î¦ÎÎÏÎÎ¨ ÏÏÎ¦Î Î¤ÎÏÏÎ§Î§ ÏÎÏÎ¡ ÏÏÎ Î© ÎÎ¾Î Î³ÎÏ ÎÎ¹Î¥ÎÎ Î©ÎÎ¥ Î·ÏÎÎ¶ÎÎÎ± Î¦Î¹Î³ÏÏ ÏÎ¦ÏÎÎµÏÎ© ÎÎ¨ÏÎ¨ Î·ÏÎÏ Î³ÎÏÎ¨Î¾Î²Î»Î» Î£Î©Î¦Î¡ ÏÎµÎ»Î¹Î ÎÎ ÎµÎ¥Î·Îº Î¥Î Î¸ÏÏÎ¨Î· ÎÎÎ±ÎÎ·Î´Ï Î\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Canthopexy** (`SUR-33`)\n> **Description**: Tightens lower eyelid to prevent sagging and support eye shape.\n\n- **Risks/Side Effects**: ÏÏÏÎ¹ÎÎ¡ÎÎ¿ Î¹Î¨Ï Î¶ÏÏ ÎÎ²ÏÎÎ¥ ÏÎÎ ÎÎ¦ÎºÏÎ ÎÏÎº Î·Î£Î» ÎÎ¾Î Î§ÎºÎ Î±Î½ÎÎÎ¹Î½Î£ ÏÎÎ²ÏÎ»ÎÎ§Î Î½Î¦ÎÏ ÎÏÏÎ ÎÎÎÎ ÏÎÎ¾ÎÎ£ÎÎ Î¨ÎºÎÎµÎ ÎÎÎ¥Î·Î Î¹ÎÎ¤Î¨Î¨ Î½ÏÎÎÎÎ¹Î ÏÎÎ ÏÎ¨ÎÎÎ¸Î³Î¶Î¦ ÏÎÎ¾Î³ Î©Î¡ÏÎ±Î½Î¸Î·Î½ ÎÎ¿Î¿ ÎÎµÎ² ÏÏÎÎ¹Î³ ÏÎ§Î¹ ÏÏ\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Canthoplasty** (`SUR-25`)\n> **Description**: Targets the corners of the eye to alter the shape, tilt, and size of the eyes.\n\n- **Risks/Side Effects**: ÏÎÏÎÎ¦ÎÎ Î Î¸Î·ÎÎÏÎÎºÏ ÏÏÎÎ²Î¿Î»Ï Î¡ÏÎÎÏÏÏÎ¥ ÏÏÎÎÎ  ÎÎºÎ¦Ï Î ÏÎ¹ÎÏÎ» Î³Î¤Î Î Î¡ÎÎ»Î Î³Î¸Î´Î£Î ÏÎ³ÎÎ§Î¿ ÏÎ¼ÎÎ²Î·Î ÎÎÎ¸ÎÎ¡ÏÎ¼ ÎÎ¤Î¦ Î¥ÎÎ¶Î ÎµÎ´ÎÎÎ© ÎÎÎÎ±Î±Î¦ÎÎ ÎÎÏÎ¥ÎÎ Î³ Î¶ÏÎ ÎÎÎ± ÎÎÎ©Î©ÎÎÎ²Î\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **ÏÏÎ¿ÎÏÎ ÎÎ½Î¾ ÎÎÎ¤ÎÎÏÎ** (`SUR-35`)\n> **Description**: Î½ÏÎ Î ÎÎÎ¥Î Î¨Î¼Ï ÏÎ´ÎÎ¸Î¤Î¿ ÏÎ Ï ÏÏÎºÎÎÏ Î³ÎÎ¸ÎÏÎÎ±Î Î Î±ÏÎÎÎ²Î£Î ÎºÎ²Î§Î»ÎÎ¶Ï Î³Î³Î±ÎÎºÎ³ÎÎ¨ Î½ÎÎºÎÎ ÎÎ¼Î Î¦ÎÎ ÏÎ¾Î³Î·Î¼Î ÏÏÎÎÏÎÎ  Î ÎÏÏÎ ÏÎ³ ÏÏÎ½Î¸Î\n\n- **Risks/Side Effects**: Î·Î¿ÏÎÎ Î³ÎÎ² Î¾ÎÎ Î´Î¼ÎÎÎ ÎÎ¤Îµ ÎÎ¿ÎÎ·ÏÎÎ¤Î¤ Î³Î»Ï Î£ÏÎ¸ÎÎ½ÏÎ§Î ÏÏÎ¦ ÏÏÏÎ¹Î Î·ÏÎÏÎ Î£Î¤Î Î¼ Î¶Î¨Î¤ Î±ÎÎ¹Î¹Î± ÏÎÎÎ£ÏÏÏÎ ÎÎ»ÏÎÎ ÎÏÎ² ÎÎ¸ÎÎ¤Î±Î Î Î¡ÏÎ¨ÎÎÎ³ Î±Î½Î²Î Î±ÏÎ¤ÏÎ¿ Î¨Î¿Î¦Î¹Î¾ ÏÏÎÎ¶ ÏÎ¹ÏÏÎ´ÏÎ¹Î ÎÎ¹ÎÎ¼ Î Î¹Ï ÎÎÎ£Î±ÎÎ ÎÏÎ¾\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Chin implants** (`SUR-07`)\n> **Description**: Implants to specifically enhance chin projection and shape.\n\n- **Risks/Side Effects**: ÏÎ¸Î¨Î²Î½Î¤Î¦Î± Î¾ÎµÎ§Î´Î¹ÎÏ ÏÎÎÎ ÎÎÎ¨ Î§ÎÎÎÎÎ¶Î¸ ÏÏÎÎ¤Î¦ ÎÏÎ¤ ÎºÎÎ©ÎÎ£Î¶Î» Î¤ÏÎ³ÎÎ©Î± Î¡ÎÎ¨Î¡Î§Î¡ Î¶Î²Î³ÏÎ¿Î Î£ÏÎ¨Î Î§Î±Î¹Î£ÎÎ»Ï Î´Î³ÎÎÎ¤Î Î¡ ÏÎÎ ÎÎÏÏÎÏ Î·Î©Î¥ÏÏ Î£Î¾Î¹ÎÎ·Ï ÏÎ¡ÎÎ¤ÏÏÎ¨Î¦ Î´ÎÏÎÎ· ÎÎÎÏÎ»\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Fat grafting** (`SUR-09`)\n> **Description**: Fat is harvested from the patient and processed. Microfat is for volume enhancement. Nanofat is for facial/skin rejuvenation.\n\n- **Risks/Side Effects**: ÎµÎÎÎÎ¡Î¾ÎÎ Î¸Î¾Î¸Î£Î³ÏÎÏ Î¼ÎÎ¤Î£ÏÎ¨Î·Î Î·Î±Î·ÎÎ Î³Î»Î§ÎÎ¡ Î¥Î·Î§ÎÎÏÎµÏ ÎÎÎÎÎ¨ÏÎ§ Î©ÏÏÎº ÏÎÎ± ÏÎ©ÎÎÎ¶Î¶ÎÎ§ Î»Î Î ÏÎ¤Î  Î²Î©Î¶Î» Î£Î¤ÎÎ¥Î´Î¤Î ÎÎ¥Î½Î±Î¿Ï Î½Î¥ÎÎ¸Î Î¶Î±Î¥Î¶Î¤ÎÏÎ¸ Î¼ÎµÎ¦Î»Î¸ÎÎÎ¥ ÏÎ»ÏÎ¿ÎÏÎ»Î£ Î´ÏÎ¥Î ÏÏÎÎ¨ÎÎ²Î ÎÎÎ Î»Î Î¿Î¥ÎÏÏÎ¿Î±Ï ÎÎ¿Î¸ÎÎÎ ÎÎ¥ÏÎ¼ÎºÎµ Î¸ÎÎ¤ÏÎ ÏÎÏÎ¾ÎÏÎ Î½Î©ÎÎ¤ Î©Î¥ÎÎ¼ÎÎÏÎ¤ ÎÎÎ·Î¦Î ÎÎ±ÎÎ²ÏÎÎºÎ© Î¦Î²ÎÎÏÎ» ÏÏÎ§ÏÎ§Î¾ Î·Î³Î¤ÎÎ¤Î§ Î¥Î¸Î´Î¼Î³ÎÎ· ÎÎ©ÏÏÎ ÏÎ§Î¸Î Î¾Î¼Î¾Î©ÎÎ´Î» ÎµÎ§ÎÏÎ¸Î ÎÎ¡ÏÎÎ¶Î¿Î¶Î ÎÎ¡ÎºÎ¿ÏÎ Î³Ï Î¡ÏÎÏÎ§ Î²ÎÏÎ¹ÎÎ¶ ÎÏÎ»ÏÎ¡ ÎÎÎ´ Î¶ÏÎ¹ÏÎ¦Î Î¹ Î¼Î£ÎÏ ÏÎ¡Î¦Î»ÏÎ½ÏÎ¡ ÎÎ©Î±ÎÎ½ÎÎ³Ï ÏÎ·Î¿ÎÎ¥ ÏÎ§Î ÎÎ\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Jaw implants** (`SUR-17`)\n> **Description**: Implants to enhance/ augment jaw bone for a prominent jawline.\n\n- **Risks/Side Effects**: Î¨ÏÎÏÎµÎ¾ÏÎ Î»Î¶ÎÎ Î Î¿Î¦Î¥Î´ ÎÎ¡Î¥ÎÎµÎ¾Î¹ Î»ÎÎÏÎ ÏÎÎ¸Î¾ ÎÎ¾ÎÎ¨Î³ÏÎÎ ÎÎ§ÏÎ Î³ÎÎ¥ÏÎ¥ÏÎ Î¾Î³ÏÏÎÏÏÎ\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Jaw reduction surgery** (`SUR-34`)\n> **Description**: Reshapes jawbone to slim and contour the lower face, often for V-line effect.\n\n- **Risks/Side Effects**: ÎºÎ©ÏÎ Î²Î¡ÏÏ Î¼ÎÎ§ÎµÎ¡Î¼ ÎÎ³Î£ ÏÎ¥Îµ ÎÎ·ÎÎºÎ·ÎÎÎ ÎÏÎÏ ÎµÏÎ Î¸Î¸Î¦ Î¡Î´Î²ÏÎ¼Î Î¨ÎÎ¸ÎÎ´Î§ Î¡ÎÏÎ¶Î Ï Î´Î»ÏÎ¾ ÏÏÎ¡ÏÎ² ÏÎÏÏ ÎÏÎ£Î±ÎµÎ·Î²Î Î¿ÏÏÎ¸Î´Î  ÎÎ´ÏÎÎÎº Î¶ÎÎÏÎ¨ÎÎ ÏÏÎÎ©Î»ÎºÎ ÎÏÎ¤ÎÎ¥ÎÎÎ ÏÎ¾ÎÎÏÏ Î¦Î·ÎÎ¸ÏÎÎ» ÎÎÏÎ±Î ÎÎ§Î Î´ Î±Î¡ÎÏÎ Î·ÎÎ¿ÎÎ·ÏÎ¤Î¶ Î»ÎÎÎ±Î·Î¿ ÏÎÎ Î¿Î²Î ÎÎ¦Î£Î ÎÎ¦ÎÎÎ»ÎÏÎ ÎÎ¸Î¼ÏÎ§Ï Î»Î»ÏÎ§Îº ÏÎ¦ÎÎ¡Î¦ÎÎ©Ï Î¤Î´Î¾Î¦ Î ÏÎÎ¦ÎºÎ¦ Î·ÎÎ¨ÎµÏ ÎÎÎ·Î Î¨Î¥Ï ÎÎ¤ÎÎ´ÎÎÎ»Î¼ ÏÎ¶Î»ÎÎ¥Ï Î´ÎÎÏÎÎÏÎ¡ ÎÏÏÎÎ¹ÎÎ¿ ÏÎ ÏÎ¸Î¸Î¾ÏÎ½\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Bimaxillary osteotomy** (`SUR-13`)\n> **Description**: Reposition both the jaws for facial balance and remove any misalignment.\n\n- **Risks/Side Effects**: ÎÎ Î¦Î Î·ÎÎ¾Î· Î»ÏÎÎ Î¼ÏÎ¹ÎÎ¾ Î¶ÎÎÎ· ÏÎÎ³Î¿ Î¦Î²ÎÎÏ ÎÎ½Î´ Î¤ÏÎÎ¨Î¨ÎÎÎ¸ ÏÎÎÎ¦Î·Î¡ÎÎ¨ ÎÏÏÎ¨ÎÎÎ¶ ÎÎÎ¤ÏÏÎÏ Î½Î¥ÏÎ·ÎÎÎ§Î¨ Î¿ÏÎ§Î¥ Î ÎÎÎ¹Î¦Î¥Î» ÏÎ¿Î·Î¦ÏÎ³ ÏÎ¿Î ÎÎÎ ÎµÎ³ÎÎÎÎ Î¹Î¹ÏÎ§Î§ ÎÎÎÎÎÎ¡ Î¡ÏÎ·Î¡Î\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Neck lift** (`SUR-21`)\n> **Description**: Comprehensive procedure that removes excess skin and lifts the neck skin May include “Submental Tuck” (muscle/skin tightening) or “Submental Liposuction” (fat removal)\n\n- **Risks/Side Effects**: Î¤ÎÎÎ¾Î¤ÎÎÏ Î½Î¤ÏÎ¥Î±Î¼ÎÎ© Î¼ÎÎ½Î²ÎÏÎÎ Î¤Î£Î Î³ÏÎ¸Î ÎÎÏÎÎ¸ Î´ÎÏÏ Î¼Î¨Î¹Î¨ÎÏÎ¨Î Î¤Î±ÎÎÎÎµÎ Î¸Î¤Î©Î¹Î¼ Î©ÎÎÎÎÎÏÎ Î¼ÏÎ¼Î·ÎÎ±Î  ÎÏÎ´Î·ÎÎÎ¡Î½ Î¸ÎÎ¶Î£Î£ ÎºÎÎ¾ÎÎ¤Î\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Midface implants** (`SUR-06`)\n> **Description**: Implants to enhance and augment midface projection.\n\n- **Risks/Side Effects**: ÏÎÎ·Î¿Î©ÏÎÎµ Î¼ÏÎ·ÏÎ¥Î¼Î± ÎºÎÎºÎ±Î§Î½Ï Î±ÏÎÎ³Î Î¤ÏÎ¨ÏÎÎ¡ ÎÎ§Î´ÏÏÎ½ Î§Î¨Î³ Î§Î±ÏÎ ÎÏÎºÎ»ÎÎµÎÎ¦ ÎÎ¹Î¾Î¿Î Î¦ÎÎµÎ Î·Î²Î£ ÎÎ¼ÎÎÎÎÎ¡ ÎÎ¹ÎÎ Î¼ÏÎÏÎ¸Î§Î Î¿Î£Î§ÎÎ§ÎÎÎ© Î¿Î½Î³ÎÎ¥\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Î¶Î¿ÎÎÎ¶Ï Î¸ÏÎ»ÎµÎÎÎÎ³ ÎÏ** (`SUR-39`)\n> **Description**: Î¨Î»Î½Î ÎÎ½Î¿ÎÎ»ÎÎ¼ Î¸Î¥Î Î¤ Î³Î¥ÎµÎÏ Î¾ÎÎÎÎ¿ÎÎ¦ ÎÎ¨Î¼ÎÎµÎ¶Î Î¦Î±ÏÎ¿ ÎÎ¿Î´ÏÎÎ¦ÎÎ ÎÎ½ÎºÎ²Î¹ÏÎ¤ ÎÏÎÎ¾Î£ ÏÎ¿ÏÎÎÎÎ¶Ï ÏÎµÎµÎ¥ ÎµÏÎ¦Î±ÎÎÎ¡ ÎÎ½ÏÎ ÎÎÎ¡Î³ÎÏÎ£Î¿ ÏÏÏÏÎ¨ÏÎ§Î¦ ÏÎÎ¸Î Î£ÎÎ¾ÎÏ Î£ÏÎÎ¶ÎÎ£ Î¥Î¾Î ÎÎ¿ ÎÎÎ¹Î¦Î²Î¨Î£ Î©ÏÎ³ÏÎ³ÏÎ³Î§ Î´Î¹ÎÎ±ÎÎ¹ÎÎ Î²Î¹ÎÎÎÎ§ ÏÎ½ÎÎÎ ÏÎÎµÎ Ï ÎÎÎ©Î ÎÏÎ¦Î Î Î£ÏÎÎÏÎ Î¡ÎµÎ´Î¡Ï Î¹Î»ÏÎ¤ÏÎ£ÎÏ ÎÏÎÎ± Î¤ÎÎÏ Î¸ÏÎÎ©Î½ ÏÎ§Î§ÎÎº ÎÎ§Î´Î·ÎÎ ÏÎ£ÎºÎÎÎ³Î±Îµ ÏÏÎÎ²ÏÎ ÏÎ¥ÎÎ¶ÎÎ£Î¨Î  Î ÎÎºÎ³\n\n- **Risks/Side Effects**: Î¡Î¶ÎÎÎÎ±ÏÏ Î»Î¾ÎÎºÎÎÏ ÏÎ¹ÎºÏÏÏÎ£Î¾ ÏÎ¡Î½Î©ÏÎ¹ ÏÏÎÏÎÎ Ï ÎÏÎÎ»Î¸Î ÏÎÎ´ Î²ÎÎ¾ Î¹Î ÎÎ³Î ÏÎµÎ¾Î¸ÏÎ¨ ÎÎÎ Î¶Î¥Î ÎºÎ£ÏÎ´ÎµÎ¹Î¹Î¶ Î¹Î¨Î¸Î¨ Î²Î²ÎÎ½ÎÎ¾Î¹ Î Î£ÏÎ´Î±Î² ÎÎ¿ÏÏÏÏÎº Î»ÎÎÎ¨ Î¦ÎÎÎ¶ÎÎ¼ Î¼ÎÎ ÎÎ»Î Î¼Î¿ ÎÎ§ÎÎÎÎ² ÎÎºÎ£ÎÎÏ Î¤ÏÎ³Î¾ÎÎ·ÎºÎ½ Î¶Î¸Î¶Î Î²Î´Î¶ÏÏÎ¥Î´Î ÏÎ¤Î¦ÎÎÎÎ Î¿ÏÎÎ½ ÎÎ¾ÎÎÎ¦Î¥ ÏÎÏÎ¼ÎÏ ÏÎÎ³Î Î¿ÎÎ´Î±Î¾ ÎºÎ²Î² ÎÏ\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Supraorbital rim implants** (`SUR-22`)\n> **Description**: Implant to enhance the upper orbital hollows for proper orbital definition.\n\n- **Risks/Side Effects**: ÎÎ¡Î±Î³ÏÎÎÏ Î¼ÏÎ»Î© ÎÎ§ÏÎÎÎÏ Î¡ÎºÎºÏÎ¸ÎÎ© Î Î²ÏÎ ÎÎÎ¡ÏÎ¼ ÎÎ§ÎÎÎÎ² ÎÎºÏÎ©Î Î©Î±Ï ÏÎÎ¨ÎÏÎ·ÏÎ Î¸ÎÎºÎ¦Î©Î² ÎÎ¤ÎÎÎ Î¡ÎÎ¥ ÎÎ¾Î¡Î» Î´ÎÎµÎÏ ÎÎ£ÏÎ¸ÎºÎ½Î½Î» ÏÏÏÎ´ÎµÎ» Î¨Î³Î¸ÏÏ Î±ÎÏÏÎ ÎµÎ¹ Î¾ÎÎ±ÎÎ¹ ÎÎÎ¡Î´Î  Î¸Î¸ÎÏ ÏÎ Î¼Î¦Î³ÎÎÎ ÎÏÎÎ²Î±ÏÎÎ± ÎÎ¤ÏÎ±Î½Î\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Submental liposuction** (`SUR-38`)\n> **Description**: Removes excess fat beneath the chin to refine the jawline and improve neck contour.\n\n- **Risks/Side Effects**: ÎÎ»Î¶Î¶Î£Î¼Î¥Îº Î¸Î Î ÏÎÎ³Î¼Î Î¹Î¿ÎµÏÎÎ´Ï Î±ÎÎÎ»ÎÎ¼Ï ÏÎÎ ÏÎÎ¦ÏÎ²Î  Î¨ÏÎÎ¹Îº Î©Î¨ÎÎ³ Î²ÏÎ§Î¨Î²Î ÎÎ¦ÎÏÏÎ¨ ÏÏÎÏÎ¹ ÎÏÎÎÎ¦Î¾ ÎÎÏÎ ÏÎÎÎ¶Îº ÎÎ¨ÏÎ¨Î¤Î£Î¼Î¡ Î Î¿ÏÏ Î¦Î±ÏÎÎ´Î· ÎÎ½ÎÏÎÎÏÎ ÏÎÎ§Î¨Î·Îµ Î¨ÎºÎÎÎ¾Î¦Î¤ ÎÎ¾ÎÎ¤Î Î´ Î·ÎÎ¹Î¼ÏÎ©Î© ÎÎÎ´Î·ÎÏ ÎÏÏÎÏÎ ÎÎÎÎ¼Ï ÎÎÎºÎÎ¥Î¥Î¿Î½ ÏÎ¿ÎÎ¥ÎÎÏÎ ÎµÏÏÏÏÎ ÎÎÎµÎµÎÎ  ÏÏÏÎ¤Î\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Submental tuck (submentoplasty)** (`SUR-11`)\n> **Description**: Direct excision of submental skin/fat with platysma plication; tightens central neck muscles and removes excess tissue and fat. Also called cervicoplasty. Targets submental fullness and laxity via small incision under chin.\n\n- **Risks/Side Effects**: ÎÎÎ¨Î£ÏÎÎ§Î Î¹ÎÎ¡ÏÏÎ½Î© Î¹Î·ÎÎÎÎ³ÏÎ¥ Î¼ÎÎÎ¹ÎÎ¥ Î²ÎÏÏÎ¹Î±ÎÏ Î©ÎÎ³ÎµÎ² ÎÏÎÎÎµÏÎ¼ ÏÎ¶Î½ ÏÎÎºÎ³ ÏÎÎÎ¼Î»ÎÏÎ\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Lip reduction surgery (reduction cheiloplasty)** (`SUR-40`)\n> **Description**: Surgically removes excess lip tissue to reduce lip volume and projection, improving proportion between the lips and surrounding features.\n\n- **Risks/Side Effects**: Î¦ÎÎ¡ÎÎ ÎÎ©Î¡ Î¹ÎÎ§Î¶ ÎÎ¥Î± Î²Î©Î¦Î·Î ÎÏÎ²ÎÎÎÎ³Î³ ÎÎÏ ÎÎÎ²Î±Î¼ÎÎ·Î¿ ÎµÎ¿Î¦ Î¨Î¹ÎºÎ¤ÎÎ¿ ÎºÎ´Î¹ÎÏÎ¤ÏÎ£ ÎÎ´Î´ÏÎ¦Î¿Î£Î¼ Î¥Î¦Î Î»Î³Î¸Î£Î»Î¸ Î¨ÎÎÎ¸ÎÎ½Î¿Ï ÎÎ¡Î·Î¶ ÎÎ£Î¤ÏÎ½Î§Î¿Î§ Î¡Î´ÎºÎ´\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Cheekbone implants** (`SUR-05`)\n> **Description**: Implants to enhance zygomatic prominence.\n\n- **Risks/Side Effects**: Î´ÎÎÎ´ÎÎÏÎ¶ Î»Î¨Î¡ÏÎÎÎ»Î  Î¨Î©Î´Ï Î¿Î¦ÎÎ© Î¹Î´Î¹ÏÎÎ¡ÏÎ ÎÏÎ²Î©Î¥ ÎÎÎ½ÎÎµÎ¡Îº Î²Î¼ÎÎ¹Î Î©Î·Î¾ÏÎ§Î ÎÎ±ÏÎÏÎ·Î´Ï ÎÎºÏÎ¶Î¿Î¹ ÏÏÎÎ¦ ÏÎÎ³ÎÎÎÎÎ» ÏÎÎ¸Î§Î£ÎÎ Î·ÎºÏ ÎÎ¥Î¨ÏÏ ÏÏÎÎÎÏÎ Î½Î²Ï ÏÏÏÎ ÏÎ¶Î±ÎÏ Î±ÎÏÎ¡ÏÎ²Î ÎµÎ¤Î»ÏÎÎµÎ¹Ï Î£ÎÎµÏÎ¥ÎµÎ Î\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Genioplasty** (`SUR-20`)\n> **Description**: Osteotomy of chin bone to reshape the chin for symmetry and facial balance.\n\n- **Risks/Side Effects**: Î¼ÎÎ¼ÎÎ¿ÏÎ Ï Î¾ÏÎÎÎ¶Î ÎÎ»Î¥Î© ÎÏÎÎ¶Î´Î¦Î¼Î Î¿Î£Î©Î¦ ÎÎÎ¥Î¦Î³ ÎÎÎµÎµÎ£ÏÎ¥ ÎÎÎ¥Î¾ ÎÎÎÎÎ»ÏÎ» ÎÎ¸ÏÎ½ÎµÏ ÎÎ»ÏÏÎ¥ÎÎ² Î¡ÎÎÎÏ ÎÎ´Î¶ÏÏ\n- **Logic Rules (Triggers & Impacts)**:\n\n#### **Lip lift** (`SUR-29`)\n> **Description**: Shorten philtrum by skin removal under nose.\n\n- **Risks/Side Effects**: Î»Î´ÎÏÏÎÎÎ¨ Î¸Î¶Î¼ÎÎµ ÏÎ½Î·Î·Î§ÎºÏ ÎÎ§Î¸ Î¥Î¨ÎÎ³ ÎÎÎºÎ§ÏÏ ÎºÎ¡Î¶Î¶Î¾ÎÎÏ Î Î±Î·Î´Î´ÎÏ ÎºÏÎ¼ Î¡Î´Î½ Î¶Î Î¨Î¹ÎÏÏÎ ÎµÎ£ÎÎÏÎ³Î Î¸Î¾Î©Î¨Î³Î·Î¦\n- **Logic Rules (Triggers & Impacts)**:\n\n### Non-Surgical Treatments (Soft-Maxes)\n\n#### **Jaw fillers** (`NST-05`)\n> **Description**: Injectable fillers to enhance jawline definition, width, and projection.\n\n- **Risks/Side Effects**: Temporary swelling, bruising, asymmetry, lumps, infection, vascular occlusion (rare but vision/necrosis risk), blueish discolouration (if superficial), migration.\n- **Logic Rules (Triggers & Impacts)**:\n    - **Trigger**: \"Weak/soft jaw structure\"\n      - **Impacts**:\n        - `Bigonial width`: increase (2%)\n        - `Ramus to Mandible Ratio`: increase (2%)\n        - `Recession relative to frankfort plane`: increase (2%)\n        - `Lower Third`: increase (2%)\n        - `Lower Third Proportion`: decrease (2%)\n        - `Chin to philtrum ratio`: increase (2%)\n        - `Total Facial Width to Height Ratio`: increase (2%)\n        - `Facial Convexity (Glabella)`: increase (2%)\n        - `Facial Convexity (Nasion)`: increase (2%)\n        - `Total Facial Convexity`: increase (2%)\n        - `Jaw Frontal Angle`: both (2%)\n        - `Nasofacial Angle`: decrease (2%)\n        - `Nasomental Angle`: increase (2%)\n        - `Mentolabial angle`: decrease (2%)\n        - `Gonion to mouth line`: increase (2%)\n        - `Upper Lip S-Line Position`: both (2%)\n        - `Lower Lip S-Line Position`: both (2%)\n        - `Upper Lip E-Line Position`: both (2%)\n        - `Lower Lip E-Line Position`: both (2%)\n        - `Upper Lip Burstone Line`: both (2%)\n        - `Lower Lip Burstone Line`: both (2%)\n        - `Holdaway H Line`: both (2%)\n        - `Jaw Slope`: decrease (2%)\n    - **Trigger**: \"Narrow jaw\"\n      - **Impacts**:\n        - `Bigonial width`: increase (2%)\n        - `Jaw Frontal Angle`: increase (2%)\n        - `Neck Width`: decrease (2%)\n    - **Trigger**: \"Flat jaw\"\n      - **Impacts**:\n        - `Jaw Frontal Angle`: decrease (2%)\n        - `Lower Third`: increase (2%)\n        - `Lower Third Proportion`: decrease (2%)\n        - `Chin to philtrum ratio`: increase (2%)\n        - `Mandibular Plane Angle`: increase (2%)\n        - `Gonial Angle`: increase (2%)\n        - `Jaw Slope`: increase (2%)\n    - **Trigger**: \"Undefined jawline\"\n    - **Trigger**: \"Mandibular recession\"\n      - **Impacts**:\n        - `Recession relative to frankfort plane`: increase (2%)\n        - `Facial Convexity (Glabella)`: increase (2%)\n        - `Facial Convexity (Nasion)`: increase (2%)\n        - `Total Facial Convexity`: increase (2%)\n        - `Upper Lip S-Line Position`: both (2%)\n        - `Lower Lip S-Line Position`: both (2%)\n        - `Upper Lip E-Line Position`: both (2%)\n        - `Lower Lip E-Line Position`: both (2%)\n        - `Upper Lip Burstone Line`: both (2%)\n        - `Lower Lip Burstone Line`: both (2%)\n        - `Holdaway H Line`: both (2%)\n        - `Nasofacial Angle`: decrease (2%)\n        - `Nasomental Angle`: increase (2%)\n        - `Mentolabial angle`: decrease (2%)\n        - `Z Angle`: increase (2%)\n    - **Trigger**: \"Rounder convex facial profile\"\n      - **Impacts**:\n        - `Recession relative to frankfort plane`: increase (2%)\n        - `Facial Convexity (Glabella)`: increase (2%)\n        - `Facial Convexity (Nasion)`: increase (2%)\n        - `Total Facial Convexity`: increase (2%)\n        - `Upper Lip S-Line Position`: both (2%)\n        - `Lower Lip S-Line Position`: both (2%)\n        - `Upper Lip E-Line Position`: both (2%)\n        - `Lower Lip E-Line Position`: both (2%)\n        - `Upper Lip Burstone Line`: both (2%)\n        - `Lower Lip Burstone Line`: both (2%)\n        - `Holdaway H Line`: both (2%)\n        - `Nasofacial Angle`: decrease (2%)\n        - `Nasomental Angle`: increase (2%)\n        - `Mentolabial angle`: decrease (2%)\n    - **Trigger**: \"Underprojected chin\"\n      - **Impacts**:\n        - `Recession relative to frankfort plane`: increase (2%)\n        - `Facial Convexity (Glabella)`: increase (2%)\n        - `Facial Convexity (Nasion)`: increase (2%)\n        - `Total Facial Convexity`: increase (2%)\n        - `Upper Lip S-Line Position`: both (2%)\n        - `Lower Lip S-Line Position`: both (2%)\n        - `Upper Lip E-Line Position`: both (2%)\n        - `Lower Lip E-Line Position`: both (2%)\n        - `Upper Lip Burstone Line`: both (2%)\n        - `Lower Lip Burstone Line`: both (2%)\n        - `Holdaway H Line`: both (2%)\n        - `Nasofacial Angle`: decrease (2%)\n        - `Nasomental Angle`: increase (2%)\n        - `Mentolabial angle`: decrease (2%)\n    - **Trigger**: \"Steep jaw\"\n      - **Impacts**:\n        - `Jaw Frontal Angle`: increase (2%)\n        - `Mandibular Plane Angle`: decrease (2%)\n        - `Gonial Angle`: decrease (2%)\n    - **Trigger**: \"Short ramus\"\n      - **Impacts**:\n        - `Ramus to Mandible Ratio`: increase (2%)\n        - `Gonion to mouth line`: increase (2%)\n        - `Mandibular Plane Angle`: decrease (2%)\n        - `Gonial Angle`: decrease (2%)\n    - **Trigger**: \"Disproportionate lower face (short chin or long philtrum)\"\n      - **Impacts**:\n        - `Total Facial Width to Height Ratio`: increase (2%)\n        - `Chin to philtrum ratio`: increase (2%)\n        - `Lower Third`: increase (2%)\n        - `Lower Third Proportion`: decrease (2%)\n        - `Jaw Frontal Angle`: decrease (2%)\n        - `Mandibular Plane Angle`: increase (2%)\n        - `Gonial Angle`: increase (2%)\n    - **Trigger**: \"Short lower third\"\n      - **Impacts**:\n        - `Ramus to Mandible Ratio`: both (2%)\n        - `Recession relative to frankfort plane`: increase (2%)\n        - `Total Facial Width to Height Ratio`: increase (2%)\n        - `Lower Third`: increase (2%)\n        - `Lower Third Proportion`: decrease (2%)\n        - `Chin to philtrum ratio`: increase (2%)\n        - `Facial Convexity (Glabella)`: increase (2%)\n        - `Facial Convexity (Nasion)`: increase (2%)\n        - `Total Facial Convexity`: increase (2%)\n        - `Jaw Frontal Angle`: decrease (2%)\n        - `Nasofacial Angle`: decrease (2%)\n        - `Nasomental Angle`: increase (2%)\n        - `Mentolabial angle`: decrease (2%)\n        - `Upper lip E-line position`: increase (2%)\n        - `Lower lip E-line position`: increase (2%)\n        - `Upper lip S-line position`: increase (2%)\n        - `Lower lip S-line position`: increase (2%)\n        - `Upper lip Burstone line`: increase (2%)\n        - `Lower lip Burstone line`: increase (2%)\n        - `Holdaway H line`: increase (2%)\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Kybella (double chin removal)** (`NST-01`)\n> **Description**: Injectable deoxycholic acid to dissolve submental fat.\n\n- **Risks/Side Effects**: Swelling, bruising, numbness, pain, nerve injury, asymmetry.\n- **Logic Rules (Triggers & Impacts)**:\n    - **Trigger**: \"Double chin\"\n      - **Impacts**:\n        - `Submental Cervical Angle`: decrease (2%)\n    - **Trigger**: \"High submental fat\"\n      - **Impacts**:\n        - `Submental Cervical Angle`: decrease (2%)\n    - **Trigger**: \"Undefined jawline\"\n      - **Impacts**:\n        - `Submental Cervical Angle`: decrease (2%)\n\n#### **Cheekbone fillers** (`NST-06`)\n> **Description**: Enhances cheekbone prominence for better facial angularity, harmony, and prominence.\n\n- **Risks/Side Effects**: Temporary swelling, asymmetry risk, bruising, lumps, infection, vascular compromise to retina (rare), nodules/biofilm.\n- **Logic Rules (Triggers & Impacts)**:\n    - **Trigger**: \"Flat & small cheekbones\"\n      - **Impacts**:\n        - `Cheekbone height`: increase (2%)\n        - `Facial width to height ratio`: increase (2%)\n        - `Total Facial Width to Height Ratio`: decrease (2%)\n        - `Bigonial width`: decrease (2%)\n        - `Eye Separation Ratio`: decrease (1%)\n        - `Bitemporal width`: decrease (2%)\n    - **Trigger**: \"Lacking Ogee curve\"\n      - **Impacts**:\n        - `Cheekbone height`: increase (2%)\n        - `Facial width to height ratio`: increase (2%)\n        - `Total Facial Width to Height Ratio`: decrease (2%)\n        - `Bigonial width`: decrease (2%)\n        - `Eye Separation Ratio`: decrease (1%)\n        - `Bitemporal width`: decrease (2%)\n    - **Trigger**: \"Low-set cheekbones\"\n      - **Impacts**:\n        - `Cheekbone height`: increase (2%)\n        - `Facial width to height ratio`: increase (2%)\n        - `Total Facial Width to Height Ratio`: decrease (2%)\n        - `Bigonial width`: decrease (2%)\n        - `Eye Separation Ratio`: decrease (1%)\n        - `Bitemporal width`: decrease (2%)\n    - **Trigger**: \"Medium-set cheekbones\"\n      - **Impacts**:\n        - `Cheekbone height`: increase (2%)\n        - `Facial width to height ratio`: increase (2%)\n        - `Total Facial Width to Height Ratio`: decrease (2%)\n        - `Bigonial width`: decrease (2%)\n        - `Eye Separation Ratio`: decrease (1%)\n        - `Bitemporal width`: decrease (2%)\n    - **Trigger**: \"Overly long face shape\"\n      - **Impacts**:\n        - `Cheekbone height`: increase (2%)\n        - `Facial width to height ratio`: increase (2%)\n        - `Total Facial Width to Height Ratio`: decrease (2%)\n        - `Bigonial width`: decrease (2%)\n        - `Eye Separation Ratio`: decrease (1%)\n        - `Bitemporal width`: decrease (2%)\n    - **Trigger**: \"Long midface\"\n      - **Impacts**:\n        - `Cheekbone height`: increase (2%)\n        - `Facial width to height ratio`: increase (2%)\n        - `Total Facial Width to Height Ratio`: decrease (2%)\n        - `Bigonial width`: decrease (2%)\n        - `Eye Separation Ratio`: decrease (1%)\n        - `Bitemporal width`: decrease (2%)\n    - **Trigger**: \"Wide-set eyes\"\n      - **Impacts**:\n        - `Cheekbone height`: increase (2%)\n        - `Facial width to height ratio`: increase (2%)\n        - `Total Facial Width to Height Ratio`: decrease (2%)\n        - `Bigonial width`: decrease (2%)\n        - `Eye Separation Ratio`: decrease (1%)\n        - `Bitemporal width`: decrease (2%)\n\n#### **Cryolipolysis (fat freezing)** (`NST-04`)\n> **Description**: Noninvasive fat reduction via controlled cooling (e.g., CoolSculpting); targets stubborn subcutaneous fat without surgery. FDA-cleared for abdomen, flanks, thighs, arms, back, and submental area.\n\n- **Risks/Side Effects**: Temporary erythema/swelling, bruising, numbness/paresthesia, pain, edema, paradoxical adipose hyperplasia, frostbite, hyperpigmentation.\n- **Logic Rules (Triggers & Impacts)**:\n    - **Trigger**: \"Double chin\"\n      - **Impacts**:\n        - `Submental Cervical Angle`: decrease (2%)\n    - **Trigger**: \"High submental fat\"\n      - **Impacts**:\n        - `Submental Cervical Angle`: decrease (2%)\n    - **Trigger**: \"Undefined jawline\"\n      - **Impacts**:\n        - `Submental Cervical Angle`: decrease (2%)\n    - **Trigger**: \"Round neck region\"\n      - **Impacts**:\n        - `Submental Cervical Angle`: decrease (2%)\n\n#### **Lip filler** (`NST-08`)\n> **Description**: injectable filler to enhance lip volume, contour and correct asymmetry.\n\n- **Risks/Side Effects**: Swelling, lumps, bruising, asymmetry, vascular occlusion, vascular occlusion; mucosal ulceration if over-filled.\n- **Logic Rules (Triggers & Impacts)**:\n    - **Trigger**: \"Thin upper lip\"\n      - **Impacts**:\n        - `Lip Thickness`: increase (2%)\n        - `Lower Lip to Upper Lip Ratio`: decrease (2%)\n        - `Upper Lip S-Line Position`: decrease (2%)\n        - `Upper Lip E-Line Position`: decrease (2%)\n        - `Upper Lip Burstone Line`: decrease (2%)\n        - `Holdaway H Line`: increase (2%)\n        - `Nasolabial angle`: decrease (2%)\n        - `Chin to philtrum ratio`: increase (2%)\n        - `Midface Ratio`: increase (2%)\n        - `Facial Width to Height Ratio`: increase (2%)\n        - `Cupid's Bow Depth`: increase (2%)\n        - `Z Angle`: decrease (2%)\n    - **Trigger**: \"Lacking cupid's bow\"\n      - **Impacts**:\n        - `Cupid's Bow Depth`: increase (2%)\n        - `Lip Thickness`: increase (2%)\n        - `Lower Lip to Upper Lip Ratio`: decrease (2%)\n        - `Upper Lip S-Line Position`: decrease (2%)\n        - `Upper Lip E-Line Position`: decrease (2%)\n        - `Upper Lip Burstone Line`: decrease (2%)\n        - `Holdaway H Line`: increase (2%)\n        - `Nasolabial angle`: decrease (2%)\n        - `Chin to philtrum ratio`: increase (2%)\n        - `Midface Ratio`: increase (2%)\n        - `Facial Width to Height Ratio`: increase (2%)\n        - `Z Angle`: decrease (2%)\n    - **Trigger**: \"Thin lower lip\"\n      - **Impacts**:\n        - `Lip Thickness`: increase (2%)\n        - `Lower Lip to Upper Lip Ratio`: increase (2%)\n        - `Lower Lip S-Line Position`: decrease (2%)\n        - `Lower Lip E-Line Position`: decrease (2%)\n        - `Lower Lip Burstone Line`: decrease (2%)\n        - `Holdaway H Line`: decrease (2%)\n        - `Mentolabial angle`: decrease (2%)\n        - `Chin to philtrum ratio`: decrease (2%)\n    - **Trigger**: \"Overly retruded upper lip\"\n      - **Impacts**:\n        - `Lip Thickness`: increase (2%)\n        - `Lower Lip to Upper Lip Ratio`: decrease (2%)\n        - `Upper Lip S-Line Position`: decrease (2%)\n        - `Upper Lip E-Line Position`: decrease (2%)\n        - `Upper Lip Burstone Line`: decrease (2%)\n        - `Holdaway H Line`: increase (2%)\n        - `Nasolabial angle`: decrease (2%)\n        - `Chin to philtrum ratio`: increase (2%)\n        - `Midface Ratio`: increase (2%)\n        - `Facial Width to Height Ratio`: increase (2%)\n        - `Cupid's Bow Depth`: increase (2%)\n        - `Z Angle`: decrease (2%)\n    - **Trigger**: \"Overly retruded lower lip\"\n      - **Impacts**:\n        - `Lip Thickness`: increase (2%)\n        - `Lower Lip to Upper Lip Ratio`: increase (2%)\n        - `Lower Lip S-Line Position`: decrease (2%)\n        - `Lower Lip E-Line Position`: decrease (2%)\n        - `Lower Lip Burstone Line`: decrease (2%)\n        - `Holdaway H Line`: decrease (2%)\n        - `Mentolabial angle`: decrease (2%)\n        - `Chin to philtrum ratio`: decrease (2%)\n    - **Trigger**: \"Mouth asymmetry\"\n    - **Trigger**: \"Disproportionate lower face (short chin or long philtrum)\"\n      - **Impacts**:\n        - `Lip Thickness`: increase (2%)\n        - `Lower Lip to Upper Lip Ratio`: decrease (2%)\n        - `Upper Lip S-Line Position`: decrease (2%)\n        - `Upper Lip E-Line Position`: decrease (2%)\n        - `Upper Lip Burstone Line`: decrease (2%)\n        - `Holdaway H Line`: increase (2%)\n        - `Nasolabial angle`: decrease (2%)\n        - `Chin to philtrum ratio`: increase (2%)\n        - `Midface Ratio`: increase (2%)\n        - `Facial Width to Height Ratio`: increase (2%)\n    - **Trigger**: \"Disproportionate lower face (long chin or short philtrum)\"\n      - **Impacts**:\n        - `Lip Thickness`: increase (2%)\n        - `Lower Lip to Upper Lip Ratio`: increase (2%)\n        - `Lower Lip S-Line Position`: decrease (2%)\n        - `Lower Lip E-Line Position`: decrease (2%)\n        - `Lower Lip Burstone Line`: decrease (2%)\n        - `Holdaway H Line`: decrease (2%)\n        - `Mentolabial angle`: decrease (2%)\n        - `Chin to philtrum ratio`: decrease (2%)\n    - **Trigger**: \"Long midface\"\n      - **Impacts**:\n        - `Lip Thickness`: increase (2%)\n        - `Lower Lip to Upper Lip Ratio`: decrease (2%)\n        - `Upper Lip S-Line Position`: decrease (2%)\n        - `Upper Lip E-Line Position`: decrease (2%)\n        - `Upper Lip Burstone Line`: decrease (2%)\n        - `Holdaway H Line`: increase (2%)\n        - `Nasolabial angle`: decrease (2%)\n        - `Chin to philtrum ratio`: increase (2%)\n        - `Midface Ratio`: increase (2%)\n        - `Facial Width to Height Ratio`: increase (2%)\n\n### Lifestyle & Habits\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n### Cosmetics & Enhancement\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n### Hair Restoration\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n#### **Unknown Treatment** (`???`)\n> **Description**: \n\n\n","numLines":651,"startLine":1,"totalLines":651}}}
{"parentUuid":"a7fe1a7e-3d48-4c85-b8e5-a80c2289a4b0","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01ADefG1YnDNefDt6fBzTe9U","type":"message","role":"assistant","content":[{"type":"text","text":"Now I have a comprehensive understanding of the codebase. I can see that:\n\n1. `FlawAssessment` in `scoring/types.ts` already has a `confidence` field defined!\n2. The `Flaw` type in `types/results.ts` does not have a confidence field yet\n3. The insights engine uses Z-scores for severity calculation but doesn't expose confidence\n\nLet me check the components that display flaws to understand how to add the confidence badge:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":43491,"cache_creation_input_tokens":19021,"cache_read_input_tokens":26722,"cache_creation":{"ephemeral_5m_input_tokens":19021,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVV4jbR4MP6dsXdv9b6h","type":"assistant","uuid":"d27c79a2-7546-4a09-9440-98169f1623ca","timestamp":"2025-12-26T14:50:05.414Z"}
{"parentUuid":"d27c79a2-7546-4a09-9440-98169f1623ca","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01ADefG1YnDNefDt6fBzTe9U","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01TvQcqW5BEVrUCYmHtTqgiM","name":"Glob","input":{"pattern":"**/StrengthFlawCards.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":43491,"cache_creation_input_tokens":19021,"cache_read_input_tokens":26722,"cache_creation":{"ephemeral_5m_input_tokens":19021,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVV4jbR4MP6dsXdv9b6h","type":"assistant","uuid":"48435ade-7d1f-4d55-a45c-94cc9fe0582d","timestamp":"2025-12-26T14:50:05.910Z"}
{"parentUuid":"48435ade-7d1f-4d55-a45c-94cc9fe0582d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01ADefG1YnDNefDt6fBzTe9U","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FLRa8C2fGeSdWNTXFGqr7s","name":"Glob","input":{"pattern":"**/WeakPointCard.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":43491,"cache_creation_input_tokens":19021,"cache_read_input_tokens":26722,"cache_creation":{"ephemeral_5m_input_tokens":19021,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVV4jbR4MP6dsXdv9b6h","type":"assistant","uuid":"16bc1cde-0645-4c0e-9e81-1ac45a43d8c4","timestamp":"2025-12-26T14:50:06.321Z"}
{"parentUuid":"16bc1cde-0645-4c0e-9e81-1ac45a43d8c4","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01ADefG1YnDNefDt6fBzTe9U","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014pNDYb8He3hhf7Rk2FbjWT","name":"Glob","input":{"pattern":"**/KeyStrengthsFlaws.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":43491,"cache_creation_input_tokens":19021,"cache_read_input_tokens":26722,"cache_creation":{"ephemeral_5m_input_tokens":19021,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVV4jbR4MP6dsXdv9b6h","type":"assistant","uuid":"8371005f-d44b-4528-914f-6880bf99a347","timestamp":"2025-12-26T14:50:06.789Z"}
{"parentUuid":"8371005f-d44b-4528-914f-6880bf99a347","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01TvQcqW5BEVrUCYmHtTqgiM","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx"}]},"uuid":"6762355d-2133-49ae-b152-109ded183e88","timestamp":"2025-12-26T14:50:07.743Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx"],"durationMs":882,"numFiles":1,"truncated":false}}
{"parentUuid":"6762355d-2133-49ae-b152-109ded183e88","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014pNDYb8He3hhf7Rk2FbjWT","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx"}]},"uuid":"212b1da7-7542-4630-8ead-0ccfaaaa1459","timestamp":"2025-12-26T14:50:07.744Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx"],"durationMs":882,"numFiles":1,"truncated":false}}
{"parentUuid":"212b1da7-7542-4630-8ead-0ccfaaaa1459","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FLRa8C2fGeSdWNTXFGqr7s","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx"}]},"uuid":"511a859d-6bb8-4165-8dad-86fd242ef356","timestamp":"2025-12-26T14:50:07.751Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx"],"durationMs":890,"numFiles":1,"truncated":false}}
{"parentUuid":"511a859d-6bb8-4165-8dad-86fd242ef356","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VGf9HH17bGWFATCDxGPVoJ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01EB3a3y6YHP7A9SvARgzYjZ","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":67,"cache_creation_input_tokens":43973,"cache_read_input_tokens":45743,"cache_creation":{"ephemeral_5m_input_tokens":43973,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"}},"requestId":"req_011CWVV5aVkTvUMEod6iQzmm","type":"assistant","uuid":"78a4ca97-2a6c-49fb-9769-9374664ab5b7","timestamp":"2025-12-26T14:50:14.136Z"}
{"parentUuid":"78a4ca97-2a6c-49fb-9769-9374664ab5b7","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VGf9HH17bGWFATCDxGPVoJ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01L44XQBatZV31sw78MbUcJP","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":67,"cache_creation_input_tokens":43973,"cache_read_input_tokens":45743,"cache_creation":{"ephemeral_5m_input_tokens":43973,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"}},"requestId":"req_011CWVV5aVkTvUMEod6iQzmm","type":"assistant","uuid":"dfbe93f1-4200-48b3-a6c9-716b6ad973ae","timestamp":"2025-12-26T14:50:14.843Z"}
{"parentUuid":"dfbe93f1-4200-48b3-a6c9-716b6ad973ae","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VGf9HH17bGWFATCDxGPVoJ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016RvSijiYNp2ubwMm6wRast","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":67,"cache_creation_input_tokens":43973,"cache_read_input_tokens":45743,"cache_creation":{"ephemeral_5m_input_tokens":43973,"ephemeral_1h_input_tokens":0},"output_tokens":230,"service_tier":"standard"}},"requestId":"req_011CWVV5aVkTvUMEod6iQzmm","type":"assistant","uuid":"bd92edeb-f163-44ae-bf0a-bd6fada3cc47","timestamp":"2025-12-26T14:50:15.514Z"}
{"parentUuid":"bd92edeb-f163-44ae-bf0a-bd6fada3cc47","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01EB3a3y6YHP7A9SvARgzYjZ","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useState, useMemo } from 'react';\n     4→import { motion, AnimatePresence } from 'framer-motion';\n     5→import { ChevronDown, AlertTriangle, CheckCircle, Sparkles } from 'lucide-react';\n     6→import { Strength, Flaw, Recommendation, getScoreColor } from '@/types/results';\n     7→\n     8→// ============================================\n     9→// QUALITY TIER BADGES (Harmony Style) - Strengths\n    10→// ============================================\n    11→\n    12→type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\n    13→\n    14→interface QualityConfig {\n    15→  label: string;\n    16→  textColor: string;\n    17→  bgColor: string;\n    18→}\n    19→\n    20→const QUALITY_CONFIGS: Record<QualityTier, QualityConfig> = {\n    21→  ideal: {\n    22→    label: 'Ideal',\n    23→    textColor: 'rgb(34, 211, 238)',    // cyan-400\n    24→    bgColor: 'rgba(34, 211, 238, 0.15)', // cyan-400/15\n    25→  },\n    26→  excellent: {\n    27→    label: 'Excellent',\n    28→    textColor: 'rgb(52, 211, 153)',    // emerald-400\n    29→    bgColor: 'rgba(52, 211, 153, 0.15)', // emerald-400/15\n    30→  },\n    31→  good: {\n    32→    label: 'Good',\n    33→    textColor: 'rgb(74, 222, 128)',    // green-400\n    34→    bgColor: 'rgba(74, 222, 128, 0.15)', // green-400/15\n    35→  },\n    36→  below_average: {\n    37→    label: 'Average',\n    38→    textColor: 'rgb(163, 163, 163)',   // neutral-400\n    39→    bgColor: 'rgba(163, 163, 163, 0.15)', // neutral-400/15\n    40→  },\n    41→};\n    42→\n    43→function QualityBadge({ quality }: { quality: QualityTier }) {\n    44→  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n    45→\n    46→  return (\n    47→    <span\n    48→      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n    49→      style={{\n    50→        color: config.textColor,\n    51→        backgroundColor: config.bgColor,\n    52→      }}\n    53→    >\n    54→      {config.label}\n    55→    </span>\n    56→  );\n    57→}\n    58→\n    59→// ============================================\n    60→// SEVERITY BADGES (Harmony Style) - Flaws\n    61→// ============================================\n    62→\n    63→type SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n    64→\n    65→interface SeverityConfig {\n    66→  label: string;\n    67→  textColor: string;\n    68→  bgColor: string;\n    69→  borderColor?: string;\n    70→}\n    71→\n    72→const SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {\n    73→  extremely_severe: {\n    74→    label: 'extremely severe',\n    75→    textColor: 'rgb(248, 113, 113)',   // red-400\n    76→    bgColor: 'rgba(248, 113, 113, 0.15)', // red-400/15\n    77→  },\n    78→  severe: {\n    79→    label: 'severe',\n    80→    textColor: 'rgb(248, 113, 113)',   // red-400\n    81→    bgColor: 'rgba(248, 113, 113, 0.1)', // red-400/10\n    82→    borderColor: 'rgba(248, 113, 113, 0.3)', // red-400/30\n    83→  },\n    84→  moderate: {\n    85→    label: 'moderate',\n    86→    textColor: 'rgb(251, 146, 60)',    // orange-400\n    87→    bgColor: 'rgba(251, 146, 60, 0.1)', // orange-400/10\n    88→    borderColor: 'rgba(251, 146, 60, 0.3)', // orange-400/30\n    89→  },\n    90→  minor: {\n    91→    label: 'minor',\n    92→    textColor: 'rgb(250, 204, 21)',    // yellow-400\n    93→    bgColor: 'rgba(250, 204, 21, 0.1)', // yellow-400/10\n    94→    borderColor: 'rgba(250, 204, 21, 0.3)', // yellow-400/30\n    95→  },\n    96→};\n    97→\n    98→function getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n    99→  if (harmonyLost >= 0.8) return 'extremely_severe';\n   100→  if (harmonyLost >= 0.5) return 'severe';\n   101→  if (harmonyLost >= 0.3) return 'moderate';\n   102→  return 'minor';\n   103→}\n   104→\n   105→function getSeverityFromScore(score: number): SeverityLevel {\n   106→  if (score <= 2) return 'extremely_severe';\n   107→  if (score <= 4) return 'severe';\n   108→  if (score <= 6) return 'moderate';\n   109→  return 'minor';\n   110→}\n   111→\n   112→function SeverityBadge({ severity }: { severity: SeverityLevel }) {\n   113→  const config = SEVERITY_CONFIGS[severity];\n   114→\n   115→  return (\n   116→    <span\n   117→      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n   118→      style={{\n   119→        color: config.textColor,\n   120→        backgroundColor: config.bgColor,\n   121→        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n   122→      }}\n   123→    >\n   124→      {config.label}\n   125→    </span>\n   126→  );\n   127→}\n   128→\n   129→// ============================================\n   130→// PROCEDURE PHASE BADGE\n   131→// ============================================\n   132→\n   133→type ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n   134→\n   135→interface PhaseConfig {\n   136→  textColor: string;\n   137→  bgColor: string;\n   138→}\n   139→\n   140→const PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n   141→  Foundational: {\n   142→    textColor: 'rgb(52, 211, 153)',   // emerald-400\n   143→    bgColor: 'rgba(52, 211, 153, 0.15)', // emerald-400/15\n   144→  },\n   145→  'Non-Invasive': {\n   146→    textColor: 'rgb(96, 165, 250)',   // blue-400\n   147→    bgColor: 'rgba(96, 165, 250, 0.15)', // blue-400/15\n   148→  },\n   149→  'Minimally Invasive': {\n   150→    textColor: 'rgb(167, 139, 250)',  // violet-400\n   151→    bgColor: 'rgba(167, 139, 250, 0.15)', // violet-400/15\n   152→  },\n   153→  Surgical: {\n   154→    textColor: 'rgb(192, 132, 252)',  // purple-400\n   155→    bgColor: 'rgba(192, 132, 252, 0.15)', // purple-400/15\n   156→  },\n   157→};\n   158→\n   159→function PhaseBadge({ phase }: { phase: ProcedurePhase }) {\n   160→  const config = PHASE_CONFIGS[phase] || PHASE_CONFIGS['Non-Invasive'];\n   161→\n   162→  return (\n   163→    <span\n   164→      className=\"inline-flex items-center px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium\"\n   165→      style={{\n   166→        color: config.textColor,\n   167→        backgroundColor: config.bgColor,\n   168→      }}\n   169→    >\n   170→      {phase}\n   171→    </span>\n   172→  );\n   173→}\n   174→\n   175→// ============================================\n   176→// CONTRIBUTING/AFFECTED RATIO ITEM\n   177→// ============================================\n   178→\n   179→interface RatioItemProps {\n   180→  name: string;\n   181→  score: number | string;\n   182→  onClick?: () => void;\n   183→  animationDelay?: number;\n   184→}\n   185→\n   186→function RatioItem({ name, score, onClick, animationDelay = 0 }: RatioItemProps) {\n   187→  const numericScore = typeof score === 'number' ? score : 0;\n   188→\n   189→  return (\n   190→    <button\n   191→      onClick={onClick}\n   192→      className=\"w-full flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-neutral-800/50 border border-neutral-700/50 transition-all duration-200 hover:border-neutral-600 hover:bg-neutral-800 text-left cursor-pointer animate-fade-in\"\n   193→      style={{\n   194→        animationDuration: '0.2s',\n   195→        animationDelay: `${animationDelay}s`,\n   196→      }}\n   197→    >\n   198→      <span className=\"text-xs sm:text-sm text-neutral-300 font-medium\">{name}</span>\n   199→      <div className=\"flex items-baseline gap-0.5 sm:gap-1\">\n   200→        <span\n   201→          className=\"text-xs sm:text-sm font-semibold\"\n   202→          style={{ color: typeof score === 'string' ? '#a3a3a3' : getScoreColor(numericScore) }}\n   203→        >\n   204→          {typeof score === 'number' ? score.toFixed(1) : score}\n   205→        </span>\n   206→        <span className=\"text-[10px] sm:text-xs text-neutral-500\">/10</span>\n   207→      </div>\n   208→    </button>\n   209→  );\n   210→}\n   211→\n   212→// ============================================\n   213→// PLAN ITEM (Recommendation)\n   214→// ============================================\n   215→\n   216→interface PlanItemProps {\n   217→  name: string;\n   218→  phase: ProcedurePhase;\n   219→  inPlan?: boolean;\n   220→  animationDelay?: number;\n   221→}\n   222→\n   223→function PlanItem({ name, phase, inPlan = true, animationDelay = 0 }: PlanItemProps) {\n   224→  return (\n   225→    <div\n   226→      className=\"flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-neutral-800/50 border border-neutral-700/50 animate-fade-in\"\n   227→      style={{\n   228→        animationDuration: '0.2s',\n   229→        animationDelay: `${animationDelay}s`,\n   230→      }}\n   231→    >\n   232→      <span className=\"text-xs sm:text-sm text-neutral-300 font-medium\">{name}</span>\n   233→      <div className=\"flex items-center gap-2\">\n   234→        {inPlan && (\n   235→          <span className=\"text-[9px] sm:text-[10px] px-1.5 py-0.5 rounded bg-emerald-400/15 text-emerald-400 font-medium\">\n   236→            In Plan\n   237→          </span>\n   238→        )}\n   239→        <PhaseBadge phase={phase} />\n   240→      </div>\n   241→    </div>\n   242→  );\n   243→}\n   244→\n   245→// ============================================\n   246→// STRENGTH CARD (Harmony Style)\n   247→// ============================================\n   248→\n   249→interface StrengthCardProps {\n   250→  strength: Strength;\n   251→  isExpanded?: boolean;\n   252→  onToggle?: () => void;\n   253→  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n   254→  animationDelay?: number;\n   255→}\n   256→\n   257→export function StrengthCard({\n   258→  strength,\n   259→  isExpanded = false,\n   260→  onToggle,\n   261→  onRatioClick,\n   262→  animationDelay = 0,\n   263→}: StrengthCardProps) {\n   264→  // Get score color for the average score\n   265→  const numericScore = typeof strength.avgScore === 'number' ? strength.avgScore : 0;\n   266→  const scoreColor = getScoreColor(numericScore);\n   267→\n   268→  return (\n   269→    <div\n   270→      className=\"rounded-lg bg-neutral-900 border border-neutral-800/60 overflow-hidden transition-all duration-200 hover:border-neutral-700 hover:shadow-lg shadow-black/10 animate-fade-in\"\n   271→      style={{ animationDelay: `${animationDelay}s` }}\n   272→    >\n   273→      {/* Header */}\n   274→      <button\n   275→        onClick={onToggle}\n   276→        className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"\n   277→      >\n   278→        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n   279→          {/* Left: Badge + Content */}\n   280→          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n   281→            <QualityBadge quality={strength.qualityLevel} />\n   282→            <div className=\"flex-1 min-w-0\">\n   283→              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n   284→                {strength.strengthName}\n   285→              </h4>\n   286→              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n   287→                {strength.summary}\n   288→              </p>\n   289→            </div>\n   290→          </div>\n   291→\n   292→          {/* Right: Score + Chevron */}\n   293→          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n   294→            <div className=\"text-right\">\n   295→              <div\n   296→                className=\"text-lg sm:text-xl font-semibold tracking-tight transition-colors duration-200\"\n   297→                style={{ color: scoreColor }}\n   298→              >\n   299→                {typeof strength.avgScore === 'number' ? strength.avgScore.toFixed(2) : strength.avgScore}\n   300→              </div>\n   301→              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium mt-0.5\">avg /10</div>\n   302→            </div>\n   303→            <motion.div\n   304→              animate={{ rotate: isExpanded ? 180 : 0 }}\n   305→              transition={{ duration: 0.3 }}\n   306→            >\n   307→              <ChevronDown className=\"w-4 h-4 text-neutral-500\" />\n   308→            </motion.div>\n   309→          </div>\n   310→        </div>\n   311→      </button>\n   312→\n   313→      {/* Expanded Content */}\n   314→      <AnimatePresence initial={false}>\n   315→        {isExpanded && (\n   316→          <motion.div\n   317→            initial={{ height: 0, opacity: 0 }}\n   318→            animate={{ height: 'auto', opacity: 1 }}\n   319→            exit={{ height: 0, opacity: 0 }}\n   320→            transition={{ duration: 0.3, ease: 'easeInOut' }}\n   321→            className=\"overflow-hidden\"\n   322→          >\n   323→            <div className=\"border-t border-neutral-800 bg-neutral-900/50 px-4 sm:px-6 py-3 sm:py-4\">\n   324→              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n   325→                Contributing Ratios\n   326→              </div>\n   327→              <div className=\"space-y-2\">\n   328→                {strength.responsibleRatios.map((ratio, i) => (\n   329→                  <RatioItem\n   330→                    key={ratio.ratioId}\n   331→                    name={ratio.ratioName}\n   332→                    score={ratio.score}\n   333→                    onClick={() => onRatioClick?.(ratio)}\n   334→                    animationDelay={i * 0.03}\n   335→                  />\n   336→                ))}\n   337→              </div>\n   338→            </div>\n   339→          </motion.div>\n   340→        )}\n   341→      </AnimatePresence>\n   342→    </div>\n   343→  );\n   344→}\n   345→\n   346→// ============================================\n   347→// FLAW CARD (Harmony Style - Areas of Improvement)\n   348→// ============================================\n   349→\n   350→interface FlawCardProps {\n   351→  flaw: Flaw;\n   352→  isExpanded?: boolean;\n   353→  onToggle?: () => void;\n   354→  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n   355→  recommendations?: Recommendation[];\n   356→  animationDelay?: number;\n   357→}\n   358→\n   359→export function FlawCard({\n   360→  flaw,\n   361→  isExpanded = false,\n   362→  onToggle,\n   363→  onRatioClick,\n   364→  recommendations = [],\n   365→  animationDelay = 0,\n   366→}: FlawCardProps) {\n   367→  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n   368→\n   369→  // Find matching recommendations for this flaw\n   370→  const matchedRecommendations = useMemo(() => {\n   371→    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n   372→    return recommendations.filter(rec =>\n   373→      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n   374→      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n   375→    ).slice(0, 3); // Limit to 3 recommendations\n   376→  }, [flaw, recommendations]);\n   377→\n   378→  // Map phase names\n   379→  const mapPhase = (phase: string): ProcedurePhase => {\n   380→    if (phase === 'Foundational') return 'Foundational';\n   381→    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n   382→    if (phase === 'Surgical') return 'Surgical';\n   383→    return 'Non-Invasive';\n   384→  };\n   385→\n   386→  return (\n   387→    <div\n   388→      className=\"rounded-lg bg-neutral-900 border border-neutral-800/60 overflow-hidden transition-all duration-200 hover:border-neutral-700 hover:shadow-lg shadow-black/10 animate-fade-in\"\n   389→      style={{ animationDelay: `${animationDelay}s` }}\n   390→    >\n   391→      {/* Header */}\n   392→      <button\n   393→        onClick={onToggle}\n   394→        className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"\n   395→      >\n   396→        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n   397→          {/* Left: Badge + Content */}\n   398→          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n   399→            <SeverityBadge severity={severity} />\n   400→            <div className=\"flex-1 min-w-0\">\n   401→              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n   402→                {flaw.flawName}\n   403→              </h4>\n   404→              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n   405→                {flaw.summary}\n   406→              </p>\n   407→            </div>\n   408→          </div>\n   409→\n   410→          {/* Right: Points impact + Chevron */}\n   411→          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n   412→            <div className=\"text-right space-y-1\">\n   413→              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-400\">\n   414→                -{flaw.harmonyPercentageLost.toFixed(2)}\n   415→              </div>\n   416→              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n   417→              {flaw.rollingHarmonyPercentageLost !== undefined && (\n   418→                <div className=\"text-[10px] text-neutral-500 font-medium pt-0.5 border-t border-neutral-800 mt-1 pt-1\">\n   419→                  Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n   420→                </div>\n   421→              )}\n   422→            </div>\n   423→            <motion.div\n   424→              animate={{ rotate: isExpanded ? 180 : 0 }}\n   425→              transition={{ duration: 0.3 }}\n   426→            >\n   427→              <ChevronDown className=\"w-4 h-4 text-neutral-500\" />\n   428→            </motion.div>\n   429→          </div>\n   430→        </div>\n   431→      </button>\n   432→\n   433→      {/* Expanded Content */}\n   434→      <AnimatePresence initial={false}>\n   435→        {isExpanded && (\n   436→          <motion.div\n   437→            initial={{ height: 0, opacity: 0 }}\n   438→            animate={{ height: 'auto', opacity: 1 }}\n   439→            exit={{ height: 0, opacity: 0 }}\n   440→            transition={{ duration: 0.3, ease: 'easeInOut' }}\n   441→            className=\"overflow-hidden\"\n   442→          >\n   443→            {/* Affected Ratios Section */}\n   444→            <div className=\"border-t border-neutral-800 bg-neutral-900/50 px-4 sm:px-6 py-3 sm:py-4\">\n   445→              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n   446→                Affected Ratios\n   447→              </div>\n   448→              <div className=\"space-y-2\">\n   449→                {flaw.responsibleRatios.map((ratio, i) => (\n   450→                  <RatioItem\n   451→                    key={ratio.ratioId}\n   452→                    name={ratio.ratioName}\n   453→                    score={ratio.score}\n   454→                    onClick={() => onRatioClick?.(ratio)}\n   455→                    animationDelay={i * 0.03}\n   456→                  />\n   457→                ))}\n   458→              </div>\n   459→            </div>\n   460→\n   461→            {/* Your Plan Section (if there are matched recommendations) */}\n   462→            {matchedRecommendations.length > 0 && (\n   463→              <div className=\"border-t border-neutral-800 bg-emerald-400/5 px-4 sm:px-6 py-3 sm:py-4\">\n   464→                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n   465→                  <Sparkles className=\"w-3 h-3 text-emerald-400\" />\n   466→                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-400 uppercase tracking-wider\">\n   467→                    Your Plan\n   468→                  </span>\n   469→                </div>\n   470→                <div className=\"space-y-2\">\n   471→                  {matchedRecommendations.map((rec, i) => (\n   472→                    <PlanItem\n   473→                      key={rec.ref_id}\n   474→                      name={rec.name}\n   475→                      phase={mapPhase(rec.phase)}\n   476→                      inPlan={true}\n   477→                      animationDelay={i * 0.03}\n   478→                    />\n   479→                  ))}\n   480→                </div>\n   481→              </div>\n   482→            )}\n   483→          </motion.div>\n   484→        )}\n   485→      </AnimatePresence>\n   486→    </div>\n   487→  );\n   488→}\n   489→\n   490→// ============================================\n   491→// STRENGTHS SECTION (Container)\n   492→// ============================================\n   493→\n   494→interface StrengthsSectionProps {\n   495→  strengths: Strength[];\n   496→  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n   497→  maxVisible?: number;\n   498→}\n   499→\n   500→export function StrengthsSection({\n   501→  strengths,\n   502→  onRatioClick,\n   503→  maxVisible = 5,\n   504→}: StrengthsSectionProps) {\n   505→  const [expandedId, setExpandedId] = useState<string | null>(null);\n   506→  const [showAll, setShowAll] = useState(false);\n   507→\n   508→  const visibleStrengths = showAll ? strengths : strengths.slice(0, maxVisible);\n   509→  const hasMore = strengths.length > maxVisible;\n   510→\n   511→  return (\n   512→    <div className=\"rounded-xl bg-neutral-900/80 border border-neutral-800/50 p-4 sm:p-6 lg:p-8\">\n   513→      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n   514→        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n   515→          Key Strengths\n   516→        </h3>\n   517→      </div>\n   518→\n   519→      <div className=\"space-y-3\">\n   520→        {visibleStrengths.map((strength, i) => (\n   521→          <StrengthCard\n   522→            key={strength.id}\n   523→            strength={strength}\n   524→            isExpanded={expandedId === strength.id}\n   525→            onToggle={() => setExpandedId(expandedId === strength.id ? null : strength.id)}\n   526→            onRatioClick={onRatioClick}\n   527→            animationDelay={i * 0.04}\n   528→          />\n   529→        ))}\n   530→      </div>\n   531→\n   532→      {hasMore && (\n   533→        <button\n   534→          onClick={() => setShowAll(!showAll)}\n   535→          className=\"w-full mt-6 py-3 rounded-lg bg-neutral-800 border border-neutral-700/50 hover:border-neutral-600 hover:bg-neutral-700 transition-all duration-200 text-sm font-medium text-white\"\n   536→        >\n   537→          <span className=\"flex items-center justify-center gap-2\">\n   538→            <span>{showAll ? 'Show Less' : `Show All ${strengths.length} Strengths`}</span>\n   539→            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n   540→              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n   541→            </motion.div>\n   542→          </span>\n   543→        </button>\n   544→      )}\n   545→    </div>\n   546→  );\n   547→}\n   548→\n   549→// ============================================\n   550→// FLAWS SECTION (Areas of Improvement Container)\n   551→// ============================================\n   552→\n   553→interface FlawsSectionProps {\n   554→  flaws: Flaw[];\n   555→  recommendations?: Recommendation[];\n   556→  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n   557→  maxVisible?: number;\n   558→}\n   559→\n   560→export function FlawsSection({\n   561→  flaws,\n   562→  recommendations = [],\n   563→  onRatioClick,\n   564→  maxVisible = 5,\n   565→}: FlawsSectionProps) {\n   566→  const [expandedId, setExpandedId] = useState<string | null>(null);\n   567→  const [showAll, setShowAll] = useState(false);\n   568→\n   569→  const visibleFlaws = showAll ? flaws : flaws.slice(0, maxVisible);\n   570→  const hasMore = flaws.length > maxVisible;\n   571→\n   572→  return (\n   573→    <div className=\"rounded-xl bg-neutral-900/80 border border-neutral-800/50 p-4 sm:p-6 lg:p-8\">\n   574→      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n   575→        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n   576→          Areas of Improvement\n   577→        </h3>\n   578→      </div>\n   579→\n   580→      <div className=\"space-y-3\">\n   581→        {visibleFlaws.map((flaw, i) => (\n   582→          <FlawCard\n   583→            key={flaw.id}\n   584→            flaw={flaw}\n   585→            isExpanded={expandedId === flaw.id}\n   586→            onToggle={() => setExpandedId(expandedId === flaw.id ? null : flaw.id)}\n   587→            onRatioClick={onRatioClick}\n   588→            recommendations={recommendations}\n   589→            animationDelay={i * 0.04}\n   590→          />\n   591→        ))}\n   592→      </div>\n   593→\n   594→      {hasMore && (\n   595→        <button\n   596→          onClick={() => setShowAll(!showAll)}\n   597→          className=\"w-full mt-6 py-3 rounded-lg bg-neutral-800 border border-neutral-700/50 hover:border-neutral-600 hover:bg-neutral-700 transition-all duration-200 text-sm font-medium text-white\"\n   598→        >\n   599→          <span className=\"flex items-center justify-center gap-2\">\n   600→            <span>{showAll ? 'Show Less' : `Show All ${flaws.length} Areas`}</span>\n   601→            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n   602→              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n   603→            </motion.div>\n   604→          </span>\n   605→        </button>\n   606→      )}\n   607→    </div>\n   608→  );\n   609→}\n   610→\n   611→// ============================================\n   612→// COMPACT BADGES (for use elsewhere)\n   613→// ============================================\n   614→\n   615→interface CompactStrengthBadgeProps {\n   616→  strength: Strength;\n   617→  onClick?: () => void;\n   618→}\n   619→\n   620→export function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {\n   621→  return (\n   622→    <button\n   623→      onClick={onClick}\n   624→      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-green-400/10 border border-green-400/30 rounded-lg hover:bg-green-400/20 transition-colors\"\n   625→    >\n   626→      <CheckCircle size={12} className=\"text-green-400\" />\n   627→      <span className=\"text-xs text-green-400\">{strength.strengthName}</span>\n   628→    </button>\n   629→  );\n   630→}\n   631→\n   632→interface CompactFlawBadgeProps {\n   633→  flaw: Flaw;\n   634→  onClick?: () => void;\n   635→}\n   636→\n   637→export function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n   638→  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n   639→  const config = SEVERITY_CONFIGS[severity];\n   640→\n   641→  return (\n   642→    <button\n   643→      onClick={onClick}\n   644→      className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-lg hover:opacity-80 transition-all\"\n   645→      style={{\n   646→        backgroundColor: config.bgColor,\n   647→        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n   648→      }}\n   649→    >\n   650→      <AlertTriangle size={12} style={{ color: config.textColor }} />\n   651→      <span className=\"text-xs\" style={{ color: config.textColor }}>{flaw.flawName}</span>\n   652→    </button>\n   653→  );\n   654→}\n   655→\n   656→// Export utility functions\n   657→export { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\n   658→export { SeverityBadge };\n   659→export type { SeverityLevel };\n   660→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"113db886-2051-4a0f-9a7c-2c7f6233e98c","timestamp":"2025-12-26T14:50:15.579Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","content":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ChevronDown, AlertTriangle, CheckCircle, Sparkles } from 'lucide-react';\nimport { Strength, Flaw, Recommendation, getScoreColor } from '@/types/results';\n\n// ============================================\n// QUALITY TIER BADGES (Harmony Style) - Strengths\n// ============================================\n\ntype QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\n\ninterface QualityConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n}\n\nconst QUALITY_CONFIGS: Record<QualityTier, QualityConfig> = {\n  ideal: {\n    label: 'Ideal',\n    textColor: 'rgb(34, 211, 238)',    // cyan-400\n    bgColor: 'rgba(34, 211, 238, 0.15)', // cyan-400/15\n  },\n  excellent: {\n    label: 'Excellent',\n    textColor: 'rgb(52, 211, 153)',    // emerald-400\n    bgColor: 'rgba(52, 211, 153, 0.15)', // emerald-400/15\n  },\n  good: {\n    label: 'Good',\n    textColor: 'rgb(74, 222, 128)',    // green-400\n    bgColor: 'rgba(74, 222, 128, 0.15)', // green-400/15\n  },\n  below_average: {\n    label: 'Average',\n    textColor: 'rgb(163, 163, 163)',   // neutral-400\n    bgColor: 'rgba(163, 163, 163, 0.15)', // neutral-400/15\n  },\n};\n\nfunction QualityBadge({ quality }: { quality: QualityTier }) {\n  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// SEVERITY BADGES (Harmony Style) - Flaws\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n\ninterface SeverityConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor?: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {\n  extremely_severe: {\n    label: 'extremely severe',\n    textColor: 'rgb(248, 113, 113)',   // red-400\n    bgColor: 'rgba(248, 113, 113, 0.15)', // red-400/15\n  },\n  severe: {\n    label: 'severe',\n    textColor: 'rgb(248, 113, 113)',   // red-400\n    bgColor: 'rgba(248, 113, 113, 0.1)', // red-400/10\n    borderColor: 'rgba(248, 113, 113, 0.3)', // red-400/30\n  },\n  moderate: {\n    label: 'moderate',\n    textColor: 'rgb(251, 146, 60)',    // orange-400\n    bgColor: 'rgba(251, 146, 60, 0.1)', // orange-400/10\n    borderColor: 'rgba(251, 146, 60, 0.3)', // orange-400/30\n  },\n  minor: {\n    label: 'minor',\n    textColor: 'rgb(250, 204, 21)',    // yellow-400\n    bgColor: 'rgba(250, 204, 21, 0.1)', // yellow-400/10\n    borderColor: 'rgba(250, 204, 21, 0.3)', // yellow-400/30\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  if (harmonyLost >= 0.8) return 'extremely_severe';\n  if (harmonyLost >= 0.5) return 'severe';\n  if (harmonyLost >= 0.3) return 'moderate';\n  return 'minor';\n}\n\nfunction getSeverityFromScore(score: number): SeverityLevel {\n  if (score <= 2) return 'extremely_severe';\n  if (score <= 4) return 'severe';\n  if (score <= 6) return 'moderate';\n  return 'minor';\n}\n\nfunction SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================\n\ntype ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n\ninterface PhaseConfig {\n  textColor: string;\n  bgColor: string;\n}\n\nconst PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n  Foundational: {\n    textColor: 'rgb(52, 211, 153)',   // emerald-400\n    bgColor: 'rgba(52, 211, 153, 0.15)', // emerald-400/15\n  },\n  'Non-Invasive': {\n    textColor: 'rgb(96, 165, 250)',   // blue-400\n    bgColor: 'rgba(96, 165, 250, 0.15)', // blue-400/15\n  },\n  'Minimally Invasive': {\n    textColor: 'rgb(167, 139, 250)',  // violet-400\n    bgColor: 'rgba(167, 139, 250, 0.15)', // violet-400/15\n  },\n  Surgical: {\n    textColor: 'rgb(192, 132, 252)',  // purple-400\n    bgColor: 'rgba(192, 132, 252, 0.15)', // purple-400/15\n  },\n};\n\nfunction PhaseBadge({ phase }: { phase: ProcedurePhase }) {\n  const config = PHASE_CONFIGS[phase] || PHASE_CONFIGS['Non-Invasive'];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {phase}\n    </span>\n  );\n}\n\n// ============================================\n// CONTRIBUTING/AFFECTED RATIO ITEM\n// ============================================\n\ninterface RatioItemProps {\n  name: string;\n  score: number | string;\n  onClick?: () => void;\n  animationDelay?: number;\n}\n\nfunction RatioItem({ name, score, onClick, animationDelay = 0 }: RatioItemProps) {\n  const numericScore = typeof score === 'number' ? score : 0;\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"w-full flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-neutral-800/50 border border-neutral-700/50 transition-all duration-200 hover:border-neutral-600 hover:bg-neutral-800 text-left cursor-pointer animate-fade-in\"\n      style={{\n        animationDuration: '0.2s',\n        animationDelay: `${animationDelay}s`,\n      }}\n    >\n      <span className=\"text-xs sm:text-sm text-neutral-300 font-medium\">{name}</span>\n      <div className=\"flex items-baseline gap-0.5 sm:gap-1\">\n        <span\n          className=\"text-xs sm:text-sm font-semibold\"\n          style={{ color: typeof score === 'string' ? '#a3a3a3' : getScoreColor(numericScore) }}\n        >\n          {typeof score === 'number' ? score.toFixed(1) : score}\n        </span>\n        <span className=\"text-[10px] sm:text-xs text-neutral-500\">/10</span>\n      </div>\n    </button>\n  );\n}\n\n// ============================================\n// PLAN ITEM (Recommendation)\n// ============================================\n\ninterface PlanItemProps {\n  name: string;\n  phase: ProcedurePhase;\n  inPlan?: boolean;\n  animationDelay?: number;\n}\n\nfunction PlanItem({ name, phase, inPlan = true, animationDelay = 0 }: PlanItemProps) {\n  return (\n    <div\n      className=\"flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-neutral-800/50 border border-neutral-700/50 animate-fade-in\"\n      style={{\n        animationDuration: '0.2s',\n        animationDelay: `${animationDelay}s`,\n      }}\n    >\n      <span className=\"text-xs sm:text-sm text-neutral-300 font-medium\">{name}</span>\n      <div className=\"flex items-center gap-2\">\n        {inPlan && (\n          <span className=\"text-[9px] sm:text-[10px] px-1.5 py-0.5 rounded bg-emerald-400/15 text-emerald-400 font-medium\">\n            In Plan\n          </span>\n        )}\n        <PhaseBadge phase={phase} />\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// STRENGTH CARD (Harmony Style)\n// ============================================\n\ninterface StrengthCardProps {\n  strength: Strength;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n  animationDelay?: number;\n}\n\nexport function StrengthCard({\n  strength,\n  isExpanded = false,\n  onToggle,\n  onRatioClick,\n  animationDelay = 0,\n}: StrengthCardProps) {\n  // Get score color for the average score\n  const numericScore = typeof strength.avgScore === 'number' ? strength.avgScore : 0;\n  const scoreColor = getScoreColor(numericScore);\n\n  return (\n    <div\n      className=\"rounded-lg bg-neutral-900 border border-neutral-800/60 overflow-hidden transition-all duration-200 hover:border-neutral-700 hover:shadow-lg shadow-black/10 animate-fade-in\"\n      style={{ animationDelay: `${animationDelay}s` }}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <QualityBadge quality={strength.qualityLevel} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {strength.strengthName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n                {strength.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Score + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right\">\n              <div\n                className=\"text-lg sm:text-xl font-semibold tracking-tight transition-colors duration-200\"\n                style={{ color: scoreColor }}\n              >\n                {typeof strength.avgScore === 'number' ? strength.avgScore.toFixed(2) : strength.avgScore}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium mt-0.5\">avg /10</div>\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-500\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: 'easeInOut' }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"border-t border-neutral-800 bg-neutral-900/50 px-4 sm:px-6 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Contributing Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {strength.responsibleRatios.map((ratio, i) => (\n                  <RatioItem\n                    key={ratio.ratioId}\n                    name={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick?.(ratio)}\n                    animationDelay={i * 0.03}\n                  />\n                ))}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// FLAW CARD (Harmony Style - Areas of Improvement)\n// ============================================\n\ninterface FlawCardProps {\n  flaw: Flaw;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n  recommendations?: Recommendation[];\n  animationDelay?: number;\n}\n\nexport function FlawCard({\n  flaw,\n  isExpanded = false,\n  onToggle,\n  onRatioClick,\n  recommendations = [],\n  animationDelay = 0,\n}: FlawCardProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n\n  // Find matching recommendations for this flaw\n  const matchedRecommendations = useMemo(() => {\n    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n    return recommendations.filter(rec =>\n      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n    ).slice(0, 3); // Limit to 3 recommendations\n  }, [flaw, recommendations]);\n\n  // Map phase names\n  const mapPhase = (phase: string): ProcedurePhase => {\n    if (phase === 'Foundational') return 'Foundational';\n    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n    if (phase === 'Surgical') return 'Surgical';\n    return 'Non-Invasive';\n  };\n\n  return (\n    <div\n      className=\"rounded-lg bg-neutral-900 border border-neutral-800/60 overflow-hidden transition-all duration-200 hover:border-neutral-700 hover:shadow-lg shadow-black/10 animate-fade-in\"\n      style={{ animationDelay: `${animationDelay}s` }}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <SeverityBadge severity={severity} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-400\">\n                -{flaw.harmonyPercentageLost.toFixed(2)}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n              {flaw.rollingHarmonyPercentageLost !== undefined && (\n                <div className=\"text-[10px] text-neutral-500 font-medium pt-0.5 border-t border-neutral-800 mt-1 pt-1\">\n                  Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n                </div>\n              )}\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-500\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: 'easeInOut' }}\n            className=\"overflow-hidden\"\n          >\n            {/* Affected Ratios Section */}\n            <div className=\"border-t border-neutral-800 bg-neutral-900/50 px-4 sm:px-6 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Affected Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {flaw.responsibleRatios.map((ratio, i) => (\n                  <RatioItem\n                    key={ratio.ratioId}\n                    name={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick?.(ratio)}\n                    animationDelay={i * 0.03}\n                  />\n                ))}\n              </div>\n            </div>\n\n            {/* Your Plan Section (if there are matched recommendations) */}\n            {matchedRecommendations.length > 0 && (\n              <div className=\"border-t border-neutral-800 bg-emerald-400/5 px-4 sm:px-6 py-3 sm:py-4\">\n                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n                  <Sparkles className=\"w-3 h-3 text-emerald-400\" />\n                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-400 uppercase tracking-wider\">\n                    Your Plan\n                  </span>\n                </div>\n                <div className=\"space-y-2\">\n                  {matchedRecommendations.map((rec, i) => (\n                    <PlanItem\n                      key={rec.ref_id}\n                      name={rec.name}\n                      phase={mapPhase(rec.phase)}\n                      inPlan={true}\n                      animationDelay={i * 0.03}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// STRENGTHS SECTION (Container)\n// ============================================\n\ninterface StrengthsSectionProps {\n  strengths: Strength[];\n  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n  maxVisible?: number;\n}\n\nexport function StrengthsSection({\n  strengths,\n  onRatioClick,\n  maxVisible = 5,\n}: StrengthsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const visibleStrengths = showAll ? strengths : strengths.slice(0, maxVisible);\n  const hasMore = strengths.length > maxVisible;\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/80 border border-neutral-800/50 p-4 sm:p-6 lg:p-8\">\n      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n          Key Strengths\n        </h3>\n      </div>\n\n      <div className=\"space-y-3\">\n        {visibleStrengths.map((strength, i) => (\n          <StrengthCard\n            key={strength.id}\n            strength={strength}\n            isExpanded={expandedId === strength.id}\n            onToggle={() => setExpandedId(expandedId === strength.id ? null : strength.id)}\n            onRatioClick={onRatioClick}\n            animationDelay={i * 0.04}\n          />\n        ))}\n      </div>\n\n      {hasMore && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-6 py-3 rounded-lg bg-neutral-800 border border-neutral-700/50 hover:border-neutral-600 hover:bg-neutral-700 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show All ${strengths.length} Strengths`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// FLAWS SECTION (Areas of Improvement Container)\n// ============================================\n\ninterface FlawsSectionProps {\n  flaws: Flaw[];\n  recommendations?: Recommendation[];\n  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n  maxVisible?: number;\n}\n\nexport function FlawsSection({\n  flaws,\n  recommendations = [],\n  onRatioClick,\n  maxVisible = 5,\n}: FlawsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const visibleFlaws = showAll ? flaws : flaws.slice(0, maxVisible);\n  const hasMore = flaws.length > maxVisible;\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/80 border border-neutral-800/50 p-4 sm:p-6 lg:p-8\">\n      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n          Areas of Improvement\n        </h3>\n      </div>\n\n      <div className=\"space-y-3\">\n        {visibleFlaws.map((flaw, i) => (\n          <FlawCard\n            key={flaw.id}\n            flaw={flaw}\n            isExpanded={expandedId === flaw.id}\n            onToggle={() => setExpandedId(expandedId === flaw.id ? null : flaw.id)}\n            onRatioClick={onRatioClick}\n            recommendations={recommendations}\n            animationDelay={i * 0.04}\n          />\n        ))}\n      </div>\n\n      {hasMore && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-6 py-3 rounded-lg bg-neutral-800 border border-neutral-700/50 hover:border-neutral-600 hover:bg-neutral-700 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show All ${flaws.length} Areas`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// COMPACT BADGES (for use elsewhere)\n// ============================================\n\ninterface CompactStrengthBadgeProps {\n  strength: Strength;\n  onClick?: () => void;\n}\n\nexport function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-green-400/10 border border-green-400/30 rounded-lg hover:bg-green-400/20 transition-colors\"\n    >\n      <CheckCircle size={12} className=\"text-green-400\" />\n      <span className=\"text-xs text-green-400\">{strength.strengthName}</span>\n    </button>\n  );\n}\n\ninterface CompactFlawBadgeProps {\n  flaw: Flaw;\n  onClick?: () => void;\n}\n\nexport function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-lg hover:opacity-80 transition-all\"\n      style={{\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      <AlertTriangle size={12} style={{ color: config.textColor }} />\n      <span className=\"text-xs\" style={{ color: config.textColor }}>{flaw.flawName}</span>\n    </button>\n  );\n}\n\n// Export utility functions\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\nexport { SeverityBadge };\nexport type { SeverityLevel };\n","numLines":660,"startLine":1,"totalLines":660}}}
{"parentUuid":"113db886-2051-4a0f-9a7c-2c7f6233e98c","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01L44XQBatZV31sw78MbUcJP","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useState } from 'react';\n     4→import { motion, AnimatePresence } from 'framer-motion';\n     5→import {\n     6→  ChevronDown,\n     7→  ChevronUp,\n     8→  ShoppingCart,\n     9→  Zap,\n    10→  ArrowRight,\n    11→  Package,\n    12→} from 'lucide-react';\n    13→import { Flaw, ProductRecommendation, Recommendation } from '@/types/results';\n    14→import { ProductCard } from './ProductCard';\n    15→\n    16→interface WeakPointCardProps {\n    17→  flaw: Flaw;\n    18→  rank: number;\n    19→  products: ProductRecommendation[];\n    20→  treatments: Recommendation[];\n    21→  onViewTreatment?: (treatment: Recommendation) => void;\n    22→}\n    23→\n    24→export function WeakPointCard({\n    25→  flaw,\n    26→  rank,\n    27→  products,\n    28→  treatments,\n    29→  onViewTreatment,\n    30→}: WeakPointCardProps) {\n    31→  const [isExpanded, setIsExpanded] = useState(false);\n    32→\n    33→  // Severity colors\n    34→  const getSeverityColor = (impact: number) => {\n    35→    if (impact >= 5) return { bg: 'bg-red-500/20', border: 'border-red-500/30', text: 'text-red-400' };\n    36→    if (impact >= 3) return { bg: 'bg-orange-500/20', border: 'border-orange-500/30', text: 'text-orange-400' };\n    37→    return { bg: 'bg-yellow-500/20', border: 'border-yellow-500/30', text: 'text-yellow-400' };\n    38→  };\n    39→\n    40→  const colors = getSeverityColor(flaw.harmonyPercentageLost);\n    41→\n    42→  return (\n    43→    <motion.div\n    44→      className={`${colors.bg} border ${colors.border} rounded-xl overflow-hidden`}\n    45→      initial={{ opacity: 0, y: 10 }}\n    46→      animate={{ opacity: 1, y: 0 }}\n    47→      transition={{ delay: rank * 0.05 }}\n    48→    >\n    49→      {/* Header */}\n    50→      <button\n    51→        onClick={() => setIsExpanded(!isExpanded)}\n    52→        className=\"w-full p-4 flex items-center justify-between hover:bg-white/5 transition-colors\"\n    53→      >\n    54→        <div className=\"flex items-center gap-3\">\n    55→          <div className={`w-8 h-8 rounded-lg ${colors.bg} flex items-center justify-center`}>\n    56→            <span className={`text-sm font-bold ${colors.text}`}>#{rank}</span>\n    57→          </div>\n    58→          <div className=\"text-left\">\n    59→            <h4 className=\"font-medium text-white\">{flaw.flawName}</h4>\n    60→            <p className=\"text-xs text-neutral-400\">{flaw.categoryName}</p>\n    61→          </div>\n    62→        </div>\n    63→\n    64→        <div className=\"flex items-center gap-4\">\n    65→          <div className=\"text-right\">\n    66→            <span className={`text-sm font-semibold ${colors.text}`}>\n    67→              -{flaw.harmonyPercentageLost.toFixed(1)}%\n    68→            </span>\n    69→            <p className=\"text-xs text-neutral-500\">harmony lost</p>\n    70→          </div>\n    71→          {isExpanded ? (\n    72→            <ChevronUp size={20} className=\"text-neutral-400\" />\n    73→          ) : (\n    74→            <ChevronDown size={20} className=\"text-neutral-400\" />\n    75→          )}\n    76→        </div>\n    77→      </button>\n    78→\n    79→      {/* Expanded Content */}\n    80→      <AnimatePresence>\n    81→        {isExpanded && (\n    82→          <motion.div\n    83→            initial={{ height: 0, opacity: 0 }}\n    84→            animate={{ height: 'auto', opacity: 1 }}\n    85→            exit={{ height: 0, opacity: 0 }}\n    86→            transition={{ duration: 0.2 }}\n    87→            className=\"overflow-hidden\"\n    88→          >\n    89→            <div className=\"px-4 pb-4 space-y-4\">\n    90→              {/* Summary */}\n    91→              <p className=\"text-sm text-neutral-300\">{flaw.summary}</p>\n    92→\n    93→              {/* Contributing Ratios */}\n    94→              {flaw.responsibleRatios.length > 0 && (\n    95→                <div className=\"space-y-2\">\n    96→                  <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n    97→                    Contributing Metrics\n    98→                  </h5>\n    99→                  <div className=\"flex flex-wrap gap-2\">\n   100→                    {flaw.responsibleRatios.slice(0, 3).map((ratio) => (\n   101→                      <div\n   102→                        key={ratio.ratioId}\n   103→                        className=\"px-2 py-1 bg-neutral-800/50 rounded-lg text-xs\"\n   104→                      >\n   105→                        <span className=\"text-neutral-300\">{ratio.ratioName}</span>\n   106→                        <span className=\"text-neutral-500 ml-1\">\n   107→                          ({typeof ratio.score === 'number' ? ratio.score.toFixed(1) : ratio.score}/10)\n   108→                        </span>\n   109→                      </div>\n   110→                    ))}\n   111→                  </div>\n   112→                </div>\n   113→              )}\n   114→\n   115→              {/* Products to Fix */}\n   116→              {products.length > 0 && (\n   117→                <div className=\"space-y-3\">\n   118→                  <div className=\"flex items-center gap-2\">\n   119→                    <Package size={14} className=\"text-cyan-400\" />\n   120→                    <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n   121→                      Products to Help\n   122→                    </h5>\n   123→                  </div>\n   124→                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n   125→                    {products.slice(0, 2).map((rec) => (\n   126→                      <ProductCard key={rec.product.id} recommendation={rec} compact />\n   127→                    ))}\n   128→                  </div>\n   129→                  {products.length > 2 && (\n   130→                    <p className=\"text-xs text-neutral-500 text-center\">\n   131→                      +{products.length - 2} more products\n   132→                    </p>\n   133→                  )}\n   134→                </div>\n   135→              )}\n   136→\n   137→              {/* Treatments */}\n   138→              {treatments.length > 0 && (\n   139→                <div className=\"space-y-3\">\n   140→                  <div className=\"flex items-center gap-2\">\n   141→                    <Zap size={14} className=\"text-purple-400\" />\n   142→                    <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n   143→                      Recommended Treatments\n   144→                    </h5>\n   145→                  </div>\n   146→                  <div className=\"space-y-2\">\n   147→                    {treatments.slice(0, 3).map((treatment) => (\n   148→                      <button\n   149→                        key={treatment.ref_id}\n   150→                        onClick={() => onViewTreatment?.(treatment)}\n   151→                        className=\"w-full flex items-center justify-between p-3 bg-neutral-800/50 rounded-lg hover:bg-neutral-800 transition-colors group\"\n   152→                      >\n   153→                        <div className=\"flex items-center gap-3\">\n   154→                          <div className={`px-2 py-0.5 rounded text-xs font-medium ${\n   155→                            treatment.phase === 'Foundational'\n   156→                              ? 'bg-green-500/20 text-green-400'\n   157→                              : treatment.phase === 'Minimally Invasive'\n   158→                                ? 'bg-yellow-500/20 text-yellow-400'\n   159→                                : 'bg-red-500/20 text-red-400'\n   160→                          }`}>\n   161→                            {treatment.phase}\n   162→                          </div>\n   163→                          <span className=\"text-sm text-white\">{treatment.name}</span>\n   164→                        </div>\n   165→                        <div className=\"flex items-center gap-2\">\n   166→                          <span className=\"text-xs text-green-400\">\n   167→                            +{(treatment.impact * 100).toFixed(0)}% improvement\n   168→                          </span>\n   169→                          <ArrowRight size={14} className=\"text-neutral-500 group-hover:text-cyan-400 transition-colors\" />\n   170→                        </div>\n   171→                      </button>\n   172→                    ))}\n   173→                  </div>\n   174→                </div>\n   175→              )}\n   176→\n   177→              {/* CTA */}\n   178→              <div className=\"pt-2 border-t border-neutral-800\">\n   179→                <a\n   180→                  href=\"#plan\"\n   181→                  className=\"flex items-center justify-center gap-2 w-full py-2.5 bg-gradient-to-r from-cyan-500 to-blue-600 text-black text-sm font-medium rounded-lg hover:opacity-90 transition-opacity\"\n   182→                >\n   183→                  <ShoppingCart size={16} />\n   184→                  View Full Fix Plan\n   185→                </a>\n   186→              </div>\n   187→            </div>\n   188→          </motion.div>\n   189→        )}\n   190→      </AnimatePresence>\n   191→    </motion.div>\n   192→  );\n   193→}\n   194→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"d1ab7c05-7787-4a1c-8847-bc5d53da26bf","timestamp":"2025-12-26T14:50:15.579Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx","content":"'use client';\n\nimport { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  ChevronDown,\n  ChevronUp,\n  ShoppingCart,\n  Zap,\n  ArrowRight,\n  Package,\n} from 'lucide-react';\nimport { Flaw, ProductRecommendation, Recommendation } from '@/types/results';\nimport { ProductCard } from './ProductCard';\n\ninterface WeakPointCardProps {\n  flaw: Flaw;\n  rank: number;\n  products: ProductRecommendation[];\n  treatments: Recommendation[];\n  onViewTreatment?: (treatment: Recommendation) => void;\n}\n\nexport function WeakPointCard({\n  flaw,\n  rank,\n  products,\n  treatments,\n  onViewTreatment,\n}: WeakPointCardProps) {\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  // Severity colors\n  const getSeverityColor = (impact: number) => {\n    if (impact >= 5) return { bg: 'bg-red-500/20', border: 'border-red-500/30', text: 'text-red-400' };\n    if (impact >= 3) return { bg: 'bg-orange-500/20', border: 'border-orange-500/30', text: 'text-orange-400' };\n    return { bg: 'bg-yellow-500/20', border: 'border-yellow-500/30', text: 'text-yellow-400' };\n  };\n\n  const colors = getSeverityColor(flaw.harmonyPercentageLost);\n\n  return (\n    <motion.div\n      className={`${colors.bg} border ${colors.border} rounded-xl overflow-hidden`}\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ delay: rank * 0.05 }}\n    >\n      {/* Header */}\n      <button\n        onClick={() => setIsExpanded(!isExpanded)}\n        className=\"w-full p-4 flex items-center justify-between hover:bg-white/5 transition-colors\"\n      >\n        <div className=\"flex items-center gap-3\">\n          <div className={`w-8 h-8 rounded-lg ${colors.bg} flex items-center justify-center`}>\n            <span className={`text-sm font-bold ${colors.text}`}>#{rank}</span>\n          </div>\n          <div className=\"text-left\">\n            <h4 className=\"font-medium text-white\">{flaw.flawName}</h4>\n            <p className=\"text-xs text-neutral-400\">{flaw.categoryName}</p>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-4\">\n          <div className=\"text-right\">\n            <span className={`text-sm font-semibold ${colors.text}`}>\n              -{flaw.harmonyPercentageLost.toFixed(1)}%\n            </span>\n            <p className=\"text-xs text-neutral-500\">harmony lost</p>\n          </div>\n          {isExpanded ? (\n            <ChevronUp size={20} className=\"text-neutral-400\" />\n          ) : (\n            <ChevronDown size={20} className=\"text-neutral-400\" />\n          )}\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.2 }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"px-4 pb-4 space-y-4\">\n              {/* Summary */}\n              <p className=\"text-sm text-neutral-300\">{flaw.summary}</p>\n\n              {/* Contributing Ratios */}\n              {flaw.responsibleRatios.length > 0 && (\n                <div className=\"space-y-2\">\n                  <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n                    Contributing Metrics\n                  </h5>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {flaw.responsibleRatios.slice(0, 3).map((ratio) => (\n                      <div\n                        key={ratio.ratioId}\n                        className=\"px-2 py-1 bg-neutral-800/50 rounded-lg text-xs\"\n                      >\n                        <span className=\"text-neutral-300\">{ratio.ratioName}</span>\n                        <span className=\"text-neutral-500 ml-1\">\n                          ({typeof ratio.score === 'number' ? ratio.score.toFixed(1) : ratio.score}/10)\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Products to Fix */}\n              {products.length > 0 && (\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Package size={14} className=\"text-cyan-400\" />\n                    <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n                      Products to Help\n                    </h5>\n                  </div>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                    {products.slice(0, 2).map((rec) => (\n                      <ProductCard key={rec.product.id} recommendation={rec} compact />\n                    ))}\n                  </div>\n                  {products.length > 2 && (\n                    <p className=\"text-xs text-neutral-500 text-center\">\n                      +{products.length - 2} more products\n                    </p>\n                  )}\n                </div>\n              )}\n\n              {/* Treatments */}\n              {treatments.length > 0 && (\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Zap size={14} className=\"text-purple-400\" />\n                    <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n                      Recommended Treatments\n                    </h5>\n                  </div>\n                  <div className=\"space-y-2\">\n                    {treatments.slice(0, 3).map((treatment) => (\n                      <button\n                        key={treatment.ref_id}\n                        onClick={() => onViewTreatment?.(treatment)}\n                        className=\"w-full flex items-center justify-between p-3 bg-neutral-800/50 rounded-lg hover:bg-neutral-800 transition-colors group\"\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <div className={`px-2 py-0.5 rounded text-xs font-medium ${\n                            treatment.phase === 'Foundational'\n                              ? 'bg-green-500/20 text-green-400'\n                              : treatment.phase === 'Minimally Invasive'\n                                ? 'bg-yellow-500/20 text-yellow-400'\n                                : 'bg-red-500/20 text-red-400'\n                          }`}>\n                            {treatment.phase}\n                          </div>\n                          <span className=\"text-sm text-white\">{treatment.name}</span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-xs text-green-400\">\n                            +{(treatment.impact * 100).toFixed(0)}% improvement\n                          </span>\n                          <ArrowRight size={14} className=\"text-neutral-500 group-hover:text-cyan-400 transition-colors\" />\n                        </div>\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* CTA */}\n              <div className=\"pt-2 border-t border-neutral-800\">\n                <a\n                  href=\"#plan\"\n                  className=\"flex items-center justify-center gap-2 w-full py-2.5 bg-gradient-to-r from-cyan-500 to-blue-600 text-black text-sm font-medium rounded-lg hover:opacity-90 transition-opacity\"\n                >\n                  <ShoppingCart size={16} />\n                  View Full Fix Plan\n                </a>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n","numLines":194,"startLine":1,"totalLines":194}}}
{"parentUuid":"d1ab7c05-7787-4a1c-8847-bc5d53da26bf","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016RvSijiYNp2ubwMm6wRast","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useState, useMemo } from 'react';\n     4→import { motion, AnimatePresence } from 'framer-motion';\n     5→import { ChevronDown, Sparkles, AlertTriangle } from 'lucide-react';\n     6→import { Strength, Flaw, ResponsibleRatio, Recommendation, getScoreColor } from '@/types/results';\n     7→import { useResults } from '@/contexts/ResultsContext';\n     8→\n     9→// ============================================\n    10→// QUALITY BADGE COMPONENT (Light Theme)\n    11→// ============================================\n    12→\n    13→type QualityLevel = 'ideal' | 'excellent' | 'good' | 'below_average';\n    14→\n    15→interface QualityBadgeConfig {\n    16→  label: string;\n    17→  textColor: string;\n    18→  bgColor: string;\n    19→}\n    20→\n    21→const QUALITY_CONFIGS: Record<QualityLevel, QualityBadgeConfig> = {\n    22→  ideal: {\n    23→    label: 'Ideal',\n    24→    textColor: 'rgb(8, 145, 178)',    // cyan-600\n    25→    bgColor: 'rgb(207, 250, 254)',    // cyan-100\n    26→  },\n    27→  excellent: {\n    28→    label: 'Excellent',\n    29→    textColor: 'rgb(4, 120, 87)',     // emerald-700\n    30→    bgColor: 'rgb(209, 250, 229)',    // emerald-100\n    31→  },\n    32→  good: {\n    33→    label: 'Good',\n    34→    textColor: 'rgb(21, 128, 61)',    // green-700\n    35→    bgColor: 'rgb(220, 252, 231)',    // green-100\n    36→  },\n    37→  below_average: {\n    38→    label: 'Average',\n    39→    textColor: 'rgb(113, 113, 122)',  // gray-500\n    40→    bgColor: 'rgb(244, 244, 245)',    // gray-100\n    41→  },\n    42→};\n    43→\n    44→function QualityBadge({ quality }: { quality: QualityLevel }) {\n    45→  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n    46→\n    47→  return (\n    48→    <span\n    49→      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n    50→      style={{\n    51→        color: config.textColor,\n    52→        backgroundColor: config.bgColor,\n    53→      }}\n    54→    >\n    55→      {config.label}\n    56→    </span>\n    57→  );\n    58→}\n    59→\n    60→// ============================================\n    61→// SEVERITY BADGE COMPONENT (Harmony Style)\n    62→// ============================================\n    63→\n    64→type SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n    65→\n    66→interface SeverityBadgeConfig {\n    67→  label: string;\n    68→  textColor: string;\n    69→  bgColor: string;\n    70→  borderColor?: string;\n    71→}\n    72→\n    73→const SEVERITY_CONFIGS: Record<SeverityLevel, SeverityBadgeConfig> = {\n    74→  extremely_severe: {\n    75→    label: 'extremely severe',\n    76→    textColor: 'rgb(127, 29, 29)',     // red-900\n    77→    bgColor: 'rgb(254, 202, 202)',     // red-200\n    78→  },\n    79→  severe: {\n    80→    label: 'severe',\n    81→    textColor: 'rgb(185, 28, 28)',     // red-700\n    82→    bgColor: 'rgb(254, 226, 226)',     // red-50\n    83→    borderColor: 'rgb(254, 202, 202)', // red-200\n    84→  },\n    85→  moderate: {\n    86→    label: 'moderate',\n    87→    textColor: 'rgb(194, 65, 12)',     // orange-700\n    88→    bgColor: 'rgb(255, 237, 213)',     // orange-50\n    89→    borderColor: 'rgb(254, 215, 170)', // orange-200\n    90→  },\n    91→  minor: {\n    92→    label: 'minor',\n    93→    textColor: 'rgb(161, 98, 7)',      // yellow-700\n    94→    bgColor: 'rgb(254, 249, 195)',     // yellow-50\n    95→    borderColor: 'rgb(254, 240, 138)', // yellow-200\n    96→  },\n    97→};\n    98→\n    99→function getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n   100→  // Handle edge cases: NaN, Infinity, undefined, null, negative\n   101→  if (\n   102→    typeof harmonyLost !== 'number' ||\n   103→    !Number.isFinite(harmonyLost) ||\n   104→    Number.isNaN(harmonyLost) ||\n   105→    harmonyLost < 0\n   106→  ) {\n   107→    return 'minor'; // Default to least severe for invalid values\n   108→  }\n   109→  if (harmonyLost >= 0.8) return 'extremely_severe';\n   110→  if (harmonyLost >= 0.5) return 'severe';\n   111→  if (harmonyLost >= 0.3) return 'moderate';\n   112→  return 'minor';\n   113→}\n   114→\n   115→function SeverityBadge({ severity }: { severity: SeverityLevel }) {\n   116→  const config = SEVERITY_CONFIGS[severity] || SEVERITY_CONFIGS.moderate;\n   117→\n   118→  return (\n   119→    <span\n   120→      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n   121→      style={{\n   122→        color: config.textColor,\n   123→        backgroundColor: config.bgColor,\n   124→        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n   125→      }}\n   126→    >\n   127→      {config.label}\n   128→    </span>\n   129→  );\n   130→}\n   131→\n   132→// ============================================\n   133→// PROCEDURE PHASE BADGE\n   134→// ============================================\n   135→\n   136→type ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n   137→\n   138→interface PhaseConfig {\n   139→  textColor: string;\n   140→  bgColor: string;\n   141→}\n   142→\n   143→const PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n   144→  Foundational: {\n   145→    textColor: 'rgb(4, 120, 87)',     // emerald-700\n   146→    bgColor: 'rgb(209, 250, 229)',    // emerald-50\n   147→  },\n   148→  'Non-Invasive': {\n   149→    textColor: 'rgb(29, 78, 216)',    // blue-700\n   150→    bgColor: 'rgb(219, 234, 254)',    // blue-50\n   151→  },\n   152→  'Minimally Invasive': {\n   153→    textColor: 'rgb(109, 40, 217)',   // violet-700\n   154→    bgColor: 'rgb(237, 233, 254)',    // violet-50\n   155→  },\n   156→  Surgical: {\n   157→    textColor: 'rgb(126, 34, 206)',   // purple-700\n   158→    bgColor: 'rgb(243, 232, 255)',    // purple-50\n   159→  },\n   160→};\n   161→\n   162→function PhaseBadge({ phase }: { phase: ProcedurePhase }) {\n   163→  const config = PHASE_CONFIGS[phase] || PHASE_CONFIGS['Non-Invasive'];\n   164→\n   165→  return (\n   166→    <span\n   167→      className=\"px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium\"\n   168→      style={{\n   169→        color: config.textColor,\n   170→        backgroundColor: config.bgColor,\n   171→      }}\n   172→    >\n   173→      {phase}\n   174→    </span>\n   175→  );\n   176→}\n   177→\n   178→// ============================================\n   179→// CONTRIBUTING RATIO BUTTON (Harmony Style - Dark Theme)\n   180→// ============================================\n   181→\n   182→interface ContributingRatioButtonProps {\n   183→  ratioName: string;\n   184→  score: number | string;\n   185→  onClick: () => void;\n   186→  animationDelay?: number;\n   187→}\n   188→\n   189→function ContributingRatioButton({\n   190→  ratioName,\n   191→  score,\n   192→  onClick,\n   193→  animationDelay = 0,\n   194→}: ContributingRatioButtonProps) {\n   195→  const numericScore = typeof score === 'number' ? score : 0;\n   196→  const color = getScoreColor(numericScore);\n   197→\n   198→  return (\n   199→    <motion.button\n   200→      initial={{ opacity: 0, y: 10 }}\n   201→      animate={{ opacity: 1, y: 0 }}\n   202→      transition={{ duration: 0.2, delay: animationDelay }}\n   203→      onClick={onClick}\n   204→      className=\"w-full flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-lg border transition-all text-left cursor-pointer group bg-neutral-900/80 border-neutral-800 hover:border-neutral-700 hover:bg-neutral-800/50\"\n   205→    >\n   206→      <span className=\"text-xs sm:text-sm font-medium transition-colors text-neutral-200 group-hover:text-white\">\n   207→        {ratioName}\n   208→      </span>\n   209→      <div className=\"flex items-baseline gap-0.5 sm:gap-1\">\n   210→        <span className=\"text-xs sm:text-sm font-semibold\" style={{ color: typeof score === 'string' ? '#a3a3a3' : color }}>\n   211→          {typeof score === 'number' ? score.toFixed(1) : score}\n   212→        </span>\n   213→        <span className=\"text-[10px] sm:text-xs text-neutral-500\">/10</span>\n   214→      </div>\n   215→    </motion.button>\n   216→  );\n   217→}\n   218→\n   219→// ============================================\n   220→// PLAN ITEM (Recommendation in \"Your Plan\" section)\n   221→// ============================================\n   222→\n   223→interface PlanItemProps {\n   224→  name: string;\n   225→  phase: ProcedurePhase;\n   226→  animationDelay?: number;\n   227→}\n   228→\n   229→function PlanItem({ name, phase, animationDelay = 0 }: PlanItemProps) {\n   230→  return (\n   231→    <motion.div\n   232→      initial={{ opacity: 0, y: 10 }}\n   233→      animate={{ opacity: 1, y: 0 }}\n   234→      transition={{ duration: 0.2, delay: animationDelay }}\n   235→      className=\"flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-lg bg-neutral-900/80 border border-neutral-800\"\n   236→    >\n   237→      <span className=\"text-xs sm:text-sm text-neutral-200 font-medium\">{name}</span>\n   238→      <div className=\"flex items-center gap-2\">\n   239→        <span className=\"text-[9px] sm:text-[10px] px-1.5 py-0.5 rounded bg-emerald-500/20 text-emerald-400 font-medium\">\n   240→          In Plan\n   241→        </span>\n   242→        <PhaseBadge phase={phase} />\n   243→      </div>\n   244→    </motion.div>\n   245→  );\n   246→}\n   247→\n   248→// ============================================\n   249→// KEY STRENGTH CARD (Harmony Style)\n   250→// ============================================\n   251→\n   252→interface KeyStrengthCardProps {\n   253→  strength: Strength;\n   254→  isExpanded: boolean;\n   255→  onToggle: () => void;\n   256→  onRatioClick: (ratio: ResponsibleRatio) => void;\n   257→  animationDelay?: number;\n   258→}\n   259→\n   260→function KeyStrengthCard({\n   261→  strength,\n   262→  isExpanded,\n   263→  onToggle,\n   264→  onRatioClick,\n   265→  animationDelay = 0,\n   266→}: KeyStrengthCardProps) {\n   267→  const score = typeof strength.avgScore === 'number' ? strength.avgScore : 0;\n   268→  const color = getScoreColor(score);\n   269→\n   270→  return (\n   271→    <motion.div\n   272→      initial={{ opacity: 0, y: 10 }}\n   273→      animate={{ opacity: 1, y: 0 }}\n   274→      transition={{ duration: 0.3, delay: animationDelay }}\n   275→      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-cyan-500/30' : 'border-neutral-800 hover:border-neutral-700'\n   276→        }`}\n   277→    >\n   278→      {/* Header Button */}\n   279→      <button\n   280→        onClick={onToggle}\n   281→        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n   282→      >\n   283→        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n   284→          {/* Left: Badge + Content */}\n   285→          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n   286→            <QualityBadge quality={strength.qualityLevel} />\n   287→            <div className=\"flex-1 min-w-0\">\n   288→              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n   289→                {strength.strengthName}\n   290→              </h4>\n   291→              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n   292→                {strength.summary}\n   293→              </p>\n   294→            </div>\n   295→          </div>\n   296→\n   297→          {/* Right: Score + Chevron */}\n   298→          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n   299→            <div className=\"text-right\">\n   300→              <div\n   301→                className=\"text-lg sm:text-xl font-semibold tracking-tight\"\n   302→                style={{ color: typeof strength.avgScore === 'string' ? '#a3a3a3' : color }}\n   303→              >\n   304→                {typeof strength.avgScore === 'number' ? strength.avgScore.toFixed(2) : strength.avgScore}\n   305→              </div>\n   306→              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium mt-0.5\">avg /10</div>\n   307→            </div>\n   308→            <motion.div\n   309→              animate={{ rotate: isExpanded ? 180 : 0 }}\n   310→              transition={{ duration: 0.3 }}\n   311→            >\n   312→              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n   313→            </motion.div>\n   314→          </div>\n   315→        </div>\n   316→      </button>\n   317→\n   318→      {/* Expanded Content */}\n   319→      <AnimatePresence initial={false}>\n   320→        {isExpanded && (\n   321→          <motion.div\n   322→            initial={{ height: 0, opacity: 0 }}\n   323→            animate={{ height: 'auto', opacity: 1 }}\n   324→            exit={{ height: 0, opacity: 0 }}\n   325→            transition={{ duration: 0.3 }}\n   326→            className=\"overflow-hidden\"\n   327→          >\n   328→            <div className=\"border-t border-neutral-800 bg-neutral-800/30 px-4 sm:px-5 py-3 sm:py-4\">\n   329→              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n   330→                Contributing Ratios\n   331→              </div>\n   332→              <div className=\"space-y-2\">\n   333→                {strength.responsibleRatios.map((ratio, i) => (\n   334→                  <ContributingRatioButton\n   335→                    key={ratio.ratioId}\n   336→                    ratioName={ratio.ratioName}\n   337→                    score={ratio.score}\n   338→                    onClick={() => onRatioClick(ratio)}\n   339→                    animationDelay={i * 0.05}\n   340→                  />\n   341→                ))}\n   342→              </div>\n   343→            </div>\n   344→          </motion.div>\n   345→        )}\n   346→      </AnimatePresence>\n   347→    </motion.div>\n   348→  );\n   349→}\n   350→\n   351→// ============================================\n   352→// AREA OF IMPROVEMENT CARD (Harmony Style with Your Plan)\n   353→// ============================================\n   354→\n   355→interface AreaOfImprovementCardProps {\n   356→  flaw: Flaw;\n   357→  isExpanded: boolean;\n   358→  onToggle: () => void;\n   359→  onRatioClick: (ratio: ResponsibleRatio) => void;\n   360→  recommendations?: Recommendation[];\n   361→  animationDelay?: number;\n   362→}\n   363→\n   364→function AreaOfImprovementCard({\n   365→  flaw,\n   366→  isExpanded,\n   367→  onToggle,\n   368→  onRatioClick,\n   369→  recommendations = [],\n   370→  animationDelay = 0,\n   371→}: AreaOfImprovementCardProps) {\n   372→  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n   373→\n   374→  // Find matching recommendations for this flaw\n   375→  const matchedRecommendations = useMemo(() => {\n   376→    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n   377→    return recommendations.filter(rec =>\n   378→      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n   379→      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n   380→    ).slice(0, 3);\n   381→  }, [flaw, recommendations]);\n   382→\n   383→  // Map phase names\n   384→  const mapPhase = (phase: string): ProcedurePhase => {\n   385→    if (phase === 'Foundational') return 'Foundational';\n   386→    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n   387→    if (phase === 'Surgical') return 'Surgical';\n   388→    return 'Non-Invasive';\n   389→  };\n   390→\n   391→  return (\n   392→    <motion.div\n   393→      initial={{ opacity: 0, y: 10 }}\n   394→      animate={{ opacity: 1, y: 0 }}\n   395→      transition={{ duration: 0.3, delay: animationDelay }}\n   396→      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-red-500/30' : 'border-neutral-800 hover:border-neutral-700'\n   397→        }`}\n   398→    >\n   399→      {/* Header Button */}\n   400→      <button\n   401→        onClick={onToggle}\n   402→        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n   403→      >\n   404→        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n   405→          {/* Left: Badge + Content */}\n   406→          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n   407→            <SeverityBadge severity={severity} />\n   408→            <div className=\"flex-1 min-w-0\">\n   409→              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n   410→                {flaw.flawName}\n   411→              </h4>\n   412→              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n   413→                {flaw.summary}\n   414→              </p>\n   415→            </div>\n   416→          </div>\n   417→\n   418→          {/* Right: Points impact + Chevron */}\n   419→          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n   420→            <div className=\"text-right space-y-1\">\n   421→              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-500\">\n   422→                -{(typeof flaw.harmonyPercentageLost === 'number' && Number.isFinite(flaw.harmonyPercentageLost)\n   423→                  ? flaw.harmonyPercentageLost\n   424→                  : 0\n   425→                ).toFixed(2)}\n   426→              </div>\n   427→              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n   428→              {flaw.rollingHarmonyPercentageLost !== undefined &&\n   429→                typeof flaw.rollingHarmonyPercentageLost === 'number' &&\n   430→                Number.isFinite(flaw.rollingHarmonyPercentageLost) && (\n   431→                  <div className=\"text-[10px] text-neutral-600 font-medium pt-0.5 border-t border-neutral-700 mt-1\">\n   432→                    Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n   433→                  </div>\n   434→                )}\n   435→            </div>\n   436→            <motion.div\n   437→              animate={{ rotate: isExpanded ? 180 : 0 }}\n   438→              transition={{ duration: 0.3 }}\n   439→            >\n   440→              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n   441→            </motion.div>\n   442→          </div>\n   443→        </div>\n   444→      </button>\n   445→\n   446→      {/* Expanded Content */}\n   447→      <AnimatePresence initial={false}>\n   448→        {isExpanded && (\n   449→          <motion.div\n   450→            initial={{ height: 0, opacity: 0 }}\n   451→            animate={{ height: 'auto', opacity: 1 }}\n   452→            exit={{ height: 0, opacity: 0 }}\n   453→            transition={{ duration: 0.3 }}\n   454→            className=\"overflow-hidden\"\n   455→          >\n   456→            {/* Affected Ratios Section */}\n   457→            <div className=\"border-t border-neutral-800 bg-neutral-800/30 px-4 sm:px-5 py-3 sm:py-4\">\n   458→              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n   459→                Affected Ratios\n   460→              </div>\n   461→              <div className=\"space-y-2\">\n   462→                {flaw.responsibleRatios.map((ratio, i) => (\n   463→                  <ContributingRatioButton\n   464→                    key={ratio.ratioId}\n   465→                    ratioName={ratio.ratioName}\n   466→                    score={ratio.score}\n   467→                    onClick={() => onRatioClick(ratio)}\n   468→                    animationDelay={i * 0.05}\n   469→                  />\n   470→                ))}\n   471→              </div>\n   472→            </div>\n   473→\n   474→            {/* Your Plan Section (if there are matched recommendations) */}\n   475→            {matchedRecommendations.length > 0 && (\n   476→              <div className=\"border-t border-neutral-800 bg-emerald-900/10 px-4 sm:px-5 py-3 sm:py-4\">\n   477→                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n   478→                  <Sparkles className=\"w-3 h-3 text-emerald-400\" />\n   479→                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-400 uppercase tracking-wider\">\n   480→                    Your Plan\n   481→                  </span>\n   482→                </div>\n   483→                <div className=\"space-y-2\">\n   484→                  {matchedRecommendations.map((rec, i) => (\n   485→                    <PlanItem\n   486→                      key={rec.ref_id}\n   487→                      name={rec.name}\n   488→                      phase={mapPhase(rec.phase)}\n   489→                      animationDelay={i * 0.05}\n   490→                    />\n   491→                  ))}\n   492→                </div>\n   493→              </div>\n   494→            )}\n   495→          </motion.div>\n   496→        )}\n   497→      </AnimatePresence>\n   498→    </motion.div>\n   499→  );\n   500→}\n   501→\n   502→// ============================================\n   503→// KEY STRENGTHS SECTION (Harmony Style)\n   504→// ============================================\n   505→\n   506→interface KeyStrengthsSectionProps {\n   507→  strengths: Strength[];\n   508→  onRatioClick: (ratio: ResponsibleRatio, categoryName: string) => void;\n   509→  initialShowCount?: number;\n   510→}\n   511→\n   512→export function KeyStrengthsSection({\n   513→  strengths,\n   514→  onRatioClick,\n   515→  initialShowCount = 3,\n   516→}: KeyStrengthsSectionProps) {\n   517→  const [expandedId, setExpandedId] = useState<string | null>(null);\n   518→  const [showAll, setShowAll] = useState(false);\n   519→\n   520→  const displayedStrengths = showAll ? strengths : strengths.slice(0, initialShowCount);\n   521→  const remainingCount = Math.max(0, strengths.length - initialShowCount);\n   522→\n   523→  // Calculate average strength contribution (handle invalid values)\n   524→  const avgScore = useMemo(() => {\n   525→    if (!strengths || strengths.length === 0) return 0;\n   526→    const validScores = strengths.filter(\n   527→      (s) => typeof s.avgScore === 'number' && Number.isFinite(s.avgScore)\n   528→    );\n   529→    if (validScores.length === 0) return 0;\n   530→    return validScores.reduce((sum, s) => sum + (s.avgScore as number), 0) / validScores.length;\n   531→  }, [strengths]);\n   532→\n   533→  return (\n   534→    <div className=\"rounded-xl bg-neutral-900/50 border border-neutral-800 p-4 sm:p-6\">\n   535→      {/* Header */}\n   536→      <div className=\"flex items-center justify-between mb-4 sm:mb-5\">\n   537→        <div className=\"flex items-center gap-2\">\n   538→          <div className=\"w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center\">\n   539→            <Sparkles className=\"w-4 h-4 text-cyan-400\" />\n   540→          </div>\n   541→          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n   542→            Key Strengths\n   543→          </h3>\n   544→        </div>\n   545→        <div className=\"text-right\">\n   546→          <span className=\"text-sm text-neutral-500\">\n   547→            {strengths.length} total\n   548→          </span>\n   549→          {strengths.length > 0 && (\n   550→            <p className=\"text-xs text-green-400 font-medium\">\n   551→              Avg: {avgScore.toFixed(1)}/10\n   552→            </p>\n   553→          )}\n   554→        </div>\n   555→      </div>\n   556→\n   557→      {/* Cards */}\n   558→      <div className=\"space-y-3\">\n   559→        {displayedStrengths.length > 0 ? (\n   560→          displayedStrengths.map((strength, i) => (\n   561→            <KeyStrengthCard\n   562→              key={strength.id}\n   563→              strength={strength}\n   564→              isExpanded={expandedId === strength.id}\n   565→              onToggle={() => setExpandedId(expandedId === strength.id ? null : strength.id)}\n   566→              onRatioClick={(ratio) => onRatioClick(ratio, strength.categoryName)}\n   567→              animationDelay={i * 0.04}\n   568→            />\n   569→          ))\n   570→        ) : (\n   571→          <div className=\"rounded-xl bg-neutral-800/50 border border-neutral-700 p-6 text-center\">\n   572→            <p className=\"text-neutral-500\">No significant strengths detected</p>\n   573→          </div>\n   574→        )}\n   575→      </div>\n   576→\n   577→      {/* Show More Button */}\n   578→      {remainingCount > 0 && (\n   579→        <button\n   580→          onClick={() => setShowAll(!showAll)}\n   581→          className=\"w-full mt-4 py-3 rounded-lg bg-neutral-800/50 border border-neutral-700 hover:border-neutral-600 hover:bg-neutral-800 transition-all duration-200 text-sm font-medium text-white\"\n   582→        >\n   583→          <span className=\"flex items-center justify-center gap-2\">\n   584→            <span>{showAll ? 'Show Less' : `Show ${remainingCount} More`}</span>\n   585→            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n   586→              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n   587→            </motion.div>\n   588→          </span>\n   589→        </button>\n   590→      )}\n   591→    </div>\n   592→  );\n   593→}\n   594→\n   595→// ============================================\n   596→// AREAS OF IMPROVEMENT SECTION (Harmony Style with Your Plan)\n   597→// ============================================\n   598→\n   599→interface AreasOfImprovementSectionProps {\n   600→  flaws: Flaw[];\n   601→  onRatioClick: (ratio: ResponsibleRatio, categoryName: string) => void;\n   602→  initialShowCount?: number;\n   603→}\n   604→\n   605→export function AreasOfImprovementSection({\n   606→  flaws,\n   607→  onRatioClick,\n   608→  initialShowCount = 3,\n   609→}: AreasOfImprovementSectionProps) {\n   610→  const [expandedId, setExpandedId] = useState<string | null>(null);\n   611→  const [showAll, setShowAll] = useState(false);\n   612→\n   613→  // Get recommendations from context\n   614→  const { recommendations } = useResults();\n   615→\n   616→  const displayedFlaws = showAll ? flaws : flaws.slice(0, initialShowCount);\n   617→  const remainingCount = Math.max(0, flaws.length - initialShowCount);\n   618→\n   619→  // Calculate total impact from all flaws (handle invalid values)\n   620→  const totalImpact = flaws.reduce((sum, f) => {\n   621→    const impact = typeof f.harmonyPercentageLost === 'number' && Number.isFinite(f.harmonyPercentageLost)\n   622→      ? f.harmonyPercentageLost\n   623→      : 0;\n   624→    return sum + impact;\n   625→  }, 0);\n   626→\n   627→  return (\n   628→    <div className=\"rounded-xl bg-neutral-900/50 border border-neutral-800 p-4 sm:p-6\">\n   629→      {/* Header */}\n   630→      <div className=\"flex items-center justify-between mb-4 sm:mb-5\">\n   631→        <div className=\"flex items-center gap-2\">\n   632→          <div className=\"w-8 h-8 rounded-lg bg-amber-500/20 flex items-center justify-center\">\n   633→            <AlertTriangle className=\"w-4 h-4 text-amber-400\" />\n   634→          </div>\n   635→          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n   636→            Areas of Improvement\n   637→          </h3>\n   638→        </div>\n   639→        <div className=\"text-right\">\n   640→          <span className=\"text-sm text-neutral-500\">\n   641→            {flaws.length} total\n   642→          </span>\n   643→          {flaws.length > 0 && (\n   644→            <p className=\"text-xs text-red-400 font-medium\">\n   645→              Impact: -{totalImpact.toFixed(1)} pts\n   646→            </p>\n   647→          )}\n   648→        </div>\n   649→      </div>\n   650→\n   651→      {/* Cards */}\n   652→      <div className=\"space-y-3\">\n   653→        {displayedFlaws.length > 0 ? (\n   654→          displayedFlaws.map((flaw, i) => (\n   655→            <AreaOfImprovementCard\n   656→              key={flaw.id}\n   657→              flaw={flaw}\n   658→              isExpanded={expandedId === flaw.id}\n   659→              onToggle={() => setExpandedId(expandedId === flaw.id ? null : flaw.id)}\n   660→              onRatioClick={(ratio) => onRatioClick(ratio, flaw.categoryName)}\n   661→              recommendations={recommendations}\n   662→              animationDelay={i * 0.04}\n   663→            />\n   664→          ))\n   665→        ) : (\n   666→          <div className=\"rounded-xl bg-neutral-800/50 border border-neutral-700 p-6 text-center\">\n   667→            <p className=\"text-neutral-500\">No significant areas for improvement detected</p>\n   668→          </div>\n   669→        )}\n   670→      </div>\n   671→\n   672→      {/* Show More Button */}\n   673→      {remainingCount > 0 && (\n   674→        <button\n   675→          onClick={() => setShowAll(!showAll)}\n   676→          className=\"w-full mt-4 py-3 rounded-lg bg-neutral-800/50 border border-neutral-700 hover:border-neutral-600 hover:bg-neutral-800 transition-all duration-200 text-sm font-medium text-white\"\n   677→        >\n   678→          <span className=\"flex items-center justify-center gap-2\">\n   679→            <span>{showAll ? 'Show Less' : `Show ${remainingCount} More`}</span>\n   680→            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n   681→              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n   682→            </motion.div>\n   683→          </span>\n   684→        </button>\n   685→      )}\n   686→    </div>\n   687→  );\n   688→}\n   689→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"97ec6c1c-e0a5-4630-a13d-70caf6a7bb75","timestamp":"2025-12-26T14:50:15.579Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","content":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ChevronDown, Sparkles, AlertTriangle } from 'lucide-react';\nimport { Strength, Flaw, ResponsibleRatio, Recommendation, getScoreColor } from '@/types/results';\nimport { useResults } from '@/contexts/ResultsContext';\n\n// ============================================\n// QUALITY BADGE COMPONENT (Light Theme)\n// ============================================\n\ntype QualityLevel = 'ideal' | 'excellent' | 'good' | 'below_average';\n\ninterface QualityBadgeConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n}\n\nconst QUALITY_CONFIGS: Record<QualityLevel, QualityBadgeConfig> = {\n  ideal: {\n    label: 'Ideal',\n    textColor: 'rgb(8, 145, 178)',    // cyan-600\n    bgColor: 'rgb(207, 250, 254)',    // cyan-100\n  },\n  excellent: {\n    label: 'Excellent',\n    textColor: 'rgb(4, 120, 87)',     // emerald-700\n    bgColor: 'rgb(209, 250, 229)',    // emerald-100\n  },\n  good: {\n    label: 'Good',\n    textColor: 'rgb(21, 128, 61)',    // green-700\n    bgColor: 'rgb(220, 252, 231)',    // green-100\n  },\n  below_average: {\n    label: 'Average',\n    textColor: 'rgb(113, 113, 122)',  // gray-500\n    bgColor: 'rgb(244, 244, 245)',    // gray-100\n  },\n};\n\nfunction QualityBadge({ quality }: { quality: QualityLevel }) {\n  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n\n  return (\n    <span\n      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// SEVERITY BADGE COMPONENT (Harmony Style)\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n\ninterface SeverityBadgeConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor?: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityBadgeConfig> = {\n  extremely_severe: {\n    label: 'extremely severe',\n    textColor: 'rgb(127, 29, 29)',     // red-900\n    bgColor: 'rgb(254, 202, 202)',     // red-200\n  },\n  severe: {\n    label: 'severe',\n    textColor: 'rgb(185, 28, 28)',     // red-700\n    bgColor: 'rgb(254, 226, 226)',     // red-50\n    borderColor: 'rgb(254, 202, 202)', // red-200\n  },\n  moderate: {\n    label: 'moderate',\n    textColor: 'rgb(194, 65, 12)',     // orange-700\n    bgColor: 'rgb(255, 237, 213)',     // orange-50\n    borderColor: 'rgb(254, 215, 170)', // orange-200\n  },\n  minor: {\n    label: 'minor',\n    textColor: 'rgb(161, 98, 7)',      // yellow-700\n    bgColor: 'rgb(254, 249, 195)',     // yellow-50\n    borderColor: 'rgb(254, 240, 138)', // yellow-200\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  // Handle edge cases: NaN, Infinity, undefined, null, negative\n  if (\n    typeof harmonyLost !== 'number' ||\n    !Number.isFinite(harmonyLost) ||\n    Number.isNaN(harmonyLost) ||\n    harmonyLost < 0\n  ) {\n    return 'minor'; // Default to least severe for invalid values\n  }\n  if (harmonyLost >= 0.8) return 'extremely_severe';\n  if (harmonyLost >= 0.5) return 'severe';\n  if (harmonyLost >= 0.3) return 'moderate';\n  return 'minor';\n}\n\nfunction SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity] || SEVERITY_CONFIGS.moderate;\n\n  return (\n    <span\n      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================\n\ntype ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n\ninterface PhaseConfig {\n  textColor: string;\n  bgColor: string;\n}\n\nconst PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n  Foundational: {\n    textColor: 'rgb(4, 120, 87)',     // emerald-700\n    bgColor: 'rgb(209, 250, 229)',    // emerald-50\n  },\n  'Non-Invasive': {\n    textColor: 'rgb(29, 78, 216)',    // blue-700\n    bgColor: 'rgb(219, 234, 254)',    // blue-50\n  },\n  'Minimally Invasive': {\n    textColor: 'rgb(109, 40, 217)',   // violet-700\n    bgColor: 'rgb(237, 233, 254)',    // violet-50\n  },\n  Surgical: {\n    textColor: 'rgb(126, 34, 206)',   // purple-700\n    bgColor: 'rgb(243, 232, 255)',    // purple-50\n  },\n};\n\nfunction PhaseBadge({ phase }: { phase: ProcedurePhase }) {\n  const config = PHASE_CONFIGS[phase] || PHASE_CONFIGS['Non-Invasive'];\n\n  return (\n    <span\n      className=\"px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {phase}\n    </span>\n  );\n}\n\n// ============================================\n// CONTRIBUTING RATIO BUTTON (Harmony Style - Dark Theme)\n// ============================================\n\ninterface ContributingRatioButtonProps {\n  ratioName: string;\n  score: number | string;\n  onClick: () => void;\n  animationDelay?: number;\n}\n\nfunction ContributingRatioButton({\n  ratioName,\n  score,\n  onClick,\n  animationDelay = 0,\n}: ContributingRatioButtonProps) {\n  const numericScore = typeof score === 'number' ? score : 0;\n  const color = getScoreColor(numericScore);\n\n  return (\n    <motion.button\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.2, delay: animationDelay }}\n      onClick={onClick}\n      className=\"w-full flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-lg border transition-all text-left cursor-pointer group bg-neutral-900/80 border-neutral-800 hover:border-neutral-700 hover:bg-neutral-800/50\"\n    >\n      <span className=\"text-xs sm:text-sm font-medium transition-colors text-neutral-200 group-hover:text-white\">\n        {ratioName}\n      </span>\n      <div className=\"flex items-baseline gap-0.5 sm:gap-1\">\n        <span className=\"text-xs sm:text-sm font-semibold\" style={{ color: typeof score === 'string' ? '#a3a3a3' : color }}>\n          {typeof score === 'number' ? score.toFixed(1) : score}\n        </span>\n        <span className=\"text-[10px] sm:text-xs text-neutral-500\">/10</span>\n      </div>\n    </motion.button>\n  );\n}\n\n// ============================================\n// PLAN ITEM (Recommendation in \"Your Plan\" section)\n// ============================================\n\ninterface PlanItemProps {\n  name: string;\n  phase: ProcedurePhase;\n  animationDelay?: number;\n}\n\nfunction PlanItem({ name, phase, animationDelay = 0 }: PlanItemProps) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.2, delay: animationDelay }}\n      className=\"flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-lg bg-neutral-900/80 border border-neutral-800\"\n    >\n      <span className=\"text-xs sm:text-sm text-neutral-200 font-medium\">{name}</span>\n      <div className=\"flex items-center gap-2\">\n        <span className=\"text-[9px] sm:text-[10px] px-1.5 py-0.5 rounded bg-emerald-500/20 text-emerald-400 font-medium\">\n          In Plan\n        </span>\n        <PhaseBadge phase={phase} />\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// KEY STRENGTH CARD (Harmony Style)\n// ============================================\n\ninterface KeyStrengthCardProps {\n  strength: Strength;\n  isExpanded: boolean;\n  onToggle: () => void;\n  onRatioClick: (ratio: ResponsibleRatio) => void;\n  animationDelay?: number;\n}\n\nfunction KeyStrengthCard({\n  strength,\n  isExpanded,\n  onToggle,\n  onRatioClick,\n  animationDelay = 0,\n}: KeyStrengthCardProps) {\n  const score = typeof strength.avgScore === 'number' ? strength.avgScore : 0;\n  const color = getScoreColor(score);\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.3, delay: animationDelay }}\n      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-cyan-500/30' : 'border-neutral-800 hover:border-neutral-700'\n        }`}\n    >\n      {/* Header Button */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <QualityBadge quality={strength.qualityLevel} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {strength.strengthName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n                {strength.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Score + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right\">\n              <div\n                className=\"text-lg sm:text-xl font-semibold tracking-tight\"\n                style={{ color: typeof strength.avgScore === 'string' ? '#a3a3a3' : color }}\n              >\n                {typeof strength.avgScore === 'number' ? strength.avgScore.toFixed(2) : strength.avgScore}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium mt-0.5\">avg /10</div>\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3 }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"border-t border-neutral-800 bg-neutral-800/30 px-4 sm:px-5 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Contributing Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {strength.responsibleRatios.map((ratio, i) => (\n                  <ContributingRatioButton\n                    key={ratio.ratioId}\n                    ratioName={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick(ratio)}\n                    animationDelay={i * 0.05}\n                  />\n                ))}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n\n// ============================================\n// AREA OF IMPROVEMENT CARD (Harmony Style with Your Plan)\n// ============================================\n\ninterface AreaOfImprovementCardProps {\n  flaw: Flaw;\n  isExpanded: boolean;\n  onToggle: () => void;\n  onRatioClick: (ratio: ResponsibleRatio) => void;\n  recommendations?: Recommendation[];\n  animationDelay?: number;\n}\n\nfunction AreaOfImprovementCard({\n  flaw,\n  isExpanded,\n  onToggle,\n  onRatioClick,\n  recommendations = [],\n  animationDelay = 0,\n}: AreaOfImprovementCardProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n\n  // Find matching recommendations for this flaw\n  const matchedRecommendations = useMemo(() => {\n    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n    return recommendations.filter(rec =>\n      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n    ).slice(0, 3);\n  }, [flaw, recommendations]);\n\n  // Map phase names\n  const mapPhase = (phase: string): ProcedurePhase => {\n    if (phase === 'Foundational') return 'Foundational';\n    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n    if (phase === 'Surgical') return 'Surgical';\n    return 'Non-Invasive';\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.3, delay: animationDelay }}\n      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-red-500/30' : 'border-neutral-800 hover:border-neutral-700'\n        }`}\n    >\n      {/* Header Button */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <SeverityBadge severity={severity} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-500\">\n                -{(typeof flaw.harmonyPercentageLost === 'number' && Number.isFinite(flaw.harmonyPercentageLost)\n                  ? flaw.harmonyPercentageLost\n                  : 0\n                ).toFixed(2)}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n              {flaw.rollingHarmonyPercentageLost !== undefined &&\n                typeof flaw.rollingHarmonyPercentageLost === 'number' &&\n                Number.isFinite(flaw.rollingHarmonyPercentageLost) && (\n                  <div className=\"text-[10px] text-neutral-600 font-medium pt-0.5 border-t border-neutral-700 mt-1\">\n                    Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n                  </div>\n                )}\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3 }}\n            className=\"overflow-hidden\"\n          >\n            {/* Affected Ratios Section */}\n            <div className=\"border-t border-neutral-800 bg-neutral-800/30 px-4 sm:px-5 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Affected Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {flaw.responsibleRatios.map((ratio, i) => (\n                  <ContributingRatioButton\n                    key={ratio.ratioId}\n                    ratioName={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick(ratio)}\n                    animationDelay={i * 0.05}\n                  />\n                ))}\n              </div>\n            </div>\n\n            {/* Your Plan Section (if there are matched recommendations) */}\n            {matchedRecommendations.length > 0 && (\n              <div className=\"border-t border-neutral-800 bg-emerald-900/10 px-4 sm:px-5 py-3 sm:py-4\">\n                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n                  <Sparkles className=\"w-3 h-3 text-emerald-400\" />\n                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-400 uppercase tracking-wider\">\n                    Your Plan\n                  </span>\n                </div>\n                <div className=\"space-y-2\">\n                  {matchedRecommendations.map((rec, i) => (\n                    <PlanItem\n                      key={rec.ref_id}\n                      name={rec.name}\n                      phase={mapPhase(rec.phase)}\n                      animationDelay={i * 0.05}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n\n// ============================================\n// KEY STRENGTHS SECTION (Harmony Style)\n// ============================================\n\ninterface KeyStrengthsSectionProps {\n  strengths: Strength[];\n  onRatioClick: (ratio: ResponsibleRatio, categoryName: string) => void;\n  initialShowCount?: number;\n}\n\nexport function KeyStrengthsSection({\n  strengths,\n  onRatioClick,\n  initialShowCount = 3,\n}: KeyStrengthsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const displayedStrengths = showAll ? strengths : strengths.slice(0, initialShowCount);\n  const remainingCount = Math.max(0, strengths.length - initialShowCount);\n\n  // Calculate average strength contribution (handle invalid values)\n  const avgScore = useMemo(() => {\n    if (!strengths || strengths.length === 0) return 0;\n    const validScores = strengths.filter(\n      (s) => typeof s.avgScore === 'number' && Number.isFinite(s.avgScore)\n    );\n    if (validScores.length === 0) return 0;\n    return validScores.reduce((sum, s) => sum + (s.avgScore as number), 0) / validScores.length;\n  }, [strengths]);\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/50 border border-neutral-800 p-4 sm:p-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-4 sm:mb-5\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center\">\n            <Sparkles className=\"w-4 h-4 text-cyan-400\" />\n          </div>\n          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n            Key Strengths\n          </h3>\n        </div>\n        <div className=\"text-right\">\n          <span className=\"text-sm text-neutral-500\">\n            {strengths.length} total\n          </span>\n          {strengths.length > 0 && (\n            <p className=\"text-xs text-green-400 font-medium\">\n              Avg: {avgScore.toFixed(1)}/10\n            </p>\n          )}\n        </div>\n      </div>\n\n      {/* Cards */}\n      <div className=\"space-y-3\">\n        {displayedStrengths.length > 0 ? (\n          displayedStrengths.map((strength, i) => (\n            <KeyStrengthCard\n              key={strength.id}\n              strength={strength}\n              isExpanded={expandedId === strength.id}\n              onToggle={() => setExpandedId(expandedId === strength.id ? null : strength.id)}\n              onRatioClick={(ratio) => onRatioClick(ratio, strength.categoryName)}\n              animationDelay={i * 0.04}\n            />\n          ))\n        ) : (\n          <div className=\"rounded-xl bg-neutral-800/50 border border-neutral-700 p-6 text-center\">\n            <p className=\"text-neutral-500\">No significant strengths detected</p>\n          </div>\n        )}\n      </div>\n\n      {/* Show More Button */}\n      {remainingCount > 0 && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-4 py-3 rounded-lg bg-neutral-800/50 border border-neutral-700 hover:border-neutral-600 hover:bg-neutral-800 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show ${remainingCount} More`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// AREAS OF IMPROVEMENT SECTION (Harmony Style with Your Plan)\n// ============================================\n\ninterface AreasOfImprovementSectionProps {\n  flaws: Flaw[];\n  onRatioClick: (ratio: ResponsibleRatio, categoryName: string) => void;\n  initialShowCount?: number;\n}\n\nexport function AreasOfImprovementSection({\n  flaws,\n  onRatioClick,\n  initialShowCount = 3,\n}: AreasOfImprovementSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  // Get recommendations from context\n  const { recommendations } = useResults();\n\n  const displayedFlaws = showAll ? flaws : flaws.slice(0, initialShowCount);\n  const remainingCount = Math.max(0, flaws.length - initialShowCount);\n\n  // Calculate total impact from all flaws (handle invalid values)\n  const totalImpact = flaws.reduce((sum, f) => {\n    const impact = typeof f.harmonyPercentageLost === 'number' && Number.isFinite(f.harmonyPercentageLost)\n      ? f.harmonyPercentageLost\n      : 0;\n    return sum + impact;\n  }, 0);\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/50 border border-neutral-800 p-4 sm:p-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-4 sm:mb-5\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-8 rounded-lg bg-amber-500/20 flex items-center justify-center\">\n            <AlertTriangle className=\"w-4 h-4 text-amber-400\" />\n          </div>\n          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n            Areas of Improvement\n          </h3>\n        </div>\n        <div className=\"text-right\">\n          <span className=\"text-sm text-neutral-500\">\n            {flaws.length} total\n          </span>\n          {flaws.length > 0 && (\n            <p className=\"text-xs text-red-400 font-medium\">\n              Impact: -{totalImpact.toFixed(1)} pts\n            </p>\n          )}\n        </div>\n      </div>\n\n      {/* Cards */}\n      <div className=\"space-y-3\">\n        {displayedFlaws.length > 0 ? (\n          displayedFlaws.map((flaw, i) => (\n            <AreaOfImprovementCard\n              key={flaw.id}\n              flaw={flaw}\n              isExpanded={expandedId === flaw.id}\n              onToggle={() => setExpandedId(expandedId === flaw.id ? null : flaw.id)}\n              onRatioClick={(ratio) => onRatioClick(ratio, flaw.categoryName)}\n              recommendations={recommendations}\n              animationDelay={i * 0.04}\n            />\n          ))\n        ) : (\n          <div className=\"rounded-xl bg-neutral-800/50 border border-neutral-700 p-6 text-center\">\n            <p className=\"text-neutral-500\">No significant areas for improvement detected</p>\n          </div>\n        )}\n      </div>\n\n      {/* Show More Button */}\n      {remainingCount > 0 && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-4 py-3 rounded-lg bg-neutral-800/50 border border-neutral-700 hover:border-neutral-600 hover:bg-neutral-800 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show ${remainingCount} More`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n","numLines":689,"startLine":1,"totalLines":689}}}
{"parentUuid":"97ec6c1c-e0a5-4630-a13d-70caf6a7bb75","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01GKKNFUcme59bpSC3fyYwDc","type":"message","role":"assistant","content":[{"type":"text","text":"Now I have a complete understanding of the codebase. Let me implement the confidence levels for flaw detection. Here's my implementation plan:\n\n1. Add `ConfidenceLevel` type to `scoring/types.ts`\n2. Add `confidence` field to `Flaw` type in `types/results.ts`\n3. Add confidence calculation function to `insights-engine.ts` based on Z-score magnitude\n4. Update `convertToFlaw` function to include confidence\n5. Create a `ConfidenceBadge` component in `StrengthFlawCards.tsx` and display it\n\nLet me implement this:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":23312,"cache_read_input_tokens":89716,"cache_creation":{"ephemeral_5m_input_tokens":23312,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWVV6A4rBeDeLxkMii9yq","type":"assistant","uuid":"12f7c63d-d2dc-4df0-ae7d-e6e628c2d331","timestamp":"2025-12-26T14:50:24.569Z"}
{"parentUuid":"12f7c63d-d2dc-4df0-ae7d-e6e628c2d331","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01GKKNFUcme59bpSC3fyYwDc","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01DubdaKLh2xsoX5ksDoquDF","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring/types.ts","old_string":"export type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';","new_string":"export type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\n/**\n * Confidence level for flaw/strength detection based on Z-score magnitude\n * - confirmed: |z| >= 2 (high statistical certainty, 2+ standard deviations from mean)\n * - likely: 1 <= |z| < 2 (moderate certainty, 1-2 standard deviations)\n * - possible: 0.5 <= |z| < 1 (low certainty, 0.5-1 standard deviation)\n */\nexport type ConfidenceLevel = 'confirmed' | 'likely' | 'possible';"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":23312,"cache_read_input_tokens":89716,"cache_creation":{"ephemeral_5m_input_tokens":23312,"ephemeral_1h_input_tokens":0},"output_tokens":604,"service_tier":"standard"}},"requestId":"req_011CWVV6A4rBeDeLxkMii9yq","type":"assistant","uuid":"49eb671d-6315-4d21-87f9-ee0f3bf7a220","timestamp":"2025-12-26T14:50:31.901Z"}
{"parentUuid":"49eb671d-6315-4d21-87f9-ee0f3bf7a220","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File has been modified since read, either by the user or by a linter. Read it again before attempting to write it.</tool_use_error>","is_error":true,"tool_use_id":"toolu_01DubdaKLh2xsoX5ksDoquDF"}]},"uuid":"4fbf1c3b-1c42-43ba-b9d6-847f67603040","timestamp":"2025-12-26T14:50:31.926Z","toolUseResult":"Error: File has been modified since read, either by the user or by a linter. Read it again before attempting to write it."}
{"parentUuid":"4fbf1c3b-1c42-43ba-b9d6-847f67603040","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01P5wDWGRxyhzUVo1bi98Dp5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FsiEasaFMj93BJuT67QWQC","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring/types.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":661,"cache_read_input_tokens":113028,"cache_creation":{"ephemeral_5m_input_tokens":661,"ephemeral_1h_input_tokens":0},"output_tokens":81,"service_tier":"standard"}},"requestId":"req_011CWVV7MnpzyW569Z7wG1ya","type":"assistant","uuid":"bf6443c1-9f27-42d6-9f52-6dfe781aed9d","timestamp":"2025-12-26T14:50:34.681Z"}
{"parentUuid":"bf6443c1-9f27-42d6-9f52-6dfe781aed9d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FsiEasaFMj93BJuT67QWQC","type":"tool_result","content":"     1→/**\n     2→ * Scoring System Type Definitions\n     3→ * Extracted from harmony-scoring.ts for better modularity\n     4→ */\n     5→\n     6→// Re-export LandmarkPoint from landmarks module\n     7→export type { LandmarkPoint } from '@/lib/landmarks';\n     8→\n     9→// ============================================\n    10→// CORE TYPES\n    11→// ============================================\n    12→\n    13→export interface Point {\n    14→  x: number;\n    15→  y: number;\n    16→}\n    17→\n    18→export type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\n    19→export type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\n    20→export type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n    21→\n    22→/**\n    23→ * Polarity defines how deviation from the ideal range is interpreted:\n    24→ * - 'balanced': Default. Deviation in either direction is equally bad.\n    25→ * - 'higher_is_better': Values above the ideal are still good. Only values below\n    26→ *   the 'safeFloor' are true weaknesses. E.g., Canthal Tilt (positive tilt is good)\n    27→ * - 'lower_is_better': Values below the ideal are still good. Only values above\n    28→ *   the 'safeCeiling' are true weaknesses. E.g., Philtrum length (shorter is better)\n    29→ */\n    30→export type MetricPolarity = 'balanced' | 'higher_is_better' | 'lower_is_better';\n    31→\n    32→export interface MetricConfig {\n    33→  id: string;\n    34→  name: string;\n    35→  category: string;\n    36→  unit: MeasurementUnit;\n    37→  idealMin: number;\n    38→  idealMax: number;\n    39→  rangeMin: number;\n    40→  rangeMax: number;\n    41→  decayRate: number;\n    42→  maxScore: number;\n    43→  weight: number;\n    44→  description: string;\n    45→  profileType: 'front' | 'side';\n    46→  customCurve?: BezierCurveConfig;\n    47→  /**\n    48→   * Polarity for directional/dimorphic scoring.\n    49→   * Defaults to 'balanced' if not specified.\n    50→   */\n    51→  polarity?: MetricPolarity;\n    52→  /**\n    53→   * For 'higher_is_better': minimum value that's still acceptable.\n    54→   * Values above this but below idealMin get a passing score (softFloorScore).\n    55→   * Values below this are true weaknesses.\n    56→   */\n    57→  safeFloor?: number;\n    58→  /**\n    59→   * For 'lower_is_better': maximum value that's still acceptable.\n    60→   * Values below this but above idealMax get a passing score (softCeilingScore).\n    61→   * Values above this are true weaknesses.\n    62→   */\n    63→  safeCeiling?: number;\n    64→  /**\n    65→   * Score given to values in the \"acceptable but not ideal\" zone.\n    66→   * Defaults to 8.0 (Good). Range: 6.0-9.0\n    67→   */\n    68→  softZoneScore?: number;\n    69→  /**\n    70→   * Facial landmarks used to calculate this metric.\n    71→   * For documentation/debugging purposes - references landmark IDs from landmarks.ts\n    72→   * Front profile landmarks: trichion, left_zygion, right_zygion, menton, etc.\n    73→   * Side profile landmarks: gonionTop, gonionBottom, nasion, pronasale, etc.\n    74→   */\n    75→  usedLandmarks?: string[];\n    76→}\n    77→\n    78→export interface BezierCurveConfig {\n    79→  mode: 'custom' | 'exponential';\n    80→  points: CurvePoint[];\n    81→}\n    82→\n    83→export interface CurvePoint {\n    84→  x: number;\n    85→  y: number;\n    86→  leftHandleX?: number;\n    87→  leftHandleY?: number;\n    88→  rightHandleX?: number;\n    89→  rightHandleY?: number;\n    90→  fixed?: boolean;\n    91→}\n    92→\n    93→export interface MetricScoreResult {\n    94→  metricId: string;\n    95→  name: string;\n    96→  value: number;\n    97→  score: number;  // 0-10 scale\n    98→  standardizedScore: number;\n    99→  qualityTier: QualityTier;\n   100→  severity: SeverityLevel;\n   101→  idealMin: number;\n   102→  idealMax: number;\n   103→  deviation: number;\n   104→  deviationDirection: 'above' | 'below' | 'within';\n   105→  unit: MeasurementUnit;\n   106→  category: string;\n   107→  percentile?: number;\n   108→}\n   109→\n   110→export interface HarmonyAnalysis {\n   111→  overallScore: number;  // 0-10 scale\n   112→  standardizedScore: number;\n   113→  qualityTier: QualityTier;\n   114→  percentile: number;\n   115→  frontScore: number;\n   116→  sideScore: number;\n   117→  categoryScores: Record<string, number>;\n   118→  measurements: MetricScoreResult[];\n   119→  flaws: FlawAssessment[];\n   120→  strengths: StrengthAssessment[];\n   121→}\n   122→\n   123→export interface FlawAssessment {\n   124→  category: string;\n   125→  metricId: string;\n   126→  metricName: string;\n   127→  severity: SeverityLevel;\n   128→  deviation: string;\n   129→  reasoning: string;\n   130→  confidence: 'confirmed' | 'likely' | 'possible';\n   131→}\n   132→\n   133→export interface StrengthAssessment {\n   134→  category: string;\n   135→  metricId: string;\n   136→  metricName: string;\n   137→  qualityTier: QualityTier;\n   138→  value: number;\n   139→  reasoning: string;\n   140→}\n   141→\n   142→// ============================================\n   143→// DEMOGRAPHIC TYPES\n   144→// ============================================\n   145→\n   146→export type Ethnicity =\n   147→  | 'east_asian'\n   148→  | 'south_asian'\n   149→  | 'black'\n   150→  | 'hispanic'\n   151→  | 'middle_eastern'\n   152→  | 'native_american'\n   153→  | 'pacific_islander'\n   154→  | 'white'\n   155→  | 'other';\n   156→\n   157→export type Gender = 'male' | 'female';\n   158→\n   159→export type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n   160→\n   161→export interface DemographicOverride {\n   162→  idealMin: number;\n   163→  idealMax: number;\n   164→}\n   165→\n   166→export interface DemographicOptions {\n   167→  gender?: Gender;\n   168→  ethnicity?: Ethnicity;\n   169→}\n   170→\n   171→// ============================================\n   172→// FLAW MAPPING TYPES\n   173→// ============================================\n   174→\n   175→export interface FlawMapping {\n   176→  category: string;\n   177→  flawName: string;\n   178→  confidence: 'confirmed' | 'likely' | 'possible';\n   179→  reasoning: string;\n   180→}\n   181→\n   182→// ============================================\n   183→// PROFILE RESULT TYPES\n   184→// ============================================\n   185→\n   186→export interface FrontProfileResults {\n   187→  measurements: MetricScoreResult[];\n   188→  overallScore: number;\n   189→  standardizedScore: number;\n   190→  qualityTier: QualityTier;\n   191→  categoryScores: Record<string, number>;\n   192→}\n   193→\n   194→export interface SideProfileResults {\n   195→  measurements: MetricScoreResult[];\n   196→  overallScore: number;\n   197→  standardizedScore: number;\n   198→  qualityTier: QualityTier;\n   199→  categoryScores: Record<string, number>;\n   200→}\n   201→\n   202→// ============================================\n   203→// PSL RATING TYPES\n   204→// ============================================\n   205→\n   206→export interface PSLRating {\n   207→  score: number;\n   208→  tier: string;\n   209→  percentile: number;\n   210→  description: string;\n   211→}\n   212→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"1c572ef4-9c45-457a-81ef-f65f03e8cf05","timestamp":"2025-12-26T14:50:34.754Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring/types.ts","content":"/**\n * Scoring System Type Definitions\n * Extracted from harmony-scoring.ts for better modularity\n */\n\n// Re-export LandmarkPoint from landmarks module\nexport type { LandmarkPoint } from '@/lib/landmarks';\n\n// ============================================\n// CORE TYPES\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\n/**\n * Polarity defines how deviation from the ideal range is interpreted:\n * - 'balanced': Default. Deviation in either direction is equally bad.\n * - 'higher_is_better': Values above the ideal are still good. Only values below\n *   the 'safeFloor' are true weaknesses. E.g., Canthal Tilt (positive tilt is good)\n * - 'lower_is_better': Values below the ideal are still good. Only values above\n *   the 'safeCeiling' are true weaknesses. E.g., Philtrum length (shorter is better)\n */\nexport type MetricPolarity = 'balanced' | 'higher_is_better' | 'lower_is_better';\n\nexport interface MetricConfig {\n  id: string;\n  name: string;\n  category: string;\n  unit: MeasurementUnit;\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  decayRate: number;\n  maxScore: number;\n  weight: number;\n  description: string;\n  profileType: 'front' | 'side';\n  customCurve?: BezierCurveConfig;\n  /**\n   * Polarity for directional/dimorphic scoring.\n   * Defaults to 'balanced' if not specified.\n   */\n  polarity?: MetricPolarity;\n  /**\n   * For 'higher_is_better': minimum value that's still acceptable.\n   * Values above this but below idealMin get a passing score (softFloorScore).\n   * Values below this are true weaknesses.\n   */\n  safeFloor?: number;\n  /**\n   * For 'lower_is_better': maximum value that's still acceptable.\n   * Values below this but above idealMax get a passing score (softCeilingScore).\n   * Values above this are true weaknesses.\n   */\n  safeCeiling?: number;\n  /**\n   * Score given to values in the \"acceptable but not ideal\" zone.\n   * Defaults to 8.0 (Good). Range: 6.0-9.0\n   */\n  softZoneScore?: number;\n  /**\n   * Facial landmarks used to calculate this metric.\n   * For documentation/debugging purposes - references landmark IDs from landmarks.ts\n   * Front profile landmarks: trichion, left_zygion, right_zygion, menton, etc.\n   * Side profile landmarks: gonionTop, gonionBottom, nasion, pronasale, etc.\n   */\n  usedLandmarks?: string[];\n}\n\nexport interface BezierCurveConfig {\n  mode: 'custom' | 'exponential';\n  points: CurvePoint[];\n}\n\nexport interface CurvePoint {\n  x: number;\n  y: number;\n  leftHandleX?: number;\n  leftHandleY?: number;\n  rightHandleX?: number;\n  rightHandleY?: number;\n  fixed?: boolean;\n}\n\nexport interface MetricScoreResult {\n  metricId: string;\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  severity: SeverityLevel;\n  idealMin: number;\n  idealMax: number;\n  deviation: number;\n  deviationDirection: 'above' | 'below' | 'within';\n  unit: MeasurementUnit;\n  category: string;\n  percentile?: number;\n}\n\nexport interface HarmonyAnalysis {\n  overallScore: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  percentile: number;\n  frontScore: number;\n  sideScore: number;\n  categoryScores: Record<string, number>;\n  measurements: MetricScoreResult[];\n  flaws: FlawAssessment[];\n  strengths: StrengthAssessment[];\n}\n\nexport interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n}\n\nexport interface StrengthAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  qualityTier: QualityTier;\n  value: number;\n  reasoning: string;\n}\n\n// ============================================\n// DEMOGRAPHIC TYPES\n// ============================================\n\nexport type Ethnicity =\n  | 'east_asian'\n  | 'south_asian'\n  | 'black'\n  | 'hispanic'\n  | 'middle_eastern'\n  | 'native_american'\n  | 'pacific_islander'\n  | 'white'\n  | 'other';\n\nexport type Gender = 'male' | 'female';\n\nexport type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n\nexport interface DemographicOverride {\n  idealMin: number;\n  idealMax: number;\n}\n\nexport interface DemographicOptions {\n  gender?: Gender;\n  ethnicity?: Ethnicity;\n}\n\n// ============================================\n// FLAW MAPPING TYPES\n// ============================================\n\nexport interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n  reasoning: string;\n}\n\n// ============================================\n// PROFILE RESULT TYPES\n// ============================================\n\nexport interface FrontProfileResults {\n  measurements: MetricScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\nexport interface SideProfileResults {\n  measurements: MetricScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n// ============================================\n// PSL RATING TYPES\n// ============================================\n\nexport interface PSLRating {\n  score: number;\n  tier: string;\n  percentile: number;\n  description: string;\n}\n","numLines":212,"startLine":1,"totalLines":212}}}
{"parentUuid":"1c572ef4-9c45-457a-81ef-f65f03e8cf05","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01F7EX3F6uMMoAoCpxcGM7hU","type":"message","role":"assistant","content":[{"type":"text","text":"I see that `FlawAssessment` already has a `confidence` field defined. Now let me add the `ConfidenceLevel` type and update the existing types to use it consistently:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2697,"cache_read_input_tokens":113689,"cache_creation":{"ephemeral_5m_input_tokens":2697,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVV7a2HXX66KJCqBBZcW","type":"assistant","uuid":"12da8483-d09e-4a5e-8ab1-9521f4387c73","timestamp":"2025-12-26T14:50:40.283Z"}
{"parentUuid":"12da8483-d09e-4a5e-8ab1-9521f4387c73","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01F7EX3F6uMMoAoCpxcGM7hU","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015M3ukTSTCXPdLtMtytpF9c","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring/types.ts","old_string":"export type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';","new_string":"export type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\n/**\n * Confidence level for flaw/strength detection based on Z-score magnitude\n * - confirmed: |z| >= 2 (high statistical certainty, 2+ standard deviations from mean)\n * - likely: 1 <= |z| < 2 (moderate certainty, 1-2 standard deviations)\n * - possible: 0.5 <= |z| < 1 (low certainty, 0.5-1 standard deviation)\n */\nexport type ConfidenceLevel = 'confirmed' | 'likely' | 'possible';"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2697,"cache_read_input_tokens":113689,"cache_creation":{"ephemeral_5m_input_tokens":2697,"ephemeral_1h_input_tokens":0},"output_tokens":503,"service_tier":"standard"}},"requestId":"req_011CWVV7a2HXX66KJCqBBZcW","type":"assistant","uuid":"de68dfd6-a8a9-42c0-8c70-b3ec22af8907","timestamp":"2025-12-26T14:50:47.053Z"}
{"parentUuid":"de68dfd6-a8a9-42c0-8c70-b3ec22af8907","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015M3ukTSTCXPdLtMtytpF9c","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring/types.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n    14→  x: number;\n    15→  y: number;\n    16→}\n    17→\n    18→export type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\n    19→export type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\n    20→export type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n    21→\n    22→/**\n    23→ * Confidence level for flaw/strength detection based on Z-score magnitude\n    24→ * - confirmed: |z| >= 2 (high statistical certainty, 2+ standard deviations from mean)\n    25→ * - likely: 1 <= |z| < 2 (moderate certainty, 1-2 standard deviations)\n    26→ * - possible: 0.5 <= |z| < 1 (low certainty, 0.5-1 standard deviation)\n    27→ */\n    28→export type ConfidenceLevel = 'confirmed' | 'likely' | 'possible';\n    29→\n    30→/**\n    31→ * Polarity defines how deviation from the ideal range is interpreted:\n    32→ * - 'balanced': Default. Deviation in either direction is equally bad."}]},"uuid":"839dde66-76c6-4cd4-80e4-676f0e772586","timestamp":"2025-12-26T14:50:47.114Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring/types.ts","oldString":"export type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';","newString":"export type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\n/**\n * Confidence level for flaw/strength detection based on Z-score magnitude\n * - confirmed: |z| >= 2 (high statistical certainty, 2+ standard deviations from mean)\n * - likely: 1 <= |z| < 2 (moderate certainty, 1-2 standard deviations)\n * - possible: 0.5 <= |z| < 1 (low certainty, 0.5-1 standard deviation)\n */\nexport type ConfidenceLevel = 'confirmed' | 'likely' | 'possible';","originalFile":"/**\n * Scoring System Type Definitions\n * Extracted from harmony-scoring.ts for better modularity\n */\n\n// Re-export LandmarkPoint from landmarks module\nexport type { LandmarkPoint } from '@/lib/landmarks';\n\n// ============================================\n// CORE TYPES\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\n/**\n * Polarity defines how deviation from the ideal range is interpreted:\n * - 'balanced': Default. Deviation in either direction is equally bad.\n * - 'higher_is_better': Values above the ideal are still good. Only values below\n *   the 'safeFloor' are true weaknesses. E.g., Canthal Tilt (positive tilt is good)\n * - 'lower_is_better': Values below the ideal are still good. Only values above\n *   the 'safeCeiling' are true weaknesses. E.g., Philtrum length (shorter is better)\n */\nexport type MetricPolarity = 'balanced' | 'higher_is_better' | 'lower_is_better';\n\nexport interface MetricConfig {\n  id: string;\n  name: string;\n  category: string;\n  unit: MeasurementUnit;\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  decayRate: number;\n  maxScore: number;\n  weight: number;\n  description: string;\n  profileType: 'front' | 'side';\n  customCurve?: BezierCurveConfig;\n  /**\n   * Polarity for directional/dimorphic scoring.\n   * Defaults to 'balanced' if not specified.\n   */\n  polarity?: MetricPolarity;\n  /**\n   * For 'higher_is_better': minimum value that's still acceptable.\n   * Values above this but below idealMin get a passing score (softFloorScore).\n   * Values below this are true weaknesses.\n   */\n  safeFloor?: number;\n  /**\n   * For 'lower_is_better': maximum value that's still acceptable.\n   * Values below this but above idealMax get a passing score (softCeilingScore).\n   * Values above this are true weaknesses.\n   */\n  safeCeiling?: number;\n  /**\n   * Score given to values in the \"acceptable but not ideal\" zone.\n   * Defaults to 8.0 (Good). Range: 6.0-9.0\n   */\n  softZoneScore?: number;\n  /**\n   * Facial landmarks used to calculate this metric.\n   * For documentation/debugging purposes - references landmark IDs from landmarks.ts\n   * Front profile landmarks: trichion, left_zygion, right_zygion, menton, etc.\n   * Side profile landmarks: gonionTop, gonionBottom, nasion, pronasale, etc.\n   */\n  usedLandmarks?: string[];\n}\n\nexport interface BezierCurveConfig {\n  mode: 'custom' | 'exponential';\n  points: CurvePoint[];\n}\n\nexport interface CurvePoint {\n  x: number;\n  y: number;\n  leftHandleX?: number;\n  leftHandleY?: number;\n  rightHandleX?: number;\n  rightHandleY?: number;\n  fixed?: boolean;\n}\n\nexport interface MetricScoreResult {\n  metricId: string;\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  severity: SeverityLevel;\n  idealMin: number;\n  idealMax: number;\n  deviation: number;\n  deviationDirection: 'above' | 'below' | 'within';\n  unit: MeasurementUnit;\n  category: string;\n  percentile?: number;\n}\n\nexport interface HarmonyAnalysis {\n  overallScore: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  percentile: number;\n  frontScore: number;\n  sideScore: number;\n  categoryScores: Record<string, number>;\n  measurements: MetricScoreResult[];\n  flaws: FlawAssessment[];\n  strengths: StrengthAssessment[];\n}\n\nexport interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n}\n\nexport interface StrengthAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  qualityTier: QualityTier;\n  value: number;\n  reasoning: string;\n}\n\n// ============================================\n// DEMOGRAPHIC TYPES\n// ============================================\n\nexport type Ethnicity =\n  | 'east_asian'\n  | 'south_asian'\n  | 'black'\n  | 'hispanic'\n  | 'middle_eastern'\n  | 'native_american'\n  | 'pacific_islander'\n  | 'white'\n  | 'other';\n\nexport type Gender = 'male' | 'female';\n\nexport type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n\nexport interface DemographicOverride {\n  idealMin: number;\n  idealMax: number;\n}\n\nexport interface DemographicOptions {\n  gender?: Gender;\n  ethnicity?: Ethnicity;\n}\n\n// ============================================\n// FLAW MAPPING TYPES\n// ============================================\n\nexport interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n  reasoning: string;\n}\n\n// ============================================\n// PROFILE RESULT TYPES\n// ============================================\n\nexport interface FrontProfileResults {\n  measurements: MetricScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\nexport interface SideProfileResults {\n  measurements: MetricScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n// ============================================\n// PSL RATING TYPES\n// ============================================\n\nexport interface PSLRating {\n  score: number;\n  tier: string;\n  percentile: number;\n  description: string;\n}\n","structuredPatch":[{"oldStart":20,"oldLines":6,"newStart":20,"newLines":14,"lines":[" export type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';"," "," /**","+ * Confidence level for flaw/strength detection based on Z-score magnitude","+ * - confirmed: |z| >= 2 (high statistical certainty, 2+ standard deviations from mean)","+ * - likely: 1 <= |z| < 2 (moderate certainty, 1-2 standard deviations)","+ * - possible: 0.5 <= |z| < 1 (low certainty, 0.5-1 standard deviation)","+ */","+export type ConfidenceLevel = 'confirmed' | 'likely' | 'possible';","+","+/**","  * Polarity defines how deviation from the ideal range is interpreted:","  * - 'balanced': Default. Deviation in either direction is equally bad.","  * - 'higher_is_better': Values above the ideal are still good. Only values below"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"839dde66-76c6-4cd4-80e4-676f0e772586","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01DRyDgxjNx9HBBN2x2LQxnx","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me update the `FlawAssessment` and `FlawMapping` types to use the new `ConfidenceLevel` type:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":922,"cache_read_input_tokens":116386,"cache_creation":{"ephemeral_5m_input_tokens":922,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWVV8UnnYC8et56z8GZXe","type":"assistant","uuid":"2b345a64-db3c-492a-8024-7b82e05f2e05","timestamp":"2025-12-26T14:50:49.757Z"}
{"parentUuid":"2b345a64-db3c-492a-8024-7b82e05f2e05","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01DRyDgxjNx9HBBN2x2LQxnx","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GGk69yXs2MAc8zbnDuxahy","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring/types.ts","old_string":"export interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n}","new_string":"export interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: ConfidenceLevel;\n}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":922,"cache_read_input_tokens":116386,"cache_creation":{"ephemeral_5m_input_tokens":922,"ephemeral_1h_input_tokens":0},"output_tokens":282,"service_tier":"standard"}},"requestId":"req_011CWVV8UnnYC8et56z8GZXe","type":"assistant","uuid":"658f7a7a-586a-4cfd-b7dd-9f3bbbb1d74e","timestamp":"2025-12-26T14:50:52.724Z"}
{"parentUuid":"658f7a7a-586a-4cfd-b7dd-9f3bbbb1d74e","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GGk69yXs2MAc8zbnDuxahy","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring/types.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   127→  flaws: FlawAssessment[];\n   128→  strengths: StrengthAssessment[];\n   129→}\n   130→\n   131→export interface FlawAssessment {\n   132→  category: string;\n   133→  metricId: string;\n   134→  metricName: string;\n   135→  severity: SeverityLevel;\n   136→  deviation: string;\n   137→  reasoning: string;\n   138→  confidence: ConfidenceLevel;\n   139→}\n   140→\n   141→export interface StrengthAssessment {\n   142→  category: string;\n   143→  metricId: string;"}]},"uuid":"0e18154e-8c13-49ce-ab19-e9c6c576c6c9","timestamp":"2025-12-26T14:50:52.791Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring/types.ts","oldString":"export interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n}","newString":"export interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: ConfidenceLevel;\n}","originalFile":"/**\n * Scoring System Type Definitions\n * Extracted from harmony-scoring.ts for better modularity\n */\n\n// Re-export LandmarkPoint from landmarks module\nexport type { LandmarkPoint } from '@/lib/landmarks';\n\n// ============================================\n// CORE TYPES\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\n/**\n * Confidence level for flaw/strength detection based on Z-score magnitude\n * - confirmed: |z| >= 2 (high statistical certainty, 2+ standard deviations from mean)\n * - likely: 1 <= |z| < 2 (moderate certainty, 1-2 standard deviations)\n * - possible: 0.5 <= |z| < 1 (low certainty, 0.5-1 standard deviation)\n */\nexport type ConfidenceLevel = 'confirmed' | 'likely' | 'possible';\n\n/**\n * Polarity defines how deviation from the ideal range is interpreted:\n * - 'balanced': Default. Deviation in either direction is equally bad.\n * - 'higher_is_better': Values above the ideal are still good. Only values below\n *   the 'safeFloor' are true weaknesses. E.g., Canthal Tilt (positive tilt is good)\n * - 'lower_is_better': Values below the ideal are still good. Only values above\n *   the 'safeCeiling' are true weaknesses. E.g., Philtrum length (shorter is better)\n */\nexport type MetricPolarity = 'balanced' | 'higher_is_better' | 'lower_is_better';\n\nexport interface MetricConfig {\n  id: string;\n  name: string;\n  category: string;\n  unit: MeasurementUnit;\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  decayRate: number;\n  maxScore: number;\n  weight: number;\n  description: string;\n  profileType: 'front' | 'side';\n  customCurve?: BezierCurveConfig;\n  /**\n   * Polarity for directional/dimorphic scoring.\n   * Defaults to 'balanced' if not specified.\n   */\n  polarity?: MetricPolarity;\n  /**\n   * For 'higher_is_better': minimum value that's still acceptable.\n   * Values above this but below idealMin get a passing score (softFloorScore).\n   * Values below this are true weaknesses.\n   */\n  safeFloor?: number;\n  /**\n   * For 'lower_is_better': maximum value that's still acceptable.\n   * Values below this but above idealMax get a passing score (softCeilingScore).\n   * Values above this are true weaknesses.\n   */\n  safeCeiling?: number;\n  /**\n   * Score given to values in the \"acceptable but not ideal\" zone.\n   * Defaults to 8.0 (Good). Range: 6.0-9.0\n   */\n  softZoneScore?: number;\n  /**\n   * Facial landmarks used to calculate this metric.\n   * For documentation/debugging purposes - references landmark IDs from landmarks.ts\n   * Front profile landmarks: trichion, left_zygion, right_zygion, menton, etc.\n   * Side profile landmarks: gonionTop, gonionBottom, nasion, pronasale, etc.\n   */\n  usedLandmarks?: string[];\n}\n\nexport interface BezierCurveConfig {\n  mode: 'custom' | 'exponential';\n  points: CurvePoint[];\n}\n\nexport interface CurvePoint {\n  x: number;\n  y: number;\n  leftHandleX?: number;\n  leftHandleY?: number;\n  rightHandleX?: number;\n  rightHandleY?: number;\n  fixed?: boolean;\n}\n\nexport interface MetricScoreResult {\n  metricId: string;\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  severity: SeverityLevel;\n  idealMin: number;\n  idealMax: number;\n  deviation: number;\n  deviationDirection: 'above' | 'below' | 'within';\n  unit: MeasurementUnit;\n  category: string;\n  percentile?: number;\n}\n\nexport interface HarmonyAnalysis {\n  overallScore: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  percentile: number;\n  frontScore: number;\n  sideScore: number;\n  categoryScores: Record<string, number>;\n  measurements: MetricScoreResult[];\n  flaws: FlawAssessment[];\n  strengths: StrengthAssessment[];\n}\n\nexport interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n}\n\nexport interface StrengthAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  qualityTier: QualityTier;\n  value: number;\n  reasoning: string;\n}\n\n// ============================================\n// DEMOGRAPHIC TYPES\n// ============================================\n\nexport type Ethnicity =\n  | 'east_asian'\n  | 'south_asian'\n  | 'black'\n  | 'hispanic'\n  | 'middle_eastern'\n  | 'native_american'\n  | 'pacific_islander'\n  | 'white'\n  | 'other';\n\nexport type Gender = 'male' | 'female';\n\nexport type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n\nexport interface DemographicOverride {\n  idealMin: number;\n  idealMax: number;\n}\n\nexport interface DemographicOptions {\n  gender?: Gender;\n  ethnicity?: Ethnicity;\n}\n\n// ============================================\n// FLAW MAPPING TYPES\n// ============================================\n\nexport interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n  reasoning: string;\n}\n\n// ============================================\n// PROFILE RESULT TYPES\n// ============================================\n\nexport interface FrontProfileResults {\n  measurements: MetricScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\nexport interface SideProfileResults {\n  measurements: MetricScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n// ============================================\n// PSL RATING TYPES\n// ============================================\n\nexport interface PSLRating {\n  score: number;\n  tier: string;\n  percentile: number;\n  description: string;\n}\n","structuredPatch":[{"oldStart":135,"oldLines":7,"newStart":135,"newLines":7,"lines":["   severity: SeverityLevel;","   deviation: string;","   reasoning: string;","-  confidence: 'confirmed' | 'likely' | 'possible';","+  confidence: ConfidenceLevel;"," }"," "," export interface StrengthAssessment {"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"0e18154e-8c13-49ce-ab19-e9c6c576c6c9","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01R5MzyMY9Bbn6uuiMMVMZe3","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GVGZasu2X9nRK38VjMi1uV","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring/types.ts","old_string":"export interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n  reasoning: string;\n}","new_string":"export interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: ConfidenceLevel;\n  reasoning: string;\n}"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":619,"cache_read_input_tokens":117308,"cache_creation":{"ephemeral_5m_input_tokens":619,"ephemeral_1h_input_tokens":0},"output_tokens":199,"service_tier":"standard"}},"requestId":"req_011CWVV8u536yYnvPfNVYMSg","type":"assistant","uuid":"5ee9d1bb-7cb0-4f2f-a431-54fe5d3a1e62","timestamp":"2025-12-26T14:50:58.404Z"}
{"parentUuid":"5ee9d1bb-7cb0-4f2f-a431-54fe5d3a1e62","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GVGZasu2X9nRK38VjMi1uV","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring/types.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   179→// ============================================\n   180→// FLAW MAPPING TYPES\n   181→// ============================================\n   182→\n   183→export interface FlawMapping {\n   184→  category: string;\n   185→  flawName: string;\n   186→  confidence: ConfidenceLevel;\n   187→  reasoning: string;\n   188→}\n   189→\n   190→// ============================================\n   191→// PROFILE RESULT TYPES\n   192→// ============================================"}]},"uuid":"e5fb7cff-6b49-4485-a1f7-e574f5567e5e","timestamp":"2025-12-26T14:50:58.458Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring/types.ts","oldString":"export interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n  reasoning: string;\n}","newString":"export interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: ConfidenceLevel;\n  reasoning: string;\n}","originalFile":"/**\n * Scoring System Type Definitions\n * Extracted from harmony-scoring.ts for better modularity\n */\n\n// Re-export LandmarkPoint from landmarks module\nexport type { LandmarkPoint } from '@/lib/landmarks';\n\n// ============================================\n// CORE TYPES\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\n/**\n * Confidence level for flaw/strength detection based on Z-score magnitude\n * - confirmed: |z| >= 2 (high statistical certainty, 2+ standard deviations from mean)\n * - likely: 1 <= |z| < 2 (moderate certainty, 1-2 standard deviations)\n * - possible: 0.5 <= |z| < 1 (low certainty, 0.5-1 standard deviation)\n */\nexport type ConfidenceLevel = 'confirmed' | 'likely' | 'possible';\n\n/**\n * Polarity defines how deviation from the ideal range is interpreted:\n * - 'balanced': Default. Deviation in either direction is equally bad.\n * - 'higher_is_better': Values above the ideal are still good. Only values below\n *   the 'safeFloor' are true weaknesses. E.g., Canthal Tilt (positive tilt is good)\n * - 'lower_is_better': Values below the ideal are still good. Only values above\n *   the 'safeCeiling' are true weaknesses. E.g., Philtrum length (shorter is better)\n */\nexport type MetricPolarity = 'balanced' | 'higher_is_better' | 'lower_is_better';\n\nexport interface MetricConfig {\n  id: string;\n  name: string;\n  category: string;\n  unit: MeasurementUnit;\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  decayRate: number;\n  maxScore: number;\n  weight: number;\n  description: string;\n  profileType: 'front' | 'side';\n  customCurve?: BezierCurveConfig;\n  /**\n   * Polarity for directional/dimorphic scoring.\n   * Defaults to 'balanced' if not specified.\n   */\n  polarity?: MetricPolarity;\n  /**\n   * For 'higher_is_better': minimum value that's still acceptable.\n   * Values above this but below idealMin get a passing score (softFloorScore).\n   * Values below this are true weaknesses.\n   */\n  safeFloor?: number;\n  /**\n   * For 'lower_is_better': maximum value that's still acceptable.\n   * Values below this but above idealMax get a passing score (softCeilingScore).\n   * Values above this are true weaknesses.\n   */\n  safeCeiling?: number;\n  /**\n   * Score given to values in the \"acceptable but not ideal\" zone.\n   * Defaults to 8.0 (Good). Range: 6.0-9.0\n   */\n  softZoneScore?: number;\n  /**\n   * Facial landmarks used to calculate this metric.\n   * For documentation/debugging purposes - references landmark IDs from landmarks.ts\n   * Front profile landmarks: trichion, left_zygion, right_zygion, menton, etc.\n   * Side profile landmarks: gonionTop, gonionBottom, nasion, pronasale, etc.\n   */\n  usedLandmarks?: string[];\n}\n\nexport interface BezierCurveConfig {\n  mode: 'custom' | 'exponential';\n  points: CurvePoint[];\n}\n\nexport interface CurvePoint {\n  x: number;\n  y: number;\n  leftHandleX?: number;\n  leftHandleY?: number;\n  rightHandleX?: number;\n  rightHandleY?: number;\n  fixed?: boolean;\n}\n\nexport interface MetricScoreResult {\n  metricId: string;\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  severity: SeverityLevel;\n  idealMin: number;\n  idealMax: number;\n  deviation: number;\n  deviationDirection: 'above' | 'below' | 'within';\n  unit: MeasurementUnit;\n  category: string;\n  percentile?: number;\n}\n\nexport interface HarmonyAnalysis {\n  overallScore: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  percentile: number;\n  frontScore: number;\n  sideScore: number;\n  categoryScores: Record<string, number>;\n  measurements: MetricScoreResult[];\n  flaws: FlawAssessment[];\n  strengths: StrengthAssessment[];\n}\n\nexport interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: ConfidenceLevel;\n}\n\nexport interface StrengthAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  qualityTier: QualityTier;\n  value: number;\n  reasoning: string;\n}\n\n// ============================================\n// DEMOGRAPHIC TYPES\n// ============================================\n\nexport type Ethnicity =\n  | 'east_asian'\n  | 'south_asian'\n  | 'black'\n  | 'hispanic'\n  | 'middle_eastern'\n  | 'native_american'\n  | 'pacific_islander'\n  | 'white'\n  | 'other';\n\nexport type Gender = 'male' | 'female';\n\nexport type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n\nexport interface DemographicOverride {\n  idealMin: number;\n  idealMax: number;\n}\n\nexport interface DemographicOptions {\n  gender?: Gender;\n  ethnicity?: Ethnicity;\n}\n\n// ============================================\n// FLAW MAPPING TYPES\n// ============================================\n\nexport interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n  reasoning: string;\n}\n\n// ============================================\n// PROFILE RESULT TYPES\n// ============================================\n\nexport interface FrontProfileResults {\n  measurements: MetricScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\nexport interface SideProfileResults {\n  measurements: MetricScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n// ============================================\n// PSL RATING TYPES\n// ============================================\n\nexport interface PSLRating {\n  score: number;\n  tier: string;\n  percentile: number;\n  description: string;\n}\n","structuredPatch":[{"oldStart":183,"oldLines":7,"newStart":183,"newLines":7,"lines":[" export interface FlawMapping {","   category: string;","   flawName: string;","-  confidence: 'confirmed' | 'likely' | 'possible';","+  confidence: ConfidenceLevel;","   reasoning: string;"," }"," "]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"e5fb7cff-6b49-4485-a1f7-e574f5567e5e","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01QHdCWfAhYFuexWecCpnizH","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me update the `Flaw` type in `types/results.ts` to add the confidence field:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":385,"cache_read_input_tokens":117927,"cache_creation":{"ephemeral_5m_input_tokens":385,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVV9KRWDf5pU4EQcvJtm","type":"assistant","uuid":"0d477931-867c-4f38-baf9-b7044ec0c223","timestamp":"2025-12-26T14:51:04.240Z"}
{"parentUuid":"0d477931-867c-4f38-baf9-b7044ec0c223","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01QHdCWfAhYFuexWecCpnizH","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BhvBdMjePGxRV2tk6ZZbQK","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/types/results.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":385,"cache_read_input_tokens":117927,"cache_creation":{"ephemeral_5m_input_tokens":385,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVV9KRWDf5pU4EQcvJtm","type":"assistant","uuid":"b47dc77c-f8e6-4c03-a49d-539b966b022b","timestamp":"2025-12-26T14:51:05.238Z"}
{"parentUuid":"b47dc77c-f8e6-4c03-a49d-539b966b022b","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BhvBdMjePGxRV2tk6ZZbQK","type":"tool_result","content":"     1→/**\n     2→ * Harmony-Style Results Page Types\n     3→ * Complete type definitions for the results UI\n     4→ */\n     5→\n     6→import { QualityTier, SeverityLevel, MeasurementUnit } from '@/lib/harmony-scoring';\n     7→\n     8→// ============================================\n     9→// ILLUSTRATION TYPES\n    10→// ============================================\n    11→\n    12→export interface IllustrationPoint {\n    13→  type: 'landmark' | 'calculated';\n    14→  landmarkId?: string;\n    15→  x?: number;\n    16→  y?: number;\n    17→  label?: string;\n    18→}\n    19→\n    20→export interface IllustrationLine {\n    21→  from: string;\n    22→  to: string;\n    23→  color: string;\n    24→  style?: 'solid' | 'dashed';\n    25→  label?: string;\n    26→  labelColor?: string;\n    27→  labelPosition?: 'start' | 'middle' | 'end';\n    28→}\n    29→\n    30→export interface RatioIllustration {\n    31→  points: Record<string, IllustrationPoint>;\n    32→  lines: Record<string, IllustrationLine>;\n    33→}\n    34→\n    35→// ============================================\n    36→// RATIO/MEASUREMENT TYPES\n    37→// ============================================\n    38→\n    39→export interface Ratio {\n    40→  id: string;\n    41→  name: string;\n    42→  value: number | string;\n    43→  score: number | string;  // 0-10 scale or Greek text\n    44→  standardizedScore: number | string;\n    45→  unit: 'x' | 'mm' | '%' | '°';\n    46→  idealMin: number;\n    47→  idealMax: number;\n    48→  rangeMin: number;\n    49→  rangeMax: number;\n    50→  description: string;\n    51→  category: string;\n    52→  qualityLevel: QualityTier;\n    53→  severity: SeverityLevel;\n    54→  illustration: RatioIllustration;\n    55→  mayIndicateFlaws: string[];\n    56→  mayIndicateStrengths: string[];\n    57→  usedLandmarks: string[];\n    58→  scoringCurveConfig?: {\n    59→    decayRate: number;\n    60→    maxScore: number;\n    61→  };\n    62→  // Harmony Taxonomy classification\n    63→  taxonomyPrimary?: string;    // 'harmony' | 'dimorphism' | 'angularity' | 'features'\n    64→  taxonomySecondary?: string;  // Subcategory ID\n    65→}\n    66→\n    67→// ============================================\n    68→// STRENGTH/FLAW TYPES\n    69→// ============================================\n    70→\n    71→export interface ResponsibleRatio {\n    72→  ratioName: string;\n    73→  ratioId: string;\n    74→  score: number | string;\n    75→  value: number | string;\n    76→  isObfuscated?: boolean;\n    77→  // Additional properties for AI descriptions\n    78→  idealMin: number;\n    79→  idealMax: number;\n    80→  unit: string;\n    81→  category?: string;\n    82→}\n    83→\n    84→export interface Strength {\n    85→  id: string;\n    86→  strengthName: string;\n    87→  summary: string;\n    88→  avgScore: number | string;\n    89→  qualityLevel: QualityTier;\n    90→  categoryName: string;\n    91→  responsibleRatios: ResponsibleRatio[];\n    92→}\n    93→\n    94→export interface Flaw {\n    95→  id: string;\n    96→  flawName: string;\n    97→  summary: string;\n    98→  harmonyPercentageLost: number;\n    99→  standardizedImpact: number;\n   100→  categoryName: string;\n   101→  isOther?: boolean;\n   102→  responsibleRatios: ResponsibleRatio[];\n   103→  rollingPointsDeducted?: number;\n   104→  rollingHarmonyPercentageLost?: number;\n   105→  rollingStandardizedImpact?: number;\n   106→}\n   107→\n   108→// ============================================\n   109→// RECOMMENDATION TYPES\n   110→// ============================================\n   111→\n   112→export type RecommendationPhase = 'Surgical' | 'Minimally Invasive' | 'Foundational';\n   113→\n   114→export interface RecommendationTimeline {\n   115→  effect_start: 'immediate' | 'delayed' | 'gradual';\n   116→  full_results_weeks: number;\n   117→  full_results_weeks_max?: number;\n   118→}\n   119→\n   120→export interface RecommendationCost {\n   121→  type: 'flat' | 'per_month' | 'per_session';\n   122→  min: number;\n   123→  max: number;\n   124→  currency: string;\n   125→}\n   126→\n   127→export interface RatioImpact {\n   128→  ratioId: string;\n   129→  ratioName: string;\n   130→  direction: 'increase' | 'decrease' | 'both';\n   131→  percentageEffect: number;\n   132→}\n   133→\n   134→export interface Recommendation {\n   135→  ref_id: string;\n   136→  name: string;\n   137→  description: string;\n   138→  phase: RecommendationPhase;\n   139→  impact: number;  // 0-1 effectiveness score\n   140→  coverage: number;  // Number of metrics improved\n   141→  percentage: string;  // e.g., \"10-20%\"\n   142→  expectedImprovementRange?: { min: number; max: number };\n   143→  matchedFlaws: string[];\n   144→  matchedRatios: string[];\n   145→  ratios_impacted: RatioImpact[];\n   146→  timeline: RecommendationTimeline;\n   147→  cost: RecommendationCost;\n   148→  risks_side_effects: string | null;\n   149→  warnings: string[];\n   150→  gender: 'male' | 'female' | 'both';\n   151→}\n   152→\n   153→// ============================================\n   154→// HARMONY ANALYSIS TYPES\n   155→// ============================================\n   156→\n   157→export interface ProfileAnalysis {\n   158→  standardizedScore: number;\n   159→  ratios: Ratio[];\n   160→  overallAIDescription?: string | null;\n   161→}\n   162→\n   163→export interface FullHarmonyAnalysis {\n   164→  standardizedScore: number;\n   165→  front: ProfileAnalysis;\n   166→  side: ProfileAnalysis;\n   167→  strengths: Strength[];\n   168→  flaws: Flaw[];\n   169→}\n   170→\n   171→// ============================================\n   172→// FACE DATA TYPES\n   173→// ============================================\n   174→\n   175→export interface FaceData {\n   176→  id: string;\n   177→  userId?: string;\n   178→  frontPhotoUrl: string;\n   179→  sidePhotoUrl?: string;\n   180→  harmonyScore: number | null;\n   181→  frontHarmonyScore: number | null;\n   182→  sideHarmonyScore: number | null;\n   183→  gender: 'male' | 'female';\n   184→  race?: string;\n   185→  unlocked: boolean;\n   186→  actionPlanUnlocked: boolean;\n   187→  harmonyAnalysis: FullHarmonyAnalysis;\n   188→}\n   189→\n   190→// ============================================\n   191→// UI STATE TYPES\n   192→// ============================================\n   193→\n   194→export type ResultsTab =\n   195→  | 'overview'\n   196→  | 'front-ratios'\n   197→  | 'side-ratios'\n   198→  | 'leaderboard'\n   199→  | 'psl'\n   200→  | 'archetype'\n   201→  | 'plan'\n   202→  | 'guides'\n   203→  | 'community'\n   204→  | 'referrals'\n   205→  | 'options'\n   206→  | 'support';\n   207→\n   208→// ============================================\n   209→// LEADERBOARD TYPES\n   210→// ============================================\n   211→\n   212→export interface UserRank {\n   213→  userId: string;\n   214→  score: number;\n   215→  globalRank: number;\n   216→  genderRank: number;\n   217→  percentile: number;\n   218→  totalUsers: number;\n   219→  genderTotal: number;\n   220→  anonymousName: string;\n   221→  updatedAt: string;\n   222→}\n   223→\n   224→export interface LeaderboardEntry {\n   225→  userId: string;\n   226→  rank: number;\n   227→  score: number;\n   228→  anonymousName: string;\n   229→  gender: 'male' | 'female';\n   230→  facePhotoUrl: string | null;\n   231→  isCurrentUser: boolean;\n   232→  topStrengths: string[];\n   233→  topImprovements: string[];\n   234→}\n   235→\n   236→export interface UserProfile extends Omit<LeaderboardEntry, 'isCurrentUser'> {\n   237→  topStrengths: string[];\n   238→  topImprovements: string[];\n   239→}\n   240→\n   241→export interface LeaderboardData {\n   242→  entries: LeaderboardEntry[];\n   243→  totalCount: number;\n   244→  userRank: UserRank | null;\n   245→}\n   246→\n   247→export interface ResultsUIState {\n   248→  activeTab: ResultsTab;\n   249→  expandedMeasurementId: string | null;\n   250→  selectedVisualizationMetric: string | null;\n   251→  categoryFilter: string | null;\n   252→  showLandmarkOverlay: boolean;\n   253→}\n   254→\n   255→// ============================================\n   256→// CATEGORY TYPES\n   257→// ============================================\n   258→\n   259→export interface MeasurementCategory {\n   260→  id: string;\n   261→  name: string;\n   262→  color: string;\n   263→  description: string;\n   264→}\n   265→\n   266→export const MEASUREMENT_CATEGORIES: MeasurementCategory[] = [\n   267→  { id: 'midface', name: 'Midface/Face Shape', color: '#67e8f9', description: 'Facial proportions and overall shape' },\n   268→  { id: 'jaw-growth', name: 'Occlusion/Jaw Growth', color: '#a78bfa', description: 'Jaw development and bite alignment' },\n   269→  { id: 'jaw-shape', name: 'Jaw Shape', color: '#f97316', description: 'Jawline contour and angles' },\n   270→  { id: 'upper-third', name: 'Upper Third', color: '#84cc16', description: 'Forehead and hairline proportions' },\n   271→  { id: 'eyes', name: 'Eyes', color: '#06b6d4', description: 'Eye shape, spacing, and canthal tilt' },\n   272→  { id: 'nose', name: 'Nose', color: '#fbbf24', description: 'Nasal proportions and angles' },\n   273→  { id: 'lips', name: 'Lips', color: '#ec4899', description: 'Lip proportions and projection' },\n   274→  { id: 'chin', name: 'Chin', color: '#ef4444', description: 'Chin projection and shape' },\n   275→  { id: 'neck', name: 'Neck', color: '#14b8a6', description: 'Neck angle and throat definition' },\n   276→  { id: 'other', name: 'Other', color: '#6b7280', description: 'Additional measurements' },\n   277→];\n   278→\n   279→// ============================================\n   280→// SCORE COLOR HELPERS\n   281→// ============================================\n   282→\n   283→export function getScoreColor(score: number): string {\n   284→  if (score >= 8) return '#67e8f9';  // Cyan - ideal\n   285→  if (score >= 6) return '#22c55e';  // Green - good\n   286→  if (score >= 4) return '#fbbf24';  // Yellow - fair\n   287→  return 'rgb(227, 67, 67)';         // Red - poor\n   288→}\n   289→\n   290→export function getQualityColor(quality: QualityTier): string {\n   291→  switch (quality) {\n   292→    case 'ideal': return '#67e8f9';\n   293→    case 'excellent': return '#22c55e';\n   294→    case 'good': return '#fbbf24';\n   295→    case 'below_average': return 'rgb(227, 67, 67)';\n   296→    default: return '#6b7280';\n   297→  }\n   298→}\n   299→\n   300→export function getSeverityColor(severity: SeverityLevel): string {\n   301→  switch (severity) {\n   302→    case 'optimal': return '#67e8f9';\n   303→    case 'minor': return '#22c55e';\n   304→    case 'moderate': return '#fbbf24';\n   305→    case 'major': return '#f97316';\n   306→    case 'severe': return '#ef4444';\n   307→    case 'extremely_severe': return '#dc2626';\n   308→    default: return '#6b7280';\n   309→  }\n   310→}\n   311→\n   312→export function getCategoryColor(categoryName: string): string {\n   313→  const cat = MEASUREMENT_CATEGORIES.find(c =>\n   314→    c.name.toLowerCase().includes(categoryName.toLowerCase()) ||\n   315→    categoryName.toLowerCase().includes(c.name.toLowerCase())\n   316→  );\n   317→  return cat?.color || '#6b7280';\n   318→}\n   319→\n   320→// ============================================\n   321→// UNIT FORMATTING\n   322→// ============================================\n   323→\n   324→export function formatUnit(unit: 'x' | 'mm' | '%' | '°' | MeasurementUnit): string {\n   325→  switch (unit) {\n   326→    case 'x':\n   327→    case 'ratio': return 'x';\n   328→    case 'mm': return 'mm';\n   329→    case '%':\n   330→    case 'percent': return '%';\n   331→    case '°':\n   332→    case 'degrees': return '°';\n   333→    default: return '';\n   334→  }\n   335→}\n   336→\n   337→export function formatValue(value: number | string, unit: 'x' | 'mm' | '%' | '°' | MeasurementUnit): string {\n   338→  // Handle obfuscated string values\n   339→  if (typeof value === 'string') {\n   340→    return value;\n   341→  }\n   342→  const unitStr = formatUnit(unit);\n   343→  if (unit === '%' || unit === 'percent') {\n   344→    return `${value.toFixed(1)}${unitStr}`;\n   345→  }\n   346→  if (unit === '°' || unit === 'degrees') {\n   347→    return `${value.toFixed(1)}${unitStr}`;\n   348→  }\n   349→  return `${value.toFixed(2)}${unitStr}`;\n   350→}\n   351→\n   352→// ============================================\n   353→// PRODUCT & SUPPLEMENT TYPES\n   354→// ============================================\n   355→\n   356→export interface Product {\n   357→  id: string;\n   358→  name: string;\n   359→  brand: string;\n   360→  category: \"skin\" | \"hair\" | \"anti-aging\" | \"hormonal\" | \"bone\" | \"general\" | \"jawline\" | \"tools\" | \"dental\";\n   361→  affiliateLink: string;\n   362→  affiliateType: \"amazon\" | \"direct\";\n   363→  supplementId: string;\n   364→  priority: number;\n   365→  baseStackItem?: boolean;\n   366→  description?: string;\n   367→}\n   368→\n   369→export interface ProductRecommendation {\n   370→  product: Product;\n   371→  state: \"flaw\" | \"ideal\";\n   372→  targetMetric: string;\n   373→  message: string;\n   374→  urgency: \"high\" | \"medium\" | \"low\";\n   375→  matchedMetrics: string[];\n   376→}\n   377→\n   378→export interface DailyStack {\n   379→  products: Product[];\n   380→  totalCostPerMonth: { min: number; max: number };\n   381→  timing: {\n   382→    morning: Product[];\n   383→    evening: Product[];\n   384→    anytime: Product[];\n   385→  };\n   386→  rationale: string;\n   387→}\n   388→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"8dbb2049-0853-484b-b9e9-85a2b2b52b22","timestamp":"2025-12-26T14:51:05.393Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/types/results.ts","content":"/**\n * Harmony-Style Results Page Types\n * Complete type definitions for the results UI\n */\n\nimport { QualityTier, SeverityLevel, MeasurementUnit } from '@/lib/harmony-scoring';\n\n// ============================================\n// ILLUSTRATION TYPES\n// ============================================\n\nexport interface IllustrationPoint {\n  type: 'landmark' | 'calculated';\n  landmarkId?: string;\n  x?: number;\n  y?: number;\n  label?: string;\n}\n\nexport interface IllustrationLine {\n  from: string;\n  to: string;\n  color: string;\n  style?: 'solid' | 'dashed';\n  label?: string;\n  labelColor?: string;\n  labelPosition?: 'start' | 'middle' | 'end';\n}\n\nexport interface RatioIllustration {\n  points: Record<string, IllustrationPoint>;\n  lines: Record<string, IllustrationLine>;\n}\n\n// ============================================\n// RATIO/MEASUREMENT TYPES\n// ============================================\n\nexport interface Ratio {\n  id: string;\n  name: string;\n  value: number | string;\n  score: number | string;  // 0-10 scale or Greek text\n  standardizedScore: number | string;\n  unit: 'x' | 'mm' | '%' | '°';\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  description: string;\n  category: string;\n  qualityLevel: QualityTier;\n  severity: SeverityLevel;\n  illustration: RatioIllustration;\n  mayIndicateFlaws: string[];\n  mayIndicateStrengths: string[];\n  usedLandmarks: string[];\n  scoringCurveConfig?: {\n    decayRate: number;\n    maxScore: number;\n  };\n  // Harmony Taxonomy classification\n  taxonomyPrimary?: string;    // 'harmony' | 'dimorphism' | 'angularity' | 'features'\n  taxonomySecondary?: string;  // Subcategory ID\n}\n\n// ============================================\n// STRENGTH/FLAW TYPES\n// ============================================\n\nexport interface ResponsibleRatio {\n  ratioName: string;\n  ratioId: string;\n  score: number | string;\n  value: number | string;\n  isObfuscated?: boolean;\n  // Additional properties for AI descriptions\n  idealMin: number;\n  idealMax: number;\n  unit: string;\n  category?: string;\n}\n\nexport interface Strength {\n  id: string;\n  strengthName: string;\n  summary: string;\n  avgScore: number | string;\n  qualityLevel: QualityTier;\n  categoryName: string;\n  responsibleRatios: ResponsibleRatio[];\n}\n\nexport interface Flaw {\n  id: string;\n  flawName: string;\n  summary: string;\n  harmonyPercentageLost: number;\n  standardizedImpact: number;\n  categoryName: string;\n  isOther?: boolean;\n  responsibleRatios: ResponsibleRatio[];\n  rollingPointsDeducted?: number;\n  rollingHarmonyPercentageLost?: number;\n  rollingStandardizedImpact?: number;\n}\n\n// ============================================\n// RECOMMENDATION TYPES\n// ============================================\n\nexport type RecommendationPhase = 'Surgical' | 'Minimally Invasive' | 'Foundational';\n\nexport interface RecommendationTimeline {\n  effect_start: 'immediate' | 'delayed' | 'gradual';\n  full_results_weeks: number;\n  full_results_weeks_max?: number;\n}\n\nexport interface RecommendationCost {\n  type: 'flat' | 'per_month' | 'per_session';\n  min: number;\n  max: number;\n  currency: string;\n}\n\nexport interface RatioImpact {\n  ratioId: string;\n  ratioName: string;\n  direction: 'increase' | 'decrease' | 'both';\n  percentageEffect: number;\n}\n\nexport interface Recommendation {\n  ref_id: string;\n  name: string;\n  description: string;\n  phase: RecommendationPhase;\n  impact: number;  // 0-1 effectiveness score\n  coverage: number;  // Number of metrics improved\n  percentage: string;  // e.g., \"10-20%\"\n  expectedImprovementRange?: { min: number; max: number };\n  matchedFlaws: string[];\n  matchedRatios: string[];\n  ratios_impacted: RatioImpact[];\n  timeline: RecommendationTimeline;\n  cost: RecommendationCost;\n  risks_side_effects: string | null;\n  warnings: string[];\n  gender: 'male' | 'female' | 'both';\n}\n\n// ============================================\n// HARMONY ANALYSIS TYPES\n// ============================================\n\nexport interface ProfileAnalysis {\n  standardizedScore: number;\n  ratios: Ratio[];\n  overallAIDescription?: string | null;\n}\n\nexport interface FullHarmonyAnalysis {\n  standardizedScore: number;\n  front: ProfileAnalysis;\n  side: ProfileAnalysis;\n  strengths: Strength[];\n  flaws: Flaw[];\n}\n\n// ============================================\n// FACE DATA TYPES\n// ============================================\n\nexport interface FaceData {\n  id: string;\n  userId?: string;\n  frontPhotoUrl: string;\n  sidePhotoUrl?: string;\n  harmonyScore: number | null;\n  frontHarmonyScore: number | null;\n  sideHarmonyScore: number | null;\n  gender: 'male' | 'female';\n  race?: string;\n  unlocked: boolean;\n  actionPlanUnlocked: boolean;\n  harmonyAnalysis: FullHarmonyAnalysis;\n}\n\n// ============================================\n// UI STATE TYPES\n// ============================================\n\nexport type ResultsTab =\n  | 'overview'\n  | 'front-ratios'\n  | 'side-ratios'\n  | 'leaderboard'\n  | 'psl'\n  | 'archetype'\n  | 'plan'\n  | 'guides'\n  | 'community'\n  | 'referrals'\n  | 'options'\n  | 'support';\n\n// ============================================\n// LEADERBOARD TYPES\n// ============================================\n\nexport interface UserRank {\n  userId: string;\n  score: number;\n  globalRank: number;\n  genderRank: number;\n  percentile: number;\n  totalUsers: number;\n  genderTotal: number;\n  anonymousName: string;\n  updatedAt: string;\n}\n\nexport interface LeaderboardEntry {\n  userId: string;\n  rank: number;\n  score: number;\n  anonymousName: string;\n  gender: 'male' | 'female';\n  facePhotoUrl: string | null;\n  isCurrentUser: boolean;\n  topStrengths: string[];\n  topImprovements: string[];\n}\n\nexport interface UserProfile extends Omit<LeaderboardEntry, 'isCurrentUser'> {\n  topStrengths: string[];\n  topImprovements: string[];\n}\n\nexport interface LeaderboardData {\n  entries: LeaderboardEntry[];\n  totalCount: number;\n  userRank: UserRank | null;\n}\n\nexport interface ResultsUIState {\n  activeTab: ResultsTab;\n  expandedMeasurementId: string | null;\n  selectedVisualizationMetric: string | null;\n  categoryFilter: string | null;\n  showLandmarkOverlay: boolean;\n}\n\n// ============================================\n// CATEGORY TYPES\n// ============================================\n\nexport interface MeasurementCategory {\n  id: string;\n  name: string;\n  color: string;\n  description: string;\n}\n\nexport const MEASUREMENT_CATEGORIES: MeasurementCategory[] = [\n  { id: 'midface', name: 'Midface/Face Shape', color: '#67e8f9', description: 'Facial proportions and overall shape' },\n  { id: 'jaw-growth', name: 'Occlusion/Jaw Growth', color: '#a78bfa', description: 'Jaw development and bite alignment' },\n  { id: 'jaw-shape', name: 'Jaw Shape', color: '#f97316', description: 'Jawline contour and angles' },\n  { id: 'upper-third', name: 'Upper Third', color: '#84cc16', description: 'Forehead and hairline proportions' },\n  { id: 'eyes', name: 'Eyes', color: '#06b6d4', description: 'Eye shape, spacing, and canthal tilt' },\n  { id: 'nose', name: 'Nose', color: '#fbbf24', description: 'Nasal proportions and angles' },\n  { id: 'lips', name: 'Lips', color: '#ec4899', description: 'Lip proportions and projection' },\n  { id: 'chin', name: 'Chin', color: '#ef4444', description: 'Chin projection and shape' },\n  { id: 'neck', name: 'Neck', color: '#14b8a6', description: 'Neck angle and throat definition' },\n  { id: 'other', name: 'Other', color: '#6b7280', description: 'Additional measurements' },\n];\n\n// ============================================\n// SCORE COLOR HELPERS\n// ============================================\n\nexport function getScoreColor(score: number): string {\n  if (score >= 8) return '#67e8f9';  // Cyan - ideal\n  if (score >= 6) return '#22c55e';  // Green - good\n  if (score >= 4) return '#fbbf24';  // Yellow - fair\n  return 'rgb(227, 67, 67)';         // Red - poor\n}\n\nexport function getQualityColor(quality: QualityTier): string {\n  switch (quality) {\n    case 'ideal': return '#67e8f9';\n    case 'excellent': return '#22c55e';\n    case 'good': return '#fbbf24';\n    case 'below_average': return 'rgb(227, 67, 67)';\n    default: return '#6b7280';\n  }\n}\n\nexport function getSeverityColor(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'optimal': return '#67e8f9';\n    case 'minor': return '#22c55e';\n    case 'moderate': return '#fbbf24';\n    case 'major': return '#f97316';\n    case 'severe': return '#ef4444';\n    case 'extremely_severe': return '#dc2626';\n    default: return '#6b7280';\n  }\n}\n\nexport function getCategoryColor(categoryName: string): string {\n  const cat = MEASUREMENT_CATEGORIES.find(c =>\n    c.name.toLowerCase().includes(categoryName.toLowerCase()) ||\n    categoryName.toLowerCase().includes(c.name.toLowerCase())\n  );\n  return cat?.color || '#6b7280';\n}\n\n// ============================================\n// UNIT FORMATTING\n// ============================================\n\nexport function formatUnit(unit: 'x' | 'mm' | '%' | '°' | MeasurementUnit): string {\n  switch (unit) {\n    case 'x':\n    case 'ratio': return 'x';\n    case 'mm': return 'mm';\n    case '%':\n    case 'percent': return '%';\n    case '°':\n    case 'degrees': return '°';\n    default: return '';\n  }\n}\n\nexport function formatValue(value: number | string, unit: 'x' | 'mm' | '%' | '°' | MeasurementUnit): string {\n  // Handle obfuscated string values\n  if (typeof value === 'string') {\n    return value;\n  }\n  const unitStr = formatUnit(unit);\n  if (unit === '%' || unit === 'percent') {\n    return `${value.toFixed(1)}${unitStr}`;\n  }\n  if (unit === '°' || unit === 'degrees') {\n    return `${value.toFixed(1)}${unitStr}`;\n  }\n  return `${value.toFixed(2)}${unitStr}`;\n}\n\n// ============================================\n// PRODUCT & SUPPLEMENT TYPES\n// ============================================\n\nexport interface Product {\n  id: string;\n  name: string;\n  brand: string;\n  category: \"skin\" | \"hair\" | \"anti-aging\" | \"hormonal\" | \"bone\" | \"general\" | \"jawline\" | \"tools\" | \"dental\";\n  affiliateLink: string;\n  affiliateType: \"amazon\" | \"direct\";\n  supplementId: string;\n  priority: number;\n  baseStackItem?: boolean;\n  description?: string;\n}\n\nexport interface ProductRecommendation {\n  product: Product;\n  state: \"flaw\" | \"ideal\";\n  targetMetric: string;\n  message: string;\n  urgency: \"high\" | \"medium\" | \"low\";\n  matchedMetrics: string[];\n}\n\nexport interface DailyStack {\n  products: Product[];\n  totalCostPerMonth: { min: number; max: number };\n  timing: {\n    morning: Product[];\n    evening: Product[];\n    anytime: Product[];\n  };\n  rationale: string;\n}\n","numLines":388,"startLine":1,"totalLines":388}}}
{"parentUuid":"8dbb2049-0853-484b-b9e9-85a2b2b52b22","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01LRYGbwYS2Pxc4aYTJ5jZ4M","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me add the import for `ConfidenceLevel` and update the `Flaw` interface:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4881,"cache_read_input_tokens":118312,"cache_creation":{"ephemeral_5m_input_tokens":4881,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWVV9q3itwkPf3ZuF2F34","type":"assistant","uuid":"08d35df8-f4de-4c6f-b4ec-5b3064e4d60e","timestamp":"2025-12-26T14:51:08.372Z"}
{"parentUuid":"08d35df8-f4de-4c6f-b4ec-5b3064e4d60e","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01LRYGbwYS2Pxc4aYTJ5jZ4M","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01D6UhwiUScRnTQMAxEpfLjU","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/types/results.ts","old_string":"import { QualityTier, SeverityLevel, MeasurementUnit } from '@/lib/harmony-scoring';","new_string":"import { QualityTier, SeverityLevel, MeasurementUnit, ConfidenceLevel } from '@/lib/harmony-scoring';"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4881,"cache_read_input_tokens":118312,"cache_creation":{"ephemeral_5m_input_tokens":4881,"ephemeral_1h_input_tokens":0},"output_tokens":202,"service_tier":"standard"}},"requestId":"req_011CWVV9q3itwkPf3ZuF2F34","type":"assistant","uuid":"173a6680-ec95-4db1-a36a-73b244375539","timestamp":"2025-12-26T14:51:11.385Z"}
{"parentUuid":"173a6680-ec95-4db1-a36a-73b244375539","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01D6UhwiUScRnTQMAxEpfLjU","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/types/results.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n     2→ * Harmony-Style Results Page Types\n     3→ * Complete type definitions for the results UI\n     4→ */\n     5→\n     6→import { QualityTier, SeverityLevel, MeasurementUnit, ConfidenceLevel } from '@/lib/harmony-scoring';\n     7→\n     8→// ============================================\n     9→// ILLUSTRATION TYPES\n    10→// ============================================"}]},"uuid":"d1ca7a4b-811c-464b-a13a-0e6f0a4e6de7","timestamp":"2025-12-26T14:51:11.455Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/types/results.ts","oldString":"import { QualityTier, SeverityLevel, MeasurementUnit } from '@/lib/harmony-scoring';","newString":"import { QualityTier, SeverityLevel, MeasurementUnit, ConfidenceLevel } from '@/lib/harmony-scoring';","originalFile":"/**\n * Harmony-Style Results Page Types\n * Complete type definitions for the results UI\n */\n\nimport { QualityTier, SeverityLevel, MeasurementUnit } from '@/lib/harmony-scoring';\n\n// ============================================\n// ILLUSTRATION TYPES\n// ============================================\n\nexport interface IllustrationPoint {\n  type: 'landmark' | 'calculated';\n  landmarkId?: string;\n  x?: number;\n  y?: number;\n  label?: string;\n}\n\nexport interface IllustrationLine {\n  from: string;\n  to: string;\n  color: string;\n  style?: 'solid' | 'dashed';\n  label?: string;\n  labelColor?: string;\n  labelPosition?: 'start' | 'middle' | 'end';\n}\n\nexport interface RatioIllustration {\n  points: Record<string, IllustrationPoint>;\n  lines: Record<string, IllustrationLine>;\n}\n\n// ============================================\n// RATIO/MEASUREMENT TYPES\n// ============================================\n\nexport interface Ratio {\n  id: string;\n  name: string;\n  value: number | string;\n  score: number | string;  // 0-10 scale or Greek text\n  standardizedScore: number | string;\n  unit: 'x' | 'mm' | '%' | '°';\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  description: string;\n  category: string;\n  qualityLevel: QualityTier;\n  severity: SeverityLevel;\n  illustration: RatioIllustration;\n  mayIndicateFlaws: string[];\n  mayIndicateStrengths: string[];\n  usedLandmarks: string[];\n  scoringCurveConfig?: {\n    decayRate: number;\n    maxScore: number;\n  };\n  // Harmony Taxonomy classification\n  taxonomyPrimary?: string;    // 'harmony' | 'dimorphism' | 'angularity' | 'features'\n  taxonomySecondary?: string;  // Subcategory ID\n}\n\n// ============================================\n// STRENGTH/FLAW TYPES\n// ============================================\n\nexport interface ResponsibleRatio {\n  ratioName: string;\n  ratioId: string;\n  score: number | string;\n  value: number | string;\n  isObfuscated?: boolean;\n  // Additional properties for AI descriptions\n  idealMin: number;\n  idealMax: number;\n  unit: string;\n  category?: string;\n}\n\nexport interface Strength {\n  id: string;\n  strengthName: string;\n  summary: string;\n  avgScore: number | string;\n  qualityLevel: QualityTier;\n  categoryName: string;\n  responsibleRatios: ResponsibleRatio[];\n}\n\nexport interface Flaw {\n  id: string;\n  flawName: string;\n  summary: string;\n  harmonyPercentageLost: number;\n  standardizedImpact: number;\n  categoryName: string;\n  isOther?: boolean;\n  responsibleRatios: ResponsibleRatio[];\n  rollingPointsDeducted?: number;\n  rollingHarmonyPercentageLost?: number;\n  rollingStandardizedImpact?: number;\n}\n\n// ============================================\n// RECOMMENDATION TYPES\n// ============================================\n\nexport type RecommendationPhase = 'Surgical' | 'Minimally Invasive' | 'Foundational';\n\nexport interface RecommendationTimeline {\n  effect_start: 'immediate' | 'delayed' | 'gradual';\n  full_results_weeks: number;\n  full_results_weeks_max?: number;\n}\n\nexport interface RecommendationCost {\n  type: 'flat' | 'per_month' | 'per_session';\n  min: number;\n  max: number;\n  currency: string;\n}\n\nexport interface RatioImpact {\n  ratioId: string;\n  ratioName: string;\n  direction: 'increase' | 'decrease' | 'both';\n  percentageEffect: number;\n}\n\nexport interface Recommendation {\n  ref_id: string;\n  name: string;\n  description: string;\n  phase: RecommendationPhase;\n  impact: number;  // 0-1 effectiveness score\n  coverage: number;  // Number of metrics improved\n  percentage: string;  // e.g., \"10-20%\"\n  expectedImprovementRange?: { min: number; max: number };\n  matchedFlaws: string[];\n  matchedRatios: string[];\n  ratios_impacted: RatioImpact[];\n  timeline: RecommendationTimeline;\n  cost: RecommendationCost;\n  risks_side_effects: string | null;\n  warnings: string[];\n  gender: 'male' | 'female' | 'both';\n}\n\n// ============================================\n// HARMONY ANALYSIS TYPES\n// ============================================\n\nexport interface ProfileAnalysis {\n  standardizedScore: number;\n  ratios: Ratio[];\n  overallAIDescription?: string | null;\n}\n\nexport interface FullHarmonyAnalysis {\n  standardizedScore: number;\n  front: ProfileAnalysis;\n  side: ProfileAnalysis;\n  strengths: Strength[];\n  flaws: Flaw[];\n}\n\n// ============================================\n// FACE DATA TYPES\n// ============================================\n\nexport interface FaceData {\n  id: string;\n  userId?: string;\n  frontPhotoUrl: string;\n  sidePhotoUrl?: string;\n  harmonyScore: number | null;\n  frontHarmonyScore: number | null;\n  sideHarmonyScore: number | null;\n  gender: 'male' | 'female';\n  race?: string;\n  unlocked: boolean;\n  actionPlanUnlocked: boolean;\n  harmonyAnalysis: FullHarmonyAnalysis;\n}\n\n// ============================================\n// UI STATE TYPES\n// ============================================\n\nexport type ResultsTab =\n  | 'overview'\n  | 'front-ratios'\n  | 'side-ratios'\n  | 'leaderboard'\n  | 'psl'\n  | 'archetype'\n  | 'plan'\n  | 'guides'\n  | 'community'\n  | 'referrals'\n  | 'options'\n  | 'support';\n\n// ============================================\n// LEADERBOARD TYPES\n// ============================================\n\nexport interface UserRank {\n  userId: string;\n  score: number;\n  globalRank: number;\n  genderRank: number;\n  percentile: number;\n  totalUsers: number;\n  genderTotal: number;\n  anonymousName: string;\n  updatedAt: string;\n}\n\nexport interface LeaderboardEntry {\n  userId: string;\n  rank: number;\n  score: number;\n  anonymousName: string;\n  gender: 'male' | 'female';\n  facePhotoUrl: string | null;\n  isCurrentUser: boolean;\n  topStrengths: string[];\n  topImprovements: string[];\n}\n\nexport interface UserProfile extends Omit<LeaderboardEntry, 'isCurrentUser'> {\n  topStrengths: string[];\n  topImprovements: string[];\n}\n\nexport interface LeaderboardData {\n  entries: LeaderboardEntry[];\n  totalCount: number;\n  userRank: UserRank | null;\n}\n\nexport interface ResultsUIState {\n  activeTab: ResultsTab;\n  expandedMeasurementId: string | null;\n  selectedVisualizationMetric: string | null;\n  categoryFilter: string | null;\n  showLandmarkOverlay: boolean;\n}\n\n// ============================================\n// CATEGORY TYPES\n// ============================================\n\nexport interface MeasurementCategory {\n  id: string;\n  name: string;\n  color: string;\n  description: string;\n}\n\nexport const MEASUREMENT_CATEGORIES: MeasurementCategory[] = [\n  { id: 'midface', name: 'Midface/Face Shape', color: '#67e8f9', description: 'Facial proportions and overall shape' },\n  { id: 'jaw-growth', name: 'Occlusion/Jaw Growth', color: '#a78bfa', description: 'Jaw development and bite alignment' },\n  { id: 'jaw-shape', name: 'Jaw Shape', color: '#f97316', description: 'Jawline contour and angles' },\n  { id: 'upper-third', name: 'Upper Third', color: '#84cc16', description: 'Forehead and hairline proportions' },\n  { id: 'eyes', name: 'Eyes', color: '#06b6d4', description: 'Eye shape, spacing, and canthal tilt' },\n  { id: 'nose', name: 'Nose', color: '#fbbf24', description: 'Nasal proportions and angles' },\n  { id: 'lips', name: 'Lips', color: '#ec4899', description: 'Lip proportions and projection' },\n  { id: 'chin', name: 'Chin', color: '#ef4444', description: 'Chin projection and shape' },\n  { id: 'neck', name: 'Neck', color: '#14b8a6', description: 'Neck angle and throat definition' },\n  { id: 'other', name: 'Other', color: '#6b7280', description: 'Additional measurements' },\n];\n\n// ============================================\n// SCORE COLOR HELPERS\n// ============================================\n\nexport function getScoreColor(score: number): string {\n  if (score >= 8) return '#67e8f9';  // Cyan - ideal\n  if (score >= 6) return '#22c55e';  // Green - good\n  if (score >= 4) return '#fbbf24';  // Yellow - fair\n  return 'rgb(227, 67, 67)';         // Red - poor\n}\n\nexport function getQualityColor(quality: QualityTier): string {\n  switch (quality) {\n    case 'ideal': return '#67e8f9';\n    case 'excellent': return '#22c55e';\n    case 'good': return '#fbbf24';\n    case 'below_average': return 'rgb(227, 67, 67)';\n    default: return '#6b7280';\n  }\n}\n\nexport function getSeverityColor(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'optimal': return '#67e8f9';\n    case 'minor': return '#22c55e';\n    case 'moderate': return '#fbbf24';\n    case 'major': return '#f97316';\n    case 'severe': return '#ef4444';\n    case 'extremely_severe': return '#dc2626';\n    default: return '#6b7280';\n  }\n}\n\nexport function getCategoryColor(categoryName: string): string {\n  const cat = MEASUREMENT_CATEGORIES.find(c =>\n    c.name.toLowerCase().includes(categoryName.toLowerCase()) ||\n    categoryName.toLowerCase().includes(c.name.toLowerCase())\n  );\n  return cat?.color || '#6b7280';\n}\n\n// ============================================\n// UNIT FORMATTING\n// ============================================\n\nexport function formatUnit(unit: 'x' | 'mm' | '%' | '°' | MeasurementUnit): string {\n  switch (unit) {\n    case 'x':\n    case 'ratio': return 'x';\n    case 'mm': return 'mm';\n    case '%':\n    case 'percent': return '%';\n    case '°':\n    case 'degrees': return '°';\n    default: return '';\n  }\n}\n\nexport function formatValue(value: number | string, unit: 'x' | 'mm' | '%' | '°' | MeasurementUnit): string {\n  // Handle obfuscated string values\n  if (typeof value === 'string') {\n    return value;\n  }\n  const unitStr = formatUnit(unit);\n  if (unit === '%' || unit === 'percent') {\n    return `${value.toFixed(1)}${unitStr}`;\n  }\n  if (unit === '°' || unit === 'degrees') {\n    return `${value.toFixed(1)}${unitStr}`;\n  }\n  return `${value.toFixed(2)}${unitStr}`;\n}\n\n// ============================================\n// PRODUCT & SUPPLEMENT TYPES\n// ============================================\n\nexport interface Product {\n  id: string;\n  name: string;\n  brand: string;\n  category: \"skin\" | \"hair\" | \"anti-aging\" | \"hormonal\" | \"bone\" | \"general\" | \"jawline\" | \"tools\" | \"dental\";\n  affiliateLink: string;\n  affiliateType: \"amazon\" | \"direct\";\n  supplementId: string;\n  priority: number;\n  baseStackItem?: boolean;\n  description?: string;\n}\n\nexport interface ProductRecommendation {\n  product: Product;\n  state: \"flaw\" | \"ideal\";\n  targetMetric: string;\n  message: string;\n  urgency: \"high\" | \"medium\" | \"low\";\n  matchedMetrics: string[];\n}\n\nexport interface DailyStack {\n  products: Product[];\n  totalCostPerMonth: { min: number; max: number };\n  timing: {\n    morning: Product[];\n    evening: Product[];\n    anytime: Product[];\n  };\n  rationale: string;\n}\n","structuredPatch":[{"oldStart":3,"oldLines":7,"newStart":3,"newLines":7,"lines":["  * Complete type definitions for the results UI","  */"," ","-import { QualityTier, SeverityLevel, MeasurementUnit } from '@/lib/harmony-scoring';","+import { QualityTier, SeverityLevel, MeasurementUnit, ConfidenceLevel } from '@/lib/harmony-scoring';"," "," // ============================================"," // ILLUSTRATION TYPES"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"d1ca7a4b-811c-464b-a13a-0e6f0a4e6de7","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01JLA6aSrjXeT5o5CeT6iooN","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GRmgtZg5fyDhMcxiL3Grhx","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/types/results.ts","old_string":"export interface Flaw {\n  id: string;\n  flawName: string;\n  summary: string;\n  harmonyPercentageLost: number;\n  standardizedImpact: number;\n  categoryName: string;\n  isOther?: boolean;\n  responsibleRatios: ResponsibleRatio[];\n  rollingPointsDeducted?: number;\n  rollingHarmonyPercentageLost?: number;\n  rollingStandardizedImpact?: number;\n}","new_string":"export interface Flaw {\n  id: string;\n  flawName: string;\n  summary: string;\n  harmonyPercentageLost: number;\n  standardizedImpact: number;\n  categoryName: string;\n  isOther?: boolean;\n  responsibleRatios: ResponsibleRatio[];\n  rollingPointsDeducted?: number;\n  rollingHarmonyPercentageLost?: number;\n  rollingStandardizedImpact?: number;\n  /**\n   * Confidence level based on Z-score magnitude:\n   * - confirmed: |z| >= 2 (statistically significant)\n   * - likely: 1 <= |z| < 2\n   * - possible: 0.5 <= |z| < 1\n   */\n  confidence?: ConfidenceLevel;\n}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":369,"cache_read_input_tokens":123193,"cache_creation":{"ephemeral_5m_input_tokens":369,"ephemeral_1h_input_tokens":0},"output_tokens":432,"service_tier":"standard"}},"requestId":"req_011CWVVAGq1ihPuvc1LZnMu6","type":"assistant","uuid":"4fb448a0-f2d1-4fb5-82f6-2b098abebc27","timestamp":"2025-12-26T14:51:20.428Z"}
{"parentUuid":"4fb448a0-f2d1-4fb5-82f6-2b098abebc27","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GRmgtZg5fyDhMcxiL3Grhx","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/types/results.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n    90→  categoryName: string;\n    91→  responsibleRatios: ResponsibleRatio[];\n    92→}\n    93→\n    94→export interface Flaw {\n    95→  id: string;\n    96→  flawName: string;\n    97→  summary: string;\n    98→  harmonyPercentageLost: number;\n    99→  standardizedImpact: number;\n   100→  categoryName: string;\n   101→  isOther?: boolean;\n   102→  responsibleRatios: ResponsibleRatio[];\n   103→  rollingPointsDeducted?: number;\n   104→  rollingHarmonyPercentageLost?: number;\n   105→  rollingStandardizedImpact?: number;\n   106→  /**\n   107→   * Confidence level based on Z-score magnitude:\n   108→   * - confirmed: |z| >= 2 (statistically significant)\n   109→   * - likely: 1 <= |z| < 2\n   110→   * - possible: 0.5 <= |z| < 1\n   111→   */\n   112→  confidence?: ConfidenceLevel;\n   113→}\n   114→\n   115→// ============================================\n   116→// RECOMMENDATION TYPES\n   117→// ============================================"}]},"uuid":"fcfae432-cbb4-4ac7-80b6-9d564c2a9ad8","timestamp":"2025-12-26T14:51:20.496Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/types/results.ts","oldString":"export interface Flaw {\n  id: string;\n  flawName: string;\n  summary: string;\n  harmonyPercentageLost: number;\n  standardizedImpact: number;\n  categoryName: string;\n  isOther?: boolean;\n  responsibleRatios: ResponsibleRatio[];\n  rollingPointsDeducted?: number;\n  rollingHarmonyPercentageLost?: number;\n  rollingStandardizedImpact?: number;\n}","newString":"export interface Flaw {\n  id: string;\n  flawName: string;\n  summary: string;\n  harmonyPercentageLost: number;\n  standardizedImpact: number;\n  categoryName: string;\n  isOther?: boolean;\n  responsibleRatios: ResponsibleRatio[];\n  rollingPointsDeducted?: number;\n  rollingHarmonyPercentageLost?: number;\n  rollingStandardizedImpact?: number;\n  /**\n   * Confidence level based on Z-score magnitude:\n   * - confirmed: |z| >= 2 (statistically significant)\n   * - likely: 1 <= |z| < 2\n   * - possible: 0.5 <= |z| < 1\n   */\n  confidence?: ConfidenceLevel;\n}","originalFile":"/**\n * Harmony-Style Results Page Types\n * Complete type definitions for the results UI\n */\n\nimport { QualityTier, SeverityLevel, MeasurementUnit, ConfidenceLevel } from '@/lib/harmony-scoring';\n\n// ============================================\n// ILLUSTRATION TYPES\n// ============================================\n\nexport interface IllustrationPoint {\n  type: 'landmark' | 'calculated';\n  landmarkId?: string;\n  x?: number;\n  y?: number;\n  label?: string;\n}\n\nexport interface IllustrationLine {\n  from: string;\n  to: string;\n  color: string;\n  style?: 'solid' | 'dashed';\n  label?: string;\n  labelColor?: string;\n  labelPosition?: 'start' | 'middle' | 'end';\n}\n\nexport interface RatioIllustration {\n  points: Record<string, IllustrationPoint>;\n  lines: Record<string, IllustrationLine>;\n}\n\n// ============================================\n// RATIO/MEASUREMENT TYPES\n// ============================================\n\nexport interface Ratio {\n  id: string;\n  name: string;\n  value: number | string;\n  score: number | string;  // 0-10 scale or Greek text\n  standardizedScore: number | string;\n  unit: 'x' | 'mm' | '%' | '°';\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  description: string;\n  category: string;\n  qualityLevel: QualityTier;\n  severity: SeverityLevel;\n  illustration: RatioIllustration;\n  mayIndicateFlaws: string[];\n  mayIndicateStrengths: string[];\n  usedLandmarks: string[];\n  scoringCurveConfig?: {\n    decayRate: number;\n    maxScore: number;\n  };\n  // Harmony Taxonomy classification\n  taxonomyPrimary?: string;    // 'harmony' | 'dimorphism' | 'angularity' | 'features'\n  taxonomySecondary?: string;  // Subcategory ID\n}\n\n// ============================================\n// STRENGTH/FLAW TYPES\n// ============================================\n\nexport interface ResponsibleRatio {\n  ratioName: string;\n  ratioId: string;\n  score: number | string;\n  value: number | string;\n  isObfuscated?: boolean;\n  // Additional properties for AI descriptions\n  idealMin: number;\n  idealMax: number;\n  unit: string;\n  category?: string;\n}\n\nexport interface Strength {\n  id: string;\n  strengthName: string;\n  summary: string;\n  avgScore: number | string;\n  qualityLevel: QualityTier;\n  categoryName: string;\n  responsibleRatios: ResponsibleRatio[];\n}\n\nexport interface Flaw {\n  id: string;\n  flawName: string;\n  summary: string;\n  harmonyPercentageLost: number;\n  standardizedImpact: number;\n  categoryName: string;\n  isOther?: boolean;\n  responsibleRatios: ResponsibleRatio[];\n  rollingPointsDeducted?: number;\n  rollingHarmonyPercentageLost?: number;\n  rollingStandardizedImpact?: number;\n}\n\n// ============================================\n// RECOMMENDATION TYPES\n// ============================================\n\nexport type RecommendationPhase = 'Surgical' | 'Minimally Invasive' | 'Foundational';\n\nexport interface RecommendationTimeline {\n  effect_start: 'immediate' | 'delayed' | 'gradual';\n  full_results_weeks: number;\n  full_results_weeks_max?: number;\n}\n\nexport interface RecommendationCost {\n  type: 'flat' | 'per_month' | 'per_session';\n  min: number;\n  max: number;\n  currency: string;\n}\n\nexport interface RatioImpact {\n  ratioId: string;\n  ratioName: string;\n  direction: 'increase' | 'decrease' | 'both';\n  percentageEffect: number;\n}\n\nexport interface Recommendation {\n  ref_id: string;\n  name: string;\n  description: string;\n  phase: RecommendationPhase;\n  impact: number;  // 0-1 effectiveness score\n  coverage: number;  // Number of metrics improved\n  percentage: string;  // e.g., \"10-20%\"\n  expectedImprovementRange?: { min: number; max: number };\n  matchedFlaws: string[];\n  matchedRatios: string[];\n  ratios_impacted: RatioImpact[];\n  timeline: RecommendationTimeline;\n  cost: RecommendationCost;\n  risks_side_effects: string | null;\n  warnings: string[];\n  gender: 'male' | 'female' | 'both';\n}\n\n// ============================================\n// HARMONY ANALYSIS TYPES\n// ============================================\n\nexport interface ProfileAnalysis {\n  standardizedScore: number;\n  ratios: Ratio[];\n  overallAIDescription?: string | null;\n}\n\nexport interface FullHarmonyAnalysis {\n  standardizedScore: number;\n  front: ProfileAnalysis;\n  side: ProfileAnalysis;\n  strengths: Strength[];\n  flaws: Flaw[];\n}\n\n// ============================================\n// FACE DATA TYPES\n// ============================================\n\nexport interface FaceData {\n  id: string;\n  userId?: string;\n  frontPhotoUrl: string;\n  sidePhotoUrl?: string;\n  harmonyScore: number | null;\n  frontHarmonyScore: number | null;\n  sideHarmonyScore: number | null;\n  gender: 'male' | 'female';\n  race?: string;\n  unlocked: boolean;\n  actionPlanUnlocked: boolean;\n  harmonyAnalysis: FullHarmonyAnalysis;\n}\n\n// ============================================\n// UI STATE TYPES\n// ============================================\n\nexport type ResultsTab =\n  | 'overview'\n  | 'front-ratios'\n  | 'side-ratios'\n  | 'leaderboard'\n  | 'psl'\n  | 'archetype'\n  | 'plan'\n  | 'guides'\n  | 'community'\n  | 'referrals'\n  | 'options'\n  | 'support';\n\n// ============================================\n// LEADERBOARD TYPES\n// ============================================\n\nexport interface UserRank {\n  userId: string;\n  score: number;\n  globalRank: number;\n  genderRank: number;\n  percentile: number;\n  totalUsers: number;\n  genderTotal: number;\n  anonymousName: string;\n  updatedAt: string;\n}\n\nexport interface LeaderboardEntry {\n  userId: string;\n  rank: number;\n  score: number;\n  anonymousName: string;\n  gender: 'male' | 'female';\n  facePhotoUrl: string | null;\n  isCurrentUser: boolean;\n  topStrengths: string[];\n  topImprovements: string[];\n}\n\nexport interface UserProfile extends Omit<LeaderboardEntry, 'isCurrentUser'> {\n  topStrengths: string[];\n  topImprovements: string[];\n}\n\nexport interface LeaderboardData {\n  entries: LeaderboardEntry[];\n  totalCount: number;\n  userRank: UserRank | null;\n}\n\nexport interface ResultsUIState {\n  activeTab: ResultsTab;\n  expandedMeasurementId: string | null;\n  selectedVisualizationMetric: string | null;\n  categoryFilter: string | null;\n  showLandmarkOverlay: boolean;\n}\n\n// ============================================\n// CATEGORY TYPES\n// ============================================\n\nexport interface MeasurementCategory {\n  id: string;\n  name: string;\n  color: string;\n  description: string;\n}\n\nexport const MEASUREMENT_CATEGORIES: MeasurementCategory[] = [\n  { id: 'midface', name: 'Midface/Face Shape', color: '#67e8f9', description: 'Facial proportions and overall shape' },\n  { id: 'jaw-growth', name: 'Occlusion/Jaw Growth', color: '#a78bfa', description: 'Jaw development and bite alignment' },\n  { id: 'jaw-shape', name: 'Jaw Shape', color: '#f97316', description: 'Jawline contour and angles' },\n  { id: 'upper-third', name: 'Upper Third', color: '#84cc16', description: 'Forehead and hairline proportions' },\n  { id: 'eyes', name: 'Eyes', color: '#06b6d4', description: 'Eye shape, spacing, and canthal tilt' },\n  { id: 'nose', name: 'Nose', color: '#fbbf24', description: 'Nasal proportions and angles' },\n  { id: 'lips', name: 'Lips', color: '#ec4899', description: 'Lip proportions and projection' },\n  { id: 'chin', name: 'Chin', color: '#ef4444', description: 'Chin projection and shape' },\n  { id: 'neck', name: 'Neck', color: '#14b8a6', description: 'Neck angle and throat definition' },\n  { id: 'other', name: 'Other', color: '#6b7280', description: 'Additional measurements' },\n];\n\n// ============================================\n// SCORE COLOR HELPERS\n// ============================================\n\nexport function getScoreColor(score: number): string {\n  if (score >= 8) return '#67e8f9';  // Cyan - ideal\n  if (score >= 6) return '#22c55e';  // Green - good\n  if (score >= 4) return '#fbbf24';  // Yellow - fair\n  return 'rgb(227, 67, 67)';         // Red - poor\n}\n\nexport function getQualityColor(quality: QualityTier): string {\n  switch (quality) {\n    case 'ideal': return '#67e8f9';\n    case 'excellent': return '#22c55e';\n    case 'good': return '#fbbf24';\n    case 'below_average': return 'rgb(227, 67, 67)';\n    default: return '#6b7280';\n  }\n}\n\nexport function getSeverityColor(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'optimal': return '#67e8f9';\n    case 'minor': return '#22c55e';\n    case 'moderate': return '#fbbf24';\n    case 'major': return '#f97316';\n    case 'severe': return '#ef4444';\n    case 'extremely_severe': return '#dc2626';\n    default: return '#6b7280';\n  }\n}\n\nexport function getCategoryColor(categoryName: string): string {\n  const cat = MEASUREMENT_CATEGORIES.find(c =>\n    c.name.toLowerCase().includes(categoryName.toLowerCase()) ||\n    categoryName.toLowerCase().includes(c.name.toLowerCase())\n  );\n  return cat?.color || '#6b7280';\n}\n\n// ============================================\n// UNIT FORMATTING\n// ============================================\n\nexport function formatUnit(unit: 'x' | 'mm' | '%' | '°' | MeasurementUnit): string {\n  switch (unit) {\n    case 'x':\n    case 'ratio': return 'x';\n    case 'mm': return 'mm';\n    case '%':\n    case 'percent': return '%';\n    case '°':\n    case 'degrees': return '°';\n    default: return '';\n  }\n}\n\nexport function formatValue(value: number | string, unit: 'x' | 'mm' | '%' | '°' | MeasurementUnit): string {\n  // Handle obfuscated string values\n  if (typeof value === 'string') {\n    return value;\n  }\n  const unitStr = formatUnit(unit);\n  if (unit === '%' || unit === 'percent') {\n    return `${value.toFixed(1)}${unitStr}`;\n  }\n  if (unit === '°' || unit === 'degrees') {\n    return `${value.toFixed(1)}${unitStr}`;\n  }\n  return `${value.toFixed(2)}${unitStr}`;\n}\n\n// ============================================\n// PRODUCT & SUPPLEMENT TYPES\n// ============================================\n\nexport interface Product {\n  id: string;\n  name: string;\n  brand: string;\n  category: \"skin\" | \"hair\" | \"anti-aging\" | \"hormonal\" | \"bone\" | \"general\" | \"jawline\" | \"tools\" | \"dental\";\n  affiliateLink: string;\n  affiliateType: \"amazon\" | \"direct\";\n  supplementId: string;\n  priority: number;\n  baseStackItem?: boolean;\n  description?: string;\n}\n\nexport interface ProductRecommendation {\n  product: Product;\n  state: \"flaw\" | \"ideal\";\n  targetMetric: string;\n  message: string;\n  urgency: \"high\" | \"medium\" | \"low\";\n  matchedMetrics: string[];\n}\n\nexport interface DailyStack {\n  products: Product[];\n  totalCostPerMonth: { min: number; max: number };\n  timing: {\n    morning: Product[];\n    evening: Product[];\n    anytime: Product[];\n  };\n  rationale: string;\n}\n","structuredPatch":[{"oldStart":103,"oldLines":6,"newStart":103,"newLines":13,"lines":["   rollingPointsDeducted?: number;","   rollingHarmonyPercentageLost?: number;","   rollingStandardizedImpact?: number;","+  /**","+   * Confidence level based on Z-score magnitude:","+   * - confirmed: |z| >= 2 (statistically significant)","+   * - likely: 1 <= |z| < 2","+   * - possible: 0.5 <= |z| < 1","+   */","+  confidence?: ConfidenceLevel;"," }"," "," // ============================================"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"fcfae432-cbb4-4ac7-80b6-9d564c2a9ad8","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01LqXKVaEFe29LgwjLSJK34c","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me check if `harmony-scoring.ts` exports `ConfidenceLevel`:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":925,"cache_read_input_tokens":123562,"cache_creation":{"ephemeral_5m_input_tokens":925,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVVAwce1z1GdMKK9vLQg","type":"assistant","uuid":"af5e1ef1-9872-4340-8a32-cbed28b3a14d","timestamp":"2025-12-26T14:51:23.363Z"}
{"parentUuid":"af5e1ef1-9872-4340-8a32-cbed28b3a14d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01LqXKVaEFe29LgwjLSJK34c","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018YeMKApoYyL2VHWfWWPwdX","name":"Grep","input":{"pattern":"export.*ConfidenceLevel","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib","output_mode":"content"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":925,"cache_read_input_tokens":123562,"cache_creation":{"ephemeral_5m_input_tokens":925,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVVAwce1z1GdMKK9vLQg","type":"assistant","uuid":"1b357395-890c-4191-8980-1b5871cc8438","timestamp":"2025-12-26T14:51:24.565Z"}
{"parentUuid":"1b357395-890c-4191-8980-1b5871cc8438","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018YeMKApoYyL2VHWfWWPwdX","type":"tool_result","content":"src/lib/scoring/types.ts:28:export type ConfidenceLevel = 'confirmed' | 'likely' | 'possible';"}]},"uuid":"76074fd6-f6b7-4034-927d-a8856ead48ed","timestamp":"2025-12-26T14:51:25.067Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"src/lib/scoring/types.ts:28:export type ConfidenceLevel = 'confirmed' | 'likely' | 'possible';","numLines":1}}
{"parentUuid":"76074fd6-f6b7-4034-927d-a8856ead48ed","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UBN7sFsgX8jYYcvgc7YkCs","type":"message","role":"assistant","content":[{"type":"text","text":"Now I need to check if `harmony-scoring.ts` re-exports types from `scoring/types.ts`:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":183,"cache_read_input_tokens":124487,"cache_creation":{"ephemeral_5m_input_tokens":183,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWVVBGzxfpNVHwoB1Mshp","type":"assistant","uuid":"8feef7ec-2061-4e27-9521-aa316ad070ac","timestamp":"2025-12-26T14:51:28.060Z"}
{"parentUuid":"8feef7ec-2061-4e27-9521-aa316ad070ac","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UBN7sFsgX8jYYcvgc7YkCs","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01C7X2CecsjFJ3eRo6UrBWgM","name":"Grep","input":{"pattern":"export.*from.*scoring/types","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib","output_mode":"content"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":183,"cache_read_input_tokens":124487,"cache_creation":{"ephemeral_5m_input_tokens":183,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWVVBGzxfpNVHwoB1Mshp","type":"assistant","uuid":"3a9a4169-be65-4220-8584-e6d988459c48","timestamp":"2025-12-26T14:51:29.271Z"}
{"parentUuid":"3a9a4169-be65-4220-8584-e6d988459c48","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01C7X2CecsjFJ3eRo6UrBWgM","type":"tool_result","content":"No matches found"}]},"uuid":"73ccf55e-28ad-43ce-9d8f-e7e155326ab1","timestamp":"2025-12-26T14:51:29.700Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"","numLines":0}}
{"parentUuid":"73ccf55e-28ad-43ce-9d8f-e7e155326ab1","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MayrroBhrpfAhkskyBsgCr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01G3b4RGS1ruNyVmmAu85JYt","name":"Grep","input":{"pattern":"export.*QualityTier","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/harmony-scoring.ts","output_mode":"content"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":260,"cache_read_input_tokens":124670,"cache_creation":{"ephemeral_5m_input_tokens":260,"ephemeral_1h_input_tokens":0},"output_tokens":21,"service_tier":"standard"}},"requestId":"req_011CWVVBcxW3x1TtsGGsQgns","type":"assistant","uuid":"2570ff85-4906-4266-a09e-774f788f57bd","timestamp":"2025-12-26T14:51:32.975Z"}
{"parentUuid":"2570ff85-4906-4266-a09e-774f788f57bd","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01G3b4RGS1ruNyVmmAu85JYt","type":"tool_result","content":"No matches found"}]},"uuid":"35072137-6ec3-4cac-b719-3cc9856aa953","timestamp":"2025-12-26T14:51:33.400Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"","numLines":0}}
{"parentUuid":"35072137-6ec3-4cac-b719-3cc9856aa953","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_0165yG6aHdwJnp8yvV7MLhnj","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Pagh1CvHdxuEzsN9NDNNy3","name":"Bash","input":{"command":"head -50 /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/harmony-scoring.ts","description":"Check harmony-scoring exports"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":137,"cache_read_input_tokens":124930,"cache_creation":{"ephemeral_5m_input_tokens":137,"ephemeral_1h_input_tokens":0},"output_tokens":23,"service_tier":"standard"}},"requestId":"req_011CWVVBte5GAqvCuJd4d8DK","type":"assistant","uuid":"fdebadeb-7dbf-4371-8083-c8ded0fe51f8","timestamp":"2025-12-26T14:51:37.733Z"}
{"parentUuid":"fdebadeb-7dbf-4371-8083-c8ded0fe51f8","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Pagh1CvHdxuEzsN9NDNNy3","type":"tool_result","content":"/**\n * Harmony Facial Analysis Scoring System - Barrel Export\n *\n * This file re-exports all scoring functionality from modular files.\n * The actual implementations are split across:\n * - ./scoring/types.ts - Type definitions\n * - ./scoring/calculator.ts - Core scoring algorithms\n * - ./scoring/analyzer.ts - Profile analysis functions\n * - ./data/metric-configs.ts - Metric configurations\n * - ./data/demographic-overrides.ts - Ethnicity/gender overrides\n */\n\n// ============================================\n// TYPE EXPORTS\n// ============================================\nexport type {\n  Point,\n  QualityTier,\n  SeverityLevel,\n  MeasurementUnit,\n  MetricPolarity,\n  MetricConfig,\n  BezierCurveConfig,\n  CurvePoint,\n  MetricScoreResult,\n  HarmonyAnalysis,\n  FlawAssessment,\n  StrengthAssessment,\n  Ethnicity,\n  Gender,\n  DemographicKey,\n  DemographicOverride,\n  DemographicOptions,\n  FlawMapping,\n  FrontProfileResults,\n  SideProfileResults,\n  PSLRating,\n  LandmarkPoint,\n} from './scoring/types';\n\n// ============================================\n// CALCULATOR EXPORTS\n// ============================================\nexport {\n  calculateMetricScore,\n  isValueAcceptable,\n  interpolateCustomCurve,\n  cubicBezier,\n  cubicBezierDerivative,\n  catmullRomSpline,","is_error":false}]},"uuid":"48c9309c-5eff-4145-ab83-d1bbe03276be","timestamp":"2025-12-26T14:51:37.867Z","toolUseResult":{"stdout":"/**\n * Harmony Facial Analysis Scoring System - Barrel Export\n *\n * This file re-exports all scoring functionality from modular files.\n * The actual implementations are split across:\n * - ./scoring/types.ts - Type definitions\n * - ./scoring/calculator.ts - Core scoring algorithms\n * - ./scoring/analyzer.ts - Profile analysis functions\n * - ./data/metric-configs.ts - Metric configurations\n * - ./data/demographic-overrides.ts - Ethnicity/gender overrides\n */\n\n// ============================================\n// TYPE EXPORTS\n// ============================================\nexport type {\n  Point,\n  QualityTier,\n  SeverityLevel,\n  MeasurementUnit,\n  MetricPolarity,\n  MetricConfig,\n  BezierCurveConfig,\n  CurvePoint,\n  MetricScoreResult,\n  HarmonyAnalysis,\n  FlawAssessment,\n  StrengthAssessment,\n  Ethnicity,\n  Gender,\n  DemographicKey,\n  DemographicOverride,\n  DemographicOptions,\n  FlawMapping,\n  FrontProfileResults,\n  SideProfileResults,\n  PSLRating,\n  LandmarkPoint,\n} from './scoring/types';\n\n// ============================================\n// CALCULATOR EXPORTS\n// ============================================\nexport {\n  calculateMetricScore,\n  isValueAcceptable,\n  interpolateCustomCurve,\n  cubicBezier,\n  cubicBezierDerivative,\n  catmullRomSpline,","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"48c9309c-5eff-4145-ab83-d1bbe03276be","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NydJDxvPambujE5tVdzapZ","type":"message","role":"assistant","content":[{"type":"text","text":"I need to add `ConfidenceLevel` to the type exports in `harmony-scoring.ts`:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":502,"cache_read_input_tokens":125067,"cache_creation":{"ephemeral_5m_input_tokens":502,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVCDjnEHEnkaGqY9jKk","type":"assistant","uuid":"c810fec7-d162-4738-9e95-036e9b7a470b","timestamp":"2025-12-26T14:51:40.682Z"}
{"parentUuid":"c810fec7-d162-4738-9e95-036e9b7a470b","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NydJDxvPambujE5tVdzapZ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016EbB5c2Twbtb8jXVwca9Uu","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/harmony-scoring.ts","limit":50}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":502,"cache_read_input_tokens":125067,"cache_creation":{"ephemeral_5m_input_tokens":502,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVCDjnEHEnkaGqY9jKk","type":"assistant","uuid":"f969dd88-592d-40e5-b6da-506ecb344afa","timestamp":"2025-12-26T14:51:42.067Z"}
{"parentUuid":"f969dd88-592d-40e5-b6da-506ecb344afa","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016EbB5c2Twbtb8jXVwca9Uu","type":"tool_result","content":"     1→/**\n     2→ * Harmony Facial Analysis Scoring System - Barrel Export\n     3→ *\n     4→ * This file re-exports all scoring functionality from modular files.\n     5→ * The actual implementations are split across:\n     6→ * - ./scoring/types.ts - Type definitions\n     7→ * - ./scoring/calculator.ts - Core scoring algorithms\n     8→ * - ./scoring/analyzer.ts - Profile analysis functions\n     9→ * - ./data/metric-configs.ts - Metric configurations\n    10→ * - ./data/demographic-overrides.ts - Ethnicity/gender overrides\n    11→ */\n    12→\n    13→// ============================================\n    14→// TYPE EXPORTS\n    15→// ============================================\n    16→export type {\n    17→  Point,\n    18→  QualityTier,\n    19→  SeverityLevel,\n    20→  MeasurementUnit,\n    21→  MetricPolarity,\n    22→  MetricConfig,\n    23→  BezierCurveConfig,\n    24→  CurvePoint,\n    25→  MetricScoreResult,\n    26→  HarmonyAnalysis,\n    27→  FlawAssessment,\n    28→  StrengthAssessment,\n    29→  Ethnicity,\n    30→  Gender,\n    31→  DemographicKey,\n    32→  DemographicOverride,\n    33→  DemographicOptions,\n    34→  FlawMapping,\n    35→  FrontProfileResults,\n    36→  SideProfileResults,\n    37→  PSLRating,\n    38→  LandmarkPoint,\n    39→} from './scoring/types';\n    40→\n    41→// ============================================\n    42→// CALCULATOR EXPORTS\n    43→// ============================================\n    44→export {\n    45→  calculateMetricScore,\n    46→  isValueAcceptable,\n    47→  interpolateCustomCurve,\n    48→  cubicBezier,\n    49→  cubicBezierDerivative,\n    50→  catmullRomSpline,\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"cec4ca9a-ce5e-4bc3-8668-53b4fcfb0d7d","timestamp":"2025-12-26T14:51:42.145Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/harmony-scoring.ts","content":"/**\n * Harmony Facial Analysis Scoring System - Barrel Export\n *\n * This file re-exports all scoring functionality from modular files.\n * The actual implementations are split across:\n * - ./scoring/types.ts - Type definitions\n * - ./scoring/calculator.ts - Core scoring algorithms\n * - ./scoring/analyzer.ts - Profile analysis functions\n * - ./data/metric-configs.ts - Metric configurations\n * - ./data/demographic-overrides.ts - Ethnicity/gender overrides\n */\n\n// ============================================\n// TYPE EXPORTS\n// ============================================\nexport type {\n  Point,\n  QualityTier,\n  SeverityLevel,\n  MeasurementUnit,\n  MetricPolarity,\n  MetricConfig,\n  BezierCurveConfig,\n  CurvePoint,\n  MetricScoreResult,\n  HarmonyAnalysis,\n  FlawAssessment,\n  StrengthAssessment,\n  Ethnicity,\n  Gender,\n  DemographicKey,\n  DemographicOverride,\n  DemographicOptions,\n  FlawMapping,\n  FrontProfileResults,\n  SideProfileResults,\n  PSLRating,\n  LandmarkPoint,\n} from './scoring/types';\n\n// ============================================\n// CALCULATOR EXPORTS\n// ============================================\nexport {\n  calculateMetricScore,\n  isValueAcceptable,\n  interpolateCustomCurve,\n  cubicBezier,\n  cubicBezierDerivative,\n  catmullRomSpline,","numLines":50,"startLine":1,"totalLines":85}}}
{"parentUuid":"cec4ca9a-ce5e-4bc3-8668-53b4fcfb0d7d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01WiWGC4z1Pu5o2pYuQJ6QDy","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01LwDh9Z7gBJf74fGN8TFZ5r","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/harmony-scoring.ts","old_string":"export type {\n  Point,\n  QualityTier,\n  SeverityLevel,\n  MeasurementUnit,\n  MetricPolarity,\n  MetricConfig,\n  BezierCurveConfig,\n  CurvePoint,\n  MetricScoreResult,\n  HarmonyAnalysis,\n  FlawAssessment,\n  StrengthAssessment,\n  Ethnicity,\n  Gender,\n  DemographicKey,\n  DemographicOverride,\n  DemographicOptions,\n  FlawMapping,\n  FrontProfileResults,\n  SideProfileResults,\n  PSLRating,\n  LandmarkPoint,\n} from './scoring/types';","new_string":"export type {\n  Point,\n  QualityTier,\n  SeverityLevel,\n  MeasurementUnit,\n  MetricPolarity,\n  ConfidenceLevel,\n  MetricConfig,\n  BezierCurveConfig,\n  CurvePoint,\n  MetricScoreResult,\n  HarmonyAnalysis,\n  FlawAssessment,\n  StrengthAssessment,\n  Ethnicity,\n  Gender,\n  DemographicKey,\n  DemographicOverride,\n  DemographicOptions,\n  FlawMapping,\n  FrontProfileResults,\n  SideProfileResults,\n  PSLRating,\n  LandmarkPoint,\n} from './scoring/types';"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":852,"cache_read_input_tokens":125569,"cache_creation":{"ephemeral_5m_input_tokens":852,"ephemeral_1h_input_tokens":0},"output_tokens":467,"service_tier":"standard"}},"requestId":"req_011CWVVCY9ZJeLQjkEpSEn6G","type":"assistant","uuid":"20ea43a5-6d20-4d3f-bc3b-b33f43a7d63f","timestamp":"2025-12-26T14:51:50.378Z"}
{"parentUuid":"20ea43a5-6d20-4d3f-bc3b-b33f43a7d63f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01LwDh9Z7gBJf74fGN8TFZ5r","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/harmony-scoring.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n    12→\n    13→// ============================================\n    14→// TYPE EXPORTS\n    15→// ============================================\n    16→export type {\n    17→  Point,\n    18→  QualityTier,\n    19→  SeverityLevel,\n    20→  MeasurementUnit,\n    21→  MetricPolarity,\n    22→  ConfidenceLevel,\n    23→  MetricConfig,\n    24→  BezierCurveConfig,\n    25→  CurvePoint,\n    26→  MetricScoreResult,\n    27→  HarmonyAnalysis,\n    28→  FlawAssessment,\n    29→  StrengthAssessment,\n    30→  Ethnicity,\n    31→  Gender,\n    32→  DemographicKey,\n    33→  DemographicOverride,\n    34→  DemographicOptions,\n    35→  FlawMapping,\n    36→  FrontProfileResults,\n    37→  SideProfileResults,\n    38→  PSLRating,\n    39→  LandmarkPoint,\n    40→} from './scoring/types';\n    41→\n    42→// ============================================\n    43→// CALCULATOR EXPORTS\n    44→// ============================================"}]},"uuid":"75e02e53-11fd-47b5-bf6f-cbc75c00620a","timestamp":"2025-12-26T14:51:50.439Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/harmony-scoring.ts","oldString":"export type {\n  Point,\n  QualityTier,\n  SeverityLevel,\n  MeasurementUnit,\n  MetricPolarity,\n  MetricConfig,\n  BezierCurveConfig,\n  CurvePoint,\n  MetricScoreResult,\n  HarmonyAnalysis,\n  FlawAssessment,\n  StrengthAssessment,\n  Ethnicity,\n  Gender,\n  DemographicKey,\n  DemographicOverride,\n  DemographicOptions,\n  FlawMapping,\n  FrontProfileResults,\n  SideProfileResults,\n  PSLRating,\n  LandmarkPoint,\n} from './scoring/types';","newString":"export type {\n  Point,\n  QualityTier,\n  SeverityLevel,\n  MeasurementUnit,\n  MetricPolarity,\n  ConfidenceLevel,\n  MetricConfig,\n  BezierCurveConfig,\n  CurvePoint,\n  MetricScoreResult,\n  HarmonyAnalysis,\n  FlawAssessment,\n  StrengthAssessment,\n  Ethnicity,\n  Gender,\n  DemographicKey,\n  DemographicOverride,\n  DemographicOptions,\n  FlawMapping,\n  FrontProfileResults,\n  SideProfileResults,\n  PSLRating,\n  LandmarkPoint,\n} from './scoring/types';","originalFile":"/**\n * Harmony Facial Analysis Scoring System - Barrel Export\n *\n * This file re-exports all scoring functionality from modular files.\n * The actual implementations are split across:\n * - ./scoring/types.ts - Type definitions\n * - ./scoring/calculator.ts - Core scoring algorithms\n * - ./scoring/analyzer.ts - Profile analysis functions\n * - ./data/metric-configs.ts - Metric configurations\n * - ./data/demographic-overrides.ts - Ethnicity/gender overrides\n */\n\n// ============================================\n// TYPE EXPORTS\n// ============================================\nexport type {\n  Point,\n  QualityTier,\n  SeverityLevel,\n  MeasurementUnit,\n  MetricPolarity,\n  MetricConfig,\n  BezierCurveConfig,\n  CurvePoint,\n  MetricScoreResult,\n  HarmonyAnalysis,\n  FlawAssessment,\n  StrengthAssessment,\n  Ethnicity,\n  Gender,\n  DemographicKey,\n  DemographicOverride,\n  DemographicOptions,\n  FlawMapping,\n  FrontProfileResults,\n  SideProfileResults,\n  PSLRating,\n  LandmarkPoint,\n} from './scoring/types';\n\n// ============================================\n// CALCULATOR EXPORTS\n// ============================================\nexport {\n  calculateMetricScore,\n  isValueAcceptable,\n  interpolateCustomCurve,\n  cubicBezier,\n  cubicBezierDerivative,\n  catmullRomSpline,\n  standardizeScore,\n  getQualityTier,\n  getSeverityLevel,\n  getDeviationDescription,\n  getUnitLabel,\n  distance,\n  calculateAngle,\n  perpendicularDistance,\n  calculateHarmonyPercentile,\n  normalCDF,\n  convertToPSL,\n  METRIC_FLAW_MAPPINGS,\n  METRIC_CUSTOM_CURVES,\n} from './scoring/calculator';\n\n// ============================================\n// ANALYZER EXPORTS\n// ============================================\nexport {\n  getLandmark,\n  scoreMeasurement,\n  analyzeFrontProfile,\n  analyzeSideProfile,\n  analyzeHarmony,\n} from './scoring/analyzer';\n\n// ============================================\n// DATA EXPORTS\n// ============================================\nexport { METRIC_CONFIGS, MEASUREMENT_CATEGORIES } from './data/metric-configs';\nexport { DEMOGRAPHIC_OVERRIDES, getMetricConfigForDemographics } from './data/demographic-overrides';\n\n// Re-export bezier curves for convenience\nexport { BEZIER_CURVES } from './bezier-curves';\n","structuredPatch":[{"oldStart":19,"oldLines":6,"newStart":19,"newLines":7,"lines":["   SeverityLevel,","   MeasurementUnit,","   MetricPolarity,","+  ConfidenceLevel,","   MetricConfig,","   BezierCurveConfig,","   CurvePoint,"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"75e02e53-11fd-47b5-bf6f-cbc75c00620a","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01FP9xX6MpwvqbG66XEqtzdc","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me update the `insights-engine.ts` to add confidence calculation and update the `convertToFlaw` function:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1485,"cache_read_input_tokens":126421,"cache_creation":{"ephemeral_5m_input_tokens":1485,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWVVD9cG6nVKw5Jf6AyL3","type":"assistant","uuid":"3b5a960d-4c16-4033-9021-adfb77323cfa","timestamp":"2025-12-26T14:51:53.947Z"}
{"parentUuid":"3b5a960d-4c16-4033-9021-adfb77323cfa","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01FP9xX6MpwvqbG66XEqtzdc","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01K5qygFvqauNeAQwEQPbUen","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","offset":2380,"limit":300}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1485,"cache_read_input_tokens":126421,"cache_creation":{"ephemeral_5m_input_tokens":1485,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWVVD9cG6nVKw5Jf6AyL3","type":"assistant","uuid":"a9bab259-27d3-45c3-91c8-4e5f07320b9f","timestamp":"2025-12-26T14:51:55.388Z"}
{"parentUuid":"a9bab259-27d3-45c3-91c8-4e5f07320b9f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01K5qygFvqauNeAQwEQPbUen","type":"tool_result","content":"  2380→  \"Cupids Bow Depth\": \"cupidsBowDepth\",\n  2381→\n  2382→  // Neck\n  2383→  \"Neck Width\": \"neckWidth\",\n  2384→  \"Neck to Jaw Ratio\": \"neckToJawRatio\",\n  2385→\n  2386→  // Profile\n  2387→  \"Total Profile Angle\": \"totalProfileAngle\",\n  2388→};\n  2389→\n  2390→// ============================================\n  2391→// CLASSIFICATION FUNCTIONS\n  2392→// ============================================\n  2393→\n  2394→/**\n  2395→ * Get weakness severity based on average score\n  2396→ * 0-3 = \"Severe\", 3-5 = \"Moderate\", 5-7 = \"Minor\"\n  2397→ */\n  2398→function getWeaknessSeverity(avgScore: number): WeaknessSeverity {\n  2399→  if (avgScore <= 3) return 'severe';\n  2400→  if (avgScore <= 5) return 'moderate';\n  2401→  return 'minor';\n  2402→}\n  2403→\n  2404→/**\n  2405→ * Get strength grade based on average score\n  2406→ * 8-9 = \"Good\", 9-9.5 = \"Excellent\", 9.5-10 = \"Ideal\"\n  2407→ */\n  2408→function getStrengthGrade(avgScore: number): StrengthGrade {\n  2409→  if (avgScore >= 9.5) return 'ideal';\n  2410→  if (avgScore >= 9) return 'excellent';\n  2411→  return 'good';\n  2412→}\n  2413→\n  2414→/**\n  2415→ * Find metric by display name from measurements array\n  2416→ */\n  2417→function findMetricByName(\n  2418→  metricName: string,\n  2419→  measurements: MetricScoreResult[]\n  2420→): MetricScoreResult | undefined {\n  2421→  // First try direct ID mapping\n  2422→  const metricId = METRIC_NAME_TO_ID[metricName];\n  2423→  if (metricId) {\n  2424→    return measurements.find(m => m.metricId === metricId);\n  2425→  }\n  2426→\n  2427→  // Fallback: try fuzzy matching on name\n  2428→  const normalizedName = metricName.toLowerCase().replace(/[^a-z0-9]/g, '');\n  2429→  return measurements.find(m => {\n  2430→    const normalizedMetricName = m.name.toLowerCase().replace(/[^a-z0-9]/g, '');\n  2431→    return normalizedMetricName.includes(normalizedName) ||\n  2432→           normalizedName.includes(normalizedMetricName);\n  2433→  });\n  2434→}\n  2435→\n  2436→/**\n  2437→ * Check if a metric should be considered a \"false positive\" weakness.\n  2438→ * This handles directional/dimorphic metrics where low scores don't mean weakness.\n  2439→ *\n  2440→ * Example: Canthal Tilt of 3° gets a low score (not in 6-8° ideal range)\n  2441→ * but is still a POSITIVE trait, not a weakness.\n  2442→ */\n  2443→function isFalsePositiveWeakness(metric: MatchedMetric): boolean {\n  2444→  const config = METRIC_CONFIGS[metric.metricId];\n  2445→  if (!config) return false;\n  2446→\n  2447→  // Check if the value is actually acceptable based on polarity\n  2448→  const { acceptable } = isValueAcceptable(metric.value, config);\n  2449→  return acceptable;\n  2450→}\n  2451→\n  2452→/**\n  2453→ * Process all insight definitions against user's measurements\n  2454→ */\n  2455→export function classifyInsights(\n  2456→  measurements: MetricScoreResult[],\n  2457→  insightDefinitions: InsightDefinition[] = INSIGHTS_DEFINITIONS\n  2458→): InsightClassificationResult {\n  2459→  const strengths: ClassifiedStrength[] = [];\n  2460→  const weaknesses: ClassifiedWeakness[] = [];\n  2461→\n  2462→  for (const insight of insightDefinitions) {\n  2463→    const { metrics, threshold } = insight.severity_logic;\n  2464→\n  2465→    // Find matching measurements for this insight\n  2466→    const matchedMetrics: MatchedMetric[] = [];\n  2467→    for (const metricName of metrics) {\n  2468→      const measurement = findMetricByName(metricName, measurements);\n  2469→      if (measurement) {\n  2470→        matchedMetrics.push({\n  2471→          metricId: measurement.metricId,\n  2472→          metricName: measurement.name,\n  2473→          score: measurement.score,\n  2474→          value: measurement.value,\n  2475→          idealMin: measurement.idealMin,\n  2476→          idealMax: measurement.idealMax,\n  2477→          unit: measurement.unit,\n  2478→          category: measurement.category,\n  2479→        });\n  2480→      }\n  2481→    }\n  2482→\n  2483→    // Skip if no metrics matched (need at least 1)\n  2484→    if (matchedMetrics.length === 0) continue;\n  2485→\n  2486→    // Calculate average score\n  2487→    const avgScore = matchedMetrics.reduce((sum, m) => sum + m.score, 0) / matchedMetrics.length;\n  2488→\n  2489→    // Classify based on type and threshold\n  2490→    if (insight.type === 'weakness') {\n  2491→      // Weakness: avg < threshold → add to areas of improvement\n  2492→      if (avgScore < threshold) {\n  2493→        // ========== FALSE POSITIVE CHECK ==========\n  2494→        // Before adding to weaknesses, check if ANY of the matched metrics\n  2495→        // are actually in an \"acceptable\" zone based on their polarity.\n  2496→        // If so, this is a false positive and should be skipped or reclassified.\n  2497→        const falsePositiveMetrics = matchedMetrics.filter(isFalsePositiveWeakness);\n  2498→\n  2499→        // If ALL matched metrics are false positives, skip this weakness entirely\n  2500→        if (falsePositiveMetrics.length === matchedMetrics.length) {\n  2501→          // This is a false positive weakness - the values are actually acceptable\n  2502→          // Consider adding to strengths if scores are decent\n  2503→          if (avgScore >= 6) {\n  2504→            strengths.push({\n  2505→              insightId: `${insight.id}_acceptable`,\n  2506→              title: insight.title.replace('Negative', 'Neutral').replace('Weak', 'Moderate'),\n  2507→              description: `While not in the peak ideal range, the measured values are within acceptable limits.`,\n  2508→              grade: 'good',\n  2509→              gradeLabel: 'Acceptable',\n  2510→              avgScore,\n  2511→              matchedMetrics,\n  2512→            });\n  2513→          }\n  2514→          continue; // Skip adding as weakness\n  2515→        }\n  2516→\n  2517→        // If SOME metrics are false positives, filter them out\n  2518→        const trueWeaknessMetrics = matchedMetrics.filter(m => !isFalsePositiveWeakness(m));\n  2519→        if (trueWeaknessMetrics.length === 0) continue;\n  2520→\n  2521→        // Recalculate average with only true weakness metrics\n  2522→        const trueAvgScore = trueWeaknessMetrics.reduce((sum, m) => sum + m.score, 0) / trueWeaknessMetrics.length;\n  2523→\n  2524→        // Only add as weakness if true average is still below threshold\n  2525→        if (trueAvgScore < threshold) {\n  2526→          const severity = getWeaknessSeverity(trueAvgScore);\n  2527→          const labels = insight.content.severity_labels;\n  2528→          const severityLabel = labels?.[severity] || severity;\n  2529→\n  2530→          weaknesses.push({\n  2531→            insightId: insight.id,\n  2532→            title: insight.title,\n  2533→            description: insight.content.description,\n  2534→            severity,\n  2535→            severityLabel,\n  2536→            avgScore: trueAvgScore,\n  2537→            matchedMetrics: trueWeaknessMetrics,\n  2538→          });\n  2539→        }\n  2540→      }\n  2541→    } else {\n  2542→      // Strength: avg > threshold → add to key strengths\n  2543→      if (avgScore > threshold) {\n  2544→        const grade = getStrengthGrade(avgScore);\n  2545→        const labels = insight.content.grade_labels;\n  2546→        const gradeLabel = labels?.[grade] || grade;\n  2547→\n  2548→        strengths.push({\n  2549→          insightId: insight.id,\n  2550→          title: insight.title,\n  2551→          description: insight.content.description,\n  2552→          grade,\n  2553→          gradeLabel,\n  2554→          avgScore,\n  2555→          matchedMetrics,\n  2556→        });\n  2557→      }\n  2558→    }\n  2559→  }\n  2560→\n  2561→  // Sort by score (weaknesses by lowest score first, strengths by highest first)\n  2562→  weaknesses.sort((a, b) => a.avgScore - b.avgScore);\n  2563→  strengths.sort((a, b) => b.avgScore - a.avgScore);\n  2564→\n  2565→  return { strengths, weaknesses };\n  2566→}\n  2567→\n  2568→/**\n  2569→ * Convert ClassifiedStrength to Strength type for UI compatibility\n  2570→ */\n  2571→export function convertToStrength(classified: ClassifiedStrength): Strength {\n  2572→  return {\n  2573→    id: `insight_strength_${classified.insightId}`,\n  2574→    strengthName: `${classified.title} (${classified.gradeLabel})`,\n  2575→    summary: classified.description,\n  2576→    avgScore: Math.max(0, Math.min(10, classified.avgScore)),  // Clamp to 0-10\n  2577→    qualityLevel: classified.grade === 'ideal' ? 'ideal' :\n  2578→                  classified.grade === 'excellent' ? 'excellent' : 'good',\n  2579→    categoryName: classified.matchedMetrics[0]?.category || 'General',\n  2580→    responsibleRatios: classified.matchedMetrics.map(m => ({\n  2581→      ratioName: m.metricName,\n  2582→      ratioId: m.metricId,\n  2583→      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n  2584→      value: m.value,\n  2585→      idealMin: m.idealMin,\n  2586→      idealMax: m.idealMax,\n  2587→      unit: m.unit,\n  2588→      category: m.category,\n  2589→    })),\n  2590→  };\n  2591→}\n  2592→\n  2593→/**\n  2594→ * Convert ClassifiedWeakness to Flaw type for UI compatibility\n  2595→ */\n  2596→export function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  2597→  const impact = (10 - classified.avgScore) * 0.5;\n  2598→  const newRollingLost = rollingLost + impact;\n  2599→\n  2600→  return {\n  2601→    id: `insight_flaw_${classified.insightId}`,\n  2602→    flawName: `${classified.title} (${classified.severityLabel})`,\n  2603→    summary: classified.description,\n  2604→    harmonyPercentageLost: impact,\n  2605→    standardizedImpact: impact / 10,\n  2606→    categoryName: classified.matchedMetrics[0]?.category || 'General',\n  2607→    responsibleRatios: classified.matchedMetrics.map(m => ({\n  2608→      ratioName: m.metricName,\n  2609→      ratioId: m.metricId,\n  2610→      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n  2611→      value: m.value,\n  2612→      idealMin: m.idealMin,\n  2613→      idealMax: m.idealMax,\n  2614→      unit: m.unit,\n  2615→      category: m.category,\n  2616→    })),\n  2617→    rollingPointsDeducted: newRollingLost,\n  2618→    rollingHarmonyPercentageLost: newRollingLost,\n  2619→    rollingStandardizedImpact: newRollingLost / 10,\n  2620→  };\n  2621→}\n  2622→\n  2623→/**\n  2624→ * Main function: Generate strengths and flaws from measurements using insights\n  2625→ */\n  2626→export function generateInsightBasedResults(\n  2627→  measurements: MetricScoreResult[]\n  2628→): { strengths: Strength[]; flaws: Flaw[] } {\n  2629→  const { strengths: classifiedStrengths, weaknesses: classifiedWeaknesses } = classifyInsights(measurements);\n  2630→\n  2631→  // Convert to UI-compatible types\n  2632→  const strengths = classifiedStrengths.map((s) => convertToStrength(s));\n  2633→\n  2634→  let rollingLost = 0;\n  2635→  const flaws = classifiedWeaknesses.map((w, i) => {\n  2636→    const flaw = convertToFlaw(w, i, rollingLost);\n  2637→    rollingLost = flaw.rollingPointsDeducted || 0;\n  2638→    return flaw;\n  2639→  });\n  2640→\n  2641→  return { strengths, flaws };\n  2642→}\n  2643→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"11fa4474-76c7-4945-b3c8-ed8e4822751f","timestamp":"2025-12-26T14:51:55.548Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","content":"  \"Cupids Bow Depth\": \"cupidsBowDepth\",\n\n  // Neck\n  \"Neck Width\": \"neckWidth\",\n  \"Neck to Jaw Ratio\": \"neckToJawRatio\",\n\n  // Profile\n  \"Total Profile Angle\": \"totalProfileAngle\",\n};\n\n// ============================================\n// CLASSIFICATION FUNCTIONS\n// ============================================\n\n/**\n * Get weakness severity based on average score\n * 0-3 = \"Severe\", 3-5 = \"Moderate\", 5-7 = \"Minor\"\n */\nfunction getWeaknessSeverity(avgScore: number): WeaknessSeverity {\n  if (avgScore <= 3) return 'severe';\n  if (avgScore <= 5) return 'moderate';\n  return 'minor';\n}\n\n/**\n * Get strength grade based on average score\n * 8-9 = \"Good\", 9-9.5 = \"Excellent\", 9.5-10 = \"Ideal\"\n */\nfunction getStrengthGrade(avgScore: number): StrengthGrade {\n  if (avgScore >= 9.5) return 'ideal';\n  if (avgScore >= 9) return 'excellent';\n  return 'good';\n}\n\n/**\n * Find metric by display name from measurements array\n */\nfunction findMetricByName(\n  metricName: string,\n  measurements: MetricScoreResult[]\n): MetricScoreResult | undefined {\n  // First try direct ID mapping\n  const metricId = METRIC_NAME_TO_ID[metricName];\n  if (metricId) {\n    return measurements.find(m => m.metricId === metricId);\n  }\n\n  // Fallback: try fuzzy matching on name\n  const normalizedName = metricName.toLowerCase().replace(/[^a-z0-9]/g, '');\n  return measurements.find(m => {\n    const normalizedMetricName = m.name.toLowerCase().replace(/[^a-z0-9]/g, '');\n    return normalizedMetricName.includes(normalizedName) ||\n           normalizedName.includes(normalizedMetricName);\n  });\n}\n\n/**\n * Check if a metric should be considered a \"false positive\" weakness.\n * This handles directional/dimorphic metrics where low scores don't mean weakness.\n *\n * Example: Canthal Tilt of 3° gets a low score (not in 6-8° ideal range)\n * but is still a POSITIVE trait, not a weakness.\n */\nfunction isFalsePositiveWeakness(metric: MatchedMetric): boolean {\n  const config = METRIC_CONFIGS[metric.metricId];\n  if (!config) return false;\n\n  // Check if the value is actually acceptable based on polarity\n  const { acceptable } = isValueAcceptable(metric.value, config);\n  return acceptable;\n}\n\n/**\n * Process all insight definitions against user's measurements\n */\nexport function classifyInsights(\n  measurements: MetricScoreResult[],\n  insightDefinitions: InsightDefinition[] = INSIGHTS_DEFINITIONS\n): InsightClassificationResult {\n  const strengths: ClassifiedStrength[] = [];\n  const weaknesses: ClassifiedWeakness[] = [];\n\n  for (const insight of insightDefinitions) {\n    const { metrics, threshold } = insight.severity_logic;\n\n    // Find matching measurements for this insight\n    const matchedMetrics: MatchedMetric[] = [];\n    for (const metricName of metrics) {\n      const measurement = findMetricByName(metricName, measurements);\n      if (measurement) {\n        matchedMetrics.push({\n          metricId: measurement.metricId,\n          metricName: measurement.name,\n          score: measurement.score,\n          value: measurement.value,\n          idealMin: measurement.idealMin,\n          idealMax: measurement.idealMax,\n          unit: measurement.unit,\n          category: measurement.category,\n        });\n      }\n    }\n\n    // Skip if no metrics matched (need at least 1)\n    if (matchedMetrics.length === 0) continue;\n\n    // Calculate average score\n    const avgScore = matchedMetrics.reduce((sum, m) => sum + m.score, 0) / matchedMetrics.length;\n\n    // Classify based on type and threshold\n    if (insight.type === 'weakness') {\n      // Weakness: avg < threshold → add to areas of improvement\n      if (avgScore < threshold) {\n        // ========== FALSE POSITIVE CHECK ==========\n        // Before adding to weaknesses, check if ANY of the matched metrics\n        // are actually in an \"acceptable\" zone based on their polarity.\n        // If so, this is a false positive and should be skipped or reclassified.\n        const falsePositiveMetrics = matchedMetrics.filter(isFalsePositiveWeakness);\n\n        // If ALL matched metrics are false positives, skip this weakness entirely\n        if (falsePositiveMetrics.length === matchedMetrics.length) {\n          // This is a false positive weakness - the values are actually acceptable\n          // Consider adding to strengths if scores are decent\n          if (avgScore >= 6) {\n            strengths.push({\n              insightId: `${insight.id}_acceptable`,\n              title: insight.title.replace('Negative', 'Neutral').replace('Weak', 'Moderate'),\n              description: `While not in the peak ideal range, the measured values are within acceptable limits.`,\n              grade: 'good',\n              gradeLabel: 'Acceptable',\n              avgScore,\n              matchedMetrics,\n            });\n          }\n          continue; // Skip adding as weakness\n        }\n\n        // If SOME metrics are false positives, filter them out\n        const trueWeaknessMetrics = matchedMetrics.filter(m => !isFalsePositiveWeakness(m));\n        if (trueWeaknessMetrics.length === 0) continue;\n\n        // Recalculate average with only true weakness metrics\n        const trueAvgScore = trueWeaknessMetrics.reduce((sum, m) => sum + m.score, 0) / trueWeaknessMetrics.length;\n\n        // Only add as weakness if true average is still below threshold\n        if (trueAvgScore < threshold) {\n          const severity = getWeaknessSeverity(trueAvgScore);\n          const labels = insight.content.severity_labels;\n          const severityLabel = labels?.[severity] || severity;\n\n          weaknesses.push({\n            insightId: insight.id,\n            title: insight.title,\n            description: insight.content.description,\n            severity,\n            severityLabel,\n            avgScore: trueAvgScore,\n            matchedMetrics: trueWeaknessMetrics,\n          });\n        }\n      }\n    } else {\n      // Strength: avg > threshold → add to key strengths\n      if (avgScore > threshold) {\n        const grade = getStrengthGrade(avgScore);\n        const labels = insight.content.grade_labels;\n        const gradeLabel = labels?.[grade] || grade;\n\n        strengths.push({\n          insightId: insight.id,\n          title: insight.title,\n          description: insight.content.description,\n          grade,\n          gradeLabel,\n          avgScore,\n          matchedMetrics,\n        });\n      }\n    }\n  }\n\n  // Sort by score (weaknesses by lowest score first, strengths by highest first)\n  weaknesses.sort((a, b) => a.avgScore - b.avgScore);\n  strengths.sort((a, b) => b.avgScore - a.avgScore);\n\n  return { strengths, weaknesses };\n}\n\n/**\n * Convert ClassifiedStrength to Strength type for UI compatibility\n */\nexport function convertToStrength(classified: ClassifiedStrength): Strength {\n  return {\n    id: `insight_strength_${classified.insightId}`,\n    strengthName: `${classified.title} (${classified.gradeLabel})`,\n    summary: classified.description,\n    avgScore: Math.max(0, Math.min(10, classified.avgScore)),  // Clamp to 0-10\n    qualityLevel: classified.grade === 'ideal' ? 'ideal' :\n                  classified.grade === 'excellent' ? 'excellent' : 'good',\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n  };\n}\n\n/**\n * Convert ClassifiedWeakness to Flaw type for UI compatibility\n */\nexport function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  const impact = (10 - classified.avgScore) * 0.5;\n  const newRollingLost = rollingLost + impact;\n\n  return {\n    id: `insight_flaw_${classified.insightId}`,\n    flawName: `${classified.title} (${classified.severityLabel})`,\n    summary: classified.description,\n    harmonyPercentageLost: impact,\n    standardizedImpact: impact / 10,\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n    rollingPointsDeducted: newRollingLost,\n    rollingHarmonyPercentageLost: newRollingLost,\n    rollingStandardizedImpact: newRollingLost / 10,\n  };\n}\n\n/**\n * Main function: Generate strengths and flaws from measurements using insights\n */\nexport function generateInsightBasedResults(\n  measurements: MetricScoreResult[]\n): { strengths: Strength[]; flaws: Flaw[] } {\n  const { strengths: classifiedStrengths, weaknesses: classifiedWeaknesses } = classifyInsights(measurements);\n\n  // Convert to UI-compatible types\n  const strengths = classifiedStrengths.map((s) => convertToStrength(s));\n\n  let rollingLost = 0;\n  const flaws = classifiedWeaknesses.map((w, i) => {\n    const flaw = convertToFlaw(w, i, rollingLost);\n    rollingLost = flaw.rollingPointsDeducted || 0;\n    return flaw;\n  });\n\n  return { strengths, flaws };\n}\n","numLines":264,"startLine":2380,"totalLines":2643}}}
{"parentUuid":"11fa4474-76c7-4945-b3c8-ed8e4822751f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_013Tnhhu5TU7wEWjGxe24LfF","type":"message","role":"assistant","content":[{"type":"text","text":"Now I understand the code. Let me add the confidence calculation logic and update the `convertToFlaw` function. First, let me see what imports are at the top of the file:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4227,"cache_read_input_tokens":127906,"cache_creation":{"ephemeral_5m_input_tokens":4227,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVDXMiUwX8sx57gZSGb","type":"assistant","uuid":"50e9e5a0-0c34-48ec-b033-16cde2822ca4","timestamp":"2025-12-26T14:52:00.098Z"}
{"parentUuid":"50e9e5a0-0c34-48ec-b033-16cde2822ca4","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_013Tnhhu5TU7wEWjGxe24LfF","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AiobmtwYkLby1cCwj4ojKM","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","limit":35}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":4227,"cache_read_input_tokens":127906,"cache_creation":{"ephemeral_5m_input_tokens":4227,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVDXMiUwX8sx57gZSGb","type":"assistant","uuid":"f819587d-46cc-4ba4-8656-bd1a8d9c327d","timestamp":"2025-12-26T14:52:01.694Z"}
{"parentUuid":"f819587d-46cc-4ba4-8656-bd1a8d9c327d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AiobmtwYkLby1cCwj4ojKM","type":"tool_result","content":"     1→/**\n     2→ * Insights Engine\n     3→ *\n     4→ * Processes insight definitions from insights.json and classifies them\n     5→ * as strengths or areas of improvement based on user's metric scores.\n     6→ *\n     7→ * Logic:\n     8→ * - For each insight definition, calculate average score of affected metrics\n     9→ * - Weakness: if avg score < threshold → classify with severity label\n    10→ * - Strength: if avg score > threshold → classify with grade label\n    11→ *\n    12→ * Z-Score Based 5-Tier Severity Logic:\n    13→ * - Ideal (Green): User is inside the ideal range\n    14→ * - Good (Blue): Within 0.5 Standard Deviation of the mean (|z| < 0.5)\n    15→ * - Fair (Cyan): Between 0.5 and 1 Standard Deviation (0.5 ≤ |z| < 1)\n    16→ * - Moderate (Yellow): Between 1 and 2 Standard Deviations (1 ≤ |z| < 2)\n    17→ * - Severe (Red): More than 2 Standard Deviations away (|z| ≥ 2)\n    18→ *\n    19→ * Severity Labels (Weaknesses):\n    20→ *   0-3 = \"Severe\"\n    21→ *   3-5 = \"Moderate\"\n    22→ *   5-7 = \"Minor\"\n    23→ *\n    24→ * Grade Labels (Strengths):\n    25→ *   8-9   = \"Good\"\n    26→ *   9-9.5 = \"Excellent\"\n    27→ *   9.5-10 = \"Ideal\"\n    28→ */\n    29→\n    30→import { Strength, Flaw } from '@/types/results';\n    31→import { MetricScoreResult, METRIC_CONFIGS, isValueAcceptable } from '@/lib/harmony-scoring';\n    32→\n    33→// ============================================\n    34→// MASTER SCORING DATABASE (Z-Score Based)\n    35→// ============================================\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"dbc03c66-34b0-424d-baf6-788c62ec762e","timestamp":"2025-12-26T14:52:01.810Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","content":"/**\n * Insights Engine\n *\n * Processes insight definitions from insights.json and classifies them\n * as strengths or areas of improvement based on user's metric scores.\n *\n * Logic:\n * - For each insight definition, calculate average score of affected metrics\n * - Weakness: if avg score < threshold → classify with severity label\n * - Strength: if avg score > threshold → classify with grade label\n *\n * Z-Score Based 5-Tier Severity Logic:\n * - Ideal (Green): User is inside the ideal range\n * - Good (Blue): Within 0.5 Standard Deviation of the mean (|z| < 0.5)\n * - Fair (Cyan): Between 0.5 and 1 Standard Deviation (0.5 ≤ |z| < 1)\n * - Moderate (Yellow): Between 1 and 2 Standard Deviations (1 ≤ |z| < 2)\n * - Severe (Red): More than 2 Standard Deviations away (|z| ≥ 2)\n *\n * Severity Labels (Weaknesses):\n *   0-3 = \"Severe\"\n *   3-5 = \"Moderate\"\n *   5-7 = \"Minor\"\n *\n * Grade Labels (Strengths):\n *   8-9   = \"Good\"\n *   9-9.5 = \"Excellent\"\n *   9.5-10 = \"Ideal\"\n */\n\nimport { Strength, Flaw } from '@/types/results';\nimport { MetricScoreResult, METRIC_CONFIGS, isValueAcceptable } from '@/lib/harmony-scoring';\n\n// ============================================\n// MASTER SCORING DATABASE (Z-Score Based)\n// ============================================","numLines":35,"startLine":1,"totalLines":2643}}}
{"parentUuid":"dbc03c66-34b0-424d-baf6-788c62ec762e","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_014TxTJeE78w35KYwEab1W4f","type":"message","role":"assistant","content":[{"type":"text","text":"Now I need to:\n1. Import `ConfidenceLevel` type\n2. Add confidence calculation function based on Z-score\n3. Update `ClassifiedWeakness` interface to include confidence\n4. Update the `convertToFlaw` function to include confidence"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":785,"cache_read_input_tokens":132133,"cache_creation":{"ephemeral_5m_input_tokens":785,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWVVDzMfzV155Ry9gqzwQ","type":"assistant","uuid":"bd09046d-f714-470f-8451-6d299b6ec303","timestamp":"2025-12-26T14:52:06.884Z"}
{"parentUuid":"bd09046d-f714-470f-8451-6d299b6ec303","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_014TxTJeE78w35KYwEab1W4f","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012hNZa6y2vmnbfxnh4rE2M8","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","old_string":"import { Strength, Flaw } from '@/types/results';\nimport { MetricScoreResult, METRIC_CONFIGS, isValueAcceptable } from '@/lib/harmony-scoring';","new_string":"import { Strength, Flaw } from '@/types/results';\nimport { MetricScoreResult, METRIC_CONFIGS, isValueAcceptable, ConfidenceLevel } from '@/lib/harmony-scoring';"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":785,"cache_read_input_tokens":132133,"cache_creation":{"ephemeral_5m_input_tokens":785,"ephemeral_1h_input_tokens":0},"output_tokens":275,"service_tier":"standard"}},"requestId":"req_011CWVVDzMfzV155Ry9gqzwQ","type":"assistant","uuid":"e89da394-a050-4edc-804c-bb072b0090d4","timestamp":"2025-12-26T14:52:09.237Z"}
{"parentUuid":"e89da394-a050-4edc-804c-bb072b0090d4","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012hNZa6y2vmnbfxnh4rE2M8","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n    26→ *   9-9.5 = \"Excellent\"\n    27→ *   9.5-10 = \"Ideal\"\n    28→ */\n    29→\n    30→import { Strength, Flaw } from '@/types/results';\n    31→import { MetricScoreResult, METRIC_CONFIGS, isValueAcceptable, ConfidenceLevel } from '@/lib/harmony-scoring';\n    32→\n    33→// ============================================\n    34→// MASTER SCORING DATABASE (Z-Score Based)\n    35→// ============================================"}]},"uuid":"2094213b-6b7b-4b0f-bf9f-e6091af19bec","timestamp":"2025-12-26T14:52:09.301Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","oldString":"import { Strength, Flaw } from '@/types/results';\nimport { MetricScoreResult, METRIC_CONFIGS, isValueAcceptable } from '@/lib/harmony-scoring';","newString":"import { Strength, Flaw } from '@/types/results';\nimport { MetricScoreResult, METRIC_CONFIGS, isValueAcceptable, ConfidenceLevel } from '@/lib/harmony-scoring';","originalFile":"/**\n * Insights Engine\n *\n * Processes insight definitions from insights.json and classifies them\n * as strengths or areas of improvement based on user's metric scores.\n *\n * Logic:\n * - For each insight definition, calculate average score of affected metrics\n * - Weakness: if avg score < threshold → classify with severity label\n * - Strength: if avg score > threshold → classify with grade label\n *\n * Z-Score Based 5-Tier Severity Logic:\n * - Ideal (Green): User is inside the ideal range\n * - Good (Blue): Within 0.5 Standard Deviation of the mean (|z| < 0.5)\n * - Fair (Cyan): Between 0.5 and 1 Standard Deviation (0.5 ≤ |z| < 1)\n * - Moderate (Yellow): Between 1 and 2 Standard Deviations (1 ≤ |z| < 2)\n * - Severe (Red): More than 2 Standard Deviations away (|z| ≥ 2)\n *\n * Severity Labels (Weaknesses):\n *   0-3 = \"Severe\"\n *   3-5 = \"Moderate\"\n *   5-7 = \"Minor\"\n *\n * Grade Labels (Strengths):\n *   8-9   = \"Good\"\n *   9-9.5 = \"Excellent\"\n *   9.5-10 = \"Ideal\"\n */\n\nimport { Strength, Flaw } from '@/types/results';\nimport { MetricScoreResult, METRIC_CONFIGS, isValueAcceptable } from '@/lib/harmony-scoring';\n\n// ============================================\n// MASTER SCORING DATABASE (Z-Score Based)\n// ============================================\n\nexport type SeverityLevel = 'ideal' | 'good' | 'fair' | 'moderate' | 'severe';\nexport type Gender = 'male' | 'female';\nexport type Ethnicity = 'white' | 'black' | 'east_asian' | 'south_asian' | 'hispanic' | 'middle_eastern' | 'native_american' | 'pacific_islander';\n\nexport interface MasterMetricConfig {\n  ideal: [number, number];  // [min, max] ideal range\n  mean: number;             // Population mean\n  std_dev: number;          // Standard deviation\n  flaws?: {\n    low?: string[];         // Flaws when value is too low\n    high?: string[];        // Flaws when value is too high\n  };\n}\n\n// Base/Default standards (White Male baseline)\nexport const MASTER_SCORING_DB: Record<string, MasterMetricConfig> = {\n  // MIDFACE & PROPORTIONS\n  \"midface_ratio\": {\n    ideal: [0.97, 1.00],\n    mean: 1.0,\n    std_dev: 0.115,\n    flaws: { low: [\"Long midface\", \"Long upper jaw\"] }\n  },\n  \"faceWidthToHeight\": {\n    ideal: [1.30, 1.45],\n    mean: 1.38,\n    std_dev: 0.08,\n    flaws: {\n      low: [\"Overly long face\", \"Narrow face\"],\n      high: [\"Wide face\", \"Short face\"]\n    }\n  },\n  \"totalFacialWidthToHeight\": {\n    ideal: [1.25, 1.40],\n    mean: 1.33,\n    std_dev: 0.075,\n    flaws: {\n      low: [\"Long face shape\"],\n      high: [\"Wide face shape\"]\n    }\n  },\n  \"upperThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short forehead\"],\n      high: [\"Long forehead\"]\n    }\n  },\n  \"middleThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short midface\"],\n      high: [\"Long midface\"]\n    }\n  },\n  \"lowerThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short lower face\"],\n      high: [\"Long lower face\"]\n    }\n  },\n\n  // EYE SPACING & IPD\n  \"eye_separation_ratio\": {\n    ideal: [0.45, 0.47],\n    mean: 0.46,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"interpupillaryRatio\": {\n    ideal: [0.44, 0.48],\n    mean: 0.46,\n    std_dev: 0.025,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"oneEyeApartTest\": {\n    ideal: [0.95, 1.05],\n    mean: 1.0,\n    std_dev: 0.08,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"intercanthalWidth\": {\n    ideal: [30, 35],\n    mean: 32.5,\n    std_dev: 2.5,\n    flaws: {\n      low: [\"Narrow eye spacing\"],\n      high: [\"Wide eye spacing\"]\n    }\n  },\n\n  // EYE SHAPE & FEATURES\n  \"lateralCanthalTilt\": {\n    ideal: [6, 8],\n    mean: 5.0,\n    std_dev: 3.5,\n    flaws: {\n      low: [\"Negative canthal tilt\", \"Downturned eyes\"],\n      high: [\"Excessively upturned eyes\"]\n    }\n  },\n  \"eyeAspectRatio\": {\n    ideal: [0.30, 0.35],\n    mean: 0.32,\n    std_dev: 0.04,\n    flaws: {\n      low: [\"Narrow eyes\"],\n      high: [\"Round eyes\"]\n    }\n  },\n  \"palpebralFissureLength\": {\n    ideal: [28, 32],\n    mean: 30.0,\n    std_dev: 2.5,\n    flaws: {\n      low: [\"Small eyes\"],\n      high: [\"Large eyes\"]\n    }\n  },\n  \"eyeWidth\": {\n    ideal: [28, 32],\n    mean: 30.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Narrow eyes\"],\n      high: [\"Wide eyes\"]\n    }\n  },\n  \"upperEyelidExposure\": {\n    ideal: [0.5, 1.2],\n    mean: 0.85,\n    std_dev: 0.35,\n    flaws: {\n      low: [\"Hooded eyes\"],\n      high: [\"Excessive upper lid exposure\"]\n    }\n  },\n  \"tearTroughDepth\": {\n    ideal: [0.0, 0.3],\n    mean: 0.15,\n    std_dev: 0.15,\n    flaws: {\n      high: [\"Dark circles / Tear troughs\", \"Under-eye hollowness\"]\n    }\n  },\n\n  // JAW ANGLES & STRUCTURE\n  \"gonial_angle\": {\n    ideal: [115, 125],\n    mean: 118.0,\n    std_dev: 6.5,\n    flaws: {\n      high: [\"Weak/soft jaw structure\", \"Rounded jaw\"]\n    }\n  },\n  \"mandibularPlaneAngle\": {\n    ideal: [20, 28],\n    mean: 24.0,\n    std_dev: 4.0,\n    flaws: {\n      low: [\"Flat mandibular plane\"],\n      high: [\"Steep mandibular plane\", \"Hyper-divergent jaw\"]\n    }\n  },\n  \"jawFrontalAngle\": {\n    ideal: [125, 135],\n    mean: 130.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Steep jaw\"],\n      high: [\"Flat jaw angle\"]\n    }\n  },\n  \"jawSlope\": {\n    ideal: [25, 35],\n    mean: 30.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat jawline\"],\n      high: [\"Steep jawline\"]\n    }\n  },\n\n  // JAW WIDTH\n  \"jawWidthRatio\": {\n    ideal: [0.85, 0.95],\n    mean: 0.90,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Narrow jaw\"],\n      high: [\"Wide jaw\"]\n    }\n  },\n  \"bigonialWidth\": {\n    ideal: [110, 125],\n    mean: 117.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow jaw width\"],\n      high: [\"Excessively wide jaw\"]\n    }\n  },\n\n  // CHEEKBONES\n  \"cheekbone_height\": {\n    ideal: [83.0, 100.0],\n    mean: 85.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Low-set cheekbones\", \"Flat midface\"]\n    }\n  },\n  \"cheekboneWidth\": {\n    ideal: [130, 145],\n    mean: 137.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow cheekbones\"],\n      high: [\"Wide cheekbones\"]\n    }\n  },\n\n  // CHIN\n  \"chinPhiltrumRatio\": {\n    ideal: [1.8, 2.2],\n    mean: 2.0,\n    std_dev: 0.2,\n    flaws: {\n      low: [\"Recessed chin\", \"Short chin\"],\n      high: [\"Long chin\", \"Projected chin\"]\n    }\n  },\n  \"chinHeight\": {\n    ideal: [35, 45],\n    mean: 40.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Short chin\"],\n      high: [\"Long chin\"]\n    }\n  },\n  \"chinWidth\": {\n    ideal: [35, 45],\n    mean: 40.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Pointed/Narrow chin\"],\n      high: [\"Wide chin\"]\n    }\n  },\n\n  // NOSE ANGLES\n  \"nasalTipAngle\": {\n    ideal: [95, 115],\n    mean: 105.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Droopy nasal tip\"],\n      high: [\"Upturned nasal tip\"]\n    }\n  },\n  \"nasolabialAngle\": {\n    ideal: [95, 110],\n    mean: 102.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Droopy nasal tip\"],\n      high: [\"Upturned nose\"]\n    }\n  },\n  \"nasofrontalAngle\": {\n    ideal: [115, 135],\n    mean: 125.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Deep nasal root\"],\n      high: [\"Flat nasal root\"]\n    }\n  },\n  \"nasofacialAngle\": {\n    ideal: [30, 40],\n    mean: 35.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat nose profile\"],\n      high: [\"Overprojected nose\"]\n    }\n  },\n  \"nasomentaAngle\": {\n    ideal: [120, 135],\n    mean: 127.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Convex profile\"],\n      high: [\"Concave profile\"]\n    }\n  },\n\n  // NOSE WIDTH & PROPORTIONS\n  \"nasalIndex\": {\n    ideal: [65, 75],\n    mean: 70.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Narrow nose\"],\n      high: [\"Wide nose\", \"Bulbous nose\"]\n    }\n  },\n  \"noseWidth\": {\n    ideal: [35, 42],\n    mean: 38.5,\n    std_dev: 3.5,\n    flaws: {\n      low: [\"Narrow nose\"],\n      high: [\"Wide nasal base\"]\n    }\n  },\n  \"noseBridgeWidth\": {\n    ideal: [12, 18],\n    mean: 15.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Narrow nose bridge\"],\n      high: [\"Wide nose bridge\"]\n    }\n  },\n  \"nasalProjection\": {\n    ideal: [16, 22],\n    mean: 19.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Underprojected nose\"],\n      high: [\"Overprojected nose\"]\n    }\n  },\n  \"noseLengthRatio\": {\n    ideal: [0.45, 0.55],\n    mean: 0.50,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Short nose\"],\n      high: [\"Long nose\"]\n    }\n  },\n\n  // LIPS & PHILTRUM\n  \"lipRatio\": {\n    ideal: [1.4, 1.6],\n    mean: 1.5,\n    std_dev: 0.15,\n    flaws: {\n      low: [\"Thin upper lip\"],\n      high: [\"Thick upper lip\"]\n    }\n  },\n  \"philtrumLength\": {\n    ideal: [11, 15],\n    mean: 13.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Short philtrum\"],\n      high: [\"Long philtrum\"]\n    }\n  },\n  \"upperLipHeight\": {\n    ideal: [18, 24],\n    mean: 21.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Thin upper lip\"],\n      high: [\"Thick upper lip\"]\n    }\n  },\n  \"lipChinDistance\": {\n    ideal: [40, 50],\n    mean: 45.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Short lower third\"],\n      high: [\"Long lower third\"]\n    }\n  },\n  \"upperLipProjection\": {\n    ideal: [-2, 2],\n    mean: 0.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Recessed upper lip\"],\n      high: [\"Protruding upper lip\"]\n    }\n  },\n  \"lowerLipProjection\": {\n    ideal: [-1, 3],\n    mean: 1.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Recessed lower lip\"],\n      high: [\"Protruding lower lip\"]\n    }\n  },\n  \"cupidsBowDepth\": {\n    ideal: [3, 6],\n    mean: 4.5,\n    std_dev: 1.5,\n    flaws: {\n      low: [\"Flat cupid's bow\"],\n      high: [\"Pronounced cupid's bow\"]\n    }\n  },\n\n  // EYEBROWS\n  \"eyebrowHeight\": {\n    ideal: [8, 14],\n    mean: 11.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Low-set eyebrows\"],\n      high: [\"High eyebrows\"]\n    }\n  },\n  \"browLengthRatio\": {\n    ideal: [0.50, 0.60],\n    mean: 0.55,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Short eyebrows\"],\n      high: [\"Long eyebrows\"]\n    }\n  },\n  \"browLengthToFaceWidth\": {\n    ideal: [0.30, 0.38],\n    mean: 0.34,\n    std_dev: 0.04,\n    flaws: {\n      low: [\"Short eyebrows\"],\n      high: [\"Long eyebrows\"]\n    }\n  },\n  \"browridgeInclinationAngle\": {\n    ideal: [10, 20],\n    mean: 15.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat brow ridge\"],\n      high: [\"Prominent brow ridge\"]\n    }\n  },\n  \"eyebrowThickness\": {\n    ideal: [1.5, 3.0],\n    mean: 2.25,\n    std_dev: 0.75,\n    flaws: {\n      low: [\"Sparse/Weak eyebrows\"],\n      high: [\"Overly thick eyebrows\"]\n    }\n  },\n\n  // FOREHEAD\n  \"foreheadHeight\": {\n    ideal: [55, 70],\n    mean: 62.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Short forehead\"],\n      high: [\"Tall forehead\"]\n    }\n  },\n  \"bitemporalWidth\": {\n    ideal: [120, 135],\n    mean: 127.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow forehead\"],\n      high: [\"Wide forehead\"]\n    }\n  },\n\n  // PROFILE & DEPTH\n  \"facialDepthToHeight\": {\n    ideal: [0.75, 0.85],\n    mean: 0.80,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Flat facial profile\"],\n      high: [\"Overprojected profile\"]\n    }\n  },\n  \"anteriorFacialDepth\": {\n    ideal: [115, 130],\n    mean: 122.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Shallow face depth\"],\n      high: [\"Deep face projection\"]\n    }\n  },\n  \"totalProfileAngle\": {\n    ideal: [165, 175],\n    mean: 170.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Convex profile\"],\n      high: [\"Concave profile\"]\n    }\n  },\n\n  // ASYMMETRY\n  \"facialAsymmetryIndex\": {\n    ideal: [0, 3],\n    mean: 2.0,\n    std_dev: 1.5,\n    flaws: {\n      high: [\"Facial asymmetry\"]\n    }\n  },\n  \"eyeAsymmetry\": {\n    ideal: [0, 2],\n    mean: 1.0,\n    std_dev: 1.0,\n    flaws: {\n      high: [\"Eye asymmetry\"]\n    }\n  },\n  \"jawAsymmetry\": {\n    ideal: [0, 3],\n    mean: 1.5,\n    std_dev: 1.5,\n    flaws: {\n      high: [\"Jaw asymmetry\"]\n    }\n  },\n\n  // OTHER\n  \"recessionFrankfort\": {\n    ideal: [-2, 2],\n    mean: 0.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Maxillary recession\"],\n      high: [\"Maxillary protrusion\"]\n    }\n  },\n  \"neckWidth\": {\n    ideal: [110, 130],\n    mean: 120.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Narrow neck\"],\n      high: [\"Wide neck\"]\n    }\n  },\n  \"neckToJawRatio\": {\n    ideal: [0.90, 1.10],\n    mean: 1.0,\n    std_dev: 0.10,\n    flaws: {\n      low: [\"Narrow neck\"],\n      high: [\"Thick neck\"]\n    }\n  }\n};\n\n// ============================================\n// ETHNICITY-SPECIFIC OVERRIDES\n// ============================================\n\n/**\n * Ethnicity and gender-specific metric standards\n * These override the base MASTER_SCORING_DB values for specific populations\n */\nexport const ETHNICITY_OVERRIDES: Record<string, Record<string, Partial<MasterMetricConfig>>> = {\n  // ========================================\n  // MALE WHITE STANDARDS (Neoclassical Baseline)\n  // ========================================\n  \"male_white\": {\n    // NOSE WIDTH - Strict 1:1 ratio (Eye Width = Nose Width)\n    \"noseWidth\": {\n      ideal: [35, 42],  // Corresponds to alar_base_ratio [0.98, 1.05]\n      mean: 38.5,\n      std_dev: 3.5,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // MIDFACE - Prefers compact midface (Hunter look)\n    \"midface_ratio\": {\n      ideal: [0.95, 1.02],\n      mean: 0.985,\n      std_dev: 0.035,\n      flaws: {\n        low: [\"Long midface\"]\n      }\n    },\n\n    // JAW - Square/Robust jaw preference\n    \"gonial_angle\": {\n      ideal: [115.0, 125.0],\n      mean: 120.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Weak/Soft jaw structure\"]\n      }\n    },\n\n    // FACE WIDTH - Standard Mesoprosopic range\n    \"faceWidthToHeight\": {\n      ideal: [1.90, 2.05],\n      mean: 1.975,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Short/Wide face\"]\n      }\n    },\n\n    // EYE TILT - Neutral to slightly positive\n    \"lateralCanthalTilt\": {\n      ideal: [4.0, 8.0],\n      mean: 6.0,\n      std_dev: 2.0,\n      flaws: {\n        low: [\"Negative canthal tilt\"]\n      }\n    },\n\n    // LOWER FACE BALANCE\n    \"chinPhiltrumRatio\": {\n      ideal: [2.10, 2.30],\n      mean: 2.20,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Long philtrum / Short chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE BLACK / AFRICAN STANDARDS\n  // ========================================\n  \"male_black\": {\n    // NOSE WIDTH - Significantly wider tolerance\n    \"noseWidth\": {\n      ideal: [40, 50],  // Wider range (corresponds to alar_base_ratio [1.12, 1.25])\n      mean: 45.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n    \"nasalIndex\": {\n      ideal: [80, 95],  // Wider nasal index\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        high: [\"Wide nose\"]\n      }\n    },\n\n    // LIPS - Prefers fuller lips\n    \"lipRatio\": {\n      ideal: [1.2, 1.5],\n      mean: 1.35,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    },\n\n    // PHILTRUM - Shorter visible philtrum is ideal\n    \"philtrumLength\": {\n      ideal: [11.0, 14.0],\n      mean: 12.5,\n      std_dev: 1.5,\n      flaws: {\n        high: [\"Long philtrum\"]\n      }\n    },\n\n    // CHIN - Adjusts for natural forward mouth projection (Prognathism)\n    \"chinPhiltrumRatio\": {\n      ideal: [1.80, 2.10],  // Lower range to account for prognathism\n      mean: 1.95,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Recessed chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE EAST ASIAN STANDARDS\n  // ========================================\n  \"male_east_asian\": {\n    // EYE SPACING - Shifted WIDER for East Asian males\n    \"eye_separation_ratio\": {\n      ideal: [0.48, 0.53],  // Shifted wider (0.46 is \"close-set\" here)\n      mean: 0.505,\n      std_dev: 0.025,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Wide-set eyes\"]\n      }\n    },\n    \"interpupillaryRatio\": {\n      ideal: [0.48, 0.53],\n      mean: 0.505,\n      std_dev: 0.025,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Wide-set eyes\"]\n      }\n    },\n\n    // EYE SHAPE - Prefers narrower/longer eyes (Hunter Eyes)\n    \"eyeAspectRatio\": {\n      ideal: [0.25, 0.29],  // Lower ratio = more elongated\n      mean: 0.27,\n      std_dev: 0.02,\n      flaws: {\n        low: [\"Overly narrow eyes\"],\n        high: [\"Overly round eye shape\"]\n      }\n    },\n    \"palpebralFissureLength\": {\n      ideal: [29, 33],\n      mean: 31.0,\n      std_dev: 2.0,\n      flaws: {\n        low: [\"Small eyes\"],\n        high: [\"Large eyes\"]\n      }\n    },\n\n    // NOSE - Asian noses typically allowed to be wider\n    \"nasalIndex\": {\n      ideal: [75, 85],\n      mean: 80.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nose\"]\n      }\n    },\n    \"noseWidth\": {\n      ideal: [38, 45],\n      mean: 41.5,\n      std_dev: 3.5,\n      flaws: {\n        low: [\"Narrow nose\"],\n        high: [\"Very wide nasal base\"]\n      }\n    },\n    \"noseBridgeWidth\": {\n      ideal: [14, 20],\n      mean: 17.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Narrow nose bridge\"],\n        high: [\"Wide nose bridge\"]\n      }\n    },\n\n    // CHEEKS - Rewards slightly fuller cheeks (Youth/K-Pop aesthetic)\n    \"cheekbone_height\": {\n      ideal: [80.0, 95.0],\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Gaunt/Hollow face\"]\n      }\n    },\n\n    // JAW - Slightly softer angles acceptable\n    \"gonial_angle\": {\n      ideal: [118, 128],\n      mean: 123.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Weak/soft jaw structure\"]\n      }\n    },\n    \"mandibularPlaneAngle\": {\n      ideal: [20, 30],\n      mean: 25.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Flat mandibular plane\"],\n        high: [\"Steep mandibular plane\"]\n      }\n    },\n\n    // FACIAL PROPORTIONS - Wider faces more common\n    \"faceWidthToHeight\": {\n      ideal: [1.35, 1.50],\n      mean: 1.425,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n    \"totalFacialWidthToHeight\": {\n      ideal: [1.30, 1.45],\n      mean: 1.375,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long face shape\"],\n        high: [\"Wide face shape\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE SOUTH ASIAN STANDARDS\n  // ========================================\n  \"male_south_asian\": {\n    // NOSE WIDTH - Slightly wider tolerance than White\n    \"noseWidth\": {\n      ideal: [36, 43],  // alar_base_ratio [1.00, 1.08]\n      mean: 39.5,\n      std_dev: 3.5,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // TEAR TROUGH - VERY STRICT. High penalty for dark circles\n    \"tearTroughDepth\": {\n      ideal: [0.0, 0.5],\n      mean: 0.25,\n      std_dev: 0.25,\n      flaws: {\n        high: [\"Dark circles / Tear troughs\"]\n      }\n    },\n\n    // UPPER EYELID - Often prefers visible lid platform\n    \"upperEyelidExposure\": {\n      ideal: [0.5, 2.0],\n      mean: 1.25,\n      std_dev: 0.75,\n      flaws: {\n        low: [\"Hooded eyes\"]\n      }\n    },\n\n    // CHEEKS - Penalizes \"Gaunt\" looks heavily\n    \"cheekbone_height\": {\n      ideal: [83.0, 95.0],\n      mean: 89.0,\n      std_dev: 6.0,\n      flaws: {\n        low: [\"Volume loss / Gauntness\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE HISPANIC STANDARDS (\"The Bridge Model\")\n  // ========================================\n  \"male_hispanic\": {\n    // FACE WIDTH - Rewards broader, more robust face shapes (Mestizo)\n    \"faceWidthToHeight\": {\n      ideal: [1.95, 2.10],\n      mean: 2.025,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long/Narrow face\"]\n      }\n    },\n\n    // NOSE WIDTH - Bridge tolerance (Wider than White, narrower than Black)\n    \"noseWidth\": {\n      ideal: [36, 44],  // alar_base_ratio [1.00, 1.12]\n      mean: 40.0,\n      std_dev: 4.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // EYE TILT - Strong preference for positive tilt\n    \"lateralCanthalTilt\": {\n      ideal: [6.0, 12.0],\n      mean: 9.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Negative/Neutral canthal tilt\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE MIDDLE EASTERN STANDARDS\n  // ========================================\n  \"male_middle_eastern\": {\n    // EYEBROW THICKNESS - Prefers significantly thicker/darker brows\n    \"eyebrowThickness\": {\n      ideal: [2.0, 4.0],\n      mean: 3.0,\n      std_dev: 1.0,\n      flaws: {\n        low: [\"Sparse/Weak eyebrows\"],\n        high: [\"Unibrow\"]\n      }\n    },\n\n    // NASOLABIAL ANGLE - Penalizes droopy tip (<90) or hooked noses\n    \"nasolabialAngle\": {\n      ideal: [90.0, 100.0],\n      mean: 95.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Droopy nose tip / Hooked nose\"]\n      }\n    },\n\n    // EYE TILT - Strong preference for Almond/Hunter eye shape\n    \"lateralCanthalTilt\": {\n      ideal: [4.0, 10.0],\n      mean: 7.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    },\n\n    // MIDFACE - Similar to White model (Compact is better)\n    \"midface_ratio\": {\n      ideal: [0.95, 1.02],\n      mean: 0.985,\n      std_dev: 0.035,\n      flaws: {\n        low: [\"Long midface\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE PACIFIC ISLANDER STANDARDS (\"The Warrior Skull\")\n  // ========================================\n  \"male_pacific_islander\": {\n    // FACE WIDTH - The Highest Width Standard (Very broad)\n    \"faceWidthToHeight\": {\n      ideal: [2.10, 2.30],\n      mean: 2.20,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Narrow/Long face\"]\n      }\n    },\n\n    // NOSE WIDTH - Wide tolerance\n    \"noseWidth\": {\n      ideal: [38, 48],  // alar_base_ratio [1.05, 1.20]\n      mean: 43.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // CHEEKS - Rewards high mass/robustness\n    \"cheekbone_height\": {\n      ideal: [85.0, 100.0],\n      mean: 92.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Gaunt/Weak face structure\"]\n      }\n    },\n\n    // CHIN WIDTH - Prefers a very broad, square chin\n    \"chinWidth\": {\n      ideal: [40.0, 50.0],\n      mean: 45.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Pointed/Narrow chin\"]\n      }\n    }\n  },\n\n  \"male_native_american\": {\n    \"faceWidthToHeight\": {\n      ideal: [2.00, 2.20],\n      mean: 2.10,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Wide face\"]\n      }\n    },\n\n    \"nasalIndex\": {\n      ideal: [75, 90],\n      mean: 82.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Narrow nose\"],\n        high: [\"Wide nose\"]\n      }\n    },\n\n    \"cheekbone_height\": {\n      ideal: [80.0, 95.0],\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Flat cheekbones\"]\n      }\n    },\n\n    \"gonialAngle\": {\n      ideal: [115, 125],\n      mean: 120,\n      std_dev: 5,\n      flaws: {\n        low: [\"Weak jaw\"],\n        high: [\"Harsh jaw angle\"]\n      }\n    },\n\n    \"chinWidth\": {\n      ideal: [38.0, 48.0],\n      mean: 43.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Narrow chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // FEMALE ETHNICITIES (The \"Missing Link\")\n  // ========================================\n\n  \"female_white\": {\n    // NOSE WIDTH - Strict Rule of Fifths for feminine harmony\n    \"alar_base_ratio\": {\n      ideal: [0.98, 1.05],\n      mean: 1.015,\n      std_dev: 0.035,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // FACE WIDTH - Prefers oval/narrow feminine proportions\n    \"fwhr\": {\n      ideal: [1.45, 1.53],\n      mean: 1.49,\n      std_dev: 0.04,\n      flaws: {\n        low: [\"Long/Narrow face\"],\n        high: [\"Wide face\"]\n      }\n    },\n\n    // JAW - Soft, tapered feminine jawline\n    \"gonial_angle\": {\n      ideal: [122.0, 130.0],\n      mean: 126.0,\n      std_dev: 4.0,\n      flaws: {\n        low: [\"Sharp/Masculine jaw angle\"],\n        high: [\"Weak/Overly soft jawline\"]\n      }\n    },\n\n    // EYE TILT - Neutral to positive preferred\n    \"canthal_tilt\": {\n      ideal: [4.0, 9.0],\n      mean: 6.5,\n      std_dev: 2.5,\n      flaws: {\n        low: [\"Negative/Downturned eyes\"]\n      }\n    },\n\n    // CHIN-PHILTRUM - Golden Ratio balance\n    \"chin_philtrum_ratio\": {\n      ideal: [2.0, 2.2],\n      mean: 2.1,\n      std_dev: 0.1,\n      flaws: {\n        low: [\"Recessed chin\"],\n        high: [\"Protruding chin\"]\n      }\n    }\n  },\n\n  \"female_black\": {\n    // LIPS - High volume preference (fuller lips)\n    \"lipRatio\": {\n      ideal: [1.3, 1.6],\n      mean: 1.45,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    },\n\n    // NOSE WIDTH - Wider tolerance for ethnic variation\n    \"alar_base_ratio\": {\n      ideal: [1.05, 1.15],\n      mean: 1.10,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Very wide nasal base\"]\n      }\n    },\n\n    // CHIN - Allows forward projection (natural prognathism)\n    \"chin_projection\": {\n      ideal: [0.0, 5.0],\n      mean: 2.5,\n      std_dev: 2.5,\n      flaws: {\n        high: [\"Excessive chin projection\"]\n      }\n    },\n\n    // JAW - Soft feminine jawline\n    \"gonial_angle\": {\n      ideal: [120.0, 130.0],\n      mean: 125.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Sharp jaw angle\"],\n        high: [\"Weak jawline\"]\n      }\n    }\n  },\n\n  \"female_east_asian\": {\n    // EYE SPACING - Wide-set neotenous preference\n    \"eye_separation_ratio\": {\n      ideal: [46.3, 47.5],\n      mean: 46.9,\n      std_dev: 0.6,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Very wide-set eyes\"]\n      }\n    },\n\n    // JAW - Tapered V-shape feminine ideal\n    \"gonial_angle\": {\n      ideal: [120.0, 126.0],\n      mean: 123.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Sharp V-line jaw\"],\n        high: [\"Weak/Square jawline\"]\n      }\n    },\n\n    // EYEBROWS - Higher set brows (youthful feminine)\n    \"eyebrow_height\": {\n      ideal: [0.85, 1.30],\n      mean: 1.075,\n      std_dev: 0.225,\n      flaws: {\n        low: [\"Low-set/Heavy brows\"],\n        high: [\"Very high-arched brows\"]\n      }\n    },\n\n    // LOWER FACE - Compact lower third (neotenous)\n    \"lower_third_ratio\": {\n      ideal: [29.6, 32.7],\n      mean: 31.15,\n      std_dev: 1.55,\n      flaws: {\n        low: [\"Very short lower face\"],\n        high: [\"Long lower face\"]\n      }\n    }\n  },\n\n  \"female_south_asian\": {\n    // TEAR TROUGHS - Very strict on dark circles\n    \"tear_trough_depth\": {\n      ideal: [0.0, 0.5],\n      mean: 0.25,\n      std_dev: 0.25,\n      flaws: {\n        high: [\"Dark circles / Deep tear troughs\"]\n      }\n    },\n\n    // CHEEKS - Rewards midface volume (youthful fullness)\n    \"cheek_fullness\": {\n      ideal: [1.0, 2.0],\n      mean: 1.5,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Gaunt/Hollow cheeks\"]\n      }\n    },\n\n    // SKIN - High penalty for uneven skin tone\n    \"skin_uniformity\": {\n      ideal: [0.92, 1.0],\n      mean: 0.96,\n      std_dev: 0.04,\n      flaws: {\n        low: [\"Uneven skin tone / Pigmentation\"]\n      }\n    },\n\n    // NOSE WIDTH - Intermediate tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.00, 1.08],\n      mean: 1.04,\n      std_dev: 0.04,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    }\n  },\n\n  \"female_hispanic\": {\n    // FACE WIDTH - Broader Mestiza tolerance\n    \"fwhr\": {\n      ideal: [1.50, 1.62],\n      mean: 1.56,\n      std_dev: 0.06,\n      flaws: {\n        low: [\"Long/Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // EYE TILT - Strong almond eye preference\n    \"canthal_tilt\": {\n      ideal: [6.0, 12.0],\n      mean: 9.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Neutral/Downturned eyes\"]\n      }\n    },\n\n    // NOSE WIDTH - Intermediate width tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.00, 1.10],\n      mean: 1.05,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // LIPS - Voluptuous preference\n    \"lipRatio\": {\n      ideal: [1.1, 1.35],\n      mean: 1.225,\n      std_dev: 0.125,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    }\n  },\n\n  \"female_middle_eastern\": {\n    // EYEBROWS - Dense/Thick brows preference\n    \"eyebrow_thickness\": {\n      ideal: [1.5, 3.0],\n      mean: 2.25,\n      std_dev: 0.75,\n      flaws: {\n        low: [\"Sparse/Thin eyebrows\"],\n        high: [\"Unibrow\"]\n      }\n    },\n\n    // NOSE - Refined/Upturned tip\n    \"nasolabial_angle\": {\n      ideal: [95.0, 105.0],\n      mean: 100.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Droopy nose tip\"],\n        high: [\"Overly upturned nose\"]\n      }\n    },\n\n    // EYE TILT - Foxy/Hunter feminine eye shape\n    \"canthal_tilt\": {\n      ideal: [5.0, 10.0],\n      mean: 7.5,\n      std_dev: 2.5,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    },\n\n    // EYELID - Low exposure preferred\n    \"upper_eyelid_exposure\": {\n      ideal: [0.5, 1.5],\n      mean: 1.0,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Hooded eyes\"],\n        high: [\"Excessive eyelid exposure\"]\n      }\n    }\n  },\n\n  \"female_native_american\": {\n    // FACE WIDTH - Wide/High cheekbone structure\n    \"fwhr\": {\n      ideal: [1.52, 1.65],\n      mean: 1.585,\n      std_dev: 0.065,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // CHEEKBONES - High definition/prominence\n    \"cheekbone_prominence\": {\n      ideal: [1.5, 2.5],\n      mean: 2.0,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Flat cheekbones\"],\n        high: [\"Overly prominent cheekbones\"]\n      }\n    },\n\n    // JAW - Stronger jaw tolerance\n    \"gonial_angle\": {\n      ideal: [115.0, 125.0],\n      mean: 120.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Very sharp jaw\"],\n        high: [\"Weak jawline\"]\n      }\n    },\n\n    // EYE TILT - Positive tilt preference\n    \"canthal_tilt\": {\n      ideal: [5.0, 11.0],\n      mean: 8.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    }\n  },\n\n  \"female_pacific_islander\": {\n    // FACE WIDTH - Widest/Robust facial structure\n    \"fwhr\": {\n      ideal: [1.55, 1.70],\n      mean: 1.625,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // CHEEKS - High volume/softness preference\n    \"cheek_fullness\": {\n      ideal: [1.2, 2.5],\n      mean: 1.85,\n      std_dev: 0.65,\n      flaws: {\n        low: [\"Gaunt/Hollow cheeks\"]\n      }\n    },\n\n    // NOSE WIDTH - Wide nose tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.05, 1.15],\n      mean: 1.10,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Very wide nasal base\"]\n      }\n    },\n\n    // LIPS - Full lips preference\n    \"lipRatio\": {\n      ideal: [1.25, 1.50],\n      mean: 1.375,\n      std_dev: 0.125,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    }\n  }\n};\n\n/**\n * Get the appropriate metric configuration for a given gender and ethnicity\n * Falls back to base config if no override exists\n */\nexport function getMetricConfig(\n  metricId: string,\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'white'\n): MasterMetricConfig | undefined {\n  const key = `${gender}_${ethnicity}`;\n  const override = ETHNICITY_OVERRIDES[key]?.[metricId];\n  const baseConfig = MASTER_SCORING_DB[metricId];\n\n  if (!baseConfig) return undefined;\n\n  // Merge override with base config\n  if (override) {\n    return {\n      ...baseConfig,\n      ...override,\n      flaws: {\n        ...baseConfig.flaws,\n        ...override.flaws\n      }\n    } as MasterMetricConfig;\n  }\n\n  return baseConfig;\n}\n\n// ============================================\n// Z-SCORE SEVERITY FUNCTIONS\n// ============================================\n\n/**\n * Calculate Z-score for a given value\n * Z = (value - mean) / std_dev\n */\nexport function calculateZScore(value: number, mean: number, stdDev: number): number {\n  if (stdDev === 0) return 0;\n  return Math.abs((value - mean) / stdDev);\n}\n\n/**\n * Determine severity level based on Z-score and ideal range (5-tier system)\n * - Ideal: Value is within ideal range\n * - Good: |z| < 0.5 (within 0.5 standard deviation)\n * - Fair: 0.5 ≤ |z| < 1 (between 0.5-1 standard deviations)\n * - Moderate: 1 ≤ |z| < 2 (between 1-2 standard deviations)\n * - Severe: |z| ≥ 2 (more than 2 standard deviations away)\n */\nexport function getSeverityFromZScore(\n  value: number,\n  config: MasterMetricConfig\n): { severity: SeverityLevel; zScore: number; isInIdeal: boolean } {\n  const { ideal, mean, std_dev } = config;\n  const isInIdeal = value >= ideal[0] && value <= ideal[1];\n  const zScore = calculateZScore(value, mean, std_dev);\n\n  let severity: SeverityLevel;\n  if (isInIdeal) {\n    severity = 'ideal';\n  } else if (zScore < 0.5) {\n    severity = 'good';\n  } else if (zScore < 1) {\n    severity = 'fair';\n  } else if (zScore < 2) {\n    severity = 'moderate';\n  } else {\n    severity = 'severe';\n  }\n\n  return { severity, zScore, isInIdeal };\n}\n\n/**\n * Get severity for a metric value with ethnicity/gender awareness\n */\nexport function getSeverityForMetric(\n  metricId: string,\n  value: number,\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'white'\n): { severity: SeverityLevel; zScore: number; isInIdeal: boolean; config: MasterMetricConfig } | null {\n  const config = getMetricConfig(metricId, gender, ethnicity);\n  if (!config) return null;\n\n  const result = getSeverityFromZScore(value, config);\n  return { ...result, config };\n}\n\n/**\n * Get badge color for severity level (5-tier)\n */\nexport function getSeverityColor(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'green';\n    case 'good': return 'blue';\n    case 'fair': return 'cyan';\n    case 'moderate': return 'yellow';\n    case 'severe': return 'red';\n    default: return 'gray';\n  }\n}\n\n/**\n * Get severity label for display (5-tier)\n */\nexport function getSeverityLabel(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'Ideal';\n    case 'good': return 'Good';\n    case 'fair': return 'Fair';\n    case 'moderate': return 'Moderate';\n    case 'severe': return 'Severe';\n    default: return 'Unknown';\n  }\n}\n\n// ============================================\n// INSIGHT DEFINITION TYPES\n// ============================================\n\nexport interface InsightSeverityLogic {\n  metrics: string[];  // Display names of metrics (e.g., \"Face Width to Height Ratio\")\n  threshold: number;  // Score threshold for classification\n}\n\nexport interface WeaknessSeverityLabels {\n  minor: string;\n  moderate: string;\n  severe: string;\n}\n\nexport interface StrengthGradeLabels {\n  good: string;\n  excellent: string;\n  ideal: string;\n}\n\nexport interface InsightContent {\n  description: string;\n  severity_labels?: WeaknessSeverityLabels;  // For weaknesses\n  grade_labels?: StrengthGradeLabels;        // For strengths\n}\n\nexport interface InsightDefinition {\n  id: string;\n  title: string;\n  type: 'weakness' | 'strength';\n  severity_logic: InsightSeverityLogic;\n  content: InsightContent;\n}\n\n// ============================================\n// CLASSIFICATION RESULT TYPES\n// ============================================\n\nexport type WeaknessSeverity = 'severe' | 'moderate' | 'minor';\nexport type StrengthGrade = 'ideal' | 'excellent' | 'good';\n\nexport interface ClassifiedWeakness {\n  insightId: string;\n  title: string;\n  description: string;\n  severity: WeaknessSeverity;\n  severityLabel: string;  // Custom label from definition (e.g., \"Extremely Long\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n}\n\nexport interface ClassifiedStrength {\n  insightId: string;\n  title: string;\n  description: string;\n  grade: StrengthGrade;\n  gradeLabel: string;  // Custom label from definition (e.g., \"Ideal\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n}\n\nexport interface MatchedMetric {\n  metricId: string;\n  metricName: string;\n  score: number;\n  value: number;\n  idealMin: number;\n  idealMax: number;\n  unit: string;\n  category: string;\n}\n\nexport interface InsightClassificationResult {\n  strengths: ClassifiedStrength[];\n  weaknesses: ClassifiedWeakness[];\n}\n\n// ============================================\n// INSIGHTS DATABASE\n// ============================================\n\nexport const INSIGHTS_DEFINITIONS: InsightDefinition[] = [\n  {\n    id: \"long_midface\",\n    title: \"Long Midface\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\", \"Ipsilateral Alar Angle\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The middle of the face is elongated, creating an unbalanced vertical proportion.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Extremely Long\" }\n    }\n  },\n  {\n    id: \"short_midface\",\n    title: \"Short Midface\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The midface has ideal vertical proportions, contributing to facial harmony.\",\n      grade_labels: { good: \"Proportionate\", excellent: \"Well-Balanced\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"weak_jaw\",\n    title: \"Weak/Soft Jaw Structure\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Chin to Philtrum Ratio\", \"Jaw Slope\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The jaw has a softer, rounder shape, often less angular and robust than the ideal.\",\n      severity_labels: { minor: \"Soft\", moderate: \"Recessed\", severe: \"Weak\" }\n    }\n  },\n  {\n    id: \"strong_jaw\",\n    title: \"Strong Jaw Definition\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Jaw Width Ratio\", \"Bigonial Width\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The jaw displays strong definition with well-defined angles and proportionate width.\",\n      grade_labels: { good: \"Defined\", excellent: \"Strong\", ideal: \"Ideal Angular\" }\n    }\n  },\n  {\n    id: \"refined_nasal_tip\",\n    title: \"Refined Nasal Tip\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasal Tip Angle\", \"Nose Tip Position\", \"Frankfort-tip Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious nasal profile due to the nasal tip being well-defined and proportionate.\",\n      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"bulbous_nose\",\n    title: \"Bulbous Nasal Tip\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Index\", \"Nose Width\", \"Nasal Tip Angle\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nasal tip appears rounded and less defined, affecting nasal aesthetics.\",\n      severity_labels: { minor: \"Slightly Rounded\", moderate: \"Rounded\", severe: \"Bulbous\" }\n    }\n  },\n  {\n    id: \"ideal_upper_lip\",\n    title: \"Well-Positioned Upper Lip\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Upper Lip E-Line Position\", \"Upper Lip S-Line Position\", \"Nasolabial Angle\"],\n      threshold: 9.0\n    },\n    content: {\n      description: \"This contributes to a harmonious mouth region due to the upper lip sitting neither too far forward nor too far back.\",\n      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"negative_canthal_tilt\",\n    title: \"Negative Canthal Tilt\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The outer corners of the eyes sit lower than the inner corners, creating a downturned appearance.\",\n      severity_labels: { minor: \"Slight Downturn\", moderate: \"Noticeable\", severe: \"Pronounced\" }\n    }\n  },\n  {\n    id: \"positive_canthal_tilt\",\n    title: \"Positive Canthal Tilt\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The outer corners of the eyes are elevated, creating an attractive upswept eye shape.\",\n      grade_labels: { good: \"Slight Upturn\", excellent: \"Well-Tilted\", ideal: \"Hunter Eyes\" }\n    }\n  },\n  {\n    id: \"balanced_facial_thirds\",\n    title: \"Balanced Facial Thirds\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face displays well-balanced vertical proportions across all three facial thirds.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfectly Proportioned\" }\n    }\n  },\n  {\n    id: \"imbalanced_thirds\",\n    title: \"Facial Third Imbalance\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The vertical face proportions show imbalance between the three facial thirds.\",\n      severity_labels: { minor: \"Slight Imbalance\", moderate: \"Noticeable Disproportion\", severe: \"Significant Imbalance\" }\n    }\n  },\n  {\n    id: \"high_cheekbones\",\n    title: \"High Cheekbones\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Cheekbone Height\", \"Cheekbone Width\", \"Midface Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"Well-positioned cheekbones that create attractive facial contours and catch light beautifully.\",\n      grade_labels: { good: \"Visible\", excellent: \"Prominent\", ideal: \"Model-Tier\" }\n    }\n  },\n  {\n    id: \"flat_midface\",\n    title: \"Flat Midface\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Cheekbone Height\", \"Midface Ratio\", \"Total Facial Width to Height\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The midface lacks forward projection, resulting in flatter facial contours.\",\n      severity_labels: { minor: \"Slightly Flat\", moderate: \"Underprojected\", severe: \"Recessed\" }\n    }\n  },\n  {\n    id: \"ideal_lip_ratio\",\n    title: \"Ideal Lip Proportions\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Lip Ratio\", \"Philtrum Length\", \"Lip Chin Distance\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The lips demonstrate excellent proportions with balanced upper-to-lower lip ratio.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Well-Proportioned\", ideal: \"Perfect Ratio\" }\n    }\n  },\n  {\n    id: \"thin_lips\",\n    title: \"Thin Lip Profile\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Lip Ratio\", \"Upper Lip Projection\", \"Lower Lip Projection\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The lips appear thinner than ideal proportions, affecting lower face harmony.\",\n      severity_labels: { minor: \"Slightly Thin\", moderate: \"Thin\", severe: \"Very Thin\" }\n    }\n  },\n  {\n    id: \"ideal_ipd\",\n    title: \"Ideal Eye Spacing\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The eyes are ideally spaced, creating facial balance and attractiveness.\",\n      grade_labels: { good: \"Good Spacing\", excellent: \"Ideal Distance\", ideal: \"Perfect IPD\" }\n    }\n  },\n  {\n    id: \"wide_set_eyes\",\n    title: \"Wide-Set Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes are spaced wider apart than the aesthetic ideal.\",\n      severity_labels: { minor: \"Slightly Wide\", moderate: \"Noticeably Wide\", severe: \"Very Wide\" }\n    }\n  },\n  {\n    id: \"close_set_eyes\",\n    title: \"Close-Set Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"Intercanthal Width\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes are positioned closer together than the aesthetic ideal.\",\n      severity_labels: { minor: \"Slightly Close\", moderate: \"Noticeably Close\", severe: \"Very Close\" }\n    }\n  },\n  {\n    id: \"ideal_nose_projection\",\n    title: \"Ideal Nasal Projection\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasofrontal Angle\", \"Nasofacial Angle\", \"Nasomenta Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The nose has ideal forward projection relative to the face, creating profile harmony.\",\n      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect Projection\" }\n    }\n  },\n  {\n    id: \"recessed_chin\",\n    title: \"Recessed Chin\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Facial Depth to Height\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The chin sits behind the ideal position, affecting profile balance.\",\n      severity_labels: { minor: \"Slightly Recessed\", moderate: \"Recessed\", severe: \"Severely Recessed\" }\n    }\n  },\n  {\n    id: \"ideal_chin_projection\",\n    title: \"Ideal Chin Projection\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Anterior Facial Depth\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The chin demonstrates ideal projection and proportions relative to the face.\",\n      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect\" }\n    }\n  },\n  {\n    id: \"long_philtrum\",\n    title: \"Long Philtrum\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Philtrum Length\", \"Lip Chin Distance\", \"Upper Lip Height\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The distance between nose and upper lip is longer than ideal.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n    }\n  },\n  {\n    id: \"short_philtrum\",\n    title: \"Short Philtrum\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Philtrum Length\", \"Upper Lip Height\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The philtrum has ideal or shorter length, considered youthful and attractive.\",\n      grade_labels: { good: \"Good Length\", excellent: \"Short\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"wide_nose\",\n    title: \"Wide Nasal Base\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Index\", \"Intercanthal Nasal Ratio\", \"Nose Bridge Width\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The base of the nose is wider than the aesthetic ideal for facial harmony.\",\n      severity_labels: { minor: \"Slightly Wide\", moderate: \"Wide\", severe: \"Very Wide\" }\n    }\n  },\n  {\n    id: \"ideal_brow_position\",\n    title: \"Ideal Brow Position\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Eyebrow Height\", \"Brow Length Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The eyebrows are ideally positioned relative to the eyes and facial structure.\",\n      grade_labels: { good: \"Good Position\", excellent: \"Well-Arched\", ideal: \"Perfect Frame\" }\n    }\n  },\n  {\n    id: \"narrow_jaw\",\n    title: \"Narrow Jaw\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Jaw Width Ratio\", \"Bigonial Width\", \"Jaw Frontal Angle\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The jaw is narrower than ideal, affecting lower face width and definition.\",\n      severity_labels: { minor: \"Slightly Narrow\", moderate: \"Narrow\", severe: \"Very Narrow\" }\n    }\n  },\n  {\n    id: \"steep_mandibular_plane\",\n    title: \"Steep Mandibular Plane\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The mandibular plane angle is steeper than ideal, often indicating vertical growth pattern.\",\n      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n    }\n  },\n  // ============================================\n  // INSIGHT DEFINITIONS (element.html / element1.html)\n  // ============================================\n  // --- WEAKNESSES ---\n  {\n    id: \"steep_jaw\",\n    title: \"Steep Jaw\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Jaw Frontal Angle\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The jaw angles sharply downward, creating a narrow or pointed chin effect.\",\n      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n    }\n  },\n  {\n    id: \"maxillary_recession\",\n    title: \"Maxillary Recession\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Facial Depth to Height Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The upper jaw is less forward than ideal, reducing midface projection and facial harmony.\",\n      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n    }\n  },\n  {\n    id: \"mandibular_recession\",\n    title: \"Mandibular Recession\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The lower jaw is set back, creating a less prominent chin and an unbalanced profile.\",\n      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n    }\n  },\n  {\n    id: \"underprojected_chin\",\n    title: \"Underprojected Chin\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\", \"Chin Height\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The chin lacks forward projection, creating a weak lower face appearance.\",\n      severity_labels: { minor: \"Slightly Weak\", moderate: \"Underprojected\", severe: \"Severely Underprojected\" }\n    }\n  },\n  {\n    id: \"overly_long_face\",\n    title: \"Overly Long Face Shape\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Total Facial Width to Height Ratio\", \"Face Width to Height Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The face is excessively tall and narrow, creating an elongated appearance.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n    }\n  },\n  {\n    id: \"hyper_divergent_jaw\",\n    title: \"Hyper-Divergent Jaw Growth\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The jaw grows with an overly steep angle, resulting in a long or narrow lower face. This can indicate malocclusion.\",\n      severity_labels: { minor: \"Mildly Divergent\", moderate: \"Divergent\", severe: \"Hyper-Divergent\" }\n    }\n  },\n  {\n    id: \"weak_brow_ridge\",\n    title: \"Soft/Weak Brow Ridge\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Browridge Inclination Angle\", \"Eyebrow Height\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The forehead has a softer, less prominent ridge than the ideal, reducing masculine definition.\",\n      severity_labels: { minor: \"Slightly Soft\", moderate: \"Soft\", severe: \"Very Weak\" }\n    }\n  },\n  {\n    id: \"droopy_nasal_tip\",\n    title: \"Droopy Nasal Tip\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\", \"Nasofacial Angle\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nasal tip points downward more than ideal, creating a drooping appearance.\",\n      severity_labels: { minor: \"Slightly Droopy\", moderate: \"Droopy\", severe: \"Very Droopy\" }\n    }\n  },\n  {\n    id: \"overprojected_nose\",\n    title: \"Overprojected Nose\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Projection\", \"Nasofacial Angle\", \"Nose Length Ratio\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nose projects too far forward relative to the face, creating imbalance.\",\n      severity_labels: { minor: \"Slightly Projected\", moderate: \"Overprojected\", severe: \"Very Overprojected\" }\n    }\n  },\n  {\n    id: \"small_eyes\",\n    title: \"Small Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Eye Aspect Ratio\", \"Palpebral Fissure Length\", \"Eye Width\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes appear smaller than the aesthetic ideal relative to the face.\",\n      severity_labels: { minor: \"Slightly Small\", moderate: \"Small\", severe: \"Very Small\" }\n    }\n  },\n  {\n    id: \"low_set_eyebrows\",\n    title: \"Low-Set Eyebrows\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Eyebrow Height\", \"Brow to Hairline Distance\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyebrows sit lower than ideal, reducing the visible upper eyelid space.\",\n      severity_labels: { minor: \"Slightly Low\", moderate: \"Low\", severe: \"Very Low\" }\n    }\n  },\n  {\n    id: \"asymmetrical_face\",\n    title: \"Facial Asymmetry\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The left and right sides of the face show noticeable differences in proportion or position.\",\n      severity_labels: { minor: \"Slight Asymmetry\", moderate: \"Noticeable Asymmetry\", severe: \"Significant Asymmetry\" }\n    }\n  },\n  // --- STRENGTHS ---\n  {\n    id: \"good_jaw_width\",\n    title: \"Good Jaw Width\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Bigonial Width\", \"Jaw Width Ratio\", \"Jaw Frontal Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a pleasant jaw contour due to the jaw being neither too wide nor too narrow.\",\n      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n    }\n  },\n  {\n    id: \"good_forehead_slope\",\n    title: \"Good Forehead Slope\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Browridge Inclination Angle\", \"Forehead Height\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a pleasant forehead contour by indicating that the forehead is neither too steep nor too flat.\",\n      grade_labels: { good: \"Good Slope\", excellent: \"Well-Angled\", ideal: \"Ideal Slope\" }\n    }\n  },\n  {\n    id: \"good_cupids_bow\",\n    title: \"Good Cupid's Bow Depth\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Cupids Bow Depth\", \"Upper Lip Height\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious lip region due to the cupid's bow having ideal definition and depth.\",\n      grade_labels: { good: \"Defined\", excellent: \"Well-Defined\", ideal: \"Perfectly Defined\" }\n    }\n  },\n  {\n    id: \"good_eyebrow_length\",\n    title: \"Good Eyebrow Length\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Brow Length to Face Width Ratio\", \"Brow Length Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious eye region due to the eyebrows having ideal horizontal length relative to face width.\",\n      grade_labels: { good: \"Good Length\", excellent: \"Well-Proportioned\", ideal: \"Ideal Length\" }\n    }\n  },\n  {\n    id: \"good_neck_width\",\n    title: \"Good Neck Width\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Neck Width\", \"Neck to Jaw Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious lower face due to the neck being neither too wide nor too thin.\",\n      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n    }\n  },\n  {\n    id: \"ideal_nasolabial_angle\",\n    title: \"Ideal Nasolabial Angle\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The angle between nose and upper lip is in the ideal range, creating profile harmony.\",\n      grade_labels: { good: \"Good Angle\", excellent: \"Well-Angled\", ideal: \"Perfect Angle\" }\n    }\n  },\n  {\n    id: \"ideal_facial_depth\",\n    title: \"Ideal Facial Depth\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Facial Depth to Height Ratio\", \"Anterior Facial Depth\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face has ideal forward projection creating attractive three-dimensional contours.\",\n      grade_labels: { good: \"Good Depth\", excellent: \"Well-Projected\", ideal: \"Ideal Projection\" }\n    }\n  },\n  {\n    id: \"ideal_eye_shape\",\n    title: \"Ideal Eye Shape\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Eye Aspect Ratio\", \"Lateral Canthal Tilt\", \"Palpebral Fissure Length\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The eyes have an attractive almond shape with ideal proportions and tilt.\",\n      grade_labels: { good: \"Attractive\", excellent: \"Well-Shaped\", ideal: \"Hunter Eyes\" }\n    }\n  },\n  {\n    id: \"harmonious_profile\",\n    title: \"Harmonious Profile\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Total Profile Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The facial profile shows excellent balance between nose, lips, and chin positions.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfect Profile\" }\n    }\n  },\n  {\n    id: \"good_facial_symmetry\",\n    title: \"Good Facial Symmetry\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face displays excellent bilateral symmetry, a key component of attractiveness.\",\n      grade_labels: { good: \"Symmetric\", excellent: \"Very Symmetric\", ideal: \"Near-Perfect Symmetry\" }\n    }\n  }\n];\n\n// ============================================\n// METRIC NAME MAPPING\n// ============================================\n\n// Map display names to metric IDs for lookup\nconst METRIC_NAME_TO_ID: Record<string, string> = {\n  // Face Shape/Proportions\n  \"Face Width to Height Ratio\": \"faceWidthToHeight\",\n  \"Total Facial Width to Height\": \"totalFacialWidthToHeight\",\n  \"Total Facial Width to Height Ratio\": \"totalFacialWidthToHeight\",\n  \"Midface Ratio\": \"midfaceRatio\",\n  \"Upper Third Proportion\": \"upperThirdProportion\",\n  \"Middle Third Proportion\": \"middleThirdProportion\",\n  \"Lower Third Proportion\": \"lowerThirdProportion\",\n  \"Cheekbone Height\": \"cheekboneHeight\",\n  \"Cheekbone Width\": \"cheekboneWidth\",\n  \"Bitemporal Width\": \"bitemporalWidth\",\n  \"Forehead Height\": \"foreheadHeight\",\n  \"Facial Asymmetry Index\": \"facialAsymmetryIndex\",\n\n  // Jaw\n  \"Gonial Angle\": \"gonialAngle\",\n  \"Mandibular Plane Angle\": \"mandibularPlaneAngle\",\n  \"Jaw Width Ratio\": \"jawWidthRatio\",\n  \"Bigonial Width\": \"bigonialWidth\",\n  \"Jaw Frontal Angle\": \"jawFrontalAngle\",\n  \"Jaw Slope\": \"jawSlope\",\n  \"Jaw Asymmetry\": \"jawAsymmetry\",\n\n  // Chin\n  \"Chin to Philtrum Ratio\": \"chinPhiltrumRatio\",\n  \"Chin Height\": \"chinHeight\",\n  \"Facial Depth to Height\": \"facialDepthToHeight\",\n  \"Facial Depth to Height Ratio\": \"facialDepthToHeight\",\n  \"Anterior Facial Depth\": \"anteriorFacialDepth\",\n  \"Recession Relative to Frankfort Plane\": \"recessionFrankfort\",\n\n  // Eyes\n  \"Lateral Canthal Tilt\": \"lateralCanthalTilt\",\n  \"Eye Aspect Ratio\": \"eyeAspectRatio\",\n  \"Eye Separation Ratio\": \"eyeSeparationRatio\",\n  \"Interpupillary Ratio\": \"interpupillaryRatio\",\n  \"One Eye Apart Test\": \"oneEyeApartTest\",\n  \"Intercanthal Width\": \"intercanthalWidth\",\n  \"Eyebrow Height\": \"eyebrowHeight\",\n  \"Brow Length Ratio\": \"browLengthRatio\",\n  \"Brow Length to Face Width Ratio\": \"browLengthToFaceWidth\",\n  \"Palpebral Fissure Length\": \"palpebralFissureLength\",\n  \"Eye Width\": \"eyeWidth\",\n  \"Eye Asymmetry\": \"eyeAsymmetry\",\n  \"Brow to Hairline Distance\": \"browToHairlineDistance\",\n\n  // Brow\n  \"Browridge Inclination Angle\": \"browridgeInclinationAngle\",\n\n  // Nose\n  \"Nasal Index\": \"nasalIndex\",\n  \"Nasal Tip Angle\": \"nasalTipAngle\",\n  \"Nose Tip Position\": \"noseTipPosition\",\n  \"Frankfort-tip Angle\": \"frankfortTipAngle\",\n  \"Nasofrontal Angle\": \"nasofrontalAngle\",\n  \"Nasofacial Angle\": \"nasofacialAngle\",\n  \"Nasomenta Angle\": \"nasomentaAngle\",\n  \"Nasomental Angle\": \"nasomentaAngle\",\n  \"Intercanthal Nasal Ratio\": \"intercanthalNasalRatio\",\n  \"Nose Bridge Width\": \"noseBridgeWidth\",\n  \"Nose Width\": \"noseWidth\",\n  \"Nasal Projection\": \"nasalProjection\",\n  \"Nose Length Ratio\": \"noseLengthRatio\",\n  \"Ipsilateral Alar Angle\": \"ipsilateralAlarAngle\",\n\n  // Lips\n  \"Lip Ratio\": \"lipRatio\",\n  \"Philtrum Length\": \"philtrumLength\",\n  \"Upper Lip Projection\": \"upperLipProjection\",\n  \"Lower Lip Projection\": \"lowerLipProjection\",\n  \"Lip Chin Distance\": \"lipChinDistance\",\n  \"Upper Lip Height\": \"upperLipHeight\",\n  \"Upper Lip E-Line Position\": \"upperLipELine\",\n  \"Upper Lip S-Line Position\": \"upperLipSLine\",\n  \"Nasolabial Angle\": \"nasolabialAngle\",\n  \"Cupids Bow Depth\": \"cupidsBowDepth\",\n\n  // Neck\n  \"Neck Width\": \"neckWidth\",\n  \"Neck to Jaw Ratio\": \"neckToJawRatio\",\n\n  // Profile\n  \"Total Profile Angle\": \"totalProfileAngle\",\n};\n\n// ============================================\n// CLASSIFICATION FUNCTIONS\n// ============================================\n\n/**\n * Get weakness severity based on average score\n * 0-3 = \"Severe\", 3-5 = \"Moderate\", 5-7 = \"Minor\"\n */\nfunction getWeaknessSeverity(avgScore: number): WeaknessSeverity {\n  if (avgScore <= 3) return 'severe';\n  if (avgScore <= 5) return 'moderate';\n  return 'minor';\n}\n\n/**\n * Get strength grade based on average score\n * 8-9 = \"Good\", 9-9.5 = \"Excellent\", 9.5-10 = \"Ideal\"\n */\nfunction getStrengthGrade(avgScore: number): StrengthGrade {\n  if (avgScore >= 9.5) return 'ideal';\n  if (avgScore >= 9) return 'excellent';\n  return 'good';\n}\n\n/**\n * Find metric by display name from measurements array\n */\nfunction findMetricByName(\n  metricName: string,\n  measurements: MetricScoreResult[]\n): MetricScoreResult | undefined {\n  // First try direct ID mapping\n  const metricId = METRIC_NAME_TO_ID[metricName];\n  if (metricId) {\n    return measurements.find(m => m.metricId === metricId);\n  }\n\n  // Fallback: try fuzzy matching on name\n  const normalizedName = metricName.toLowerCase().replace(/[^a-z0-9]/g, '');\n  return measurements.find(m => {\n    const normalizedMetricName = m.name.toLowerCase().replace(/[^a-z0-9]/g, '');\n    return normalizedMetricName.includes(normalizedName) ||\n           normalizedName.includes(normalizedMetricName);\n  });\n}\n\n/**\n * Check if a metric should be considered a \"false positive\" weakness.\n * This handles directional/dimorphic metrics where low scores don't mean weakness.\n *\n * Example: Canthal Tilt of 3° gets a low score (not in 6-8° ideal range)\n * but is still a POSITIVE trait, not a weakness.\n */\nfunction isFalsePositiveWeakness(metric: MatchedMetric): boolean {\n  const config = METRIC_CONFIGS[metric.metricId];\n  if (!config) return false;\n\n  // Check if the value is actually acceptable based on polarity\n  const { acceptable } = isValueAcceptable(metric.value, config);\n  return acceptable;\n}\n\n/**\n * Process all insight definitions against user's measurements\n */\nexport function classifyInsights(\n  measurements: MetricScoreResult[],\n  insightDefinitions: InsightDefinition[] = INSIGHTS_DEFINITIONS\n): InsightClassificationResult {\n  const strengths: ClassifiedStrength[] = [];\n  const weaknesses: ClassifiedWeakness[] = [];\n\n  for (const insight of insightDefinitions) {\n    const { metrics, threshold } = insight.severity_logic;\n\n    // Find matching measurements for this insight\n    const matchedMetrics: MatchedMetric[] = [];\n    for (const metricName of metrics) {\n      const measurement = findMetricByName(metricName, measurements);\n      if (measurement) {\n        matchedMetrics.push({\n          metricId: measurement.metricId,\n          metricName: measurement.name,\n          score: measurement.score,\n          value: measurement.value,\n          idealMin: measurement.idealMin,\n          idealMax: measurement.idealMax,\n          unit: measurement.unit,\n          category: measurement.category,\n        });\n      }\n    }\n\n    // Skip if no metrics matched (need at least 1)\n    if (matchedMetrics.length === 0) continue;\n\n    // Calculate average score\n    const avgScore = matchedMetrics.reduce((sum, m) => sum + m.score, 0) / matchedMetrics.length;\n\n    // Classify based on type and threshold\n    if (insight.type === 'weakness') {\n      // Weakness: avg < threshold → add to areas of improvement\n      if (avgScore < threshold) {\n        // ========== FALSE POSITIVE CHECK ==========\n        // Before adding to weaknesses, check if ANY of the matched metrics\n        // are actually in an \"acceptable\" zone based on their polarity.\n        // If so, this is a false positive and should be skipped or reclassified.\n        const falsePositiveMetrics = matchedMetrics.filter(isFalsePositiveWeakness);\n\n        // If ALL matched metrics are false positives, skip this weakness entirely\n        if (falsePositiveMetrics.length === matchedMetrics.length) {\n          // This is a false positive weakness - the values are actually acceptable\n          // Consider adding to strengths if scores are decent\n          if (avgScore >= 6) {\n            strengths.push({\n              insightId: `${insight.id}_acceptable`,\n              title: insight.title.replace('Negative', 'Neutral').replace('Weak', 'Moderate'),\n              description: `While not in the peak ideal range, the measured values are within acceptable limits.`,\n              grade: 'good',\n              gradeLabel: 'Acceptable',\n              avgScore,\n              matchedMetrics,\n            });\n          }\n          continue; // Skip adding as weakness\n        }\n\n        // If SOME metrics are false positives, filter them out\n        const trueWeaknessMetrics = matchedMetrics.filter(m => !isFalsePositiveWeakness(m));\n        if (trueWeaknessMetrics.length === 0) continue;\n\n        // Recalculate average with only true weakness metrics\n        const trueAvgScore = trueWeaknessMetrics.reduce((sum, m) => sum + m.score, 0) / trueWeaknessMetrics.length;\n\n        // Only add as weakness if true average is still below threshold\n        if (trueAvgScore < threshold) {\n          const severity = getWeaknessSeverity(trueAvgScore);\n          const labels = insight.content.severity_labels;\n          const severityLabel = labels?.[severity] || severity;\n\n          weaknesses.push({\n            insightId: insight.id,\n            title: insight.title,\n            description: insight.content.description,\n            severity,\n            severityLabel,\n            avgScore: trueAvgScore,\n            matchedMetrics: trueWeaknessMetrics,\n          });\n        }\n      }\n    } else {\n      // Strength: avg > threshold → add to key strengths\n      if (avgScore > threshold) {\n        const grade = getStrengthGrade(avgScore);\n        const labels = insight.content.grade_labels;\n        const gradeLabel = labels?.[grade] || grade;\n\n        strengths.push({\n          insightId: insight.id,\n          title: insight.title,\n          description: insight.content.description,\n          grade,\n          gradeLabel,\n          avgScore,\n          matchedMetrics,\n        });\n      }\n    }\n  }\n\n  // Sort by score (weaknesses by lowest score first, strengths by highest first)\n  weaknesses.sort((a, b) => a.avgScore - b.avgScore);\n  strengths.sort((a, b) => b.avgScore - a.avgScore);\n\n  return { strengths, weaknesses };\n}\n\n/**\n * Convert ClassifiedStrength to Strength type for UI compatibility\n */\nexport function convertToStrength(classified: ClassifiedStrength): Strength {\n  return {\n    id: `insight_strength_${classified.insightId}`,\n    strengthName: `${classified.title} (${classified.gradeLabel})`,\n    summary: classified.description,\n    avgScore: Math.max(0, Math.min(10, classified.avgScore)),  // Clamp to 0-10\n    qualityLevel: classified.grade === 'ideal' ? 'ideal' :\n                  classified.grade === 'excellent' ? 'excellent' : 'good',\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n  };\n}\n\n/**\n * Convert ClassifiedWeakness to Flaw type for UI compatibility\n */\nexport function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  const impact = (10 - classified.avgScore) * 0.5;\n  const newRollingLost = rollingLost + impact;\n\n  return {\n    id: `insight_flaw_${classified.insightId}`,\n    flawName: `${classified.title} (${classified.severityLabel})`,\n    summary: classified.description,\n    harmonyPercentageLost: impact,\n    standardizedImpact: impact / 10,\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n    rollingPointsDeducted: newRollingLost,\n    rollingHarmonyPercentageLost: newRollingLost,\n    rollingStandardizedImpact: newRollingLost / 10,\n  };\n}\n\n/**\n * Main function: Generate strengths and flaws from measurements using insights\n */\nexport function generateInsightBasedResults(\n  measurements: MetricScoreResult[]\n): { strengths: Strength[]; flaws: Flaw[] } {\n  const { strengths: classifiedStrengths, weaknesses: classifiedWeaknesses } = classifyInsights(measurements);\n\n  // Convert to UI-compatible types\n  const strengths = classifiedStrengths.map((s) => convertToStrength(s));\n\n  let rollingLost = 0;\n  const flaws = classifiedWeaknesses.map((w, i) => {\n    const flaw = convertToFlaw(w, i, rollingLost);\n    rollingLost = flaw.rollingPointsDeducted || 0;\n    return flaw;\n  });\n\n  return { strengths, flaws };\n}\n","structuredPatch":[{"oldStart":28,"oldLines":7,"newStart":28,"newLines":7,"lines":["  */"," "," import { Strength, Flaw } from '@/types/results';","-import { MetricScoreResult, METRIC_CONFIGS, isValueAcceptable } from '@/lib/harmony-scoring';","+import { MetricScoreResult, METRIC_CONFIGS, isValueAcceptable, ConfidenceLevel } from '@/lib/harmony-scoring';"," "," // ============================================"," // MASTER SCORING DATABASE (Z-Score Based)"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"2094213b-6b7b-4b0f-bf9f-e6091af19bec","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Gw1L2Sm61ojj6zZJxtEvvH","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me find the `ClassifiedWeakness` interface and update it:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":585,"cache_read_input_tokens":132918,"cache_creation":{"ephemeral_5m_input_tokens":585,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWVVEYYBL8FFReeyBnHAt","type":"assistant","uuid":"3fa5e006-c842-4c25-a327-d1015d9b5aef","timestamp":"2025-12-26T14:52:14.027Z"}
{"parentUuid":"3fa5e006-c842-4c25-a327-d1015d9b5aef","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Gw1L2Sm61ojj6zZJxtEvvH","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01L2aJcQA7Uuz9uaczWAKwcp","name":"Grep","input":{"pattern":"export interface ClassifiedWeakness","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","output_mode":"content","-n":true}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":585,"cache_read_input_tokens":132918,"cache_creation":{"ephemeral_5m_input_tokens":585,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWVVEYYBL8FFReeyBnHAt","type":"assistant","uuid":"16e57fde-f166-4f0d-9136-da9b349a2917","timestamp":"2025-12-26T14:52:16.307Z"}
{"parentUuid":"16e57fde-f166-4f0d-9136-da9b349a2917","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01L2aJcQA7Uuz9uaczWAKwcp","type":"tool_result","content":"1614:export interface ClassifiedWeakness {"}]},"uuid":"e46e032a-b2da-44c5-ad1d-4d9b16eebee7","timestamp":"2025-12-26T14:52:16.829Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"1614:export interface ClassifiedWeakness {","numLines":1}}
{"parentUuid":"e46e032a-b2da-44c5-ad1d-4d9b16eebee7","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VNd9dywPGbjnB1UAGVVCHN","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0195qTXHBrFHraoJMPmwnVyW","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","offset":1610,"limit":50}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":181,"cache_read_input_tokens":133503,"cache_creation":{"ephemeral_5m_input_tokens":181,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"}},"requestId":"req_011CWVVF6NMXg3jBFzBHoDkW","type":"assistant","uuid":"8a25b4eb-7747-47aa-8063-b4787b6ec49d","timestamp":"2025-12-26T14:52:20.784Z"}
{"parentUuid":"8a25b4eb-7747-47aa-8063-b4787b6ec49d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0195qTXHBrFHraoJMPmwnVyW","type":"tool_result","content":"  1610→\n  1611→export type WeaknessSeverity = 'severe' | 'moderate' | 'minor';\n  1612→export type StrengthGrade = 'ideal' | 'excellent' | 'good';\n  1613→\n  1614→export interface ClassifiedWeakness {\n  1615→  insightId: string;\n  1616→  title: string;\n  1617→  description: string;\n  1618→  severity: WeaknessSeverity;\n  1619→  severityLabel: string;  // Custom label from definition (e.g., \"Extremely Long\")\n  1620→  avgScore: number;\n  1621→  matchedMetrics: MatchedMetric[];\n  1622→}\n  1623→\n  1624→export interface ClassifiedStrength {\n  1625→  insightId: string;\n  1626→  title: string;\n  1627→  description: string;\n  1628→  grade: StrengthGrade;\n  1629→  gradeLabel: string;  // Custom label from definition (e.g., \"Ideal\")\n  1630→  avgScore: number;\n  1631→  matchedMetrics: MatchedMetric[];\n  1632→}\n  1633→\n  1634→export interface MatchedMetric {\n  1635→  metricId: string;\n  1636→  metricName: string;\n  1637→  score: number;\n  1638→  value: number;\n  1639→  idealMin: number;\n  1640→  idealMax: number;\n  1641→  unit: string;\n  1642→  category: string;\n  1643→}\n  1644→\n  1645→export interface InsightClassificationResult {\n  1646→  strengths: ClassifiedStrength[];\n  1647→  weaknesses: ClassifiedWeakness[];\n  1648→}\n  1649→\n  1650→// ============================================\n  1651→// INSIGHTS DATABASE\n  1652→// ============================================\n  1653→\n  1654→export const INSIGHTS_DEFINITIONS: InsightDefinition[] = [\n  1655→  {\n  1656→    id: \"long_midface\",\n  1657→    title: \"Long Midface\",\n  1658→    type: \"weakness\",\n  1659→    severity_logic: {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"18857fe8-7de6-4b5b-b93b-95170f95ed7f","timestamp":"2025-12-26T14:52:20.853Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","content":"\nexport type WeaknessSeverity = 'severe' | 'moderate' | 'minor';\nexport type StrengthGrade = 'ideal' | 'excellent' | 'good';\n\nexport interface ClassifiedWeakness {\n  insightId: string;\n  title: string;\n  description: string;\n  severity: WeaknessSeverity;\n  severityLabel: string;  // Custom label from definition (e.g., \"Extremely Long\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n}\n\nexport interface ClassifiedStrength {\n  insightId: string;\n  title: string;\n  description: string;\n  grade: StrengthGrade;\n  gradeLabel: string;  // Custom label from definition (e.g., \"Ideal\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n}\n\nexport interface MatchedMetric {\n  metricId: string;\n  metricName: string;\n  score: number;\n  value: number;\n  idealMin: number;\n  idealMax: number;\n  unit: string;\n  category: string;\n}\n\nexport interface InsightClassificationResult {\n  strengths: ClassifiedStrength[];\n  weaknesses: ClassifiedWeakness[];\n}\n\n// ============================================\n// INSIGHTS DATABASE\n// ============================================\n\nexport const INSIGHTS_DEFINITIONS: InsightDefinition[] = [\n  {\n    id: \"long_midface\",\n    title: \"Long Midface\",\n    type: \"weakness\",\n    severity_logic: {","numLines":50,"startLine":1610,"totalLines":2643}}}
{"parentUuid":"18857fe8-7de6-4b5b-b93b-95170f95ed7f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01V7hXviYebiqWrLT4GJHd6e","type":"message","role":"assistant","content":[{"type":"text","text":"Now I'll add the confidence field to `ClassifiedWeakness`:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":898,"cache_read_input_tokens":133684,"cache_creation":{"ephemeral_5m_input_tokens":898,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWVVFPo6rV68Npf4Y5bu2","type":"assistant","uuid":"8a826aa7-aac9-4d88-82cd-07c585b9920d","timestamp":"2025-12-26T14:52:25.523Z"}
{"parentUuid":"8a826aa7-aac9-4d88-82cd-07c585b9920d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01V7hXviYebiqWrLT4GJHd6e","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011y9o4xjhvYf8sAB9LXmdwk","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","old_string":"export interface ClassifiedWeakness {\n  insightId: string;\n  title: string;\n  description: string;\n  severity: WeaknessSeverity;\n  severityLabel: string;  // Custom label from definition (e.g., \"Extremely Long\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n}","new_string":"export interface ClassifiedWeakness {\n  insightId: string;\n  title: string;\n  description: string;\n  severity: WeaknessSeverity;\n  severityLabel: string;  // Custom label from definition (e.g., \"Extremely Long\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n  /**\n   * Confidence level based on Z-score magnitude:\n   * - confirmed: |z| >= 2 (high statistical certainty, 2+ SDs from mean)\n   * - likely: 1 <= |z| < 2 (moderate certainty)\n   * - possible: 0.5 <= |z| < 1 (low certainty)\n   */\n  confidence: ConfidenceLevel;\n}"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":898,"cache_read_input_tokens":133684,"cache_creation":{"ephemeral_5m_input_tokens":898,"ephemeral_1h_input_tokens":0},"output_tokens":403,"service_tier":"standard"}},"requestId":"req_011CWVVFPo6rV68Npf4Y5bu2","type":"assistant","uuid":"94102f79-7435-40fc-8143-8111a9c8da66","timestamp":"2025-12-26T14:52:30.686Z"}
{"parentUuid":"94102f79-7435-40fc-8143-8111a9c8da66","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011y9o4xjhvYf8sAB9LXmdwk","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  1610→\n  1611→export type WeaknessSeverity = 'severe' | 'moderate' | 'minor';\n  1612→export type StrengthGrade = 'ideal' | 'excellent' | 'good';\n  1613→\n  1614→export interface ClassifiedWeakness {\n  1615→  insightId: string;\n  1616→  title: string;\n  1617→  description: string;\n  1618→  severity: WeaknessSeverity;\n  1619→  severityLabel: string;  // Custom label from definition (e.g., \"Extremely Long\")\n  1620→  avgScore: number;\n  1621→  matchedMetrics: MatchedMetric[];\n  1622→  /**\n  1623→   * Confidence level based on Z-score magnitude:\n  1624→   * - confirmed: |z| >= 2 (high statistical certainty, 2+ SDs from mean)\n  1625→   * - likely: 1 <= |z| < 2 (moderate certainty)\n  1626→   * - possible: 0.5 <= |z| < 1 (low certainty)\n  1627→   */\n  1628→  confidence: ConfidenceLevel;\n  1629→}\n  1630→\n  1631→export interface ClassifiedStrength {\n  1632→  insightId: string;\n  1633→  title: string;"}]},"uuid":"3223a065-145c-4e79-8754-bfbd4f7df063","timestamp":"2025-12-26T14:52:30.759Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","oldString":"export interface ClassifiedWeakness {\n  insightId: string;\n  title: string;\n  description: string;\n  severity: WeaknessSeverity;\n  severityLabel: string;  // Custom label from definition (e.g., \"Extremely Long\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n}","newString":"export interface ClassifiedWeakness {\n  insightId: string;\n  title: string;\n  description: string;\n  severity: WeaknessSeverity;\n  severityLabel: string;  // Custom label from definition (e.g., \"Extremely Long\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n  /**\n   * Confidence level based on Z-score magnitude:\n   * - confirmed: |z| >= 2 (high statistical certainty, 2+ SDs from mean)\n   * - likely: 1 <= |z| < 2 (moderate certainty)\n   * - possible: 0.5 <= |z| < 1 (low certainty)\n   */\n  confidence: ConfidenceLevel;\n}","originalFile":"/**\n * Insights Engine\n *\n * Processes insight definitions from insights.json and classifies them\n * as strengths or areas of improvement based on user's metric scores.\n *\n * Logic:\n * - For each insight definition, calculate average score of affected metrics\n * - Weakness: if avg score < threshold → classify with severity label\n * - Strength: if avg score > threshold → classify with grade label\n *\n * Z-Score Based 5-Tier Severity Logic:\n * - Ideal (Green): User is inside the ideal range\n * - Good (Blue): Within 0.5 Standard Deviation of the mean (|z| < 0.5)\n * - Fair (Cyan): Between 0.5 and 1 Standard Deviation (0.5 ≤ |z| < 1)\n * - Moderate (Yellow): Between 1 and 2 Standard Deviations (1 ≤ |z| < 2)\n * - Severe (Red): More than 2 Standard Deviations away (|z| ≥ 2)\n *\n * Severity Labels (Weaknesses):\n *   0-3 = \"Severe\"\n *   3-5 = \"Moderate\"\n *   5-7 = \"Minor\"\n *\n * Grade Labels (Strengths):\n *   8-9   = \"Good\"\n *   9-9.5 = \"Excellent\"\n *   9.5-10 = \"Ideal\"\n */\n\nimport { Strength, Flaw } from '@/types/results';\nimport { MetricScoreResult, METRIC_CONFIGS, isValueAcceptable, ConfidenceLevel } from '@/lib/harmony-scoring';\n\n// ============================================\n// MASTER SCORING DATABASE (Z-Score Based)\n// ============================================\n\nexport type SeverityLevel = 'ideal' | 'good' | 'fair' | 'moderate' | 'severe';\nexport type Gender = 'male' | 'female';\nexport type Ethnicity = 'white' | 'black' | 'east_asian' | 'south_asian' | 'hispanic' | 'middle_eastern' | 'native_american' | 'pacific_islander';\n\nexport interface MasterMetricConfig {\n  ideal: [number, number];  // [min, max] ideal range\n  mean: number;             // Population mean\n  std_dev: number;          // Standard deviation\n  flaws?: {\n    low?: string[];         // Flaws when value is too low\n    high?: string[];        // Flaws when value is too high\n  };\n}\n\n// Base/Default standards (White Male baseline)\nexport const MASTER_SCORING_DB: Record<string, MasterMetricConfig> = {\n  // MIDFACE & PROPORTIONS\n  \"midface_ratio\": {\n    ideal: [0.97, 1.00],\n    mean: 1.0,\n    std_dev: 0.115,\n    flaws: { low: [\"Long midface\", \"Long upper jaw\"] }\n  },\n  \"faceWidthToHeight\": {\n    ideal: [1.30, 1.45],\n    mean: 1.38,\n    std_dev: 0.08,\n    flaws: {\n      low: [\"Overly long face\", \"Narrow face\"],\n      high: [\"Wide face\", \"Short face\"]\n    }\n  },\n  \"totalFacialWidthToHeight\": {\n    ideal: [1.25, 1.40],\n    mean: 1.33,\n    std_dev: 0.075,\n    flaws: {\n      low: [\"Long face shape\"],\n      high: [\"Wide face shape\"]\n    }\n  },\n  \"upperThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short forehead\"],\n      high: [\"Long forehead\"]\n    }\n  },\n  \"middleThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short midface\"],\n      high: [\"Long midface\"]\n    }\n  },\n  \"lowerThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short lower face\"],\n      high: [\"Long lower face\"]\n    }\n  },\n\n  // EYE SPACING & IPD\n  \"eye_separation_ratio\": {\n    ideal: [0.45, 0.47],\n    mean: 0.46,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"interpupillaryRatio\": {\n    ideal: [0.44, 0.48],\n    mean: 0.46,\n    std_dev: 0.025,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"oneEyeApartTest\": {\n    ideal: [0.95, 1.05],\n    mean: 1.0,\n    std_dev: 0.08,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"intercanthalWidth\": {\n    ideal: [30, 35],\n    mean: 32.5,\n    std_dev: 2.5,\n    flaws: {\n      low: [\"Narrow eye spacing\"],\n      high: [\"Wide eye spacing\"]\n    }\n  },\n\n  // EYE SHAPE & FEATURES\n  \"lateralCanthalTilt\": {\n    ideal: [6, 8],\n    mean: 5.0,\n    std_dev: 3.5,\n    flaws: {\n      low: [\"Negative canthal tilt\", \"Downturned eyes\"],\n      high: [\"Excessively upturned eyes\"]\n    }\n  },\n  \"eyeAspectRatio\": {\n    ideal: [0.30, 0.35],\n    mean: 0.32,\n    std_dev: 0.04,\n    flaws: {\n      low: [\"Narrow eyes\"],\n      high: [\"Round eyes\"]\n    }\n  },\n  \"palpebralFissureLength\": {\n    ideal: [28, 32],\n    mean: 30.0,\n    std_dev: 2.5,\n    flaws: {\n      low: [\"Small eyes\"],\n      high: [\"Large eyes\"]\n    }\n  },\n  \"eyeWidth\": {\n    ideal: [28, 32],\n    mean: 30.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Narrow eyes\"],\n      high: [\"Wide eyes\"]\n    }\n  },\n  \"upperEyelidExposure\": {\n    ideal: [0.5, 1.2],\n    mean: 0.85,\n    std_dev: 0.35,\n    flaws: {\n      low: [\"Hooded eyes\"],\n      high: [\"Excessive upper lid exposure\"]\n    }\n  },\n  \"tearTroughDepth\": {\n    ideal: [0.0, 0.3],\n    mean: 0.15,\n    std_dev: 0.15,\n    flaws: {\n      high: [\"Dark circles / Tear troughs\", \"Under-eye hollowness\"]\n    }\n  },\n\n  // JAW ANGLES & STRUCTURE\n  \"gonial_angle\": {\n    ideal: [115, 125],\n    mean: 118.0,\n    std_dev: 6.5,\n    flaws: {\n      high: [\"Weak/soft jaw structure\", \"Rounded jaw\"]\n    }\n  },\n  \"mandibularPlaneAngle\": {\n    ideal: [20, 28],\n    mean: 24.0,\n    std_dev: 4.0,\n    flaws: {\n      low: [\"Flat mandibular plane\"],\n      high: [\"Steep mandibular plane\", \"Hyper-divergent jaw\"]\n    }\n  },\n  \"jawFrontalAngle\": {\n    ideal: [125, 135],\n    mean: 130.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Steep jaw\"],\n      high: [\"Flat jaw angle\"]\n    }\n  },\n  \"jawSlope\": {\n    ideal: [25, 35],\n    mean: 30.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat jawline\"],\n      high: [\"Steep jawline\"]\n    }\n  },\n\n  // JAW WIDTH\n  \"jawWidthRatio\": {\n    ideal: [0.85, 0.95],\n    mean: 0.90,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Narrow jaw\"],\n      high: [\"Wide jaw\"]\n    }\n  },\n  \"bigonialWidth\": {\n    ideal: [110, 125],\n    mean: 117.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow jaw width\"],\n      high: [\"Excessively wide jaw\"]\n    }\n  },\n\n  // CHEEKBONES\n  \"cheekbone_height\": {\n    ideal: [83.0, 100.0],\n    mean: 85.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Low-set cheekbones\", \"Flat midface\"]\n    }\n  },\n  \"cheekboneWidth\": {\n    ideal: [130, 145],\n    mean: 137.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow cheekbones\"],\n      high: [\"Wide cheekbones\"]\n    }\n  },\n\n  // CHIN\n  \"chinPhiltrumRatio\": {\n    ideal: [1.8, 2.2],\n    mean: 2.0,\n    std_dev: 0.2,\n    flaws: {\n      low: [\"Recessed chin\", \"Short chin\"],\n      high: [\"Long chin\", \"Projected chin\"]\n    }\n  },\n  \"chinHeight\": {\n    ideal: [35, 45],\n    mean: 40.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Short chin\"],\n      high: [\"Long chin\"]\n    }\n  },\n  \"chinWidth\": {\n    ideal: [35, 45],\n    mean: 40.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Pointed/Narrow chin\"],\n      high: [\"Wide chin\"]\n    }\n  },\n\n  // NOSE ANGLES\n  \"nasalTipAngle\": {\n    ideal: [95, 115],\n    mean: 105.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Droopy nasal tip\"],\n      high: [\"Upturned nasal tip\"]\n    }\n  },\n  \"nasolabialAngle\": {\n    ideal: [95, 110],\n    mean: 102.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Droopy nasal tip\"],\n      high: [\"Upturned nose\"]\n    }\n  },\n  \"nasofrontalAngle\": {\n    ideal: [115, 135],\n    mean: 125.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Deep nasal root\"],\n      high: [\"Flat nasal root\"]\n    }\n  },\n  \"nasofacialAngle\": {\n    ideal: [30, 40],\n    mean: 35.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat nose profile\"],\n      high: [\"Overprojected nose\"]\n    }\n  },\n  \"nasomentaAngle\": {\n    ideal: [120, 135],\n    mean: 127.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Convex profile\"],\n      high: [\"Concave profile\"]\n    }\n  },\n\n  // NOSE WIDTH & PROPORTIONS\n  \"nasalIndex\": {\n    ideal: [65, 75],\n    mean: 70.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Narrow nose\"],\n      high: [\"Wide nose\", \"Bulbous nose\"]\n    }\n  },\n  \"noseWidth\": {\n    ideal: [35, 42],\n    mean: 38.5,\n    std_dev: 3.5,\n    flaws: {\n      low: [\"Narrow nose\"],\n      high: [\"Wide nasal base\"]\n    }\n  },\n  \"noseBridgeWidth\": {\n    ideal: [12, 18],\n    mean: 15.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Narrow nose bridge\"],\n      high: [\"Wide nose bridge\"]\n    }\n  },\n  \"nasalProjection\": {\n    ideal: [16, 22],\n    mean: 19.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Underprojected nose\"],\n      high: [\"Overprojected nose\"]\n    }\n  },\n  \"noseLengthRatio\": {\n    ideal: [0.45, 0.55],\n    mean: 0.50,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Short nose\"],\n      high: [\"Long nose\"]\n    }\n  },\n\n  // LIPS & PHILTRUM\n  \"lipRatio\": {\n    ideal: [1.4, 1.6],\n    mean: 1.5,\n    std_dev: 0.15,\n    flaws: {\n      low: [\"Thin upper lip\"],\n      high: [\"Thick upper lip\"]\n    }\n  },\n  \"philtrumLength\": {\n    ideal: [11, 15],\n    mean: 13.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Short philtrum\"],\n      high: [\"Long philtrum\"]\n    }\n  },\n  \"upperLipHeight\": {\n    ideal: [18, 24],\n    mean: 21.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Thin upper lip\"],\n      high: [\"Thick upper lip\"]\n    }\n  },\n  \"lipChinDistance\": {\n    ideal: [40, 50],\n    mean: 45.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Short lower third\"],\n      high: [\"Long lower third\"]\n    }\n  },\n  \"upperLipProjection\": {\n    ideal: [-2, 2],\n    mean: 0.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Recessed upper lip\"],\n      high: [\"Protruding upper lip\"]\n    }\n  },\n  \"lowerLipProjection\": {\n    ideal: [-1, 3],\n    mean: 1.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Recessed lower lip\"],\n      high: [\"Protruding lower lip\"]\n    }\n  },\n  \"cupidsBowDepth\": {\n    ideal: [3, 6],\n    mean: 4.5,\n    std_dev: 1.5,\n    flaws: {\n      low: [\"Flat cupid's bow\"],\n      high: [\"Pronounced cupid's bow\"]\n    }\n  },\n\n  // EYEBROWS\n  \"eyebrowHeight\": {\n    ideal: [8, 14],\n    mean: 11.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Low-set eyebrows\"],\n      high: [\"High eyebrows\"]\n    }\n  },\n  \"browLengthRatio\": {\n    ideal: [0.50, 0.60],\n    mean: 0.55,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Short eyebrows\"],\n      high: [\"Long eyebrows\"]\n    }\n  },\n  \"browLengthToFaceWidth\": {\n    ideal: [0.30, 0.38],\n    mean: 0.34,\n    std_dev: 0.04,\n    flaws: {\n      low: [\"Short eyebrows\"],\n      high: [\"Long eyebrows\"]\n    }\n  },\n  \"browridgeInclinationAngle\": {\n    ideal: [10, 20],\n    mean: 15.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat brow ridge\"],\n      high: [\"Prominent brow ridge\"]\n    }\n  },\n  \"eyebrowThickness\": {\n    ideal: [1.5, 3.0],\n    mean: 2.25,\n    std_dev: 0.75,\n    flaws: {\n      low: [\"Sparse/Weak eyebrows\"],\n      high: [\"Overly thick eyebrows\"]\n    }\n  },\n\n  // FOREHEAD\n  \"foreheadHeight\": {\n    ideal: [55, 70],\n    mean: 62.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Short forehead\"],\n      high: [\"Tall forehead\"]\n    }\n  },\n  \"bitemporalWidth\": {\n    ideal: [120, 135],\n    mean: 127.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow forehead\"],\n      high: [\"Wide forehead\"]\n    }\n  },\n\n  // PROFILE & DEPTH\n  \"facialDepthToHeight\": {\n    ideal: [0.75, 0.85],\n    mean: 0.80,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Flat facial profile\"],\n      high: [\"Overprojected profile\"]\n    }\n  },\n  \"anteriorFacialDepth\": {\n    ideal: [115, 130],\n    mean: 122.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Shallow face depth\"],\n      high: [\"Deep face projection\"]\n    }\n  },\n  \"totalProfileAngle\": {\n    ideal: [165, 175],\n    mean: 170.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Convex profile\"],\n      high: [\"Concave profile\"]\n    }\n  },\n\n  // ASYMMETRY\n  \"facialAsymmetryIndex\": {\n    ideal: [0, 3],\n    mean: 2.0,\n    std_dev: 1.5,\n    flaws: {\n      high: [\"Facial asymmetry\"]\n    }\n  },\n  \"eyeAsymmetry\": {\n    ideal: [0, 2],\n    mean: 1.0,\n    std_dev: 1.0,\n    flaws: {\n      high: [\"Eye asymmetry\"]\n    }\n  },\n  \"jawAsymmetry\": {\n    ideal: [0, 3],\n    mean: 1.5,\n    std_dev: 1.5,\n    flaws: {\n      high: [\"Jaw asymmetry\"]\n    }\n  },\n\n  // OTHER\n  \"recessionFrankfort\": {\n    ideal: [-2, 2],\n    mean: 0.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Maxillary recession\"],\n      high: [\"Maxillary protrusion\"]\n    }\n  },\n  \"neckWidth\": {\n    ideal: [110, 130],\n    mean: 120.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Narrow neck\"],\n      high: [\"Wide neck\"]\n    }\n  },\n  \"neckToJawRatio\": {\n    ideal: [0.90, 1.10],\n    mean: 1.0,\n    std_dev: 0.10,\n    flaws: {\n      low: [\"Narrow neck\"],\n      high: [\"Thick neck\"]\n    }\n  }\n};\n\n// ============================================\n// ETHNICITY-SPECIFIC OVERRIDES\n// ============================================\n\n/**\n * Ethnicity and gender-specific metric standards\n * These override the base MASTER_SCORING_DB values for specific populations\n */\nexport const ETHNICITY_OVERRIDES: Record<string, Record<string, Partial<MasterMetricConfig>>> = {\n  // ========================================\n  // MALE WHITE STANDARDS (Neoclassical Baseline)\n  // ========================================\n  \"male_white\": {\n    // NOSE WIDTH - Strict 1:1 ratio (Eye Width = Nose Width)\n    \"noseWidth\": {\n      ideal: [35, 42],  // Corresponds to alar_base_ratio [0.98, 1.05]\n      mean: 38.5,\n      std_dev: 3.5,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // MIDFACE - Prefers compact midface (Hunter look)\n    \"midface_ratio\": {\n      ideal: [0.95, 1.02],\n      mean: 0.985,\n      std_dev: 0.035,\n      flaws: {\n        low: [\"Long midface\"]\n      }\n    },\n\n    // JAW - Square/Robust jaw preference\n    \"gonial_angle\": {\n      ideal: [115.0, 125.0],\n      mean: 120.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Weak/Soft jaw structure\"]\n      }\n    },\n\n    // FACE WIDTH - Standard Mesoprosopic range\n    \"faceWidthToHeight\": {\n      ideal: [1.90, 2.05],\n      mean: 1.975,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Short/Wide face\"]\n      }\n    },\n\n    // EYE TILT - Neutral to slightly positive\n    \"lateralCanthalTilt\": {\n      ideal: [4.0, 8.0],\n      mean: 6.0,\n      std_dev: 2.0,\n      flaws: {\n        low: [\"Negative canthal tilt\"]\n      }\n    },\n\n    // LOWER FACE BALANCE\n    \"chinPhiltrumRatio\": {\n      ideal: [2.10, 2.30],\n      mean: 2.20,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Long philtrum / Short chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE BLACK / AFRICAN STANDARDS\n  // ========================================\n  \"male_black\": {\n    // NOSE WIDTH - Significantly wider tolerance\n    \"noseWidth\": {\n      ideal: [40, 50],  // Wider range (corresponds to alar_base_ratio [1.12, 1.25])\n      mean: 45.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n    \"nasalIndex\": {\n      ideal: [80, 95],  // Wider nasal index\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        high: [\"Wide nose\"]\n      }\n    },\n\n    // LIPS - Prefers fuller lips\n    \"lipRatio\": {\n      ideal: [1.2, 1.5],\n      mean: 1.35,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    },\n\n    // PHILTRUM - Shorter visible philtrum is ideal\n    \"philtrumLength\": {\n      ideal: [11.0, 14.0],\n      mean: 12.5,\n      std_dev: 1.5,\n      flaws: {\n        high: [\"Long philtrum\"]\n      }\n    },\n\n    // CHIN - Adjusts for natural forward mouth projection (Prognathism)\n    \"chinPhiltrumRatio\": {\n      ideal: [1.80, 2.10],  // Lower range to account for prognathism\n      mean: 1.95,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Recessed chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE EAST ASIAN STANDARDS\n  // ========================================\n  \"male_east_asian\": {\n    // EYE SPACING - Shifted WIDER for East Asian males\n    \"eye_separation_ratio\": {\n      ideal: [0.48, 0.53],  // Shifted wider (0.46 is \"close-set\" here)\n      mean: 0.505,\n      std_dev: 0.025,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Wide-set eyes\"]\n      }\n    },\n    \"interpupillaryRatio\": {\n      ideal: [0.48, 0.53],\n      mean: 0.505,\n      std_dev: 0.025,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Wide-set eyes\"]\n      }\n    },\n\n    // EYE SHAPE - Prefers narrower/longer eyes (Hunter Eyes)\n    \"eyeAspectRatio\": {\n      ideal: [0.25, 0.29],  // Lower ratio = more elongated\n      mean: 0.27,\n      std_dev: 0.02,\n      flaws: {\n        low: [\"Overly narrow eyes\"],\n        high: [\"Overly round eye shape\"]\n      }\n    },\n    \"palpebralFissureLength\": {\n      ideal: [29, 33],\n      mean: 31.0,\n      std_dev: 2.0,\n      flaws: {\n        low: [\"Small eyes\"],\n        high: [\"Large eyes\"]\n      }\n    },\n\n    // NOSE - Asian noses typically allowed to be wider\n    \"nasalIndex\": {\n      ideal: [75, 85],\n      mean: 80.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nose\"]\n      }\n    },\n    \"noseWidth\": {\n      ideal: [38, 45],\n      mean: 41.5,\n      std_dev: 3.5,\n      flaws: {\n        low: [\"Narrow nose\"],\n        high: [\"Very wide nasal base\"]\n      }\n    },\n    \"noseBridgeWidth\": {\n      ideal: [14, 20],\n      mean: 17.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Narrow nose bridge\"],\n        high: [\"Wide nose bridge\"]\n      }\n    },\n\n    // CHEEKS - Rewards slightly fuller cheeks (Youth/K-Pop aesthetic)\n    \"cheekbone_height\": {\n      ideal: [80.0, 95.0],\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Gaunt/Hollow face\"]\n      }\n    },\n\n    // JAW - Slightly softer angles acceptable\n    \"gonial_angle\": {\n      ideal: [118, 128],\n      mean: 123.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Weak/soft jaw structure\"]\n      }\n    },\n    \"mandibularPlaneAngle\": {\n      ideal: [20, 30],\n      mean: 25.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Flat mandibular plane\"],\n        high: [\"Steep mandibular plane\"]\n      }\n    },\n\n    // FACIAL PROPORTIONS - Wider faces more common\n    \"faceWidthToHeight\": {\n      ideal: [1.35, 1.50],\n      mean: 1.425,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n    \"totalFacialWidthToHeight\": {\n      ideal: [1.30, 1.45],\n      mean: 1.375,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long face shape\"],\n        high: [\"Wide face shape\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE SOUTH ASIAN STANDARDS\n  // ========================================\n  \"male_south_asian\": {\n    // NOSE WIDTH - Slightly wider tolerance than White\n    \"noseWidth\": {\n      ideal: [36, 43],  // alar_base_ratio [1.00, 1.08]\n      mean: 39.5,\n      std_dev: 3.5,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // TEAR TROUGH - VERY STRICT. High penalty for dark circles\n    \"tearTroughDepth\": {\n      ideal: [0.0, 0.5],\n      mean: 0.25,\n      std_dev: 0.25,\n      flaws: {\n        high: [\"Dark circles / Tear troughs\"]\n      }\n    },\n\n    // UPPER EYELID - Often prefers visible lid platform\n    \"upperEyelidExposure\": {\n      ideal: [0.5, 2.0],\n      mean: 1.25,\n      std_dev: 0.75,\n      flaws: {\n        low: [\"Hooded eyes\"]\n      }\n    },\n\n    // CHEEKS - Penalizes \"Gaunt\" looks heavily\n    \"cheekbone_height\": {\n      ideal: [83.0, 95.0],\n      mean: 89.0,\n      std_dev: 6.0,\n      flaws: {\n        low: [\"Volume loss / Gauntness\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE HISPANIC STANDARDS (\"The Bridge Model\")\n  // ========================================\n  \"male_hispanic\": {\n    // FACE WIDTH - Rewards broader, more robust face shapes (Mestizo)\n    \"faceWidthToHeight\": {\n      ideal: [1.95, 2.10],\n      mean: 2.025,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long/Narrow face\"]\n      }\n    },\n\n    // NOSE WIDTH - Bridge tolerance (Wider than White, narrower than Black)\n    \"noseWidth\": {\n      ideal: [36, 44],  // alar_base_ratio [1.00, 1.12]\n      mean: 40.0,\n      std_dev: 4.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // EYE TILT - Strong preference for positive tilt\n    \"lateralCanthalTilt\": {\n      ideal: [6.0, 12.0],\n      mean: 9.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Negative/Neutral canthal tilt\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE MIDDLE EASTERN STANDARDS\n  // ========================================\n  \"male_middle_eastern\": {\n    // EYEBROW THICKNESS - Prefers significantly thicker/darker brows\n    \"eyebrowThickness\": {\n      ideal: [2.0, 4.0],\n      mean: 3.0,\n      std_dev: 1.0,\n      flaws: {\n        low: [\"Sparse/Weak eyebrows\"],\n        high: [\"Unibrow\"]\n      }\n    },\n\n    // NASOLABIAL ANGLE - Penalizes droopy tip (<90) or hooked noses\n    \"nasolabialAngle\": {\n      ideal: [90.0, 100.0],\n      mean: 95.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Droopy nose tip / Hooked nose\"]\n      }\n    },\n\n    // EYE TILT - Strong preference for Almond/Hunter eye shape\n    \"lateralCanthalTilt\": {\n      ideal: [4.0, 10.0],\n      mean: 7.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    },\n\n    // MIDFACE - Similar to White model (Compact is better)\n    \"midface_ratio\": {\n      ideal: [0.95, 1.02],\n      mean: 0.985,\n      std_dev: 0.035,\n      flaws: {\n        low: [\"Long midface\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE PACIFIC ISLANDER STANDARDS (\"The Warrior Skull\")\n  // ========================================\n  \"male_pacific_islander\": {\n    // FACE WIDTH - The Highest Width Standard (Very broad)\n    \"faceWidthToHeight\": {\n      ideal: [2.10, 2.30],\n      mean: 2.20,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Narrow/Long face\"]\n      }\n    },\n\n    // NOSE WIDTH - Wide tolerance\n    \"noseWidth\": {\n      ideal: [38, 48],  // alar_base_ratio [1.05, 1.20]\n      mean: 43.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // CHEEKS - Rewards high mass/robustness\n    \"cheekbone_height\": {\n      ideal: [85.0, 100.0],\n      mean: 92.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Gaunt/Weak face structure\"]\n      }\n    },\n\n    // CHIN WIDTH - Prefers a very broad, square chin\n    \"chinWidth\": {\n      ideal: [40.0, 50.0],\n      mean: 45.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Pointed/Narrow chin\"]\n      }\n    }\n  },\n\n  \"male_native_american\": {\n    \"faceWidthToHeight\": {\n      ideal: [2.00, 2.20],\n      mean: 2.10,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Wide face\"]\n      }\n    },\n\n    \"nasalIndex\": {\n      ideal: [75, 90],\n      mean: 82.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Narrow nose\"],\n        high: [\"Wide nose\"]\n      }\n    },\n\n    \"cheekbone_height\": {\n      ideal: [80.0, 95.0],\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Flat cheekbones\"]\n      }\n    },\n\n    \"gonialAngle\": {\n      ideal: [115, 125],\n      mean: 120,\n      std_dev: 5,\n      flaws: {\n        low: [\"Weak jaw\"],\n        high: [\"Harsh jaw angle\"]\n      }\n    },\n\n    \"chinWidth\": {\n      ideal: [38.0, 48.0],\n      mean: 43.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Narrow chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // FEMALE ETHNICITIES (The \"Missing Link\")\n  // ========================================\n\n  \"female_white\": {\n    // NOSE WIDTH - Strict Rule of Fifths for feminine harmony\n    \"alar_base_ratio\": {\n      ideal: [0.98, 1.05],\n      mean: 1.015,\n      std_dev: 0.035,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // FACE WIDTH - Prefers oval/narrow feminine proportions\n    \"fwhr\": {\n      ideal: [1.45, 1.53],\n      mean: 1.49,\n      std_dev: 0.04,\n      flaws: {\n        low: [\"Long/Narrow face\"],\n        high: [\"Wide face\"]\n      }\n    },\n\n    // JAW - Soft, tapered feminine jawline\n    \"gonial_angle\": {\n      ideal: [122.0, 130.0],\n      mean: 126.0,\n      std_dev: 4.0,\n      flaws: {\n        low: [\"Sharp/Masculine jaw angle\"],\n        high: [\"Weak/Overly soft jawline\"]\n      }\n    },\n\n    // EYE TILT - Neutral to positive preferred\n    \"canthal_tilt\": {\n      ideal: [4.0, 9.0],\n      mean: 6.5,\n      std_dev: 2.5,\n      flaws: {\n        low: [\"Negative/Downturned eyes\"]\n      }\n    },\n\n    // CHIN-PHILTRUM - Golden Ratio balance\n    \"chin_philtrum_ratio\": {\n      ideal: [2.0, 2.2],\n      mean: 2.1,\n      std_dev: 0.1,\n      flaws: {\n        low: [\"Recessed chin\"],\n        high: [\"Protruding chin\"]\n      }\n    }\n  },\n\n  \"female_black\": {\n    // LIPS - High volume preference (fuller lips)\n    \"lipRatio\": {\n      ideal: [1.3, 1.6],\n      mean: 1.45,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    },\n\n    // NOSE WIDTH - Wider tolerance for ethnic variation\n    \"alar_base_ratio\": {\n      ideal: [1.05, 1.15],\n      mean: 1.10,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Very wide nasal base\"]\n      }\n    },\n\n    // CHIN - Allows forward projection (natural prognathism)\n    \"chin_projection\": {\n      ideal: [0.0, 5.0],\n      mean: 2.5,\n      std_dev: 2.5,\n      flaws: {\n        high: [\"Excessive chin projection\"]\n      }\n    },\n\n    // JAW - Soft feminine jawline\n    \"gonial_angle\": {\n      ideal: [120.0, 130.0],\n      mean: 125.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Sharp jaw angle\"],\n        high: [\"Weak jawline\"]\n      }\n    }\n  },\n\n  \"female_east_asian\": {\n    // EYE SPACING - Wide-set neotenous preference\n    \"eye_separation_ratio\": {\n      ideal: [46.3, 47.5],\n      mean: 46.9,\n      std_dev: 0.6,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Very wide-set eyes\"]\n      }\n    },\n\n    // JAW - Tapered V-shape feminine ideal\n    \"gonial_angle\": {\n      ideal: [120.0, 126.0],\n      mean: 123.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Sharp V-line jaw\"],\n        high: [\"Weak/Square jawline\"]\n      }\n    },\n\n    // EYEBROWS - Higher set brows (youthful feminine)\n    \"eyebrow_height\": {\n      ideal: [0.85, 1.30],\n      mean: 1.075,\n      std_dev: 0.225,\n      flaws: {\n        low: [\"Low-set/Heavy brows\"],\n        high: [\"Very high-arched brows\"]\n      }\n    },\n\n    // LOWER FACE - Compact lower third (neotenous)\n    \"lower_third_ratio\": {\n      ideal: [29.6, 32.7],\n      mean: 31.15,\n      std_dev: 1.55,\n      flaws: {\n        low: [\"Very short lower face\"],\n        high: [\"Long lower face\"]\n      }\n    }\n  },\n\n  \"female_south_asian\": {\n    // TEAR TROUGHS - Very strict on dark circles\n    \"tear_trough_depth\": {\n      ideal: [0.0, 0.5],\n      mean: 0.25,\n      std_dev: 0.25,\n      flaws: {\n        high: [\"Dark circles / Deep tear troughs\"]\n      }\n    },\n\n    // CHEEKS - Rewards midface volume (youthful fullness)\n    \"cheek_fullness\": {\n      ideal: [1.0, 2.0],\n      mean: 1.5,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Gaunt/Hollow cheeks\"]\n      }\n    },\n\n    // SKIN - High penalty for uneven skin tone\n    \"skin_uniformity\": {\n      ideal: [0.92, 1.0],\n      mean: 0.96,\n      std_dev: 0.04,\n      flaws: {\n        low: [\"Uneven skin tone / Pigmentation\"]\n      }\n    },\n\n    // NOSE WIDTH - Intermediate tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.00, 1.08],\n      mean: 1.04,\n      std_dev: 0.04,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    }\n  },\n\n  \"female_hispanic\": {\n    // FACE WIDTH - Broader Mestiza tolerance\n    \"fwhr\": {\n      ideal: [1.50, 1.62],\n      mean: 1.56,\n      std_dev: 0.06,\n      flaws: {\n        low: [\"Long/Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // EYE TILT - Strong almond eye preference\n    \"canthal_tilt\": {\n      ideal: [6.0, 12.0],\n      mean: 9.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Neutral/Downturned eyes\"]\n      }\n    },\n\n    // NOSE WIDTH - Intermediate width tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.00, 1.10],\n      mean: 1.05,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // LIPS - Voluptuous preference\n    \"lipRatio\": {\n      ideal: [1.1, 1.35],\n      mean: 1.225,\n      std_dev: 0.125,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    }\n  },\n\n  \"female_middle_eastern\": {\n    // EYEBROWS - Dense/Thick brows preference\n    \"eyebrow_thickness\": {\n      ideal: [1.5, 3.0],\n      mean: 2.25,\n      std_dev: 0.75,\n      flaws: {\n        low: [\"Sparse/Thin eyebrows\"],\n        high: [\"Unibrow\"]\n      }\n    },\n\n    // NOSE - Refined/Upturned tip\n    \"nasolabial_angle\": {\n      ideal: [95.0, 105.0],\n      mean: 100.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Droopy nose tip\"],\n        high: [\"Overly upturned nose\"]\n      }\n    },\n\n    // EYE TILT - Foxy/Hunter feminine eye shape\n    \"canthal_tilt\": {\n      ideal: [5.0, 10.0],\n      mean: 7.5,\n      std_dev: 2.5,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    },\n\n    // EYELID - Low exposure preferred\n    \"upper_eyelid_exposure\": {\n      ideal: [0.5, 1.5],\n      mean: 1.0,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Hooded eyes\"],\n        high: [\"Excessive eyelid exposure\"]\n      }\n    }\n  },\n\n  \"female_native_american\": {\n    // FACE WIDTH - Wide/High cheekbone structure\n    \"fwhr\": {\n      ideal: [1.52, 1.65],\n      mean: 1.585,\n      std_dev: 0.065,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // CHEEKBONES - High definition/prominence\n    \"cheekbone_prominence\": {\n      ideal: [1.5, 2.5],\n      mean: 2.0,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Flat cheekbones\"],\n        high: [\"Overly prominent cheekbones\"]\n      }\n    },\n\n    // JAW - Stronger jaw tolerance\n    \"gonial_angle\": {\n      ideal: [115.0, 125.0],\n      mean: 120.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Very sharp jaw\"],\n        high: [\"Weak jawline\"]\n      }\n    },\n\n    // EYE TILT - Positive tilt preference\n    \"canthal_tilt\": {\n      ideal: [5.0, 11.0],\n      mean: 8.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    }\n  },\n\n  \"female_pacific_islander\": {\n    // FACE WIDTH - Widest/Robust facial structure\n    \"fwhr\": {\n      ideal: [1.55, 1.70],\n      mean: 1.625,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // CHEEKS - High volume/softness preference\n    \"cheek_fullness\": {\n      ideal: [1.2, 2.5],\n      mean: 1.85,\n      std_dev: 0.65,\n      flaws: {\n        low: [\"Gaunt/Hollow cheeks\"]\n      }\n    },\n\n    // NOSE WIDTH - Wide nose tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.05, 1.15],\n      mean: 1.10,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Very wide nasal base\"]\n      }\n    },\n\n    // LIPS - Full lips preference\n    \"lipRatio\": {\n      ideal: [1.25, 1.50],\n      mean: 1.375,\n      std_dev: 0.125,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    }\n  }\n};\n\n/**\n * Get the appropriate metric configuration for a given gender and ethnicity\n * Falls back to base config if no override exists\n */\nexport function getMetricConfig(\n  metricId: string,\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'white'\n): MasterMetricConfig | undefined {\n  const key = `${gender}_${ethnicity}`;\n  const override = ETHNICITY_OVERRIDES[key]?.[metricId];\n  const baseConfig = MASTER_SCORING_DB[metricId];\n\n  if (!baseConfig) return undefined;\n\n  // Merge override with base config\n  if (override) {\n    return {\n      ...baseConfig,\n      ...override,\n      flaws: {\n        ...baseConfig.flaws,\n        ...override.flaws\n      }\n    } as MasterMetricConfig;\n  }\n\n  return baseConfig;\n}\n\n// ============================================\n// Z-SCORE SEVERITY FUNCTIONS\n// ============================================\n\n/**\n * Calculate Z-score for a given value\n * Z = (value - mean) / std_dev\n */\nexport function calculateZScore(value: number, mean: number, stdDev: number): number {\n  if (stdDev === 0) return 0;\n  return Math.abs((value - mean) / stdDev);\n}\n\n/**\n * Determine severity level based on Z-score and ideal range (5-tier system)\n * - Ideal: Value is within ideal range\n * - Good: |z| < 0.5 (within 0.5 standard deviation)\n * - Fair: 0.5 ≤ |z| < 1 (between 0.5-1 standard deviations)\n * - Moderate: 1 ≤ |z| < 2 (between 1-2 standard deviations)\n * - Severe: |z| ≥ 2 (more than 2 standard deviations away)\n */\nexport function getSeverityFromZScore(\n  value: number,\n  config: MasterMetricConfig\n): { severity: SeverityLevel; zScore: number; isInIdeal: boolean } {\n  const { ideal, mean, std_dev } = config;\n  const isInIdeal = value >= ideal[0] && value <= ideal[1];\n  const zScore = calculateZScore(value, mean, std_dev);\n\n  let severity: SeverityLevel;\n  if (isInIdeal) {\n    severity = 'ideal';\n  } else if (zScore < 0.5) {\n    severity = 'good';\n  } else if (zScore < 1) {\n    severity = 'fair';\n  } else if (zScore < 2) {\n    severity = 'moderate';\n  } else {\n    severity = 'severe';\n  }\n\n  return { severity, zScore, isInIdeal };\n}\n\n/**\n * Get severity for a metric value with ethnicity/gender awareness\n */\nexport function getSeverityForMetric(\n  metricId: string,\n  value: number,\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'white'\n): { severity: SeverityLevel; zScore: number; isInIdeal: boolean; config: MasterMetricConfig } | null {\n  const config = getMetricConfig(metricId, gender, ethnicity);\n  if (!config) return null;\n\n  const result = getSeverityFromZScore(value, config);\n  return { ...result, config };\n}\n\n/**\n * Get badge color for severity level (5-tier)\n */\nexport function getSeverityColor(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'green';\n    case 'good': return 'blue';\n    case 'fair': return 'cyan';\n    case 'moderate': return 'yellow';\n    case 'severe': return 'red';\n    default: return 'gray';\n  }\n}\n\n/**\n * Get severity label for display (5-tier)\n */\nexport function getSeverityLabel(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'Ideal';\n    case 'good': return 'Good';\n    case 'fair': return 'Fair';\n    case 'moderate': return 'Moderate';\n    case 'severe': return 'Severe';\n    default: return 'Unknown';\n  }\n}\n\n// ============================================\n// INSIGHT DEFINITION TYPES\n// ============================================\n\nexport interface InsightSeverityLogic {\n  metrics: string[];  // Display names of metrics (e.g., \"Face Width to Height Ratio\")\n  threshold: number;  // Score threshold for classification\n}\n\nexport interface WeaknessSeverityLabels {\n  minor: string;\n  moderate: string;\n  severe: string;\n}\n\nexport interface StrengthGradeLabels {\n  good: string;\n  excellent: string;\n  ideal: string;\n}\n\nexport interface InsightContent {\n  description: string;\n  severity_labels?: WeaknessSeverityLabels;  // For weaknesses\n  grade_labels?: StrengthGradeLabels;        // For strengths\n}\n\nexport interface InsightDefinition {\n  id: string;\n  title: string;\n  type: 'weakness' | 'strength';\n  severity_logic: InsightSeverityLogic;\n  content: InsightContent;\n}\n\n// ============================================\n// CLASSIFICATION RESULT TYPES\n// ============================================\n\nexport type WeaknessSeverity = 'severe' | 'moderate' | 'minor';\nexport type StrengthGrade = 'ideal' | 'excellent' | 'good';\n\nexport interface ClassifiedWeakness {\n  insightId: string;\n  title: string;\n  description: string;\n  severity: WeaknessSeverity;\n  severityLabel: string;  // Custom label from definition (e.g., \"Extremely Long\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n}\n\nexport interface ClassifiedStrength {\n  insightId: string;\n  title: string;\n  description: string;\n  grade: StrengthGrade;\n  gradeLabel: string;  // Custom label from definition (e.g., \"Ideal\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n}\n\nexport interface MatchedMetric {\n  metricId: string;\n  metricName: string;\n  score: number;\n  value: number;\n  idealMin: number;\n  idealMax: number;\n  unit: string;\n  category: string;\n}\n\nexport interface InsightClassificationResult {\n  strengths: ClassifiedStrength[];\n  weaknesses: ClassifiedWeakness[];\n}\n\n// ============================================\n// INSIGHTS DATABASE\n// ============================================\n\nexport const INSIGHTS_DEFINITIONS: InsightDefinition[] = [\n  {\n    id: \"long_midface\",\n    title: \"Long Midface\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\", \"Ipsilateral Alar Angle\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The middle of the face is elongated, creating an unbalanced vertical proportion.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Extremely Long\" }\n    }\n  },\n  {\n    id: \"short_midface\",\n    title: \"Short Midface\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The midface has ideal vertical proportions, contributing to facial harmony.\",\n      grade_labels: { good: \"Proportionate\", excellent: \"Well-Balanced\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"weak_jaw\",\n    title: \"Weak/Soft Jaw Structure\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Chin to Philtrum Ratio\", \"Jaw Slope\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The jaw has a softer, rounder shape, often less angular and robust than the ideal.\",\n      severity_labels: { minor: \"Soft\", moderate: \"Recessed\", severe: \"Weak\" }\n    }\n  },\n  {\n    id: \"strong_jaw\",\n    title: \"Strong Jaw Definition\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Jaw Width Ratio\", \"Bigonial Width\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The jaw displays strong definition with well-defined angles and proportionate width.\",\n      grade_labels: { good: \"Defined\", excellent: \"Strong\", ideal: \"Ideal Angular\" }\n    }\n  },\n  {\n    id: \"refined_nasal_tip\",\n    title: \"Refined Nasal Tip\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasal Tip Angle\", \"Nose Tip Position\", \"Frankfort-tip Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious nasal profile due to the nasal tip being well-defined and proportionate.\",\n      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"bulbous_nose\",\n    title: \"Bulbous Nasal Tip\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Index\", \"Nose Width\", \"Nasal Tip Angle\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nasal tip appears rounded and less defined, affecting nasal aesthetics.\",\n      severity_labels: { minor: \"Slightly Rounded\", moderate: \"Rounded\", severe: \"Bulbous\" }\n    }\n  },\n  {\n    id: \"ideal_upper_lip\",\n    title: \"Well-Positioned Upper Lip\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Upper Lip E-Line Position\", \"Upper Lip S-Line Position\", \"Nasolabial Angle\"],\n      threshold: 9.0\n    },\n    content: {\n      description: \"This contributes to a harmonious mouth region due to the upper lip sitting neither too far forward nor too far back.\",\n      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"negative_canthal_tilt\",\n    title: \"Negative Canthal Tilt\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The outer corners of the eyes sit lower than the inner corners, creating a downturned appearance.\",\n      severity_labels: { minor: \"Slight Downturn\", moderate: \"Noticeable\", severe: \"Pronounced\" }\n    }\n  },\n  {\n    id: \"positive_canthal_tilt\",\n    title: \"Positive Canthal Tilt\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The outer corners of the eyes are elevated, creating an attractive upswept eye shape.\",\n      grade_labels: { good: \"Slight Upturn\", excellent: \"Well-Tilted\", ideal: \"Hunter Eyes\" }\n    }\n  },\n  {\n    id: \"balanced_facial_thirds\",\n    title: \"Balanced Facial Thirds\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face displays well-balanced vertical proportions across all three facial thirds.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfectly Proportioned\" }\n    }\n  },\n  {\n    id: \"imbalanced_thirds\",\n    title: \"Facial Third Imbalance\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The vertical face proportions show imbalance between the three facial thirds.\",\n      severity_labels: { minor: \"Slight Imbalance\", moderate: \"Noticeable Disproportion\", severe: \"Significant Imbalance\" }\n    }\n  },\n  {\n    id: \"high_cheekbones\",\n    title: \"High Cheekbones\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Cheekbone Height\", \"Cheekbone Width\", \"Midface Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"Well-positioned cheekbones that create attractive facial contours and catch light beautifully.\",\n      grade_labels: { good: \"Visible\", excellent: \"Prominent\", ideal: \"Model-Tier\" }\n    }\n  },\n  {\n    id: \"flat_midface\",\n    title: \"Flat Midface\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Cheekbone Height\", \"Midface Ratio\", \"Total Facial Width to Height\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The midface lacks forward projection, resulting in flatter facial contours.\",\n      severity_labels: { minor: \"Slightly Flat\", moderate: \"Underprojected\", severe: \"Recessed\" }\n    }\n  },\n  {\n    id: \"ideal_lip_ratio\",\n    title: \"Ideal Lip Proportions\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Lip Ratio\", \"Philtrum Length\", \"Lip Chin Distance\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The lips demonstrate excellent proportions with balanced upper-to-lower lip ratio.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Well-Proportioned\", ideal: \"Perfect Ratio\" }\n    }\n  },\n  {\n    id: \"thin_lips\",\n    title: \"Thin Lip Profile\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Lip Ratio\", \"Upper Lip Projection\", \"Lower Lip Projection\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The lips appear thinner than ideal proportions, affecting lower face harmony.\",\n      severity_labels: { minor: \"Slightly Thin\", moderate: \"Thin\", severe: \"Very Thin\" }\n    }\n  },\n  {\n    id: \"ideal_ipd\",\n    title: \"Ideal Eye Spacing\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The eyes are ideally spaced, creating facial balance and attractiveness.\",\n      grade_labels: { good: \"Good Spacing\", excellent: \"Ideal Distance\", ideal: \"Perfect IPD\" }\n    }\n  },\n  {\n    id: \"wide_set_eyes\",\n    title: \"Wide-Set Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes are spaced wider apart than the aesthetic ideal.\",\n      severity_labels: { minor: \"Slightly Wide\", moderate: \"Noticeably Wide\", severe: \"Very Wide\" }\n    }\n  },\n  {\n    id: \"close_set_eyes\",\n    title: \"Close-Set Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"Intercanthal Width\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes are positioned closer together than the aesthetic ideal.\",\n      severity_labels: { minor: \"Slightly Close\", moderate: \"Noticeably Close\", severe: \"Very Close\" }\n    }\n  },\n  {\n    id: \"ideal_nose_projection\",\n    title: \"Ideal Nasal Projection\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasofrontal Angle\", \"Nasofacial Angle\", \"Nasomenta Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The nose has ideal forward projection relative to the face, creating profile harmony.\",\n      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect Projection\" }\n    }\n  },\n  {\n    id: \"recessed_chin\",\n    title: \"Recessed Chin\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Facial Depth to Height\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The chin sits behind the ideal position, affecting profile balance.\",\n      severity_labels: { minor: \"Slightly Recessed\", moderate: \"Recessed\", severe: \"Severely Recessed\" }\n    }\n  },\n  {\n    id: \"ideal_chin_projection\",\n    title: \"Ideal Chin Projection\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Anterior Facial Depth\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The chin demonstrates ideal projection and proportions relative to the face.\",\n      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect\" }\n    }\n  },\n  {\n    id: \"long_philtrum\",\n    title: \"Long Philtrum\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Philtrum Length\", \"Lip Chin Distance\", \"Upper Lip Height\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The distance between nose and upper lip is longer than ideal.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n    }\n  },\n  {\n    id: \"short_philtrum\",\n    title: \"Short Philtrum\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Philtrum Length\", \"Upper Lip Height\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The philtrum has ideal or shorter length, considered youthful and attractive.\",\n      grade_labels: { good: \"Good Length\", excellent: \"Short\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"wide_nose\",\n    title: \"Wide Nasal Base\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Index\", \"Intercanthal Nasal Ratio\", \"Nose Bridge Width\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The base of the nose is wider than the aesthetic ideal for facial harmony.\",\n      severity_labels: { minor: \"Slightly Wide\", moderate: \"Wide\", severe: \"Very Wide\" }\n    }\n  },\n  {\n    id: \"ideal_brow_position\",\n    title: \"Ideal Brow Position\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Eyebrow Height\", \"Brow Length Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The eyebrows are ideally positioned relative to the eyes and facial structure.\",\n      grade_labels: { good: \"Good Position\", excellent: \"Well-Arched\", ideal: \"Perfect Frame\" }\n    }\n  },\n  {\n    id: \"narrow_jaw\",\n    title: \"Narrow Jaw\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Jaw Width Ratio\", \"Bigonial Width\", \"Jaw Frontal Angle\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The jaw is narrower than ideal, affecting lower face width and definition.\",\n      severity_labels: { minor: \"Slightly Narrow\", moderate: \"Narrow\", severe: \"Very Narrow\" }\n    }\n  },\n  {\n    id: \"steep_mandibular_plane\",\n    title: \"Steep Mandibular Plane\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The mandibular plane angle is steeper than ideal, often indicating vertical growth pattern.\",\n      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n    }\n  },\n  // ============================================\n  // INSIGHT DEFINITIONS (element.html / element1.html)\n  // ============================================\n  // --- WEAKNESSES ---\n  {\n    id: \"steep_jaw\",\n    title: \"Steep Jaw\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Jaw Frontal Angle\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The jaw angles sharply downward, creating a narrow or pointed chin effect.\",\n      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n    }\n  },\n  {\n    id: \"maxillary_recession\",\n    title: \"Maxillary Recession\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Facial Depth to Height Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The upper jaw is less forward than ideal, reducing midface projection and facial harmony.\",\n      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n    }\n  },\n  {\n    id: \"mandibular_recession\",\n    title: \"Mandibular Recession\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The lower jaw is set back, creating a less prominent chin and an unbalanced profile.\",\n      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n    }\n  },\n  {\n    id: \"underprojected_chin\",\n    title: \"Underprojected Chin\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\", \"Chin Height\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The chin lacks forward projection, creating a weak lower face appearance.\",\n      severity_labels: { minor: \"Slightly Weak\", moderate: \"Underprojected\", severe: \"Severely Underprojected\" }\n    }\n  },\n  {\n    id: \"overly_long_face\",\n    title: \"Overly Long Face Shape\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Total Facial Width to Height Ratio\", \"Face Width to Height Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The face is excessively tall and narrow, creating an elongated appearance.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n    }\n  },\n  {\n    id: \"hyper_divergent_jaw\",\n    title: \"Hyper-Divergent Jaw Growth\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The jaw grows with an overly steep angle, resulting in a long or narrow lower face. This can indicate malocclusion.\",\n      severity_labels: { minor: \"Mildly Divergent\", moderate: \"Divergent\", severe: \"Hyper-Divergent\" }\n    }\n  },\n  {\n    id: \"weak_brow_ridge\",\n    title: \"Soft/Weak Brow Ridge\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Browridge Inclination Angle\", \"Eyebrow Height\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The forehead has a softer, less prominent ridge than the ideal, reducing masculine definition.\",\n      severity_labels: { minor: \"Slightly Soft\", moderate: \"Soft\", severe: \"Very Weak\" }\n    }\n  },\n  {\n    id: \"droopy_nasal_tip\",\n    title: \"Droopy Nasal Tip\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\", \"Nasofacial Angle\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nasal tip points downward more than ideal, creating a drooping appearance.\",\n      severity_labels: { minor: \"Slightly Droopy\", moderate: \"Droopy\", severe: \"Very Droopy\" }\n    }\n  },\n  {\n    id: \"overprojected_nose\",\n    title: \"Overprojected Nose\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Projection\", \"Nasofacial Angle\", \"Nose Length Ratio\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nose projects too far forward relative to the face, creating imbalance.\",\n      severity_labels: { minor: \"Slightly Projected\", moderate: \"Overprojected\", severe: \"Very Overprojected\" }\n    }\n  },\n  {\n    id: \"small_eyes\",\n    title: \"Small Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Eye Aspect Ratio\", \"Palpebral Fissure Length\", \"Eye Width\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes appear smaller than the aesthetic ideal relative to the face.\",\n      severity_labels: { minor: \"Slightly Small\", moderate: \"Small\", severe: \"Very Small\" }\n    }\n  },\n  {\n    id: \"low_set_eyebrows\",\n    title: \"Low-Set Eyebrows\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Eyebrow Height\", \"Brow to Hairline Distance\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyebrows sit lower than ideal, reducing the visible upper eyelid space.\",\n      severity_labels: { minor: \"Slightly Low\", moderate: \"Low\", severe: \"Very Low\" }\n    }\n  },\n  {\n    id: \"asymmetrical_face\",\n    title: \"Facial Asymmetry\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The left and right sides of the face show noticeable differences in proportion or position.\",\n      severity_labels: { minor: \"Slight Asymmetry\", moderate: \"Noticeable Asymmetry\", severe: \"Significant Asymmetry\" }\n    }\n  },\n  // --- STRENGTHS ---\n  {\n    id: \"good_jaw_width\",\n    title: \"Good Jaw Width\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Bigonial Width\", \"Jaw Width Ratio\", \"Jaw Frontal Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a pleasant jaw contour due to the jaw being neither too wide nor too narrow.\",\n      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n    }\n  },\n  {\n    id: \"good_forehead_slope\",\n    title: \"Good Forehead Slope\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Browridge Inclination Angle\", \"Forehead Height\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a pleasant forehead contour by indicating that the forehead is neither too steep nor too flat.\",\n      grade_labels: { good: \"Good Slope\", excellent: \"Well-Angled\", ideal: \"Ideal Slope\" }\n    }\n  },\n  {\n    id: \"good_cupids_bow\",\n    title: \"Good Cupid's Bow Depth\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Cupids Bow Depth\", \"Upper Lip Height\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious lip region due to the cupid's bow having ideal definition and depth.\",\n      grade_labels: { good: \"Defined\", excellent: \"Well-Defined\", ideal: \"Perfectly Defined\" }\n    }\n  },\n  {\n    id: \"good_eyebrow_length\",\n    title: \"Good Eyebrow Length\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Brow Length to Face Width Ratio\", \"Brow Length Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious eye region due to the eyebrows having ideal horizontal length relative to face width.\",\n      grade_labels: { good: \"Good Length\", excellent: \"Well-Proportioned\", ideal: \"Ideal Length\" }\n    }\n  },\n  {\n    id: \"good_neck_width\",\n    title: \"Good Neck Width\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Neck Width\", \"Neck to Jaw Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious lower face due to the neck being neither too wide nor too thin.\",\n      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n    }\n  },\n  {\n    id: \"ideal_nasolabial_angle\",\n    title: \"Ideal Nasolabial Angle\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The angle between nose and upper lip is in the ideal range, creating profile harmony.\",\n      grade_labels: { good: \"Good Angle\", excellent: \"Well-Angled\", ideal: \"Perfect Angle\" }\n    }\n  },\n  {\n    id: \"ideal_facial_depth\",\n    title: \"Ideal Facial Depth\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Facial Depth to Height Ratio\", \"Anterior Facial Depth\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face has ideal forward projection creating attractive three-dimensional contours.\",\n      grade_labels: { good: \"Good Depth\", excellent: \"Well-Projected\", ideal: \"Ideal Projection\" }\n    }\n  },\n  {\n    id: \"ideal_eye_shape\",\n    title: \"Ideal Eye Shape\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Eye Aspect Ratio\", \"Lateral Canthal Tilt\", \"Palpebral Fissure Length\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The eyes have an attractive almond shape with ideal proportions and tilt.\",\n      grade_labels: { good: \"Attractive\", excellent: \"Well-Shaped\", ideal: \"Hunter Eyes\" }\n    }\n  },\n  {\n    id: \"harmonious_profile\",\n    title: \"Harmonious Profile\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Total Profile Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The facial profile shows excellent balance between nose, lips, and chin positions.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfect Profile\" }\n    }\n  },\n  {\n    id: \"good_facial_symmetry\",\n    title: \"Good Facial Symmetry\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face displays excellent bilateral symmetry, a key component of attractiveness.\",\n      grade_labels: { good: \"Symmetric\", excellent: \"Very Symmetric\", ideal: \"Near-Perfect Symmetry\" }\n    }\n  }\n];\n\n// ============================================\n// METRIC NAME MAPPING\n// ============================================\n\n// Map display names to metric IDs for lookup\nconst METRIC_NAME_TO_ID: Record<string, string> = {\n  // Face Shape/Proportions\n  \"Face Width to Height Ratio\": \"faceWidthToHeight\",\n  \"Total Facial Width to Height\": \"totalFacialWidthToHeight\",\n  \"Total Facial Width to Height Ratio\": \"totalFacialWidthToHeight\",\n  \"Midface Ratio\": \"midfaceRatio\",\n  \"Upper Third Proportion\": \"upperThirdProportion\",\n  \"Middle Third Proportion\": \"middleThirdProportion\",\n  \"Lower Third Proportion\": \"lowerThirdProportion\",\n  \"Cheekbone Height\": \"cheekboneHeight\",\n  \"Cheekbone Width\": \"cheekboneWidth\",\n  \"Bitemporal Width\": \"bitemporalWidth\",\n  \"Forehead Height\": \"foreheadHeight\",\n  \"Facial Asymmetry Index\": \"facialAsymmetryIndex\",\n\n  // Jaw\n  \"Gonial Angle\": \"gonialAngle\",\n  \"Mandibular Plane Angle\": \"mandibularPlaneAngle\",\n  \"Jaw Width Ratio\": \"jawWidthRatio\",\n  \"Bigonial Width\": \"bigonialWidth\",\n  \"Jaw Frontal Angle\": \"jawFrontalAngle\",\n  \"Jaw Slope\": \"jawSlope\",\n  \"Jaw Asymmetry\": \"jawAsymmetry\",\n\n  // Chin\n  \"Chin to Philtrum Ratio\": \"chinPhiltrumRatio\",\n  \"Chin Height\": \"chinHeight\",\n  \"Facial Depth to Height\": \"facialDepthToHeight\",\n  \"Facial Depth to Height Ratio\": \"facialDepthToHeight\",\n  \"Anterior Facial Depth\": \"anteriorFacialDepth\",\n  \"Recession Relative to Frankfort Plane\": \"recessionFrankfort\",\n\n  // Eyes\n  \"Lateral Canthal Tilt\": \"lateralCanthalTilt\",\n  \"Eye Aspect Ratio\": \"eyeAspectRatio\",\n  \"Eye Separation Ratio\": \"eyeSeparationRatio\",\n  \"Interpupillary Ratio\": \"interpupillaryRatio\",\n  \"One Eye Apart Test\": \"oneEyeApartTest\",\n  \"Intercanthal Width\": \"intercanthalWidth\",\n  \"Eyebrow Height\": \"eyebrowHeight\",\n  \"Brow Length Ratio\": \"browLengthRatio\",\n  \"Brow Length to Face Width Ratio\": \"browLengthToFaceWidth\",\n  \"Palpebral Fissure Length\": \"palpebralFissureLength\",\n  \"Eye Width\": \"eyeWidth\",\n  \"Eye Asymmetry\": \"eyeAsymmetry\",\n  \"Brow to Hairline Distance\": \"browToHairlineDistance\",\n\n  // Brow\n  \"Browridge Inclination Angle\": \"browridgeInclinationAngle\",\n\n  // Nose\n  \"Nasal Index\": \"nasalIndex\",\n  \"Nasal Tip Angle\": \"nasalTipAngle\",\n  \"Nose Tip Position\": \"noseTipPosition\",\n  \"Frankfort-tip Angle\": \"frankfortTipAngle\",\n  \"Nasofrontal Angle\": \"nasofrontalAngle\",\n  \"Nasofacial Angle\": \"nasofacialAngle\",\n  \"Nasomenta Angle\": \"nasomentaAngle\",\n  \"Nasomental Angle\": \"nasomentaAngle\",\n  \"Intercanthal Nasal Ratio\": \"intercanthalNasalRatio\",\n  \"Nose Bridge Width\": \"noseBridgeWidth\",\n  \"Nose Width\": \"noseWidth\",\n  \"Nasal Projection\": \"nasalProjection\",\n  \"Nose Length Ratio\": \"noseLengthRatio\",\n  \"Ipsilateral Alar Angle\": \"ipsilateralAlarAngle\",\n\n  // Lips\n  \"Lip Ratio\": \"lipRatio\",\n  \"Philtrum Length\": \"philtrumLength\",\n  \"Upper Lip Projection\": \"upperLipProjection\",\n  \"Lower Lip Projection\": \"lowerLipProjection\",\n  \"Lip Chin Distance\": \"lipChinDistance\",\n  \"Upper Lip Height\": \"upperLipHeight\",\n  \"Upper Lip E-Line Position\": \"upperLipELine\",\n  \"Upper Lip S-Line Position\": \"upperLipSLine\",\n  \"Nasolabial Angle\": \"nasolabialAngle\",\n  \"Cupids Bow Depth\": \"cupidsBowDepth\",\n\n  // Neck\n  \"Neck Width\": \"neckWidth\",\n  \"Neck to Jaw Ratio\": \"neckToJawRatio\",\n\n  // Profile\n  \"Total Profile Angle\": \"totalProfileAngle\",\n};\n\n// ============================================\n// CLASSIFICATION FUNCTIONS\n// ============================================\n\n/**\n * Get weakness severity based on average score\n * 0-3 = \"Severe\", 3-5 = \"Moderate\", 5-7 = \"Minor\"\n */\nfunction getWeaknessSeverity(avgScore: number): WeaknessSeverity {\n  if (avgScore <= 3) return 'severe';\n  if (avgScore <= 5) return 'moderate';\n  return 'minor';\n}\n\n/**\n * Get strength grade based on average score\n * 8-9 = \"Good\", 9-9.5 = \"Excellent\", 9.5-10 = \"Ideal\"\n */\nfunction getStrengthGrade(avgScore: number): StrengthGrade {\n  if (avgScore >= 9.5) return 'ideal';\n  if (avgScore >= 9) return 'excellent';\n  return 'good';\n}\n\n/**\n * Find metric by display name from measurements array\n */\nfunction findMetricByName(\n  metricName: string,\n  measurements: MetricScoreResult[]\n): MetricScoreResult | undefined {\n  // First try direct ID mapping\n  const metricId = METRIC_NAME_TO_ID[metricName];\n  if (metricId) {\n    return measurements.find(m => m.metricId === metricId);\n  }\n\n  // Fallback: try fuzzy matching on name\n  const normalizedName = metricName.toLowerCase().replace(/[^a-z0-9]/g, '');\n  return measurements.find(m => {\n    const normalizedMetricName = m.name.toLowerCase().replace(/[^a-z0-9]/g, '');\n    return normalizedMetricName.includes(normalizedName) ||\n           normalizedName.includes(normalizedMetricName);\n  });\n}\n\n/**\n * Check if a metric should be considered a \"false positive\" weakness.\n * This handles directional/dimorphic metrics where low scores don't mean weakness.\n *\n * Example: Canthal Tilt of 3° gets a low score (not in 6-8° ideal range)\n * but is still a POSITIVE trait, not a weakness.\n */\nfunction isFalsePositiveWeakness(metric: MatchedMetric): boolean {\n  const config = METRIC_CONFIGS[metric.metricId];\n  if (!config) return false;\n\n  // Check if the value is actually acceptable based on polarity\n  const { acceptable } = isValueAcceptable(metric.value, config);\n  return acceptable;\n}\n\n/**\n * Process all insight definitions against user's measurements\n */\nexport function classifyInsights(\n  measurements: MetricScoreResult[],\n  insightDefinitions: InsightDefinition[] = INSIGHTS_DEFINITIONS\n): InsightClassificationResult {\n  const strengths: ClassifiedStrength[] = [];\n  const weaknesses: ClassifiedWeakness[] = [];\n\n  for (const insight of insightDefinitions) {\n    const { metrics, threshold } = insight.severity_logic;\n\n    // Find matching measurements for this insight\n    const matchedMetrics: MatchedMetric[] = [];\n    for (const metricName of metrics) {\n      const measurement = findMetricByName(metricName, measurements);\n      if (measurement) {\n        matchedMetrics.push({\n          metricId: measurement.metricId,\n          metricName: measurement.name,\n          score: measurement.score,\n          value: measurement.value,\n          idealMin: measurement.idealMin,\n          idealMax: measurement.idealMax,\n          unit: measurement.unit,\n          category: measurement.category,\n        });\n      }\n    }\n\n    // Skip if no metrics matched (need at least 1)\n    if (matchedMetrics.length === 0) continue;\n\n    // Calculate average score\n    const avgScore = matchedMetrics.reduce((sum, m) => sum + m.score, 0) / matchedMetrics.length;\n\n    // Classify based on type and threshold\n    if (insight.type === 'weakness') {\n      // Weakness: avg < threshold → add to areas of improvement\n      if (avgScore < threshold) {\n        // ========== FALSE POSITIVE CHECK ==========\n        // Before adding to weaknesses, check if ANY of the matched metrics\n        // are actually in an \"acceptable\" zone based on their polarity.\n        // If so, this is a false positive and should be skipped or reclassified.\n        const falsePositiveMetrics = matchedMetrics.filter(isFalsePositiveWeakness);\n\n        // If ALL matched metrics are false positives, skip this weakness entirely\n        if (falsePositiveMetrics.length === matchedMetrics.length) {\n          // This is a false positive weakness - the values are actually acceptable\n          // Consider adding to strengths if scores are decent\n          if (avgScore >= 6) {\n            strengths.push({\n              insightId: `${insight.id}_acceptable`,\n              title: insight.title.replace('Negative', 'Neutral').replace('Weak', 'Moderate'),\n              description: `While not in the peak ideal range, the measured values are within acceptable limits.`,\n              grade: 'good',\n              gradeLabel: 'Acceptable',\n              avgScore,\n              matchedMetrics,\n            });\n          }\n          continue; // Skip adding as weakness\n        }\n\n        // If SOME metrics are false positives, filter them out\n        const trueWeaknessMetrics = matchedMetrics.filter(m => !isFalsePositiveWeakness(m));\n        if (trueWeaknessMetrics.length === 0) continue;\n\n        // Recalculate average with only true weakness metrics\n        const trueAvgScore = trueWeaknessMetrics.reduce((sum, m) => sum + m.score, 0) / trueWeaknessMetrics.length;\n\n        // Only add as weakness if true average is still below threshold\n        if (trueAvgScore < threshold) {\n          const severity = getWeaknessSeverity(trueAvgScore);\n          const labels = insight.content.severity_labels;\n          const severityLabel = labels?.[severity] || severity;\n\n          weaknesses.push({\n            insightId: insight.id,\n            title: insight.title,\n            description: insight.content.description,\n            severity,\n            severityLabel,\n            avgScore: trueAvgScore,\n            matchedMetrics: trueWeaknessMetrics,\n          });\n        }\n      }\n    } else {\n      // Strength: avg > threshold → add to key strengths\n      if (avgScore > threshold) {\n        const grade = getStrengthGrade(avgScore);\n        const labels = insight.content.grade_labels;\n        const gradeLabel = labels?.[grade] || grade;\n\n        strengths.push({\n          insightId: insight.id,\n          title: insight.title,\n          description: insight.content.description,\n          grade,\n          gradeLabel,\n          avgScore,\n          matchedMetrics,\n        });\n      }\n    }\n  }\n\n  // Sort by score (weaknesses by lowest score first, strengths by highest first)\n  weaknesses.sort((a, b) => a.avgScore - b.avgScore);\n  strengths.sort((a, b) => b.avgScore - a.avgScore);\n\n  return { strengths, weaknesses };\n}\n\n/**\n * Convert ClassifiedStrength to Strength type for UI compatibility\n */\nexport function convertToStrength(classified: ClassifiedStrength): Strength {\n  return {\n    id: `insight_strength_${classified.insightId}`,\n    strengthName: `${classified.title} (${classified.gradeLabel})`,\n    summary: classified.description,\n    avgScore: Math.max(0, Math.min(10, classified.avgScore)),  // Clamp to 0-10\n    qualityLevel: classified.grade === 'ideal' ? 'ideal' :\n                  classified.grade === 'excellent' ? 'excellent' : 'good',\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n  };\n}\n\n/**\n * Convert ClassifiedWeakness to Flaw type for UI compatibility\n */\nexport function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  const impact = (10 - classified.avgScore) * 0.5;\n  const newRollingLost = rollingLost + impact;\n\n  return {\n    id: `insight_flaw_${classified.insightId}`,\n    flawName: `${classified.title} (${classified.severityLabel})`,\n    summary: classified.description,\n    harmonyPercentageLost: impact,\n    standardizedImpact: impact / 10,\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n    rollingPointsDeducted: newRollingLost,\n    rollingHarmonyPercentageLost: newRollingLost,\n    rollingStandardizedImpact: newRollingLost / 10,\n  };\n}\n\n/**\n * Main function: Generate strengths and flaws from measurements using insights\n */\nexport function generateInsightBasedResults(\n  measurements: MetricScoreResult[]\n): { strengths: Strength[]; flaws: Flaw[] } {\n  const { strengths: classifiedStrengths, weaknesses: classifiedWeaknesses } = classifyInsights(measurements);\n\n  // Convert to UI-compatible types\n  const strengths = classifiedStrengths.map((s) => convertToStrength(s));\n\n  let rollingLost = 0;\n  const flaws = classifiedWeaknesses.map((w, i) => {\n    const flaw = convertToFlaw(w, i, rollingLost);\n    rollingLost = flaw.rollingPointsDeducted || 0;\n    return flaw;\n  });\n\n  return { strengths, flaws };\n}\n","structuredPatch":[{"oldStart":1619,"oldLines":6,"newStart":1619,"newLines":13,"lines":["   severityLabel: string;  // Custom label from definition (e.g., \"Extremely Long\")","   avgScore: number;","   matchedMetrics: MatchedMetric[];","+  /**","+   * Confidence level based on Z-score magnitude:","+   * - confirmed: |z| >= 2 (high statistical certainty, 2+ SDs from mean)","+   * - likely: 1 <= |z| < 2 (moderate certainty)","+   * - possible: 0.5 <= |z| < 1 (low certainty)","+   */","+  confidence: ConfidenceLevel;"," }"," "," export interface ClassifiedStrength {"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"3223a065-145c-4e79-8754-bfbd4f7df063","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Khv4qu5Rwu3hZSMUsNFmea","type":"message","role":"assistant","content":[{"type":"text","text":"Now I need to add the confidence calculation function and update the classification logic. Let me add the function after the existing Z-score functions (around line 1500):"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":825,"cache_read_input_tokens":134582,"cache_creation":{"ephemeral_5m_input_tokens":825,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVG7rg4NJsLJ1xdpQhh","type":"assistant","uuid":"9af1bf49-69a9-4092-933e-1a7729a5c604","timestamp":"2025-12-26T14:52:33.830Z"}
{"parentUuid":"9af1bf49-69a9-4092-933e-1a7729a5c604","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Khv4qu5Rwu3hZSMUsNFmea","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016XV4MCApN2Mn92NLBsUJpA","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","offset":1480,"limit":80}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":825,"cache_read_input_tokens":134582,"cache_creation":{"ephemeral_5m_input_tokens":825,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVG7rg4NJsLJ1xdpQhh","type":"assistant","uuid":"3bae7d4e-daff-46a9-8508-df02e764fb8e","timestamp":"2025-12-26T14:52:34.937Z"}
{"parentUuid":"3bae7d4e-daff-46a9-8508-df02e764fb8e","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016XV4MCApN2Mn92NLBsUJpA","type":"tool_result","content":"  1480→  return baseConfig;\n  1481→}\n  1482→\n  1483→// ============================================\n  1484→// Z-SCORE SEVERITY FUNCTIONS\n  1485→// ============================================\n  1486→\n  1487→/**\n  1488→ * Calculate Z-score for a given value\n  1489→ * Z = (value - mean) / std_dev\n  1490→ */\n  1491→export function calculateZScore(value: number, mean: number, stdDev: number): number {\n  1492→  if (stdDev === 0) return 0;\n  1493→  return Math.abs((value - mean) / stdDev);\n  1494→}\n  1495→\n  1496→/**\n  1497→ * Determine severity level based on Z-score and ideal range (5-tier system)\n  1498→ * - Ideal: Value is within ideal range\n  1499→ * - Good: |z| < 0.5 (within 0.5 standard deviation)\n  1500→ * - Fair: 0.5 ≤ |z| < 1 (between 0.5-1 standard deviations)\n  1501→ * - Moderate: 1 ≤ |z| < 2 (between 1-2 standard deviations)\n  1502→ * - Severe: |z| ≥ 2 (more than 2 standard deviations away)\n  1503→ */\n  1504→export function getSeverityFromZScore(\n  1505→  value: number,\n  1506→  config: MasterMetricConfig\n  1507→): { severity: SeverityLevel; zScore: number; isInIdeal: boolean } {\n  1508→  const { ideal, mean, std_dev } = config;\n  1509→  const isInIdeal = value >= ideal[0] && value <= ideal[1];\n  1510→  const zScore = calculateZScore(value, mean, std_dev);\n  1511→\n  1512→  let severity: SeverityLevel;\n  1513→  if (isInIdeal) {\n  1514→    severity = 'ideal';\n  1515→  } else if (zScore < 0.5) {\n  1516→    severity = 'good';\n  1517→  } else if (zScore < 1) {\n  1518→    severity = 'fair';\n  1519→  } else if (zScore < 2) {\n  1520→    severity = 'moderate';\n  1521→  } else {\n  1522→    severity = 'severe';\n  1523→  }\n  1524→\n  1525→  return { severity, zScore, isInIdeal };\n  1526→}\n  1527→\n  1528→/**\n  1529→ * Get severity for a metric value with ethnicity/gender awareness\n  1530→ */\n  1531→export function getSeverityForMetric(\n  1532→  metricId: string,\n  1533→  value: number,\n  1534→  gender: Gender = 'male',\n  1535→  ethnicity: Ethnicity = 'white'\n  1536→): { severity: SeverityLevel; zScore: number; isInIdeal: boolean; config: MasterMetricConfig } | null {\n  1537→  const config = getMetricConfig(metricId, gender, ethnicity);\n  1538→  if (!config) return null;\n  1539→\n  1540→  const result = getSeverityFromZScore(value, config);\n  1541→  return { ...result, config };\n  1542→}\n  1543→\n  1544→/**\n  1545→ * Get badge color for severity level (5-tier)\n  1546→ */\n  1547→export function getSeverityColor(severity: SeverityLevel): string {\n  1548→  switch (severity) {\n  1549→    case 'ideal': return 'green';\n  1550→    case 'good': return 'blue';\n  1551→    case 'fair': return 'cyan';\n  1552→    case 'moderate': return 'yellow';\n  1553→    case 'severe': return 'red';\n  1554→    default: return 'gray';\n  1555→  }\n  1556→}\n  1557→\n  1558→/**\n  1559→ * Get severity label for display (5-tier)\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"aff75dcb-5cd6-4b21-bee5-5df27b07c778","timestamp":"2025-12-26T14:52:35.019Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","content":"  return baseConfig;\n}\n\n// ============================================\n// Z-SCORE SEVERITY FUNCTIONS\n// ============================================\n\n/**\n * Calculate Z-score for a given value\n * Z = (value - mean) / std_dev\n */\nexport function calculateZScore(value: number, mean: number, stdDev: number): number {\n  if (stdDev === 0) return 0;\n  return Math.abs((value - mean) / stdDev);\n}\n\n/**\n * Determine severity level based on Z-score and ideal range (5-tier system)\n * - Ideal: Value is within ideal range\n * - Good: |z| < 0.5 (within 0.5 standard deviation)\n * - Fair: 0.5 ≤ |z| < 1 (between 0.5-1 standard deviations)\n * - Moderate: 1 ≤ |z| < 2 (between 1-2 standard deviations)\n * - Severe: |z| ≥ 2 (more than 2 standard deviations away)\n */\nexport function getSeverityFromZScore(\n  value: number,\n  config: MasterMetricConfig\n): { severity: SeverityLevel; zScore: number; isInIdeal: boolean } {\n  const { ideal, mean, std_dev } = config;\n  const isInIdeal = value >= ideal[0] && value <= ideal[1];\n  const zScore = calculateZScore(value, mean, std_dev);\n\n  let severity: SeverityLevel;\n  if (isInIdeal) {\n    severity = 'ideal';\n  } else if (zScore < 0.5) {\n    severity = 'good';\n  } else if (zScore < 1) {\n    severity = 'fair';\n  } else if (zScore < 2) {\n    severity = 'moderate';\n  } else {\n    severity = 'severe';\n  }\n\n  return { severity, zScore, isInIdeal };\n}\n\n/**\n * Get severity for a metric value with ethnicity/gender awareness\n */\nexport function getSeverityForMetric(\n  metricId: string,\n  value: number,\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'white'\n): { severity: SeverityLevel; zScore: number; isInIdeal: boolean; config: MasterMetricConfig } | null {\n  const config = getMetricConfig(metricId, gender, ethnicity);\n  if (!config) return null;\n\n  const result = getSeverityFromZScore(value, config);\n  return { ...result, config };\n}\n\n/**\n * Get badge color for severity level (5-tier)\n */\nexport function getSeverityColor(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'green';\n    case 'good': return 'blue';\n    case 'fair': return 'cyan';\n    case 'moderate': return 'yellow';\n    case 'severe': return 'red';\n    default: return 'gray';\n  }\n}\n\n/**\n * Get severity label for display (5-tier)","numLines":80,"startLine":1480,"totalLines":2650}}}
{"parentUuid":"aff75dcb-5cd6-4b21-bee5-5df27b07c778","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_012mN2jSkhaSRtWa5So18HDb","type":"message","role":"assistant","content":[{"type":"text","text":"I see there's already a Z-score calculation function. Now I need to add a confidence calculation function based on Z-score. Let me add it after the existing Z-score functions:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":69052,"cache_read_input_tokens":13150,"cache_creation":{"ephemeral_5m_input_tokens":69052,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVGSAkXbVrFHzMAJeqn","type":"assistant","uuid":"9db43349-d2c3-4f68-aeb0-3f11539d43e1","timestamp":"2025-12-26T14:52:41.757Z"}
{"parentUuid":"9db43349-d2c3-4f68-aeb0-3f11539d43e1","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_012mN2jSkhaSRtWa5So18HDb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FJE5K16Pg6DQnTAJpyZ3XY","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","offset":1555,"limit":60}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":69052,"cache_read_input_tokens":13150,"cache_creation":{"ephemeral_5m_input_tokens":69052,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVGSAkXbVrFHzMAJeqn","type":"assistant","uuid":"24716b8d-664c-4efe-bfcb-e9dd42e8f94d","timestamp":"2025-12-26T14:52:42.548Z"}
{"parentUuid":"24716b8d-664c-4efe-bfcb-e9dd42e8f94d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FJE5K16Pg6DQnTAJpyZ3XY","type":"tool_result","content":"  1555→  }\n  1556→}\n  1557→\n  1558→/**\n  1559→ * Get severity label for display (5-tier)\n  1560→ */\n  1561→export function getSeverityLabel(severity: SeverityLevel): string {\n  1562→  switch (severity) {\n  1563→    case 'ideal': return 'Ideal';\n  1564→    case 'good': return 'Good';\n  1565→    case 'fair': return 'Fair';\n  1566→    case 'moderate': return 'Moderate';\n  1567→    case 'severe': return 'Severe';\n  1568→    default: return 'Unknown';\n  1569→  }\n  1570→}\n  1571→\n  1572→// ============================================\n  1573→// INSIGHT DEFINITION TYPES\n  1574→// ============================================\n  1575→\n  1576→export interface InsightSeverityLogic {\n  1577→  metrics: string[];  // Display names of metrics (e.g., \"Face Width to Height Ratio\")\n  1578→  threshold: number;  // Score threshold for classification\n  1579→}\n  1580→\n  1581→export interface WeaknessSeverityLabels {\n  1582→  minor: string;\n  1583→  moderate: string;\n  1584→  severe: string;\n  1585→}\n  1586→\n  1587→export interface StrengthGradeLabels {\n  1588→  good: string;\n  1589→  excellent: string;\n  1590→  ideal: string;\n  1591→}\n  1592→\n  1593→export interface InsightContent {\n  1594→  description: string;\n  1595→  severity_labels?: WeaknessSeverityLabels;  // For weaknesses\n  1596→  grade_labels?: StrengthGradeLabels;        // For strengths\n  1597→}\n  1598→\n  1599→export interface InsightDefinition {\n  1600→  id: string;\n  1601→  title: string;\n  1602→  type: 'weakness' | 'strength';\n  1603→  severity_logic: InsightSeverityLogic;\n  1604→  content: InsightContent;\n  1605→}\n  1606→\n  1607→// ============================================\n  1608→// CLASSIFICATION RESULT TYPES\n  1609→// ============================================\n  1610→\n  1611→export type WeaknessSeverity = 'severe' | 'moderate' | 'minor';\n  1612→export type StrengthGrade = 'ideal' | 'excellent' | 'good';\n  1613→\n  1614→export interface ClassifiedWeakness {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"b8043b2a-9f57-4305-b3be-2b2270ba202f","timestamp":"2025-12-26T14:52:42.713Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","content":"  }\n}\n\n/**\n * Get severity label for display (5-tier)\n */\nexport function getSeverityLabel(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'Ideal';\n    case 'good': return 'Good';\n    case 'fair': return 'Fair';\n    case 'moderate': return 'Moderate';\n    case 'severe': return 'Severe';\n    default: return 'Unknown';\n  }\n}\n\n// ============================================\n// INSIGHT DEFINITION TYPES\n// ============================================\n\nexport interface InsightSeverityLogic {\n  metrics: string[];  // Display names of metrics (e.g., \"Face Width to Height Ratio\")\n  threshold: number;  // Score threshold for classification\n}\n\nexport interface WeaknessSeverityLabels {\n  minor: string;\n  moderate: string;\n  severe: string;\n}\n\nexport interface StrengthGradeLabels {\n  good: string;\n  excellent: string;\n  ideal: string;\n}\n\nexport interface InsightContent {\n  description: string;\n  severity_labels?: WeaknessSeverityLabels;  // For weaknesses\n  grade_labels?: StrengthGradeLabels;        // For strengths\n}\n\nexport interface InsightDefinition {\n  id: string;\n  title: string;\n  type: 'weakness' | 'strength';\n  severity_logic: InsightSeverityLogic;\n  content: InsightContent;\n}\n\n// ============================================\n// CLASSIFICATION RESULT TYPES\n// ============================================\n\nexport type WeaknessSeverity = 'severe' | 'moderate' | 'minor';\nexport type StrengthGrade = 'ideal' | 'excellent' | 'good';\n\nexport interface ClassifiedWeakness {","numLines":60,"startLine":1555,"totalLines":2650}}}
{"parentUuid":"b8043b2a-9f57-4305-b3be-2b2270ba202f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01BMghodvtvqPpdDcTimQf3c","type":"message","role":"assistant","content":[{"type":"text","text":"Now I'll add the confidence calculation function after the severity label function:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":942,"cache_read_input_tokens":82202,"cache_creation":{"ephemeral_5m_input_tokens":942,"ephemeral_1h_input_tokens":0},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CWVVGzwyheCwXDLXxFAjK","type":"assistant","uuid":"98765335-5b94-44e3-9cc6-43aef864c55f","timestamp":"2025-12-26T14:52:47.480Z"}
{"parentUuid":"98765335-5b94-44e3-9cc6-43aef864c55f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01BMghodvtvqPpdDcTimQf3c","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MaW8wYp921qfc3vA8QxDkF","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","old_string":"/**\n * Get severity label for display (5-tier)\n */\nexport function getSeverityLabel(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'Ideal';\n    case 'good': return 'Good';\n    case 'fair': return 'Fair';\n    case 'moderate': return 'Moderate';\n    case 'severe': return 'Severe';\n    default: return 'Unknown';\n  }\n}\n\n// ============================================\n// INSIGHT DEFINITION TYPES\n// ============================================","new_string":"/**\n * Get severity label for display (5-tier)\n */\nexport function getSeverityLabel(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'Ideal';\n    case 'good': return 'Good';\n    case 'fair': return 'Fair';\n    case 'moderate': return 'Moderate';\n    case 'severe': return 'Severe';\n    default: return 'Unknown';\n  }\n}\n\n// ============================================\n// CONFIDENCE CALCULATION (Z-Score Based)\n// ============================================\n\n/**\n * Calculate confidence level for flaw detection based on Z-score magnitude.\n *\n * Logic from FaceIQ:\n * - confirmed: |z| >= 2 (high statistical certainty - 2+ standard deviations)\n * - likely: 1 <= |z| < 2 (moderate certainty - 1-2 standard deviations)\n * - possible: 0.5 <= |z| < 1 (low certainty - 0.5-1 standard deviation)\n *\n * For metrics without Z-score data, we calculate confidence from the score:\n * Score 0-3 = confirmed (very poor score = high confidence it's a flaw)\n * Score 3-5 = likely (poor score = moderate confidence)\n * Score 5-7 = possible (below average = low confidence)\n *\n * @param zScore - The absolute Z-score value\n * @returns ConfidenceLevel - 'confirmed' | 'likely' | 'possible'\n */\nexport function calculateConfidenceFromZScore(zScore: number): ConfidenceLevel {\n  if (zScore >= 2) return 'confirmed';\n  if (zScore >= 1) return 'likely';\n  return 'possible';\n}\n\n/**\n * Calculate confidence level from score when Z-score is unavailable.\n * Maps score ranges to confidence levels inversely (lower score = higher confidence).\n *\n * @param avgScore - Average score of the flaw (0-10 scale)\n * @returns ConfidenceLevel\n */\nexport function calculateConfidenceFromScore(avgScore: number): ConfidenceLevel {\n  // Very low scores = high confidence it's a real flaw\n  if (avgScore <= 3) return 'confirmed';\n  // Poor scores = moderate confidence\n  if (avgScore <= 5) return 'likely';\n  // Below average scores = low confidence\n  return 'possible';\n}\n\n/**\n * Calculate confidence for a set of matched metrics.\n * Uses Z-score when available, falls back to score-based calculation.\n *\n * @param matchedMetrics - Array of metrics contributing to the flaw\n * @param avgScore - Overall average score of the flaw\n * @returns ConfidenceLevel\n */\nexport function calculateFlawConfidence(\n  matchedMetrics: MatchedMetric[],\n  avgScore: number\n): ConfidenceLevel {\n  // Calculate Z-scores for each metric if we have the config\n  const zScores: number[] = [];\n\n  for (const metric of matchedMetrics) {\n    const config = MASTER_SCORING_DB[metric.metricId];\n    if (config && config.std_dev > 0) {\n      const zScore = calculateZScore(metric.value, config.mean, config.std_dev);\n      zScores.push(zScore);\n    }\n  }\n\n  // If we have Z-scores, use the maximum (highest deviation = highest confidence)\n  if (zScores.length > 0) {\n    const maxZScore = Math.max(...zScores);\n    return calculateConfidenceFromZScore(maxZScore);\n  }\n\n  // Fall back to score-based confidence\n  return calculateConfidenceFromScore(avgScore);\n}\n\n// ============================================\n// INSIGHT DEFINITION TYPES\n// ============================================"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":942,"cache_read_input_tokens":82202,"cache_creation":{"ephemeral_5m_input_tokens":942,"ephemeral_1h_input_tokens":0},"output_tokens":1228,"service_tier":"standard"}},"requestId":"req_011CWVVGzwyheCwXDLXxFAjK","type":"assistant","uuid":"51235b30-11ab-4c56-a56e-ce65b4110590","timestamp":"2025-12-26T14:53:00.291Z"}
{"parentUuid":"51235b30-11ab-4c56-a56e-ce65b4110590","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MaW8wYp921qfc3vA8QxDkF","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  1554→    default: return 'gray';\n  1555→  }\n  1556→}\n  1557→\n  1558→/**\n  1559→ * Get severity label for display (5-tier)\n  1560→ */\n  1561→export function getSeverityLabel(severity: SeverityLevel): string {\n  1562→  switch (severity) {\n  1563→    case 'ideal': return 'Ideal';\n  1564→    case 'good': return 'Good';\n  1565→    case 'fair': return 'Fair';\n  1566→    case 'moderate': return 'Moderate';\n  1567→    case 'severe': return 'Severe';\n  1568→    default: return 'Unknown';\n  1569→  }\n  1570→}\n  1571→\n  1572→// ============================================\n  1573→// CONFIDENCE CALCULATION (Z-Score Based)\n  1574→// ============================================\n  1575→\n  1576→/**\n  1577→ * Calculate confidence level for flaw detection based on Z-score magnitude.\n  1578→ *\n  1579→ * Logic from FaceIQ:\n  1580→ * - confirmed: |z| >= 2 (high statistical certainty - 2+ standard deviations)\n  1581→ * - likely: 1 <= |z| < 2 (moderate certainty - 1-2 standard deviations)\n  1582→ * - possible: 0.5 <= |z| < 1 (low certainty - 0.5-1 standard deviation)\n  1583→ *\n  1584→ * For metrics without Z-score data, we calculate confidence from the score:\n  1585→ * Score 0-3 = confirmed (very poor score = high confidence it's a flaw)\n  1586→ * Score 3-5 = likely (poor score = moderate confidence)\n  1587→ * Score 5-7 = possible (below average = low confidence)\n  1588→ *\n  1589→ * @param zScore - The absolute Z-score value\n  1590→ * @returns ConfidenceLevel - 'confirmed' | 'likely' | 'possible'\n  1591→ */\n  1592→export function calculateConfidenceFromZScore(zScore: number): ConfidenceLevel {\n  1593→  if (zScore >= 2) return 'confirmed';\n  1594→  if (zScore >= 1) return 'likely';\n  1595→  return 'possible';\n  1596→}\n  1597→\n  1598→/**\n  1599→ * Calculate confidence level from score when Z-score is unavailable.\n  1600→ * Maps score ranges to confidence levels inversely (lower score = higher confidence).\n  1601→ *\n  1602→ * @param avgScore - Average score of the flaw (0-10 scale)\n  1603→ * @returns ConfidenceLevel\n  1604→ */\n  1605→export function calculateConfidenceFromScore(avgScore: number): ConfidenceLevel {\n  1606→  // Very low scores = high confidence it's a real flaw\n  1607→  if (avgScore <= 3) return 'confirmed';\n  1608→  // Poor scores = moderate confidence\n  1609→  if (avgScore <= 5) return 'likely';\n  1610→  // Below average scores = low confidence\n  1611→  return 'possible';\n  1612→}\n  1613→\n  1614→/**\n  1615→ * Calculate confidence for a set of matched metrics.\n  1616→ * Uses Z-score when available, falls back to score-based calculation.\n  1617→ *\n  1618→ * @param matchedMetrics - Array of metrics contributing to the flaw\n  1619→ * @param avgScore - Overall average score of the flaw\n  1620→ * @returns ConfidenceLevel\n  1621→ */\n  1622→export function calculateFlawConfidence(\n  1623→  matchedMetrics: MatchedMetric[],\n  1624→  avgScore: number\n  1625→): ConfidenceLevel {\n  1626→  // Calculate Z-scores for each metric if we have the config\n  1627→  const zScores: number[] = [];\n  1628→\n  1629→  for (const metric of matchedMetrics) {\n  1630→    const config = MASTER_SCORING_DB[metric.metricId];\n  1631→    if (config && config.std_dev > 0) {\n  1632→      const zScore = calculateZScore(metric.value, config.mean, config.std_dev);\n  1633→      zScores.push(zScore);\n  1634→    }\n  1635→  }\n  1636→\n  1637→  // If we have Z-scores, use the maximum (highest deviation = highest confidence)\n  1638→  if (zScores.length > 0) {\n  1639→    const maxZScore = Math.max(...zScores);\n  1640→    return calculateConfidenceFromZScore(maxZScore);\n  1641→  }\n  1642→\n  1643→  // Fall back to score-based confidence\n  1644→  return calculateConfidenceFromScore(avgScore);\n  1645→}\n  1646→\n  1647→// ============================================\n  1648→// INSIGHT DEFINITION TYPES\n  1649→// ============================================\n  1650→\n  1651→export interface InsightSeverityLogic {\n  1652→  metrics: string[];  // Display names of metrics (e.g., \"Face Width to Height Ratio\")\n  1653→  threshold: number;  // Score threshold for classification"}]},"uuid":"99ea586e-36e9-4652-9002-98a05c931547","timestamp":"2025-12-26T14:53:00.350Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","oldString":"/**\n * Get severity label for display (5-tier)\n */\nexport function getSeverityLabel(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'Ideal';\n    case 'good': return 'Good';\n    case 'fair': return 'Fair';\n    case 'moderate': return 'Moderate';\n    case 'severe': return 'Severe';\n    default: return 'Unknown';\n  }\n}\n\n// ============================================\n// INSIGHT DEFINITION TYPES\n// ============================================","newString":"/**\n * Get severity label for display (5-tier)\n */\nexport function getSeverityLabel(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'Ideal';\n    case 'good': return 'Good';\n    case 'fair': return 'Fair';\n    case 'moderate': return 'Moderate';\n    case 'severe': return 'Severe';\n    default: return 'Unknown';\n  }\n}\n\n// ============================================\n// CONFIDENCE CALCULATION (Z-Score Based)\n// ============================================\n\n/**\n * Calculate confidence level for flaw detection based on Z-score magnitude.\n *\n * Logic from FaceIQ:\n * - confirmed: |z| >= 2 (high statistical certainty - 2+ standard deviations)\n * - likely: 1 <= |z| < 2 (moderate certainty - 1-2 standard deviations)\n * - possible: 0.5 <= |z| < 1 (low certainty - 0.5-1 standard deviation)\n *\n * For metrics without Z-score data, we calculate confidence from the score:\n * Score 0-3 = confirmed (very poor score = high confidence it's a flaw)\n * Score 3-5 = likely (poor score = moderate confidence)\n * Score 5-7 = possible (below average = low confidence)\n *\n * @param zScore - The absolute Z-score value\n * @returns ConfidenceLevel - 'confirmed' | 'likely' | 'possible'\n */\nexport function calculateConfidenceFromZScore(zScore: number): ConfidenceLevel {\n  if (zScore >= 2) return 'confirmed';\n  if (zScore >= 1) return 'likely';\n  return 'possible';\n}\n\n/**\n * Calculate confidence level from score when Z-score is unavailable.\n * Maps score ranges to confidence levels inversely (lower score = higher confidence).\n *\n * @param avgScore - Average score of the flaw (0-10 scale)\n * @returns ConfidenceLevel\n */\nexport function calculateConfidenceFromScore(avgScore: number): ConfidenceLevel {\n  // Very low scores = high confidence it's a real flaw\n  if (avgScore <= 3) return 'confirmed';\n  // Poor scores = moderate confidence\n  if (avgScore <= 5) return 'likely';\n  // Below average scores = low confidence\n  return 'possible';\n}\n\n/**\n * Calculate confidence for a set of matched metrics.\n * Uses Z-score when available, falls back to score-based calculation.\n *\n * @param matchedMetrics - Array of metrics contributing to the flaw\n * @param avgScore - Overall average score of the flaw\n * @returns ConfidenceLevel\n */\nexport function calculateFlawConfidence(\n  matchedMetrics: MatchedMetric[],\n  avgScore: number\n): ConfidenceLevel {\n  // Calculate Z-scores for each metric if we have the config\n  const zScores: number[] = [];\n\n  for (const metric of matchedMetrics) {\n    const config = MASTER_SCORING_DB[metric.metricId];\n    if (config && config.std_dev > 0) {\n      const zScore = calculateZScore(metric.value, config.mean, config.std_dev);\n      zScores.push(zScore);\n    }\n  }\n\n  // If we have Z-scores, use the maximum (highest deviation = highest confidence)\n  if (zScores.length > 0) {\n    const maxZScore = Math.max(...zScores);\n    return calculateConfidenceFromZScore(maxZScore);\n  }\n\n  // Fall back to score-based confidence\n  return calculateConfidenceFromScore(avgScore);\n}\n\n// ============================================\n// INSIGHT DEFINITION TYPES\n// ============================================","originalFile":"/**\n * Insights Engine\n *\n * Processes insight definitions from insights.json and classifies them\n * as strengths or areas of improvement based on user's metric scores.\n *\n * Logic:\n * - For each insight definition, calculate average score of affected metrics\n * - Weakness: if avg score < threshold → classify with severity label\n * - Strength: if avg score > threshold → classify with grade label\n *\n * Z-Score Based 5-Tier Severity Logic:\n * - Ideal (Green): User is inside the ideal range\n * - Good (Blue): Within 0.5 Standard Deviation of the mean (|z| < 0.5)\n * - Fair (Cyan): Between 0.5 and 1 Standard Deviation (0.5 ≤ |z| < 1)\n * - Moderate (Yellow): Between 1 and 2 Standard Deviations (1 ≤ |z| < 2)\n * - Severe (Red): More than 2 Standard Deviations away (|z| ≥ 2)\n *\n * Severity Labels (Weaknesses):\n *   0-3 = \"Severe\"\n *   3-5 = \"Moderate\"\n *   5-7 = \"Minor\"\n *\n * Grade Labels (Strengths):\n *   8-9   = \"Good\"\n *   9-9.5 = \"Excellent\"\n *   9.5-10 = \"Ideal\"\n */\n\nimport { Strength, Flaw } from '@/types/results';\nimport { MetricScoreResult, METRIC_CONFIGS, isValueAcceptable, ConfidenceLevel } from '@/lib/harmony-scoring';\n\n// ============================================\n// MASTER SCORING DATABASE (Z-Score Based)\n// ============================================\n\nexport type SeverityLevel = 'ideal' | 'good' | 'fair' | 'moderate' | 'severe';\nexport type Gender = 'male' | 'female';\nexport type Ethnicity = 'white' | 'black' | 'east_asian' | 'south_asian' | 'hispanic' | 'middle_eastern' | 'native_american' | 'pacific_islander';\n\nexport interface MasterMetricConfig {\n  ideal: [number, number];  // [min, max] ideal range\n  mean: number;             // Population mean\n  std_dev: number;          // Standard deviation\n  flaws?: {\n    low?: string[];         // Flaws when value is too low\n    high?: string[];        // Flaws when value is too high\n  };\n}\n\n// Base/Default standards (White Male baseline)\nexport const MASTER_SCORING_DB: Record<string, MasterMetricConfig> = {\n  // MIDFACE & PROPORTIONS\n  \"midface_ratio\": {\n    ideal: [0.97, 1.00],\n    mean: 1.0,\n    std_dev: 0.115,\n    flaws: { low: [\"Long midface\", \"Long upper jaw\"] }\n  },\n  \"faceWidthToHeight\": {\n    ideal: [1.30, 1.45],\n    mean: 1.38,\n    std_dev: 0.08,\n    flaws: {\n      low: [\"Overly long face\", \"Narrow face\"],\n      high: [\"Wide face\", \"Short face\"]\n    }\n  },\n  \"totalFacialWidthToHeight\": {\n    ideal: [1.25, 1.40],\n    mean: 1.33,\n    std_dev: 0.075,\n    flaws: {\n      low: [\"Long face shape\"],\n      high: [\"Wide face shape\"]\n    }\n  },\n  \"upperThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short forehead\"],\n      high: [\"Long forehead\"]\n    }\n  },\n  \"middleThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short midface\"],\n      high: [\"Long midface\"]\n    }\n  },\n  \"lowerThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short lower face\"],\n      high: [\"Long lower face\"]\n    }\n  },\n\n  // EYE SPACING & IPD\n  \"eye_separation_ratio\": {\n    ideal: [0.45, 0.47],\n    mean: 0.46,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"interpupillaryRatio\": {\n    ideal: [0.44, 0.48],\n    mean: 0.46,\n    std_dev: 0.025,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"oneEyeApartTest\": {\n    ideal: [0.95, 1.05],\n    mean: 1.0,\n    std_dev: 0.08,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"intercanthalWidth\": {\n    ideal: [30, 35],\n    mean: 32.5,\n    std_dev: 2.5,\n    flaws: {\n      low: [\"Narrow eye spacing\"],\n      high: [\"Wide eye spacing\"]\n    }\n  },\n\n  // EYE SHAPE & FEATURES\n  \"lateralCanthalTilt\": {\n    ideal: [6, 8],\n    mean: 5.0,\n    std_dev: 3.5,\n    flaws: {\n      low: [\"Negative canthal tilt\", \"Downturned eyes\"],\n      high: [\"Excessively upturned eyes\"]\n    }\n  },\n  \"eyeAspectRatio\": {\n    ideal: [0.30, 0.35],\n    mean: 0.32,\n    std_dev: 0.04,\n    flaws: {\n      low: [\"Narrow eyes\"],\n      high: [\"Round eyes\"]\n    }\n  },\n  \"palpebralFissureLength\": {\n    ideal: [28, 32],\n    mean: 30.0,\n    std_dev: 2.5,\n    flaws: {\n      low: [\"Small eyes\"],\n      high: [\"Large eyes\"]\n    }\n  },\n  \"eyeWidth\": {\n    ideal: [28, 32],\n    mean: 30.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Narrow eyes\"],\n      high: [\"Wide eyes\"]\n    }\n  },\n  \"upperEyelidExposure\": {\n    ideal: [0.5, 1.2],\n    mean: 0.85,\n    std_dev: 0.35,\n    flaws: {\n      low: [\"Hooded eyes\"],\n      high: [\"Excessive upper lid exposure\"]\n    }\n  },\n  \"tearTroughDepth\": {\n    ideal: [0.0, 0.3],\n    mean: 0.15,\n    std_dev: 0.15,\n    flaws: {\n      high: [\"Dark circles / Tear troughs\", \"Under-eye hollowness\"]\n    }\n  },\n\n  // JAW ANGLES & STRUCTURE\n  \"gonial_angle\": {\n    ideal: [115, 125],\n    mean: 118.0,\n    std_dev: 6.5,\n    flaws: {\n      high: [\"Weak/soft jaw structure\", \"Rounded jaw\"]\n    }\n  },\n  \"mandibularPlaneAngle\": {\n    ideal: [20, 28],\n    mean: 24.0,\n    std_dev: 4.0,\n    flaws: {\n      low: [\"Flat mandibular plane\"],\n      high: [\"Steep mandibular plane\", \"Hyper-divergent jaw\"]\n    }\n  },\n  \"jawFrontalAngle\": {\n    ideal: [125, 135],\n    mean: 130.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Steep jaw\"],\n      high: [\"Flat jaw angle\"]\n    }\n  },\n  \"jawSlope\": {\n    ideal: [25, 35],\n    mean: 30.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat jawline\"],\n      high: [\"Steep jawline\"]\n    }\n  },\n\n  // JAW WIDTH\n  \"jawWidthRatio\": {\n    ideal: [0.85, 0.95],\n    mean: 0.90,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Narrow jaw\"],\n      high: [\"Wide jaw\"]\n    }\n  },\n  \"bigonialWidth\": {\n    ideal: [110, 125],\n    mean: 117.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow jaw width\"],\n      high: [\"Excessively wide jaw\"]\n    }\n  },\n\n  // CHEEKBONES\n  \"cheekbone_height\": {\n    ideal: [83.0, 100.0],\n    mean: 85.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Low-set cheekbones\", \"Flat midface\"]\n    }\n  },\n  \"cheekboneWidth\": {\n    ideal: [130, 145],\n    mean: 137.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow cheekbones\"],\n      high: [\"Wide cheekbones\"]\n    }\n  },\n\n  // CHIN\n  \"chinPhiltrumRatio\": {\n    ideal: [1.8, 2.2],\n    mean: 2.0,\n    std_dev: 0.2,\n    flaws: {\n      low: [\"Recessed chin\", \"Short chin\"],\n      high: [\"Long chin\", \"Projected chin\"]\n    }\n  },\n  \"chinHeight\": {\n    ideal: [35, 45],\n    mean: 40.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Short chin\"],\n      high: [\"Long chin\"]\n    }\n  },\n  \"chinWidth\": {\n    ideal: [35, 45],\n    mean: 40.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Pointed/Narrow chin\"],\n      high: [\"Wide chin\"]\n    }\n  },\n\n  // NOSE ANGLES\n  \"nasalTipAngle\": {\n    ideal: [95, 115],\n    mean: 105.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Droopy nasal tip\"],\n      high: [\"Upturned nasal tip\"]\n    }\n  },\n  \"nasolabialAngle\": {\n    ideal: [95, 110],\n    mean: 102.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Droopy nasal tip\"],\n      high: [\"Upturned nose\"]\n    }\n  },\n  \"nasofrontalAngle\": {\n    ideal: [115, 135],\n    mean: 125.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Deep nasal root\"],\n      high: [\"Flat nasal root\"]\n    }\n  },\n  \"nasofacialAngle\": {\n    ideal: [30, 40],\n    mean: 35.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat nose profile\"],\n      high: [\"Overprojected nose\"]\n    }\n  },\n  \"nasomentaAngle\": {\n    ideal: [120, 135],\n    mean: 127.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Convex profile\"],\n      high: [\"Concave profile\"]\n    }\n  },\n\n  // NOSE WIDTH & PROPORTIONS\n  \"nasalIndex\": {\n    ideal: [65, 75],\n    mean: 70.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Narrow nose\"],\n      high: [\"Wide nose\", \"Bulbous nose\"]\n    }\n  },\n  \"noseWidth\": {\n    ideal: [35, 42],\n    mean: 38.5,\n    std_dev: 3.5,\n    flaws: {\n      low: [\"Narrow nose\"],\n      high: [\"Wide nasal base\"]\n    }\n  },\n  \"noseBridgeWidth\": {\n    ideal: [12, 18],\n    mean: 15.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Narrow nose bridge\"],\n      high: [\"Wide nose bridge\"]\n    }\n  },\n  \"nasalProjection\": {\n    ideal: [16, 22],\n    mean: 19.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Underprojected nose\"],\n      high: [\"Overprojected nose\"]\n    }\n  },\n  \"noseLengthRatio\": {\n    ideal: [0.45, 0.55],\n    mean: 0.50,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Short nose\"],\n      high: [\"Long nose\"]\n    }\n  },\n\n  // LIPS & PHILTRUM\n  \"lipRatio\": {\n    ideal: [1.4, 1.6],\n    mean: 1.5,\n    std_dev: 0.15,\n    flaws: {\n      low: [\"Thin upper lip\"],\n      high: [\"Thick upper lip\"]\n    }\n  },\n  \"philtrumLength\": {\n    ideal: [11, 15],\n    mean: 13.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Short philtrum\"],\n      high: [\"Long philtrum\"]\n    }\n  },\n  \"upperLipHeight\": {\n    ideal: [18, 24],\n    mean: 21.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Thin upper lip\"],\n      high: [\"Thick upper lip\"]\n    }\n  },\n  \"lipChinDistance\": {\n    ideal: [40, 50],\n    mean: 45.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Short lower third\"],\n      high: [\"Long lower third\"]\n    }\n  },\n  \"upperLipProjection\": {\n    ideal: [-2, 2],\n    mean: 0.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Recessed upper lip\"],\n      high: [\"Protruding upper lip\"]\n    }\n  },\n  \"lowerLipProjection\": {\n    ideal: [-1, 3],\n    mean: 1.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Recessed lower lip\"],\n      high: [\"Protruding lower lip\"]\n    }\n  },\n  \"cupidsBowDepth\": {\n    ideal: [3, 6],\n    mean: 4.5,\n    std_dev: 1.5,\n    flaws: {\n      low: [\"Flat cupid's bow\"],\n      high: [\"Pronounced cupid's bow\"]\n    }\n  },\n\n  // EYEBROWS\n  \"eyebrowHeight\": {\n    ideal: [8, 14],\n    mean: 11.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Low-set eyebrows\"],\n      high: [\"High eyebrows\"]\n    }\n  },\n  \"browLengthRatio\": {\n    ideal: [0.50, 0.60],\n    mean: 0.55,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Short eyebrows\"],\n      high: [\"Long eyebrows\"]\n    }\n  },\n  \"browLengthToFaceWidth\": {\n    ideal: [0.30, 0.38],\n    mean: 0.34,\n    std_dev: 0.04,\n    flaws: {\n      low: [\"Short eyebrows\"],\n      high: [\"Long eyebrows\"]\n    }\n  },\n  \"browridgeInclinationAngle\": {\n    ideal: [10, 20],\n    mean: 15.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat brow ridge\"],\n      high: [\"Prominent brow ridge\"]\n    }\n  },\n  \"eyebrowThickness\": {\n    ideal: [1.5, 3.0],\n    mean: 2.25,\n    std_dev: 0.75,\n    flaws: {\n      low: [\"Sparse/Weak eyebrows\"],\n      high: [\"Overly thick eyebrows\"]\n    }\n  },\n\n  // FOREHEAD\n  \"foreheadHeight\": {\n    ideal: [55, 70],\n    mean: 62.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Short forehead\"],\n      high: [\"Tall forehead\"]\n    }\n  },\n  \"bitemporalWidth\": {\n    ideal: [120, 135],\n    mean: 127.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow forehead\"],\n      high: [\"Wide forehead\"]\n    }\n  },\n\n  // PROFILE & DEPTH\n  \"facialDepthToHeight\": {\n    ideal: [0.75, 0.85],\n    mean: 0.80,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Flat facial profile\"],\n      high: [\"Overprojected profile\"]\n    }\n  },\n  \"anteriorFacialDepth\": {\n    ideal: [115, 130],\n    mean: 122.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Shallow face depth\"],\n      high: [\"Deep face projection\"]\n    }\n  },\n  \"totalProfileAngle\": {\n    ideal: [165, 175],\n    mean: 170.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Convex profile\"],\n      high: [\"Concave profile\"]\n    }\n  },\n\n  // ASYMMETRY\n  \"facialAsymmetryIndex\": {\n    ideal: [0, 3],\n    mean: 2.0,\n    std_dev: 1.5,\n    flaws: {\n      high: [\"Facial asymmetry\"]\n    }\n  },\n  \"eyeAsymmetry\": {\n    ideal: [0, 2],\n    mean: 1.0,\n    std_dev: 1.0,\n    flaws: {\n      high: [\"Eye asymmetry\"]\n    }\n  },\n  \"jawAsymmetry\": {\n    ideal: [0, 3],\n    mean: 1.5,\n    std_dev: 1.5,\n    flaws: {\n      high: [\"Jaw asymmetry\"]\n    }\n  },\n\n  // OTHER\n  \"recessionFrankfort\": {\n    ideal: [-2, 2],\n    mean: 0.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Maxillary recession\"],\n      high: [\"Maxillary protrusion\"]\n    }\n  },\n  \"neckWidth\": {\n    ideal: [110, 130],\n    mean: 120.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Narrow neck\"],\n      high: [\"Wide neck\"]\n    }\n  },\n  \"neckToJawRatio\": {\n    ideal: [0.90, 1.10],\n    mean: 1.0,\n    std_dev: 0.10,\n    flaws: {\n      low: [\"Narrow neck\"],\n      high: [\"Thick neck\"]\n    }\n  }\n};\n\n// ============================================\n// ETHNICITY-SPECIFIC OVERRIDES\n// ============================================\n\n/**\n * Ethnicity and gender-specific metric standards\n * These override the base MASTER_SCORING_DB values for specific populations\n */\nexport const ETHNICITY_OVERRIDES: Record<string, Record<string, Partial<MasterMetricConfig>>> = {\n  // ========================================\n  // MALE WHITE STANDARDS (Neoclassical Baseline)\n  // ========================================\n  \"male_white\": {\n    // NOSE WIDTH - Strict 1:1 ratio (Eye Width = Nose Width)\n    \"noseWidth\": {\n      ideal: [35, 42],  // Corresponds to alar_base_ratio [0.98, 1.05]\n      mean: 38.5,\n      std_dev: 3.5,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // MIDFACE - Prefers compact midface (Hunter look)\n    \"midface_ratio\": {\n      ideal: [0.95, 1.02],\n      mean: 0.985,\n      std_dev: 0.035,\n      flaws: {\n        low: [\"Long midface\"]\n      }\n    },\n\n    // JAW - Square/Robust jaw preference\n    \"gonial_angle\": {\n      ideal: [115.0, 125.0],\n      mean: 120.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Weak/Soft jaw structure\"]\n      }\n    },\n\n    // FACE WIDTH - Standard Mesoprosopic range\n    \"faceWidthToHeight\": {\n      ideal: [1.90, 2.05],\n      mean: 1.975,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Short/Wide face\"]\n      }\n    },\n\n    // EYE TILT - Neutral to slightly positive\n    \"lateralCanthalTilt\": {\n      ideal: [4.0, 8.0],\n      mean: 6.0,\n      std_dev: 2.0,\n      flaws: {\n        low: [\"Negative canthal tilt\"]\n      }\n    },\n\n    // LOWER FACE BALANCE\n    \"chinPhiltrumRatio\": {\n      ideal: [2.10, 2.30],\n      mean: 2.20,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Long philtrum / Short chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE BLACK / AFRICAN STANDARDS\n  // ========================================\n  \"male_black\": {\n    // NOSE WIDTH - Significantly wider tolerance\n    \"noseWidth\": {\n      ideal: [40, 50],  // Wider range (corresponds to alar_base_ratio [1.12, 1.25])\n      mean: 45.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n    \"nasalIndex\": {\n      ideal: [80, 95],  // Wider nasal index\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        high: [\"Wide nose\"]\n      }\n    },\n\n    // LIPS - Prefers fuller lips\n    \"lipRatio\": {\n      ideal: [1.2, 1.5],\n      mean: 1.35,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    },\n\n    // PHILTRUM - Shorter visible philtrum is ideal\n    \"philtrumLength\": {\n      ideal: [11.0, 14.0],\n      mean: 12.5,\n      std_dev: 1.5,\n      flaws: {\n        high: [\"Long philtrum\"]\n      }\n    },\n\n    // CHIN - Adjusts for natural forward mouth projection (Prognathism)\n    \"chinPhiltrumRatio\": {\n      ideal: [1.80, 2.10],  // Lower range to account for prognathism\n      mean: 1.95,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Recessed chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE EAST ASIAN STANDARDS\n  // ========================================\n  \"male_east_asian\": {\n    // EYE SPACING - Shifted WIDER for East Asian males\n    \"eye_separation_ratio\": {\n      ideal: [0.48, 0.53],  // Shifted wider (0.46 is \"close-set\" here)\n      mean: 0.505,\n      std_dev: 0.025,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Wide-set eyes\"]\n      }\n    },\n    \"interpupillaryRatio\": {\n      ideal: [0.48, 0.53],\n      mean: 0.505,\n      std_dev: 0.025,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Wide-set eyes\"]\n      }\n    },\n\n    // EYE SHAPE - Prefers narrower/longer eyes (Hunter Eyes)\n    \"eyeAspectRatio\": {\n      ideal: [0.25, 0.29],  // Lower ratio = more elongated\n      mean: 0.27,\n      std_dev: 0.02,\n      flaws: {\n        low: [\"Overly narrow eyes\"],\n        high: [\"Overly round eye shape\"]\n      }\n    },\n    \"palpebralFissureLength\": {\n      ideal: [29, 33],\n      mean: 31.0,\n      std_dev: 2.0,\n      flaws: {\n        low: [\"Small eyes\"],\n        high: [\"Large eyes\"]\n      }\n    },\n\n    // NOSE - Asian noses typically allowed to be wider\n    \"nasalIndex\": {\n      ideal: [75, 85],\n      mean: 80.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nose\"]\n      }\n    },\n    \"noseWidth\": {\n      ideal: [38, 45],\n      mean: 41.5,\n      std_dev: 3.5,\n      flaws: {\n        low: [\"Narrow nose\"],\n        high: [\"Very wide nasal base\"]\n      }\n    },\n    \"noseBridgeWidth\": {\n      ideal: [14, 20],\n      mean: 17.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Narrow nose bridge\"],\n        high: [\"Wide nose bridge\"]\n      }\n    },\n\n    // CHEEKS - Rewards slightly fuller cheeks (Youth/K-Pop aesthetic)\n    \"cheekbone_height\": {\n      ideal: [80.0, 95.0],\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Gaunt/Hollow face\"]\n      }\n    },\n\n    // JAW - Slightly softer angles acceptable\n    \"gonial_angle\": {\n      ideal: [118, 128],\n      mean: 123.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Weak/soft jaw structure\"]\n      }\n    },\n    \"mandibularPlaneAngle\": {\n      ideal: [20, 30],\n      mean: 25.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Flat mandibular plane\"],\n        high: [\"Steep mandibular plane\"]\n      }\n    },\n\n    // FACIAL PROPORTIONS - Wider faces more common\n    \"faceWidthToHeight\": {\n      ideal: [1.35, 1.50],\n      mean: 1.425,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n    \"totalFacialWidthToHeight\": {\n      ideal: [1.30, 1.45],\n      mean: 1.375,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long face shape\"],\n        high: [\"Wide face shape\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE SOUTH ASIAN STANDARDS\n  // ========================================\n  \"male_south_asian\": {\n    // NOSE WIDTH - Slightly wider tolerance than White\n    \"noseWidth\": {\n      ideal: [36, 43],  // alar_base_ratio [1.00, 1.08]\n      mean: 39.5,\n      std_dev: 3.5,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // TEAR TROUGH - VERY STRICT. High penalty for dark circles\n    \"tearTroughDepth\": {\n      ideal: [0.0, 0.5],\n      mean: 0.25,\n      std_dev: 0.25,\n      flaws: {\n        high: [\"Dark circles / Tear troughs\"]\n      }\n    },\n\n    // UPPER EYELID - Often prefers visible lid platform\n    \"upperEyelidExposure\": {\n      ideal: [0.5, 2.0],\n      mean: 1.25,\n      std_dev: 0.75,\n      flaws: {\n        low: [\"Hooded eyes\"]\n      }\n    },\n\n    // CHEEKS - Penalizes \"Gaunt\" looks heavily\n    \"cheekbone_height\": {\n      ideal: [83.0, 95.0],\n      mean: 89.0,\n      std_dev: 6.0,\n      flaws: {\n        low: [\"Volume loss / Gauntness\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE HISPANIC STANDARDS (\"The Bridge Model\")\n  // ========================================\n  \"male_hispanic\": {\n    // FACE WIDTH - Rewards broader, more robust face shapes (Mestizo)\n    \"faceWidthToHeight\": {\n      ideal: [1.95, 2.10],\n      mean: 2.025,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long/Narrow face\"]\n      }\n    },\n\n    // NOSE WIDTH - Bridge tolerance (Wider than White, narrower than Black)\n    \"noseWidth\": {\n      ideal: [36, 44],  // alar_base_ratio [1.00, 1.12]\n      mean: 40.0,\n      std_dev: 4.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // EYE TILT - Strong preference for positive tilt\n    \"lateralCanthalTilt\": {\n      ideal: [6.0, 12.0],\n      mean: 9.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Negative/Neutral canthal tilt\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE MIDDLE EASTERN STANDARDS\n  // ========================================\n  \"male_middle_eastern\": {\n    // EYEBROW THICKNESS - Prefers significantly thicker/darker brows\n    \"eyebrowThickness\": {\n      ideal: [2.0, 4.0],\n      mean: 3.0,\n      std_dev: 1.0,\n      flaws: {\n        low: [\"Sparse/Weak eyebrows\"],\n        high: [\"Unibrow\"]\n      }\n    },\n\n    // NASOLABIAL ANGLE - Penalizes droopy tip (<90) or hooked noses\n    \"nasolabialAngle\": {\n      ideal: [90.0, 100.0],\n      mean: 95.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Droopy nose tip / Hooked nose\"]\n      }\n    },\n\n    // EYE TILT - Strong preference for Almond/Hunter eye shape\n    \"lateralCanthalTilt\": {\n      ideal: [4.0, 10.0],\n      mean: 7.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    },\n\n    // MIDFACE - Similar to White model (Compact is better)\n    \"midface_ratio\": {\n      ideal: [0.95, 1.02],\n      mean: 0.985,\n      std_dev: 0.035,\n      flaws: {\n        low: [\"Long midface\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE PACIFIC ISLANDER STANDARDS (\"The Warrior Skull\")\n  // ========================================\n  \"male_pacific_islander\": {\n    // FACE WIDTH - The Highest Width Standard (Very broad)\n    \"faceWidthToHeight\": {\n      ideal: [2.10, 2.30],\n      mean: 2.20,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Narrow/Long face\"]\n      }\n    },\n\n    // NOSE WIDTH - Wide tolerance\n    \"noseWidth\": {\n      ideal: [38, 48],  // alar_base_ratio [1.05, 1.20]\n      mean: 43.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // CHEEKS - Rewards high mass/robustness\n    \"cheekbone_height\": {\n      ideal: [85.0, 100.0],\n      mean: 92.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Gaunt/Weak face structure\"]\n      }\n    },\n\n    // CHIN WIDTH - Prefers a very broad, square chin\n    \"chinWidth\": {\n      ideal: [40.0, 50.0],\n      mean: 45.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Pointed/Narrow chin\"]\n      }\n    }\n  },\n\n  \"male_native_american\": {\n    \"faceWidthToHeight\": {\n      ideal: [2.00, 2.20],\n      mean: 2.10,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Wide face\"]\n      }\n    },\n\n    \"nasalIndex\": {\n      ideal: [75, 90],\n      mean: 82.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Narrow nose\"],\n        high: [\"Wide nose\"]\n      }\n    },\n\n    \"cheekbone_height\": {\n      ideal: [80.0, 95.0],\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Flat cheekbones\"]\n      }\n    },\n\n    \"gonialAngle\": {\n      ideal: [115, 125],\n      mean: 120,\n      std_dev: 5,\n      flaws: {\n        low: [\"Weak jaw\"],\n        high: [\"Harsh jaw angle\"]\n      }\n    },\n\n    \"chinWidth\": {\n      ideal: [38.0, 48.0],\n      mean: 43.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Narrow chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // FEMALE ETHNICITIES (The \"Missing Link\")\n  // ========================================\n\n  \"female_white\": {\n    // NOSE WIDTH - Strict Rule of Fifths for feminine harmony\n    \"alar_base_ratio\": {\n      ideal: [0.98, 1.05],\n      mean: 1.015,\n      std_dev: 0.035,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // FACE WIDTH - Prefers oval/narrow feminine proportions\n    \"fwhr\": {\n      ideal: [1.45, 1.53],\n      mean: 1.49,\n      std_dev: 0.04,\n      flaws: {\n        low: [\"Long/Narrow face\"],\n        high: [\"Wide face\"]\n      }\n    },\n\n    // JAW - Soft, tapered feminine jawline\n    \"gonial_angle\": {\n      ideal: [122.0, 130.0],\n      mean: 126.0,\n      std_dev: 4.0,\n      flaws: {\n        low: [\"Sharp/Masculine jaw angle\"],\n        high: [\"Weak/Overly soft jawline\"]\n      }\n    },\n\n    // EYE TILT - Neutral to positive preferred\n    \"canthal_tilt\": {\n      ideal: [4.0, 9.0],\n      mean: 6.5,\n      std_dev: 2.5,\n      flaws: {\n        low: [\"Negative/Downturned eyes\"]\n      }\n    },\n\n    // CHIN-PHILTRUM - Golden Ratio balance\n    \"chin_philtrum_ratio\": {\n      ideal: [2.0, 2.2],\n      mean: 2.1,\n      std_dev: 0.1,\n      flaws: {\n        low: [\"Recessed chin\"],\n        high: [\"Protruding chin\"]\n      }\n    }\n  },\n\n  \"female_black\": {\n    // LIPS - High volume preference (fuller lips)\n    \"lipRatio\": {\n      ideal: [1.3, 1.6],\n      mean: 1.45,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    },\n\n    // NOSE WIDTH - Wider tolerance for ethnic variation\n    \"alar_base_ratio\": {\n      ideal: [1.05, 1.15],\n      mean: 1.10,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Very wide nasal base\"]\n      }\n    },\n\n    // CHIN - Allows forward projection (natural prognathism)\n    \"chin_projection\": {\n      ideal: [0.0, 5.0],\n      mean: 2.5,\n      std_dev: 2.5,\n      flaws: {\n        high: [\"Excessive chin projection\"]\n      }\n    },\n\n    // JAW - Soft feminine jawline\n    \"gonial_angle\": {\n      ideal: [120.0, 130.0],\n      mean: 125.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Sharp jaw angle\"],\n        high: [\"Weak jawline\"]\n      }\n    }\n  },\n\n  \"female_east_asian\": {\n    // EYE SPACING - Wide-set neotenous preference\n    \"eye_separation_ratio\": {\n      ideal: [46.3, 47.5],\n      mean: 46.9,\n      std_dev: 0.6,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Very wide-set eyes\"]\n      }\n    },\n\n    // JAW - Tapered V-shape feminine ideal\n    \"gonial_angle\": {\n      ideal: [120.0, 126.0],\n      mean: 123.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Sharp V-line jaw\"],\n        high: [\"Weak/Square jawline\"]\n      }\n    },\n\n    // EYEBROWS - Higher set brows (youthful feminine)\n    \"eyebrow_height\": {\n      ideal: [0.85, 1.30],\n      mean: 1.075,\n      std_dev: 0.225,\n      flaws: {\n        low: [\"Low-set/Heavy brows\"],\n        high: [\"Very high-arched brows\"]\n      }\n    },\n\n    // LOWER FACE - Compact lower third (neotenous)\n    \"lower_third_ratio\": {\n      ideal: [29.6, 32.7],\n      mean: 31.15,\n      std_dev: 1.55,\n      flaws: {\n        low: [\"Very short lower face\"],\n        high: [\"Long lower face\"]\n      }\n    }\n  },\n\n  \"female_south_asian\": {\n    // TEAR TROUGHS - Very strict on dark circles\n    \"tear_trough_depth\": {\n      ideal: [0.0, 0.5],\n      mean: 0.25,\n      std_dev: 0.25,\n      flaws: {\n        high: [\"Dark circles / Deep tear troughs\"]\n      }\n    },\n\n    // CHEEKS - Rewards midface volume (youthful fullness)\n    \"cheek_fullness\": {\n      ideal: [1.0, 2.0],\n      mean: 1.5,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Gaunt/Hollow cheeks\"]\n      }\n    },\n\n    // SKIN - High penalty for uneven skin tone\n    \"skin_uniformity\": {\n      ideal: [0.92, 1.0],\n      mean: 0.96,\n      std_dev: 0.04,\n      flaws: {\n        low: [\"Uneven skin tone / Pigmentation\"]\n      }\n    },\n\n    // NOSE WIDTH - Intermediate tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.00, 1.08],\n      mean: 1.04,\n      std_dev: 0.04,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    }\n  },\n\n  \"female_hispanic\": {\n    // FACE WIDTH - Broader Mestiza tolerance\n    \"fwhr\": {\n      ideal: [1.50, 1.62],\n      mean: 1.56,\n      std_dev: 0.06,\n      flaws: {\n        low: [\"Long/Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // EYE TILT - Strong almond eye preference\n    \"canthal_tilt\": {\n      ideal: [6.0, 12.0],\n      mean: 9.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Neutral/Downturned eyes\"]\n      }\n    },\n\n    // NOSE WIDTH - Intermediate width tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.00, 1.10],\n      mean: 1.05,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // LIPS - Voluptuous preference\n    \"lipRatio\": {\n      ideal: [1.1, 1.35],\n      mean: 1.225,\n      std_dev: 0.125,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    }\n  },\n\n  \"female_middle_eastern\": {\n    // EYEBROWS - Dense/Thick brows preference\n    \"eyebrow_thickness\": {\n      ideal: [1.5, 3.0],\n      mean: 2.25,\n      std_dev: 0.75,\n      flaws: {\n        low: [\"Sparse/Thin eyebrows\"],\n        high: [\"Unibrow\"]\n      }\n    },\n\n    // NOSE - Refined/Upturned tip\n    \"nasolabial_angle\": {\n      ideal: [95.0, 105.0],\n      mean: 100.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Droopy nose tip\"],\n        high: [\"Overly upturned nose\"]\n      }\n    },\n\n    // EYE TILT - Foxy/Hunter feminine eye shape\n    \"canthal_tilt\": {\n      ideal: [5.0, 10.0],\n      mean: 7.5,\n      std_dev: 2.5,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    },\n\n    // EYELID - Low exposure preferred\n    \"upper_eyelid_exposure\": {\n      ideal: [0.5, 1.5],\n      mean: 1.0,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Hooded eyes\"],\n        high: [\"Excessive eyelid exposure\"]\n      }\n    }\n  },\n\n  \"female_native_american\": {\n    // FACE WIDTH - Wide/High cheekbone structure\n    \"fwhr\": {\n      ideal: [1.52, 1.65],\n      mean: 1.585,\n      std_dev: 0.065,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // CHEEKBONES - High definition/prominence\n    \"cheekbone_prominence\": {\n      ideal: [1.5, 2.5],\n      mean: 2.0,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Flat cheekbones\"],\n        high: [\"Overly prominent cheekbones\"]\n      }\n    },\n\n    // JAW - Stronger jaw tolerance\n    \"gonial_angle\": {\n      ideal: [115.0, 125.0],\n      mean: 120.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Very sharp jaw\"],\n        high: [\"Weak jawline\"]\n      }\n    },\n\n    // EYE TILT - Positive tilt preference\n    \"canthal_tilt\": {\n      ideal: [5.0, 11.0],\n      mean: 8.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    }\n  },\n\n  \"female_pacific_islander\": {\n    // FACE WIDTH - Widest/Robust facial structure\n    \"fwhr\": {\n      ideal: [1.55, 1.70],\n      mean: 1.625,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // CHEEKS - High volume/softness preference\n    \"cheek_fullness\": {\n      ideal: [1.2, 2.5],\n      mean: 1.85,\n      std_dev: 0.65,\n      flaws: {\n        low: [\"Gaunt/Hollow cheeks\"]\n      }\n    },\n\n    // NOSE WIDTH - Wide nose tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.05, 1.15],\n      mean: 1.10,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Very wide nasal base\"]\n      }\n    },\n\n    // LIPS - Full lips preference\n    \"lipRatio\": {\n      ideal: [1.25, 1.50],\n      mean: 1.375,\n      std_dev: 0.125,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    }\n  }\n};\n\n/**\n * Get the appropriate metric configuration for a given gender and ethnicity\n * Falls back to base config if no override exists\n */\nexport function getMetricConfig(\n  metricId: string,\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'white'\n): MasterMetricConfig | undefined {\n  const key = `${gender}_${ethnicity}`;\n  const override = ETHNICITY_OVERRIDES[key]?.[metricId];\n  const baseConfig = MASTER_SCORING_DB[metricId];\n\n  if (!baseConfig) return undefined;\n\n  // Merge override with base config\n  if (override) {\n    return {\n      ...baseConfig,\n      ...override,\n      flaws: {\n        ...baseConfig.flaws,\n        ...override.flaws\n      }\n    } as MasterMetricConfig;\n  }\n\n  return baseConfig;\n}\n\n// ============================================\n// Z-SCORE SEVERITY FUNCTIONS\n// ============================================\n\n/**\n * Calculate Z-score for a given value\n * Z = (value - mean) / std_dev\n */\nexport function calculateZScore(value: number, mean: number, stdDev: number): number {\n  if (stdDev === 0) return 0;\n  return Math.abs((value - mean) / stdDev);\n}\n\n/**\n * Determine severity level based on Z-score and ideal range (5-tier system)\n * - Ideal: Value is within ideal range\n * - Good: |z| < 0.5 (within 0.5 standard deviation)\n * - Fair: 0.5 ≤ |z| < 1 (between 0.5-1 standard deviations)\n * - Moderate: 1 ≤ |z| < 2 (between 1-2 standard deviations)\n * - Severe: |z| ≥ 2 (more than 2 standard deviations away)\n */\nexport function getSeverityFromZScore(\n  value: number,\n  config: MasterMetricConfig\n): { severity: SeverityLevel; zScore: number; isInIdeal: boolean } {\n  const { ideal, mean, std_dev } = config;\n  const isInIdeal = value >= ideal[0] && value <= ideal[1];\n  const zScore = calculateZScore(value, mean, std_dev);\n\n  let severity: SeverityLevel;\n  if (isInIdeal) {\n    severity = 'ideal';\n  } else if (zScore < 0.5) {\n    severity = 'good';\n  } else if (zScore < 1) {\n    severity = 'fair';\n  } else if (zScore < 2) {\n    severity = 'moderate';\n  } else {\n    severity = 'severe';\n  }\n\n  return { severity, zScore, isInIdeal };\n}\n\n/**\n * Get severity for a metric value with ethnicity/gender awareness\n */\nexport function getSeverityForMetric(\n  metricId: string,\n  value: number,\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'white'\n): { severity: SeverityLevel; zScore: number; isInIdeal: boolean; config: MasterMetricConfig } | null {\n  const config = getMetricConfig(metricId, gender, ethnicity);\n  if (!config) return null;\n\n  const result = getSeverityFromZScore(value, config);\n  return { ...result, config };\n}\n\n/**\n * Get badge color for severity level (5-tier)\n */\nexport function getSeverityColor(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'green';\n    case 'good': return 'blue';\n    case 'fair': return 'cyan';\n    case 'moderate': return 'yellow';\n    case 'severe': return 'red';\n    default: return 'gray';\n  }\n}\n\n/**\n * Get severity label for display (5-tier)\n */\nexport function getSeverityLabel(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'Ideal';\n    case 'good': return 'Good';\n    case 'fair': return 'Fair';\n    case 'moderate': return 'Moderate';\n    case 'severe': return 'Severe';\n    default: return 'Unknown';\n  }\n}\n\n// ============================================\n// INSIGHT DEFINITION TYPES\n// ============================================\n\nexport interface InsightSeverityLogic {\n  metrics: string[];  // Display names of metrics (e.g., \"Face Width to Height Ratio\")\n  threshold: number;  // Score threshold for classification\n}\n\nexport interface WeaknessSeverityLabels {\n  minor: string;\n  moderate: string;\n  severe: string;\n}\n\nexport interface StrengthGradeLabels {\n  good: string;\n  excellent: string;\n  ideal: string;\n}\n\nexport interface InsightContent {\n  description: string;\n  severity_labels?: WeaknessSeverityLabels;  // For weaknesses\n  grade_labels?: StrengthGradeLabels;        // For strengths\n}\n\nexport interface InsightDefinition {\n  id: string;\n  title: string;\n  type: 'weakness' | 'strength';\n  severity_logic: InsightSeverityLogic;\n  content: InsightContent;\n}\n\n// ============================================\n// CLASSIFICATION RESULT TYPES\n// ============================================\n\nexport type WeaknessSeverity = 'severe' | 'moderate' | 'minor';\nexport type StrengthGrade = 'ideal' | 'excellent' | 'good';\n\nexport interface ClassifiedWeakness {\n  insightId: string;\n  title: string;\n  description: string;\n  severity: WeaknessSeverity;\n  severityLabel: string;  // Custom label from definition (e.g., \"Extremely Long\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n  /**\n   * Confidence level based on Z-score magnitude:\n   * - confirmed: |z| >= 2 (high statistical certainty, 2+ SDs from mean)\n   * - likely: 1 <= |z| < 2 (moderate certainty)\n   * - possible: 0.5 <= |z| < 1 (low certainty)\n   */\n  confidence: ConfidenceLevel;\n}\n\nexport interface ClassifiedStrength {\n  insightId: string;\n  title: string;\n  description: string;\n  grade: StrengthGrade;\n  gradeLabel: string;  // Custom label from definition (e.g., \"Ideal\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n}\n\nexport interface MatchedMetric {\n  metricId: string;\n  metricName: string;\n  score: number;\n  value: number;\n  idealMin: number;\n  idealMax: number;\n  unit: string;\n  category: string;\n}\n\nexport interface InsightClassificationResult {\n  strengths: ClassifiedStrength[];\n  weaknesses: ClassifiedWeakness[];\n}\n\n// ============================================\n// INSIGHTS DATABASE\n// ============================================\n\nexport const INSIGHTS_DEFINITIONS: InsightDefinition[] = [\n  {\n    id: \"long_midface\",\n    title: \"Long Midface\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\", \"Ipsilateral Alar Angle\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The middle of the face is elongated, creating an unbalanced vertical proportion.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Extremely Long\" }\n    }\n  },\n  {\n    id: \"short_midface\",\n    title: \"Short Midface\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The midface has ideal vertical proportions, contributing to facial harmony.\",\n      grade_labels: { good: \"Proportionate\", excellent: \"Well-Balanced\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"weak_jaw\",\n    title: \"Weak/Soft Jaw Structure\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Chin to Philtrum Ratio\", \"Jaw Slope\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The jaw has a softer, rounder shape, often less angular and robust than the ideal.\",\n      severity_labels: { minor: \"Soft\", moderate: \"Recessed\", severe: \"Weak\" }\n    }\n  },\n  {\n    id: \"strong_jaw\",\n    title: \"Strong Jaw Definition\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Jaw Width Ratio\", \"Bigonial Width\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The jaw displays strong definition with well-defined angles and proportionate width.\",\n      grade_labels: { good: \"Defined\", excellent: \"Strong\", ideal: \"Ideal Angular\" }\n    }\n  },\n  {\n    id: \"refined_nasal_tip\",\n    title: \"Refined Nasal Tip\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasal Tip Angle\", \"Nose Tip Position\", \"Frankfort-tip Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious nasal profile due to the nasal tip being well-defined and proportionate.\",\n      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"bulbous_nose\",\n    title: \"Bulbous Nasal Tip\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Index\", \"Nose Width\", \"Nasal Tip Angle\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nasal tip appears rounded and less defined, affecting nasal aesthetics.\",\n      severity_labels: { minor: \"Slightly Rounded\", moderate: \"Rounded\", severe: \"Bulbous\" }\n    }\n  },\n  {\n    id: \"ideal_upper_lip\",\n    title: \"Well-Positioned Upper Lip\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Upper Lip E-Line Position\", \"Upper Lip S-Line Position\", \"Nasolabial Angle\"],\n      threshold: 9.0\n    },\n    content: {\n      description: \"This contributes to a harmonious mouth region due to the upper lip sitting neither too far forward nor too far back.\",\n      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"negative_canthal_tilt\",\n    title: \"Negative Canthal Tilt\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The outer corners of the eyes sit lower than the inner corners, creating a downturned appearance.\",\n      severity_labels: { minor: \"Slight Downturn\", moderate: \"Noticeable\", severe: \"Pronounced\" }\n    }\n  },\n  {\n    id: \"positive_canthal_tilt\",\n    title: \"Positive Canthal Tilt\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The outer corners of the eyes are elevated, creating an attractive upswept eye shape.\",\n      grade_labels: { good: \"Slight Upturn\", excellent: \"Well-Tilted\", ideal: \"Hunter Eyes\" }\n    }\n  },\n  {\n    id: \"balanced_facial_thirds\",\n    title: \"Balanced Facial Thirds\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face displays well-balanced vertical proportions across all three facial thirds.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfectly Proportioned\" }\n    }\n  },\n  {\n    id: \"imbalanced_thirds\",\n    title: \"Facial Third Imbalance\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The vertical face proportions show imbalance between the three facial thirds.\",\n      severity_labels: { minor: \"Slight Imbalance\", moderate: \"Noticeable Disproportion\", severe: \"Significant Imbalance\" }\n    }\n  },\n  {\n    id: \"high_cheekbones\",\n    title: \"High Cheekbones\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Cheekbone Height\", \"Cheekbone Width\", \"Midface Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"Well-positioned cheekbones that create attractive facial contours and catch light beautifully.\",\n      grade_labels: { good: \"Visible\", excellent: \"Prominent\", ideal: \"Model-Tier\" }\n    }\n  },\n  {\n    id: \"flat_midface\",\n    title: \"Flat Midface\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Cheekbone Height\", \"Midface Ratio\", \"Total Facial Width to Height\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The midface lacks forward projection, resulting in flatter facial contours.\",\n      severity_labels: { minor: \"Slightly Flat\", moderate: \"Underprojected\", severe: \"Recessed\" }\n    }\n  },\n  {\n    id: \"ideal_lip_ratio\",\n    title: \"Ideal Lip Proportions\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Lip Ratio\", \"Philtrum Length\", \"Lip Chin Distance\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The lips demonstrate excellent proportions with balanced upper-to-lower lip ratio.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Well-Proportioned\", ideal: \"Perfect Ratio\" }\n    }\n  },\n  {\n    id: \"thin_lips\",\n    title: \"Thin Lip Profile\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Lip Ratio\", \"Upper Lip Projection\", \"Lower Lip Projection\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The lips appear thinner than ideal proportions, affecting lower face harmony.\",\n      severity_labels: { minor: \"Slightly Thin\", moderate: \"Thin\", severe: \"Very Thin\" }\n    }\n  },\n  {\n    id: \"ideal_ipd\",\n    title: \"Ideal Eye Spacing\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The eyes are ideally spaced, creating facial balance and attractiveness.\",\n      grade_labels: { good: \"Good Spacing\", excellent: \"Ideal Distance\", ideal: \"Perfect IPD\" }\n    }\n  },\n  {\n    id: \"wide_set_eyes\",\n    title: \"Wide-Set Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes are spaced wider apart than the aesthetic ideal.\",\n      severity_labels: { minor: \"Slightly Wide\", moderate: \"Noticeably Wide\", severe: \"Very Wide\" }\n    }\n  },\n  {\n    id: \"close_set_eyes\",\n    title: \"Close-Set Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"Intercanthal Width\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes are positioned closer together than the aesthetic ideal.\",\n      severity_labels: { minor: \"Slightly Close\", moderate: \"Noticeably Close\", severe: \"Very Close\" }\n    }\n  },\n  {\n    id: \"ideal_nose_projection\",\n    title: \"Ideal Nasal Projection\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasofrontal Angle\", \"Nasofacial Angle\", \"Nasomenta Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The nose has ideal forward projection relative to the face, creating profile harmony.\",\n      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect Projection\" }\n    }\n  },\n  {\n    id: \"recessed_chin\",\n    title: \"Recessed Chin\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Facial Depth to Height\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The chin sits behind the ideal position, affecting profile balance.\",\n      severity_labels: { minor: \"Slightly Recessed\", moderate: \"Recessed\", severe: \"Severely Recessed\" }\n    }\n  },\n  {\n    id: \"ideal_chin_projection\",\n    title: \"Ideal Chin Projection\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Anterior Facial Depth\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The chin demonstrates ideal projection and proportions relative to the face.\",\n      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect\" }\n    }\n  },\n  {\n    id: \"long_philtrum\",\n    title: \"Long Philtrum\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Philtrum Length\", \"Lip Chin Distance\", \"Upper Lip Height\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The distance between nose and upper lip is longer than ideal.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n    }\n  },\n  {\n    id: \"short_philtrum\",\n    title: \"Short Philtrum\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Philtrum Length\", \"Upper Lip Height\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The philtrum has ideal or shorter length, considered youthful and attractive.\",\n      grade_labels: { good: \"Good Length\", excellent: \"Short\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"wide_nose\",\n    title: \"Wide Nasal Base\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Index\", \"Intercanthal Nasal Ratio\", \"Nose Bridge Width\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The base of the nose is wider than the aesthetic ideal for facial harmony.\",\n      severity_labels: { minor: \"Slightly Wide\", moderate: \"Wide\", severe: \"Very Wide\" }\n    }\n  },\n  {\n    id: \"ideal_brow_position\",\n    title: \"Ideal Brow Position\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Eyebrow Height\", \"Brow Length Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The eyebrows are ideally positioned relative to the eyes and facial structure.\",\n      grade_labels: { good: \"Good Position\", excellent: \"Well-Arched\", ideal: \"Perfect Frame\" }\n    }\n  },\n  {\n    id: \"narrow_jaw\",\n    title: \"Narrow Jaw\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Jaw Width Ratio\", \"Bigonial Width\", \"Jaw Frontal Angle\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The jaw is narrower than ideal, affecting lower face width and definition.\",\n      severity_labels: { minor: \"Slightly Narrow\", moderate: \"Narrow\", severe: \"Very Narrow\" }\n    }\n  },\n  {\n    id: \"steep_mandibular_plane\",\n    title: \"Steep Mandibular Plane\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The mandibular plane angle is steeper than ideal, often indicating vertical growth pattern.\",\n      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n    }\n  },\n  // ============================================\n  // INSIGHT DEFINITIONS (element.html / element1.html)\n  // ============================================\n  // --- WEAKNESSES ---\n  {\n    id: \"steep_jaw\",\n    title: \"Steep Jaw\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Jaw Frontal Angle\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The jaw angles sharply downward, creating a narrow or pointed chin effect.\",\n      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n    }\n  },\n  {\n    id: \"maxillary_recession\",\n    title: \"Maxillary Recession\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Facial Depth to Height Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The upper jaw is less forward than ideal, reducing midface projection and facial harmony.\",\n      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n    }\n  },\n  {\n    id: \"mandibular_recession\",\n    title: \"Mandibular Recession\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The lower jaw is set back, creating a less prominent chin and an unbalanced profile.\",\n      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n    }\n  },\n  {\n    id: \"underprojected_chin\",\n    title: \"Underprojected Chin\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\", \"Chin Height\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The chin lacks forward projection, creating a weak lower face appearance.\",\n      severity_labels: { minor: \"Slightly Weak\", moderate: \"Underprojected\", severe: \"Severely Underprojected\" }\n    }\n  },\n  {\n    id: \"overly_long_face\",\n    title: \"Overly Long Face Shape\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Total Facial Width to Height Ratio\", \"Face Width to Height Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The face is excessively tall and narrow, creating an elongated appearance.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n    }\n  },\n  {\n    id: \"hyper_divergent_jaw\",\n    title: \"Hyper-Divergent Jaw Growth\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The jaw grows with an overly steep angle, resulting in a long or narrow lower face. This can indicate malocclusion.\",\n      severity_labels: { minor: \"Mildly Divergent\", moderate: \"Divergent\", severe: \"Hyper-Divergent\" }\n    }\n  },\n  {\n    id: \"weak_brow_ridge\",\n    title: \"Soft/Weak Brow Ridge\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Browridge Inclination Angle\", \"Eyebrow Height\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The forehead has a softer, less prominent ridge than the ideal, reducing masculine definition.\",\n      severity_labels: { minor: \"Slightly Soft\", moderate: \"Soft\", severe: \"Very Weak\" }\n    }\n  },\n  {\n    id: \"droopy_nasal_tip\",\n    title: \"Droopy Nasal Tip\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\", \"Nasofacial Angle\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nasal tip points downward more than ideal, creating a drooping appearance.\",\n      severity_labels: { minor: \"Slightly Droopy\", moderate: \"Droopy\", severe: \"Very Droopy\" }\n    }\n  },\n  {\n    id: \"overprojected_nose\",\n    title: \"Overprojected Nose\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Projection\", \"Nasofacial Angle\", \"Nose Length Ratio\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nose projects too far forward relative to the face, creating imbalance.\",\n      severity_labels: { minor: \"Slightly Projected\", moderate: \"Overprojected\", severe: \"Very Overprojected\" }\n    }\n  },\n  {\n    id: \"small_eyes\",\n    title: \"Small Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Eye Aspect Ratio\", \"Palpebral Fissure Length\", \"Eye Width\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes appear smaller than the aesthetic ideal relative to the face.\",\n      severity_labels: { minor: \"Slightly Small\", moderate: \"Small\", severe: \"Very Small\" }\n    }\n  },\n  {\n    id: \"low_set_eyebrows\",\n    title: \"Low-Set Eyebrows\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Eyebrow Height\", \"Brow to Hairline Distance\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyebrows sit lower than ideal, reducing the visible upper eyelid space.\",\n      severity_labels: { minor: \"Slightly Low\", moderate: \"Low\", severe: \"Very Low\" }\n    }\n  },\n  {\n    id: \"asymmetrical_face\",\n    title: \"Facial Asymmetry\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The left and right sides of the face show noticeable differences in proportion or position.\",\n      severity_labels: { minor: \"Slight Asymmetry\", moderate: \"Noticeable Asymmetry\", severe: \"Significant Asymmetry\" }\n    }\n  },\n  // --- STRENGTHS ---\n  {\n    id: \"good_jaw_width\",\n    title: \"Good Jaw Width\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Bigonial Width\", \"Jaw Width Ratio\", \"Jaw Frontal Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a pleasant jaw contour due to the jaw being neither too wide nor too narrow.\",\n      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n    }\n  },\n  {\n    id: \"good_forehead_slope\",\n    title: \"Good Forehead Slope\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Browridge Inclination Angle\", \"Forehead Height\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a pleasant forehead contour by indicating that the forehead is neither too steep nor too flat.\",\n      grade_labels: { good: \"Good Slope\", excellent: \"Well-Angled\", ideal: \"Ideal Slope\" }\n    }\n  },\n  {\n    id: \"good_cupids_bow\",\n    title: \"Good Cupid's Bow Depth\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Cupids Bow Depth\", \"Upper Lip Height\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious lip region due to the cupid's bow having ideal definition and depth.\",\n      grade_labels: { good: \"Defined\", excellent: \"Well-Defined\", ideal: \"Perfectly Defined\" }\n    }\n  },\n  {\n    id: \"good_eyebrow_length\",\n    title: \"Good Eyebrow Length\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Brow Length to Face Width Ratio\", \"Brow Length Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious eye region due to the eyebrows having ideal horizontal length relative to face width.\",\n      grade_labels: { good: \"Good Length\", excellent: \"Well-Proportioned\", ideal: \"Ideal Length\" }\n    }\n  },\n  {\n    id: \"good_neck_width\",\n    title: \"Good Neck Width\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Neck Width\", \"Neck to Jaw Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious lower face due to the neck being neither too wide nor too thin.\",\n      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n    }\n  },\n  {\n    id: \"ideal_nasolabial_angle\",\n    title: \"Ideal Nasolabial Angle\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The angle between nose and upper lip is in the ideal range, creating profile harmony.\",\n      grade_labels: { good: \"Good Angle\", excellent: \"Well-Angled\", ideal: \"Perfect Angle\" }\n    }\n  },\n  {\n    id: \"ideal_facial_depth\",\n    title: \"Ideal Facial Depth\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Facial Depth to Height Ratio\", \"Anterior Facial Depth\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face has ideal forward projection creating attractive three-dimensional contours.\",\n      grade_labels: { good: \"Good Depth\", excellent: \"Well-Projected\", ideal: \"Ideal Projection\" }\n    }\n  },\n  {\n    id: \"ideal_eye_shape\",\n    title: \"Ideal Eye Shape\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Eye Aspect Ratio\", \"Lateral Canthal Tilt\", \"Palpebral Fissure Length\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The eyes have an attractive almond shape with ideal proportions and tilt.\",\n      grade_labels: { good: \"Attractive\", excellent: \"Well-Shaped\", ideal: \"Hunter Eyes\" }\n    }\n  },\n  {\n    id: \"harmonious_profile\",\n    title: \"Harmonious Profile\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Total Profile Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The facial profile shows excellent balance between nose, lips, and chin positions.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfect Profile\" }\n    }\n  },\n  {\n    id: \"good_facial_symmetry\",\n    title: \"Good Facial Symmetry\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face displays excellent bilateral symmetry, a key component of attractiveness.\",\n      grade_labels: { good: \"Symmetric\", excellent: \"Very Symmetric\", ideal: \"Near-Perfect Symmetry\" }\n    }\n  }\n];\n\n// ============================================\n// METRIC NAME MAPPING\n// ============================================\n\n// Map display names to metric IDs for lookup\nconst METRIC_NAME_TO_ID: Record<string, string> = {\n  // Face Shape/Proportions\n  \"Face Width to Height Ratio\": \"faceWidthToHeight\",\n  \"Total Facial Width to Height\": \"totalFacialWidthToHeight\",\n  \"Total Facial Width to Height Ratio\": \"totalFacialWidthToHeight\",\n  \"Midface Ratio\": \"midfaceRatio\",\n  \"Upper Third Proportion\": \"upperThirdProportion\",\n  \"Middle Third Proportion\": \"middleThirdProportion\",\n  \"Lower Third Proportion\": \"lowerThirdProportion\",\n  \"Cheekbone Height\": \"cheekboneHeight\",\n  \"Cheekbone Width\": \"cheekboneWidth\",\n  \"Bitemporal Width\": \"bitemporalWidth\",\n  \"Forehead Height\": \"foreheadHeight\",\n  \"Facial Asymmetry Index\": \"facialAsymmetryIndex\",\n\n  // Jaw\n  \"Gonial Angle\": \"gonialAngle\",\n  \"Mandibular Plane Angle\": \"mandibularPlaneAngle\",\n  \"Jaw Width Ratio\": \"jawWidthRatio\",\n  \"Bigonial Width\": \"bigonialWidth\",\n  \"Jaw Frontal Angle\": \"jawFrontalAngle\",\n  \"Jaw Slope\": \"jawSlope\",\n  \"Jaw Asymmetry\": \"jawAsymmetry\",\n\n  // Chin\n  \"Chin to Philtrum Ratio\": \"chinPhiltrumRatio\",\n  \"Chin Height\": \"chinHeight\",\n  \"Facial Depth to Height\": \"facialDepthToHeight\",\n  \"Facial Depth to Height Ratio\": \"facialDepthToHeight\",\n  \"Anterior Facial Depth\": \"anteriorFacialDepth\",\n  \"Recession Relative to Frankfort Plane\": \"recessionFrankfort\",\n\n  // Eyes\n  \"Lateral Canthal Tilt\": \"lateralCanthalTilt\",\n  \"Eye Aspect Ratio\": \"eyeAspectRatio\",\n  \"Eye Separation Ratio\": \"eyeSeparationRatio\",\n  \"Interpupillary Ratio\": \"interpupillaryRatio\",\n  \"One Eye Apart Test\": \"oneEyeApartTest\",\n  \"Intercanthal Width\": \"intercanthalWidth\",\n  \"Eyebrow Height\": \"eyebrowHeight\",\n  \"Brow Length Ratio\": \"browLengthRatio\",\n  \"Brow Length to Face Width Ratio\": \"browLengthToFaceWidth\",\n  \"Palpebral Fissure Length\": \"palpebralFissureLength\",\n  \"Eye Width\": \"eyeWidth\",\n  \"Eye Asymmetry\": \"eyeAsymmetry\",\n  \"Brow to Hairline Distance\": \"browToHairlineDistance\",\n\n  // Brow\n  \"Browridge Inclination Angle\": \"browridgeInclinationAngle\",\n\n  // Nose\n  \"Nasal Index\": \"nasalIndex\",\n  \"Nasal Tip Angle\": \"nasalTipAngle\",\n  \"Nose Tip Position\": \"noseTipPosition\",\n  \"Frankfort-tip Angle\": \"frankfortTipAngle\",\n  \"Nasofrontal Angle\": \"nasofrontalAngle\",\n  \"Nasofacial Angle\": \"nasofacialAngle\",\n  \"Nasomenta Angle\": \"nasomentaAngle\",\n  \"Nasomental Angle\": \"nasomentaAngle\",\n  \"Intercanthal Nasal Ratio\": \"intercanthalNasalRatio\",\n  \"Nose Bridge Width\": \"noseBridgeWidth\",\n  \"Nose Width\": \"noseWidth\",\n  \"Nasal Projection\": \"nasalProjection\",\n  \"Nose Length Ratio\": \"noseLengthRatio\",\n  \"Ipsilateral Alar Angle\": \"ipsilateralAlarAngle\",\n\n  // Lips\n  \"Lip Ratio\": \"lipRatio\",\n  \"Philtrum Length\": \"philtrumLength\",\n  \"Upper Lip Projection\": \"upperLipProjection\",\n  \"Lower Lip Projection\": \"lowerLipProjection\",\n  \"Lip Chin Distance\": \"lipChinDistance\",\n  \"Upper Lip Height\": \"upperLipHeight\",\n  \"Upper Lip E-Line Position\": \"upperLipELine\",\n  \"Upper Lip S-Line Position\": \"upperLipSLine\",\n  \"Nasolabial Angle\": \"nasolabialAngle\",\n  \"Cupids Bow Depth\": \"cupidsBowDepth\",\n\n  // Neck\n  \"Neck Width\": \"neckWidth\",\n  \"Neck to Jaw Ratio\": \"neckToJawRatio\",\n\n  // Profile\n  \"Total Profile Angle\": \"totalProfileAngle\",\n};\n\n// ============================================\n// CLASSIFICATION FUNCTIONS\n// ============================================\n\n/**\n * Get weakness severity based on average score\n * 0-3 = \"Severe\", 3-5 = \"Moderate\", 5-7 = \"Minor\"\n */\nfunction getWeaknessSeverity(avgScore: number): WeaknessSeverity {\n  if (avgScore <= 3) return 'severe';\n  if (avgScore <= 5) return 'moderate';\n  return 'minor';\n}\n\n/**\n * Get strength grade based on average score\n * 8-9 = \"Good\", 9-9.5 = \"Excellent\", 9.5-10 = \"Ideal\"\n */\nfunction getStrengthGrade(avgScore: number): StrengthGrade {\n  if (avgScore >= 9.5) return 'ideal';\n  if (avgScore >= 9) return 'excellent';\n  return 'good';\n}\n\n/**\n * Find metric by display name from measurements array\n */\nfunction findMetricByName(\n  metricName: string,\n  measurements: MetricScoreResult[]\n): MetricScoreResult | undefined {\n  // First try direct ID mapping\n  const metricId = METRIC_NAME_TO_ID[metricName];\n  if (metricId) {\n    return measurements.find(m => m.metricId === metricId);\n  }\n\n  // Fallback: try fuzzy matching on name\n  const normalizedName = metricName.toLowerCase().replace(/[^a-z0-9]/g, '');\n  return measurements.find(m => {\n    const normalizedMetricName = m.name.toLowerCase().replace(/[^a-z0-9]/g, '');\n    return normalizedMetricName.includes(normalizedName) ||\n           normalizedName.includes(normalizedMetricName);\n  });\n}\n\n/**\n * Check if a metric should be considered a \"false positive\" weakness.\n * This handles directional/dimorphic metrics where low scores don't mean weakness.\n *\n * Example: Canthal Tilt of 3° gets a low score (not in 6-8° ideal range)\n * but is still a POSITIVE trait, not a weakness.\n */\nfunction isFalsePositiveWeakness(metric: MatchedMetric): boolean {\n  const config = METRIC_CONFIGS[metric.metricId];\n  if (!config) return false;\n\n  // Check if the value is actually acceptable based on polarity\n  const { acceptable } = isValueAcceptable(metric.value, config);\n  return acceptable;\n}\n\n/**\n * Process all insight definitions against user's measurements\n */\nexport function classifyInsights(\n  measurements: MetricScoreResult[],\n  insightDefinitions: InsightDefinition[] = INSIGHTS_DEFINITIONS\n): InsightClassificationResult {\n  const strengths: ClassifiedStrength[] = [];\n  const weaknesses: ClassifiedWeakness[] = [];\n\n  for (const insight of insightDefinitions) {\n    const { metrics, threshold } = insight.severity_logic;\n\n    // Find matching measurements for this insight\n    const matchedMetrics: MatchedMetric[] = [];\n    for (const metricName of metrics) {\n      const measurement = findMetricByName(metricName, measurements);\n      if (measurement) {\n        matchedMetrics.push({\n          metricId: measurement.metricId,\n          metricName: measurement.name,\n          score: measurement.score,\n          value: measurement.value,\n          idealMin: measurement.idealMin,\n          idealMax: measurement.idealMax,\n          unit: measurement.unit,\n          category: measurement.category,\n        });\n      }\n    }\n\n    // Skip if no metrics matched (need at least 1)\n    if (matchedMetrics.length === 0) continue;\n\n    // Calculate average score\n    const avgScore = matchedMetrics.reduce((sum, m) => sum + m.score, 0) / matchedMetrics.length;\n\n    // Classify based on type and threshold\n    if (insight.type === 'weakness') {\n      // Weakness: avg < threshold → add to areas of improvement\n      if (avgScore < threshold) {\n        // ========== FALSE POSITIVE CHECK ==========\n        // Before adding to weaknesses, check if ANY of the matched metrics\n        // are actually in an \"acceptable\" zone based on their polarity.\n        // If so, this is a false positive and should be skipped or reclassified.\n        const falsePositiveMetrics = matchedMetrics.filter(isFalsePositiveWeakness);\n\n        // If ALL matched metrics are false positives, skip this weakness entirely\n        if (falsePositiveMetrics.length === matchedMetrics.length) {\n          // This is a false positive weakness - the values are actually acceptable\n          // Consider adding to strengths if scores are decent\n          if (avgScore >= 6) {\n            strengths.push({\n              insightId: `${insight.id}_acceptable`,\n              title: insight.title.replace('Negative', 'Neutral').replace('Weak', 'Moderate'),\n              description: `While not in the peak ideal range, the measured values are within acceptable limits.`,\n              grade: 'good',\n              gradeLabel: 'Acceptable',\n              avgScore,\n              matchedMetrics,\n            });\n          }\n          continue; // Skip adding as weakness\n        }\n\n        // If SOME metrics are false positives, filter them out\n        const trueWeaknessMetrics = matchedMetrics.filter(m => !isFalsePositiveWeakness(m));\n        if (trueWeaknessMetrics.length === 0) continue;\n\n        // Recalculate average with only true weakness metrics\n        const trueAvgScore = trueWeaknessMetrics.reduce((sum, m) => sum + m.score, 0) / trueWeaknessMetrics.length;\n\n        // Only add as weakness if true average is still below threshold\n        if (trueAvgScore < threshold) {\n          const severity = getWeaknessSeverity(trueAvgScore);\n          const labels = insight.content.severity_labels;\n          const severityLabel = labels?.[severity] || severity;\n\n          weaknesses.push({\n            insightId: insight.id,\n            title: insight.title,\n            description: insight.content.description,\n            severity,\n            severityLabel,\n            avgScore: trueAvgScore,\n            matchedMetrics: trueWeaknessMetrics,\n          });\n        }\n      }\n    } else {\n      // Strength: avg > threshold → add to key strengths\n      if (avgScore > threshold) {\n        const grade = getStrengthGrade(avgScore);\n        const labels = insight.content.grade_labels;\n        const gradeLabel = labels?.[grade] || grade;\n\n        strengths.push({\n          insightId: insight.id,\n          title: insight.title,\n          description: insight.content.description,\n          grade,\n          gradeLabel,\n          avgScore,\n          matchedMetrics,\n        });\n      }\n    }\n  }\n\n  // Sort by score (weaknesses by lowest score first, strengths by highest first)\n  weaknesses.sort((a, b) => a.avgScore - b.avgScore);\n  strengths.sort((a, b) => b.avgScore - a.avgScore);\n\n  return { strengths, weaknesses };\n}\n\n/**\n * Convert ClassifiedStrength to Strength type for UI compatibility\n */\nexport function convertToStrength(classified: ClassifiedStrength): Strength {\n  return {\n    id: `insight_strength_${classified.insightId}`,\n    strengthName: `${classified.title} (${classified.gradeLabel})`,\n    summary: classified.description,\n    avgScore: Math.max(0, Math.min(10, classified.avgScore)),  // Clamp to 0-10\n    qualityLevel: classified.grade === 'ideal' ? 'ideal' :\n                  classified.grade === 'excellent' ? 'excellent' : 'good',\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n  };\n}\n\n/**\n * Convert ClassifiedWeakness to Flaw type for UI compatibility\n */\nexport function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  const impact = (10 - classified.avgScore) * 0.5;\n  const newRollingLost = rollingLost + impact;\n\n  return {\n    id: `insight_flaw_${classified.insightId}`,\n    flawName: `${classified.title} (${classified.severityLabel})`,\n    summary: classified.description,\n    harmonyPercentageLost: impact,\n    standardizedImpact: impact / 10,\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n    rollingPointsDeducted: newRollingLost,\n    rollingHarmonyPercentageLost: newRollingLost,\n    rollingStandardizedImpact: newRollingLost / 10,\n  };\n}\n\n/**\n * Main function: Generate strengths and flaws from measurements using insights\n */\nexport function generateInsightBasedResults(\n  measurements: MetricScoreResult[]\n): { strengths: Strength[]; flaws: Flaw[] } {\n  const { strengths: classifiedStrengths, weaknesses: classifiedWeaknesses } = classifyInsights(measurements);\n\n  // Convert to UI-compatible types\n  const strengths = classifiedStrengths.map((s) => convertToStrength(s));\n\n  let rollingLost = 0;\n  const flaws = classifiedWeaknesses.map((w, i) => {\n    const flaw = convertToFlaw(w, i, rollingLost);\n    rollingLost = flaw.rollingPointsDeducted || 0;\n    return flaw;\n  });\n\n  return { strengths, flaws };\n}\n","structuredPatch":[{"oldStart":1570,"oldLines":6,"newStart":1570,"newLines":81,"lines":[" }"," "," // ============================================","+// CONFIDENCE CALCULATION (Z-Score Based)","+// ============================================","+","+/**","+ * Calculate confidence level for flaw detection based on Z-score magnitude.","+ *","+ * Logic from FaceIQ:","+ * - confirmed: |z| >= 2 (high statistical certainty - 2+ standard deviations)","+ * - likely: 1 <= |z| < 2 (moderate certainty - 1-2 standard deviations)","+ * - possible: 0.5 <= |z| < 1 (low certainty - 0.5-1 standard deviation)","+ *","+ * For metrics without Z-score data, we calculate confidence from the score:","+ * Score 0-3 = confirmed (very poor score = high confidence it's a flaw)","+ * Score 3-5 = likely (poor score = moderate confidence)","+ * Score 5-7 = possible (below average = low confidence)","+ *","+ * @param zScore - The absolute Z-score value","+ * @returns ConfidenceLevel - 'confirmed' | 'likely' | 'possible'","+ */","+export function calculateConfidenceFromZScore(zScore: number): ConfidenceLevel {","+  if (zScore >= 2) return 'confirmed';","+  if (zScore >= 1) return 'likely';","+  return 'possible';","+}","+","+/**","+ * Calculate confidence level from score when Z-score is unavailable.","+ * Maps score ranges to confidence levels inversely (lower score = higher confidence).","+ *","+ * @param avgScore - Average score of the flaw (0-10 scale)","+ * @returns ConfidenceLevel","+ */","+export function calculateConfidenceFromScore(avgScore: number): ConfidenceLevel {","+  // Very low scores = high confidence it's a real flaw","+  if (avgScore <= 3) return 'confirmed';","+  // Poor scores = moderate confidence","+  if (avgScore <= 5) return 'likely';","+  // Below average scores = low confidence","+  return 'possible';","+}","+","+/**","+ * Calculate confidence for a set of matched metrics.","+ * Uses Z-score when available, falls back to score-based calculation.","+ *","+ * @param matchedMetrics - Array of metrics contributing to the flaw","+ * @param avgScore - Overall average score of the flaw","+ * @returns ConfidenceLevel","+ */","+export function calculateFlawConfidence(","+  matchedMetrics: MatchedMetric[],","+  avgScore: number","+): ConfidenceLevel {","+  // Calculate Z-scores for each metric if we have the config","+  const zScores: number[] = [];","+","+  for (const metric of matchedMetrics) {","+    const config = MASTER_SCORING_DB[metric.metricId];","+    if (config && config.std_dev > 0) {","+      const zScore = calculateZScore(metric.value, config.mean, config.std_dev);","+      zScores.push(zScore);","+    }","+  }","+","+  // If we have Z-scores, use the maximum (highest deviation = highest confidence)","+  if (zScores.length > 0) {","+    const maxZScore = Math.max(...zScores);","+    return calculateConfidenceFromZScore(maxZScore);","+  }","+","+  // Fall back to score-based confidence","+  return calculateConfidenceFromScore(avgScore);","+}","+","+// ============================================"," // INSIGHT DEFINITION TYPES"," // ============================================"," "]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"99ea586e-36e9-4652-9002-98a05c931547","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01PYz1ZwEYtv8YrL6bzP7ha1","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me find the `classifyInsights` function and update it to include confidence in the weakness classification. Let me read the relevant section:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2830,"cache_read_input_tokens":83144,"cache_creation":{"ephemeral_5m_input_tokens":2830,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVJJN1JmPmnghQBSeEU","type":"assistant","uuid":"1a1741b9-3b91-43e5-a2b0-ce0b59b2bbb2","timestamp":"2025-12-26T14:53:06.016Z"}
{"parentUuid":"1a1741b9-3b91-43e5-a2b0-ce0b59b2bbb2","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01PYz1ZwEYtv8YrL6bzP7ha1","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_013d1H4fMnQmCUAWzWaR8aXy","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","offset":2580,"limit":100}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2830,"cache_read_input_tokens":83144,"cache_creation":{"ephemeral_5m_input_tokens":2830,"ephemeral_1h_input_tokens":0},"output_tokens":147,"service_tier":"standard"}},"requestId":"req_011CWVVJJN1JmPmnghQBSeEU","type":"assistant","uuid":"036bbaf8-7bbb-4385-9036-dd06460bba50","timestamp":"2025-12-26T14:53:06.762Z"}
{"parentUuid":"036bbaf8-7bbb-4385-9036-dd06460bba50","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_013d1H4fMnQmCUAWzWaR8aXy","type":"tool_result","content":"  2580→\n  2581→        // If ALL matched metrics are false positives, skip this weakness entirely\n  2582→        if (falsePositiveMetrics.length === matchedMetrics.length) {\n  2583→          // This is a false positive weakness - the values are actually acceptable\n  2584→          // Consider adding to strengths if scores are decent\n  2585→          if (avgScore >= 6) {\n  2586→            strengths.push({\n  2587→              insightId: `${insight.id}_acceptable`,\n  2588→              title: insight.title.replace('Negative', 'Neutral').replace('Weak', 'Moderate'),\n  2589→              description: `While not in the peak ideal range, the measured values are within acceptable limits.`,\n  2590→              grade: 'good',\n  2591→              gradeLabel: 'Acceptable',\n  2592→              avgScore,\n  2593→              matchedMetrics,\n  2594→            });\n  2595→          }\n  2596→          continue; // Skip adding as weakness\n  2597→        }\n  2598→\n  2599→        // If SOME metrics are false positives, filter them out\n  2600→        const trueWeaknessMetrics = matchedMetrics.filter(m => !isFalsePositiveWeakness(m));\n  2601→        if (trueWeaknessMetrics.length === 0) continue;\n  2602→\n  2603→        // Recalculate average with only true weakness metrics\n  2604→        const trueAvgScore = trueWeaknessMetrics.reduce((sum, m) => sum + m.score, 0) / trueWeaknessMetrics.length;\n  2605→\n  2606→        // Only add as weakness if true average is still below threshold\n  2607→        if (trueAvgScore < threshold) {\n  2608→          const severity = getWeaknessSeverity(trueAvgScore);\n  2609→          const labels = insight.content.severity_labels;\n  2610→          const severityLabel = labels?.[severity] || severity;\n  2611→\n  2612→          weaknesses.push({\n  2613→            insightId: insight.id,\n  2614→            title: insight.title,\n  2615→            description: insight.content.description,\n  2616→            severity,\n  2617→            severityLabel,\n  2618→            avgScore: trueAvgScore,\n  2619→            matchedMetrics: trueWeaknessMetrics,\n  2620→          });\n  2621→        }\n  2622→      }\n  2623→    } else {\n  2624→      // Strength: avg > threshold → add to key strengths\n  2625→      if (avgScore > threshold) {\n  2626→        const grade = getStrengthGrade(avgScore);\n  2627→        const labels = insight.content.grade_labels;\n  2628→        const gradeLabel = labels?.[grade] || grade;\n  2629→\n  2630→        strengths.push({\n  2631→          insightId: insight.id,\n  2632→          title: insight.title,\n  2633→          description: insight.content.description,\n  2634→          grade,\n  2635→          gradeLabel,\n  2636→          avgScore,\n  2637→          matchedMetrics,\n  2638→        });\n  2639→      }\n  2640→    }\n  2641→  }\n  2642→\n  2643→  // Sort by score (weaknesses by lowest score first, strengths by highest first)\n  2644→  weaknesses.sort((a, b) => a.avgScore - b.avgScore);\n  2645→  strengths.sort((a, b) => b.avgScore - a.avgScore);\n  2646→\n  2647→  return { strengths, weaknesses };\n  2648→}\n  2649→\n  2650→/**\n  2651→ * Convert ClassifiedStrength to Strength type for UI compatibility\n  2652→ */\n  2653→export function convertToStrength(classified: ClassifiedStrength): Strength {\n  2654→  return {\n  2655→    id: `insight_strength_${classified.insightId}`,\n  2656→    strengthName: `${classified.title} (${classified.gradeLabel})`,\n  2657→    summary: classified.description,\n  2658→    avgScore: Math.max(0, Math.min(10, classified.avgScore)),  // Clamp to 0-10\n  2659→    qualityLevel: classified.grade === 'ideal' ? 'ideal' :\n  2660→                  classified.grade === 'excellent' ? 'excellent' : 'good',\n  2661→    categoryName: classified.matchedMetrics[0]?.category || 'General',\n  2662→    responsibleRatios: classified.matchedMetrics.map(m => ({\n  2663→      ratioName: m.metricName,\n  2664→      ratioId: m.metricId,\n  2665→      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n  2666→      value: m.value,\n  2667→      idealMin: m.idealMin,\n  2668→      idealMax: m.idealMax,\n  2669→      unit: m.unit,\n  2670→      category: m.category,\n  2671→    })),\n  2672→  };\n  2673→}\n  2674→\n  2675→/**\n  2676→ * Convert ClassifiedWeakness to Flaw type for UI compatibility\n  2677→ */\n  2678→export function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  2679→  const impact = (10 - classified.avgScore) * 0.5;\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"3288a164-058e-4967-8b42-b7fd059318e9","timestamp":"2025-12-26T14:53:06.832Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","content":"\n        // If ALL matched metrics are false positives, skip this weakness entirely\n        if (falsePositiveMetrics.length === matchedMetrics.length) {\n          // This is a false positive weakness - the values are actually acceptable\n          // Consider adding to strengths if scores are decent\n          if (avgScore >= 6) {\n            strengths.push({\n              insightId: `${insight.id}_acceptable`,\n              title: insight.title.replace('Negative', 'Neutral').replace('Weak', 'Moderate'),\n              description: `While not in the peak ideal range, the measured values are within acceptable limits.`,\n              grade: 'good',\n              gradeLabel: 'Acceptable',\n              avgScore,\n              matchedMetrics,\n            });\n          }\n          continue; // Skip adding as weakness\n        }\n\n        // If SOME metrics are false positives, filter them out\n        const trueWeaknessMetrics = matchedMetrics.filter(m => !isFalsePositiveWeakness(m));\n        if (trueWeaknessMetrics.length === 0) continue;\n\n        // Recalculate average with only true weakness metrics\n        const trueAvgScore = trueWeaknessMetrics.reduce((sum, m) => sum + m.score, 0) / trueWeaknessMetrics.length;\n\n        // Only add as weakness if true average is still below threshold\n        if (trueAvgScore < threshold) {\n          const severity = getWeaknessSeverity(trueAvgScore);\n          const labels = insight.content.severity_labels;\n          const severityLabel = labels?.[severity] || severity;\n\n          weaknesses.push({\n            insightId: insight.id,\n            title: insight.title,\n            description: insight.content.description,\n            severity,\n            severityLabel,\n            avgScore: trueAvgScore,\n            matchedMetrics: trueWeaknessMetrics,\n          });\n        }\n      }\n    } else {\n      // Strength: avg > threshold → add to key strengths\n      if (avgScore > threshold) {\n        const grade = getStrengthGrade(avgScore);\n        const labels = insight.content.grade_labels;\n        const gradeLabel = labels?.[grade] || grade;\n\n        strengths.push({\n          insightId: insight.id,\n          title: insight.title,\n          description: insight.content.description,\n          grade,\n          gradeLabel,\n          avgScore,\n          matchedMetrics,\n        });\n      }\n    }\n  }\n\n  // Sort by score (weaknesses by lowest score first, strengths by highest first)\n  weaknesses.sort((a, b) => a.avgScore - b.avgScore);\n  strengths.sort((a, b) => b.avgScore - a.avgScore);\n\n  return { strengths, weaknesses };\n}\n\n/**\n * Convert ClassifiedStrength to Strength type for UI compatibility\n */\nexport function convertToStrength(classified: ClassifiedStrength): Strength {\n  return {\n    id: `insight_strength_${classified.insightId}`,\n    strengthName: `${classified.title} (${classified.gradeLabel})`,\n    summary: classified.description,\n    avgScore: Math.max(0, Math.min(10, classified.avgScore)),  // Clamp to 0-10\n    qualityLevel: classified.grade === 'ideal' ? 'ideal' :\n                  classified.grade === 'excellent' ? 'excellent' : 'good',\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n  };\n}\n\n/**\n * Convert ClassifiedWeakness to Flaw type for UI compatibility\n */\nexport function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  const impact = (10 - classified.avgScore) * 0.5;","numLines":100,"startLine":2580,"totalLines":2725}}}
{"parentUuid":"3288a164-058e-4967-8b42-b7fd059318e9","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01KECj22zg5U7m98C6c6srzL","type":"message","role":"assistant","content":[{"type":"text","text":"Now I need to:\n1. Update the `weaknesses.push()` call to include `confidence` calculation\n2. Update the `convertToFlaw` function to pass through the confidence to the `Flaw` type\n\nLet me update the weaknesses push call first:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1731,"cache_read_input_tokens":85974,"cache_creation":{"ephemeral_5m_input_tokens":1731,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWVVJn3Q6EpR4sV4JCG33","type":"assistant","uuid":"a139c993-8a97-4964-89d7-101bc7d721e2","timestamp":"2025-12-26T14:53:12.737Z"}
{"parentUuid":"a139c993-8a97-4964-89d7-101bc7d721e2","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01KECj22zg5U7m98C6c6srzL","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019GvdZRd85CKkegSw23hBAv","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","old_string":"        // Only add as weakness if true average is still below threshold\n        if (trueAvgScore < threshold) {\n          const severity = getWeaknessSeverity(trueAvgScore);\n          const labels = insight.content.severity_labels;\n          const severityLabel = labels?.[severity] || severity;\n\n          weaknesses.push({\n            insightId: insight.id,\n            title: insight.title,\n            description: insight.content.description,\n            severity,\n            severityLabel,\n            avgScore: trueAvgScore,\n            matchedMetrics: trueWeaknessMetrics,\n          });\n        }","new_string":"        // Only add as weakness if true average is still below threshold\n        if (trueAvgScore < threshold) {\n          const severity = getWeaknessSeverity(trueAvgScore);\n          const labels = insight.content.severity_labels;\n          const severityLabel = labels?.[severity] || severity;\n          // Calculate confidence based on Z-scores of matched metrics\n          const confidence = calculateFlawConfidence(trueWeaknessMetrics, trueAvgScore);\n\n          weaknesses.push({\n            insightId: insight.id,\n            title: insight.title,\n            description: insight.content.description,\n            severity,\n            severityLabel,\n            avgScore: trueAvgScore,\n            matchedMetrics: trueWeaknessMetrics,\n            confidence,\n          });\n        }"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1731,"cache_read_input_tokens":85974,"cache_creation":{"ephemeral_5m_input_tokens":1731,"ephemeral_1h_input_tokens":0},"output_tokens":523,"service_tier":"standard"}},"requestId":"req_011CWVVJn3Q6EpR4sV4JCG33","type":"assistant","uuid":"4718caa7-da8d-4504-a407-6ac3bce52c78","timestamp":"2025-12-26T14:53:16.131Z"}
{"parentUuid":"4718caa7-da8d-4504-a407-6ac3bce52c78","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019GvdZRd85CKkegSw23hBAv","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  2602→\n  2603→        // Recalculate average with only true weakness metrics\n  2604→        const trueAvgScore = trueWeaknessMetrics.reduce((sum, m) => sum + m.score, 0) / trueWeaknessMetrics.length;\n  2605→\n  2606→        // Only add as weakness if true average is still below threshold\n  2607→        if (trueAvgScore < threshold) {\n  2608→          const severity = getWeaknessSeverity(trueAvgScore);\n  2609→          const labels = insight.content.severity_labels;\n  2610→          const severityLabel = labels?.[severity] || severity;\n  2611→          // Calculate confidence based on Z-scores of matched metrics\n  2612→          const confidence = calculateFlawConfidence(trueWeaknessMetrics, trueAvgScore);\n  2613→\n  2614→          weaknesses.push({\n  2615→            insightId: insight.id,\n  2616→            title: insight.title,\n  2617→            description: insight.content.description,\n  2618→            severity,\n  2619→            severityLabel,\n  2620→            avgScore: trueAvgScore,\n  2621→            matchedMetrics: trueWeaknessMetrics,\n  2622→            confidence,\n  2623→          });\n  2624→        }\n  2625→      }\n  2626→    } else {\n  2627→      // Strength: avg > threshold → add to key strengths\n  2628→      if (avgScore > threshold) {"}]},"uuid":"4c695fb3-89c9-4771-a26f-de90c83c2325","timestamp":"2025-12-26T14:53:16.194Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","oldString":"        // Only add as weakness if true average is still below threshold\n        if (trueAvgScore < threshold) {\n          const severity = getWeaknessSeverity(trueAvgScore);\n          const labels = insight.content.severity_labels;\n          const severityLabel = labels?.[severity] || severity;\n\n          weaknesses.push({\n            insightId: insight.id,\n            title: insight.title,\n            description: insight.content.description,\n            severity,\n            severityLabel,\n            avgScore: trueAvgScore,\n            matchedMetrics: trueWeaknessMetrics,\n          });\n        }","newString":"        // Only add as weakness if true average is still below threshold\n        if (trueAvgScore < threshold) {\n          const severity = getWeaknessSeverity(trueAvgScore);\n          const labels = insight.content.severity_labels;\n          const severityLabel = labels?.[severity] || severity;\n          // Calculate confidence based on Z-scores of matched metrics\n          const confidence = calculateFlawConfidence(trueWeaknessMetrics, trueAvgScore);\n\n          weaknesses.push({\n            insightId: insight.id,\n            title: insight.title,\n            description: insight.content.description,\n            severity,\n            severityLabel,\n            avgScore: trueAvgScore,\n            matchedMetrics: trueWeaknessMetrics,\n            confidence,\n          });\n        }","originalFile":"/**\n * Insights Engine\n *\n * Processes insight definitions from insights.json and classifies them\n * as strengths or areas of improvement based on user's metric scores.\n *\n * Logic:\n * - For each insight definition, calculate average score of affected metrics\n * - Weakness: if avg score < threshold → classify with severity label\n * - Strength: if avg score > threshold → classify with grade label\n *\n * Z-Score Based 5-Tier Severity Logic:\n * - Ideal (Green): User is inside the ideal range\n * - Good (Blue): Within 0.5 Standard Deviation of the mean (|z| < 0.5)\n * - Fair (Cyan): Between 0.5 and 1 Standard Deviation (0.5 ≤ |z| < 1)\n * - Moderate (Yellow): Between 1 and 2 Standard Deviations (1 ≤ |z| < 2)\n * - Severe (Red): More than 2 Standard Deviations away (|z| ≥ 2)\n *\n * Severity Labels (Weaknesses):\n *   0-3 = \"Severe\"\n *   3-5 = \"Moderate\"\n *   5-7 = \"Minor\"\n *\n * Grade Labels (Strengths):\n *   8-9   = \"Good\"\n *   9-9.5 = \"Excellent\"\n *   9.5-10 = \"Ideal\"\n */\n\nimport { Strength, Flaw } from '@/types/results';\nimport { MetricScoreResult, METRIC_CONFIGS, isValueAcceptable, ConfidenceLevel } from '@/lib/harmony-scoring';\n\n// ============================================\n// MASTER SCORING DATABASE (Z-Score Based)\n// ============================================\n\nexport type SeverityLevel = 'ideal' | 'good' | 'fair' | 'moderate' | 'severe';\nexport type Gender = 'male' | 'female';\nexport type Ethnicity = 'white' | 'black' | 'east_asian' | 'south_asian' | 'hispanic' | 'middle_eastern' | 'native_american' | 'pacific_islander';\n\nexport interface MasterMetricConfig {\n  ideal: [number, number];  // [min, max] ideal range\n  mean: number;             // Population mean\n  std_dev: number;          // Standard deviation\n  flaws?: {\n    low?: string[];         // Flaws when value is too low\n    high?: string[];        // Flaws when value is too high\n  };\n}\n\n// Base/Default standards (White Male baseline)\nexport const MASTER_SCORING_DB: Record<string, MasterMetricConfig> = {\n  // MIDFACE & PROPORTIONS\n  \"midface_ratio\": {\n    ideal: [0.97, 1.00],\n    mean: 1.0,\n    std_dev: 0.115,\n    flaws: { low: [\"Long midface\", \"Long upper jaw\"] }\n  },\n  \"faceWidthToHeight\": {\n    ideal: [1.30, 1.45],\n    mean: 1.38,\n    std_dev: 0.08,\n    flaws: {\n      low: [\"Overly long face\", \"Narrow face\"],\n      high: [\"Wide face\", \"Short face\"]\n    }\n  },\n  \"totalFacialWidthToHeight\": {\n    ideal: [1.25, 1.40],\n    mean: 1.33,\n    std_dev: 0.075,\n    flaws: {\n      low: [\"Long face shape\"],\n      high: [\"Wide face shape\"]\n    }\n  },\n  \"upperThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short forehead\"],\n      high: [\"Long forehead\"]\n    }\n  },\n  \"middleThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short midface\"],\n      high: [\"Long midface\"]\n    }\n  },\n  \"lowerThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short lower face\"],\n      high: [\"Long lower face\"]\n    }\n  },\n\n  // EYE SPACING & IPD\n  \"eye_separation_ratio\": {\n    ideal: [0.45, 0.47],\n    mean: 0.46,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"interpupillaryRatio\": {\n    ideal: [0.44, 0.48],\n    mean: 0.46,\n    std_dev: 0.025,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"oneEyeApartTest\": {\n    ideal: [0.95, 1.05],\n    mean: 1.0,\n    std_dev: 0.08,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"intercanthalWidth\": {\n    ideal: [30, 35],\n    mean: 32.5,\n    std_dev: 2.5,\n    flaws: {\n      low: [\"Narrow eye spacing\"],\n      high: [\"Wide eye spacing\"]\n    }\n  },\n\n  // EYE SHAPE & FEATURES\n  \"lateralCanthalTilt\": {\n    ideal: [6, 8],\n    mean: 5.0,\n    std_dev: 3.5,\n    flaws: {\n      low: [\"Negative canthal tilt\", \"Downturned eyes\"],\n      high: [\"Excessively upturned eyes\"]\n    }\n  },\n  \"eyeAspectRatio\": {\n    ideal: [0.30, 0.35],\n    mean: 0.32,\n    std_dev: 0.04,\n    flaws: {\n      low: [\"Narrow eyes\"],\n      high: [\"Round eyes\"]\n    }\n  },\n  \"palpebralFissureLength\": {\n    ideal: [28, 32],\n    mean: 30.0,\n    std_dev: 2.5,\n    flaws: {\n      low: [\"Small eyes\"],\n      high: [\"Large eyes\"]\n    }\n  },\n  \"eyeWidth\": {\n    ideal: [28, 32],\n    mean: 30.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Narrow eyes\"],\n      high: [\"Wide eyes\"]\n    }\n  },\n  \"upperEyelidExposure\": {\n    ideal: [0.5, 1.2],\n    mean: 0.85,\n    std_dev: 0.35,\n    flaws: {\n      low: [\"Hooded eyes\"],\n      high: [\"Excessive upper lid exposure\"]\n    }\n  },\n  \"tearTroughDepth\": {\n    ideal: [0.0, 0.3],\n    mean: 0.15,\n    std_dev: 0.15,\n    flaws: {\n      high: [\"Dark circles / Tear troughs\", \"Under-eye hollowness\"]\n    }\n  },\n\n  // JAW ANGLES & STRUCTURE\n  \"gonial_angle\": {\n    ideal: [115, 125],\n    mean: 118.0,\n    std_dev: 6.5,\n    flaws: {\n      high: [\"Weak/soft jaw structure\", \"Rounded jaw\"]\n    }\n  },\n  \"mandibularPlaneAngle\": {\n    ideal: [20, 28],\n    mean: 24.0,\n    std_dev: 4.0,\n    flaws: {\n      low: [\"Flat mandibular plane\"],\n      high: [\"Steep mandibular plane\", \"Hyper-divergent jaw\"]\n    }\n  },\n  \"jawFrontalAngle\": {\n    ideal: [125, 135],\n    mean: 130.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Steep jaw\"],\n      high: [\"Flat jaw angle\"]\n    }\n  },\n  \"jawSlope\": {\n    ideal: [25, 35],\n    mean: 30.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat jawline\"],\n      high: [\"Steep jawline\"]\n    }\n  },\n\n  // JAW WIDTH\n  \"jawWidthRatio\": {\n    ideal: [0.85, 0.95],\n    mean: 0.90,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Narrow jaw\"],\n      high: [\"Wide jaw\"]\n    }\n  },\n  \"bigonialWidth\": {\n    ideal: [110, 125],\n    mean: 117.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow jaw width\"],\n      high: [\"Excessively wide jaw\"]\n    }\n  },\n\n  // CHEEKBONES\n  \"cheekbone_height\": {\n    ideal: [83.0, 100.0],\n    mean: 85.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Low-set cheekbones\", \"Flat midface\"]\n    }\n  },\n  \"cheekboneWidth\": {\n    ideal: [130, 145],\n    mean: 137.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow cheekbones\"],\n      high: [\"Wide cheekbones\"]\n    }\n  },\n\n  // CHIN\n  \"chinPhiltrumRatio\": {\n    ideal: [1.8, 2.2],\n    mean: 2.0,\n    std_dev: 0.2,\n    flaws: {\n      low: [\"Recessed chin\", \"Short chin\"],\n      high: [\"Long chin\", \"Projected chin\"]\n    }\n  },\n  \"chinHeight\": {\n    ideal: [35, 45],\n    mean: 40.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Short chin\"],\n      high: [\"Long chin\"]\n    }\n  },\n  \"chinWidth\": {\n    ideal: [35, 45],\n    mean: 40.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Pointed/Narrow chin\"],\n      high: [\"Wide chin\"]\n    }\n  },\n\n  // NOSE ANGLES\n  \"nasalTipAngle\": {\n    ideal: [95, 115],\n    mean: 105.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Droopy nasal tip\"],\n      high: [\"Upturned nasal tip\"]\n    }\n  },\n  \"nasolabialAngle\": {\n    ideal: [95, 110],\n    mean: 102.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Droopy nasal tip\"],\n      high: [\"Upturned nose\"]\n    }\n  },\n  \"nasofrontalAngle\": {\n    ideal: [115, 135],\n    mean: 125.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Deep nasal root\"],\n      high: [\"Flat nasal root\"]\n    }\n  },\n  \"nasofacialAngle\": {\n    ideal: [30, 40],\n    mean: 35.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat nose profile\"],\n      high: [\"Overprojected nose\"]\n    }\n  },\n  \"nasomentaAngle\": {\n    ideal: [120, 135],\n    mean: 127.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Convex profile\"],\n      high: [\"Concave profile\"]\n    }\n  },\n\n  // NOSE WIDTH & PROPORTIONS\n  \"nasalIndex\": {\n    ideal: [65, 75],\n    mean: 70.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Narrow nose\"],\n      high: [\"Wide nose\", \"Bulbous nose\"]\n    }\n  },\n  \"noseWidth\": {\n    ideal: [35, 42],\n    mean: 38.5,\n    std_dev: 3.5,\n    flaws: {\n      low: [\"Narrow nose\"],\n      high: [\"Wide nasal base\"]\n    }\n  },\n  \"noseBridgeWidth\": {\n    ideal: [12, 18],\n    mean: 15.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Narrow nose bridge\"],\n      high: [\"Wide nose bridge\"]\n    }\n  },\n  \"nasalProjection\": {\n    ideal: [16, 22],\n    mean: 19.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Underprojected nose\"],\n      high: [\"Overprojected nose\"]\n    }\n  },\n  \"noseLengthRatio\": {\n    ideal: [0.45, 0.55],\n    mean: 0.50,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Short nose\"],\n      high: [\"Long nose\"]\n    }\n  },\n\n  // LIPS & PHILTRUM\n  \"lipRatio\": {\n    ideal: [1.4, 1.6],\n    mean: 1.5,\n    std_dev: 0.15,\n    flaws: {\n      low: [\"Thin upper lip\"],\n      high: [\"Thick upper lip\"]\n    }\n  },\n  \"philtrumLength\": {\n    ideal: [11, 15],\n    mean: 13.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Short philtrum\"],\n      high: [\"Long philtrum\"]\n    }\n  },\n  \"upperLipHeight\": {\n    ideal: [18, 24],\n    mean: 21.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Thin upper lip\"],\n      high: [\"Thick upper lip\"]\n    }\n  },\n  \"lipChinDistance\": {\n    ideal: [40, 50],\n    mean: 45.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Short lower third\"],\n      high: [\"Long lower third\"]\n    }\n  },\n  \"upperLipProjection\": {\n    ideal: [-2, 2],\n    mean: 0.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Recessed upper lip\"],\n      high: [\"Protruding upper lip\"]\n    }\n  },\n  \"lowerLipProjection\": {\n    ideal: [-1, 3],\n    mean: 1.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Recessed lower lip\"],\n      high: [\"Protruding lower lip\"]\n    }\n  },\n  \"cupidsBowDepth\": {\n    ideal: [3, 6],\n    mean: 4.5,\n    std_dev: 1.5,\n    flaws: {\n      low: [\"Flat cupid's bow\"],\n      high: [\"Pronounced cupid's bow\"]\n    }\n  },\n\n  // EYEBROWS\n  \"eyebrowHeight\": {\n    ideal: [8, 14],\n    mean: 11.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Low-set eyebrows\"],\n      high: [\"High eyebrows\"]\n    }\n  },\n  \"browLengthRatio\": {\n    ideal: [0.50, 0.60],\n    mean: 0.55,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Short eyebrows\"],\n      high: [\"Long eyebrows\"]\n    }\n  },\n  \"browLengthToFaceWidth\": {\n    ideal: [0.30, 0.38],\n    mean: 0.34,\n    std_dev: 0.04,\n    flaws: {\n      low: [\"Short eyebrows\"],\n      high: [\"Long eyebrows\"]\n    }\n  },\n  \"browridgeInclinationAngle\": {\n    ideal: [10, 20],\n    mean: 15.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat brow ridge\"],\n      high: [\"Prominent brow ridge\"]\n    }\n  },\n  \"eyebrowThickness\": {\n    ideal: [1.5, 3.0],\n    mean: 2.25,\n    std_dev: 0.75,\n    flaws: {\n      low: [\"Sparse/Weak eyebrows\"],\n      high: [\"Overly thick eyebrows\"]\n    }\n  },\n\n  // FOREHEAD\n  \"foreheadHeight\": {\n    ideal: [55, 70],\n    mean: 62.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Short forehead\"],\n      high: [\"Tall forehead\"]\n    }\n  },\n  \"bitemporalWidth\": {\n    ideal: [120, 135],\n    mean: 127.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow forehead\"],\n      high: [\"Wide forehead\"]\n    }\n  },\n\n  // PROFILE & DEPTH\n  \"facialDepthToHeight\": {\n    ideal: [0.75, 0.85],\n    mean: 0.80,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Flat facial profile\"],\n      high: [\"Overprojected profile\"]\n    }\n  },\n  \"anteriorFacialDepth\": {\n    ideal: [115, 130],\n    mean: 122.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Shallow face depth\"],\n      high: [\"Deep face projection\"]\n    }\n  },\n  \"totalProfileAngle\": {\n    ideal: [165, 175],\n    mean: 170.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Convex profile\"],\n      high: [\"Concave profile\"]\n    }\n  },\n\n  // ASYMMETRY\n  \"facialAsymmetryIndex\": {\n    ideal: [0, 3],\n    mean: 2.0,\n    std_dev: 1.5,\n    flaws: {\n      high: [\"Facial asymmetry\"]\n    }\n  },\n  \"eyeAsymmetry\": {\n    ideal: [0, 2],\n    mean: 1.0,\n    std_dev: 1.0,\n    flaws: {\n      high: [\"Eye asymmetry\"]\n    }\n  },\n  \"jawAsymmetry\": {\n    ideal: [0, 3],\n    mean: 1.5,\n    std_dev: 1.5,\n    flaws: {\n      high: [\"Jaw asymmetry\"]\n    }\n  },\n\n  // OTHER\n  \"recessionFrankfort\": {\n    ideal: [-2, 2],\n    mean: 0.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Maxillary recession\"],\n      high: [\"Maxillary protrusion\"]\n    }\n  },\n  \"neckWidth\": {\n    ideal: [110, 130],\n    mean: 120.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Narrow neck\"],\n      high: [\"Wide neck\"]\n    }\n  },\n  \"neckToJawRatio\": {\n    ideal: [0.90, 1.10],\n    mean: 1.0,\n    std_dev: 0.10,\n    flaws: {\n      low: [\"Narrow neck\"],\n      high: [\"Thick neck\"]\n    }\n  }\n};\n\n// ============================================\n// ETHNICITY-SPECIFIC OVERRIDES\n// ============================================\n\n/**\n * Ethnicity and gender-specific metric standards\n * These override the base MASTER_SCORING_DB values for specific populations\n */\nexport const ETHNICITY_OVERRIDES: Record<string, Record<string, Partial<MasterMetricConfig>>> = {\n  // ========================================\n  // MALE WHITE STANDARDS (Neoclassical Baseline)\n  // ========================================\n  \"male_white\": {\n    // NOSE WIDTH - Strict 1:1 ratio (Eye Width = Nose Width)\n    \"noseWidth\": {\n      ideal: [35, 42],  // Corresponds to alar_base_ratio [0.98, 1.05]\n      mean: 38.5,\n      std_dev: 3.5,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // MIDFACE - Prefers compact midface (Hunter look)\n    \"midface_ratio\": {\n      ideal: [0.95, 1.02],\n      mean: 0.985,\n      std_dev: 0.035,\n      flaws: {\n        low: [\"Long midface\"]\n      }\n    },\n\n    // JAW - Square/Robust jaw preference\n    \"gonial_angle\": {\n      ideal: [115.0, 125.0],\n      mean: 120.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Weak/Soft jaw structure\"]\n      }\n    },\n\n    // FACE WIDTH - Standard Mesoprosopic range\n    \"faceWidthToHeight\": {\n      ideal: [1.90, 2.05],\n      mean: 1.975,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Short/Wide face\"]\n      }\n    },\n\n    // EYE TILT - Neutral to slightly positive\n    \"lateralCanthalTilt\": {\n      ideal: [4.0, 8.0],\n      mean: 6.0,\n      std_dev: 2.0,\n      flaws: {\n        low: [\"Negative canthal tilt\"]\n      }\n    },\n\n    // LOWER FACE BALANCE\n    \"chinPhiltrumRatio\": {\n      ideal: [2.10, 2.30],\n      mean: 2.20,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Long philtrum / Short chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE BLACK / AFRICAN STANDARDS\n  // ========================================\n  \"male_black\": {\n    // NOSE WIDTH - Significantly wider tolerance\n    \"noseWidth\": {\n      ideal: [40, 50],  // Wider range (corresponds to alar_base_ratio [1.12, 1.25])\n      mean: 45.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n    \"nasalIndex\": {\n      ideal: [80, 95],  // Wider nasal index\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        high: [\"Wide nose\"]\n      }\n    },\n\n    // LIPS - Prefers fuller lips\n    \"lipRatio\": {\n      ideal: [1.2, 1.5],\n      mean: 1.35,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    },\n\n    // PHILTRUM - Shorter visible philtrum is ideal\n    \"philtrumLength\": {\n      ideal: [11.0, 14.0],\n      mean: 12.5,\n      std_dev: 1.5,\n      flaws: {\n        high: [\"Long philtrum\"]\n      }\n    },\n\n    // CHIN - Adjusts for natural forward mouth projection (Prognathism)\n    \"chinPhiltrumRatio\": {\n      ideal: [1.80, 2.10],  // Lower range to account for prognathism\n      mean: 1.95,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Recessed chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE EAST ASIAN STANDARDS\n  // ========================================\n  \"male_east_asian\": {\n    // EYE SPACING - Shifted WIDER for East Asian males\n    \"eye_separation_ratio\": {\n      ideal: [0.48, 0.53],  // Shifted wider (0.46 is \"close-set\" here)\n      mean: 0.505,\n      std_dev: 0.025,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Wide-set eyes\"]\n      }\n    },\n    \"interpupillaryRatio\": {\n      ideal: [0.48, 0.53],\n      mean: 0.505,\n      std_dev: 0.025,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Wide-set eyes\"]\n      }\n    },\n\n    // EYE SHAPE - Prefers narrower/longer eyes (Hunter Eyes)\n    \"eyeAspectRatio\": {\n      ideal: [0.25, 0.29],  // Lower ratio = more elongated\n      mean: 0.27,\n      std_dev: 0.02,\n      flaws: {\n        low: [\"Overly narrow eyes\"],\n        high: [\"Overly round eye shape\"]\n      }\n    },\n    \"palpebralFissureLength\": {\n      ideal: [29, 33],\n      mean: 31.0,\n      std_dev: 2.0,\n      flaws: {\n        low: [\"Small eyes\"],\n        high: [\"Large eyes\"]\n      }\n    },\n\n    // NOSE - Asian noses typically allowed to be wider\n    \"nasalIndex\": {\n      ideal: [75, 85],\n      mean: 80.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nose\"]\n      }\n    },\n    \"noseWidth\": {\n      ideal: [38, 45],\n      mean: 41.5,\n      std_dev: 3.5,\n      flaws: {\n        low: [\"Narrow nose\"],\n        high: [\"Very wide nasal base\"]\n      }\n    },\n    \"noseBridgeWidth\": {\n      ideal: [14, 20],\n      mean: 17.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Narrow nose bridge\"],\n        high: [\"Wide nose bridge\"]\n      }\n    },\n\n    // CHEEKS - Rewards slightly fuller cheeks (Youth/K-Pop aesthetic)\n    \"cheekbone_height\": {\n      ideal: [80.0, 95.0],\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Gaunt/Hollow face\"]\n      }\n    },\n\n    // JAW - Slightly softer angles acceptable\n    \"gonial_angle\": {\n      ideal: [118, 128],\n      mean: 123.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Weak/soft jaw structure\"]\n      }\n    },\n    \"mandibularPlaneAngle\": {\n      ideal: [20, 30],\n      mean: 25.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Flat mandibular plane\"],\n        high: [\"Steep mandibular plane\"]\n      }\n    },\n\n    // FACIAL PROPORTIONS - Wider faces more common\n    \"faceWidthToHeight\": {\n      ideal: [1.35, 1.50],\n      mean: 1.425,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n    \"totalFacialWidthToHeight\": {\n      ideal: [1.30, 1.45],\n      mean: 1.375,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long face shape\"],\n        high: [\"Wide face shape\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE SOUTH ASIAN STANDARDS\n  // ========================================\n  \"male_south_asian\": {\n    // NOSE WIDTH - Slightly wider tolerance than White\n    \"noseWidth\": {\n      ideal: [36, 43],  // alar_base_ratio [1.00, 1.08]\n      mean: 39.5,\n      std_dev: 3.5,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // TEAR TROUGH - VERY STRICT. High penalty for dark circles\n    \"tearTroughDepth\": {\n      ideal: [0.0, 0.5],\n      mean: 0.25,\n      std_dev: 0.25,\n      flaws: {\n        high: [\"Dark circles / Tear troughs\"]\n      }\n    },\n\n    // UPPER EYELID - Often prefers visible lid platform\n    \"upperEyelidExposure\": {\n      ideal: [0.5, 2.0],\n      mean: 1.25,\n      std_dev: 0.75,\n      flaws: {\n        low: [\"Hooded eyes\"]\n      }\n    },\n\n    // CHEEKS - Penalizes \"Gaunt\" looks heavily\n    \"cheekbone_height\": {\n      ideal: [83.0, 95.0],\n      mean: 89.0,\n      std_dev: 6.0,\n      flaws: {\n        low: [\"Volume loss / Gauntness\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE HISPANIC STANDARDS (\"The Bridge Model\")\n  // ========================================\n  \"male_hispanic\": {\n    // FACE WIDTH - Rewards broader, more robust face shapes (Mestizo)\n    \"faceWidthToHeight\": {\n      ideal: [1.95, 2.10],\n      mean: 2.025,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long/Narrow face\"]\n      }\n    },\n\n    // NOSE WIDTH - Bridge tolerance (Wider than White, narrower than Black)\n    \"noseWidth\": {\n      ideal: [36, 44],  // alar_base_ratio [1.00, 1.12]\n      mean: 40.0,\n      std_dev: 4.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // EYE TILT - Strong preference for positive tilt\n    \"lateralCanthalTilt\": {\n      ideal: [6.0, 12.0],\n      mean: 9.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Negative/Neutral canthal tilt\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE MIDDLE EASTERN STANDARDS\n  // ========================================\n  \"male_middle_eastern\": {\n    // EYEBROW THICKNESS - Prefers significantly thicker/darker brows\n    \"eyebrowThickness\": {\n      ideal: [2.0, 4.0],\n      mean: 3.0,\n      std_dev: 1.0,\n      flaws: {\n        low: [\"Sparse/Weak eyebrows\"],\n        high: [\"Unibrow\"]\n      }\n    },\n\n    // NASOLABIAL ANGLE - Penalizes droopy tip (<90) or hooked noses\n    \"nasolabialAngle\": {\n      ideal: [90.0, 100.0],\n      mean: 95.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Droopy nose tip / Hooked nose\"]\n      }\n    },\n\n    // EYE TILT - Strong preference for Almond/Hunter eye shape\n    \"lateralCanthalTilt\": {\n      ideal: [4.0, 10.0],\n      mean: 7.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    },\n\n    // MIDFACE - Similar to White model (Compact is better)\n    \"midface_ratio\": {\n      ideal: [0.95, 1.02],\n      mean: 0.985,\n      std_dev: 0.035,\n      flaws: {\n        low: [\"Long midface\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE PACIFIC ISLANDER STANDARDS (\"The Warrior Skull\")\n  // ========================================\n  \"male_pacific_islander\": {\n    // FACE WIDTH - The Highest Width Standard (Very broad)\n    \"faceWidthToHeight\": {\n      ideal: [2.10, 2.30],\n      mean: 2.20,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Narrow/Long face\"]\n      }\n    },\n\n    // NOSE WIDTH - Wide tolerance\n    \"noseWidth\": {\n      ideal: [38, 48],  // alar_base_ratio [1.05, 1.20]\n      mean: 43.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // CHEEKS - Rewards high mass/robustness\n    \"cheekbone_height\": {\n      ideal: [85.0, 100.0],\n      mean: 92.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Gaunt/Weak face structure\"]\n      }\n    },\n\n    // CHIN WIDTH - Prefers a very broad, square chin\n    \"chinWidth\": {\n      ideal: [40.0, 50.0],\n      mean: 45.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Pointed/Narrow chin\"]\n      }\n    }\n  },\n\n  \"male_native_american\": {\n    \"faceWidthToHeight\": {\n      ideal: [2.00, 2.20],\n      mean: 2.10,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Wide face\"]\n      }\n    },\n\n    \"nasalIndex\": {\n      ideal: [75, 90],\n      mean: 82.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Narrow nose\"],\n        high: [\"Wide nose\"]\n      }\n    },\n\n    \"cheekbone_height\": {\n      ideal: [80.0, 95.0],\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Flat cheekbones\"]\n      }\n    },\n\n    \"gonialAngle\": {\n      ideal: [115, 125],\n      mean: 120,\n      std_dev: 5,\n      flaws: {\n        low: [\"Weak jaw\"],\n        high: [\"Harsh jaw angle\"]\n      }\n    },\n\n    \"chinWidth\": {\n      ideal: [38.0, 48.0],\n      mean: 43.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Narrow chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // FEMALE ETHNICITIES (The \"Missing Link\")\n  // ========================================\n\n  \"female_white\": {\n    // NOSE WIDTH - Strict Rule of Fifths for feminine harmony\n    \"alar_base_ratio\": {\n      ideal: [0.98, 1.05],\n      mean: 1.015,\n      std_dev: 0.035,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // FACE WIDTH - Prefers oval/narrow feminine proportions\n    \"fwhr\": {\n      ideal: [1.45, 1.53],\n      mean: 1.49,\n      std_dev: 0.04,\n      flaws: {\n        low: [\"Long/Narrow face\"],\n        high: [\"Wide face\"]\n      }\n    },\n\n    // JAW - Soft, tapered feminine jawline\n    \"gonial_angle\": {\n      ideal: [122.0, 130.0],\n      mean: 126.0,\n      std_dev: 4.0,\n      flaws: {\n        low: [\"Sharp/Masculine jaw angle\"],\n        high: [\"Weak/Overly soft jawline\"]\n      }\n    },\n\n    // EYE TILT - Neutral to positive preferred\n    \"canthal_tilt\": {\n      ideal: [4.0, 9.0],\n      mean: 6.5,\n      std_dev: 2.5,\n      flaws: {\n        low: [\"Negative/Downturned eyes\"]\n      }\n    },\n\n    // CHIN-PHILTRUM - Golden Ratio balance\n    \"chin_philtrum_ratio\": {\n      ideal: [2.0, 2.2],\n      mean: 2.1,\n      std_dev: 0.1,\n      flaws: {\n        low: [\"Recessed chin\"],\n        high: [\"Protruding chin\"]\n      }\n    }\n  },\n\n  \"female_black\": {\n    // LIPS - High volume preference (fuller lips)\n    \"lipRatio\": {\n      ideal: [1.3, 1.6],\n      mean: 1.45,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    },\n\n    // NOSE WIDTH - Wider tolerance for ethnic variation\n    \"alar_base_ratio\": {\n      ideal: [1.05, 1.15],\n      mean: 1.10,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Very wide nasal base\"]\n      }\n    },\n\n    // CHIN - Allows forward projection (natural prognathism)\n    \"chin_projection\": {\n      ideal: [0.0, 5.0],\n      mean: 2.5,\n      std_dev: 2.5,\n      flaws: {\n        high: [\"Excessive chin projection\"]\n      }\n    },\n\n    // JAW - Soft feminine jawline\n    \"gonial_angle\": {\n      ideal: [120.0, 130.0],\n      mean: 125.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Sharp jaw angle\"],\n        high: [\"Weak jawline\"]\n      }\n    }\n  },\n\n  \"female_east_asian\": {\n    // EYE SPACING - Wide-set neotenous preference\n    \"eye_separation_ratio\": {\n      ideal: [46.3, 47.5],\n      mean: 46.9,\n      std_dev: 0.6,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Very wide-set eyes\"]\n      }\n    },\n\n    // JAW - Tapered V-shape feminine ideal\n    \"gonial_angle\": {\n      ideal: [120.0, 126.0],\n      mean: 123.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Sharp V-line jaw\"],\n        high: [\"Weak/Square jawline\"]\n      }\n    },\n\n    // EYEBROWS - Higher set brows (youthful feminine)\n    \"eyebrow_height\": {\n      ideal: [0.85, 1.30],\n      mean: 1.075,\n      std_dev: 0.225,\n      flaws: {\n        low: [\"Low-set/Heavy brows\"],\n        high: [\"Very high-arched brows\"]\n      }\n    },\n\n    // LOWER FACE - Compact lower third (neotenous)\n    \"lower_third_ratio\": {\n      ideal: [29.6, 32.7],\n      mean: 31.15,\n      std_dev: 1.55,\n      flaws: {\n        low: [\"Very short lower face\"],\n        high: [\"Long lower face\"]\n      }\n    }\n  },\n\n  \"female_south_asian\": {\n    // TEAR TROUGHS - Very strict on dark circles\n    \"tear_trough_depth\": {\n      ideal: [0.0, 0.5],\n      mean: 0.25,\n      std_dev: 0.25,\n      flaws: {\n        high: [\"Dark circles / Deep tear troughs\"]\n      }\n    },\n\n    // CHEEKS - Rewards midface volume (youthful fullness)\n    \"cheek_fullness\": {\n      ideal: [1.0, 2.0],\n      mean: 1.5,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Gaunt/Hollow cheeks\"]\n      }\n    },\n\n    // SKIN - High penalty for uneven skin tone\n    \"skin_uniformity\": {\n      ideal: [0.92, 1.0],\n      mean: 0.96,\n      std_dev: 0.04,\n      flaws: {\n        low: [\"Uneven skin tone / Pigmentation\"]\n      }\n    },\n\n    // NOSE WIDTH - Intermediate tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.00, 1.08],\n      mean: 1.04,\n      std_dev: 0.04,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    }\n  },\n\n  \"female_hispanic\": {\n    // FACE WIDTH - Broader Mestiza tolerance\n    \"fwhr\": {\n      ideal: [1.50, 1.62],\n      mean: 1.56,\n      std_dev: 0.06,\n      flaws: {\n        low: [\"Long/Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // EYE TILT - Strong almond eye preference\n    \"canthal_tilt\": {\n      ideal: [6.0, 12.0],\n      mean: 9.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Neutral/Downturned eyes\"]\n      }\n    },\n\n    // NOSE WIDTH - Intermediate width tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.00, 1.10],\n      mean: 1.05,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // LIPS - Voluptuous preference\n    \"lipRatio\": {\n      ideal: [1.1, 1.35],\n      mean: 1.225,\n      std_dev: 0.125,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    }\n  },\n\n  \"female_middle_eastern\": {\n    // EYEBROWS - Dense/Thick brows preference\n    \"eyebrow_thickness\": {\n      ideal: [1.5, 3.0],\n      mean: 2.25,\n      std_dev: 0.75,\n      flaws: {\n        low: [\"Sparse/Thin eyebrows\"],\n        high: [\"Unibrow\"]\n      }\n    },\n\n    // NOSE - Refined/Upturned tip\n    \"nasolabial_angle\": {\n      ideal: [95.0, 105.0],\n      mean: 100.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Droopy nose tip\"],\n        high: [\"Overly upturned nose\"]\n      }\n    },\n\n    // EYE TILT - Foxy/Hunter feminine eye shape\n    \"canthal_tilt\": {\n      ideal: [5.0, 10.0],\n      mean: 7.5,\n      std_dev: 2.5,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    },\n\n    // EYELID - Low exposure preferred\n    \"upper_eyelid_exposure\": {\n      ideal: [0.5, 1.5],\n      mean: 1.0,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Hooded eyes\"],\n        high: [\"Excessive eyelid exposure\"]\n      }\n    }\n  },\n\n  \"female_native_american\": {\n    // FACE WIDTH - Wide/High cheekbone structure\n    \"fwhr\": {\n      ideal: [1.52, 1.65],\n      mean: 1.585,\n      std_dev: 0.065,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // CHEEKBONES - High definition/prominence\n    \"cheekbone_prominence\": {\n      ideal: [1.5, 2.5],\n      mean: 2.0,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Flat cheekbones\"],\n        high: [\"Overly prominent cheekbones\"]\n      }\n    },\n\n    // JAW - Stronger jaw tolerance\n    \"gonial_angle\": {\n      ideal: [115.0, 125.0],\n      mean: 120.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Very sharp jaw\"],\n        high: [\"Weak jawline\"]\n      }\n    },\n\n    // EYE TILT - Positive tilt preference\n    \"canthal_tilt\": {\n      ideal: [5.0, 11.0],\n      mean: 8.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    }\n  },\n\n  \"female_pacific_islander\": {\n    // FACE WIDTH - Widest/Robust facial structure\n    \"fwhr\": {\n      ideal: [1.55, 1.70],\n      mean: 1.625,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // CHEEKS - High volume/softness preference\n    \"cheek_fullness\": {\n      ideal: [1.2, 2.5],\n      mean: 1.85,\n      std_dev: 0.65,\n      flaws: {\n        low: [\"Gaunt/Hollow cheeks\"]\n      }\n    },\n\n    // NOSE WIDTH - Wide nose tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.05, 1.15],\n      mean: 1.10,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Very wide nasal base\"]\n      }\n    },\n\n    // LIPS - Full lips preference\n    \"lipRatio\": {\n      ideal: [1.25, 1.50],\n      mean: 1.375,\n      std_dev: 0.125,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    }\n  }\n};\n\n/**\n * Get the appropriate metric configuration for a given gender and ethnicity\n * Falls back to base config if no override exists\n */\nexport function getMetricConfig(\n  metricId: string,\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'white'\n): MasterMetricConfig | undefined {\n  const key = `${gender}_${ethnicity}`;\n  const override = ETHNICITY_OVERRIDES[key]?.[metricId];\n  const baseConfig = MASTER_SCORING_DB[metricId];\n\n  if (!baseConfig) return undefined;\n\n  // Merge override with base config\n  if (override) {\n    return {\n      ...baseConfig,\n      ...override,\n      flaws: {\n        ...baseConfig.flaws,\n        ...override.flaws\n      }\n    } as MasterMetricConfig;\n  }\n\n  return baseConfig;\n}\n\n// ============================================\n// Z-SCORE SEVERITY FUNCTIONS\n// ============================================\n\n/**\n * Calculate Z-score for a given value\n * Z = (value - mean) / std_dev\n */\nexport function calculateZScore(value: number, mean: number, stdDev: number): number {\n  if (stdDev === 0) return 0;\n  return Math.abs((value - mean) / stdDev);\n}\n\n/**\n * Determine severity level based on Z-score and ideal range (5-tier system)\n * - Ideal: Value is within ideal range\n * - Good: |z| < 0.5 (within 0.5 standard deviation)\n * - Fair: 0.5 ≤ |z| < 1 (between 0.5-1 standard deviations)\n * - Moderate: 1 ≤ |z| < 2 (between 1-2 standard deviations)\n * - Severe: |z| ≥ 2 (more than 2 standard deviations away)\n */\nexport function getSeverityFromZScore(\n  value: number,\n  config: MasterMetricConfig\n): { severity: SeverityLevel; zScore: number; isInIdeal: boolean } {\n  const { ideal, mean, std_dev } = config;\n  const isInIdeal = value >= ideal[0] && value <= ideal[1];\n  const zScore = calculateZScore(value, mean, std_dev);\n\n  let severity: SeverityLevel;\n  if (isInIdeal) {\n    severity = 'ideal';\n  } else if (zScore < 0.5) {\n    severity = 'good';\n  } else if (zScore < 1) {\n    severity = 'fair';\n  } else if (zScore < 2) {\n    severity = 'moderate';\n  } else {\n    severity = 'severe';\n  }\n\n  return { severity, zScore, isInIdeal };\n}\n\n/**\n * Get severity for a metric value with ethnicity/gender awareness\n */\nexport function getSeverityForMetric(\n  metricId: string,\n  value: number,\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'white'\n): { severity: SeverityLevel; zScore: number; isInIdeal: boolean; config: MasterMetricConfig } | null {\n  const config = getMetricConfig(metricId, gender, ethnicity);\n  if (!config) return null;\n\n  const result = getSeverityFromZScore(value, config);\n  return { ...result, config };\n}\n\n/**\n * Get badge color for severity level (5-tier)\n */\nexport function getSeverityColor(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'green';\n    case 'good': return 'blue';\n    case 'fair': return 'cyan';\n    case 'moderate': return 'yellow';\n    case 'severe': return 'red';\n    default: return 'gray';\n  }\n}\n\n/**\n * Get severity label for display (5-tier)\n */\nexport function getSeverityLabel(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'Ideal';\n    case 'good': return 'Good';\n    case 'fair': return 'Fair';\n    case 'moderate': return 'Moderate';\n    case 'severe': return 'Severe';\n    default: return 'Unknown';\n  }\n}\n\n// ============================================\n// CONFIDENCE CALCULATION (Z-Score Based)\n// ============================================\n\n/**\n * Calculate confidence level for flaw detection based on Z-score magnitude.\n *\n * Logic from FaceIQ:\n * - confirmed: |z| >= 2 (high statistical certainty - 2+ standard deviations)\n * - likely: 1 <= |z| < 2 (moderate certainty - 1-2 standard deviations)\n * - possible: 0.5 <= |z| < 1 (low certainty - 0.5-1 standard deviation)\n *\n * For metrics without Z-score data, we calculate confidence from the score:\n * Score 0-3 = confirmed (very poor score = high confidence it's a flaw)\n * Score 3-5 = likely (poor score = moderate confidence)\n * Score 5-7 = possible (below average = low confidence)\n *\n * @param zScore - The absolute Z-score value\n * @returns ConfidenceLevel - 'confirmed' | 'likely' | 'possible'\n */\nexport function calculateConfidenceFromZScore(zScore: number): ConfidenceLevel {\n  if (zScore >= 2) return 'confirmed';\n  if (zScore >= 1) return 'likely';\n  return 'possible';\n}\n\n/**\n * Calculate confidence level from score when Z-score is unavailable.\n * Maps score ranges to confidence levels inversely (lower score = higher confidence).\n *\n * @param avgScore - Average score of the flaw (0-10 scale)\n * @returns ConfidenceLevel\n */\nexport function calculateConfidenceFromScore(avgScore: number): ConfidenceLevel {\n  // Very low scores = high confidence it's a real flaw\n  if (avgScore <= 3) return 'confirmed';\n  // Poor scores = moderate confidence\n  if (avgScore <= 5) return 'likely';\n  // Below average scores = low confidence\n  return 'possible';\n}\n\n/**\n * Calculate confidence for a set of matched metrics.\n * Uses Z-score when available, falls back to score-based calculation.\n *\n * @param matchedMetrics - Array of metrics contributing to the flaw\n * @param avgScore - Overall average score of the flaw\n * @returns ConfidenceLevel\n */\nexport function calculateFlawConfidence(\n  matchedMetrics: MatchedMetric[],\n  avgScore: number\n): ConfidenceLevel {\n  // Calculate Z-scores for each metric if we have the config\n  const zScores: number[] = [];\n\n  for (const metric of matchedMetrics) {\n    const config = MASTER_SCORING_DB[metric.metricId];\n    if (config && config.std_dev > 0) {\n      const zScore = calculateZScore(metric.value, config.mean, config.std_dev);\n      zScores.push(zScore);\n    }\n  }\n\n  // If we have Z-scores, use the maximum (highest deviation = highest confidence)\n  if (zScores.length > 0) {\n    const maxZScore = Math.max(...zScores);\n    return calculateConfidenceFromZScore(maxZScore);\n  }\n\n  // Fall back to score-based confidence\n  return calculateConfidenceFromScore(avgScore);\n}\n\n// ============================================\n// INSIGHT DEFINITION TYPES\n// ============================================\n\nexport interface InsightSeverityLogic {\n  metrics: string[];  // Display names of metrics (e.g., \"Face Width to Height Ratio\")\n  threshold: number;  // Score threshold for classification\n}\n\nexport interface WeaknessSeverityLabels {\n  minor: string;\n  moderate: string;\n  severe: string;\n}\n\nexport interface StrengthGradeLabels {\n  good: string;\n  excellent: string;\n  ideal: string;\n}\n\nexport interface InsightContent {\n  description: string;\n  severity_labels?: WeaknessSeverityLabels;  // For weaknesses\n  grade_labels?: StrengthGradeLabels;        // For strengths\n}\n\nexport interface InsightDefinition {\n  id: string;\n  title: string;\n  type: 'weakness' | 'strength';\n  severity_logic: InsightSeverityLogic;\n  content: InsightContent;\n}\n\n// ============================================\n// CLASSIFICATION RESULT TYPES\n// ============================================\n\nexport type WeaknessSeverity = 'severe' | 'moderate' | 'minor';\nexport type StrengthGrade = 'ideal' | 'excellent' | 'good';\n\nexport interface ClassifiedWeakness {\n  insightId: string;\n  title: string;\n  description: string;\n  severity: WeaknessSeverity;\n  severityLabel: string;  // Custom label from definition (e.g., \"Extremely Long\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n  /**\n   * Confidence level based on Z-score magnitude:\n   * - confirmed: |z| >= 2 (high statistical certainty, 2+ SDs from mean)\n   * - likely: 1 <= |z| < 2 (moderate certainty)\n   * - possible: 0.5 <= |z| < 1 (low certainty)\n   */\n  confidence: ConfidenceLevel;\n}\n\nexport interface ClassifiedStrength {\n  insightId: string;\n  title: string;\n  description: string;\n  grade: StrengthGrade;\n  gradeLabel: string;  // Custom label from definition (e.g., \"Ideal\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n}\n\nexport interface MatchedMetric {\n  metricId: string;\n  metricName: string;\n  score: number;\n  value: number;\n  idealMin: number;\n  idealMax: number;\n  unit: string;\n  category: string;\n}\n\nexport interface InsightClassificationResult {\n  strengths: ClassifiedStrength[];\n  weaknesses: ClassifiedWeakness[];\n}\n\n// ============================================\n// INSIGHTS DATABASE\n// ============================================\n\nexport const INSIGHTS_DEFINITIONS: InsightDefinition[] = [\n  {\n    id: \"long_midface\",\n    title: \"Long Midface\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\", \"Ipsilateral Alar Angle\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The middle of the face is elongated, creating an unbalanced vertical proportion.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Extremely Long\" }\n    }\n  },\n  {\n    id: \"short_midface\",\n    title: \"Short Midface\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The midface has ideal vertical proportions, contributing to facial harmony.\",\n      grade_labels: { good: \"Proportionate\", excellent: \"Well-Balanced\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"weak_jaw\",\n    title: \"Weak/Soft Jaw Structure\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Chin to Philtrum Ratio\", \"Jaw Slope\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The jaw has a softer, rounder shape, often less angular and robust than the ideal.\",\n      severity_labels: { minor: \"Soft\", moderate: \"Recessed\", severe: \"Weak\" }\n    }\n  },\n  {\n    id: \"strong_jaw\",\n    title: \"Strong Jaw Definition\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Jaw Width Ratio\", \"Bigonial Width\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The jaw displays strong definition with well-defined angles and proportionate width.\",\n      grade_labels: { good: \"Defined\", excellent: \"Strong\", ideal: \"Ideal Angular\" }\n    }\n  },\n  {\n    id: \"refined_nasal_tip\",\n    title: \"Refined Nasal Tip\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasal Tip Angle\", \"Nose Tip Position\", \"Frankfort-tip Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious nasal profile due to the nasal tip being well-defined and proportionate.\",\n      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"bulbous_nose\",\n    title: \"Bulbous Nasal Tip\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Index\", \"Nose Width\", \"Nasal Tip Angle\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nasal tip appears rounded and less defined, affecting nasal aesthetics.\",\n      severity_labels: { minor: \"Slightly Rounded\", moderate: \"Rounded\", severe: \"Bulbous\" }\n    }\n  },\n  {\n    id: \"ideal_upper_lip\",\n    title: \"Well-Positioned Upper Lip\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Upper Lip E-Line Position\", \"Upper Lip S-Line Position\", \"Nasolabial Angle\"],\n      threshold: 9.0\n    },\n    content: {\n      description: \"This contributes to a harmonious mouth region due to the upper lip sitting neither too far forward nor too far back.\",\n      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"negative_canthal_tilt\",\n    title: \"Negative Canthal Tilt\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The outer corners of the eyes sit lower than the inner corners, creating a downturned appearance.\",\n      severity_labels: { minor: \"Slight Downturn\", moderate: \"Noticeable\", severe: \"Pronounced\" }\n    }\n  },\n  {\n    id: \"positive_canthal_tilt\",\n    title: \"Positive Canthal Tilt\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The outer corners of the eyes are elevated, creating an attractive upswept eye shape.\",\n      grade_labels: { good: \"Slight Upturn\", excellent: \"Well-Tilted\", ideal: \"Hunter Eyes\" }\n    }\n  },\n  {\n    id: \"balanced_facial_thirds\",\n    title: \"Balanced Facial Thirds\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face displays well-balanced vertical proportions across all three facial thirds.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfectly Proportioned\" }\n    }\n  },\n  {\n    id: \"imbalanced_thirds\",\n    title: \"Facial Third Imbalance\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The vertical face proportions show imbalance between the three facial thirds.\",\n      severity_labels: { minor: \"Slight Imbalance\", moderate: \"Noticeable Disproportion\", severe: \"Significant Imbalance\" }\n    }\n  },\n  {\n    id: \"high_cheekbones\",\n    title: \"High Cheekbones\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Cheekbone Height\", \"Cheekbone Width\", \"Midface Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"Well-positioned cheekbones that create attractive facial contours and catch light beautifully.\",\n      grade_labels: { good: \"Visible\", excellent: \"Prominent\", ideal: \"Model-Tier\" }\n    }\n  },\n  {\n    id: \"flat_midface\",\n    title: \"Flat Midface\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Cheekbone Height\", \"Midface Ratio\", \"Total Facial Width to Height\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The midface lacks forward projection, resulting in flatter facial contours.\",\n      severity_labels: { minor: \"Slightly Flat\", moderate: \"Underprojected\", severe: \"Recessed\" }\n    }\n  },\n  {\n    id: \"ideal_lip_ratio\",\n    title: \"Ideal Lip Proportions\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Lip Ratio\", \"Philtrum Length\", \"Lip Chin Distance\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The lips demonstrate excellent proportions with balanced upper-to-lower lip ratio.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Well-Proportioned\", ideal: \"Perfect Ratio\" }\n    }\n  },\n  {\n    id: \"thin_lips\",\n    title: \"Thin Lip Profile\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Lip Ratio\", \"Upper Lip Projection\", \"Lower Lip Projection\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The lips appear thinner than ideal proportions, affecting lower face harmony.\",\n      severity_labels: { minor: \"Slightly Thin\", moderate: \"Thin\", severe: \"Very Thin\" }\n    }\n  },\n  {\n    id: \"ideal_ipd\",\n    title: \"Ideal Eye Spacing\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The eyes are ideally spaced, creating facial balance and attractiveness.\",\n      grade_labels: { good: \"Good Spacing\", excellent: \"Ideal Distance\", ideal: \"Perfect IPD\" }\n    }\n  },\n  {\n    id: \"wide_set_eyes\",\n    title: \"Wide-Set Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes are spaced wider apart than the aesthetic ideal.\",\n      severity_labels: { minor: \"Slightly Wide\", moderate: \"Noticeably Wide\", severe: \"Very Wide\" }\n    }\n  },\n  {\n    id: \"close_set_eyes\",\n    title: \"Close-Set Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"Intercanthal Width\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes are positioned closer together than the aesthetic ideal.\",\n      severity_labels: { minor: \"Slightly Close\", moderate: \"Noticeably Close\", severe: \"Very Close\" }\n    }\n  },\n  {\n    id: \"ideal_nose_projection\",\n    title: \"Ideal Nasal Projection\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasofrontal Angle\", \"Nasofacial Angle\", \"Nasomenta Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The nose has ideal forward projection relative to the face, creating profile harmony.\",\n      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect Projection\" }\n    }\n  },\n  {\n    id: \"recessed_chin\",\n    title: \"Recessed Chin\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Facial Depth to Height\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The chin sits behind the ideal position, affecting profile balance.\",\n      severity_labels: { minor: \"Slightly Recessed\", moderate: \"Recessed\", severe: \"Severely Recessed\" }\n    }\n  },\n  {\n    id: \"ideal_chin_projection\",\n    title: \"Ideal Chin Projection\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Anterior Facial Depth\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The chin demonstrates ideal projection and proportions relative to the face.\",\n      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect\" }\n    }\n  },\n  {\n    id: \"long_philtrum\",\n    title: \"Long Philtrum\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Philtrum Length\", \"Lip Chin Distance\", \"Upper Lip Height\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The distance between nose and upper lip is longer than ideal.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n    }\n  },\n  {\n    id: \"short_philtrum\",\n    title: \"Short Philtrum\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Philtrum Length\", \"Upper Lip Height\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The philtrum has ideal or shorter length, considered youthful and attractive.\",\n      grade_labels: { good: \"Good Length\", excellent: \"Short\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"wide_nose\",\n    title: \"Wide Nasal Base\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Index\", \"Intercanthal Nasal Ratio\", \"Nose Bridge Width\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The base of the nose is wider than the aesthetic ideal for facial harmony.\",\n      severity_labels: { minor: \"Slightly Wide\", moderate: \"Wide\", severe: \"Very Wide\" }\n    }\n  },\n  {\n    id: \"ideal_brow_position\",\n    title: \"Ideal Brow Position\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Eyebrow Height\", \"Brow Length Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The eyebrows are ideally positioned relative to the eyes and facial structure.\",\n      grade_labels: { good: \"Good Position\", excellent: \"Well-Arched\", ideal: \"Perfect Frame\" }\n    }\n  },\n  {\n    id: \"narrow_jaw\",\n    title: \"Narrow Jaw\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Jaw Width Ratio\", \"Bigonial Width\", \"Jaw Frontal Angle\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The jaw is narrower than ideal, affecting lower face width and definition.\",\n      severity_labels: { minor: \"Slightly Narrow\", moderate: \"Narrow\", severe: \"Very Narrow\" }\n    }\n  },\n  {\n    id: \"steep_mandibular_plane\",\n    title: \"Steep Mandibular Plane\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The mandibular plane angle is steeper than ideal, often indicating vertical growth pattern.\",\n      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n    }\n  },\n  // ============================================\n  // INSIGHT DEFINITIONS (element.html / element1.html)\n  // ============================================\n  // --- WEAKNESSES ---\n  {\n    id: \"steep_jaw\",\n    title: \"Steep Jaw\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Jaw Frontal Angle\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The jaw angles sharply downward, creating a narrow or pointed chin effect.\",\n      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n    }\n  },\n  {\n    id: \"maxillary_recession\",\n    title: \"Maxillary Recession\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Facial Depth to Height Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The upper jaw is less forward than ideal, reducing midface projection and facial harmony.\",\n      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n    }\n  },\n  {\n    id: \"mandibular_recession\",\n    title: \"Mandibular Recession\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The lower jaw is set back, creating a less prominent chin and an unbalanced profile.\",\n      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n    }\n  },\n  {\n    id: \"underprojected_chin\",\n    title: \"Underprojected Chin\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\", \"Chin Height\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The chin lacks forward projection, creating a weak lower face appearance.\",\n      severity_labels: { minor: \"Slightly Weak\", moderate: \"Underprojected\", severe: \"Severely Underprojected\" }\n    }\n  },\n  {\n    id: \"overly_long_face\",\n    title: \"Overly Long Face Shape\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Total Facial Width to Height Ratio\", \"Face Width to Height Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The face is excessively tall and narrow, creating an elongated appearance.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n    }\n  },\n  {\n    id: \"hyper_divergent_jaw\",\n    title: \"Hyper-Divergent Jaw Growth\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The jaw grows with an overly steep angle, resulting in a long or narrow lower face. This can indicate malocclusion.\",\n      severity_labels: { minor: \"Mildly Divergent\", moderate: \"Divergent\", severe: \"Hyper-Divergent\" }\n    }\n  },\n  {\n    id: \"weak_brow_ridge\",\n    title: \"Soft/Weak Brow Ridge\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Browridge Inclination Angle\", \"Eyebrow Height\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The forehead has a softer, less prominent ridge than the ideal, reducing masculine definition.\",\n      severity_labels: { minor: \"Slightly Soft\", moderate: \"Soft\", severe: \"Very Weak\" }\n    }\n  },\n  {\n    id: \"droopy_nasal_tip\",\n    title: \"Droopy Nasal Tip\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\", \"Nasofacial Angle\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nasal tip points downward more than ideal, creating a drooping appearance.\",\n      severity_labels: { minor: \"Slightly Droopy\", moderate: \"Droopy\", severe: \"Very Droopy\" }\n    }\n  },\n  {\n    id: \"overprojected_nose\",\n    title: \"Overprojected Nose\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Projection\", \"Nasofacial Angle\", \"Nose Length Ratio\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nose projects too far forward relative to the face, creating imbalance.\",\n      severity_labels: { minor: \"Slightly Projected\", moderate: \"Overprojected\", severe: \"Very Overprojected\" }\n    }\n  },\n  {\n    id: \"small_eyes\",\n    title: \"Small Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Eye Aspect Ratio\", \"Palpebral Fissure Length\", \"Eye Width\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes appear smaller than the aesthetic ideal relative to the face.\",\n      severity_labels: { minor: \"Slightly Small\", moderate: \"Small\", severe: \"Very Small\" }\n    }\n  },\n  {\n    id: \"low_set_eyebrows\",\n    title: \"Low-Set Eyebrows\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Eyebrow Height\", \"Brow to Hairline Distance\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyebrows sit lower than ideal, reducing the visible upper eyelid space.\",\n      severity_labels: { minor: \"Slightly Low\", moderate: \"Low\", severe: \"Very Low\" }\n    }\n  },\n  {\n    id: \"asymmetrical_face\",\n    title: \"Facial Asymmetry\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The left and right sides of the face show noticeable differences in proportion or position.\",\n      severity_labels: { minor: \"Slight Asymmetry\", moderate: \"Noticeable Asymmetry\", severe: \"Significant Asymmetry\" }\n    }\n  },\n  // --- STRENGTHS ---\n  {\n    id: \"good_jaw_width\",\n    title: \"Good Jaw Width\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Bigonial Width\", \"Jaw Width Ratio\", \"Jaw Frontal Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a pleasant jaw contour due to the jaw being neither too wide nor too narrow.\",\n      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n    }\n  },\n  {\n    id: \"good_forehead_slope\",\n    title: \"Good Forehead Slope\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Browridge Inclination Angle\", \"Forehead Height\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a pleasant forehead contour by indicating that the forehead is neither too steep nor too flat.\",\n      grade_labels: { good: \"Good Slope\", excellent: \"Well-Angled\", ideal: \"Ideal Slope\" }\n    }\n  },\n  {\n    id: \"good_cupids_bow\",\n    title: \"Good Cupid's Bow Depth\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Cupids Bow Depth\", \"Upper Lip Height\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious lip region due to the cupid's bow having ideal definition and depth.\",\n      grade_labels: { good: \"Defined\", excellent: \"Well-Defined\", ideal: \"Perfectly Defined\" }\n    }\n  },\n  {\n    id: \"good_eyebrow_length\",\n    title: \"Good Eyebrow Length\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Brow Length to Face Width Ratio\", \"Brow Length Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious eye region due to the eyebrows having ideal horizontal length relative to face width.\",\n      grade_labels: { good: \"Good Length\", excellent: \"Well-Proportioned\", ideal: \"Ideal Length\" }\n    }\n  },\n  {\n    id: \"good_neck_width\",\n    title: \"Good Neck Width\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Neck Width\", \"Neck to Jaw Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious lower face due to the neck being neither too wide nor too thin.\",\n      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n    }\n  },\n  {\n    id: \"ideal_nasolabial_angle\",\n    title: \"Ideal Nasolabial Angle\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The angle between nose and upper lip is in the ideal range, creating profile harmony.\",\n      grade_labels: { good: \"Good Angle\", excellent: \"Well-Angled\", ideal: \"Perfect Angle\" }\n    }\n  },\n  {\n    id: \"ideal_facial_depth\",\n    title: \"Ideal Facial Depth\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Facial Depth to Height Ratio\", \"Anterior Facial Depth\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face has ideal forward projection creating attractive three-dimensional contours.\",\n      grade_labels: { good: \"Good Depth\", excellent: \"Well-Projected\", ideal: \"Ideal Projection\" }\n    }\n  },\n  {\n    id: \"ideal_eye_shape\",\n    title: \"Ideal Eye Shape\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Eye Aspect Ratio\", \"Lateral Canthal Tilt\", \"Palpebral Fissure Length\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The eyes have an attractive almond shape with ideal proportions and tilt.\",\n      grade_labels: { good: \"Attractive\", excellent: \"Well-Shaped\", ideal: \"Hunter Eyes\" }\n    }\n  },\n  {\n    id: \"harmonious_profile\",\n    title: \"Harmonious Profile\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Total Profile Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The facial profile shows excellent balance between nose, lips, and chin positions.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfect Profile\" }\n    }\n  },\n  {\n    id: \"good_facial_symmetry\",\n    title: \"Good Facial Symmetry\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face displays excellent bilateral symmetry, a key component of attractiveness.\",\n      grade_labels: { good: \"Symmetric\", excellent: \"Very Symmetric\", ideal: \"Near-Perfect Symmetry\" }\n    }\n  }\n];\n\n// ============================================\n// METRIC NAME MAPPING\n// ============================================\n\n// Map display names to metric IDs for lookup\nconst METRIC_NAME_TO_ID: Record<string, string> = {\n  // Face Shape/Proportions\n  \"Face Width to Height Ratio\": \"faceWidthToHeight\",\n  \"Total Facial Width to Height\": \"totalFacialWidthToHeight\",\n  \"Total Facial Width to Height Ratio\": \"totalFacialWidthToHeight\",\n  \"Midface Ratio\": \"midfaceRatio\",\n  \"Upper Third Proportion\": \"upperThirdProportion\",\n  \"Middle Third Proportion\": \"middleThirdProportion\",\n  \"Lower Third Proportion\": \"lowerThirdProportion\",\n  \"Cheekbone Height\": \"cheekboneHeight\",\n  \"Cheekbone Width\": \"cheekboneWidth\",\n  \"Bitemporal Width\": \"bitemporalWidth\",\n  \"Forehead Height\": \"foreheadHeight\",\n  \"Facial Asymmetry Index\": \"facialAsymmetryIndex\",\n\n  // Jaw\n  \"Gonial Angle\": \"gonialAngle\",\n  \"Mandibular Plane Angle\": \"mandibularPlaneAngle\",\n  \"Jaw Width Ratio\": \"jawWidthRatio\",\n  \"Bigonial Width\": \"bigonialWidth\",\n  \"Jaw Frontal Angle\": \"jawFrontalAngle\",\n  \"Jaw Slope\": \"jawSlope\",\n  \"Jaw Asymmetry\": \"jawAsymmetry\",\n\n  // Chin\n  \"Chin to Philtrum Ratio\": \"chinPhiltrumRatio\",\n  \"Chin Height\": \"chinHeight\",\n  \"Facial Depth to Height\": \"facialDepthToHeight\",\n  \"Facial Depth to Height Ratio\": \"facialDepthToHeight\",\n  \"Anterior Facial Depth\": \"anteriorFacialDepth\",\n  \"Recession Relative to Frankfort Plane\": \"recessionFrankfort\",\n\n  // Eyes\n  \"Lateral Canthal Tilt\": \"lateralCanthalTilt\",\n  \"Eye Aspect Ratio\": \"eyeAspectRatio\",\n  \"Eye Separation Ratio\": \"eyeSeparationRatio\",\n  \"Interpupillary Ratio\": \"interpupillaryRatio\",\n  \"One Eye Apart Test\": \"oneEyeApartTest\",\n  \"Intercanthal Width\": \"intercanthalWidth\",\n  \"Eyebrow Height\": \"eyebrowHeight\",\n  \"Brow Length Ratio\": \"browLengthRatio\",\n  \"Brow Length to Face Width Ratio\": \"browLengthToFaceWidth\",\n  \"Palpebral Fissure Length\": \"palpebralFissureLength\",\n  \"Eye Width\": \"eyeWidth\",\n  \"Eye Asymmetry\": \"eyeAsymmetry\",\n  \"Brow to Hairline Distance\": \"browToHairlineDistance\",\n\n  // Brow\n  \"Browridge Inclination Angle\": \"browridgeInclinationAngle\",\n\n  // Nose\n  \"Nasal Index\": \"nasalIndex\",\n  \"Nasal Tip Angle\": \"nasalTipAngle\",\n  \"Nose Tip Position\": \"noseTipPosition\",\n  \"Frankfort-tip Angle\": \"frankfortTipAngle\",\n  \"Nasofrontal Angle\": \"nasofrontalAngle\",\n  \"Nasofacial Angle\": \"nasofacialAngle\",\n  \"Nasomenta Angle\": \"nasomentaAngle\",\n  \"Nasomental Angle\": \"nasomentaAngle\",\n  \"Intercanthal Nasal Ratio\": \"intercanthalNasalRatio\",\n  \"Nose Bridge Width\": \"noseBridgeWidth\",\n  \"Nose Width\": \"noseWidth\",\n  \"Nasal Projection\": \"nasalProjection\",\n  \"Nose Length Ratio\": \"noseLengthRatio\",\n  \"Ipsilateral Alar Angle\": \"ipsilateralAlarAngle\",\n\n  // Lips\n  \"Lip Ratio\": \"lipRatio\",\n  \"Philtrum Length\": \"philtrumLength\",\n  \"Upper Lip Projection\": \"upperLipProjection\",\n  \"Lower Lip Projection\": \"lowerLipProjection\",\n  \"Lip Chin Distance\": \"lipChinDistance\",\n  \"Upper Lip Height\": \"upperLipHeight\",\n  \"Upper Lip E-Line Position\": \"upperLipELine\",\n  \"Upper Lip S-Line Position\": \"upperLipSLine\",\n  \"Nasolabial Angle\": \"nasolabialAngle\",\n  \"Cupids Bow Depth\": \"cupidsBowDepth\",\n\n  // Neck\n  \"Neck Width\": \"neckWidth\",\n  \"Neck to Jaw Ratio\": \"neckToJawRatio\",\n\n  // Profile\n  \"Total Profile Angle\": \"totalProfileAngle\",\n};\n\n// ============================================\n// CLASSIFICATION FUNCTIONS\n// ============================================\n\n/**\n * Get weakness severity based on average score\n * 0-3 = \"Severe\", 3-5 = \"Moderate\", 5-7 = \"Minor\"\n */\nfunction getWeaknessSeverity(avgScore: number): WeaknessSeverity {\n  if (avgScore <= 3) return 'severe';\n  if (avgScore <= 5) return 'moderate';\n  return 'minor';\n}\n\n/**\n * Get strength grade based on average score\n * 8-9 = \"Good\", 9-9.5 = \"Excellent\", 9.5-10 = \"Ideal\"\n */\nfunction getStrengthGrade(avgScore: number): StrengthGrade {\n  if (avgScore >= 9.5) return 'ideal';\n  if (avgScore >= 9) return 'excellent';\n  return 'good';\n}\n\n/**\n * Find metric by display name from measurements array\n */\nfunction findMetricByName(\n  metricName: string,\n  measurements: MetricScoreResult[]\n): MetricScoreResult | undefined {\n  // First try direct ID mapping\n  const metricId = METRIC_NAME_TO_ID[metricName];\n  if (metricId) {\n    return measurements.find(m => m.metricId === metricId);\n  }\n\n  // Fallback: try fuzzy matching on name\n  const normalizedName = metricName.toLowerCase().replace(/[^a-z0-9]/g, '');\n  return measurements.find(m => {\n    const normalizedMetricName = m.name.toLowerCase().replace(/[^a-z0-9]/g, '');\n    return normalizedMetricName.includes(normalizedName) ||\n           normalizedName.includes(normalizedMetricName);\n  });\n}\n\n/**\n * Check if a metric should be considered a \"false positive\" weakness.\n * This handles directional/dimorphic metrics where low scores don't mean weakness.\n *\n * Example: Canthal Tilt of 3° gets a low score (not in 6-8° ideal range)\n * but is still a POSITIVE trait, not a weakness.\n */\nfunction isFalsePositiveWeakness(metric: MatchedMetric): boolean {\n  const config = METRIC_CONFIGS[metric.metricId];\n  if (!config) return false;\n\n  // Check if the value is actually acceptable based on polarity\n  const { acceptable } = isValueAcceptable(metric.value, config);\n  return acceptable;\n}\n\n/**\n * Process all insight definitions against user's measurements\n */\nexport function classifyInsights(\n  measurements: MetricScoreResult[],\n  insightDefinitions: InsightDefinition[] = INSIGHTS_DEFINITIONS\n): InsightClassificationResult {\n  const strengths: ClassifiedStrength[] = [];\n  const weaknesses: ClassifiedWeakness[] = [];\n\n  for (const insight of insightDefinitions) {\n    const { metrics, threshold } = insight.severity_logic;\n\n    // Find matching measurements for this insight\n    const matchedMetrics: MatchedMetric[] = [];\n    for (const metricName of metrics) {\n      const measurement = findMetricByName(metricName, measurements);\n      if (measurement) {\n        matchedMetrics.push({\n          metricId: measurement.metricId,\n          metricName: measurement.name,\n          score: measurement.score,\n          value: measurement.value,\n          idealMin: measurement.idealMin,\n          idealMax: measurement.idealMax,\n          unit: measurement.unit,\n          category: measurement.category,\n        });\n      }\n    }\n\n    // Skip if no metrics matched (need at least 1)\n    if (matchedMetrics.length === 0) continue;\n\n    // Calculate average score\n    const avgScore = matchedMetrics.reduce((sum, m) => sum + m.score, 0) / matchedMetrics.length;\n\n    // Classify based on type and threshold\n    if (insight.type === 'weakness') {\n      // Weakness: avg < threshold → add to areas of improvement\n      if (avgScore < threshold) {\n        // ========== FALSE POSITIVE CHECK ==========\n        // Before adding to weaknesses, check if ANY of the matched metrics\n        // are actually in an \"acceptable\" zone based on their polarity.\n        // If so, this is a false positive and should be skipped or reclassified.\n        const falsePositiveMetrics = matchedMetrics.filter(isFalsePositiveWeakness);\n\n        // If ALL matched metrics are false positives, skip this weakness entirely\n        if (falsePositiveMetrics.length === matchedMetrics.length) {\n          // This is a false positive weakness - the values are actually acceptable\n          // Consider adding to strengths if scores are decent\n          if (avgScore >= 6) {\n            strengths.push({\n              insightId: `${insight.id}_acceptable`,\n              title: insight.title.replace('Negative', 'Neutral').replace('Weak', 'Moderate'),\n              description: `While not in the peak ideal range, the measured values are within acceptable limits.`,\n              grade: 'good',\n              gradeLabel: 'Acceptable',\n              avgScore,\n              matchedMetrics,\n            });\n          }\n          continue; // Skip adding as weakness\n        }\n\n        // If SOME metrics are false positives, filter them out\n        const trueWeaknessMetrics = matchedMetrics.filter(m => !isFalsePositiveWeakness(m));\n        if (trueWeaknessMetrics.length === 0) continue;\n\n        // Recalculate average with only true weakness metrics\n        const trueAvgScore = trueWeaknessMetrics.reduce((sum, m) => sum + m.score, 0) / trueWeaknessMetrics.length;\n\n        // Only add as weakness if true average is still below threshold\n        if (trueAvgScore < threshold) {\n          const severity = getWeaknessSeverity(trueAvgScore);\n          const labels = insight.content.severity_labels;\n          const severityLabel = labels?.[severity] || severity;\n\n          weaknesses.push({\n            insightId: insight.id,\n            title: insight.title,\n            description: insight.content.description,\n            severity,\n            severityLabel,\n            avgScore: trueAvgScore,\n            matchedMetrics: trueWeaknessMetrics,\n          });\n        }\n      }\n    } else {\n      // Strength: avg > threshold → add to key strengths\n      if (avgScore > threshold) {\n        const grade = getStrengthGrade(avgScore);\n        const labels = insight.content.grade_labels;\n        const gradeLabel = labels?.[grade] || grade;\n\n        strengths.push({\n          insightId: insight.id,\n          title: insight.title,\n          description: insight.content.description,\n          grade,\n          gradeLabel,\n          avgScore,\n          matchedMetrics,\n        });\n      }\n    }\n  }\n\n  // Sort by score (weaknesses by lowest score first, strengths by highest first)\n  weaknesses.sort((a, b) => a.avgScore - b.avgScore);\n  strengths.sort((a, b) => b.avgScore - a.avgScore);\n\n  return { strengths, weaknesses };\n}\n\n/**\n * Convert ClassifiedStrength to Strength type for UI compatibility\n */\nexport function convertToStrength(classified: ClassifiedStrength): Strength {\n  return {\n    id: `insight_strength_${classified.insightId}`,\n    strengthName: `${classified.title} (${classified.gradeLabel})`,\n    summary: classified.description,\n    avgScore: Math.max(0, Math.min(10, classified.avgScore)),  // Clamp to 0-10\n    qualityLevel: classified.grade === 'ideal' ? 'ideal' :\n                  classified.grade === 'excellent' ? 'excellent' : 'good',\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n  };\n}\n\n/**\n * Convert ClassifiedWeakness to Flaw type for UI compatibility\n */\nexport function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  const impact = (10 - classified.avgScore) * 0.5;\n  const newRollingLost = rollingLost + impact;\n\n  return {\n    id: `insight_flaw_${classified.insightId}`,\n    flawName: `${classified.title} (${classified.severityLabel})`,\n    summary: classified.description,\n    harmonyPercentageLost: impact,\n    standardizedImpact: impact / 10,\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n    rollingPointsDeducted: newRollingLost,\n    rollingHarmonyPercentageLost: newRollingLost,\n    rollingStandardizedImpact: newRollingLost / 10,\n  };\n}\n\n/**\n * Main function: Generate strengths and flaws from measurements using insights\n */\nexport function generateInsightBasedResults(\n  measurements: MetricScoreResult[]\n): { strengths: Strength[]; flaws: Flaw[] } {\n  const { strengths: classifiedStrengths, weaknesses: classifiedWeaknesses } = classifyInsights(measurements);\n\n  // Convert to UI-compatible types\n  const strengths = classifiedStrengths.map((s) => convertToStrength(s));\n\n  let rollingLost = 0;\n  const flaws = classifiedWeaknesses.map((w, i) => {\n    const flaw = convertToFlaw(w, i, rollingLost);\n    rollingLost = flaw.rollingPointsDeducted || 0;\n    return flaw;\n  });\n\n  return { strengths, flaws };\n}\n","structuredPatch":[{"oldStart":2608,"oldLines":6,"newStart":2608,"newLines":8,"lines":["           const severity = getWeaknessSeverity(trueAvgScore);","           const labels = insight.content.severity_labels;","           const severityLabel = labels?.[severity] || severity;","+          // Calculate confidence based on Z-scores of matched metrics","+          const confidence = calculateFlawConfidence(trueWeaknessMetrics, trueAvgScore);"," ","           weaknesses.push({","             insightId: insight.id,"]},{"oldStart":2617,"oldLines":6,"newStart":2619,"newLines":7,"lines":["             severityLabel,","             avgScore: trueAvgScore,","             matchedMetrics: trueWeaknessMetrics,","+            confidence,","           });","         }","       }"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"4c695fb3-89c9-4771-a26f-de90c83c2325","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01DatE8f1J1nVLGjmVTJ87Mo","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me update the `convertToFlaw` function to include the confidence:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1091,"cache_read_input_tokens":87705,"cache_creation":{"ephemeral_5m_input_tokens":1091,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWVVKU6Rbovw52ukBtjA6","type":"assistant","uuid":"b0ec5403-6847-4fa9-9a6d-3b7ebfbf99fc","timestamp":"2025-12-26T14:53:21.507Z"}
{"parentUuid":"b0ec5403-6847-4fa9-9a6d-3b7ebfbf99fc","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01DatE8f1J1nVLGjmVTJ87Mo","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XLYv1p5Zs5g2d6PHSvPGdq","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","offset":2675,"limit":50}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1091,"cache_read_input_tokens":87705,"cache_creation":{"ephemeral_5m_input_tokens":1091,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWVVKU6Rbovw52ukBtjA6","type":"assistant","uuid":"905e335d-bb2a-4484-9d3c-7ced9c2f844b","timestamp":"2025-12-26T14:53:22.081Z"}
{"parentUuid":"905e335d-bb2a-4484-9d3c-7ced9c2f844b","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XLYv1p5Zs5g2d6PHSvPGdq","type":"tool_result","content":"  2675→  };\n  2676→}\n  2677→\n  2678→/**\n  2679→ * Convert ClassifiedWeakness to Flaw type for UI compatibility\n  2680→ */\n  2681→export function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  2682→  const impact = (10 - classified.avgScore) * 0.5;\n  2683→  const newRollingLost = rollingLost + impact;\n  2684→\n  2685→  return {\n  2686→    id: `insight_flaw_${classified.insightId}`,\n  2687→    flawName: `${classified.title} (${classified.severityLabel})`,\n  2688→    summary: classified.description,\n  2689→    harmonyPercentageLost: impact,\n  2690→    standardizedImpact: impact / 10,\n  2691→    categoryName: classified.matchedMetrics[0]?.category || 'General',\n  2692→    responsibleRatios: classified.matchedMetrics.map(m => ({\n  2693→      ratioName: m.metricName,\n  2694→      ratioId: m.metricId,\n  2695→      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n  2696→      value: m.value,\n  2697→      idealMin: m.idealMin,\n  2698→      idealMax: m.idealMax,\n  2699→      unit: m.unit,\n  2700→      category: m.category,\n  2701→    })),\n  2702→    rollingPointsDeducted: newRollingLost,\n  2703→    rollingHarmonyPercentageLost: newRollingLost,\n  2704→    rollingStandardizedImpact: newRollingLost / 10,\n  2705→  };\n  2706→}\n  2707→\n  2708→/**\n  2709→ * Main function: Generate strengths and flaws from measurements using insights\n  2710→ */\n  2711→export function generateInsightBasedResults(\n  2712→  measurements: MetricScoreResult[]\n  2713→): { strengths: Strength[]; flaws: Flaw[] } {\n  2714→  const { strengths: classifiedStrengths, weaknesses: classifiedWeaknesses } = classifyInsights(measurements);\n  2715→\n  2716→  // Convert to UI-compatible types\n  2717→  const strengths = classifiedStrengths.map((s) => convertToStrength(s));\n  2718→\n  2719→  let rollingLost = 0;\n  2720→  const flaws = classifiedWeaknesses.map((w, i) => {\n  2721→    const flaw = convertToFlaw(w, i, rollingLost);\n  2722→    rollingLost = flaw.rollingPointsDeducted || 0;\n  2723→    return flaw;\n  2724→  });\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"2b4fbe19-e4c7-4079-bb42-2e9c1110a036","timestamp":"2025-12-26T14:53:22.172Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","content":"  };\n}\n\n/**\n * Convert ClassifiedWeakness to Flaw type for UI compatibility\n */\nexport function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  const impact = (10 - classified.avgScore) * 0.5;\n  const newRollingLost = rollingLost + impact;\n\n  return {\n    id: `insight_flaw_${classified.insightId}`,\n    flawName: `${classified.title} (${classified.severityLabel})`,\n    summary: classified.description,\n    harmonyPercentageLost: impact,\n    standardizedImpact: impact / 10,\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n    rollingPointsDeducted: newRollingLost,\n    rollingHarmonyPercentageLost: newRollingLost,\n    rollingStandardizedImpact: newRollingLost / 10,\n  };\n}\n\n/**\n * Main function: Generate strengths and flaws from measurements using insights\n */\nexport function generateInsightBasedResults(\n  measurements: MetricScoreResult[]\n): { strengths: Strength[]; flaws: Flaw[] } {\n  const { strengths: classifiedStrengths, weaknesses: classifiedWeaknesses } = classifyInsights(measurements);\n\n  // Convert to UI-compatible types\n  const strengths = classifiedStrengths.map((s) => convertToStrength(s));\n\n  let rollingLost = 0;\n  const flaws = classifiedWeaknesses.map((w, i) => {\n    const flaw = convertToFlaw(w, i, rollingLost);\n    rollingLost = flaw.rollingPointsDeducted || 0;\n    return flaw;\n  });","numLines":50,"startLine":2675,"totalLines":2728}}}
{"parentUuid":"2b4fbe19-e4c7-4079-bb42-2e9c1110a036","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Lr4cYtoMZMyWbk6GFFHupn","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CFuYfMngyK92cN3xo6LBMK","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","old_string":"/**\n * Convert ClassifiedWeakness to Flaw type for UI compatibility\n */\nexport function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  const impact = (10 - classified.avgScore) * 0.5;\n  const newRollingLost = rollingLost + impact;\n\n  return {\n    id: `insight_flaw_${classified.insightId}`,\n    flawName: `${classified.title} (${classified.severityLabel})`,\n    summary: classified.description,\n    harmonyPercentageLost: impact,\n    standardizedImpact: impact / 10,\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n    rollingPointsDeducted: newRollingLost,\n    rollingHarmonyPercentageLost: newRollingLost,\n    rollingStandardizedImpact: newRollingLost / 10,\n  };\n}","new_string":"/**\n * Convert ClassifiedWeakness to Flaw type for UI compatibility\n */\nexport function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  const impact = (10 - classified.avgScore) * 0.5;\n  const newRollingLost = rollingLost + impact;\n\n  return {\n    id: `insight_flaw_${classified.insightId}`,\n    flawName: `${classified.title} (${classified.severityLabel})`,\n    summary: classified.description,\n    harmonyPercentageLost: impact,\n    standardizedImpact: impact / 10,\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n    rollingPointsDeducted: newRollingLost,\n    rollingHarmonyPercentageLost: newRollingLost,\n    rollingStandardizedImpact: newRollingLost / 10,\n    confidence: classified.confidence,\n  };\n}"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1016,"cache_read_input_tokens":88796,"cache_creation":{"ephemeral_5m_input_tokens":1016,"ephemeral_1h_input_tokens":0},"output_tokens":875,"service_tier":"standard"}},"requestId":"req_011CWVVKvySrAWAtXvJMMsM7","type":"assistant","uuid":"350f2242-b2e2-4834-bdb7-6b3d7fca301c","timestamp":"2025-12-26T14:53:33.955Z"}
{"parentUuid":"350f2242-b2e2-4834-bdb7-6b3d7fca301c","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CFuYfMngyK92cN3xo6LBMK","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  2674→    })),\n  2675→  };\n  2676→}\n  2677→\n  2678→/**\n  2679→ * Convert ClassifiedWeakness to Flaw type for UI compatibility\n  2680→ */\n  2681→export function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  2682→  const impact = (10 - classified.avgScore) * 0.5;\n  2683→  const newRollingLost = rollingLost + impact;\n  2684→\n  2685→  return {\n  2686→    id: `insight_flaw_${classified.insightId}`,\n  2687→    flawName: `${classified.title} (${classified.severityLabel})`,\n  2688→    summary: classified.description,\n  2689→    harmonyPercentageLost: impact,\n  2690→    standardizedImpact: impact / 10,\n  2691→    categoryName: classified.matchedMetrics[0]?.category || 'General',\n  2692→    responsibleRatios: classified.matchedMetrics.map(m => ({\n  2693→      ratioName: m.metricName,\n  2694→      ratioId: m.metricId,\n  2695→      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n  2696→      value: m.value,\n  2697→      idealMin: m.idealMin,\n  2698→      idealMax: m.idealMax,\n  2699→      unit: m.unit,\n  2700→      category: m.category,\n  2701→    })),\n  2702→    rollingPointsDeducted: newRollingLost,\n  2703→    rollingHarmonyPercentageLost: newRollingLost,\n  2704→    rollingStandardizedImpact: newRollingLost / 10,\n  2705→    confidence: classified.confidence,\n  2706→  };\n  2707→}\n  2708→\n  2709→/**\n  2710→ * Main function: Generate strengths and flaws from measurements using insights\n  2711→ */"}]},"uuid":"7e0d9270-e8b8-435a-9798-d77eef7019ec","timestamp":"2025-12-26T14:53:34.015Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","oldString":"/**\n * Convert ClassifiedWeakness to Flaw type for UI compatibility\n */\nexport function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  const impact = (10 - classified.avgScore) * 0.5;\n  const newRollingLost = rollingLost + impact;\n\n  return {\n    id: `insight_flaw_${classified.insightId}`,\n    flawName: `${classified.title} (${classified.severityLabel})`,\n    summary: classified.description,\n    harmonyPercentageLost: impact,\n    standardizedImpact: impact / 10,\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n    rollingPointsDeducted: newRollingLost,\n    rollingHarmonyPercentageLost: newRollingLost,\n    rollingStandardizedImpact: newRollingLost / 10,\n  };\n}","newString":"/**\n * Convert ClassifiedWeakness to Flaw type for UI compatibility\n */\nexport function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  const impact = (10 - classified.avgScore) * 0.5;\n  const newRollingLost = rollingLost + impact;\n\n  return {\n    id: `insight_flaw_${classified.insightId}`,\n    flawName: `${classified.title} (${classified.severityLabel})`,\n    summary: classified.description,\n    harmonyPercentageLost: impact,\n    standardizedImpact: impact / 10,\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n    rollingPointsDeducted: newRollingLost,\n    rollingHarmonyPercentageLost: newRollingLost,\n    rollingStandardizedImpact: newRollingLost / 10,\n    confidence: classified.confidence,\n  };\n}","originalFile":"/**\n * Insights Engine\n *\n * Processes insight definitions from insights.json and classifies them\n * as strengths or areas of improvement based on user's metric scores.\n *\n * Logic:\n * - For each insight definition, calculate average score of affected metrics\n * - Weakness: if avg score < threshold → classify with severity label\n * - Strength: if avg score > threshold → classify with grade label\n *\n * Z-Score Based 5-Tier Severity Logic:\n * - Ideal (Green): User is inside the ideal range\n * - Good (Blue): Within 0.5 Standard Deviation of the mean (|z| < 0.5)\n * - Fair (Cyan): Between 0.5 and 1 Standard Deviation (0.5 ≤ |z| < 1)\n * - Moderate (Yellow): Between 1 and 2 Standard Deviations (1 ≤ |z| < 2)\n * - Severe (Red): More than 2 Standard Deviations away (|z| ≥ 2)\n *\n * Severity Labels (Weaknesses):\n *   0-3 = \"Severe\"\n *   3-5 = \"Moderate\"\n *   5-7 = \"Minor\"\n *\n * Grade Labels (Strengths):\n *   8-9   = \"Good\"\n *   9-9.5 = \"Excellent\"\n *   9.5-10 = \"Ideal\"\n */\n\nimport { Strength, Flaw } from '@/types/results';\nimport { MetricScoreResult, METRIC_CONFIGS, isValueAcceptable, ConfidenceLevel } from '@/lib/harmony-scoring';\n\n// ============================================\n// MASTER SCORING DATABASE (Z-Score Based)\n// ============================================\n\nexport type SeverityLevel = 'ideal' | 'good' | 'fair' | 'moderate' | 'severe';\nexport type Gender = 'male' | 'female';\nexport type Ethnicity = 'white' | 'black' | 'east_asian' | 'south_asian' | 'hispanic' | 'middle_eastern' | 'native_american' | 'pacific_islander';\n\nexport interface MasterMetricConfig {\n  ideal: [number, number];  // [min, max] ideal range\n  mean: number;             // Population mean\n  std_dev: number;          // Standard deviation\n  flaws?: {\n    low?: string[];         // Flaws when value is too low\n    high?: string[];        // Flaws when value is too high\n  };\n}\n\n// Base/Default standards (White Male baseline)\nexport const MASTER_SCORING_DB: Record<string, MasterMetricConfig> = {\n  // MIDFACE & PROPORTIONS\n  \"midface_ratio\": {\n    ideal: [0.97, 1.00],\n    mean: 1.0,\n    std_dev: 0.115,\n    flaws: { low: [\"Long midface\", \"Long upper jaw\"] }\n  },\n  \"faceWidthToHeight\": {\n    ideal: [1.30, 1.45],\n    mean: 1.38,\n    std_dev: 0.08,\n    flaws: {\n      low: [\"Overly long face\", \"Narrow face\"],\n      high: [\"Wide face\", \"Short face\"]\n    }\n  },\n  \"totalFacialWidthToHeight\": {\n    ideal: [1.25, 1.40],\n    mean: 1.33,\n    std_dev: 0.075,\n    flaws: {\n      low: [\"Long face shape\"],\n      high: [\"Wide face shape\"]\n    }\n  },\n  \"upperThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short forehead\"],\n      high: [\"Long forehead\"]\n    }\n  },\n  \"middleThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short midface\"],\n      high: [\"Long midface\"]\n    }\n  },\n  \"lowerThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short lower face\"],\n      high: [\"Long lower face\"]\n    }\n  },\n\n  // EYE SPACING & IPD\n  \"eye_separation_ratio\": {\n    ideal: [0.45, 0.47],\n    mean: 0.46,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"interpupillaryRatio\": {\n    ideal: [0.44, 0.48],\n    mean: 0.46,\n    std_dev: 0.025,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"oneEyeApartTest\": {\n    ideal: [0.95, 1.05],\n    mean: 1.0,\n    std_dev: 0.08,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"intercanthalWidth\": {\n    ideal: [30, 35],\n    mean: 32.5,\n    std_dev: 2.5,\n    flaws: {\n      low: [\"Narrow eye spacing\"],\n      high: [\"Wide eye spacing\"]\n    }\n  },\n\n  // EYE SHAPE & FEATURES\n  \"lateralCanthalTilt\": {\n    ideal: [6, 8],\n    mean: 5.0,\n    std_dev: 3.5,\n    flaws: {\n      low: [\"Negative canthal tilt\", \"Downturned eyes\"],\n      high: [\"Excessively upturned eyes\"]\n    }\n  },\n  \"eyeAspectRatio\": {\n    ideal: [0.30, 0.35],\n    mean: 0.32,\n    std_dev: 0.04,\n    flaws: {\n      low: [\"Narrow eyes\"],\n      high: [\"Round eyes\"]\n    }\n  },\n  \"palpebralFissureLength\": {\n    ideal: [28, 32],\n    mean: 30.0,\n    std_dev: 2.5,\n    flaws: {\n      low: [\"Small eyes\"],\n      high: [\"Large eyes\"]\n    }\n  },\n  \"eyeWidth\": {\n    ideal: [28, 32],\n    mean: 30.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Narrow eyes\"],\n      high: [\"Wide eyes\"]\n    }\n  },\n  \"upperEyelidExposure\": {\n    ideal: [0.5, 1.2],\n    mean: 0.85,\n    std_dev: 0.35,\n    flaws: {\n      low: [\"Hooded eyes\"],\n      high: [\"Excessive upper lid exposure\"]\n    }\n  },\n  \"tearTroughDepth\": {\n    ideal: [0.0, 0.3],\n    mean: 0.15,\n    std_dev: 0.15,\n    flaws: {\n      high: [\"Dark circles / Tear troughs\", \"Under-eye hollowness\"]\n    }\n  },\n\n  // JAW ANGLES & STRUCTURE\n  \"gonial_angle\": {\n    ideal: [115, 125],\n    mean: 118.0,\n    std_dev: 6.5,\n    flaws: {\n      high: [\"Weak/soft jaw structure\", \"Rounded jaw\"]\n    }\n  },\n  \"mandibularPlaneAngle\": {\n    ideal: [20, 28],\n    mean: 24.0,\n    std_dev: 4.0,\n    flaws: {\n      low: [\"Flat mandibular plane\"],\n      high: [\"Steep mandibular plane\", \"Hyper-divergent jaw\"]\n    }\n  },\n  \"jawFrontalAngle\": {\n    ideal: [125, 135],\n    mean: 130.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Steep jaw\"],\n      high: [\"Flat jaw angle\"]\n    }\n  },\n  \"jawSlope\": {\n    ideal: [25, 35],\n    mean: 30.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat jawline\"],\n      high: [\"Steep jawline\"]\n    }\n  },\n\n  // JAW WIDTH\n  \"jawWidthRatio\": {\n    ideal: [0.85, 0.95],\n    mean: 0.90,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Narrow jaw\"],\n      high: [\"Wide jaw\"]\n    }\n  },\n  \"bigonialWidth\": {\n    ideal: [110, 125],\n    mean: 117.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow jaw width\"],\n      high: [\"Excessively wide jaw\"]\n    }\n  },\n\n  // CHEEKBONES\n  \"cheekbone_height\": {\n    ideal: [83.0, 100.0],\n    mean: 85.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Low-set cheekbones\", \"Flat midface\"]\n    }\n  },\n  \"cheekboneWidth\": {\n    ideal: [130, 145],\n    mean: 137.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow cheekbones\"],\n      high: [\"Wide cheekbones\"]\n    }\n  },\n\n  // CHIN\n  \"chinPhiltrumRatio\": {\n    ideal: [1.8, 2.2],\n    mean: 2.0,\n    std_dev: 0.2,\n    flaws: {\n      low: [\"Recessed chin\", \"Short chin\"],\n      high: [\"Long chin\", \"Projected chin\"]\n    }\n  },\n  \"chinHeight\": {\n    ideal: [35, 45],\n    mean: 40.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Short chin\"],\n      high: [\"Long chin\"]\n    }\n  },\n  \"chinWidth\": {\n    ideal: [35, 45],\n    mean: 40.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Pointed/Narrow chin\"],\n      high: [\"Wide chin\"]\n    }\n  },\n\n  // NOSE ANGLES\n  \"nasalTipAngle\": {\n    ideal: [95, 115],\n    mean: 105.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Droopy nasal tip\"],\n      high: [\"Upturned nasal tip\"]\n    }\n  },\n  \"nasolabialAngle\": {\n    ideal: [95, 110],\n    mean: 102.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Droopy nasal tip\"],\n      high: [\"Upturned nose\"]\n    }\n  },\n  \"nasofrontalAngle\": {\n    ideal: [115, 135],\n    mean: 125.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Deep nasal root\"],\n      high: [\"Flat nasal root\"]\n    }\n  },\n  \"nasofacialAngle\": {\n    ideal: [30, 40],\n    mean: 35.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat nose profile\"],\n      high: [\"Overprojected nose\"]\n    }\n  },\n  \"nasomentaAngle\": {\n    ideal: [120, 135],\n    mean: 127.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Convex profile\"],\n      high: [\"Concave profile\"]\n    }\n  },\n\n  // NOSE WIDTH & PROPORTIONS\n  \"nasalIndex\": {\n    ideal: [65, 75],\n    mean: 70.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Narrow nose\"],\n      high: [\"Wide nose\", \"Bulbous nose\"]\n    }\n  },\n  \"noseWidth\": {\n    ideal: [35, 42],\n    mean: 38.5,\n    std_dev: 3.5,\n    flaws: {\n      low: [\"Narrow nose\"],\n      high: [\"Wide nasal base\"]\n    }\n  },\n  \"noseBridgeWidth\": {\n    ideal: [12, 18],\n    mean: 15.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Narrow nose bridge\"],\n      high: [\"Wide nose bridge\"]\n    }\n  },\n  \"nasalProjection\": {\n    ideal: [16, 22],\n    mean: 19.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Underprojected nose\"],\n      high: [\"Overprojected nose\"]\n    }\n  },\n  \"noseLengthRatio\": {\n    ideal: [0.45, 0.55],\n    mean: 0.50,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Short nose\"],\n      high: [\"Long nose\"]\n    }\n  },\n\n  // LIPS & PHILTRUM\n  \"lipRatio\": {\n    ideal: [1.4, 1.6],\n    mean: 1.5,\n    std_dev: 0.15,\n    flaws: {\n      low: [\"Thin upper lip\"],\n      high: [\"Thick upper lip\"]\n    }\n  },\n  \"philtrumLength\": {\n    ideal: [11, 15],\n    mean: 13.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Short philtrum\"],\n      high: [\"Long philtrum\"]\n    }\n  },\n  \"upperLipHeight\": {\n    ideal: [18, 24],\n    mean: 21.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Thin upper lip\"],\n      high: [\"Thick upper lip\"]\n    }\n  },\n  \"lipChinDistance\": {\n    ideal: [40, 50],\n    mean: 45.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Short lower third\"],\n      high: [\"Long lower third\"]\n    }\n  },\n  \"upperLipProjection\": {\n    ideal: [-2, 2],\n    mean: 0.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Recessed upper lip\"],\n      high: [\"Protruding upper lip\"]\n    }\n  },\n  \"lowerLipProjection\": {\n    ideal: [-1, 3],\n    mean: 1.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Recessed lower lip\"],\n      high: [\"Protruding lower lip\"]\n    }\n  },\n  \"cupidsBowDepth\": {\n    ideal: [3, 6],\n    mean: 4.5,\n    std_dev: 1.5,\n    flaws: {\n      low: [\"Flat cupid's bow\"],\n      high: [\"Pronounced cupid's bow\"]\n    }\n  },\n\n  // EYEBROWS\n  \"eyebrowHeight\": {\n    ideal: [8, 14],\n    mean: 11.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Low-set eyebrows\"],\n      high: [\"High eyebrows\"]\n    }\n  },\n  \"browLengthRatio\": {\n    ideal: [0.50, 0.60],\n    mean: 0.55,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Short eyebrows\"],\n      high: [\"Long eyebrows\"]\n    }\n  },\n  \"browLengthToFaceWidth\": {\n    ideal: [0.30, 0.38],\n    mean: 0.34,\n    std_dev: 0.04,\n    flaws: {\n      low: [\"Short eyebrows\"],\n      high: [\"Long eyebrows\"]\n    }\n  },\n  \"browridgeInclinationAngle\": {\n    ideal: [10, 20],\n    mean: 15.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat brow ridge\"],\n      high: [\"Prominent brow ridge\"]\n    }\n  },\n  \"eyebrowThickness\": {\n    ideal: [1.5, 3.0],\n    mean: 2.25,\n    std_dev: 0.75,\n    flaws: {\n      low: [\"Sparse/Weak eyebrows\"],\n      high: [\"Overly thick eyebrows\"]\n    }\n  },\n\n  // FOREHEAD\n  \"foreheadHeight\": {\n    ideal: [55, 70],\n    mean: 62.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Short forehead\"],\n      high: [\"Tall forehead\"]\n    }\n  },\n  \"bitemporalWidth\": {\n    ideal: [120, 135],\n    mean: 127.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow forehead\"],\n      high: [\"Wide forehead\"]\n    }\n  },\n\n  // PROFILE & DEPTH\n  \"facialDepthToHeight\": {\n    ideal: [0.75, 0.85],\n    mean: 0.80,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Flat facial profile\"],\n      high: [\"Overprojected profile\"]\n    }\n  },\n  \"anteriorFacialDepth\": {\n    ideal: [115, 130],\n    mean: 122.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Shallow face depth\"],\n      high: [\"Deep face projection\"]\n    }\n  },\n  \"totalProfileAngle\": {\n    ideal: [165, 175],\n    mean: 170.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Convex profile\"],\n      high: [\"Concave profile\"]\n    }\n  },\n\n  // ASYMMETRY\n  \"facialAsymmetryIndex\": {\n    ideal: [0, 3],\n    mean: 2.0,\n    std_dev: 1.5,\n    flaws: {\n      high: [\"Facial asymmetry\"]\n    }\n  },\n  \"eyeAsymmetry\": {\n    ideal: [0, 2],\n    mean: 1.0,\n    std_dev: 1.0,\n    flaws: {\n      high: [\"Eye asymmetry\"]\n    }\n  },\n  \"jawAsymmetry\": {\n    ideal: [0, 3],\n    mean: 1.5,\n    std_dev: 1.5,\n    flaws: {\n      high: [\"Jaw asymmetry\"]\n    }\n  },\n\n  // OTHER\n  \"recessionFrankfort\": {\n    ideal: [-2, 2],\n    mean: 0.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Maxillary recession\"],\n      high: [\"Maxillary protrusion\"]\n    }\n  },\n  \"neckWidth\": {\n    ideal: [110, 130],\n    mean: 120.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Narrow neck\"],\n      high: [\"Wide neck\"]\n    }\n  },\n  \"neckToJawRatio\": {\n    ideal: [0.90, 1.10],\n    mean: 1.0,\n    std_dev: 0.10,\n    flaws: {\n      low: [\"Narrow neck\"],\n      high: [\"Thick neck\"]\n    }\n  }\n};\n\n// ============================================\n// ETHNICITY-SPECIFIC OVERRIDES\n// ============================================\n\n/**\n * Ethnicity and gender-specific metric standards\n * These override the base MASTER_SCORING_DB values for specific populations\n */\nexport const ETHNICITY_OVERRIDES: Record<string, Record<string, Partial<MasterMetricConfig>>> = {\n  // ========================================\n  // MALE WHITE STANDARDS (Neoclassical Baseline)\n  // ========================================\n  \"male_white\": {\n    // NOSE WIDTH - Strict 1:1 ratio (Eye Width = Nose Width)\n    \"noseWidth\": {\n      ideal: [35, 42],  // Corresponds to alar_base_ratio [0.98, 1.05]\n      mean: 38.5,\n      std_dev: 3.5,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // MIDFACE - Prefers compact midface (Hunter look)\n    \"midface_ratio\": {\n      ideal: [0.95, 1.02],\n      mean: 0.985,\n      std_dev: 0.035,\n      flaws: {\n        low: [\"Long midface\"]\n      }\n    },\n\n    // JAW - Square/Robust jaw preference\n    \"gonial_angle\": {\n      ideal: [115.0, 125.0],\n      mean: 120.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Weak/Soft jaw structure\"]\n      }\n    },\n\n    // FACE WIDTH - Standard Mesoprosopic range\n    \"faceWidthToHeight\": {\n      ideal: [1.90, 2.05],\n      mean: 1.975,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Short/Wide face\"]\n      }\n    },\n\n    // EYE TILT - Neutral to slightly positive\n    \"lateralCanthalTilt\": {\n      ideal: [4.0, 8.0],\n      mean: 6.0,\n      std_dev: 2.0,\n      flaws: {\n        low: [\"Negative canthal tilt\"]\n      }\n    },\n\n    // LOWER FACE BALANCE\n    \"chinPhiltrumRatio\": {\n      ideal: [2.10, 2.30],\n      mean: 2.20,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Long philtrum / Short chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE BLACK / AFRICAN STANDARDS\n  // ========================================\n  \"male_black\": {\n    // NOSE WIDTH - Significantly wider tolerance\n    \"noseWidth\": {\n      ideal: [40, 50],  // Wider range (corresponds to alar_base_ratio [1.12, 1.25])\n      mean: 45.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n    \"nasalIndex\": {\n      ideal: [80, 95],  // Wider nasal index\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        high: [\"Wide nose\"]\n      }\n    },\n\n    // LIPS - Prefers fuller lips\n    \"lipRatio\": {\n      ideal: [1.2, 1.5],\n      mean: 1.35,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    },\n\n    // PHILTRUM - Shorter visible philtrum is ideal\n    \"philtrumLength\": {\n      ideal: [11.0, 14.0],\n      mean: 12.5,\n      std_dev: 1.5,\n      flaws: {\n        high: [\"Long philtrum\"]\n      }\n    },\n\n    // CHIN - Adjusts for natural forward mouth projection (Prognathism)\n    \"chinPhiltrumRatio\": {\n      ideal: [1.80, 2.10],  // Lower range to account for prognathism\n      mean: 1.95,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Recessed chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE EAST ASIAN STANDARDS\n  // ========================================\n  \"male_east_asian\": {\n    // EYE SPACING - Shifted WIDER for East Asian males\n    \"eye_separation_ratio\": {\n      ideal: [0.48, 0.53],  // Shifted wider (0.46 is \"close-set\" here)\n      mean: 0.505,\n      std_dev: 0.025,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Wide-set eyes\"]\n      }\n    },\n    \"interpupillaryRatio\": {\n      ideal: [0.48, 0.53],\n      mean: 0.505,\n      std_dev: 0.025,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Wide-set eyes\"]\n      }\n    },\n\n    // EYE SHAPE - Prefers narrower/longer eyes (Hunter Eyes)\n    \"eyeAspectRatio\": {\n      ideal: [0.25, 0.29],  // Lower ratio = more elongated\n      mean: 0.27,\n      std_dev: 0.02,\n      flaws: {\n        low: [\"Overly narrow eyes\"],\n        high: [\"Overly round eye shape\"]\n      }\n    },\n    \"palpebralFissureLength\": {\n      ideal: [29, 33],\n      mean: 31.0,\n      std_dev: 2.0,\n      flaws: {\n        low: [\"Small eyes\"],\n        high: [\"Large eyes\"]\n      }\n    },\n\n    // NOSE - Asian noses typically allowed to be wider\n    \"nasalIndex\": {\n      ideal: [75, 85],\n      mean: 80.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nose\"]\n      }\n    },\n    \"noseWidth\": {\n      ideal: [38, 45],\n      mean: 41.5,\n      std_dev: 3.5,\n      flaws: {\n        low: [\"Narrow nose\"],\n        high: [\"Very wide nasal base\"]\n      }\n    },\n    \"noseBridgeWidth\": {\n      ideal: [14, 20],\n      mean: 17.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Narrow nose bridge\"],\n        high: [\"Wide nose bridge\"]\n      }\n    },\n\n    // CHEEKS - Rewards slightly fuller cheeks (Youth/K-Pop aesthetic)\n    \"cheekbone_height\": {\n      ideal: [80.0, 95.0],\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Gaunt/Hollow face\"]\n      }\n    },\n\n    // JAW - Slightly softer angles acceptable\n    \"gonial_angle\": {\n      ideal: [118, 128],\n      mean: 123.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Weak/soft jaw structure\"]\n      }\n    },\n    \"mandibularPlaneAngle\": {\n      ideal: [20, 30],\n      mean: 25.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Flat mandibular plane\"],\n        high: [\"Steep mandibular plane\"]\n      }\n    },\n\n    // FACIAL PROPORTIONS - Wider faces more common\n    \"faceWidthToHeight\": {\n      ideal: [1.35, 1.50],\n      mean: 1.425,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n    \"totalFacialWidthToHeight\": {\n      ideal: [1.30, 1.45],\n      mean: 1.375,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long face shape\"],\n        high: [\"Wide face shape\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE SOUTH ASIAN STANDARDS\n  // ========================================\n  \"male_south_asian\": {\n    // NOSE WIDTH - Slightly wider tolerance than White\n    \"noseWidth\": {\n      ideal: [36, 43],  // alar_base_ratio [1.00, 1.08]\n      mean: 39.5,\n      std_dev: 3.5,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // TEAR TROUGH - VERY STRICT. High penalty for dark circles\n    \"tearTroughDepth\": {\n      ideal: [0.0, 0.5],\n      mean: 0.25,\n      std_dev: 0.25,\n      flaws: {\n        high: [\"Dark circles / Tear troughs\"]\n      }\n    },\n\n    // UPPER EYELID - Often prefers visible lid platform\n    \"upperEyelidExposure\": {\n      ideal: [0.5, 2.0],\n      mean: 1.25,\n      std_dev: 0.75,\n      flaws: {\n        low: [\"Hooded eyes\"]\n      }\n    },\n\n    // CHEEKS - Penalizes \"Gaunt\" looks heavily\n    \"cheekbone_height\": {\n      ideal: [83.0, 95.0],\n      mean: 89.0,\n      std_dev: 6.0,\n      flaws: {\n        low: [\"Volume loss / Gauntness\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE HISPANIC STANDARDS (\"The Bridge Model\")\n  // ========================================\n  \"male_hispanic\": {\n    // FACE WIDTH - Rewards broader, more robust face shapes (Mestizo)\n    \"faceWidthToHeight\": {\n      ideal: [1.95, 2.10],\n      mean: 2.025,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long/Narrow face\"]\n      }\n    },\n\n    // NOSE WIDTH - Bridge tolerance (Wider than White, narrower than Black)\n    \"noseWidth\": {\n      ideal: [36, 44],  // alar_base_ratio [1.00, 1.12]\n      mean: 40.0,\n      std_dev: 4.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // EYE TILT - Strong preference for positive tilt\n    \"lateralCanthalTilt\": {\n      ideal: [6.0, 12.0],\n      mean: 9.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Negative/Neutral canthal tilt\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE MIDDLE EASTERN STANDARDS\n  // ========================================\n  \"male_middle_eastern\": {\n    // EYEBROW THICKNESS - Prefers significantly thicker/darker brows\n    \"eyebrowThickness\": {\n      ideal: [2.0, 4.0],\n      mean: 3.0,\n      std_dev: 1.0,\n      flaws: {\n        low: [\"Sparse/Weak eyebrows\"],\n        high: [\"Unibrow\"]\n      }\n    },\n\n    // NASOLABIAL ANGLE - Penalizes droopy tip (<90) or hooked noses\n    \"nasolabialAngle\": {\n      ideal: [90.0, 100.0],\n      mean: 95.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Droopy nose tip / Hooked nose\"]\n      }\n    },\n\n    // EYE TILT - Strong preference for Almond/Hunter eye shape\n    \"lateralCanthalTilt\": {\n      ideal: [4.0, 10.0],\n      mean: 7.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    },\n\n    // MIDFACE - Similar to White model (Compact is better)\n    \"midface_ratio\": {\n      ideal: [0.95, 1.02],\n      mean: 0.985,\n      std_dev: 0.035,\n      flaws: {\n        low: [\"Long midface\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE PACIFIC ISLANDER STANDARDS (\"The Warrior Skull\")\n  // ========================================\n  \"male_pacific_islander\": {\n    // FACE WIDTH - The Highest Width Standard (Very broad)\n    \"faceWidthToHeight\": {\n      ideal: [2.10, 2.30],\n      mean: 2.20,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Narrow/Long face\"]\n      }\n    },\n\n    // NOSE WIDTH - Wide tolerance\n    \"noseWidth\": {\n      ideal: [38, 48],  // alar_base_ratio [1.05, 1.20]\n      mean: 43.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // CHEEKS - Rewards high mass/robustness\n    \"cheekbone_height\": {\n      ideal: [85.0, 100.0],\n      mean: 92.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Gaunt/Weak face structure\"]\n      }\n    },\n\n    // CHIN WIDTH - Prefers a very broad, square chin\n    \"chinWidth\": {\n      ideal: [40.0, 50.0],\n      mean: 45.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Pointed/Narrow chin\"]\n      }\n    }\n  },\n\n  \"male_native_american\": {\n    \"faceWidthToHeight\": {\n      ideal: [2.00, 2.20],\n      mean: 2.10,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Wide face\"]\n      }\n    },\n\n    \"nasalIndex\": {\n      ideal: [75, 90],\n      mean: 82.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Narrow nose\"],\n        high: [\"Wide nose\"]\n      }\n    },\n\n    \"cheekbone_height\": {\n      ideal: [80.0, 95.0],\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Flat cheekbones\"]\n      }\n    },\n\n    \"gonialAngle\": {\n      ideal: [115, 125],\n      mean: 120,\n      std_dev: 5,\n      flaws: {\n        low: [\"Weak jaw\"],\n        high: [\"Harsh jaw angle\"]\n      }\n    },\n\n    \"chinWidth\": {\n      ideal: [38.0, 48.0],\n      mean: 43.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Narrow chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // FEMALE ETHNICITIES (The \"Missing Link\")\n  // ========================================\n\n  \"female_white\": {\n    // NOSE WIDTH - Strict Rule of Fifths for feminine harmony\n    \"alar_base_ratio\": {\n      ideal: [0.98, 1.05],\n      mean: 1.015,\n      std_dev: 0.035,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // FACE WIDTH - Prefers oval/narrow feminine proportions\n    \"fwhr\": {\n      ideal: [1.45, 1.53],\n      mean: 1.49,\n      std_dev: 0.04,\n      flaws: {\n        low: [\"Long/Narrow face\"],\n        high: [\"Wide face\"]\n      }\n    },\n\n    // JAW - Soft, tapered feminine jawline\n    \"gonial_angle\": {\n      ideal: [122.0, 130.0],\n      mean: 126.0,\n      std_dev: 4.0,\n      flaws: {\n        low: [\"Sharp/Masculine jaw angle\"],\n        high: [\"Weak/Overly soft jawline\"]\n      }\n    },\n\n    // EYE TILT - Neutral to positive preferred\n    \"canthal_tilt\": {\n      ideal: [4.0, 9.0],\n      mean: 6.5,\n      std_dev: 2.5,\n      flaws: {\n        low: [\"Negative/Downturned eyes\"]\n      }\n    },\n\n    // CHIN-PHILTRUM - Golden Ratio balance\n    \"chin_philtrum_ratio\": {\n      ideal: [2.0, 2.2],\n      mean: 2.1,\n      std_dev: 0.1,\n      flaws: {\n        low: [\"Recessed chin\"],\n        high: [\"Protruding chin\"]\n      }\n    }\n  },\n\n  \"female_black\": {\n    // LIPS - High volume preference (fuller lips)\n    \"lipRatio\": {\n      ideal: [1.3, 1.6],\n      mean: 1.45,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    },\n\n    // NOSE WIDTH - Wider tolerance for ethnic variation\n    \"alar_base_ratio\": {\n      ideal: [1.05, 1.15],\n      mean: 1.10,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Very wide nasal base\"]\n      }\n    },\n\n    // CHIN - Allows forward projection (natural prognathism)\n    \"chin_projection\": {\n      ideal: [0.0, 5.0],\n      mean: 2.5,\n      std_dev: 2.5,\n      flaws: {\n        high: [\"Excessive chin projection\"]\n      }\n    },\n\n    // JAW - Soft feminine jawline\n    \"gonial_angle\": {\n      ideal: [120.0, 130.0],\n      mean: 125.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Sharp jaw angle\"],\n        high: [\"Weak jawline\"]\n      }\n    }\n  },\n\n  \"female_east_asian\": {\n    // EYE SPACING - Wide-set neotenous preference\n    \"eye_separation_ratio\": {\n      ideal: [46.3, 47.5],\n      mean: 46.9,\n      std_dev: 0.6,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Very wide-set eyes\"]\n      }\n    },\n\n    // JAW - Tapered V-shape feminine ideal\n    \"gonial_angle\": {\n      ideal: [120.0, 126.0],\n      mean: 123.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Sharp V-line jaw\"],\n        high: [\"Weak/Square jawline\"]\n      }\n    },\n\n    // EYEBROWS - Higher set brows (youthful feminine)\n    \"eyebrow_height\": {\n      ideal: [0.85, 1.30],\n      mean: 1.075,\n      std_dev: 0.225,\n      flaws: {\n        low: [\"Low-set/Heavy brows\"],\n        high: [\"Very high-arched brows\"]\n      }\n    },\n\n    // LOWER FACE - Compact lower third (neotenous)\n    \"lower_third_ratio\": {\n      ideal: [29.6, 32.7],\n      mean: 31.15,\n      std_dev: 1.55,\n      flaws: {\n        low: [\"Very short lower face\"],\n        high: [\"Long lower face\"]\n      }\n    }\n  },\n\n  \"female_south_asian\": {\n    // TEAR TROUGHS - Very strict on dark circles\n    \"tear_trough_depth\": {\n      ideal: [0.0, 0.5],\n      mean: 0.25,\n      std_dev: 0.25,\n      flaws: {\n        high: [\"Dark circles / Deep tear troughs\"]\n      }\n    },\n\n    // CHEEKS - Rewards midface volume (youthful fullness)\n    \"cheek_fullness\": {\n      ideal: [1.0, 2.0],\n      mean: 1.5,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Gaunt/Hollow cheeks\"]\n      }\n    },\n\n    // SKIN - High penalty for uneven skin tone\n    \"skin_uniformity\": {\n      ideal: [0.92, 1.0],\n      mean: 0.96,\n      std_dev: 0.04,\n      flaws: {\n        low: [\"Uneven skin tone / Pigmentation\"]\n      }\n    },\n\n    // NOSE WIDTH - Intermediate tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.00, 1.08],\n      mean: 1.04,\n      std_dev: 0.04,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    }\n  },\n\n  \"female_hispanic\": {\n    // FACE WIDTH - Broader Mestiza tolerance\n    \"fwhr\": {\n      ideal: [1.50, 1.62],\n      mean: 1.56,\n      std_dev: 0.06,\n      flaws: {\n        low: [\"Long/Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // EYE TILT - Strong almond eye preference\n    \"canthal_tilt\": {\n      ideal: [6.0, 12.0],\n      mean: 9.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Neutral/Downturned eyes\"]\n      }\n    },\n\n    // NOSE WIDTH - Intermediate width tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.00, 1.10],\n      mean: 1.05,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // LIPS - Voluptuous preference\n    \"lipRatio\": {\n      ideal: [1.1, 1.35],\n      mean: 1.225,\n      std_dev: 0.125,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    }\n  },\n\n  \"female_middle_eastern\": {\n    // EYEBROWS - Dense/Thick brows preference\n    \"eyebrow_thickness\": {\n      ideal: [1.5, 3.0],\n      mean: 2.25,\n      std_dev: 0.75,\n      flaws: {\n        low: [\"Sparse/Thin eyebrows\"],\n        high: [\"Unibrow\"]\n      }\n    },\n\n    // NOSE - Refined/Upturned tip\n    \"nasolabial_angle\": {\n      ideal: [95.0, 105.0],\n      mean: 100.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Droopy nose tip\"],\n        high: [\"Overly upturned nose\"]\n      }\n    },\n\n    // EYE TILT - Foxy/Hunter feminine eye shape\n    \"canthal_tilt\": {\n      ideal: [5.0, 10.0],\n      mean: 7.5,\n      std_dev: 2.5,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    },\n\n    // EYELID - Low exposure preferred\n    \"upper_eyelid_exposure\": {\n      ideal: [0.5, 1.5],\n      mean: 1.0,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Hooded eyes\"],\n        high: [\"Excessive eyelid exposure\"]\n      }\n    }\n  },\n\n  \"female_native_american\": {\n    // FACE WIDTH - Wide/High cheekbone structure\n    \"fwhr\": {\n      ideal: [1.52, 1.65],\n      mean: 1.585,\n      std_dev: 0.065,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // CHEEKBONES - High definition/prominence\n    \"cheekbone_prominence\": {\n      ideal: [1.5, 2.5],\n      mean: 2.0,\n      std_dev: 0.5,\n      flaws: {\n        low: [\"Flat cheekbones\"],\n        high: [\"Overly prominent cheekbones\"]\n      }\n    },\n\n    // JAW - Stronger jaw tolerance\n    \"gonial_angle\": {\n      ideal: [115.0, 125.0],\n      mean: 120.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Very sharp jaw\"],\n        high: [\"Weak jawline\"]\n      }\n    },\n\n    // EYE TILT - Positive tilt preference\n    \"canthal_tilt\": {\n      ideal: [5.0, 11.0],\n      mean: 8.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    }\n  },\n\n  \"female_pacific_islander\": {\n    // FACE WIDTH - Widest/Robust facial structure\n    \"fwhr\": {\n      ideal: [1.55, 1.70],\n      mean: 1.625,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n\n    // CHEEKS - High volume/softness preference\n    \"cheek_fullness\": {\n      ideal: [1.2, 2.5],\n      mean: 1.85,\n      std_dev: 0.65,\n      flaws: {\n        low: [\"Gaunt/Hollow cheeks\"]\n      }\n    },\n\n    // NOSE WIDTH - Wide nose tolerance\n    \"alar_base_ratio\": {\n      ideal: [1.05, 1.15],\n      mean: 1.10,\n      std_dev: 0.05,\n      flaws: {\n        high: [\"Very wide nasal base\"]\n      }\n    },\n\n    // LIPS - Full lips preference\n    \"lipRatio\": {\n      ideal: [1.25, 1.50],\n      mean: 1.375,\n      std_dev: 0.125,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    }\n  }\n};\n\n/**\n * Get the appropriate metric configuration for a given gender and ethnicity\n * Falls back to base config if no override exists\n */\nexport function getMetricConfig(\n  metricId: string,\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'white'\n): MasterMetricConfig | undefined {\n  const key = `${gender}_${ethnicity}`;\n  const override = ETHNICITY_OVERRIDES[key]?.[metricId];\n  const baseConfig = MASTER_SCORING_DB[metricId];\n\n  if (!baseConfig) return undefined;\n\n  // Merge override with base config\n  if (override) {\n    return {\n      ...baseConfig,\n      ...override,\n      flaws: {\n        ...baseConfig.flaws,\n        ...override.flaws\n      }\n    } as MasterMetricConfig;\n  }\n\n  return baseConfig;\n}\n\n// ============================================\n// Z-SCORE SEVERITY FUNCTIONS\n// ============================================\n\n/**\n * Calculate Z-score for a given value\n * Z = (value - mean) / std_dev\n */\nexport function calculateZScore(value: number, mean: number, stdDev: number): number {\n  if (stdDev === 0) return 0;\n  return Math.abs((value - mean) / stdDev);\n}\n\n/**\n * Determine severity level based on Z-score and ideal range (5-tier system)\n * - Ideal: Value is within ideal range\n * - Good: |z| < 0.5 (within 0.5 standard deviation)\n * - Fair: 0.5 ≤ |z| < 1 (between 0.5-1 standard deviations)\n * - Moderate: 1 ≤ |z| < 2 (between 1-2 standard deviations)\n * - Severe: |z| ≥ 2 (more than 2 standard deviations away)\n */\nexport function getSeverityFromZScore(\n  value: number,\n  config: MasterMetricConfig\n): { severity: SeverityLevel; zScore: number; isInIdeal: boolean } {\n  const { ideal, mean, std_dev } = config;\n  const isInIdeal = value >= ideal[0] && value <= ideal[1];\n  const zScore = calculateZScore(value, mean, std_dev);\n\n  let severity: SeverityLevel;\n  if (isInIdeal) {\n    severity = 'ideal';\n  } else if (zScore < 0.5) {\n    severity = 'good';\n  } else if (zScore < 1) {\n    severity = 'fair';\n  } else if (zScore < 2) {\n    severity = 'moderate';\n  } else {\n    severity = 'severe';\n  }\n\n  return { severity, zScore, isInIdeal };\n}\n\n/**\n * Get severity for a metric value with ethnicity/gender awareness\n */\nexport function getSeverityForMetric(\n  metricId: string,\n  value: number,\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'white'\n): { severity: SeverityLevel; zScore: number; isInIdeal: boolean; config: MasterMetricConfig } | null {\n  const config = getMetricConfig(metricId, gender, ethnicity);\n  if (!config) return null;\n\n  const result = getSeverityFromZScore(value, config);\n  return { ...result, config };\n}\n\n/**\n * Get badge color for severity level (5-tier)\n */\nexport function getSeverityColor(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'green';\n    case 'good': return 'blue';\n    case 'fair': return 'cyan';\n    case 'moderate': return 'yellow';\n    case 'severe': return 'red';\n    default: return 'gray';\n  }\n}\n\n/**\n * Get severity label for display (5-tier)\n */\nexport function getSeverityLabel(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'Ideal';\n    case 'good': return 'Good';\n    case 'fair': return 'Fair';\n    case 'moderate': return 'Moderate';\n    case 'severe': return 'Severe';\n    default: return 'Unknown';\n  }\n}\n\n// ============================================\n// CONFIDENCE CALCULATION (Z-Score Based)\n// ============================================\n\n/**\n * Calculate confidence level for flaw detection based on Z-score magnitude.\n *\n * Logic from FaceIQ:\n * - confirmed: |z| >= 2 (high statistical certainty - 2+ standard deviations)\n * - likely: 1 <= |z| < 2 (moderate certainty - 1-2 standard deviations)\n * - possible: 0.5 <= |z| < 1 (low certainty - 0.5-1 standard deviation)\n *\n * For metrics without Z-score data, we calculate confidence from the score:\n * Score 0-3 = confirmed (very poor score = high confidence it's a flaw)\n * Score 3-5 = likely (poor score = moderate confidence)\n * Score 5-7 = possible (below average = low confidence)\n *\n * @param zScore - The absolute Z-score value\n * @returns ConfidenceLevel - 'confirmed' | 'likely' | 'possible'\n */\nexport function calculateConfidenceFromZScore(zScore: number): ConfidenceLevel {\n  if (zScore >= 2) return 'confirmed';\n  if (zScore >= 1) return 'likely';\n  return 'possible';\n}\n\n/**\n * Calculate confidence level from score when Z-score is unavailable.\n * Maps score ranges to confidence levels inversely (lower score = higher confidence).\n *\n * @param avgScore - Average score of the flaw (0-10 scale)\n * @returns ConfidenceLevel\n */\nexport function calculateConfidenceFromScore(avgScore: number): ConfidenceLevel {\n  // Very low scores = high confidence it's a real flaw\n  if (avgScore <= 3) return 'confirmed';\n  // Poor scores = moderate confidence\n  if (avgScore <= 5) return 'likely';\n  // Below average scores = low confidence\n  return 'possible';\n}\n\n/**\n * Calculate confidence for a set of matched metrics.\n * Uses Z-score when available, falls back to score-based calculation.\n *\n * @param matchedMetrics - Array of metrics contributing to the flaw\n * @param avgScore - Overall average score of the flaw\n * @returns ConfidenceLevel\n */\nexport function calculateFlawConfidence(\n  matchedMetrics: MatchedMetric[],\n  avgScore: number\n): ConfidenceLevel {\n  // Calculate Z-scores for each metric if we have the config\n  const zScores: number[] = [];\n\n  for (const metric of matchedMetrics) {\n    const config = MASTER_SCORING_DB[metric.metricId];\n    if (config && config.std_dev > 0) {\n      const zScore = calculateZScore(metric.value, config.mean, config.std_dev);\n      zScores.push(zScore);\n    }\n  }\n\n  // If we have Z-scores, use the maximum (highest deviation = highest confidence)\n  if (zScores.length > 0) {\n    const maxZScore = Math.max(...zScores);\n    return calculateConfidenceFromZScore(maxZScore);\n  }\n\n  // Fall back to score-based confidence\n  return calculateConfidenceFromScore(avgScore);\n}\n\n// ============================================\n// INSIGHT DEFINITION TYPES\n// ============================================\n\nexport interface InsightSeverityLogic {\n  metrics: string[];  // Display names of metrics (e.g., \"Face Width to Height Ratio\")\n  threshold: number;  // Score threshold for classification\n}\n\nexport interface WeaknessSeverityLabels {\n  minor: string;\n  moderate: string;\n  severe: string;\n}\n\nexport interface StrengthGradeLabels {\n  good: string;\n  excellent: string;\n  ideal: string;\n}\n\nexport interface InsightContent {\n  description: string;\n  severity_labels?: WeaknessSeverityLabels;  // For weaknesses\n  grade_labels?: StrengthGradeLabels;        // For strengths\n}\n\nexport interface InsightDefinition {\n  id: string;\n  title: string;\n  type: 'weakness' | 'strength';\n  severity_logic: InsightSeverityLogic;\n  content: InsightContent;\n}\n\n// ============================================\n// CLASSIFICATION RESULT TYPES\n// ============================================\n\nexport type WeaknessSeverity = 'severe' | 'moderate' | 'minor';\nexport type StrengthGrade = 'ideal' | 'excellent' | 'good';\n\nexport interface ClassifiedWeakness {\n  insightId: string;\n  title: string;\n  description: string;\n  severity: WeaknessSeverity;\n  severityLabel: string;  // Custom label from definition (e.g., \"Extremely Long\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n  /**\n   * Confidence level based on Z-score magnitude:\n   * - confirmed: |z| >= 2 (high statistical certainty, 2+ SDs from mean)\n   * - likely: 1 <= |z| < 2 (moderate certainty)\n   * - possible: 0.5 <= |z| < 1 (low certainty)\n   */\n  confidence: ConfidenceLevel;\n}\n\nexport interface ClassifiedStrength {\n  insightId: string;\n  title: string;\n  description: string;\n  grade: StrengthGrade;\n  gradeLabel: string;  // Custom label from definition (e.g., \"Ideal\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n}\n\nexport interface MatchedMetric {\n  metricId: string;\n  metricName: string;\n  score: number;\n  value: number;\n  idealMin: number;\n  idealMax: number;\n  unit: string;\n  category: string;\n}\n\nexport interface InsightClassificationResult {\n  strengths: ClassifiedStrength[];\n  weaknesses: ClassifiedWeakness[];\n}\n\n// ============================================\n// INSIGHTS DATABASE\n// ============================================\n\nexport const INSIGHTS_DEFINITIONS: InsightDefinition[] = [\n  {\n    id: \"long_midface\",\n    title: \"Long Midface\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\", \"Ipsilateral Alar Angle\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The middle of the face is elongated, creating an unbalanced vertical proportion.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Extremely Long\" }\n    }\n  },\n  {\n    id: \"short_midface\",\n    title: \"Short Midface\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The midface has ideal vertical proportions, contributing to facial harmony.\",\n      grade_labels: { good: \"Proportionate\", excellent: \"Well-Balanced\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"weak_jaw\",\n    title: \"Weak/Soft Jaw Structure\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Chin to Philtrum Ratio\", \"Jaw Slope\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The jaw has a softer, rounder shape, often less angular and robust than the ideal.\",\n      severity_labels: { minor: \"Soft\", moderate: \"Recessed\", severe: \"Weak\" }\n    }\n  },\n  {\n    id: \"strong_jaw\",\n    title: \"Strong Jaw Definition\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Jaw Width Ratio\", \"Bigonial Width\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The jaw displays strong definition with well-defined angles and proportionate width.\",\n      grade_labels: { good: \"Defined\", excellent: \"Strong\", ideal: \"Ideal Angular\" }\n    }\n  },\n  {\n    id: \"refined_nasal_tip\",\n    title: \"Refined Nasal Tip\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasal Tip Angle\", \"Nose Tip Position\", \"Frankfort-tip Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious nasal profile due to the nasal tip being well-defined and proportionate.\",\n      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"bulbous_nose\",\n    title: \"Bulbous Nasal Tip\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Index\", \"Nose Width\", \"Nasal Tip Angle\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nasal tip appears rounded and less defined, affecting nasal aesthetics.\",\n      severity_labels: { minor: \"Slightly Rounded\", moderate: \"Rounded\", severe: \"Bulbous\" }\n    }\n  },\n  {\n    id: \"ideal_upper_lip\",\n    title: \"Well-Positioned Upper Lip\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Upper Lip E-Line Position\", \"Upper Lip S-Line Position\", \"Nasolabial Angle\"],\n      threshold: 9.0\n    },\n    content: {\n      description: \"This contributes to a harmonious mouth region due to the upper lip sitting neither too far forward nor too far back.\",\n      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"negative_canthal_tilt\",\n    title: \"Negative Canthal Tilt\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The outer corners of the eyes sit lower than the inner corners, creating a downturned appearance.\",\n      severity_labels: { minor: \"Slight Downturn\", moderate: \"Noticeable\", severe: \"Pronounced\" }\n    }\n  },\n  {\n    id: \"positive_canthal_tilt\",\n    title: \"Positive Canthal Tilt\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The outer corners of the eyes are elevated, creating an attractive upswept eye shape.\",\n      grade_labels: { good: \"Slight Upturn\", excellent: \"Well-Tilted\", ideal: \"Hunter Eyes\" }\n    }\n  },\n  {\n    id: \"balanced_facial_thirds\",\n    title: \"Balanced Facial Thirds\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face displays well-balanced vertical proportions across all three facial thirds.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfectly Proportioned\" }\n    }\n  },\n  {\n    id: \"imbalanced_thirds\",\n    title: \"Facial Third Imbalance\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The vertical face proportions show imbalance between the three facial thirds.\",\n      severity_labels: { minor: \"Slight Imbalance\", moderate: \"Noticeable Disproportion\", severe: \"Significant Imbalance\" }\n    }\n  },\n  {\n    id: \"high_cheekbones\",\n    title: \"High Cheekbones\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Cheekbone Height\", \"Cheekbone Width\", \"Midface Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"Well-positioned cheekbones that create attractive facial contours and catch light beautifully.\",\n      grade_labels: { good: \"Visible\", excellent: \"Prominent\", ideal: \"Model-Tier\" }\n    }\n  },\n  {\n    id: \"flat_midface\",\n    title: \"Flat Midface\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Cheekbone Height\", \"Midface Ratio\", \"Total Facial Width to Height\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The midface lacks forward projection, resulting in flatter facial contours.\",\n      severity_labels: { minor: \"Slightly Flat\", moderate: \"Underprojected\", severe: \"Recessed\" }\n    }\n  },\n  {\n    id: \"ideal_lip_ratio\",\n    title: \"Ideal Lip Proportions\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Lip Ratio\", \"Philtrum Length\", \"Lip Chin Distance\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The lips demonstrate excellent proportions with balanced upper-to-lower lip ratio.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Well-Proportioned\", ideal: \"Perfect Ratio\" }\n    }\n  },\n  {\n    id: \"thin_lips\",\n    title: \"Thin Lip Profile\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Lip Ratio\", \"Upper Lip Projection\", \"Lower Lip Projection\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The lips appear thinner than ideal proportions, affecting lower face harmony.\",\n      severity_labels: { minor: \"Slightly Thin\", moderate: \"Thin\", severe: \"Very Thin\" }\n    }\n  },\n  {\n    id: \"ideal_ipd\",\n    title: \"Ideal Eye Spacing\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The eyes are ideally spaced, creating facial balance and attractiveness.\",\n      grade_labels: { good: \"Good Spacing\", excellent: \"Ideal Distance\", ideal: \"Perfect IPD\" }\n    }\n  },\n  {\n    id: \"wide_set_eyes\",\n    title: \"Wide-Set Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes are spaced wider apart than the aesthetic ideal.\",\n      severity_labels: { minor: \"Slightly Wide\", moderate: \"Noticeably Wide\", severe: \"Very Wide\" }\n    }\n  },\n  {\n    id: \"close_set_eyes\",\n    title: \"Close-Set Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"Intercanthal Width\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes are positioned closer together than the aesthetic ideal.\",\n      severity_labels: { minor: \"Slightly Close\", moderate: \"Noticeably Close\", severe: \"Very Close\" }\n    }\n  },\n  {\n    id: \"ideal_nose_projection\",\n    title: \"Ideal Nasal Projection\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasofrontal Angle\", \"Nasofacial Angle\", \"Nasomenta Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The nose has ideal forward projection relative to the face, creating profile harmony.\",\n      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect Projection\" }\n    }\n  },\n  {\n    id: \"recessed_chin\",\n    title: \"Recessed Chin\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Facial Depth to Height\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The chin sits behind the ideal position, affecting profile balance.\",\n      severity_labels: { minor: \"Slightly Recessed\", moderate: \"Recessed\", severe: \"Severely Recessed\" }\n    }\n  },\n  {\n    id: \"ideal_chin_projection\",\n    title: \"Ideal Chin Projection\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Anterior Facial Depth\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The chin demonstrates ideal projection and proportions relative to the face.\",\n      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect\" }\n    }\n  },\n  {\n    id: \"long_philtrum\",\n    title: \"Long Philtrum\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Philtrum Length\", \"Lip Chin Distance\", \"Upper Lip Height\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The distance between nose and upper lip is longer than ideal.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n    }\n  },\n  {\n    id: \"short_philtrum\",\n    title: \"Short Philtrum\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Philtrum Length\", \"Upper Lip Height\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The philtrum has ideal or shorter length, considered youthful and attractive.\",\n      grade_labels: { good: \"Good Length\", excellent: \"Short\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"wide_nose\",\n    title: \"Wide Nasal Base\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Index\", \"Intercanthal Nasal Ratio\", \"Nose Bridge Width\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The base of the nose is wider than the aesthetic ideal for facial harmony.\",\n      severity_labels: { minor: \"Slightly Wide\", moderate: \"Wide\", severe: \"Very Wide\" }\n    }\n  },\n  {\n    id: \"ideal_brow_position\",\n    title: \"Ideal Brow Position\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Eyebrow Height\", \"Brow Length Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The eyebrows are ideally positioned relative to the eyes and facial structure.\",\n      grade_labels: { good: \"Good Position\", excellent: \"Well-Arched\", ideal: \"Perfect Frame\" }\n    }\n  },\n  {\n    id: \"narrow_jaw\",\n    title: \"Narrow Jaw\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Jaw Width Ratio\", \"Bigonial Width\", \"Jaw Frontal Angle\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The jaw is narrower than ideal, affecting lower face width and definition.\",\n      severity_labels: { minor: \"Slightly Narrow\", moderate: \"Narrow\", severe: \"Very Narrow\" }\n    }\n  },\n  {\n    id: \"steep_mandibular_plane\",\n    title: \"Steep Mandibular Plane\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The mandibular plane angle is steeper than ideal, often indicating vertical growth pattern.\",\n      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n    }\n  },\n  // ============================================\n  // INSIGHT DEFINITIONS (element.html / element1.html)\n  // ============================================\n  // --- WEAKNESSES ---\n  {\n    id: \"steep_jaw\",\n    title: \"Steep Jaw\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Jaw Frontal Angle\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The jaw angles sharply downward, creating a narrow or pointed chin effect.\",\n      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n    }\n  },\n  {\n    id: \"maxillary_recession\",\n    title: \"Maxillary Recession\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Facial Depth to Height Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The upper jaw is less forward than ideal, reducing midface projection and facial harmony.\",\n      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n    }\n  },\n  {\n    id: \"mandibular_recession\",\n    title: \"Mandibular Recession\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The lower jaw is set back, creating a less prominent chin and an unbalanced profile.\",\n      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n    }\n  },\n  {\n    id: \"underprojected_chin\",\n    title: \"Underprojected Chin\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\", \"Chin Height\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The chin lacks forward projection, creating a weak lower face appearance.\",\n      severity_labels: { minor: \"Slightly Weak\", moderate: \"Underprojected\", severe: \"Severely Underprojected\" }\n    }\n  },\n  {\n    id: \"overly_long_face\",\n    title: \"Overly Long Face Shape\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Total Facial Width to Height Ratio\", \"Face Width to Height Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The face is excessively tall and narrow, creating an elongated appearance.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n    }\n  },\n  {\n    id: \"hyper_divergent_jaw\",\n    title: \"Hyper-Divergent Jaw Growth\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The jaw grows with an overly steep angle, resulting in a long or narrow lower face. This can indicate malocclusion.\",\n      severity_labels: { minor: \"Mildly Divergent\", moderate: \"Divergent\", severe: \"Hyper-Divergent\" }\n    }\n  },\n  {\n    id: \"weak_brow_ridge\",\n    title: \"Soft/Weak Brow Ridge\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Browridge Inclination Angle\", \"Eyebrow Height\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The forehead has a softer, less prominent ridge than the ideal, reducing masculine definition.\",\n      severity_labels: { minor: \"Slightly Soft\", moderate: \"Soft\", severe: \"Very Weak\" }\n    }\n  },\n  {\n    id: \"droopy_nasal_tip\",\n    title: \"Droopy Nasal Tip\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\", \"Nasofacial Angle\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nasal tip points downward more than ideal, creating a drooping appearance.\",\n      severity_labels: { minor: \"Slightly Droopy\", moderate: \"Droopy\", severe: \"Very Droopy\" }\n    }\n  },\n  {\n    id: \"overprojected_nose\",\n    title: \"Overprojected Nose\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Projection\", \"Nasofacial Angle\", \"Nose Length Ratio\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nose projects too far forward relative to the face, creating imbalance.\",\n      severity_labels: { minor: \"Slightly Projected\", moderate: \"Overprojected\", severe: \"Very Overprojected\" }\n    }\n  },\n  {\n    id: \"small_eyes\",\n    title: \"Small Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Eye Aspect Ratio\", \"Palpebral Fissure Length\", \"Eye Width\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes appear smaller than the aesthetic ideal relative to the face.\",\n      severity_labels: { minor: \"Slightly Small\", moderate: \"Small\", severe: \"Very Small\" }\n    }\n  },\n  {\n    id: \"low_set_eyebrows\",\n    title: \"Low-Set Eyebrows\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Eyebrow Height\", \"Brow to Hairline Distance\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyebrows sit lower than ideal, reducing the visible upper eyelid space.\",\n      severity_labels: { minor: \"Slightly Low\", moderate: \"Low\", severe: \"Very Low\" }\n    }\n  },\n  {\n    id: \"asymmetrical_face\",\n    title: \"Facial Asymmetry\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The left and right sides of the face show noticeable differences in proportion or position.\",\n      severity_labels: { minor: \"Slight Asymmetry\", moderate: \"Noticeable Asymmetry\", severe: \"Significant Asymmetry\" }\n    }\n  },\n  // --- STRENGTHS ---\n  {\n    id: \"good_jaw_width\",\n    title: \"Good Jaw Width\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Bigonial Width\", \"Jaw Width Ratio\", \"Jaw Frontal Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a pleasant jaw contour due to the jaw being neither too wide nor too narrow.\",\n      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n    }\n  },\n  {\n    id: \"good_forehead_slope\",\n    title: \"Good Forehead Slope\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Browridge Inclination Angle\", \"Forehead Height\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a pleasant forehead contour by indicating that the forehead is neither too steep nor too flat.\",\n      grade_labels: { good: \"Good Slope\", excellent: \"Well-Angled\", ideal: \"Ideal Slope\" }\n    }\n  },\n  {\n    id: \"good_cupids_bow\",\n    title: \"Good Cupid's Bow Depth\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Cupids Bow Depth\", \"Upper Lip Height\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious lip region due to the cupid's bow having ideal definition and depth.\",\n      grade_labels: { good: \"Defined\", excellent: \"Well-Defined\", ideal: \"Perfectly Defined\" }\n    }\n  },\n  {\n    id: \"good_eyebrow_length\",\n    title: \"Good Eyebrow Length\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Brow Length to Face Width Ratio\", \"Brow Length Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious eye region due to the eyebrows having ideal horizontal length relative to face width.\",\n      grade_labels: { good: \"Good Length\", excellent: \"Well-Proportioned\", ideal: \"Ideal Length\" }\n    }\n  },\n  {\n    id: \"good_neck_width\",\n    title: \"Good Neck Width\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Neck Width\", \"Neck to Jaw Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious lower face due to the neck being neither too wide nor too thin.\",\n      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n    }\n  },\n  {\n    id: \"ideal_nasolabial_angle\",\n    title: \"Ideal Nasolabial Angle\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The angle between nose and upper lip is in the ideal range, creating profile harmony.\",\n      grade_labels: { good: \"Good Angle\", excellent: \"Well-Angled\", ideal: \"Perfect Angle\" }\n    }\n  },\n  {\n    id: \"ideal_facial_depth\",\n    title: \"Ideal Facial Depth\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Facial Depth to Height Ratio\", \"Anterior Facial Depth\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face has ideal forward projection creating attractive three-dimensional contours.\",\n      grade_labels: { good: \"Good Depth\", excellent: \"Well-Projected\", ideal: \"Ideal Projection\" }\n    }\n  },\n  {\n    id: \"ideal_eye_shape\",\n    title: \"Ideal Eye Shape\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Eye Aspect Ratio\", \"Lateral Canthal Tilt\", \"Palpebral Fissure Length\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The eyes have an attractive almond shape with ideal proportions and tilt.\",\n      grade_labels: { good: \"Attractive\", excellent: \"Well-Shaped\", ideal: \"Hunter Eyes\" }\n    }\n  },\n  {\n    id: \"harmonious_profile\",\n    title: \"Harmonious Profile\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Total Profile Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The facial profile shows excellent balance between nose, lips, and chin positions.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfect Profile\" }\n    }\n  },\n  {\n    id: \"good_facial_symmetry\",\n    title: \"Good Facial Symmetry\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face displays excellent bilateral symmetry, a key component of attractiveness.\",\n      grade_labels: { good: \"Symmetric\", excellent: \"Very Symmetric\", ideal: \"Near-Perfect Symmetry\" }\n    }\n  }\n];\n\n// ============================================\n// METRIC NAME MAPPING\n// ============================================\n\n// Map display names to metric IDs for lookup\nconst METRIC_NAME_TO_ID: Record<string, string> = {\n  // Face Shape/Proportions\n  \"Face Width to Height Ratio\": \"faceWidthToHeight\",\n  \"Total Facial Width to Height\": \"totalFacialWidthToHeight\",\n  \"Total Facial Width to Height Ratio\": \"totalFacialWidthToHeight\",\n  \"Midface Ratio\": \"midfaceRatio\",\n  \"Upper Third Proportion\": \"upperThirdProportion\",\n  \"Middle Third Proportion\": \"middleThirdProportion\",\n  \"Lower Third Proportion\": \"lowerThirdProportion\",\n  \"Cheekbone Height\": \"cheekboneHeight\",\n  \"Cheekbone Width\": \"cheekboneWidth\",\n  \"Bitemporal Width\": \"bitemporalWidth\",\n  \"Forehead Height\": \"foreheadHeight\",\n  \"Facial Asymmetry Index\": \"facialAsymmetryIndex\",\n\n  // Jaw\n  \"Gonial Angle\": \"gonialAngle\",\n  \"Mandibular Plane Angle\": \"mandibularPlaneAngle\",\n  \"Jaw Width Ratio\": \"jawWidthRatio\",\n  \"Bigonial Width\": \"bigonialWidth\",\n  \"Jaw Frontal Angle\": \"jawFrontalAngle\",\n  \"Jaw Slope\": \"jawSlope\",\n  \"Jaw Asymmetry\": \"jawAsymmetry\",\n\n  // Chin\n  \"Chin to Philtrum Ratio\": \"chinPhiltrumRatio\",\n  \"Chin Height\": \"chinHeight\",\n  \"Facial Depth to Height\": \"facialDepthToHeight\",\n  \"Facial Depth to Height Ratio\": \"facialDepthToHeight\",\n  \"Anterior Facial Depth\": \"anteriorFacialDepth\",\n  \"Recession Relative to Frankfort Plane\": \"recessionFrankfort\",\n\n  // Eyes\n  \"Lateral Canthal Tilt\": \"lateralCanthalTilt\",\n  \"Eye Aspect Ratio\": \"eyeAspectRatio\",\n  \"Eye Separation Ratio\": \"eyeSeparationRatio\",\n  \"Interpupillary Ratio\": \"interpupillaryRatio\",\n  \"One Eye Apart Test\": \"oneEyeApartTest\",\n  \"Intercanthal Width\": \"intercanthalWidth\",\n  \"Eyebrow Height\": \"eyebrowHeight\",\n  \"Brow Length Ratio\": \"browLengthRatio\",\n  \"Brow Length to Face Width Ratio\": \"browLengthToFaceWidth\",\n  \"Palpebral Fissure Length\": \"palpebralFissureLength\",\n  \"Eye Width\": \"eyeWidth\",\n  \"Eye Asymmetry\": \"eyeAsymmetry\",\n  \"Brow to Hairline Distance\": \"browToHairlineDistance\",\n\n  // Brow\n  \"Browridge Inclination Angle\": \"browridgeInclinationAngle\",\n\n  // Nose\n  \"Nasal Index\": \"nasalIndex\",\n  \"Nasal Tip Angle\": \"nasalTipAngle\",\n  \"Nose Tip Position\": \"noseTipPosition\",\n  \"Frankfort-tip Angle\": \"frankfortTipAngle\",\n  \"Nasofrontal Angle\": \"nasofrontalAngle\",\n  \"Nasofacial Angle\": \"nasofacialAngle\",\n  \"Nasomenta Angle\": \"nasomentaAngle\",\n  \"Nasomental Angle\": \"nasomentaAngle\",\n  \"Intercanthal Nasal Ratio\": \"intercanthalNasalRatio\",\n  \"Nose Bridge Width\": \"noseBridgeWidth\",\n  \"Nose Width\": \"noseWidth\",\n  \"Nasal Projection\": \"nasalProjection\",\n  \"Nose Length Ratio\": \"noseLengthRatio\",\n  \"Ipsilateral Alar Angle\": \"ipsilateralAlarAngle\",\n\n  // Lips\n  \"Lip Ratio\": \"lipRatio\",\n  \"Philtrum Length\": \"philtrumLength\",\n  \"Upper Lip Projection\": \"upperLipProjection\",\n  \"Lower Lip Projection\": \"lowerLipProjection\",\n  \"Lip Chin Distance\": \"lipChinDistance\",\n  \"Upper Lip Height\": \"upperLipHeight\",\n  \"Upper Lip E-Line Position\": \"upperLipELine\",\n  \"Upper Lip S-Line Position\": \"upperLipSLine\",\n  \"Nasolabial Angle\": \"nasolabialAngle\",\n  \"Cupids Bow Depth\": \"cupidsBowDepth\",\n\n  // Neck\n  \"Neck Width\": \"neckWidth\",\n  \"Neck to Jaw Ratio\": \"neckToJawRatio\",\n\n  // Profile\n  \"Total Profile Angle\": \"totalProfileAngle\",\n};\n\n// ============================================\n// CLASSIFICATION FUNCTIONS\n// ============================================\n\n/**\n * Get weakness severity based on average score\n * 0-3 = \"Severe\", 3-5 = \"Moderate\", 5-7 = \"Minor\"\n */\nfunction getWeaknessSeverity(avgScore: number): WeaknessSeverity {\n  if (avgScore <= 3) return 'severe';\n  if (avgScore <= 5) return 'moderate';\n  return 'minor';\n}\n\n/**\n * Get strength grade based on average score\n * 8-9 = \"Good\", 9-9.5 = \"Excellent\", 9.5-10 = \"Ideal\"\n */\nfunction getStrengthGrade(avgScore: number): StrengthGrade {\n  if (avgScore >= 9.5) return 'ideal';\n  if (avgScore >= 9) return 'excellent';\n  return 'good';\n}\n\n/**\n * Find metric by display name from measurements array\n */\nfunction findMetricByName(\n  metricName: string,\n  measurements: MetricScoreResult[]\n): MetricScoreResult | undefined {\n  // First try direct ID mapping\n  const metricId = METRIC_NAME_TO_ID[metricName];\n  if (metricId) {\n    return measurements.find(m => m.metricId === metricId);\n  }\n\n  // Fallback: try fuzzy matching on name\n  const normalizedName = metricName.toLowerCase().replace(/[^a-z0-9]/g, '');\n  return measurements.find(m => {\n    const normalizedMetricName = m.name.toLowerCase().replace(/[^a-z0-9]/g, '');\n    return normalizedMetricName.includes(normalizedName) ||\n           normalizedName.includes(normalizedMetricName);\n  });\n}\n\n/**\n * Check if a metric should be considered a \"false positive\" weakness.\n * This handles directional/dimorphic metrics where low scores don't mean weakness.\n *\n * Example: Canthal Tilt of 3° gets a low score (not in 6-8° ideal range)\n * but is still a POSITIVE trait, not a weakness.\n */\nfunction isFalsePositiveWeakness(metric: MatchedMetric): boolean {\n  const config = METRIC_CONFIGS[metric.metricId];\n  if (!config) return false;\n\n  // Check if the value is actually acceptable based on polarity\n  const { acceptable } = isValueAcceptable(metric.value, config);\n  return acceptable;\n}\n\n/**\n * Process all insight definitions against user's measurements\n */\nexport function classifyInsights(\n  measurements: MetricScoreResult[],\n  insightDefinitions: InsightDefinition[] = INSIGHTS_DEFINITIONS\n): InsightClassificationResult {\n  const strengths: ClassifiedStrength[] = [];\n  const weaknesses: ClassifiedWeakness[] = [];\n\n  for (const insight of insightDefinitions) {\n    const { metrics, threshold } = insight.severity_logic;\n\n    // Find matching measurements for this insight\n    const matchedMetrics: MatchedMetric[] = [];\n    for (const metricName of metrics) {\n      const measurement = findMetricByName(metricName, measurements);\n      if (measurement) {\n        matchedMetrics.push({\n          metricId: measurement.metricId,\n          metricName: measurement.name,\n          score: measurement.score,\n          value: measurement.value,\n          idealMin: measurement.idealMin,\n          idealMax: measurement.idealMax,\n          unit: measurement.unit,\n          category: measurement.category,\n        });\n      }\n    }\n\n    // Skip if no metrics matched (need at least 1)\n    if (matchedMetrics.length === 0) continue;\n\n    // Calculate average score\n    const avgScore = matchedMetrics.reduce((sum, m) => sum + m.score, 0) / matchedMetrics.length;\n\n    // Classify based on type and threshold\n    if (insight.type === 'weakness') {\n      // Weakness: avg < threshold → add to areas of improvement\n      if (avgScore < threshold) {\n        // ========== FALSE POSITIVE CHECK ==========\n        // Before adding to weaknesses, check if ANY of the matched metrics\n        // are actually in an \"acceptable\" zone based on their polarity.\n        // If so, this is a false positive and should be skipped or reclassified.\n        const falsePositiveMetrics = matchedMetrics.filter(isFalsePositiveWeakness);\n\n        // If ALL matched metrics are false positives, skip this weakness entirely\n        if (falsePositiveMetrics.length === matchedMetrics.length) {\n          // This is a false positive weakness - the values are actually acceptable\n          // Consider adding to strengths if scores are decent\n          if (avgScore >= 6) {\n            strengths.push({\n              insightId: `${insight.id}_acceptable`,\n              title: insight.title.replace('Negative', 'Neutral').replace('Weak', 'Moderate'),\n              description: `While not in the peak ideal range, the measured values are within acceptable limits.`,\n              grade: 'good',\n              gradeLabel: 'Acceptable',\n              avgScore,\n              matchedMetrics,\n            });\n          }\n          continue; // Skip adding as weakness\n        }\n\n        // If SOME metrics are false positives, filter them out\n        const trueWeaknessMetrics = matchedMetrics.filter(m => !isFalsePositiveWeakness(m));\n        if (trueWeaknessMetrics.length === 0) continue;\n\n        // Recalculate average with only true weakness metrics\n        const trueAvgScore = trueWeaknessMetrics.reduce((sum, m) => sum + m.score, 0) / trueWeaknessMetrics.length;\n\n        // Only add as weakness if true average is still below threshold\n        if (trueAvgScore < threshold) {\n          const severity = getWeaknessSeverity(trueAvgScore);\n          const labels = insight.content.severity_labels;\n          const severityLabel = labels?.[severity] || severity;\n          // Calculate confidence based on Z-scores of matched metrics\n          const confidence = calculateFlawConfidence(trueWeaknessMetrics, trueAvgScore);\n\n          weaknesses.push({\n            insightId: insight.id,\n            title: insight.title,\n            description: insight.content.description,\n            severity,\n            severityLabel,\n            avgScore: trueAvgScore,\n            matchedMetrics: trueWeaknessMetrics,\n            confidence,\n          });\n        }\n      }\n    } else {\n      // Strength: avg > threshold → add to key strengths\n      if (avgScore > threshold) {\n        const grade = getStrengthGrade(avgScore);\n        const labels = insight.content.grade_labels;\n        const gradeLabel = labels?.[grade] || grade;\n\n        strengths.push({\n          insightId: insight.id,\n          title: insight.title,\n          description: insight.content.description,\n          grade,\n          gradeLabel,\n          avgScore,\n          matchedMetrics,\n        });\n      }\n    }\n  }\n\n  // Sort by score (weaknesses by lowest score first, strengths by highest first)\n  weaknesses.sort((a, b) => a.avgScore - b.avgScore);\n  strengths.sort((a, b) => b.avgScore - a.avgScore);\n\n  return { strengths, weaknesses };\n}\n\n/**\n * Convert ClassifiedStrength to Strength type for UI compatibility\n */\nexport function convertToStrength(classified: ClassifiedStrength): Strength {\n  return {\n    id: `insight_strength_${classified.insightId}`,\n    strengthName: `${classified.title} (${classified.gradeLabel})`,\n    summary: classified.description,\n    avgScore: Math.max(0, Math.min(10, classified.avgScore)),  // Clamp to 0-10\n    qualityLevel: classified.grade === 'ideal' ? 'ideal' :\n                  classified.grade === 'excellent' ? 'excellent' : 'good',\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n  };\n}\n\n/**\n * Convert ClassifiedWeakness to Flaw type for UI compatibility\n */\nexport function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  const impact = (10 - classified.avgScore) * 0.5;\n  const newRollingLost = rollingLost + impact;\n\n  return {\n    id: `insight_flaw_${classified.insightId}`,\n    flawName: `${classified.title} (${classified.severityLabel})`,\n    summary: classified.description,\n    harmonyPercentageLost: impact,\n    standardizedImpact: impact / 10,\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: Math.max(0, Math.min(10, m.score)),  // Clamp to 0-10 to prevent display overflow\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n    rollingPointsDeducted: newRollingLost,\n    rollingHarmonyPercentageLost: newRollingLost,\n    rollingStandardizedImpact: newRollingLost / 10,\n  };\n}\n\n/**\n * Main function: Generate strengths and flaws from measurements using insights\n */\nexport function generateInsightBasedResults(\n  measurements: MetricScoreResult[]\n): { strengths: Strength[]; flaws: Flaw[] } {\n  const { strengths: classifiedStrengths, weaknesses: classifiedWeaknesses } = classifyInsights(measurements);\n\n  // Convert to UI-compatible types\n  const strengths = classifiedStrengths.map((s) => convertToStrength(s));\n\n  let rollingLost = 0;\n  const flaws = classifiedWeaknesses.map((w, i) => {\n    const flaw = convertToFlaw(w, i, rollingLost);\n    rollingLost = flaw.rollingPointsDeducted || 0;\n    return flaw;\n  });\n\n  return { strengths, flaws };\n}\n","structuredPatch":[{"oldStart":2702,"oldLines":6,"newStart":2702,"newLines":7,"lines":["     rollingPointsDeducted: newRollingLost,","     rollingHarmonyPercentageLost: newRollingLost,","     rollingStandardizedImpact: newRollingLost / 10,","+    confidence: classified.confidence,","   };"," }"," "]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"7e0d9270-e8b8-435a-9798-d77eef7019ec","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01B6vs4njfPuX4eCDxZm3Czp","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me add a `ConfidenceBadge` component to `StrengthFlawCards.tsx` and update the UI components to display it. Let me read the current file again:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1614,"cache_read_input_tokens":89812,"cache_creation":{"ephemeral_5m_input_tokens":1614,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVVLnJpt8erWnxYkkmVA","type":"assistant","uuid":"6465d913-6193-40c1-a675-dbdc1dd445eb","timestamp":"2025-12-26T14:53:40.038Z"}
{"parentUuid":"6465d913-6193-40c1-a675-dbdc1dd445eb","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01B6vs4njfPuX4eCDxZm3Czp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QJEbEQwf3trRouS3sExmMo","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","limit":135}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1614,"cache_read_input_tokens":89812,"cache_creation":{"ephemeral_5m_input_tokens":1614,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVVLnJpt8erWnxYkkmVA","type":"assistant","uuid":"7cd29a28-a7b6-4721-9db5-e8eee48e56d5","timestamp":"2025-12-26T14:53:40.674Z"}
{"parentUuid":"7cd29a28-a7b6-4721-9db5-e8eee48e56d5","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QJEbEQwf3trRouS3sExmMo","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useState, useMemo } from 'react';\n     4→import { motion, AnimatePresence } from 'framer-motion';\n     5→import { ChevronDown, AlertTriangle, CheckCircle, Sparkles } from 'lucide-react';\n     6→import { Strength, Flaw, Recommendation, getScoreColor } from '@/types/results';\n     7→\n     8→// ============================================\n     9→// QUALITY TIER BADGES (Harmony Style) - Strengths\n    10→// ============================================\n    11→\n    12→type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\n    13→\n    14→interface QualityConfig {\n    15→  label: string;\n    16→  textColor: string;\n    17→  bgColor: string;\n    18→}\n    19→\n    20→const QUALITY_CONFIGS: Record<QualityTier, QualityConfig> = {\n    21→  ideal: {\n    22→    label: 'Ideal',\n    23→    textColor: 'rgb(34, 211, 238)',    // cyan-400\n    24→    bgColor: 'rgba(34, 211, 238, 0.15)', // cyan-400/15\n    25→  },\n    26→  excellent: {\n    27→    label: 'Excellent',\n    28→    textColor: 'rgb(52, 211, 153)',    // emerald-400\n    29→    bgColor: 'rgba(52, 211, 153, 0.15)', // emerald-400/15\n    30→  },\n    31→  good: {\n    32→    label: 'Good',\n    33→    textColor: 'rgb(74, 222, 128)',    // green-400\n    34→    bgColor: 'rgba(74, 222, 128, 0.15)', // green-400/15\n    35→  },\n    36→  below_average: {\n    37→    label: 'Average',\n    38→    textColor: 'rgb(163, 163, 163)',   // neutral-400\n    39→    bgColor: 'rgba(163, 163, 163, 0.15)', // neutral-400/15\n    40→  },\n    41→};\n    42→\n    43→function QualityBadge({ quality }: { quality: QualityTier }) {\n    44→  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n    45→\n    46→  return (\n    47→    <span\n    48→      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n    49→      style={{\n    50→        color: config.textColor,\n    51→        backgroundColor: config.bgColor,\n    52→      }}\n    53→    >\n    54→      {config.label}\n    55→    </span>\n    56→  );\n    57→}\n    58→\n    59→// ============================================\n    60→// SEVERITY BADGES (Harmony Style) - Flaws\n    61→// ============================================\n    62→\n    63→type SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n    64→\n    65→interface SeverityConfig {\n    66→  label: string;\n    67→  textColor: string;\n    68→  bgColor: string;\n    69→  borderColor?: string;\n    70→}\n    71→\n    72→const SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {\n    73→  extremely_severe: {\n    74→    label: 'extremely severe',\n    75→    textColor: 'rgb(248, 113, 113)',   // red-400\n    76→    bgColor: 'rgba(248, 113, 113, 0.15)', // red-400/15\n    77→  },\n    78→  severe: {\n    79→    label: 'severe',\n    80→    textColor: 'rgb(248, 113, 113)',   // red-400\n    81→    bgColor: 'rgba(248, 113, 113, 0.1)', // red-400/10\n    82→    borderColor: 'rgba(248, 113, 113, 0.3)', // red-400/30\n    83→  },\n    84→  moderate: {\n    85→    label: 'moderate',\n    86→    textColor: 'rgb(251, 146, 60)',    // orange-400\n    87→    bgColor: 'rgba(251, 146, 60, 0.1)', // orange-400/10\n    88→    borderColor: 'rgba(251, 146, 60, 0.3)', // orange-400/30\n    89→  },\n    90→  minor: {\n    91→    label: 'minor',\n    92→    textColor: 'rgb(250, 204, 21)',    // yellow-400\n    93→    bgColor: 'rgba(250, 204, 21, 0.1)', // yellow-400/10\n    94→    borderColor: 'rgba(250, 204, 21, 0.3)', // yellow-400/30\n    95→  },\n    96→};\n    97→\n    98→function getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n    99→  if (harmonyLost >= 0.8) return 'extremely_severe';\n   100→  if (harmonyLost >= 0.5) return 'severe';\n   101→  if (harmonyLost >= 0.3) return 'moderate';\n   102→  return 'minor';\n   103→}\n   104→\n   105→function getSeverityFromScore(score: number): SeverityLevel {\n   106→  if (score <= 2) return 'extremely_severe';\n   107→  if (score <= 4) return 'severe';\n   108→  if (score <= 6) return 'moderate';\n   109→  return 'minor';\n   110→}\n   111→\n   112→function SeverityBadge({ severity }: { severity: SeverityLevel }) {\n   113→  const config = SEVERITY_CONFIGS[severity];\n   114→\n   115→  return (\n   116→    <span\n   117→      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n   118→      style={{\n   119→        color: config.textColor,\n   120→        backgroundColor: config.bgColor,\n   121→        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n   122→      }}\n   123→    >\n   124→      {config.label}\n   125→    </span>\n   126→  );\n   127→}\n   128→\n   129→// ============================================\n   130→// PROCEDURE PHASE BADGE\n   131→// ============================================\n   132→\n   133→type ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n   134→\n   135→interface PhaseConfig {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"3c5c37c8-f5a2-4f97-a210-5c68be0f1ccd","timestamp":"2025-12-26T14:53:40.749Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","content":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ChevronDown, AlertTriangle, CheckCircle, Sparkles } from 'lucide-react';\nimport { Strength, Flaw, Recommendation, getScoreColor } from '@/types/results';\n\n// ============================================\n// QUALITY TIER BADGES (Harmony Style) - Strengths\n// ============================================\n\ntype QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\n\ninterface QualityConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n}\n\nconst QUALITY_CONFIGS: Record<QualityTier, QualityConfig> = {\n  ideal: {\n    label: 'Ideal',\n    textColor: 'rgb(34, 211, 238)',    // cyan-400\n    bgColor: 'rgba(34, 211, 238, 0.15)', // cyan-400/15\n  },\n  excellent: {\n    label: 'Excellent',\n    textColor: 'rgb(52, 211, 153)',    // emerald-400\n    bgColor: 'rgba(52, 211, 153, 0.15)', // emerald-400/15\n  },\n  good: {\n    label: 'Good',\n    textColor: 'rgb(74, 222, 128)',    // green-400\n    bgColor: 'rgba(74, 222, 128, 0.15)', // green-400/15\n  },\n  below_average: {\n    label: 'Average',\n    textColor: 'rgb(163, 163, 163)',   // neutral-400\n    bgColor: 'rgba(163, 163, 163, 0.15)', // neutral-400/15\n  },\n};\n\nfunction QualityBadge({ quality }: { quality: QualityTier }) {\n  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// SEVERITY BADGES (Harmony Style) - Flaws\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n\ninterface SeverityConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor?: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {\n  extremely_severe: {\n    label: 'extremely severe',\n    textColor: 'rgb(248, 113, 113)',   // red-400\n    bgColor: 'rgba(248, 113, 113, 0.15)', // red-400/15\n  },\n  severe: {\n    label: 'severe',\n    textColor: 'rgb(248, 113, 113)',   // red-400\n    bgColor: 'rgba(248, 113, 113, 0.1)', // red-400/10\n    borderColor: 'rgba(248, 113, 113, 0.3)', // red-400/30\n  },\n  moderate: {\n    label: 'moderate',\n    textColor: 'rgb(251, 146, 60)',    // orange-400\n    bgColor: 'rgba(251, 146, 60, 0.1)', // orange-400/10\n    borderColor: 'rgba(251, 146, 60, 0.3)', // orange-400/30\n  },\n  minor: {\n    label: 'minor',\n    textColor: 'rgb(250, 204, 21)',    // yellow-400\n    bgColor: 'rgba(250, 204, 21, 0.1)', // yellow-400/10\n    borderColor: 'rgba(250, 204, 21, 0.3)', // yellow-400/30\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  if (harmonyLost >= 0.8) return 'extremely_severe';\n  if (harmonyLost >= 0.5) return 'severe';\n  if (harmonyLost >= 0.3) return 'moderate';\n  return 'minor';\n}\n\nfunction getSeverityFromScore(score: number): SeverityLevel {\n  if (score <= 2) return 'extremely_severe';\n  if (score <= 4) return 'severe';\n  if (score <= 6) return 'moderate';\n  return 'minor';\n}\n\nfunction SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================\n\ntype ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n\ninterface PhaseConfig {","numLines":135,"startLine":1,"totalLines":660}}}
{"parentUuid":"3c5c37c8-f5a2-4f97-a210-5c68be0f1ccd","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01CUwgLe9X2RfSJpXo67gk3q","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me add the `ConfidenceBadge` component and import the `ConfidenceLevel` type:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2150,"cache_read_input_tokens":91426,"cache_creation":{"ephemeral_5m_input_tokens":2150,"ephemeral_1h_input_tokens":0},"output_tokens":8,"service_tier":"standard"}},"requestId":"req_011CWVVMH5Sz7w4a78fL8sKp","type":"assistant","uuid":"611301e9-266f-4bab-9776-2b233625f89f","timestamp":"2025-12-26T14:53:46.386Z"}
{"parentUuid":"611301e9-266f-4bab-9776-2b233625f89f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01CUwgLe9X2RfSJpXo67gk3q","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015ARazZ5j7utFqXdR5pqtUi","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","old_string":"import { Strength, Flaw, Recommendation, getScoreColor } from '@/types/results';","new_string":"import { Strength, Flaw, Recommendation, getScoreColor } from '@/types/results';\nimport { ConfidenceLevel } from '@/lib/harmony-scoring';"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2150,"cache_read_input_tokens":91426,"cache_creation":{"ephemeral_5m_input_tokens":2150,"ephemeral_1h_input_tokens":0},"output_tokens":219,"service_tier":"standard"}},"requestId":"req_011CWVVMH5Sz7w4a78fL8sKp","type":"assistant","uuid":"0a351d01-1cc3-4ab5-9519-ccedf5c22c96","timestamp":"2025-12-26T14:53:47.685Z"}
{"parentUuid":"0a351d01-1cc3-4ab5-9519-ccedf5c22c96","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015ARazZ5j7utFqXdR5pqtUi","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n     2→\n     3→import { useState, useMemo } from 'react';\n     4→import { motion, AnimatePresence } from 'framer-motion';\n     5→import { ChevronDown, AlertTriangle, CheckCircle, Sparkles } from 'lucide-react';\n     6→import { Strength, Flaw, Recommendation, getScoreColor } from '@/types/results';\n     7→import { ConfidenceLevel } from '@/lib/harmony-scoring';\n     8→\n     9→// ============================================\n    10→// QUALITY TIER BADGES (Harmony Style) - Strengths\n    11→// ============================================"}]},"uuid":"9f79e227-8f28-4c36-bac8-c19cd1e2368a","timestamp":"2025-12-26T14:53:47.745Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","oldString":"import { Strength, Flaw, Recommendation, getScoreColor } from '@/types/results';","newString":"import { Strength, Flaw, Recommendation, getScoreColor } from '@/types/results';\nimport { ConfidenceLevel } from '@/lib/harmony-scoring';","originalFile":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ChevronDown, AlertTriangle, CheckCircle, Sparkles } from 'lucide-react';\nimport { Strength, Flaw, Recommendation, getScoreColor } from '@/types/results';\n\n// ============================================\n// QUALITY TIER BADGES (Harmony Style) - Strengths\n// ============================================\n\ntype QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\n\ninterface QualityConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n}\n\nconst QUALITY_CONFIGS: Record<QualityTier, QualityConfig> = {\n  ideal: {\n    label: 'Ideal',\n    textColor: 'rgb(34, 211, 238)',    // cyan-400\n    bgColor: 'rgba(34, 211, 238, 0.15)', // cyan-400/15\n  },\n  excellent: {\n    label: 'Excellent',\n    textColor: 'rgb(52, 211, 153)',    // emerald-400\n    bgColor: 'rgba(52, 211, 153, 0.15)', // emerald-400/15\n  },\n  good: {\n    label: 'Good',\n    textColor: 'rgb(74, 222, 128)',    // green-400\n    bgColor: 'rgba(74, 222, 128, 0.15)', // green-400/15\n  },\n  below_average: {\n    label: 'Average',\n    textColor: 'rgb(163, 163, 163)',   // neutral-400\n    bgColor: 'rgba(163, 163, 163, 0.15)', // neutral-400/15\n  },\n};\n\nfunction QualityBadge({ quality }: { quality: QualityTier }) {\n  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// SEVERITY BADGES (Harmony Style) - Flaws\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n\ninterface SeverityConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor?: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {\n  extremely_severe: {\n    label: 'extremely severe',\n    textColor: 'rgb(248, 113, 113)',   // red-400\n    bgColor: 'rgba(248, 113, 113, 0.15)', // red-400/15\n  },\n  severe: {\n    label: 'severe',\n    textColor: 'rgb(248, 113, 113)',   // red-400\n    bgColor: 'rgba(248, 113, 113, 0.1)', // red-400/10\n    borderColor: 'rgba(248, 113, 113, 0.3)', // red-400/30\n  },\n  moderate: {\n    label: 'moderate',\n    textColor: 'rgb(251, 146, 60)',    // orange-400\n    bgColor: 'rgba(251, 146, 60, 0.1)', // orange-400/10\n    borderColor: 'rgba(251, 146, 60, 0.3)', // orange-400/30\n  },\n  minor: {\n    label: 'minor',\n    textColor: 'rgb(250, 204, 21)',    // yellow-400\n    bgColor: 'rgba(250, 204, 21, 0.1)', // yellow-400/10\n    borderColor: 'rgba(250, 204, 21, 0.3)', // yellow-400/30\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  if (harmonyLost >= 0.8) return 'extremely_severe';\n  if (harmonyLost >= 0.5) return 'severe';\n  if (harmonyLost >= 0.3) return 'moderate';\n  return 'minor';\n}\n\nfunction getSeverityFromScore(score: number): SeverityLevel {\n  if (score <= 2) return 'extremely_severe';\n  if (score <= 4) return 'severe';\n  if (score <= 6) return 'moderate';\n  return 'minor';\n}\n\nfunction SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================\n\ntype ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n\ninterface PhaseConfig {\n  textColor: string;\n  bgColor: string;\n}\n\nconst PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n  Foundational: {\n    textColor: 'rgb(52, 211, 153)',   // emerald-400\n    bgColor: 'rgba(52, 211, 153, 0.15)', // emerald-400/15\n  },\n  'Non-Invasive': {\n    textColor: 'rgb(96, 165, 250)',   // blue-400\n    bgColor: 'rgba(96, 165, 250, 0.15)', // blue-400/15\n  },\n  'Minimally Invasive': {\n    textColor: 'rgb(167, 139, 250)',  // violet-400\n    bgColor: 'rgba(167, 139, 250, 0.15)', // violet-400/15\n  },\n  Surgical: {\n    textColor: 'rgb(192, 132, 252)',  // purple-400\n    bgColor: 'rgba(192, 132, 252, 0.15)', // purple-400/15\n  },\n};\n\nfunction PhaseBadge({ phase }: { phase: ProcedurePhase }) {\n  const config = PHASE_CONFIGS[phase] || PHASE_CONFIGS['Non-Invasive'];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {phase}\n    </span>\n  );\n}\n\n// ============================================\n// CONTRIBUTING/AFFECTED RATIO ITEM\n// ============================================\n\ninterface RatioItemProps {\n  name: string;\n  score: number | string;\n  onClick?: () => void;\n  animationDelay?: number;\n}\n\nfunction RatioItem({ name, score, onClick, animationDelay = 0 }: RatioItemProps) {\n  const numericScore = typeof score === 'number' ? score : 0;\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"w-full flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-neutral-800/50 border border-neutral-700/50 transition-all duration-200 hover:border-neutral-600 hover:bg-neutral-800 text-left cursor-pointer animate-fade-in\"\n      style={{\n        animationDuration: '0.2s',\n        animationDelay: `${animationDelay}s`,\n      }}\n    >\n      <span className=\"text-xs sm:text-sm text-neutral-300 font-medium\">{name}</span>\n      <div className=\"flex items-baseline gap-0.5 sm:gap-1\">\n        <span\n          className=\"text-xs sm:text-sm font-semibold\"\n          style={{ color: typeof score === 'string' ? '#a3a3a3' : getScoreColor(numericScore) }}\n        >\n          {typeof score === 'number' ? score.toFixed(1) : score}\n        </span>\n        <span className=\"text-[10px] sm:text-xs text-neutral-500\">/10</span>\n      </div>\n    </button>\n  );\n}\n\n// ============================================\n// PLAN ITEM (Recommendation)\n// ============================================\n\ninterface PlanItemProps {\n  name: string;\n  phase: ProcedurePhase;\n  inPlan?: boolean;\n  animationDelay?: number;\n}\n\nfunction PlanItem({ name, phase, inPlan = true, animationDelay = 0 }: PlanItemProps) {\n  return (\n    <div\n      className=\"flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-neutral-800/50 border border-neutral-700/50 animate-fade-in\"\n      style={{\n        animationDuration: '0.2s',\n        animationDelay: `${animationDelay}s`,\n      }}\n    >\n      <span className=\"text-xs sm:text-sm text-neutral-300 font-medium\">{name}</span>\n      <div className=\"flex items-center gap-2\">\n        {inPlan && (\n          <span className=\"text-[9px] sm:text-[10px] px-1.5 py-0.5 rounded bg-emerald-400/15 text-emerald-400 font-medium\">\n            In Plan\n          </span>\n        )}\n        <PhaseBadge phase={phase} />\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// STRENGTH CARD (Harmony Style)\n// ============================================\n\ninterface StrengthCardProps {\n  strength: Strength;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n  animationDelay?: number;\n}\n\nexport function StrengthCard({\n  strength,\n  isExpanded = false,\n  onToggle,\n  onRatioClick,\n  animationDelay = 0,\n}: StrengthCardProps) {\n  // Get score color for the average score\n  const numericScore = typeof strength.avgScore === 'number' ? strength.avgScore : 0;\n  const scoreColor = getScoreColor(numericScore);\n\n  return (\n    <div\n      className=\"rounded-lg bg-neutral-900 border border-neutral-800/60 overflow-hidden transition-all duration-200 hover:border-neutral-700 hover:shadow-lg shadow-black/10 animate-fade-in\"\n      style={{ animationDelay: `${animationDelay}s` }}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <QualityBadge quality={strength.qualityLevel} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {strength.strengthName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n                {strength.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Score + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right\">\n              <div\n                className=\"text-lg sm:text-xl font-semibold tracking-tight transition-colors duration-200\"\n                style={{ color: scoreColor }}\n              >\n                {typeof strength.avgScore === 'number' ? strength.avgScore.toFixed(2) : strength.avgScore}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium mt-0.5\">avg /10</div>\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-500\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: 'easeInOut' }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"border-t border-neutral-800 bg-neutral-900/50 px-4 sm:px-6 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Contributing Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {strength.responsibleRatios.map((ratio, i) => (\n                  <RatioItem\n                    key={ratio.ratioId}\n                    name={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick?.(ratio)}\n                    animationDelay={i * 0.03}\n                  />\n                ))}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// FLAW CARD (Harmony Style - Areas of Improvement)\n// ============================================\n\ninterface FlawCardProps {\n  flaw: Flaw;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n  recommendations?: Recommendation[];\n  animationDelay?: number;\n}\n\nexport function FlawCard({\n  flaw,\n  isExpanded = false,\n  onToggle,\n  onRatioClick,\n  recommendations = [],\n  animationDelay = 0,\n}: FlawCardProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n\n  // Find matching recommendations for this flaw\n  const matchedRecommendations = useMemo(() => {\n    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n    return recommendations.filter(rec =>\n      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n    ).slice(0, 3); // Limit to 3 recommendations\n  }, [flaw, recommendations]);\n\n  // Map phase names\n  const mapPhase = (phase: string): ProcedurePhase => {\n    if (phase === 'Foundational') return 'Foundational';\n    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n    if (phase === 'Surgical') return 'Surgical';\n    return 'Non-Invasive';\n  };\n\n  return (\n    <div\n      className=\"rounded-lg bg-neutral-900 border border-neutral-800/60 overflow-hidden transition-all duration-200 hover:border-neutral-700 hover:shadow-lg shadow-black/10 animate-fade-in\"\n      style={{ animationDelay: `${animationDelay}s` }}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <SeverityBadge severity={severity} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-400\">\n                -{flaw.harmonyPercentageLost.toFixed(2)}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n              {flaw.rollingHarmonyPercentageLost !== undefined && (\n                <div className=\"text-[10px] text-neutral-500 font-medium pt-0.5 border-t border-neutral-800 mt-1 pt-1\">\n                  Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n                </div>\n              )}\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-500\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: 'easeInOut' }}\n            className=\"overflow-hidden\"\n          >\n            {/* Affected Ratios Section */}\n            <div className=\"border-t border-neutral-800 bg-neutral-900/50 px-4 sm:px-6 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Affected Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {flaw.responsibleRatios.map((ratio, i) => (\n                  <RatioItem\n                    key={ratio.ratioId}\n                    name={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick?.(ratio)}\n                    animationDelay={i * 0.03}\n                  />\n                ))}\n              </div>\n            </div>\n\n            {/* Your Plan Section (if there are matched recommendations) */}\n            {matchedRecommendations.length > 0 && (\n              <div className=\"border-t border-neutral-800 bg-emerald-400/5 px-4 sm:px-6 py-3 sm:py-4\">\n                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n                  <Sparkles className=\"w-3 h-3 text-emerald-400\" />\n                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-400 uppercase tracking-wider\">\n                    Your Plan\n                  </span>\n                </div>\n                <div className=\"space-y-2\">\n                  {matchedRecommendations.map((rec, i) => (\n                    <PlanItem\n                      key={rec.ref_id}\n                      name={rec.name}\n                      phase={mapPhase(rec.phase)}\n                      inPlan={true}\n                      animationDelay={i * 0.03}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// STRENGTHS SECTION (Container)\n// ============================================\n\ninterface StrengthsSectionProps {\n  strengths: Strength[];\n  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n  maxVisible?: number;\n}\n\nexport function StrengthsSection({\n  strengths,\n  onRatioClick,\n  maxVisible = 5,\n}: StrengthsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const visibleStrengths = showAll ? strengths : strengths.slice(0, maxVisible);\n  const hasMore = strengths.length > maxVisible;\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/80 border border-neutral-800/50 p-4 sm:p-6 lg:p-8\">\n      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n          Key Strengths\n        </h3>\n      </div>\n\n      <div className=\"space-y-3\">\n        {visibleStrengths.map((strength, i) => (\n          <StrengthCard\n            key={strength.id}\n            strength={strength}\n            isExpanded={expandedId === strength.id}\n            onToggle={() => setExpandedId(expandedId === strength.id ? null : strength.id)}\n            onRatioClick={onRatioClick}\n            animationDelay={i * 0.04}\n          />\n        ))}\n      </div>\n\n      {hasMore && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-6 py-3 rounded-lg bg-neutral-800 border border-neutral-700/50 hover:border-neutral-600 hover:bg-neutral-700 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show All ${strengths.length} Strengths`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// FLAWS SECTION (Areas of Improvement Container)\n// ============================================\n\ninterface FlawsSectionProps {\n  flaws: Flaw[];\n  recommendations?: Recommendation[];\n  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n  maxVisible?: number;\n}\n\nexport function FlawsSection({\n  flaws,\n  recommendations = [],\n  onRatioClick,\n  maxVisible = 5,\n}: FlawsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const visibleFlaws = showAll ? flaws : flaws.slice(0, maxVisible);\n  const hasMore = flaws.length > maxVisible;\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/80 border border-neutral-800/50 p-4 sm:p-6 lg:p-8\">\n      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n          Areas of Improvement\n        </h3>\n      </div>\n\n      <div className=\"space-y-3\">\n        {visibleFlaws.map((flaw, i) => (\n          <FlawCard\n            key={flaw.id}\n            flaw={flaw}\n            isExpanded={expandedId === flaw.id}\n            onToggle={() => setExpandedId(expandedId === flaw.id ? null : flaw.id)}\n            onRatioClick={onRatioClick}\n            recommendations={recommendations}\n            animationDelay={i * 0.04}\n          />\n        ))}\n      </div>\n\n      {hasMore && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-6 py-3 rounded-lg bg-neutral-800 border border-neutral-700/50 hover:border-neutral-600 hover:bg-neutral-700 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show All ${flaws.length} Areas`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// COMPACT BADGES (for use elsewhere)\n// ============================================\n\ninterface CompactStrengthBadgeProps {\n  strength: Strength;\n  onClick?: () => void;\n}\n\nexport function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-green-400/10 border border-green-400/30 rounded-lg hover:bg-green-400/20 transition-colors\"\n    >\n      <CheckCircle size={12} className=\"text-green-400\" />\n      <span className=\"text-xs text-green-400\">{strength.strengthName}</span>\n    </button>\n  );\n}\n\ninterface CompactFlawBadgeProps {\n  flaw: Flaw;\n  onClick?: () => void;\n}\n\nexport function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-lg hover:opacity-80 transition-all\"\n      style={{\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      <AlertTriangle size={12} style={{ color: config.textColor }} />\n      <span className=\"text-xs\" style={{ color: config.textColor }}>{flaw.flawName}</span>\n    </button>\n  );\n}\n\n// Export utility functions\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\nexport { SeverityBadge };\nexport type { SeverityLevel };\n","structuredPatch":[{"oldStart":4,"oldLines":6,"newStart":4,"newLines":7,"lines":[" import { motion, AnimatePresence } from 'framer-motion';"," import { ChevronDown, AlertTriangle, CheckCircle, Sparkles } from 'lucide-react';"," import { Strength, Flaw, Recommendation, getScoreColor } from '@/types/results';","+import { ConfidenceLevel } from '@/lib/harmony-scoring';"," "," // ============================================"," // QUALITY TIER BADGES (Harmony Style) - Strengths"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"9f79e227-8f28-4c36-bac8-c19cd1e2368a","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RYCJViFPZZvDQuSdx5yJ8G","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me add the ConfidenceBadge component after the SeverityBadge:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":558,"cache_read_input_tokens":93576,"cache_creation":{"ephemeral_5m_input_tokens":558,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVMo417wqYFATsZ1c9d","type":"assistant","uuid":"338c4428-cb44-48da-98ca-7acbe68e384f","timestamp":"2025-12-26T14:53:53.968Z"}
{"parentUuid":"338c4428-cb44-48da-98ca-7acbe68e384f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RYCJViFPZZvDQuSdx5yJ8G","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016hBRgGQmWzknSRPib82dze","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","old_string":"function SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================","new_string":"function SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// CONFIDENCE BADGES - Flaw Detection Certainty\n// ============================================\n\ninterface ConfidenceConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor: string;\n  icon: string;  // Unicode checkmark/question icons\n}\n\nconst CONFIDENCE_CONFIGS: Record<ConfidenceLevel, ConfidenceConfig> = {\n  confirmed: {\n    label: 'Confirmed',\n    textColor: 'rgb(74, 222, 128)',     // green-400\n    bgColor: 'rgba(74, 222, 128, 0.1)', // green-400/10\n    borderColor: 'rgba(74, 222, 128, 0.3)', // green-400/30\n    icon: '\\u2713',  // checkmark\n  },\n  likely: {\n    label: 'Likely',\n    textColor: 'rgb(96, 165, 250)',     // blue-400\n    bgColor: 'rgba(96, 165, 250, 0.1)', // blue-400/10\n    borderColor: 'rgba(96, 165, 250, 0.3)', // blue-400/30\n    icon: '\\u2248',  // approximately equal\n  },\n  possible: {\n    label: 'Possible',\n    textColor: 'rgb(163, 163, 163)',    // neutral-400\n    bgColor: 'rgba(163, 163, 163, 0.1)', // neutral-400/10\n    borderColor: 'rgba(163, 163, 163, 0.3)', // neutral-400/30\n    icon: '?',\n  },\n};\n\ninterface ConfidenceBadgeProps {\n  confidence: ConfidenceLevel;\n  showIcon?: boolean;\n}\n\nexport function ConfidenceBadge({ confidence, showIcon = true }: ConfidenceBadgeProps) {\n  const config = CONFIDENCE_CONFIGS[confidence] || CONFIDENCE_CONFIGS.possible;\n\n  return (\n    <span\n      className=\"inline-flex items-center gap-1 px-1.5 py-0.5 sm:px-2 sm:py-0.5 rounded text-[9px] sm:text-[10px] font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: `1px solid ${config.borderColor}`,\n      }}\n      title={`Detection confidence: ${config.label}`}\n    >\n      {showIcon && <span className=\"text-[8px] sm:text-[9px]\">{config.icon}</span>}\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":558,"cache_read_input_tokens":93576,"cache_creation":{"ephemeral_5m_input_tokens":558,"ephemeral_1h_input_tokens":0},"output_tokens":1204,"service_tier":"standard"}},"requestId":"req_011CWVVMo417wqYFATsZ1c9d","type":"assistant","uuid":"1908ad8c-d85b-45c6-bfa0-de0de1756981","timestamp":"2025-12-26T14:54:03.389Z"}
{"parentUuid":"1908ad8c-d85b-45c6-bfa0-de0de1756981","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016hBRgGQmWzknSRPib82dze","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   109→  if (score <= 6) return 'moderate';\n   110→  return 'minor';\n   111→}\n   112→\n   113→function SeverityBadge({ severity }: { severity: SeverityLevel }) {\n   114→  const config = SEVERITY_CONFIGS[severity];\n   115→\n   116→  return (\n   117→    <span\n   118→      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n   119→      style={{\n   120→        color: config.textColor,\n   121→        backgroundColor: config.bgColor,\n   122→        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n   123→      }}\n   124→    >\n   125→      {config.label}\n   126→    </span>\n   127→  );\n   128→}\n   129→\n   130→// ============================================\n   131→// CONFIDENCE BADGES - Flaw Detection Certainty\n   132→// ============================================\n   133→\n   134→interface ConfidenceConfig {\n   135→  label: string;\n   136→  textColor: string;\n   137→  bgColor: string;\n   138→  borderColor: string;\n   139→  icon: string;  // Unicode checkmark/question icons\n   140→}\n   141→\n   142→const CONFIDENCE_CONFIGS: Record<ConfidenceLevel, ConfidenceConfig> = {\n   143→  confirmed: {\n   144→    label: 'Confirmed',\n   145→    textColor: 'rgb(74, 222, 128)',     // green-400\n   146→    bgColor: 'rgba(74, 222, 128, 0.1)', // green-400/10\n   147→    borderColor: 'rgba(74, 222, 128, 0.3)', // green-400/30\n   148→    icon: '\\u2713',  // checkmark\n   149→  },\n   150→  likely: {\n   151→    label: 'Likely',\n   152→    textColor: 'rgb(96, 165, 250)',     // blue-400\n   153→    bgColor: 'rgba(96, 165, 250, 0.1)', // blue-400/10\n   154→    borderColor: 'rgba(96, 165, 250, 0.3)', // blue-400/30\n   155→    icon: '\\u2248',  // approximately equal\n   156→  },\n   157→  possible: {\n   158→    label: 'Possible',\n   159→    textColor: 'rgb(163, 163, 163)',    // neutral-400\n   160→    bgColor: 'rgba(163, 163, 163, 0.1)', // neutral-400/10\n   161→    borderColor: 'rgba(163, 163, 163, 0.3)', // neutral-400/30\n   162→    icon: '?',\n   163→  },\n   164→};\n   165→\n   166→interface ConfidenceBadgeProps {\n   167→  confidence: ConfidenceLevel;\n   168→  showIcon?: boolean;\n   169→}\n   170→\n   171→export function ConfidenceBadge({ confidence, showIcon = true }: ConfidenceBadgeProps) {\n   172→  const config = CONFIDENCE_CONFIGS[confidence] || CONFIDENCE_CONFIGS.possible;\n   173→\n   174→  return (\n   175→    <span\n   176→      className=\"inline-flex items-center gap-1 px-1.5 py-0.5 sm:px-2 sm:py-0.5 rounded text-[9px] sm:text-[10px] font-medium tracking-wide whitespace-nowrap\"\n   177→      style={{\n   178→        color: config.textColor,\n   179→        backgroundColor: config.bgColor,\n   180→        border: `1px solid ${config.borderColor}`,\n   181→      }}\n   182→      title={`Detection confidence: ${config.label}`}\n   183→    >\n   184→      {showIcon && <span className=\"text-[8px] sm:text-[9px]\">{config.icon}</span>}\n   185→      {config.label}\n   186→    </span>\n   187→  );\n   188→}\n   189→\n   190→// ============================================\n   191→// PROCEDURE PHASE BADGE\n   192→// ============================================\n   193→\n   194→type ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n   195→\n   196→interface PhaseConfig {"}]},"uuid":"d33e968b-3772-43fb-9fce-891f89325d19","timestamp":"2025-12-26T14:54:03.444Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","oldString":"function SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================","newString":"function SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// CONFIDENCE BADGES - Flaw Detection Certainty\n// ============================================\n\ninterface ConfidenceConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor: string;\n  icon: string;  // Unicode checkmark/question icons\n}\n\nconst CONFIDENCE_CONFIGS: Record<ConfidenceLevel, ConfidenceConfig> = {\n  confirmed: {\n    label: 'Confirmed',\n    textColor: 'rgb(74, 222, 128)',     // green-400\n    bgColor: 'rgba(74, 222, 128, 0.1)', // green-400/10\n    borderColor: 'rgba(74, 222, 128, 0.3)', // green-400/30\n    icon: '\\u2713',  // checkmark\n  },\n  likely: {\n    label: 'Likely',\n    textColor: 'rgb(96, 165, 250)',     // blue-400\n    bgColor: 'rgba(96, 165, 250, 0.1)', // blue-400/10\n    borderColor: 'rgba(96, 165, 250, 0.3)', // blue-400/30\n    icon: '\\u2248',  // approximately equal\n  },\n  possible: {\n    label: 'Possible',\n    textColor: 'rgb(163, 163, 163)',    // neutral-400\n    bgColor: 'rgba(163, 163, 163, 0.1)', // neutral-400/10\n    borderColor: 'rgba(163, 163, 163, 0.3)', // neutral-400/30\n    icon: '?',\n  },\n};\n\ninterface ConfidenceBadgeProps {\n  confidence: ConfidenceLevel;\n  showIcon?: boolean;\n}\n\nexport function ConfidenceBadge({ confidence, showIcon = true }: ConfidenceBadgeProps) {\n  const config = CONFIDENCE_CONFIGS[confidence] || CONFIDENCE_CONFIGS.possible;\n\n  return (\n    <span\n      className=\"inline-flex items-center gap-1 px-1.5 py-0.5 sm:px-2 sm:py-0.5 rounded text-[9px] sm:text-[10px] font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: `1px solid ${config.borderColor}`,\n      }}\n      title={`Detection confidence: ${config.label}`}\n    >\n      {showIcon && <span className=\"text-[8px] sm:text-[9px]\">{config.icon}</span>}\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================","originalFile":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ChevronDown, AlertTriangle, CheckCircle, Sparkles } from 'lucide-react';\nimport { Strength, Flaw, Recommendation, getScoreColor } from '@/types/results';\nimport { ConfidenceLevel } from '@/lib/harmony-scoring';\n\n// ============================================\n// QUALITY TIER BADGES (Harmony Style) - Strengths\n// ============================================\n\ntype QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\n\ninterface QualityConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n}\n\nconst QUALITY_CONFIGS: Record<QualityTier, QualityConfig> = {\n  ideal: {\n    label: 'Ideal',\n    textColor: 'rgb(34, 211, 238)',    // cyan-400\n    bgColor: 'rgba(34, 211, 238, 0.15)', // cyan-400/15\n  },\n  excellent: {\n    label: 'Excellent',\n    textColor: 'rgb(52, 211, 153)',    // emerald-400\n    bgColor: 'rgba(52, 211, 153, 0.15)', // emerald-400/15\n  },\n  good: {\n    label: 'Good',\n    textColor: 'rgb(74, 222, 128)',    // green-400\n    bgColor: 'rgba(74, 222, 128, 0.15)', // green-400/15\n  },\n  below_average: {\n    label: 'Average',\n    textColor: 'rgb(163, 163, 163)',   // neutral-400\n    bgColor: 'rgba(163, 163, 163, 0.15)', // neutral-400/15\n  },\n};\n\nfunction QualityBadge({ quality }: { quality: QualityTier }) {\n  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// SEVERITY BADGES (Harmony Style) - Flaws\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n\ninterface SeverityConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor?: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {\n  extremely_severe: {\n    label: 'extremely severe',\n    textColor: 'rgb(248, 113, 113)',   // red-400\n    bgColor: 'rgba(248, 113, 113, 0.15)', // red-400/15\n  },\n  severe: {\n    label: 'severe',\n    textColor: 'rgb(248, 113, 113)',   // red-400\n    bgColor: 'rgba(248, 113, 113, 0.1)', // red-400/10\n    borderColor: 'rgba(248, 113, 113, 0.3)', // red-400/30\n  },\n  moderate: {\n    label: 'moderate',\n    textColor: 'rgb(251, 146, 60)',    // orange-400\n    bgColor: 'rgba(251, 146, 60, 0.1)', // orange-400/10\n    borderColor: 'rgba(251, 146, 60, 0.3)', // orange-400/30\n  },\n  minor: {\n    label: 'minor',\n    textColor: 'rgb(250, 204, 21)',    // yellow-400\n    bgColor: 'rgba(250, 204, 21, 0.1)', // yellow-400/10\n    borderColor: 'rgba(250, 204, 21, 0.3)', // yellow-400/30\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  if (harmonyLost >= 0.8) return 'extremely_severe';\n  if (harmonyLost >= 0.5) return 'severe';\n  if (harmonyLost >= 0.3) return 'moderate';\n  return 'minor';\n}\n\nfunction getSeverityFromScore(score: number): SeverityLevel {\n  if (score <= 2) return 'extremely_severe';\n  if (score <= 4) return 'severe';\n  if (score <= 6) return 'moderate';\n  return 'minor';\n}\n\nfunction SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================\n\ntype ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n\ninterface PhaseConfig {\n  textColor: string;\n  bgColor: string;\n}\n\nconst PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n  Foundational: {\n    textColor: 'rgb(52, 211, 153)',   // emerald-400\n    bgColor: 'rgba(52, 211, 153, 0.15)', // emerald-400/15\n  },\n  'Non-Invasive': {\n    textColor: 'rgb(96, 165, 250)',   // blue-400\n    bgColor: 'rgba(96, 165, 250, 0.15)', // blue-400/15\n  },\n  'Minimally Invasive': {\n    textColor: 'rgb(167, 139, 250)',  // violet-400\n    bgColor: 'rgba(167, 139, 250, 0.15)', // violet-400/15\n  },\n  Surgical: {\n    textColor: 'rgb(192, 132, 252)',  // purple-400\n    bgColor: 'rgba(192, 132, 252, 0.15)', // purple-400/15\n  },\n};\n\nfunction PhaseBadge({ phase }: { phase: ProcedurePhase }) {\n  const config = PHASE_CONFIGS[phase] || PHASE_CONFIGS['Non-Invasive'];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {phase}\n    </span>\n  );\n}\n\n// ============================================\n// CONTRIBUTING/AFFECTED RATIO ITEM\n// ============================================\n\ninterface RatioItemProps {\n  name: string;\n  score: number | string;\n  onClick?: () => void;\n  animationDelay?: number;\n}\n\nfunction RatioItem({ name, score, onClick, animationDelay = 0 }: RatioItemProps) {\n  const numericScore = typeof score === 'number' ? score : 0;\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"w-full flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-neutral-800/50 border border-neutral-700/50 transition-all duration-200 hover:border-neutral-600 hover:bg-neutral-800 text-left cursor-pointer animate-fade-in\"\n      style={{\n        animationDuration: '0.2s',\n        animationDelay: `${animationDelay}s`,\n      }}\n    >\n      <span className=\"text-xs sm:text-sm text-neutral-300 font-medium\">{name}</span>\n      <div className=\"flex items-baseline gap-0.5 sm:gap-1\">\n        <span\n          className=\"text-xs sm:text-sm font-semibold\"\n          style={{ color: typeof score === 'string' ? '#a3a3a3' : getScoreColor(numericScore) }}\n        >\n          {typeof score === 'number' ? score.toFixed(1) : score}\n        </span>\n        <span className=\"text-[10px] sm:text-xs text-neutral-500\">/10</span>\n      </div>\n    </button>\n  );\n}\n\n// ============================================\n// PLAN ITEM (Recommendation)\n// ============================================\n\ninterface PlanItemProps {\n  name: string;\n  phase: ProcedurePhase;\n  inPlan?: boolean;\n  animationDelay?: number;\n}\n\nfunction PlanItem({ name, phase, inPlan = true, animationDelay = 0 }: PlanItemProps) {\n  return (\n    <div\n      className=\"flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-neutral-800/50 border border-neutral-700/50 animate-fade-in\"\n      style={{\n        animationDuration: '0.2s',\n        animationDelay: `${animationDelay}s`,\n      }}\n    >\n      <span className=\"text-xs sm:text-sm text-neutral-300 font-medium\">{name}</span>\n      <div className=\"flex items-center gap-2\">\n        {inPlan && (\n          <span className=\"text-[9px] sm:text-[10px] px-1.5 py-0.5 rounded bg-emerald-400/15 text-emerald-400 font-medium\">\n            In Plan\n          </span>\n        )}\n        <PhaseBadge phase={phase} />\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// STRENGTH CARD (Harmony Style)\n// ============================================\n\ninterface StrengthCardProps {\n  strength: Strength;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n  animationDelay?: number;\n}\n\nexport function StrengthCard({\n  strength,\n  isExpanded = false,\n  onToggle,\n  onRatioClick,\n  animationDelay = 0,\n}: StrengthCardProps) {\n  // Get score color for the average score\n  const numericScore = typeof strength.avgScore === 'number' ? strength.avgScore : 0;\n  const scoreColor = getScoreColor(numericScore);\n\n  return (\n    <div\n      className=\"rounded-lg bg-neutral-900 border border-neutral-800/60 overflow-hidden transition-all duration-200 hover:border-neutral-700 hover:shadow-lg shadow-black/10 animate-fade-in\"\n      style={{ animationDelay: `${animationDelay}s` }}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <QualityBadge quality={strength.qualityLevel} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {strength.strengthName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n                {strength.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Score + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right\">\n              <div\n                className=\"text-lg sm:text-xl font-semibold tracking-tight transition-colors duration-200\"\n                style={{ color: scoreColor }}\n              >\n                {typeof strength.avgScore === 'number' ? strength.avgScore.toFixed(2) : strength.avgScore}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium mt-0.5\">avg /10</div>\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-500\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: 'easeInOut' }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"border-t border-neutral-800 bg-neutral-900/50 px-4 sm:px-6 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Contributing Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {strength.responsibleRatios.map((ratio, i) => (\n                  <RatioItem\n                    key={ratio.ratioId}\n                    name={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick?.(ratio)}\n                    animationDelay={i * 0.03}\n                  />\n                ))}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// FLAW CARD (Harmony Style - Areas of Improvement)\n// ============================================\n\ninterface FlawCardProps {\n  flaw: Flaw;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n  recommendations?: Recommendation[];\n  animationDelay?: number;\n}\n\nexport function FlawCard({\n  flaw,\n  isExpanded = false,\n  onToggle,\n  onRatioClick,\n  recommendations = [],\n  animationDelay = 0,\n}: FlawCardProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n\n  // Find matching recommendations for this flaw\n  const matchedRecommendations = useMemo(() => {\n    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n    return recommendations.filter(rec =>\n      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n    ).slice(0, 3); // Limit to 3 recommendations\n  }, [flaw, recommendations]);\n\n  // Map phase names\n  const mapPhase = (phase: string): ProcedurePhase => {\n    if (phase === 'Foundational') return 'Foundational';\n    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n    if (phase === 'Surgical') return 'Surgical';\n    return 'Non-Invasive';\n  };\n\n  return (\n    <div\n      className=\"rounded-lg bg-neutral-900 border border-neutral-800/60 overflow-hidden transition-all duration-200 hover:border-neutral-700 hover:shadow-lg shadow-black/10 animate-fade-in\"\n      style={{ animationDelay: `${animationDelay}s` }}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <SeverityBadge severity={severity} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-400\">\n                -{flaw.harmonyPercentageLost.toFixed(2)}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n              {flaw.rollingHarmonyPercentageLost !== undefined && (\n                <div className=\"text-[10px] text-neutral-500 font-medium pt-0.5 border-t border-neutral-800 mt-1 pt-1\">\n                  Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n                </div>\n              )}\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-500\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: 'easeInOut' }}\n            className=\"overflow-hidden\"\n          >\n            {/* Affected Ratios Section */}\n            <div className=\"border-t border-neutral-800 bg-neutral-900/50 px-4 sm:px-6 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Affected Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {flaw.responsibleRatios.map((ratio, i) => (\n                  <RatioItem\n                    key={ratio.ratioId}\n                    name={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick?.(ratio)}\n                    animationDelay={i * 0.03}\n                  />\n                ))}\n              </div>\n            </div>\n\n            {/* Your Plan Section (if there are matched recommendations) */}\n            {matchedRecommendations.length > 0 && (\n              <div className=\"border-t border-neutral-800 bg-emerald-400/5 px-4 sm:px-6 py-3 sm:py-4\">\n                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n                  <Sparkles className=\"w-3 h-3 text-emerald-400\" />\n                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-400 uppercase tracking-wider\">\n                    Your Plan\n                  </span>\n                </div>\n                <div className=\"space-y-2\">\n                  {matchedRecommendations.map((rec, i) => (\n                    <PlanItem\n                      key={rec.ref_id}\n                      name={rec.name}\n                      phase={mapPhase(rec.phase)}\n                      inPlan={true}\n                      animationDelay={i * 0.03}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// STRENGTHS SECTION (Container)\n// ============================================\n\ninterface StrengthsSectionProps {\n  strengths: Strength[];\n  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n  maxVisible?: number;\n}\n\nexport function StrengthsSection({\n  strengths,\n  onRatioClick,\n  maxVisible = 5,\n}: StrengthsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const visibleStrengths = showAll ? strengths : strengths.slice(0, maxVisible);\n  const hasMore = strengths.length > maxVisible;\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/80 border border-neutral-800/50 p-4 sm:p-6 lg:p-8\">\n      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n          Key Strengths\n        </h3>\n      </div>\n\n      <div className=\"space-y-3\">\n        {visibleStrengths.map((strength, i) => (\n          <StrengthCard\n            key={strength.id}\n            strength={strength}\n            isExpanded={expandedId === strength.id}\n            onToggle={() => setExpandedId(expandedId === strength.id ? null : strength.id)}\n            onRatioClick={onRatioClick}\n            animationDelay={i * 0.04}\n          />\n        ))}\n      </div>\n\n      {hasMore && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-6 py-3 rounded-lg bg-neutral-800 border border-neutral-700/50 hover:border-neutral-600 hover:bg-neutral-700 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show All ${strengths.length} Strengths`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// FLAWS SECTION (Areas of Improvement Container)\n// ============================================\n\ninterface FlawsSectionProps {\n  flaws: Flaw[];\n  recommendations?: Recommendation[];\n  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n  maxVisible?: number;\n}\n\nexport function FlawsSection({\n  flaws,\n  recommendations = [],\n  onRatioClick,\n  maxVisible = 5,\n}: FlawsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const visibleFlaws = showAll ? flaws : flaws.slice(0, maxVisible);\n  const hasMore = flaws.length > maxVisible;\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/80 border border-neutral-800/50 p-4 sm:p-6 lg:p-8\">\n      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n          Areas of Improvement\n        </h3>\n      </div>\n\n      <div className=\"space-y-3\">\n        {visibleFlaws.map((flaw, i) => (\n          <FlawCard\n            key={flaw.id}\n            flaw={flaw}\n            isExpanded={expandedId === flaw.id}\n            onToggle={() => setExpandedId(expandedId === flaw.id ? null : flaw.id)}\n            onRatioClick={onRatioClick}\n            recommendations={recommendations}\n            animationDelay={i * 0.04}\n          />\n        ))}\n      </div>\n\n      {hasMore && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-6 py-3 rounded-lg bg-neutral-800 border border-neutral-700/50 hover:border-neutral-600 hover:bg-neutral-700 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show All ${flaws.length} Areas`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// COMPACT BADGES (for use elsewhere)\n// ============================================\n\ninterface CompactStrengthBadgeProps {\n  strength: Strength;\n  onClick?: () => void;\n}\n\nexport function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-green-400/10 border border-green-400/30 rounded-lg hover:bg-green-400/20 transition-colors\"\n    >\n      <CheckCircle size={12} className=\"text-green-400\" />\n      <span className=\"text-xs text-green-400\">{strength.strengthName}</span>\n    </button>\n  );\n}\n\ninterface CompactFlawBadgeProps {\n  flaw: Flaw;\n  onClick?: () => void;\n}\n\nexport function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-lg hover:opacity-80 transition-all\"\n      style={{\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      <AlertTriangle size={12} style={{ color: config.textColor }} />\n      <span className=\"text-xs\" style={{ color: config.textColor }}>{flaw.flawName}</span>\n    </button>\n  );\n}\n\n// Export utility functions\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\nexport { SeverityBadge };\nexport type { SeverityLevel };\n","structuredPatch":[{"oldStart":128,"oldLines":6,"newStart":128,"newLines":66,"lines":[" }"," "," // ============================================","+// CONFIDENCE BADGES - Flaw Detection Certainty","+// ============================================","+","+interface ConfidenceConfig {","+  label: string;","+  textColor: string;","+  bgColor: string;","+  borderColor: string;","+  icon: string;  // Unicode checkmark/question icons","+}","+","+const CONFIDENCE_CONFIGS: Record<ConfidenceLevel, ConfidenceConfig> = {","+  confirmed: {","+    label: 'Confirmed',","+    textColor: 'rgb(74, 222, 128)',     // green-400","+    bgColor: 'rgba(74, 222, 128, 0.1)', // green-400/10","+    borderColor: 'rgba(74, 222, 128, 0.3)', // green-400/30","+    icon: '\\u2713',  // checkmark","+  },","+  likely: {","+    label: 'Likely',","+    textColor: 'rgb(96, 165, 250)',     // blue-400","+    bgColor: 'rgba(96, 165, 250, 0.1)', // blue-400/10","+    borderColor: 'rgba(96, 165, 250, 0.3)', // blue-400/30","+    icon: '\\u2248',  // approximately equal","+  },","+  possible: {","+    label: 'Possible',","+    textColor: 'rgb(163, 163, 163)',    // neutral-400","+    bgColor: 'rgba(163, 163, 163, 0.1)', // neutral-400/10","+    borderColor: 'rgba(163, 163, 163, 0.3)', // neutral-400/30","+    icon: '?',","+  },","+};","+","+interface ConfidenceBadgeProps {","+  confidence: ConfidenceLevel;","+  showIcon?: boolean;","+}","+","+export function ConfidenceBadge({ confidence, showIcon = true }: ConfidenceBadgeProps) {","+  const config = CONFIDENCE_CONFIGS[confidence] || CONFIDENCE_CONFIGS.possible;","+","+  return (","+    <span","+      className=\"inline-flex items-center gap-1 px-1.5 py-0.5 sm:px-2 sm:py-0.5 rounded text-[9px] sm:text-[10px] font-medium tracking-wide whitespace-nowrap\"","+      style={{","+        color: config.textColor,","+        backgroundColor: config.bgColor,","+        border: `1px solid ${config.borderColor}`,","+      }}","+      title={`Detection confidence: ${config.label}`}","+    >","+      {showIcon && <span className=\"text-[8px] sm:text-[9px]\">{config.icon}</span>}","+      {config.label}","+    </span>","+  );","+}","+","+// ============================================"," // PROCEDURE PHASE BADGE"," // ============================================"," "]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"d33e968b-3772-43fb-9fce-891f89325d19","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01BPQ2Z1QhSNNPuh33umWdHV","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me find the `FlawCard` component and update it to display the confidence badge:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2492,"cache_read_input_tokens":94134,"cache_creation":{"ephemeral_5m_input_tokens":2492,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVVNxAxStRP3N3zs5L6F","type":"assistant","uuid":"e28260b2-1c1f-491f-9a02-8218b31b4d11","timestamp":"2025-12-26T14:54:09.948Z"}
{"parentUuid":"e28260b2-1c1f-491f-9a02-8218b31b4d11","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01BPQ2Z1QhSNNPuh33umWdHV","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01EXagMcHpky87JbVA4RxLxm","name":"Grep","input":{"pattern":"export function FlawCard","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","output_mode":"content","-n":true}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2492,"cache_read_input_tokens":94134,"cache_creation":{"ephemeral_5m_input_tokens":2492,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVVNxAxStRP3N3zs5L6F","type":"assistant","uuid":"1796b76a-2b9d-476d-9e70-ab00758ae766","timestamp":"2025-12-26T14:54:11.313Z"}
{"parentUuid":"1796b76a-2b9d-476d-9e70-ab00758ae766","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01EXagMcHpky87JbVA4RxLxm","type":"tool_result","content":"420:export function FlawCard({"}]},"uuid":"0c12eabe-69ff-4473-8dce-96c2e0539d99","timestamp":"2025-12-26T14:54:11.908Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"420:export function FlawCard({","numLines":1}}
{"parentUuid":"0c12eabe-69ff-4473-8dce-96c2e0539d99","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01FHawtgHWraw6R1dvXjAF34","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GPDiqixtYHd1GvnGuQitEF","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","offset":405,"limit":100}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":290,"cache_read_input_tokens":96626,"cache_creation":{"ephemeral_5m_input_tokens":290,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"}},"requestId":"req_011CWVVPaPoY3YVUXvzDJqHL","type":"assistant","uuid":"97f591b0-15b5-4984-bec8-d541cc339ca1","timestamp":"2025-12-26T14:54:18.141Z"}
{"parentUuid":"97f591b0-15b5-4984-bec8-d541cc339ca1","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GPDiqixtYHd1GvnGuQitEF","type":"tool_result","content":"   405→}\n   406→\n   407→// ============================================\n   408→// FLAW CARD (Harmony Style - Areas of Improvement)\n   409→// ============================================\n   410→\n   411→interface FlawCardProps {\n   412→  flaw: Flaw;\n   413→  isExpanded?: boolean;\n   414→  onToggle?: () => void;\n   415→  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n   416→  recommendations?: Recommendation[];\n   417→  animationDelay?: number;\n   418→}\n   419→\n   420→export function FlawCard({\n   421→  flaw,\n   422→  isExpanded = false,\n   423→  onToggle,\n   424→  onRatioClick,\n   425→  recommendations = [],\n   426→  animationDelay = 0,\n   427→}: FlawCardProps) {\n   428→  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n   429→\n   430→  // Find matching recommendations for this flaw\n   431→  const matchedRecommendations = useMemo(() => {\n   432→    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n   433→    return recommendations.filter(rec =>\n   434→      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n   435→      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n   436→    ).slice(0, 3); // Limit to 3 recommendations\n   437→  }, [flaw, recommendations]);\n   438→\n   439→  // Map phase names\n   440→  const mapPhase = (phase: string): ProcedurePhase => {\n   441→    if (phase === 'Foundational') return 'Foundational';\n   442→    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n   443→    if (phase === 'Surgical') return 'Surgical';\n   444→    return 'Non-Invasive';\n   445→  };\n   446→\n   447→  return (\n   448→    <div\n   449→      className=\"rounded-lg bg-neutral-900 border border-neutral-800/60 overflow-hidden transition-all duration-200 hover:border-neutral-700 hover:shadow-lg shadow-black/10 animate-fade-in\"\n   450→      style={{ animationDelay: `${animationDelay}s` }}\n   451→    >\n   452→      {/* Header */}\n   453→      <button\n   454→        onClick={onToggle}\n   455→        className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"\n   456→      >\n   457→        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n   458→          {/* Left: Badge + Content */}\n   459→          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n   460→            <SeverityBadge severity={severity} />\n   461→            <div className=\"flex-1 min-w-0\">\n   462→              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n   463→                {flaw.flawName}\n   464→              </h4>\n   465→              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n   466→                {flaw.summary}\n   467→              </p>\n   468→            </div>\n   469→          </div>\n   470→\n   471→          {/* Right: Points impact + Chevron */}\n   472→          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n   473→            <div className=\"text-right space-y-1\">\n   474→              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-400\">\n   475→                -{flaw.harmonyPercentageLost.toFixed(2)}\n   476→              </div>\n   477→              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n   478→              {flaw.rollingHarmonyPercentageLost !== undefined && (\n   479→                <div className=\"text-[10px] text-neutral-500 font-medium pt-0.5 border-t border-neutral-800 mt-1 pt-1\">\n   480→                  Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n   481→                </div>\n   482→              )}\n   483→            </div>\n   484→            <motion.div\n   485→              animate={{ rotate: isExpanded ? 180 : 0 }}\n   486→              transition={{ duration: 0.3 }}\n   487→            >\n   488→              <ChevronDown className=\"w-4 h-4 text-neutral-500\" />\n   489→            </motion.div>\n   490→          </div>\n   491→        </div>\n   492→      </button>\n   493→\n   494→      {/* Expanded Content */}\n   495→      <AnimatePresence initial={false}>\n   496→        {isExpanded && (\n   497→          <motion.div\n   498→            initial={{ height: 0, opacity: 0 }}\n   499→            animate={{ height: 'auto', opacity: 1 }}\n   500→            exit={{ height: 0, opacity: 0 }}\n   501→            transition={{ duration: 0.3, ease: 'easeInOut' }}\n   502→            className=\"overflow-hidden\"\n   503→          >\n   504→            {/* Affected Ratios Section */}\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"0792fe7a-99e7-42fa-a166-d275b82885c2","timestamp":"2025-12-26T14:54:18.227Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","content":"}\n\n// ============================================\n// FLAW CARD (Harmony Style - Areas of Improvement)\n// ============================================\n\ninterface FlawCardProps {\n  flaw: Flaw;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n  recommendations?: Recommendation[];\n  animationDelay?: number;\n}\n\nexport function FlawCard({\n  flaw,\n  isExpanded = false,\n  onToggle,\n  onRatioClick,\n  recommendations = [],\n  animationDelay = 0,\n}: FlawCardProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n\n  // Find matching recommendations for this flaw\n  const matchedRecommendations = useMemo(() => {\n    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n    return recommendations.filter(rec =>\n      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n    ).slice(0, 3); // Limit to 3 recommendations\n  }, [flaw, recommendations]);\n\n  // Map phase names\n  const mapPhase = (phase: string): ProcedurePhase => {\n    if (phase === 'Foundational') return 'Foundational';\n    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n    if (phase === 'Surgical') return 'Surgical';\n    return 'Non-Invasive';\n  };\n\n  return (\n    <div\n      className=\"rounded-lg bg-neutral-900 border border-neutral-800/60 overflow-hidden transition-all duration-200 hover:border-neutral-700 hover:shadow-lg shadow-black/10 animate-fade-in\"\n      style={{ animationDelay: `${animationDelay}s` }}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <SeverityBadge severity={severity} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-400\">\n                -{flaw.harmonyPercentageLost.toFixed(2)}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n              {flaw.rollingHarmonyPercentageLost !== undefined && (\n                <div className=\"text-[10px] text-neutral-500 font-medium pt-0.5 border-t border-neutral-800 mt-1 pt-1\">\n                  Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n                </div>\n              )}\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-500\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: 'easeInOut' }}\n            className=\"overflow-hidden\"\n          >\n            {/* Affected Ratios Section */}","numLines":100,"startLine":405,"totalLines":721}}}
{"parentUuid":"0792fe7a-99e7-42fa-a166-d275b82885c2","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01WSiZizZQHxkfEZ539xQeaZ","type":"message","role":"assistant","content":[{"type":"text","text":"Now I'll update the FlawCard component to show the confidence badge alongside the severity badge:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1805,"cache_read_input_tokens":96916,"cache_creation":{"ephemeral_5m_input_tokens":1805,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWVVQ3vWqnZXZV1tC1CaN","type":"assistant","uuid":"f671663e-48e1-49b5-9942-e50fe027af15","timestamp":"2025-12-26T14:54:23.526Z"}
{"parentUuid":"f671663e-48e1-49b5-9942-e50fe027af15","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01WSiZizZQHxkfEZ539xQeaZ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MQh21AUGU5otQtnTxEFSiK","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","old_string":"        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <SeverityBadge severity={severity} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}","new_string":"        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badges + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <div className=\"flex flex-col gap-1\">\n              <SeverityBadge severity={severity} />\n              {flaw.confidence && <ConfidenceBadge confidence={flaw.confidence} />}\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1805,"cache_read_input_tokens":96916,"cache_creation":{"ephemeral_5m_input_tokens":1805,"ephemeral_1h_input_tokens":0},"output_tokens":636,"service_tier":"standard"}},"requestId":"req_011CWVVQ3vWqnZXZV1tC1CaN","type":"assistant","uuid":"9d3c966b-0967-46cf-a2a1-7733286438fc","timestamp":"2025-12-26T14:54:31.439Z"}
{"parentUuid":"9d3c966b-0967-46cf-a2a1-7733286438fc","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MQh21AUGU5otQtnTxEFSiK","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   453→      <button\n   454→        onClick={onToggle}\n   455→        className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"\n   456→      >\n   457→        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n   458→          {/* Left: Badges + Content */}\n   459→          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n   460→            <div className=\"flex flex-col gap-1\">\n   461→              <SeverityBadge severity={severity} />\n   462→              {flaw.confidence && <ConfidenceBadge confidence={flaw.confidence} />}\n   463→            </div>\n   464→            <div className=\"flex-1 min-w-0\">\n   465→              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n   466→                {flaw.flawName}\n   467→              </h4>\n   468→              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n   469→                {flaw.summary}\n   470→              </p>\n   471→            </div>\n   472→          </div>\n   473→\n   474→          {/* Right: Points impact + Chevron */}\n   475→          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n   476→            <div className=\"text-right space-y-1\">\n   477→              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-400\">\n   478→                -{flaw.harmonyPercentageLost.toFixed(2)}"}]},"uuid":"f7d75175-d6bf-411b-8aeb-748aa2d0a6d8","timestamp":"2025-12-26T14:54:31.488Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","oldString":"        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <SeverityBadge severity={severity} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}","newString":"        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badges + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <div className=\"flex flex-col gap-1\">\n              <SeverityBadge severity={severity} />\n              {flaw.confidence && <ConfidenceBadge confidence={flaw.confidence} />}\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}","originalFile":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ChevronDown, AlertTriangle, CheckCircle, Sparkles } from 'lucide-react';\nimport { Strength, Flaw, Recommendation, getScoreColor } from '@/types/results';\nimport { ConfidenceLevel } from '@/lib/harmony-scoring';\n\n// ============================================\n// QUALITY TIER BADGES (Harmony Style) - Strengths\n// ============================================\n\ntype QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\n\ninterface QualityConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n}\n\nconst QUALITY_CONFIGS: Record<QualityTier, QualityConfig> = {\n  ideal: {\n    label: 'Ideal',\n    textColor: 'rgb(34, 211, 238)',    // cyan-400\n    bgColor: 'rgba(34, 211, 238, 0.15)', // cyan-400/15\n  },\n  excellent: {\n    label: 'Excellent',\n    textColor: 'rgb(52, 211, 153)',    // emerald-400\n    bgColor: 'rgba(52, 211, 153, 0.15)', // emerald-400/15\n  },\n  good: {\n    label: 'Good',\n    textColor: 'rgb(74, 222, 128)',    // green-400\n    bgColor: 'rgba(74, 222, 128, 0.15)', // green-400/15\n  },\n  below_average: {\n    label: 'Average',\n    textColor: 'rgb(163, 163, 163)',   // neutral-400\n    bgColor: 'rgba(163, 163, 163, 0.15)', // neutral-400/15\n  },\n};\n\nfunction QualityBadge({ quality }: { quality: QualityTier }) {\n  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// SEVERITY BADGES (Harmony Style) - Flaws\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n\ninterface SeverityConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor?: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {\n  extremely_severe: {\n    label: 'extremely severe',\n    textColor: 'rgb(248, 113, 113)',   // red-400\n    bgColor: 'rgba(248, 113, 113, 0.15)', // red-400/15\n  },\n  severe: {\n    label: 'severe',\n    textColor: 'rgb(248, 113, 113)',   // red-400\n    bgColor: 'rgba(248, 113, 113, 0.1)', // red-400/10\n    borderColor: 'rgba(248, 113, 113, 0.3)', // red-400/30\n  },\n  moderate: {\n    label: 'moderate',\n    textColor: 'rgb(251, 146, 60)',    // orange-400\n    bgColor: 'rgba(251, 146, 60, 0.1)', // orange-400/10\n    borderColor: 'rgba(251, 146, 60, 0.3)', // orange-400/30\n  },\n  minor: {\n    label: 'minor',\n    textColor: 'rgb(250, 204, 21)',    // yellow-400\n    bgColor: 'rgba(250, 204, 21, 0.1)', // yellow-400/10\n    borderColor: 'rgba(250, 204, 21, 0.3)', // yellow-400/30\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  if (harmonyLost >= 0.8) return 'extremely_severe';\n  if (harmonyLost >= 0.5) return 'severe';\n  if (harmonyLost >= 0.3) return 'moderate';\n  return 'minor';\n}\n\nfunction getSeverityFromScore(score: number): SeverityLevel {\n  if (score <= 2) return 'extremely_severe';\n  if (score <= 4) return 'severe';\n  if (score <= 6) return 'moderate';\n  return 'minor';\n}\n\nfunction SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// CONFIDENCE BADGES - Flaw Detection Certainty\n// ============================================\n\ninterface ConfidenceConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor: string;\n  icon: string;  // Unicode checkmark/question icons\n}\n\nconst CONFIDENCE_CONFIGS: Record<ConfidenceLevel, ConfidenceConfig> = {\n  confirmed: {\n    label: 'Confirmed',\n    textColor: 'rgb(74, 222, 128)',     // green-400\n    bgColor: 'rgba(74, 222, 128, 0.1)', // green-400/10\n    borderColor: 'rgba(74, 222, 128, 0.3)', // green-400/30\n    icon: '\\u2713',  // checkmark\n  },\n  likely: {\n    label: 'Likely',\n    textColor: 'rgb(96, 165, 250)',     // blue-400\n    bgColor: 'rgba(96, 165, 250, 0.1)', // blue-400/10\n    borderColor: 'rgba(96, 165, 250, 0.3)', // blue-400/30\n    icon: '\\u2248',  // approximately equal\n  },\n  possible: {\n    label: 'Possible',\n    textColor: 'rgb(163, 163, 163)',    // neutral-400\n    bgColor: 'rgba(163, 163, 163, 0.1)', // neutral-400/10\n    borderColor: 'rgba(163, 163, 163, 0.3)', // neutral-400/30\n    icon: '?',\n  },\n};\n\ninterface ConfidenceBadgeProps {\n  confidence: ConfidenceLevel;\n  showIcon?: boolean;\n}\n\nexport function ConfidenceBadge({ confidence, showIcon = true }: ConfidenceBadgeProps) {\n  const config = CONFIDENCE_CONFIGS[confidence] || CONFIDENCE_CONFIGS.possible;\n\n  return (\n    <span\n      className=\"inline-flex items-center gap-1 px-1.5 py-0.5 sm:px-2 sm:py-0.5 rounded text-[9px] sm:text-[10px] font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: `1px solid ${config.borderColor}`,\n      }}\n      title={`Detection confidence: ${config.label}`}\n    >\n      {showIcon && <span className=\"text-[8px] sm:text-[9px]\">{config.icon}</span>}\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================\n\ntype ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n\ninterface PhaseConfig {\n  textColor: string;\n  bgColor: string;\n}\n\nconst PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n  Foundational: {\n    textColor: 'rgb(52, 211, 153)',   // emerald-400\n    bgColor: 'rgba(52, 211, 153, 0.15)', // emerald-400/15\n  },\n  'Non-Invasive': {\n    textColor: 'rgb(96, 165, 250)',   // blue-400\n    bgColor: 'rgba(96, 165, 250, 0.15)', // blue-400/15\n  },\n  'Minimally Invasive': {\n    textColor: 'rgb(167, 139, 250)',  // violet-400\n    bgColor: 'rgba(167, 139, 250, 0.15)', // violet-400/15\n  },\n  Surgical: {\n    textColor: 'rgb(192, 132, 252)',  // purple-400\n    bgColor: 'rgba(192, 132, 252, 0.15)', // purple-400/15\n  },\n};\n\nfunction PhaseBadge({ phase }: { phase: ProcedurePhase }) {\n  const config = PHASE_CONFIGS[phase] || PHASE_CONFIGS['Non-Invasive'];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {phase}\n    </span>\n  );\n}\n\n// ============================================\n// CONTRIBUTING/AFFECTED RATIO ITEM\n// ============================================\n\ninterface RatioItemProps {\n  name: string;\n  score: number | string;\n  onClick?: () => void;\n  animationDelay?: number;\n}\n\nfunction RatioItem({ name, score, onClick, animationDelay = 0 }: RatioItemProps) {\n  const numericScore = typeof score === 'number' ? score : 0;\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"w-full flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-neutral-800/50 border border-neutral-700/50 transition-all duration-200 hover:border-neutral-600 hover:bg-neutral-800 text-left cursor-pointer animate-fade-in\"\n      style={{\n        animationDuration: '0.2s',\n        animationDelay: `${animationDelay}s`,\n      }}\n    >\n      <span className=\"text-xs sm:text-sm text-neutral-300 font-medium\">{name}</span>\n      <div className=\"flex items-baseline gap-0.5 sm:gap-1\">\n        <span\n          className=\"text-xs sm:text-sm font-semibold\"\n          style={{ color: typeof score === 'string' ? '#a3a3a3' : getScoreColor(numericScore) }}\n        >\n          {typeof score === 'number' ? score.toFixed(1) : score}\n        </span>\n        <span className=\"text-[10px] sm:text-xs text-neutral-500\">/10</span>\n      </div>\n    </button>\n  );\n}\n\n// ============================================\n// PLAN ITEM (Recommendation)\n// ============================================\n\ninterface PlanItemProps {\n  name: string;\n  phase: ProcedurePhase;\n  inPlan?: boolean;\n  animationDelay?: number;\n}\n\nfunction PlanItem({ name, phase, inPlan = true, animationDelay = 0 }: PlanItemProps) {\n  return (\n    <div\n      className=\"flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-neutral-800/50 border border-neutral-700/50 animate-fade-in\"\n      style={{\n        animationDuration: '0.2s',\n        animationDelay: `${animationDelay}s`,\n      }}\n    >\n      <span className=\"text-xs sm:text-sm text-neutral-300 font-medium\">{name}</span>\n      <div className=\"flex items-center gap-2\">\n        {inPlan && (\n          <span className=\"text-[9px] sm:text-[10px] px-1.5 py-0.5 rounded bg-emerald-400/15 text-emerald-400 font-medium\">\n            In Plan\n          </span>\n        )}\n        <PhaseBadge phase={phase} />\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// STRENGTH CARD (Harmony Style)\n// ============================================\n\ninterface StrengthCardProps {\n  strength: Strength;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n  animationDelay?: number;\n}\n\nexport function StrengthCard({\n  strength,\n  isExpanded = false,\n  onToggle,\n  onRatioClick,\n  animationDelay = 0,\n}: StrengthCardProps) {\n  // Get score color for the average score\n  const numericScore = typeof strength.avgScore === 'number' ? strength.avgScore : 0;\n  const scoreColor = getScoreColor(numericScore);\n\n  return (\n    <div\n      className=\"rounded-lg bg-neutral-900 border border-neutral-800/60 overflow-hidden transition-all duration-200 hover:border-neutral-700 hover:shadow-lg shadow-black/10 animate-fade-in\"\n      style={{ animationDelay: `${animationDelay}s` }}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <QualityBadge quality={strength.qualityLevel} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {strength.strengthName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n                {strength.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Score + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right\">\n              <div\n                className=\"text-lg sm:text-xl font-semibold tracking-tight transition-colors duration-200\"\n                style={{ color: scoreColor }}\n              >\n                {typeof strength.avgScore === 'number' ? strength.avgScore.toFixed(2) : strength.avgScore}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium mt-0.5\">avg /10</div>\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-500\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: 'easeInOut' }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"border-t border-neutral-800 bg-neutral-900/50 px-4 sm:px-6 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Contributing Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {strength.responsibleRatios.map((ratio, i) => (\n                  <RatioItem\n                    key={ratio.ratioId}\n                    name={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick?.(ratio)}\n                    animationDelay={i * 0.03}\n                  />\n                ))}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// FLAW CARD (Harmony Style - Areas of Improvement)\n// ============================================\n\ninterface FlawCardProps {\n  flaw: Flaw;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n  recommendations?: Recommendation[];\n  animationDelay?: number;\n}\n\nexport function FlawCard({\n  flaw,\n  isExpanded = false,\n  onToggle,\n  onRatioClick,\n  recommendations = [],\n  animationDelay = 0,\n}: FlawCardProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n\n  // Find matching recommendations for this flaw\n  const matchedRecommendations = useMemo(() => {\n    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n    return recommendations.filter(rec =>\n      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n    ).slice(0, 3); // Limit to 3 recommendations\n  }, [flaw, recommendations]);\n\n  // Map phase names\n  const mapPhase = (phase: string): ProcedurePhase => {\n    if (phase === 'Foundational') return 'Foundational';\n    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n    if (phase === 'Surgical') return 'Surgical';\n    return 'Non-Invasive';\n  };\n\n  return (\n    <div\n      className=\"rounded-lg bg-neutral-900 border border-neutral-800/60 overflow-hidden transition-all duration-200 hover:border-neutral-700 hover:shadow-lg shadow-black/10 animate-fade-in\"\n      style={{ animationDelay: `${animationDelay}s` }}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <SeverityBadge severity={severity} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-400\">\n                -{flaw.harmonyPercentageLost.toFixed(2)}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n              {flaw.rollingHarmonyPercentageLost !== undefined && (\n                <div className=\"text-[10px] text-neutral-500 font-medium pt-0.5 border-t border-neutral-800 mt-1 pt-1\">\n                  Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n                </div>\n              )}\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-500\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: 'easeInOut' }}\n            className=\"overflow-hidden\"\n          >\n            {/* Affected Ratios Section */}\n            <div className=\"border-t border-neutral-800 bg-neutral-900/50 px-4 sm:px-6 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Affected Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {flaw.responsibleRatios.map((ratio, i) => (\n                  <RatioItem\n                    key={ratio.ratioId}\n                    name={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick?.(ratio)}\n                    animationDelay={i * 0.03}\n                  />\n                ))}\n              </div>\n            </div>\n\n            {/* Your Plan Section (if there are matched recommendations) */}\n            {matchedRecommendations.length > 0 && (\n              <div className=\"border-t border-neutral-800 bg-emerald-400/5 px-4 sm:px-6 py-3 sm:py-4\">\n                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n                  <Sparkles className=\"w-3 h-3 text-emerald-400\" />\n                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-400 uppercase tracking-wider\">\n                    Your Plan\n                  </span>\n                </div>\n                <div className=\"space-y-2\">\n                  {matchedRecommendations.map((rec, i) => (\n                    <PlanItem\n                      key={rec.ref_id}\n                      name={rec.name}\n                      phase={mapPhase(rec.phase)}\n                      inPlan={true}\n                      animationDelay={i * 0.03}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// STRENGTHS SECTION (Container)\n// ============================================\n\ninterface StrengthsSectionProps {\n  strengths: Strength[];\n  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n  maxVisible?: number;\n}\n\nexport function StrengthsSection({\n  strengths,\n  onRatioClick,\n  maxVisible = 5,\n}: StrengthsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const visibleStrengths = showAll ? strengths : strengths.slice(0, maxVisible);\n  const hasMore = strengths.length > maxVisible;\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/80 border border-neutral-800/50 p-4 sm:p-6 lg:p-8\">\n      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n          Key Strengths\n        </h3>\n      </div>\n\n      <div className=\"space-y-3\">\n        {visibleStrengths.map((strength, i) => (\n          <StrengthCard\n            key={strength.id}\n            strength={strength}\n            isExpanded={expandedId === strength.id}\n            onToggle={() => setExpandedId(expandedId === strength.id ? null : strength.id)}\n            onRatioClick={onRatioClick}\n            animationDelay={i * 0.04}\n          />\n        ))}\n      </div>\n\n      {hasMore && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-6 py-3 rounded-lg bg-neutral-800 border border-neutral-700/50 hover:border-neutral-600 hover:bg-neutral-700 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show All ${strengths.length} Strengths`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// FLAWS SECTION (Areas of Improvement Container)\n// ============================================\n\ninterface FlawsSectionProps {\n  flaws: Flaw[];\n  recommendations?: Recommendation[];\n  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n  maxVisible?: number;\n}\n\nexport function FlawsSection({\n  flaws,\n  recommendations = [],\n  onRatioClick,\n  maxVisible = 5,\n}: FlawsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const visibleFlaws = showAll ? flaws : flaws.slice(0, maxVisible);\n  const hasMore = flaws.length > maxVisible;\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/80 border border-neutral-800/50 p-4 sm:p-6 lg:p-8\">\n      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n          Areas of Improvement\n        </h3>\n      </div>\n\n      <div className=\"space-y-3\">\n        {visibleFlaws.map((flaw, i) => (\n          <FlawCard\n            key={flaw.id}\n            flaw={flaw}\n            isExpanded={expandedId === flaw.id}\n            onToggle={() => setExpandedId(expandedId === flaw.id ? null : flaw.id)}\n            onRatioClick={onRatioClick}\n            recommendations={recommendations}\n            animationDelay={i * 0.04}\n          />\n        ))}\n      </div>\n\n      {hasMore && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-6 py-3 rounded-lg bg-neutral-800 border border-neutral-700/50 hover:border-neutral-600 hover:bg-neutral-700 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show All ${flaws.length} Areas`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// COMPACT BADGES (for use elsewhere)\n// ============================================\n\ninterface CompactStrengthBadgeProps {\n  strength: Strength;\n  onClick?: () => void;\n}\n\nexport function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-green-400/10 border border-green-400/30 rounded-lg hover:bg-green-400/20 transition-colors\"\n    >\n      <CheckCircle size={12} className=\"text-green-400\" />\n      <span className=\"text-xs text-green-400\">{strength.strengthName}</span>\n    </button>\n  );\n}\n\ninterface CompactFlawBadgeProps {\n  flaw: Flaw;\n  onClick?: () => void;\n}\n\nexport function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-lg hover:opacity-80 transition-all\"\n      style={{\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      <AlertTriangle size={12} style={{ color: config.textColor }} />\n      <span className=\"text-xs\" style={{ color: config.textColor }}>{flaw.flawName}</span>\n    </button>\n  );\n}\n\n// Export utility functions\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\nexport { SeverityBadge };\nexport type { SeverityLevel };\n","structuredPatch":[{"oldStart":455,"oldLines":9,"newStart":455,"newLines":12,"lines":["         className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"","       >","         <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">","-          {/* Left: Badge + Content */}","+          {/* Left: Badges + Content */}","           <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">","-            <SeverityBadge severity={severity} />","+            <div className=\"flex flex-col gap-1\">","+              <SeverityBadge severity={severity} />","+              {flaw.confidence && <ConfidenceBadge confidence={flaw.confidence} />}","+            </div>","             <div className=\"flex-1 min-w-0\">","               <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">","                 {flaw.flawName}"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"f7d75175-d6bf-411b-8aeb-748aa2d0a6d8","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01KeHbWUTEY2ZkdpYDpivBpK","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me also update the `KeyStrengthsFlaws.tsx` component to display the confidence badge. Let me check that file:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1330,"cache_read_input_tokens":98721,"cache_creation":{"ephemeral_5m_input_tokens":1330,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVR28dx828c2NLYTzNQ","type":"assistant","uuid":"2d85b6d0-b516-4d8e-80c0-94db7568695d","timestamp":"2025-12-26T14:54:35.405Z"}
{"parentUuid":"2d85b6d0-b516-4d8e-80c0-94db7568695d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01KeHbWUTEY2ZkdpYDpivBpK","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JPqoAfXPMbURArCYbCHiMq","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","offset":395,"limit":120}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1330,"cache_read_input_tokens":98721,"cache_creation":{"ephemeral_5m_input_tokens":1330,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVR28dx828c2NLYTzNQ","type":"assistant","uuid":"6928f65b-78f9-48b5-ba6a-270e953522ac","timestamp":"2025-12-26T14:54:36.694Z"}
{"parentUuid":"6928f65b-78f9-48b5-ba6a-270e953522ac","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JPqoAfXPMbURArCYbCHiMq","type":"tool_result","content":"   395→      transition={{ duration: 0.3, delay: animationDelay }}\n   396→      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-red-500/30' : 'border-neutral-800 hover:border-neutral-700'\n   397→        }`}\n   398→    >\n   399→      {/* Header Button */}\n   400→      <button\n   401→        onClick={onToggle}\n   402→        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n   403→      >\n   404→        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n   405→          {/* Left: Badge + Content */}\n   406→          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n   407→            <SeverityBadge severity={severity} />\n   408→            <div className=\"flex-1 min-w-0\">\n   409→              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n   410→                {flaw.flawName}\n   411→              </h4>\n   412→              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n   413→                {flaw.summary}\n   414→              </p>\n   415→            </div>\n   416→          </div>\n   417→\n   418→          {/* Right: Points impact + Chevron */}\n   419→          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n   420→            <div className=\"text-right space-y-1\">\n   421→              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-500\">\n   422→                -{(typeof flaw.harmonyPercentageLost === 'number' && Number.isFinite(flaw.harmonyPercentageLost)\n   423→                  ? flaw.harmonyPercentageLost\n   424→                  : 0\n   425→                ).toFixed(2)}\n   426→              </div>\n   427→              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n   428→              {flaw.rollingHarmonyPercentageLost !== undefined &&\n   429→                typeof flaw.rollingHarmonyPercentageLost === 'number' &&\n   430→                Number.isFinite(flaw.rollingHarmonyPercentageLost) && (\n   431→                  <div className=\"text-[10px] text-neutral-600 font-medium pt-0.5 border-t border-neutral-700 mt-1\">\n   432→                    Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n   433→                  </div>\n   434→                )}\n   435→            </div>\n   436→            <motion.div\n   437→              animate={{ rotate: isExpanded ? 180 : 0 }}\n   438→              transition={{ duration: 0.3 }}\n   439→            >\n   440→              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n   441→            </motion.div>\n   442→          </div>\n   443→        </div>\n   444→      </button>\n   445→\n   446→      {/* Expanded Content */}\n   447→      <AnimatePresence initial={false}>\n   448→        {isExpanded && (\n   449→          <motion.div\n   450→            initial={{ height: 0, opacity: 0 }}\n   451→            animate={{ height: 'auto', opacity: 1 }}\n   452→            exit={{ height: 0, opacity: 0 }}\n   453→            transition={{ duration: 0.3 }}\n   454→            className=\"overflow-hidden\"\n   455→          >\n   456→            {/* Affected Ratios Section */}\n   457→            <div className=\"border-t border-neutral-800 bg-neutral-800/30 px-4 sm:px-5 py-3 sm:py-4\">\n   458→              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n   459→                Affected Ratios\n   460→              </div>\n   461→              <div className=\"space-y-2\">\n   462→                {flaw.responsibleRatios.map((ratio, i) => (\n   463→                  <ContributingRatioButton\n   464→                    key={ratio.ratioId}\n   465→                    ratioName={ratio.ratioName}\n   466→                    score={ratio.score}\n   467→                    onClick={() => onRatioClick(ratio)}\n   468→                    animationDelay={i * 0.05}\n   469→                  />\n   470→                ))}\n   471→              </div>\n   472→            </div>\n   473→\n   474→            {/* Your Plan Section (if there are matched recommendations) */}\n   475→            {matchedRecommendations.length > 0 && (\n   476→              <div className=\"border-t border-neutral-800 bg-emerald-900/10 px-4 sm:px-5 py-3 sm:py-4\">\n   477→                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n   478→                  <Sparkles className=\"w-3 h-3 text-emerald-400\" />\n   479→                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-400 uppercase tracking-wider\">\n   480→                    Your Plan\n   481→                  </span>\n   482→                </div>\n   483→                <div className=\"space-y-2\">\n   484→                  {matchedRecommendations.map((rec, i) => (\n   485→                    <PlanItem\n   486→                      key={rec.ref_id}\n   487→                      name={rec.name}\n   488→                      phase={mapPhase(rec.phase)}\n   489→                      animationDelay={i * 0.05}\n   490→                    />\n   491→                  ))}\n   492→                </div>\n   493→              </div>\n   494→            )}\n   495→          </motion.div>\n   496→        )}\n   497→      </AnimatePresence>\n   498→    </motion.div>\n   499→  );\n   500→}\n   501→\n   502→// ============================================\n   503→// KEY STRENGTHS SECTION (Harmony Style)\n   504→// ============================================\n   505→\n   506→interface KeyStrengthsSectionProps {\n   507→  strengths: Strength[];\n   508→  onRatioClick: (ratio: ResponsibleRatio, categoryName: string) => void;\n   509→  initialShowCount?: number;\n   510→}\n   511→\n   512→export function KeyStrengthsSection({\n   513→  strengths,\n   514→  onRatioClick,\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"1ec31f56-b23d-4685-89d6-92ef8f8152ab","timestamp":"2025-12-26T14:54:36.766Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","content":"      transition={{ duration: 0.3, delay: animationDelay }}\n      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-red-500/30' : 'border-neutral-800 hover:border-neutral-700'\n        }`}\n    >\n      {/* Header Button */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <SeverityBadge severity={severity} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-500\">\n                -{(typeof flaw.harmonyPercentageLost === 'number' && Number.isFinite(flaw.harmonyPercentageLost)\n                  ? flaw.harmonyPercentageLost\n                  : 0\n                ).toFixed(2)}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n              {flaw.rollingHarmonyPercentageLost !== undefined &&\n                typeof flaw.rollingHarmonyPercentageLost === 'number' &&\n                Number.isFinite(flaw.rollingHarmonyPercentageLost) && (\n                  <div className=\"text-[10px] text-neutral-600 font-medium pt-0.5 border-t border-neutral-700 mt-1\">\n                    Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n                  </div>\n                )}\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3 }}\n            className=\"overflow-hidden\"\n          >\n            {/* Affected Ratios Section */}\n            <div className=\"border-t border-neutral-800 bg-neutral-800/30 px-4 sm:px-5 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Affected Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {flaw.responsibleRatios.map((ratio, i) => (\n                  <ContributingRatioButton\n                    key={ratio.ratioId}\n                    ratioName={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick(ratio)}\n                    animationDelay={i * 0.05}\n                  />\n                ))}\n              </div>\n            </div>\n\n            {/* Your Plan Section (if there are matched recommendations) */}\n            {matchedRecommendations.length > 0 && (\n              <div className=\"border-t border-neutral-800 bg-emerald-900/10 px-4 sm:px-5 py-3 sm:py-4\">\n                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n                  <Sparkles className=\"w-3 h-3 text-emerald-400\" />\n                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-400 uppercase tracking-wider\">\n                    Your Plan\n                  </span>\n                </div>\n                <div className=\"space-y-2\">\n                  {matchedRecommendations.map((rec, i) => (\n                    <PlanItem\n                      key={rec.ref_id}\n                      name={rec.name}\n                      phase={mapPhase(rec.phase)}\n                      animationDelay={i * 0.05}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n\n// ============================================\n// KEY STRENGTHS SECTION (Harmony Style)\n// ============================================\n\ninterface KeyStrengthsSectionProps {\n  strengths: Strength[];\n  onRatioClick: (ratio: ResponsibleRatio, categoryName: string) => void;\n  initialShowCount?: number;\n}\n\nexport function KeyStrengthsSection({\n  strengths,\n  onRatioClick,","numLines":120,"startLine":395,"totalLines":689}}}
{"parentUuid":"1ec31f56-b23d-4685-89d6-92ef8f8152ab","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01HaPTyG6dzKM1X96FNxY2x2","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me update the `KeyStrengthsFlaws.tsx` to also include the confidence badge. First I'll add the import and ConfidenceBadge component, then update the AreaOfImprovementCard:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2163,"cache_read_input_tokens":100051,"cache_creation":{"ephemeral_5m_input_tokens":2163,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVVRQdjc63R1vybCtkGL","type":"assistant","uuid":"53baf992-ef2d-4121-bff5-eaf3661bf89c","timestamp":"2025-12-26T14:54:42.462Z"}
{"parentUuid":"53baf992-ef2d-4121-bff5-eaf3661bf89c","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01HaPTyG6dzKM1X96FNxY2x2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0156MA594cKfV8QganSDrUzt","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","limit":10}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2163,"cache_read_input_tokens":100051,"cache_creation":{"ephemeral_5m_input_tokens":2163,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVVRQdjc63R1vybCtkGL","type":"assistant","uuid":"e5d516cb-609c-418a-961f-f089b3ea896c","timestamp":"2025-12-26T14:54:44.207Z"}
{"parentUuid":"e5d516cb-609c-418a-961f-f089b3ea896c","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0156MA594cKfV8QganSDrUzt","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useState, useMemo } from 'react';\n     4→import { motion, AnimatePresence } from 'framer-motion';\n     5→import { ChevronDown, Sparkles, AlertTriangle } from 'lucide-react';\n     6→import { Strength, Flaw, ResponsibleRatio, Recommendation, getScoreColor } from '@/types/results';\n     7→import { useResults } from '@/contexts/ResultsContext';\n     8→\n     9→// ============================================\n    10→// QUALITY BADGE COMPONENT (Light Theme)\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"899b0986-9366-4201-af98-55c420e23f62","timestamp":"2025-12-26T14:54:44.310Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","content":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ChevronDown, Sparkles, AlertTriangle } from 'lucide-react';\nimport { Strength, Flaw, ResponsibleRatio, Recommendation, getScoreColor } from '@/types/results';\nimport { useResults } from '@/contexts/ResultsContext';\n\n// ============================================\n// QUALITY BADGE COMPONENT (Light Theme)","numLines":10,"startLine":1,"totalLines":689}}}
{"parentUuid":"899b0986-9366-4201-af98-55c420e23f62","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01HADNzxEhMygBpDG41AaavK","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QNpy5i1rvR8xKisW3L1WYu","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","old_string":"import { Strength, Flaw, ResponsibleRatio, Recommendation, getScoreColor } from '@/types/results';\nimport { useResults } from '@/contexts/ResultsContext';","new_string":"import { Strength, Flaw, ResponsibleRatio, Recommendation, getScoreColor } from '@/types/results';\nimport { useResults } from '@/contexts/ResultsContext';\nimport { ConfidenceLevel } from '@/lib/harmony-scoring';"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":506,"cache_read_input_tokens":102214,"cache_creation":{"ephemeral_5m_input_tokens":506,"ephemeral_1h_input_tokens":0},"output_tokens":233,"service_tier":"standard"}},"requestId":"req_011CWVVRxyRB91gXfmfY8xQ2","type":"assistant","uuid":"3115287e-4042-464b-8396-27562198e173","timestamp":"2025-12-26T14:54:51.712Z"}
{"parentUuid":"3115287e-4042-464b-8396-27562198e173","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QNpy5i1rvR8xKisW3L1WYu","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n     2→\n     3→import { useState, useMemo } from 'react';\n     4→import { motion, AnimatePresence } from 'framer-motion';\n     5→import { ChevronDown, Sparkles, AlertTriangle } from 'lucide-react';\n     6→import { Strength, Flaw, ResponsibleRatio, Recommendation, getScoreColor } from '@/types/results';\n     7→import { useResults } from '@/contexts/ResultsContext';\n     8→import { ConfidenceLevel } from '@/lib/harmony-scoring';\n     9→\n    10→// ============================================\n    11→// QUALITY BADGE COMPONENT (Light Theme)\n    12→// ============================================"}]},"uuid":"0856950f-b315-44b8-a589-0b5fc856f8a5","timestamp":"2025-12-26T14:54:51.774Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","oldString":"import { Strength, Flaw, ResponsibleRatio, Recommendation, getScoreColor } from '@/types/results';\nimport { useResults } from '@/contexts/ResultsContext';","newString":"import { Strength, Flaw, ResponsibleRatio, Recommendation, getScoreColor } from '@/types/results';\nimport { useResults } from '@/contexts/ResultsContext';\nimport { ConfidenceLevel } from '@/lib/harmony-scoring';","originalFile":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ChevronDown, Sparkles, AlertTriangle } from 'lucide-react';\nimport { Strength, Flaw, ResponsibleRatio, Recommendation, getScoreColor } from '@/types/results';\nimport { useResults } from '@/contexts/ResultsContext';\n\n// ============================================\n// QUALITY BADGE COMPONENT (Light Theme)\n// ============================================\n\ntype QualityLevel = 'ideal' | 'excellent' | 'good' | 'below_average';\n\ninterface QualityBadgeConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n}\n\nconst QUALITY_CONFIGS: Record<QualityLevel, QualityBadgeConfig> = {\n  ideal: {\n    label: 'Ideal',\n    textColor: 'rgb(8, 145, 178)',    // cyan-600\n    bgColor: 'rgb(207, 250, 254)',    // cyan-100\n  },\n  excellent: {\n    label: 'Excellent',\n    textColor: 'rgb(4, 120, 87)',     // emerald-700\n    bgColor: 'rgb(209, 250, 229)',    // emerald-100\n  },\n  good: {\n    label: 'Good',\n    textColor: 'rgb(21, 128, 61)',    // green-700\n    bgColor: 'rgb(220, 252, 231)',    // green-100\n  },\n  below_average: {\n    label: 'Average',\n    textColor: 'rgb(113, 113, 122)',  // gray-500\n    bgColor: 'rgb(244, 244, 245)',    // gray-100\n  },\n};\n\nfunction QualityBadge({ quality }: { quality: QualityLevel }) {\n  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n\n  return (\n    <span\n      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// SEVERITY BADGE COMPONENT (Harmony Style)\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n\ninterface SeverityBadgeConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor?: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityBadgeConfig> = {\n  extremely_severe: {\n    label: 'extremely severe',\n    textColor: 'rgb(127, 29, 29)',     // red-900\n    bgColor: 'rgb(254, 202, 202)',     // red-200\n  },\n  severe: {\n    label: 'severe',\n    textColor: 'rgb(185, 28, 28)',     // red-700\n    bgColor: 'rgb(254, 226, 226)',     // red-50\n    borderColor: 'rgb(254, 202, 202)', // red-200\n  },\n  moderate: {\n    label: 'moderate',\n    textColor: 'rgb(194, 65, 12)',     // orange-700\n    bgColor: 'rgb(255, 237, 213)',     // orange-50\n    borderColor: 'rgb(254, 215, 170)', // orange-200\n  },\n  minor: {\n    label: 'minor',\n    textColor: 'rgb(161, 98, 7)',      // yellow-700\n    bgColor: 'rgb(254, 249, 195)',     // yellow-50\n    borderColor: 'rgb(254, 240, 138)', // yellow-200\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  // Handle edge cases: NaN, Infinity, undefined, null, negative\n  if (\n    typeof harmonyLost !== 'number' ||\n    !Number.isFinite(harmonyLost) ||\n    Number.isNaN(harmonyLost) ||\n    harmonyLost < 0\n  ) {\n    return 'minor'; // Default to least severe for invalid values\n  }\n  if (harmonyLost >= 0.8) return 'extremely_severe';\n  if (harmonyLost >= 0.5) return 'severe';\n  if (harmonyLost >= 0.3) return 'moderate';\n  return 'minor';\n}\n\nfunction SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity] || SEVERITY_CONFIGS.moderate;\n\n  return (\n    <span\n      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================\n\ntype ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n\ninterface PhaseConfig {\n  textColor: string;\n  bgColor: string;\n}\n\nconst PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n  Foundational: {\n    textColor: 'rgb(4, 120, 87)',     // emerald-700\n    bgColor: 'rgb(209, 250, 229)',    // emerald-50\n  },\n  'Non-Invasive': {\n    textColor: 'rgb(29, 78, 216)',    // blue-700\n    bgColor: 'rgb(219, 234, 254)',    // blue-50\n  },\n  'Minimally Invasive': {\n    textColor: 'rgb(109, 40, 217)',   // violet-700\n    bgColor: 'rgb(237, 233, 254)',    // violet-50\n  },\n  Surgical: {\n    textColor: 'rgb(126, 34, 206)',   // purple-700\n    bgColor: 'rgb(243, 232, 255)',    // purple-50\n  },\n};\n\nfunction PhaseBadge({ phase }: { phase: ProcedurePhase }) {\n  const config = PHASE_CONFIGS[phase] || PHASE_CONFIGS['Non-Invasive'];\n\n  return (\n    <span\n      className=\"px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {phase}\n    </span>\n  );\n}\n\n// ============================================\n// CONTRIBUTING RATIO BUTTON (Harmony Style - Dark Theme)\n// ============================================\n\ninterface ContributingRatioButtonProps {\n  ratioName: string;\n  score: number | string;\n  onClick: () => void;\n  animationDelay?: number;\n}\n\nfunction ContributingRatioButton({\n  ratioName,\n  score,\n  onClick,\n  animationDelay = 0,\n}: ContributingRatioButtonProps) {\n  const numericScore = typeof score === 'number' ? score : 0;\n  const color = getScoreColor(numericScore);\n\n  return (\n    <motion.button\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.2, delay: animationDelay }}\n      onClick={onClick}\n      className=\"w-full flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-lg border transition-all text-left cursor-pointer group bg-neutral-900/80 border-neutral-800 hover:border-neutral-700 hover:bg-neutral-800/50\"\n    >\n      <span className=\"text-xs sm:text-sm font-medium transition-colors text-neutral-200 group-hover:text-white\">\n        {ratioName}\n      </span>\n      <div className=\"flex items-baseline gap-0.5 sm:gap-1\">\n        <span className=\"text-xs sm:text-sm font-semibold\" style={{ color: typeof score === 'string' ? '#a3a3a3' : color }}>\n          {typeof score === 'number' ? score.toFixed(1) : score}\n        </span>\n        <span className=\"text-[10px] sm:text-xs text-neutral-500\">/10</span>\n      </div>\n    </motion.button>\n  );\n}\n\n// ============================================\n// PLAN ITEM (Recommendation in \"Your Plan\" section)\n// ============================================\n\ninterface PlanItemProps {\n  name: string;\n  phase: ProcedurePhase;\n  animationDelay?: number;\n}\n\nfunction PlanItem({ name, phase, animationDelay = 0 }: PlanItemProps) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.2, delay: animationDelay }}\n      className=\"flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-lg bg-neutral-900/80 border border-neutral-800\"\n    >\n      <span className=\"text-xs sm:text-sm text-neutral-200 font-medium\">{name}</span>\n      <div className=\"flex items-center gap-2\">\n        <span className=\"text-[9px] sm:text-[10px] px-1.5 py-0.5 rounded bg-emerald-500/20 text-emerald-400 font-medium\">\n          In Plan\n        </span>\n        <PhaseBadge phase={phase} />\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// KEY STRENGTH CARD (Harmony Style)\n// ============================================\n\ninterface KeyStrengthCardProps {\n  strength: Strength;\n  isExpanded: boolean;\n  onToggle: () => void;\n  onRatioClick: (ratio: ResponsibleRatio) => void;\n  animationDelay?: number;\n}\n\nfunction KeyStrengthCard({\n  strength,\n  isExpanded,\n  onToggle,\n  onRatioClick,\n  animationDelay = 0,\n}: KeyStrengthCardProps) {\n  const score = typeof strength.avgScore === 'number' ? strength.avgScore : 0;\n  const color = getScoreColor(score);\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.3, delay: animationDelay }}\n      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-cyan-500/30' : 'border-neutral-800 hover:border-neutral-700'\n        }`}\n    >\n      {/* Header Button */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <QualityBadge quality={strength.qualityLevel} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {strength.strengthName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n                {strength.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Score + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right\">\n              <div\n                className=\"text-lg sm:text-xl font-semibold tracking-tight\"\n                style={{ color: typeof strength.avgScore === 'string' ? '#a3a3a3' : color }}\n              >\n                {typeof strength.avgScore === 'number' ? strength.avgScore.toFixed(2) : strength.avgScore}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium mt-0.5\">avg /10</div>\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3 }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"border-t border-neutral-800 bg-neutral-800/30 px-4 sm:px-5 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Contributing Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {strength.responsibleRatios.map((ratio, i) => (\n                  <ContributingRatioButton\n                    key={ratio.ratioId}\n                    ratioName={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick(ratio)}\n                    animationDelay={i * 0.05}\n                  />\n                ))}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n\n// ============================================\n// AREA OF IMPROVEMENT CARD (Harmony Style with Your Plan)\n// ============================================\n\ninterface AreaOfImprovementCardProps {\n  flaw: Flaw;\n  isExpanded: boolean;\n  onToggle: () => void;\n  onRatioClick: (ratio: ResponsibleRatio) => void;\n  recommendations?: Recommendation[];\n  animationDelay?: number;\n}\n\nfunction AreaOfImprovementCard({\n  flaw,\n  isExpanded,\n  onToggle,\n  onRatioClick,\n  recommendations = [],\n  animationDelay = 0,\n}: AreaOfImprovementCardProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n\n  // Find matching recommendations for this flaw\n  const matchedRecommendations = useMemo(() => {\n    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n    return recommendations.filter(rec =>\n      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n    ).slice(0, 3);\n  }, [flaw, recommendations]);\n\n  // Map phase names\n  const mapPhase = (phase: string): ProcedurePhase => {\n    if (phase === 'Foundational') return 'Foundational';\n    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n    if (phase === 'Surgical') return 'Surgical';\n    return 'Non-Invasive';\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.3, delay: animationDelay }}\n      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-red-500/30' : 'border-neutral-800 hover:border-neutral-700'\n        }`}\n    >\n      {/* Header Button */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <SeverityBadge severity={severity} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-500\">\n                -{(typeof flaw.harmonyPercentageLost === 'number' && Number.isFinite(flaw.harmonyPercentageLost)\n                  ? flaw.harmonyPercentageLost\n                  : 0\n                ).toFixed(2)}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n              {flaw.rollingHarmonyPercentageLost !== undefined &&\n                typeof flaw.rollingHarmonyPercentageLost === 'number' &&\n                Number.isFinite(flaw.rollingHarmonyPercentageLost) && (\n                  <div className=\"text-[10px] text-neutral-600 font-medium pt-0.5 border-t border-neutral-700 mt-1\">\n                    Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n                  </div>\n                )}\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3 }}\n            className=\"overflow-hidden\"\n          >\n            {/* Affected Ratios Section */}\n            <div className=\"border-t border-neutral-800 bg-neutral-800/30 px-4 sm:px-5 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Affected Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {flaw.responsibleRatios.map((ratio, i) => (\n                  <ContributingRatioButton\n                    key={ratio.ratioId}\n                    ratioName={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick(ratio)}\n                    animationDelay={i * 0.05}\n                  />\n                ))}\n              </div>\n            </div>\n\n            {/* Your Plan Section (if there are matched recommendations) */}\n            {matchedRecommendations.length > 0 && (\n              <div className=\"border-t border-neutral-800 bg-emerald-900/10 px-4 sm:px-5 py-3 sm:py-4\">\n                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n                  <Sparkles className=\"w-3 h-3 text-emerald-400\" />\n                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-400 uppercase tracking-wider\">\n                    Your Plan\n                  </span>\n                </div>\n                <div className=\"space-y-2\">\n                  {matchedRecommendations.map((rec, i) => (\n                    <PlanItem\n                      key={rec.ref_id}\n                      name={rec.name}\n                      phase={mapPhase(rec.phase)}\n                      animationDelay={i * 0.05}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n\n// ============================================\n// KEY STRENGTHS SECTION (Harmony Style)\n// ============================================\n\ninterface KeyStrengthsSectionProps {\n  strengths: Strength[];\n  onRatioClick: (ratio: ResponsibleRatio, categoryName: string) => void;\n  initialShowCount?: number;\n}\n\nexport function KeyStrengthsSection({\n  strengths,\n  onRatioClick,\n  initialShowCount = 3,\n}: KeyStrengthsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const displayedStrengths = showAll ? strengths : strengths.slice(0, initialShowCount);\n  const remainingCount = Math.max(0, strengths.length - initialShowCount);\n\n  // Calculate average strength contribution (handle invalid values)\n  const avgScore = useMemo(() => {\n    if (!strengths || strengths.length === 0) return 0;\n    const validScores = strengths.filter(\n      (s) => typeof s.avgScore === 'number' && Number.isFinite(s.avgScore)\n    );\n    if (validScores.length === 0) return 0;\n    return validScores.reduce((sum, s) => sum + (s.avgScore as number), 0) / validScores.length;\n  }, [strengths]);\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/50 border border-neutral-800 p-4 sm:p-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-4 sm:mb-5\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center\">\n            <Sparkles className=\"w-4 h-4 text-cyan-400\" />\n          </div>\n          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n            Key Strengths\n          </h3>\n        </div>\n        <div className=\"text-right\">\n          <span className=\"text-sm text-neutral-500\">\n            {strengths.length} total\n          </span>\n          {strengths.length > 0 && (\n            <p className=\"text-xs text-green-400 font-medium\">\n              Avg: {avgScore.toFixed(1)}/10\n            </p>\n          )}\n        </div>\n      </div>\n\n      {/* Cards */}\n      <div className=\"space-y-3\">\n        {displayedStrengths.length > 0 ? (\n          displayedStrengths.map((strength, i) => (\n            <KeyStrengthCard\n              key={strength.id}\n              strength={strength}\n              isExpanded={expandedId === strength.id}\n              onToggle={() => setExpandedId(expandedId === strength.id ? null : strength.id)}\n              onRatioClick={(ratio) => onRatioClick(ratio, strength.categoryName)}\n              animationDelay={i * 0.04}\n            />\n          ))\n        ) : (\n          <div className=\"rounded-xl bg-neutral-800/50 border border-neutral-700 p-6 text-center\">\n            <p className=\"text-neutral-500\">No significant strengths detected</p>\n          </div>\n        )}\n      </div>\n\n      {/* Show More Button */}\n      {remainingCount > 0 && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-4 py-3 rounded-lg bg-neutral-800/50 border border-neutral-700 hover:border-neutral-600 hover:bg-neutral-800 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show ${remainingCount} More`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// AREAS OF IMPROVEMENT SECTION (Harmony Style with Your Plan)\n// ============================================\n\ninterface AreasOfImprovementSectionProps {\n  flaws: Flaw[];\n  onRatioClick: (ratio: ResponsibleRatio, categoryName: string) => void;\n  initialShowCount?: number;\n}\n\nexport function AreasOfImprovementSection({\n  flaws,\n  onRatioClick,\n  initialShowCount = 3,\n}: AreasOfImprovementSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  // Get recommendations from context\n  const { recommendations } = useResults();\n\n  const displayedFlaws = showAll ? flaws : flaws.slice(0, initialShowCount);\n  const remainingCount = Math.max(0, flaws.length - initialShowCount);\n\n  // Calculate total impact from all flaws (handle invalid values)\n  const totalImpact = flaws.reduce((sum, f) => {\n    const impact = typeof f.harmonyPercentageLost === 'number' && Number.isFinite(f.harmonyPercentageLost)\n      ? f.harmonyPercentageLost\n      : 0;\n    return sum + impact;\n  }, 0);\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/50 border border-neutral-800 p-4 sm:p-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-4 sm:mb-5\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-8 rounded-lg bg-amber-500/20 flex items-center justify-center\">\n            <AlertTriangle className=\"w-4 h-4 text-amber-400\" />\n          </div>\n          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n            Areas of Improvement\n          </h3>\n        </div>\n        <div className=\"text-right\">\n          <span className=\"text-sm text-neutral-500\">\n            {flaws.length} total\n          </span>\n          {flaws.length > 0 && (\n            <p className=\"text-xs text-red-400 font-medium\">\n              Impact: -{totalImpact.toFixed(1)} pts\n            </p>\n          )}\n        </div>\n      </div>\n\n      {/* Cards */}\n      <div className=\"space-y-3\">\n        {displayedFlaws.length > 0 ? (\n          displayedFlaws.map((flaw, i) => (\n            <AreaOfImprovementCard\n              key={flaw.id}\n              flaw={flaw}\n              isExpanded={expandedId === flaw.id}\n              onToggle={() => setExpandedId(expandedId === flaw.id ? null : flaw.id)}\n              onRatioClick={(ratio) => onRatioClick(ratio, flaw.categoryName)}\n              recommendations={recommendations}\n              animationDelay={i * 0.04}\n            />\n          ))\n        ) : (\n          <div className=\"rounded-xl bg-neutral-800/50 border border-neutral-700 p-6 text-center\">\n            <p className=\"text-neutral-500\">No significant areas for improvement detected</p>\n          </div>\n        )}\n      </div>\n\n      {/* Show More Button */}\n      {remainingCount > 0 && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-4 py-3 rounded-lg bg-neutral-800/50 border border-neutral-700 hover:border-neutral-600 hover:bg-neutral-800 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show ${remainingCount} More`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n","structuredPatch":[{"oldStart":5,"oldLines":6,"newStart":5,"newLines":7,"lines":[" import { ChevronDown, Sparkles, AlertTriangle } from 'lucide-react';"," import { Strength, Flaw, ResponsibleRatio, Recommendation, getScoreColor } from '@/types/results';"," import { useResults } from '@/contexts/ResultsContext';","+import { ConfidenceLevel } from '@/lib/harmony-scoring';"," "," // ============================================"," // QUALITY BADGE COMPONENT (Light Theme)"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"0856950f-b315-44b8-a589-0b5fc856f8a5","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_011VYa8Md5sRrH2kQQtTPrXF","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me find the SeverityBadge component and add the ConfidenceBadge after it:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":484,"cache_read_input_tokens":102720,"cache_creation":{"ephemeral_5m_input_tokens":484,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVSWnLtsWfmERyvwcfx","type":"assistant","uuid":"73c9c274-61da-4343-bfd7-0e47e04538db","timestamp":"2025-12-26T14:54:54.539Z"}
{"parentUuid":"73c9c274-61da-4343-bfd7-0e47e04538db","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_011VYa8Md5sRrH2kQQtTPrXF","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0198T1ytfRnqF3TbyxQmqebY","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","offset":108,"limit":40}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":484,"cache_read_input_tokens":102720,"cache_creation":{"ephemeral_5m_input_tokens":484,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVSWnLtsWfmERyvwcfx","type":"assistant","uuid":"c707bf51-7b9e-4770-9cee-382bc18fbaa8","timestamp":"2025-12-26T14:54:55.661Z"}
{"parentUuid":"c707bf51-7b9e-4770-9cee-382bc18fbaa8","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0198T1ytfRnqF3TbyxQmqebY","type":"tool_result","content":"   108→    return 'minor'; // Default to least severe for invalid values\n   109→  }\n   110→  if (harmonyLost >= 0.8) return 'extremely_severe';\n   111→  if (harmonyLost >= 0.5) return 'severe';\n   112→  if (harmonyLost >= 0.3) return 'moderate';\n   113→  return 'minor';\n   114→}\n   115→\n   116→function SeverityBadge({ severity }: { severity: SeverityLevel }) {\n   117→  const config = SEVERITY_CONFIGS[severity] || SEVERITY_CONFIGS.moderate;\n   118→\n   119→  return (\n   120→    <span\n   121→      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n   122→      style={{\n   123→        color: config.textColor,\n   124→        backgroundColor: config.bgColor,\n   125→        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n   126→      }}\n   127→    >\n   128→      {config.label}\n   129→    </span>\n   130→  );\n   131→}\n   132→\n   133→// ============================================\n   134→// PROCEDURE PHASE BADGE\n   135→// ============================================\n   136→\n   137→type ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n   138→\n   139→interface PhaseConfig {\n   140→  textColor: string;\n   141→  bgColor: string;\n   142→}\n   143→\n   144→const PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n   145→  Foundational: {\n   146→    textColor: 'rgb(4, 120, 87)',     // emerald-700\n   147→    bgColor: 'rgb(209, 250, 229)',    // emerald-50\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"a56a7044-71cb-490f-b0c3-83876fe9a8c7","timestamp":"2025-12-26T14:54:55.752Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","content":"    return 'minor'; // Default to least severe for invalid values\n  }\n  if (harmonyLost >= 0.8) return 'extremely_severe';\n  if (harmonyLost >= 0.5) return 'severe';\n  if (harmonyLost >= 0.3) return 'moderate';\n  return 'minor';\n}\n\nfunction SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity] || SEVERITY_CONFIGS.moderate;\n\n  return (\n    <span\n      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================\n\ntype ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n\ninterface PhaseConfig {\n  textColor: string;\n  bgColor: string;\n}\n\nconst PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n  Foundational: {\n    textColor: 'rgb(4, 120, 87)',     // emerald-700\n    bgColor: 'rgb(209, 250, 229)',    // emerald-50","numLines":40,"startLine":108,"totalLines":690}}}
{"parentUuid":"a56a7044-71cb-490f-b0c3-83876fe9a8c7","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NyY5tymbhG2EoqA6jYJUx6","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GiHcDQQSoiULWVghf49Jsj","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","old_string":"function SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity] || SEVERITY_CONFIGS.moderate;\n\n  return (\n    <span\n      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================","new_string":"function SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity] || SEVERITY_CONFIGS.moderate;\n\n  return (\n    <span\n      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// CONFIDENCE BADGES - Flaw Detection Certainty\n// ============================================\n\ninterface ConfidenceConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor: string;\n  icon: string;\n}\n\nconst CONFIDENCE_CONFIGS: Record<ConfidenceLevel, ConfidenceConfig> = {\n  confirmed: {\n    label: 'Confirmed',\n    textColor: 'rgb(74, 222, 128)',     // green-400\n    bgColor: 'rgba(74, 222, 128, 0.1)', // green-400/10\n    borderColor: 'rgba(74, 222, 128, 0.3)', // green-400/30\n    icon: '\\u2713',  // checkmark\n  },\n  likely: {\n    label: 'Likely',\n    textColor: 'rgb(96, 165, 250)',     // blue-400\n    bgColor: 'rgba(96, 165, 250, 0.1)', // blue-400/10\n    borderColor: 'rgba(96, 165, 250, 0.3)', // blue-400/30\n    icon: '\\u2248',  // approximately equal\n  },\n  possible: {\n    label: 'Possible',\n    textColor: 'rgb(163, 163, 163)',    // neutral-400\n    bgColor: 'rgba(163, 163, 163, 0.1)', // neutral-400/10\n    borderColor: 'rgba(163, 163, 163, 0.3)', // neutral-400/30\n    icon: '?',\n  },\n};\n\ninterface ConfidenceBadgeProps {\n  confidence: ConfidenceLevel;\n  showIcon?: boolean;\n}\n\nfunction ConfidenceBadge({ confidence, showIcon = true }: ConfidenceBadgeProps) {\n  const config = CONFIDENCE_CONFIGS[confidence] || CONFIDENCE_CONFIGS.possible;\n\n  return (\n    <span\n      className=\"inline-flex items-center gap-1 px-1.5 py-0.5 sm:px-2 sm:py-0.5 rounded text-[9px] sm:text-[10px] font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: `1px solid ${config.borderColor}`,\n      }}\n      title={`Detection confidence: ${config.label}`}\n    >\n      {showIcon && <span className=\"text-[8px] sm:text-[9px]\">{config.icon}</span>}\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":888,"cache_read_input_tokens":103204,"cache_creation":{"ephemeral_5m_input_tokens":888,"ephemeral_1h_input_tokens":0},"output_tokens":1196,"service_tier":"standard"}},"requestId":"req_011CWVVSorkr7pjFA4AU4dVG","type":"assistant","uuid":"9c14cf77-9646-4072-8e9a-eb831a26bd55","timestamp":"2025-12-26T14:55:15.258Z"}
{"parentUuid":"9c14cf77-9646-4072-8e9a-eb831a26bd55","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GiHcDQQSoiULWVghf49Jsj","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   112→  if (harmonyLost >= 0.3) return 'moderate';\n   113→  return 'minor';\n   114→}\n   115→\n   116→function SeverityBadge({ severity }: { severity: SeverityLevel }) {\n   117→  const config = SEVERITY_CONFIGS[severity] || SEVERITY_CONFIGS.moderate;\n   118→\n   119→  return (\n   120→    <span\n   121→      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n   122→      style={{\n   123→        color: config.textColor,\n   124→        backgroundColor: config.bgColor,\n   125→        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n   126→      }}\n   127→    >\n   128→      {config.label}\n   129→    </span>\n   130→  );\n   131→}\n   132→\n   133→// ============================================\n   134→// CONFIDENCE BADGES - Flaw Detection Certainty\n   135→// ============================================\n   136→\n   137→interface ConfidenceConfig {\n   138→  label: string;\n   139→  textColor: string;\n   140→  bgColor: string;\n   141→  borderColor: string;\n   142→  icon: string;\n   143→}\n   144→\n   145→const CONFIDENCE_CONFIGS: Record<ConfidenceLevel, ConfidenceConfig> = {\n   146→  confirmed: {\n   147→    label: 'Confirmed',\n   148→    textColor: 'rgb(74, 222, 128)',     // green-400\n   149→    bgColor: 'rgba(74, 222, 128, 0.1)', // green-400/10\n   150→    borderColor: 'rgba(74, 222, 128, 0.3)', // green-400/30\n   151→    icon: '\\u2713',  // checkmark\n   152→  },\n   153→  likely: {\n   154→    label: 'Likely',\n   155→    textColor: 'rgb(96, 165, 250)',     // blue-400\n   156→    bgColor: 'rgba(96, 165, 250, 0.1)', // blue-400/10\n   157→    borderColor: 'rgba(96, 165, 250, 0.3)', // blue-400/30\n   158→    icon: '\\u2248',  // approximately equal\n   159→  },\n   160→  possible: {\n   161→    label: 'Possible',\n   162→    textColor: 'rgb(163, 163, 163)',    // neutral-400\n   163→    bgColor: 'rgba(163, 163, 163, 0.1)', // neutral-400/10\n   164→    borderColor: 'rgba(163, 163, 163, 0.3)', // neutral-400/30\n   165→    icon: '?',\n   166→  },\n   167→};\n   168→\n   169→interface ConfidenceBadgeProps {\n   170→  confidence: ConfidenceLevel;\n   171→  showIcon?: boolean;\n   172→}\n   173→\n   174→function ConfidenceBadge({ confidence, showIcon = true }: ConfidenceBadgeProps) {\n   175→  const config = CONFIDENCE_CONFIGS[confidence] || CONFIDENCE_CONFIGS.possible;\n   176→\n   177→  return (\n   178→    <span\n   179→      className=\"inline-flex items-center gap-1 px-1.5 py-0.5 sm:px-2 sm:py-0.5 rounded text-[9px] sm:text-[10px] font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n   180→      style={{\n   181→        color: config.textColor,\n   182→        backgroundColor: config.bgColor,\n   183→        border: `1px solid ${config.borderColor}`,\n   184→      }}\n   185→      title={`Detection confidence: ${config.label}`}\n   186→    >\n   187→      {showIcon && <span className=\"text-[8px] sm:text-[9px]\">{config.icon}</span>}\n   188→      {config.label}\n   189→    </span>\n   190→  );\n   191→}\n   192→\n   193→// ============================================\n   194→// PROCEDURE PHASE BADGE\n   195→// ============================================\n   196→\n   197→type ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n   198→\n   199→interface PhaseConfig {"}]},"uuid":"c2c4f556-0300-4317-baec-e32969e3467e","timestamp":"2025-12-26T14:55:15.312Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","oldString":"function SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity] || SEVERITY_CONFIGS.moderate;\n\n  return (\n    <span\n      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================","newString":"function SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity] || SEVERITY_CONFIGS.moderate;\n\n  return (\n    <span\n      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// CONFIDENCE BADGES - Flaw Detection Certainty\n// ============================================\n\ninterface ConfidenceConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor: string;\n  icon: string;\n}\n\nconst CONFIDENCE_CONFIGS: Record<ConfidenceLevel, ConfidenceConfig> = {\n  confirmed: {\n    label: 'Confirmed',\n    textColor: 'rgb(74, 222, 128)',     // green-400\n    bgColor: 'rgba(74, 222, 128, 0.1)', // green-400/10\n    borderColor: 'rgba(74, 222, 128, 0.3)', // green-400/30\n    icon: '\\u2713',  // checkmark\n  },\n  likely: {\n    label: 'Likely',\n    textColor: 'rgb(96, 165, 250)',     // blue-400\n    bgColor: 'rgba(96, 165, 250, 0.1)', // blue-400/10\n    borderColor: 'rgba(96, 165, 250, 0.3)', // blue-400/30\n    icon: '\\u2248',  // approximately equal\n  },\n  possible: {\n    label: 'Possible',\n    textColor: 'rgb(163, 163, 163)',    // neutral-400\n    bgColor: 'rgba(163, 163, 163, 0.1)', // neutral-400/10\n    borderColor: 'rgba(163, 163, 163, 0.3)', // neutral-400/30\n    icon: '?',\n  },\n};\n\ninterface ConfidenceBadgeProps {\n  confidence: ConfidenceLevel;\n  showIcon?: boolean;\n}\n\nfunction ConfidenceBadge({ confidence, showIcon = true }: ConfidenceBadgeProps) {\n  const config = CONFIDENCE_CONFIGS[confidence] || CONFIDENCE_CONFIGS.possible;\n\n  return (\n    <span\n      className=\"inline-flex items-center gap-1 px-1.5 py-0.5 sm:px-2 sm:py-0.5 rounded text-[9px] sm:text-[10px] font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: `1px solid ${config.borderColor}`,\n      }}\n      title={`Detection confidence: ${config.label}`}\n    >\n      {showIcon && <span className=\"text-[8px] sm:text-[9px]\">{config.icon}</span>}\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================","originalFile":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ChevronDown, Sparkles, AlertTriangle } from 'lucide-react';\nimport { Strength, Flaw, ResponsibleRatio, Recommendation, getScoreColor } from '@/types/results';\nimport { useResults } from '@/contexts/ResultsContext';\nimport { ConfidenceLevel } from '@/lib/harmony-scoring';\n\n// ============================================\n// QUALITY BADGE COMPONENT (Light Theme)\n// ============================================\n\ntype QualityLevel = 'ideal' | 'excellent' | 'good' | 'below_average';\n\ninterface QualityBadgeConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n}\n\nconst QUALITY_CONFIGS: Record<QualityLevel, QualityBadgeConfig> = {\n  ideal: {\n    label: 'Ideal',\n    textColor: 'rgb(8, 145, 178)',    // cyan-600\n    bgColor: 'rgb(207, 250, 254)',    // cyan-100\n  },\n  excellent: {\n    label: 'Excellent',\n    textColor: 'rgb(4, 120, 87)',     // emerald-700\n    bgColor: 'rgb(209, 250, 229)',    // emerald-100\n  },\n  good: {\n    label: 'Good',\n    textColor: 'rgb(21, 128, 61)',    // green-700\n    bgColor: 'rgb(220, 252, 231)',    // green-100\n  },\n  below_average: {\n    label: 'Average',\n    textColor: 'rgb(113, 113, 122)',  // gray-500\n    bgColor: 'rgb(244, 244, 245)',    // gray-100\n  },\n};\n\nfunction QualityBadge({ quality }: { quality: QualityLevel }) {\n  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n\n  return (\n    <span\n      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// SEVERITY BADGE COMPONENT (Harmony Style)\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n\ninterface SeverityBadgeConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor?: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityBadgeConfig> = {\n  extremely_severe: {\n    label: 'extremely severe',\n    textColor: 'rgb(127, 29, 29)',     // red-900\n    bgColor: 'rgb(254, 202, 202)',     // red-200\n  },\n  severe: {\n    label: 'severe',\n    textColor: 'rgb(185, 28, 28)',     // red-700\n    bgColor: 'rgb(254, 226, 226)',     // red-50\n    borderColor: 'rgb(254, 202, 202)', // red-200\n  },\n  moderate: {\n    label: 'moderate',\n    textColor: 'rgb(194, 65, 12)',     // orange-700\n    bgColor: 'rgb(255, 237, 213)',     // orange-50\n    borderColor: 'rgb(254, 215, 170)', // orange-200\n  },\n  minor: {\n    label: 'minor',\n    textColor: 'rgb(161, 98, 7)',      // yellow-700\n    bgColor: 'rgb(254, 249, 195)',     // yellow-50\n    borderColor: 'rgb(254, 240, 138)', // yellow-200\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  // Handle edge cases: NaN, Infinity, undefined, null, negative\n  if (\n    typeof harmonyLost !== 'number' ||\n    !Number.isFinite(harmonyLost) ||\n    Number.isNaN(harmonyLost) ||\n    harmonyLost < 0\n  ) {\n    return 'minor'; // Default to least severe for invalid values\n  }\n  if (harmonyLost >= 0.8) return 'extremely_severe';\n  if (harmonyLost >= 0.5) return 'severe';\n  if (harmonyLost >= 0.3) return 'moderate';\n  return 'minor';\n}\n\nfunction SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity] || SEVERITY_CONFIGS.moderate;\n\n  return (\n    <span\n      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================\n\ntype ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n\ninterface PhaseConfig {\n  textColor: string;\n  bgColor: string;\n}\n\nconst PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n  Foundational: {\n    textColor: 'rgb(4, 120, 87)',     // emerald-700\n    bgColor: 'rgb(209, 250, 229)',    // emerald-50\n  },\n  'Non-Invasive': {\n    textColor: 'rgb(29, 78, 216)',    // blue-700\n    bgColor: 'rgb(219, 234, 254)',    // blue-50\n  },\n  'Minimally Invasive': {\n    textColor: 'rgb(109, 40, 217)',   // violet-700\n    bgColor: 'rgb(237, 233, 254)',    // violet-50\n  },\n  Surgical: {\n    textColor: 'rgb(126, 34, 206)',   // purple-700\n    bgColor: 'rgb(243, 232, 255)',    // purple-50\n  },\n};\n\nfunction PhaseBadge({ phase }: { phase: ProcedurePhase }) {\n  const config = PHASE_CONFIGS[phase] || PHASE_CONFIGS['Non-Invasive'];\n\n  return (\n    <span\n      className=\"px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {phase}\n    </span>\n  );\n}\n\n// ============================================\n// CONTRIBUTING RATIO BUTTON (Harmony Style - Dark Theme)\n// ============================================\n\ninterface ContributingRatioButtonProps {\n  ratioName: string;\n  score: number | string;\n  onClick: () => void;\n  animationDelay?: number;\n}\n\nfunction ContributingRatioButton({\n  ratioName,\n  score,\n  onClick,\n  animationDelay = 0,\n}: ContributingRatioButtonProps) {\n  const numericScore = typeof score === 'number' ? score : 0;\n  const color = getScoreColor(numericScore);\n\n  return (\n    <motion.button\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.2, delay: animationDelay }}\n      onClick={onClick}\n      className=\"w-full flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-lg border transition-all text-left cursor-pointer group bg-neutral-900/80 border-neutral-800 hover:border-neutral-700 hover:bg-neutral-800/50\"\n    >\n      <span className=\"text-xs sm:text-sm font-medium transition-colors text-neutral-200 group-hover:text-white\">\n        {ratioName}\n      </span>\n      <div className=\"flex items-baseline gap-0.5 sm:gap-1\">\n        <span className=\"text-xs sm:text-sm font-semibold\" style={{ color: typeof score === 'string' ? '#a3a3a3' : color }}>\n          {typeof score === 'number' ? score.toFixed(1) : score}\n        </span>\n        <span className=\"text-[10px] sm:text-xs text-neutral-500\">/10</span>\n      </div>\n    </motion.button>\n  );\n}\n\n// ============================================\n// PLAN ITEM (Recommendation in \"Your Plan\" section)\n// ============================================\n\ninterface PlanItemProps {\n  name: string;\n  phase: ProcedurePhase;\n  animationDelay?: number;\n}\n\nfunction PlanItem({ name, phase, animationDelay = 0 }: PlanItemProps) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.2, delay: animationDelay }}\n      className=\"flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-lg bg-neutral-900/80 border border-neutral-800\"\n    >\n      <span className=\"text-xs sm:text-sm text-neutral-200 font-medium\">{name}</span>\n      <div className=\"flex items-center gap-2\">\n        <span className=\"text-[9px] sm:text-[10px] px-1.5 py-0.5 rounded bg-emerald-500/20 text-emerald-400 font-medium\">\n          In Plan\n        </span>\n        <PhaseBadge phase={phase} />\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// KEY STRENGTH CARD (Harmony Style)\n// ============================================\n\ninterface KeyStrengthCardProps {\n  strength: Strength;\n  isExpanded: boolean;\n  onToggle: () => void;\n  onRatioClick: (ratio: ResponsibleRatio) => void;\n  animationDelay?: number;\n}\n\nfunction KeyStrengthCard({\n  strength,\n  isExpanded,\n  onToggle,\n  onRatioClick,\n  animationDelay = 0,\n}: KeyStrengthCardProps) {\n  const score = typeof strength.avgScore === 'number' ? strength.avgScore : 0;\n  const color = getScoreColor(score);\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.3, delay: animationDelay }}\n      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-cyan-500/30' : 'border-neutral-800 hover:border-neutral-700'\n        }`}\n    >\n      {/* Header Button */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <QualityBadge quality={strength.qualityLevel} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {strength.strengthName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n                {strength.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Score + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right\">\n              <div\n                className=\"text-lg sm:text-xl font-semibold tracking-tight\"\n                style={{ color: typeof strength.avgScore === 'string' ? '#a3a3a3' : color }}\n              >\n                {typeof strength.avgScore === 'number' ? strength.avgScore.toFixed(2) : strength.avgScore}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium mt-0.5\">avg /10</div>\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3 }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"border-t border-neutral-800 bg-neutral-800/30 px-4 sm:px-5 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Contributing Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {strength.responsibleRatios.map((ratio, i) => (\n                  <ContributingRatioButton\n                    key={ratio.ratioId}\n                    ratioName={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick(ratio)}\n                    animationDelay={i * 0.05}\n                  />\n                ))}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n\n// ============================================\n// AREA OF IMPROVEMENT CARD (Harmony Style with Your Plan)\n// ============================================\n\ninterface AreaOfImprovementCardProps {\n  flaw: Flaw;\n  isExpanded: boolean;\n  onToggle: () => void;\n  onRatioClick: (ratio: ResponsibleRatio) => void;\n  recommendations?: Recommendation[];\n  animationDelay?: number;\n}\n\nfunction AreaOfImprovementCard({\n  flaw,\n  isExpanded,\n  onToggle,\n  onRatioClick,\n  recommendations = [],\n  animationDelay = 0,\n}: AreaOfImprovementCardProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n\n  // Find matching recommendations for this flaw\n  const matchedRecommendations = useMemo(() => {\n    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n    return recommendations.filter(rec =>\n      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n    ).slice(0, 3);\n  }, [flaw, recommendations]);\n\n  // Map phase names\n  const mapPhase = (phase: string): ProcedurePhase => {\n    if (phase === 'Foundational') return 'Foundational';\n    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n    if (phase === 'Surgical') return 'Surgical';\n    return 'Non-Invasive';\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.3, delay: animationDelay }}\n      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-red-500/30' : 'border-neutral-800 hover:border-neutral-700'\n        }`}\n    >\n      {/* Header Button */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <SeverityBadge severity={severity} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-500\">\n                -{(typeof flaw.harmonyPercentageLost === 'number' && Number.isFinite(flaw.harmonyPercentageLost)\n                  ? flaw.harmonyPercentageLost\n                  : 0\n                ).toFixed(2)}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n              {flaw.rollingHarmonyPercentageLost !== undefined &&\n                typeof flaw.rollingHarmonyPercentageLost === 'number' &&\n                Number.isFinite(flaw.rollingHarmonyPercentageLost) && (\n                  <div className=\"text-[10px] text-neutral-600 font-medium pt-0.5 border-t border-neutral-700 mt-1\">\n                    Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n                  </div>\n                )}\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3 }}\n            className=\"overflow-hidden\"\n          >\n            {/* Affected Ratios Section */}\n            <div className=\"border-t border-neutral-800 bg-neutral-800/30 px-4 sm:px-5 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Affected Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {flaw.responsibleRatios.map((ratio, i) => (\n                  <ContributingRatioButton\n                    key={ratio.ratioId}\n                    ratioName={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick(ratio)}\n                    animationDelay={i * 0.05}\n                  />\n                ))}\n              </div>\n            </div>\n\n            {/* Your Plan Section (if there are matched recommendations) */}\n            {matchedRecommendations.length > 0 && (\n              <div className=\"border-t border-neutral-800 bg-emerald-900/10 px-4 sm:px-5 py-3 sm:py-4\">\n                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n                  <Sparkles className=\"w-3 h-3 text-emerald-400\" />\n                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-400 uppercase tracking-wider\">\n                    Your Plan\n                  </span>\n                </div>\n                <div className=\"space-y-2\">\n                  {matchedRecommendations.map((rec, i) => (\n                    <PlanItem\n                      key={rec.ref_id}\n                      name={rec.name}\n                      phase={mapPhase(rec.phase)}\n                      animationDelay={i * 0.05}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n\n// ============================================\n// KEY STRENGTHS SECTION (Harmony Style)\n// ============================================\n\ninterface KeyStrengthsSectionProps {\n  strengths: Strength[];\n  onRatioClick: (ratio: ResponsibleRatio, categoryName: string) => void;\n  initialShowCount?: number;\n}\n\nexport function KeyStrengthsSection({\n  strengths,\n  onRatioClick,\n  initialShowCount = 3,\n}: KeyStrengthsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const displayedStrengths = showAll ? strengths : strengths.slice(0, initialShowCount);\n  const remainingCount = Math.max(0, strengths.length - initialShowCount);\n\n  // Calculate average strength contribution (handle invalid values)\n  const avgScore = useMemo(() => {\n    if (!strengths || strengths.length === 0) return 0;\n    const validScores = strengths.filter(\n      (s) => typeof s.avgScore === 'number' && Number.isFinite(s.avgScore)\n    );\n    if (validScores.length === 0) return 0;\n    return validScores.reduce((sum, s) => sum + (s.avgScore as number), 0) / validScores.length;\n  }, [strengths]);\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/50 border border-neutral-800 p-4 sm:p-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-4 sm:mb-5\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center\">\n            <Sparkles className=\"w-4 h-4 text-cyan-400\" />\n          </div>\n          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n            Key Strengths\n          </h3>\n        </div>\n        <div className=\"text-right\">\n          <span className=\"text-sm text-neutral-500\">\n            {strengths.length} total\n          </span>\n          {strengths.length > 0 && (\n            <p className=\"text-xs text-green-400 font-medium\">\n              Avg: {avgScore.toFixed(1)}/10\n            </p>\n          )}\n        </div>\n      </div>\n\n      {/* Cards */}\n      <div className=\"space-y-3\">\n        {displayedStrengths.length > 0 ? (\n          displayedStrengths.map((strength, i) => (\n            <KeyStrengthCard\n              key={strength.id}\n              strength={strength}\n              isExpanded={expandedId === strength.id}\n              onToggle={() => setExpandedId(expandedId === strength.id ? null : strength.id)}\n              onRatioClick={(ratio) => onRatioClick(ratio, strength.categoryName)}\n              animationDelay={i * 0.04}\n            />\n          ))\n        ) : (\n          <div className=\"rounded-xl bg-neutral-800/50 border border-neutral-700 p-6 text-center\">\n            <p className=\"text-neutral-500\">No significant strengths detected</p>\n          </div>\n        )}\n      </div>\n\n      {/* Show More Button */}\n      {remainingCount > 0 && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-4 py-3 rounded-lg bg-neutral-800/50 border border-neutral-700 hover:border-neutral-600 hover:bg-neutral-800 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show ${remainingCount} More`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// AREAS OF IMPROVEMENT SECTION (Harmony Style with Your Plan)\n// ============================================\n\ninterface AreasOfImprovementSectionProps {\n  flaws: Flaw[];\n  onRatioClick: (ratio: ResponsibleRatio, categoryName: string) => void;\n  initialShowCount?: number;\n}\n\nexport function AreasOfImprovementSection({\n  flaws,\n  onRatioClick,\n  initialShowCount = 3,\n}: AreasOfImprovementSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  // Get recommendations from context\n  const { recommendations } = useResults();\n\n  const displayedFlaws = showAll ? flaws : flaws.slice(0, initialShowCount);\n  const remainingCount = Math.max(0, flaws.length - initialShowCount);\n\n  // Calculate total impact from all flaws (handle invalid values)\n  const totalImpact = flaws.reduce((sum, f) => {\n    const impact = typeof f.harmonyPercentageLost === 'number' && Number.isFinite(f.harmonyPercentageLost)\n      ? f.harmonyPercentageLost\n      : 0;\n    return sum + impact;\n  }, 0);\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/50 border border-neutral-800 p-4 sm:p-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-4 sm:mb-5\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-8 rounded-lg bg-amber-500/20 flex items-center justify-center\">\n            <AlertTriangle className=\"w-4 h-4 text-amber-400\" />\n          </div>\n          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n            Areas of Improvement\n          </h3>\n        </div>\n        <div className=\"text-right\">\n          <span className=\"text-sm text-neutral-500\">\n            {flaws.length} total\n          </span>\n          {flaws.length > 0 && (\n            <p className=\"text-xs text-red-400 font-medium\">\n              Impact: -{totalImpact.toFixed(1)} pts\n            </p>\n          )}\n        </div>\n      </div>\n\n      {/* Cards */}\n      <div className=\"space-y-3\">\n        {displayedFlaws.length > 0 ? (\n          displayedFlaws.map((flaw, i) => (\n            <AreaOfImprovementCard\n              key={flaw.id}\n              flaw={flaw}\n              isExpanded={expandedId === flaw.id}\n              onToggle={() => setExpandedId(expandedId === flaw.id ? null : flaw.id)}\n              onRatioClick={(ratio) => onRatioClick(ratio, flaw.categoryName)}\n              recommendations={recommendations}\n              animationDelay={i * 0.04}\n            />\n          ))\n        ) : (\n          <div className=\"rounded-xl bg-neutral-800/50 border border-neutral-700 p-6 text-center\">\n            <p className=\"text-neutral-500\">No significant areas for improvement detected</p>\n          </div>\n        )}\n      </div>\n\n      {/* Show More Button */}\n      {remainingCount > 0 && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-4 py-3 rounded-lg bg-neutral-800/50 border border-neutral-700 hover:border-neutral-600 hover:bg-neutral-800 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show ${remainingCount} More`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n","structuredPatch":[{"oldStart":131,"oldLines":6,"newStart":131,"newLines":66,"lines":[" }"," "," // ============================================","+// CONFIDENCE BADGES - Flaw Detection Certainty","+// ============================================","+","+interface ConfidenceConfig {","+  label: string;","+  textColor: string;","+  bgColor: string;","+  borderColor: string;","+  icon: string;","+}","+","+const CONFIDENCE_CONFIGS: Record<ConfidenceLevel, ConfidenceConfig> = {","+  confirmed: {","+    label: 'Confirmed',","+    textColor: 'rgb(74, 222, 128)',     // green-400","+    bgColor: 'rgba(74, 222, 128, 0.1)', // green-400/10","+    borderColor: 'rgba(74, 222, 128, 0.3)', // green-400/30","+    icon: '\\u2713',  // checkmark","+  },","+  likely: {","+    label: 'Likely',","+    textColor: 'rgb(96, 165, 250)',     // blue-400","+    bgColor: 'rgba(96, 165, 250, 0.1)', // blue-400/10","+    borderColor: 'rgba(96, 165, 250, 0.3)', // blue-400/30","+    icon: '\\u2248',  // approximately equal","+  },","+  possible: {","+    label: 'Possible',","+    textColor: 'rgb(163, 163, 163)',    // neutral-400","+    bgColor: 'rgba(163, 163, 163, 0.1)', // neutral-400/10","+    borderColor: 'rgba(163, 163, 163, 0.3)', // neutral-400/30","+    icon: '?',","+  },","+};","+","+interface ConfidenceBadgeProps {","+  confidence: ConfidenceLevel;","+  showIcon?: boolean;","+}","+","+function ConfidenceBadge({ confidence, showIcon = true }: ConfidenceBadgeProps) {","+  const config = CONFIDENCE_CONFIGS[confidence] || CONFIDENCE_CONFIGS.possible;","+","+  return (","+    <span","+      className=\"inline-flex items-center gap-1 px-1.5 py-0.5 sm:px-2 sm:py-0.5 rounded text-[9px] sm:text-[10px] font-medium tracking-wide whitespace-nowrap flex-shrink-0\"","+      style={{","+        color: config.textColor,","+        backgroundColor: config.bgColor,","+        border: `1px solid ${config.borderColor}`,","+      }}","+      title={`Detection confidence: ${config.label}`}","+    >","+      {showIcon && <span className=\"text-[8px] sm:text-[9px]\">{config.icon}</span>}","+      {config.label}","+    </span>","+  );","+}","+","+// ============================================"," // PROCEDURE PHASE BADGE"," // ============================================"," "]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"c2c4f556-0300-4317-baec-e32969e3467e","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01FPucjMReDfxdTLXckhDSn2","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me update the `AreaOfImprovementCard` component to display the confidence badge. First, let me find the line number:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2495,"cache_read_input_tokens":104092,"cache_creation":{"ephemeral_5m_input_tokens":2495,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWVVUFTfEmfMvjEQ7zaC2","type":"assistant","uuid":"5183b516-2aa7-467a-8527-80be1aab9cf2","timestamp":"2025-12-26T14:55:19.356Z"}
{"parentUuid":"5183b516-2aa7-467a-8527-80be1aab9cf2","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01FPucjMReDfxdTLXckhDSn2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018M3eyRHW3jFTqmZ65dexeE","name":"Grep","input":{"pattern":"function AreaOfImprovementCard","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","output_mode":"content","-n":true}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":2495,"cache_read_input_tokens":104092,"cache_creation":{"ephemeral_5m_input_tokens":2495,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWVVUFTfEmfMvjEQ7zaC2","type":"assistant","uuid":"dcac933c-bb30-4f5c-acae-231c661a99dd","timestamp":"2025-12-26T14:55:21.752Z"}
{"parentUuid":"dcac933c-bb30-4f5c-acae-231c661a99dd","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018M3eyRHW3jFTqmZ65dexeE","type":"tool_result","content":"425:function AreaOfImprovementCard({"}]},"uuid":"a5a686af-4e35-4ebd-8aae-91270590dbd7","timestamp":"2025-12-26T14:55:22.197Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"425:function AreaOfImprovementCard({","numLines":1}}
{"parentUuid":"a5a686af-4e35-4ebd-8aae-91270590dbd7","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VRyaGpQ1RwsfVtRj7zUfjd","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NBkEFn9sRCMXwJKqNVTVGS","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","offset":455,"limit":30}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":309,"cache_read_input_tokens":106587,"cache_creation":{"ephemeral_5m_input_tokens":309,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"}},"requestId":"req_011CWVVUkyvhK67GKVUe8Jo5","type":"assistant","uuid":"60e5f03f-16c7-42e6-99ea-3f0aa38ceb74","timestamp":"2025-12-26T14:55:27.921Z"}
{"parentUuid":"60e5f03f-16c7-42e6-99ea-3f0aa38ceb74","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NBkEFn9sRCMXwJKqNVTVGS","type":"tool_result","content":"   455→      animate={{ opacity: 1, y: 0 }}\n   456→      transition={{ duration: 0.3, delay: animationDelay }}\n   457→      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-red-500/30' : 'border-neutral-800 hover:border-neutral-700'\n   458→        }`}\n   459→    >\n   460→      {/* Header Button */}\n   461→      <button\n   462→        onClick={onToggle}\n   463→        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n   464→      >\n   465→        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n   466→          {/* Left: Badge + Content */}\n   467→          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n   468→            <SeverityBadge severity={severity} />\n   469→            <div className=\"flex-1 min-w-0\">\n   470→              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n   471→                {flaw.flawName}\n   472→              </h4>\n   473→              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n   474→                {flaw.summary}\n   475→              </p>\n   476→            </div>\n   477→          </div>\n   478→\n   479→          {/* Right: Points impact + Chevron */}\n   480→          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n   481→            <div className=\"text-right space-y-1\">\n   482→              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-500\">\n   483→                -{(typeof flaw.harmonyPercentageLost === 'number' && Number.isFinite(flaw.harmonyPercentageLost)\n   484→                  ? flaw.harmonyPercentageLost\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"a7b0517c-e41f-440c-9d64-f59671ecc5ed","timestamp":"2025-12-26T14:55:28.128Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","content":"      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.3, delay: animationDelay }}\n      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-red-500/30' : 'border-neutral-800 hover:border-neutral-700'\n        }`}\n    >\n      {/* Header Button */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <SeverityBadge severity={severity} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-500\">\n                -{(typeof flaw.harmonyPercentageLost === 'number' && Number.isFinite(flaw.harmonyPercentageLost)\n                  ? flaw.harmonyPercentageLost","numLines":30,"startLine":455,"totalLines":750}}}
{"parentUuid":"a7b0517c-e41f-440c-9d64-f59671ecc5ed","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RBjduDTVV9ueqyzdqnZNW6","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VQR5NLnX9ffhXtAZcQdo38","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","old_string":"        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <SeverityBadge severity={severity} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-500\">\n                -{(typeof flaw.harmonyPercentageLost === 'number' && Number.isFinite(flaw.harmonyPercentageLost)\n                  ? flaw.harmonyPercentageLost","new_string":"        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badges + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <div className=\"flex flex-col gap-1\">\n              <SeverityBadge severity={severity} />\n              {flaw.confidence && <ConfidenceBadge confidence={flaw.confidence} />}\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-500\">\n                -{(typeof flaw.harmonyPercentageLost === 'number' && Number.isFinite(flaw.harmonyPercentageLost)\n                  ? flaw.harmonyPercentageLost"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":845,"cache_read_input_tokens":106896,"cache_creation":{"ephemeral_5m_input_tokens":845,"ephemeral_1h_input_tokens":0},"output_tokens":926,"service_tier":"standard"}},"requestId":"req_011CWVVVCKRXiXs7cXuSzekY","type":"assistant","uuid":"51a1dcad-1d0b-4147-b0c8-d4dc3a284ede","timestamp":"2025-12-26T14:55:41.972Z"}
{"parentUuid":"51a1dcad-1d0b-4147-b0c8-d4dc3a284ede","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VQR5NLnX9ffhXtAZcQdo38","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   461→      <button\n   462→        onClick={onToggle}\n   463→        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n   464→      >\n   465→        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n   466→          {/* Left: Badges + Content */}\n   467→          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n   468→            <div className=\"flex flex-col gap-1\">\n   469→              <SeverityBadge severity={severity} />\n   470→              {flaw.confidence && <ConfidenceBadge confidence={flaw.confidence} />}\n   471→            </div>\n   472→            <div className=\"flex-1 min-w-0\">\n   473→              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n   474→                {flaw.flawName}\n   475→              </h4>\n   476→              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n   477→                {flaw.summary}\n   478→              </p>\n   479→            </div>\n   480→          </div>\n   481→\n   482→          {/* Right: Points impact + Chevron */}\n   483→          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n   484→            <div className=\"text-right space-y-1\">\n   485→              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-500\">\n   486→                -{(typeof flaw.harmonyPercentageLost === 'number' && Number.isFinite(flaw.harmonyPercentageLost)\n   487→                  ? flaw.harmonyPercentageLost\n   488→                  : 0\n   489→                ).toFixed(2)}\n   490→              </div>\n   491→              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>"}]},"uuid":"8892731a-7a41-45e5-a773-edb867b32445","timestamp":"2025-12-26T14:55:42.026Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","oldString":"        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <SeverityBadge severity={severity} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-500\">\n                -{(typeof flaw.harmonyPercentageLost === 'number' && Number.isFinite(flaw.harmonyPercentageLost)\n                  ? flaw.harmonyPercentageLost","newString":"        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badges + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <div className=\"flex flex-col gap-1\">\n              <SeverityBadge severity={severity} />\n              {flaw.confidence && <ConfidenceBadge confidence={flaw.confidence} />}\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-500\">\n                -{(typeof flaw.harmonyPercentageLost === 'number' && Number.isFinite(flaw.harmonyPercentageLost)\n                  ? flaw.harmonyPercentageLost","originalFile":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ChevronDown, Sparkles, AlertTriangle } from 'lucide-react';\nimport { Strength, Flaw, ResponsibleRatio, Recommendation, getScoreColor } from '@/types/results';\nimport { useResults } from '@/contexts/ResultsContext';\nimport { ConfidenceLevel } from '@/lib/harmony-scoring';\n\n// ============================================\n// QUALITY BADGE COMPONENT (Light Theme)\n// ============================================\n\ntype QualityLevel = 'ideal' | 'excellent' | 'good' | 'below_average';\n\ninterface QualityBadgeConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n}\n\nconst QUALITY_CONFIGS: Record<QualityLevel, QualityBadgeConfig> = {\n  ideal: {\n    label: 'Ideal',\n    textColor: 'rgb(8, 145, 178)',    // cyan-600\n    bgColor: 'rgb(207, 250, 254)',    // cyan-100\n  },\n  excellent: {\n    label: 'Excellent',\n    textColor: 'rgb(4, 120, 87)',     // emerald-700\n    bgColor: 'rgb(209, 250, 229)',    // emerald-100\n  },\n  good: {\n    label: 'Good',\n    textColor: 'rgb(21, 128, 61)',    // green-700\n    bgColor: 'rgb(220, 252, 231)',    // green-100\n  },\n  below_average: {\n    label: 'Average',\n    textColor: 'rgb(113, 113, 122)',  // gray-500\n    bgColor: 'rgb(244, 244, 245)',    // gray-100\n  },\n};\n\nfunction QualityBadge({ quality }: { quality: QualityLevel }) {\n  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n\n  return (\n    <span\n      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// SEVERITY BADGE COMPONENT (Harmony Style)\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n\ninterface SeverityBadgeConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor?: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityBadgeConfig> = {\n  extremely_severe: {\n    label: 'extremely severe',\n    textColor: 'rgb(127, 29, 29)',     // red-900\n    bgColor: 'rgb(254, 202, 202)',     // red-200\n  },\n  severe: {\n    label: 'severe',\n    textColor: 'rgb(185, 28, 28)',     // red-700\n    bgColor: 'rgb(254, 226, 226)',     // red-50\n    borderColor: 'rgb(254, 202, 202)', // red-200\n  },\n  moderate: {\n    label: 'moderate',\n    textColor: 'rgb(194, 65, 12)',     // orange-700\n    bgColor: 'rgb(255, 237, 213)',     // orange-50\n    borderColor: 'rgb(254, 215, 170)', // orange-200\n  },\n  minor: {\n    label: 'minor',\n    textColor: 'rgb(161, 98, 7)',      // yellow-700\n    bgColor: 'rgb(254, 249, 195)',     // yellow-50\n    borderColor: 'rgb(254, 240, 138)', // yellow-200\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  // Handle edge cases: NaN, Infinity, undefined, null, negative\n  if (\n    typeof harmonyLost !== 'number' ||\n    !Number.isFinite(harmonyLost) ||\n    Number.isNaN(harmonyLost) ||\n    harmonyLost < 0\n  ) {\n    return 'minor'; // Default to least severe for invalid values\n  }\n  if (harmonyLost >= 0.8) return 'extremely_severe';\n  if (harmonyLost >= 0.5) return 'severe';\n  if (harmonyLost >= 0.3) return 'moderate';\n  return 'minor';\n}\n\nfunction SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity] || SEVERITY_CONFIGS.moderate;\n\n  return (\n    <span\n      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// CONFIDENCE BADGES - Flaw Detection Certainty\n// ============================================\n\ninterface ConfidenceConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor: string;\n  icon: string;\n}\n\nconst CONFIDENCE_CONFIGS: Record<ConfidenceLevel, ConfidenceConfig> = {\n  confirmed: {\n    label: 'Confirmed',\n    textColor: 'rgb(74, 222, 128)',     // green-400\n    bgColor: 'rgba(74, 222, 128, 0.1)', // green-400/10\n    borderColor: 'rgba(74, 222, 128, 0.3)', // green-400/30\n    icon: '\\u2713',  // checkmark\n  },\n  likely: {\n    label: 'Likely',\n    textColor: 'rgb(96, 165, 250)',     // blue-400\n    bgColor: 'rgba(96, 165, 250, 0.1)', // blue-400/10\n    borderColor: 'rgba(96, 165, 250, 0.3)', // blue-400/30\n    icon: '\\u2248',  // approximately equal\n  },\n  possible: {\n    label: 'Possible',\n    textColor: 'rgb(163, 163, 163)',    // neutral-400\n    bgColor: 'rgba(163, 163, 163, 0.1)', // neutral-400/10\n    borderColor: 'rgba(163, 163, 163, 0.3)', // neutral-400/30\n    icon: '?',\n  },\n};\n\ninterface ConfidenceBadgeProps {\n  confidence: ConfidenceLevel;\n  showIcon?: boolean;\n}\n\nfunction ConfidenceBadge({ confidence, showIcon = true }: ConfidenceBadgeProps) {\n  const config = CONFIDENCE_CONFIGS[confidence] || CONFIDENCE_CONFIGS.possible;\n\n  return (\n    <span\n      className=\"inline-flex items-center gap-1 px-1.5 py-0.5 sm:px-2 sm:py-0.5 rounded text-[9px] sm:text-[10px] font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: `1px solid ${config.borderColor}`,\n      }}\n      title={`Detection confidence: ${config.label}`}\n    >\n      {showIcon && <span className=\"text-[8px] sm:text-[9px]\">{config.icon}</span>}\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================\n\ntype ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n\ninterface PhaseConfig {\n  textColor: string;\n  bgColor: string;\n}\n\nconst PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n  Foundational: {\n    textColor: 'rgb(4, 120, 87)',     // emerald-700\n    bgColor: 'rgb(209, 250, 229)',    // emerald-50\n  },\n  'Non-Invasive': {\n    textColor: 'rgb(29, 78, 216)',    // blue-700\n    bgColor: 'rgb(219, 234, 254)',    // blue-50\n  },\n  'Minimally Invasive': {\n    textColor: 'rgb(109, 40, 217)',   // violet-700\n    bgColor: 'rgb(237, 233, 254)',    // violet-50\n  },\n  Surgical: {\n    textColor: 'rgb(126, 34, 206)',   // purple-700\n    bgColor: 'rgb(243, 232, 255)',    // purple-50\n  },\n};\n\nfunction PhaseBadge({ phase }: { phase: ProcedurePhase }) {\n  const config = PHASE_CONFIGS[phase] || PHASE_CONFIGS['Non-Invasive'];\n\n  return (\n    <span\n      className=\"px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {phase}\n    </span>\n  );\n}\n\n// ============================================\n// CONTRIBUTING RATIO BUTTON (Harmony Style - Dark Theme)\n// ============================================\n\ninterface ContributingRatioButtonProps {\n  ratioName: string;\n  score: number | string;\n  onClick: () => void;\n  animationDelay?: number;\n}\n\nfunction ContributingRatioButton({\n  ratioName,\n  score,\n  onClick,\n  animationDelay = 0,\n}: ContributingRatioButtonProps) {\n  const numericScore = typeof score === 'number' ? score : 0;\n  const color = getScoreColor(numericScore);\n\n  return (\n    <motion.button\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.2, delay: animationDelay }}\n      onClick={onClick}\n      className=\"w-full flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-lg border transition-all text-left cursor-pointer group bg-neutral-900/80 border-neutral-800 hover:border-neutral-700 hover:bg-neutral-800/50\"\n    >\n      <span className=\"text-xs sm:text-sm font-medium transition-colors text-neutral-200 group-hover:text-white\">\n        {ratioName}\n      </span>\n      <div className=\"flex items-baseline gap-0.5 sm:gap-1\">\n        <span className=\"text-xs sm:text-sm font-semibold\" style={{ color: typeof score === 'string' ? '#a3a3a3' : color }}>\n          {typeof score === 'number' ? score.toFixed(1) : score}\n        </span>\n        <span className=\"text-[10px] sm:text-xs text-neutral-500\">/10</span>\n      </div>\n    </motion.button>\n  );\n}\n\n// ============================================\n// PLAN ITEM (Recommendation in \"Your Plan\" section)\n// ============================================\n\ninterface PlanItemProps {\n  name: string;\n  phase: ProcedurePhase;\n  animationDelay?: number;\n}\n\nfunction PlanItem({ name, phase, animationDelay = 0 }: PlanItemProps) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.2, delay: animationDelay }}\n      className=\"flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-lg bg-neutral-900/80 border border-neutral-800\"\n    >\n      <span className=\"text-xs sm:text-sm text-neutral-200 font-medium\">{name}</span>\n      <div className=\"flex items-center gap-2\">\n        <span className=\"text-[9px] sm:text-[10px] px-1.5 py-0.5 rounded bg-emerald-500/20 text-emerald-400 font-medium\">\n          In Plan\n        </span>\n        <PhaseBadge phase={phase} />\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// KEY STRENGTH CARD (Harmony Style)\n// ============================================\n\ninterface KeyStrengthCardProps {\n  strength: Strength;\n  isExpanded: boolean;\n  onToggle: () => void;\n  onRatioClick: (ratio: ResponsibleRatio) => void;\n  animationDelay?: number;\n}\n\nfunction KeyStrengthCard({\n  strength,\n  isExpanded,\n  onToggle,\n  onRatioClick,\n  animationDelay = 0,\n}: KeyStrengthCardProps) {\n  const score = typeof strength.avgScore === 'number' ? strength.avgScore : 0;\n  const color = getScoreColor(score);\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.3, delay: animationDelay }}\n      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-cyan-500/30' : 'border-neutral-800 hover:border-neutral-700'\n        }`}\n    >\n      {/* Header Button */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <QualityBadge quality={strength.qualityLevel} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {strength.strengthName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n                {strength.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Score + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right\">\n              <div\n                className=\"text-lg sm:text-xl font-semibold tracking-tight\"\n                style={{ color: typeof strength.avgScore === 'string' ? '#a3a3a3' : color }}\n              >\n                {typeof strength.avgScore === 'number' ? strength.avgScore.toFixed(2) : strength.avgScore}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium mt-0.5\">avg /10</div>\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3 }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"border-t border-neutral-800 bg-neutral-800/30 px-4 sm:px-5 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Contributing Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {strength.responsibleRatios.map((ratio, i) => (\n                  <ContributingRatioButton\n                    key={ratio.ratioId}\n                    ratioName={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick(ratio)}\n                    animationDelay={i * 0.05}\n                  />\n                ))}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n\n// ============================================\n// AREA OF IMPROVEMENT CARD (Harmony Style with Your Plan)\n// ============================================\n\ninterface AreaOfImprovementCardProps {\n  flaw: Flaw;\n  isExpanded: boolean;\n  onToggle: () => void;\n  onRatioClick: (ratio: ResponsibleRatio) => void;\n  recommendations?: Recommendation[];\n  animationDelay?: number;\n}\n\nfunction AreaOfImprovementCard({\n  flaw,\n  isExpanded,\n  onToggle,\n  onRatioClick,\n  recommendations = [],\n  animationDelay = 0,\n}: AreaOfImprovementCardProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n\n  // Find matching recommendations for this flaw\n  const matchedRecommendations = useMemo(() => {\n    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n    return recommendations.filter(rec =>\n      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n    ).slice(0, 3);\n  }, [flaw, recommendations]);\n\n  // Map phase names\n  const mapPhase = (phase: string): ProcedurePhase => {\n    if (phase === 'Foundational') return 'Foundational';\n    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n    if (phase === 'Surgical') return 'Surgical';\n    return 'Non-Invasive';\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.3, delay: animationDelay }}\n      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-red-500/30' : 'border-neutral-800 hover:border-neutral-700'\n        }`}\n    >\n      {/* Header Button */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <SeverityBadge severity={severity} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-500\">\n                -{(typeof flaw.harmonyPercentageLost === 'number' && Number.isFinite(flaw.harmonyPercentageLost)\n                  ? flaw.harmonyPercentageLost\n                  : 0\n                ).toFixed(2)}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n              {flaw.rollingHarmonyPercentageLost !== undefined &&\n                typeof flaw.rollingHarmonyPercentageLost === 'number' &&\n                Number.isFinite(flaw.rollingHarmonyPercentageLost) && (\n                  <div className=\"text-[10px] text-neutral-600 font-medium pt-0.5 border-t border-neutral-700 mt-1\">\n                    Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n                  </div>\n                )}\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3 }}\n            className=\"overflow-hidden\"\n          >\n            {/* Affected Ratios Section */}\n            <div className=\"border-t border-neutral-800 bg-neutral-800/30 px-4 sm:px-5 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Affected Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {flaw.responsibleRatios.map((ratio, i) => (\n                  <ContributingRatioButton\n                    key={ratio.ratioId}\n                    ratioName={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick(ratio)}\n                    animationDelay={i * 0.05}\n                  />\n                ))}\n              </div>\n            </div>\n\n            {/* Your Plan Section (if there are matched recommendations) */}\n            {matchedRecommendations.length > 0 && (\n              <div className=\"border-t border-neutral-800 bg-emerald-900/10 px-4 sm:px-5 py-3 sm:py-4\">\n                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n                  <Sparkles className=\"w-3 h-3 text-emerald-400\" />\n                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-400 uppercase tracking-wider\">\n                    Your Plan\n                  </span>\n                </div>\n                <div className=\"space-y-2\">\n                  {matchedRecommendations.map((rec, i) => (\n                    <PlanItem\n                      key={rec.ref_id}\n                      name={rec.name}\n                      phase={mapPhase(rec.phase)}\n                      animationDelay={i * 0.05}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n\n// ============================================\n// KEY STRENGTHS SECTION (Harmony Style)\n// ============================================\n\ninterface KeyStrengthsSectionProps {\n  strengths: Strength[];\n  onRatioClick: (ratio: ResponsibleRatio, categoryName: string) => void;\n  initialShowCount?: number;\n}\n\nexport function KeyStrengthsSection({\n  strengths,\n  onRatioClick,\n  initialShowCount = 3,\n}: KeyStrengthsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const displayedStrengths = showAll ? strengths : strengths.slice(0, initialShowCount);\n  const remainingCount = Math.max(0, strengths.length - initialShowCount);\n\n  // Calculate average strength contribution (handle invalid values)\n  const avgScore = useMemo(() => {\n    if (!strengths || strengths.length === 0) return 0;\n    const validScores = strengths.filter(\n      (s) => typeof s.avgScore === 'number' && Number.isFinite(s.avgScore)\n    );\n    if (validScores.length === 0) return 0;\n    return validScores.reduce((sum, s) => sum + (s.avgScore as number), 0) / validScores.length;\n  }, [strengths]);\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/50 border border-neutral-800 p-4 sm:p-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-4 sm:mb-5\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center\">\n            <Sparkles className=\"w-4 h-4 text-cyan-400\" />\n          </div>\n          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n            Key Strengths\n          </h3>\n        </div>\n        <div className=\"text-right\">\n          <span className=\"text-sm text-neutral-500\">\n            {strengths.length} total\n          </span>\n          {strengths.length > 0 && (\n            <p className=\"text-xs text-green-400 font-medium\">\n              Avg: {avgScore.toFixed(1)}/10\n            </p>\n          )}\n        </div>\n      </div>\n\n      {/* Cards */}\n      <div className=\"space-y-3\">\n        {displayedStrengths.length > 0 ? (\n          displayedStrengths.map((strength, i) => (\n            <KeyStrengthCard\n              key={strength.id}\n              strength={strength}\n              isExpanded={expandedId === strength.id}\n              onToggle={() => setExpandedId(expandedId === strength.id ? null : strength.id)}\n              onRatioClick={(ratio) => onRatioClick(ratio, strength.categoryName)}\n              animationDelay={i * 0.04}\n            />\n          ))\n        ) : (\n          <div className=\"rounded-xl bg-neutral-800/50 border border-neutral-700 p-6 text-center\">\n            <p className=\"text-neutral-500\">No significant strengths detected</p>\n          </div>\n        )}\n      </div>\n\n      {/* Show More Button */}\n      {remainingCount > 0 && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-4 py-3 rounded-lg bg-neutral-800/50 border border-neutral-700 hover:border-neutral-600 hover:bg-neutral-800 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show ${remainingCount} More`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// AREAS OF IMPROVEMENT SECTION (Harmony Style with Your Plan)\n// ============================================\n\ninterface AreasOfImprovementSectionProps {\n  flaws: Flaw[];\n  onRatioClick: (ratio: ResponsibleRatio, categoryName: string) => void;\n  initialShowCount?: number;\n}\n\nexport function AreasOfImprovementSection({\n  flaws,\n  onRatioClick,\n  initialShowCount = 3,\n}: AreasOfImprovementSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  // Get recommendations from context\n  const { recommendations } = useResults();\n\n  const displayedFlaws = showAll ? flaws : flaws.slice(0, initialShowCount);\n  const remainingCount = Math.max(0, flaws.length - initialShowCount);\n\n  // Calculate total impact from all flaws (handle invalid values)\n  const totalImpact = flaws.reduce((sum, f) => {\n    const impact = typeof f.harmonyPercentageLost === 'number' && Number.isFinite(f.harmonyPercentageLost)\n      ? f.harmonyPercentageLost\n      : 0;\n    return sum + impact;\n  }, 0);\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/50 border border-neutral-800 p-4 sm:p-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-4 sm:mb-5\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-8 rounded-lg bg-amber-500/20 flex items-center justify-center\">\n            <AlertTriangle className=\"w-4 h-4 text-amber-400\" />\n          </div>\n          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n            Areas of Improvement\n          </h3>\n        </div>\n        <div className=\"text-right\">\n          <span className=\"text-sm text-neutral-500\">\n            {flaws.length} total\n          </span>\n          {flaws.length > 0 && (\n            <p className=\"text-xs text-red-400 font-medium\">\n              Impact: -{totalImpact.toFixed(1)} pts\n            </p>\n          )}\n        </div>\n      </div>\n\n      {/* Cards */}\n      <div className=\"space-y-3\">\n        {displayedFlaws.length > 0 ? (\n          displayedFlaws.map((flaw, i) => (\n            <AreaOfImprovementCard\n              key={flaw.id}\n              flaw={flaw}\n              isExpanded={expandedId === flaw.id}\n              onToggle={() => setExpandedId(expandedId === flaw.id ? null : flaw.id)}\n              onRatioClick={(ratio) => onRatioClick(ratio, flaw.categoryName)}\n              recommendations={recommendations}\n              animationDelay={i * 0.04}\n            />\n          ))\n        ) : (\n          <div className=\"rounded-xl bg-neutral-800/50 border border-neutral-700 p-6 text-center\">\n            <p className=\"text-neutral-500\">No significant areas for improvement detected</p>\n          </div>\n        )}\n      </div>\n\n      {/* Show More Button */}\n      {remainingCount > 0 && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-4 py-3 rounded-lg bg-neutral-800/50 border border-neutral-700 hover:border-neutral-600 hover:bg-neutral-800 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show ${remainingCount} More`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n","structuredPatch":[{"oldStart":463,"oldLines":9,"newStart":463,"newLines":12,"lines":["         className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"","       >","         <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">","-          {/* Left: Badge + Content */}","+          {/* Left: Badges + Content */}","           <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">","-            <SeverityBadge severity={severity} />","+            <div className=\"flex flex-col gap-1\">","+              <SeverityBadge severity={severity} />","+              {flaw.confidence && <ConfidenceBadge confidence={flaw.confidence} />}","+            </div>","             <div className=\"flex-1 min-w-0\">","               <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">","                 {flaw.flawName}"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"8892731a-7a41-45e5-a773-edb867b32445","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01STaVuiDUSyHFS2jioT3kTT","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me also update the `WeakPointCard.tsx` to display the confidence badge:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1620,"cache_read_input_tokens":107741,"cache_creation":{"ephemeral_5m_input_tokens":1620,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVVWDkXSAQ28o1voHEuN","type":"assistant","uuid":"222a2c72-e0ad-4a56-bc0d-2b09b2eaf203","timestamp":"2025-12-26T14:55:45.635Z"}
{"parentUuid":"222a2c72-e0ad-4a56-bc0d-2b09b2eaf203","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01STaVuiDUSyHFS2jioT3kTT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01613DPMXNhivPGV148kizFT","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1620,"cache_read_input_tokens":107741,"cache_creation":{"ephemeral_5m_input_tokens":1620,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVVWDkXSAQ28o1voHEuN","type":"assistant","uuid":"bd9f6b67-db9c-4000-aeed-551b54010fa8","timestamp":"2025-12-26T14:55:46.381Z"}
{"parentUuid":"bd9f6b67-db9c-4000-aeed-551b54010fa8","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01613DPMXNhivPGV148kizFT","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useState } from 'react';\n     4→import { motion, AnimatePresence } from 'framer-motion';\n     5→import {\n     6→  ChevronDown,\n     7→  ChevronUp,\n     8→  ShoppingCart,\n     9→  Zap,\n    10→  ArrowRight,\n    11→  Package,\n    12→} from 'lucide-react';\n    13→import { Flaw, ProductRecommendation, Recommendation } from '@/types/results';\n    14→import { ProductCard } from './ProductCard';\n    15→\n    16→interface WeakPointCardProps {\n    17→  flaw: Flaw;\n    18→  rank: number;\n    19→  products: ProductRecommendation[];\n    20→  treatments: Recommendation[];\n    21→  onViewTreatment?: (treatment: Recommendation) => void;\n    22→}\n    23→\n    24→export function WeakPointCard({\n    25→  flaw,\n    26→  rank,\n    27→  products,\n    28→  treatments,\n    29→  onViewTreatment,\n    30→}: WeakPointCardProps) {\n    31→  const [isExpanded, setIsExpanded] = useState(false);\n    32→\n    33→  // Severity colors\n    34→  const getSeverityColor = (impact: number) => {\n    35→    if (impact >= 5) return { bg: 'bg-red-500/20', border: 'border-red-500/30', text: 'text-red-400' };\n    36→    if (impact >= 3) return { bg: 'bg-orange-500/20', border: 'border-orange-500/30', text: 'text-orange-400' };\n    37→    return { bg: 'bg-yellow-500/20', border: 'border-yellow-500/30', text: 'text-yellow-400' };\n    38→  };\n    39→\n    40→  const colors = getSeverityColor(flaw.harmonyPercentageLost);\n    41→\n    42→  return (\n    43→    <motion.div\n    44→      className={`${colors.bg} border ${colors.border} rounded-xl overflow-hidden`}\n    45→      initial={{ opacity: 0, y: 10 }}\n    46→      animate={{ opacity: 1, y: 0 }}\n    47→      transition={{ delay: rank * 0.05 }}\n    48→    >\n    49→      {/* Header */}\n    50→      <button\n    51→        onClick={() => setIsExpanded(!isExpanded)}\n    52→        className=\"w-full p-4 flex items-center justify-between hover:bg-white/5 transition-colors\"\n    53→      >\n    54→        <div className=\"flex items-center gap-3\">\n    55→          <div className={`w-8 h-8 rounded-lg ${colors.bg} flex items-center justify-center`}>\n    56→            <span className={`text-sm font-bold ${colors.text}`}>#{rank}</span>\n    57→          </div>\n    58→          <div className=\"text-left\">\n    59→            <h4 className=\"font-medium text-white\">{flaw.flawName}</h4>\n    60→            <p className=\"text-xs text-neutral-400\">{flaw.categoryName}</p>\n    61→          </div>\n    62→        </div>\n    63→\n    64→        <div className=\"flex items-center gap-4\">\n    65→          <div className=\"text-right\">\n    66→            <span className={`text-sm font-semibold ${colors.text}`}>\n    67→              -{flaw.harmonyPercentageLost.toFixed(1)}%\n    68→            </span>\n    69→            <p className=\"text-xs text-neutral-500\">harmony lost</p>\n    70→          </div>\n    71→          {isExpanded ? (\n    72→            <ChevronUp size={20} className=\"text-neutral-400\" />\n    73→          ) : (\n    74→            <ChevronDown size={20} className=\"text-neutral-400\" />\n    75→          )}\n    76→        </div>\n    77→      </button>\n    78→\n    79→      {/* Expanded Content */}\n    80→      <AnimatePresence>\n    81→        {isExpanded && (\n    82→          <motion.div\n    83→            initial={{ height: 0, opacity: 0 }}\n    84→            animate={{ height: 'auto', opacity: 1 }}\n    85→            exit={{ height: 0, opacity: 0 }}\n    86→            transition={{ duration: 0.2 }}\n    87→            className=\"overflow-hidden\"\n    88→          >\n    89→            <div className=\"px-4 pb-4 space-y-4\">\n    90→              {/* Summary */}\n    91→              <p className=\"text-sm text-neutral-300\">{flaw.summary}</p>\n    92→\n    93→              {/* Contributing Ratios */}\n    94→              {flaw.responsibleRatios.length > 0 && (\n    95→                <div className=\"space-y-2\">\n    96→                  <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n    97→                    Contributing Metrics\n    98→                  </h5>\n    99→                  <div className=\"flex flex-wrap gap-2\">\n   100→                    {flaw.responsibleRatios.slice(0, 3).map((ratio) => (\n   101→                      <div\n   102→                        key={ratio.ratioId}\n   103→                        className=\"px-2 py-1 bg-neutral-800/50 rounded-lg text-xs\"\n   104→                      >\n   105→                        <span className=\"text-neutral-300\">{ratio.ratioName}</span>\n   106→                        <span className=\"text-neutral-500 ml-1\">\n   107→                          ({typeof ratio.score === 'number' ? ratio.score.toFixed(1) : ratio.score}/10)\n   108→                        </span>\n   109→                      </div>\n   110→                    ))}\n   111→                  </div>\n   112→                </div>\n   113→              )}\n   114→\n   115→              {/* Products to Fix */}\n   116→              {products.length > 0 && (\n   117→                <div className=\"space-y-3\">\n   118→                  <div className=\"flex items-center gap-2\">\n   119→                    <Package size={14} className=\"text-cyan-400\" />\n   120→                    <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n   121→                      Products to Help\n   122→                    </h5>\n   123→                  </div>\n   124→                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n   125→                    {products.slice(0, 2).map((rec) => (\n   126→                      <ProductCard key={rec.product.id} recommendation={rec} compact />\n   127→                    ))}\n   128→                  </div>\n   129→                  {products.length > 2 && (\n   130→                    <p className=\"text-xs text-neutral-500 text-center\">\n   131→                      +{products.length - 2} more products\n   132→                    </p>\n   133→                  )}\n   134→                </div>\n   135→              )}\n   136→\n   137→              {/* Treatments */}\n   138→              {treatments.length > 0 && (\n   139→                <div className=\"space-y-3\">\n   140→                  <div className=\"flex items-center gap-2\">\n   141→                    <Zap size={14} className=\"text-purple-400\" />\n   142→                    <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n   143→                      Recommended Treatments\n   144→                    </h5>\n   145→                  </div>\n   146→                  <div className=\"space-y-2\">\n   147→                    {treatments.slice(0, 3).map((treatment) => (\n   148→                      <button\n   149→                        key={treatment.ref_id}\n   150→                        onClick={() => onViewTreatment?.(treatment)}\n   151→                        className=\"w-full flex items-center justify-between p-3 bg-neutral-800/50 rounded-lg hover:bg-neutral-800 transition-colors group\"\n   152→                      >\n   153→                        <div className=\"flex items-center gap-3\">\n   154→                          <div className={`px-2 py-0.5 rounded text-xs font-medium ${\n   155→                            treatment.phase === 'Foundational'\n   156→                              ? 'bg-green-500/20 text-green-400'\n   157→                              : treatment.phase === 'Minimally Invasive'\n   158→                                ? 'bg-yellow-500/20 text-yellow-400'\n   159→                                : 'bg-red-500/20 text-red-400'\n   160→                          }`}>\n   161→                            {treatment.phase}\n   162→                          </div>\n   163→                          <span className=\"text-sm text-white\">{treatment.name}</span>\n   164→                        </div>\n   165→                        <div className=\"flex items-center gap-2\">\n   166→                          <span className=\"text-xs text-green-400\">\n   167→                            +{(treatment.impact * 100).toFixed(0)}% improvement\n   168→                          </span>\n   169→                          <ArrowRight size={14} className=\"text-neutral-500 group-hover:text-cyan-400 transition-colors\" />\n   170→                        </div>\n   171→                      </button>\n   172→                    ))}\n   173→                  </div>\n   174→                </div>\n   175→              )}\n   176→\n   177→              {/* CTA */}\n   178→              <div className=\"pt-2 border-t border-neutral-800\">\n   179→                <a\n   180→                  href=\"#plan\"\n   181→                  className=\"flex items-center justify-center gap-2 w-full py-2.5 bg-gradient-to-r from-cyan-500 to-blue-600 text-black text-sm font-medium rounded-lg hover:opacity-90 transition-opacity\"\n   182→                >\n   183→                  <ShoppingCart size={16} />\n   184→                  View Full Fix Plan\n   185→                </a>\n   186→              </div>\n   187→            </div>\n   188→          </motion.div>\n   189→        )}\n   190→      </AnimatePresence>\n   191→    </motion.div>\n   192→  );\n   193→}\n   194→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"bdbf91b6-1783-41dd-a5a2-1ff8645e2c20","timestamp":"2025-12-26T14:55:46.437Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx","content":"'use client';\n\nimport { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  ChevronDown,\n  ChevronUp,\n  ShoppingCart,\n  Zap,\n  ArrowRight,\n  Package,\n} from 'lucide-react';\nimport { Flaw, ProductRecommendation, Recommendation } from '@/types/results';\nimport { ProductCard } from './ProductCard';\n\ninterface WeakPointCardProps {\n  flaw: Flaw;\n  rank: number;\n  products: ProductRecommendation[];\n  treatments: Recommendation[];\n  onViewTreatment?: (treatment: Recommendation) => void;\n}\n\nexport function WeakPointCard({\n  flaw,\n  rank,\n  products,\n  treatments,\n  onViewTreatment,\n}: WeakPointCardProps) {\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  // Severity colors\n  const getSeverityColor = (impact: number) => {\n    if (impact >= 5) return { bg: 'bg-red-500/20', border: 'border-red-500/30', text: 'text-red-400' };\n    if (impact >= 3) return { bg: 'bg-orange-500/20', border: 'border-orange-500/30', text: 'text-orange-400' };\n    return { bg: 'bg-yellow-500/20', border: 'border-yellow-500/30', text: 'text-yellow-400' };\n  };\n\n  const colors = getSeverityColor(flaw.harmonyPercentageLost);\n\n  return (\n    <motion.div\n      className={`${colors.bg} border ${colors.border} rounded-xl overflow-hidden`}\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ delay: rank * 0.05 }}\n    >\n      {/* Header */}\n      <button\n        onClick={() => setIsExpanded(!isExpanded)}\n        className=\"w-full p-4 flex items-center justify-between hover:bg-white/5 transition-colors\"\n      >\n        <div className=\"flex items-center gap-3\">\n          <div className={`w-8 h-8 rounded-lg ${colors.bg} flex items-center justify-center`}>\n            <span className={`text-sm font-bold ${colors.text}`}>#{rank}</span>\n          </div>\n          <div className=\"text-left\">\n            <h4 className=\"font-medium text-white\">{flaw.flawName}</h4>\n            <p className=\"text-xs text-neutral-400\">{flaw.categoryName}</p>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-4\">\n          <div className=\"text-right\">\n            <span className={`text-sm font-semibold ${colors.text}`}>\n              -{flaw.harmonyPercentageLost.toFixed(1)}%\n            </span>\n            <p className=\"text-xs text-neutral-500\">harmony lost</p>\n          </div>\n          {isExpanded ? (\n            <ChevronUp size={20} className=\"text-neutral-400\" />\n          ) : (\n            <ChevronDown size={20} className=\"text-neutral-400\" />\n          )}\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.2 }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"px-4 pb-4 space-y-4\">\n              {/* Summary */}\n              <p className=\"text-sm text-neutral-300\">{flaw.summary}</p>\n\n              {/* Contributing Ratios */}\n              {flaw.responsibleRatios.length > 0 && (\n                <div className=\"space-y-2\">\n                  <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n                    Contributing Metrics\n                  </h5>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {flaw.responsibleRatios.slice(0, 3).map((ratio) => (\n                      <div\n                        key={ratio.ratioId}\n                        className=\"px-2 py-1 bg-neutral-800/50 rounded-lg text-xs\"\n                      >\n                        <span className=\"text-neutral-300\">{ratio.ratioName}</span>\n                        <span className=\"text-neutral-500 ml-1\">\n                          ({typeof ratio.score === 'number' ? ratio.score.toFixed(1) : ratio.score}/10)\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Products to Fix */}\n              {products.length > 0 && (\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Package size={14} className=\"text-cyan-400\" />\n                    <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n                      Products to Help\n                    </h5>\n                  </div>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                    {products.slice(0, 2).map((rec) => (\n                      <ProductCard key={rec.product.id} recommendation={rec} compact />\n                    ))}\n                  </div>\n                  {products.length > 2 && (\n                    <p className=\"text-xs text-neutral-500 text-center\">\n                      +{products.length - 2} more products\n                    </p>\n                  )}\n                </div>\n              )}\n\n              {/* Treatments */}\n              {treatments.length > 0 && (\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Zap size={14} className=\"text-purple-400\" />\n                    <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n                      Recommended Treatments\n                    </h5>\n                  </div>\n                  <div className=\"space-y-2\">\n                    {treatments.slice(0, 3).map((treatment) => (\n                      <button\n                        key={treatment.ref_id}\n                        onClick={() => onViewTreatment?.(treatment)}\n                        className=\"w-full flex items-center justify-between p-3 bg-neutral-800/50 rounded-lg hover:bg-neutral-800 transition-colors group\"\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <div className={`px-2 py-0.5 rounded text-xs font-medium ${\n                            treatment.phase === 'Foundational'\n                              ? 'bg-green-500/20 text-green-400'\n                              : treatment.phase === 'Minimally Invasive'\n                                ? 'bg-yellow-500/20 text-yellow-400'\n                                : 'bg-red-500/20 text-red-400'\n                          }`}>\n                            {treatment.phase}\n                          </div>\n                          <span className=\"text-sm text-white\">{treatment.name}</span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-xs text-green-400\">\n                            +{(treatment.impact * 100).toFixed(0)}% improvement\n                          </span>\n                          <ArrowRight size={14} className=\"text-neutral-500 group-hover:text-cyan-400 transition-colors\" />\n                        </div>\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* CTA */}\n              <div className=\"pt-2 border-t border-neutral-800\">\n                <a\n                  href=\"#plan\"\n                  className=\"flex items-center justify-center gap-2 w-full py-2.5 bg-gradient-to-r from-cyan-500 to-blue-600 text-black text-sm font-medium rounded-lg hover:opacity-90 transition-opacity\"\n                >\n                  <ShoppingCart size={16} />\n                  View Full Fix Plan\n                </a>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n","numLines":194,"startLine":1,"totalLines":194}}}
{"parentUuid":"bdbf91b6-1783-41dd-a5a2-1ff8645e2c20","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UdxcfRgqDszfMwBLgri82d","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me update `WeakPointCard.tsx` to also display the confidence badge:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":3118,"cache_read_input_tokens":109361,"cache_creation":{"ephemeral_5m_input_tokens":3118,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWVVWZA5fPKJK4UcKqmkK","type":"assistant","uuid":"a856aa41-b58a-40b2-a918-ac9728d61b0b","timestamp":"2025-12-26T14:55:50.383Z"}
{"parentUuid":"a856aa41-b58a-40b2-a918-ac9728d61b0b","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UdxcfRgqDszfMwBLgri82d","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Lx5XB4oh6bM9cGWbLRytMq","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx","old_string":"import { Flaw, ProductRecommendation, Recommendation } from '@/types/results';\nimport { ProductCard } from './ProductCard';","new_string":"import { Flaw, ProductRecommendation, Recommendation } from '@/types/results';\nimport { ProductCard } from './ProductCard';\nimport { ConfidenceLevel } from '@/lib/harmony-scoring';\n\n// ============================================\n// CONFIDENCE BADGE COMPONENT\n// ============================================\n\nconst CONFIDENCE_CONFIGS: Record<ConfidenceLevel, { label: string; bgClass: string; textClass: string; icon: string }> = {\n  confirmed: {\n    label: 'Confirmed',\n    bgClass: 'bg-green-500/20',\n    textClass: 'text-green-400',\n    icon: '\\u2713',\n  },\n  likely: {\n    label: 'Likely',\n    bgClass: 'bg-blue-500/20',\n    textClass: 'text-blue-400',\n    icon: '\\u2248',\n  },\n  possible: {\n    label: 'Possible',\n    bgClass: 'bg-neutral-500/20',\n    textClass: 'text-neutral-400',\n    icon: '?',\n  },\n};\n\nfunction ConfidenceBadge({ confidence }: { confidence: ConfidenceLevel }) {\n  const config = CONFIDENCE_CONFIGS[confidence] || CONFIDENCE_CONFIGS.possible;\n  return (\n    <span\n      className={`inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] font-medium ${config.bgClass} ${config.textClass}`}\n      title={`Detection confidence: ${config.label}`}\n    >\n      <span className=\"text-[8px]\">{config.icon}</span>\n      {config.label}\n    </span>\n  );\n}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":3118,"cache_read_input_tokens":109361,"cache_creation":{"ephemeral_5m_input_tokens":3118,"ephemeral_1h_input_tokens":0},"output_tokens":600,"service_tier":"standard"}},"requestId":"req_011CWVVWZA5fPKJK4UcKqmkK","type":"assistant","uuid":"803d2281-157a-412b-a731-af0d87b3d0ae","timestamp":"2025-12-26T14:55:59.974Z"}
{"parentUuid":"803d2281-157a-412b-a731-af0d87b3d0ae","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Lx5XB4oh6bM9cGWbLRytMq","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n     9→  Zap,\n    10→  ArrowRight,\n    11→  Package,\n    12→} from 'lucide-react';\n    13→import { Flaw, ProductRecommendation, Recommendation } from '@/types/results';\n    14→import { ProductCard } from './ProductCard';\n    15→import { ConfidenceLevel } from '@/lib/harmony-scoring';\n    16→\n    17→// ============================================\n    18→// CONFIDENCE BADGE COMPONENT\n    19→// ============================================\n    20→\n    21→const CONFIDENCE_CONFIGS: Record<ConfidenceLevel, { label: string; bgClass: string; textClass: string; icon: string }> = {\n    22→  confirmed: {\n    23→    label: 'Confirmed',\n    24→    bgClass: 'bg-green-500/20',\n    25→    textClass: 'text-green-400',\n    26→    icon: '\\u2713',\n    27→  },\n    28→  likely: {\n    29→    label: 'Likely',\n    30→    bgClass: 'bg-blue-500/20',\n    31→    textClass: 'text-blue-400',\n    32→    icon: '\\u2248',\n    33→  },\n    34→  possible: {\n    35→    label: 'Possible',\n    36→    bgClass: 'bg-neutral-500/20',\n    37→    textClass: 'text-neutral-400',\n    38→    icon: '?',\n    39→  },\n    40→};\n    41→\n    42→function ConfidenceBadge({ confidence }: { confidence: ConfidenceLevel }) {\n    43→  const config = CONFIDENCE_CONFIGS[confidence] || CONFIDENCE_CONFIGS.possible;\n    44→  return (\n    45→    <span\n    46→      className={`inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] font-medium ${config.bgClass} ${config.textClass}`}\n    47→      title={`Detection confidence: ${config.label}`}\n    48→    >\n    49→      <span className=\"text-[8px]\">{config.icon}</span>\n    50→      {config.label}\n    51→    </span>\n    52→  );\n    53→}\n    54→\n    55→interface WeakPointCardProps {\n    56→  flaw: Flaw;\n    57→  rank: number;"}]},"uuid":"0c7a6005-63bb-4d4d-8c35-f33f7f899e31","timestamp":"2025-12-26T14:56:00.035Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx","oldString":"import { Flaw, ProductRecommendation, Recommendation } from '@/types/results';\nimport { ProductCard } from './ProductCard';","newString":"import { Flaw, ProductRecommendation, Recommendation } from '@/types/results';\nimport { ProductCard } from './ProductCard';\nimport { ConfidenceLevel } from '@/lib/harmony-scoring';\n\n// ============================================\n// CONFIDENCE BADGE COMPONENT\n// ============================================\n\nconst CONFIDENCE_CONFIGS: Record<ConfidenceLevel, { label: string; bgClass: string; textClass: string; icon: string }> = {\n  confirmed: {\n    label: 'Confirmed',\n    bgClass: 'bg-green-500/20',\n    textClass: 'text-green-400',\n    icon: '\\u2713',\n  },\n  likely: {\n    label: 'Likely',\n    bgClass: 'bg-blue-500/20',\n    textClass: 'text-blue-400',\n    icon: '\\u2248',\n  },\n  possible: {\n    label: 'Possible',\n    bgClass: 'bg-neutral-500/20',\n    textClass: 'text-neutral-400',\n    icon: '?',\n  },\n};\n\nfunction ConfidenceBadge({ confidence }: { confidence: ConfidenceLevel }) {\n  const config = CONFIDENCE_CONFIGS[confidence] || CONFIDENCE_CONFIGS.possible;\n  return (\n    <span\n      className={`inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] font-medium ${config.bgClass} ${config.textClass}`}\n      title={`Detection confidence: ${config.label}`}\n    >\n      <span className=\"text-[8px]\">{config.icon}</span>\n      {config.label}\n    </span>\n  );\n}","originalFile":"'use client';\n\nimport { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  ChevronDown,\n  ChevronUp,\n  ShoppingCart,\n  Zap,\n  ArrowRight,\n  Package,\n} from 'lucide-react';\nimport { Flaw, ProductRecommendation, Recommendation } from '@/types/results';\nimport { ProductCard } from './ProductCard';\n\ninterface WeakPointCardProps {\n  flaw: Flaw;\n  rank: number;\n  products: ProductRecommendation[];\n  treatments: Recommendation[];\n  onViewTreatment?: (treatment: Recommendation) => void;\n}\n\nexport function WeakPointCard({\n  flaw,\n  rank,\n  products,\n  treatments,\n  onViewTreatment,\n}: WeakPointCardProps) {\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  // Severity colors\n  const getSeverityColor = (impact: number) => {\n    if (impact >= 5) return { bg: 'bg-red-500/20', border: 'border-red-500/30', text: 'text-red-400' };\n    if (impact >= 3) return { bg: 'bg-orange-500/20', border: 'border-orange-500/30', text: 'text-orange-400' };\n    return { bg: 'bg-yellow-500/20', border: 'border-yellow-500/30', text: 'text-yellow-400' };\n  };\n\n  const colors = getSeverityColor(flaw.harmonyPercentageLost);\n\n  return (\n    <motion.div\n      className={`${colors.bg} border ${colors.border} rounded-xl overflow-hidden`}\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ delay: rank * 0.05 }}\n    >\n      {/* Header */}\n      <button\n        onClick={() => setIsExpanded(!isExpanded)}\n        className=\"w-full p-4 flex items-center justify-between hover:bg-white/5 transition-colors\"\n      >\n        <div className=\"flex items-center gap-3\">\n          <div className={`w-8 h-8 rounded-lg ${colors.bg} flex items-center justify-center`}>\n            <span className={`text-sm font-bold ${colors.text}`}>#{rank}</span>\n          </div>\n          <div className=\"text-left\">\n            <h4 className=\"font-medium text-white\">{flaw.flawName}</h4>\n            <p className=\"text-xs text-neutral-400\">{flaw.categoryName}</p>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-4\">\n          <div className=\"text-right\">\n            <span className={`text-sm font-semibold ${colors.text}`}>\n              -{flaw.harmonyPercentageLost.toFixed(1)}%\n            </span>\n            <p className=\"text-xs text-neutral-500\">harmony lost</p>\n          </div>\n          {isExpanded ? (\n            <ChevronUp size={20} className=\"text-neutral-400\" />\n          ) : (\n            <ChevronDown size={20} className=\"text-neutral-400\" />\n          )}\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.2 }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"px-4 pb-4 space-y-4\">\n              {/* Summary */}\n              <p className=\"text-sm text-neutral-300\">{flaw.summary}</p>\n\n              {/* Contributing Ratios */}\n              {flaw.responsibleRatios.length > 0 && (\n                <div className=\"space-y-2\">\n                  <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n                    Contributing Metrics\n                  </h5>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {flaw.responsibleRatios.slice(0, 3).map((ratio) => (\n                      <div\n                        key={ratio.ratioId}\n                        className=\"px-2 py-1 bg-neutral-800/50 rounded-lg text-xs\"\n                      >\n                        <span className=\"text-neutral-300\">{ratio.ratioName}</span>\n                        <span className=\"text-neutral-500 ml-1\">\n                          ({typeof ratio.score === 'number' ? ratio.score.toFixed(1) : ratio.score}/10)\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Products to Fix */}\n              {products.length > 0 && (\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Package size={14} className=\"text-cyan-400\" />\n                    <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n                      Products to Help\n                    </h5>\n                  </div>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                    {products.slice(0, 2).map((rec) => (\n                      <ProductCard key={rec.product.id} recommendation={rec} compact />\n                    ))}\n                  </div>\n                  {products.length > 2 && (\n                    <p className=\"text-xs text-neutral-500 text-center\">\n                      +{products.length - 2} more products\n                    </p>\n                  )}\n                </div>\n              )}\n\n              {/* Treatments */}\n              {treatments.length > 0 && (\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Zap size={14} className=\"text-purple-400\" />\n                    <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n                      Recommended Treatments\n                    </h5>\n                  </div>\n                  <div className=\"space-y-2\">\n                    {treatments.slice(0, 3).map((treatment) => (\n                      <button\n                        key={treatment.ref_id}\n                        onClick={() => onViewTreatment?.(treatment)}\n                        className=\"w-full flex items-center justify-between p-3 bg-neutral-800/50 rounded-lg hover:bg-neutral-800 transition-colors group\"\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <div className={`px-2 py-0.5 rounded text-xs font-medium ${\n                            treatment.phase === 'Foundational'\n                              ? 'bg-green-500/20 text-green-400'\n                              : treatment.phase === 'Minimally Invasive'\n                                ? 'bg-yellow-500/20 text-yellow-400'\n                                : 'bg-red-500/20 text-red-400'\n                          }`}>\n                            {treatment.phase}\n                          </div>\n                          <span className=\"text-sm text-white\">{treatment.name}</span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-xs text-green-400\">\n                            +{(treatment.impact * 100).toFixed(0)}% improvement\n                          </span>\n                          <ArrowRight size={14} className=\"text-neutral-500 group-hover:text-cyan-400 transition-colors\" />\n                        </div>\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* CTA */}\n              <div className=\"pt-2 border-t border-neutral-800\">\n                <a\n                  href=\"#plan\"\n                  className=\"flex items-center justify-center gap-2 w-full py-2.5 bg-gradient-to-r from-cyan-500 to-blue-600 text-black text-sm font-medium rounded-lg hover:opacity-90 transition-opacity\"\n                >\n                  <ShoppingCart size={16} />\n                  View Full Fix Plan\n                </a>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n","structuredPatch":[{"oldStart":12,"oldLines":7,"newStart":12,"newLines":46,"lines":[" } from 'lucide-react';"," import { Flaw, ProductRecommendation, Recommendation } from '@/types/results';"," import { ProductCard } from './ProductCard';","+import { ConfidenceLevel } from '@/lib/harmony-scoring';"," ","+// ============================================","+// CONFIDENCE BADGE COMPONENT","+// ============================================","+","+const CONFIDENCE_CONFIGS: Record<ConfidenceLevel, { label: string; bgClass: string; textClass: string; icon: string }> = {","+  confirmed: {","+    label: 'Confirmed',","+    bgClass: 'bg-green-500/20',","+    textClass: 'text-green-400',","+    icon: '\\u2713',","+  },","+  likely: {","+    label: 'Likely',","+    bgClass: 'bg-blue-500/20',","+    textClass: 'text-blue-400',","+    icon: '\\u2248',","+  },","+  possible: {","+    label: 'Possible',","+    bgClass: 'bg-neutral-500/20',","+    textClass: 'text-neutral-400',","+    icon: '?',","+  },","+};","+","+function ConfidenceBadge({ confidence }: { confidence: ConfidenceLevel }) {","+  const config = CONFIDENCE_CONFIGS[confidence] || CONFIDENCE_CONFIGS.possible;","+  return (","+    <span","+      className={`inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] font-medium ${config.bgClass} ${config.textClass}`}","+      title={`Detection confidence: ${config.label}`}","+    >","+      <span className=\"text-[8px]\">{config.icon}</span>","+      {config.label}","+    </span>","+  );","+}","+"," interface WeakPointCardProps {","   flaw: Flaw;","   rank: number;"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"0c7a6005-63bb-4d4d-8c35-f33f7f899e31","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01SLDJrPBrQYLa6ai2Go3DFK","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me update the WeakPointCard to display the confidence badge:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1297,"cache_read_input_tokens":112479,"cache_creation":{"ephemeral_5m_input_tokens":1297,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWVVXYh5jpePM7sT9XRJV","type":"assistant","uuid":"3a79c431-a66d-4451-aab6-f1550698e16f","timestamp":"2025-12-26T14:56:06.134Z"}
{"parentUuid":"3a79c431-a66d-4451-aab6-f1550698e16f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01SLDJrPBrQYLa6ai2Go3DFK","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Bgfu6kLYtRTQMucKrc88HD","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx","offset":85,"limit":25}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1297,"cache_read_input_tokens":112479,"cache_creation":{"ephemeral_5m_input_tokens":1297,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWVVXYh5jpePM7sT9XRJV","type":"assistant","uuid":"8b60408f-bffc-45a4-aa7a-3d9ff6843b0f","timestamp":"2025-12-26T14:56:07.723Z"}
{"parentUuid":"8b60408f-bffc-45a4-aa7a-3d9ff6843b0f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Bgfu6kLYtRTQMucKrc88HD","type":"tool_result","content":"    85→      animate={{ opacity: 1, y: 0 }}\n    86→      transition={{ delay: rank * 0.05 }}\n    87→    >\n    88→      {/* Header */}\n    89→      <button\n    90→        onClick={() => setIsExpanded(!isExpanded)}\n    91→        className=\"w-full p-4 flex items-center justify-between hover:bg-white/5 transition-colors\"\n    92→      >\n    93→        <div className=\"flex items-center gap-3\">\n    94→          <div className={`w-8 h-8 rounded-lg ${colors.bg} flex items-center justify-center`}>\n    95→            <span className={`text-sm font-bold ${colors.text}`}>#{rank}</span>\n    96→          </div>\n    97→          <div className=\"text-left\">\n    98→            <h4 className=\"font-medium text-white\">{flaw.flawName}</h4>\n    99→            <p className=\"text-xs text-neutral-400\">{flaw.categoryName}</p>\n   100→          </div>\n   101→        </div>\n   102→\n   103→        <div className=\"flex items-center gap-4\">\n   104→          <div className=\"text-right\">\n   105→            <span className={`text-sm font-semibold ${colors.text}`}>\n   106→              -{flaw.harmonyPercentageLost.toFixed(1)}%\n   107→            </span>\n   108→            <p className=\"text-xs text-neutral-500\">harmony lost</p>\n   109→          </div>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"f43576e1-8e5f-4a28-ab01-8a49ea102189","timestamp":"2025-12-26T14:56:07.871Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx","content":"      animate={{ opacity: 1, y: 0 }}\n      transition={{ delay: rank * 0.05 }}\n    >\n      {/* Header */}\n      <button\n        onClick={() => setIsExpanded(!isExpanded)}\n        className=\"w-full p-4 flex items-center justify-between hover:bg-white/5 transition-colors\"\n      >\n        <div className=\"flex items-center gap-3\">\n          <div className={`w-8 h-8 rounded-lg ${colors.bg} flex items-center justify-center`}>\n            <span className={`text-sm font-bold ${colors.text}`}>#{rank}</span>\n          </div>\n          <div className=\"text-left\">\n            <h4 className=\"font-medium text-white\">{flaw.flawName}</h4>\n            <p className=\"text-xs text-neutral-400\">{flaw.categoryName}</p>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-4\">\n          <div className=\"text-right\">\n            <span className={`text-sm font-semibold ${colors.text}`}>\n              -{flaw.harmonyPercentageLost.toFixed(1)}%\n            </span>\n            <p className=\"text-xs text-neutral-500\">harmony lost</p>\n          </div>","numLines":25,"startLine":85,"totalLines":233}}}
{"parentUuid":"f43576e1-8e5f-4a28-ab01-8a49ea102189","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Bh8UwosuBBF1igb9CF8wqv","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01QWvKpbF7fHWwHX9ex8faFr","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx","old_string":"        <div className=\"flex items-center gap-3\">\n          <div className={`w-8 h-8 rounded-lg ${colors.bg} flex items-center justify-center`}>\n            <span className={`text-sm font-bold ${colors.text}`}>#{rank}</span>\n          </div>\n          <div className=\"text-left\">\n            <h4 className=\"font-medium text-white\">{flaw.flawName}</h4>\n            <p className=\"text-xs text-neutral-400\">{flaw.categoryName}</p>\n          </div>\n        </div>","new_string":"        <div className=\"flex items-center gap-3\">\n          <div className={`w-8 h-8 rounded-lg ${colors.bg} flex items-center justify-center`}>\n            <span className={`text-sm font-bold ${colors.text}`}>#{rank}</span>\n          </div>\n          <div className=\"text-left\">\n            <div className=\"flex items-center gap-2\">\n              <h4 className=\"font-medium text-white\">{flaw.flawName}</h4>\n              {flaw.confidence && <ConfidenceBadge confidence={flaw.confidence} />}\n            </div>\n            <p className=\"text-xs text-neutral-400\">{flaw.categoryName}</p>\n          </div>\n        </div>"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":734,"cache_read_input_tokens":113776,"cache_creation":{"ephemeral_5m_input_tokens":734,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"}},"requestId":"req_011CWVVY89jaQQo1HauoJVWv","type":"assistant","uuid":"98650222-1ea6-4aec-83af-cf99eaab599a","timestamp":"2025-12-26T14:56:22.903Z"}
{"parentUuid":"98650222-1ea6-4aec-83af-cf99eaab599a","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01QWvKpbF7fHWwHX9ex8faFr","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n    89→      <button\n    90→        onClick={() => setIsExpanded(!isExpanded)}\n    91→        className=\"w-full p-4 flex items-center justify-between hover:bg-white/5 transition-colors\"\n    92→      >\n    93→        <div className=\"flex items-center gap-3\">\n    94→          <div className={`w-8 h-8 rounded-lg ${colors.bg} flex items-center justify-center`}>\n    95→            <span className={`text-sm font-bold ${colors.text}`}>#{rank}</span>\n    96→          </div>\n    97→          <div className=\"text-left\">\n    98→            <div className=\"flex items-center gap-2\">\n    99→              <h4 className=\"font-medium text-white\">{flaw.flawName}</h4>\n   100→              {flaw.confidence && <ConfidenceBadge confidence={flaw.confidence} />}\n   101→            </div>\n   102→            <p className=\"text-xs text-neutral-400\">{flaw.categoryName}</p>\n   103→          </div>\n   104→        </div>\n   105→\n   106→        <div className=\"flex items-center gap-4\">\n   107→          <div className=\"text-right\">\n   108→            <span className={`text-sm font-semibold ${colors.text}`}>"}]},"uuid":"e71949fc-111e-487b-ba5d-408dc7596e9a","timestamp":"2025-12-26T14:56:23.006Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx","oldString":"        <div className=\"flex items-center gap-3\">\n          <div className={`w-8 h-8 rounded-lg ${colors.bg} flex items-center justify-center`}>\n            <span className={`text-sm font-bold ${colors.text}`}>#{rank}</span>\n          </div>\n          <div className=\"text-left\">\n            <h4 className=\"font-medium text-white\">{flaw.flawName}</h4>\n            <p className=\"text-xs text-neutral-400\">{flaw.categoryName}</p>\n          </div>\n        </div>","newString":"        <div className=\"flex items-center gap-3\">\n          <div className={`w-8 h-8 rounded-lg ${colors.bg} flex items-center justify-center`}>\n            <span className={`text-sm font-bold ${colors.text}`}>#{rank}</span>\n          </div>\n          <div className=\"text-left\">\n            <div className=\"flex items-center gap-2\">\n              <h4 className=\"font-medium text-white\">{flaw.flawName}</h4>\n              {flaw.confidence && <ConfidenceBadge confidence={flaw.confidence} />}\n            </div>\n            <p className=\"text-xs text-neutral-400\">{flaw.categoryName}</p>\n          </div>\n        </div>","originalFile":"'use client';\n\nimport { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  ChevronDown,\n  ChevronUp,\n  ShoppingCart,\n  Zap,\n  ArrowRight,\n  Package,\n} from 'lucide-react';\nimport { Flaw, ProductRecommendation, Recommendation } from '@/types/results';\nimport { ProductCard } from './ProductCard';\nimport { ConfidenceLevel } from '@/lib/harmony-scoring';\n\n// ============================================\n// CONFIDENCE BADGE COMPONENT\n// ============================================\n\nconst CONFIDENCE_CONFIGS: Record<ConfidenceLevel, { label: string; bgClass: string; textClass: string; icon: string }> = {\n  confirmed: {\n    label: 'Confirmed',\n    bgClass: 'bg-green-500/20',\n    textClass: 'text-green-400',\n    icon: '\\u2713',\n  },\n  likely: {\n    label: 'Likely',\n    bgClass: 'bg-blue-500/20',\n    textClass: 'text-blue-400',\n    icon: '\\u2248',\n  },\n  possible: {\n    label: 'Possible',\n    bgClass: 'bg-neutral-500/20',\n    textClass: 'text-neutral-400',\n    icon: '?',\n  },\n};\n\nfunction ConfidenceBadge({ confidence }: { confidence: ConfidenceLevel }) {\n  const config = CONFIDENCE_CONFIGS[confidence] || CONFIDENCE_CONFIGS.possible;\n  return (\n    <span\n      className={`inline-flex items-center gap-1 px-1.5 py-0.5 rounded text-[9px] font-medium ${config.bgClass} ${config.textClass}`}\n      title={`Detection confidence: ${config.label}`}\n    >\n      <span className=\"text-[8px]\">{config.icon}</span>\n      {config.label}\n    </span>\n  );\n}\n\ninterface WeakPointCardProps {\n  flaw: Flaw;\n  rank: number;\n  products: ProductRecommendation[];\n  treatments: Recommendation[];\n  onViewTreatment?: (treatment: Recommendation) => void;\n}\n\nexport function WeakPointCard({\n  flaw,\n  rank,\n  products,\n  treatments,\n  onViewTreatment,\n}: WeakPointCardProps) {\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  // Severity colors\n  const getSeverityColor = (impact: number) => {\n    if (impact >= 5) return { bg: 'bg-red-500/20', border: 'border-red-500/30', text: 'text-red-400' };\n    if (impact >= 3) return { bg: 'bg-orange-500/20', border: 'border-orange-500/30', text: 'text-orange-400' };\n    return { bg: 'bg-yellow-500/20', border: 'border-yellow-500/30', text: 'text-yellow-400' };\n  };\n\n  const colors = getSeverityColor(flaw.harmonyPercentageLost);\n\n  return (\n    <motion.div\n      className={`${colors.bg} border ${colors.border} rounded-xl overflow-hidden`}\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ delay: rank * 0.05 }}\n    >\n      {/* Header */}\n      <button\n        onClick={() => setIsExpanded(!isExpanded)}\n        className=\"w-full p-4 flex items-center justify-between hover:bg-white/5 transition-colors\"\n      >\n        <div className=\"flex items-center gap-3\">\n          <div className={`w-8 h-8 rounded-lg ${colors.bg} flex items-center justify-center`}>\n            <span className={`text-sm font-bold ${colors.text}`}>#{rank}</span>\n          </div>\n          <div className=\"text-left\">\n            <h4 className=\"font-medium text-white\">{flaw.flawName}</h4>\n            <p className=\"text-xs text-neutral-400\">{flaw.categoryName}</p>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-4\">\n          <div className=\"text-right\">\n            <span className={`text-sm font-semibold ${colors.text}`}>\n              -{flaw.harmonyPercentageLost.toFixed(1)}%\n            </span>\n            <p className=\"text-xs text-neutral-500\">harmony lost</p>\n          </div>\n          {isExpanded ? (\n            <ChevronUp size={20} className=\"text-neutral-400\" />\n          ) : (\n            <ChevronDown size={20} className=\"text-neutral-400\" />\n          )}\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.2 }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"px-4 pb-4 space-y-4\">\n              {/* Summary */}\n              <p className=\"text-sm text-neutral-300\">{flaw.summary}</p>\n\n              {/* Contributing Ratios */}\n              {flaw.responsibleRatios.length > 0 && (\n                <div className=\"space-y-2\">\n                  <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n                    Contributing Metrics\n                  </h5>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {flaw.responsibleRatios.slice(0, 3).map((ratio) => (\n                      <div\n                        key={ratio.ratioId}\n                        className=\"px-2 py-1 bg-neutral-800/50 rounded-lg text-xs\"\n                      >\n                        <span className=\"text-neutral-300\">{ratio.ratioName}</span>\n                        <span className=\"text-neutral-500 ml-1\">\n                          ({typeof ratio.score === 'number' ? ratio.score.toFixed(1) : ratio.score}/10)\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Products to Fix */}\n              {products.length > 0 && (\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Package size={14} className=\"text-cyan-400\" />\n                    <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n                      Products to Help\n                    </h5>\n                  </div>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                    {products.slice(0, 2).map((rec) => (\n                      <ProductCard key={rec.product.id} recommendation={rec} compact />\n                    ))}\n                  </div>\n                  {products.length > 2 && (\n                    <p className=\"text-xs text-neutral-500 text-center\">\n                      +{products.length - 2} more products\n                    </p>\n                  )}\n                </div>\n              )}\n\n              {/* Treatments */}\n              {treatments.length > 0 && (\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Zap size={14} className=\"text-purple-400\" />\n                    <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n                      Recommended Treatments\n                    </h5>\n                  </div>\n                  <div className=\"space-y-2\">\n                    {treatments.slice(0, 3).map((treatment) => (\n                      <button\n                        key={treatment.ref_id}\n                        onClick={() => onViewTreatment?.(treatment)}\n                        className=\"w-full flex items-center justify-between p-3 bg-neutral-800/50 rounded-lg hover:bg-neutral-800 transition-colors group\"\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <div className={`px-2 py-0.5 rounded text-xs font-medium ${\n                            treatment.phase === 'Foundational'\n                              ? 'bg-green-500/20 text-green-400'\n                              : treatment.phase === 'Minimally Invasive'\n                                ? 'bg-yellow-500/20 text-yellow-400'\n                                : 'bg-red-500/20 text-red-400'\n                          }`}>\n                            {treatment.phase}\n                          </div>\n                          <span className=\"text-sm text-white\">{treatment.name}</span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-xs text-green-400\">\n                            +{(treatment.impact * 100).toFixed(0)}% improvement\n                          </span>\n                          <ArrowRight size={14} className=\"text-neutral-500 group-hover:text-cyan-400 transition-colors\" />\n                        </div>\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* CTA */}\n              <div className=\"pt-2 border-t border-neutral-800\">\n                <a\n                  href=\"#plan\"\n                  className=\"flex items-center justify-center gap-2 w-full py-2.5 bg-gradient-to-r from-cyan-500 to-blue-600 text-black text-sm font-medium rounded-lg hover:opacity-90 transition-opacity\"\n                >\n                  <ShoppingCart size={16} />\n                  View Full Fix Plan\n                </a>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n","structuredPatch":[{"oldStart":95,"oldLines":7,"newStart":95,"newLines":10,"lines":["             <span className={`text-sm font-bold ${colors.text}`}>#{rank}</span>","           </div>","           <div className=\"text-left\">","-            <h4 className=\"font-medium text-white\">{flaw.flawName}</h4>","+            <div className=\"flex items-center gap-2\">","+              <h4 className=\"font-medium text-white\">{flaw.flawName}</h4>","+              {flaw.confidence && <ConfidenceBadge confidence={flaw.confidence} />}","+            </div>","             <p className=\"text-xs text-neutral-400\">{flaw.categoryName}</p>","           </div>","         </div>"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"e71949fc-111e-487b-ba5d-408dc7596e9a","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_016JJzCffz6huVMWYKWMnn7K","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me run TypeScript to check for any errors:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":869,"cache_read_input_tokens":114510,"cache_creation":{"ephemeral_5m_input_tokens":869,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVZEx3EH9zpzQqQWmNP","type":"assistant","uuid":"1b6bce01-9d90-49c4-a870-16a401c1d881","timestamp":"2025-12-26T14:56:26.511Z"}
{"parentUuid":"1b6bce01-9d90-49c4-a870-16a401c1d881","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_016JJzCffz6huVMWYKWMnn7K","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JiYeiLsmSxgD1zree6tb5W","name":"Bash","input":{"command":"npx tsc --noEmit 2>&1 | head -50","description":"Type check the codebase"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":869,"cache_read_input_tokens":114510,"cache_creation":{"ephemeral_5m_input_tokens":869,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVZEx3EH9zpzQqQWmNP","type":"assistant","uuid":"caff4cbc-680c-4438-a2b6-511793639312","timestamp":"2025-12-26T14:56:27.606Z"}
{"parentUuid":"caff4cbc-680c-4438-a2b6-511793639312","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JiYeiLsmSxgD1zree6tb5W","type":"tool_result","content":"src/components/results/tabs/ReferralsTab.tsx(21,13): error TS2339: Property 'resultsAnalysis' does not exist on type 'ResultsContextType'.","is_error":false}]},"uuid":"46be48fd-68c6-4c4c-a08e-fbe76d02ae85","timestamp":"2025-12-26T14:56:28.774Z","toolUseResult":{"stdout":"src/components/results/tabs/ReferralsTab.tsx(21,13): error TS2339: Property 'resultsAnalysis' does not exist on type 'ResultsContextType'.","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"46be48fd-68c6-4c4c-a08e-fbe76d02ae85","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UimJ3VbueFxaJCCSUKirit","type":"message","role":"assistant","content":[{"type":"text","text":"There's a pre-existing error in ReferralsTab.tsx that's unrelated to my changes. Let me specifically check if my changes introduced any TypeScript errors:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":264,"cache_read_input_tokens":115379,"cache_creation":{"ephemeral_5m_input_tokens":264,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVZfVAutd7P8wTT22q4","type":"assistant","uuid":"1d300401-23ea-4aee-9f82-b36256eb7dbd","timestamp":"2025-12-26T14:56:33.634Z"}
{"parentUuid":"1d300401-23ea-4aee-9f82-b36256eb7dbd","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UimJ3VbueFxaJCCSUKirit","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015A3m8ADnu2FB2toN53ACdo","name":"Bash","input":{"command":"npx tsc --noEmit 2>&1 | grep -E \"(insights-engine|StrengthFlawCards|KeyStrengthsFlaws|WeakPointCard|scoring/types|harmony-scoring|results.ts)\" | head -30","description":"Check TypeScript errors in modified files"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":264,"cache_read_input_tokens":115379,"cache_creation":{"ephemeral_5m_input_tokens":264,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVZfVAutd7P8wTT22q4","type":"assistant","uuid":"fae97cdc-5860-4aa5-9379-1c6d0f63f331","timestamp":"2025-12-26T14:56:36.181Z"}
{"parentUuid":"fae97cdc-5860-4aa5-9379-1c6d0f63f331","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015A3m8ADnu2FB2toN53ACdo","type":"tool_result","content":"","is_error":false}]},"uuid":"56170c56-d829-498f-ae9e-0869624e0a3a","timestamp":"2025-12-26T14:56:37.329Z","toolUseResult":{"stdout":"","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"56170c56-d829-498f-ae9e-0869624e0a3a","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01J27gYFF6njHKiVStdc9SnT","type":"message","role":"assistant","content":[{"type":"text","text":"No errors in the files I modified. Let me run ESLint to check for any linting issues:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":196,"cache_read_input_tokens":115643,"cache_creation":{"ephemeral_5m_input_tokens":196,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVaJ9oPN7Ya2sFmDdUm","type":"assistant","uuid":"11964977-67cd-41b0-b1e9-b8f506d7449d","timestamp":"2025-12-26T14:56:40.699Z"}
{"parentUuid":"11964977-67cd-41b0-b1e9-b8f506d7449d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01J27gYFF6njHKiVStdc9SnT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AxjQBudf1Q1oW9tHoyNKsY","name":"Bash","input":{"command":"npm run lint 2>&1 | tail -30","description":"Lint the codebase"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":196,"cache_read_input_tokens":115643,"cache_creation":{"ephemeral_5m_input_tokens":196,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVaJ9oPN7Ya2sFmDdUm","type":"assistant","uuid":"52a27a52-eecc-4fc6-b3b7-85261d646d4d","timestamp":"2025-12-26T14:56:41.661Z"}
{"parentUuid":"52a27a52-eecc-4fc6-b3b7-85261d646d4d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AxjQBudf1Q1oW9tHoyNKsY","type":"tool_result","content":"> looksmaxx-app@0.1.0 lint\n> next lint\n\n\n./src/components/results/cards/AnalysisHistoryCard.tsx\n64:13  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/modals/UserProfileModal.tsx\n108:21  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/tabs/LeaderboardTab.tsx\n212:29  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/tabs/ReferralsTab.tsx\n4:10  Error: 'motion' is defined but never used.  @typescript-eslint/no-unused-vars\n5:43  Error: 'Facebook' is defined but never used.  @typescript-eslint/no-unused-vars\n5:53  Error: 'Twitter' is defined but never used.  @typescript-eslint/no-unused-vars\n5:62  Error: 'Mail' is defined but never used.  @typescript-eslint/no-unused-vars\n21:13  Error: 'resultsAnalysis' is assigned a value but never used.  @typescript-eslint/no-unused-vars\n\n./src/contexts/ResultsContext.tsx\n920:6  Warning: React Hook useCallback has missing dependencies: 'frontPhoto', 'sidePhoto', and 'updateStreak'. Either include them or remove the dependency array.  react-hooks/exhaustive-deps\n1123:7  Warning: React Hook useMemo has a missing dependency: 'productRecommendations'. Either include it or remove the dependency array.  react-hooks/exhaustive-deps\n\ninfo  - Need to disable some ESLint rules? Learn more here: https://nextjs.org/docs/basic-features/eslint#disabling-rules","is_error":false}]},"uuid":"8bf553c5-ece7-4676-a906-bbd2206cc6e9","timestamp":"2025-12-26T14:56:43.367Z","toolUseResult":{"stdout":"> looksmaxx-app@0.1.0 lint\n> next lint\n\n\n./src/components/results/cards/AnalysisHistoryCard.tsx\n64:13  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/modals/UserProfileModal.tsx\n108:21  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/tabs/LeaderboardTab.tsx\n212:29  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/tabs/ReferralsTab.tsx\n4:10  Error: 'motion' is defined but never used.  @typescript-eslint/no-unused-vars\n5:43  Error: 'Facebook' is defined but never used.  @typescript-eslint/no-unused-vars\n5:53  Error: 'Twitter' is defined but never used.  @typescript-eslint/no-unused-vars\n5:62  Error: 'Mail' is defined but never used.  @typescript-eslint/no-unused-vars\n21:13  Error: 'resultsAnalysis' is assigned a value but never used.  @typescript-eslint/no-unused-vars\n\n./src/contexts/ResultsContext.tsx\n920:6  Warning: React Hook useCallback has missing dependencies: 'frontPhoto', 'sidePhoto', and 'updateStreak'. Either include them or remove the dependency array.  react-hooks/exhaustive-deps\n1123:7  Warning: React Hook useMemo has a missing dependency: 'productRecommendations'. Either include it or remove the dependency array.  react-hooks/exhaustive-deps\n\ninfo  - Need to disable some ESLint rules? Learn more here: https://nextjs.org/docs/basic-features/eslint#disabling-rules","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"8bf553c5-ece7-4676-a906-bbd2206cc6e9","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01BB2QcML43tmYNgZTLbQrtX","type":"message","role":"assistant","content":[{"type":"text","text":"The linting errors are all pre-existing and not related to my changes. My implementation is complete.\n\nLet me also export the `ConfidenceBadge` and related utilities from the StrengthFlawCards file so they can be used elsewhere:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":848,"cache_read_input_tokens":115839,"cache_creation":{"ephemeral_5m_input_tokens":848,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVajrsqG77FaJcPKV8h","type":"assistant","uuid":"62193d94-04b7-4dfa-b184-c95c287d490f","timestamp":"2025-12-26T14:56:46.809Z"}
{"parentUuid":"62193d94-04b7-4dfa-b184-c95c287d490f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01BB2QcML43tmYNgZTLbQrtX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MjB1W2vvFpzYEVPyoGBHEg","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","offset":710,"limit":20}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":848,"cache_read_input_tokens":115839,"cache_creation":{"ephemeral_5m_input_tokens":848,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVajrsqG77FaJcPKV8h","type":"assistant","uuid":"7a8a9bd4-100a-426a-b29f-087fee24dbfc","timestamp":"2025-12-26T14:56:48.296Z"}
{"parentUuid":"7a8a9bd4-100a-426a-b29f-087fee24dbfc","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MjB1W2vvFpzYEVPyoGBHEg","type":"tool_result","content":"   710→        backgroundColor: config.bgColor,\n   711→        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n   712→      }}\n   713→    >\n   714→      <AlertTriangle size={12} style={{ color: config.textColor }} />\n   715→      <span className=\"text-xs\" style={{ color: config.textColor }}>{flaw.flawName}</span>\n   716→    </button>\n   717→  );\n   718→}\n   719→\n   720→// Export utility functions\n   721→export { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\n   722→export { SeverityBadge };\n   723→export type { SeverityLevel };\n   724→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"4f2c0bcd-a2ac-40d8-8144-5a34d73214ef","timestamp":"2025-12-26T14:56:48.395Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","content":"        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      <AlertTriangle size={12} style={{ color: config.textColor }} />\n      <span className=\"text-xs\" style={{ color: config.textColor }}>{flaw.flawName}</span>\n    </button>\n  );\n}\n\n// Export utility functions\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\nexport { SeverityBadge };\nexport type { SeverityLevel };\n","numLines":15,"startLine":710,"totalLines":724}}}
{"parentUuid":"4f2c0bcd-a2ac-40d8-8144-5a34d73214ef","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_013apE2sj2WQnmXbLkivgmQ4","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01EHaup5mEBnkrUZeCXZ5RQi","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","old_string":"// Export utility functions\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\nexport { SeverityBadge };\nexport type { SeverityLevel };","new_string":"// Export utility functions\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\nexport { SeverityBadge, ConfidenceBadge, CONFIDENCE_CONFIGS };\nexport type { SeverityLevel };"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":462,"cache_read_input_tokens":116687,"cache_creation":{"ephemeral_5m_input_tokens":462,"ephemeral_1h_input_tokens":0},"output_tokens":231,"service_tier":"standard"}},"requestId":"req_011CWVVb7W7zaUubSTaEF37S","type":"assistant","uuid":"aa4adec2-9725-4bec-8788-9e7655aeb259","timestamp":"2025-12-26T14:56:53.948Z"}
{"parentUuid":"aa4adec2-9725-4bec-8788-9e7655aeb259","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01EHaup5mEBnkrUZeCXZ5RQi","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   716→    </button>\n   717→  );\n   718→}\n   719→\n   720→// Export utility functions\n   721→export { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\n   722→export { SeverityBadge, ConfidenceBadge, CONFIDENCE_CONFIGS };\n   723→export type { SeverityLevel };\n   724→"}]},"uuid":"b6d2759b-499d-4efd-bf3f-fc811efd6a92","timestamp":"2025-12-26T14:56:54.013Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","oldString":"// Export utility functions\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\nexport { SeverityBadge };\nexport type { SeverityLevel };","newString":"// Export utility functions\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\nexport { SeverityBadge, ConfidenceBadge, CONFIDENCE_CONFIGS };\nexport type { SeverityLevel };","originalFile":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ChevronDown, AlertTriangle, CheckCircle, Sparkles } from 'lucide-react';\nimport { Strength, Flaw, Recommendation, getScoreColor } from '@/types/results';\nimport { ConfidenceLevel } from '@/lib/harmony-scoring';\n\n// ============================================\n// QUALITY TIER BADGES (Harmony Style) - Strengths\n// ============================================\n\ntype QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\n\ninterface QualityConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n}\n\nconst QUALITY_CONFIGS: Record<QualityTier, QualityConfig> = {\n  ideal: {\n    label: 'Ideal',\n    textColor: 'rgb(34, 211, 238)',    // cyan-400\n    bgColor: 'rgba(34, 211, 238, 0.15)', // cyan-400/15\n  },\n  excellent: {\n    label: 'Excellent',\n    textColor: 'rgb(52, 211, 153)',    // emerald-400\n    bgColor: 'rgba(52, 211, 153, 0.15)', // emerald-400/15\n  },\n  good: {\n    label: 'Good',\n    textColor: 'rgb(74, 222, 128)',    // green-400\n    bgColor: 'rgba(74, 222, 128, 0.15)', // green-400/15\n  },\n  below_average: {\n    label: 'Average',\n    textColor: 'rgb(163, 163, 163)',   // neutral-400\n    bgColor: 'rgba(163, 163, 163, 0.15)', // neutral-400/15\n  },\n};\n\nfunction QualityBadge({ quality }: { quality: QualityTier }) {\n  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// SEVERITY BADGES (Harmony Style) - Flaws\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n\ninterface SeverityConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor?: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {\n  extremely_severe: {\n    label: 'extremely severe',\n    textColor: 'rgb(248, 113, 113)',   // red-400\n    bgColor: 'rgba(248, 113, 113, 0.15)', // red-400/15\n  },\n  severe: {\n    label: 'severe',\n    textColor: 'rgb(248, 113, 113)',   // red-400\n    bgColor: 'rgba(248, 113, 113, 0.1)', // red-400/10\n    borderColor: 'rgba(248, 113, 113, 0.3)', // red-400/30\n  },\n  moderate: {\n    label: 'moderate',\n    textColor: 'rgb(251, 146, 60)',    // orange-400\n    bgColor: 'rgba(251, 146, 60, 0.1)', // orange-400/10\n    borderColor: 'rgba(251, 146, 60, 0.3)', // orange-400/30\n  },\n  minor: {\n    label: 'minor',\n    textColor: 'rgb(250, 204, 21)',    // yellow-400\n    bgColor: 'rgba(250, 204, 21, 0.1)', // yellow-400/10\n    borderColor: 'rgba(250, 204, 21, 0.3)', // yellow-400/30\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  if (harmonyLost >= 0.8) return 'extremely_severe';\n  if (harmonyLost >= 0.5) return 'severe';\n  if (harmonyLost >= 0.3) return 'moderate';\n  return 'minor';\n}\n\nfunction getSeverityFromScore(score: number): SeverityLevel {\n  if (score <= 2) return 'extremely_severe';\n  if (score <= 4) return 'severe';\n  if (score <= 6) return 'moderate';\n  return 'minor';\n}\n\nfunction SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// CONFIDENCE BADGES - Flaw Detection Certainty\n// ============================================\n\ninterface ConfidenceConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor: string;\n  icon: string;  // Unicode checkmark/question icons\n}\n\nconst CONFIDENCE_CONFIGS: Record<ConfidenceLevel, ConfidenceConfig> = {\n  confirmed: {\n    label: 'Confirmed',\n    textColor: 'rgb(74, 222, 128)',     // green-400\n    bgColor: 'rgba(74, 222, 128, 0.1)', // green-400/10\n    borderColor: 'rgba(74, 222, 128, 0.3)', // green-400/30\n    icon: '\\u2713',  // checkmark\n  },\n  likely: {\n    label: 'Likely',\n    textColor: 'rgb(96, 165, 250)',     // blue-400\n    bgColor: 'rgba(96, 165, 250, 0.1)', // blue-400/10\n    borderColor: 'rgba(96, 165, 250, 0.3)', // blue-400/30\n    icon: '\\u2248',  // approximately equal\n  },\n  possible: {\n    label: 'Possible',\n    textColor: 'rgb(163, 163, 163)',    // neutral-400\n    bgColor: 'rgba(163, 163, 163, 0.1)', // neutral-400/10\n    borderColor: 'rgba(163, 163, 163, 0.3)', // neutral-400/30\n    icon: '?',\n  },\n};\n\ninterface ConfidenceBadgeProps {\n  confidence: ConfidenceLevel;\n  showIcon?: boolean;\n}\n\nexport function ConfidenceBadge({ confidence, showIcon = true }: ConfidenceBadgeProps) {\n  const config = CONFIDENCE_CONFIGS[confidence] || CONFIDENCE_CONFIGS.possible;\n\n  return (\n    <span\n      className=\"inline-flex items-center gap-1 px-1.5 py-0.5 sm:px-2 sm:py-0.5 rounded text-[9px] sm:text-[10px] font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: `1px solid ${config.borderColor}`,\n      }}\n      title={`Detection confidence: ${config.label}`}\n    >\n      {showIcon && <span className=\"text-[8px] sm:text-[9px]\">{config.icon}</span>}\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================\n\ntype ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n\ninterface PhaseConfig {\n  textColor: string;\n  bgColor: string;\n}\n\nconst PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n  Foundational: {\n    textColor: 'rgb(52, 211, 153)',   // emerald-400\n    bgColor: 'rgba(52, 211, 153, 0.15)', // emerald-400/15\n  },\n  'Non-Invasive': {\n    textColor: 'rgb(96, 165, 250)',   // blue-400\n    bgColor: 'rgba(96, 165, 250, 0.15)', // blue-400/15\n  },\n  'Minimally Invasive': {\n    textColor: 'rgb(167, 139, 250)',  // violet-400\n    bgColor: 'rgba(167, 139, 250, 0.15)', // violet-400/15\n  },\n  Surgical: {\n    textColor: 'rgb(192, 132, 252)',  // purple-400\n    bgColor: 'rgba(192, 132, 252, 0.15)', // purple-400/15\n  },\n};\n\nfunction PhaseBadge({ phase }: { phase: ProcedurePhase }) {\n  const config = PHASE_CONFIGS[phase] || PHASE_CONFIGS['Non-Invasive'];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {phase}\n    </span>\n  );\n}\n\n// ============================================\n// CONTRIBUTING/AFFECTED RATIO ITEM\n// ============================================\n\ninterface RatioItemProps {\n  name: string;\n  score: number | string;\n  onClick?: () => void;\n  animationDelay?: number;\n}\n\nfunction RatioItem({ name, score, onClick, animationDelay = 0 }: RatioItemProps) {\n  const numericScore = typeof score === 'number' ? score : 0;\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"w-full flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-neutral-800/50 border border-neutral-700/50 transition-all duration-200 hover:border-neutral-600 hover:bg-neutral-800 text-left cursor-pointer animate-fade-in\"\n      style={{\n        animationDuration: '0.2s',\n        animationDelay: `${animationDelay}s`,\n      }}\n    >\n      <span className=\"text-xs sm:text-sm text-neutral-300 font-medium\">{name}</span>\n      <div className=\"flex items-baseline gap-0.5 sm:gap-1\">\n        <span\n          className=\"text-xs sm:text-sm font-semibold\"\n          style={{ color: typeof score === 'string' ? '#a3a3a3' : getScoreColor(numericScore) }}\n        >\n          {typeof score === 'number' ? score.toFixed(1) : score}\n        </span>\n        <span className=\"text-[10px] sm:text-xs text-neutral-500\">/10</span>\n      </div>\n    </button>\n  );\n}\n\n// ============================================\n// PLAN ITEM (Recommendation)\n// ============================================\n\ninterface PlanItemProps {\n  name: string;\n  phase: ProcedurePhase;\n  inPlan?: boolean;\n  animationDelay?: number;\n}\n\nfunction PlanItem({ name, phase, inPlan = true, animationDelay = 0 }: PlanItemProps) {\n  return (\n    <div\n      className=\"flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-neutral-800/50 border border-neutral-700/50 animate-fade-in\"\n      style={{\n        animationDuration: '0.2s',\n        animationDelay: `${animationDelay}s`,\n      }}\n    >\n      <span className=\"text-xs sm:text-sm text-neutral-300 font-medium\">{name}</span>\n      <div className=\"flex items-center gap-2\">\n        {inPlan && (\n          <span className=\"text-[9px] sm:text-[10px] px-1.5 py-0.5 rounded bg-emerald-400/15 text-emerald-400 font-medium\">\n            In Plan\n          </span>\n        )}\n        <PhaseBadge phase={phase} />\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// STRENGTH CARD (Harmony Style)\n// ============================================\n\ninterface StrengthCardProps {\n  strength: Strength;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n  animationDelay?: number;\n}\n\nexport function StrengthCard({\n  strength,\n  isExpanded = false,\n  onToggle,\n  onRatioClick,\n  animationDelay = 0,\n}: StrengthCardProps) {\n  // Get score color for the average score\n  const numericScore = typeof strength.avgScore === 'number' ? strength.avgScore : 0;\n  const scoreColor = getScoreColor(numericScore);\n\n  return (\n    <div\n      className=\"rounded-lg bg-neutral-900 border border-neutral-800/60 overflow-hidden transition-all duration-200 hover:border-neutral-700 hover:shadow-lg shadow-black/10 animate-fade-in\"\n      style={{ animationDelay: `${animationDelay}s` }}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <QualityBadge quality={strength.qualityLevel} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {strength.strengthName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n                {strength.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Score + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right\">\n              <div\n                className=\"text-lg sm:text-xl font-semibold tracking-tight transition-colors duration-200\"\n                style={{ color: scoreColor }}\n              >\n                {typeof strength.avgScore === 'number' ? strength.avgScore.toFixed(2) : strength.avgScore}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium mt-0.5\">avg /10</div>\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-500\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: 'easeInOut' }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"border-t border-neutral-800 bg-neutral-900/50 px-4 sm:px-6 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Contributing Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {strength.responsibleRatios.map((ratio, i) => (\n                  <RatioItem\n                    key={ratio.ratioId}\n                    name={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick?.(ratio)}\n                    animationDelay={i * 0.03}\n                  />\n                ))}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// FLAW CARD (Harmony Style - Areas of Improvement)\n// ============================================\n\ninterface FlawCardProps {\n  flaw: Flaw;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n  recommendations?: Recommendation[];\n  animationDelay?: number;\n}\n\nexport function FlawCard({\n  flaw,\n  isExpanded = false,\n  onToggle,\n  onRatioClick,\n  recommendations = [],\n  animationDelay = 0,\n}: FlawCardProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n\n  // Find matching recommendations for this flaw\n  const matchedRecommendations = useMemo(() => {\n    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n    return recommendations.filter(rec =>\n      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n    ).slice(0, 3); // Limit to 3 recommendations\n  }, [flaw, recommendations]);\n\n  // Map phase names\n  const mapPhase = (phase: string): ProcedurePhase => {\n    if (phase === 'Foundational') return 'Foundational';\n    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n    if (phase === 'Surgical') return 'Surgical';\n    return 'Non-Invasive';\n  };\n\n  return (\n    <div\n      className=\"rounded-lg bg-neutral-900 border border-neutral-800/60 overflow-hidden transition-all duration-200 hover:border-neutral-700 hover:shadow-lg shadow-black/10 animate-fade-in\"\n      style={{ animationDelay: `${animationDelay}s` }}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badges + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <div className=\"flex flex-col gap-1\">\n              <SeverityBadge severity={severity} />\n              {flaw.confidence && <ConfidenceBadge confidence={flaw.confidence} />}\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-400\">\n                -{flaw.harmonyPercentageLost.toFixed(2)}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n              {flaw.rollingHarmonyPercentageLost !== undefined && (\n                <div className=\"text-[10px] text-neutral-500 font-medium pt-0.5 border-t border-neutral-800 mt-1 pt-1\">\n                  Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n                </div>\n              )}\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-500\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: 'easeInOut' }}\n            className=\"overflow-hidden\"\n          >\n            {/* Affected Ratios Section */}\n            <div className=\"border-t border-neutral-800 bg-neutral-900/50 px-4 sm:px-6 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Affected Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {flaw.responsibleRatios.map((ratio, i) => (\n                  <RatioItem\n                    key={ratio.ratioId}\n                    name={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick?.(ratio)}\n                    animationDelay={i * 0.03}\n                  />\n                ))}\n              </div>\n            </div>\n\n            {/* Your Plan Section (if there are matched recommendations) */}\n            {matchedRecommendations.length > 0 && (\n              <div className=\"border-t border-neutral-800 bg-emerald-400/5 px-4 sm:px-6 py-3 sm:py-4\">\n                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n                  <Sparkles className=\"w-3 h-3 text-emerald-400\" />\n                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-400 uppercase tracking-wider\">\n                    Your Plan\n                  </span>\n                </div>\n                <div className=\"space-y-2\">\n                  {matchedRecommendations.map((rec, i) => (\n                    <PlanItem\n                      key={rec.ref_id}\n                      name={rec.name}\n                      phase={mapPhase(rec.phase)}\n                      inPlan={true}\n                      animationDelay={i * 0.03}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// STRENGTHS SECTION (Container)\n// ============================================\n\ninterface StrengthsSectionProps {\n  strengths: Strength[];\n  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n  maxVisible?: number;\n}\n\nexport function StrengthsSection({\n  strengths,\n  onRatioClick,\n  maxVisible = 5,\n}: StrengthsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const visibleStrengths = showAll ? strengths : strengths.slice(0, maxVisible);\n  const hasMore = strengths.length > maxVisible;\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/80 border border-neutral-800/50 p-4 sm:p-6 lg:p-8\">\n      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n          Key Strengths\n        </h3>\n      </div>\n\n      <div className=\"space-y-3\">\n        {visibleStrengths.map((strength, i) => (\n          <StrengthCard\n            key={strength.id}\n            strength={strength}\n            isExpanded={expandedId === strength.id}\n            onToggle={() => setExpandedId(expandedId === strength.id ? null : strength.id)}\n            onRatioClick={onRatioClick}\n            animationDelay={i * 0.04}\n          />\n        ))}\n      </div>\n\n      {hasMore && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-6 py-3 rounded-lg bg-neutral-800 border border-neutral-700/50 hover:border-neutral-600 hover:bg-neutral-700 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show All ${strengths.length} Strengths`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// FLAWS SECTION (Areas of Improvement Container)\n// ============================================\n\ninterface FlawsSectionProps {\n  flaws: Flaw[];\n  recommendations?: Recommendation[];\n  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n  maxVisible?: number;\n}\n\nexport function FlawsSection({\n  flaws,\n  recommendations = [],\n  onRatioClick,\n  maxVisible = 5,\n}: FlawsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const visibleFlaws = showAll ? flaws : flaws.slice(0, maxVisible);\n  const hasMore = flaws.length > maxVisible;\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/80 border border-neutral-800/50 p-4 sm:p-6 lg:p-8\">\n      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n          Areas of Improvement\n        </h3>\n      </div>\n\n      <div className=\"space-y-3\">\n        {visibleFlaws.map((flaw, i) => (\n          <FlawCard\n            key={flaw.id}\n            flaw={flaw}\n            isExpanded={expandedId === flaw.id}\n            onToggle={() => setExpandedId(expandedId === flaw.id ? null : flaw.id)}\n            onRatioClick={onRatioClick}\n            recommendations={recommendations}\n            animationDelay={i * 0.04}\n          />\n        ))}\n      </div>\n\n      {hasMore && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-6 py-3 rounded-lg bg-neutral-800 border border-neutral-700/50 hover:border-neutral-600 hover:bg-neutral-700 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show All ${flaws.length} Areas`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// COMPACT BADGES (for use elsewhere)\n// ============================================\n\ninterface CompactStrengthBadgeProps {\n  strength: Strength;\n  onClick?: () => void;\n}\n\nexport function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-green-400/10 border border-green-400/30 rounded-lg hover:bg-green-400/20 transition-colors\"\n    >\n      <CheckCircle size={12} className=\"text-green-400\" />\n      <span className=\"text-xs text-green-400\">{strength.strengthName}</span>\n    </button>\n  );\n}\n\ninterface CompactFlawBadgeProps {\n  flaw: Flaw;\n  onClick?: () => void;\n}\n\nexport function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-lg hover:opacity-80 transition-all\"\n      style={{\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      <AlertTriangle size={12} style={{ color: config.textColor }} />\n      <span className=\"text-xs\" style={{ color: config.textColor }}>{flaw.flawName}</span>\n    </button>\n  );\n}\n\n// Export utility functions\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\nexport { SeverityBadge };\nexport type { SeverityLevel };\n","structuredPatch":[{"oldStart":719,"oldLines":5,"newStart":719,"newLines":5,"lines":[" "," // Export utility functions"," export { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };","-export { SeverityBadge };","+export { SeverityBadge, ConfidenceBadge, CONFIDENCE_CONFIGS };"," export type { SeverityLevel };"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"b6d2759b-499d-4efd-bf3f-fc811efd6a92","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_017ByLwQ1wmbRy5kj6s1j1Sh","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me run a quick final type check to confirm everything is working:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":508,"cache_read_input_tokens":117149,"cache_creation":{"ephemeral_5m_input_tokens":508,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVbXWkLh6bFEKMEK2Gc","type":"assistant","uuid":"963cc105-9a85-4d73-96f9-18be0e6ee5f6","timestamp":"2025-12-26T14:56:58.187Z"}
{"parentUuid":"963cc105-9a85-4d73-96f9-18be0e6ee5f6","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_017ByLwQ1wmbRy5kj6s1j1Sh","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Rp6rgB5rGuPNeMv6fLhgXK","name":"Bash","input":{"command":"npx tsc --noEmit 2>&1 | head -20","description":"Final type check"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":508,"cache_read_input_tokens":117149,"cache_creation":{"ephemeral_5m_input_tokens":508,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVbXWkLh6bFEKMEK2Gc","type":"assistant","uuid":"17c290e4-ce4a-4080-bc7c-d9af1ccfc784","timestamp":"2025-12-26T14:56:59.290Z"}
{"parentUuid":"17c290e4-ce4a-4080-bc7c-d9af1ccfc784","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Rp6rgB5rGuPNeMv6fLhgXK","type":"tool_result","content":"src/components/results/cards/StrengthFlawCards.tsx(171,17): error TS2323: Cannot redeclare exported variable 'ConfidenceBadge'.\nsrc/components/results/cards/StrengthFlawCards.tsx(722,25): error TS2323: Cannot redeclare exported variable 'ConfidenceBadge'.\nsrc/components/results/cards/StrengthFlawCards.tsx(722,25): error TS2484: Export declaration conflicts with exported declaration of 'ConfidenceBadge'.\nsrc/components/results/tabs/ReferralsTab.tsx(21,13): error TS2339: Property 'resultsAnalysis' does not exist on type 'ResultsContextType'.","is_error":false}]},"uuid":"61e8ef32-541b-48f2-9533-aef831a77219","timestamp":"2025-12-26T14:57:00.997Z","toolUseResult":{"stdout":"src/components/results/cards/StrengthFlawCards.tsx(171,17): error TS2323: Cannot redeclare exported variable 'ConfidenceBadge'.\nsrc/components/results/cards/StrengthFlawCards.tsx(722,25): error TS2323: Cannot redeclare exported variable 'ConfidenceBadge'.\nsrc/components/results/cards/StrengthFlawCards.tsx(722,25): error TS2484: Export declaration conflicts with exported declaration of 'ConfidenceBadge'.\nsrc/components/results/tabs/ReferralsTab.tsx(21,13): error TS2339: Property 'resultsAnalysis' does not exist on type 'ResultsContextType'.","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"61e8ef32-541b-48f2-9533-aef831a77219","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01KptjMcsLhwRhnJnP92HWW4","type":"message","role":"assistant","content":[{"type":"text","text":"I see - the function is already exported when it's defined. Let me fix that:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":297,"cache_read_input_tokens":117657,"cache_creation":{"ephemeral_5m_input_tokens":297,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWVVc3RqKNbkbxoeH8SEp","type":"assistant","uuid":"bd179c9d-fa0a-4c00-9303-bd20c8385e43","timestamp":"2025-12-26T14:57:04.991Z"}
{"parentUuid":"bd179c9d-fa0a-4c00-9303-bd20c8385e43","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01KptjMcsLhwRhnJnP92HWW4","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018YSiTg2aNfPcV5Gq4y9g6b","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","old_string":"// Export utility functions\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\nexport { SeverityBadge, ConfidenceBadge, CONFIDENCE_CONFIGS };\nexport type { SeverityLevel };","new_string":"// Export utility functions\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS, CONFIDENCE_CONFIGS };\nexport { SeverityBadge };\nexport type { SeverityLevel };"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":297,"cache_read_input_tokens":117657,"cache_creation":{"ephemeral_5m_input_tokens":297,"ephemeral_1h_input_tokens":0},"output_tokens":256,"service_tier":"standard"}},"requestId":"req_011CWVVc3RqKNbkbxoeH8SEp","type":"assistant","uuid":"5d0dc707-e84d-491b-aaf1-26d7afcaa9b4","timestamp":"2025-12-26T14:57:07.473Z"}
{"parentUuid":"5d0dc707-e84d-491b-aaf1-26d7afcaa9b4","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018YSiTg2aNfPcV5Gq4y9g6b","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   716→    </button>\n   717→  );\n   718→}\n   719→\n   720→// Export utility functions\n   721→export { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS, CONFIDENCE_CONFIGS };\n   722→export { SeverityBadge };\n   723→export type { SeverityLevel };\n   724→"}]},"uuid":"de7700e0-2ef8-4b22-ae64-8190c4162d70","timestamp":"2025-12-26T14:57:07.537Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","oldString":"// Export utility functions\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\nexport { SeverityBadge, ConfidenceBadge, CONFIDENCE_CONFIGS };\nexport type { SeverityLevel };","newString":"// Export utility functions\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS, CONFIDENCE_CONFIGS };\nexport { SeverityBadge };\nexport type { SeverityLevel };","originalFile":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ChevronDown, AlertTriangle, CheckCircle, Sparkles } from 'lucide-react';\nimport { Strength, Flaw, Recommendation, getScoreColor } from '@/types/results';\nimport { ConfidenceLevel } from '@/lib/harmony-scoring';\n\n// ============================================\n// QUALITY TIER BADGES (Harmony Style) - Strengths\n// ============================================\n\ntype QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\n\ninterface QualityConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n}\n\nconst QUALITY_CONFIGS: Record<QualityTier, QualityConfig> = {\n  ideal: {\n    label: 'Ideal',\n    textColor: 'rgb(34, 211, 238)',    // cyan-400\n    bgColor: 'rgba(34, 211, 238, 0.15)', // cyan-400/15\n  },\n  excellent: {\n    label: 'Excellent',\n    textColor: 'rgb(52, 211, 153)',    // emerald-400\n    bgColor: 'rgba(52, 211, 153, 0.15)', // emerald-400/15\n  },\n  good: {\n    label: 'Good',\n    textColor: 'rgb(74, 222, 128)',    // green-400\n    bgColor: 'rgba(74, 222, 128, 0.15)', // green-400/15\n  },\n  below_average: {\n    label: 'Average',\n    textColor: 'rgb(163, 163, 163)',   // neutral-400\n    bgColor: 'rgba(163, 163, 163, 0.15)', // neutral-400/15\n  },\n};\n\nfunction QualityBadge({ quality }: { quality: QualityTier }) {\n  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// SEVERITY BADGES (Harmony Style) - Flaws\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n\ninterface SeverityConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor?: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {\n  extremely_severe: {\n    label: 'extremely severe',\n    textColor: 'rgb(248, 113, 113)',   // red-400\n    bgColor: 'rgba(248, 113, 113, 0.15)', // red-400/15\n  },\n  severe: {\n    label: 'severe',\n    textColor: 'rgb(248, 113, 113)',   // red-400\n    bgColor: 'rgba(248, 113, 113, 0.1)', // red-400/10\n    borderColor: 'rgba(248, 113, 113, 0.3)', // red-400/30\n  },\n  moderate: {\n    label: 'moderate',\n    textColor: 'rgb(251, 146, 60)',    // orange-400\n    bgColor: 'rgba(251, 146, 60, 0.1)', // orange-400/10\n    borderColor: 'rgba(251, 146, 60, 0.3)', // orange-400/30\n  },\n  minor: {\n    label: 'minor',\n    textColor: 'rgb(250, 204, 21)',    // yellow-400\n    bgColor: 'rgba(250, 204, 21, 0.1)', // yellow-400/10\n    borderColor: 'rgba(250, 204, 21, 0.3)', // yellow-400/30\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  if (harmonyLost >= 0.8) return 'extremely_severe';\n  if (harmonyLost >= 0.5) return 'severe';\n  if (harmonyLost >= 0.3) return 'moderate';\n  return 'minor';\n}\n\nfunction getSeverityFromScore(score: number): SeverityLevel {\n  if (score <= 2) return 'extremely_severe';\n  if (score <= 4) return 'severe';\n  if (score <= 6) return 'moderate';\n  return 'minor';\n}\n\nfunction SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// CONFIDENCE BADGES - Flaw Detection Certainty\n// ============================================\n\ninterface ConfidenceConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor: string;\n  icon: string;  // Unicode checkmark/question icons\n}\n\nconst CONFIDENCE_CONFIGS: Record<ConfidenceLevel, ConfidenceConfig> = {\n  confirmed: {\n    label: 'Confirmed',\n    textColor: 'rgb(74, 222, 128)',     // green-400\n    bgColor: 'rgba(74, 222, 128, 0.1)', // green-400/10\n    borderColor: 'rgba(74, 222, 128, 0.3)', // green-400/30\n    icon: '\\u2713',  // checkmark\n  },\n  likely: {\n    label: 'Likely',\n    textColor: 'rgb(96, 165, 250)',     // blue-400\n    bgColor: 'rgba(96, 165, 250, 0.1)', // blue-400/10\n    borderColor: 'rgba(96, 165, 250, 0.3)', // blue-400/30\n    icon: '\\u2248',  // approximately equal\n  },\n  possible: {\n    label: 'Possible',\n    textColor: 'rgb(163, 163, 163)',    // neutral-400\n    bgColor: 'rgba(163, 163, 163, 0.1)', // neutral-400/10\n    borderColor: 'rgba(163, 163, 163, 0.3)', // neutral-400/30\n    icon: '?',\n  },\n};\n\ninterface ConfidenceBadgeProps {\n  confidence: ConfidenceLevel;\n  showIcon?: boolean;\n}\n\nexport function ConfidenceBadge({ confidence, showIcon = true }: ConfidenceBadgeProps) {\n  const config = CONFIDENCE_CONFIGS[confidence] || CONFIDENCE_CONFIGS.possible;\n\n  return (\n    <span\n      className=\"inline-flex items-center gap-1 px-1.5 py-0.5 sm:px-2 sm:py-0.5 rounded text-[9px] sm:text-[10px] font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: `1px solid ${config.borderColor}`,\n      }}\n      title={`Detection confidence: ${config.label}`}\n    >\n      {showIcon && <span className=\"text-[8px] sm:text-[9px]\">{config.icon}</span>}\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================\n\ntype ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n\ninterface PhaseConfig {\n  textColor: string;\n  bgColor: string;\n}\n\nconst PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n  Foundational: {\n    textColor: 'rgb(52, 211, 153)',   // emerald-400\n    bgColor: 'rgba(52, 211, 153, 0.15)', // emerald-400/15\n  },\n  'Non-Invasive': {\n    textColor: 'rgb(96, 165, 250)',   // blue-400\n    bgColor: 'rgba(96, 165, 250, 0.15)', // blue-400/15\n  },\n  'Minimally Invasive': {\n    textColor: 'rgb(167, 139, 250)',  // violet-400\n    bgColor: 'rgba(167, 139, 250, 0.15)', // violet-400/15\n  },\n  Surgical: {\n    textColor: 'rgb(192, 132, 252)',  // purple-400\n    bgColor: 'rgba(192, 132, 252, 0.15)', // purple-400/15\n  },\n};\n\nfunction PhaseBadge({ phase }: { phase: ProcedurePhase }) {\n  const config = PHASE_CONFIGS[phase] || PHASE_CONFIGS['Non-Invasive'];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {phase}\n    </span>\n  );\n}\n\n// ============================================\n// CONTRIBUTING/AFFECTED RATIO ITEM\n// ============================================\n\ninterface RatioItemProps {\n  name: string;\n  score: number | string;\n  onClick?: () => void;\n  animationDelay?: number;\n}\n\nfunction RatioItem({ name, score, onClick, animationDelay = 0 }: RatioItemProps) {\n  const numericScore = typeof score === 'number' ? score : 0;\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"w-full flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-neutral-800/50 border border-neutral-700/50 transition-all duration-200 hover:border-neutral-600 hover:bg-neutral-800 text-left cursor-pointer animate-fade-in\"\n      style={{\n        animationDuration: '0.2s',\n        animationDelay: `${animationDelay}s`,\n      }}\n    >\n      <span className=\"text-xs sm:text-sm text-neutral-300 font-medium\">{name}</span>\n      <div className=\"flex items-baseline gap-0.5 sm:gap-1\">\n        <span\n          className=\"text-xs sm:text-sm font-semibold\"\n          style={{ color: typeof score === 'string' ? '#a3a3a3' : getScoreColor(numericScore) }}\n        >\n          {typeof score === 'number' ? score.toFixed(1) : score}\n        </span>\n        <span className=\"text-[10px] sm:text-xs text-neutral-500\">/10</span>\n      </div>\n    </button>\n  );\n}\n\n// ============================================\n// PLAN ITEM (Recommendation)\n// ============================================\n\ninterface PlanItemProps {\n  name: string;\n  phase: ProcedurePhase;\n  inPlan?: boolean;\n  animationDelay?: number;\n}\n\nfunction PlanItem({ name, phase, inPlan = true, animationDelay = 0 }: PlanItemProps) {\n  return (\n    <div\n      className=\"flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-neutral-800/50 border border-neutral-700/50 animate-fade-in\"\n      style={{\n        animationDuration: '0.2s',\n        animationDelay: `${animationDelay}s`,\n      }}\n    >\n      <span className=\"text-xs sm:text-sm text-neutral-300 font-medium\">{name}</span>\n      <div className=\"flex items-center gap-2\">\n        {inPlan && (\n          <span className=\"text-[9px] sm:text-[10px] px-1.5 py-0.5 rounded bg-emerald-400/15 text-emerald-400 font-medium\">\n            In Plan\n          </span>\n        )}\n        <PhaseBadge phase={phase} />\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// STRENGTH CARD (Harmony Style)\n// ============================================\n\ninterface StrengthCardProps {\n  strength: Strength;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n  animationDelay?: number;\n}\n\nexport function StrengthCard({\n  strength,\n  isExpanded = false,\n  onToggle,\n  onRatioClick,\n  animationDelay = 0,\n}: StrengthCardProps) {\n  // Get score color for the average score\n  const numericScore = typeof strength.avgScore === 'number' ? strength.avgScore : 0;\n  const scoreColor = getScoreColor(numericScore);\n\n  return (\n    <div\n      className=\"rounded-lg bg-neutral-900 border border-neutral-800/60 overflow-hidden transition-all duration-200 hover:border-neutral-700 hover:shadow-lg shadow-black/10 animate-fade-in\"\n      style={{ animationDelay: `${animationDelay}s` }}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <QualityBadge quality={strength.qualityLevel} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {strength.strengthName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n                {strength.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Score + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right\">\n              <div\n                className=\"text-lg sm:text-xl font-semibold tracking-tight transition-colors duration-200\"\n                style={{ color: scoreColor }}\n              >\n                {typeof strength.avgScore === 'number' ? strength.avgScore.toFixed(2) : strength.avgScore}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium mt-0.5\">avg /10</div>\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-500\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: 'easeInOut' }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"border-t border-neutral-800 bg-neutral-900/50 px-4 sm:px-6 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Contributing Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {strength.responsibleRatios.map((ratio, i) => (\n                  <RatioItem\n                    key={ratio.ratioId}\n                    name={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick?.(ratio)}\n                    animationDelay={i * 0.03}\n                  />\n                ))}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// FLAW CARD (Harmony Style - Areas of Improvement)\n// ============================================\n\ninterface FlawCardProps {\n  flaw: Flaw;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n  recommendations?: Recommendation[];\n  animationDelay?: number;\n}\n\nexport function FlawCard({\n  flaw,\n  isExpanded = false,\n  onToggle,\n  onRatioClick,\n  recommendations = [],\n  animationDelay = 0,\n}: FlawCardProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n\n  // Find matching recommendations for this flaw\n  const matchedRecommendations = useMemo(() => {\n    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n    return recommendations.filter(rec =>\n      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n    ).slice(0, 3); // Limit to 3 recommendations\n  }, [flaw, recommendations]);\n\n  // Map phase names\n  const mapPhase = (phase: string): ProcedurePhase => {\n    if (phase === 'Foundational') return 'Foundational';\n    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n    if (phase === 'Surgical') return 'Surgical';\n    return 'Non-Invasive';\n  };\n\n  return (\n    <div\n      className=\"rounded-lg bg-neutral-900 border border-neutral-800/60 overflow-hidden transition-all duration-200 hover:border-neutral-700 hover:shadow-lg shadow-black/10 animate-fade-in\"\n      style={{ animationDelay: `${animationDelay}s` }}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-6 hover:bg-neutral-800/50 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badges + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <div className=\"flex flex-col gap-1\">\n              <SeverityBadge severity={severity} />\n              {flaw.confidence && <ConfidenceBadge confidence={flaw.confidence} />}\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-400\">\n                -{flaw.harmonyPercentageLost.toFixed(2)}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n              {flaw.rollingHarmonyPercentageLost !== undefined && (\n                <div className=\"text-[10px] text-neutral-500 font-medium pt-0.5 border-t border-neutral-800 mt-1 pt-1\">\n                  Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n                </div>\n              )}\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-500\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: 'easeInOut' }}\n            className=\"overflow-hidden\"\n          >\n            {/* Affected Ratios Section */}\n            <div className=\"border-t border-neutral-800 bg-neutral-900/50 px-4 sm:px-6 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Affected Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {flaw.responsibleRatios.map((ratio, i) => (\n                  <RatioItem\n                    key={ratio.ratioId}\n                    name={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick?.(ratio)}\n                    animationDelay={i * 0.03}\n                  />\n                ))}\n              </div>\n            </div>\n\n            {/* Your Plan Section (if there are matched recommendations) */}\n            {matchedRecommendations.length > 0 && (\n              <div className=\"border-t border-neutral-800 bg-emerald-400/5 px-4 sm:px-6 py-3 sm:py-4\">\n                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n                  <Sparkles className=\"w-3 h-3 text-emerald-400\" />\n                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-400 uppercase tracking-wider\">\n                    Your Plan\n                  </span>\n                </div>\n                <div className=\"space-y-2\">\n                  {matchedRecommendations.map((rec, i) => (\n                    <PlanItem\n                      key={rec.ref_id}\n                      name={rec.name}\n                      phase={mapPhase(rec.phase)}\n                      inPlan={true}\n                      animationDelay={i * 0.03}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// STRENGTHS SECTION (Container)\n// ============================================\n\ninterface StrengthsSectionProps {\n  strengths: Strength[];\n  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n  maxVisible?: number;\n}\n\nexport function StrengthsSection({\n  strengths,\n  onRatioClick,\n  maxVisible = 5,\n}: StrengthsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const visibleStrengths = showAll ? strengths : strengths.slice(0, maxVisible);\n  const hasMore = strengths.length > maxVisible;\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/80 border border-neutral-800/50 p-4 sm:p-6 lg:p-8\">\n      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n          Key Strengths\n        </h3>\n      </div>\n\n      <div className=\"space-y-3\">\n        {visibleStrengths.map((strength, i) => (\n          <StrengthCard\n            key={strength.id}\n            strength={strength}\n            isExpanded={expandedId === strength.id}\n            onToggle={() => setExpandedId(expandedId === strength.id ? null : strength.id)}\n            onRatioClick={onRatioClick}\n            animationDelay={i * 0.04}\n          />\n        ))}\n      </div>\n\n      {hasMore && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-6 py-3 rounded-lg bg-neutral-800 border border-neutral-700/50 hover:border-neutral-600 hover:bg-neutral-700 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show All ${strengths.length} Strengths`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// FLAWS SECTION (Areas of Improvement Container)\n// ============================================\n\ninterface FlawsSectionProps {\n  flaws: Flaw[];\n  recommendations?: Recommendation[];\n  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n  maxVisible?: number;\n}\n\nexport function FlawsSection({\n  flaws,\n  recommendations = [],\n  onRatioClick,\n  maxVisible = 5,\n}: FlawsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const visibleFlaws = showAll ? flaws : flaws.slice(0, maxVisible);\n  const hasMore = flaws.length > maxVisible;\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/80 border border-neutral-800/50 p-4 sm:p-6 lg:p-8\">\n      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n          Areas of Improvement\n        </h3>\n      </div>\n\n      <div className=\"space-y-3\">\n        {visibleFlaws.map((flaw, i) => (\n          <FlawCard\n            key={flaw.id}\n            flaw={flaw}\n            isExpanded={expandedId === flaw.id}\n            onToggle={() => setExpandedId(expandedId === flaw.id ? null : flaw.id)}\n            onRatioClick={onRatioClick}\n            recommendations={recommendations}\n            animationDelay={i * 0.04}\n          />\n        ))}\n      </div>\n\n      {hasMore && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-6 py-3 rounded-lg bg-neutral-800 border border-neutral-700/50 hover:border-neutral-600 hover:bg-neutral-700 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show All ${flaws.length} Areas`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// COMPACT BADGES (for use elsewhere)\n// ============================================\n\ninterface CompactStrengthBadgeProps {\n  strength: Strength;\n  onClick?: () => void;\n}\n\nexport function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-green-400/10 border border-green-400/30 rounded-lg hover:bg-green-400/20 transition-colors\"\n    >\n      <CheckCircle size={12} className=\"text-green-400\" />\n      <span className=\"text-xs text-green-400\">{strength.strengthName}</span>\n    </button>\n  );\n}\n\ninterface CompactFlawBadgeProps {\n  flaw: Flaw;\n  onClick?: () => void;\n}\n\nexport function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-lg hover:opacity-80 transition-all\"\n      style={{\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      <AlertTriangle size={12} style={{ color: config.textColor }} />\n      <span className=\"text-xs\" style={{ color: config.textColor }}>{flaw.flawName}</span>\n    </button>\n  );\n}\n\n// Export utility functions\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\nexport { SeverityBadge, ConfidenceBadge, CONFIDENCE_CONFIGS };\nexport type { SeverityLevel };\n","structuredPatch":[{"oldStart":718,"oldLines":6,"newStart":718,"newLines":6,"lines":[" }"," "," // Export utility functions","-export { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };","-export { SeverityBadge, ConfidenceBadge, CONFIDENCE_CONFIGS };","+export { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS, CONFIDENCE_CONFIGS };","+export { SeverityBadge };"," export type { SeverityLevel };"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"de7700e0-2ef8-4b22-ae64-8190c4162d70","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_017ArYpFpdWT9bGNqyE3qQWt","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MDHW4wdepCwYoLR1acHFkk","name":"Bash","input":{"command":"npx tsc --noEmit 2>&1 | grep -v ReferralsTab | head -20","description":"Final type check excluding pre-existing errors"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":525,"cache_read_input_tokens":117954,"cache_creation":{"ephemeral_5m_input_tokens":525,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"}},"requestId":"req_011CWVVcXFA2b4SbcYbCiXeN","type":"assistant","uuid":"9763fbd5-f128-4f91-bf12-5fc5a2d10808","timestamp":"2025-12-26T14:57:13.125Z"}
{"parentUuid":"9763fbd5-f128-4f91-bf12-5fc5a2d10808","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MDHW4wdepCwYoLR1acHFkk","type":"tool_result","content":"","is_error":false}]},"uuid":"e5e37417-2cff-4bf5-b63b-eb75a00540ef","timestamp":"2025-12-26T14:57:14.664Z","toolUseResult":{"stdout":"","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"e5e37417-2cff-4bf5-b63b-eb75a00540ef","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"df8c5b13-ae4e-4858-825f-600437c50d83","version":"2.0.76","gitBranch":"main","agentId":"a4013b7","slug":"optimized-strolling-moler","message":{"model":"claude-opus-4-5-20251101","id":"msg_01WtgfZEEA5YRZ7Xg3HqQUA4","type":"message","role":"assistant","content":[{"type":"text","text":"All TypeScript errors from my changes are now resolved. The only remaining error is in `ReferralsTab.tsx` which is a pre-existing issue.\n\nLet me provide a summary of the implementation:\n\n## Summary of Implementation\n\n### 1. Added `ConfidenceLevel` type to `src/lib/scoring/types.ts`\n```typescript\nexport type ConfidenceLevel = 'confirmed' | 'likely' | 'possible';\n```\n\n### 2. Updated `Flaw` type in `src/types/results.ts`\nAdded optional `confidence` field to the `Flaw` interface.\n\n### 3. Added confidence calculation functions to `src/lib/insights-engine.ts`\n- `calculateConfidenceFromZScore(zScore: number)` - Determines confidence from Z-score magnitude\n- `calculateConfidenceFromScore(avgScore: number)` - Fallback when Z-score unavailable\n- `calculateFlawConfidence(matchedMetrics, avgScore)` - Main function that uses Z-scores when available\n\n**Confidence Level Logic:**\n| Z-Score | Confidence | Meaning |\n|---------|------------|---------|\n| >= 2 | `confirmed` | High statistical certainty (2+ standard deviations) |\n| 1-2 | `likely` | Moderate certainty (1-2 standard deviations) |\n| 0.5-1 | `possible` | Low certainty (0.5-1 standard deviation) |\n\n### 4. Updated `ClassifiedWeakness` interface\nAdded `confidence: ConfidenceLevel` field.\n\n### 5. Updated `classifyInsights()` function\nNow calculates and includes confidence when creating weakness objects.\n\n### 6. Updated `convertToFlaw()` function\nPasses through the confidence field to the UI-compatible `Flaw` type.\n\n### 7. Created `ConfidenceBadge` component in three files:\n- `src/components/results/cards/StrengthFlawCards.tsx`\n- `src/components/results/cards/KeyStrengthsFlaws.tsx`\n- `src/components/results/cards/WeakPointCard.tsx`\n\nThe badge displays:\n- **Confirmed** (green, checkmark) - High confidence\n- **Likely** (blue, approximately-equal symbol) - Moderate confidence\n- **Possible** (gray, question mark) - Low confidence\n\n### 8. Updated UI components to display confidence badges:\n- `FlawCard` in `StrengthFlawCards.tsx` - Shows confidence badge below severity badge\n- `AreaOfImprovementCard` in `KeyStrengthsFlaws.tsx` - Shows confidence badge below severity badge\n- `WeakPointCard` - Shows confidence badge next to flaw name\n\n### Key Files Modified:\n1. `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring/types.ts` - Added ConfidenceLevel type\n2. `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/harmony-scoring.ts` - Exported ConfidenceLevel\n3. `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/types/results.ts` - Added confidence to Flaw interface\n4. `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts` - Added confidence calculation functions\n5. `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx` - Added ConfidenceBadge component\n6. `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx` - Added ConfidenceBadge component\n7. `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx` - Added ConfidenceBadge component"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":127,"cache_read_input_tokens":118479,"cache_creation":{"ephemeral_5m_input_tokens":127,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVVd3jiSsT6Z2zNKqgh6","type":"assistant","uuid":"92960d4d-c9db-41cd-9e62-775efa4ba4cc","timestamp":"2025-12-26T14:57:36.282Z"}
