     1→'use client';
     2→
     3→import { useState, useMemo, forwardRef } from 'react';
     4→import { motion, AnimatePresence } from 'framer-motion';
     5→import {
     6→  ShoppingBag,
     7→  Package,
     8→  ExternalLink,
     9→  Search,
    10→  Sparkles,
    11→  Zap,
    12→  Shield,
    13→  Clock,
    14→  TrendingUp,
    15→  CheckCircle,
    16→  Scissors,
    17→  Droplet,
    18→  Pill,
    19→  Dumbbell,
    20→  Eye,
    21→  Smile,
    22→} from 'lucide-react';
    23→import { useResults } from '@/contexts/ResultsContext';
    24→import { useRegion } from '@/contexts/RegionContext';
    25→import { TabContent } from '../ResultsLayout';
    26→import { GUIDE_PRODUCTS } from '@/data/guides/products-registry';
    27→import { GuideProduct } from '@/types/guides';
    28→
    29→// ============================================
    30→// SECTION HEADER
    31→// ============================================
    32→
    33→function SectionHeader({ title, children }: { title: string; children?: React.ReactNode }) {
    34→  return (
    35→    <div className="flex items-center gap-4 mb-6">
    36→      <h2 className="text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 whitespace-nowrap">
    37→        {title}
    38→      </h2>
    39→      <div className="flex-1 h-px bg-neutral-800" />
    40→      {children}
    41→    </div>
    42→  );
    43→}
    44→
    45→// ============================================
    46→// CATEGORY DEFINITIONS
    47→// ============================================
    48→
    49→type ProductCategory = 'all' | 'supplements' | 'skincare' | 'tools' | 'grooming' | 'hygiene' | 'hair' | 'teeth';
    50→
    51→const CATEGORIES: { id: ProductCategory; label: string; icon: React.ReactNode }[] = [
    52→  { id: 'all', label: 'All Products', icon: <Package size={14} /> },
    53→  { id: 'supplements', label: 'Supplements', icon: <Pill size={14} /> },
    54→  { id: 'skincare', label: 'Skincare', icon: <Droplet size={14} /> },
    55→  { id: 'tools', label: 'Tools', icon: <Scissors size={14} /> },
    56→  { id: 'grooming', label: 'Grooming', icon: <Dumbbell size={14} /> },
    57→  { id: 'hygiene', label: 'Hygiene', icon: <Sparkles size={14} /> },
    58→  { id: 'hair', label: 'Hair', icon: <Eye size={14} /> },
    59→  { id: 'teeth', label: 'Teeth', icon: <Smile size={14} /> },
    60→];
    61→
    62→// Map guide product categories to our categories
    63→function mapCategory(cat: string): ProductCategory {
    64→  const mapping: Record<string, ProductCategory> = {
    65→    supplements: 'supplements',
    66→    skincare: 'skincare',
    67→    miscellaneous: 'tools',
    68→    grooming: 'grooming',
    69→    hygiene: 'hygiene',
    70→    hair: 'hair',
    71→    beard: 'grooming',
    72→    teeth: 'teeth',
    73→    kbeauty: 'skincare',
    74→    hormonal: 'supplements',
    75→    surgery: 'tools',
    76→  };
    77→  return mapping[cat] || 'all';
    78→}
    79→
    80→// ============================================
    81→// HERO BUNDLE CARD
    82→// ============================================
    83→
    84→interface HeroBundleProps {
    85→  title: string;
    86→  subtitle: string;
    87→  products: GuideProduct[];
    88→  savings: number;
    89→  gradient: string;
    90→  icon: React.ReactNode;
    91→}
    92→
    93→function HeroBundleCard({ title, subtitle, products, savings, gradient, icon }: HeroBundleProps) {
    94→  const { formatAmount } = useRegion();
    95→
    96→  const totalPrice = useMemo(() => {
    97→    return products.reduce((sum, p) => sum + (p.priceRange?.max || 0), 0);
    98→  }, [products]);
    99→
   100→  const bundlePrice = Math.round(totalPrice * (1 - savings / 100));
   101→
   102→  return (
   103→    <motion.div
   104→      className={`rounded-[2rem] ${gradient} border border-white/10 p-6 md:p-8 relative overflow-hidden`}
   105→      initial={{ opacity: 0, y: 20 }}
   106→      animate={{ opacity: 1, y: 0 }}
   107→    >
   108→      {/* Decorative blur */}
   109→      <div className="absolute top-0 right-0 w-64 h-64 rounded-full bg-white/10 blur-[100px] -translate-y-1/2 translate-x-1/2" />
   110→
   111→      <div className="relative z-10">
   112→        <div className="flex items-start justify-between gap-4 mb-6">
   113→          <div className="flex items-center gap-4">
   114→            <div className="w-14 h-14 rounded-2xl bg-white/20 border border-white/20 flex items-center justify-center shadow-xl">
   115→              {icon}
   116→            </div>
   117→            <div>
   118→              <h3 className="text-xl font-black uppercase tracking-wider text-white">{title}</h3>
   119→              <p className="text-sm text-white/70">{subtitle}</p>
   120→            </div>
   121→          </div>
   122→          <div className="px-3 py-1.5 bg-white/20 border border-white/20 rounded-lg">
   123→            <span className="text-sm font-black text-white">Save {savings}%</span>
   124→          </div>
   125→        </div>
   126→
   127→        {/* Products grid */}
   128→        <div className="grid grid-cols-2 md:grid-cols-4 gap-3 mb-6">
   129→          {products.slice(0, 4).map((product, idx) => (
   130→            <div
   131→              key={product.id}
   132→              className="bg-black/30 rounded-xl p-3 border border-white/10 overflow-hidden"
   133→            >
   134→              <div className="flex items-center gap-2 mb-2 min-w-0">
   135→                <div className="w-6 h-6 rounded-lg bg-white/10 flex items-center justify-center flex-shrink-0">
   136→                  <span className="text-xs font-black text-white/80">{idx + 1}</span>
   137→                </div>
   138→                <span className="text-[10px] font-bold uppercase tracking-wider text-white/60 truncate">{product.brand}</span>
   139→              </div>
   140→              <p className="text-sm font-bold text-white truncate">{product.name}</p>
   141→            </div>
   142→          ))}
   143→        </div>
   144→
   145→        {/* Pricing & CTA */}
   146→        <div className="flex items-center justify-between gap-4 pt-4 border-t border-white/10">
   147→          <div>
   148→            <p className="text-[10px] font-bold uppercase tracking-wider text-white/60 mb-1">Bundle Total</p>
   149→            <div className="flex items-baseline gap-2">
   150→              <span className="text-2xl font-black text-white">{formatAmount(bundlePrice)}</span>
   151→              <span className="text-sm font-bold text-white/50 line-through">{formatAmount(totalPrice)}</span>
   152→            </div>
   153→          </div>
   154→          <button className="px-6 py-3 bg-white text-black text-xs font-black uppercase tracking-wider rounded-xl hover:bg-white/90 transition-colors flex items-center gap-2">
   155→            <ShoppingBag size={16} />
   156→            Get Bundle
   157→          </button>
   158→        </div>
   159→      </div>
   160→    </motion.div>
   161→  );
   162→}
   163→
   164→// ============================================
   165→// PRODUCT CARD
   166→// ============================================
   167→
   168→interface ProductCardProps {
   169→  product: GuideProduct;
   170→  rank?: number;
   171→  isRecommended?: boolean;
   172→}
   173→
   174→const ProductCard = forwardRef<HTMLDivElement, ProductCardProps>(
   175→  function ProductCard({ product, rank, isRecommended }, ref) {
   176→    const { getLink, formatAmount, region } = useRegion();
   177→    const link = product.regionLinks ? getLink(product.regionLinks) : '#';
   178→
   179→    return (
   180→      <motion.div
   181→        ref={ref}
   182→        className={`rounded-2xl bg-neutral-900/40 border ${isRecommended ? 'border-cyan-500/30' : 'border-white/5'} p-5 hover:border-white/10 transition-all group`}
   183→        initial={{ opacity: 0, y: 20 }}
   184→        animate={{ opacity: 1, y: 0 }}
   185→      >
   186→      <div className="flex items-start gap-4 mb-4">
   187→        {rank && (
   188→          <div className="w-8 h-8 rounded-lg bg-neutral-900 border border-white/10 flex items-center justify-center flex-shrink-0">
   189→            <span className="text-xs font-black text-neutral-400">#{rank}</span>
   190→          </div>
   191→        )}
   192→        <div className="flex-1 min-w-0">
   193→          <div className="flex items-center gap-2 mb-1">
   194→            <span className="text-[9px] font-black uppercase tracking-wider text-neutral-500">{product.brand || 'Brand'}</span>
   195→            {isRecommended && (
   196→              <span className="px-1.5 py-0.5 bg-cyan-500/20 border border-cyan-500/30 rounded text-[8px] font-black uppercase tracking-wider text-cyan-400">
   197→                Recommended
   198→              </span>
   199→            )}
   200→            {product.isBaseStack && (
   201→              <span className="px-1.5 py-0.5 bg-green-500/20 border border-green-500/30 rounded text-[8px] font-black uppercase tracking-wider text-green-400">
   202→                Essential
   203→              </span>
   204→            )}
   205→          </div>
   206→          <h4 className="text-sm font-black uppercase tracking-wider text-white group-hover:text-cyan-400 transition-colors truncate">
   207→            {product.name}
   208→          </h4>
   209→        </div>
   210→        {product.priceRange && (
   211→          <div className="text-right flex-shrink-0">
   212→            <p className="text-sm font-black text-white">
   213→              {formatAmount(product.priceRange.min)}
   214→              {product.priceRange.max !== product.priceRange.min && (
   215→                <span className="text-neutral-500">-{formatAmount(product.priceRange.max)}</span>
   216→              )}
   217→            </p>
   218→          </div>
   219→        )}
   220→      </div>
   221→
   222→      {product.tagline && (
   223→        <p className="text-xs text-neutral-400 mb-4 leading-relaxed line-clamp-2 italic">
   224→          &ldquo;{product.tagline}&rdquo;
   225→        </p>
   226→      )}
   227→
   228→      {product.description && !product.tagline && (
   229→        <p className="text-xs text-neutral-500 mb-4 leading-relaxed line-clamp-2">
   230→          {product.description}
   231→        </p>
   232→      )}
   233→
   234→      <a
   235→        href={link}
   236→        target="_blank"
   237→        rel="noopener noreferrer"
   238→        className="flex items-center justify-center gap-2 w-full py-2.5 bg-neutral-800 hover:bg-neutral-700 border border-white/5 rounded-xl text-[10px] font-black uppercase tracking-wider text-white transition-colors"
   239→      >
   240→        <ExternalLink size={12} />
   241→        Buy on {region === 'asia' ? 'Amazon' : region.toUpperCase()}
   242→      </a>
   243→      </motion.div>
   244→    );
   245→  }
   246→);
   247→
   248→// ============================================
   249→// STATS CARD
   250→// ============================================
   251→
   252→function StatsCard({ products }: { products: GuideProduct[] }) {
   253→  const essentialCount = products.filter(p => p.isBaseStack).length;
   254→  const categories = new Set(products.map(p => p.category)).size;
   255→
   256→  return (
   257→    <div className="rounded-[2rem] bg-neutral-900/40 border border-white/5 p-6">
   258→      <div className="grid grid-cols-3 gap-4">
   259→        <div className="text-center">
   260→          <p className="text-3xl font-black text-cyan-400">{products.length}</p>
   261→          <p className="text-[10px] font-bold uppercase tracking-wider text-neutral-500">Products</p>
   262→        </div>
   263→        <div className="text-center border-x border-white/5">
   264→          <p className="text-3xl font-black text-green-400">{essentialCount}</p>
   265→          <p className="text-[10px] font-bold uppercase tracking-wider text-neutral-500">Essential</p>
   266→        </div>
   267→        <div className="text-center">
   268→          <p className="text-3xl font-black text-purple-400">{categories}</p>
   269→          <p className="text-[10px] font-bold uppercase tracking-wider text-neutral-500">Categories</p>
   270→        </div>
   271→      </div>
   272→    </div>
   273→  );
   274→}
   275→
   276→// ============================================
   277→// SHOP TAB
   278→// ============================================
   279→
   280→export function ShopTab() {
   281→  const { gender } = useResults();
   282→  const [selectedCategory, setSelectedCategory] = useState<ProductCategory>('all');
   283→  const [searchQuery, setSearchQuery] = useState('');
   284→
   285→  // Get all products
   286→  const allProducts = useMemo(() => {
   287→    // Guide products are more complete, use those
   288→    return GUIDE_PRODUCTS.sort((a, b) => {
   289→      // Base stack items first
   290→      if (a.isBaseStack && !b.isBaseStack) return -1;
   291→      if (!a.isBaseStack && b.isBaseStack) return 1;
   292→      // Then by priority
   293→      return a.priority - b.priority;
   294→    });
   295→  }, []);
   296→
   297→  // Filter products
   298→  const filteredProducts = useMemo(() => {
   299→    let products = allProducts;
   300→
   301→    if (selectedCategory !== 'all') {
   302→      products = products.filter(p => mapCategory(p.category) === selectedCategory);
   303→    }
   304→
   305→    if (searchQuery.trim()) {
   306→      const query = searchQuery.toLowerCase();
   307→      products = products.filter(p =>
   308→        p.name.toLowerCase().includes(query) ||
   309→        p.brand?.toLowerCase().includes(query) ||
   310→        p.tagline?.toLowerCase().includes(query) ||
   311→        p.description?.toLowerCase().includes(query)
   312→      );
   313→    }
   314→
   315→    return products;
   316→  }, [allProducts, selectedCategory, searchQuery]);
   317→
   318→  // Get products for hero bundles
   319→  const starterBundle = useMemo(() => {
   320→    return allProducts.filter(p => p.isBaseStack).slice(0, 4);
   321→  }, [allProducts]);
   322→
   323→  const skinBundle = useMemo(() => {
   324→    return allProducts.filter(p => p.category === 'skincare' || p.category === 'kbeauty').slice(0, 4);
   325→  }, [allProducts]);
   326→
   327→  const maleBundle = useMemo(() => {
   328→    return allProducts.filter(p =>
   329→      p.category === 'grooming' ||
   330→      p.category === 'beard' ||
   331→      p.category === 'hair'
   332→    ).slice(0, 4);
   333→  }, [allProducts]);
   334→
   335→  return (
   336→    <TabContent
   337→      title="Shop"
   338→      subtitle="Curated products to optimize your potential"
   339→    >
   340→      <div className="space-y-10">
   341→        {/* Stats */}
   342→        <StatsCard products={allProducts} />
   343→
   344→        {/* Hero Bundles */}
   345→        <section>
   346→          <SectionHeader title="Featured Bundles">
   347→            <span className="px-3 py-1.5 bg-purple-500/20 border border-purple-500/30 text-purple-400 text-[10px] font-black uppercase tracking-wider rounded-lg">
   348→              Save Up to 20%
   349→            </span>
   350→          </SectionHeader>
   351→
   352→          <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
   353→            <HeroBundleCard
   354→              title="Starter Stack"
   355→              subtitle="The essentials every looksmaxxer needs"
   356→              products={starterBundle}
   357→              savings={15}
   358→              gradient="bg-gradient-to-br from-cyan-600 to-blue-700"
   359→              icon={<Zap size={24} className="text-white" />}
   360→            />
   361→            <HeroBundleCard
   362→              title="Skin Protocol"
   363→              subtitle="Complete skincare routine for clear skin"
   364→              products={skinBundle}
   365→              savings={20}
   366→              gradient="bg-gradient-to-br from-rose-600 to-pink-700"
   367→              icon={<Droplet size={24} className="text-white" />}
   368→            />
   369→          </div>
   370→
   371→          {gender === 'male' && maleBundle.length >= 4 && (
   372→            <div className="mt-6">
   373→              <HeroBundleCard
   374→                title="Male Grooming Kit"
   375→                subtitle="Essential grooming for peak appearance"
   376→                products={maleBundle}
   377→                savings={15}
   378→                gradient="bg-gradient-to-br from-neutral-700 to-neutral-900"
   379→                icon={<Scissors size={24} className="text-white" />}
   380→              />
   381→            </div>
   382→          )}
   383→        </section>
   384→
   385→        {/* Why These Products */}
   386→        <section className="rounded-[2rem] bg-neutral-900/40 border border-white/5 p-6 md:p-8">
   387→          <h3 className="text-sm font-black uppercase tracking-wider text-white mb-6 flex items-center gap-3">
   388→            <div className="w-10 h-10 rounded-xl bg-neutral-900 border border-white/10 flex items-center justify-center">
   389→              <Shield size={18} className="text-cyan-400" />
   390→            </div>
   391→            Why We Recommend These Products
   392→          </h3>
   393→          <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
   394→            <div className="flex items-start gap-4">
   395→              <div className="w-8 h-8 rounded-lg bg-green-500/20 border border-green-500/30 flex items-center justify-center flex-shrink-0">
   396→                <CheckCircle size={14} className="text-green-400" />
   397→              </div>
   398→              <div>
   399→                <p className="text-sm font-bold text-white mb-1">Evidence-Based</p>
   400→                <p className="text-xs text-neutral-500">Every product is backed by clinical research and real results</p>
   401→              </div>
   402→            </div>
   403→            <div className="flex items-start gap-4">
   404→              <div className="w-8 h-8 rounded-lg bg-cyan-500/20 border border-cyan-500/30 flex items-center justify-center flex-shrink-0">
   405→                <TrendingUp size={14} className="text-cyan-400" />
   406→              </div>
   407→              <div>
   408→                <p className="text-sm font-bold text-white mb-1">Results-Focused</p>
   409→                <p className="text-xs text-neutral-500">Selected for maximum impact on your facial aesthetics</p>
   410→              </div>
   411→            </div>
   412→            <div className="flex items-start gap-4">
   413→              <div className="w-8 h-8 rounded-lg bg-purple-500/20 border border-purple-500/30 flex items-center justify-center flex-shrink-0">
   414→                <Clock size={14} className="text-purple-400" />
   415→              </div>
   416→              <div>
   417→                <p className="text-sm font-bold text-white mb-1">Time-Tested</p>
   418→                <p className="text-xs text-neutral-500">Community-verified products with proven track records</p>
   419→              </div>
   420→            </div>
   421→          </div>
   422→        </section>
   423→
   424→        {/* Category Filter & Search */}
   425→        <section>
   426→          <SectionHeader title="Browse All Products" />
   427→
   428→          {/* Category Pills */}
   429→          <div className="flex flex-wrap gap-2 mb-6">
   430→            {CATEGORIES.map(cat => (
   431→              <button
   432→                key={cat.id}
   433→                onClick={() => setSelectedCategory(cat.id)}
   434→                className={`px-4 py-2 rounded-xl text-[10px] font-black uppercase tracking-wider transition-all border flex items-center gap-2 ${
   435→                  selectedCategory === cat.id
   436→                    ? 'bg-cyan-500 text-black border-cyan-400'
   437→                    : 'bg-neutral-900/50 text-neutral-400 border-white/5 hover:border-white/10 hover:text-white'
   438→                }`}
   439→              >
   440→                {cat.icon}
   441→                {cat.label}
   442→              </button>
   443→            ))}
   444→          </div>
   445→
   446→          {/* Search */}
   447→          <div className="relative mb-8">
   448→            <Search size={16} className="absolute left-4 top-1/2 -translate-y-1/2 text-neutral-500" />
   449→            <input
   450→              type="text"
   451→              value={searchQuery}
   452→              onChange={(e) => setSearchQuery(e.target.value)}
   453→              placeholder="Search products..."
   454→              className="w-full pl-11 pr-4 py-3 bg-neutral-900/50 border border-white/5 rounded-xl text-sm text-white placeholder:text-neutral-600 focus:outline-none focus:border-cyan-500/30"
   455→            />
   456→          </div>
   457→
   458→          {/* Results Count */}
   459→          <div className="flex items-center justify-between mb-6">
   460→            <p className="text-[10px] font-bold uppercase tracking-wider text-neutral-500">
   461→              {filteredProducts.length} Products
   462→            </p>
   463→          </div>
   464→
   465→          {/* Products Grid */}
   466→          <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
   467→            <AnimatePresence mode="popLayout">
   468→              {filteredProducts.map((product, idx) => (
   469→                <ProductCard
   470→                  key={product.id}
   471→                  product={product}
   472→                  rank={selectedCategory === 'all' ? undefined : idx + 1}
   473→                  isRecommended={product.isBaseStack}
   474→                />
   475→              ))}
   476→            </AnimatePresence>
   477→          </div>
   478→
   479→          {filteredProducts.length === 0 && (
   480→            <div className="text-center py-16">
   481→              <div className="w-16 h-16 rounded-2xl bg-neutral-900 border border-white/10 flex items-center justify-center mx-auto mb-5">
   482→                <Search size={28} className="text-neutral-600" />
   483→              </div>
   484→              <h3 className="text-lg font-black uppercase tracking-wider text-white mb-2">No Products Found</h3>
   485→              <p className="text-[10px] font-bold uppercase tracking-wider text-neutral-600">
   486→                Try adjusting your search or category filter
   487→              </p>
   488→            </div>
   489→          )}
   490→        </section>
   491→
   492→        {/* Affiliate Disclosure */}
   493→        <section className="p-6 rounded-2xl bg-neutral-900/40 border border-white/5">
   494→          <p className="text-xs text-neutral-500 leading-relaxed">
   495→            <strong className="text-neutral-400">Affiliate Disclosure:</strong> We may earn a commission when you purchase through our links. This helps support LOOXSMAXXLABS at no extra cost to you. We only recommend products we believe in and have thoroughly researched.
   496→          </p>
   497→        </section>
   498→      </div>
   499→    </TabContent>
   500→  );
   501→}
   502→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
