     1→'use client';
     2→
     3→import { useState, useCallback } from 'react';
     4→import { useRouter } from 'next/navigation';
     5→import { motion, AnimatePresence } from 'framer-motion';
     6→import {
     7→  User,
     8→  Bell,
     9→  Eye,
    10→  Download,
    11→  Share2,
    12→  Trash2,
    13→  Lock,
    14→  Globe,
    15→  ChevronRight,
    16→  CheckCircle,
    17→  AlertTriangle,
    18→  LogOut,
    19→} from 'lucide-react';
    20→import { TabContent } from '../ResultsLayout';
    21→import { useResults } from '@/contexts/ResultsContext';
    22→import { usePricing } from '@/contexts/PricingContext';
    23→import { AchievementsShowcase } from '@/components/achievements';
    24→import { AnalysisReport } from '../reports/AnalysisReport';
    25→import { useQuota } from '@/hooks/useQuota';
    26→import { QuotaSummary } from '@/components/ui/QuotaDisplay';
    27→import { exportToPDF, exportToImage } from '@/lib/exportReport';
    28→
    29→// ============================================
    30→// SETTING ITEM
    31→// ============================================
    32→
    33→interface SettingItemProps {
    34→  icon: React.ReactNode;
    35→  title: string;
    36→  description?: string;
    37→  children?: React.ReactNode;
    38→  onClick?: () => void;
    39→}
    40→
    41→function SettingItem({ icon, title, description, children, onClick }: SettingItemProps) {
    42→  const Wrapper = onClick ? 'button' : 'div';
    43→
    44→  return (
    45→    <Wrapper
    46→      onClick={onClick}
    47→      className={`group w-full flex items-center gap-4 p-5 rounded-2xl bg-neutral-900/40 border border-white/5 ${onClick ? 'hover:border-white/10 transition-all cursor-pointer' : ''
    48→        }`}
    49→    >
    50→      <div className="w-12 h-12 rounded-xl bg-neutral-900 border border-white/10 flex items-center justify-center flex-shrink-0">
    51→        {icon}
    52→      </div>
    53→      <div className="flex-1 text-left">
    54→        <h4 className="font-black text-white">{title}</h4>
    55→        {description && (
    56→          <p className="text-[10px] font-bold uppercase tracking-wider text-neutral-600 mt-0.5">{description}</p>
    57→        )}
    58→      </div>
    59→      {children || (onClick && (
    60→        <div className="w-8 h-8 rounded-lg bg-neutral-900 border border-white/5 flex items-center justify-center group-hover:border-cyan-500/30 group-hover:bg-cyan-500/10 transition-all">
    61→          <ChevronRight size={14} className="text-neutral-600 group-hover:text-cyan-400 transition-colors" />
    62→        </div>
    63→      ))}
    64→    </Wrapper>
    65→  );
    66→}
    67→
    68→// ============================================
    69→// TOGGLE SWITCH
    70→// ============================================
    71→
    72→interface ToggleSwitchProps {
    73→  enabled: boolean;
    74→  onToggle: () => void;
    75→}
    76→
    77→function ToggleSwitch({ enabled, onToggle }: ToggleSwitchProps) {
    78→  return (
    79→    <button
    80→      onClick={onToggle}
    81→      className={`relative w-11 h-6 rounded-full transition-colors ${enabled ? 'bg-cyan-500' : 'bg-neutral-700'
    82→        }`}
    83→    >
    84→      <motion.div
    85→        className="absolute top-1 w-4 h-4 bg-white rounded-full"
    86→        animate={{ left: enabled ? 24 : 4 }}
    87→        transition={{ type: 'spring', stiffness: 500, damping: 30 }}
    88→      />
    89→    </button>
    90→  );
    91→}
    92→
    93→// ============================================
    94→// OPTIONS TAB
    95→// ============================================
    96→
    97→export function OptionsTab() {
    98→  const router = useRouter();
    99→  const {
   100→    frontRatios,
   101→    sideRatios,
   102→    overallScore,
   103→    pslRating,
   104→    showLandmarkOverlay,
   105→    setShowLandmarkOverlay,
   106→  } = useResults();
   107→  const { openPricingModal } = usePricing();
   108→  const { analyses, downloads, forumPosts, plan } = useQuota();
   109→
   110→  // Mock achievement data based on PSL score
   111→  const pslScore = pslRating?.psl || 0;
   112→  const mockAchievements = {
   113→    unlockedIds: [
   114→      'first-analysis',
   115→      ...(pslScore >= 5.0 ? ['above-average'] : []),
   116→      ...(pslScore >= 6.0 ? ['top-tier'] : []),
   117→      ...(pslScore >= 7.0 ? ['elite'] : []),
   118→      ...(pslScore >= 7.5 ? ['top-model'] : []),
   119→    ],
   120→    progress: {
   121→      'analysis-veteran': 1,
   122→      'streak-3': 1,
   123→      'streak-7': 1,
   124→      'streak-30': 1,
   125→    },
   126→    totalXp: 50 +
   127→      (pslScore >= 5.0 ? 100 : 0) +
   128→      (pslScore >= 6.0 ? 250 : 0) +
   129→      (pslScore >= 7.0 ? 500 : 0) +
   130→      (pslScore >= 7.5 ? 1000 : 0),
   131→  };
   132→  const [notifications, setNotifications] = useState(true);
   133→  const [autoSave, setAutoSave] = useState(true);
   134→  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null);
   135→  const [showDeleteConfirm, setShowDeleteConfirm] = useState(false);
   136→  const [showLogoutConfirm, setShowLogoutConfirm] = useState(false);
   137→
   138→  const showToast = useCallback((message: string, type: 'success' | 'error' = 'success') => {
   139→    setToast({ message, type });
   140→    setTimeout(() => setToast(null), 3000);
   141→  }, []);
   142→
   143→  const handleProfile = () => {
   144→    // If we have an authentication system, this would go to profile
   145→    // For now, if no profile page exists, we show a toast or redirect to login/signup
   146→    const token = localStorage.getItem('auth_token');
   147→    if (token) {
   148→      showToast('Profile settings coming soon!');
   149→    } else {
   150→      router.push('/login');
   151→    }
   152→  };
   153→
   154→  const handlePrivacy = () => {
   155→    router.push('/privacy');
   156→  };
   157→
   158→  const handleLogout = () => {
   159→    localStorage.removeItem('auth_token');
   160→    localStorage.removeItem('user');
   161→    showToast('Logged out successfully');
   162→    setShowLogoutConfirm(false);
   163→    setTimeout(() => router.push('/'), 1000);
   164→  };
   165→
   166→
   167→
   168→  // ... (inside component)
   169→
   170→  const handleExport = useCallback(async () => {
   171→    showToast('Generating PDF...', 'success');
   172→    try {
   173→      // Use existing utility which handles html2canvas + jsPDF
   174→      const result = await exportToPDF('pdf-report-container', {
   175→        filename: `LooxsmaxxLabs_Report_${new Date().toISOString().split('T')[0]}`,
   176→        scale: 2, // High quality
   177→        pageFormat: 'a4',
   178→        margins: 10
   179→      });
   180→
   181→      if (result.success) {
   182→        showToast('PDF Exported Successfully!');
   183→      } else {
   184→        showToast('Failed to generate PDF', 'error');
   185→        console.error(result.error);
   186→      }
   187→    } catch {
   188→      showToast('Failed to export', 'error');
   189→    }
   190→  }, [showToast]);
   191→
   192→  const handleShare = useCallback(async () => {
   193→    showToast('Generating shareable card...', 'success');
   194→    try {
   195→      // Just export the same report as an image for now, or we could target a specific subsection
   196→      // Ideally we'd have a specific "SocialCard" element, but the report is good too.
   197→      const result = await exportToImage('pdf-report-container', {
   198→        filename: `LooxsmaxxLabs_Card_${new Date().toISOString().split('T')[0]}`,
   199→        scale: 2
   200→      });
   201→
   202→      if (result.success) {
   203→        showToast('Image saved! Ready to share.');
   204→      } else {
   205→        showToast('Failed to generate image', 'error');
   206→      }
   207→    } catch {
   208→      showToast('Failed to share', 'error');
   209→    }
   210→  }, [showToast]);
   211→
   212→  const handleDeleteAnalysis = useCallback(() => {
   213→    // Clear localStorage
   214→    localStorage.removeItem('looksmaxx_results');
   215→    localStorage.removeItem('looksmaxx_photos');
   216→    showToast('Analysis deleted successfully');
   217→    setShowDeleteConfirm(false);
   218→    // Redirect to home after short delay
   219→    setTimeout(() => router.push('/'), 1500);
   220→  }, [router, showToast]);
   221→
   222→  return (
   223→    <TabContent
   224→      title="Options"
   225→      subtitle="Customize your experience"
   226→    >
   227→      {/* Toast notification */}
   228→      <AnimatePresence>
   229→        {toast && (
   230→          <motion.div
   231→            initial={{ opacity: 0, y: -20 }}
   232→            animate={{ opacity: 1, y: 0 }}
   233→            exit={{ opacity: 0, y: -20 }}
   234→            className={`fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg flex items-center gap-2 ${toast.type === 'success'
   235→              ? 'bg-neutral-800 border border-neutral-700'
   236→              : 'bg-red-900/80 border border-red-700'
   237→              }`}
   238→          >
   239→            {toast.type === 'success' ? (
   240→              <CheckCircle size={16} className="text-cyan-400" />
   241→            ) : (
   242→              <AlertTriangle size={16} className="text-red-400" />
   243→            )}
   244→            <span className="text-sm text-white">{toast.message}</span>
   245→          </motion.div>
   246→        )}
   247→      </AnimatePresence>
   248→
   249→      {/* Logout confirmation modal */}
   250→      <AnimatePresence>
   251→        {showLogoutConfirm && (
   252→          <motion.div
   253→            initial={{ opacity: 0 }}
   254→            animate={{ opacity: 1 }}
   255→            exit={{ opacity: 0 }}
   256→            className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"
   257→          >
   258→            <motion.div
   259→              initial={{ scale: 0.95, opacity: 0 }}
   260→              animate={{ scale: 1, opacity: 1 }}
   261→              exit={{ scale: 0.95, opacity: 0 }}
   262→              className="bg-neutral-900/90 border border-white/10 rounded-2xl p-8 max-w-sm w-full"
   263→            >
   264→              <div className="flex items-center gap-4 mb-6">
   265→                <div className="w-12 h-12 rounded-xl bg-neutral-800 border border-white/10 flex items-center justify-center">
   266→                  <LogOut size={22} className="text-white" />
   267→                </div>
   268→                <h3 className="text-xl font-black text-white">Sign Out?</h3>
   269→              </div>
   270→              <p className="text-neutral-500 text-sm mb-8">
   271→                Are you sure you want to sign out of your account?
   272→              </p>
   273→              <div className="flex gap-4">
   274→                <button
   275→                  onClick={() => setShowLogoutConfirm(false)}
   276→                  className="flex-1 px-5 py-3 bg-neutral-800 border border-white/5 text-white font-bold rounded-xl hover:bg-neutral-700 transition-colors"
   277→                >
   278→                  Cancel
   279→                </button>
   280→                <button
   281→                  onClick={handleLogout}
   282→                  className="flex-1 px-5 py-3 bg-cyan-500 text-black font-black uppercase tracking-wider rounded-xl hover:bg-cyan-400 transition-colors"
   283→                >
   284→                  Sign Out
   285→                </button>
   286→              </div>
   287→            </motion.div>
   288→          </motion.div>
   289→        )}
   290→      </AnimatePresence>
   291→
   292→      {/* Delete confirmation modal */}
   293→      <AnimatePresence>
   294→        {showDeleteConfirm && (
   295→          <motion.div
   296→            initial={{ opacity: 0 }}
   297→            animate={{ opacity: 1 }}
   298→            exit={{ opacity: 0 }}
   299→            className="fixed inset-0 z-50 flex items-center justify-center bg-black/80 backdrop-blur-sm p-4"
   300→          >
   301→            <motion.div
   302→              initial={{ scale: 0.95, opacity: 0 }}
   303→              animate={{ scale: 1, opacity: 1 }}
   304→              exit={{ scale: 0.95, opacity: 0 }}
   305→              className="bg-neutral-900/90 border border-white/10 rounded-2xl p-8 max-w-sm w-full"
   306→            >
   307→              <div className="flex items-center gap-4 mb-6">
   308→                <div className="w-12 h-12 rounded-xl bg-red-500/15 border border-red-500/20 flex items-center justify-center">
   309→                  <AlertTriangle size={22} className="text-red-400" />
   310→                </div>
   311→                <h3 className="text-xl font-black text-white">Delete Analysis?</h3>
   312→              </div>
   313→              <p className="text-neutral-500 text-sm mb-8">
   314→                This will permanently delete your analysis and all associated data. This action cannot be undone.
   315→              </p>
   316→              <div className="flex gap-4">
   317→                <button
   318→                  onClick={() => setShowDeleteConfirm(false)}
   319→                  className="flex-1 px-5 py-3 bg-neutral-800 border border-white/5 text-white font-bold rounded-xl hover:bg-neutral-700 transition-colors"
   320→                >
   321→                  Cancel
   322→                </button>
   323→                <button
   324→                  onClick={handleDeleteAnalysis}
   325→                  className="flex-1 px-5 py-3 bg-red-500 text-white font-black uppercase tracking-wider rounded-xl hover:bg-red-400 transition-colors"
   326→                >
   327→                  Delete
   328→                </button>
   329→              </div>
   330→            </motion.div>
   331→          </motion.div>
   332→        )}
   333→      </AnimatePresence>
   334→
   335→      <div className="max-w-2xl space-y-8">
   336→        {/* Achievements Section */}
   337→        <div>
   338→          <h3 className="text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-4 flex items-center gap-4">
   339→            Achievements
   340→            <div className="flex-1 h-px bg-neutral-800" />
   341→          </h3>
   342→          <AchievementsShowcase
   343→            unlockedIds={mockAchievements.unlockedIds}
   344→            progress={mockAchievements.progress}
   345→            totalXp={mockAchievements.totalXp}
   346→            compact={true}
   347→          />
   348→        </div>
   349→
   350→        {/* Usage & Quota Section */}
   351→        <div>
   352→          <h3 className="text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-4 flex items-center gap-4">
   353→            Usage & Quota
   354→            <div className="flex-1 h-px bg-neutral-800" />
   355→          </h3>
   356→          <QuotaSummary
   357→            analyses={analyses}
   358→            downloads={downloads}
   359→            forumPosts={forumPosts}
   360→            plan={plan}
   361→            onUpgrade={openPricingModal}
   362→          />
   363→        </div>
   364→
   365→        {/* Display Settings */}
   366→        <div>
   367→          <h3 className="text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-4 flex items-center gap-4">
   368→            Display
   369→            <div className="flex-1 h-px bg-neutral-800" />
   370→          </h3>
   371→          <div className="space-y-3">
   372→            <SettingItem
   373→              icon={<Eye size={20} className="text-cyan-400" />}
   374→              title="Show Landmarks"
   375→              description="Display facial landmarks on photos"
   376→            >
   377→              <ToggleSwitch enabled={showLandmarkOverlay} onToggle={() => setShowLandmarkOverlay(!showLandmarkOverlay)} />
   378→            </SettingItem>
   379→          </div>
   380→        </div>
   381→
   382→        {/* Account Settings */}
   383→        <div>
   384→          <h3 className="text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-4 flex items-center gap-4">
   385→            Account
   386→            <div className="flex-1 h-px bg-neutral-800" />
   387→          </h3>
   388→          <div className="space-y-3">
   389→            <SettingItem
   390→              icon={<User size={20} className="text-green-400" />}
   391→              title="Profile Settings"
   392→              description="Manage your account information"
   393→              onClick={handleProfile}
   394→            />
   395→
   396→            <SettingItem
   397→              icon={<Bell size={20} className="text-yellow-400" />}
   398→              title="Notifications"
   399→              description="Receive updates about your analysis"
   400→            >
   401→              <ToggleSwitch enabled={notifications} onToggle={() => setNotifications(!notifications)} />
   402→            </SettingItem>
   403→
   404→            <SettingItem
   405→              icon={<Lock size={20} className="text-red-400" />}
   406→              title="Privacy & Terms"
   407→              description="Control how your data is used"
   408→              onClick={handlePrivacy}
   409→            />
   410→
   411→            <SettingItem
   412→              icon={<LogOut size={20} className="text-neutral-400" />}
   413→              title="Sign Out"
   414→              description="Logout of your account"
   415→              onClick={() => setShowLogoutConfirm(true)}
   416→            />
   417→          </div>
   418→        </div>
   419→
   420→        {/* Data Settings */}
   421→        <div>
   422→          <h3 className="text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-4 flex items-center gap-4">
   423→            Data
   424→            <div className="flex-1 h-px bg-neutral-800" />
   425→          </h3>
   426→          <div className="space-y-3">
   427→            <SettingItem
   428→              icon={<Download size={20} className="text-cyan-400" />}
   429→              title="Export Analysis"
   430→              description="Download your results as PDF"
   431→              onClick={handleExport}
   432→            />
   433→
   434→            <SettingItem
   435→              icon={<Share2 size={20} className="text-blue-400" />}
   436→              title="Share Results"
   437→              description="Download shareable result card"
   438→              onClick={handleShare}
   439→            />
   440→
   441→            <SettingItem
   442→              icon={<Globe size={20} className="text-purple-400" />}
   443→              title="Auto-Save"
   444→              description="Automatically save analysis to cloud"
   445→            >
   446→              <ToggleSwitch enabled={autoSave} onToggle={() => setAutoSave(!autoSave)} />
   447→            </SettingItem>
   448→          </div>
   449→        </div>
   450→
   451→        {/* Danger Zone */}
   452→        <div>
   453→          <h3 className="text-[10px] font-black uppercase tracking-[0.4em] text-red-500/80 mb-4 flex items-center gap-4">
   454→            Danger Zone
   455→            <div className="flex-1 h-px bg-red-500/20" />
   456→          </h3>
   457→          <div className="space-y-3">
   458→            <div className="group w-full flex items-center gap-4 p-5 rounded-2xl bg-red-500/5 border border-red-500/20 hover:border-red-500/40 transition-all cursor-pointer"
   459→              onClick={() => setShowDeleteConfirm(true)}
   460→            >
   461→              <div className="w-12 h-12 rounded-xl bg-red-500/10 border border-red-500/20 flex items-center justify-center flex-shrink-0">
   462→                <Trash2 size={20} className="text-red-400" />
   463→              </div>
   464→              <div className="flex-1 text-left">
   465→                <h4 className="font-black text-red-400">Delete Analysis</h4>
   466→                <p className="text-[10px] font-bold uppercase tracking-wider text-red-400/60 mt-0.5">Permanently delete this analysis and all data</p>
   467→              </div>
   468→              <div className="w-8 h-8 rounded-lg bg-red-500/10 border border-red-500/20 flex items-center justify-center group-hover:bg-red-500/20 transition-all">
   469→                <ChevronRight size={14} className="text-red-400" />
   470→              </div>
   471→            </div>
   472→          </div>
   473→        </div>
   474→      </div>
   475→
   476→      {/* Hidden Report Container for Capture */}
   477→      <div style={{ position: 'fixed', left: '-9999px', top: 0 }}>
   478→        <div id="pdf-report-container">
   479→          <AnalysisReport
   480→            analysis={{
   481→              front_image_url: localStorage.getItem('looksmaxx_front_photo'),
   482→              side_image_url: localStorage.getItem('looksmaxx_side_photo'),
   483→              front_landmarks: (() => {
   484→                try {
   485→                  const results = JSON.parse(localStorage.getItem('looksmaxx_results') || '{}');
   486→                  return results?.analysis?.front_landmarks || [];
   487→                } catch { return []; }
   488→              })(),
   489→              side_landmarks: (() => {
   490→                try {
   491→                  const results = JSON.parse(localStorage.getItem('looksmaxx_results') || '{}');
   492→                  return results?.analysis?.side_landmarks || [];
   493→                } catch { return []; }
   494→              })(),
   495→              scores: { masculinity: 50, femininity: 50, symmetry: 50, skinQuality: 50, aging: 25 },
   496→            }}
   497→            results={{ overallScore, pslRating, frontRatios, sideRatios }}
   498→            userName={(() => {
   499→              try {
   500→                return JSON.parse(localStorage.getItem('user') || '{}').username || 'User';
   501→              } catch { return 'User'; }
   502→            })()}
   503→            isUnlocked={plan === 'pro' || plan === 'plus'}
   504→          />
   505→        </div>
   506→      </div>
   507→    </TabContent>
   508→  );
   509→}
   510→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
