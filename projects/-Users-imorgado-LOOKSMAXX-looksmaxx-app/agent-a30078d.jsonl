{"parentUuid":null,"isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"9ef504ee-e86a-4062-a25e-b90107ea7ce2","version":"2.0.76","gitBranch":"main","agentId":"a30078d","slug":"shiny-wondering-bentley","type":"user","message":{"role":"user","content":"Analyze the PSL specification document at /Users/imorgado/LOOKSMAXX/psl.md in detail. Focus on understanding:\n\n1. The PSL scoring formula and all its components (face, height, body, bonuses, penalties)\n2. The tier classification system (Deformity to True Mogger)\n3. The archetype classification system with all the categories and sub-archetypes\n4. The AI Vision feature extraction specifications\n5. The advice generation engine (hairstyles, skincare, style, action plans)\n6. The database schema requirements\n7. The API endpoints needed\n8. The frontend components required\n\nProvide a comprehensive summary of the logic and how all systems integrate together."},"uuid":"7124cc56-d1df-49b6-b177-ea68c3f4d2fa","timestamp":"2025-12-25T23:19:04.924Z"}
{"parentUuid":"7124cc56-d1df-49b6-b177-ea68c3f4d2fa","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"9ef504ee-e86a-4062-a25e-b90107ea7ce2","version":"2.0.76","gitBranch":"main","agentId":"a30078d","slug":"shiny-wondering-bentley","message":{"model":"claude-haiku-4-5-20251001","id":"msg_015Cgmmitu1aWJgbyGsQoM6E","type":"message","role":"assistant","content":[{"type":"text","text":"I'll analyze the PSL specification document in detail. Let me start by reading the file."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":3769,"cache_read_input_tokens":11170,"cache_creation":{"ephemeral_5m_input_tokens":3769,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWUG5h4NntvLyyFaUaZVS","type":"assistant","uuid":"a4ba49d2-125b-449d-b504-a0b8926a8f1c","timestamp":"2025-12-25T23:19:06.944Z"}
{"parentUuid":"a4ba49d2-125b-449d-b504-a0b8926a8f1c","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"9ef504ee-e86a-4062-a25e-b90107ea7ce2","version":"2.0.76","gitBranch":"main","agentId":"a30078d","slug":"shiny-wondering-bentley","message":{"model":"claude-haiku-4-5-20251001","id":"msg_015Cgmmitu1aWJgbyGsQoM6E","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CAcCy16pnrdRdW4j1ewyrc","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/psl.md"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":3769,"cache_read_input_tokens":11170,"cache_creation":{"ephemeral_5m_input_tokens":3769,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWUG5h4NntvLyyFaUaZVS","type":"assistant","uuid":"1e9b9c97-bcc3-42ee-bc73-407c949443b0","timestamp":"2025-12-25T23:19:07.177Z"}
{"parentUuid":"1e9b9c97-bcc3-42ee-bc73-407c949443b0","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"9ef504ee-e86a-4062-a25e-b90107ea7ce2","version":"2.0.76","gitBranch":"main","agentId":"a30078d","slug":"shiny-wondering-bentley","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CAcCy16pnrdRdW4j1ewyrc","type":"tool_result","content":"     1→# PSL Enhancement System - Implementation Specification\n     2→\n     3→## Overview\n     4→\n     5→This document outlines the implementation of an enhanced PSL (Pretty Scale Level) scoring system with AI-powered feature extraction, archetype classification, and personalized advice generation. The AI vision analysis is a **paid feature**.\n     6→\n     7→---\n     8→\n     9→## Table of Contents\n    10→\n    11→1. [System Architecture](#1-system-architecture)\n    12→2. [PSL Scoring Formula](#2-psl-scoring-formula)\n    13→3. [AI Vision Feature Extraction (Paid)](#3-ai-vision-feature-extraction-paid)\n    14→4. [Archetype Classification System](#4-archetype-classification-system)\n    15→5. [Advice Generation Engine](#5-advice-generation-engine)\n    16→6. [Database Schema](#6-database-schema)\n    17→7. [API Endpoints](#7-api-endpoints)\n    18→8. [Frontend Components](#8-frontend-components)\n    19→9. [Implementation Phases](#9-implementation-phases)\n    20→10. [Cost & Pricing](#10-cost--pricing)\n    21→\n    22→---\n    23→\n    24→## 1. System Architecture\n    25→\n    26→### High-Level Flow\n    27→\n    28→```\n    29→┌─────────────────────────────────────────────────────────────────────────────┐\n    30→│                           USER INPUT                                         │\n    31→├─────────────────────────────────────────────────────────────────────────────┤\n    32→│  FREE TIER                          │  PAID TIER (AI Vision)                │\n    33→│  ├── Gender                         │  ├── All FREE tier data               │\n    34→│  ├── Ethnicity                      │  ├── AI Skin Analysis                 │\n    35→│  ├── Front Photo                    │  ├── AI Hair/Hairline Analysis        │\n    36→│  ├── Side Photo                     │  ├── AI Teeth Analysis                │\n    37→│  └── Height (manual input)          │  ├── AI Hollow Cheeks Detection       │\n    38→│                                      │  ├── AI Eye Color Extraction         │\n    39→│                                      │  ├── Physique Photo (optional)        │\n    40→│                                      │  └── AI Body Composition Analysis     │\n    41→└─────────────────────────────────────────────────────────────────────────────┘\n    42→                                    │\n    43→                                    ▼\n    44→┌─────────────────────────────────────────────────────────────────────────────┐\n    45→│                         PROCESSING PIPELINE                                  │\n    46→├─────────────────────────────────────────────────────────────────────────────┤\n    47→│                                                                              │\n    48→│  STAGE 1: Landmark Analysis (Existing)                                      │\n    49→│  ├── MediaPipe 478 landmarks (client-side)                                  │\n    50→│  ├── InsightFace 106 landmarks (server-side)                                │\n    51→│  └── 70+ facial metrics computed                                            │\n    52→│                                                                              │\n    53→│  STAGE 2: AI Vision Extraction (Paid Only)                                  │\n    54→│  ├── Claude Vision API analyzes photos                                      │\n    55→│  ├── Extracts soft tissue features                                          │\n    56→│  └── Stores in vision_extractions table                                     │\n    57→│                                                                              │\n    58→│  STAGE 3: PSL Calculation                                                   │\n    59→│  ├── Face Score (from landmarks) × 0.75                                     │\n    60→│  ├── Height Score (from input) × 0.20                                       │\n    61→│  ├── Body Score (from AI vision, if available) × 0.05                       │\n    62→│  ├── Apply bonuses and constraints                                          │\n    63→│  └── Classify into tier                                                     │\n    64→│                                                                              │\n    65→│  STAGE 4: Archetype Classification                                          │\n    66→│  ├── Rule-based scoring per archetype                                       │\n    67→│  ├── AI refinement for edge cases (paid)                                    │\n    68→│  └── Sub-archetype determination                                            │\n    69→│                                                                              │\n    70→│  STAGE 5: Advice Generation                                                 │\n    71→│  ├── Hairstyle recommendations (face shape + hairline)                      │\n    72→│  ├── Skincare routine (skin analysis)                                       │\n    73→│  ├── Style guide (archetype-matched)                                        │\n    74→│  └── Prioritized action plan (flaws → fixes)                                │\n    75→│                                                                              │\n    76→└─────────────────────────────────────────────────────────────────────────────┘\n    77→                                    │\n    78→                                    ▼\n    79→┌─────────────────────────────────────────────────────────────────────────────┐\n    80→│                              OUTPUT                                          │\n    81→├─────────────────────────────────────────────────────────────────────────────┤\n    82→│  ├── Enhanced PSL Score (0-10) with tier badge                              │\n    83→│  ├── Score breakdown (Face/Height/Body/Bonuses)                             │\n    84→│  ├── Primary + Secondary Archetype                                          │\n    85→│  ├── Hairstyle Recommendations (3-5 options)                                │\n    86→│  ├── Skincare Routine (AM/PM)                                               │\n    87→│  ├── Style Guide (clothing, colors, accessories)                            │\n    88→│  └── Personalized Action Plan (prioritized by impact)                       │\n    89→└─────────────────────────────────────────────────────────────────────────────┘\n    90→```\n    91→\n    92→### Service Architecture\n    93→\n    94→```\n    95→looksmaxx-api/\n    96→├── app/\n    97→│   ├── services/\n    98→│   │   ├── psl_service.py           # PSL calculation with formula\n    99→│   │   ├── vision_service.py        # Claude Vision API integration\n   100→│   │   ├── archetype_service.py     # Archetype classification\n   101→│   │   └── advice_service.py        # Recommendation generation\n   102→│   │\n   103→│   ├── routers/\n   104→│   │   ├── psl.py                   # PSL endpoints\n   105→│   │   ├── vision.py                # AI vision endpoints\n   106→│   │   └── advice.py                # Advice endpoints\n   107→│   │\n   108→│   └── data/\n   109→│       ├── archetypes.json          # Archetype definitions\n   110→│       ├── hairstyles.json          # Hairstyle database\n   111→│       ├── skincare.json            # Skincare routines\n   112→│       └── style_guides.json        # Style recommendations\n   113→\n   114→looksmaxx-app/\n   115→├── src/\n   116→│   ├── contexts/\n   117→│   │   └── PSLContext.tsx           # Enhanced PSL state\n   118→│   │\n   119→│   ├── components/\n   120→│   │   └── psl/\n   121→│   │       ├── PSLScoreCard.tsx     # Main score display\n   122→│   │       ├── PSLBreakdown.tsx     # Component breakdown\n   123→│   │       ├── TierBadge.tsx        # Tier visualization\n   124→│   │       ├── ArchetypeCard.tsx    # Archetype display\n   125→│   │       ├── HairstyleRecs.tsx    # Hairstyle recommendations\n   126→│   │       ├── SkincareRoutine.tsx  # Skincare display\n   127→│   │       ├── StyleGuide.tsx       # Style recommendations\n   128→│   │       └── ActionPlan.tsx       # Prioritized improvements\n   129→│   │\n   130→│   └── lib/\n   131→│       ├── psl-calculator.ts        # Client-side PSL logic\n   132→│       └── archetype-classifier.ts  # Client-side classification\n   133→```\n   134→\n   135→---\n   136→\n   137→## 2. PSL Scoring Formula\n   138→\n   139→### 2.1 Base Formula\n   140→\n   141→```\n   142→PSL_Score = (Face × 0.75) + (Height × 0.20) + (Body × 0.05) + Bonuses\n   143→```\n   144→\n   145→Where:\n   146→- **Face** = Harmony score from landmark analysis (0-10)\n   147→- **Height** = Height rating from lookup table (0-10)\n   148→- **Body** = Body composition score from AI vision (0-10), defaults to 5.0 if not available\n   149→- **Bonuses** = Threshold and synergy bonuses (0-0.85 max)\n   150→\n   151→### 2.2 Height Rating Table\n   152→\n   153→| Height (Male) | Rating | Height (Female) | Rating |\n   154→|---------------|--------|-----------------|--------|\n   155→| < 5'3\" (160cm) | 1.0 | < 4'11\" (150cm) | 1.0 |\n   156→| 5'3\" (160cm) | 2.0 | 4'11\" (150cm) | 2.0 |\n   157→| 5'5\" (165cm) | 3.0 | 5'1\" (155cm) | 3.5 |\n   158→| 5'7\" (170cm) | 4.0 | 5'3\" (160cm) | 5.0 |\n   159→| 5'9\" (175cm) | 5.0 | 5'5\" (165cm) | 6.0 |\n   160→| 5'10\" (178cm) | 5.5 | 5'6\" (168cm) | 6.5 |\n   161→| 5'11\" (180cm) | 6.0 | 5'7\" (170cm) | 7.0 |\n   162→| 6'0\" (183cm) | 7.0 | 5'8\" (173cm) | 7.5 |\n   163→| 6'1\" (185cm) | 7.5 | 5'9\" (175cm) | 8.0 |\n   164→| 6'2\" (188cm) | 8.0 | 5'10\" (178cm) | 8.5 |\n   165→| 6'3\" (190cm) | 8.5 | 5'11\" (180cm) | 9.0 |\n   166→| 6'4\" (193cm) | 9.0 | 6'0\"+ (183cm+) | 9.0 (cap) |\n   167→| 6'5\"+ (196cm+) | 9.5 (diminishing) | - | - |\n   168→\n   169→### 2.3 Body Rating Scale\n   170→\n   171→| Body Fat % | Muscle Level | Rating | Description |\n   172→|------------|--------------|--------|-------------|\n   173→| 25%+ | Low | 2.0-3.0 | Overweight, no definition |\n   174→| 20-25% | Low | 3.5-4.5 | Soft, minimal definition |\n   175→| 18-22% | Medium | 5.0-5.5 | Average, some definition |\n   176→| 15-18% | Medium | 6.0-6.5 | Lean, visible abs starting |\n   177→| 12-15% | Medium-High | 7.0-7.5 | Athletic, clear definition |\n   178→| 10-12% | High | 8.0-8.5 | Shredded, competition lean |\n   179→| 8-10% | Very High | 9.0-9.5 | Elite physique |\n   180→| < 8% | Extreme | 9.5+ | IFBB Pro tier |\n   181→\n   182→### 2.4 Bonus System\n   183→\n   184→#### Threshold Bonuses (when category ≥ 8.5)\n   185→| Category | Bonus |\n   186→|----------|-------|\n   187→| Face ≥ 8.5 | +0.30 |\n   188→| Height ≥ 8.5 | +0.20 |\n   189→| Body ≥ 8.5 | +0.10 |\n   190→\n   191→#### Synergy Bonuses (when multiple categories ≥ 8.5)\n   192→| Combination | Additional Bonus |\n   193→|-------------|------------------|\n   194→| Face + Height ≥ 8.5 | +0.15 |\n   195→| Face + Body ≥ 8.5 | +0.10 |\n   196→| Height + Body ≥ 8.5 | +0.05 |\n   197→\n   198→#### Triple Synergy (all three ≥ 8.5)\n   199→- **+0.35** flat bonus (replaces pair bonuses, stacks with threshold bonuses)\n   200→\n   201→### 2.5 Constraints (Failos)\n   202→\n   203→| Constraint | Effect |\n   204→|------------|--------|\n   205→| Major facial failo present | Caps tier regardless of score |\n   206→| Body < 5.0 | -0.3 to face perception |\n   207→| Height < 8.0 rating | Cannot reach Gigachad tier |\n   208→| Severe asymmetry | -0.5 penalty |\n   209→\n   210→### 2.6 Tier Classification\n   211→\n   212→| Tier | Score Range | Percentile | Description |\n   213→|------|-------------|------------|-------------|\n   214→| Deformity | 0.0 - 1.0 | Bottom 0.01% | Medical intervention territory |\n   215→| Subhuman | 1.25 - 1.75 | Bottom 0.1% | Genetic outlier |\n   216→| Incel | 2.0 - 3.0 | Bottom 2.5% | Visibly below average |\n   217→| LTN (Low Tier Normie) | 3.5 - 4.5 | Bottom 13.59% | Somewhat unattractive |\n   218→| MTN (Mid Tier Normie) | 4.75 - 5.25 | Middle 68% | True average |\n   219→| HTN (High Tier Normie) | 5.5 - 6.5 | Top 13.59% | Somewhat attractive |\n   220→| Chadlite | 7.0 - 8.0 | Top 2.5% | Attractive, local star |\n   221→| Chad | 8.25 - 8.75 | Top 0.1% | Very attractive, elite |\n   222→| Gigachad | 9.0 - 9.5 | Top 0.01% | Mythical tier |\n   223→| True Mogger | 9.5+ | Apex | Theoretical limit |\n   224→\n   225→### 2.7 Implementation\n   226→\n   227→```typescript\n   228→// psl-calculator.ts\n   229→\n   230→interface PSLInput {\n   231→  faceScore: number;        // 0-10 from harmony analysis\n   232→  heightCm: number;         // User input\n   233→  gender: 'male' | 'female';\n   234→  bodyAnalysis?: {          // From AI vision (paid)\n   235→    bodyFatPercent: number;\n   236→    muscleLevel: 'low' | 'medium' | 'medium-high' | 'high' | 'very-high' | 'extreme';\n   237→  };\n   238→  failos?: string[];        // Detected major failos\n   239→}\n   240→\n   241→interface PSLResult {\n   242→  score: number;            // Final PSL 0-10\n   243→  tier: string;             // Tier name\n   244→  percentile: number;       // Population percentile\n   245→  breakdown: {\n   246→    face: { raw: number; weighted: number };\n   247→    height: { raw: number; weighted: number };\n   248→    body: { raw: number; weighted: number };\n   249→    bonuses: { threshold: number; synergy: number; total: number };\n   250→    penalties: number;\n   251→  };\n   252→  potential: number;        // Estimated max with improvements\n   253→}\n   254→\n   255→function calculatePSL(input: PSLInput): PSLResult {\n   256→  // 1. Get height rating\n   257→  const heightRating = getHeightRating(input.heightCm, input.gender);\n   258→\n   259→  // 2. Get body rating (default 5.0 if not available)\n   260→  const bodyRating = input.bodyAnalysis\n   261→    ? getBodyRating(input.bodyAnalysis.bodyFatPercent, input.bodyAnalysis.muscleLevel)\n   262→    : 5.0;\n   263→\n   264→  // 3. Calculate base score\n   265→  const faceWeighted = input.faceScore * 0.75;\n   266→  const heightWeighted = heightRating * 0.20;\n   267→  const bodyWeighted = bodyRating * 0.05;\n   268→  let baseScore = faceWeighted + heightWeighted + bodyWeighted;\n   269→\n   270→  // 4. Calculate bonuses\n   271→  let thresholdBonus = 0;\n   272→  let synergyBonus = 0;\n   273→\n   274→  if (input.faceScore >= 8.5) thresholdBonus += 0.30;\n   275→  if (heightRating >= 8.5) thresholdBonus += 0.20;\n   276→  if (bodyRating >= 8.5) thresholdBonus += 0.10;\n   277→\n   278→  const highCount = [input.faceScore, heightRating, bodyRating].filter(s => s >= 8.5).length;\n   279→\n   280→  if (highCount === 3) {\n   281→    synergyBonus = 0.35; // Triple synergy replaces pairs\n   282→  } else if (highCount === 2) {\n   283→    if (input.faceScore >= 8.5 && heightRating >= 8.5) synergyBonus += 0.15;\n   284→    if (input.faceScore >= 8.5 && bodyRating >= 8.5) synergyBonus += 0.10;\n   285→    if (heightRating >= 8.5 && bodyRating >= 8.5) synergyBonus += 0.05;\n   286→  }\n   287→\n   288→  // 5. Apply penalties\n   289→  let penalties = 0;\n   290→  if (bodyRating < 5.0) penalties += 0.3;\n   291→  if (input.failos?.includes('severe_asymmetry')) penalties += 0.5;\n   292→\n   293→  // 6. Final score\n   294→  const finalScore = Math.min(10, Math.max(0, baseScore + thresholdBonus + synergyBonus - penalties));\n   295→\n   296→  // 7. Classify tier (with constraints)\n   297→  const tier = classifyTier(finalScore, heightRating, input.failos);\n   298→\n   299→  return {\n   300→    score: Math.round(finalScore * 100) / 100,\n   301→    tier: tier.name,\n   302→    percentile: tier.percentile,\n   303→    breakdown: {\n   304→      face: { raw: input.faceScore, weighted: faceWeighted },\n   305→      height: { raw: heightRating, weighted: heightWeighted },\n   306→      body: { raw: bodyRating, weighted: bodyWeighted },\n   307→      bonuses: { threshold: thresholdBonus, synergy: synergyBonus, total: thresholdBonus + synergyBonus },\n   308→      penalties,\n   309→    },\n   310→    potential: estimatePotential(input),\n   311→  };\n   312→}\n   313→```\n   314→\n   315→---\n   316→\n   317→## 3. AI Vision Feature Extraction (Paid)\n   318→\n   319→### 3.1 Features Extracted\n   320→\n   321→#### From Face Photos\n   322→\n   323→| Feature | Scale | Description | Used For |\n   324→|---------|-------|-------------|----------|\n   325→| **Skin Clarity** | 0-10 | Overall skin quality | Skincare recommendations |\n   326→| **Skin Tone** | Category | pale/fair/medium/olive/tan/dark | Style color matching |\n   327→| **Acne Level** | none/mild/moderate/severe | Current breakout status | Skincare priority |\n   328→| **Acne Scarring** | none/mild/moderate/severe | Historical scarring | Treatment recommendations |\n   329→| **Pore Visibility** | minimal/visible/prominent | Pore size assessment | Skincare routine |\n   330→| **Texture Issues** | list | Roughness, bumps, etc. | Targeted treatments |\n   331→| **Hairline NW** | 0-7 | Norwood scale classification | Hairstyle recommendations |\n   332→| **Hair Density** | thin/medium/thick | Hair thickness | Hairstyle options |\n   333→| **Hair Texture** | straight/wavy/curly/coily | Natural texture | Styling recommendations |\n   334→| **Hair Color** | Category | Natural color classification | Style matching |\n   335→| **Eye Color** | Category | Iris color | Style color matching |\n   336→| **Under-eye Darkness** | 0-10 | Dark circle severity | Skincare/concealer advice |\n   337→| **Under-eye Puffiness** | 0-10 | Bag severity | Lifestyle recommendations |\n   338→| **Hollow Cheeks** | 0-10 | Buccal fat assessment | Leanness indicator |\n   339→| **Teeth Color** | white/off-white/yellow/stained | Tooth shade | Whitening recommendations |\n   340→| **Teeth Alignment** | aligned/minor-issues/crooked | Orthodontic status | Treatment options |\n   341→| **Eyebrow Density** | sparse/medium/thick | Brow fullness | Grooming advice |\n   342→| **Facial Hair Potential** | low/medium/high | Beard growth capability | Style recommendations |\n   343→\n   344→#### From Physique Photo (Optional)\n   345→\n   346→| Feature | Scale | Description | Used For |\n   347→|---------|-------|-------------|----------|\n   348→| **Body Fat %** | 5-40% | Estimated body fat | Body score calculation |\n   349→| **Muscle Mass** | low/medium/medium-high/high/very-high | Muscularity | Body score, archetype |\n   350→| **Frame Size** | small/medium/large/very-large | Skeletal frame | Archetype classification |\n   351→| **Shoulder Width** | narrow/average/broad/very-broad | Shoulder assessment | Style recommendations |\n   352→| **Waist Definition** | undefined/slight/defined/very-defined | V-taper indicator | Physique score |\n   353→| **Posture** | poor/fair/good/excellent | Standing posture | Improvement advice |\n   354→\n   355→### 3.2 Claude Vision Implementation\n   356→\n   357→```python\n   358→# vision_service.py\n   359→\n   360→import anthropic\n   361→from typing import Optional\n   362→import base64\n   363→\n   364→class VisionService:\n   365→    def __init__(self):\n   366→        self.client = anthropic.Anthropic()\n   367→        self.model = \"claude-sonnet-4-20250514\"\n   368→\n   369→    async def extract_features(\n   370→        self,\n   371→        front_photo_url: str,\n   372→        side_photo_url: Optional[str] = None,\n   373→        physique_photo_url: Optional[str] = None\n   374→    ) -> VisionExtractionResult:\n   375→\n   376→        # Prepare images\n   377→        images = [{\"type\": \"image\", \"source\": {\"type\": \"url\", \"url\": front_photo_url}}]\n   378→        if side_photo_url:\n   379→            images.append({\"type\": \"image\", \"source\": {\"type\": \"url\", \"url\": side_photo_url}})\n   380→\n   381→        # Face analysis prompt\n   382→        face_prompt = \"\"\"Analyze this face photo and extract the following features.\n   383→        Return a JSON object with these exact keys:\n   384→\n   385→        {\n   386→          \"skin\": {\n   387→            \"clarity\": <0-10 score>,\n   388→            \"tone\": \"<pale|fair|medium|olive|tan|dark>\",\n   389→            \"acne_level\": \"<none|mild|moderate|severe>\",\n   390→            \"acne_scarring\": \"<none|mild|moderate|severe>\",\n   391→            \"pore_visibility\": \"<minimal|visible|prominent>\",\n   392→            \"texture_issues\": [\"<list of issues>\"]\n   393→          },\n   394→          \"hair\": {\n   395→            \"hairline_nw\": <0-7 Norwood scale>,\n   396→            \"density\": \"<thin|medium|thick>\",\n   397→            \"texture\": \"<straight|wavy|curly|coily>\",\n   398→            \"color\": \"<blonde|light-brown|brown|dark-brown|black|red|gray>\"\n   399→          },\n   400→          \"eyes\": {\n   401→            \"color\": \"<blue|green|hazel|brown|dark-brown|black>\",\n   402→            \"under_eye_darkness\": <0-10>,\n   403→            \"under_eye_puffiness\": <0-10>\n   404→          },\n   405→          \"facial_features\": {\n   406→            \"hollow_cheeks\": <0-10>,\n   407→            \"eyebrow_density\": \"<sparse|medium|thick>\",\n   408→            \"facial_hair_potential\": \"<low|medium|high>\"\n   409→          },\n   410→          \"teeth\": {\n   411→            \"color\": \"<white|off-white|yellow|stained>\",\n   412→            \"alignment\": \"<aligned|minor-issues|crooked>\",\n   413→            \"visible_in_photo\": <boolean>\n   414→          }\n   415→        }\n   416→\n   417→        Be objective and accurate. If a feature cannot be determined from the photo, use null.\n   418→        \"\"\"\n   419→\n   420→        response = await self.client.messages.create(\n   421→            model=self.model,\n   422→            max_tokens=1024,\n   423→            messages=[{\n   424→                \"role\": \"user\",\n   425→                \"content\": [*images, {\"type\": \"text\", \"text\": face_prompt}]\n   426→            }]\n   427→        )\n   428→\n   429→        face_features = parse_json_response(response.content[0].text)\n   430→\n   431→        # Body analysis if physique photo provided\n   432→        body_features = None\n   433→        if physique_photo_url:\n   434→            body_features = await self._analyze_physique(physique_photo_url)\n   435→\n   436→        return VisionExtractionResult(\n   437→            face=face_features,\n   438→            body=body_features\n   439→        )\n   440→\n   441→    async def _analyze_physique(self, photo_url: str) -> BodyAnalysis:\n   442→        body_prompt = \"\"\"Analyze this physique photo and extract:\n   443→\n   444→        {\n   445→          \"body_fat_percent\": <estimated 5-40%>,\n   446→          \"muscle_mass\": \"<low|medium|medium-high|high|very-high>\",\n   447→          \"frame_size\": \"<small|medium|large|very-large>\",\n   448→          \"shoulder_width\": \"<narrow|average|broad|very-broad>\",\n   449→          \"waist_definition\": \"<undefined|slight|defined|very-defined>\",\n   450→          \"posture\": \"<poor|fair|good|excellent>\",\n   451→          \"estimated_height_category\": \"<short|average|tall|very-tall>\"\n   452→        }\n   453→\n   454→        Be objective. Base body fat estimate on visible definition and vascularity.\n   455→        \"\"\"\n   456→\n   457→        response = await self.client.messages.create(\n   458→            model=self.model,\n   459→            max_tokens=512,\n   460→            messages=[{\n   461→                \"role\": \"user\",\n   462→                \"content\": [\n   463→                    {\"type\": \"image\", \"source\": {\"type\": \"url\", \"url\": photo_url}},\n   464→                    {\"type\": \"text\", \"text\": body_prompt}\n   465→                ]\n   466→            }]\n   467→        )\n   468→\n   469→        return parse_json_response(response.content[0].text)\n   470→```\n   471→\n   472→### 3.3 Caching Strategy\n   473→\n   474→- Vision extractions are cached per analysis ID\n   475→- Cache invalidated if photos are updated\n   476→- Results stored in `vision_extractions` table\n   477→- TTL: Permanent (until analysis deleted)\n   478→\n   479→---\n   480→\n   481→## 4. Archetype Classification System\n   482→\n   483→### 4.1 Archetype Taxonomy\n   484→\n   485→```\n   486→ARCHETYPES\n   487→├── SOFTBOY (Low Dimorphism, Ectomorphic)\n   488→│   ├── K-Pop Idol\n   489→│   │   ├── Traits: East/SE Asian, flat midface, clear skin, styled hair\n   490→│   │   ├── Style: Slim tailored, high contrast colors, layered hair\n   491→│   │   └── Examples: BTS members, K-drama actors\n   492→│   │\n   493→│   ├── Softboy\n   494→│   │   ├── Traits: Youthful, delicate features, slim build\n   495→│   │   ├── Style: Oversized fits, light colors, long hair\n   496→│   │   └── Examples: Timothée Chalamet, young Leonardo DiCaprio\n   497→│   │\n   498→│   └── Academic\n   499→│       ├── Traits: Intellectual look, refined, understated\n   500→│       ├── Style: Preppy, glasses, earth tones\n   501→│       └── Examples: Young Hugh Grant\n   502→│\n   503→├── PRETTYBOY (Balanced Dimorphism, Good Harmony)\n   504→│   ├── Skater\n   505→│   │   ├── Traits: Casual cool, athletic lean, relaxed\n   506→│   │   ├── Style: Streetwear, baggy pants, sneakers\n   507→│   │   └── Examples: Young Heath Ledger\n   508→│   │\n   509→│   ├── Prettyboy\n   510→│   │   ├── Traits: Symmetrical, harmonious, classic beauty\n   511→│   │   ├── Style: Clean, fitted, minimal\n   512→│   │   └── Examples: Francisco Lachowski, Sean O'Pry\n   513→│   │\n   514→│   └── Surfer\n   515→│       ├── Traits: Sun-kissed, athletic, carefree\n   516→│       ├── Style: Beach casual, natural fabrics\n   517→│       └── Examples: Young Chris Hemsworth\n   518→│\n   519→├── ROBUST PRETTYBOY (Pretty + Edge/Intensity)\n   520→│   ├── Fallen Angel\n   521→│   │   ├── Traits: Ethereal, intense, mysterious\n   522→│   │   ├── Style: Dark romantic, leather, black\n   523→│   │   └── Examples: Young Jared Leto, Jordan Barrett\n   524→│   │\n   525→│   ├── Prince\n   526→│   │   ├── Traits: Regal, refined, elegant\n   527→│   │   ├── Style: Tailored suits, classic elegance\n   528→│   │   └── Examples: Young Alain Delon, Matt Bomer\n   529→│   │\n   530→│   ├── Bad Boy\n   531→│   │   ├── Traits: Rebellious, smoldering, dangerous appeal\n   532→│   │   ├── Style: Leather jackets, boots, rough edges\n   533→│   │   └── Examples: James Dean, Young Johnny Depp\n   534→│   │\n   535→│   └── Artist\n   536→│       ├── Traits: Creative, unconventional, magnetic\n   537→│       ├── Style: Eclectic, statement pieces\n   538→│       └── Examples: Harry Styles, Zayn Malik\n   539→│\n   540→├── CHAD (High Dimorphism, Strong Features)\n   541→│   ├── Vampire\n   542→│   │   ├── Traits: Sharp features, pale, mysterious, hollow cheeks\n   543→│   │   ├── Style: Dark, sophisticated, elegant\n   544→│   │   └── Examples: Robert Pattinson, Ian Somerhalder\n   545→│   │\n   546→│   ├── Superman\n   547→│   │   ├── Traits: Heroic, strong jaw, broad build, classic handsome\n   548→│   │   ├── Style: Classic American, clean-cut\n   549→│   │   └── Examples: Henry Cavill, David Gandy\n   550→│   │\n   551→│   ├── Jock\n   552→│   │   ├── Traits: Athletic, confident, dominant presence\n   553→│   │   ├── Style: Athletic wear, casual sporty\n   554→│   │   └── Examples: Chris Evans, Michael B. Jordan\n   555→│   │\n   556→│   ├── Casanova\n   557→│   │   ├── Traits: Charming, seductive, smooth\n   558→│   │   ├── Style: Tailored, sophisticated, European\n   559→│   │   └── Examples: George Clooney, Pierce Brosnan\n   560→│   │\n   561→│   ├── Executive\n   562→│   │   ├── Traits: Powerful, authoritative, successful look\n   563→│   │   ├── Style: Power suits, luxury watches\n   564→│   │   └── Examples: Jon Hamm, Gabriel Macht\n   565→│   │\n   566→│   └── Pharaoh\n   567→│       ├── Traits: Exotic, regal, chiseled, Middle Eastern features\n   568→│       ├── Style: Luxurious, gold accents, designer\n   569→│       └── Examples: Fares Fares, Egyptian models\n   570→│\n   571→├── HYPERMASCULINE (Extreme Masculine Features)\n   572→│   ├── Aquaman\n   573→│   │   ├── Traits: Tall, muscular, long hair, rugged handsome\n   574→│   │   ├── Style: Relaxed, bohemian, natural fabrics\n   575→│   │   └── Examples: Jason Momoa, Thor-era Chris Hemsworth\n   576→│   │\n   577→│   ├── Hypermasculine\n   578→│   │   ├── Traits: Extreme bone structure, heavy brow, dominant\n   579→│   │   ├── Style: Minimalist, masculine basics\n   580→│   │   └── Examples: Dolph Lundgren (prime), Michael Fassbender\n   581→│   │\n   582→│   ├── Outlaw\n   583→│   │   ├── Traits: Rough, weathered, dangerous\n   584→│   │   ├── Style: Leather, denim, boots, rugged\n   585→│   │   └── Examples: Young Clint Eastwood, Josh Brolin\n   586→│   │\n   587→│   └── Countryman\n   588→│       ├── Traits: Rugged, outdoorsy, strong silent\n   589→│       ├── Style: Workwear, flannel, boots\n   590→│       └── Examples: Yellowstone cast, Young Sam Elliott\n   591→│\n   592→└── OGRE (Maximum Size/Mass)\n   593→    ├── Viking\n   594→    │   ├── Traits: Massive, bearded, warrior look, Norse features\n   595→    │   ├── Style: Rugged, fur, leather, minimalist\n   596→    │   └── Examples: Hafþór Björnsson, Alexander Skarsgård (Northman)\n   597→    │\n   598→    └── Bodybuilder\n   599→        ├── Traits: Extreme muscle, massive frame, imposing\n   600→        ├── Style: Fitted to show physique, tank tops\n   601→        └── Examples: Arnold Schwarzenegger (prime), Dwayne Johnson\n   602→```\n   603→\n   604→### 4.2 Classification Criteria\n   605→\n   606→#### Input Features for Classification\n   607→\n   608→| Feature | Source | Weight |\n   609→|---------|--------|--------|\n   610→| Gonial Angle | Landmarks | High |\n   611→| Facial Width/Height Ratio | Landmarks | High |\n   612→| Brow Ridge Prominence | Landmarks + Vision | Medium |\n   613→| Cheekbone Height | Landmarks | Medium |\n   614→| Eye Area Score | Landmarks | Medium |\n   615→| Dimorphism Level | Computed | High |\n   616→| Body Type | Vision (physique) | Medium |\n   617→| Frame Size | Vision | Medium |\n   618→| Ethnicity | User input | Medium |\n   619→| Hollow Cheeks | Vision | Low |\n   620→| Skin Tone | Vision | Low |\n   621→\n   622→#### Dimorphism Classification\n   623→\n   624→| Level | Gonial Angle | Brow Ridge | Jaw Definition | Features |\n   625→|-------|--------------|------------|----------------|----------|\n   626→| Low | ≥ 130° | Minimal | Soft, undefined | Neotenous, youthful |\n   627→| Low-Balanced | 125-130° | Slight | Harmonious soft | Balanced but softer |\n   628→| Balanced | 118-125° | Moderate | Neutral | Neither masc nor fem |\n   629→| Above-Average | 115-120° | Moderate+ | Defined | Leaning masculine |\n   630→| High | 110-118° | Prominent | Very defined | Strongly masculine |\n   631→| Very High | < 110° | Heavy | Extremely defined | Hypermasculine |\n   632→\n   633→#### Body Type Classification\n   634→\n   635→| Type | Shoulder-Waist Ratio | Build | Archetype Fit |\n   636→|------|---------------------|-------|---------------|\n   637→| Ectomorphic | < 1.35 | Slim, lean | Softboy, Prettyboy |\n   638→| Ecto-Mesomorphic | 1.35-1.45 | Lean athletic | Robust Prettyboy, Vampire Chad |\n   639→| Mesomorphic | 1.45-1.55 | Athletic | Chad, Jock |\n   640→| Endo-Mesomorphic | > 1.55, high muscle | Muscular large | Hypermasculine, Aquaman |\n   641→| Meso-Endomorphic | > 1.45, higher BF | Thick, strong | Ogre, Viking |\n   642→\n   643→### 4.3 Classification Algorithm\n   644→\n   645→```typescript\n   646→// archetype-classifier.ts\n   647→\n   648→interface ClassificationInput {\n   649→  // From landmarks\n   650→  gonialAngle: number;\n   651→  fwhr: number;\n   652→  browRidgeProminence: number;\n   653→  cheekboneHeight: number;\n   654→  eyeAreaScore: number;\n   655→\n   656→  // Computed\n   657→  dimorphismLevel: DimorphismLevel;\n   658→\n   659→  // From vision (if available)\n   660→  hollowCheeks?: number;\n   661→  skinTone?: string;\n   662→\n   663→  // From physique (if available)\n   664→  bodyType?: BodyType;\n   665→  frameSize?: FrameSize;\n   666→\n   667→  // User input\n   668→  ethnicity: string;\n   669→  gender: 'male' | 'female';\n   670→}\n   671→\n   672→interface ArchetypeResult {\n   673→  primary: {\n   674→    category: string;      // e.g., \"Chad\"\n   675→    subArchetype: string;  // e.g., \"Vampire\"\n   676→    confidence: number;    // 0-1\n   677→  };\n   678→  secondary: {\n   679→    category: string;\n   680→    subArchetype: string;\n   681→    confidence: number;\n   682→  };\n   683→  traits: string[];\n   684→  styleGuide: StyleRecommendation;\n   685→  transitionPath?: {\n   686→    target: string;\n   687→    requirements: string[];\n   688→  };\n   689→}\n   690→\n   691→function classifyArchetype(input: ClassificationInput): ArchetypeResult {\n   692→  const scores: Record<string, number> = {};\n   693→\n   694→  // Score each main category\n   695→  scores.Softboy = scoreSoftboy(input);\n   696→  scores.Prettyboy = scorePrettyboy(input);\n   697→  scores.RobustPrettyboy = scoreRobustPrettyboy(input);\n   698→  scores.Chad = scoreChad(input);\n   699→  scores.Hypermasculine = scoreHypermasculine(input);\n   700→  scores.Ogre = scoreOgre(input);\n   701→\n   702→  // Get top 2 categories\n   703→  const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);\n   704→  const primaryCategory = sorted[0][0];\n   705→  const secondaryCategory = sorted[1][0];\n   706→\n   707→  // Determine sub-archetype within primary\n   708→  const primarySub = classifySubArchetype(primaryCategory, input);\n   709→  const secondarySub = classifySubArchetype(secondaryCategory, input);\n   710→\n   711→  return {\n   712→    primary: {\n   713→      category: primaryCategory,\n   714→      subArchetype: primarySub.name,\n   715→      confidence: sorted[0][1] / 100,\n   716→    },\n   717→    secondary: {\n   718→      category: secondaryCategory,\n   719→      subArchetype: secondarySub.name,\n   720→      confidence: sorted[1][1] / 100,\n   721→    },\n   722→    traits: [...primarySub.traits, ...secondarySub.traits.slice(0, 2)],\n   723→    styleGuide: getStyleGuide(primaryCategory, primarySub.name),\n   724→    transitionPath: getTransitionPath(primaryCategory, sorted),\n   725→  };\n   726→}\n   727→\n   728→function scoreChad(input: ClassificationInput): number {\n   729→  let score = 0;\n   730→\n   731→  // Gonial angle (strong jaw)\n   732→  if (input.gonialAngle <= 120) score += 25;\n   733→  else if (input.gonialAngle <= 125) score += 15;\n   734→\n   735→  // High dimorphism\n   736→  if (input.dimorphismLevel === 'high') score += 25;\n   737→  else if (input.dimorphismLevel === 'above-average') score += 15;\n   738→\n   739→  // Brow ridge\n   740→  if (input.browRidgeProminence >= 7) score += 15;\n   741→\n   742→  // Body type\n   743→  if (input.bodyType === 'mesomorphic') score += 15;\n   744→  else if (input.bodyType === 'ecto-mesomorphic') score += 10;\n   745→\n   746→  // Hollow cheeks (vampire sub-type indicator)\n   747→  if (input.hollowCheeks && input.hollowCheeks >= 7) score += 10;\n   748→\n   749→  // Frame\n   750→  if (input.frameSize === 'large') score += 10;\n   751→\n   752→  return score;\n   753→}\n   754→\n   755→// Similar scoring functions for other categories...\n   756→```\n   757→\n   758→---\n   759→\n   760→## 5. Advice Generation Engine\n   761→\n   762→### 5.1 Advice Categories\n   763→\n   764→1. **Hairstyle Recommendations**\n   765→2. **Skincare Routine**\n   766→3. **Style Guide** (clothing, colors, accessories)\n   767→4. **Grooming Guide** (facial hair, eyebrows, etc.)\n   768→5. **Physique Recommendations**\n   769→6. **Action Plan** (prioritized improvements)\n   770→\n   771→### 5.2 Hairstyle Recommendations\n   772→\n   773→#### Face Shape Detection (from landmarks)\n   774→\n   775→| Face Shape | Characteristics | Detection Criteria |\n   776→|------------|-----------------|-------------------|\n   777→| Oval | Balanced, slightly longer | FWHR 1.4-1.6, cheekbones widest |\n   778→| Round | Wide, soft angles | FWHR > 1.6, minimal jaw definition |\n   779→| Square | Strong jaw, equal width/length | FWHR ≈ 1.5, wide bigonial |\n   780→| Oblong | Long, narrow | FWHR < 1.4, high forehead |\n   781→| Heart | Wide forehead, narrow chin | Wide temples, narrow lower third |\n   782→| Diamond | Narrow forehead/chin, wide cheeks | High cheekbones, narrow bigonial |\n   783→\n   784→#### Hairstyle Database Structure\n   785→\n   786→```json\n   787→{\n   788→  \"hairstyles\": [\n   789→    {\n   790→      \"id\": \"textured-fringe\",\n   791→      \"name\": \"Textured Fringe\",\n   792→      \"description\": \"Layered top with textured fringe covering forehead\",\n   793→      \"face_shapes\": [\"oblong\", \"heart\", \"diamond\"],\n   794→      \"hairline_max_nw\": 2,\n   795→      \"hair_textures\": [\"straight\", \"wavy\"],\n   796→      \"archetypes\": [\"Prettyboy\", \"Softboy\", \"RobustPrettyboy\"],\n   797→      \"maintenance\": \"medium\",\n   798→      \"styling_time\": \"5-10 min\",\n   799→      \"products\": [\"texturizing paste\", \"sea salt spray\"],\n   800→      \"reference_images\": [\"url1\", \"url2\"]\n   801→    },\n   802→    {\n   803→      \"id\": \"slicked-back\",\n   804→      \"name\": \"Slicked Back\",\n   805→      \"description\": \"Hair pushed back with product for clean look\",\n   806→      \"face_shapes\": [\"oval\", \"square\", \"diamond\"],\n   807→      \"hairline_max_nw\": 1,\n   808→      \"hair_textures\": [\"straight\", \"wavy\"],\n   809→      \"archetypes\": [\"Chad\", \"Executive\", \"Prince\"],\n   810→      \"maintenance\": \"low\",\n   811→      \"styling_time\": \"2-5 min\",\n   812→      \"products\": [\"pomade\", \"gel\"],\n   813→      \"reference_images\": [\"url1\", \"url2\"]\n   814→    },\n   815→    {\n   816→      \"id\": \"buzz-cut\",\n   817→      \"name\": \"Buzz Cut\",\n   818→      \"description\": \"Very short all around, low maintenance\",\n   819→      \"face_shapes\": [\"oval\", \"square\"],\n   820→      \"hairline_max_nw\": 7,\n   821→      \"hair_textures\": [\"any\"],\n   822→      \"archetypes\": [\"Hypermasculine\", \"Jock\", \"Ogre\"],\n   823→      \"maintenance\": \"very-low\",\n   824→      \"styling_time\": \"0 min\",\n   825→      \"products\": [],\n   826→      \"reference_images\": [\"url1\", \"url2\"]\n   827→    }\n   828→    // ... more hairstyles\n   829→  ]\n   830→}\n   831→```\n   832→\n   833→#### Recommendation Logic\n   834→\n   835→```typescript\n   836→function recommendHairstyles(\n   837→  faceShape: FaceShape,\n   838→  hairlineNW: number,\n   839→  hairTexture: string,\n   840→  archetype: ArchetypeResult,\n   841→  preferences?: { maintenance?: string }\n   842→): HairstyleRecommendation[] {\n   843→\n   844→  return HAIRSTYLES\n   845→    .filter(h => h.face_shapes.includes(faceShape))\n   846→    .filter(h => h.hairline_max_nw >= hairlineNW)\n   847→    .filter(h => h.hair_textures.includes(hairTexture) || h.hair_textures.includes('any'))\n   848→    .filter(h => h.archetypes.some(a =>\n   849→      a === archetype.primary.category || a === archetype.primary.subArchetype\n   850→    ))\n   851→    .sort((a, b) => {\n   852→      // Prioritize by archetype match strength\n   853→      const aMatch = getArchetypeMatchScore(a, archetype);\n   854→      const bMatch = getArchetypeMatchScore(b, archetype);\n   855→      return bMatch - aMatch;\n   856→    })\n   857→    .slice(0, 5);\n   858→}\n   859→```\n   860→\n   861→### 5.3 Skincare Routine Generation\n   862→\n   863→#### Routine Structure\n   864→\n   865→```typescript\n   866→interface SkincareRoutine {\n   867→  morning: SkincareStep[];\n   868→  evening: SkincareStep[];\n   869→  weekly: SkincareStep[];\n   870→  targetedTreatments: Treatment[];\n   871→}\n   872→\n   873→interface SkincareStep {\n   874→  order: number;\n   875→  type: 'cleanser' | 'toner' | 'serum' | 'moisturizer' | 'sunscreen' | 'treatment';\n   876→  product: {\n   877→    name: string;\n   878→    ingredients: string[];\n   879→    purpose: string;\n   880→  };\n   881→  frequency: 'daily' | 'alternate' | 'weekly';\n   882→  notes?: string;\n   883→}\n   884→```\n   885→\n   886→#### Routine Logic Based on Skin Analysis\n   887→\n   888→```typescript\n   889→function generateSkincareRoutine(skinAnalysis: SkinAnalysis): SkincareRoutine {\n   890→  const routine: SkincareRoutine = {\n   891→    morning: [],\n   892→    evening: [],\n   893→    weekly: [],\n   894→    targetedTreatments: [],\n   895→  };\n   896→\n   897→  // Morning routine (always)\n   898→  routine.morning.push(\n   899→    { order: 1, type: 'cleanser', product: getCleanser(skinAnalysis) },\n   900→    { order: 2, type: 'moisturizer', product: getMoisturizer(skinAnalysis) },\n   901→    { order: 3, type: 'sunscreen', product: { name: 'SPF 50+ Sunscreen', ingredients: ['zinc oxide'], purpose: 'UV protection' } }\n   902→  );\n   903→\n   904→  // Evening routine (always)\n   905→  routine.evening.push(\n   906→    { order: 1, type: 'cleanser', product: getCleanser(skinAnalysis) },\n   907→    { order: 2, type: 'treatment', product: getEveningTreatment(skinAnalysis) },\n   908→    { order: 3, type: 'moisturizer', product: getMoisturizer(skinAnalysis) }\n   909→  );\n   910→\n   911→  // Add targeted treatments based on issues\n   912→  if (skinAnalysis.acne_level !== 'none') {\n   913→    routine.targetedTreatments.push({\n   914→      concern: 'acne',\n   915→      product: 'Benzoyl Peroxide 2.5% or Salicylic Acid 2%',\n   916→      frequency: 'daily',\n   917→      notes: 'Apply to affected areas only'\n   918→    });\n   919→  }\n   920→\n   921→  if (skinAnalysis.acne_scarring !== 'none') {\n   922→    routine.targetedTreatments.push({\n   923→      concern: 'scarring',\n   924→      product: 'Vitamin C Serum (morning) + Retinol (evening)',\n   925→      frequency: 'daily',\n   926→      notes: 'Start retinol slowly, 2x/week then increase'\n   927→    });\n   928→  }\n   929→\n   930→  if (skinAnalysis.under_eye_darkness >= 6) {\n   931→    routine.targetedTreatments.push({\n   932→      concern: 'dark circles',\n   933→      product: 'Caffeine Eye Serum + Vitamin K cream',\n   934→      frequency: 'twice daily',\n   935→      notes: 'Also improve sleep and hydration'\n   936→    });\n   937→  }\n   938→\n   939→  // Weekly treatments\n   940→  if (skinAnalysis.pore_visibility !== 'minimal') {\n   941→    routine.weekly.push({\n   942→      order: 1,\n   943→      type: 'treatment',\n   944→      product: { name: 'Clay Mask', ingredients: ['kaolin', 'bentonite'], purpose: 'Deep pore cleansing' },\n   945→      frequency: 'weekly'\n   946→    });\n   947→  }\n   948→\n   949→  return routine;\n   950→}\n   951→```\n   952→\n   953→### 5.4 Style Guide Generation\n   954→\n   955→```typescript\n   956→interface StyleGuide {\n   957→  archetype: string;\n   958→  subArchetype: string;\n   959→\n   960→  clothing: {\n   961→    essentials: ClothingItem[];\n   962→    fits: string[];\n   963→    avoid: string[];\n   964→  };\n   965→\n   966→  colors: {\n   967→    primary: string[];      // Best colors based on skin tone\n   968→    accent: string[];       // Accent colors\n   969→    avoid: string[];        // Colors to avoid\n   970→  };\n   971→\n   972→  accessories: {\n   973→    recommended: Accessory[];\n   974→    optional: Accessory[];\n   975→  };\n   976→\n   977→  grooming: {\n   978→    facialHair: string;     // Recommendation based on features\n   979→    eyebrows: string;\n   980→    hair: string;           // Reference to hairstyle recs\n   981→  };\n   982→\n   983→  inspirationImages: string[];\n   984→  celebrityReferences: string[];\n   985→}\n   986→\n   987→function generateStyleGuide(\n   988→  archetype: ArchetypeResult,\n   989→  skinTone: string,\n   990→  visionFeatures: VisionFeatures\n   991→): StyleGuide {\n   992→\n   993→  const baseGuide = STYLE_GUIDES[archetype.primary.subArchetype];\n   994→\n   995→  // Customize colors based on skin tone\n   996→  const colors = getColorPalette(skinTone, archetype);\n   997→\n   998→  // Facial hair recommendation\n   999→  const facialHair = recommendFacialHair(\n  1000→    archetype,\n  1001→    visionFeatures.facial_hair_potential,\n  1002→    visionFeatures.hollow_cheeks\n  1003→  );\n  1004→\n  1005→  return {\n  1006→    ...baseGuide,\n  1007→    colors,\n  1008→    grooming: {\n  1009→      facialHair,\n  1010→      eyebrows: recommendEyebrowGrooming(visionFeatures.eyebrow_density),\n  1011→      hair: 'See hairstyle recommendations',\n  1012→    },\n  1013→  };\n  1014→}\n  1015→```\n  1016→\n  1017→### 5.5 Action Plan Generation\n  1018→\n  1019→```typescript\n  1020→interface ActionPlan {\n  1021→  tier: 'foundation' | 'enhancement' | 'advanced';\n  1022→  items: ActionItem[];\n  1023→  estimatedTimeframe: string;\n  1024→  estimatedCost: CostRange;\n  1025→  potentialPSLGain: number;\n  1026→}\n  1027→\n  1028→interface ActionItem {\n  1029→  priority: number;\n  1030→  category: 'skincare' | 'hair' | 'physique' | 'style' | 'dental' | 'surgical';\n  1031→  action: string;\n  1032→  reason: string;\n  1033→  impact: 'high' | 'medium' | 'low';\n  1034→  difficulty: 'easy' | 'medium' | 'hard';\n  1035→  timeframe: string;\n  1036→  cost: CostRange;\n  1037→  linkedFlaw?: string;\n  1038→}\n  1039→\n  1040→function generateActionPlan(\n  1041→  flaws: Flaw[],\n  1042→  strengths: Strength[],\n  1043→  visionFeatures: VisionFeatures,\n  1044→  archetype: ArchetypeResult,\n  1045→  userPreferences: { budget: string; timeline: string }\n  1046→): ActionPlan[] {\n  1047→\n  1048→  const items: ActionItem[] = [];\n  1049→\n  1050→  // 1. Foundation tier (softmaxxing, low cost, high impact)\n  1051→\n  1052→  // Skincare if issues detected\n  1053→  if (visionFeatures.skin.acne_level !== 'none' || visionFeatures.skin.clarity < 7) {\n  1054→    items.push({\n  1055→      priority: 1,\n  1056→      category: 'skincare',\n  1057→      action: 'Establish consistent skincare routine',\n  1058→      reason: `Current skin clarity: ${visionFeatures.skin.clarity}/10`,\n  1059→      impact: 'high',\n  1060→      difficulty: 'easy',\n  1061→      timeframe: '2-4 weeks for visible improvement',\n  1062→      cost: { min: 30, max: 100, currency: 'USD', frequency: 'monthly' },\n  1063→    });\n  1064→  }\n  1065→\n  1066→  // Haircut if not matching archetype\n  1067→  items.push({\n  1068→    priority: 2,\n  1069→    category: 'hair',\n  1070→    action: `Get archetype-matched haircut (${archetype.primary.subArchetype} style)`,\n  1071→    reason: 'Hairstyle should complement face shape and archetype',\n  1072→    impact: 'high',\n  1073→    difficulty: 'easy',\n  1074→    timeframe: 'Immediate',\n  1075→    cost: { min: 20, max: 80, currency: 'USD', frequency: 'monthly' },\n  1076→  });\n  1077→\n  1078→  // Physique if needed\n  1079→  if (visionFeatures.body && visionFeatures.body.body_fat_percent > 18) {\n  1080→    items.push({\n  1081→      priority: 3,\n  1082→      category: 'physique',\n  1083→      action: 'Reduce body fat to 12-15% range',\n  1084→      reason: `Current estimated BF: ${visionFeatures.body.body_fat_percent}%. Lower BF reveals facial definition and hollow cheeks.`,\n  1085→      impact: 'high',\n  1086→      difficulty: 'medium',\n  1087→      timeframe: '3-6 months',\n  1088→      cost: { min: 0, max: 100, currency: 'USD', frequency: 'monthly' },\n  1089→    });\n  1090→  }\n  1091→\n  1092→  // Style update\n  1093→  items.push({\n  1094→    priority: 4,\n  1095→    category: 'style',\n  1096→    action: `Adopt ${archetype.primary.subArchetype} wardrobe essentials`,\n  1097→    reason: 'Clothing should reinforce your natural archetype',\n  1098→    impact: 'medium',\n  1099→    difficulty: 'easy',\n  1100→    timeframe: '1-2 weeks',\n  1101→    cost: { min: 200, max: 500, currency: 'USD', frequency: 'one-time' },\n  1102→  });\n  1103→\n  1104→  // Dental if issues\n  1105→  if (visionFeatures.teeth.color !== 'white') {\n  1106→    items.push({\n  1107→      priority: 5,\n  1108→      category: 'dental',\n  1109→      action: 'Whiten teeth',\n  1110→      reason: `Current tooth color: ${visionFeatures.teeth.color}`,\n  1111→      impact: 'medium',\n  1112→      difficulty: 'easy',\n  1113→      timeframe: '2-4 weeks',\n  1114→      cost: { min: 30, max: 500, currency: 'USD', frequency: 'one-time' },\n  1115→    });\n  1116→  }\n  1117→\n  1118→  // 2. Enhancement tier (from existing flaws)\n  1119→  flaws.forEach((flaw, index) => {\n  1120→    const treatment = findBestTreatment(flaw);\n  1121→    if (treatment && treatment.phase !== 'Surgical') {\n  1122→      items.push({\n  1123→        priority: 10 + index,\n  1124→        category: treatment.category,\n  1125→        action: treatment.name,\n  1126→        reason: flaw.summary,\n  1127→        impact: treatment.impact > 0.5 ? 'high' : 'medium',\n  1128→        difficulty: 'medium',\n  1129→        timeframe: treatment.timeline,\n  1130→        cost: treatment.cost,\n  1131→        linkedFlaw: flaw.id,\n  1132→      });\n  1133→    }\n  1134→  });\n  1135→\n  1136→  // Sort by priority and group into tiers\n  1137→  const sorted = items.sort((a, b) => a.priority - b.priority);\n  1138→\n  1139→  return [\n  1140→    {\n  1141→      tier: 'foundation',\n  1142→      items: sorted.filter(i => i.priority <= 5),\n  1143→      estimatedTimeframe: '1-3 months',\n  1144→      estimatedCost: sumCosts(sorted.filter(i => i.priority <= 5)),\n  1145→      potentialPSLGain: 0.5,\n  1146→    },\n  1147→    {\n  1148→      tier: 'enhancement',\n  1149→      items: sorted.filter(i => i.priority > 5 && i.priority <= 15),\n  1150→      estimatedTimeframe: '3-6 months',\n  1151→      estimatedCost: sumCosts(sorted.filter(i => i.priority > 5 && i.priority <= 15)),\n  1152→      potentialPSLGain: 1.0,\n  1153→    },\n  1154→    {\n  1155→      tier: 'advanced',\n  1156→      items: sorted.filter(i => i.priority > 15),\n  1157→      estimatedTimeframe: '6-12 months',\n  1158→      estimatedCost: sumCosts(sorted.filter(i => i.priority > 15)),\n  1159→      potentialPSLGain: 0.5,\n  1160→    },\n  1161→  ];\n  1162→}\n  1163→```\n  1164→\n  1165→---\n  1166→\n  1167→## 6. Database Schema\n  1168→\n  1169→### 6.1 New Tables\n  1170→\n  1171→```sql\n  1172→-- Enhanced user profile\n  1173→ALTER TABLE users ADD COLUMN IF NOT EXISTS height_cm INTEGER;\n  1174→ALTER TABLE users ADD COLUMN IF NOT EXISTS physique_photo_url TEXT;\n  1175→ALTER TABLE users ADD COLUMN IF NOT EXISTS psl_tier VARCHAR(20);\n  1176→\n  1177→-- Vision extractions (cached AI analysis)\n  1178→CREATE TABLE vision_extractions (\n  1179→    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n  1180→    analysis_id UUID NOT NULL REFERENCES analyses(id) ON DELETE CASCADE,\n  1181→    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n  1182→\n  1183→    -- Face features\n  1184→    skin_clarity DECIMAL(3,2),\n  1185→    skin_tone VARCHAR(50),\n  1186→    acne_level VARCHAR(20),\n  1187→    acne_scarring VARCHAR(20),\n  1188→    pore_visibility VARCHAR(20),\n  1189→    texture_issues JSONB,\n  1190→\n  1191→    -- Hair features\n  1192→    hairline_nw INTEGER,\n  1193→    hair_density VARCHAR(20),\n  1194→    hair_texture VARCHAR(20),\n  1195→    hair_color VARCHAR(50),\n  1196→\n  1197→    -- Eye features\n  1198→    eye_color VARCHAR(50),\n  1199→    under_eye_darkness DECIMAL(3,2),\n  1200→    under_eye_puffiness DECIMAL(3,2),\n  1201→\n  1202→    -- Facial features\n  1203→    hollow_cheeks DECIMAL(3,2),\n  1204→    eyebrow_density VARCHAR(20),\n  1205→    facial_hair_potential VARCHAR(20),\n  1206→\n  1207→    -- Teeth\n  1208→    teeth_color VARCHAR(20),\n  1209→    teeth_alignment VARCHAR(20),\n  1210→\n  1211→    -- Body (if physique photo provided)\n  1212→    body_fat_percent DECIMAL(4,1),\n  1213→    muscle_mass VARCHAR(20),\n  1214→    frame_size VARCHAR(20),\n  1215→    shoulder_width VARCHAR(20),\n  1216→    waist_definition VARCHAR(20),\n  1217→    posture VARCHAR(20),\n  1218→\n  1219→    -- Metadata\n  1220→    raw_response JSONB,\n  1221→    created_at TIMESTAMP DEFAULT NOW(),\n  1222→\n  1223→    UNIQUE(analysis_id)\n  1224→);\n  1225→\n  1226→-- PSL scores (enhanced)\n  1227→CREATE TABLE psl_scores (\n  1228→    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n  1229→    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n  1230→    analysis_id UUID NOT NULL REFERENCES analyses(id) ON DELETE CASCADE,\n  1231→\n  1232→    -- Component scores\n  1233→    face_score DECIMAL(4,2) NOT NULL,\n  1234→    height_score DECIMAL(4,2) NOT NULL,\n  1235→    body_score DECIMAL(4,2),\n  1236→\n  1237→    -- Bonuses\n  1238→    threshold_bonus DECIMAL(4,2) DEFAULT 0,\n  1239→    synergy_bonus DECIMAL(4,2) DEFAULT 0,\n  1240→    penalties DECIMAL(4,2) DEFAULT 0,\n  1241→\n  1242→    -- Final\n  1243→    total_score DECIMAL(4,2) NOT NULL,\n  1244→    tier VARCHAR(20) NOT NULL,\n  1245→    percentile DECIMAL(5,2),\n  1246→\n  1247→    -- Potential\n  1248→    potential_score DECIMAL(4,2),\n  1249→\n  1250→    created_at TIMESTAMP DEFAULT NOW(),\n  1251→\n  1252→    UNIQUE(analysis_id)\n  1253→);\n  1254→\n  1255→-- Archetype classifications\n  1256→CREATE TABLE archetype_results (\n  1257→    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n  1258→    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n  1259→    analysis_id UUID NOT NULL REFERENCES analyses(id) ON DELETE CASCADE,\n  1260→\n  1261→    -- Primary archetype\n  1262→    primary_category VARCHAR(50) NOT NULL,\n  1263→    primary_sub_archetype VARCHAR(50) NOT NULL,\n  1264→    primary_confidence DECIMAL(3,2) NOT NULL,\n  1265→\n  1266→    -- Secondary archetype\n  1267→    secondary_category VARCHAR(50),\n  1268→    secondary_sub_archetype VARCHAR(50),\n  1269→    secondary_confidence DECIMAL(3,2),\n  1270→\n  1271→    -- Details\n  1272→    traits JSONB,\n  1273→    style_guide JSONB,\n  1274→    transition_path JSONB,\n  1275→\n  1276→    created_at TIMESTAMP DEFAULT NOW(),\n  1277→\n  1278→    UNIQUE(analysis_id)\n  1279→);\n  1280→\n  1281→-- Generated advice\n  1282→CREATE TABLE advice_results (\n  1283→    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n  1284→    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n  1285→    analysis_id UUID NOT NULL REFERENCES analyses(id) ON DELETE CASCADE,\n  1286→\n  1287→    -- Recommendations\n  1288→    hairstyle_recommendations JSONB,\n  1289→    skincare_routine JSONB,\n  1290→    style_guide JSONB,\n  1291→    grooming_guide JSONB,\n  1292→    action_plan JSONB,\n  1293→\n  1294→    -- User preferences used\n  1295→    budget VARCHAR(20),\n  1296→    timeline VARCHAR(20),\n  1297→    goals JSONB,\n  1298→\n  1299→    created_at TIMESTAMP DEFAULT NOW(),\n  1300→\n  1301→    UNIQUE(analysis_id)\n  1302→);\n  1303→\n  1304→-- Indexes\n  1305→CREATE INDEX idx_vision_extractions_analysis ON vision_extractions(analysis_id);\n  1306→CREATE INDEX idx_vision_extractions_user ON vision_extractions(user_id);\n  1307→CREATE INDEX idx_psl_scores_analysis ON psl_scores(analysis_id);\n  1308→CREATE INDEX idx_psl_scores_user ON psl_scores(user_id);\n  1309→CREATE INDEX idx_archetype_results_analysis ON archetype_results(analysis_id);\n  1310→CREATE INDEX idx_advice_results_analysis ON advice_results(analysis_id);\n  1311→```\n  1312→\n  1313→---\n  1314→\n  1315→## 7. API Endpoints\n  1316→\n  1317→### 7.1 PSL Endpoints\n  1318→\n  1319→| Endpoint | Method | Auth | Paid | Description |\n  1320→|----------|--------|------|------|-------------|\n  1321→| `/psl/calculate` | POST | Yes | No | Calculate PSL from face + height |\n  1322→| `/psl/calculate-full` | POST | Yes | Yes | Calculate PSL with AI vision + body |\n  1323→| `/psl/{analysis_id}` | GET | Yes | No | Get stored PSL score |\n  1324→\n  1325→#### POST /psl/calculate\n  1326→```json\n  1327→// Request\n  1328→{\n  1329→  \"analysis_id\": \"uuid\",\n  1330→  \"height_cm\": 180\n  1331→}\n  1332→\n  1333→// Response\n  1334→{\n  1335→  \"score\": 6.75,\n  1336→  \"tier\": \"HTN\",\n  1337→  \"percentile\": 78.5,\n  1338→  \"breakdown\": {\n  1339→    \"face\": { \"raw\": 7.2, \"weighted\": 5.4 },\n  1340→    \"height\": { \"raw\": 7.0, \"weighted\": 1.4 },\n  1341→    \"body\": { \"raw\": 5.0, \"weighted\": 0.25 },\n  1342→    \"bonuses\": { \"threshold\": 0, \"synergy\": 0, \"total\": 0 },\n  1343→    \"penalties\": 0\n  1344→  },\n  1345→  \"potential\": 7.8\n  1346→}\n  1347→```\n  1348→\n  1349→### 7.2 Vision Endpoints (Paid)\n  1350→\n  1351→| Endpoint | Method | Auth | Paid | Description |\n  1352→|----------|--------|------|------|-------------|\n  1353→| `/vision/extract` | POST | Yes | Yes | Extract features from photos |\n  1354→| `/vision/extract-body` | POST | Yes | Yes | Analyze physique photo |\n  1355→| `/vision/{analysis_id}` | GET | Yes | Yes | Get stored vision extraction |\n  1356→\n  1357→#### POST /vision/extract\n  1358→```json\n  1359→// Request\n  1360→{\n  1361→  \"analysis_id\": \"uuid\",\n  1362→  \"include_body\": false\n  1363→}\n  1364→\n  1365→// Response\n  1366→{\n  1367→  \"extraction_id\": \"uuid\",\n  1368→  \"face\": {\n  1369→    \"skin\": {\n  1370→      \"clarity\": 7.5,\n  1371→      \"tone\": \"medium\",\n  1372→      \"acne_level\": \"mild\",\n  1373→      \"acne_scarring\": \"none\",\n  1374→      \"pore_visibility\": \"visible\"\n  1375→    },\n  1376→    \"hair\": {\n  1377→      \"hairline_nw\": 1,\n  1378→      \"density\": \"thick\",\n  1379→      \"texture\": \"wavy\",\n  1380→      \"color\": \"dark-brown\"\n  1381→    },\n  1382→    \"eyes\": {\n  1383→      \"color\": \"brown\",\n  1384→      \"under_eye_darkness\": 4.5,\n  1385→      \"under_eye_puffiness\": 2.0\n  1386→    },\n  1387→    \"facial_features\": {\n  1388→      \"hollow_cheeks\": 6.5,\n  1389→      \"eyebrow_density\": \"thick\",\n  1390→      \"facial_hair_potential\": \"high\"\n  1391→    },\n  1392→    \"teeth\": {\n  1393→      \"color\": \"off-white\",\n  1394→      \"alignment\": \"aligned\"\n  1395→    }\n  1396→  },\n  1397→  \"body\": null\n  1398→}\n  1399→```\n  1400→\n  1401→### 7.3 Archetype Endpoints\n  1402→\n  1403→| Endpoint | Method | Auth | Paid | Description |\n  1404→|----------|--------|------|------|-------------|\n  1405→| `/archetype/classify` | POST | Yes | No* | Classify archetype (enhanced with vision if paid) |\n  1406→| `/archetype/{analysis_id}` | GET | Yes | No | Get stored archetype |\n  1407→| `/archetype/styles` | GET | No | No | Get all style guides |\n  1408→\n  1409→### 7.4 Advice Endpoints (Paid)\n  1410→\n  1411→| Endpoint | Method | Auth | Paid | Description |\n  1412→|----------|--------|------|------|-------------|\n  1413→| `/advice/generate` | POST | Yes | Yes | Generate full advice package |\n  1414→| `/advice/hairstyles` | GET | Yes | Yes | Get hairstyle recommendations |\n  1415→| `/advice/skincare` | GET | Yes | Yes | Get skincare routine |\n  1416→| `/advice/style` | GET | Yes | Yes | Get style guide |\n  1417→| `/advice/action-plan` | GET | Yes | Yes | Get action plan |\n  1418→| `/advice/{analysis_id}` | GET | Yes | Yes | Get all stored advice |\n  1419→\n  1420→#### POST /advice/generate\n  1421→```json\n  1422→// Request\n  1423→{\n  1424→  \"analysis_id\": \"uuid\",\n  1425→  \"preferences\": {\n  1426→    \"budget\": \"medium\",\n  1427→    \"timeline\": \"6mo\",\n  1428→    \"goals\": [\"dating\", \"confidence\"]\n  1429→  }\n  1430→}\n  1431→\n  1432→// Response\n  1433→{\n  1434→  \"advice_id\": \"uuid\",\n  1435→  \"hairstyles\": [...],\n  1436→  \"skincare\": {...},\n  1437→  \"style_guide\": {...},\n  1438→  \"grooming\": {...},\n  1439→  \"action_plan\": [...]\n  1440→}\n  1441→```\n  1442→\n  1443→---\n  1444→\n  1445→## 8. Frontend Components\n  1446→\n  1447→### 8.1 Component Structure\n  1448→\n  1449→```\n  1450→src/components/psl/\n  1451→├── PSLScoreCard.tsx          # Main score display with tier badge\n  1452→├── PSLBreakdown.tsx          # Visual breakdown (face/height/body pie)\n  1453→├── PSLTierBadge.tsx          # Tier icon and name\n  1454→├── PSLComparison.tsx         # Current vs Potential\n  1455→├── PSLUpgradePrompt.tsx      # Prompt to unlock AI vision\n  1456→│\n  1457→├── archetype/\n  1458→│   ├── ArchetypeCard.tsx     # Primary archetype display\n  1459→│   ├── ArchetypeTraits.tsx   # Trait badges\n  1460→│   ├── ArchetypeComparison.tsx # Primary vs Secondary\n  1461→│   └── ArchetypeTransition.tsx # Path to next archetype\n  1462→│\n  1463→├── advice/\n  1464→│   ├── HairstyleRecommendations.tsx  # Hairstyle cards with images\n  1465→│   ├── SkincareRoutine.tsx           # AM/PM routine display\n  1466→│   ├── StyleGuide.tsx                # Clothing/color recommendations\n  1467→│   ├── GroomingGuide.tsx             # Facial hair, brows, etc.\n  1468→│   └── ActionPlan.tsx                # Prioritized improvements\n  1469→│\n  1470→└── shared/\n  1471→    ├── FeatureCard.tsx       # Extracted feature display\n  1472→    ├── ScoreBar.tsx          # Horizontal score visualization\n  1473→    ├── TierIcon.tsx          # Tier-specific icons\n  1474→    └── PaywallOverlay.tsx    # Upgrade prompt overlay\n  1475→```\n  1476→\n  1477→### 8.2 Results Tab Integration\n  1478→\n  1479→```typescript\n  1480→// Add to ResultsLayout.tsx tabs\n  1481→const TABS: TabConfig[] = [\n  1482→  { id: 'overview', label: 'Overview', icon: <LayoutDashboard size={18} /> },\n  1483→  { id: 'front-ratios', label: 'Front Ratios', icon: <User size={18} /> },\n  1484→  { id: 'side-ratios', label: 'Side Ratios', icon: <ScanFace size={18} /> },\n  1485→  { id: 'leaderboard', label: 'Leaderboard', icon: <Trophy size={18} /> },\n  1486→  { id: 'plan', label: 'Your Plan', icon: <Sparkles size={18} /> },\n  1487→  // NEW TABS\n  1488→  { id: 'psl', label: 'PSL Score', icon: <Gauge size={18} />, paid: false },\n  1489→  { id: 'archetype', label: 'Archetype', icon: <Shapes size={18} />, paid: false },\n  1490→  { id: 'advice', label: 'AI Advice', icon: <Lightbulb size={18} />, paid: true },\n  1491→  // EXISTING\n  1492→  { id: 'options', label: 'Options', icon: <Settings size={18} /> },\n  1493→  { id: 'support', label: 'Support', icon: <HelpCircle size={18} /> },\n  1494→];\n  1495→```\n  1496→\n  1497→### 8.3 Key Component: PSLScoreCard\n  1498→\n  1499→```tsx\n  1500→// PSLScoreCard.tsx\n  1501→interface PSLScoreCardProps {\n  1502→  psl: PSLResult;\n  1503→  showBreakdown?: boolean;\n  1504→  showPotential?: boolean;\n  1505→}\n  1506→\n  1507→export function PSLScoreCard({ psl, showBreakdown = true, showPotential = true }: PSLScoreCardProps) {\n  1508→  return (\n  1509→    <div className=\"bg-zinc-900 rounded-xl p-6 border border-zinc-800\">\n  1510→      {/* Header */}\n  1511→      <div className=\"flex items-center justify-between mb-6\">\n  1512→        <h2 className=\"text-xl font-semibold text-white\">PSL Rating</h2>\n  1513→        <PSLTierBadge tier={psl.tier} />\n  1514→      </div>\n  1515→\n  1516→      {/* Main Score */}\n  1517→      <div className=\"flex items-center gap-6 mb-6\">\n  1518→        <div className=\"text-6xl font-bold text-cyan-400\">\n  1519→          {psl.score.toFixed(2)}\n  1520→        </div>\n  1521→        <div className=\"text-zinc-400\">\n  1522→          <div className=\"text-lg\">{psl.tier}</div>\n  1523→          <div className=\"text-sm\">Top {(100 - psl.percentile).toFixed(1)}%</div>\n  1524→        </div>\n  1525→      </div>\n  1526→\n  1527→      {/* Breakdown */}\n  1528→      {showBreakdown && (\n  1529→        <PSLBreakdown breakdown={psl.breakdown} />\n  1530→      )}\n  1531→\n  1532→      {/* Potential */}\n  1533→      {showPotential && psl.potential > psl.score && (\n  1534→        <div className=\"mt-4 pt-4 border-t border-zinc-800\">\n  1535→          <div className=\"flex items-center justify-between text-sm\">\n  1536→            <span className=\"text-zinc-400\">Potential with improvements</span>\n  1537→            <span className=\"text-green-400 font-semibold\">\n  1538→              {psl.potential.toFixed(2)} (+{(psl.potential - psl.score).toFixed(2)})\n  1539→            </span>\n  1540→          </div>\n  1541→        </div>\n  1542→      )}\n  1543→    </div>\n  1544→  );\n  1545→}\n  1546→```\n  1547→\n  1548→### 8.4 Key Component: ArchetypeCard\n  1549→\n  1550→```tsx\n  1551→// ArchetypeCard.tsx\n  1552→interface ArchetypeCardProps {\n  1553→  archetype: ArchetypeResult;\n  1554→  showSecondary?: boolean;\n  1555→  showTransition?: boolean;\n  1556→}\n  1557→\n  1558→export function ArchetypeCard({ archetype, showSecondary = true, showTransition = true }: ArchetypeCardProps) {\n  1559→  return (\n  1560→    <div className=\"bg-zinc-900 rounded-xl p-6 border border-zinc-800\">\n  1561→      {/* Primary Archetype */}\n  1562→      <div className=\"flex items-start gap-4 mb-6\">\n  1563→        <div className=\"w-16 h-16 rounded-lg bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center\">\n  1564→          <ArchetypeIcon archetype={archetype.primary.subArchetype} />\n  1565→        </div>\n  1566→        <div>\n  1567→          <div className=\"text-sm text-zinc-400 mb-1\">Your Archetype</div>\n  1568→          <div className=\"text-2xl font-bold text-white\">\n  1569→            {archetype.primary.subArchetype}\n  1570→          </div>\n  1571→          <div className=\"text-sm text-zinc-500\">\n  1572→            {archetype.primary.category} • {(archetype.primary.confidence * 100).toFixed(0)}% match\n  1573→          </div>\n  1574→        </div>\n  1575→      </div>\n  1576→\n  1577→      {/* Traits */}\n  1578→      <div className=\"flex flex-wrap gap-2 mb-6\">\n  1579→        {archetype.traits.map(trait => (\n  1580→          <span key={trait} className=\"px-3 py-1 rounded-full bg-zinc-800 text-zinc-300 text-sm\">\n  1581→            {trait}\n  1582→          </span>\n  1583→        ))}\n  1584→      </div>\n  1585→\n  1586→      {/* Secondary */}\n  1587→      {showSecondary && archetype.secondary && (\n  1588→        <div className=\"p-4 rounded-lg bg-zinc-800/50 mb-4\">\n  1589→          <div className=\"text-sm text-zinc-400 mb-1\">Secondary Match</div>\n  1590→          <div className=\"text-lg text-white\">\n  1591→            {archetype.secondary.subArchetype}\n  1592→            <span className=\"text-zinc-500 text-sm ml-2\">\n  1593→              ({(archetype.secondary.confidence * 100).toFixed(0)}%)\n  1594→            </span>\n  1595→          </div>\n  1596→        </div>\n  1597→      )}\n  1598→\n  1599→      {/* Transition Path */}\n  1600→      {showTransition && archetype.transitionPath && (\n  1601→        <div className=\"p-4 rounded-lg border border-dashed border-zinc-700\">\n  1602→          <div className=\"text-sm text-zinc-400 mb-2\">Transition Potential</div>\n  1603→          <div className=\"flex items-center gap-2\">\n  1604→            <span className=\"text-white\">{archetype.primary.subArchetype}</span>\n  1605→            <ArrowRight className=\"text-zinc-600\" size={16} />\n  1606→            <span className=\"text-cyan-400\">{archetype.transitionPath.target}</span>\n  1607→          </div>\n  1608→          <div className=\"text-xs text-zinc-500 mt-2\">\n  1609→            Requirements: {archetype.transitionPath.requirements.join(', ')}\n  1610→          </div>\n  1611→        </div>\n  1612→      )}\n  1613→    </div>\n  1614→  );\n  1615→}\n  1616→```\n  1617→\n  1618→---\n  1619→\n  1620→## 9. Implementation Phases\n  1621→\n  1622→### Phase 1: PSL Foundation (Week 1)\n  1623→**Priority: Critical**\n  1624→\n  1625→- [ ] Add `height_cm` to users table\n  1626→- [ ] Implement height input in onboarding/results\n  1627→- [ ] Create `psl-calculator.ts` with formula\n  1628→- [ ] Create `PSLScoreCard`, `PSLBreakdown`, `PSLTierBadge` components\n  1629→- [ ] Add PSL tab to results page\n  1630→- [ ] Create `/psl/calculate` endpoint\n  1631→\n  1632→### Phase 2: Archetype System (Week 2)\n  1633→**Priority: High**\n  1634→\n  1635→- [ ] Create `archetypes.json` with full taxonomy\n  1636→- [ ] Implement `archetype-classifier.ts`\n  1637→- [ ] Create `archetype_service.py`\n  1638→- [ ] Create `ArchetypeCard`, `ArchetypeTraits` components\n  1639→- [ ] Add Archetype tab to results page\n  1640→- [ ] Create `/archetype/classify` endpoint\n  1641→\n  1642→### Phase 3: AI Vision Integration (Week 3)\n  1643→**Priority: High - Paid Feature**\n  1644→\n  1645→- [ ] Set up Claude API integration\n  1646→- [ ] Implement `vision_service.py`\n  1647→- [ ] Create `vision_extractions` table\n  1648→- [ ] Create `/vision/extract` endpoint\n  1649→- [ ] Add paywall for AI vision access\n  1650→- [ ] Display extracted features in UI\n  1651→\n  1652→### Phase 4: Advice Engine (Week 4)\n  1653→**Priority: High - Paid Feature**\n  1654→\n  1655→- [ ] Create `hairstyles.json` database\n  1656→- [ ] Create `skincare.json` routines\n  1657→- [ ] Create `style_guides.json`\n  1658→- [ ] Implement `advice_service.py`\n  1659→- [ ] Create advice components (`HairstyleRecommendations`, `SkincareRoutine`, etc.)\n  1660→- [ ] Add Advice tab to results page\n  1661→- [ ] Create `/advice/*` endpoints\n  1662→\n  1663→### Phase 5: Action Plan (Week 5)\n  1664→**Priority: Medium**\n  1665→\n  1666→- [ ] Implement action plan generation logic\n  1667→- [ ] Create `ActionPlan` component\n  1668→- [ ] Integrate with existing recommendations\n  1669→- [ ] Add cost/timeline estimates\n  1670→- [ ] Link flaws to specific actions\n  1671→\n  1672→### Phase 6: Polish & Integration (Week 6)\n  1673→**Priority: Medium**\n  1674→\n  1675→- [ ] End-to-end testing\n  1676→- [ ] Performance optimization\n  1677→- [ ] Caching for AI calls\n  1678→- [ ] Error handling\n  1679→- [ ] Mobile responsiveness\n  1680→- [ ] Analytics integration\n  1681→\n  1682→---\n  1683→\n  1684→## 10. Cost & Pricing\n  1685→\n  1686→### 10.1 API Costs\n  1687→\n  1688→| Service | Cost per Call | Usage |\n  1689→|---------|--------------|-------|\n  1690→| Claude Vision (face) | ~$0.01-0.02 | Per face extraction |\n  1691→| Claude Vision (body) | ~$0.01 | Per body extraction |\n  1692→| Total per user | ~$0.02-0.03 | One-time per analysis |\n  1693→\n  1694→### 10.2 Suggested Pricing Tiers\n  1695→\n  1696→| Feature | Free | Pro ($X/mo) | Premium ($Y/mo) |\n  1697→|---------|------|-------------|-----------------|\n  1698→| Landmark Analysis | ✓ | ✓ | ✓ |\n  1699→| Basic PSL (face + height) | ✓ | ✓ | ✓ |\n  1700→| Archetype (rule-based) | ✓ | ✓ | ✓ |\n  1701→| AI Vision Extraction | ✗ | ✓ | ✓ |\n  1702→| Enhanced PSL (with body) | ✗ | ✓ | ✓ |\n  1703→| Hairstyle Recommendations | ✗ | ✓ | ✓ |\n  1704→| Skincare Routine | ✗ | ✓ | ✓ |\n  1705→| Style Guide | ✗ | ✓ | ✓ |\n  1706→| Action Plan | ✗ | ✓ | ✓ |\n  1707→| Unlimited Re-analyses | ✗ | ✗ | ✓ |\n  1708→\n  1709→### 10.3 Margin Analysis\n  1710→\n  1711→- Cost per paid user: ~$0.03 (one-time AI call)\n  1712→- If user pays $5/month: 99%+ margin\n  1713→- If user pays $20 one-time: 99%+ margin\n  1714→- AI costs are negligible relative to value provided\n  1715→\n  1716→---\n  1717→\n  1718→## Appendix A: Halos & Failos Reference\n  1719→\n  1720→### Halos (Positive Features)\n  1721→\n  1722→| Halo | Detection Method | Impact |\n  1723→|------|------------------|--------|\n  1724→| Hunter Eyes | Landmarks (canthal tilt, deep-set) | High |\n  1725→| Hollow Cheeks | Vision AI | High |\n  1726→| Strong Jawline | Landmarks (gonial angle, bigonial) | High |\n  1727→| Clear Skin | Vision AI | High |\n  1728→| NW0-1 Hairline | Vision AI | Medium |\n  1729→| White Teeth | Vision AI | Medium |\n  1730→| Compact Midface | Landmarks | High |\n  1731→| Dense Eyebrows | Vision AI | Low |\n  1732→| Golden/Tanned Skin | Vision AI | Low |\n  1733→\n  1734→### Failos (Negative Features)\n  1735→\n  1736→| Failo | Detection Method | Severity |\n  1737→|-------|------------------|----------|\n  1738→| Negative Canthal Tilt | Landmarks | Major |\n  1739→| Receding Chin | Landmarks | Major |\n  1740→| Long Philtrum | Landmarks | Moderate |\n  1741→| Severe Acne/Scarring | Vision AI | Major |\n  1742→| Asymmetry | Landmarks | Moderate-Major |\n  1743→| NW3+ Hairline | Vision AI | Moderate |\n  1744→| Scleral Show | Landmarks | Moderate |\n  1745→| Thin Neck | Landmarks/Vision | Minor |\n  1746→| Mouth Breathing Signs | Landmarks | Major |\n  1747→| Narrow Palate | Landmarks | Moderate |\n  1748→\n  1749→---\n  1750→\n  1751→## Appendix B: Celebrity Calibration\n  1752→\n  1753→Use these known ratings for algorithm validation:\n  1754→\n  1755→| Celebrity | Expected PSL | Archetype | Key Features |\n  1756→|-----------|--------------|-----------|--------------|\n  1757→| Francisco Lachowski | 9.0+ | Prettyboy | Perfect harmony, no failos |\n  1758→| Henry Cavill | 8.5-9.0 | Superman Chad | Strong jaw, dimorphism |\n  1759→| Ian Somerhalder | 8.0-8.5 | Vampire Chad | Hunter eyes, hollow cheeks |\n  1760→| Zac Efron (prime) | 8.0-8.5 | Jock Chad | Athletic, symmetrical |\n  1761→| Timothée Chalamet | 7.5-8.0 | Softboy | Harmony, low dimorphism |\n  1762→| Josh Hutcherson | 5.5-6.0 | HTN | Average height limits ceiling |\n  1763→| Average man | 5.0 | MTN | By definition |\n  1764→\n  1765→---\n  1766→\n  1767→## Appendix C: File Paths Summary\n  1768→\n  1769→### Backend (looksmaxx-api)\n  1770→\n  1771→```\n  1772→app/\n  1773→├── services/\n  1774→│   ├── psl_service.py           # NEW\n  1775→│   ├── vision_service.py        # NEW\n  1776→│   ├── archetype_service.py     # NEW\n  1777→│   └── advice_service.py        # NEW\n  1778→├── routers/\n  1779→│   ├── psl.py                   # NEW\n  1780→│   ├── vision.py                # NEW\n  1781→│   └── advice.py                # NEW\n  1782→├── models/\n  1783→│   ├── vision_extraction.py     # NEW\n  1784→│   ├── psl_score.py             # NEW\n  1785→│   ├── archetype_result.py      # NEW\n  1786→│   └── advice_result.py         # NEW\n  1787→└── data/\n  1788→    ├── archetypes.json          # NEW\n  1789→    ├── hairstyles.json          # NEW\n  1790→    ├── skincare.json            # NEW\n  1791→    └── style_guides.json        # NEW\n  1792→```\n  1793→\n  1794→### Frontend (looksmaxx-app)\n  1795→\n  1796→```\n  1797→src/\n  1798→├── components/\n  1799→│   └── psl/                     # NEW (entire folder)\n  1800→├── contexts/\n  1801→│   └── PSLContext.tsx           # NEW\n  1802→├── lib/\n  1803→│   ├── psl-calculator.ts        # NEW\n  1804→│   └── archetype-classifier.ts  # NEW\n  1805→└── types/\n  1806→    └── psl.ts                   # NEW\n  1807→```\n  1808→\n  1809→---\n  1810→\n  1811→*Document Version: 1.0*\n  1812→*Last Updated: 2025-01-XX*\n  1813→*Author: LOOKSMAXX Team*\n  1814→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"b6608bf0-1e7b-472a-8ab4-6bed5c58d991","timestamp":"2025-12-25T23:19:07.424Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/psl.md","content":"# PSL Enhancement System - Implementation Specification\n\n## Overview\n\nThis document outlines the implementation of an enhanced PSL (Pretty Scale Level) scoring system with AI-powered feature extraction, archetype classification, and personalized advice generation. The AI vision analysis is a **paid feature**.\n\n---\n\n## Table of Contents\n\n1. [System Architecture](#1-system-architecture)\n2. [PSL Scoring Formula](#2-psl-scoring-formula)\n3. [AI Vision Feature Extraction (Paid)](#3-ai-vision-feature-extraction-paid)\n4. [Archetype Classification System](#4-archetype-classification-system)\n5. [Advice Generation Engine](#5-advice-generation-engine)\n6. [Database Schema](#6-database-schema)\n7. [API Endpoints](#7-api-endpoints)\n8. [Frontend Components](#8-frontend-components)\n9. [Implementation Phases](#9-implementation-phases)\n10. [Cost & Pricing](#10-cost--pricing)\n\n---\n\n## 1. System Architecture\n\n### High-Level Flow\n\n```\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                           USER INPUT                                         │\n├─────────────────────────────────────────────────────────────────────────────┤\n│  FREE TIER                          │  PAID TIER (AI Vision)                │\n│  ├── Gender                         │  ├── All FREE tier data               │\n│  ├── Ethnicity                      │  ├── AI Skin Analysis                 │\n│  ├── Front Photo                    │  ├── AI Hair/Hairline Analysis        │\n│  ├── Side Photo                     │  ├── AI Teeth Analysis                │\n│  └── Height (manual input)          │  ├── AI Hollow Cheeks Detection       │\n│                                      │  ├── AI Eye Color Extraction         │\n│                                      │  ├── Physique Photo (optional)        │\n│                                      │  └── AI Body Composition Analysis     │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                         PROCESSING PIPELINE                                  │\n├─────────────────────────────────────────────────────────────────────────────┤\n│                                                                              │\n│  STAGE 1: Landmark Analysis (Existing)                                      │\n│  ├── MediaPipe 478 landmarks (client-side)                                  │\n│  ├── InsightFace 106 landmarks (server-side)                                │\n│  └── 70+ facial metrics computed                                            │\n│                                                                              │\n│  STAGE 2: AI Vision Extraction (Paid Only)                                  │\n│  ├── Claude Vision API analyzes photos                                      │\n│  ├── Extracts soft tissue features                                          │\n│  └── Stores in vision_extractions table                                     │\n│                                                                              │\n│  STAGE 3: PSL Calculation                                                   │\n│  ├── Face Score (from landmarks) × 0.75                                     │\n│  ├── Height Score (from input) × 0.20                                       │\n│  ├── Body Score (from AI vision, if available) × 0.05                       │\n│  ├── Apply bonuses and constraints                                          │\n│  └── Classify into tier                                                     │\n│                                                                              │\n│  STAGE 4: Archetype Classification                                          │\n│  ├── Rule-based scoring per archetype                                       │\n│  ├── AI refinement for edge cases (paid)                                    │\n│  └── Sub-archetype determination                                            │\n│                                                                              │\n│  STAGE 5: Advice Generation                                                 │\n│  ├── Hairstyle recommendations (face shape + hairline)                      │\n│  ├── Skincare routine (skin analysis)                                       │\n│  ├── Style guide (archetype-matched)                                        │\n│  └── Prioritized action plan (flaws → fixes)                                │\n│                                                                              │\n└─────────────────────────────────────────────────────────────────────────────┘\n                                    │\n                                    ▼\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                              OUTPUT                                          │\n├─────────────────────────────────────────────────────────────────────────────┤\n│  ├── Enhanced PSL Score (0-10) with tier badge                              │\n│  ├── Score breakdown (Face/Height/Body/Bonuses)                             │\n│  ├── Primary + Secondary Archetype                                          │\n│  ├── Hairstyle Recommendations (3-5 options)                                │\n│  ├── Skincare Routine (AM/PM)                                               │\n│  ├── Style Guide (clothing, colors, accessories)                            │\n│  └── Personalized Action Plan (prioritized by impact)                       │\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n### Service Architecture\n\n```\nlooksmaxx-api/\n├── app/\n│   ├── services/\n│   │   ├── psl_service.py           # PSL calculation with formula\n│   │   ├── vision_service.py        # Claude Vision API integration\n│   │   ├── archetype_service.py     # Archetype classification\n│   │   └── advice_service.py        # Recommendation generation\n│   │\n│   ├── routers/\n│   │   ├── psl.py                   # PSL endpoints\n│   │   ├── vision.py                # AI vision endpoints\n│   │   └── advice.py                # Advice endpoints\n│   │\n│   └── data/\n│       ├── archetypes.json          # Archetype definitions\n│       ├── hairstyles.json          # Hairstyle database\n│       ├── skincare.json            # Skincare routines\n│       └── style_guides.json        # Style recommendations\n\nlooksmaxx-app/\n├── src/\n│   ├── contexts/\n│   │   └── PSLContext.tsx           # Enhanced PSL state\n│   │\n│   ├── components/\n│   │   └── psl/\n│   │       ├── PSLScoreCard.tsx     # Main score display\n│   │       ├── PSLBreakdown.tsx     # Component breakdown\n│   │       ├── TierBadge.tsx        # Tier visualization\n│   │       ├── ArchetypeCard.tsx    # Archetype display\n│   │       ├── HairstyleRecs.tsx    # Hairstyle recommendations\n│   │       ├── SkincareRoutine.tsx  # Skincare display\n│   │       ├── StyleGuide.tsx       # Style recommendations\n│   │       └── ActionPlan.tsx       # Prioritized improvements\n│   │\n│   └── lib/\n│       ├── psl-calculator.ts        # Client-side PSL logic\n│       └── archetype-classifier.ts  # Client-side classification\n```\n\n---\n\n## 2. PSL Scoring Formula\n\n### 2.1 Base Formula\n\n```\nPSL_Score = (Face × 0.75) + (Height × 0.20) + (Body × 0.05) + Bonuses\n```\n\nWhere:\n- **Face** = Harmony score from landmark analysis (0-10)\n- **Height** = Height rating from lookup table (0-10)\n- **Body** = Body composition score from AI vision (0-10), defaults to 5.0 if not available\n- **Bonuses** = Threshold and synergy bonuses (0-0.85 max)\n\n### 2.2 Height Rating Table\n\n| Height (Male) | Rating | Height (Female) | Rating |\n|---------------|--------|-----------------|--------|\n| < 5'3\" (160cm) | 1.0 | < 4'11\" (150cm) | 1.0 |\n| 5'3\" (160cm) | 2.0 | 4'11\" (150cm) | 2.0 |\n| 5'5\" (165cm) | 3.0 | 5'1\" (155cm) | 3.5 |\n| 5'7\" (170cm) | 4.0 | 5'3\" (160cm) | 5.0 |\n| 5'9\" (175cm) | 5.0 | 5'5\" (165cm) | 6.0 |\n| 5'10\" (178cm) | 5.5 | 5'6\" (168cm) | 6.5 |\n| 5'11\" (180cm) | 6.0 | 5'7\" (170cm) | 7.0 |\n| 6'0\" (183cm) | 7.0 | 5'8\" (173cm) | 7.5 |\n| 6'1\" (185cm) | 7.5 | 5'9\" (175cm) | 8.0 |\n| 6'2\" (188cm) | 8.0 | 5'10\" (178cm) | 8.5 |\n| 6'3\" (190cm) | 8.5 | 5'11\" (180cm) | 9.0 |\n| 6'4\" (193cm) | 9.0 | 6'0\"+ (183cm+) | 9.0 (cap) |\n| 6'5\"+ (196cm+) | 9.5 (diminishing) | - | - |\n\n### 2.3 Body Rating Scale\n\n| Body Fat % | Muscle Level | Rating | Description |\n|------------|--------------|--------|-------------|\n| 25%+ | Low | 2.0-3.0 | Overweight, no definition |\n| 20-25% | Low | 3.5-4.5 | Soft, minimal definition |\n| 18-22% | Medium | 5.0-5.5 | Average, some definition |\n| 15-18% | Medium | 6.0-6.5 | Lean, visible abs starting |\n| 12-15% | Medium-High | 7.0-7.5 | Athletic, clear definition |\n| 10-12% | High | 8.0-8.5 | Shredded, competition lean |\n| 8-10% | Very High | 9.0-9.5 | Elite physique |\n| < 8% | Extreme | 9.5+ | IFBB Pro tier |\n\n### 2.4 Bonus System\n\n#### Threshold Bonuses (when category ≥ 8.5)\n| Category | Bonus |\n|----------|-------|\n| Face ≥ 8.5 | +0.30 |\n| Height ≥ 8.5 | +0.20 |\n| Body ≥ 8.5 | +0.10 |\n\n#### Synergy Bonuses (when multiple categories ≥ 8.5)\n| Combination | Additional Bonus |\n|-------------|------------------|\n| Face + Height ≥ 8.5 | +0.15 |\n| Face + Body ≥ 8.5 | +0.10 |\n| Height + Body ≥ 8.5 | +0.05 |\n\n#### Triple Synergy (all three ≥ 8.5)\n- **+0.35** flat bonus (replaces pair bonuses, stacks with threshold bonuses)\n\n### 2.5 Constraints (Failos)\n\n| Constraint | Effect |\n|------------|--------|\n| Major facial failo present | Caps tier regardless of score |\n| Body < 5.0 | -0.3 to face perception |\n| Height < 8.0 rating | Cannot reach Gigachad tier |\n| Severe asymmetry | -0.5 penalty |\n\n### 2.6 Tier Classification\n\n| Tier | Score Range | Percentile | Description |\n|------|-------------|------------|-------------|\n| Deformity | 0.0 - 1.0 | Bottom 0.01% | Medical intervention territory |\n| Subhuman | 1.25 - 1.75 | Bottom 0.1% | Genetic outlier |\n| Incel | 2.0 - 3.0 | Bottom 2.5% | Visibly below average |\n| LTN (Low Tier Normie) | 3.5 - 4.5 | Bottom 13.59% | Somewhat unattractive |\n| MTN (Mid Tier Normie) | 4.75 - 5.25 | Middle 68% | True average |\n| HTN (High Tier Normie) | 5.5 - 6.5 | Top 13.59% | Somewhat attractive |\n| Chadlite | 7.0 - 8.0 | Top 2.5% | Attractive, local star |\n| Chad | 8.25 - 8.75 | Top 0.1% | Very attractive, elite |\n| Gigachad | 9.0 - 9.5 | Top 0.01% | Mythical tier |\n| True Mogger | 9.5+ | Apex | Theoretical limit |\n\n### 2.7 Implementation\n\n```typescript\n// psl-calculator.ts\n\ninterface PSLInput {\n  faceScore: number;        // 0-10 from harmony analysis\n  heightCm: number;         // User input\n  gender: 'male' | 'female';\n  bodyAnalysis?: {          // From AI vision (paid)\n    bodyFatPercent: number;\n    muscleLevel: 'low' | 'medium' | 'medium-high' | 'high' | 'very-high' | 'extreme';\n  };\n  failos?: string[];        // Detected major failos\n}\n\ninterface PSLResult {\n  score: number;            // Final PSL 0-10\n  tier: string;             // Tier name\n  percentile: number;       // Population percentile\n  breakdown: {\n    face: { raw: number; weighted: number };\n    height: { raw: number; weighted: number };\n    body: { raw: number; weighted: number };\n    bonuses: { threshold: number; synergy: number; total: number };\n    penalties: number;\n  };\n  potential: number;        // Estimated max with improvements\n}\n\nfunction calculatePSL(input: PSLInput): PSLResult {\n  // 1. Get height rating\n  const heightRating = getHeightRating(input.heightCm, input.gender);\n\n  // 2. Get body rating (default 5.0 if not available)\n  const bodyRating = input.bodyAnalysis\n    ? getBodyRating(input.bodyAnalysis.bodyFatPercent, input.bodyAnalysis.muscleLevel)\n    : 5.0;\n\n  // 3. Calculate base score\n  const faceWeighted = input.faceScore * 0.75;\n  const heightWeighted = heightRating * 0.20;\n  const bodyWeighted = bodyRating * 0.05;\n  let baseScore = faceWeighted + heightWeighted + bodyWeighted;\n\n  // 4. Calculate bonuses\n  let thresholdBonus = 0;\n  let synergyBonus = 0;\n\n  if (input.faceScore >= 8.5) thresholdBonus += 0.30;\n  if (heightRating >= 8.5) thresholdBonus += 0.20;\n  if (bodyRating >= 8.5) thresholdBonus += 0.10;\n\n  const highCount = [input.faceScore, heightRating, bodyRating].filter(s => s >= 8.5).length;\n\n  if (highCount === 3) {\n    synergyBonus = 0.35; // Triple synergy replaces pairs\n  } else if (highCount === 2) {\n    if (input.faceScore >= 8.5 && heightRating >= 8.5) synergyBonus += 0.15;\n    if (input.faceScore >= 8.5 && bodyRating >= 8.5) synergyBonus += 0.10;\n    if (heightRating >= 8.5 && bodyRating >= 8.5) synergyBonus += 0.05;\n  }\n\n  // 5. Apply penalties\n  let penalties = 0;\n  if (bodyRating < 5.0) penalties += 0.3;\n  if (input.failos?.includes('severe_asymmetry')) penalties += 0.5;\n\n  // 6. Final score\n  const finalScore = Math.min(10, Math.max(0, baseScore + thresholdBonus + synergyBonus - penalties));\n\n  // 7. Classify tier (with constraints)\n  const tier = classifyTier(finalScore, heightRating, input.failos);\n\n  return {\n    score: Math.round(finalScore * 100) / 100,\n    tier: tier.name,\n    percentile: tier.percentile,\n    breakdown: {\n      face: { raw: input.faceScore, weighted: faceWeighted },\n      height: { raw: heightRating, weighted: heightWeighted },\n      body: { raw: bodyRating, weighted: bodyWeighted },\n      bonuses: { threshold: thresholdBonus, synergy: synergyBonus, total: thresholdBonus + synergyBonus },\n      penalties,\n    },\n    potential: estimatePotential(input),\n  };\n}\n```\n\n---\n\n## 3. AI Vision Feature Extraction (Paid)\n\n### 3.1 Features Extracted\n\n#### From Face Photos\n\n| Feature | Scale | Description | Used For |\n|---------|-------|-------------|----------|\n| **Skin Clarity** | 0-10 | Overall skin quality | Skincare recommendations |\n| **Skin Tone** | Category | pale/fair/medium/olive/tan/dark | Style color matching |\n| **Acne Level** | none/mild/moderate/severe | Current breakout status | Skincare priority |\n| **Acne Scarring** | none/mild/moderate/severe | Historical scarring | Treatment recommendations |\n| **Pore Visibility** | minimal/visible/prominent | Pore size assessment | Skincare routine |\n| **Texture Issues** | list | Roughness, bumps, etc. | Targeted treatments |\n| **Hairline NW** | 0-7 | Norwood scale classification | Hairstyle recommendations |\n| **Hair Density** | thin/medium/thick | Hair thickness | Hairstyle options |\n| **Hair Texture** | straight/wavy/curly/coily | Natural texture | Styling recommendations |\n| **Hair Color** | Category | Natural color classification | Style matching |\n| **Eye Color** | Category | Iris color | Style color matching |\n| **Under-eye Darkness** | 0-10 | Dark circle severity | Skincare/concealer advice |\n| **Under-eye Puffiness** | 0-10 | Bag severity | Lifestyle recommendations |\n| **Hollow Cheeks** | 0-10 | Buccal fat assessment | Leanness indicator |\n| **Teeth Color** | white/off-white/yellow/stained | Tooth shade | Whitening recommendations |\n| **Teeth Alignment** | aligned/minor-issues/crooked | Orthodontic status | Treatment options |\n| **Eyebrow Density** | sparse/medium/thick | Brow fullness | Grooming advice |\n| **Facial Hair Potential** | low/medium/high | Beard growth capability | Style recommendations |\n\n#### From Physique Photo (Optional)\n\n| Feature | Scale | Description | Used For |\n|---------|-------|-------------|----------|\n| **Body Fat %** | 5-40% | Estimated body fat | Body score calculation |\n| **Muscle Mass** | low/medium/medium-high/high/very-high | Muscularity | Body score, archetype |\n| **Frame Size** | small/medium/large/very-large | Skeletal frame | Archetype classification |\n| **Shoulder Width** | narrow/average/broad/very-broad | Shoulder assessment | Style recommendations |\n| **Waist Definition** | undefined/slight/defined/very-defined | V-taper indicator | Physique score |\n| **Posture** | poor/fair/good/excellent | Standing posture | Improvement advice |\n\n### 3.2 Claude Vision Implementation\n\n```python\n# vision_service.py\n\nimport anthropic\nfrom typing import Optional\nimport base64\n\nclass VisionService:\n    def __init__(self):\n        self.client = anthropic.Anthropic()\n        self.model = \"claude-sonnet-4-20250514\"\n\n    async def extract_features(\n        self,\n        front_photo_url: str,\n        side_photo_url: Optional[str] = None,\n        physique_photo_url: Optional[str] = None\n    ) -> VisionExtractionResult:\n\n        # Prepare images\n        images = [{\"type\": \"image\", \"source\": {\"type\": \"url\", \"url\": front_photo_url}}]\n        if side_photo_url:\n            images.append({\"type\": \"image\", \"source\": {\"type\": \"url\", \"url\": side_photo_url}})\n\n        # Face analysis prompt\n        face_prompt = \"\"\"Analyze this face photo and extract the following features.\n        Return a JSON object with these exact keys:\n\n        {\n          \"skin\": {\n            \"clarity\": <0-10 score>,\n            \"tone\": \"<pale|fair|medium|olive|tan|dark>\",\n            \"acne_level\": \"<none|mild|moderate|severe>\",\n            \"acne_scarring\": \"<none|mild|moderate|severe>\",\n            \"pore_visibility\": \"<minimal|visible|prominent>\",\n            \"texture_issues\": [\"<list of issues>\"]\n          },\n          \"hair\": {\n            \"hairline_nw\": <0-7 Norwood scale>,\n            \"density\": \"<thin|medium|thick>\",\n            \"texture\": \"<straight|wavy|curly|coily>\",\n            \"color\": \"<blonde|light-brown|brown|dark-brown|black|red|gray>\"\n          },\n          \"eyes\": {\n            \"color\": \"<blue|green|hazel|brown|dark-brown|black>\",\n            \"under_eye_darkness\": <0-10>,\n            \"under_eye_puffiness\": <0-10>\n          },\n          \"facial_features\": {\n            \"hollow_cheeks\": <0-10>,\n            \"eyebrow_density\": \"<sparse|medium|thick>\",\n            \"facial_hair_potential\": \"<low|medium|high>\"\n          },\n          \"teeth\": {\n            \"color\": \"<white|off-white|yellow|stained>\",\n            \"alignment\": \"<aligned|minor-issues|crooked>\",\n            \"visible_in_photo\": <boolean>\n          }\n        }\n\n        Be objective and accurate. If a feature cannot be determined from the photo, use null.\n        \"\"\"\n\n        response = await self.client.messages.create(\n            model=self.model,\n            max_tokens=1024,\n            messages=[{\n                \"role\": \"user\",\n                \"content\": [*images, {\"type\": \"text\", \"text\": face_prompt}]\n            }]\n        )\n\n        face_features = parse_json_response(response.content[0].text)\n\n        # Body analysis if physique photo provided\n        body_features = None\n        if physique_photo_url:\n            body_features = await self._analyze_physique(physique_photo_url)\n\n        return VisionExtractionResult(\n            face=face_features,\n            body=body_features\n        )\n\n    async def _analyze_physique(self, photo_url: str) -> BodyAnalysis:\n        body_prompt = \"\"\"Analyze this physique photo and extract:\n\n        {\n          \"body_fat_percent\": <estimated 5-40%>,\n          \"muscle_mass\": \"<low|medium|medium-high|high|very-high>\",\n          \"frame_size\": \"<small|medium|large|very-large>\",\n          \"shoulder_width\": \"<narrow|average|broad|very-broad>\",\n          \"waist_definition\": \"<undefined|slight|defined|very-defined>\",\n          \"posture\": \"<poor|fair|good|excellent>\",\n          \"estimated_height_category\": \"<short|average|tall|very-tall>\"\n        }\n\n        Be objective. Base body fat estimate on visible definition and vascularity.\n        \"\"\"\n\n        response = await self.client.messages.create(\n            model=self.model,\n            max_tokens=512,\n            messages=[{\n                \"role\": \"user\",\n                \"content\": [\n                    {\"type\": \"image\", \"source\": {\"type\": \"url\", \"url\": photo_url}},\n                    {\"type\": \"text\", \"text\": body_prompt}\n                ]\n            }]\n        )\n\n        return parse_json_response(response.content[0].text)\n```\n\n### 3.3 Caching Strategy\n\n- Vision extractions are cached per analysis ID\n- Cache invalidated if photos are updated\n- Results stored in `vision_extractions` table\n- TTL: Permanent (until analysis deleted)\n\n---\n\n## 4. Archetype Classification System\n\n### 4.1 Archetype Taxonomy\n\n```\nARCHETYPES\n├── SOFTBOY (Low Dimorphism, Ectomorphic)\n│   ├── K-Pop Idol\n│   │   ├── Traits: East/SE Asian, flat midface, clear skin, styled hair\n│   │   ├── Style: Slim tailored, high contrast colors, layered hair\n│   │   └── Examples: BTS members, K-drama actors\n│   │\n│   ├── Softboy\n│   │   ├── Traits: Youthful, delicate features, slim build\n│   │   ├── Style: Oversized fits, light colors, long hair\n│   │   └── Examples: Timothée Chalamet, young Leonardo DiCaprio\n│   │\n│   └── Academic\n│       ├── Traits: Intellectual look, refined, understated\n│       ├── Style: Preppy, glasses, earth tones\n│       └── Examples: Young Hugh Grant\n│\n├── PRETTYBOY (Balanced Dimorphism, Good Harmony)\n│   ├── Skater\n│   │   ├── Traits: Casual cool, athletic lean, relaxed\n│   │   ├── Style: Streetwear, baggy pants, sneakers\n│   │   └── Examples: Young Heath Ledger\n│   │\n│   ├── Prettyboy\n│   │   ├── Traits: Symmetrical, harmonious, classic beauty\n│   │   ├── Style: Clean, fitted, minimal\n│   │   └── Examples: Francisco Lachowski, Sean O'Pry\n│   │\n│   └── Surfer\n│       ├── Traits: Sun-kissed, athletic, carefree\n│       ├── Style: Beach casual, natural fabrics\n│       └── Examples: Young Chris Hemsworth\n│\n├── ROBUST PRETTYBOY (Pretty + Edge/Intensity)\n│   ├── Fallen Angel\n│   │   ├── Traits: Ethereal, intense, mysterious\n│   │   ├── Style: Dark romantic, leather, black\n│   │   └── Examples: Young Jared Leto, Jordan Barrett\n│   │\n│   ├── Prince\n│   │   ├── Traits: Regal, refined, elegant\n│   │   ├── Style: Tailored suits, classic elegance\n│   │   └── Examples: Young Alain Delon, Matt Bomer\n│   │\n│   ├── Bad Boy\n│   │   ├── Traits: Rebellious, smoldering, dangerous appeal\n│   │   ├── Style: Leather jackets, boots, rough edges\n│   │   └── Examples: James Dean, Young Johnny Depp\n│   │\n│   └── Artist\n│       ├── Traits: Creative, unconventional, magnetic\n│       ├── Style: Eclectic, statement pieces\n│       └── Examples: Harry Styles, Zayn Malik\n│\n├── CHAD (High Dimorphism, Strong Features)\n│   ├── Vampire\n│   │   ├── Traits: Sharp features, pale, mysterious, hollow cheeks\n│   │   ├── Style: Dark, sophisticated, elegant\n│   │   └── Examples: Robert Pattinson, Ian Somerhalder\n│   │\n│   ├── Superman\n│   │   ├── Traits: Heroic, strong jaw, broad build, classic handsome\n│   │   ├── Style: Classic American, clean-cut\n│   │   └── Examples: Henry Cavill, David Gandy\n│   │\n│   ├── Jock\n│   │   ├── Traits: Athletic, confident, dominant presence\n│   │   ├── Style: Athletic wear, casual sporty\n│   │   └── Examples: Chris Evans, Michael B. Jordan\n│   │\n│   ├── Casanova\n│   │   ├── Traits: Charming, seductive, smooth\n│   │   ├── Style: Tailored, sophisticated, European\n│   │   └── Examples: George Clooney, Pierce Brosnan\n│   │\n│   ├── Executive\n│   │   ├── Traits: Powerful, authoritative, successful look\n│   │   ├── Style: Power suits, luxury watches\n│   │   └── Examples: Jon Hamm, Gabriel Macht\n│   │\n│   └── Pharaoh\n│       ├── Traits: Exotic, regal, chiseled, Middle Eastern features\n│       ├── Style: Luxurious, gold accents, designer\n│       └── Examples: Fares Fares, Egyptian models\n│\n├── HYPERMASCULINE (Extreme Masculine Features)\n│   ├── Aquaman\n│   │   ├── Traits: Tall, muscular, long hair, rugged handsome\n│   │   ├── Style: Relaxed, bohemian, natural fabrics\n│   │   └── Examples: Jason Momoa, Thor-era Chris Hemsworth\n│   │\n│   ├── Hypermasculine\n│   │   ├── Traits: Extreme bone structure, heavy brow, dominant\n│   │   ├── Style: Minimalist, masculine basics\n│   │   └── Examples: Dolph Lundgren (prime), Michael Fassbender\n│   │\n│   ├── Outlaw\n│   │   ├── Traits: Rough, weathered, dangerous\n│   │   ├── Style: Leather, denim, boots, rugged\n│   │   └── Examples: Young Clint Eastwood, Josh Brolin\n│   │\n│   └── Countryman\n│       ├── Traits: Rugged, outdoorsy, strong silent\n│       ├── Style: Workwear, flannel, boots\n│       └── Examples: Yellowstone cast, Young Sam Elliott\n│\n└── OGRE (Maximum Size/Mass)\n    ├── Viking\n    │   ├── Traits: Massive, bearded, warrior look, Norse features\n    │   ├── Style: Rugged, fur, leather, minimalist\n    │   └── Examples: Hafþór Björnsson, Alexander Skarsgård (Northman)\n    │\n    └── Bodybuilder\n        ├── Traits: Extreme muscle, massive frame, imposing\n        ├── Style: Fitted to show physique, tank tops\n        └── Examples: Arnold Schwarzenegger (prime), Dwayne Johnson\n```\n\n### 4.2 Classification Criteria\n\n#### Input Features for Classification\n\n| Feature | Source | Weight |\n|---------|--------|--------|\n| Gonial Angle | Landmarks | High |\n| Facial Width/Height Ratio | Landmarks | High |\n| Brow Ridge Prominence | Landmarks + Vision | Medium |\n| Cheekbone Height | Landmarks | Medium |\n| Eye Area Score | Landmarks | Medium |\n| Dimorphism Level | Computed | High |\n| Body Type | Vision (physique) | Medium |\n| Frame Size | Vision | Medium |\n| Ethnicity | User input | Medium |\n| Hollow Cheeks | Vision | Low |\n| Skin Tone | Vision | Low |\n\n#### Dimorphism Classification\n\n| Level | Gonial Angle | Brow Ridge | Jaw Definition | Features |\n|-------|--------------|------------|----------------|----------|\n| Low | ≥ 130° | Minimal | Soft, undefined | Neotenous, youthful |\n| Low-Balanced | 125-130° | Slight | Harmonious soft | Balanced but softer |\n| Balanced | 118-125° | Moderate | Neutral | Neither masc nor fem |\n| Above-Average | 115-120° | Moderate+ | Defined | Leaning masculine |\n| High | 110-118° | Prominent | Very defined | Strongly masculine |\n| Very High | < 110° | Heavy | Extremely defined | Hypermasculine |\n\n#### Body Type Classification\n\n| Type | Shoulder-Waist Ratio | Build | Archetype Fit |\n|------|---------------------|-------|---------------|\n| Ectomorphic | < 1.35 | Slim, lean | Softboy, Prettyboy |\n| Ecto-Mesomorphic | 1.35-1.45 | Lean athletic | Robust Prettyboy, Vampire Chad |\n| Mesomorphic | 1.45-1.55 | Athletic | Chad, Jock |\n| Endo-Mesomorphic | > 1.55, high muscle | Muscular large | Hypermasculine, Aquaman |\n| Meso-Endomorphic | > 1.45, higher BF | Thick, strong | Ogre, Viking |\n\n### 4.3 Classification Algorithm\n\n```typescript\n// archetype-classifier.ts\n\ninterface ClassificationInput {\n  // From landmarks\n  gonialAngle: number;\n  fwhr: number;\n  browRidgeProminence: number;\n  cheekboneHeight: number;\n  eyeAreaScore: number;\n\n  // Computed\n  dimorphismLevel: DimorphismLevel;\n\n  // From vision (if available)\n  hollowCheeks?: number;\n  skinTone?: string;\n\n  // From physique (if available)\n  bodyType?: BodyType;\n  frameSize?: FrameSize;\n\n  // User input\n  ethnicity: string;\n  gender: 'male' | 'female';\n}\n\ninterface ArchetypeResult {\n  primary: {\n    category: string;      // e.g., \"Chad\"\n    subArchetype: string;  // e.g., \"Vampire\"\n    confidence: number;    // 0-1\n  };\n  secondary: {\n    category: string;\n    subArchetype: string;\n    confidence: number;\n  };\n  traits: string[];\n  styleGuide: StyleRecommendation;\n  transitionPath?: {\n    target: string;\n    requirements: string[];\n  };\n}\n\nfunction classifyArchetype(input: ClassificationInput): ArchetypeResult {\n  const scores: Record<string, number> = {};\n\n  // Score each main category\n  scores.Softboy = scoreSoftboy(input);\n  scores.Prettyboy = scorePrettyboy(input);\n  scores.RobustPrettyboy = scoreRobustPrettyboy(input);\n  scores.Chad = scoreChad(input);\n  scores.Hypermasculine = scoreHypermasculine(input);\n  scores.Ogre = scoreOgre(input);\n\n  // Get top 2 categories\n  const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);\n  const primaryCategory = sorted[0][0];\n  const secondaryCategory = sorted[1][0];\n\n  // Determine sub-archetype within primary\n  const primarySub = classifySubArchetype(primaryCategory, input);\n  const secondarySub = classifySubArchetype(secondaryCategory, input);\n\n  return {\n    primary: {\n      category: primaryCategory,\n      subArchetype: primarySub.name,\n      confidence: sorted[0][1] / 100,\n    },\n    secondary: {\n      category: secondaryCategory,\n      subArchetype: secondarySub.name,\n      confidence: sorted[1][1] / 100,\n    },\n    traits: [...primarySub.traits, ...secondarySub.traits.slice(0, 2)],\n    styleGuide: getStyleGuide(primaryCategory, primarySub.name),\n    transitionPath: getTransitionPath(primaryCategory, sorted),\n  };\n}\n\nfunction scoreChad(input: ClassificationInput): number {\n  let score = 0;\n\n  // Gonial angle (strong jaw)\n  if (input.gonialAngle <= 120) score += 25;\n  else if (input.gonialAngle <= 125) score += 15;\n\n  // High dimorphism\n  if (input.dimorphismLevel === 'high') score += 25;\n  else if (input.dimorphismLevel === 'above-average') score += 15;\n\n  // Brow ridge\n  if (input.browRidgeProminence >= 7) score += 15;\n\n  // Body type\n  if (input.bodyType === 'mesomorphic') score += 15;\n  else if (input.bodyType === 'ecto-mesomorphic') score += 10;\n\n  // Hollow cheeks (vampire sub-type indicator)\n  if (input.hollowCheeks && input.hollowCheeks >= 7) score += 10;\n\n  // Frame\n  if (input.frameSize === 'large') score += 10;\n\n  return score;\n}\n\n// Similar scoring functions for other categories...\n```\n\n---\n\n## 5. Advice Generation Engine\n\n### 5.1 Advice Categories\n\n1. **Hairstyle Recommendations**\n2. **Skincare Routine**\n3. **Style Guide** (clothing, colors, accessories)\n4. **Grooming Guide** (facial hair, eyebrows, etc.)\n5. **Physique Recommendations**\n6. **Action Plan** (prioritized improvements)\n\n### 5.2 Hairstyle Recommendations\n\n#### Face Shape Detection (from landmarks)\n\n| Face Shape | Characteristics | Detection Criteria |\n|------------|-----------------|-------------------|\n| Oval | Balanced, slightly longer | FWHR 1.4-1.6, cheekbones widest |\n| Round | Wide, soft angles | FWHR > 1.6, minimal jaw definition |\n| Square | Strong jaw, equal width/length | FWHR ≈ 1.5, wide bigonial |\n| Oblong | Long, narrow | FWHR < 1.4, high forehead |\n| Heart | Wide forehead, narrow chin | Wide temples, narrow lower third |\n| Diamond | Narrow forehead/chin, wide cheeks | High cheekbones, narrow bigonial |\n\n#### Hairstyle Database Structure\n\n```json\n{\n  \"hairstyles\": [\n    {\n      \"id\": \"textured-fringe\",\n      \"name\": \"Textured Fringe\",\n      \"description\": \"Layered top with textured fringe covering forehead\",\n      \"face_shapes\": [\"oblong\", \"heart\", \"diamond\"],\n      \"hairline_max_nw\": 2,\n      \"hair_textures\": [\"straight\", \"wavy\"],\n      \"archetypes\": [\"Prettyboy\", \"Softboy\", \"RobustPrettyboy\"],\n      \"maintenance\": \"medium\",\n      \"styling_time\": \"5-10 min\",\n      \"products\": [\"texturizing paste\", \"sea salt spray\"],\n      \"reference_images\": [\"url1\", \"url2\"]\n    },\n    {\n      \"id\": \"slicked-back\",\n      \"name\": \"Slicked Back\",\n      \"description\": \"Hair pushed back with product for clean look\",\n      \"face_shapes\": [\"oval\", \"square\", \"diamond\"],\n      \"hairline_max_nw\": 1,\n      \"hair_textures\": [\"straight\", \"wavy\"],\n      \"archetypes\": [\"Chad\", \"Executive\", \"Prince\"],\n      \"maintenance\": \"low\",\n      \"styling_time\": \"2-5 min\",\n      \"products\": [\"pomade\", \"gel\"],\n      \"reference_images\": [\"url1\", \"url2\"]\n    },\n    {\n      \"id\": \"buzz-cut\",\n      \"name\": \"Buzz Cut\",\n      \"description\": \"Very short all around, low maintenance\",\n      \"face_shapes\": [\"oval\", \"square\"],\n      \"hairline_max_nw\": 7,\n      \"hair_textures\": [\"any\"],\n      \"archetypes\": [\"Hypermasculine\", \"Jock\", \"Ogre\"],\n      \"maintenance\": \"very-low\",\n      \"styling_time\": \"0 min\",\n      \"products\": [],\n      \"reference_images\": [\"url1\", \"url2\"]\n    }\n    // ... more hairstyles\n  ]\n}\n```\n\n#### Recommendation Logic\n\n```typescript\nfunction recommendHairstyles(\n  faceShape: FaceShape,\n  hairlineNW: number,\n  hairTexture: string,\n  archetype: ArchetypeResult,\n  preferences?: { maintenance?: string }\n): HairstyleRecommendation[] {\n\n  return HAIRSTYLES\n    .filter(h => h.face_shapes.includes(faceShape))\n    .filter(h => h.hairline_max_nw >= hairlineNW)\n    .filter(h => h.hair_textures.includes(hairTexture) || h.hair_textures.includes('any'))\n    .filter(h => h.archetypes.some(a =>\n      a === archetype.primary.category || a === archetype.primary.subArchetype\n    ))\n    .sort((a, b) => {\n      // Prioritize by archetype match strength\n      const aMatch = getArchetypeMatchScore(a, archetype);\n      const bMatch = getArchetypeMatchScore(b, archetype);\n      return bMatch - aMatch;\n    })\n    .slice(0, 5);\n}\n```\n\n### 5.3 Skincare Routine Generation\n\n#### Routine Structure\n\n```typescript\ninterface SkincareRoutine {\n  morning: SkincareStep[];\n  evening: SkincareStep[];\n  weekly: SkincareStep[];\n  targetedTreatments: Treatment[];\n}\n\ninterface SkincareStep {\n  order: number;\n  type: 'cleanser' | 'toner' | 'serum' | 'moisturizer' | 'sunscreen' | 'treatment';\n  product: {\n    name: string;\n    ingredients: string[];\n    purpose: string;\n  };\n  frequency: 'daily' | 'alternate' | 'weekly';\n  notes?: string;\n}\n```\n\n#### Routine Logic Based on Skin Analysis\n\n```typescript\nfunction generateSkincareRoutine(skinAnalysis: SkinAnalysis): SkincareRoutine {\n  const routine: SkincareRoutine = {\n    morning: [],\n    evening: [],\n    weekly: [],\n    targetedTreatments: [],\n  };\n\n  // Morning routine (always)\n  routine.morning.push(\n    { order: 1, type: 'cleanser', product: getCleanser(skinAnalysis) },\n    { order: 2, type: 'moisturizer', product: getMoisturizer(skinAnalysis) },\n    { order: 3, type: 'sunscreen', product: { name: 'SPF 50+ Sunscreen', ingredients: ['zinc oxide'], purpose: 'UV protection' } }\n  );\n\n  // Evening routine (always)\n  routine.evening.push(\n    { order: 1, type: 'cleanser', product: getCleanser(skinAnalysis) },\n    { order: 2, type: 'treatment', product: getEveningTreatment(skinAnalysis) },\n    { order: 3, type: 'moisturizer', product: getMoisturizer(skinAnalysis) }\n  );\n\n  // Add targeted treatments based on issues\n  if (skinAnalysis.acne_level !== 'none') {\n    routine.targetedTreatments.push({\n      concern: 'acne',\n      product: 'Benzoyl Peroxide 2.5% or Salicylic Acid 2%',\n      frequency: 'daily',\n      notes: 'Apply to affected areas only'\n    });\n  }\n\n  if (skinAnalysis.acne_scarring !== 'none') {\n    routine.targetedTreatments.push({\n      concern: 'scarring',\n      product: 'Vitamin C Serum (morning) + Retinol (evening)',\n      frequency: 'daily',\n      notes: 'Start retinol slowly, 2x/week then increase'\n    });\n  }\n\n  if (skinAnalysis.under_eye_darkness >= 6) {\n    routine.targetedTreatments.push({\n      concern: 'dark circles',\n      product: 'Caffeine Eye Serum + Vitamin K cream',\n      frequency: 'twice daily',\n      notes: 'Also improve sleep and hydration'\n    });\n  }\n\n  // Weekly treatments\n  if (skinAnalysis.pore_visibility !== 'minimal') {\n    routine.weekly.push({\n      order: 1,\n      type: 'treatment',\n      product: { name: 'Clay Mask', ingredients: ['kaolin', 'bentonite'], purpose: 'Deep pore cleansing' },\n      frequency: 'weekly'\n    });\n  }\n\n  return routine;\n}\n```\n\n### 5.4 Style Guide Generation\n\n```typescript\ninterface StyleGuide {\n  archetype: string;\n  subArchetype: string;\n\n  clothing: {\n    essentials: ClothingItem[];\n    fits: string[];\n    avoid: string[];\n  };\n\n  colors: {\n    primary: string[];      // Best colors based on skin tone\n    accent: string[];       // Accent colors\n    avoid: string[];        // Colors to avoid\n  };\n\n  accessories: {\n    recommended: Accessory[];\n    optional: Accessory[];\n  };\n\n  grooming: {\n    facialHair: string;     // Recommendation based on features\n    eyebrows: string;\n    hair: string;           // Reference to hairstyle recs\n  };\n\n  inspirationImages: string[];\n  celebrityReferences: string[];\n}\n\nfunction generateStyleGuide(\n  archetype: ArchetypeResult,\n  skinTone: string,\n  visionFeatures: VisionFeatures\n): StyleGuide {\n\n  const baseGuide = STYLE_GUIDES[archetype.primary.subArchetype];\n\n  // Customize colors based on skin tone\n  const colors = getColorPalette(skinTone, archetype);\n\n  // Facial hair recommendation\n  const facialHair = recommendFacialHair(\n    archetype,\n    visionFeatures.facial_hair_potential,\n    visionFeatures.hollow_cheeks\n  );\n\n  return {\n    ...baseGuide,\n    colors,\n    grooming: {\n      facialHair,\n      eyebrows: recommendEyebrowGrooming(visionFeatures.eyebrow_density),\n      hair: 'See hairstyle recommendations',\n    },\n  };\n}\n```\n\n### 5.5 Action Plan Generation\n\n```typescript\ninterface ActionPlan {\n  tier: 'foundation' | 'enhancement' | 'advanced';\n  items: ActionItem[];\n  estimatedTimeframe: string;\n  estimatedCost: CostRange;\n  potentialPSLGain: number;\n}\n\ninterface ActionItem {\n  priority: number;\n  category: 'skincare' | 'hair' | 'physique' | 'style' | 'dental' | 'surgical';\n  action: string;\n  reason: string;\n  impact: 'high' | 'medium' | 'low';\n  difficulty: 'easy' | 'medium' | 'hard';\n  timeframe: string;\n  cost: CostRange;\n  linkedFlaw?: string;\n}\n\nfunction generateActionPlan(\n  flaws: Flaw[],\n  strengths: Strength[],\n  visionFeatures: VisionFeatures,\n  archetype: ArchetypeResult,\n  userPreferences: { budget: string; timeline: string }\n): ActionPlan[] {\n\n  const items: ActionItem[] = [];\n\n  // 1. Foundation tier (softmaxxing, low cost, high impact)\n\n  // Skincare if issues detected\n  if (visionFeatures.skin.acne_level !== 'none' || visionFeatures.skin.clarity < 7) {\n    items.push({\n      priority: 1,\n      category: 'skincare',\n      action: 'Establish consistent skincare routine',\n      reason: `Current skin clarity: ${visionFeatures.skin.clarity}/10`,\n      impact: 'high',\n      difficulty: 'easy',\n      timeframe: '2-4 weeks for visible improvement',\n      cost: { min: 30, max: 100, currency: 'USD', frequency: 'monthly' },\n    });\n  }\n\n  // Haircut if not matching archetype\n  items.push({\n    priority: 2,\n    category: 'hair',\n    action: `Get archetype-matched haircut (${archetype.primary.subArchetype} style)`,\n    reason: 'Hairstyle should complement face shape and archetype',\n    impact: 'high',\n    difficulty: 'easy',\n    timeframe: 'Immediate',\n    cost: { min: 20, max: 80, currency: 'USD', frequency: 'monthly' },\n  });\n\n  // Physique if needed\n  if (visionFeatures.body && visionFeatures.body.body_fat_percent > 18) {\n    items.push({\n      priority: 3,\n      category: 'physique',\n      action: 'Reduce body fat to 12-15% range',\n      reason: `Current estimated BF: ${visionFeatures.body.body_fat_percent}%. Lower BF reveals facial definition and hollow cheeks.`,\n      impact: 'high',\n      difficulty: 'medium',\n      timeframe: '3-6 months',\n      cost: { min: 0, max: 100, currency: 'USD', frequency: 'monthly' },\n    });\n  }\n\n  // Style update\n  items.push({\n    priority: 4,\n    category: 'style',\n    action: `Adopt ${archetype.primary.subArchetype} wardrobe essentials`,\n    reason: 'Clothing should reinforce your natural archetype',\n    impact: 'medium',\n    difficulty: 'easy',\n    timeframe: '1-2 weeks',\n    cost: { min: 200, max: 500, currency: 'USD', frequency: 'one-time' },\n  });\n\n  // Dental if issues\n  if (visionFeatures.teeth.color !== 'white') {\n    items.push({\n      priority: 5,\n      category: 'dental',\n      action: 'Whiten teeth',\n      reason: `Current tooth color: ${visionFeatures.teeth.color}`,\n      impact: 'medium',\n      difficulty: 'easy',\n      timeframe: '2-4 weeks',\n      cost: { min: 30, max: 500, currency: 'USD', frequency: 'one-time' },\n    });\n  }\n\n  // 2. Enhancement tier (from existing flaws)\n  flaws.forEach((flaw, index) => {\n    const treatment = findBestTreatment(flaw);\n    if (treatment && treatment.phase !== 'Surgical') {\n      items.push({\n        priority: 10 + index,\n        category: treatment.category,\n        action: treatment.name,\n        reason: flaw.summary,\n        impact: treatment.impact > 0.5 ? 'high' : 'medium',\n        difficulty: 'medium',\n        timeframe: treatment.timeline,\n        cost: treatment.cost,\n        linkedFlaw: flaw.id,\n      });\n    }\n  });\n\n  // Sort by priority and group into tiers\n  const sorted = items.sort((a, b) => a.priority - b.priority);\n\n  return [\n    {\n      tier: 'foundation',\n      items: sorted.filter(i => i.priority <= 5),\n      estimatedTimeframe: '1-3 months',\n      estimatedCost: sumCosts(sorted.filter(i => i.priority <= 5)),\n      potentialPSLGain: 0.5,\n    },\n    {\n      tier: 'enhancement',\n      items: sorted.filter(i => i.priority > 5 && i.priority <= 15),\n      estimatedTimeframe: '3-6 months',\n      estimatedCost: sumCosts(sorted.filter(i => i.priority > 5 && i.priority <= 15)),\n      potentialPSLGain: 1.0,\n    },\n    {\n      tier: 'advanced',\n      items: sorted.filter(i => i.priority > 15),\n      estimatedTimeframe: '6-12 months',\n      estimatedCost: sumCosts(sorted.filter(i => i.priority > 15)),\n      potentialPSLGain: 0.5,\n    },\n  ];\n}\n```\n\n---\n\n## 6. Database Schema\n\n### 6.1 New Tables\n\n```sql\n-- Enhanced user profile\nALTER TABLE users ADD COLUMN IF NOT EXISTS height_cm INTEGER;\nALTER TABLE users ADD COLUMN IF NOT EXISTS physique_photo_url TEXT;\nALTER TABLE users ADD COLUMN IF NOT EXISTS psl_tier VARCHAR(20);\n\n-- Vision extractions (cached AI analysis)\nCREATE TABLE vision_extractions (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    analysis_id UUID NOT NULL REFERENCES analyses(id) ON DELETE CASCADE,\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n\n    -- Face features\n    skin_clarity DECIMAL(3,2),\n    skin_tone VARCHAR(50),\n    acne_level VARCHAR(20),\n    acne_scarring VARCHAR(20),\n    pore_visibility VARCHAR(20),\n    texture_issues JSONB,\n\n    -- Hair features\n    hairline_nw INTEGER,\n    hair_density VARCHAR(20),\n    hair_texture VARCHAR(20),\n    hair_color VARCHAR(50),\n\n    -- Eye features\n    eye_color VARCHAR(50),\n    under_eye_darkness DECIMAL(3,2),\n    under_eye_puffiness DECIMAL(3,2),\n\n    -- Facial features\n    hollow_cheeks DECIMAL(3,2),\n    eyebrow_density VARCHAR(20),\n    facial_hair_potential VARCHAR(20),\n\n    -- Teeth\n    teeth_color VARCHAR(20),\n    teeth_alignment VARCHAR(20),\n\n    -- Body (if physique photo provided)\n    body_fat_percent DECIMAL(4,1),\n    muscle_mass VARCHAR(20),\n    frame_size VARCHAR(20),\n    shoulder_width VARCHAR(20),\n    waist_definition VARCHAR(20),\n    posture VARCHAR(20),\n\n    -- Metadata\n    raw_response JSONB,\n    created_at TIMESTAMP DEFAULT NOW(),\n\n    UNIQUE(analysis_id)\n);\n\n-- PSL scores (enhanced)\nCREATE TABLE psl_scores (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n    analysis_id UUID NOT NULL REFERENCES analyses(id) ON DELETE CASCADE,\n\n    -- Component scores\n    face_score DECIMAL(4,2) NOT NULL,\n    height_score DECIMAL(4,2) NOT NULL,\n    body_score DECIMAL(4,2),\n\n    -- Bonuses\n    threshold_bonus DECIMAL(4,2) DEFAULT 0,\n    synergy_bonus DECIMAL(4,2) DEFAULT 0,\n    penalties DECIMAL(4,2) DEFAULT 0,\n\n    -- Final\n    total_score DECIMAL(4,2) NOT NULL,\n    tier VARCHAR(20) NOT NULL,\n    percentile DECIMAL(5,2),\n\n    -- Potential\n    potential_score DECIMAL(4,2),\n\n    created_at TIMESTAMP DEFAULT NOW(),\n\n    UNIQUE(analysis_id)\n);\n\n-- Archetype classifications\nCREATE TABLE archetype_results (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n    analysis_id UUID NOT NULL REFERENCES analyses(id) ON DELETE CASCADE,\n\n    -- Primary archetype\n    primary_category VARCHAR(50) NOT NULL,\n    primary_sub_archetype VARCHAR(50) NOT NULL,\n    primary_confidence DECIMAL(3,2) NOT NULL,\n\n    -- Secondary archetype\n    secondary_category VARCHAR(50),\n    secondary_sub_archetype VARCHAR(50),\n    secondary_confidence DECIMAL(3,2),\n\n    -- Details\n    traits JSONB,\n    style_guide JSONB,\n    transition_path JSONB,\n\n    created_at TIMESTAMP DEFAULT NOW(),\n\n    UNIQUE(analysis_id)\n);\n\n-- Generated advice\nCREATE TABLE advice_results (\n    id UUID PRIMARY KEY DEFAULT uuid_generate_v4(),\n    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,\n    analysis_id UUID NOT NULL REFERENCES analyses(id) ON DELETE CASCADE,\n\n    -- Recommendations\n    hairstyle_recommendations JSONB,\n    skincare_routine JSONB,\n    style_guide JSONB,\n    grooming_guide JSONB,\n    action_plan JSONB,\n\n    -- User preferences used\n    budget VARCHAR(20),\n    timeline VARCHAR(20),\n    goals JSONB,\n\n    created_at TIMESTAMP DEFAULT NOW(),\n\n    UNIQUE(analysis_id)\n);\n\n-- Indexes\nCREATE INDEX idx_vision_extractions_analysis ON vision_extractions(analysis_id);\nCREATE INDEX idx_vision_extractions_user ON vision_extractions(user_id);\nCREATE INDEX idx_psl_scores_analysis ON psl_scores(analysis_id);\nCREATE INDEX idx_psl_scores_user ON psl_scores(user_id);\nCREATE INDEX idx_archetype_results_analysis ON archetype_results(analysis_id);\nCREATE INDEX idx_advice_results_analysis ON advice_results(analysis_id);\n```\n\n---\n\n## 7. API Endpoints\n\n### 7.1 PSL Endpoints\n\n| Endpoint | Method | Auth | Paid | Description |\n|----------|--------|------|------|-------------|\n| `/psl/calculate` | POST | Yes | No | Calculate PSL from face + height |\n| `/psl/calculate-full` | POST | Yes | Yes | Calculate PSL with AI vision + body |\n| `/psl/{analysis_id}` | GET | Yes | No | Get stored PSL score |\n\n#### POST /psl/calculate\n```json\n// Request\n{\n  \"analysis_id\": \"uuid\",\n  \"height_cm\": 180\n}\n\n// Response\n{\n  \"score\": 6.75,\n  \"tier\": \"HTN\",\n  \"percentile\": 78.5,\n  \"breakdown\": {\n    \"face\": { \"raw\": 7.2, \"weighted\": 5.4 },\n    \"height\": { \"raw\": 7.0, \"weighted\": 1.4 },\n    \"body\": { \"raw\": 5.0, \"weighted\": 0.25 },\n    \"bonuses\": { \"threshold\": 0, \"synergy\": 0, \"total\": 0 },\n    \"penalties\": 0\n  },\n  \"potential\": 7.8\n}\n```\n\n### 7.2 Vision Endpoints (Paid)\n\n| Endpoint | Method | Auth | Paid | Description |\n|----------|--------|------|------|-------------|\n| `/vision/extract` | POST | Yes | Yes | Extract features from photos |\n| `/vision/extract-body` | POST | Yes | Yes | Analyze physique photo |\n| `/vision/{analysis_id}` | GET | Yes | Yes | Get stored vision extraction |\n\n#### POST /vision/extract\n```json\n// Request\n{\n  \"analysis_id\": \"uuid\",\n  \"include_body\": false\n}\n\n// Response\n{\n  \"extraction_id\": \"uuid\",\n  \"face\": {\n    \"skin\": {\n      \"clarity\": 7.5,\n      \"tone\": \"medium\",\n      \"acne_level\": \"mild\",\n      \"acne_scarring\": \"none\",\n      \"pore_visibility\": \"visible\"\n    },\n    \"hair\": {\n      \"hairline_nw\": 1,\n      \"density\": \"thick\",\n      \"texture\": \"wavy\",\n      \"color\": \"dark-brown\"\n    },\n    \"eyes\": {\n      \"color\": \"brown\",\n      \"under_eye_darkness\": 4.5,\n      \"under_eye_puffiness\": 2.0\n    },\n    \"facial_features\": {\n      \"hollow_cheeks\": 6.5,\n      \"eyebrow_density\": \"thick\",\n      \"facial_hair_potential\": \"high\"\n    },\n    \"teeth\": {\n      \"color\": \"off-white\",\n      \"alignment\": \"aligned\"\n    }\n  },\n  \"body\": null\n}\n```\n\n### 7.3 Archetype Endpoints\n\n| Endpoint | Method | Auth | Paid | Description |\n|----------|--------|------|------|-------------|\n| `/archetype/classify` | POST | Yes | No* | Classify archetype (enhanced with vision if paid) |\n| `/archetype/{analysis_id}` | GET | Yes | No | Get stored archetype |\n| `/archetype/styles` | GET | No | No | Get all style guides |\n\n### 7.4 Advice Endpoints (Paid)\n\n| Endpoint | Method | Auth | Paid | Description |\n|----------|--------|------|------|-------------|\n| `/advice/generate` | POST | Yes | Yes | Generate full advice package |\n| `/advice/hairstyles` | GET | Yes | Yes | Get hairstyle recommendations |\n| `/advice/skincare` | GET | Yes | Yes | Get skincare routine |\n| `/advice/style` | GET | Yes | Yes | Get style guide |\n| `/advice/action-plan` | GET | Yes | Yes | Get action plan |\n| `/advice/{analysis_id}` | GET | Yes | Yes | Get all stored advice |\n\n#### POST /advice/generate\n```json\n// Request\n{\n  \"analysis_id\": \"uuid\",\n  \"preferences\": {\n    \"budget\": \"medium\",\n    \"timeline\": \"6mo\",\n    \"goals\": [\"dating\", \"confidence\"]\n  }\n}\n\n// Response\n{\n  \"advice_id\": \"uuid\",\n  \"hairstyles\": [...],\n  \"skincare\": {...},\n  \"style_guide\": {...},\n  \"grooming\": {...},\n  \"action_plan\": [...]\n}\n```\n\n---\n\n## 8. Frontend Components\n\n### 8.1 Component Structure\n\n```\nsrc/components/psl/\n├── PSLScoreCard.tsx          # Main score display with tier badge\n├── PSLBreakdown.tsx          # Visual breakdown (face/height/body pie)\n├── PSLTierBadge.tsx          # Tier icon and name\n├── PSLComparison.tsx         # Current vs Potential\n├── PSLUpgradePrompt.tsx      # Prompt to unlock AI vision\n│\n├── archetype/\n│   ├── ArchetypeCard.tsx     # Primary archetype display\n│   ├── ArchetypeTraits.tsx   # Trait badges\n│   ├── ArchetypeComparison.tsx # Primary vs Secondary\n│   └── ArchetypeTransition.tsx # Path to next archetype\n│\n├── advice/\n│   ├── HairstyleRecommendations.tsx  # Hairstyle cards with images\n│   ├── SkincareRoutine.tsx           # AM/PM routine display\n│   ├── StyleGuide.tsx                # Clothing/color recommendations\n│   ├── GroomingGuide.tsx             # Facial hair, brows, etc.\n│   └── ActionPlan.tsx                # Prioritized improvements\n│\n└── shared/\n    ├── FeatureCard.tsx       # Extracted feature display\n    ├── ScoreBar.tsx          # Horizontal score visualization\n    ├── TierIcon.tsx          # Tier-specific icons\n    └── PaywallOverlay.tsx    # Upgrade prompt overlay\n```\n\n### 8.2 Results Tab Integration\n\n```typescript\n// Add to ResultsLayout.tsx tabs\nconst TABS: TabConfig[] = [\n  { id: 'overview', label: 'Overview', icon: <LayoutDashboard size={18} /> },\n  { id: 'front-ratios', label: 'Front Ratios', icon: <User size={18} /> },\n  { id: 'side-ratios', label: 'Side Ratios', icon: <ScanFace size={18} /> },\n  { id: 'leaderboard', label: 'Leaderboard', icon: <Trophy size={18} /> },\n  { id: 'plan', label: 'Your Plan', icon: <Sparkles size={18} /> },\n  // NEW TABS\n  { id: 'psl', label: 'PSL Score', icon: <Gauge size={18} />, paid: false },\n  { id: 'archetype', label: 'Archetype', icon: <Shapes size={18} />, paid: false },\n  { id: 'advice', label: 'AI Advice', icon: <Lightbulb size={18} />, paid: true },\n  // EXISTING\n  { id: 'options', label: 'Options', icon: <Settings size={18} /> },\n  { id: 'support', label: 'Support', icon: <HelpCircle size={18} /> },\n];\n```\n\n### 8.3 Key Component: PSLScoreCard\n\n```tsx\n// PSLScoreCard.tsx\ninterface PSLScoreCardProps {\n  psl: PSLResult;\n  showBreakdown?: boolean;\n  showPotential?: boolean;\n}\n\nexport function PSLScoreCard({ psl, showBreakdown = true, showPotential = true }: PSLScoreCardProps) {\n  return (\n    <div className=\"bg-zinc-900 rounded-xl p-6 border border-zinc-800\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-6\">\n        <h2 className=\"text-xl font-semibold text-white\">PSL Rating</h2>\n        <PSLTierBadge tier={psl.tier} />\n      </div>\n\n      {/* Main Score */}\n      <div className=\"flex items-center gap-6 mb-6\">\n        <div className=\"text-6xl font-bold text-cyan-400\">\n          {psl.score.toFixed(2)}\n        </div>\n        <div className=\"text-zinc-400\">\n          <div className=\"text-lg\">{psl.tier}</div>\n          <div className=\"text-sm\">Top {(100 - psl.percentile).toFixed(1)}%</div>\n        </div>\n      </div>\n\n      {/* Breakdown */}\n      {showBreakdown && (\n        <PSLBreakdown breakdown={psl.breakdown} />\n      )}\n\n      {/* Potential */}\n      {showPotential && psl.potential > psl.score && (\n        <div className=\"mt-4 pt-4 border-t border-zinc-800\">\n          <div className=\"flex items-center justify-between text-sm\">\n            <span className=\"text-zinc-400\">Potential with improvements</span>\n            <span className=\"text-green-400 font-semibold\">\n              {psl.potential.toFixed(2)} (+{(psl.potential - psl.score).toFixed(2)})\n            </span>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n```\n\n### 8.4 Key Component: ArchetypeCard\n\n```tsx\n// ArchetypeCard.tsx\ninterface ArchetypeCardProps {\n  archetype: ArchetypeResult;\n  showSecondary?: boolean;\n  showTransition?: boolean;\n}\n\nexport function ArchetypeCard({ archetype, showSecondary = true, showTransition = true }: ArchetypeCardProps) {\n  return (\n    <div className=\"bg-zinc-900 rounded-xl p-6 border border-zinc-800\">\n      {/* Primary Archetype */}\n      <div className=\"flex items-start gap-4 mb-6\">\n        <div className=\"w-16 h-16 rounded-lg bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center\">\n          <ArchetypeIcon archetype={archetype.primary.subArchetype} />\n        </div>\n        <div>\n          <div className=\"text-sm text-zinc-400 mb-1\">Your Archetype</div>\n          <div className=\"text-2xl font-bold text-white\">\n            {archetype.primary.subArchetype}\n          </div>\n          <div className=\"text-sm text-zinc-500\">\n            {archetype.primary.category} • {(archetype.primary.confidence * 100).toFixed(0)}% match\n          </div>\n        </div>\n      </div>\n\n      {/* Traits */}\n      <div className=\"flex flex-wrap gap-2 mb-6\">\n        {archetype.traits.map(trait => (\n          <span key={trait} className=\"px-3 py-1 rounded-full bg-zinc-800 text-zinc-300 text-sm\">\n            {trait}\n          </span>\n        ))}\n      </div>\n\n      {/* Secondary */}\n      {showSecondary && archetype.secondary && (\n        <div className=\"p-4 rounded-lg bg-zinc-800/50 mb-4\">\n          <div className=\"text-sm text-zinc-400 mb-1\">Secondary Match</div>\n          <div className=\"text-lg text-white\">\n            {archetype.secondary.subArchetype}\n            <span className=\"text-zinc-500 text-sm ml-2\">\n              ({(archetype.secondary.confidence * 100).toFixed(0)}%)\n            </span>\n          </div>\n        </div>\n      )}\n\n      {/* Transition Path */}\n      {showTransition && archetype.transitionPath && (\n        <div className=\"p-4 rounded-lg border border-dashed border-zinc-700\">\n          <div className=\"text-sm text-zinc-400 mb-2\">Transition Potential</div>\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-white\">{archetype.primary.subArchetype}</span>\n            <ArrowRight className=\"text-zinc-600\" size={16} />\n            <span className=\"text-cyan-400\">{archetype.transitionPath.target}</span>\n          </div>\n          <div className=\"text-xs text-zinc-500 mt-2\">\n            Requirements: {archetype.transitionPath.requirements.join(', ')}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n```\n\n---\n\n## 9. Implementation Phases\n\n### Phase 1: PSL Foundation (Week 1)\n**Priority: Critical**\n\n- [ ] Add `height_cm` to users table\n- [ ] Implement height input in onboarding/results\n- [ ] Create `psl-calculator.ts` with formula\n- [ ] Create `PSLScoreCard`, `PSLBreakdown`, `PSLTierBadge` components\n- [ ] Add PSL tab to results page\n- [ ] Create `/psl/calculate` endpoint\n\n### Phase 2: Archetype System (Week 2)\n**Priority: High**\n\n- [ ] Create `archetypes.json` with full taxonomy\n- [ ] Implement `archetype-classifier.ts`\n- [ ] Create `archetype_service.py`\n- [ ] Create `ArchetypeCard`, `ArchetypeTraits` components\n- [ ] Add Archetype tab to results page\n- [ ] Create `/archetype/classify` endpoint\n\n### Phase 3: AI Vision Integration (Week 3)\n**Priority: High - Paid Feature**\n\n- [ ] Set up Claude API integration\n- [ ] Implement `vision_service.py`\n- [ ] Create `vision_extractions` table\n- [ ] Create `/vision/extract` endpoint\n- [ ] Add paywall for AI vision access\n- [ ] Display extracted features in UI\n\n### Phase 4: Advice Engine (Week 4)\n**Priority: High - Paid Feature**\n\n- [ ] Create `hairstyles.json` database\n- [ ] Create `skincare.json` routines\n- [ ] Create `style_guides.json`\n- [ ] Implement `advice_service.py`\n- [ ] Create advice components (`HairstyleRecommendations`, `SkincareRoutine`, etc.)\n- [ ] Add Advice tab to results page\n- [ ] Create `/advice/*` endpoints\n\n### Phase 5: Action Plan (Week 5)\n**Priority: Medium**\n\n- [ ] Implement action plan generation logic\n- [ ] Create `ActionPlan` component\n- [ ] Integrate with existing recommendations\n- [ ] Add cost/timeline estimates\n- [ ] Link flaws to specific actions\n\n### Phase 6: Polish & Integration (Week 6)\n**Priority: Medium**\n\n- [ ] End-to-end testing\n- [ ] Performance optimization\n- [ ] Caching for AI calls\n- [ ] Error handling\n- [ ] Mobile responsiveness\n- [ ] Analytics integration\n\n---\n\n## 10. Cost & Pricing\n\n### 10.1 API Costs\n\n| Service | Cost per Call | Usage |\n|---------|--------------|-------|\n| Claude Vision (face) | ~$0.01-0.02 | Per face extraction |\n| Claude Vision (body) | ~$0.01 | Per body extraction |\n| Total per user | ~$0.02-0.03 | One-time per analysis |\n\n### 10.2 Suggested Pricing Tiers\n\n| Feature | Free | Pro ($X/mo) | Premium ($Y/mo) |\n|---------|------|-------------|-----------------|\n| Landmark Analysis | ✓ | ✓ | ✓ |\n| Basic PSL (face + height) | ✓ | ✓ | ✓ |\n| Archetype (rule-based) | ✓ | ✓ | ✓ |\n| AI Vision Extraction | ✗ | ✓ | ✓ |\n| Enhanced PSL (with body) | ✗ | ✓ | ✓ |\n| Hairstyle Recommendations | ✗ | ✓ | ✓ |\n| Skincare Routine | ✗ | ✓ | ✓ |\n| Style Guide | ✗ | ✓ | ✓ |\n| Action Plan | ✗ | ✓ | ✓ |\n| Unlimited Re-analyses | ✗ | ✗ | ✓ |\n\n### 10.3 Margin Analysis\n\n- Cost per paid user: ~$0.03 (one-time AI call)\n- If user pays $5/month: 99%+ margin\n- If user pays $20 one-time: 99%+ margin\n- AI costs are negligible relative to value provided\n\n---\n\n## Appendix A: Halos & Failos Reference\n\n### Halos (Positive Features)\n\n| Halo | Detection Method | Impact |\n|------|------------------|--------|\n| Hunter Eyes | Landmarks (canthal tilt, deep-set) | High |\n| Hollow Cheeks | Vision AI | High |\n| Strong Jawline | Landmarks (gonial angle, bigonial) | High |\n| Clear Skin | Vision AI | High |\n| NW0-1 Hairline | Vision AI | Medium |\n| White Teeth | Vision AI | Medium |\n| Compact Midface | Landmarks | High |\n| Dense Eyebrows | Vision AI | Low |\n| Golden/Tanned Skin | Vision AI | Low |\n\n### Failos (Negative Features)\n\n| Failo | Detection Method | Severity |\n|-------|------------------|----------|\n| Negative Canthal Tilt | Landmarks | Major |\n| Receding Chin | Landmarks | Major |\n| Long Philtrum | Landmarks | Moderate |\n| Severe Acne/Scarring | Vision AI | Major |\n| Asymmetry | Landmarks | Moderate-Major |\n| NW3+ Hairline | Vision AI | Moderate |\n| Scleral Show | Landmarks | Moderate |\n| Thin Neck | Landmarks/Vision | Minor |\n| Mouth Breathing Signs | Landmarks | Major |\n| Narrow Palate | Landmarks | Moderate |\n\n---\n\n## Appendix B: Celebrity Calibration\n\nUse these known ratings for algorithm validation:\n\n| Celebrity | Expected PSL | Archetype | Key Features |\n|-----------|--------------|-----------|--------------|\n| Francisco Lachowski | 9.0+ | Prettyboy | Perfect harmony, no failos |\n| Henry Cavill | 8.5-9.0 | Superman Chad | Strong jaw, dimorphism |\n| Ian Somerhalder | 8.0-8.5 | Vampire Chad | Hunter eyes, hollow cheeks |\n| Zac Efron (prime) | 8.0-8.5 | Jock Chad | Athletic, symmetrical |\n| Timothée Chalamet | 7.5-8.0 | Softboy | Harmony, low dimorphism |\n| Josh Hutcherson | 5.5-6.0 | HTN | Average height limits ceiling |\n| Average man | 5.0 | MTN | By definition |\n\n---\n\n## Appendix C: File Paths Summary\n\n### Backend (looksmaxx-api)\n\n```\napp/\n├── services/\n│   ├── psl_service.py           # NEW\n│   ├── vision_service.py        # NEW\n│   ├── archetype_service.py     # NEW\n│   └── advice_service.py        # NEW\n├── routers/\n│   ├── psl.py                   # NEW\n│   ├── vision.py                # NEW\n│   └── advice.py                # NEW\n├── models/\n│   ├── vision_extraction.py     # NEW\n│   ├── psl_score.py             # NEW\n│   ├── archetype_result.py      # NEW\n│   └── advice_result.py         # NEW\n└── data/\n    ├── archetypes.json          # NEW\n    ├── hairstyles.json          # NEW\n    ├── skincare.json            # NEW\n    └── style_guides.json        # NEW\n```\n\n### Frontend (looksmaxx-app)\n\n```\nsrc/\n├── components/\n│   └── psl/                     # NEW (entire folder)\n├── contexts/\n│   └── PSLContext.tsx           # NEW\n├── lib/\n│   ├── psl-calculator.ts        # NEW\n│   └── archetype-classifier.ts  # NEW\n└── types/\n    └── psl.ts                   # NEW\n```\n\n---\n\n*Document Version: 1.0*\n*Last Updated: 2025-01-XX*\n*Author: LOOKSMAXX Team*\n","numLines":1814,"startLine":1,"totalLines":1814}}}
{"parentUuid":"b6608bf0-1e7b-472a-8ab4-6bed5c58d991","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"9ef504ee-e86a-4062-a25e-b90107ea7ce2","version":"2.0.76","gitBranch":"main","agentId":"a30078d","slug":"shiny-wondering-bentley","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01PW2B9vxpdddjqMnP9hGXDk","type":"message","role":"assistant","content":[{"type":"text","text":"Excellent! I've analyzed the complete PSL specification document. Let me provide you with a comprehensive summary of the system and how all components integrate together.\n\n## COMPREHENSIVE PSL SYSTEM ANALYSIS\n\n### 1. PSL SCORING FORMULA\n\nThe PSL (Pretty Scale Level) uses a weighted formula across three physical dimensions:\n\n```\nPSL_Score = (Face × 0.75) + (Height × 0.20) + (Body × 0.05) + Bonuses - Penalties\n```\n\n**Component Breakdown:**\n- **Face** (75%): Harmony score from 70+ facial metrics (0-10 scale)\n- **Height** (20%): Rating from lookup tables (gender-specific, 1.0-9.5 range)\n- **Body** (5%): Optional body fat % + muscle level analysis (defaults to 5.0 if unavailable)\n\n**Height Ratings** (Gender-Specific):\n- Male: 5'3\" (160cm) = 2.0 → 6'5\"+ (196cm) = 9.5\n- Female: 4'11\" (150cm) = 2.0 → 6'0\"+ (183cm) = 9.0 (capped)\n\n**Body Rating Scale** (Body Fat %):\n- 25%+: 2.0-3.0 (overweight)\n- 12-15%: 7.0-7.5 (athletic)\n- 8-10%: 9.0-9.5 (elite)\n- <8%: 9.5+ (IFBB Pro)\n\n### 2. BONUS SYSTEM\n\n**Threshold Bonuses** (when individual category ≥ 8.5):\n- Face ≥ 8.5: +0.30\n- Height ≥ 8.5: +0.20\n- Body ≥ 8.5: +0.10\n\n**Synergy Bonuses** (multiple high categories):\n- Face + Height ≥ 8.5: +0.15\n- Face + Body ≥ 8.5: +0.10\n- Height + Body ≥ 8.5: +0.05\n- All three ≥ 8.5: +0.35 (flat, replaces pairs)\n\n**Constraints/Penalties**:\n- Major facial failo: Caps tier ceiling\n- Body < 5.0: -0.3 to face perception\n- Height < 8.0: Cannot reach Gigachad\n- Severe asymmetry: -0.5 penalty\n\n### 3. TIER CLASSIFICATION SYSTEM (10 TIERS)\n\n| Tier | Score Range | Percentile | Description |\n|------|-------------|------------|-------------|\n| Deformity | 0.0-1.0 | Bottom 0.01% | Medical intervention territory |\n| Subhuman | 1.25-1.75 | Bottom 0.1% | Genetic outlier |\n| Incel | 2.0-3.0 | Bottom 2.5% | Visibly below average |\n| LTN | 3.5-4.5 | Bottom 13.59% | Low Tier Normie |\n| MTN | 4.75-5.25 | Middle 68% | Mid Tier Normie (average) |\n| HTN | 5.5-6.5 | Top 13.59% | High Tier Normie |\n| Chadlite | 7.0-8.0 | Top 2.5% | Local star level |\n| Chad | 8.25-8.75 | Top 0.1% | Very attractive, elite |\n| Gigachad | 9.0-9.5 | Top 0.01% | Mythical tier |\n| True Mogger | 9.5+ | Apex | Theoretical limit |\n\n### 4. ARCHETYPE CLASSIFICATION SYSTEM\n\n**6 Main Categories with Multiple Sub-Archetypes:**\n\n**A. SOFTBOY** (Low Dimorphism, Ectomorphic)\n- K-Pop Idol: East/SE Asian, flat midface, clear skin\n- Softboy: Youthful, delicate, slim\n- Academic: Intellectual, refined, understated\n\n**B. PRETTYBOY** (Balanced Dimorphism)\n- Skater: Casual cool, athletic lean\n- Prettyboy: Symmetrical, harmonious\n- Surfer: Sun-kissed, athletic, carefree\n\n**C. ROBUST PRETTYBOY** (Pretty + Edge/Intensity)\n- Fallen Angel: Ethereal, intense, mysterious\n- Prince: Regal, refined, elegant\n- Bad Boy: Rebellious, smoldering\n- Artist: Creative, unconventional\n\n**D. CHAD** (High Dimorphism, Strong Features)\n- Vampire: Sharp, pale, hollow cheeks\n- Superman: Heroic, strong jaw, broad\n- Jock: Athletic, confident\n- Casanova: Charming, seductive, smooth\n- Executive: Powerful, authoritative\n- Pharaoh: Exotic, regal, chiseled\n\n**E. HYPERMASCULINE** (Extreme Masculine Features)\n- Aquaman: Tall, muscular, long hair\n- Hypermasculine: Extreme bone structure\n- Outlaw: Rough, weathered, dangerous\n- Countryman: Rugged, outdoorsy\n\n**F. OGRE** (Maximum Size/Mass)\n- Viking: Massive, bearded, warrior\n- Bodybuilder: Extreme muscle, imposing\n\n**Classification Inputs (Weighted):**\n- Gonial angle (jaw width): High weight\n- FWHR (facial width/height ratio): High weight\n- Dimorphism level (6 categories): High weight\n- Brow ridge prominence: Medium weight\n- Body type (5 classifications): Medium weight\n- Ethnicity: Medium weight\n- Hollow cheeks, skin tone: Low weight\n\n**Dimorphism Classification:**\n- Low: ≥130° gonial, minimal brow → neotenous\n- Low-Balanced: 125-130° → balanced, softer\n- Balanced: 118-125° → neither masculine nor feminine\n- Above-Average: 115-120° → leaning masculine\n- High: 110-118° → strongly masculine\n- Very High: <110° → hypermasculine\n\n### 5. AI VISION FEATURE EXTRACTION (PAID)\n\n**Face Analysis (15+ Features):**\n- Skin clarity (0-10), tone, acne level, scarring, pore visibility\n- Hair: Norwood scale (0-7), density, texture, color\n- Eyes: Color, under-eye darkness (0-10), puffiness (0-10)\n- Hollow cheeks (0-10), eyebrow density, facial hair potential\n- Teeth: Color, alignment\n\n**Physique Photo Analysis (6 Features):**\n- Body fat % (5-40%), muscle mass (5 levels)\n- Frame size, shoulder width, waist definition\n- Posture assessment\n\n**Implementation:**\n- Uses Claude Vision API (model: claude-sonnet-4-20250514)\n- Returns structured JSON with categorical and numeric values\n- Cached per analysis ID in `vision_extractions` table\n- Caching strategy: Permanent until analysis deleted\n\n### 6. ADVICE GENERATION ENGINE (5 Components)\n\n**A. Hairstyle Recommendations**\n- Face shape detection (6 shapes: oval, round, square, oblong, heart, diamond)\n- Filtered by: face shape, hairline NW level, hair texture, archetype\n- Database: `hairstyles.json` with 800+ entries (example shows 3+)\n- Output: 3-5 personalized recommendations with reference images\n\n**B. Skincare Routine**\n- AM/PM routines customized by skin analysis\n- Targeted treatments for: acne, scarring, dark circles, pore size\n- Weekly deep treatments based on skin type\n- Product recommendations with ingredients and usage notes\n\n**C. Style Guide**\n- Archetype-matched clothing recommendations\n- Color palette customized by skin tone\n- Accessory suggestions\n- Grooming guidance (facial hair, eyebrows)\n- Celebrity references and inspiration images\n\n**D. Grooming Guide**\n- Facial hair recommendations (based on archetype + potential)\n- Eyebrow grooming instructions\n- Hair styling tips\n\n**E. Action Plan (3 Tiers)**\n- **Foundation** (1-3 months): Softmaxxing (haircut, skincare, style)\n- **Enhancement** (3-6 months): Flaws → specific treatments\n- **Advanced** (6-12 months): Surgical/major interventions\n\nEach action includes:\n- Priority ranking, category, specific action\n- Impact level (high/medium/low), difficulty, timeframe\n- Cost range with frequency\n- Linked flaw ID for traceability\n\n### 7. DATABASE SCHEMA (4 New Tables)\n\n**vision_extractions:**\n- Stores all 23 AI-extracted features per analysis\n- Unique per analysis_id\n- Raw response saved for debugging\n- TTL: Permanent\n\n**psl_scores:**\n- Component scores (face, height, body)\n- Thresholds and synergy bonuses\n- Final score, tier, percentile\n- Potential score estimate\n- Unique per analysis_id\n\n**archetype_results:**\n- Primary + secondary archetype (category + sub-type)\n- Confidence scores (0-1 range)\n- Traits array, style guide JSONB\n- Transition path (target archetype + requirements)\n\n**advice_results:**\n- Hairstyle recommendations (JSONB array)\n- Skincare routine (JSONB with AM/PM/weekly)\n- Style guide (JSONB with clothing, colors, accessories)\n- Grooming guide (JSONB)\n- Action plan (JSONB array of 3 tiers)\n- User preferences used (budget, timeline, goals)\n\n### 8. API ENDPOINTS (13 Total)\n\n**PSL Endpoints (3):**\n- `POST /psl/calculate` - Free tier (face + height)\n- `POST /psl/calculate-full` - Paid (with AI vision + body)\n- `GET /psl/{analysis_id}` - Retrieve stored score\n\n**Vision Endpoints (3) - Paid:**\n- `POST /vision/extract` - Face feature extraction\n- `POST /vision/extract-body` - Physique analysis\n- `GET /vision/{analysis_id}` - Retrieve cached results\n\n**Archetype Endpoints (3):**\n- `POST /archetype/classify` - Classification (enhanced with vision if paid)\n- `GET /archetype/{analysis_id}` - Retrieve results\n- `GET /archetype/styles` - All style guides (public)\n\n**Advice Endpoints (4) - Paid:**\n- `POST /advice/generate` - Full package generation\n- `GET /advice/hairstyles` - Specific recommendations\n- `GET /advice/skincare` - Routine only\n- `GET /advice/style` - Style guide only\n\n### 9. FRONTEND COMPONENTS (13 Components)\n\n**PSL Components:**\n- `PSLScoreCard.tsx` - Main score display with tier badge\n- `PSLBreakdown.tsx` - Pie chart visualization (face/height/body)\n- `PSLTierBadge.tsx` - Tier icon and name\n- `PSLComparison.tsx` - Current vs potential score\n\n**Archetype Components:**\n- `ArchetypeCard.tsx` - Primary archetype display\n- `ArchetypeTraits.tsx` - Trait badges\n- `ArchetypeComparison.tsx` - Primary vs secondary\n- `ArchetypeTransition.tsx` - Path to next archetype\n\n**Advice Components:**\n- `HairstyleRecommendations.tsx` - Cards with reference images\n- `SkincareRoutine.tsx` - AM/PM/weekly display\n- `StyleGuide.tsx` - Clothing/color recommendations\n- `GroomingGuide.tsx` - Facial hair, brows\n- `ActionPlan.tsx` - Prioritized 3-tier improvements\n\n**Shared Components:**\n- `FeatureCard.tsx` - AI feature display\n- `ScoreBar.tsx` - Horizontal score visualization\n- `TierIcon.tsx` - Tier-specific icons\n- `PaywallOverlay.tsx` - Upgrade prompt for paid features\n\n**Results Tab Integration:**\n- New tabs added to existing ResultsLayout:\n  - \"PSL Score\" (free)\n  - \"Archetype\" (free)\n  - \"AI Advice\" (paid, locked unless subscribed)\n\n### 10. SYSTEM INTEGRATION FLOW\n\n```\nUSER ANALYSIS\n    ↓\n[STAGE 1] Landmarks (Existing)\n  └─→ 70+ facial metrics → Face Score\n    ↓\n[STAGE 2] AI Vision (Paid)\n  └─→ Claude Vision API → 23 extracted features\n    ↓\n[STAGE 3] PSL Calculation\n  ├─→ Face × 0.75\n  ├─→ Height × 0.20 (manual input)\n  ├─→ Body × 0.05 (from vision or default 5.0)\n  ├─→ Apply bonuses/constraints\n  └─→ Classify into tier (0-10, Deformity to True Mogger)\n    ↓\n[STAGE 4] Archetype Classification\n  ├─→ Score all 6 categories (gonial, FWHR, dimorphism, etc.)\n  ├─→ Rank to get primary + secondary\n  ├─→ Determine sub-archetype within primary\n  └─→ Generate transition path to next archetype\n    ↓\n[STAGE 5] Advice Generation (Paid)\n  ├─→ Hairstyle recs (based on face shape + hairline + archetype)\n  ├─→ Skincare routine (based on skin analysis)\n  ├─→ Style guide (based on archetype + skin tone)\n  ├─→ Grooming guide (facial hair, brows)\n  └─→ Action plan (3 tiers, prioritized by impact)\n    ↓\nOUTPUT TO USER\n  ├─→ PSL Score Card (6.75 HTN, top 13.59%)\n  ├─→ Score Breakdown (face/height/body weighted)\n  ├─→ Potential Score (+0.50 to +1.50 with improvements)\n  ├─→ Archetype Card (Prettyboy, 92% confidence)\n  ├─→ Secondary Archetype (Skater, 78%)\n  ├─→ 5 Hairstyle Recommendations\n  ├─→ AM/PM Skincare Routine\n  ├─→ Color Palette + Clothing Essentials\n  └─→ Prioritized Action Plan (3 tiers)\n```\n\n### 11. HALOS & FAILOS REFERENCE\n\n**Top Halos** (Positive Impact):\n- Hunter eyes (landmarks)\n- Hollow cheeks (vision)\n- Strong jawline (landmarks)\n- Clear skin (vision)\n- NW0-1 hairline (vision)\n- Compact midface (landmarks)\n\n**Major Failos** (Negative, Hard Cap):\n- Negative canthal tilt (landmarks)\n- Receding chin (landmarks)\n- Severe acne/scarring (vision)\n- Mouth breathing signs (landmarks)\n- NW3+ hairline (vision)\n\n### 12. IMPLEMENTATION PHASES (6 Weeks)\n\n**Week 1:** PSL foundation (formula, calculator, UI)\n**Week 2:** Archetype system (taxonomy, classifier, display)\n**Week 3:** AI Vision (Claude integration, paywall)\n**Week 4:** Advice engine (hairstyles, skincare, style)\n**Week 5:** Action plans (prioritization, cost/timeline)\n**Week 6:** Polish, testing, optimization\n\n### 13. PRICING & MARGINS\n\n**Cost Structure:**\n- Claude Vision API: ~$0.02-0.03 per user (one-time)\n- 99%+ margin on $5-20/month subscription\n\n**Suggested Tiers:**\n- **Free:** Landmarks, basic PSL, rule-based archetype\n- **Pro:** All above + AI vision, enhanced PSL, hairstyles, skincare, style\n- **Premium:** All + unlimited re-analyses\n\n---\n\n## KEY INSIGHTS\n\n1. **Weighted Multi-Dimensional:** PSL combines three independent rating systems with face as the dominant factor (75%). This creates a realistic ranking where jaw/eyes matter most but height/body provide significant multipliers.\n\n2. **Bonus Cascading:** Synergy bonuses are strategically capped (max 0.85 total) to prevent scoring inflation while rewarding well-rounded individuals. The triple synergy (+0.35) is a significant jump threshold.\n\n3. **Archetype Taxonomy:** 27 distinct sub-archetypes across 6 categories creates nuanced personality classifications beyond just \"attractive.\" This enables highly specific style guidance.\n\n4. **AI-Vision Dependency:** The entire advice system (hairstyles, skincare, style) depends on paid AI vision extraction. Free users get archetype/PSL but not personalized advice—strong monetization lever.\n\n5. **Fail-Safe Constraints:** Hard constraints (major failos capping tiers, height limits on Gigachad) prevent unrealistic scores for users with significant deformities, maintaining credibility.\n\n6. **Database Optimization:** Four separate tables for vision/PSL/archetype/advice allow independent caching and retrieval without N+1 queries.\n\n7. **Action Plan Monetization:** Three-tier action plans (foundation/enhancement/advanced) guide users through increasingly expensive treatments, creating natural upsell opportunities.\n\nThis is a sophisticated, well-engineered system that balances scientific rigor with entertainment value and strong business logic."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":26570,"cache_read_input_tokens":14939,"cache_creation":{"ephemeral_5m_input_tokens":26570,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWUG5sc8mMJNhbBh7FHad","type":"assistant","uuid":"50da8cb0-66c1-40c1-bd14-1ee49705db5c","timestamp":"2025-12-25T23:19:50.368Z"}
