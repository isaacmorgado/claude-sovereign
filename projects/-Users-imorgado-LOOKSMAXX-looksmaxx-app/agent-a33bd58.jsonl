{"parentUuid":null,"isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e7ba8ff7-ea0c-41d6-9623-9ec03de27b58","version":"2.0.70","gitBranch":"main","agentId":"a33bd58","type":"user","message":{"role":"user","content":"Investigate mediapipeDetection.ts for:\n1. Landmark index mappings (which indices map to which facial features)\n2. How landmarks are extracted and which ones are used\n3. The coordinate system and normalization\n4. Any feature-specific landmark groupings (eyes, nose, etc.)\n\nKey file: src/lib/mediapipeDetection.ts"},"uuid":"6a0fe439-52a5-4655-a34c-e62152873afa","timestamp":"2025-12-19T05:50:20.059Z"}
{"parentUuid":"6a0fe439-52a5-4655-a34c-e62152873afa","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e7ba8ff7-ea0c-41d6-9623-9ec03de27b58","version":"2.0.70","gitBranch":"main","agentId":"a33bd58","slug":"delegated-brewing-liskov","message":{"model":"claude-haiku-4-5-20251001","id":"msg_015qLWFB9PHCWChRPRvBSwHr","type":"message","role":"assistant","content":[{"type":"text","text":"I'll investigate the mediapipeDetection.ts file to understand the landmark index mappings, extraction process, coordinate system, and feature groupings."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":12131,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":12131,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWFXFjJnXy2GDiiSCcUk9","type":"assistant","uuid":"80a76cf2-a3ef-4a01-be7d-28e2be43bee0","timestamp":"2025-12-19T05:50:22.098Z"}
{"parentUuid":"80a76cf2-a3ef-4a01-be7d-28e2be43bee0","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e7ba8ff7-ea0c-41d6-9623-9ec03de27b58","version":"2.0.70","gitBranch":"main","agentId":"a33bd58","slug":"delegated-brewing-liskov","message":{"model":"claude-haiku-4-5-20251001","id":"msg_015qLWFB9PHCWChRPRvBSwHr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01838NEUEVAEWNx8biJkM8D8","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/mediapipeDetection.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":12131,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":12131,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWFXFjJnXy2GDiiSCcUk9","type":"assistant","uuid":"35c6e6a2-2f98-491b-b0c2-74e84cea2f8b","timestamp":"2025-12-19T05:50:22.351Z"}
{"parentUuid":"35c6e6a2-2f98-491b-b0c2-74e84cea2f8b","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e7ba8ff7-ea0c-41d6-9623-9ec03de27b58","version":"2.0.70","gitBranch":"main","agentId":"a33bd58","slug":"delegated-brewing-liskov","message":{"model":"claude-haiku-4-5-20251001","id":"msg_015qLWFB9PHCWChRPRvBSwHr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016oGc9UdX4GFViBWanQ4N9Y","name":"Glob","input":{"pattern":"src/lib/**/*.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":12131,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":12131,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWFXFjJnXy2GDiiSCcUk9","type":"assistant","uuid":"ed83daed-6705-4801-a061-106bf1cfe3fc","timestamp":"2025-12-19T05:50:22.511Z"}
{"parentUuid":"ed83daed-6705-4801-a061-106bf1cfe3fc","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e7ba8ff7-ea0c-41d6-9623-9ec03de27b58","version":"2.0.70","gitBranch":"main","agentId":"a33bd58","slug":"delegated-brewing-liskov","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01838NEUEVAEWNx8biJkM8D8","type":"tool_result","content":"     1→/**\n     2→ * Face Landmark Detection using MediaPipe Tasks Vision\n     3→ * Maps detected landmarks to our custom facial landmarks\n     4→ *\n     5→ * Uses the shared singleton service for optimal performance\n     6→ */\n     7→\n     8→import { faceDetectionService } from './faceDetectionService';\n     9→\n    10→// MediaPipe Face Mesh landmark indices (478 landmarks total)\n    11→// Reference: https://github.com/google/mediapipe/blob/master/mediapipe/modules/face_geometry/data/canonical_face_model_uv_visualization.png\n    12→\n    13→// Front profile landmark mapping\n    14→export const MEDIAPIPE_FRONT_MAPPING: Record<string, number> = {\n    15→  // Head\n    16→  trichion: 10,\n    17→\n    18→  // Left Eye\n    19→  left_pupila: 468,\n    20→  left_canthus_medialis: 133,\n    21→  left_canthus_lateralis: 33,\n    22→  left_palpebra_superior: 159,\n    23→  left_palpebra_inferior: 145,\n    24→  left_sulcus_palpebralis_lateralis: 130,\n    25→  left_pretarsal_skin_crease: 247,\n    26→\n    27→  // Right Eye\n    28→  right_pupila: 473,\n    29→  right_canthus_medialis: 362,\n    30→  right_canthus_lateralis: 263,\n    31→  right_palpebra_superior: 386,\n    32→  right_palpebra_inferior: 374,\n    33→  right_sulcus_palpebralis_lateralis: 359,\n    34→  right_pretarsal_skin_crease: 467,\n    35→\n    36→  // Left Brow\n    37→  left_supercilium_medialis: 107,\n    38→  left_supercilium_medial_corner: 66,\n    39→  left_supercilium_superior: 105,\n    40→  left_supercilium_apex: 70,\n    41→  left_supercilium_lateralis: 46,\n    42→\n    43→  // Right Brow\n    44→  right_supercilium_medialis: 336,\n    45→  right_supercilium_medial_corner: 296,\n    46→  right_supercilium_superior: 334,\n    47→  right_supercilium_apex: 300,\n    48→  right_supercilium_lateralis: 276,\n    49→\n    50→  // Nose\n    51→  nasal_base: 6,\n    52→  left_dorsum_nasi: 198,\n    53→  right_dorsum_nasi: 420,\n    54→  left_ala_nasi: 129,\n    55→  right_ala_nasi: 358,\n    56→  subnasale: 2,\n    57→\n    58→  // Mouth\n    59→  labrale_superius: 0,\n    60→  cupids_bow: 13,\n    61→  mouth_middle: 14,\n    62→  labrale_inferius: 17,\n    63→  left_cheilion: 61,\n    64→  right_cheilion: 291,\n    65→\n    66→  // Jaw\n    67→  left_gonion_superior: 116,\n    68→  right_gonion_superior: 345,\n    69→  left_gonion_inferior: 172,\n    70→  right_gonion_inferior: 397,\n    71→\n    72→  // Chin\n    73→  left_mentum_lateralis: 135,\n    74→  right_mentum_lateralis: 364,\n    75→  menton: 152,\n    76→\n    77→  // Cheeks\n    78→  left_zygion: 234,\n    79→  right_zygion: 454,\n    80→  left_temporal: 127,\n    81→  right_temporal: 356,\n    82→\n    83→  // Ears (approximate)\n    84→  left_auricular_lateral: 234,\n    85→  right_auricular_lateral: 454,\n    86→\n    87→  // Neck (use chin as reference)\n    88→  left_cervical_lateralis: 172,\n    89→  right_cervical_lateralis: 397,\n    90→};\n    91→\n    92→// Side profile landmark mapping\n    93→export const MEDIAPIPE_SIDE_MAPPING: Record<string, number> = {\n    94→  vertex: 10,\n    95→  external_occipital_region: 10,\n    96→  trichion_profile: 10,\n    97→  frontalis: 151,\n    98→  glabella: 9,\n    99→  corneal_apex: 468,\n   100→  lateral_eyelid: 33,\n   101→  lower_eyelid_profile: 145,\n   102→  zygoma_lateralis: 234,\n   103→  nasion: 6,\n   104→  rhinion: 4,\n   105→  supratip: 4,\n   106→  pronasale: 1,\n   107→  infratip: 2,\n   108→  columella: 2,\n   109→  subnasale_profile: 2,\n   110→  subalare: 129,\n   111→  labrale_superius_profile: 0,\n   112→  labrale_inferius_profile: 17,\n   113→  cheilion_profile: 61,\n   114→  sublabiale: 18,\n   115→  orbitale: 145,\n   116→  gonion_superior_profile: 116,\n   117→  gonion_inferior_profile: 172,\n   118→  pogonion: 152,\n   119→  menton_profile: 152,\n   120→  porion: 127,\n   121→  tragus: 127,\n   122→  intertragic_notch: 127,\n   123→  cervical_point: 152,\n   124→  neckpoint: 152,\n   125→};\n   126→\n   127→export interface DetectedLandmarks {\n   128→  landmarks: Array<{ id: string; x: number; y: number }>;\n   129→  confidence: number;\n   130→  faceBox: { x: number; y: number; width: number; height: number };\n   131→}\n   132→\n   133→/**\n   134→ * Detect facial landmarks from an image URL\n   135→ * Uses the singleton FaceDetectionService for optimal performance\n   136→ */\n   137→export async function detectFromImageUrl(\n   138→  imageUrl: string,\n   139→  mode: 'front' | 'side'\n   140→): Promise<DetectedLandmarks | null> {\n   141→  try {\n   142→    // Load the image\n   143→    const img = await loadImage(imageUrl);\n   144→\n   145→    // Use the singleton service\n   146→    const result = await faceDetectionService.detect(img);\n   147→\n   148→    if (!result.faceLandmarks || result.faceLandmarks.length === 0) {\n   149→      console.log('No faces detected');\n   150→      return null;\n   151→    }\n   152→\n   153→    const faceLandmarks = result.faceLandmarks[0];\n   154→\n   155→    // Select mapping based on mode\n   156→    const mapping = mode === 'front' ? MEDIAPIPE_FRONT_MAPPING : MEDIAPIPE_SIDE_MAPPING;\n   157→\n   158→    // Map keypoints to our landmarks\n   159→    const landmarks = Object.entries(mapping).map(([id, index]) => {\n   160→      // Handle index bounds\n   161→      const safeIndex = Math.min(index, faceLandmarks.length - 1);\n   162→      const landmark = faceLandmarks[safeIndex];\n   163→\n   164→      return {\n   165→        id,\n   166→        // MediaPipe returns normalized coordinates (0-1)\n   167→        x: landmark ? landmark.x : 0.5,\n   168→        y: landmark ? landmark.y : 0.5,\n   169→      };\n   170→    });\n   171→\n   172→    // Calculate face bounding box from all landmarks\n   173→    let minX = 1, minY = 1, maxX = 0, maxY = 0;\n   174→    faceLandmarks.forEach((lm) => {\n   175→      minX = Math.min(minX, lm.x);\n   176→      minY = Math.min(minY, lm.y);\n   177→      maxX = Math.max(maxX, lm.x);\n   178→      maxY = Math.max(maxY, lm.y);\n   179→    });\n   180→\n   181→    return {\n   182→      landmarks,\n   183→      confidence: 0.95, // MediaPipe doesn't return confidence per landmark\n   184→      faceBox: {\n   185→        x: minX,\n   186→        y: minY,\n   187→        width: maxX - minX,\n   188→        height: maxY - minY,\n   189→      },\n   190→    };\n   191→  } catch (error) {\n   192→    console.error('Face detection error:', error);\n   193→    return null;\n   194→  }\n   195→}\n   196→\n   197→/**\n   198→ * Load an image from URL\n   199→ */\n   200→function loadImage(url: string): Promise<HTMLImageElement> {\n   201→  return new Promise((resolve, reject) => {\n   202→    const img = new Image();\n   203→    img.crossOrigin = 'anonymous';\n   204→    img.onload = () => resolve(img);\n   205→    img.onerror = (e) => reject(e);\n   206→    img.src = url;\n   207→  });\n   208→}\n   209→\n   210→/**\n   211→ * Get the region to zoom into for a specific landmark\n   212→ */\n   213→export function getLandmarkZoomRegion(\n   214→  landmarkId: string\n   215→): { centerX: number; centerY: number; zoomLevel: number } {\n   216→  const regions: Record<string, { centerX: number; centerY: number; zoomLevel: number }> = {\n   217→    // Eyes - zoom in close\n   218→    left_pupila: { centerX: 0.35, centerY: 0.35, zoomLevel: 3 },\n   219→    left_canthus_medialis: { centerX: 0.4, centerY: 0.35, zoomLevel: 3 },\n   220→    left_canthus_lateralis: { centerX: 0.3, centerY: 0.35, zoomLevel: 3 },\n   221→    right_pupila: { centerX: 0.65, centerY: 0.35, zoomLevel: 3 },\n   222→    right_canthus_medialis: { centerX: 0.6, centerY: 0.35, zoomLevel: 3 },\n   223→    right_canthus_lateralis: { centerX: 0.7, centerY: 0.35, zoomLevel: 3 },\n   224→\n   225→    // Brows\n   226→    left_supercilium_apex: { centerX: 0.35, centerY: 0.28, zoomLevel: 2.5 },\n   227→    right_supercilium_apex: { centerX: 0.65, centerY: 0.28, zoomLevel: 2.5 },\n   228→\n   229→    // Nose\n   230→    nasal_base: { centerX: 0.5, centerY: 0.4, zoomLevel: 2 },\n   231→    subnasale: { centerX: 0.5, centerY: 0.55, zoomLevel: 2.5 },\n   232→\n   233→    // Mouth\n   234→    labrale_superius: { centerX: 0.5, centerY: 0.6, zoomLevel: 2.5 },\n   235→    mouth_middle: { centerX: 0.5, centerY: 0.65, zoomLevel: 2 },\n   236→\n   237→    // Chin\n   238→    menton: { centerX: 0.5, centerY: 0.85, zoomLevel: 2 },\n   239→\n   240→    // Default for other landmarks\n   241→    default: { centerX: 0.5, centerY: 0.5, zoomLevel: 1.5 },\n   242→  };\n   243→\n   244→  return regions[landmarkId] || regions.default;\n   245→}\n   246→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"7f4a1312-52b1-4e87-b8e4-d3e40bd2fc30","timestamp":"2025-12-19T05:50:22.564Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/mediapipeDetection.ts","content":"/**\n * Face Landmark Detection using MediaPipe Tasks Vision\n * Maps detected landmarks to our custom facial landmarks\n *\n * Uses the shared singleton service for optimal performance\n */\n\nimport { faceDetectionService } from './faceDetectionService';\n\n// MediaPipe Face Mesh landmark indices (478 landmarks total)\n// Reference: https://github.com/google/mediapipe/blob/master/mediapipe/modules/face_geometry/data/canonical_face_model_uv_visualization.png\n\n// Front profile landmark mapping\nexport const MEDIAPIPE_FRONT_MAPPING: Record<string, number> = {\n  // Head\n  trichion: 10,\n\n  // Left Eye\n  left_pupila: 468,\n  left_canthus_medialis: 133,\n  left_canthus_lateralis: 33,\n  left_palpebra_superior: 159,\n  left_palpebra_inferior: 145,\n  left_sulcus_palpebralis_lateralis: 130,\n  left_pretarsal_skin_crease: 247,\n\n  // Right Eye\n  right_pupila: 473,\n  right_canthus_medialis: 362,\n  right_canthus_lateralis: 263,\n  right_palpebra_superior: 386,\n  right_palpebra_inferior: 374,\n  right_sulcus_palpebralis_lateralis: 359,\n  right_pretarsal_skin_crease: 467,\n\n  // Left Brow\n  left_supercilium_medialis: 107,\n  left_supercilium_medial_corner: 66,\n  left_supercilium_superior: 105,\n  left_supercilium_apex: 70,\n  left_supercilium_lateralis: 46,\n\n  // Right Brow\n  right_supercilium_medialis: 336,\n  right_supercilium_medial_corner: 296,\n  right_supercilium_superior: 334,\n  right_supercilium_apex: 300,\n  right_supercilium_lateralis: 276,\n\n  // Nose\n  nasal_base: 6,\n  left_dorsum_nasi: 198,\n  right_dorsum_nasi: 420,\n  left_ala_nasi: 129,\n  right_ala_nasi: 358,\n  subnasale: 2,\n\n  // Mouth\n  labrale_superius: 0,\n  cupids_bow: 13,\n  mouth_middle: 14,\n  labrale_inferius: 17,\n  left_cheilion: 61,\n  right_cheilion: 291,\n\n  // Jaw\n  left_gonion_superior: 116,\n  right_gonion_superior: 345,\n  left_gonion_inferior: 172,\n  right_gonion_inferior: 397,\n\n  // Chin\n  left_mentum_lateralis: 135,\n  right_mentum_lateralis: 364,\n  menton: 152,\n\n  // Cheeks\n  left_zygion: 234,\n  right_zygion: 454,\n  left_temporal: 127,\n  right_temporal: 356,\n\n  // Ears (approximate)\n  left_auricular_lateral: 234,\n  right_auricular_lateral: 454,\n\n  // Neck (use chin as reference)\n  left_cervical_lateralis: 172,\n  right_cervical_lateralis: 397,\n};\n\n// Side profile landmark mapping\nexport const MEDIAPIPE_SIDE_MAPPING: Record<string, number> = {\n  vertex: 10,\n  external_occipital_region: 10,\n  trichion_profile: 10,\n  frontalis: 151,\n  glabella: 9,\n  corneal_apex: 468,\n  lateral_eyelid: 33,\n  lower_eyelid_profile: 145,\n  zygoma_lateralis: 234,\n  nasion: 6,\n  rhinion: 4,\n  supratip: 4,\n  pronasale: 1,\n  infratip: 2,\n  columella: 2,\n  subnasale_profile: 2,\n  subalare: 129,\n  labrale_superius_profile: 0,\n  labrale_inferius_profile: 17,\n  cheilion_profile: 61,\n  sublabiale: 18,\n  orbitale: 145,\n  gonion_superior_profile: 116,\n  gonion_inferior_profile: 172,\n  pogonion: 152,\n  menton_profile: 152,\n  porion: 127,\n  tragus: 127,\n  intertragic_notch: 127,\n  cervical_point: 152,\n  neckpoint: 152,\n};\n\nexport interface DetectedLandmarks {\n  landmarks: Array<{ id: string; x: number; y: number }>;\n  confidence: number;\n  faceBox: { x: number; y: number; width: number; height: number };\n}\n\n/**\n * Detect facial landmarks from an image URL\n * Uses the singleton FaceDetectionService for optimal performance\n */\nexport async function detectFromImageUrl(\n  imageUrl: string,\n  mode: 'front' | 'side'\n): Promise<DetectedLandmarks | null> {\n  try {\n    // Load the image\n    const img = await loadImage(imageUrl);\n\n    // Use the singleton service\n    const result = await faceDetectionService.detect(img);\n\n    if (!result.faceLandmarks || result.faceLandmarks.length === 0) {\n      console.log('No faces detected');\n      return null;\n    }\n\n    const faceLandmarks = result.faceLandmarks[0];\n\n    // Select mapping based on mode\n    const mapping = mode === 'front' ? MEDIAPIPE_FRONT_MAPPING : MEDIAPIPE_SIDE_MAPPING;\n\n    // Map keypoints to our landmarks\n    const landmarks = Object.entries(mapping).map(([id, index]) => {\n      // Handle index bounds\n      const safeIndex = Math.min(index, faceLandmarks.length - 1);\n      const landmark = faceLandmarks[safeIndex];\n\n      return {\n        id,\n        // MediaPipe returns normalized coordinates (0-1)\n        x: landmark ? landmark.x : 0.5,\n        y: landmark ? landmark.y : 0.5,\n      };\n    });\n\n    // Calculate face bounding box from all landmarks\n    let minX = 1, minY = 1, maxX = 0, maxY = 0;\n    faceLandmarks.forEach((lm) => {\n      minX = Math.min(minX, lm.x);\n      minY = Math.min(minY, lm.y);\n      maxX = Math.max(maxX, lm.x);\n      maxY = Math.max(maxY, lm.y);\n    });\n\n    return {\n      landmarks,\n      confidence: 0.95, // MediaPipe doesn't return confidence per landmark\n      faceBox: {\n        x: minX,\n        y: minY,\n        width: maxX - minX,\n        height: maxY - minY,\n      },\n    };\n  } catch (error) {\n    console.error('Face detection error:', error);\n    return null;\n  }\n}\n\n/**\n * Load an image from URL\n */\nfunction loadImage(url: string): Promise<HTMLImageElement> {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.crossOrigin = 'anonymous';\n    img.onload = () => resolve(img);\n    img.onerror = (e) => reject(e);\n    img.src = url;\n  });\n}\n\n/**\n * Get the region to zoom into for a specific landmark\n */\nexport function getLandmarkZoomRegion(\n  landmarkId: string\n): { centerX: number; centerY: number; zoomLevel: number } {\n  const regions: Record<string, { centerX: number; centerY: number; zoomLevel: number }> = {\n    // Eyes - zoom in close\n    left_pupila: { centerX: 0.35, centerY: 0.35, zoomLevel: 3 },\n    left_canthus_medialis: { centerX: 0.4, centerY: 0.35, zoomLevel: 3 },\n    left_canthus_lateralis: { centerX: 0.3, centerY: 0.35, zoomLevel: 3 },\n    right_pupila: { centerX: 0.65, centerY: 0.35, zoomLevel: 3 },\n    right_canthus_medialis: { centerX: 0.6, centerY: 0.35, zoomLevel: 3 },\n    right_canthus_lateralis: { centerX: 0.7, centerY: 0.35, zoomLevel: 3 },\n\n    // Brows\n    left_supercilium_apex: { centerX: 0.35, centerY: 0.28, zoomLevel: 2.5 },\n    right_supercilium_apex: { centerX: 0.65, centerY: 0.28, zoomLevel: 2.5 },\n\n    // Nose\n    nasal_base: { centerX: 0.5, centerY: 0.4, zoomLevel: 2 },\n    subnasale: { centerX: 0.5, centerY: 0.55, zoomLevel: 2.5 },\n\n    // Mouth\n    labrale_superius: { centerX: 0.5, centerY: 0.6, zoomLevel: 2.5 },\n    mouth_middle: { centerX: 0.5, centerY: 0.65, zoomLevel: 2 },\n\n    // Chin\n    menton: { centerX: 0.5, centerY: 0.85, zoomLevel: 2 },\n\n    // Default for other landmarks\n    default: { centerX: 0.5, centerY: 0.5, zoomLevel: 1.5 },\n  };\n\n  return regions[landmarkId] || regions.default;\n}\n","numLines":246,"startLine":1,"totalLines":246}}}
{"parentUuid":"7f4a1312-52b1-4e87-b8e4-d3e40bd2fc30","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e7ba8ff7-ea0c-41d6-9623-9ec03de27b58","version":"2.0.70","gitBranch":"main","agentId":"a33bd58","slug":"delegated-brewing-liskov","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016oGc9UdX4GFViBWanQ4N9Y","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarkImages.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceDetectionService.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/mediapipeDetection.ts"}]},"uuid":"ffe8bb98-e6ec-4d55-8e7e-346e1c2ad62c","timestamp":"2025-12-19T05:50:23.030Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarkImages.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceDetectionService.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/mediapipeDetection.ts"],"durationMs":471,"numFiles":5,"truncated":false}}
{"parentUuid":"ffe8bb98-e6ec-4d55-8e7e-346e1c2ad62c","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e7ba8ff7-ea0c-41d6-9623-9ec03de27b58","version":"2.0.70","gitBranch":"main","agentId":"a33bd58","slug":"delegated-brewing-liskov","message":{"model":"claude-haiku-4-5-20251001","id":"msg_011gBnRan9XvkaupNdUKWzbX","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me check the related files to get more context about how landmarks are used:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":3833,"cache_read_input_tokens":12131,"cache_creation":{"ephemeral_5m_input_tokens":3833,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWFXFwnNroB8ix9Zijtvr","type":"assistant","uuid":"8fd34747-f23a-4d25-bdeb-1335350554de","timestamp":"2025-12-19T05:50:24.191Z"}
{"parentUuid":"8fd34747-f23a-4d25-bdeb-1335350554de","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e7ba8ff7-ea0c-41d6-9623-9ec03de27b58","version":"2.0.70","gitBranch":"main","agentId":"a33bd58","slug":"delegated-brewing-liskov","message":{"model":"claude-haiku-4-5-20251001","id":"msg_011gBnRan9XvkaupNdUKWzbX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FnoT1yGG1rs7speGj29H2a","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceDetectionService.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":3833,"cache_read_input_tokens":12131,"cache_creation":{"ephemeral_5m_input_tokens":3833,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWFXFwnNroB8ix9Zijtvr","type":"assistant","uuid":"9b38bb51-1971-4084-8a2f-bd1915b11158","timestamp":"2025-12-19T05:50:24.485Z"}
{"parentUuid":"9b38bb51-1971-4084-8a2f-bd1915b11158","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e7ba8ff7-ea0c-41d6-9623-9ec03de27b58","version":"2.0.70","gitBranch":"main","agentId":"a33bd58","slug":"delegated-brewing-liskov","message":{"model":"claude-haiku-4-5-20251001","id":"msg_011gBnRan9XvkaupNdUKWzbX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GdS5iC5EGhze56nWA967vQ","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":3833,"cache_read_input_tokens":12131,"cache_creation":{"ephemeral_5m_input_tokens":3833,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWFXFwnNroB8ix9Zijtvr","type":"assistant","uuid":"15482fe7-351d-4a7c-b0be-78dca0bfb957","timestamp":"2025-12-19T05:50:24.735Z"}
{"parentUuid":"15482fe7-351d-4a7c-b0be-78dca0bfb957","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e7ba8ff7-ea0c-41d6-9623-9ec03de27b58","version":"2.0.70","gitBranch":"main","agentId":"a33bd58","slug":"delegated-brewing-liskov","message":{"model":"claude-haiku-4-5-20251001","id":"msg_011gBnRan9XvkaupNdUKWzbX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Q4bZqivaipK8T4TAWaxmRB","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":3833,"cache_read_input_tokens":12131,"cache_creation":{"ephemeral_5m_input_tokens":3833,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWFXFwnNroB8ix9Zijtvr","type":"assistant","uuid":"3e98f160-770f-4a2e-b4db-04a821f5d968","timestamp":"2025-12-19T05:50:24.957Z"}
{"parentUuid":"3e98f160-770f-4a2e-b4db-04a821f5d968","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e7ba8ff7-ea0c-41d6-9623-9ec03de27b58","version":"2.0.70","gitBranch":"main","agentId":"a33bd58","slug":"delegated-brewing-liskov","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FnoT1yGG1rs7speGj29H2a","type":"tool_result","content":"     1→/**\n     2→ * Unified Face Detection Service\n     3→ * Uses MediaPipe Tasks Vision for optimal performance\n     4→ * Singleton pattern with preloading and warmup support\n     5→ */\n     6→\n     7→import { FaceLandmarker, FilesetResolver, FaceLandmarkerResult } from '@mediapipe/tasks-vision';\n     8→\n     9→const CONFIG = {\n    10→  MODEL_URL: 'https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task',\n    11→  WASM_URL: 'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.22/wasm',\n    12→};\n    13→\n    14→class FaceDetectionService {\n    15→  private landmarker: FaceLandmarker | null = null;\n    16→  private initPromise: Promise<FaceLandmarker> | null = null;\n    17→  private isWarmedUp = false;\n    18→\n    19→  async initialize(): Promise<FaceLandmarker> {\n    20→    if (this.landmarker) return this.landmarker;\n    21→    if (this.initPromise) return this.initPromise;\n    22→\n    23→    this.initPromise = this.createLandmarker();\n    24→    this.landmarker = await this.initPromise;\n    25→    this.initPromise = null;\n    26→    return this.landmarker;\n    27→  }\n    28→\n    29→  private async createLandmarker(): Promise<FaceLandmarker> {\n    30→    const vision = await FilesetResolver.forVisionTasks(CONFIG.WASM_URL);\n    31→    return FaceLandmarker.createFromOptions(vision, {\n    32→      baseOptions: {\n    33→        modelAssetPath: CONFIG.MODEL_URL,\n    34→        delegate: 'GPU',\n    35→      },\n    36→      runningMode: 'IMAGE',\n    37→      numFaces: 1,\n    38→      outputFaceBlendshapes: false,\n    39→      outputFacialTransformationMatrixes: false,\n    40→    });\n    41→  }\n    42→\n    43→  async warmup(): Promise<void> {\n    44→    if (this.isWarmedUp) return;\n    45→    const landmarker = await this.initialize();\n    46→\n    47→    // Create dummy image for warmup (forces GPU shader compilation)\n    48→    const canvas = document.createElement('canvas');\n    49→    canvas.width = 224;\n    50→    canvas.height = 224;\n    51→    const ctx = canvas.getContext('2d');\n    52→    if (ctx) {\n    53→      ctx.fillStyle = '#888888';\n    54→      ctx.fillRect(0, 0, 224, 224);\n    55→      landmarker.detect(canvas);\n    56→    }\n    57→    this.isWarmedUp = true;\n    58→  }\n    59→\n    60→  async detect(image: HTMLImageElement | HTMLCanvasElement): Promise<FaceLandmarkerResult> {\n    61→    const landmarker = await this.initialize();\n    62→    return landmarker.detect(image);\n    63→  }\n    64→\n    65→  isReady(): boolean {\n    66→    return this.landmarker !== null;\n    67→  }\n    68→\n    69→  dispose(): void {\n    70→    if (this.landmarker) {\n    71→      this.landmarker.close();\n    72→      this.landmarker = null;\n    73→      this.isWarmedUp = false;\n    74→    }\n    75→  }\n    76→}\n    77→\n    78→// Export singleton instance\n    79→export const faceDetectionService = new FaceDetectionService();\n    80→\n    81→// Convenience exports\n    82→export async function preloadFaceDetection(): Promise<void> {\n    83→  await faceDetectionService.initialize();\n    84→  await faceDetectionService.warmup();\n    85→}\n    86→\n    87→export function isFaceDetectionReady(): boolean {\n    88→  return faceDetectionService.isReady();\n    89→}\n    90→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"935ace9a-a58a-445f-8906-82cf5708309e","timestamp":"2025-12-19T05:50:25.021Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceDetectionService.ts","content":"/**\n * Unified Face Detection Service\n * Uses MediaPipe Tasks Vision for optimal performance\n * Singleton pattern with preloading and warmup support\n */\n\nimport { FaceLandmarker, FilesetResolver, FaceLandmarkerResult } from '@mediapipe/tasks-vision';\n\nconst CONFIG = {\n  MODEL_URL: 'https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task',\n  WASM_URL: 'https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@0.10.22/wasm',\n};\n\nclass FaceDetectionService {\n  private landmarker: FaceLandmarker | null = null;\n  private initPromise: Promise<FaceLandmarker> | null = null;\n  private isWarmedUp = false;\n\n  async initialize(): Promise<FaceLandmarker> {\n    if (this.landmarker) return this.landmarker;\n    if (this.initPromise) return this.initPromise;\n\n    this.initPromise = this.createLandmarker();\n    this.landmarker = await this.initPromise;\n    this.initPromise = null;\n    return this.landmarker;\n  }\n\n  private async createLandmarker(): Promise<FaceLandmarker> {\n    const vision = await FilesetResolver.forVisionTasks(CONFIG.WASM_URL);\n    return FaceLandmarker.createFromOptions(vision, {\n      baseOptions: {\n        modelAssetPath: CONFIG.MODEL_URL,\n        delegate: 'GPU',\n      },\n      runningMode: 'IMAGE',\n      numFaces: 1,\n      outputFaceBlendshapes: false,\n      outputFacialTransformationMatrixes: false,\n    });\n  }\n\n  async warmup(): Promise<void> {\n    if (this.isWarmedUp) return;\n    const landmarker = await this.initialize();\n\n    // Create dummy image for warmup (forces GPU shader compilation)\n    const canvas = document.createElement('canvas');\n    canvas.width = 224;\n    canvas.height = 224;\n    const ctx = canvas.getContext('2d');\n    if (ctx) {\n      ctx.fillStyle = '#888888';\n      ctx.fillRect(0, 0, 224, 224);\n      landmarker.detect(canvas);\n    }\n    this.isWarmedUp = true;\n  }\n\n  async detect(image: HTMLImageElement | HTMLCanvasElement): Promise<FaceLandmarkerResult> {\n    const landmarker = await this.initialize();\n    return landmarker.detect(image);\n  }\n\n  isReady(): boolean {\n    return this.landmarker !== null;\n  }\n\n  dispose(): void {\n    if (this.landmarker) {\n      this.landmarker.close();\n      this.landmarker = null;\n      this.isWarmedUp = false;\n    }\n  }\n}\n\n// Export singleton instance\nexport const faceDetectionService = new FaceDetectionService();\n\n// Convenience exports\nexport async function preloadFaceDetection(): Promise<void> {\n  await faceDetectionService.initialize();\n  await faceDetectionService.warmup();\n}\n\nexport function isFaceDetectionReady(): boolean {\n  return faceDetectionService.isReady();\n}\n","numLines":90,"startLine":1,"totalLines":90}}}
{"parentUuid":"935ace9a-a58a-445f-8906-82cf5708309e","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e7ba8ff7-ea0c-41d6-9623-9ec03de27b58","version":"2.0.70","gitBranch":"main","agentId":"a33bd58","slug":"delegated-brewing-liskov","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Q4bZqivaipK8T4TAWaxmRB","type":"tool_result","content":"     1→/**\n     2→ * Facial Analysis Scoring Functions\n     3→ * Uses correct landmark IDs from landmarks.ts\n     4→ * Includes FaceIQ-style bell curve scoring and percentile ranking\n     5→ */\n     6→\n     7→import {\n     8→  LandmarkPoint,\n     9→  ScoringConfig,\n    10→  FACEIQ_SCORING_CONFIGS,\n    11→  FACEIQ_IDEAL_VALUES,\n    12→  PopulationStats,\n    13→  POPULATION_STATS,\n    14→} from './landmarks';\n    15→\n    16→// ============================================\n    17→// UTILITY TYPES & FUNCTIONS\n    18→// ============================================\n    19→\n    20→export interface Point {\n    21→  x: number;\n    22→  y: number;\n    23→}\n    24→\n    25→export interface ScoreResult {\n    26→  value: number;\n    27→  score: number;\n    28→  idealRange: { min: number; max: number };\n    29→  rating: 'excellent' | 'good' | 'average' | 'below_average';\n    30→}\n    31→\n    32→/**\n    33→ * Calculate distance between two points\n    34→ */\n    35→export function distance(p1: Point, p2: Point): number {\n    36→  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n    37→}\n    38→\n    39→/**\n    40→ * Calculate angle at vertex point (in degrees)\n    41→ * Angle is formed by points: p1 -> vertex -> p2\n    42→ */\n    43→export function calculateAngle(p1: Point, vertex: Point, p2: Point): number {\n    44→  const v1 = { x: p1.x - vertex.x, y: p1.y - vertex.y };\n    45→  const v2 = { x: p2.x - vertex.x, y: p2.y - vertex.y };\n    46→\n    47→  const dot = v1.x * v2.x + v1.y * v2.y;\n    48→  const cross = v1.x * v2.y - v1.y * v2.x;\n    49→\n    50→  const angle = Math.atan2(cross, dot) * (180 / Math.PI);\n    51→  return Math.abs(angle);\n    52→}\n    53→\n    54→/**\n    55→ * Calculate perpendicular distance from point to line\n    56→ * Positive = in front of line, Negative = behind line\n    57→ */\n    58→export function perpendicularDistance(\n    59→  point: Point,\n    60→  lineStart: Point,\n    61→  lineEnd: Point\n    62→): number {\n    63→  const A = point.x - lineStart.x;\n    64→  const B = point.y - lineStart.y;\n    65→  const C = lineEnd.x - lineStart.x;\n    66→  const D = lineEnd.y - lineStart.y;\n    67→\n    68→  const dot = A * C + B * D;\n    69→  const lenSq = C * C + D * D;\n    70→  const param = lenSq !== 0 ? dot / lenSq : -1;\n    71→\n    72→  let xx: number, yy: number;\n    73→\n    74→  if (param < 0) {\n    75→    xx = lineStart.x;\n    76→    yy = lineStart.y;\n    77→  } else if (param > 1) {\n    78→    xx = lineEnd.x;\n    79→    yy = lineEnd.y;\n    80→  } else {\n    81→    xx = lineStart.x + param * C;\n    82→    yy = lineStart.y + param * D;\n    83→  }\n    84→\n    85→  const dx = point.x - xx;\n    86→  const dy = point.y - yy;\n    87→\n    88→  // Determine sign (positive = in front of line, negative = behind)\n    89→  const sign =\n    90→    (lineEnd.y - lineStart.y) * point.x -\n    91→      (lineEnd.x - lineStart.x) * point.y +\n    92→      lineEnd.x * lineStart.y -\n    93→      lineEnd.y * lineStart.x >=\n    94→    0\n    95→      ? 1\n    96→      : -1;\n    97→\n    98→  return sign * Math.sqrt(dx * dx + dy * dy);\n    99→}\n   100→\n   101→/**\n   102→ * Get rating from score\n   103→ */\n   104→function getRating(score: number): ScoreResult['rating'] {\n   105→  if (score >= 90) return 'excellent';\n   106→  if (score >= 75) return 'good';\n   107→  if (score >= 50) return 'average';\n   108→  return 'below_average';\n   109→}\n   110→\n   111→/**\n   112→ * Helper to get landmark by ID from array\n   113→ */\n   114→function getLandmark(landmarks: LandmarkPoint[], id: string): Point | null {\n   115→  const lm = landmarks.find((l) => l.id === id);\n   116→  return lm ? { x: lm.x, y: lm.y } : null;\n   117→}\n   118→\n   119→// ============================================\n   120→// SIDE PROFILE SCORING (uses _side suffix landmarks)\n   121→// ============================================\n   122→\n   123→/**\n   124→ * Gonial Angle - Jaw angle measurement\n   125→ * Uses: tragion, gonion_inferior_side, menton_side\n   126→ * Ideal: 120° - 130° (male), 125° - 135° (female)\n   127→ */\n   128→export function calculateGonialAngle(\n   129→  sideLandmarks: LandmarkPoint[],\n   130→  gender: 'male' | 'female' = 'male'\n   131→): ScoreResult | null {\n   132→  const tragion = getLandmark(sideLandmarks, 'tragion');\n   133→  const gonion_inferior = getLandmark(sideLandmarks, 'gonion_inferior_side');\n   134→  const menton = getLandmark(sideLandmarks, 'menton_side');\n   135→\n   136→  if (!tragion || !gonion_inferior || !menton) return null;\n   137→\n   138→  const angle = calculateAngle(tragion, gonion_inferior, menton);\n   139→\n   140→  const idealMin = gender === 'male' ? 120 : 125;\n   141→  const idealMax = gender === 'male' ? 130 : 135;\n   142→\n   143→  let score: number;\n   144→  if (angle >= idealMin && angle <= idealMax) {\n   145→    score = 100;\n   146→  } else {\n   147→    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n   148→    score = Math.max(0, 100 - deviation * 5);\n   149→  }\n   150→\n   151→  return {\n   152→    value: angle,\n   153→    score,\n   154→    idealRange: { min: idealMin, max: idealMax },\n   155→    rating: getRating(score),\n   156→  };\n   157→}\n   158→\n   159→/**\n   160→ * Nasolabial Angle - Angle between columella and upper lip\n   161→ * Uses: columella_nasi, subnasale_side, labrale_superius_side\n   162→ * Ideal: 90° - 105° (male), 95° - 115° (female)\n   163→ */\n   164→export function calculateNasolabialAngle(\n   165→  sideLandmarks: LandmarkPoint[],\n   166→  gender: 'male' | 'female' = 'male'\n   167→): ScoreResult | null {\n   168→  const columella = getLandmark(sideLandmarks, 'columella_nasi');\n   169→  const subnasale = getLandmark(sideLandmarks, 'subnasale_side');\n   170→  const labrale_superius = getLandmark(sideLandmarks, 'labrale_superius_side');\n   171→\n   172→  if (!columella || !subnasale || !labrale_superius) return null;\n   173→\n   174→  const angle = calculateAngle(columella, subnasale, labrale_superius);\n   175→\n   176→  const idealMin = gender === 'male' ? 90 : 95;\n   177→  const idealMax = gender === 'male' ? 105 : 115;\n   178→\n   179→  let score: number;\n   180→  if (angle >= idealMin && angle <= idealMax) {\n   181→    score = 100;\n   182→  } else {\n   183→    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n   184→    score = Math.max(0, 100 - deviation * 4);\n   185→  }\n   186→\n   187→  return {\n   188→    value: angle,\n   189→    score,\n   190→    idealRange: { min: idealMin, max: idealMax },\n   191→    rating: getRating(score),\n   192→  };\n   193→}\n   194→\n   195→/**\n   196→ * E-Line (Ricketts' Esthetic Line) - Lip protrusion analysis\n   197→ * Uses: pronasale, pogonion, labrale_superius_side, labrale_inferius_side\n   198→ * Ideal: Upper lip 4mm behind (male) / 2mm behind (female)\n   199→ *        Lower lip 2mm behind (male) / 0mm (female)\n   200→ */\n   201→export function calculateELine(\n   202→  sideLandmarks: LandmarkPoint[],\n   203→  gender: 'male' | 'female' = 'male'\n   204→): { upperLip: ScoreResult; lowerLip: ScoreResult; combined: ScoreResult } | null {\n   205→  const pronasale = getLandmark(sideLandmarks, 'pronasale');\n   206→  const pogonion = getLandmark(sideLandmarks, 'pogonion');\n   207→  const labrale_superius = getLandmark(sideLandmarks, 'labrale_superius_side');\n   208→  const labrale_inferius = getLandmark(sideLandmarks, 'labrale_inferius_side');\n   209→\n   210→  if (!pronasale || !pogonion || !labrale_superius || !labrale_inferius) return null;\n   211→\n   212→  const upperLipDistance = perpendicularDistance(labrale_superius, pronasale, pogonion);\n   213→  const lowerLipDistance = perpendicularDistance(labrale_inferius, pronasale, pogonion);\n   214→\n   215→  // Ideal values (negative = behind the line, which is desirable)\n   216→  const idealUpperLip = gender === 'male' ? -4 : -2;\n   217→  const idealLowerLip = gender === 'male' ? -2 : 0;\n   218→  const tolerance = 2;\n   219→\n   220→  // Upper lip scoring\n   221→  const upperDeviation = Math.abs(upperLipDistance - idealUpperLip);\n   222→  const upperScore =\n   223→    upperDeviation <= tolerance\n   224→      ? 100\n   225→      : Math.max(0, 100 - (upperDeviation - tolerance) * 10);\n   226→\n   227→  // Lower lip scoring\n   228→  const lowerDeviation = Math.abs(lowerLipDistance - idealLowerLip);\n   229→  const lowerScore =\n   230→    lowerDeviation <= tolerance\n   231→      ? 100\n   232→      : Math.max(0, 100 - (lowerDeviation - tolerance) * 10);\n   233→\n   234→  const combinedScore = (upperScore + lowerScore) / 2;\n   235→\n   236→  return {\n   237→    upperLip: {\n   238→      value: upperLipDistance,\n   239→      score: upperScore,\n   240→      idealRange: { min: idealUpperLip - tolerance, max: idealUpperLip + tolerance },\n   241→      rating: getRating(upperScore),\n   242→    },\n   243→    lowerLip: {\n   244→      value: lowerLipDistance,\n   245→      score: lowerScore,\n   246→      idealRange: { min: idealLowerLip - tolerance, max: idealLowerLip + tolerance },\n   247→      rating: getRating(lowerScore),\n   248→    },\n   249→    combined: {\n   250→      value: (upperLipDistance + lowerLipDistance) / 2,\n   251→      score: combinedScore,\n   252→      idealRange: { min: -6, max: 2 },\n   253→      rating: getRating(combinedScore),\n   254→    },\n   255→  };\n   256→}\n   257→\n   258→/**\n   259→ * Mentolabial Angle - Angle at the labiomental fold\n   260→ * Uses: labrale_inferius_side, sublabiale, pogonion\n   261→ * Ideal: 120° - 140°\n   262→ */\n   263→export function calculateMentolabialAngle(\n   264→  sideLandmarks: LandmarkPoint[]\n   265→): ScoreResult | null {\n   266→  const labrale_inferius = getLandmark(sideLandmarks, 'labrale_inferius_side');\n   267→  const sublabiale = getLandmark(sideLandmarks, 'sublabiale');\n   268→  const pogonion = getLandmark(sideLandmarks, 'pogonion');\n   269→\n   270→  if (!labrale_inferius || !sublabiale || !pogonion) return null;\n   271→\n   272→  const angle = calculateAngle(labrale_inferius, sublabiale, pogonion);\n   273→\n   274→  const idealMin = 120;\n   275→  const idealMax = 140;\n   276→\n   277→  let score: number;\n   278→  if (angle >= idealMin && angle <= idealMax) {\n   279→    score = 100;\n   280→  } else {\n   281→    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n   282→    score = Math.max(0, 100 - deviation * 3);\n   283→  }\n   284→\n   285→  return {\n   286→    value: angle,\n   287→    score,\n   288→    idealRange: { min: idealMin, max: idealMax },\n   289→    rating: getRating(score),\n   290→  };\n   291→}\n   292→\n   293→/**\n   294→ * Nasofrontal Angle - Angle at the bridge of nose\n   295→ * Uses: glabella, nasion, rhinion\n   296→ * Ideal: 115° - 135°\n   297→ */\n   298→export function calculateNasofrontalAngle(\n   299→  sideLandmarks: LandmarkPoint[]\n   300→): ScoreResult | null {\n   301→  const glabella = getLandmark(sideLandmarks, 'glabella');\n   302→  const nasion = getLandmark(sideLandmarks, 'nasion');\n   303→  const rhinion = getLandmark(sideLandmarks, 'rhinion');\n   304→\n   305→  if (!glabella || !nasion || !rhinion) return null;\n   306→\n   307→  const angle = calculateAngle(glabella, nasion, rhinion);\n   308→\n   309→  const idealMin = 115;\n   310→  const idealMax = 135;\n   311→\n   312→  let score: number;\n   313→  if (angle >= idealMin && angle <= idealMax) {\n   314→    score = 100;\n   315→  } else {\n   316→    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n   317→    score = Math.max(0, 100 - deviation * 3);\n   318→  }\n   319→\n   320→  return {\n   321→    value: angle,\n   322→    score,\n   323→    idealRange: { min: idealMin, max: idealMax },\n   324→    rating: getRating(score),\n   325→  };\n   326→}\n   327→\n   328→// ============================================\n   329→// FRONT PROFILE SCORING (uses front landmarks)\n   330→// ============================================\n   331→\n   332→/**\n   333→ * Facial Thirds - Vertical face proportions\n   334→ * Uses: trichion, glabella (approx from nasion), subnasale, menton\n   335→ * Ideal: Each third ~33%\n   336→ * Note: For front profile, we use nasal_base as proxy for glabella area\n   337→ */\n   338→export function calculateFacialThirds(\n   339→  frontLandmarks: LandmarkPoint[]\n   340→): { upper: ScoreResult; middle: ScoreResult; lower: ScoreResult; overall: ScoreResult } | null {\n   341→  const trichion = getLandmark(frontLandmarks, 'trichion');\n   342→  const nasal_base = getLandmark(frontLandmarks, 'nasal_base'); // Using as glabella proxy\n   343→  const subnasale = getLandmark(frontLandmarks, 'subnasale');\n   344→  const menton = getLandmark(frontLandmarks, 'menton');\n   345→\n   346→  if (!trichion || !nasal_base || !subnasale || !menton) return null;\n   347→\n   348→  const totalHeight = distance(trichion, menton);\n   349→  if (totalHeight === 0) return null;\n   350→\n   351→  const upperThird = (distance(trichion, nasal_base) / totalHeight) * 100;\n   352→  const middleThird = (distance(nasal_base, subnasale) / totalHeight) * 100;\n   353→  const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n   354→\n   355→  const ideal = 33.33;\n   356→  const tolerance = 3;\n   357→\n   358→  const scoreThird = (value: number): number => {\n   359→    const deviation = Math.abs(value - ideal);\n   360→    return deviation <= tolerance ? 100 : Math.max(0, 100 - (deviation - tolerance) * 8);\n   361→  };\n   362→\n   363→  const upperScore = scoreThird(upperThird);\n   364→  const middleScore = scoreThird(middleThird);\n   365→  const lowerScore = scoreThird(lowerThird);\n   366→  const overallScore = (upperScore + middleScore + lowerScore) / 3;\n   367→\n   368→  return {\n   369→    upper: {\n   370→      value: upperThird,\n   371→      score: upperScore,\n   372→      idealRange: { min: 30, max: 36 },\n   373→      rating: getRating(upperScore),\n   374→    },\n   375→    middle: {\n   376→      value: middleThird,\n   377→      score: middleScore,\n   378→      idealRange: { min: 30, max: 36 },\n   379→      rating: getRating(middleScore),\n   380→    },\n   381→    lower: {\n   382→      value: lowerThird,\n   383→      score: lowerScore,\n   384→      idealRange: { min: 30, max: 36 },\n   385→      rating: getRating(lowerScore),\n   386→    },\n   387→    overall: {\n   388→      value: Math.max(Math.abs(upperThird - ideal), Math.abs(middleThird - ideal), Math.abs(lowerThird - ideal)),\n   389→      score: overallScore,\n   390→      idealRange: { min: 0, max: 3 },\n   391→      rating: getRating(overallScore),\n   392→    },\n   393→  };\n   394→}\n   395→\n   396→/**\n   397→ * Facial Width-to-Height Ratio (FWHR)\n   398→ * Uses: left_zygion, right_zygion, nasal_base (as upper bound), labrale_superius\n   399→ * Ideal: 1.8 - 2.0\n   400→ */\n   401→export function calculateFWHR(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n   402→  const left_zygion = getLandmark(frontLandmarks, 'left_zygion');\n   403→  const right_zygion = getLandmark(frontLandmarks, 'right_zygion');\n   404→  const nasal_base = getLandmark(frontLandmarks, 'nasal_base');\n   405→  const labrale_superius = getLandmark(frontLandmarks, 'labrale_superius');\n   406→\n   407→  if (!left_zygion || !right_zygion || !nasal_base || !labrale_superius) return null;\n   408→\n   409→  const bizygomatic_width = distance(left_zygion, right_zygion);\n   410→  const upper_face_height = distance(nasal_base, labrale_superius);\n   411→\n   412→  if (upper_face_height === 0) return null;\n   413→\n   414→  const ratio = bizygomatic_width / upper_face_height;\n   415→\n   416→  const idealMin = 1.8;\n   417→  const idealMax = 2.0;\n   418→\n   419→  let score: number;\n   420→  if (ratio >= idealMin && ratio <= idealMax) {\n   421→    score = 100;\n   422→  } else {\n   423→    const deviation = ratio < idealMin ? idealMin - ratio : ratio - idealMax;\n   424→    score = Math.max(0, 100 - deviation * 50);\n   425→  }\n   426→\n   427→  return {\n   428→    value: ratio,\n   429→    score,\n   430→    idealRange: { min: idealMin, max: idealMax },\n   431→    rating: getRating(score),\n   432→  };\n   433→}\n   434→\n   435→/**\n   436→ * Interpupillary Distance Ratio\n   437→ * Uses: left_pupila, right_pupila, left_zygion, right_zygion\n   438→ * Ideal: IPD ~46% of bizygomatic width\n   439→ */\n   440→export function calculateIPDRatio(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n   441→  const left_pupila = getLandmark(frontLandmarks, 'left_pupila');\n   442→  const right_pupila = getLandmark(frontLandmarks, 'right_pupila');\n   443→  const left_zygion = getLandmark(frontLandmarks, 'left_zygion');\n   444→  const right_zygion = getLandmark(frontLandmarks, 'right_zygion');\n   445→\n   446→  if (!left_pupila || !right_pupila || !left_zygion || !right_zygion) return null;\n   447→\n   448→  const ipd = distance(left_pupila, right_pupila);\n   449→  const bizygomatic_width = distance(left_zygion, right_zygion);\n   450→\n   451→  if (bizygomatic_width === 0) return null;\n   452→\n   453→  const ratio = (ipd / bizygomatic_width) * 100;\n   454→\n   455→  const ideal = 46;\n   456→  const tolerance = 2;\n   457→\n   458→  const deviation = Math.abs(ratio - ideal);\n   459→  const score = deviation <= tolerance ? 100 : Math.max(0, 100 - (deviation - tolerance) * 8);\n   460→\n   461→  return {\n   462→    value: ratio,\n   463→    score,\n   464→    idealRange: { min: 44, max: 48 },\n   465→    rating: getRating(score),\n   466→  };\n   467→}\n   468→\n   469→/**\n   470→ * Nasal Index (Nose Width to Height)\n   471→ * Uses: left_ala_nasi, right_ala_nasi, nasal_base, subnasale\n   472→ * Classification varies by ethnicity\n   473→ */\n   474→export function calculateNasalIndex(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n   475→  const left_ala_nasi = getLandmark(frontLandmarks, 'left_ala_nasi');\n   476→  const right_ala_nasi = getLandmark(frontLandmarks, 'right_ala_nasi');\n   477→  const nasal_base = getLandmark(frontLandmarks, 'nasal_base');\n   478→  const subnasale = getLandmark(frontLandmarks, 'subnasale');\n   479→\n   480→  if (!left_ala_nasi || !right_ala_nasi || !nasal_base || !subnasale) return null;\n   481→\n   482→  const nasal_width = distance(left_ala_nasi, right_ala_nasi);\n   483→  const nasal_height = distance(nasal_base, subnasale);\n   484→\n   485→  if (nasal_height === 0) return null;\n   486→\n   487→  const index = (nasal_width / nasal_height) * 100;\n   488→\n   489→  // Using mesorrhine (medium) as ideal: 70-85\n   490→  const idealMin = 70;\n   491→  const idealMax = 85;\n   492→\n   493→  let score: number;\n   494→  if (index >= idealMin && index <= idealMax) {\n   495→    score = 100;\n   496→  } else {\n   497→    const deviation = index < idealMin ? idealMin - index : index - idealMax;\n   498→    score = Math.max(0, 100 - deviation * 3);\n   499→  }\n   500→\n   501→  return {\n   502→    value: index,\n   503→    score,\n   504→    idealRange: { min: idealMin, max: idealMax },\n   505→    rating: getRating(score),\n   506→  };\n   507→}\n   508→\n   509→/**\n   510→ * Eye Canthal Tilt\n   511→ * Uses: left_canthus_medialis, left_canthus_lateralis (or right)\n   512→ * Ideal: 4° - 8° positive tilt\n   513→ */\n   514→export function calculateCanthalTilt(\n   515→  frontLandmarks: LandmarkPoint[],\n   516→  side: 'left' | 'right' = 'left'\n   517→): ScoreResult | null {\n   518→  const medialId = side === 'left' ? 'left_canthus_medialis' : 'right_canthus_medialis';\n   519→  const lateralId = side === 'left' ? 'left_canthus_lateralis' : 'right_canthus_lateralis';\n   520→\n   521→  const canthus_medialis = getLandmark(frontLandmarks, medialId);\n   522→  const canthus_lateralis = getLandmark(frontLandmarks, lateralId);\n   523→\n   524→  if (!canthus_medialis || !canthus_lateralis) return null;\n   525→\n   526→  // Y is inverted in screen coordinates\n   527→  const deltaY = canthus_medialis.y - canthus_lateralis.y;\n   528→  const deltaX = canthus_lateralis.x - canthus_medialis.x;\n   529→\n   530→  const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);\n   531→\n   532→  const idealMin = 4;\n   533→  const idealMax = 8;\n   534→\n   535→  let score: number;\n   536→  if (angle >= idealMin && angle <= idealMax) {\n   537→    score = 100;\n   538→  } else if (angle < 0) {\n   539→    // Negative tilt is worse\n   540→    score = Math.max(0, 50 + angle * 5);\n   541→  } else {\n   542→    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n   543→    score = Math.max(0, 100 - deviation * 10);\n   544→  }\n   545→\n   546→  return {\n   547→    value: angle,\n   548→    score,\n   549→    idealRange: { min: idealMin, max: idealMax },\n   550→    rating: getRating(score),\n   551→  };\n   552→}\n   553→\n   554→/**\n   555→ * Mouth Width to Nose Width Ratio\n   556→ * Uses: left_cheilion, right_cheilion, left_ala_nasi, right_ala_nasi\n   557→ * Ideal: 1.5 - 1.6\n   558→ */\n   559→export function calculateMouthNoseRatio(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n   560→  const left_cheilion = getLandmark(frontLandmarks, 'left_cheilion');\n   561→  const right_cheilion = getLandmark(frontLandmarks, 'right_cheilion');\n   562→  const left_ala_nasi = getLandmark(frontLandmarks, 'left_ala_nasi');\n   563→  const right_ala_nasi = getLandmark(frontLandmarks, 'right_ala_nasi');\n   564→\n   565→  if (!left_cheilion || !right_cheilion || !left_ala_nasi || !right_ala_nasi) return null;\n   566→\n   567→  const mouth_width = distance(left_cheilion, right_cheilion);\n   568→  const nose_width = distance(left_ala_nasi, right_ala_nasi);\n   569→\n   570→  if (nose_width === 0) return null;\n   571→\n   572→  const ratio = mouth_width / nose_width;\n   573→\n   574→  const idealMin = 1.5;\n   575→  const idealMax = 1.6;\n   576→\n   577→  let score: number;\n   578→  if (ratio >= idealMin && ratio <= idealMax) {\n   579→    score = 100;\n   580→  } else {\n   581→    const deviation = ratio < idealMin ? idealMin - ratio : ratio - idealMax;\n   582→    score = Math.max(0, 100 - deviation * 30);\n   583→  }\n   584→\n   585→  return {\n   586→    value: ratio,\n   587→    score,\n   588→    idealRange: { min: idealMin, max: idealMax },\n   589→    rating: getRating(score),\n   590→  };\n   591→}\n   592→\n   593→/**\n   594→ * Jaw Width to Face Width Ratio (Bigonial to Bizygomatic)\n   595→ * Uses: left_gonion_inferior, right_gonion_inferior, left_zygion, right_zygion\n   596→ * Ideal: 0.75 - 0.80 (male), 0.70 - 0.75 (female)\n   597→ */\n   598→export function calculateJawRatio(\n   599→  frontLandmarks: LandmarkPoint[],\n   600→  gender: 'male' | 'female' = 'male'\n   601→): ScoreResult | null {\n   602→  const left_gonion = getLandmark(frontLandmarks, 'left_gonion_inferior');\n   603→  const right_gonion = getLandmark(frontLandmarks, 'right_gonion_inferior');\n   604→  const left_zygion = getLandmark(frontLandmarks, 'left_zygion');\n   605→  const right_zygion = getLandmark(frontLandmarks, 'right_zygion');\n   606→\n   607→  if (!left_gonion || !right_gonion || !left_zygion || !right_zygion) return null;\n   608→\n   609→  const bigonial_width = distance(left_gonion, right_gonion);\n   610→  const bizygomatic_width = distance(left_zygion, right_zygion);\n   611→\n   612→  if (bizygomatic_width === 0) return null;\n   613→\n   614→  const ratio = bigonial_width / bizygomatic_width;\n   615→\n   616→  const idealMin = gender === 'male' ? 0.75 : 0.7;\n   617→  const idealMax = gender === 'male' ? 0.8 : 0.75;\n   618→\n   619→  let score: number;\n   620→  if (ratio >= idealMin && ratio <= idealMax) {\n   621→    score = 100;\n   622→  } else {\n   623→    const deviation = ratio < idealMin ? idealMin - ratio : ratio - idealMax;\n   624→    score = Math.max(0, 100 - deviation * 100);\n   625→  }\n   626→\n   627→  return {\n   628→    value: ratio,\n   629→    score,\n   630→    idealRange: { min: idealMin, max: idealMax },\n   631→    rating: getRating(score),\n   632→  };\n   633→}\n   634→\n   635→// ============================================\n   636→// COMPREHENSIVE ANALYSIS\n   637→// ============================================\n   638→\n   639→export interface FrontAnalysisResults {\n   640→  facialThirds: ReturnType<typeof calculateFacialThirds>;\n   641→  fwhr: ScoreResult | null;\n   642→  ipdRatio: ScoreResult | null;\n   643→  nasalIndex: ScoreResult | null;\n   644→  leftCanthalTilt: ScoreResult | null;\n   645→  rightCanthalTilt: ScoreResult | null;\n   646→  mouthNoseRatio: ScoreResult | null;\n   647→  jawRatio: ScoreResult | null;\n   648→  overallScore: number;\n   649→}\n   650→\n   651→export interface SideAnalysisResults {\n   652→  gonialAngle: ScoreResult | null;\n   653→  nasolabialAngle: ScoreResult | null;\n   654→  eLine: ReturnType<typeof calculateELine>;\n   655→  mentolabialAngle: ScoreResult | null;\n   656→  nasofrontalAngle: ScoreResult | null;\n   657→  overallScore: number;\n   658→}\n   659→\n   660→/**\n   661→ * Run all front profile analyses\n   662→ */\n   663→export function analyzeFrontProfile(\n   664→  frontLandmarks: LandmarkPoint[],\n   665→  gender: 'male' | 'female' = 'male'\n   666→): FrontAnalysisResults {\n   667→  const facialThirds = calculateFacialThirds(frontLandmarks);\n   668→  const fwhr = calculateFWHR(frontLandmarks);\n   669→  const ipdRatio = calculateIPDRatio(frontLandmarks);\n   670→  const nasalIndex = calculateNasalIndex(frontLandmarks);\n   671→  const leftCanthalTilt = calculateCanthalTilt(frontLandmarks, 'left');\n   672→  const rightCanthalTilt = calculateCanthalTilt(frontLandmarks, 'right');\n   673→  const mouthNoseRatio = calculateMouthNoseRatio(frontLandmarks);\n   674→  const jawRatio = calculateJawRatio(frontLandmarks, gender);\n   675→\n   676→  // Calculate overall score from valid results\n   677→  const scores: number[] = [];\n   678→  if (facialThirds) scores.push(facialThirds.overall.score);\n   679→  if (fwhr) scores.push(fwhr.score);\n   680→  if (ipdRatio) scores.push(ipdRatio.score);\n   681→  if (nasalIndex) scores.push(nasalIndex.score);\n   682→  if (leftCanthalTilt) scores.push(leftCanthalTilt.score);\n   683→  if (rightCanthalTilt) scores.push(rightCanthalTilt.score);\n   684→  if (mouthNoseRatio) scores.push(mouthNoseRatio.score);\n   685→  if (jawRatio) scores.push(jawRatio.score);\n   686→\n   687→  const overallScore = scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;\n   688→\n   689→  return {\n   690→    facialThirds,\n   691→    fwhr,\n   692→    ipdRatio,\n   693→    nasalIndex,\n   694→    leftCanthalTilt,\n   695→    rightCanthalTilt,\n   696→    mouthNoseRatio,\n   697→    jawRatio,\n   698→    overallScore,\n   699→  };\n   700→}\n   701→\n   702→/**\n   703→ * Run all side profile analyses\n   704→ */\n   705→export function analyzeSideProfile(\n   706→  sideLandmarks: LandmarkPoint[],\n   707→  gender: 'male' | 'female' = 'male'\n   708→): SideAnalysisResults {\n   709→  const gonialAngle = calculateGonialAngle(sideLandmarks, gender);\n   710→  const nasolabialAngle = calculateNasolabialAngle(sideLandmarks, gender);\n   711→  const eLine = calculateELine(sideLandmarks, gender);\n   712→  const mentolabialAngle = calculateMentolabialAngle(sideLandmarks);\n   713→  const nasofrontalAngle = calculateNasofrontalAngle(sideLandmarks);\n   714→\n   715→  // Calculate overall score from valid results\n   716→  const scores: number[] = [];\n   717→  if (gonialAngle) scores.push(gonialAngle.score);\n   718→  if (nasolabialAngle) scores.push(nasolabialAngle.score);\n   719→  if (eLine) scores.push(eLine.combined.score);\n   720→  if (mentolabialAngle) scores.push(mentolabialAngle.score);\n   721→  if (nasofrontalAngle) scores.push(nasofrontalAngle.score);\n   722→\n   723→  const overallScore = scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;\n   724→\n   725→  return {\n   726→    gonialAngle,\n   727→    nasolabialAngle,\n   728→    eLine,\n   729→    mentolabialAngle,\n   730→    nasofrontalAngle,\n   731→    overallScore,\n   732→  };\n   733→}\n   734→\n   735→// ============================================\n   736→// FACEIQ-STYLE BELL CURVE SCORING\n   737→// ============================================\n   738→\n   739→/**\n   740→ * Bell curve scoring function\n   741→ * score = e^(-0.5 × ((value-ideal)/stdDev)²) × 100\n   742→ */\n   743→export function calculateBellCurveScore(\n   744→  value: number,\n   745→  config: ScoringConfig\n   746→): number {\n   747→  const z = (value - config.idealValue) / config.standardDeviation;\n   748→  const bellCurve = Math.exp(-0.5 * z * z);\n   749→  return config.minScore + (config.maxScore - config.minScore) * bellCurve;\n   750→}\n   751→\n   752→/**\n   753→ * Get bell curve score with gender-specific ideal values\n   754→ */\n   755→export function calculateGenderAwareBellCurveScore(\n   756→  value: number,\n   757→  measurementKey: string,\n   758→  gender: 'male' | 'female'\n   759→): number {\n   760→  const idealValues = FACEIQ_IDEAL_VALUES[measurementKey];\n   761→  const config = FACEIQ_SCORING_CONFIGS[measurementKey];\n   762→\n   763→  if (!idealValues || !config) {\n   764→    return 0;\n   765→  }\n   766→\n   767→  const genderIdeal = idealValues[gender].ideal;\n   768→  const adjustedConfig = {\n   769→    ...config,\n   770→    idealValue: genderIdeal,\n   771→  };\n   772→\n   773→  return calculateBellCurveScore(value, adjustedConfig);\n   774→}\n   775→\n   776→/**\n   777→ * Calculate overall harmony score (weighted average)\n   778→ */\n   779→export function calculateHarmonyScore(\n   780→  scores: Record<string, number>\n   781→): number {\n   782→  let totalWeight = 0;\n   783→  let weightedSum = 0;\n   784→\n   785→  for (const [key, score] of Object.entries(scores)) {\n   786→    const config = FACEIQ_SCORING_CONFIGS[key];\n   787→    if (config) {\n   788→      weightedSum += score * config.weight;\n   789→      totalWeight += config.weight;\n   790→    }\n   791→  }\n   792→\n   793→  return totalWeight > 0 ? weightedSum / totalWeight : 0;\n   794→}\n   795→\n   796→// ============================================\n   797→// PERCENTILE RANKING (Population Comparison)\n   798→// ============================================\n   799→\n   800→/**\n   801→ * Standard normal CDF approximation (Abramowitz and Stegun formula)\n   802→ */\n   803→export function normalCDF(z: number): number {\n   804→  const a1 = 0.254829592;\n   805→  const a2 = -0.284496736;\n   806→  const a3 = 1.421413741;\n   807→  const a4 = -1.453152027;\n   808→  const a5 = 1.061405429;\n   809→  const p = 0.3275911;\n   810→\n   811→  const sign = z < 0 ? -1 : 1;\n   812→  const absZ = Math.abs(z) / Math.sqrt(2);\n   813→\n   814→  const t = 1.0 / (1.0 + p * absZ);\n   815→  const y =\n   816→    1.0 -\n   817→    ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-absZ * absZ);\n   818→\n   819→  return 0.5 * (1.0 + sign * y);\n   820→}\n   821→\n   822→/**\n   823→ * Calculate percentile (where you fall on the bell curve)\n   824→ */\n   825→export function calculatePercentile(\n   826→  value: number,\n   827→  stats: PopulationStats\n   828→): number {\n   829→  const z = (value - stats.mean) / stats.standardDeviation;\n   830→  return normalCDF(z) * 100;\n   831→}\n   832→\n   833→/**\n   834→ * Calculate percentile for a specific measurement\n   835→ */\n   836→export function calculateMeasurementPercentile(\n   837→  value: number,\n   838→  measurementKey: string\n   839→): number {\n   840→  const stats = POPULATION_STATS[measurementKey];\n   841→  if (!stats) {\n   842→    return 50; // Default to median if no stats available\n   843→  }\n   844→  return calculatePercentile(value, stats);\n   845→}\n   846→\n   847→// ============================================\n   848→// BELL CURVE DATA FOR VISUALIZATION\n   849→// ============================================\n   850→\n   851→export interface BellCurvePoint {\n   852→  x: number;\n   853→  y: number;\n   854→}\n   855→\n   856→export interface BellCurveData {\n   857→  points: BellCurvePoint[];\n   858→  userValue: number;\n   859→  userPercentile: number;\n   860→  mean: number;\n   861→  standardDeviation: number;\n   862→  idealValue?: number;\n   863→}\n   864→\n   865→/**\n   866→ * Generate bell curve data for visualization\n   867→ */\n   868→export function generateBellCurveData(\n   869→  stats: PopulationStats,\n   870→  userValue: number,\n   871→  idealValue?: number\n   872→): BellCurveData {\n   873→  const points: BellCurvePoint[] = [];\n   874→\n   875→  // Generate points from -4 to +4 standard deviations\n   876→  for (let i = -4; i <= 4; i += 0.1) {\n   877→    const x = stats.mean + i * stats.standardDeviation;\n   878→    const y =\n   879→      (1 / (stats.standardDeviation * Math.sqrt(2 * Math.PI))) *\n   880→      Math.exp(\n   881→        -0.5 * Math.pow((x - stats.mean) / stats.standardDeviation, 2)\n   882→      );\n   883→    points.push({ x, y });\n   884→  }\n   885→\n   886→  return {\n   887→    points,\n   888→    userValue,\n   889→    userPercentile: calculatePercentile(userValue, stats),\n   890→    mean: stats.mean,\n   891→    standardDeviation: stats.standardDeviation,\n   892→    idealValue,\n   893→  };\n   894→}\n   895→\n   896→/**\n   897→ * Generate bell curve data for a specific measurement\n   898→ */\n   899→export function generateMeasurementBellCurve(\n   900→  measurementKey: string,\n   901→  userValue: number,\n   902→  gender?: 'male' | 'female'\n   903→): BellCurveData | null {\n   904→  const stats = POPULATION_STATS[measurementKey];\n   905→  if (!stats) {\n   906→    return null;\n   907→  }\n   908→\n   909→  const idealValues = FACEIQ_IDEAL_VALUES[measurementKey];\n   910→  const idealValue = idealValues && gender ? idealValues[gender].ideal : undefined;\n   911→\n   912→  return generateBellCurveData(stats, userValue, idealValue);\n   913→}\n   914→\n   915→// ============================================\n   916→// ENHANCED SCORE RESULTS\n   917→// ============================================\n   918→\n   919→export interface EnhancedScoreResult extends ScoreResult {\n   920→  bellCurveScore: number;\n   921→  percentile: number;\n   922→  idealValue: number;\n   923→  deviation: number;\n   924→}\n   925→\n   926→/**\n   927→ * Create enhanced score result with bell curve and percentile\n   928→ */\n   929→export function createEnhancedScore(\n   930→  value: number,\n   931→  measurementKey: string,\n   932→  gender: 'male' | 'female' = 'male'\n   933→): EnhancedScoreResult | null {\n   934→  const config = FACEIQ_SCORING_CONFIGS[measurementKey];\n   935→  const idealValues = FACEIQ_IDEAL_VALUES[measurementKey];\n   936→  const stats = POPULATION_STATS[measurementKey];\n   937→\n   938→  if (!config) return null;\n   939→\n   940→  const idealValue = idealValues ? idealValues[gender].ideal : config.idealValue;\n   941→  const bellCurveScore = calculateBellCurveScore(value, {\n   942→    ...config,\n   943→    idealValue,\n   944→  });\n   945→  const percentile = stats ? calculatePercentile(value, stats) : 50;\n   946→  const deviation = value - idealValue;\n   947→\n   948→  return {\n   949→    value,\n   950→    score: bellCurveScore,\n   951→    idealRange: idealValues\n   952→      ? { min: idealValues[gender].range[0], max: idealValues[gender].range[1] }\n   953→      : { min: config.idealValue - config.standardDeviation, max: config.idealValue + config.standardDeviation },\n   954→    rating: getRating(bellCurveScore),\n   955→    bellCurveScore,\n   956→    percentile,\n   957→    idealValue,\n   958→    deviation,\n   959→  };\n   960→}\n   961→\n   962→// ============================================\n   963→// COMPREHENSIVE ANALYSIS WITH BELL CURVES\n   964→// ============================================\n   965→\n   966→export interface ComprehensiveFrontAnalysis extends FrontAnalysisResults {\n   967→  bellCurveScores: Record<string, number>;\n   968→  percentiles: Record<string, number>;\n   969→  harmonyScore: number;\n   970→}\n   971→\n   972→export interface ComprehensiveSideAnalysis extends SideAnalysisResults {\n   973→  bellCurveScores: Record<string, number>;\n   974→  percentiles: Record<string, number>;\n   975→  harmonyScore: number;\n   976→}\n   977→\n   978→/**\n   979→ * Run comprehensive front profile analysis with bell curves\n   980→ */\n   981→export function comprehensiveFrontAnalysis(\n   982→  frontLandmarks: LandmarkPoint[],\n   983→  gender: 'male' | 'female' = 'male'\n   984→): ComprehensiveFrontAnalysis {\n   985→  const baseAnalysis = analyzeFrontProfile(frontLandmarks, gender);\n   986→\n   987→  const bellCurveScores: Record<string, number> = {};\n   988→  const percentiles: Record<string, number> = {};\n   989→\n   990→  // Calculate bell curve scores for each measurement\n   991→  if (baseAnalysis.fwhr) {\n   992→    bellCurveScores.fwhr = calculateGenderAwareBellCurveScore(\n   993→      baseAnalysis.fwhr.value,\n   994→      'fwhr',\n   995→      gender\n   996→    );\n   997→    percentiles.fwhr = calculateMeasurementPercentile(\n   998→      baseAnalysis.fwhr.value,\n   999→      'fwhr'\n  1000→    );\n  1001→  }\n  1002→\n  1003→  if (baseAnalysis.leftCanthalTilt) {\n  1004→    bellCurveScores.canthalTilt = calculateGenderAwareBellCurveScore(\n  1005→      baseAnalysis.leftCanthalTilt.value,\n  1006→      'canthalTilt',\n  1007→      gender\n  1008→    );\n  1009→    percentiles.canthalTilt = calculateMeasurementPercentile(\n  1010→      baseAnalysis.leftCanthalTilt.value,\n  1011→      'canthalTilt'\n  1012→    );\n  1013→  }\n  1014→\n  1015→  if (baseAnalysis.nasalIndex) {\n  1016→    bellCurveScores.nasalIndex = calculateGenderAwareBellCurveScore(\n  1017→      baseAnalysis.nasalIndex.value,\n  1018→      'nasalIndex',\n  1019→      gender\n  1020→    );\n  1021→  }\n  1022→\n  1023→  const harmonyScore = calculateHarmonyScore(bellCurveScores);\n  1024→\n  1025→  return {\n  1026→    ...baseAnalysis,\n  1027→    bellCurveScores,\n  1028→    percentiles,\n  1029→    harmonyScore,\n  1030→  };\n  1031→}\n  1032→\n  1033→/**\n  1034→ * Run comprehensive side profile analysis with bell curves\n  1035→ */\n  1036→export function comprehensiveSideAnalysis(\n  1037→  sideLandmarks: LandmarkPoint[],\n  1038→  gender: 'male' | 'female' = 'male'\n  1039→): ComprehensiveSideAnalysis {\n  1040→  const baseAnalysis = analyzeSideProfile(sideLandmarks, gender);\n  1041→\n  1042→  const bellCurveScores: Record<string, number> = {};\n  1043→  const percentiles: Record<string, number> = {};\n  1044→\n  1045→  // Calculate bell curve scores for each measurement\n  1046→  if (baseAnalysis.gonialAngle) {\n  1047→    bellCurveScores.gonialAngle = calculateGenderAwareBellCurveScore(\n  1048→      baseAnalysis.gonialAngle.value,\n  1049→      'gonialAngle',\n  1050→      gender\n  1051→    );\n  1052→  }\n  1053→\n  1054→  if (baseAnalysis.nasolabialAngle) {\n  1055→    bellCurveScores.nasolabialAngle = calculateGenderAwareBellCurveScore(\n  1056→      baseAnalysis.nasolabialAngle.value,\n  1057→      'nasolabialAngle',\n  1058→      gender\n  1059→    );\n  1060→  }\n  1061→\n  1062→  const harmonyScore = calculateHarmonyScore(bellCurveScores);\n  1063→\n  1064→  return {\n  1065→    ...baseAnalysis,\n  1066→    bellCurveScores,\n  1067→    percentiles,\n  1068→    harmonyScore,\n  1069→  };\n  1070→}\n  1071→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"aa9ad5ba-a6d0-4474-876e-55022227ead3","timestamp":"2025-12-19T05:50:25.188Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring.ts","content":"/**\n * Facial Analysis Scoring Functions\n * Uses correct landmark IDs from landmarks.ts\n * Includes FaceIQ-style bell curve scoring and percentile ranking\n */\n\nimport {\n  LandmarkPoint,\n  ScoringConfig,\n  FACEIQ_SCORING_CONFIGS,\n  FACEIQ_IDEAL_VALUES,\n  PopulationStats,\n  POPULATION_STATS,\n} from './landmarks';\n\n// ============================================\n// UTILITY TYPES & FUNCTIONS\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport interface ScoreResult {\n  value: number;\n  score: number;\n  idealRange: { min: number; max: number };\n  rating: 'excellent' | 'good' | 'average' | 'below_average';\n}\n\n/**\n * Calculate distance between two points\n */\nexport function distance(p1: Point, p2: Point): number {\n  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n}\n\n/**\n * Calculate angle at vertex point (in degrees)\n * Angle is formed by points: p1 -> vertex -> p2\n */\nexport function calculateAngle(p1: Point, vertex: Point, p2: Point): number {\n  const v1 = { x: p1.x - vertex.x, y: p1.y - vertex.y };\n  const v2 = { x: p2.x - vertex.x, y: p2.y - vertex.y };\n\n  const dot = v1.x * v2.x + v1.y * v2.y;\n  const cross = v1.x * v2.y - v1.y * v2.x;\n\n  const angle = Math.atan2(cross, dot) * (180 / Math.PI);\n  return Math.abs(angle);\n}\n\n/**\n * Calculate perpendicular distance from point to line\n * Positive = in front of line, Negative = behind line\n */\nexport function perpendicularDistance(\n  point: Point,\n  lineStart: Point,\n  lineEnd: Point\n): number {\n  const A = point.x - lineStart.x;\n  const B = point.y - lineStart.y;\n  const C = lineEnd.x - lineStart.x;\n  const D = lineEnd.y - lineStart.y;\n\n  const dot = A * C + B * D;\n  const lenSq = C * C + D * D;\n  const param = lenSq !== 0 ? dot / lenSq : -1;\n\n  let xx: number, yy: number;\n\n  if (param < 0) {\n    xx = lineStart.x;\n    yy = lineStart.y;\n  } else if (param > 1) {\n    xx = lineEnd.x;\n    yy = lineEnd.y;\n  } else {\n    xx = lineStart.x + param * C;\n    yy = lineStart.y + param * D;\n  }\n\n  const dx = point.x - xx;\n  const dy = point.y - yy;\n\n  // Determine sign (positive = in front of line, negative = behind)\n  const sign =\n    (lineEnd.y - lineStart.y) * point.x -\n      (lineEnd.x - lineStart.x) * point.y +\n      lineEnd.x * lineStart.y -\n      lineEnd.y * lineStart.x >=\n    0\n      ? 1\n      : -1;\n\n  return sign * Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Get rating from score\n */\nfunction getRating(score: number): ScoreResult['rating'] {\n  if (score >= 90) return 'excellent';\n  if (score >= 75) return 'good';\n  if (score >= 50) return 'average';\n  return 'below_average';\n}\n\n/**\n * Helper to get landmark by ID from array\n */\nfunction getLandmark(landmarks: LandmarkPoint[], id: string): Point | null {\n  const lm = landmarks.find((l) => l.id === id);\n  return lm ? { x: lm.x, y: lm.y } : null;\n}\n\n// ============================================\n// SIDE PROFILE SCORING (uses _side suffix landmarks)\n// ============================================\n\n/**\n * Gonial Angle - Jaw angle measurement\n * Uses: tragion, gonion_inferior_side, menton_side\n * Ideal: 120° - 130° (male), 125° - 135° (female)\n */\nexport function calculateGonialAngle(\n  sideLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): ScoreResult | null {\n  const tragion = getLandmark(sideLandmarks, 'tragion');\n  const gonion_inferior = getLandmark(sideLandmarks, 'gonion_inferior_side');\n  const menton = getLandmark(sideLandmarks, 'menton_side');\n\n  if (!tragion || !gonion_inferior || !menton) return null;\n\n  const angle = calculateAngle(tragion, gonion_inferior, menton);\n\n  const idealMin = gender === 'male' ? 120 : 125;\n  const idealMax = gender === 'male' ? 130 : 135;\n\n  let score: number;\n  if (angle >= idealMin && angle <= idealMax) {\n    score = 100;\n  } else {\n    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n    score = Math.max(0, 100 - deviation * 5);\n  }\n\n  return {\n    value: angle,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n/**\n * Nasolabial Angle - Angle between columella and upper lip\n * Uses: columella_nasi, subnasale_side, labrale_superius_side\n * Ideal: 90° - 105° (male), 95° - 115° (female)\n */\nexport function calculateNasolabialAngle(\n  sideLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): ScoreResult | null {\n  const columella = getLandmark(sideLandmarks, 'columella_nasi');\n  const subnasale = getLandmark(sideLandmarks, 'subnasale_side');\n  const labrale_superius = getLandmark(sideLandmarks, 'labrale_superius_side');\n\n  if (!columella || !subnasale || !labrale_superius) return null;\n\n  const angle = calculateAngle(columella, subnasale, labrale_superius);\n\n  const idealMin = gender === 'male' ? 90 : 95;\n  const idealMax = gender === 'male' ? 105 : 115;\n\n  let score: number;\n  if (angle >= idealMin && angle <= idealMax) {\n    score = 100;\n  } else {\n    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n    score = Math.max(0, 100 - deviation * 4);\n  }\n\n  return {\n    value: angle,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n/**\n * E-Line (Ricketts' Esthetic Line) - Lip protrusion analysis\n * Uses: pronasale, pogonion, labrale_superius_side, labrale_inferius_side\n * Ideal: Upper lip 4mm behind (male) / 2mm behind (female)\n *        Lower lip 2mm behind (male) / 0mm (female)\n */\nexport function calculateELine(\n  sideLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): { upperLip: ScoreResult; lowerLip: ScoreResult; combined: ScoreResult } | null {\n  const pronasale = getLandmark(sideLandmarks, 'pronasale');\n  const pogonion = getLandmark(sideLandmarks, 'pogonion');\n  const labrale_superius = getLandmark(sideLandmarks, 'labrale_superius_side');\n  const labrale_inferius = getLandmark(sideLandmarks, 'labrale_inferius_side');\n\n  if (!pronasale || !pogonion || !labrale_superius || !labrale_inferius) return null;\n\n  const upperLipDistance = perpendicularDistance(labrale_superius, pronasale, pogonion);\n  const lowerLipDistance = perpendicularDistance(labrale_inferius, pronasale, pogonion);\n\n  // Ideal values (negative = behind the line, which is desirable)\n  const idealUpperLip = gender === 'male' ? -4 : -2;\n  const idealLowerLip = gender === 'male' ? -2 : 0;\n  const tolerance = 2;\n\n  // Upper lip scoring\n  const upperDeviation = Math.abs(upperLipDistance - idealUpperLip);\n  const upperScore =\n    upperDeviation <= tolerance\n      ? 100\n      : Math.max(0, 100 - (upperDeviation - tolerance) * 10);\n\n  // Lower lip scoring\n  const lowerDeviation = Math.abs(lowerLipDistance - idealLowerLip);\n  const lowerScore =\n    lowerDeviation <= tolerance\n      ? 100\n      : Math.max(0, 100 - (lowerDeviation - tolerance) * 10);\n\n  const combinedScore = (upperScore + lowerScore) / 2;\n\n  return {\n    upperLip: {\n      value: upperLipDistance,\n      score: upperScore,\n      idealRange: { min: idealUpperLip - tolerance, max: idealUpperLip + tolerance },\n      rating: getRating(upperScore),\n    },\n    lowerLip: {\n      value: lowerLipDistance,\n      score: lowerScore,\n      idealRange: { min: idealLowerLip - tolerance, max: idealLowerLip + tolerance },\n      rating: getRating(lowerScore),\n    },\n    combined: {\n      value: (upperLipDistance + lowerLipDistance) / 2,\n      score: combinedScore,\n      idealRange: { min: -6, max: 2 },\n      rating: getRating(combinedScore),\n    },\n  };\n}\n\n/**\n * Mentolabial Angle - Angle at the labiomental fold\n * Uses: labrale_inferius_side, sublabiale, pogonion\n * Ideal: 120° - 140°\n */\nexport function calculateMentolabialAngle(\n  sideLandmarks: LandmarkPoint[]\n): ScoreResult | null {\n  const labrale_inferius = getLandmark(sideLandmarks, 'labrale_inferius_side');\n  const sublabiale = getLandmark(sideLandmarks, 'sublabiale');\n  const pogonion = getLandmark(sideLandmarks, 'pogonion');\n\n  if (!labrale_inferius || !sublabiale || !pogonion) return null;\n\n  const angle = calculateAngle(labrale_inferius, sublabiale, pogonion);\n\n  const idealMin = 120;\n  const idealMax = 140;\n\n  let score: number;\n  if (angle >= idealMin && angle <= idealMax) {\n    score = 100;\n  } else {\n    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n    score = Math.max(0, 100 - deviation * 3);\n  }\n\n  return {\n    value: angle,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n/**\n * Nasofrontal Angle - Angle at the bridge of nose\n * Uses: glabella, nasion, rhinion\n * Ideal: 115° - 135°\n */\nexport function calculateNasofrontalAngle(\n  sideLandmarks: LandmarkPoint[]\n): ScoreResult | null {\n  const glabella = getLandmark(sideLandmarks, 'glabella');\n  const nasion = getLandmark(sideLandmarks, 'nasion');\n  const rhinion = getLandmark(sideLandmarks, 'rhinion');\n\n  if (!glabella || !nasion || !rhinion) return null;\n\n  const angle = calculateAngle(glabella, nasion, rhinion);\n\n  const idealMin = 115;\n  const idealMax = 135;\n\n  let score: number;\n  if (angle >= idealMin && angle <= idealMax) {\n    score = 100;\n  } else {\n    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n    score = Math.max(0, 100 - deviation * 3);\n  }\n\n  return {\n    value: angle,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n// ============================================\n// FRONT PROFILE SCORING (uses front landmarks)\n// ============================================\n\n/**\n * Facial Thirds - Vertical face proportions\n * Uses: trichion, glabella (approx from nasion), subnasale, menton\n * Ideal: Each third ~33%\n * Note: For front profile, we use nasal_base as proxy for glabella area\n */\nexport function calculateFacialThirds(\n  frontLandmarks: LandmarkPoint[]\n): { upper: ScoreResult; middle: ScoreResult; lower: ScoreResult; overall: ScoreResult } | null {\n  const trichion = getLandmark(frontLandmarks, 'trichion');\n  const nasal_base = getLandmark(frontLandmarks, 'nasal_base'); // Using as glabella proxy\n  const subnasale = getLandmark(frontLandmarks, 'subnasale');\n  const menton = getLandmark(frontLandmarks, 'menton');\n\n  if (!trichion || !nasal_base || !subnasale || !menton) return null;\n\n  const totalHeight = distance(trichion, menton);\n  if (totalHeight === 0) return null;\n\n  const upperThird = (distance(trichion, nasal_base) / totalHeight) * 100;\n  const middleThird = (distance(nasal_base, subnasale) / totalHeight) * 100;\n  const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n\n  const ideal = 33.33;\n  const tolerance = 3;\n\n  const scoreThird = (value: number): number => {\n    const deviation = Math.abs(value - ideal);\n    return deviation <= tolerance ? 100 : Math.max(0, 100 - (deviation - tolerance) * 8);\n  };\n\n  const upperScore = scoreThird(upperThird);\n  const middleScore = scoreThird(middleThird);\n  const lowerScore = scoreThird(lowerThird);\n  const overallScore = (upperScore + middleScore + lowerScore) / 3;\n\n  return {\n    upper: {\n      value: upperThird,\n      score: upperScore,\n      idealRange: { min: 30, max: 36 },\n      rating: getRating(upperScore),\n    },\n    middle: {\n      value: middleThird,\n      score: middleScore,\n      idealRange: { min: 30, max: 36 },\n      rating: getRating(middleScore),\n    },\n    lower: {\n      value: lowerThird,\n      score: lowerScore,\n      idealRange: { min: 30, max: 36 },\n      rating: getRating(lowerScore),\n    },\n    overall: {\n      value: Math.max(Math.abs(upperThird - ideal), Math.abs(middleThird - ideal), Math.abs(lowerThird - ideal)),\n      score: overallScore,\n      idealRange: { min: 0, max: 3 },\n      rating: getRating(overallScore),\n    },\n  };\n}\n\n/**\n * Facial Width-to-Height Ratio (FWHR)\n * Uses: left_zygion, right_zygion, nasal_base (as upper bound), labrale_superius\n * Ideal: 1.8 - 2.0\n */\nexport function calculateFWHR(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n  const left_zygion = getLandmark(frontLandmarks, 'left_zygion');\n  const right_zygion = getLandmark(frontLandmarks, 'right_zygion');\n  const nasal_base = getLandmark(frontLandmarks, 'nasal_base');\n  const labrale_superius = getLandmark(frontLandmarks, 'labrale_superius');\n\n  if (!left_zygion || !right_zygion || !nasal_base || !labrale_superius) return null;\n\n  const bizygomatic_width = distance(left_zygion, right_zygion);\n  const upper_face_height = distance(nasal_base, labrale_superius);\n\n  if (upper_face_height === 0) return null;\n\n  const ratio = bizygomatic_width / upper_face_height;\n\n  const idealMin = 1.8;\n  const idealMax = 2.0;\n\n  let score: number;\n  if (ratio >= idealMin && ratio <= idealMax) {\n    score = 100;\n  } else {\n    const deviation = ratio < idealMin ? idealMin - ratio : ratio - idealMax;\n    score = Math.max(0, 100 - deviation * 50);\n  }\n\n  return {\n    value: ratio,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n/**\n * Interpupillary Distance Ratio\n * Uses: left_pupila, right_pupila, left_zygion, right_zygion\n * Ideal: IPD ~46% of bizygomatic width\n */\nexport function calculateIPDRatio(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n  const left_pupila = getLandmark(frontLandmarks, 'left_pupila');\n  const right_pupila = getLandmark(frontLandmarks, 'right_pupila');\n  const left_zygion = getLandmark(frontLandmarks, 'left_zygion');\n  const right_zygion = getLandmark(frontLandmarks, 'right_zygion');\n\n  if (!left_pupila || !right_pupila || !left_zygion || !right_zygion) return null;\n\n  const ipd = distance(left_pupila, right_pupila);\n  const bizygomatic_width = distance(left_zygion, right_zygion);\n\n  if (bizygomatic_width === 0) return null;\n\n  const ratio = (ipd / bizygomatic_width) * 100;\n\n  const ideal = 46;\n  const tolerance = 2;\n\n  const deviation = Math.abs(ratio - ideal);\n  const score = deviation <= tolerance ? 100 : Math.max(0, 100 - (deviation - tolerance) * 8);\n\n  return {\n    value: ratio,\n    score,\n    idealRange: { min: 44, max: 48 },\n    rating: getRating(score),\n  };\n}\n\n/**\n * Nasal Index (Nose Width to Height)\n * Uses: left_ala_nasi, right_ala_nasi, nasal_base, subnasale\n * Classification varies by ethnicity\n */\nexport function calculateNasalIndex(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n  const left_ala_nasi = getLandmark(frontLandmarks, 'left_ala_nasi');\n  const right_ala_nasi = getLandmark(frontLandmarks, 'right_ala_nasi');\n  const nasal_base = getLandmark(frontLandmarks, 'nasal_base');\n  const subnasale = getLandmark(frontLandmarks, 'subnasale');\n\n  if (!left_ala_nasi || !right_ala_nasi || !nasal_base || !subnasale) return null;\n\n  const nasal_width = distance(left_ala_nasi, right_ala_nasi);\n  const nasal_height = distance(nasal_base, subnasale);\n\n  if (nasal_height === 0) return null;\n\n  const index = (nasal_width / nasal_height) * 100;\n\n  // Using mesorrhine (medium) as ideal: 70-85\n  const idealMin = 70;\n  const idealMax = 85;\n\n  let score: number;\n  if (index >= idealMin && index <= idealMax) {\n    score = 100;\n  } else {\n    const deviation = index < idealMin ? idealMin - index : index - idealMax;\n    score = Math.max(0, 100 - deviation * 3);\n  }\n\n  return {\n    value: index,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n/**\n * Eye Canthal Tilt\n * Uses: left_canthus_medialis, left_canthus_lateralis (or right)\n * Ideal: 4° - 8° positive tilt\n */\nexport function calculateCanthalTilt(\n  frontLandmarks: LandmarkPoint[],\n  side: 'left' | 'right' = 'left'\n): ScoreResult | null {\n  const medialId = side === 'left' ? 'left_canthus_medialis' : 'right_canthus_medialis';\n  const lateralId = side === 'left' ? 'left_canthus_lateralis' : 'right_canthus_lateralis';\n\n  const canthus_medialis = getLandmark(frontLandmarks, medialId);\n  const canthus_lateralis = getLandmark(frontLandmarks, lateralId);\n\n  if (!canthus_medialis || !canthus_lateralis) return null;\n\n  // Y is inverted in screen coordinates\n  const deltaY = canthus_medialis.y - canthus_lateralis.y;\n  const deltaX = canthus_lateralis.x - canthus_medialis.x;\n\n  const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);\n\n  const idealMin = 4;\n  const idealMax = 8;\n\n  let score: number;\n  if (angle >= idealMin && angle <= idealMax) {\n    score = 100;\n  } else if (angle < 0) {\n    // Negative tilt is worse\n    score = Math.max(0, 50 + angle * 5);\n  } else {\n    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n    score = Math.max(0, 100 - deviation * 10);\n  }\n\n  return {\n    value: angle,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n/**\n * Mouth Width to Nose Width Ratio\n * Uses: left_cheilion, right_cheilion, left_ala_nasi, right_ala_nasi\n * Ideal: 1.5 - 1.6\n */\nexport function calculateMouthNoseRatio(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n  const left_cheilion = getLandmark(frontLandmarks, 'left_cheilion');\n  const right_cheilion = getLandmark(frontLandmarks, 'right_cheilion');\n  const left_ala_nasi = getLandmark(frontLandmarks, 'left_ala_nasi');\n  const right_ala_nasi = getLandmark(frontLandmarks, 'right_ala_nasi');\n\n  if (!left_cheilion || !right_cheilion || !left_ala_nasi || !right_ala_nasi) return null;\n\n  const mouth_width = distance(left_cheilion, right_cheilion);\n  const nose_width = distance(left_ala_nasi, right_ala_nasi);\n\n  if (nose_width === 0) return null;\n\n  const ratio = mouth_width / nose_width;\n\n  const idealMin = 1.5;\n  const idealMax = 1.6;\n\n  let score: number;\n  if (ratio >= idealMin && ratio <= idealMax) {\n    score = 100;\n  } else {\n    const deviation = ratio < idealMin ? idealMin - ratio : ratio - idealMax;\n    score = Math.max(0, 100 - deviation * 30);\n  }\n\n  return {\n    value: ratio,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n/**\n * Jaw Width to Face Width Ratio (Bigonial to Bizygomatic)\n * Uses: left_gonion_inferior, right_gonion_inferior, left_zygion, right_zygion\n * Ideal: 0.75 - 0.80 (male), 0.70 - 0.75 (female)\n */\nexport function calculateJawRatio(\n  frontLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): ScoreResult | null {\n  const left_gonion = getLandmark(frontLandmarks, 'left_gonion_inferior');\n  const right_gonion = getLandmark(frontLandmarks, 'right_gonion_inferior');\n  const left_zygion = getLandmark(frontLandmarks, 'left_zygion');\n  const right_zygion = getLandmark(frontLandmarks, 'right_zygion');\n\n  if (!left_gonion || !right_gonion || !left_zygion || !right_zygion) return null;\n\n  const bigonial_width = distance(left_gonion, right_gonion);\n  const bizygomatic_width = distance(left_zygion, right_zygion);\n\n  if (bizygomatic_width === 0) return null;\n\n  const ratio = bigonial_width / bizygomatic_width;\n\n  const idealMin = gender === 'male' ? 0.75 : 0.7;\n  const idealMax = gender === 'male' ? 0.8 : 0.75;\n\n  let score: number;\n  if (ratio >= idealMin && ratio <= idealMax) {\n    score = 100;\n  } else {\n    const deviation = ratio < idealMin ? idealMin - ratio : ratio - idealMax;\n    score = Math.max(0, 100 - deviation * 100);\n  }\n\n  return {\n    value: ratio,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n// ============================================\n// COMPREHENSIVE ANALYSIS\n// ============================================\n\nexport interface FrontAnalysisResults {\n  facialThirds: ReturnType<typeof calculateFacialThirds>;\n  fwhr: ScoreResult | null;\n  ipdRatio: ScoreResult | null;\n  nasalIndex: ScoreResult | null;\n  leftCanthalTilt: ScoreResult | null;\n  rightCanthalTilt: ScoreResult | null;\n  mouthNoseRatio: ScoreResult | null;\n  jawRatio: ScoreResult | null;\n  overallScore: number;\n}\n\nexport interface SideAnalysisResults {\n  gonialAngle: ScoreResult | null;\n  nasolabialAngle: ScoreResult | null;\n  eLine: ReturnType<typeof calculateELine>;\n  mentolabialAngle: ScoreResult | null;\n  nasofrontalAngle: ScoreResult | null;\n  overallScore: number;\n}\n\n/**\n * Run all front profile analyses\n */\nexport function analyzeFrontProfile(\n  frontLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): FrontAnalysisResults {\n  const facialThirds = calculateFacialThirds(frontLandmarks);\n  const fwhr = calculateFWHR(frontLandmarks);\n  const ipdRatio = calculateIPDRatio(frontLandmarks);\n  const nasalIndex = calculateNasalIndex(frontLandmarks);\n  const leftCanthalTilt = calculateCanthalTilt(frontLandmarks, 'left');\n  const rightCanthalTilt = calculateCanthalTilt(frontLandmarks, 'right');\n  const mouthNoseRatio = calculateMouthNoseRatio(frontLandmarks);\n  const jawRatio = calculateJawRatio(frontLandmarks, gender);\n\n  // Calculate overall score from valid results\n  const scores: number[] = [];\n  if (facialThirds) scores.push(facialThirds.overall.score);\n  if (fwhr) scores.push(fwhr.score);\n  if (ipdRatio) scores.push(ipdRatio.score);\n  if (nasalIndex) scores.push(nasalIndex.score);\n  if (leftCanthalTilt) scores.push(leftCanthalTilt.score);\n  if (rightCanthalTilt) scores.push(rightCanthalTilt.score);\n  if (mouthNoseRatio) scores.push(mouthNoseRatio.score);\n  if (jawRatio) scores.push(jawRatio.score);\n\n  const overallScore = scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;\n\n  return {\n    facialThirds,\n    fwhr,\n    ipdRatio,\n    nasalIndex,\n    leftCanthalTilt,\n    rightCanthalTilt,\n    mouthNoseRatio,\n    jawRatio,\n    overallScore,\n  };\n}\n\n/**\n * Run all side profile analyses\n */\nexport function analyzeSideProfile(\n  sideLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): SideAnalysisResults {\n  const gonialAngle = calculateGonialAngle(sideLandmarks, gender);\n  const nasolabialAngle = calculateNasolabialAngle(sideLandmarks, gender);\n  const eLine = calculateELine(sideLandmarks, gender);\n  const mentolabialAngle = calculateMentolabialAngle(sideLandmarks);\n  const nasofrontalAngle = calculateNasofrontalAngle(sideLandmarks);\n\n  // Calculate overall score from valid results\n  const scores: number[] = [];\n  if (gonialAngle) scores.push(gonialAngle.score);\n  if (nasolabialAngle) scores.push(nasolabialAngle.score);\n  if (eLine) scores.push(eLine.combined.score);\n  if (mentolabialAngle) scores.push(mentolabialAngle.score);\n  if (nasofrontalAngle) scores.push(nasofrontalAngle.score);\n\n  const overallScore = scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;\n\n  return {\n    gonialAngle,\n    nasolabialAngle,\n    eLine,\n    mentolabialAngle,\n    nasofrontalAngle,\n    overallScore,\n  };\n}\n\n// ============================================\n// FACEIQ-STYLE BELL CURVE SCORING\n// ============================================\n\n/**\n * Bell curve scoring function\n * score = e^(-0.5 × ((value-ideal)/stdDev)²) × 100\n */\nexport function calculateBellCurveScore(\n  value: number,\n  config: ScoringConfig\n): number {\n  const z = (value - config.idealValue) / config.standardDeviation;\n  const bellCurve = Math.exp(-0.5 * z * z);\n  return config.minScore + (config.maxScore - config.minScore) * bellCurve;\n}\n\n/**\n * Get bell curve score with gender-specific ideal values\n */\nexport function calculateGenderAwareBellCurveScore(\n  value: number,\n  measurementKey: string,\n  gender: 'male' | 'female'\n): number {\n  const idealValues = FACEIQ_IDEAL_VALUES[measurementKey];\n  const config = FACEIQ_SCORING_CONFIGS[measurementKey];\n\n  if (!idealValues || !config) {\n    return 0;\n  }\n\n  const genderIdeal = idealValues[gender].ideal;\n  const adjustedConfig = {\n    ...config,\n    idealValue: genderIdeal,\n  };\n\n  return calculateBellCurveScore(value, adjustedConfig);\n}\n\n/**\n * Calculate overall harmony score (weighted average)\n */\nexport function calculateHarmonyScore(\n  scores: Record<string, number>\n): number {\n  let totalWeight = 0;\n  let weightedSum = 0;\n\n  for (const [key, score] of Object.entries(scores)) {\n    const config = FACEIQ_SCORING_CONFIGS[key];\n    if (config) {\n      weightedSum += score * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  return totalWeight > 0 ? weightedSum / totalWeight : 0;\n}\n\n// ============================================\n// PERCENTILE RANKING (Population Comparison)\n// ============================================\n\n/**\n * Standard normal CDF approximation (Abramowitz and Stegun formula)\n */\nexport function normalCDF(z: number): number {\n  const a1 = 0.254829592;\n  const a2 = -0.284496736;\n  const a3 = 1.421413741;\n  const a4 = -1.453152027;\n  const a5 = 1.061405429;\n  const p = 0.3275911;\n\n  const sign = z < 0 ? -1 : 1;\n  const absZ = Math.abs(z) / Math.sqrt(2);\n\n  const t = 1.0 / (1.0 + p * absZ);\n  const y =\n    1.0 -\n    ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-absZ * absZ);\n\n  return 0.5 * (1.0 + sign * y);\n}\n\n/**\n * Calculate percentile (where you fall on the bell curve)\n */\nexport function calculatePercentile(\n  value: number,\n  stats: PopulationStats\n): number {\n  const z = (value - stats.mean) / stats.standardDeviation;\n  return normalCDF(z) * 100;\n}\n\n/**\n * Calculate percentile for a specific measurement\n */\nexport function calculateMeasurementPercentile(\n  value: number,\n  measurementKey: string\n): number {\n  const stats = POPULATION_STATS[measurementKey];\n  if (!stats) {\n    return 50; // Default to median if no stats available\n  }\n  return calculatePercentile(value, stats);\n}\n\n// ============================================\n// BELL CURVE DATA FOR VISUALIZATION\n// ============================================\n\nexport interface BellCurvePoint {\n  x: number;\n  y: number;\n}\n\nexport interface BellCurveData {\n  points: BellCurvePoint[];\n  userValue: number;\n  userPercentile: number;\n  mean: number;\n  standardDeviation: number;\n  idealValue?: number;\n}\n\n/**\n * Generate bell curve data for visualization\n */\nexport function generateBellCurveData(\n  stats: PopulationStats,\n  userValue: number,\n  idealValue?: number\n): BellCurveData {\n  const points: BellCurvePoint[] = [];\n\n  // Generate points from -4 to +4 standard deviations\n  for (let i = -4; i <= 4; i += 0.1) {\n    const x = stats.mean + i * stats.standardDeviation;\n    const y =\n      (1 / (stats.standardDeviation * Math.sqrt(2 * Math.PI))) *\n      Math.exp(\n        -0.5 * Math.pow((x - stats.mean) / stats.standardDeviation, 2)\n      );\n    points.push({ x, y });\n  }\n\n  return {\n    points,\n    userValue,\n    userPercentile: calculatePercentile(userValue, stats),\n    mean: stats.mean,\n    standardDeviation: stats.standardDeviation,\n    idealValue,\n  };\n}\n\n/**\n * Generate bell curve data for a specific measurement\n */\nexport function generateMeasurementBellCurve(\n  measurementKey: string,\n  userValue: number,\n  gender?: 'male' | 'female'\n): BellCurveData | null {\n  const stats = POPULATION_STATS[measurementKey];\n  if (!stats) {\n    return null;\n  }\n\n  const idealValues = FACEIQ_IDEAL_VALUES[measurementKey];\n  const idealValue = idealValues && gender ? idealValues[gender].ideal : undefined;\n\n  return generateBellCurveData(stats, userValue, idealValue);\n}\n\n// ============================================\n// ENHANCED SCORE RESULTS\n// ============================================\n\nexport interface EnhancedScoreResult extends ScoreResult {\n  bellCurveScore: number;\n  percentile: number;\n  idealValue: number;\n  deviation: number;\n}\n\n/**\n * Create enhanced score result with bell curve and percentile\n */\nexport function createEnhancedScore(\n  value: number,\n  measurementKey: string,\n  gender: 'male' | 'female' = 'male'\n): EnhancedScoreResult | null {\n  const config = FACEIQ_SCORING_CONFIGS[measurementKey];\n  const idealValues = FACEIQ_IDEAL_VALUES[measurementKey];\n  const stats = POPULATION_STATS[measurementKey];\n\n  if (!config) return null;\n\n  const idealValue = idealValues ? idealValues[gender].ideal : config.idealValue;\n  const bellCurveScore = calculateBellCurveScore(value, {\n    ...config,\n    idealValue,\n  });\n  const percentile = stats ? calculatePercentile(value, stats) : 50;\n  const deviation = value - idealValue;\n\n  return {\n    value,\n    score: bellCurveScore,\n    idealRange: idealValues\n      ? { min: idealValues[gender].range[0], max: idealValues[gender].range[1] }\n      : { min: config.idealValue - config.standardDeviation, max: config.idealValue + config.standardDeviation },\n    rating: getRating(bellCurveScore),\n    bellCurveScore,\n    percentile,\n    idealValue,\n    deviation,\n  };\n}\n\n// ============================================\n// COMPREHENSIVE ANALYSIS WITH BELL CURVES\n// ============================================\n\nexport interface ComprehensiveFrontAnalysis extends FrontAnalysisResults {\n  bellCurveScores: Record<string, number>;\n  percentiles: Record<string, number>;\n  harmonyScore: number;\n}\n\nexport interface ComprehensiveSideAnalysis extends SideAnalysisResults {\n  bellCurveScores: Record<string, number>;\n  percentiles: Record<string, number>;\n  harmonyScore: number;\n}\n\n/**\n * Run comprehensive front profile analysis with bell curves\n */\nexport function comprehensiveFrontAnalysis(\n  frontLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): ComprehensiveFrontAnalysis {\n  const baseAnalysis = analyzeFrontProfile(frontLandmarks, gender);\n\n  const bellCurveScores: Record<string, number> = {};\n  const percentiles: Record<string, number> = {};\n\n  // Calculate bell curve scores for each measurement\n  if (baseAnalysis.fwhr) {\n    bellCurveScores.fwhr = calculateGenderAwareBellCurveScore(\n      baseAnalysis.fwhr.value,\n      'fwhr',\n      gender\n    );\n    percentiles.fwhr = calculateMeasurementPercentile(\n      baseAnalysis.fwhr.value,\n      'fwhr'\n    );\n  }\n\n  if (baseAnalysis.leftCanthalTilt) {\n    bellCurveScores.canthalTilt = calculateGenderAwareBellCurveScore(\n      baseAnalysis.leftCanthalTilt.value,\n      'canthalTilt',\n      gender\n    );\n    percentiles.canthalTilt = calculateMeasurementPercentile(\n      baseAnalysis.leftCanthalTilt.value,\n      'canthalTilt'\n    );\n  }\n\n  if (baseAnalysis.nasalIndex) {\n    bellCurveScores.nasalIndex = calculateGenderAwareBellCurveScore(\n      baseAnalysis.nasalIndex.value,\n      'nasalIndex',\n      gender\n    );\n  }\n\n  const harmonyScore = calculateHarmonyScore(bellCurveScores);\n\n  return {\n    ...baseAnalysis,\n    bellCurveScores,\n    percentiles,\n    harmonyScore,\n  };\n}\n\n/**\n * Run comprehensive side profile analysis with bell curves\n */\nexport function comprehensiveSideAnalysis(\n  sideLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): ComprehensiveSideAnalysis {\n  const baseAnalysis = analyzeSideProfile(sideLandmarks, gender);\n\n  const bellCurveScores: Record<string, number> = {};\n  const percentiles: Record<string, number> = {};\n\n  // Calculate bell curve scores for each measurement\n  if (baseAnalysis.gonialAngle) {\n    bellCurveScores.gonialAngle = calculateGenderAwareBellCurveScore(\n      baseAnalysis.gonialAngle.value,\n      'gonialAngle',\n      gender\n    );\n  }\n\n  if (baseAnalysis.nasolabialAngle) {\n    bellCurveScores.nasolabialAngle = calculateGenderAwareBellCurveScore(\n      baseAnalysis.nasolabialAngle.value,\n      'nasolabialAngle',\n      gender\n    );\n  }\n\n  const harmonyScore = calculateHarmonyScore(bellCurveScores);\n\n  return {\n    ...baseAnalysis,\n    bellCurveScores,\n    percentiles,\n    harmonyScore,\n  };\n}\n","numLines":1071,"startLine":1,"totalLines":1071}}}
{"parentUuid":"aa9ad5ba-a6d0-4474-876e-55022227ead3","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e7ba8ff7-ea0c-41d6-9623-9ec03de27b58","version":"2.0.70","gitBranch":"main","agentId":"a33bd58","slug":"delegated-brewing-liskov","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GdS5iC5EGhze56nWA967vQ","type":"tool_result","content":"     1→/**\n     2→ * Facial Landmark Types and Default Data\n     3→ * Based on TECHNICAL_SPECS.md medical terminology\n     4→ */\n     5→\n     6→export interface LandmarkPoint {\n     7→  id: string;\n     8→  label: string;\n     9→  medicalTerm: string;\n    10→  description: string;\n    11→  x: number;\n    12→  y: number;\n    13→  category: string;\n    14→}\n    15→\n    16→export interface LandmarkCategory {\n    17→  name: string;\n    18→  color: string;\n    19→  landmarks: string[];\n    20→}\n    21→\n    22→// ============================================\n    23→// FRONT PROFILE LANDMARKS (52 Points)\n    24→// ============================================\n    25→\n    26→export const FRONT_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n    27→  {\n    28→    name: 'Head',\n    29→    color: '#FF6B6B',\n    30→    landmarks: ['trichion'],\n    31→  },\n    32→  {\n    33→    name: 'Eyes - Left',\n    34→    color: '#4ECDC4',\n    35→    landmarks: [\n    36→      'left_pupila',\n    37→      'left_canthus_medialis',\n    38→      'left_canthus_lateralis',\n    39→      'left_palpebra_superior',\n    40→      'left_palpebra_inferior',\n    41→      'left_sulcus_palpebralis_lateralis',\n    42→      'left_pretarsal_skin_crease',\n    43→    ],\n    44→  },\n    45→  {\n    46→    name: 'Eyes - Right',\n    47→    color: '#45B7D1',\n    48→    landmarks: [\n    49→      'right_pupila',\n    50→      'right_canthus_medialis',\n    51→      'right_canthus_lateralis',\n    52→      'right_palpebra_superior',\n    53→      'right_palpebra_inferior',\n    54→      'right_sulcus_palpebralis_lateralis',\n    55→      'right_pretarsal_skin_crease',\n    56→    ],\n    57→  },\n    58→  {\n    59→    name: 'Eyebrows - Left',\n    60→    color: '#96CEB4',\n    61→    landmarks: [\n    62→      'left_supercilium_medialis',\n    63→      'left_supercilium_medial_corner',\n    64→      'left_supercilium_superior',\n    65→      'left_supercilium_apex',\n    66→      'left_supercilium_lateralis',\n    67→    ],\n    68→  },\n    69→  {\n    70→    name: 'Eyebrows - Right',\n    71→    color: '#88D8B0',\n    72→    landmarks: [\n    73→      'right_supercilium_medialis',\n    74→      'right_supercilium_medial_corner',\n    75→      'right_supercilium_superior',\n    76→      'right_supercilium_apex',\n    77→      'right_supercilium_lateralis',\n    78→    ],\n    79→  },\n    80→  {\n    81→    name: 'Nose',\n    82→    color: '#FFEAA7',\n    83→    landmarks: [\n    84→      'nasal_base',\n    85→      'left_dorsum_nasi',\n    86→      'right_dorsum_nasi',\n    87→      'left_ala_nasi',\n    88→      'right_ala_nasi',\n    89→      'subnasale',\n    90→    ],\n    91→  },\n    92→  {\n    93→    name: 'Mouth',\n    94→    color: '#DDA0DD',\n    95→    landmarks: [\n    96→      'labrale_superius',\n    97→      'cupids_bow',\n    98→      'mouth_middle',\n    99→      'labrale_inferius',\n   100→      'left_cheilion',\n   101→      'right_cheilion',\n   102→    ],\n   103→  },\n   104→  {\n   105→    name: 'Jaw',\n   106→    color: '#F39C12',\n   107→    landmarks: [\n   108→      'left_gonion_superior',\n   109→      'right_gonion_superior',\n   110→      'left_gonion_inferior',\n   111→      'right_gonion_inferior',\n   112→    ],\n   113→  },\n   114→  {\n   115→    name: 'Chin',\n   116→    color: '#E74C3C',\n   117→    landmarks: ['left_mentum_lateralis', 'right_mentum_lateralis', 'menton'],\n   118→  },\n   119→  {\n   120→    name: 'Face Width',\n   121→    color: '#9B59B6',\n   122→    landmarks: [\n   123→      'left_zygion',\n   124→      'right_zygion',\n   125→      'left_temporal',\n   126→      'right_temporal',\n   127→      'left_auricular_lateral',\n   128→      'right_auricular_lateral',\n   129→    ],\n   130→  },\n   131→  {\n   132→    name: 'Neck',\n   133→    color: '#1ABC9C',\n   134→    landmarks: ['left_cervical_lateralis', 'right_cervical_lateralis'],\n   135→  },\n   136→];\n   137→\n   138→export const FRONT_PROFILE_LANDMARKS: LandmarkPoint[] = [\n   139→  // Head/Hair\n   140→  {\n   141→    id: 'trichion',\n   142→    label: 'Hairline',\n   143→    medicalTerm: 'Trichion (frontal view)',\n   144→    description: 'Anterior hairline at midline',\n   145→    x: 0.5,\n   146→    y: 0.08,\n   147→    category: 'Head',\n   148→  },\n   149→\n   150→  // Eyes - Left\n   151→  {\n   152→    id: 'left_pupila',\n   153→    label: 'Left Pupil',\n   154→    medicalTerm: 'Left Pupila',\n   155→    description: 'Center of left pupil',\n   156→    x: 0.38,\n   157→    y: 0.35,\n   158→    category: 'Eyes - Left',\n   159→  },\n   160→  {\n   161→    id: 'left_canthus_medialis',\n   162→    label: 'Left Medial Canthus',\n   163→    medicalTerm: 'Left Canthus Medialis',\n   164→    description: 'Inner corner of left eye',\n   165→    x: 0.42,\n   166→    y: 0.35,\n   167→    category: 'Eyes - Left',\n   168→  },\n   169→  {\n   170→    id: 'left_canthus_lateralis',\n   171→    label: 'Left Lateral Canthus',\n   172→    medicalTerm: 'Left Canthus Lateralis',\n   173→    description: 'Outer corner of left eye',\n   174→    x: 0.32,\n   175→    y: 0.34,\n   176→    category: 'Eyes - Left',\n   177→  },\n   178→  {\n   179→    id: 'left_palpebra_superior',\n   180→    label: 'Left Upper Eyelid',\n   181→    medicalTerm: 'Left Palpebra Superior',\n   182→    description: 'Upper eyelid of left eye',\n   183→    x: 0.37,\n   184→    y: 0.33,\n   185→    category: 'Eyes - Left',\n   186→  },\n   187→  {\n   188→    id: 'left_palpebra_inferior',\n   189→    label: 'Left Lower Eyelid',\n   190→    medicalTerm: 'Left Palpebra Inferior',\n   191→    description: 'Lower eyelid of left eye',\n   192→    x: 0.37,\n   193→    y: 0.37,\n   194→    category: 'Eyes - Left',\n   195→  },\n   196→  {\n   197→    id: 'left_sulcus_palpebralis_lateralis',\n   198→    label: 'Left Eyelid Hood End',\n   199→    medicalTerm: 'Left Sulcus Palpebralis Lateralis',\n   200→    description: 'Lateral end of left upper eyelid crease',\n   201→    x: 0.31,\n   202→    y: 0.33,\n   203→    category: 'Eyes - Left',\n   204→  },\n   205→  {\n   206→    id: 'left_pretarsal_skin_crease',\n   207→    label: 'Left Upper Eyelid Crease',\n   208→    medicalTerm: 'Left Pretarsal Skin Crease',\n   209→    description: 'Left upper eyelid crease',\n   210→    x: 0.37,\n   211→    y: 0.32,\n   212→    category: 'Eyes - Left',\n   213→  },\n   214→\n   215→  // Eyes - Right\n   216→  {\n   217→    id: 'right_pupila',\n   218→    label: 'Right Pupil',\n   219→    medicalTerm: 'Right Pupila',\n   220→    description: 'Center of right pupil',\n   221→    x: 0.62,\n   222→    y: 0.35,\n   223→    category: 'Eyes - Right',\n   224→  },\n   225→  {\n   226→    id: 'right_canthus_medialis',\n   227→    label: 'Right Medial Canthus',\n   228→    medicalTerm: 'Right Canthus Medialis',\n   229→    description: 'Inner corner of right eye',\n   230→    x: 0.58,\n   231→    y: 0.35,\n   232→    category: 'Eyes - Right',\n   233→  },\n   234→  {\n   235→    id: 'right_canthus_lateralis',\n   236→    label: 'Right Lateral Canthus',\n   237→    medicalTerm: 'Right Canthus Lateralis',\n   238→    description: 'Outer corner of right eye',\n   239→    x: 0.68,\n   240→    y: 0.34,\n   241→    category: 'Eyes - Right',\n   242→  },\n   243→  {\n   244→    id: 'right_palpebra_superior',\n   245→    label: 'Right Upper Eyelid',\n   246→    medicalTerm: 'Right Palpebra Superior',\n   247→    description: 'Upper eyelid of right eye',\n   248→    x: 0.63,\n   249→    y: 0.33,\n   250→    category: 'Eyes - Right',\n   251→  },\n   252→  {\n   253→    id: 'right_palpebra_inferior',\n   254→    label: 'Right Lower Eyelid',\n   255→    medicalTerm: 'Right Palpebra Inferior',\n   256→    description: 'Lower eyelid of right eye',\n   257→    x: 0.63,\n   258→    y: 0.37,\n   259→    category: 'Eyes - Right',\n   260→  },\n   261→  {\n   262→    id: 'right_sulcus_palpebralis_lateralis',\n   263→    label: 'Right Eyelid Hood End',\n   264→    medicalTerm: 'Right Sulcus Palpebralis Lateralis',\n   265→    description: 'Lateral end of right upper eyelid crease',\n   266→    x: 0.69,\n   267→    y: 0.33,\n   268→    category: 'Eyes - Right',\n   269→  },\n   270→  {\n   271→    id: 'right_pretarsal_skin_crease',\n   272→    label: 'Right Upper Eyelid Crease',\n   273→    medicalTerm: 'Right Pretarsal Skin Crease',\n   274→    description: 'Right upper eyelid crease',\n   275→    x: 0.63,\n   276→    y: 0.32,\n   277→    category: 'Eyes - Right',\n   278→  },\n   279→\n   280→  // Eyebrows - Left\n   281→  {\n   282→    id: 'left_supercilium_medialis',\n   283→    label: 'Left Brow Head',\n   284→    medicalTerm: 'Left Supercilium Medialis',\n   285→    description: 'Medial start of left eyebrow',\n   286→    x: 0.43,\n   287→    y: 0.28,\n   288→    category: 'Eyebrows - Left',\n   289→  },\n   290→  {\n   291→    id: 'left_supercilium_medial_corner',\n   292→    label: 'Left Brow Inner Corner',\n   293→    medicalTerm: 'Left Supercilium Medial Corner',\n   294→    description: 'Inner corner of left eyebrow',\n   295→    x: 0.41,\n   296→    y: 0.27,\n   297→    category: 'Eyebrows - Left',\n   298→  },\n   299→  {\n   300→    id: 'left_supercilium_superior',\n   301→    label: 'Left Brow Arch',\n   302→    medicalTerm: 'Left Supercilium Superior',\n   303→    description: 'Superior arc of left eyebrow',\n   304→    x: 0.36,\n   305→    y: 0.26,\n   306→    category: 'Eyebrows - Left',\n   307→  },\n   308→  {\n   309→    id: 'left_supercilium_apex',\n   310→    label: 'Left Brow Peak',\n   311→    medicalTerm: 'Left Supercilium Apex',\n   312→    description: 'Highest point of left eyebrow',\n   313→    x: 0.34,\n   314→    y: 0.26,\n   315→    category: 'Eyebrows - Left',\n   316→  },\n   317→  {\n   318→    id: 'left_supercilium_lateralis',\n   319→    label: 'Left Brow Tail',\n   320→    medicalTerm: 'Left Supercilium Lateralis',\n   321→    description: 'Lateral end of left eyebrow',\n   322→    x: 0.29,\n   323→    y: 0.28,\n   324→    category: 'Eyebrows - Left',\n   325→  },\n   326→\n   327→  // Eyebrows - Right\n   328→  {\n   329→    id: 'right_supercilium_medialis',\n   330→    label: 'Right Brow Head',\n   331→    medicalTerm: 'Right Supercilium Medialis',\n   332→    description: 'Medial start of right eyebrow',\n   333→    x: 0.57,\n   334→    y: 0.28,\n   335→    category: 'Eyebrows - Right',\n   336→  },\n   337→  {\n   338→    id: 'right_supercilium_medial_corner',\n   339→    label: 'Right Brow Inner Corner',\n   340→    medicalTerm: 'Right Supercilium Medial Corner',\n   341→    description: 'Inner corner of right eyebrow',\n   342→    x: 0.59,\n   343→    y: 0.27,\n   344→    category: 'Eyebrows - Right',\n   345→  },\n   346→  {\n   347→    id: 'right_supercilium_superior',\n   348→    label: 'Right Brow Arch',\n   349→    medicalTerm: 'Right Supercilium Superior',\n   350→    description: 'Superior arc of right eyebrow',\n   351→    x: 0.64,\n   352→    y: 0.26,\n   353→    category: 'Eyebrows - Right',\n   354→  },\n   355→  {\n   356→    id: 'right_supercilium_apex',\n   357→    label: 'Right Brow Peak',\n   358→    medicalTerm: 'Right Supercilium Apex',\n   359→    description: 'Highest point of right eyebrow',\n   360→    x: 0.66,\n   361→    y: 0.26,\n   362→    category: 'Eyebrows - Right',\n   363→  },\n   364→  {\n   365→    id: 'right_supercilium_lateralis',\n   366→    label: 'Right Brow Tail',\n   367→    medicalTerm: 'Right Supercilium Lateralis',\n   368→    description: 'Lateral end of right eyebrow',\n   369→    x: 0.71,\n   370→    y: 0.28,\n   371→    category: 'Eyebrows - Right',\n   372→  },\n   373→\n   374→  // Nose\n   375→  {\n   376→    id: 'nasal_base',\n   377→    label: 'Nasal Base',\n   378→    medicalTerm: 'Nasal Base',\n   379→    description: 'Base of nasal dorsum',\n   380→    x: 0.5,\n   381→    y: 0.38,\n   382→    category: 'Nose',\n   383→  },\n   384→  {\n   385→    id: 'left_dorsum_nasi',\n   386→    label: 'Left Nose Bridge',\n   387→    medicalTerm: 'Left Dorsum Nasi',\n   388→    description: 'Left side of nasal bridge',\n   389→    x: 0.47,\n   390→    y: 0.42,\n   391→    category: 'Nose',\n   392→  },\n   393→  {\n   394→    id: 'right_dorsum_nasi',\n   395→    label: 'Right Nose Bridge',\n   396→    medicalTerm: 'Right Dorsum Nasi',\n   397→    description: 'Right side of nasal bridge',\n   398→    x: 0.53,\n   399→    y: 0.42,\n   400→    category: 'Nose',\n   401→  },\n   402→  {\n   403→    id: 'left_ala_nasi',\n   404→    label: 'Left Nose Side',\n   405→    medicalTerm: 'Left Ala Nasi',\n   406→    description: 'Lateral aspect of left nasal ala',\n   407→    x: 0.44,\n   408→    y: 0.5,\n   409→    category: 'Nose',\n   410→  },\n   411→  {\n   412→    id: 'right_ala_nasi',\n   413→    label: 'Right Nose Side',\n   414→    medicalTerm: 'Right Ala Nasi',\n   415→    description: 'Lateral aspect of right nasal ala',\n   416→    x: 0.56,\n   417→    y: 0.5,\n   418→    category: 'Nose',\n   419→  },\n   420→  {\n   421→    id: 'subnasale',\n   422→    label: 'Nose Bottom',\n   423→    medicalTerm: 'Subnasale',\n   424→    description: 'Junction of columella and upper lip',\n   425→    x: 0.5,\n   426→    y: 0.52,\n   427→    category: 'Nose',\n   428→  },\n   429→\n   430→  // Mouth\n   431→  {\n   432→    id: 'labrale_superius',\n   433→    label: \"Cupid's Bow\",\n   434→    medicalTerm: 'Labrale Superius',\n   435→    description: 'Midpoint of upper lip vermilion',\n   436→    x: 0.5,\n   437→    y: 0.58,\n   438→    category: 'Mouth',\n   439→  },\n   440→  {\n   441→    id: 'cupids_bow',\n   442→    label: \"Inner Cupid's Bow\",\n   443→    medicalTerm: \"Cupid's Bow\",\n   444→    description: 'Central peak of upper lip',\n   445→    x: 0.5,\n   446→    y: 0.57,\n   447→    category: 'Mouth',\n   448→  },\n   449→  {\n   450→    id: 'mouth_middle',\n   451→    label: 'Mouth Middle',\n   452→    medicalTerm: 'Mouth Middle',\n   453→    description: 'Center of mouth opening',\n   454→    x: 0.5,\n   455→    y: 0.62,\n   456→    category: 'Mouth',\n   457→  },\n   458→  {\n   459→    id: 'labrale_inferius',\n   460→    label: 'Lower Lip Center',\n   461→    medicalTerm: 'Labrale Inferius',\n   462→    description: 'Midpoint of lower lip vermilion border',\n   463→    x: 0.5,\n   464→    y: 0.66,\n   465→    category: 'Mouth',\n   466→  },\n   467→  {\n   468→    id: 'left_cheilion',\n   469→    label: 'Left Mouth Corner',\n   470→    medicalTerm: 'Left Cheilion',\n   471→    description: 'Left oral commissure',\n   472→    x: 0.42,\n   473→    y: 0.62,\n   474→    category: 'Mouth',\n   475→  },\n   476→  {\n   477→    id: 'right_cheilion',\n   478→    label: 'Right Mouth Corner',\n   479→    medicalTerm: 'Right Cheilion',\n   480→    description: 'Right oral commissure',\n   481→    x: 0.58,\n   482→    y: 0.62,\n   483→    category: 'Mouth',\n   484→  },\n   485→\n   486→  // Jaw\n   487→  {\n   488→    id: 'left_gonion_superior',\n   489→    label: 'Left Upper Jaw Angle',\n   490→    medicalTerm: 'Left Gonion Superior',\n   491→    description: 'Superior aspect of left mandibular angle',\n   492→    x: 0.22,\n   493→    y: 0.55,\n   494→    category: 'Jaw',\n   495→  },\n   496→  {\n   497→    id: 'right_gonion_superior',\n   498→    label: 'Right Upper Jaw Angle',\n   499→    medicalTerm: 'Right Gonion Superior',\n   500→    description: 'Superior aspect of right mandibular angle',\n   501→    x: 0.78,\n   502→    y: 0.55,\n   503→    category: 'Jaw',\n   504→  },\n   505→  {\n   506→    id: 'left_gonion_inferior',\n   507→    label: 'Left Lower Jaw Angle',\n   508→    medicalTerm: 'Left Gonion Inferior',\n   509→    description: 'Inferior aspect of left mandibular angle',\n   510→    x: 0.24,\n   511→    y: 0.7,\n   512→    category: 'Jaw',\n   513→  },\n   514→  {\n   515→    id: 'right_gonion_inferior',\n   516→    label: 'Right Lower Jaw Angle',\n   517→    medicalTerm: 'Right Gonion Inferior',\n   518→    description: 'Inferior aspect of right mandibular angle',\n   519→    x: 0.76,\n   520→    y: 0.7,\n   521→    category: 'Jaw',\n   522→  },\n   523→\n   524→  // Chin\n   525→  {\n   526→    id: 'left_mentum_lateralis',\n   527→    label: 'Left Chin',\n   528→    medicalTerm: 'Left Mentum Lateralis',\n   529→    description: 'Left lateral chin',\n   530→    x: 0.42,\n   531→    y: 0.8,\n   532→    category: 'Chin',\n   533→  },\n   534→  {\n   535→    id: 'right_mentum_lateralis',\n   536→    label: 'Right Chin',\n   537→    medicalTerm: 'Right Mentum Lateralis',\n   538→    description: 'Right lateral chin',\n   539→    x: 0.58,\n   540→    y: 0.8,\n   541→    category: 'Chin',\n   542→  },\n   543→  {\n   544→    id: 'menton',\n   545→    label: 'Chin Bottom',\n   546→    medicalTerm: 'Menton',\n   547→    description: 'Lowest point of chin in midline',\n   548→    x: 0.5,\n   549→    y: 0.88,\n   550→    category: 'Chin',\n   551→  },\n   552→\n   553→  // Face Width\n   554→  {\n   555→    id: 'left_zygion',\n   556→    label: 'Left Cheekbone',\n   557→    medicalTerm: 'Left Zygion',\n   558→    description: 'Most lateral point of left zygomatic arch',\n   559→    x: 0.18,\n   560→    y: 0.42,\n   561→    category: 'Face Width',\n   562→  },\n   563→  {\n   564→    id: 'right_zygion',\n   565→    label: 'Right Cheekbone',\n   566→    medicalTerm: 'Right Zygion',\n   567→    description: 'Most lateral point of right zygomatic arch',\n   568→    x: 0.82,\n   569→    y: 0.42,\n   570→    category: 'Face Width',\n   571→  },\n   572→  {\n   573→    id: 'left_temporal',\n   574→    label: 'Left Temple',\n   575→    medicalTerm: 'Left Temporal Point',\n   576→    description: 'Left temporal region',\n   577→    x: 0.2,\n   578→    y: 0.3,\n   579→    category: 'Face Width',\n   580→  },\n   581→  {\n   582→    id: 'right_temporal',\n   583→    label: 'Right Temple',\n   584→    medicalTerm: 'Right Temporal Point',\n   585→    description: 'Right temporal region',\n   586→    x: 0.8,\n   587→    y: 0.3,\n   588→    category: 'Face Width',\n   589→  },\n   590→  {\n   591→    id: 'left_auricular_lateral',\n   592→    label: 'Left Outer Ear',\n   593→    medicalTerm: 'Left Auricular Lateral Point',\n   594→    description: 'Lateral-most point of left ear',\n   595→    x: 0.12,\n   596→    y: 0.4,\n   597→    category: 'Face Width',\n   598→  },\n   599→  {\n   600→    id: 'right_auricular_lateral',\n   601→    label: 'Right Outer Ear',\n   602→    medicalTerm: 'Right Auricular Lateral Point',\n   603→    description: 'Lateral-most point of right ear',\n   604→    x: 0.88,\n   605→    y: 0.4,\n   606→    category: 'Face Width',\n   607→  },\n   608→\n   609→  // Neck\n   610→  {\n   611→    id: 'left_cervical_lateralis',\n   612→    label: 'Left Neck Point',\n   613→    medicalTerm: 'Left Cervical Lateralis',\n   614→    description: 'Left cervical point',\n   615→    x: 0.35,\n   616→    y: 0.95,\n   617→    category: 'Neck',\n   618→  },\n   619→  {\n   620→    id: 'right_cervical_lateralis',\n   621→    label: 'Right Neck Point',\n   622→    medicalTerm: 'Right Cervical Lateralis',\n   623→    description: 'Right cervical point',\n   624→    x: 0.65,\n   625→    y: 0.95,\n   626→    category: 'Neck',\n   627→  },\n   628→];\n   629→\n   630→// ============================================\n   631→// SIDE PROFILE LANDMARKS (38 Points)\n   632→// ============================================\n   633→\n   634→export const SIDE_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n   635→  {\n   636→    name: 'Cranium',\n   637→    color: '#FF6B6B',\n   638→    landmarks: ['vertex', 'external_occipital_region', 'trichion_profile'],\n   639→  },\n   640→  {\n   641→    name: 'Forehead',\n   642→    color: '#4ECDC4',\n   643→    landmarks: ['frontalis', 'glabella'],\n   644→  },\n   645→  {\n   646→    name: 'Eye Region',\n   647→    color: '#45B7D1',\n   648→    landmarks: [\n   649→      'corneal_apex',\n   650→      'lateral_eyelid',\n   651→      'palpebra_inferior_side',\n   652→      'orbitale',\n   653→    ],\n   654→  },\n   655→  {\n   656→    name: 'Nose',\n   657→    color: '#FFEAA7',\n   658→    landmarks: [\n   659→      'nasion',\n   660→      'rhinion',\n   661→      'supratip_break',\n   662→      'pronasale',\n   663→      'infratip_lobule',\n   664→      'columella_nasi',\n   665→      'subnasale_side',\n   666→      'subalare',\n   667→    ],\n   668→  },\n   669→  {\n   670→    name: 'Lips',\n   671→    color: '#DDA0DD',\n   672→    landmarks: [\n   673→      'labrale_superius_side',\n   674→      'cheilion_side',\n   675→      'labrale_inferius_side',\n   676→      'sublabiale',\n   677→    ],\n   678→  },\n   679→  {\n   680→    name: 'Chin',\n   681→    color: '#E74C3C',\n   682→    landmarks: ['pogonion', 'menton_side'],\n   683→  },\n   684→  {\n   685→    name: 'Jaw',\n   686→    color: '#F39C12',\n   687→    landmarks: ['gonion_superior_side', 'gonion_inferior_side'],\n   688→  },\n   689→  {\n   690→    name: 'Cheek',\n   691→    color: '#9B59B6',\n   692→    landmarks: ['zygion_soft_tissue'],\n   693→  },\n   694→  {\n   695→    name: 'Ear',\n   696→    color: '#3498DB',\n   697→    landmarks: ['porion', 'tragion', 'incisura_intertragica'],\n   698→  },\n   699→  {\n   700→    name: 'Neck',\n   701→    color: '#1ABC9C',\n   702→    landmarks: ['cervicale', 'anterior_cervical_landmark'],\n   703→  },\n   704→];\n   705→\n   706→export const SIDE_PROFILE_LANDMARKS: LandmarkPoint[] = [\n   707→  // Cranium\n   708→  {\n   709→    id: 'vertex',\n   710→    label: 'Top of Head',\n   711→    medicalTerm: 'Vertex',\n   712→    description: 'Highest point of cranium',\n   713→    x: 0.45,\n   714→    y: 0.02,\n   715→    category: 'Cranium',\n   716→  },\n   717→  {\n   718→    id: 'external_occipital_region',\n   719→    label: 'Occiput',\n   720→    medicalTerm: 'External Occipital Region',\n   721→    description: 'Back of skull',\n   722→    x: 0.85,\n   723→    y: 0.15,\n   724→    category: 'Cranium',\n   725→  },\n   726→  {\n   727→    id: 'trichion_profile',\n   728→    label: 'Hairline (profile)',\n   729→    medicalTerm: 'Trichion',\n   730→    description: 'Anterior hairline (profile view)',\n   731→    x: 0.35,\n   732→    y: 0.1,\n   733→    category: 'Cranium',\n   734→  },\n   735→\n   736→  // Forehead\n   737→  {\n   738→    id: 'frontalis',\n   739→    label: 'Forehead',\n   740→    medicalTerm: 'Frontalis',\n   741→    description: 'Forehead region',\n   742→    x: 0.3,\n   743→    y: 0.18,\n   744→    category: 'Forehead',\n   745→  },\n   746→  {\n   747→    id: 'glabella',\n   748→    label: 'Glabella',\n   749→    medicalTerm: 'Glabella',\n   750→    description: 'Most prominent point between eyebrows',\n   751→    x: 0.32,\n   752→    y: 0.28,\n   753→    category: 'Forehead',\n   754→  },\n   755→\n   756→  // Eye Region\n   757→  {\n   758→    id: 'corneal_apex',\n   759→    label: 'Corneal Apex',\n   760→    medicalTerm: 'Corneal Apex',\n   761→    description: 'Most anterior point of cornea',\n   762→    x: 0.28,\n   763→    y: 0.34,\n   764→    category: 'Eye Region',\n   765→  },\n   766→  {\n   767→    id: 'lateral_eyelid',\n   768→    label: 'Eyelid End',\n   769→    medicalTerm: 'Lateral Eyelid',\n   770→    description: 'Lateral extent of palpebral fissure',\n   771→    x: 0.35,\n   772→    y: 0.34,\n   773→    category: 'Eye Region',\n   774→  },\n   775→  {\n   776→    id: 'palpebra_inferior_side',\n   777→    label: 'Lower Eyelid',\n   778→    medicalTerm: 'Left Palpebra Inferior',\n   779→    description: 'Lower eyelid margin (profile view)',\n   780→    x: 0.3,\n   781→    y: 0.36,\n   782→    category: 'Eye Region',\n   783→  },\n   784→  {\n   785→    id: 'orbitale',\n   786→    label: 'Orbitale',\n   787→    medicalTerm: 'Orbitale',\n   788→    description: 'Lowest point of infraorbital margin',\n   789→    x: 0.35,\n   790→    y: 0.38,\n   791→    category: 'Eye Region',\n   792→  },\n   793→\n   794→  // Nose\n   795→  {\n   796→    id: 'nasion',\n   797→    label: 'Nasal Bridge Front',\n   798→    medicalTerm: 'Nasion',\n   799→    description: 'Deepest point of nasal root',\n   800→    x: 0.35,\n   801→    y: 0.32,\n   802→    category: 'Nose',\n   803→  },\n   804→  {\n   805→    id: 'rhinion',\n   806→    label: 'Rhinion',\n   807→    medicalTerm: 'Rhinion',\n   808→    description: 'Junction of bony and cartilaginous nose',\n   809→    x: 0.28,\n   810→    y: 0.4,\n   811→    category: 'Nose',\n   812→  },\n   813→  {\n   814→    id: 'supratip_break',\n   815→    label: 'Supratip',\n   816→    medicalTerm: 'Supratip Break',\n   817→    description: 'Depression above nasal tip',\n   818→    x: 0.22,\n   819→    y: 0.46,\n   820→    category: 'Nose',\n   821→  },\n   822→  {\n   823→    id: 'pronasale',\n   824→    label: 'Nose Tip',\n   825→    medicalTerm: 'Pronasale',\n   826→    description: 'Most anterior point of nasal tip',\n   827→    x: 0.18,\n   828→    y: 0.48,\n   829→    category: 'Nose',\n   830→  },\n   831→  {\n   832→    id: 'infratip_lobule',\n   833→    label: 'Infratip',\n   834→    medicalTerm: 'Infratip Lobule',\n   835→    description: 'Area below nasal tip',\n   836→    x: 0.2,\n   837→    y: 0.5,\n   838→    category: 'Nose',\n   839→  },\n   840→  {\n   841→    id: 'columella_nasi',\n   842→    label: 'Columella',\n   843→    medicalTerm: 'Columella Nasi',\n   844→    description: 'Fleshy external end of nasal septum',\n   845→    x: 0.24,\n   846→    y: 0.52,\n   847→    category: 'Nose',\n   848→  },\n   849→  {\n   850→    id: 'subnasale_side',\n   851→    label: 'Subnasale',\n   852→    medicalTerm: 'Subnasale',\n   853→    description: 'Junction of columella and upper lip',\n   854→    x: 0.3,\n   855→    y: 0.54,\n   856→    category: 'Nose',\n   857→  },\n   858→  {\n   859→    id: 'subalare',\n   860→    label: 'Subalare',\n   861→    medicalTerm: 'Subalare',\n   862→    description: 'Junction of alar base and upper lip',\n   863→    x: 0.28,\n   864→    y: 0.53,\n   865→    category: 'Nose',\n   866→  },\n   867→\n   868→  // Lips\n   869→  {\n   870→    id: 'labrale_superius_side',\n   871→    label: 'Upper Lip',\n   872→    medicalTerm: 'Labrale Superius',\n   873→    description: 'Upper lip vermilion border',\n   874→    x: 0.28,\n   875→    y: 0.58,\n   876→    category: 'Lips',\n   877→  },\n   878→  {\n   879→    id: 'cheilion_side',\n   880→    label: 'Mouth Corner',\n   881→    medicalTerm: 'Cheilion',\n   882→    description: 'Oral commissure (profile view)',\n   883→    x: 0.35,\n   884→    y: 0.62,\n   885→    category: 'Lips',\n   886→  },\n   887→  {\n   888→    id: 'labrale_inferius_side',\n   889→    label: 'Lower Lip',\n   890→    medicalTerm: 'Labrale Inferius',\n   891→    description: 'Lower lip vermilion border',\n   892→    x: 0.3,\n   893→    y: 0.66,\n   894→    category: 'Lips',\n   895→  },\n   896→  {\n   897→    id: 'sublabiale',\n   898→    label: 'Labiomental Fold',\n   899→    medicalTerm: 'Sublabiale',\n   900→    description: 'Deepest point of labiomental sulcus',\n   901→    x: 0.32,\n   902→    y: 0.7,\n   903→    category: 'Lips',\n   904→  },\n   905→\n   906→  // Chin\n   907→  {\n   908→    id: 'pogonion',\n   909→    label: 'Chin Point',\n   910→    medicalTerm: 'Pogonion (soft tissue)',\n   911→    description: 'Most anterior point of chin',\n   912→    x: 0.3,\n   913→    y: 0.76,\n   914→    category: 'Chin',\n   915→  },\n   916→  {\n   917→    id: 'menton_side',\n   918→    label: 'Chin Bottom',\n   919→    medicalTerm: 'Menton (soft tissue)',\n   920→    description: 'Lowest point of chin',\n   921→    x: 0.35,\n   922→    y: 0.82,\n   923→    category: 'Chin',\n   924→  },\n   925→\n   926→  // Jaw\n   927→  {\n   928→    id: 'gonion_superior_side',\n   929→    label: 'Upper Jaw Angle',\n   930→    medicalTerm: 'Gonion Superior',\n   931→    description: 'Superior mandibular angle',\n   932→    x: 0.7,\n   933→    y: 0.6,\n   934→    category: 'Jaw',\n   935→  },\n   936→  {\n   937→    id: 'gonion_inferior_side',\n   938→    label: 'Lower Jaw Angle',\n   939→    medicalTerm: 'Gonion Inferior',\n   940→    description: 'Inferior mandibular angle',\n   941→    x: 0.65,\n   942→    y: 0.72,\n   943→    category: 'Jaw',\n   944→  },\n   945→\n   946→  // Cheek\n   947→  {\n   948→    id: 'zygion_soft_tissue',\n   949→    label: 'Cheekbone',\n   950→    medicalTerm: 'Zygion (soft tissue over zygoma)',\n   951→    description: 'Soft tissue over zygomatic arch',\n   952→    x: 0.45,\n   953→    y: 0.42,\n   954→    category: 'Cheek',\n   955→  },\n   956→\n   957→  // Ear\n   958→  {\n   959→    id: 'porion',\n   960→    label: 'Porion',\n   961→    medicalTerm: 'Porion (soft tissue)',\n   962→    description: 'Superior aspect of external auditory meatus',\n   963→    x: 0.75,\n   964→    y: 0.35,\n   965→    category: 'Ear',\n   966→  },\n   967→  {\n   968→    id: 'tragion',\n   969→    label: 'Tragus',\n   970→    medicalTerm: 'Tragion (soft tissue)',\n   971→    description: 'Superior margin of tragus',\n   972→    x: 0.72,\n   973→    y: 0.42,\n   974→    category: 'Ear',\n   975→  },\n   976→  {\n   977→    id: 'incisura_intertragica',\n   978→    label: 'Intertragic Notch',\n   979→    medicalTerm: 'Incisura Intertragica',\n   980→    description: 'Notch between tragus and antitragus',\n   981→    x: 0.73,\n   982→    y: 0.45,\n   983→    category: 'Ear',\n   984→  },\n   985→\n   986→  // Neck\n   987→  {\n   988→    id: 'cervicale',\n   989→    label: 'Cervical Point',\n   990→    medicalTerm: 'Cervicale (soft tissue reference)',\n   991→    description: 'Cervical point for profile analysis',\n   992→    x: 0.5,\n   993→    y: 0.9,\n   994→    category: 'Neck',\n   995→  },\n   996→  {\n   997→    id: 'anterior_cervical_landmark',\n   998→    label: 'Neck Point',\n   999→    medicalTerm: 'Anterior Cervical Landmark',\n  1000→    description: 'Anterior neck landmark',\n  1001→    x: 0.4,\n  1002→    y: 0.88,\n  1003→    category: 'Neck',\n  1004→  },\n  1005→];\n  1006→\n  1007→// ============================================\n  1008→// MediaPipe Face Mesh Index Mapping\n  1009→// ============================================\n  1010→\n  1011→// Maps our landmark IDs to MediaPipe Face Mesh indices (478 points)\n  1012→export const MEDIAPIPE_FRONT_MAPPING: Record<string, number> = {\n  1013→  // Eyes - using iris landmarks for pupils\n  1014→  left_pupila: 468, // Left iris center\n  1015→  right_pupila: 473, // Right iris center\n  1016→\n  1017→  // Eye corners (using eye contour landmarks)\n  1018→  left_canthus_medialis: 133, // Inner corner left eye\n  1019→  left_canthus_lateralis: 33, // Outer corner left eye\n  1020→  right_canthus_medialis: 362, // Inner corner right eye\n  1021→  right_canthus_lateralis: 263, // Outer corner right eye\n  1022→\n  1023→  // Eyelids\n  1024→  left_palpebra_superior: 159, // Upper eyelid left\n  1025→  left_palpebra_inferior: 145, // Lower eyelid left\n  1026→  right_palpebra_superior: 386, // Upper eyelid right\n  1027→  right_palpebra_inferior: 374, // Lower eyelid right\n  1028→\n  1029→  // Eyebrows\n  1030→  left_supercilium_medialis: 107, // Left brow inner\n  1031→  left_supercilium_apex: 105, // Left brow peak\n  1032→  left_supercilium_lateralis: 70, // Left brow outer\n  1033→  right_supercilium_medialis: 336, // Right brow inner\n  1034→  right_supercilium_apex: 334, // Right brow peak\n  1035→  right_supercilium_lateralis: 300, // Right brow outer\n  1036→\n  1037→  // Nose\n  1038→  nasal_base: 6, // Nose bridge\n  1039→  left_ala_nasi: 219, // Left nostril\n  1040→  right_ala_nasi: 439, // Right nostril\n  1041→  subnasale: 2, // Base of nose\n  1042→\n  1043→  // Mouth\n  1044→  labrale_superius: 0, // Upper lip center\n  1045→  labrale_inferius: 17, // Lower lip center\n  1046→  left_cheilion: 61, // Left mouth corner\n  1047→  right_cheilion: 291, // Right mouth corner\n  1048→  mouth_middle: 13, // Mouth center\n  1049→\n  1050→  // Jaw\n  1051→  left_gonion_inferior: 172, // Left jaw angle\n  1052→  right_gonion_inferior: 397, // Right jaw angle\n  1053→\n  1054→  // Chin\n  1055→  menton: 152, // Chin bottom\n  1056→\n  1057→  // Face silhouette (for zygion)\n  1058→  left_zygion: 234, // Left cheekbone\n  1059→  right_zygion: 454, // Right cheekbone\n  1060→};\n  1061→\n  1062→// Helper to get category color for a landmark\n  1063→export function getLandmarkColor(\n  1064→  landmarkId: string,\n  1065→  categories: LandmarkCategory[]\n  1066→): string {\n  1067→  for (const category of categories) {\n  1068→    if (category.landmarks.includes(landmarkId)) {\n  1069→      return category.color;\n  1070→    }\n  1071→  }\n  1072→  return '#00f3ff'; // Default cyan\n  1073→}\n  1074→\n  1075→// ============================================\n  1076→// FaceIQ Side Profile Landmark Indices (106 points)\n  1077→// Reverse-engineered from FaceIQ Labs API\n  1078→// ============================================\n  1079→\n  1080→export const FACEIQ_SIDE_LANDMARKS = {\n  1081→  // Face Contour (0-16) - Jaw/Chin outline\n  1082→  MENTON: 0, // Chin bottom (lowest point)\n  1083→  POGONION: 2, // Chin prominence\n  1084→  GNATHION: 3, // Chin point\n  1085→  MANDIBLE_CONTOUR: [2, 3, 4, 5, 6, 7, 8], // Jaw line\n  1086→\n  1087→  // Posterior Points (1, 9-16) - Ear/Back of head\n  1088→  TRAGION: 1, // Ear point\n  1089→  EAR_CONTOUR: [9, 10, 11, 12, 13, 14, 15, 16],\n  1090→\n  1091→  // Forehead/Hairline (17)\n  1092→  TRICHION: 17, // Hairline\n  1093→\n  1094→  // Nose Profile (18-32)\n  1095→  NASION: 25, // Bridge of nose (deepest point)\n  1096→  PRONASALE: 32, // Nose tip\n  1097→  SUBNASALE: 52, // Base of nose\n  1098→  COLUMELLA: 53, // Nose columella\n  1099→  NOSE_BRIDGE: [25, 26, 27, 28, 29, 30, 31, 32],\n  1100→  NOSE_TIP_CONTOUR: [52, 53, 54, 55, 56, 57, 58, 59, 60],\n  1101→\n  1102→  // Eye Region (33-51)\n  1103→  EYE_LATERAL_CANTHUS: 33, // Outer eye corner\n  1104→  EYE_MEDIAL_CANTHUS: 35, // Inner eye corner\n  1105→  UPPER_EYELID: [37, 38, 39],\n  1106→  LOWER_EYELID: [40, 41, 42],\n  1107→  PUPIL: 34,\n  1108→  BROW_HEAD: 44, // Inner brow\n  1109→  BROW_ARCH: 45, // Brow peak\n  1110→  BROW_TAIL: 46, // Outer brow\n  1111→\n  1112→  // Lip Region (52-75)\n  1113→  LABRALE_SUPERIUS: 63, // Upper lip top\n  1114→  LABRALE_INFERIUS: 66, // Lower lip bottom\n  1115→  STOMION: 65, // Lip meeting point\n  1116→  UPPER_LIP_CONTOUR: [63, 64, 65],\n  1117→  LOWER_LIP_CONTOUR: [66, 67, 68],\n  1118→\n  1119→  // Additional Profile Points (76-105)\n  1120→  GLABELLA: 76, // Between eyebrows\n  1121→  SELLION: 77, // Deepest point of nasal bridge\n  1122→  SOFT_TISSUE_NASION: 78,\n  1123→  ORBITALE: 79, // Lowest point of eye socket\n  1124→  GONION: 85, // Jaw angle\n  1125→  CONDYLION: 86, // Top of jaw joint\n  1126→};\n  1127→\n  1128→// ============================================\n  1129→// FaceIQ Front Face Landmark Indices (MediaPipe 478 points)\n  1130→// ============================================\n  1131→\n  1132→export const FACEIQ_FRONT_LANDMARKS = {\n  1133→  // Key points from MediaPipe Face Mesh\n  1134→  NOSE_TIP: 1,\n  1135→  LEFT_EYE_INNER: 133,\n  1136→  LEFT_EYE_OUTER: 33,\n  1137→  RIGHT_EYE_INNER: 362,\n  1138→  RIGHT_EYE_OUTER: 263,\n  1139→  LEFT_CHEEK: 234,\n  1140→  RIGHT_CHEEK: 454,\n  1141→  UPPER_LIP: 13,\n  1142→  LOWER_LIP: 14,\n  1143→  CHIN: 152,\n  1144→  FOREHEAD: 10,\n  1145→  LEFT_EAR: 234,\n  1146→  RIGHT_EAR: 454,\n  1147→  LEFT_BROW_INNER: 107,\n  1148→  LEFT_BROW_OUTER: 70,\n  1149→  RIGHT_BROW_INNER: 336,\n  1150→  RIGHT_BROW_OUTER: 300,\n  1151→  NOSE_BRIDGE: 6,\n  1152→  LEFT_NOSTRIL: 129,\n  1153→  RIGHT_NOSTRIL: 358,\n  1154→};\n  1155→\n  1156→// ============================================\n  1157→// Scoring Configuration Types\n  1158→// ============================================\n  1159→\n  1160→export interface ScoringConfig {\n  1161→  idealValue: number;\n  1162→  standardDeviation: number;\n  1163→  minScore: number;\n  1164→  maxScore: number;\n  1165→  weight: number;\n  1166→}\n  1167→\n  1168→export interface GenderSpecificValues {\n  1169→  male: { ideal: number; range: [number, number] };\n  1170→  female: { ideal: number; range: [number, number] };\n  1171→}\n  1172→\n  1173→// ============================================\n  1174→// FaceIQ Ideal Values (Gender-Specific)\n  1175→// ============================================\n  1176→\n  1177→export const FACEIQ_IDEAL_VALUES: Record<string, GenderSpecificValues> = {\n  1178→  fwhr: {\n  1179→    male: { ideal: 1.9, range: [1.8, 2.1] },\n  1180→    female: { ideal: 1.75, range: [1.6, 1.9] },\n  1181→  },\n  1182→  canthalTilt: {\n  1183→    male: { ideal: 4, range: [2, 7] },\n  1184→    female: { ideal: 6, range: [4, 10] },\n  1185→  },\n  1186→  nasolabialAngle: {\n  1187→    male: { ideal: 95, range: [90, 100] },\n  1188→    female: { ideal: 105, range: [100, 115] },\n  1189→  },\n  1190→  gonialAngle: {\n  1191→    male: { ideal: 125, range: [120, 130] },\n  1192→    female: { ideal: 128, range: [125, 135] },\n  1193→  },\n  1194→  nasalIndex: {\n  1195→    male: { ideal: 0.7, range: [0.65, 0.75] },\n  1196→    female: { ideal: 0.65, range: [0.6, 0.7] },\n  1197→  },\n  1198→  lipRatio: {\n  1199→    male: { ideal: 0.5, range: [0.4, 0.6] },\n  1200→    female: { ideal: 0.5, range: [0.45, 0.55] },\n  1201→  },\n  1202→  facialConvexity: {\n  1203→    male: { ideal: 170, range: [165, 175] },\n  1204→    female: { ideal: 168, range: [163, 173] },\n  1205→  },\n  1206→  chinProjection: {\n  1207→    male: { ideal: 0, range: [-3, 3] },\n  1208→    female: { ideal: -2, range: [-5, 1] },\n  1209→  },\n  1210→};\n  1211→\n  1212→// ============================================\n  1213→// FaceIQ Scoring Configurations\n  1214→// ============================================\n  1215→\n  1216→export const FACEIQ_SCORING_CONFIGS: Record<string, ScoringConfig> = {\n  1217→  fwhr: {\n  1218→    idealValue: 1.9,\n  1219→    standardDeviation: 0.15,\n  1220→    minScore: 0,\n  1221→    maxScore: 100,\n  1222→    weight: 0.15,\n  1223→  },\n  1224→  canthalTilt: {\n  1225→    idealValue: 6,\n  1226→    standardDeviation: 3,\n  1227→    minScore: 0,\n  1228→    maxScore: 100,\n  1229→    weight: 0.1,\n  1230→  },\n  1231→  facialThirds: {\n  1232→    idealValue: 33.33,\n  1233→    standardDeviation: 3,\n  1234→    minScore: 0,\n  1235→    maxScore: 100,\n  1236→    weight: 0.1,\n  1237→  },\n  1238→  nasolabialAngle: {\n  1239→    idealValue: 102,\n  1240→    standardDeviation: 8,\n  1241→    minScore: 0,\n  1242→    maxScore: 100,\n  1243→    weight: 0.08,\n  1244→  },\n  1245→  gonialAngle: {\n  1246→    idealValue: 125,\n  1247→    standardDeviation: 5,\n  1248→    minScore: 0,\n  1249→    maxScore: 100,\n  1250→    weight: 0.08,\n  1251→  },\n  1252→  overallSymmetry: {\n  1253→    idealValue: 100,\n  1254→    standardDeviation: 5,\n  1255→    minScore: 0,\n  1256→    maxScore: 100,\n  1257→    weight: 0.15,\n  1258→  },\n  1259→  goldenRatio: {\n  1260→    idealValue: 1.618,\n  1261→    standardDeviation: 0.1,\n  1262→    minScore: 0,\n  1263→    maxScore: 100,\n  1264→    weight: 0.12,\n  1265→  },\n  1266→  nasalIndex: {\n  1267→    idealValue: 0.7,\n  1268→    standardDeviation: 0.08,\n  1269→    minScore: 0,\n  1270→    maxScore: 100,\n  1271→    weight: 0.06,\n  1272→  },\n  1273→  lipRatio: {\n  1274→    idealValue: 0.5,\n  1275→    standardDeviation: 0.1,\n  1276→    minScore: 0,\n  1277→    maxScore: 100,\n  1278→    weight: 0.06,\n  1279→  },\n  1280→  chinProjection: {\n  1281→    idealValue: 0,\n  1282→    standardDeviation: 3,\n  1283→    minScore: 0,\n  1284→    maxScore: 100,\n  1285→    weight: 0.05,\n  1286→  },\n  1287→  noseProjection: {\n  1288→    idealValue: 0.67,\n  1289→    standardDeviation: 0.05,\n  1290→    minScore: 0,\n  1291→    maxScore: 100,\n  1292→    weight: 0.05,\n  1293→  },\n  1294→};\n  1295→\n  1296→// ============================================\n  1297→// Population Statistics for Percentile Ranking\n  1298→// ============================================\n  1299→\n  1300→export interface PopulationStats {\n  1301→  mean: number;\n  1302→  standardDeviation: number;\n  1303→  sampleSize: number;\n  1304→}\n  1305→\n  1306→export const POPULATION_STATS: Record<string, PopulationStats> = {\n  1307→  harmonyScore: { mean: 65, standardDeviation: 12, sampleSize: 10000 },\n  1308→  fwhr: { mean: 1.85, standardDeviation: 0.2, sampleSize: 10000 },\n  1309→  canthalTilt: { mean: 4, standardDeviation: 4, sampleSize: 10000 },\n  1310→  symmetry: { mean: 85, standardDeviation: 8, sampleSize: 10000 },\n  1311→  goldenRatioMatch: { mean: 70, standardDeviation: 15, sampleSize: 10000 },\n  1312→};\n  1313→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"49390422-0f02-405d-9b1c-47e9f8f094d8","timestamp":"2025-12-19T05:50:25.189Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts","content":"/**\n * Facial Landmark Types and Default Data\n * Based on TECHNICAL_SPECS.md medical terminology\n */\n\nexport interface LandmarkPoint {\n  id: string;\n  label: string;\n  medicalTerm: string;\n  description: string;\n  x: number;\n  y: number;\n  category: string;\n}\n\nexport interface LandmarkCategory {\n  name: string;\n  color: string;\n  landmarks: string[];\n}\n\n// ============================================\n// FRONT PROFILE LANDMARKS (52 Points)\n// ============================================\n\nexport const FRONT_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n  {\n    name: 'Head',\n    color: '#FF6B6B',\n    landmarks: ['trichion'],\n  },\n  {\n    name: 'Eyes - Left',\n    color: '#4ECDC4',\n    landmarks: [\n      'left_pupila',\n      'left_canthus_medialis',\n      'left_canthus_lateralis',\n      'left_palpebra_superior',\n      'left_palpebra_inferior',\n      'left_sulcus_palpebralis_lateralis',\n      'left_pretarsal_skin_crease',\n    ],\n  },\n  {\n    name: 'Eyes - Right',\n    color: '#45B7D1',\n    landmarks: [\n      'right_pupila',\n      'right_canthus_medialis',\n      'right_canthus_lateralis',\n      'right_palpebra_superior',\n      'right_palpebra_inferior',\n      'right_sulcus_palpebralis_lateralis',\n      'right_pretarsal_skin_crease',\n    ],\n  },\n  {\n    name: 'Eyebrows - Left',\n    color: '#96CEB4',\n    landmarks: [\n      'left_supercilium_medialis',\n      'left_supercilium_medial_corner',\n      'left_supercilium_superior',\n      'left_supercilium_apex',\n      'left_supercilium_lateralis',\n    ],\n  },\n  {\n    name: 'Eyebrows - Right',\n    color: '#88D8B0',\n    landmarks: [\n      'right_supercilium_medialis',\n      'right_supercilium_medial_corner',\n      'right_supercilium_superior',\n      'right_supercilium_apex',\n      'right_supercilium_lateralis',\n    ],\n  },\n  {\n    name: 'Nose',\n    color: '#FFEAA7',\n    landmarks: [\n      'nasal_base',\n      'left_dorsum_nasi',\n      'right_dorsum_nasi',\n      'left_ala_nasi',\n      'right_ala_nasi',\n      'subnasale',\n    ],\n  },\n  {\n    name: 'Mouth',\n    color: '#DDA0DD',\n    landmarks: [\n      'labrale_superius',\n      'cupids_bow',\n      'mouth_middle',\n      'labrale_inferius',\n      'left_cheilion',\n      'right_cheilion',\n    ],\n  },\n  {\n    name: 'Jaw',\n    color: '#F39C12',\n    landmarks: [\n      'left_gonion_superior',\n      'right_gonion_superior',\n      'left_gonion_inferior',\n      'right_gonion_inferior',\n    ],\n  },\n  {\n    name: 'Chin',\n    color: '#E74C3C',\n    landmarks: ['left_mentum_lateralis', 'right_mentum_lateralis', 'menton'],\n  },\n  {\n    name: 'Face Width',\n    color: '#9B59B6',\n    landmarks: [\n      'left_zygion',\n      'right_zygion',\n      'left_temporal',\n      'right_temporal',\n      'left_auricular_lateral',\n      'right_auricular_lateral',\n    ],\n  },\n  {\n    name: 'Neck',\n    color: '#1ABC9C',\n    landmarks: ['left_cervical_lateralis', 'right_cervical_lateralis'],\n  },\n];\n\nexport const FRONT_PROFILE_LANDMARKS: LandmarkPoint[] = [\n  // Head/Hair\n  {\n    id: 'trichion',\n    label: 'Hairline',\n    medicalTerm: 'Trichion (frontal view)',\n    description: 'Anterior hairline at midline',\n    x: 0.5,\n    y: 0.08,\n    category: 'Head',\n  },\n\n  // Eyes - Left\n  {\n    id: 'left_pupila',\n    label: 'Left Pupil',\n    medicalTerm: 'Left Pupila',\n    description: 'Center of left pupil',\n    x: 0.38,\n    y: 0.35,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_canthus_medialis',\n    label: 'Left Medial Canthus',\n    medicalTerm: 'Left Canthus Medialis',\n    description: 'Inner corner of left eye',\n    x: 0.42,\n    y: 0.35,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_canthus_lateralis',\n    label: 'Left Lateral Canthus',\n    medicalTerm: 'Left Canthus Lateralis',\n    description: 'Outer corner of left eye',\n    x: 0.32,\n    y: 0.34,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_palpebra_superior',\n    label: 'Left Upper Eyelid',\n    medicalTerm: 'Left Palpebra Superior',\n    description: 'Upper eyelid of left eye',\n    x: 0.37,\n    y: 0.33,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_palpebra_inferior',\n    label: 'Left Lower Eyelid',\n    medicalTerm: 'Left Palpebra Inferior',\n    description: 'Lower eyelid of left eye',\n    x: 0.37,\n    y: 0.37,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_sulcus_palpebralis_lateralis',\n    label: 'Left Eyelid Hood End',\n    medicalTerm: 'Left Sulcus Palpebralis Lateralis',\n    description: 'Lateral end of left upper eyelid crease',\n    x: 0.31,\n    y: 0.33,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_pretarsal_skin_crease',\n    label: 'Left Upper Eyelid Crease',\n    medicalTerm: 'Left Pretarsal Skin Crease',\n    description: 'Left upper eyelid crease',\n    x: 0.37,\n    y: 0.32,\n    category: 'Eyes - Left',\n  },\n\n  // Eyes - Right\n  {\n    id: 'right_pupila',\n    label: 'Right Pupil',\n    medicalTerm: 'Right Pupila',\n    description: 'Center of right pupil',\n    x: 0.62,\n    y: 0.35,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_canthus_medialis',\n    label: 'Right Medial Canthus',\n    medicalTerm: 'Right Canthus Medialis',\n    description: 'Inner corner of right eye',\n    x: 0.58,\n    y: 0.35,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_canthus_lateralis',\n    label: 'Right Lateral Canthus',\n    medicalTerm: 'Right Canthus Lateralis',\n    description: 'Outer corner of right eye',\n    x: 0.68,\n    y: 0.34,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_palpebra_superior',\n    label: 'Right Upper Eyelid',\n    medicalTerm: 'Right Palpebra Superior',\n    description: 'Upper eyelid of right eye',\n    x: 0.63,\n    y: 0.33,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_palpebra_inferior',\n    label: 'Right Lower Eyelid',\n    medicalTerm: 'Right Palpebra Inferior',\n    description: 'Lower eyelid of right eye',\n    x: 0.63,\n    y: 0.37,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_sulcus_palpebralis_lateralis',\n    label: 'Right Eyelid Hood End',\n    medicalTerm: 'Right Sulcus Palpebralis Lateralis',\n    description: 'Lateral end of right upper eyelid crease',\n    x: 0.69,\n    y: 0.33,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_pretarsal_skin_crease',\n    label: 'Right Upper Eyelid Crease',\n    medicalTerm: 'Right Pretarsal Skin Crease',\n    description: 'Right upper eyelid crease',\n    x: 0.63,\n    y: 0.32,\n    category: 'Eyes - Right',\n  },\n\n  // Eyebrows - Left\n  {\n    id: 'left_supercilium_medialis',\n    label: 'Left Brow Head',\n    medicalTerm: 'Left Supercilium Medialis',\n    description: 'Medial start of left eyebrow',\n    x: 0.43,\n    y: 0.28,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_medial_corner',\n    label: 'Left Brow Inner Corner',\n    medicalTerm: 'Left Supercilium Medial Corner',\n    description: 'Inner corner of left eyebrow',\n    x: 0.41,\n    y: 0.27,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_superior',\n    label: 'Left Brow Arch',\n    medicalTerm: 'Left Supercilium Superior',\n    description: 'Superior arc of left eyebrow',\n    x: 0.36,\n    y: 0.26,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_apex',\n    label: 'Left Brow Peak',\n    medicalTerm: 'Left Supercilium Apex',\n    description: 'Highest point of left eyebrow',\n    x: 0.34,\n    y: 0.26,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_lateralis',\n    label: 'Left Brow Tail',\n    medicalTerm: 'Left Supercilium Lateralis',\n    description: 'Lateral end of left eyebrow',\n    x: 0.29,\n    y: 0.28,\n    category: 'Eyebrows - Left',\n  },\n\n  // Eyebrows - Right\n  {\n    id: 'right_supercilium_medialis',\n    label: 'Right Brow Head',\n    medicalTerm: 'Right Supercilium Medialis',\n    description: 'Medial start of right eyebrow',\n    x: 0.57,\n    y: 0.28,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_medial_corner',\n    label: 'Right Brow Inner Corner',\n    medicalTerm: 'Right Supercilium Medial Corner',\n    description: 'Inner corner of right eyebrow',\n    x: 0.59,\n    y: 0.27,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_superior',\n    label: 'Right Brow Arch',\n    medicalTerm: 'Right Supercilium Superior',\n    description: 'Superior arc of right eyebrow',\n    x: 0.64,\n    y: 0.26,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_apex',\n    label: 'Right Brow Peak',\n    medicalTerm: 'Right Supercilium Apex',\n    description: 'Highest point of right eyebrow',\n    x: 0.66,\n    y: 0.26,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_lateralis',\n    label: 'Right Brow Tail',\n    medicalTerm: 'Right Supercilium Lateralis',\n    description: 'Lateral end of right eyebrow',\n    x: 0.71,\n    y: 0.28,\n    category: 'Eyebrows - Right',\n  },\n\n  // Nose\n  {\n    id: 'nasal_base',\n    label: 'Nasal Base',\n    medicalTerm: 'Nasal Base',\n    description: 'Base of nasal dorsum',\n    x: 0.5,\n    y: 0.38,\n    category: 'Nose',\n  },\n  {\n    id: 'left_dorsum_nasi',\n    label: 'Left Nose Bridge',\n    medicalTerm: 'Left Dorsum Nasi',\n    description: 'Left side of nasal bridge',\n    x: 0.47,\n    y: 0.42,\n    category: 'Nose',\n  },\n  {\n    id: 'right_dorsum_nasi',\n    label: 'Right Nose Bridge',\n    medicalTerm: 'Right Dorsum Nasi',\n    description: 'Right side of nasal bridge',\n    x: 0.53,\n    y: 0.42,\n    category: 'Nose',\n  },\n  {\n    id: 'left_ala_nasi',\n    label: 'Left Nose Side',\n    medicalTerm: 'Left Ala Nasi',\n    description: 'Lateral aspect of left nasal ala',\n    x: 0.44,\n    y: 0.5,\n    category: 'Nose',\n  },\n  {\n    id: 'right_ala_nasi',\n    label: 'Right Nose Side',\n    medicalTerm: 'Right Ala Nasi',\n    description: 'Lateral aspect of right nasal ala',\n    x: 0.56,\n    y: 0.5,\n    category: 'Nose',\n  },\n  {\n    id: 'subnasale',\n    label: 'Nose Bottom',\n    medicalTerm: 'Subnasale',\n    description: 'Junction of columella and upper lip',\n    x: 0.5,\n    y: 0.52,\n    category: 'Nose',\n  },\n\n  // Mouth\n  {\n    id: 'labrale_superius',\n    label: \"Cupid's Bow\",\n    medicalTerm: 'Labrale Superius',\n    description: 'Midpoint of upper lip vermilion',\n    x: 0.5,\n    y: 0.58,\n    category: 'Mouth',\n  },\n  {\n    id: 'cupids_bow',\n    label: \"Inner Cupid's Bow\",\n    medicalTerm: \"Cupid's Bow\",\n    description: 'Central peak of upper lip',\n    x: 0.5,\n    y: 0.57,\n    category: 'Mouth',\n  },\n  {\n    id: 'mouth_middle',\n    label: 'Mouth Middle',\n    medicalTerm: 'Mouth Middle',\n    description: 'Center of mouth opening',\n    x: 0.5,\n    y: 0.62,\n    category: 'Mouth',\n  },\n  {\n    id: 'labrale_inferius',\n    label: 'Lower Lip Center',\n    medicalTerm: 'Labrale Inferius',\n    description: 'Midpoint of lower lip vermilion border',\n    x: 0.5,\n    y: 0.66,\n    category: 'Mouth',\n  },\n  {\n    id: 'left_cheilion',\n    label: 'Left Mouth Corner',\n    medicalTerm: 'Left Cheilion',\n    description: 'Left oral commissure',\n    x: 0.42,\n    y: 0.62,\n    category: 'Mouth',\n  },\n  {\n    id: 'right_cheilion',\n    label: 'Right Mouth Corner',\n    medicalTerm: 'Right Cheilion',\n    description: 'Right oral commissure',\n    x: 0.58,\n    y: 0.62,\n    category: 'Mouth',\n  },\n\n  // Jaw\n  {\n    id: 'left_gonion_superior',\n    label: 'Left Upper Jaw Angle',\n    medicalTerm: 'Left Gonion Superior',\n    description: 'Superior aspect of left mandibular angle',\n    x: 0.22,\n    y: 0.55,\n    category: 'Jaw',\n  },\n  {\n    id: 'right_gonion_superior',\n    label: 'Right Upper Jaw Angle',\n    medicalTerm: 'Right Gonion Superior',\n    description: 'Superior aspect of right mandibular angle',\n    x: 0.78,\n    y: 0.55,\n    category: 'Jaw',\n  },\n  {\n    id: 'left_gonion_inferior',\n    label: 'Left Lower Jaw Angle',\n    medicalTerm: 'Left Gonion Inferior',\n    description: 'Inferior aspect of left mandibular angle',\n    x: 0.24,\n    y: 0.7,\n    category: 'Jaw',\n  },\n  {\n    id: 'right_gonion_inferior',\n    label: 'Right Lower Jaw Angle',\n    medicalTerm: 'Right Gonion Inferior',\n    description: 'Inferior aspect of right mandibular angle',\n    x: 0.76,\n    y: 0.7,\n    category: 'Jaw',\n  },\n\n  // Chin\n  {\n    id: 'left_mentum_lateralis',\n    label: 'Left Chin',\n    medicalTerm: 'Left Mentum Lateralis',\n    description: 'Left lateral chin',\n    x: 0.42,\n    y: 0.8,\n    category: 'Chin',\n  },\n  {\n    id: 'right_mentum_lateralis',\n    label: 'Right Chin',\n    medicalTerm: 'Right Mentum Lateralis',\n    description: 'Right lateral chin',\n    x: 0.58,\n    y: 0.8,\n    category: 'Chin',\n  },\n  {\n    id: 'menton',\n    label: 'Chin Bottom',\n    medicalTerm: 'Menton',\n    description: 'Lowest point of chin in midline',\n    x: 0.5,\n    y: 0.88,\n    category: 'Chin',\n  },\n\n  // Face Width\n  {\n    id: 'left_zygion',\n    label: 'Left Cheekbone',\n    medicalTerm: 'Left Zygion',\n    description: 'Most lateral point of left zygomatic arch',\n    x: 0.18,\n    y: 0.42,\n    category: 'Face Width',\n  },\n  {\n    id: 'right_zygion',\n    label: 'Right Cheekbone',\n    medicalTerm: 'Right Zygion',\n    description: 'Most lateral point of right zygomatic arch',\n    x: 0.82,\n    y: 0.42,\n    category: 'Face Width',\n  },\n  {\n    id: 'left_temporal',\n    label: 'Left Temple',\n    medicalTerm: 'Left Temporal Point',\n    description: 'Left temporal region',\n    x: 0.2,\n    y: 0.3,\n    category: 'Face Width',\n  },\n  {\n    id: 'right_temporal',\n    label: 'Right Temple',\n    medicalTerm: 'Right Temporal Point',\n    description: 'Right temporal region',\n    x: 0.8,\n    y: 0.3,\n    category: 'Face Width',\n  },\n  {\n    id: 'left_auricular_lateral',\n    label: 'Left Outer Ear',\n    medicalTerm: 'Left Auricular Lateral Point',\n    description: 'Lateral-most point of left ear',\n    x: 0.12,\n    y: 0.4,\n    category: 'Face Width',\n  },\n  {\n    id: 'right_auricular_lateral',\n    label: 'Right Outer Ear',\n    medicalTerm: 'Right Auricular Lateral Point',\n    description: 'Lateral-most point of right ear',\n    x: 0.88,\n    y: 0.4,\n    category: 'Face Width',\n  },\n\n  // Neck\n  {\n    id: 'left_cervical_lateralis',\n    label: 'Left Neck Point',\n    medicalTerm: 'Left Cervical Lateralis',\n    description: 'Left cervical point',\n    x: 0.35,\n    y: 0.95,\n    category: 'Neck',\n  },\n  {\n    id: 'right_cervical_lateralis',\n    label: 'Right Neck Point',\n    medicalTerm: 'Right Cervical Lateralis',\n    description: 'Right cervical point',\n    x: 0.65,\n    y: 0.95,\n    category: 'Neck',\n  },\n];\n\n// ============================================\n// SIDE PROFILE LANDMARKS (38 Points)\n// ============================================\n\nexport const SIDE_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n  {\n    name: 'Cranium',\n    color: '#FF6B6B',\n    landmarks: ['vertex', 'external_occipital_region', 'trichion_profile'],\n  },\n  {\n    name: 'Forehead',\n    color: '#4ECDC4',\n    landmarks: ['frontalis', 'glabella'],\n  },\n  {\n    name: 'Eye Region',\n    color: '#45B7D1',\n    landmarks: [\n      'corneal_apex',\n      'lateral_eyelid',\n      'palpebra_inferior_side',\n      'orbitale',\n    ],\n  },\n  {\n    name: 'Nose',\n    color: '#FFEAA7',\n    landmarks: [\n      'nasion',\n      'rhinion',\n      'supratip_break',\n      'pronasale',\n      'infratip_lobule',\n      'columella_nasi',\n      'subnasale_side',\n      'subalare',\n    ],\n  },\n  {\n    name: 'Lips',\n    color: '#DDA0DD',\n    landmarks: [\n      'labrale_superius_side',\n      'cheilion_side',\n      'labrale_inferius_side',\n      'sublabiale',\n    ],\n  },\n  {\n    name: 'Chin',\n    color: '#E74C3C',\n    landmarks: ['pogonion', 'menton_side'],\n  },\n  {\n    name: 'Jaw',\n    color: '#F39C12',\n    landmarks: ['gonion_superior_side', 'gonion_inferior_side'],\n  },\n  {\n    name: 'Cheek',\n    color: '#9B59B6',\n    landmarks: ['zygion_soft_tissue'],\n  },\n  {\n    name: 'Ear',\n    color: '#3498DB',\n    landmarks: ['porion', 'tragion', 'incisura_intertragica'],\n  },\n  {\n    name: 'Neck',\n    color: '#1ABC9C',\n    landmarks: ['cervicale', 'anterior_cervical_landmark'],\n  },\n];\n\nexport const SIDE_PROFILE_LANDMARKS: LandmarkPoint[] = [\n  // Cranium\n  {\n    id: 'vertex',\n    label: 'Top of Head',\n    medicalTerm: 'Vertex',\n    description: 'Highest point of cranium',\n    x: 0.45,\n    y: 0.02,\n    category: 'Cranium',\n  },\n  {\n    id: 'external_occipital_region',\n    label: 'Occiput',\n    medicalTerm: 'External Occipital Region',\n    description: 'Back of skull',\n    x: 0.85,\n    y: 0.15,\n    category: 'Cranium',\n  },\n  {\n    id: 'trichion_profile',\n    label: 'Hairline (profile)',\n    medicalTerm: 'Trichion',\n    description: 'Anterior hairline (profile view)',\n    x: 0.35,\n    y: 0.1,\n    category: 'Cranium',\n  },\n\n  // Forehead\n  {\n    id: 'frontalis',\n    label: 'Forehead',\n    medicalTerm: 'Frontalis',\n    description: 'Forehead region',\n    x: 0.3,\n    y: 0.18,\n    category: 'Forehead',\n  },\n  {\n    id: 'glabella',\n    label: 'Glabella',\n    medicalTerm: 'Glabella',\n    description: 'Most prominent point between eyebrows',\n    x: 0.32,\n    y: 0.28,\n    category: 'Forehead',\n  },\n\n  // Eye Region\n  {\n    id: 'corneal_apex',\n    label: 'Corneal Apex',\n    medicalTerm: 'Corneal Apex',\n    description: 'Most anterior point of cornea',\n    x: 0.28,\n    y: 0.34,\n    category: 'Eye Region',\n  },\n  {\n    id: 'lateral_eyelid',\n    label: 'Eyelid End',\n    medicalTerm: 'Lateral Eyelid',\n    description: 'Lateral extent of palpebral fissure',\n    x: 0.35,\n    y: 0.34,\n    category: 'Eye Region',\n  },\n  {\n    id: 'palpebra_inferior_side',\n    label: 'Lower Eyelid',\n    medicalTerm: 'Left Palpebra Inferior',\n    description: 'Lower eyelid margin (profile view)',\n    x: 0.3,\n    y: 0.36,\n    category: 'Eye Region',\n  },\n  {\n    id: 'orbitale',\n    label: 'Orbitale',\n    medicalTerm: 'Orbitale',\n    description: 'Lowest point of infraorbital margin',\n    x: 0.35,\n    y: 0.38,\n    category: 'Eye Region',\n  },\n\n  // Nose\n  {\n    id: 'nasion',\n    label: 'Nasal Bridge Front',\n    medicalTerm: 'Nasion',\n    description: 'Deepest point of nasal root',\n    x: 0.35,\n    y: 0.32,\n    category: 'Nose',\n  },\n  {\n    id: 'rhinion',\n    label: 'Rhinion',\n    medicalTerm: 'Rhinion',\n    description: 'Junction of bony and cartilaginous nose',\n    x: 0.28,\n    y: 0.4,\n    category: 'Nose',\n  },\n  {\n    id: 'supratip_break',\n    label: 'Supratip',\n    medicalTerm: 'Supratip Break',\n    description: 'Depression above nasal tip',\n    x: 0.22,\n    y: 0.46,\n    category: 'Nose',\n  },\n  {\n    id: 'pronasale',\n    label: 'Nose Tip',\n    medicalTerm: 'Pronasale',\n    description: 'Most anterior point of nasal tip',\n    x: 0.18,\n    y: 0.48,\n    category: 'Nose',\n  },\n  {\n    id: 'infratip_lobule',\n    label: 'Infratip',\n    medicalTerm: 'Infratip Lobule',\n    description: 'Area below nasal tip',\n    x: 0.2,\n    y: 0.5,\n    category: 'Nose',\n  },\n  {\n    id: 'columella_nasi',\n    label: 'Columella',\n    medicalTerm: 'Columella Nasi',\n    description: 'Fleshy external end of nasal septum',\n    x: 0.24,\n    y: 0.52,\n    category: 'Nose',\n  },\n  {\n    id: 'subnasale_side',\n    label: 'Subnasale',\n    medicalTerm: 'Subnasale',\n    description: 'Junction of columella and upper lip',\n    x: 0.3,\n    y: 0.54,\n    category: 'Nose',\n  },\n  {\n    id: 'subalare',\n    label: 'Subalare',\n    medicalTerm: 'Subalare',\n    description: 'Junction of alar base and upper lip',\n    x: 0.28,\n    y: 0.53,\n    category: 'Nose',\n  },\n\n  // Lips\n  {\n    id: 'labrale_superius_side',\n    label: 'Upper Lip',\n    medicalTerm: 'Labrale Superius',\n    description: 'Upper lip vermilion border',\n    x: 0.28,\n    y: 0.58,\n    category: 'Lips',\n  },\n  {\n    id: 'cheilion_side',\n    label: 'Mouth Corner',\n    medicalTerm: 'Cheilion',\n    description: 'Oral commissure (profile view)',\n    x: 0.35,\n    y: 0.62,\n    category: 'Lips',\n  },\n  {\n    id: 'labrale_inferius_side',\n    label: 'Lower Lip',\n    medicalTerm: 'Labrale Inferius',\n    description: 'Lower lip vermilion border',\n    x: 0.3,\n    y: 0.66,\n    category: 'Lips',\n  },\n  {\n    id: 'sublabiale',\n    label: 'Labiomental Fold',\n    medicalTerm: 'Sublabiale',\n    description: 'Deepest point of labiomental sulcus',\n    x: 0.32,\n    y: 0.7,\n    category: 'Lips',\n  },\n\n  // Chin\n  {\n    id: 'pogonion',\n    label: 'Chin Point',\n    medicalTerm: 'Pogonion (soft tissue)',\n    description: 'Most anterior point of chin',\n    x: 0.3,\n    y: 0.76,\n    category: 'Chin',\n  },\n  {\n    id: 'menton_side',\n    label: 'Chin Bottom',\n    medicalTerm: 'Menton (soft tissue)',\n    description: 'Lowest point of chin',\n    x: 0.35,\n    y: 0.82,\n    category: 'Chin',\n  },\n\n  // Jaw\n  {\n    id: 'gonion_superior_side',\n    label: 'Upper Jaw Angle',\n    medicalTerm: 'Gonion Superior',\n    description: 'Superior mandibular angle',\n    x: 0.7,\n    y: 0.6,\n    category: 'Jaw',\n  },\n  {\n    id: 'gonion_inferior_side',\n    label: 'Lower Jaw Angle',\n    medicalTerm: 'Gonion Inferior',\n    description: 'Inferior mandibular angle',\n    x: 0.65,\n    y: 0.72,\n    category: 'Jaw',\n  },\n\n  // Cheek\n  {\n    id: 'zygion_soft_tissue',\n    label: 'Cheekbone',\n    medicalTerm: 'Zygion (soft tissue over zygoma)',\n    description: 'Soft tissue over zygomatic arch',\n    x: 0.45,\n    y: 0.42,\n    category: 'Cheek',\n  },\n\n  // Ear\n  {\n    id: 'porion',\n    label: 'Porion',\n    medicalTerm: 'Porion (soft tissue)',\n    description: 'Superior aspect of external auditory meatus',\n    x: 0.75,\n    y: 0.35,\n    category: 'Ear',\n  },\n  {\n    id: 'tragion',\n    label: 'Tragus',\n    medicalTerm: 'Tragion (soft tissue)',\n    description: 'Superior margin of tragus',\n    x: 0.72,\n    y: 0.42,\n    category: 'Ear',\n  },\n  {\n    id: 'incisura_intertragica',\n    label: 'Intertragic Notch',\n    medicalTerm: 'Incisura Intertragica',\n    description: 'Notch between tragus and antitragus',\n    x: 0.73,\n    y: 0.45,\n    category: 'Ear',\n  },\n\n  // Neck\n  {\n    id: 'cervicale',\n    label: 'Cervical Point',\n    medicalTerm: 'Cervicale (soft tissue reference)',\n    description: 'Cervical point for profile analysis',\n    x: 0.5,\n    y: 0.9,\n    category: 'Neck',\n  },\n  {\n    id: 'anterior_cervical_landmark',\n    label: 'Neck Point',\n    medicalTerm: 'Anterior Cervical Landmark',\n    description: 'Anterior neck landmark',\n    x: 0.4,\n    y: 0.88,\n    category: 'Neck',\n  },\n];\n\n// ============================================\n// MediaPipe Face Mesh Index Mapping\n// ============================================\n\n// Maps our landmark IDs to MediaPipe Face Mesh indices (478 points)\nexport const MEDIAPIPE_FRONT_MAPPING: Record<string, number> = {\n  // Eyes - using iris landmarks for pupils\n  left_pupila: 468, // Left iris center\n  right_pupila: 473, // Right iris center\n\n  // Eye corners (using eye contour landmarks)\n  left_canthus_medialis: 133, // Inner corner left eye\n  left_canthus_lateralis: 33, // Outer corner left eye\n  right_canthus_medialis: 362, // Inner corner right eye\n  right_canthus_lateralis: 263, // Outer corner right eye\n\n  // Eyelids\n  left_palpebra_superior: 159, // Upper eyelid left\n  left_palpebra_inferior: 145, // Lower eyelid left\n  right_palpebra_superior: 386, // Upper eyelid right\n  right_palpebra_inferior: 374, // Lower eyelid right\n\n  // Eyebrows\n  left_supercilium_medialis: 107, // Left brow inner\n  left_supercilium_apex: 105, // Left brow peak\n  left_supercilium_lateralis: 70, // Left brow outer\n  right_supercilium_medialis: 336, // Right brow inner\n  right_supercilium_apex: 334, // Right brow peak\n  right_supercilium_lateralis: 300, // Right brow outer\n\n  // Nose\n  nasal_base: 6, // Nose bridge\n  left_ala_nasi: 219, // Left nostril\n  right_ala_nasi: 439, // Right nostril\n  subnasale: 2, // Base of nose\n\n  // Mouth\n  labrale_superius: 0, // Upper lip center\n  labrale_inferius: 17, // Lower lip center\n  left_cheilion: 61, // Left mouth corner\n  right_cheilion: 291, // Right mouth corner\n  mouth_middle: 13, // Mouth center\n\n  // Jaw\n  left_gonion_inferior: 172, // Left jaw angle\n  right_gonion_inferior: 397, // Right jaw angle\n\n  // Chin\n  menton: 152, // Chin bottom\n\n  // Face silhouette (for zygion)\n  left_zygion: 234, // Left cheekbone\n  right_zygion: 454, // Right cheekbone\n};\n\n// Helper to get category color for a landmark\nexport function getLandmarkColor(\n  landmarkId: string,\n  categories: LandmarkCategory[]\n): string {\n  for (const category of categories) {\n    if (category.landmarks.includes(landmarkId)) {\n      return category.color;\n    }\n  }\n  return '#00f3ff'; // Default cyan\n}\n\n// ============================================\n// FaceIQ Side Profile Landmark Indices (106 points)\n// Reverse-engineered from FaceIQ Labs API\n// ============================================\n\nexport const FACEIQ_SIDE_LANDMARKS = {\n  // Face Contour (0-16) - Jaw/Chin outline\n  MENTON: 0, // Chin bottom (lowest point)\n  POGONION: 2, // Chin prominence\n  GNATHION: 3, // Chin point\n  MANDIBLE_CONTOUR: [2, 3, 4, 5, 6, 7, 8], // Jaw line\n\n  // Posterior Points (1, 9-16) - Ear/Back of head\n  TRAGION: 1, // Ear point\n  EAR_CONTOUR: [9, 10, 11, 12, 13, 14, 15, 16],\n\n  // Forehead/Hairline (17)\n  TRICHION: 17, // Hairline\n\n  // Nose Profile (18-32)\n  NASION: 25, // Bridge of nose (deepest point)\n  PRONASALE: 32, // Nose tip\n  SUBNASALE: 52, // Base of nose\n  COLUMELLA: 53, // Nose columella\n  NOSE_BRIDGE: [25, 26, 27, 28, 29, 30, 31, 32],\n  NOSE_TIP_CONTOUR: [52, 53, 54, 55, 56, 57, 58, 59, 60],\n\n  // Eye Region (33-51)\n  EYE_LATERAL_CANTHUS: 33, // Outer eye corner\n  EYE_MEDIAL_CANTHUS: 35, // Inner eye corner\n  UPPER_EYELID: [37, 38, 39],\n  LOWER_EYELID: [40, 41, 42],\n  PUPIL: 34,\n  BROW_HEAD: 44, // Inner brow\n  BROW_ARCH: 45, // Brow peak\n  BROW_TAIL: 46, // Outer brow\n\n  // Lip Region (52-75)\n  LABRALE_SUPERIUS: 63, // Upper lip top\n  LABRALE_INFERIUS: 66, // Lower lip bottom\n  STOMION: 65, // Lip meeting point\n  UPPER_LIP_CONTOUR: [63, 64, 65],\n  LOWER_LIP_CONTOUR: [66, 67, 68],\n\n  // Additional Profile Points (76-105)\n  GLABELLA: 76, // Between eyebrows\n  SELLION: 77, // Deepest point of nasal bridge\n  SOFT_TISSUE_NASION: 78,\n  ORBITALE: 79, // Lowest point of eye socket\n  GONION: 85, // Jaw angle\n  CONDYLION: 86, // Top of jaw joint\n};\n\n// ============================================\n// FaceIQ Front Face Landmark Indices (MediaPipe 478 points)\n// ============================================\n\nexport const FACEIQ_FRONT_LANDMARKS = {\n  // Key points from MediaPipe Face Mesh\n  NOSE_TIP: 1,\n  LEFT_EYE_INNER: 133,\n  LEFT_EYE_OUTER: 33,\n  RIGHT_EYE_INNER: 362,\n  RIGHT_EYE_OUTER: 263,\n  LEFT_CHEEK: 234,\n  RIGHT_CHEEK: 454,\n  UPPER_LIP: 13,\n  LOWER_LIP: 14,\n  CHIN: 152,\n  FOREHEAD: 10,\n  LEFT_EAR: 234,\n  RIGHT_EAR: 454,\n  LEFT_BROW_INNER: 107,\n  LEFT_BROW_OUTER: 70,\n  RIGHT_BROW_INNER: 336,\n  RIGHT_BROW_OUTER: 300,\n  NOSE_BRIDGE: 6,\n  LEFT_NOSTRIL: 129,\n  RIGHT_NOSTRIL: 358,\n};\n\n// ============================================\n// Scoring Configuration Types\n// ============================================\n\nexport interface ScoringConfig {\n  idealValue: number;\n  standardDeviation: number;\n  minScore: number;\n  maxScore: number;\n  weight: number;\n}\n\nexport interface GenderSpecificValues {\n  male: { ideal: number; range: [number, number] };\n  female: { ideal: number; range: [number, number] };\n}\n\n// ============================================\n// FaceIQ Ideal Values (Gender-Specific)\n// ============================================\n\nexport const FACEIQ_IDEAL_VALUES: Record<string, GenderSpecificValues> = {\n  fwhr: {\n    male: { ideal: 1.9, range: [1.8, 2.1] },\n    female: { ideal: 1.75, range: [1.6, 1.9] },\n  },\n  canthalTilt: {\n    male: { ideal: 4, range: [2, 7] },\n    female: { ideal: 6, range: [4, 10] },\n  },\n  nasolabialAngle: {\n    male: { ideal: 95, range: [90, 100] },\n    female: { ideal: 105, range: [100, 115] },\n  },\n  gonialAngle: {\n    male: { ideal: 125, range: [120, 130] },\n    female: { ideal: 128, range: [125, 135] },\n  },\n  nasalIndex: {\n    male: { ideal: 0.7, range: [0.65, 0.75] },\n    female: { ideal: 0.65, range: [0.6, 0.7] },\n  },\n  lipRatio: {\n    male: { ideal: 0.5, range: [0.4, 0.6] },\n    female: { ideal: 0.5, range: [0.45, 0.55] },\n  },\n  facialConvexity: {\n    male: { ideal: 170, range: [165, 175] },\n    female: { ideal: 168, range: [163, 173] },\n  },\n  chinProjection: {\n    male: { ideal: 0, range: [-3, 3] },\n    female: { ideal: -2, range: [-5, 1] },\n  },\n};\n\n// ============================================\n// FaceIQ Scoring Configurations\n// ============================================\n\nexport const FACEIQ_SCORING_CONFIGS: Record<string, ScoringConfig> = {\n  fwhr: {\n    idealValue: 1.9,\n    standardDeviation: 0.15,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.15,\n  },\n  canthalTilt: {\n    idealValue: 6,\n    standardDeviation: 3,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.1,\n  },\n  facialThirds: {\n    idealValue: 33.33,\n    standardDeviation: 3,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.1,\n  },\n  nasolabialAngle: {\n    idealValue: 102,\n    standardDeviation: 8,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.08,\n  },\n  gonialAngle: {\n    idealValue: 125,\n    standardDeviation: 5,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.08,\n  },\n  overallSymmetry: {\n    idealValue: 100,\n    standardDeviation: 5,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.15,\n  },\n  goldenRatio: {\n    idealValue: 1.618,\n    standardDeviation: 0.1,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.12,\n  },\n  nasalIndex: {\n    idealValue: 0.7,\n    standardDeviation: 0.08,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.06,\n  },\n  lipRatio: {\n    idealValue: 0.5,\n    standardDeviation: 0.1,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.06,\n  },\n  chinProjection: {\n    idealValue: 0,\n    standardDeviation: 3,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.05,\n  },\n  noseProjection: {\n    idealValue: 0.67,\n    standardDeviation: 0.05,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.05,\n  },\n};\n\n// ============================================\n// Population Statistics for Percentile Ranking\n// ============================================\n\nexport interface PopulationStats {\n  mean: number;\n  standardDeviation: number;\n  sampleSize: number;\n}\n\nexport const POPULATION_STATS: Record<string, PopulationStats> = {\n  harmonyScore: { mean: 65, standardDeviation: 12, sampleSize: 10000 },\n  fwhr: { mean: 1.85, standardDeviation: 0.2, sampleSize: 10000 },\n  canthalTilt: { mean: 4, standardDeviation: 4, sampleSize: 10000 },\n  symmetry: { mean: 85, standardDeviation: 8, sampleSize: 10000 },\n  goldenRatioMatch: { mean: 70, standardDeviation: 15, sampleSize: 10000 },\n};\n","numLines":1313,"startLine":1,"totalLines":1313}}}
{"parentUuid":"49390422-0f02-405d-9b1c-47e9f8f094d8","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e7ba8ff7-ea0c-41d6-9623-9ec03de27b58","version":"2.0.70","gitBranch":"main","agentId":"a33bd58","slug":"delegated-brewing-liskov","message":{"model":"claude-haiku-4-5-20251001","id":"msg_014uoGZvZuPDkb3vN2JkLxGH","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect. Now let me create a comprehensive analysis report of the mediapipeDetection.ts file.\n\n## Analysis Report: mediapipeDetection.ts\n\n### 1. Landmark Index Mappings\n\nThe file provides two main mapping configurations:\n\n#### **MEDIAPIPE_FRONT_MAPPING** (Front Profile - 52 landmarks)\nMaps custom landmark IDs to MediaPipe Face Mesh indices (out of 478 total landmarks):\n\n**Eyes (Left - 7 landmarks):**\n- `left_pupila: 468` - Left iris center\n- `left_canthus_medialis: 133` - Inner corner of left eye\n- `left_canthus_lateralis: 33` - Outer corner of left eye\n- `left_palpebra_superior: 159` - Upper eyelid\n- `left_palpebra_inferior: 145` - Lower eyelid\n- `left_sulcus_palpebralis_lateralis: 130` - Lateral eyelid hood end\n- `left_pretarsal_skin_crease: 247` - Upper eyelid crease\n\n**Eyes (Right - 7 landmarks):** Mirror indices (468→473, 133→362, 33→263, etc.)\n\n**Eyebrows (Left - 5 landmarks):**\n- `left_supercilium_medialis: 107` - Inner/medial brow\n- `left_supercilium_medial_corner: 66`\n- `left_supercilium_superior: 105` - Brow arch\n- `left_supercilium_apex: 70` - Brow peak\n- `left_supercilium_lateralis: 46` - Outer/lateral brow\n\n**Eyebrows (Right - 5 landmarks):** Mirror indices (107→336, 66→296, 105→334, 70→300, 46→276)\n\n**Nose (6 landmarks):**\n- `nasal_base: 6` - Bridge of nose\n- `left_dorsum_nasi: 198` - Left side of nasal bridge\n- `right_dorsum_nasi: 420` - Right side of nasal bridge\n- `left_ala_nasi: 129` - Lateral aspect of left nostril\n- `right_ala_nasi: 358` - Lateral aspect of right nostril\n- `subnasale: 2` - Junction of columella and upper lip\n\n**Mouth (6 landmarks):**\n- `labrale_superius: 0` - Midpoint of upper lip\n- `cupids_bow: 13` - Central peak of upper lip\n- `mouth_middle: 14` - Center of mouth\n- `labrale_inferius: 17` - Midpoint of lower lip\n- `left_cheilion: 61` - Left mouth corner\n- `right_cheilion: 291` - Right mouth corner\n\n**Jaw (4 landmarks):**\n- `left_gonion_superior: 116` - Upper left jaw angle\n- `right_gonion_superior: 345` - Upper right jaw angle\n- `left_gonion_inferior: 172` - Lower left jaw angle\n- `right_gonion_inferior: 397` - Lower right jaw angle\n\n**Chin (3 landmarks):**\n- `left_mentum_lateralis: 135` - Left lateral chin\n- `right_mentum_lateralis: 364` - Right lateral chin\n- `menton: 152` - Lowest point of chin\n\n**Cheeks/Face Width (6 landmarks):**\n- `left_zygion: 234` - Left cheekbone (most lateral point)\n- `right_zygion: 454` - Right cheekbone\n- `left_temporal: 127` - Left temple\n- `right_temporal: 356` - Right temple\n- `left_auricular_lateral: 234` - Lateral ear (reuses zygion)\n- `right_auricular_lateral: 454` - Lateral ear (reuses zygion)\n\n**Neck (2 landmarks):**\n- `left_cervical_lateralis: 172` - Left neck point (reuses jaw angle)\n- `right_cervical_lateralis: 397` - Right neck point (reuses jaw angle)\n\n#### **MEDIAPIPE_SIDE_MAPPING** (Side Profile - 38 landmarks)\nMaps to side-view specific landmarks with suffix `_profile` or `_side`:\n\n**Key Head Points:**\n- `vertex: 10` - Highest point of cranium\n- `glabella: 9` - Between eyebrows\n- `pronasale: 1` - Nose tip\n\n**Profile-Specific Points:**\n- `nasion: 6` - Deepest point of nasal root\n- `rhinion: 4` - Bony/cartilaginous junction\n- `supratip: 4`\n- `columella: 2` - Fleshy columella\n- `subnasale_profile: 2` - Columella/upper lip junction\n- `subalare: 129` - Alar base/upper lip junction\n- `pogonion: 152` - Most anterior chin point\n- `menton_profile: 152` - Lowest chin point\n- `gonion_superior_profile: 116` - Upper jaw angle\n- `gonion_inferior_profile: 172` - Lower jaw angle\n- `zygoma_lateralis: 234` - Cheekbone\n\n---\n\n### 2. Landmark Extraction Process\n\n**Function: `detectFromImageUrl(imageUrl, mode)`**\n\nThe extraction workflow:\n1. **Load Image**: Image is fetched via URL with CORS enabled\n2. **Run Detection**: Image passed to `faceDetectionService.detect()` which uses MediaPipe Face Landmarker\n3. **Extract Landmarks**: All 478 MediaPipe landmarks returned from first detected face\n4. **Map to Custom IDs**: Only landmarks specified in the mapping (front: 52, side: 38) are extracted\n5. **Normalize Coordinates**: Returns x,y as normalized values (0-1 range)\n6. **Safe Indexing**: Uses bounds checking (`Math.min(index, faceLandmarks.length - 1)`) to prevent out-of-bounds access\n\n**Code Flow (lines 137-195):**\n```typescript\nconst faceLandmarks = result.faceLandmarks[0];  // First face only\nconst mapping = mode === 'front' ? MEDIAPIPE_FRONT_MAPPING : MEDIAPIPE_SIDE_MAPPING;\nconst landmarks = Object.entries(mapping).map(([id, index]) => {\n  const safeIndex = Math.min(index, faceLandmarks.length - 1);\n  const landmark = faceLandmarks[safeIndex];\n  return {\n    id,\n    x: landmark ? landmark.x : 0.5,\n    y: landmark ? landmark.y : 0.5,\n  };\n});\n```\n\n---\n\n### 3. Coordinate System and Normalization\n\n**MediaPipe Coordinate System:**\n- **Range**: 0.0 to 1.0 for both X and Y\n- **Origin**: Top-left corner (0,0)\n- **X-axis**: Increases left-to-right (0 = left edge, 1 = right edge)\n- **Y-axis**: Increases top-to-bottom (0 = top edge, 1 = bottom edge)\n- **Input**: Image dimensions automatically handled by MediaPipe during inference\n\n**Normalization Notes:**\n- MediaPipe returns normalized coordinates directly\n- No additional scaling or offset applied in `detectFromImageUrl()`\n- Face bounding box computed from min/max of all landmark coordinates (lines 172-179)\n- Default fallback value is 0.5 (center) if landmark data is missing\n\n**Face Bounding Box Calculation (lines 172-190):**\n```typescript\nlet minX = 1, minY = 1, maxX = 0, maxY = 0;\nfaceLandmarks.forEach((lm) => {\n  minX = Math.min(minX, lm.x);\n  minY = Math.min(minY, lm.y);\n  maxX = Math.max(maxX, lm.x);\n  maxY = Math.max(maxY, lm.y);\n});\nreturn {\n  faceBox: {\n    x: minX,\n    y: minY,\n    width: maxX - minX,\n    height: maxY - minY,\n  },\n};\n```\n\n---\n\n### 4. Feature-Specific Landmark Groupings\n\nThe code organizes landmarks into anatomically-meaningful groups (from landmarks.ts):\n\n**FRONT_LANDMARK_CATEGORIES (10 groups):**\n1. **Head** - trichion (hairline)\n2. **Eyes - Left** - 7 points (pupils, canthi, eyelids, creases)\n3. **Eyes - Right** - 7 points (mirror of left)\n4. **Eyebrows - Left** - 5 points (medialis, corners, apex, lateralis)\n5. **Eyebrows - Right** - 5 points (mirror of left)\n6. **Nose** - 6 points (base, bridges, alae, subnasale)\n7. **Mouth** - 6 points (lips, cupid's bow, corners, center)\n8. **Jaw** - 4 points (gonion superior/inferior on both sides)\n9. **Chin** - 3 points (lateral and bottom points)\n10. **Face Width** - 6 points (cheekbones, temples, ears, neck reference)\n\n**SIDE_LANDMARK_CATEGORIES (10 groups):**\n1. **Cranium** - vertex, occiput, hairline\n2. **Forehead** - frontalis, glabella\n3. **Eye Region** - corneal apex, eyelids, orbitale\n4. **Nose** - nasion, rhinion, pronasale, subalare, columella\n5. **Lips** - upper/lower lip, cheilion, sublabiale\n6. **Chin** - pogonion, menton\n7. **Jaw** - gonion superior/inferior\n8. **Cheek** - zygion (soft tissue)\n9. **Ear** - porion, tragus, intertragic notch\n10. **Neck** - cervicale points\n\nEach category has a unique color for visualization (e.g., eyes=cyan, nose=yellow, mouth=magenta).\n\n---\n\n### 5. Zoom Region Mapping\n\nThe `getLandmarkZoomRegion()` function (lines 213-245) provides UI-focused zoom parameters for detail inspection:\n\n**High-Detail Landmarks (zoomLevel: 3.0):**\n- Eye pupils and canthi (left & right)\n\n**Medium-Detail Landmarks (zoomLevel: 2.5):**\n- Eyebrows (apexes)\n- Upper lip area\n\n**Lower-Detail Landmarks (zoomLevel: 2.0):**\n- Nasal base\n- Mouth center\n\n**Default:** zoomLevel 1.5 for unmapped landmarks\n\nExample - left pupil zoom:\n```typescript\nleft_pupila: { centerX: 0.35, centerY: 0.35, zoomLevel: 3 }\n```\n\n---\n\n### 6. Key Technical Notes\n\n**Limitations & Observations:**\n\n1. **Index Reuse**: Some landmarks reuse indices (e.g., ears use same indices as cheekbones, neck uses jaw angles) - this is acceptable since these are approximate positions\n\n2. **Iris vs Pupil**: Uses iris center (indices 468/473) as pupil location - MediaPipe iris landmarks are more stable than eye surface landmarks\n\n3. **Side Profile Approximation**: Side profile mapping mostly maps the same base indices differently because MediaPipe is trained on frontal faces. The side profile landmarks are essentially relabeled frontal landmarks.\n\n4. **No Confidence Scores**: Individual landmark confidence is not extracted - returns static 0.95 for all faces (line 183)\n\n5. **Single Face**: `numFaces: 1` in FaceDetectionService (line 37 of faceDetectionService.ts) - only processes first detected face\n\n6. **Performance**: Uses native WASM MediaPipe instead of TensorFlow.js (49MB vs 272MB bundle size reduction)\n\n---\n\n### Summary\n\nThe system extracts **478 MediaPipe Face Mesh landmarks** and maps a curated subset (52 front, 38 side) to anatomically-correct landmark IDs. All coordinates are normalized to 0-1 range using MediaPipe's native normalization. Landmarks are organized into 10 feature groups per profile with color coding for UI visualization, and support zoom-based detail inspection of specific facial regions."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":14489,"cache_creation_input_tokens":18469,"cache_read_input_tokens":15964,"cache_creation":{"ephemeral_5m_input_tokens":18469,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWFXG7rMvdMo1VDsCPkBu","type":"assistant","uuid":"89923fad-a278-4fb9-abdc-1335c02e8f67","timestamp":"2025-12-19T05:50:53.152Z"}
