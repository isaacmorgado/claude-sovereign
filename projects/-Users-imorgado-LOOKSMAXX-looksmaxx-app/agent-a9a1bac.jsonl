{"parentUuid":null,"isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"bd90a391-e385-4284-8226-9645391dc38b","version":"2.0.70","gitBranch":"main","agentId":"a9a1bac","slug":"golden-bouncing-hennessy","type":"user","message":{"role":"user","content":"You are Agent 3: The Surgeon (Remediation Linkage)\n\n**Mission**: Verify that specific flaws trigger specific, culturally accurate remediation plans.\n\n**Context**: The system has two remediation systems:\n1. `src/lib/advice-engine.ts` - Simple advice based on metric thresholds (surgical/non-surgical plans)\n2. `src/lib/looksmax-scoring.ts` - Metric-specific advice strings in ADVICE_DATABASE\n\n**Task**: Verify culturally appropriate remediation suggestions.\n\n**Test Scenarios**:\n\n**Scenario A: Wide Nose (Ethnicity-Aware)**\n- Input metric: `noseWidth` = 48mm (very wide)\n- Test 1: Context = male_white\n  - Check if advice mentions \"Alarplasty\", \"Rhinoplasty\", or \"Nasal reduction\"\n  - ✅ PASS if surgical narrowing is suggested\n  - ❌ FAIL if no specific advice given\n  \n- Test 2: Context = male_black \n  - Value 48mm is within acceptable range [40, 50]\n  - ✅ PASS if advice says \"within acceptable range\" or \"no action needed\"\n  - ❌ FAIL if it suggests aggressive rhinoplasty (Eurocentric bias)\n\n**Scenario B: Soft Jaw (Gender-Aware)**\n- Input metric: `gonial_angle` = 130° (very obtuse/soft)\n- Test 1: Context = male_white\n  - ✅ PASS if advice mentions \"Jaw fillers\", \"Jaw angle implants\", or \"BSSO\"\n  - ❌ FAIL if no surgical options mentioned\n  \n- Test 2: Context = female_east_asian\n  - 130° is within female ideal [120, 135]\n  - ✅ PASS if advice says \"ideal proportions\" or \"soft jawline is desirable\"\n  - ❌ FAIL if it suggests masculinizing surgery\n\n**Scenario C: Philtrum Length (Universal)**\n- Input metric: `philtrumLength` = 18mm (very long)\n- Test: Any gender/ethnicity\n  - ✅ PASS if advice mentions \"Lip lift\" or \"Upper lip surgery\"\n  - ❌ FAIL if advice is generic or missing\n\n**Verification Method**:\n1. Read `src/lib/advice-engine.ts` to understand the recommendation logic\n2. Read `src/lib/looksmax-scoring.ts` ADVICE_DATABASE\n3. For each scenario, trace through:\n   - What advice string is returned?\n   - Does it mention specific procedures?\n   - Does it consider ethnicity/gender context?\n4. Check `src/lib/insights-engine.ts` getMetricConfig to see if ethnicity overrides are used in advice generation\n\n**Output**:\n- For each scenario: ✅ PASS / ❌ FAIL with explanation\n- Report any \"Eurocentric bias\" issues where wider noses are always flagged as flaws\n- Report any \"Gender inappropriateness\" issues where feminine features are suggested to be masculine\n- Final verdict: \"REMEDIATION SYSTEM VERIFIED\" or \"REMEDIATION SYSTEM NEEDS ETHNICITY AWARENESS\""},"uuid":"d77dacd8-9ae7-4c67-bb18-c6d11a02b9f9","timestamp":"2025-12-21T18:33:02.002Z"}
{"parentUuid":"d77dacd8-9ae7-4c67-bb18-c6d11a02b9f9","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"bd90a391-e385-4284-8226-9645391dc38b","version":"2.0.70","gitBranch":"main","agentId":"a9a1bac","slug":"golden-bouncing-hennessy","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01M9ftxHfuuC23raHBCaZ2q5","type":"message","role":"assistant","content":[{"type":"text","text":"I'll systematically verify the remediation system's cultural appropriateness by examining the advice engines and testing the specific scenarios."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":12513,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":12513,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLK2sQiJcjmPZ1oKVcTT","type":"assistant","uuid":"521eade9-22c3-4b57-9699-d59cc2acddfa","timestamp":"2025-12-21T18:33:04.501Z"}
{"parentUuid":"521eade9-22c3-4b57-9699-d59cc2acddfa","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"bd90a391-e385-4284-8226-9645391dc38b","version":"2.0.70","gitBranch":"main","agentId":"a9a1bac","slug":"golden-bouncing-hennessy","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01M9ftxHfuuC23raHBCaZ2q5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AfFsDqGmgTZz7vM5mwaCgS","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/advice-engine.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":12513,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":12513,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLK2sQiJcjmPZ1oKVcTT","type":"assistant","uuid":"51fb1e0c-b3a5-404d-b88e-8876c046ab62","timestamp":"2025-12-21T18:33:05.532Z"}
{"parentUuid":"51fb1e0c-b3a5-404d-b88e-8876c046ab62","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"bd90a391-e385-4284-8226-9645391dc38b","version":"2.0.70","gitBranch":"main","agentId":"a9a1bac","slug":"golden-bouncing-hennessy","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01M9ftxHfuuC23raHBCaZ2q5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01B9hQjxYuptYHvhQgAXGrpG","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/looksmax-scoring.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":12513,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":12513,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLK2sQiJcjmPZ1oKVcTT","type":"assistant","uuid":"c25f34a0-3193-4e85-aa0e-530da455f603","timestamp":"2025-12-21T18:33:06.023Z"}
{"parentUuid":"c25f34a0-3193-4e85-aa0e-530da455f603","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"bd90a391-e385-4284-8226-9645391dc38b","version":"2.0.70","gitBranch":"main","agentId":"a9a1bac","slug":"golden-bouncing-hennessy","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01M9ftxHfuuC23raHBCaZ2q5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01SHzhBbPcySSGdfF1TNTa1E","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":12513,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":12513,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLK2sQiJcjmPZ1oKVcTT","type":"assistant","uuid":"95793982-2893-4aa9-a205-dfcab5729183","timestamp":"2025-12-21T18:33:06.603Z"}
{"parentUuid":"95793982-2893-4aa9-a205-dfcab5729183","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"bd90a391-e385-4284-8226-9645391dc38b","version":"2.0.70","gitBranch":"main","agentId":"a9a1bac","slug":"golden-bouncing-hennessy","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AfFsDqGmgTZz7vM5mwaCgS","type":"tool_result","content":"     1→/**\n     2→ * Advice Engine - Client-side implementation matching the Python AdviceEngine\n     3→ * Processes plans.json trigger rules against user metrics\n     4→ */\n     5→\n     6→import { Plan } from '@/components/results/cards/PlanActionCard';\n     7→\n     8→// ============================================\n     9→// TYPES\n    10→// ============================================\n    11→\n    12→interface Threshold {\n    13→  operator: '<' | '>';\n    14→  value: number;\n    15→}\n    16→\n    17→interface TriggerRules {\n    18→  metrics: string[];\n    19→  condition: 'OR' | 'AND';\n    20→  thresholds: Record<string, Threshold>;\n    21→}\n    22→\n    23→interface PlanContent {\n    24→  description: string;\n    25→  cost_min: number;\n    26→  cost_max: number;\n    27→  time_min?: string;\n    28→  time_max?: string;\n    29→  risks?: string;\n    30→  citations?: string[];\n    31→  tags?: string[];\n    32→}\n    33→\n    34→interface RawPlan {\n    35→  id: string;\n    36→  title: string;\n    37→  trigger_rules: TriggerRules;\n    38→  content: PlanContent;\n    39→}\n    40→\n    41→interface TriggerResult {\n    42→  metric: string;\n    43→  value: number;\n    44→  threshold: number;\n    45→  operator: '<' | '>';\n    46→}\n    47→\n    48→// ============================================\n    49→// PLANS DATA (from plans.json)\n    50→// ============================================\n    51→\n    52→export const PLANS: RawPlan[] = [\n    53→  {\n    54→    id: \"jaw_fillers\",\n    55→    title: \"Jaw Fillers\",\n    56→    trigger_rules: {\n    57→      metrics: [\"Gonial Angle\", \"Bigonial Width\", \"Ramus to Mandible Ratio\"],\n    58→      condition: \"OR\",\n    59→      thresholds: {\n    60→        \"Gonial Angle\": { operator: \">\", value: 128.0 },\n    61→        \"Bigonial Width\": { operator: \"<\", value: 90.0 },\n    62→        \"Ramus to Mandible Ratio\": { operator: \"<\", value: 0.5 }\n    63→      }\n    64→    },\n    65→    content: {\n    66→      description: \"Injectable fillers to enhance jawline definition, width, and projection.\",\n    67→      cost_min: 600,\n    68→      cost_max: 2500,\n    69→      time_min: \"6 months\",\n    70→      time_max: \"18 months\",\n    71→      risks: \"Vascular occlusion, asymmetry, swelling.\",\n    72→      citations: [\"Al-Khafaji et al., 2023\"],\n    73→      tags: [\"Minimally Invasive\"]\n    74→    }\n    75→  },\n    76→  {\n    77→    id: \"cheekbone_fillers\",\n    78→    title: \"Cheekbone Fillers\",\n    79→    trigger_rules: {\n    80→      metrics: [\"Cheekbone Height\", \"Face Width to Height Ratio\"],\n    81→      condition: \"OR\",\n    82→      thresholds: {\n    83→        \"Cheekbone Height\": { operator: \"<\", value: 60.0 },\n    84→        \"Face Width to Height Ratio\": { operator: \"<\", value: 1.75 }\n    85→      }\n    86→    },\n    87→    content: {\n    88→      description: \"Enhances cheekbone prominence for better facial angularity and harmony.\",\n    89→      cost_min: 650,\n    90→      cost_max: 2500,\n    91→      time_min: \"6 months\",\n    92→      time_max: \"18 months\",\n    93→      risks: \"Asymmetry, filler migration.\",\n    94→      citations: [\"Trinh & Gupta, 2021\"],\n    95→      tags: [\"Minimally Invasive\"]\n    96→    }\n    97→  },\n    98→  {\n    99→    id: \"beard_growth\",\n   100→    title: \"Beard / Stubble Growth\",\n   101→    trigger_rules: {\n   102→      metrics: [\"Chin to Philtrum Ratio\", \"Gonial Angle\"],\n   103→      condition: \"OR\",\n   104→      thresholds: {\n   105→        \"Chin to Philtrum Ratio\": { operator: \"<\", value: 1.8 },\n   106→        \"Gonial Angle\": { operator: \">\", value: 126.0 }\n   107→      }\n   108→    },\n   109→    content: {\n   110→      description: \"Grow dense stubble to camouflage weak chin projection or steep jawline.\",\n   111→      cost_min: 0,\n   112→      cost_max: 20,\n   113→      time_min: \"1 month\",\n   114→      time_max: \"3 months\",\n   115→      risks: \"None\",\n   116→      citations: [\"Dixson et al., 2016\"],\n   117→      tags: [\"Foundational\", \"Free\"]\n   118→    }\n   119→  },\n   120→  {\n   121→    id: \"lip_filler\",\n   122→    title: \"Lip Filler\",\n   123→    trigger_rules: {\n   124→      metrics: [\"Lower Lip to Upper Lip Ratio\"],\n   125→      condition: \"OR\",\n   126→      thresholds: {\n   127→        \"Lower Lip to Upper Lip Ratio\": { operator: \"<\", value: 1.0 }\n   128→      }\n   129→    },\n   130→    content: {\n   131→      description: \"Injectable filler to enhance volume and correct asymmetry.\",\n   132→      cost_min: 500,\n   133→      cost_max: 1200,\n   134→      time_min: \"6 months\",\n   135→      time_max: \"12 months\",\n   136→      risks: \"Migration, bruising.\",\n   137→      citations: [\"Hernandez et al., 2023\"],\n   138→      tags: [\"Minimally Invasive\"]\n   139→    }\n   140→  },\n   141→  {\n   142→    id: \"weight_loss_protocol\",\n   143→    title: \"Fat Loss Protocol (High Protein + Cardio)\",\n   144→    trigger_rules: {\n   145→      metrics: [\"Cheekbone Height\", \"Jaw Slope\"],\n   146→      condition: \"OR\",\n   147→      thresholds: {\n   148→        \"Cheekbone Height\": { operator: \"<\", value: 65.0 },\n   149→        \"Jaw Slope\": { operator: \">\", value: 140.0 }\n   150→      }\n   151→    },\n   152→    content: {\n   153→      description: \"High-protein diet combined with cardio to reduce facial bloat and reveal bone structure.\",\n   154→      cost_min: 200,\n   155→      cost_max: 1000,\n   156→      time_min: \"3 months\",\n   157→      time_max: \"12 months\",\n   158→      risks: \"None\",\n   159→      citations: [\"Moon & Koh, 2020\"],\n   160→      tags: [\"Foundational\"]\n   161→    }\n   162→  },\n   163→  {\n   164→    id: \"mewing_posture\",\n   165→    title: \"Mewing & Posture Correction\",\n   166→    trigger_rules: {\n   167→      metrics: [\"Midface Ratio\", \"Nasolabial Angle\"],\n   168→      condition: \"OR\",\n   169→      thresholds: {\n   170→        \"Midface Ratio\": { operator: \">\", value: 1.05 },\n   171→        \"Nasolabial Angle\": { operator: \"<\", value: 90.0 }\n   172→      }\n   173→    },\n   174→    content: {\n   175→      description: \"Proper tongue posture and body alignment to improve facial forward growth over time.\",\n   176→      cost_min: 0,\n   177→      cost_max: 0,\n   178→      time_min: \"12 months\",\n   179→      time_max: \"Lifetime\",\n   180→      risks: \"None if performed correctly.\",\n   181→      citations: [\"Mew J. et al., 2014\"],\n   182→      tags: [\"Foundational\", \"Free\"]\n   183→    }\n   184→  },\n   185→  {\n   186→    id: \"rhinoplasty\",\n   187→    title: \"Rhinoplasty\",\n   188→    trigger_rules: {\n   189→      metrics: [\"Nasal Projection\", \"Nasal W to H Ratio\", \"Nasolabial Angle\"],\n   190→      condition: \"OR\",\n   191→      thresholds: {\n   192→        \"Nasal Projection\": { operator: \">\", value: 0.75 },\n   193→        \"Nasal W to H Ratio\": { operator: \">\", value: 0.85 },\n   194→        \"Nasolabial Angle\": { operator: \"<\", value: 85.0 }\n   195→      }\n   196→    },\n   197→    content: {\n   198→      description: \"Surgical nose reshaping to improve proportion, projection, or correct a droopy tip.\",\n   199→      cost_min: 5000,\n   200→      cost_max: 15000,\n   201→      time_min: \"6 months\",\n   202→      time_max: \"12 months\",\n   203→      risks: \"Infection, asymmetry, breathing issues, revision surgery.\",\n   204→      citations: [\"Rohrich RJ et al., 2010\", \"Foda HM, 2008\"],\n   205→      tags: [\"Surgical\"]\n   206→    }\n   207→  },\n   208→  {\n   209→    id: \"genioplasty\",\n   210→    title: \"Sliding Genioplasty (Chin Surgery)\",\n   211→    trigger_rules: {\n   212→      metrics: [\"Chin to Philtrum Ratio\", \"Recession Relative to Frankfort Plane\"],\n   213→      condition: \"OR\",\n   214→      thresholds: {\n   215→        \"Chin to Philtrum Ratio\": { operator: \"<\", value: 1.5 },\n   216→        \"Recession Relative to Frankfort Plane\": { operator: \">\", value: 15.0 }\n   217→      }\n   218→    },\n   219→    content: {\n   220→      description: \"Surgical advancement or reduction of the chin bone for improved facial balance.\",\n   221→      cost_min: 4000,\n   222→      cost_max: 12000,\n   223→      time_min: \"3 months\",\n   224→      time_max: \"12 months\",\n   225→      risks: \"Numbness, infection, asymmetry.\",\n   226→      citations: [\"Park JH et al., 2018\"],\n   227→      tags: [\"Surgical\"]\n   228→    }\n   229→  },\n   230→  {\n   231→    id: \"canthoplasty\",\n   232→    title: \"Canthoplasty (Eye Corner Surgery)\",\n   233→    trigger_rules: {\n   234→      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n   235→      condition: \"AND\",\n   236→      thresholds: {\n   237→        \"Lateral Canthal Tilt\": { operator: \"<\", value: 4.0 },\n   238→        \"Eye Aspect Ratio\": { operator: \"<\", value: 2.8 }\n   239→      }\n   240→    },\n   241→    content: {\n   242→      description: \"Surgical repositioning of the outer eye corner to create a more positive canthal tilt.\",\n   243→      cost_min: 3000,\n   244→      cost_max: 8000,\n   245→      time_min: \"2 months\",\n   246→      time_max: \"6 months\",\n   247→      risks: \"Scarring, asymmetry, dry eyes.\",\n   248→      citations: [\"Rhee SC et al., 2017\", \"Chen WP, 2016\"],\n   249→      tags: [\"Surgical\"]\n   250→    }\n   251→  },\n   252→  {\n   253→    id: \"brow_lift\",\n   254→    title: \"Brow Lift / Browridge Enhancement\",\n   255→    trigger_rules: {\n   256→      metrics: [\"Eyebrow Low Setedness\", \"Browridge Inclination Angle\"],\n   257→      condition: \"OR\",\n   258→      thresholds: {\n   259→        \"Eyebrow Low Setedness\": { operator: \">\", value: 2.0 },\n   260→        \"Browridge Inclination Angle\": { operator: \"<\", value: 10.0 }\n   261→      }\n   262→    },\n   263→    content: {\n   264→      description: \"Surgical or filler-based enhancement of brow position and browridge definition.\",\n   265→      cost_min: 1500,\n   266→      cost_max: 10000,\n   267→      time_min: \"1 month\",\n   268→      time_max: \"6 months\",\n   269→      risks: \"Asymmetry, numbness, unnatural appearance.\",\n   270→      citations: [\"Mendelson B et al., 2015\"],\n   271→      tags: [\"Surgical\", \"Minimally Invasive\"]\n   272→    }\n   273→  }\n   274→];\n   275→\n   276→// ============================================\n   277→// ADVICE ENGINE CLASS\n   278→// ============================================\n   279→\n   280→export class AdviceEngine {\n   281→  private plans: RawPlan[];\n   282→\n   283→  constructor(customPlans?: RawPlan[]) {\n   284→    this.plans = customPlans || PLANS;\n   285→  }\n   286→\n   287→  /**\n   288→   * Check if a single threshold condition is met\n   289→   */\n   290→  private checkThreshold(userValue: number, operator: '<' | '>', thresholdValue: number): boolean {\n   291→    if (operator === '<') {\n   292→      return userValue < thresholdValue;\n   293→    }\n   294→    return userValue > thresholdValue;\n   295→  }\n   296→\n   297→  /**\n   298→   * Evaluate trigger rules against user metrics\n   299→   */\n   300→  private evaluateTriggerRules(\n   301→    triggerRules: TriggerRules,\n   302→    metricsDict: Record<string, number>\n   303→  ): { isTriggered: boolean; triggeredMetrics: TriggerResult[] } {\n   304→    const { metrics, thresholds, condition } = triggerRules;\n   305→    const triggeredMetrics: TriggerResult[] = [];\n   306→    const results: boolean[] = [];\n   307→\n   308→    for (const metricName of metrics) {\n   309→      if (!(metricName in metricsDict)) continue;\n   310→      if (!(metricName in thresholds)) continue;\n   311→\n   312→      const userValue = metricsDict[metricName];\n   313→      const { operator, value: thresholdValue } = thresholds[metricName];\n   314→      const isMet = this.checkThreshold(userValue, operator, thresholdValue);\n   315→\n   316→      if (isMet) {\n   317→        triggeredMetrics.push({\n   318→          metric: metricName,\n   319→          value: userValue,\n   320→          threshold: thresholdValue,\n   321→          operator\n   322→        });\n   323→      }\n   324→\n   325→      results.push(isMet);\n   326→    }\n   327→\n   328→    const isTriggered = condition === 'AND'\n   329→      ? results.length > 0 && results.every(r => r)\n   330→      : results.some(r => r);\n   331→\n   332→    return { isTriggered, triggeredMetrics };\n   333→  }\n   334→\n   335→  /**\n   336→   * Get all recommendations that match the user's metrics\n   337→   */\n   338→  getRecommendations(metricsDict: Record<string, number>): Plan[] {\n   339→    const recommendations: Plan[] = [];\n   340→\n   341→    for (const rawPlan of this.plans) {\n   342→      const { isTriggered, triggeredMetrics } = this.evaluateTriggerRules(\n   343→        rawPlan.trigger_rules,\n   344→        metricsDict\n   345→      );\n   346→\n   347→      if (isTriggered) {\n   348→        recommendations.push({\n   349→          id: rawPlan.id,\n   350→          title: rawPlan.title,\n   351→          content: {\n   352→            description: rawPlan.content.description,\n   353→            cost_min: rawPlan.content.cost_min,\n   354→            cost_max: rawPlan.content.cost_max,\n   355→            time_min: rawPlan.content.time_min || 'Unknown',\n   356→            time_max: rawPlan.content.time_max || 'Unknown',\n   357→            risks: rawPlan.content.risks || 'Consult a professional.',\n   358→            citations: rawPlan.content.citations || [],\n   359→            tags: rawPlan.content.tags\n   360→          },\n   361→          trigger_reason: triggeredMetrics\n   362→        });\n   363→      }\n   364→    }\n   365→\n   366→    return recommendations;\n   367→  }\n   368→\n   369→  /**\n   370→   * Get recommendations sorted by cost (cheapest first)\n   371→   */\n   372→  getRecommendationsByCost(metricsDict: Record<string, number>): Plan[] {\n   373→    return this.getRecommendations(metricsDict).sort(\n   374→      (a, b) => a.content.cost_min - b.content.cost_min\n   375→    );\n   376→  }\n   377→\n   378→  /**\n   379→   * Get recommendations grouped by phase/tag\n   380→   */\n   381→  getRecommendationsByPhase(metricsDict: Record<string, number>): Record<string, Plan[]> {\n   382→    const recommendations = this.getRecommendations(metricsDict);\n   383→    const grouped: Record<string, Plan[]> = {\n   384→      'Foundational': [],\n   385→      'Minimally Invasive': [],\n   386→      'Surgical': []\n   387→    };\n   388→\n   389→    for (const rec of recommendations) {\n   390→      const tags = rec.content.tags || [];\n   391→      if (tags.includes('Foundational')) {\n   392→        grouped['Foundational'].push(rec);\n   393→      } else if (tags.includes('Surgical')) {\n   394→        grouped['Surgical'].push(rec);\n   395→      } else if (tags.includes('Minimally Invasive')) {\n   396→        grouped['Minimally Invasive'].push(rec);\n   397→      } else {\n   398→        grouped['Minimally Invasive'].push(rec); // Default\n   399→      }\n   400→    }\n   401→\n   402→    return grouped;\n   403→  }\n   404→}\n   405→\n   406→// ============================================\n   407→// SINGLETON INSTANCE\n   408→// ============================================\n   409→\n   410→export const adviceEngine = new AdviceEngine();\n   411→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"45a6398f-f815-450c-b654-2f6226a64306","timestamp":"2025-12-21T18:33:06.653Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/advice-engine.ts","content":"/**\n * Advice Engine - Client-side implementation matching the Python AdviceEngine\n * Processes plans.json trigger rules against user metrics\n */\n\nimport { Plan } from '@/components/results/cards/PlanActionCard';\n\n// ============================================\n// TYPES\n// ============================================\n\ninterface Threshold {\n  operator: '<' | '>';\n  value: number;\n}\n\ninterface TriggerRules {\n  metrics: string[];\n  condition: 'OR' | 'AND';\n  thresholds: Record<string, Threshold>;\n}\n\ninterface PlanContent {\n  description: string;\n  cost_min: number;\n  cost_max: number;\n  time_min?: string;\n  time_max?: string;\n  risks?: string;\n  citations?: string[];\n  tags?: string[];\n}\n\ninterface RawPlan {\n  id: string;\n  title: string;\n  trigger_rules: TriggerRules;\n  content: PlanContent;\n}\n\ninterface TriggerResult {\n  metric: string;\n  value: number;\n  threshold: number;\n  operator: '<' | '>';\n}\n\n// ============================================\n// PLANS DATA (from plans.json)\n// ============================================\n\nexport const PLANS: RawPlan[] = [\n  {\n    id: \"jaw_fillers\",\n    title: \"Jaw Fillers\",\n    trigger_rules: {\n      metrics: [\"Gonial Angle\", \"Bigonial Width\", \"Ramus to Mandible Ratio\"],\n      condition: \"OR\",\n      thresholds: {\n        \"Gonial Angle\": { operator: \">\", value: 128.0 },\n        \"Bigonial Width\": { operator: \"<\", value: 90.0 },\n        \"Ramus to Mandible Ratio\": { operator: \"<\", value: 0.5 }\n      }\n    },\n    content: {\n      description: \"Injectable fillers to enhance jawline definition, width, and projection.\",\n      cost_min: 600,\n      cost_max: 2500,\n      time_min: \"6 months\",\n      time_max: \"18 months\",\n      risks: \"Vascular occlusion, asymmetry, swelling.\",\n      citations: [\"Al-Khafaji et al., 2023\"],\n      tags: [\"Minimally Invasive\"]\n    }\n  },\n  {\n    id: \"cheekbone_fillers\",\n    title: \"Cheekbone Fillers\",\n    trigger_rules: {\n      metrics: [\"Cheekbone Height\", \"Face Width to Height Ratio\"],\n      condition: \"OR\",\n      thresholds: {\n        \"Cheekbone Height\": { operator: \"<\", value: 60.0 },\n        \"Face Width to Height Ratio\": { operator: \"<\", value: 1.75 }\n      }\n    },\n    content: {\n      description: \"Enhances cheekbone prominence for better facial angularity and harmony.\",\n      cost_min: 650,\n      cost_max: 2500,\n      time_min: \"6 months\",\n      time_max: \"18 months\",\n      risks: \"Asymmetry, filler migration.\",\n      citations: [\"Trinh & Gupta, 2021\"],\n      tags: [\"Minimally Invasive\"]\n    }\n  },\n  {\n    id: \"beard_growth\",\n    title: \"Beard / Stubble Growth\",\n    trigger_rules: {\n      metrics: [\"Chin to Philtrum Ratio\", \"Gonial Angle\"],\n      condition: \"OR\",\n      thresholds: {\n        \"Chin to Philtrum Ratio\": { operator: \"<\", value: 1.8 },\n        \"Gonial Angle\": { operator: \">\", value: 126.0 }\n      }\n    },\n    content: {\n      description: \"Grow dense stubble to camouflage weak chin projection or steep jawline.\",\n      cost_min: 0,\n      cost_max: 20,\n      time_min: \"1 month\",\n      time_max: \"3 months\",\n      risks: \"None\",\n      citations: [\"Dixson et al., 2016\"],\n      tags: [\"Foundational\", \"Free\"]\n    }\n  },\n  {\n    id: \"lip_filler\",\n    title: \"Lip Filler\",\n    trigger_rules: {\n      metrics: [\"Lower Lip to Upper Lip Ratio\"],\n      condition: \"OR\",\n      thresholds: {\n        \"Lower Lip to Upper Lip Ratio\": { operator: \"<\", value: 1.0 }\n      }\n    },\n    content: {\n      description: \"Injectable filler to enhance volume and correct asymmetry.\",\n      cost_min: 500,\n      cost_max: 1200,\n      time_min: \"6 months\",\n      time_max: \"12 months\",\n      risks: \"Migration, bruising.\",\n      citations: [\"Hernandez et al., 2023\"],\n      tags: [\"Minimally Invasive\"]\n    }\n  },\n  {\n    id: \"weight_loss_protocol\",\n    title: \"Fat Loss Protocol (High Protein + Cardio)\",\n    trigger_rules: {\n      metrics: [\"Cheekbone Height\", \"Jaw Slope\"],\n      condition: \"OR\",\n      thresholds: {\n        \"Cheekbone Height\": { operator: \"<\", value: 65.0 },\n        \"Jaw Slope\": { operator: \">\", value: 140.0 }\n      }\n    },\n    content: {\n      description: \"High-protein diet combined with cardio to reduce facial bloat and reveal bone structure.\",\n      cost_min: 200,\n      cost_max: 1000,\n      time_min: \"3 months\",\n      time_max: \"12 months\",\n      risks: \"None\",\n      citations: [\"Moon & Koh, 2020\"],\n      tags: [\"Foundational\"]\n    }\n  },\n  {\n    id: \"mewing_posture\",\n    title: \"Mewing & Posture Correction\",\n    trigger_rules: {\n      metrics: [\"Midface Ratio\", \"Nasolabial Angle\"],\n      condition: \"OR\",\n      thresholds: {\n        \"Midface Ratio\": { operator: \">\", value: 1.05 },\n        \"Nasolabial Angle\": { operator: \"<\", value: 90.0 }\n      }\n    },\n    content: {\n      description: \"Proper tongue posture and body alignment to improve facial forward growth over time.\",\n      cost_min: 0,\n      cost_max: 0,\n      time_min: \"12 months\",\n      time_max: \"Lifetime\",\n      risks: \"None if performed correctly.\",\n      citations: [\"Mew J. et al., 2014\"],\n      tags: [\"Foundational\", \"Free\"]\n    }\n  },\n  {\n    id: \"rhinoplasty\",\n    title: \"Rhinoplasty\",\n    trigger_rules: {\n      metrics: [\"Nasal Projection\", \"Nasal W to H Ratio\", \"Nasolabial Angle\"],\n      condition: \"OR\",\n      thresholds: {\n        \"Nasal Projection\": { operator: \">\", value: 0.75 },\n        \"Nasal W to H Ratio\": { operator: \">\", value: 0.85 },\n        \"Nasolabial Angle\": { operator: \"<\", value: 85.0 }\n      }\n    },\n    content: {\n      description: \"Surgical nose reshaping to improve proportion, projection, or correct a droopy tip.\",\n      cost_min: 5000,\n      cost_max: 15000,\n      time_min: \"6 months\",\n      time_max: \"12 months\",\n      risks: \"Infection, asymmetry, breathing issues, revision surgery.\",\n      citations: [\"Rohrich RJ et al., 2010\", \"Foda HM, 2008\"],\n      tags: [\"Surgical\"]\n    }\n  },\n  {\n    id: \"genioplasty\",\n    title: \"Sliding Genioplasty (Chin Surgery)\",\n    trigger_rules: {\n      metrics: [\"Chin to Philtrum Ratio\", \"Recession Relative to Frankfort Plane\"],\n      condition: \"OR\",\n      thresholds: {\n        \"Chin to Philtrum Ratio\": { operator: \"<\", value: 1.5 },\n        \"Recession Relative to Frankfort Plane\": { operator: \">\", value: 15.0 }\n      }\n    },\n    content: {\n      description: \"Surgical advancement or reduction of the chin bone for improved facial balance.\",\n      cost_min: 4000,\n      cost_max: 12000,\n      time_min: \"3 months\",\n      time_max: \"12 months\",\n      risks: \"Numbness, infection, asymmetry.\",\n      citations: [\"Park JH et al., 2018\"],\n      tags: [\"Surgical\"]\n    }\n  },\n  {\n    id: \"canthoplasty\",\n    title: \"Canthoplasty (Eye Corner Surgery)\",\n    trigger_rules: {\n      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n      condition: \"AND\",\n      thresholds: {\n        \"Lateral Canthal Tilt\": { operator: \"<\", value: 4.0 },\n        \"Eye Aspect Ratio\": { operator: \"<\", value: 2.8 }\n      }\n    },\n    content: {\n      description: \"Surgical repositioning of the outer eye corner to create a more positive canthal tilt.\",\n      cost_min: 3000,\n      cost_max: 8000,\n      time_min: \"2 months\",\n      time_max: \"6 months\",\n      risks: \"Scarring, asymmetry, dry eyes.\",\n      citations: [\"Rhee SC et al., 2017\", \"Chen WP, 2016\"],\n      tags: [\"Surgical\"]\n    }\n  },\n  {\n    id: \"brow_lift\",\n    title: \"Brow Lift / Browridge Enhancement\",\n    trigger_rules: {\n      metrics: [\"Eyebrow Low Setedness\", \"Browridge Inclination Angle\"],\n      condition: \"OR\",\n      thresholds: {\n        \"Eyebrow Low Setedness\": { operator: \">\", value: 2.0 },\n        \"Browridge Inclination Angle\": { operator: \"<\", value: 10.0 }\n      }\n    },\n    content: {\n      description: \"Surgical or filler-based enhancement of brow position and browridge definition.\",\n      cost_min: 1500,\n      cost_max: 10000,\n      time_min: \"1 month\",\n      time_max: \"6 months\",\n      risks: \"Asymmetry, numbness, unnatural appearance.\",\n      citations: [\"Mendelson B et al., 2015\"],\n      tags: [\"Surgical\", \"Minimally Invasive\"]\n    }\n  }\n];\n\n// ============================================\n// ADVICE ENGINE CLASS\n// ============================================\n\nexport class AdviceEngine {\n  private plans: RawPlan[];\n\n  constructor(customPlans?: RawPlan[]) {\n    this.plans = customPlans || PLANS;\n  }\n\n  /**\n   * Check if a single threshold condition is met\n   */\n  private checkThreshold(userValue: number, operator: '<' | '>', thresholdValue: number): boolean {\n    if (operator === '<') {\n      return userValue < thresholdValue;\n    }\n    return userValue > thresholdValue;\n  }\n\n  /**\n   * Evaluate trigger rules against user metrics\n   */\n  private evaluateTriggerRules(\n    triggerRules: TriggerRules,\n    metricsDict: Record<string, number>\n  ): { isTriggered: boolean; triggeredMetrics: TriggerResult[] } {\n    const { metrics, thresholds, condition } = triggerRules;\n    const triggeredMetrics: TriggerResult[] = [];\n    const results: boolean[] = [];\n\n    for (const metricName of metrics) {\n      if (!(metricName in metricsDict)) continue;\n      if (!(metricName in thresholds)) continue;\n\n      const userValue = metricsDict[metricName];\n      const { operator, value: thresholdValue } = thresholds[metricName];\n      const isMet = this.checkThreshold(userValue, operator, thresholdValue);\n\n      if (isMet) {\n        triggeredMetrics.push({\n          metric: metricName,\n          value: userValue,\n          threshold: thresholdValue,\n          operator\n        });\n      }\n\n      results.push(isMet);\n    }\n\n    const isTriggered = condition === 'AND'\n      ? results.length > 0 && results.every(r => r)\n      : results.some(r => r);\n\n    return { isTriggered, triggeredMetrics };\n  }\n\n  /**\n   * Get all recommendations that match the user's metrics\n   */\n  getRecommendations(metricsDict: Record<string, number>): Plan[] {\n    const recommendations: Plan[] = [];\n\n    for (const rawPlan of this.plans) {\n      const { isTriggered, triggeredMetrics } = this.evaluateTriggerRules(\n        rawPlan.trigger_rules,\n        metricsDict\n      );\n\n      if (isTriggered) {\n        recommendations.push({\n          id: rawPlan.id,\n          title: rawPlan.title,\n          content: {\n            description: rawPlan.content.description,\n            cost_min: rawPlan.content.cost_min,\n            cost_max: rawPlan.content.cost_max,\n            time_min: rawPlan.content.time_min || 'Unknown',\n            time_max: rawPlan.content.time_max || 'Unknown',\n            risks: rawPlan.content.risks || 'Consult a professional.',\n            citations: rawPlan.content.citations || [],\n            tags: rawPlan.content.tags\n          },\n          trigger_reason: triggeredMetrics\n        });\n      }\n    }\n\n    return recommendations;\n  }\n\n  /**\n   * Get recommendations sorted by cost (cheapest first)\n   */\n  getRecommendationsByCost(metricsDict: Record<string, number>): Plan[] {\n    return this.getRecommendations(metricsDict).sort(\n      (a, b) => a.content.cost_min - b.content.cost_min\n    );\n  }\n\n  /**\n   * Get recommendations grouped by phase/tag\n   */\n  getRecommendationsByPhase(metricsDict: Record<string, number>): Record<string, Plan[]> {\n    const recommendations = this.getRecommendations(metricsDict);\n    const grouped: Record<string, Plan[]> = {\n      'Foundational': [],\n      'Minimally Invasive': [],\n      'Surgical': []\n    };\n\n    for (const rec of recommendations) {\n      const tags = rec.content.tags || [];\n      if (tags.includes('Foundational')) {\n        grouped['Foundational'].push(rec);\n      } else if (tags.includes('Surgical')) {\n        grouped['Surgical'].push(rec);\n      } else if (tags.includes('Minimally Invasive')) {\n        grouped['Minimally Invasive'].push(rec);\n      } else {\n        grouped['Minimally Invasive'].push(rec); // Default\n      }\n    }\n\n    return grouped;\n  }\n}\n\n// ============================================\n// SINGLETON INSTANCE\n// ============================================\n\nexport const adviceEngine = new AdviceEngine();\n","numLines":411,"startLine":1,"totalLines":411}}}
{"parentUuid":"45a6398f-f815-450c-b654-2f6226a64306","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"bd90a391-e385-4284-8226-9645391dc38b","version":"2.0.70","gitBranch":"main","agentId":"a9a1bac","slug":"golden-bouncing-hennessy","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01B9hQjxYuptYHvhQgAXGrpG","type":"tool_result","content":"     1→/**\n     2→ * LOOKSMAX Scoring Engine\n     3→ * Ported from looksmax_engine.py - Presentation Layer\n     4→ *\n     5→ * Features:\n     6→ * - Weighted Harmony Score calculation (3.0x, 2.0x, 1.0x tiers)\n     7→ * - Metric-specific advice generation\n     8→ * - Gaussian scoring with exponential decay\n     9→ */\n    10→\n    11→import type { FaceIQScoreResult, QualityTier, SeverityLevel } from './faceiq-scoring';\n    12→\n    13→// =============================================================================\n    14→// HARMONY SCORE WEIGHTS\n    15→// =============================================================================\n    16→\n    17→/**\n    18→ * High Impact Metrics (3.0x weight)\n    19→ * Core facial harmony indicators that have the greatest effect on overall attractiveness\n    20→ */\n    21→export const HIGH_IMPACT_METRICS = new Set([\n    22→  'faceWidthToHeight',\n    23→  'midfaceRatio',\n    24→  'lateralCanthalTilt',\n    25→  'gonialAngle',\n    26→  'mandibularPlaneAngle',\n    27→  'chinToPhiltrumRatio',\n    28→]);\n    29→\n    30→/**\n    31→ * Medium Impact Metrics (2.0x weight)\n    32→ * Secondary aesthetic factors\n    33→ */\n    34→export const MEDIUM_IMPACT_METRICS = new Set([\n    35→  'noseBridgeToNoseWidth',\n    36→  'nasolabialAngle',\n    37→  'cheekboneHeight',\n    38→  'ramusToMandibleRatio',\n    39→]);\n    40→\n    41→/**\n    42→ * Get the weight multiplier for a metric\n    43→ */\n    44→export function getMetricWeight(metricId: string): number {\n    45→  if (HIGH_IMPACT_METRICS.has(metricId)) return 3.0;\n    46→  if (MEDIUM_IMPACT_METRICS.has(metricId)) return 2.0;\n    47→  return 1.0;\n    48→}\n    49→\n    50→/**\n    51→ * Get weight tier name for display\n    52→ */\n    53→export function getWeightTier(metricId: string): 'high' | 'medium' | 'standard' {\n    54→  if (HIGH_IMPACT_METRICS.has(metricId)) return 'high';\n    55→  if (MEDIUM_IMPACT_METRICS.has(metricId)) return 'medium';\n    56→  return 'standard';\n    57→}\n    58→\n    59→// =============================================================================\n    60→// WEIGHTED HARMONY SCORE CALCULATION\n    61→// =============================================================================\n    62→\n    63→export interface HarmonyScoreResult {\n    64→  /** Weighted harmony percentage (0-100%) */\n    65→  harmonyPercentage: number;\n    66→  /** Weighted average score (0-10 scale) */\n    67→  weightedAverage: number;\n    68→  /** Unweighted average for comparison */\n    69→  unweightedAverage: number;\n    70→  /** Breakdown by weight tier */\n    71→  weightDistribution: {\n    72→    highImpact: { count: number; avgScore: number };\n    73→    mediumImpact: { count: number; avgScore: number };\n    74→    standard: { count: number; avgScore: number };\n    75→  };\n    76→}\n    77→\n    78→/**\n    79→ * Calculate the weighted Harmony Score from scored measurements.\n    80→ * Uses 3-tier weighting: High (3x), Medium (2x), Standard (1x)\n    81→ *\n    82→ * Formula: Σ(Score × Weight) / Σ(Weights) → percentage\n    83→ */\n    84→export function calculateHarmonyScore(\n    85→  measurements: Array<{ metricId: string; standardizedScore: number }>\n    86→): HarmonyScoreResult {\n    87→  let totalWeightedScore = 0;\n    88→  let totalWeight = 0;\n    89→  let unweightedTotal = 0;\n    90→\n    91→  const tiers = {\n    92→    high: { total: 0, count: 0 },\n    93→    medium: { total: 0, count: 0 },\n    94→    standard: { total: 0, count: 0 },\n    95→  };\n    96→\n    97→  for (const m of measurements) {\n    98→    const weight = getMetricWeight(m.metricId);\n    99→    const tier = getWeightTier(m.metricId);\n   100→\n   101→    totalWeightedScore += m.standardizedScore * weight;\n   102→    totalWeight += weight;\n   103→    unweightedTotal += m.standardizedScore;\n   104→\n   105→    tiers[tier].total += m.standardizedScore;\n   106→    tiers[tier].count++;\n   107→  }\n   108→\n   109→  const weightedAverage = totalWeight > 0 ? totalWeightedScore / totalWeight : 0;\n   110→  const unweightedAverage = measurements.length > 0 ? unweightedTotal / measurements.length : 0;\n   111→  const harmonyPercentage = (weightedAverage / 10) * 100;\n   112→\n   113→  return {\n   114→    harmonyPercentage,\n   115→    weightedAverage,\n   116→    unweightedAverage,\n   117→    weightDistribution: {\n   118→      highImpact: {\n   119→        count: tiers.high.count,\n   120→        avgScore: tiers.high.count > 0 ? tiers.high.total / tiers.high.count : 0,\n   121→      },\n   122→      mediumImpact: {\n   123→        count: tiers.medium.count,\n   124→        avgScore: tiers.medium.count > 0 ? tiers.medium.total / tiers.medium.count : 0,\n   125→      },\n   126→      standard: {\n   127→        count: tiers.standard.count,\n   128→        avgScore: tiers.standard.count > 0 ? tiers.standard.total / tiers.standard.count : 0,\n   129→      },\n   130→    },\n   131→  };\n   132→}\n   133→\n   134→// =============================================================================\n   135→// ADVICE ENGINE - METRIC-SPECIFIC FEEDBACK STRINGS\n   136→// =============================================================================\n   137→\n   138→interface AdviceEntry {\n   139→  tooHigh: string;\n   140→  tooLow: string;\n   141→}\n   142→\n   143→/**\n   144→ * Comprehensive advice database for all metrics\n   145→ * Keys match metric IDs from faceiq-scoring.ts\n   146→ */\n   147→export const ADVICE_DATABASE: Record<string, AdviceEntry> = {\n   148→  // === HIGH IMPACT METRICS ===\n   149→  faceWidthToHeight: {\n   150→    tooHigh: \"Face appears wider. Consider hairstyles that add vertical length.\",\n   151→    tooLow: \"Face is elongated. Hairstyles with side volume can add balance.\",\n   152→  },\n   153→  midfaceRatio: {\n   154→    tooHigh: \"Midface is elongated. This can project maturity but may benefit from framing.\",\n   155→    tooLow: \"Midface is compact. This is often a dimorphic and youthful trait.\",\n   156→  },\n   157→  lateralCanthalTilt: {\n   158→    tooHigh: \"Eyes have significant positive tilt. Very dimorphic - no action needed.\",\n   159→    tooLow: \"Eyes have negative tilt. Consider brow-maxxing or temporal area work.\",\n   160→  },\n   161→  gonialAngle: {\n   162→    tooHigh: \"Jaw angle is steep (obtuse). Lowering body fat or chewing hard gum may improve definition.\",\n   163→    tooLow: \"Jaw angle is very sharp. Strong masculine trait - no action typically needed.\",\n   164→  },\n   165→  mandibularPlaneAngle: {\n   166→    tooHigh: \"Steep mandibular plane (long face type). May benefit from mewing or jaw work.\",\n   167→    tooLow: \"Flat mandibular plane. This is typically a favorable trait.\",\n   168→  },\n   169→  chinToPhiltrumRatio: {\n   170→    tooHigh: \"Chin is long relative to philtrum. Generally masculine; no action needed.\",\n   171→    tooLow: \"Philtrum is long relative to chin. Upper lip lifting or chin augmentation options exist.\",\n   172→  },\n   173→\n   174→  // === MEDIUM IMPACT METRICS ===\n   175→  noseBridgeToNoseWidth: {\n   176→    tooHigh: \"Nose appears narrow relative to bridge. This is typically favorable.\",\n   177→    tooLow: \"Nose is wide relative to bridge. Nostril work can refine proportions.\",\n   178→  },\n   179→  nasolabialAngle: {\n   180→    tooHigh: \"Nose tip points upward. Can appear more feminine; tip refinement may help.\",\n   181→    tooLow: \"Nose tip points downward (droopy). Tip rotation procedures can improve profile.\",\n   182→  },\n   183→  cheekboneHeight: {\n   184→    tooHigh: \"Cheekbones are exceptionally high. Very aesthetic - no action needed.\",\n   185→    tooLow: \"Cheekbones are lower set. Malar augmentation or filler can enhance projection.\",\n   186→  },\n   187→  cheekFullness: {\n   188→    tooHigh: \"Very full cheeks. Consider facial contouring if seeking a leaner look.\",\n   189→    tooLow: \"Hollow or gaunt cheeks. Malar filler or fat grafting can restore volume.\",\n   190→  },\n   191→  ramusToMandibleRatio: {\n   192→    tooHigh: \"Short mandibular body. Jaw angle implants may improve proportions.\",\n   193→    tooLow: \"Long mandibular body. This is typically favorable for facial width.\",\n   194→  },\n   195→\n   196→  // === FRONT PROFILE METRICS ===\n   197→  jawSlope: {\n   198→    tooHigh: \"Jaw slopes steeply. Consider gonial angle enhancement.\",\n   199→    tooLow: \"Jaw has minimal slope. Strong horizontal projection is present.\",\n   200→  },\n   201→  totalFacialWidthToHeight: {\n   202→    tooHigh: \"Face is very wide relative to height. Can appear robust/masculine.\",\n   203→    tooLow: \"Face is very tall relative to width. Hairstyles with width can balance.\",\n   204→  },\n   205→  mouthWidthToNoseRatio: {\n   206→    tooHigh: \"Wide mouth relative to nose. Typically attractive; no action needed.\",\n   207→    tooLow: \"Narrow mouth relative to nose. Lip exercises may help.\",\n   208→  },\n   209→  lowerThirdProportion: {\n   210→    tooHigh: \"Lower face is long. May benefit from vertical reduction options.\",\n   211→    tooLow: \"Lower face is short. Chin augmentation can add vertical height.\",\n   212→  },\n   213→  ipsilateralAlarAngle: {\n   214→    tooHigh: \"Nostril angle is wide. Alar reduction may refine the nose.\",\n   215→    tooLow: \"Nostril angle is narrow. Typically favorable; no action needed.\",\n   216→  },\n   217→  jawFrontalAngle: {\n   218→    tooHigh: \"Jaw is V-shaped. Gonial angle widening may add presence.\",\n   219→    tooLow: \"Jaw is very U-shaped/wide. Strong masculine trait.\",\n   220→  },\n   221→  eyeAspectRatio: {\n   222→    tooHigh: \"Eyes are horizontally elongated. Hunter eyes are typically desirable.\",\n   223→    tooLow: \"Eyes are more round. Lateral canthoplasty can elongate.\",\n   224→  },\n   225→  bitemporalWidth: {\n   226→    tooHigh: \"Wide temples relative to face. Full head of hair can balance.\",\n   227→    tooLow: \"Narrow temples. Can appear more refined/gracile.\",\n   228→  },\n   229→  eyebrowLowSetedness: {\n   230→    tooHigh: \"Brows are low-set (hooded). Creates intense look; browlift if too heavy.\",\n   231→    tooLow: \"Brows are high-set. More open look; brow products can add fullness.\",\n   232→  },\n   233→  eyeSeparationRatio: {\n   234→    tooHigh: \"Eyes are widely set. Creates softer look; no action typically needed.\",\n   235→    tooLow: \"Eyes are closely set. Can appear intense; glasses can balance.\",\n   236→  },\n   237→  bigonialWidth: {\n   238→    tooHigh: \"Wide jaw relative to cheekbones. Strong masculine trait.\",\n   239→    tooLow: \"Narrow jaw relative to cheekbones. Jaw angle widening may add presence.\",\n   240→  },\n   241→  lowerToUpperLipRatio: {\n   242→    tooHigh: \"Lower lip is much fuller. Very aesthetic; no action needed.\",\n   243→    tooLow: \"Upper lip is fuller. Standard proportion; lip flip may balance.\",\n   244→  },\n   245→  eyebrowTilt: {\n   246→    tooHigh: \"Brows tilt significantly upward. Can appear expressive.\",\n   247→    tooLow: \"Brows are flat or downturned. Can appear more stoic.\",\n   248→  },\n   249→\n   250→  // === SIDE PROFILE METRICS ===\n   251→  recessionRelativeToFrankfort: {\n   252→    tooHigh: \"Significant lower jaw recession. Advancement surgery may help.\",\n   253→    tooLow: \"Jaw projects forward strongly. Very masculine; monitor overbite.\",\n   254→  },\n   255→  facialDepthToHeightRatio: {\n   256→    tooHigh: \"Face is very deep relative to height. Strong forward growth.\",\n   257→    tooLow: \"Face is flat relative to height. May benefit from midface/chin work.\",\n   258→  },\n   259→  interiorMidfaceProjectionAngle: {\n   260→    tooHigh: \"Midface projects significantly. Strong forward growth.\",\n   261→    tooLow: \"Flat midface. Cheekbone augmentation may improve profile.\",\n   262→  },\n   263→  nasofrontalAngle: {\n   264→    tooHigh: \"Deep nasofrontal angle. Creates dramatic brow/nose transition.\",\n   265→    tooLow: \"Shallow nasofrontal angle. Brow work may add definition.\",\n   266→  },\n   267→  gonionToMouthLine: {\n   268→    tooHigh: \"Gonion is low relative to mouth. May appear long-faced.\",\n   269→    tooLow: \"Gonion is high relative to mouth. Compact proportions.\",\n   270→  },\n   271→  lowerLipSLinePosition: {\n   272→    tooHigh: \"Lower lip protrudes past S-line. May indicate maxillary retrusion.\",\n   273→    tooLow: \"Lower lip is behind S-line. Well-balanced profile.\",\n   274→  },\n   275→  zAngle: {\n   276→    tooHigh: \"Profile is very upright/vertical. May appear flat.\",\n   277→    tooLow: \"Profile is convex. Standard Western ideal.\",\n   278→  },\n   279→  nasomentaAngle: {\n   280→    tooHigh: \"Nose-chin line is obtuse. May indicate weak chin.\",\n   281→    tooLow: \"Nose-chin line is acute. Strong chin projection.\",\n   282→  },\n   283→  submentalCervicalAngle: {\n   284→    tooHigh: \"Weak chin-neck angle. May benefit from submental lipo or implant.\",\n   285→    tooLow: \"Sharp chin-neck angle. Excellent definition.\",\n   286→  },\n   287→  nasofacialAngle: {\n   288→    tooHigh: \"Large angle between nose and face. Strong nose or recessed face.\",\n   289→    tooLow: \"Small angle. Well-integrated nose.\",\n   290→  },\n   291→  holdawayHLine: {\n   292→    tooHigh: \"Lips project significantly. Monitor for bimax protrusion.\",\n   293→    tooLow: \"Flat lip line. May appear retruded; filler can add volume.\",\n   294→  },\n   295→  mentolabialAngle: {\n   296→    tooHigh: \"Deep mentolabial fold. Can appear aged; filler can soften.\",\n   297→    tooLow: \"Shallow mentolabial fold. Youthful and balanced.\",\n   298→  },\n   299→  eLineLowerLip: {\n   300→    tooHigh: \"Lower lip protrudes past E-line. May benefit from orthodontics.\",\n   301→    tooLow: \"Lower lip is behind E-line. Balanced or retruded.\",\n   302→  },\n   303→  eLineUpperLip: {\n   304→    tooHigh: \"Upper lip protrudes past E-line. May benefit from orthodontics.\",\n   305→    tooLow: \"Upper lip is behind E-line. Balanced or retruded.\",\n   306→  },\n   307→  nasalTipAngle: {\n   308→    tooHigh: \"Nose tip is rotated upward. Can appear feminine.\",\n   309→    tooLow: \"Nose tip droops. Tip rotation surgery can improve.\",\n   310→  },\n   311→  nasalProjection: {\n   312→    tooHigh: \"Large nose projection. Reduction rhinoplasty may refine.\",\n   313→    tooLow: \"Minimal nose projection. Augmentation rhinoplasty may enhance.\",\n   314→  },\n   315→  nasalWToHRatio: {\n   316→    tooHigh: \"Wide nose relative to height. Narrowing procedures exist.\",\n   317→    tooLow: \"Narrow nose. Typically favorable; no action needed.\",\n   318→  },\n   319→  facialConvexityGlabella: {\n   320→    tooHigh: \"Convex profile. Strong midface projection.\",\n   321→    tooLow: \"Flat or concave profile. May benefit from augmentation.\",\n   322→  },\n   323→  facialConvexityNasion: {\n   324→    tooHigh: \"Convex profile from nasion. Good forward growth.\",\n   325→    tooLow: \"Straight or concave profile. May appear flat.\",\n   326→  },\n   327→  totalFacialConvexity: {\n   328→    tooHigh: \"Very convex total profile. Midface is prominent.\",\n   329→    tooLow: \"Flat total profile. Forward growth options may help.\",\n   330→  },\n   331→  upperForeheadSlope: {\n   332→    tooHigh: \"Sloped forehead. More masculine/primal appearance.\",\n   333→    tooLow: \"Upright forehead. More neotenous appearance.\",\n   334→  },\n   335→  browridgeInclinationAngle: {\n   336→    tooHigh: \"Prominent browridge angle. Strong masculine trait.\",\n   337→    tooLow: \"Flat browridge. Implants can add definition.\",\n   338→  },\n   339→  upperThirdProportion: {\n   340→    tooHigh: \"Upper third is long. Large forehead; can be offset with hair styling.\",\n   341→    tooLow: \"Upper third is short. Compact proportions.\",\n   342→  },\n   343→  middleThirdProportion: {\n   344→    tooHigh: \"Middle third is long. May appear long-faced.\",\n   345→    tooLow: \"Middle third is short. Compact midface.\",\n   346→  },\n   347→  chinProjection: {\n   348→    tooHigh: \"Strong chin projection. Very masculine trait.\",\n   349→    tooLow: \"Weak chin projection. Genioplasty or implant can improve.\",\n   350→  },\n   351→  lipRatio: {\n   352→    tooHigh: \"Full lips. Typically attractive; no action needed.\",\n   353→    tooLow: \"Thin lips. Filler can add volume if desired.\",\n   354→  },\n   355→};\n   356→\n   357→/**\n   358→ * Generate personalized advice based on metric score and value position.\n   359→ *\n   360→ * @param metricId - The metric identifier\n   361→ * @param score - Score from 0-10\n   362→ * @param value - Actual measured value\n   363→ * @param idealMin - Minimum of ideal range\n   364→ * @param idealMax - Maximum of ideal range\n   365→ * @returns Advice string for the metric\n   366→ */\n   367→export function generateAdvice(\n   368→  metricId: string,\n   369→  score: number,\n   370→  value: number,\n   371→  idealMin: number,\n   372→  idealMax: number\n   373→): string {\n   374→  // Perfect score - no action needed\n   375→  if (score >= 9.0) {\n   376→    return \"Ideal proportions. No action needed.\";\n   377→  }\n   378→\n   379→  // Get advice from database\n   380→  const advice = ADVICE_DATABASE[metricId];\n   381→  if (advice) {\n   382→    if (value > idealMax) {\n   383→      return advice.tooHigh;\n   384→    } else if (value < idealMin) {\n   385→      return advice.tooLow;\n   386→    }\n   387→  }\n   388→\n   389→  // Default fallback\n   390→  if (value > idealMax) {\n   391→    return `Value (${value.toFixed(2)}) is above the ideal range of ${idealMin.toFixed(1)}-${idealMax.toFixed(1)}.`;\n   392→  } else if (value < idealMin) {\n   393→    return `Value (${value.toFixed(2)}) is below the ideal range of ${idealMin.toFixed(1)}-${idealMax.toFixed(1)}.`;\n   394→  } else {\n   395→    return \"Value is within acceptable range but not optimal.\";\n   396→  }\n   397→}\n   398→\n   399→/**\n   400→ * Generate advice for a FaceIQ score result\n   401→ */\n   402→export function generateAdviceFromResult(result: FaceIQScoreResult): string {\n   403→  return generateAdvice(\n   404→    result.metricId,\n   405→    result.standardizedScore,\n   406→    result.value,\n   407→    result.idealMin,\n   408→    result.idealMax\n   409→  );\n   410→}\n   411→\n   412→// =============================================================================\n   413→// GAUSSIAN SCORING (matches Python implementation)\n   414→// =============================================================================\n   415→\n   416→/**\n   417→ * Calculate a score from 0-10 using Gaussian decay.\n   418→ * Matches the Python looksmax_engine.py implementation.\n   419→ *\n   420→ * @param value - The measured value\n   421→ * @param minRange - Minimum of ideal range\n   422→ * @param maxRange - Maximum of ideal range\n   423→ * @returns Score from 0-10\n   424→ */\n   425→export function calculateGaussianScore(\n   426→  value: number,\n   427→  minRange: number,\n   428→  maxRange: number\n   429→): number {\n   430→  // Within ideal range = perfect score\n   431→  if (value >= minRange && value <= maxRange) {\n   432→    return 10.0;\n   433→  }\n   434→\n   435→  let deviation: number;\n   436→  let target: number;\n   437→\n   438→  if (value < minRange) {\n   439→    deviation = minRange - value;\n   440→    target = minRange;\n   441→  } else {\n   442→    deviation = value - maxRange;\n   443→    target = maxRange;\n   444→  }\n   445→\n   446→  // Prevent division by zero\n   447→  if (target === 0) target = 1.0;\n   448→\n   449→  // Sigma is 10% of target value\n   450→  let sigma = Math.abs(target) * 0.1;\n   451→  if (sigma === 0) sigma = 1.0;\n   452→\n   453→  // Gaussian decay\n   454→  const score = 10.0 * Math.exp(-0.5 * Math.pow(deviation / sigma, 2));\n   455→  return Math.max(0.0, Math.min(10.0, score));\n   456→}\n   457→\n   458→// =============================================================================\n   459→// TOP/BOTTOM METRICS IDENTIFICATION\n   460→// =============================================================================\n   461→\n   462→export interface RankedMetric {\n   463→  metricId: string;\n   464→  name: string;\n   465→  value: number;\n   466→  score: number;\n   467→  idealMin: number;\n   468→  idealMax: number;\n   469→  advice: string;\n   470→  weightTier: 'high' | 'medium' | 'standard';\n   471→  category: string;\n   472→}\n   473→\n   474→/**\n   475→ * Get the top N metrics (strengths) sorted by score descending\n   476→ */\n   477→export function getTopMetrics(\n   478→  measurements: FaceIQScoreResult[],\n   479→  count: number = 3\n   480→): RankedMetric[] {\n   481→  return [...measurements]\n   482→    .sort((a, b) => b.standardizedScore - a.standardizedScore)\n   483→    .slice(0, count)\n   484→    .map((m) => ({\n   485→      metricId: m.metricId,\n   486→      name: m.name,\n   487→      value: m.value,\n   488→      score: m.standardizedScore,\n   489→      idealMin: m.idealMin,\n   490→      idealMax: m.idealMax,\n   491→      advice: generateAdviceFromResult(m),\n   492→      weightTier: getWeightTier(m.metricId),\n   493→      category: m.category,\n   494→    }));\n   495→}\n   496→\n   497→/**\n   498→ * Get the bottom N metrics (areas to improve) sorted by score ascending\n   499→ */\n   500→export function getBottomMetrics(\n   501→  measurements: FaceIQScoreResult[],\n   502→  count: number = 3\n   503→): RankedMetric[] {\n   504→  return [...measurements]\n   505→    .sort((a, b) => a.standardizedScore - b.standardizedScore)\n   506→    .slice(0, count)\n   507→    .map((m) => ({\n   508→      metricId: m.metricId,\n   509→      name: m.name,\n   510→      value: m.value,\n   511→      score: m.standardizedScore,\n   512→      idealMin: m.idealMin,\n   513→      idealMax: m.idealMax,\n   514→      advice: generateAdviceFromResult(m),\n   515→      weightTier: getWeightTier(m.metricId),\n   516→      category: m.category,\n   517→    }));\n   518→}\n   519→\n   520→// =============================================================================\n   521→// QUALITY & SEVERITY HELPERS\n   522→// =============================================================================\n   523→\n   524→/**\n   525→ * Get a human-readable quality description\n   526→ */\n   527→export function getQualityDescription(tier: QualityTier): string {\n   528→  switch (tier) {\n   529→    case 'ideal': return 'Ideal';\n   530→    case 'excellent': return 'Excellent';\n   531→    case 'good': return 'Good';\n   532→    case 'below_average': return 'Below Average';\n   533→  }\n   534→}\n   535→\n   536→/**\n   537→ * Get a human-readable severity description\n   538→ */\n   539→export function getSeverityDescription(severity: SeverityLevel): string {\n   540→  switch (severity) {\n   541→    case 'optimal': return 'Optimal';\n   542→    case 'minor': return 'Minor Deviation';\n   543→    case 'moderate': return 'Moderate Deviation';\n   544→    case 'major': return 'Major Deviation';\n   545→    case 'severe': return 'Severe Deviation';\n   546→    case 'extremely_severe': return 'Extremely Severe';\n   547→  }\n   548→}\n   549→\n   550→/**\n   551→ * Get severity color for UI display\n   552→ */\n   553→export function getSeverityColor(severity: SeverityLevel): string {\n   554→  switch (severity) {\n   555→    case 'optimal': return 'text-green-400';\n   556→    case 'minor': return 'text-lime-400';\n   557→    case 'moderate': return 'text-yellow-400';\n   558→    case 'major': return 'text-orange-400';\n   559→    case 'severe': return 'text-red-400';\n   560→    case 'extremely_severe': return 'text-red-600';\n   561→  }\n   562→}\n   563→\n   564→/**\n   565→ * Get weight tier badge color\n   566→ */\n   567→export function getWeightTierColor(tier: 'high' | 'medium' | 'standard'): string {\n   568→  switch (tier) {\n   569→    case 'high': return 'bg-purple-500/20 text-purple-400 border-purple-500/30';\n   570→    case 'medium': return 'bg-blue-500/20 text-blue-400 border-blue-500/30';\n   571→    case 'standard': return 'bg-gray-500/20 text-gray-400 border-gray-500/30';\n   572→  }\n   573→}\n   574→\n   575→/**\n   576→ * Get weight tier label\n   577→ */\n   578→export function getWeightTierLabel(tier: 'high' | 'medium' | 'standard'): string {\n   579→  switch (tier) {\n   580→    case 'high': return 'High Impact (3x)';\n   581→    case 'medium': return 'Medium Impact (2x)';\n   582→    case 'standard': return 'Standard';\n   583→  }\n   584→}\n   585→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"a39c5efe-5299-405a-b6f1-08cbfba31e66","timestamp":"2025-12-21T18:33:06.653Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/looksmax-scoring.ts","content":"/**\n * LOOKSMAX Scoring Engine\n * Ported from looksmax_engine.py - Presentation Layer\n *\n * Features:\n * - Weighted Harmony Score calculation (3.0x, 2.0x, 1.0x tiers)\n * - Metric-specific advice generation\n * - Gaussian scoring with exponential decay\n */\n\nimport type { FaceIQScoreResult, QualityTier, SeverityLevel } from './faceiq-scoring';\n\n// =============================================================================\n// HARMONY SCORE WEIGHTS\n// =============================================================================\n\n/**\n * High Impact Metrics (3.0x weight)\n * Core facial harmony indicators that have the greatest effect on overall attractiveness\n */\nexport const HIGH_IMPACT_METRICS = new Set([\n  'faceWidthToHeight',\n  'midfaceRatio',\n  'lateralCanthalTilt',\n  'gonialAngle',\n  'mandibularPlaneAngle',\n  'chinToPhiltrumRatio',\n]);\n\n/**\n * Medium Impact Metrics (2.0x weight)\n * Secondary aesthetic factors\n */\nexport const MEDIUM_IMPACT_METRICS = new Set([\n  'noseBridgeToNoseWidth',\n  'nasolabialAngle',\n  'cheekboneHeight',\n  'ramusToMandibleRatio',\n]);\n\n/**\n * Get the weight multiplier for a metric\n */\nexport function getMetricWeight(metricId: string): number {\n  if (HIGH_IMPACT_METRICS.has(metricId)) return 3.0;\n  if (MEDIUM_IMPACT_METRICS.has(metricId)) return 2.0;\n  return 1.0;\n}\n\n/**\n * Get weight tier name for display\n */\nexport function getWeightTier(metricId: string): 'high' | 'medium' | 'standard' {\n  if (HIGH_IMPACT_METRICS.has(metricId)) return 'high';\n  if (MEDIUM_IMPACT_METRICS.has(metricId)) return 'medium';\n  return 'standard';\n}\n\n// =============================================================================\n// WEIGHTED HARMONY SCORE CALCULATION\n// =============================================================================\n\nexport interface HarmonyScoreResult {\n  /** Weighted harmony percentage (0-100%) */\n  harmonyPercentage: number;\n  /** Weighted average score (0-10 scale) */\n  weightedAverage: number;\n  /** Unweighted average for comparison */\n  unweightedAverage: number;\n  /** Breakdown by weight tier */\n  weightDistribution: {\n    highImpact: { count: number; avgScore: number };\n    mediumImpact: { count: number; avgScore: number };\n    standard: { count: number; avgScore: number };\n  };\n}\n\n/**\n * Calculate the weighted Harmony Score from scored measurements.\n * Uses 3-tier weighting: High (3x), Medium (2x), Standard (1x)\n *\n * Formula: Σ(Score × Weight) / Σ(Weights) → percentage\n */\nexport function calculateHarmonyScore(\n  measurements: Array<{ metricId: string; standardizedScore: number }>\n): HarmonyScoreResult {\n  let totalWeightedScore = 0;\n  let totalWeight = 0;\n  let unweightedTotal = 0;\n\n  const tiers = {\n    high: { total: 0, count: 0 },\n    medium: { total: 0, count: 0 },\n    standard: { total: 0, count: 0 },\n  };\n\n  for (const m of measurements) {\n    const weight = getMetricWeight(m.metricId);\n    const tier = getWeightTier(m.metricId);\n\n    totalWeightedScore += m.standardizedScore * weight;\n    totalWeight += weight;\n    unweightedTotal += m.standardizedScore;\n\n    tiers[tier].total += m.standardizedScore;\n    tiers[tier].count++;\n  }\n\n  const weightedAverage = totalWeight > 0 ? totalWeightedScore / totalWeight : 0;\n  const unweightedAverage = measurements.length > 0 ? unweightedTotal / measurements.length : 0;\n  const harmonyPercentage = (weightedAverage / 10) * 100;\n\n  return {\n    harmonyPercentage,\n    weightedAverage,\n    unweightedAverage,\n    weightDistribution: {\n      highImpact: {\n        count: tiers.high.count,\n        avgScore: tiers.high.count > 0 ? tiers.high.total / tiers.high.count : 0,\n      },\n      mediumImpact: {\n        count: tiers.medium.count,\n        avgScore: tiers.medium.count > 0 ? tiers.medium.total / tiers.medium.count : 0,\n      },\n      standard: {\n        count: tiers.standard.count,\n        avgScore: tiers.standard.count > 0 ? tiers.standard.total / tiers.standard.count : 0,\n      },\n    },\n  };\n}\n\n// =============================================================================\n// ADVICE ENGINE - METRIC-SPECIFIC FEEDBACK STRINGS\n// =============================================================================\n\ninterface AdviceEntry {\n  tooHigh: string;\n  tooLow: string;\n}\n\n/**\n * Comprehensive advice database for all metrics\n * Keys match metric IDs from faceiq-scoring.ts\n */\nexport const ADVICE_DATABASE: Record<string, AdviceEntry> = {\n  // === HIGH IMPACT METRICS ===\n  faceWidthToHeight: {\n    tooHigh: \"Face appears wider. Consider hairstyles that add vertical length.\",\n    tooLow: \"Face is elongated. Hairstyles with side volume can add balance.\",\n  },\n  midfaceRatio: {\n    tooHigh: \"Midface is elongated. This can project maturity but may benefit from framing.\",\n    tooLow: \"Midface is compact. This is often a dimorphic and youthful trait.\",\n  },\n  lateralCanthalTilt: {\n    tooHigh: \"Eyes have significant positive tilt. Very dimorphic - no action needed.\",\n    tooLow: \"Eyes have negative tilt. Consider brow-maxxing or temporal area work.\",\n  },\n  gonialAngle: {\n    tooHigh: \"Jaw angle is steep (obtuse). Lowering body fat or chewing hard gum may improve definition.\",\n    tooLow: \"Jaw angle is very sharp. Strong masculine trait - no action typically needed.\",\n  },\n  mandibularPlaneAngle: {\n    tooHigh: \"Steep mandibular plane (long face type). May benefit from mewing or jaw work.\",\n    tooLow: \"Flat mandibular plane. This is typically a favorable trait.\",\n  },\n  chinToPhiltrumRatio: {\n    tooHigh: \"Chin is long relative to philtrum. Generally masculine; no action needed.\",\n    tooLow: \"Philtrum is long relative to chin. Upper lip lifting or chin augmentation options exist.\",\n  },\n\n  // === MEDIUM IMPACT METRICS ===\n  noseBridgeToNoseWidth: {\n    tooHigh: \"Nose appears narrow relative to bridge. This is typically favorable.\",\n    tooLow: \"Nose is wide relative to bridge. Nostril work can refine proportions.\",\n  },\n  nasolabialAngle: {\n    tooHigh: \"Nose tip points upward. Can appear more feminine; tip refinement may help.\",\n    tooLow: \"Nose tip points downward (droopy). Tip rotation procedures can improve profile.\",\n  },\n  cheekboneHeight: {\n    tooHigh: \"Cheekbones are exceptionally high. Very aesthetic - no action needed.\",\n    tooLow: \"Cheekbones are lower set. Malar augmentation or filler can enhance projection.\",\n  },\n  cheekFullness: {\n    tooHigh: \"Very full cheeks. Consider facial contouring if seeking a leaner look.\",\n    tooLow: \"Hollow or gaunt cheeks. Malar filler or fat grafting can restore volume.\",\n  },\n  ramusToMandibleRatio: {\n    tooHigh: \"Short mandibular body. Jaw angle implants may improve proportions.\",\n    tooLow: \"Long mandibular body. This is typically favorable for facial width.\",\n  },\n\n  // === FRONT PROFILE METRICS ===\n  jawSlope: {\n    tooHigh: \"Jaw slopes steeply. Consider gonial angle enhancement.\",\n    tooLow: \"Jaw has minimal slope. Strong horizontal projection is present.\",\n  },\n  totalFacialWidthToHeight: {\n    tooHigh: \"Face is very wide relative to height. Can appear robust/masculine.\",\n    tooLow: \"Face is very tall relative to width. Hairstyles with width can balance.\",\n  },\n  mouthWidthToNoseRatio: {\n    tooHigh: \"Wide mouth relative to nose. Typically attractive; no action needed.\",\n    tooLow: \"Narrow mouth relative to nose. Lip exercises may help.\",\n  },\n  lowerThirdProportion: {\n    tooHigh: \"Lower face is long. May benefit from vertical reduction options.\",\n    tooLow: \"Lower face is short. Chin augmentation can add vertical height.\",\n  },\n  ipsilateralAlarAngle: {\n    tooHigh: \"Nostril angle is wide. Alar reduction may refine the nose.\",\n    tooLow: \"Nostril angle is narrow. Typically favorable; no action needed.\",\n  },\n  jawFrontalAngle: {\n    tooHigh: \"Jaw is V-shaped. Gonial angle widening may add presence.\",\n    tooLow: \"Jaw is very U-shaped/wide. Strong masculine trait.\",\n  },\n  eyeAspectRatio: {\n    tooHigh: \"Eyes are horizontally elongated. Hunter eyes are typically desirable.\",\n    tooLow: \"Eyes are more round. Lateral canthoplasty can elongate.\",\n  },\n  bitemporalWidth: {\n    tooHigh: \"Wide temples relative to face. Full head of hair can balance.\",\n    tooLow: \"Narrow temples. Can appear more refined/gracile.\",\n  },\n  eyebrowLowSetedness: {\n    tooHigh: \"Brows are low-set (hooded). Creates intense look; browlift if too heavy.\",\n    tooLow: \"Brows are high-set. More open look; brow products can add fullness.\",\n  },\n  eyeSeparationRatio: {\n    tooHigh: \"Eyes are widely set. Creates softer look; no action typically needed.\",\n    tooLow: \"Eyes are closely set. Can appear intense; glasses can balance.\",\n  },\n  bigonialWidth: {\n    tooHigh: \"Wide jaw relative to cheekbones. Strong masculine trait.\",\n    tooLow: \"Narrow jaw relative to cheekbones. Jaw angle widening may add presence.\",\n  },\n  lowerToUpperLipRatio: {\n    tooHigh: \"Lower lip is much fuller. Very aesthetic; no action needed.\",\n    tooLow: \"Upper lip is fuller. Standard proportion; lip flip may balance.\",\n  },\n  eyebrowTilt: {\n    tooHigh: \"Brows tilt significantly upward. Can appear expressive.\",\n    tooLow: \"Brows are flat or downturned. Can appear more stoic.\",\n  },\n\n  // === SIDE PROFILE METRICS ===\n  recessionRelativeToFrankfort: {\n    tooHigh: \"Significant lower jaw recession. Advancement surgery may help.\",\n    tooLow: \"Jaw projects forward strongly. Very masculine; monitor overbite.\",\n  },\n  facialDepthToHeightRatio: {\n    tooHigh: \"Face is very deep relative to height. Strong forward growth.\",\n    tooLow: \"Face is flat relative to height. May benefit from midface/chin work.\",\n  },\n  interiorMidfaceProjectionAngle: {\n    tooHigh: \"Midface projects significantly. Strong forward growth.\",\n    tooLow: \"Flat midface. Cheekbone augmentation may improve profile.\",\n  },\n  nasofrontalAngle: {\n    tooHigh: \"Deep nasofrontal angle. Creates dramatic brow/nose transition.\",\n    tooLow: \"Shallow nasofrontal angle. Brow work may add definition.\",\n  },\n  gonionToMouthLine: {\n    tooHigh: \"Gonion is low relative to mouth. May appear long-faced.\",\n    tooLow: \"Gonion is high relative to mouth. Compact proportions.\",\n  },\n  lowerLipSLinePosition: {\n    tooHigh: \"Lower lip protrudes past S-line. May indicate maxillary retrusion.\",\n    tooLow: \"Lower lip is behind S-line. Well-balanced profile.\",\n  },\n  zAngle: {\n    tooHigh: \"Profile is very upright/vertical. May appear flat.\",\n    tooLow: \"Profile is convex. Standard Western ideal.\",\n  },\n  nasomentaAngle: {\n    tooHigh: \"Nose-chin line is obtuse. May indicate weak chin.\",\n    tooLow: \"Nose-chin line is acute. Strong chin projection.\",\n  },\n  submentalCervicalAngle: {\n    tooHigh: \"Weak chin-neck angle. May benefit from submental lipo or implant.\",\n    tooLow: \"Sharp chin-neck angle. Excellent definition.\",\n  },\n  nasofacialAngle: {\n    tooHigh: \"Large angle between nose and face. Strong nose or recessed face.\",\n    tooLow: \"Small angle. Well-integrated nose.\",\n  },\n  holdawayHLine: {\n    tooHigh: \"Lips project significantly. Monitor for bimax protrusion.\",\n    tooLow: \"Flat lip line. May appear retruded; filler can add volume.\",\n  },\n  mentolabialAngle: {\n    tooHigh: \"Deep mentolabial fold. Can appear aged; filler can soften.\",\n    tooLow: \"Shallow mentolabial fold. Youthful and balanced.\",\n  },\n  eLineLowerLip: {\n    tooHigh: \"Lower lip protrudes past E-line. May benefit from orthodontics.\",\n    tooLow: \"Lower lip is behind E-line. Balanced or retruded.\",\n  },\n  eLineUpperLip: {\n    tooHigh: \"Upper lip protrudes past E-line. May benefit from orthodontics.\",\n    tooLow: \"Upper lip is behind E-line. Balanced or retruded.\",\n  },\n  nasalTipAngle: {\n    tooHigh: \"Nose tip is rotated upward. Can appear feminine.\",\n    tooLow: \"Nose tip droops. Tip rotation surgery can improve.\",\n  },\n  nasalProjection: {\n    tooHigh: \"Large nose projection. Reduction rhinoplasty may refine.\",\n    tooLow: \"Minimal nose projection. Augmentation rhinoplasty may enhance.\",\n  },\n  nasalWToHRatio: {\n    tooHigh: \"Wide nose relative to height. Narrowing procedures exist.\",\n    tooLow: \"Narrow nose. Typically favorable; no action needed.\",\n  },\n  facialConvexityGlabella: {\n    tooHigh: \"Convex profile. Strong midface projection.\",\n    tooLow: \"Flat or concave profile. May benefit from augmentation.\",\n  },\n  facialConvexityNasion: {\n    tooHigh: \"Convex profile from nasion. Good forward growth.\",\n    tooLow: \"Straight or concave profile. May appear flat.\",\n  },\n  totalFacialConvexity: {\n    tooHigh: \"Very convex total profile. Midface is prominent.\",\n    tooLow: \"Flat total profile. Forward growth options may help.\",\n  },\n  upperForeheadSlope: {\n    tooHigh: \"Sloped forehead. More masculine/primal appearance.\",\n    tooLow: \"Upright forehead. More neotenous appearance.\",\n  },\n  browridgeInclinationAngle: {\n    tooHigh: \"Prominent browridge angle. Strong masculine trait.\",\n    tooLow: \"Flat browridge. Implants can add definition.\",\n  },\n  upperThirdProportion: {\n    tooHigh: \"Upper third is long. Large forehead; can be offset with hair styling.\",\n    tooLow: \"Upper third is short. Compact proportions.\",\n  },\n  middleThirdProportion: {\n    tooHigh: \"Middle third is long. May appear long-faced.\",\n    tooLow: \"Middle third is short. Compact midface.\",\n  },\n  chinProjection: {\n    tooHigh: \"Strong chin projection. Very masculine trait.\",\n    tooLow: \"Weak chin projection. Genioplasty or implant can improve.\",\n  },\n  lipRatio: {\n    tooHigh: \"Full lips. Typically attractive; no action needed.\",\n    tooLow: \"Thin lips. Filler can add volume if desired.\",\n  },\n};\n\n/**\n * Generate personalized advice based on metric score and value position.\n *\n * @param metricId - The metric identifier\n * @param score - Score from 0-10\n * @param value - Actual measured value\n * @param idealMin - Minimum of ideal range\n * @param idealMax - Maximum of ideal range\n * @returns Advice string for the metric\n */\nexport function generateAdvice(\n  metricId: string,\n  score: number,\n  value: number,\n  idealMin: number,\n  idealMax: number\n): string {\n  // Perfect score - no action needed\n  if (score >= 9.0) {\n    return \"Ideal proportions. No action needed.\";\n  }\n\n  // Get advice from database\n  const advice = ADVICE_DATABASE[metricId];\n  if (advice) {\n    if (value > idealMax) {\n      return advice.tooHigh;\n    } else if (value < idealMin) {\n      return advice.tooLow;\n    }\n  }\n\n  // Default fallback\n  if (value > idealMax) {\n    return `Value (${value.toFixed(2)}) is above the ideal range of ${idealMin.toFixed(1)}-${idealMax.toFixed(1)}.`;\n  } else if (value < idealMin) {\n    return `Value (${value.toFixed(2)}) is below the ideal range of ${idealMin.toFixed(1)}-${idealMax.toFixed(1)}.`;\n  } else {\n    return \"Value is within acceptable range but not optimal.\";\n  }\n}\n\n/**\n * Generate advice for a FaceIQ score result\n */\nexport function generateAdviceFromResult(result: FaceIQScoreResult): string {\n  return generateAdvice(\n    result.metricId,\n    result.standardizedScore,\n    result.value,\n    result.idealMin,\n    result.idealMax\n  );\n}\n\n// =============================================================================\n// GAUSSIAN SCORING (matches Python implementation)\n// =============================================================================\n\n/**\n * Calculate a score from 0-10 using Gaussian decay.\n * Matches the Python looksmax_engine.py implementation.\n *\n * @param value - The measured value\n * @param minRange - Minimum of ideal range\n * @param maxRange - Maximum of ideal range\n * @returns Score from 0-10\n */\nexport function calculateGaussianScore(\n  value: number,\n  minRange: number,\n  maxRange: number\n): number {\n  // Within ideal range = perfect score\n  if (value >= minRange && value <= maxRange) {\n    return 10.0;\n  }\n\n  let deviation: number;\n  let target: number;\n\n  if (value < minRange) {\n    deviation = minRange - value;\n    target = minRange;\n  } else {\n    deviation = value - maxRange;\n    target = maxRange;\n  }\n\n  // Prevent division by zero\n  if (target === 0) target = 1.0;\n\n  // Sigma is 10% of target value\n  let sigma = Math.abs(target) * 0.1;\n  if (sigma === 0) sigma = 1.0;\n\n  // Gaussian decay\n  const score = 10.0 * Math.exp(-0.5 * Math.pow(deviation / sigma, 2));\n  return Math.max(0.0, Math.min(10.0, score));\n}\n\n// =============================================================================\n// TOP/BOTTOM METRICS IDENTIFICATION\n// =============================================================================\n\nexport interface RankedMetric {\n  metricId: string;\n  name: string;\n  value: number;\n  score: number;\n  idealMin: number;\n  idealMax: number;\n  advice: string;\n  weightTier: 'high' | 'medium' | 'standard';\n  category: string;\n}\n\n/**\n * Get the top N metrics (strengths) sorted by score descending\n */\nexport function getTopMetrics(\n  measurements: FaceIQScoreResult[],\n  count: number = 3\n): RankedMetric[] {\n  return [...measurements]\n    .sort((a, b) => b.standardizedScore - a.standardizedScore)\n    .slice(0, count)\n    .map((m) => ({\n      metricId: m.metricId,\n      name: m.name,\n      value: m.value,\n      score: m.standardizedScore,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      advice: generateAdviceFromResult(m),\n      weightTier: getWeightTier(m.metricId),\n      category: m.category,\n    }));\n}\n\n/**\n * Get the bottom N metrics (areas to improve) sorted by score ascending\n */\nexport function getBottomMetrics(\n  measurements: FaceIQScoreResult[],\n  count: number = 3\n): RankedMetric[] {\n  return [...measurements]\n    .sort((a, b) => a.standardizedScore - b.standardizedScore)\n    .slice(0, count)\n    .map((m) => ({\n      metricId: m.metricId,\n      name: m.name,\n      value: m.value,\n      score: m.standardizedScore,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      advice: generateAdviceFromResult(m),\n      weightTier: getWeightTier(m.metricId),\n      category: m.category,\n    }));\n}\n\n// =============================================================================\n// QUALITY & SEVERITY HELPERS\n// =============================================================================\n\n/**\n * Get a human-readable quality description\n */\nexport function getQualityDescription(tier: QualityTier): string {\n  switch (tier) {\n    case 'ideal': return 'Ideal';\n    case 'excellent': return 'Excellent';\n    case 'good': return 'Good';\n    case 'below_average': return 'Below Average';\n  }\n}\n\n/**\n * Get a human-readable severity description\n */\nexport function getSeverityDescription(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'optimal': return 'Optimal';\n    case 'minor': return 'Minor Deviation';\n    case 'moderate': return 'Moderate Deviation';\n    case 'major': return 'Major Deviation';\n    case 'severe': return 'Severe Deviation';\n    case 'extremely_severe': return 'Extremely Severe';\n  }\n}\n\n/**\n * Get severity color for UI display\n */\nexport function getSeverityColor(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'optimal': return 'text-green-400';\n    case 'minor': return 'text-lime-400';\n    case 'moderate': return 'text-yellow-400';\n    case 'major': return 'text-orange-400';\n    case 'severe': return 'text-red-400';\n    case 'extremely_severe': return 'text-red-600';\n  }\n}\n\n/**\n * Get weight tier badge color\n */\nexport function getWeightTierColor(tier: 'high' | 'medium' | 'standard'): string {\n  switch (tier) {\n    case 'high': return 'bg-purple-500/20 text-purple-400 border-purple-500/30';\n    case 'medium': return 'bg-blue-500/20 text-blue-400 border-blue-500/30';\n    case 'standard': return 'bg-gray-500/20 text-gray-400 border-gray-500/30';\n  }\n}\n\n/**\n * Get weight tier label\n */\nexport function getWeightTierLabel(tier: 'high' | 'medium' | 'standard'): string {\n  switch (tier) {\n    case 'high': return 'High Impact (3x)';\n    case 'medium': return 'Medium Impact (2x)';\n    case 'standard': return 'Standard';\n  }\n}\n","numLines":585,"startLine":1,"totalLines":585}}}
{"parentUuid":"a39c5efe-5299-405a-b6f1-08cbfba31e66","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"bd90a391-e385-4284-8226-9645391dc38b","version":"2.0.70","gitBranch":"main","agentId":"a9a1bac","slug":"golden-bouncing-hennessy","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01SHzhBbPcySSGdfF1TNTa1E","type":"tool_result","content":"     1→/**\n     2→ * Insights Engine\n     3→ *\n     4→ * Processes insight definitions from insights.json and classifies them\n     5→ * as strengths or areas of improvement based on user's metric scores.\n     6→ *\n     7→ * Logic:\n     8→ * - For each insight definition, calculate average score of affected metrics\n     9→ * - Weakness: if avg score < threshold → classify with severity label\n    10→ * - Strength: if avg score > threshold → classify with grade label\n    11→ *\n    12→ * Z-Score Based Severity Logic (NEW):\n    13→ * - Ideal (Green): User is inside the ideal range\n    14→ * - Good (Blue): Within 1 Standard Deviation of the mean (|z| < 1)\n    15→ * - Moderate (Yellow): Between 1 and 2 Standard Deviations (1 ≤ |z| < 2)\n    16→ * - Severe (Red): More than 2 Standard Deviations away (|z| ≥ 2)\n    17→ *\n    18→ * Severity Labels (Weaknesses):\n    19→ *   0-3 = \"Severe\"\n    20→ *   3-5 = \"Moderate\"\n    21→ *   5-7 = \"Minor\"\n    22→ *\n    23→ * Grade Labels (Strengths):\n    24→ *   8-9   = \"Good\"\n    25→ *   9-9.5 = \"Excellent\"\n    26→ *   9.5-10 = \"Ideal\"\n    27→ */\n    28→\n    29→import { Strength, Flaw } from '@/types/results';\n    30→import { FaceIQScoreResult, FACEIQ_METRICS, isValueAcceptable } from '@/lib/faceiq-scoring';\n    31→\n    32→// ============================================\n    33→// MASTER SCORING DATABASE (Z-Score Based)\n    34→// ============================================\n    35→\n    36→export type SeverityLevel = 'ideal' | 'good' | 'moderate' | 'severe';\n    37→export type Gender = 'male' | 'female';\n    38→export type Ethnicity = 'white' | 'black' | 'east_asian' | 'south_asian' | 'hispanic' | 'middle_eastern';\n    39→\n    40→export interface MasterMetricConfig {\n    41→  ideal: [number, number];  // [min, max] ideal range\n    42→  mean: number;             // Population mean\n    43→  std_dev: number;          // Standard deviation\n    44→  flaws?: {\n    45→    low?: string[];         // Flaws when value is too low\n    46→    high?: string[];        // Flaws when value is too high\n    47→  };\n    48→}\n    49→\n    50→// Base/Default standards (White Male baseline)\n    51→export const MASTER_SCORING_DB: Record<string, MasterMetricConfig> = {\n    52→  // MIDFACE & PROPORTIONS\n    53→  \"midface_ratio\": {\n    54→    ideal: [0.97, 1.00],\n    55→    mean: 1.0,\n    56→    std_dev: 0.115,\n    57→    flaws: { low: [\"Long midface\", \"Long upper jaw\"] }\n    58→  },\n    59→  \"faceWidthToHeight\": {\n    60→    ideal: [1.30, 1.45],\n    61→    mean: 1.38,\n    62→    std_dev: 0.08,\n    63→    flaws: {\n    64→      low: [\"Overly long face\", \"Narrow face\"],\n    65→      high: [\"Wide face\", \"Short face\"]\n    66→    }\n    67→  },\n    68→  \"totalFacialWidthToHeight\": {\n    69→    ideal: [1.25, 1.40],\n    70→    mean: 1.33,\n    71→    std_dev: 0.075,\n    72→    flaws: {\n    73→      low: [\"Long face shape\"],\n    74→      high: [\"Wide face shape\"]\n    75→    }\n    76→  },\n    77→  \"upperThirdProportion\": {\n    78→    ideal: [0.30, 0.36],\n    79→    mean: 0.33,\n    80→    std_dev: 0.03,\n    81→    flaws: {\n    82→      low: [\"Short forehead\"],\n    83→      high: [\"Long forehead\"]\n    84→    }\n    85→  },\n    86→  \"middleThirdProportion\": {\n    87→    ideal: [0.30, 0.36],\n    88→    mean: 0.33,\n    89→    std_dev: 0.03,\n    90→    flaws: {\n    91→      low: [\"Short midface\"],\n    92→      high: [\"Long midface\"]\n    93→    }\n    94→  },\n    95→  \"lowerThirdProportion\": {\n    96→    ideal: [0.30, 0.36],\n    97→    mean: 0.33,\n    98→    std_dev: 0.03,\n    99→    flaws: {\n   100→      low: [\"Short lower face\"],\n   101→      high: [\"Long lower face\"]\n   102→    }\n   103→  },\n   104→\n   105→  // EYE SPACING & IPD\n   106→  \"eye_separation_ratio\": {\n   107→    ideal: [0.45, 0.47],\n   108→    mean: 0.46,\n   109→    std_dev: 0.03,\n   110→    flaws: {\n   111→      low: [\"Close-set eyes\"],\n   112→      high: [\"Wide-set eyes\"]\n   113→    }\n   114→  },\n   115→  \"interpupillaryRatio\": {\n   116→    ideal: [0.44, 0.48],\n   117→    mean: 0.46,\n   118→    std_dev: 0.025,\n   119→    flaws: {\n   120→      low: [\"Close-set eyes\"],\n   121→      high: [\"Wide-set eyes\"]\n   122→    }\n   123→  },\n   124→  \"oneEyeApartTest\": {\n   125→    ideal: [0.95, 1.05],\n   126→    mean: 1.0,\n   127→    std_dev: 0.08,\n   128→    flaws: {\n   129→      low: [\"Close-set eyes\"],\n   130→      high: [\"Wide-set eyes\"]\n   131→    }\n   132→  },\n   133→  \"intercanthalWidth\": {\n   134→    ideal: [30, 35],\n   135→    mean: 32.5,\n   136→    std_dev: 2.5,\n   137→    flaws: {\n   138→      low: [\"Narrow eye spacing\"],\n   139→      high: [\"Wide eye spacing\"]\n   140→    }\n   141→  },\n   142→\n   143→  // EYE SHAPE & FEATURES\n   144→  \"lateralCanthalTilt\": {\n   145→    ideal: [6, 8],\n   146→    mean: 5.0,\n   147→    std_dev: 3.5,\n   148→    flaws: {\n   149→      low: [\"Negative canthal tilt\", \"Downturned eyes\"],\n   150→      high: [\"Excessively upturned eyes\"]\n   151→    }\n   152→  },\n   153→  \"eyeAspectRatio\": {\n   154→    ideal: [0.30, 0.35],\n   155→    mean: 0.32,\n   156→    std_dev: 0.04,\n   157→    flaws: {\n   158→      low: [\"Narrow eyes\"],\n   159→      high: [\"Round eyes\"]\n   160→    }\n   161→  },\n   162→  \"palpebralFissureLength\": {\n   163→    ideal: [28, 32],\n   164→    mean: 30.0,\n   165→    std_dev: 2.5,\n   166→    flaws: {\n   167→      low: [\"Small eyes\"],\n   168→      high: [\"Large eyes\"]\n   169→    }\n   170→  },\n   171→  \"eyeWidth\": {\n   172→    ideal: [28, 32],\n   173→    mean: 30.0,\n   174→    std_dev: 2.0,\n   175→    flaws: {\n   176→      low: [\"Narrow eyes\"],\n   177→      high: [\"Wide eyes\"]\n   178→    }\n   179→  },\n   180→  \"upperEyelidExposure\": {\n   181→    ideal: [0.5, 1.2],\n   182→    mean: 0.85,\n   183→    std_dev: 0.35,\n   184→    flaws: {\n   185→      low: [\"Hooded eyes\"],\n   186→      high: [\"Excessive upper lid exposure\"]\n   187→    }\n   188→  },\n   189→  \"tearTroughDepth\": {\n   190→    ideal: [0.0, 0.3],\n   191→    mean: 0.15,\n   192→    std_dev: 0.15,\n   193→    flaws: {\n   194→      high: [\"Dark circles / Tear troughs\", \"Under-eye hollowness\"]\n   195→    }\n   196→  },\n   197→\n   198→  // JAW ANGLES & STRUCTURE\n   199→  \"gonial_angle\": {\n   200→    ideal: [115, 125],\n   201→    mean: 118.0,\n   202→    std_dev: 6.5,\n   203→    flaws: {\n   204→      high: [\"Weak/soft jaw structure\", \"Rounded jaw\"]\n   205→    }\n   206→  },\n   207→  \"mandibularPlaneAngle\": {\n   208→    ideal: [20, 28],\n   209→    mean: 24.0,\n   210→    std_dev: 4.0,\n   211→    flaws: {\n   212→      low: [\"Flat mandibular plane\"],\n   213→      high: [\"Steep mandibular plane\", \"Hyper-divergent jaw\"]\n   214→    }\n   215→  },\n   216→  \"jawFrontalAngle\": {\n   217→    ideal: [125, 135],\n   218→    mean: 130.0,\n   219→    std_dev: 5.0,\n   220→    flaws: {\n   221→      low: [\"Steep jaw\"],\n   222→      high: [\"Flat jaw angle\"]\n   223→    }\n   224→  },\n   225→  \"jawSlope\": {\n   226→    ideal: [25, 35],\n   227→    mean: 30.0,\n   228→    std_dev: 5.0,\n   229→    flaws: {\n   230→      low: [\"Flat jawline\"],\n   231→      high: [\"Steep jawline\"]\n   232→    }\n   233→  },\n   234→\n   235→  // JAW WIDTH\n   236→  \"jawWidthRatio\": {\n   237→    ideal: [0.85, 0.95],\n   238→    mean: 0.90,\n   239→    std_dev: 0.05,\n   240→    flaws: {\n   241→      low: [\"Narrow jaw\"],\n   242→      high: [\"Wide jaw\"]\n   243→    }\n   244→  },\n   245→  \"bigonialWidth\": {\n   246→    ideal: [110, 125],\n   247→    mean: 117.5,\n   248→    std_dev: 7.5,\n   249→    flaws: {\n   250→      low: [\"Narrow jaw width\"],\n   251→      high: [\"Excessively wide jaw\"]\n   252→    }\n   253→  },\n   254→\n   255→  // CHEEKBONES\n   256→  \"cheekbone_height\": {\n   257→    ideal: [83.0, 100.0],\n   258→    mean: 85.0,\n   259→    std_dev: 5.0,\n   260→    flaws: {\n   261→      low: [\"Low-set cheekbones\", \"Flat midface\"]\n   262→    }\n   263→  },\n   264→  \"cheekboneWidth\": {\n   265→    ideal: [130, 145],\n   266→    mean: 137.5,\n   267→    std_dev: 7.5,\n   268→    flaws: {\n   269→      low: [\"Narrow cheekbones\"],\n   270→      high: [\"Wide cheekbones\"]\n   271→    }\n   272→  },\n   273→\n   274→  // CHIN\n   275→  \"chinPhiltrumRatio\": {\n   276→    ideal: [1.8, 2.2],\n   277→    mean: 2.0,\n   278→    std_dev: 0.2,\n   279→    flaws: {\n   280→      low: [\"Recessed chin\", \"Short chin\"],\n   281→      high: [\"Long chin\", \"Projected chin\"]\n   282→    }\n   283→  },\n   284→  \"chinHeight\": {\n   285→    ideal: [35, 45],\n   286→    mean: 40.0,\n   287→    std_dev: 5.0,\n   288→    flaws: {\n   289→      low: [\"Short chin\"],\n   290→      high: [\"Long chin\"]\n   291→    }\n   292→  },\n   293→  \"chinWidth\": {\n   294→    ideal: [35, 45],\n   295→    mean: 40.0,\n   296→    std_dev: 5.0,\n   297→    flaws: {\n   298→      low: [\"Pointed/Narrow chin\"],\n   299→      high: [\"Wide chin\"]\n   300→    }\n   301→  },\n   302→\n   303→  // NOSE ANGLES\n   304→  \"nasalTipAngle\": {\n   305→    ideal: [95, 115],\n   306→    mean: 105.0,\n   307→    std_dev: 10.0,\n   308→    flaws: {\n   309→      low: [\"Droopy nasal tip\"],\n   310→      high: [\"Upturned nasal tip\"]\n   311→    }\n   312→  },\n   313→  \"nasolabialAngle\": {\n   314→    ideal: [95, 110],\n   315→    mean: 102.5,\n   316→    std_dev: 7.5,\n   317→    flaws: {\n   318→      low: [\"Droopy nasal tip\"],\n   319→      high: [\"Upturned nose\"]\n   320→    }\n   321→  },\n   322→  \"nasofrontalAngle\": {\n   323→    ideal: [115, 135],\n   324→    mean: 125.0,\n   325→    std_dev: 10.0,\n   326→    flaws: {\n   327→      low: [\"Deep nasal root\"],\n   328→      high: [\"Flat nasal root\"]\n   329→    }\n   330→  },\n   331→  \"nasofacialAngle\": {\n   332→    ideal: [30, 40],\n   333→    mean: 35.0,\n   334→    std_dev: 5.0,\n   335→    flaws: {\n   336→      low: [\"Flat nose profile\"],\n   337→      high: [\"Overprojected nose\"]\n   338→    }\n   339→  },\n   340→  \"nasomentaAngle\": {\n   341→    ideal: [120, 135],\n   342→    mean: 127.5,\n   343→    std_dev: 7.5,\n   344→    flaws: {\n   345→      low: [\"Convex profile\"],\n   346→      high: [\"Concave profile\"]\n   347→    }\n   348→  },\n   349→\n   350→  // NOSE WIDTH & PROPORTIONS\n   351→  \"nasalIndex\": {\n   352→    ideal: [65, 75],\n   353→    mean: 70.0,\n   354→    std_dev: 5.0,\n   355→    flaws: {\n   356→      low: [\"Narrow nose\"],\n   357→      high: [\"Wide nose\", \"Bulbous nose\"]\n   358→    }\n   359→  },\n   360→  \"noseWidth\": {\n   361→    ideal: [35, 42],\n   362→    mean: 38.5,\n   363→    std_dev: 3.5,\n   364→    flaws: {\n   365→      low: [\"Narrow nose\"],\n   366→      high: [\"Wide nasal base\"]\n   367→    }\n   368→  },\n   369→  \"noseBridgeWidth\": {\n   370→    ideal: [12, 18],\n   371→    mean: 15.0,\n   372→    std_dev: 3.0,\n   373→    flaws: {\n   374→      low: [\"Narrow nose bridge\"],\n   375→      high: [\"Wide nose bridge\"]\n   376→    }\n   377→  },\n   378→  \"nasalProjection\": {\n   379→    ideal: [16, 22],\n   380→    mean: 19.0,\n   381→    std_dev: 3.0,\n   382→    flaws: {\n   383→      low: [\"Underprojected nose\"],\n   384→      high: [\"Overprojected nose\"]\n   385→    }\n   386→  },\n   387→  \"noseLengthRatio\": {\n   388→    ideal: [0.45, 0.55],\n   389→    mean: 0.50,\n   390→    std_dev: 0.05,\n   391→    flaws: {\n   392→      low: [\"Short nose\"],\n   393→      high: [\"Long nose\"]\n   394→    }\n   395→  },\n   396→\n   397→  // LIPS & PHILTRUM\n   398→  \"lipRatio\": {\n   399→    ideal: [1.4, 1.6],\n   400→    mean: 1.5,\n   401→    std_dev: 0.15,\n   402→    flaws: {\n   403→      low: [\"Thin upper lip\"],\n   404→      high: [\"Thick upper lip\"]\n   405→    }\n   406→  },\n   407→  \"philtrumLength\": {\n   408→    ideal: [11, 15],\n   409→    mean: 13.0,\n   410→    std_dev: 2.0,\n   411→    flaws: {\n   412→      low: [\"Short philtrum\"],\n   413→      high: [\"Long philtrum\"]\n   414→    }\n   415→  },\n   416→  \"upperLipHeight\": {\n   417→    ideal: [18, 24],\n   418→    mean: 21.0,\n   419→    std_dev: 3.0,\n   420→    flaws: {\n   421→      low: [\"Thin upper lip\"],\n   422→      high: [\"Thick upper lip\"]\n   423→    }\n   424→  },\n   425→  \"lipChinDistance\": {\n   426→    ideal: [40, 50],\n   427→    mean: 45.0,\n   428→    std_dev: 5.0,\n   429→    flaws: {\n   430→      low: [\"Short lower third\"],\n   431→      high: [\"Long lower third\"]\n   432→    }\n   433→  },\n   434→  \"upperLipProjection\": {\n   435→    ideal: [-2, 2],\n   436→    mean: 0.0,\n   437→    std_dev: 2.0,\n   438→    flaws: {\n   439→      low: [\"Recessed upper lip\"],\n   440→      high: [\"Protruding upper lip\"]\n   441→    }\n   442→  },\n   443→  \"lowerLipProjection\": {\n   444→    ideal: [-1, 3],\n   445→    mean: 1.0,\n   446→    std_dev: 2.0,\n   447→    flaws: {\n   448→      low: [\"Recessed lower lip\"],\n   449→      high: [\"Protruding lower lip\"]\n   450→    }\n   451→  },\n   452→  \"cupidsBowDepth\": {\n   453→    ideal: [3, 6],\n   454→    mean: 4.5,\n   455→    std_dev: 1.5,\n   456→    flaws: {\n   457→      low: [\"Flat cupid's bow\"],\n   458→      high: [\"Pronounced cupid's bow\"]\n   459→    }\n   460→  },\n   461→\n   462→  // EYEBROWS\n   463→  \"eyebrowHeight\": {\n   464→    ideal: [8, 14],\n   465→    mean: 11.0,\n   466→    std_dev: 3.0,\n   467→    flaws: {\n   468→      low: [\"Low-set eyebrows\"],\n   469→      high: [\"High eyebrows\"]\n   470→    }\n   471→  },\n   472→  \"browLengthRatio\": {\n   473→    ideal: [0.50, 0.60],\n   474→    mean: 0.55,\n   475→    std_dev: 0.05,\n   476→    flaws: {\n   477→      low: [\"Short eyebrows\"],\n   478→      high: [\"Long eyebrows\"]\n   479→    }\n   480→  },\n   481→  \"browLengthToFaceWidth\": {\n   482→    ideal: [0.30, 0.38],\n   483→    mean: 0.34,\n   484→    std_dev: 0.04,\n   485→    flaws: {\n   486→      low: [\"Short eyebrows\"],\n   487→      high: [\"Long eyebrows\"]\n   488→    }\n   489→  },\n   490→  \"browridgeInclinationAngle\": {\n   491→    ideal: [10, 20],\n   492→    mean: 15.0,\n   493→    std_dev: 5.0,\n   494→    flaws: {\n   495→      low: [\"Flat brow ridge\"],\n   496→      high: [\"Prominent brow ridge\"]\n   497→    }\n   498→  },\n   499→  \"eyebrowThickness\": {\n   500→    ideal: [1.5, 3.0],\n   501→    mean: 2.25,\n   502→    std_dev: 0.75,\n   503→    flaws: {\n   504→      low: [\"Sparse/Weak eyebrows\"],\n   505→      high: [\"Overly thick eyebrows\"]\n   506→    }\n   507→  },\n   508→\n   509→  // FOREHEAD\n   510→  \"foreheadHeight\": {\n   511→    ideal: [55, 70],\n   512→    mean: 62.5,\n   513→    std_dev: 7.5,\n   514→    flaws: {\n   515→      low: [\"Short forehead\"],\n   516→      high: [\"Tall forehead\"]\n   517→    }\n   518→  },\n   519→  \"bitemporalWidth\": {\n   520→    ideal: [120, 135],\n   521→    mean: 127.5,\n   522→    std_dev: 7.5,\n   523→    flaws: {\n   524→      low: [\"Narrow forehead\"],\n   525→      high: [\"Wide forehead\"]\n   526→    }\n   527→  },\n   528→\n   529→  // PROFILE & DEPTH\n   530→  \"facialDepthToHeight\": {\n   531→    ideal: [0.75, 0.85],\n   532→    mean: 0.80,\n   533→    std_dev: 0.05,\n   534→    flaws: {\n   535→      low: [\"Flat facial profile\"],\n   536→      high: [\"Overprojected profile\"]\n   537→    }\n   538→  },\n   539→  \"anteriorFacialDepth\": {\n   540→    ideal: [115, 130],\n   541→    mean: 122.5,\n   542→    std_dev: 7.5,\n   543→    flaws: {\n   544→      low: [\"Shallow face depth\"],\n   545→      high: [\"Deep face projection\"]\n   546→    }\n   547→  },\n   548→  \"totalProfileAngle\": {\n   549→    ideal: [165, 175],\n   550→    mean: 170.0,\n   551→    std_dev: 5.0,\n   552→    flaws: {\n   553→      low: [\"Convex profile\"],\n   554→      high: [\"Concave profile\"]\n   555→    }\n   556→  },\n   557→\n   558→  // ASYMMETRY\n   559→  \"facialAsymmetryIndex\": {\n   560→    ideal: [0, 3],\n   561→    mean: 2.0,\n   562→    std_dev: 1.5,\n   563→    flaws: {\n   564→      high: [\"Facial asymmetry\"]\n   565→    }\n   566→  },\n   567→  \"eyeAsymmetry\": {\n   568→    ideal: [0, 2],\n   569→    mean: 1.0,\n   570→    std_dev: 1.0,\n   571→    flaws: {\n   572→      high: [\"Eye asymmetry\"]\n   573→    }\n   574→  },\n   575→  \"jawAsymmetry\": {\n   576→    ideal: [0, 3],\n   577→    mean: 1.5,\n   578→    std_dev: 1.5,\n   579→    flaws: {\n   580→      high: [\"Jaw asymmetry\"]\n   581→    }\n   582→  },\n   583→\n   584→  // OTHER\n   585→  \"recessionFrankfort\": {\n   586→    ideal: [-2, 2],\n   587→    mean: 0.0,\n   588→    std_dev: 2.0,\n   589→    flaws: {\n   590→      low: [\"Maxillary recession\"],\n   591→      high: [\"Maxillary protrusion\"]\n   592→    }\n   593→  },\n   594→  \"neckWidth\": {\n   595→    ideal: [110, 130],\n   596→    mean: 120.0,\n   597→    std_dev: 10.0,\n   598→    flaws: {\n   599→      low: [\"Narrow neck\"],\n   600→      high: [\"Wide neck\"]\n   601→    }\n   602→  },\n   603→  \"neckToJawRatio\": {\n   604→    ideal: [0.90, 1.10],\n   605→    mean: 1.0,\n   606→    std_dev: 0.10,\n   607→    flaws: {\n   608→      low: [\"Narrow neck\"],\n   609→      high: [\"Thick neck\"]\n   610→    }\n   611→  }\n   612→};\n   613→\n   614→// ============================================\n   615→// ETHNICITY-SPECIFIC OVERRIDES\n   616→// ============================================\n   617→\n   618→/**\n   619→ * Ethnicity and gender-specific metric standards\n   620→ * These override the base MASTER_SCORING_DB values for specific populations\n   621→ */\n   622→export const ETHNICITY_OVERRIDES: Record<string, Record<string, Partial<MasterMetricConfig>>> = {\n   623→  // ========================================\n   624→  // MALE WHITE STANDARDS (Neoclassical Baseline)\n   625→  // ========================================\n   626→  \"male_white\": {\n   627→    // NOSE WIDTH - Strict 1:1 ratio (Eye Width = Nose Width)\n   628→    \"noseWidth\": {\n   629→      ideal: [35, 42],  // Corresponds to alar_base_ratio [0.98, 1.05]\n   630→      mean: 38.5,\n   631→      std_dev: 3.5,\n   632→      flaws: {\n   633→        high: [\"Wide nasal base\"]\n   634→      }\n   635→    },\n   636→\n   637→    // MIDFACE - Prefers compact midface (Hunter look)\n   638→    \"midface_ratio\": {\n   639→      ideal: [0.95, 1.02],\n   640→      mean: 0.985,\n   641→      std_dev: 0.035,\n   642→      flaws: {\n   643→        low: [\"Long midface\"]\n   644→      }\n   645→    },\n   646→\n   647→    // JAW - Square/Robust jaw preference\n   648→    \"gonial_angle\": {\n   649→      ideal: [115.0, 125.0],\n   650→      mean: 120.0,\n   651→      std_dev: 5.0,\n   652→      flaws: {\n   653→        high: [\"Weak/Soft jaw structure\"]\n   654→      }\n   655→    },\n   656→\n   657→    // FACE WIDTH - Standard Mesoprosopic range\n   658→    \"faceWidthToHeight\": {\n   659→      ideal: [1.90, 2.05],\n   660→      mean: 1.975,\n   661→      std_dev: 0.075,\n   662→      flaws: {\n   663→        low: [\"Narrow face\"],\n   664→        high: [\"Short/Wide face\"]\n   665→      }\n   666→    },\n   667→\n   668→    // EYE TILT - Neutral to slightly positive\n   669→    \"lateralCanthalTilt\": {\n   670→      ideal: [4.0, 8.0],\n   671→      mean: 6.0,\n   672→      std_dev: 2.0,\n   673→      flaws: {\n   674→        low: [\"Negative canthal tilt\"]\n   675→      }\n   676→    },\n   677→\n   678→    // LOWER FACE BALANCE\n   679→    \"chinPhiltrumRatio\": {\n   680→      ideal: [2.10, 2.30],\n   681→      mean: 2.20,\n   682→      std_dev: 0.10,\n   683→      flaws: {\n   684→        low: [\"Long philtrum / Short chin\"]\n   685→      }\n   686→    }\n   687→  },\n   688→\n   689→  // ========================================\n   690→  // MALE BLACK / AFRICAN STANDARDS\n   691→  // ========================================\n   692→  \"male_black\": {\n   693→    // NOSE WIDTH - Significantly wider tolerance\n   694→    \"noseWidth\": {\n   695→      ideal: [40, 50],  // Wider range (corresponds to alar_base_ratio [1.12, 1.25])\n   696→      mean: 45.0,\n   697→      std_dev: 5.0,\n   698→      flaws: {\n   699→        high: [\"Wide nasal base\"]\n   700→      }\n   701→    },\n   702→    \"nasalIndex\": {\n   703→      ideal: [80, 95],  // Wider nasal index\n   704→      mean: 87.5,\n   705→      std_dev: 7.5,\n   706→      flaws: {\n   707→        high: [\"Wide nose\"]\n   708→      }\n   709→    },\n   710→\n   711→    // LIPS - Prefers fuller lips\n   712→    \"lipRatio\": {\n   713→      ideal: [1.2, 1.5],\n   714→      mean: 1.35,\n   715→      std_dev: 0.15,\n   716→      flaws: {\n   717→        low: [\"Thin lips\"]\n   718→      }\n   719→    },\n   720→\n   721→    // PHILTRUM - Shorter visible philtrum is ideal\n   722→    \"philtrumLength\": {\n   723→      ideal: [11.0, 14.0],\n   724→      mean: 12.5,\n   725→      std_dev: 1.5,\n   726→      flaws: {\n   727→        high: [\"Long philtrum\"]\n   728→      }\n   729→    },\n   730→\n   731→    // CHIN - Adjusts for natural forward mouth projection (Prognathism)\n   732→    \"chinPhiltrumRatio\": {\n   733→      ideal: [1.80, 2.10],  // Lower range to account for prognathism\n   734→      mean: 1.95,\n   735→      std_dev: 0.15,\n   736→      flaws: {\n   737→        low: [\"Recessed chin\"]\n   738→      }\n   739→    }\n   740→  },\n   741→\n   742→  // ========================================\n   743→  // MALE EAST ASIAN STANDARDS\n   744→  // ========================================\n   745→  \"male_east_asian\": {\n   746→    // EYE SPACING - Shifted WIDER for East Asian males\n   747→    \"eye_separation_ratio\": {\n   748→      ideal: [0.48, 0.53],  // Shifted wider (0.46 is \"close-set\" here)\n   749→      mean: 0.505,\n   750→      std_dev: 0.025,\n   751→      flaws: {\n   752→        low: [\"Close-set eyes\"],\n   753→        high: [\"Wide-set eyes\"]\n   754→      }\n   755→    },\n   756→    \"interpupillaryRatio\": {\n   757→      ideal: [0.48, 0.53],\n   758→      mean: 0.505,\n   759→      std_dev: 0.025,\n   760→      flaws: {\n   761→        low: [\"Close-set eyes\"],\n   762→        high: [\"Wide-set eyes\"]\n   763→      }\n   764→    },\n   765→\n   766→    // EYE SHAPE - Prefers narrower/longer eyes (Hunter Eyes)\n   767→    \"eyeAspectRatio\": {\n   768→      ideal: [0.25, 0.29],  // Lower ratio = more elongated\n   769→      mean: 0.27,\n   770→      std_dev: 0.02,\n   771→      flaws: {\n   772→        low: [\"Overly narrow eyes\"],\n   773→        high: [\"Overly round eye shape\"]\n   774→      }\n   775→    },\n   776→    \"palpebralFissureLength\": {\n   777→      ideal: [29, 33],\n   778→      mean: 31.0,\n   779→      std_dev: 2.0,\n   780→      flaws: {\n   781→        low: [\"Small eyes\"],\n   782→        high: [\"Large eyes\"]\n   783→      }\n   784→    },\n   785→\n   786→    // NOSE - Asian noses typically allowed to be wider\n   787→    \"nasalIndex\": {\n   788→      ideal: [75, 85],\n   789→      mean: 80.0,\n   790→      std_dev: 5.0,\n   791→      flaws: {\n   792→        high: [\"Wide nose\"]\n   793→      }\n   794→    },\n   795→    \"noseWidth\": {\n   796→      ideal: [38, 45],\n   797→      mean: 41.5,\n   798→      std_dev: 3.5,\n   799→      flaws: {\n   800→        low: [\"Narrow nose\"],\n   801→        high: [\"Very wide nasal base\"]\n   802→      }\n   803→    },\n   804→    \"noseBridgeWidth\": {\n   805→      ideal: [14, 20],\n   806→      mean: 17.0,\n   807→      std_dev: 3.0,\n   808→      flaws: {\n   809→        low: [\"Narrow nose bridge\"],\n   810→        high: [\"Wide nose bridge\"]\n   811→      }\n   812→    },\n   813→\n   814→    // CHEEKS - Rewards slightly fuller cheeks (Youth/K-Pop aesthetic)\n   815→    \"cheekbone_height\": {\n   816→      ideal: [80.0, 95.0],\n   817→      mean: 87.5,\n   818→      std_dev: 7.5,\n   819→      flaws: {\n   820→        low: [\"Gaunt/Hollow face\"]\n   821→      }\n   822→    },\n   823→\n   824→    // JAW - Slightly softer angles acceptable\n   825→    \"gonial_angle\": {\n   826→      ideal: [118, 128],\n   827→      mean: 123.0,\n   828→      std_dev: 5.0,\n   829→      flaws: {\n   830→        high: [\"Weak/soft jaw structure\"]\n   831→      }\n   832→    },\n   833→    \"mandibularPlaneAngle\": {\n   834→      ideal: [20, 30],\n   835→      mean: 25.0,\n   836→      std_dev: 5.0,\n   837→      flaws: {\n   838→        low: [\"Flat mandibular plane\"],\n   839→        high: [\"Steep mandibular plane\"]\n   840→      }\n   841→    },\n   842→\n   843→    // FACIAL PROPORTIONS - Wider faces more common\n   844→    \"faceWidthToHeight\": {\n   845→      ideal: [1.35, 1.50],\n   846→      mean: 1.425,\n   847→      std_dev: 0.075,\n   848→      flaws: {\n   849→        low: [\"Long face\"],\n   850→        high: [\"Very wide face\"]\n   851→      }\n   852→    },\n   853→    \"totalFacialWidthToHeight\": {\n   854→      ideal: [1.30, 1.45],\n   855→      mean: 1.375,\n   856→      std_dev: 0.075,\n   857→      flaws: {\n   858→        low: [\"Long face shape\"],\n   859→        high: [\"Wide face shape\"]\n   860→      }\n   861→    }\n   862→  },\n   863→\n   864→  // ========================================\n   865→  // MALE SOUTH ASIAN STANDARDS\n   866→  // ========================================\n   867→  \"male_south_asian\": {\n   868→    // NOSE WIDTH - Slightly wider tolerance than White\n   869→    \"noseWidth\": {\n   870→      ideal: [36, 43],  // alar_base_ratio [1.00, 1.08]\n   871→      mean: 39.5,\n   872→      std_dev: 3.5,\n   873→      flaws: {\n   874→        high: [\"Wide nasal base\"]\n   875→      }\n   876→    },\n   877→\n   878→    // TEAR TROUGH - VERY STRICT. High penalty for dark circles\n   879→    \"tearTroughDepth\": {\n   880→      ideal: [0.0, 0.5],\n   881→      mean: 0.25,\n   882→      std_dev: 0.25,\n   883→      flaws: {\n   884→        high: [\"Dark circles / Tear troughs\"]\n   885→      }\n   886→    },\n   887→\n   888→    // UPPER EYELID - Often prefers visible lid platform\n   889→    \"upperEyelidExposure\": {\n   890→      ideal: [0.5, 2.0],\n   891→      mean: 1.25,\n   892→      std_dev: 0.75,\n   893→      flaws: {\n   894→        low: [\"Hooded eyes\"]\n   895→      }\n   896→    },\n   897→\n   898→    // CHEEKS - Penalizes \"Gaunt\" looks heavily\n   899→    \"cheekbone_height\": {\n   900→      ideal: [83.0, 95.0],\n   901→      mean: 89.0,\n   902→      std_dev: 6.0,\n   903→      flaws: {\n   904→        low: [\"Volume loss / Gauntness\"]\n   905→      }\n   906→    }\n   907→  },\n   908→\n   909→  // ========================================\n   910→  // MALE HISPANIC STANDARDS (\"The Bridge Model\")\n   911→  // ========================================\n   912→  \"male_hispanic\": {\n   913→    // FACE WIDTH - Rewards broader, more robust face shapes (Mestizo)\n   914→    \"faceWidthToHeight\": {\n   915→      ideal: [1.95, 2.10],\n   916→      mean: 2.025,\n   917→      std_dev: 0.075,\n   918→      flaws: {\n   919→        low: [\"Long/Narrow face\"]\n   920→      }\n   921→    },\n   922→\n   923→    // NOSE WIDTH - Bridge tolerance (Wider than White, narrower than Black)\n   924→    \"noseWidth\": {\n   925→      ideal: [36, 44],  // alar_base_ratio [1.00, 1.12]\n   926→      mean: 40.0,\n   927→      std_dev: 4.0,\n   928→      flaws: {\n   929→        high: [\"Wide nasal base\"]\n   930→      }\n   931→    },\n   932→\n   933→    // EYE TILT - Strong preference for positive tilt\n   934→    \"lateralCanthalTilt\": {\n   935→      ideal: [6.0, 12.0],\n   936→      mean: 9.0,\n   937→      std_dev: 3.0,\n   938→      flaws: {\n   939→        low: [\"Negative/Neutral canthal tilt\"]\n   940→      }\n   941→    }\n   942→  },\n   943→\n   944→  // ========================================\n   945→  // MALE MIDDLE EASTERN STANDARDS\n   946→  // ========================================\n   947→  \"male_middle_eastern\": {\n   948→    // EYEBROW THICKNESS - Prefers significantly thicker/darker brows\n   949→    \"eyebrowThickness\": {\n   950→      ideal: [2.0, 4.0],\n   951→      mean: 3.0,\n   952→      std_dev: 1.0,\n   953→      flaws: {\n   954→        low: [\"Sparse/Weak eyebrows\"],\n   955→        high: [\"Unibrow\"]\n   956→      }\n   957→    },\n   958→\n   959→    // NASOLABIAL ANGLE - Penalizes droopy tip (<90) or hooked noses\n   960→    \"nasolabialAngle\": {\n   961→      ideal: [90.0, 100.0],\n   962→      mean: 95.0,\n   963→      std_dev: 5.0,\n   964→      flaws: {\n   965→        low: [\"Droopy nose tip / Hooked nose\"]\n   966→      }\n   967→    },\n   968→\n   969→    // EYE TILT - Strong preference for Almond/Hunter eye shape\n   970→    \"lateralCanthalTilt\": {\n   971→      ideal: [4.0, 10.0],\n   972→      mean: 7.0,\n   973→      std_dev: 3.0,\n   974→      flaws: {\n   975→        low: [\"Downturned eyes\"]\n   976→      }\n   977→    },\n   978→\n   979→    // MIDFACE - Similar to White model (Compact is better)\n   980→    \"midface_ratio\": {\n   981→      ideal: [0.95, 1.02],\n   982→      mean: 0.985,\n   983→      std_dev: 0.035,\n   984→      flaws: {\n   985→        low: [\"Long midface\"]\n   986→      }\n   987→    }\n   988→  },\n   989→\n   990→  // ========================================\n   991→  // MALE PACIFIC ISLANDER STANDARDS (\"The Warrior Skull\")\n   992→  // ========================================\n   993→  \"male_pacific_islander\": {\n   994→    // FACE WIDTH - The Highest Width Standard (Very broad)\n   995→    \"faceWidthToHeight\": {\n   996→      ideal: [2.10, 2.30],\n   997→      mean: 2.20,\n   998→      std_dev: 0.10,\n   999→      flaws: {\n  1000→        low: [\"Narrow/Long face\"]\n  1001→      }\n  1002→    },\n  1003→\n  1004→    // NOSE WIDTH - Wide tolerance\n  1005→    \"noseWidth\": {\n  1006→      ideal: [38, 48],  // alar_base_ratio [1.05, 1.20]\n  1007→      mean: 43.0,\n  1008→      std_dev: 5.0,\n  1009→      flaws: {\n  1010→        high: [\"Wide nasal base\"]\n  1011→      }\n  1012→    },\n  1013→\n  1014→    // CHEEKS - Rewards high mass/robustness\n  1015→    \"cheekbone_height\": {\n  1016→      ideal: [85.0, 100.0],\n  1017→      mean: 92.5,\n  1018→      std_dev: 7.5,\n  1019→      flaws: {\n  1020→        low: [\"Gaunt/Weak face structure\"]\n  1021→      }\n  1022→    },\n  1023→\n  1024→    // CHIN WIDTH - Prefers a very broad, square chin\n  1025→    \"chinWidth\": {\n  1026→      ideal: [40.0, 50.0],\n  1027→      mean: 45.0,\n  1028→      std_dev: 5.0,\n  1029→      flaws: {\n  1030→        low: [\"Pointed/Narrow chin\"]\n  1031→      }\n  1032→    }\n  1033→  },\n  1034→\n  1035→  // ========================================\n  1036→  // FEMALE OVERRIDES (to be added)\n  1037→  // ========================================\n  1038→  \"female_white\": {\n  1039→    // TODO: Add female-specific standards\n  1040→    // Generally: softer jaw angles, fuller lips, higher eyebrows, etc.\n  1041→  },\n  1042→  \"female_east_asian\": {\n  1043→    // TODO: Add female East Asian standards\n  1044→  }\n  1045→};\n  1046→\n  1047→/**\n  1048→ * Get the appropriate metric configuration for a given gender and ethnicity\n  1049→ * Falls back to base config if no override exists\n  1050→ */\n  1051→export function getMetricConfig(\n  1052→  metricId: string,\n  1053→  gender: Gender = 'male',\n  1054→  ethnicity: Ethnicity = 'white'\n  1055→): MasterMetricConfig | undefined {\n  1056→  const key = `${gender}_${ethnicity}`;\n  1057→  const override = ETHNICITY_OVERRIDES[key]?.[metricId];\n  1058→  const baseConfig = MASTER_SCORING_DB[metricId];\n  1059→\n  1060→  if (!baseConfig) return undefined;\n  1061→\n  1062→  // Merge override with base config\n  1063→  if (override) {\n  1064→    return {\n  1065→      ...baseConfig,\n  1066→      ...override,\n  1067→      flaws: {\n  1068→        ...baseConfig.flaws,\n  1069→        ...override.flaws\n  1070→      }\n  1071→    } as MasterMetricConfig;\n  1072→  }\n  1073→\n  1074→  return baseConfig;\n  1075→}\n  1076→\n  1077→// ============================================\n  1078→// Z-SCORE SEVERITY FUNCTIONS\n  1079→// ============================================\n  1080→\n  1081→/**\n  1082→ * Calculate Z-score for a given value\n  1083→ * Z = (value - mean) / std_dev\n  1084→ */\n  1085→export function calculateZScore(value: number, mean: number, stdDev: number): number {\n  1086→  if (stdDev === 0) return 0;\n  1087→  return Math.abs((value - mean) / stdDev);\n  1088→}\n  1089→\n  1090→/**\n  1091→ * Determine severity level based on Z-score and ideal range\n  1092→ * - Ideal: Value is within ideal range\n  1093→ * - Good: |z| < 1 (within 1 standard deviation)\n  1094→ * - Moderate: 1 ≤ |z| < 2 (between 1-2 standard deviations)\n  1095→ * - Severe: |z| ≥ 2 (more than 2 standard deviations away)\n  1096→ */\n  1097→export function getSeverityFromZScore(\n  1098→  value: number,\n  1099→  config: MasterMetricConfig\n  1100→): { severity: SeverityLevel; zScore: number; isInIdeal: boolean } {\n  1101→  const { ideal, mean, std_dev } = config;\n  1102→  const isInIdeal = value >= ideal[0] && value <= ideal[1];\n  1103→  const zScore = calculateZScore(value, mean, std_dev);\n  1104→\n  1105→  let severity: SeverityLevel;\n  1106→  if (isInIdeal) {\n  1107→    severity = 'ideal';\n  1108→  } else if (zScore < 1) {\n  1109→    severity = 'good';\n  1110→  } else if (zScore < 2) {\n  1111→    severity = 'moderate';\n  1112→  } else {\n  1113→    severity = 'severe';\n  1114→  }\n  1115→\n  1116→  return { severity, zScore, isInIdeal };\n  1117→}\n  1118→\n  1119→/**\n  1120→ * Get severity for a metric value with ethnicity/gender awareness\n  1121→ */\n  1122→export function getSeverityForMetric(\n  1123→  metricId: string,\n  1124→  value: number,\n  1125→  gender: Gender = 'male',\n  1126→  ethnicity: Ethnicity = 'white'\n  1127→): { severity: SeverityLevel; zScore: number; isInIdeal: boolean; config: MasterMetricConfig } | null {\n  1128→  const config = getMetricConfig(metricId, gender, ethnicity);\n  1129→  if (!config) return null;\n  1130→\n  1131→  const result = getSeverityFromZScore(value, config);\n  1132→  return { ...result, config };\n  1133→}\n  1134→\n  1135→/**\n  1136→ * Get badge color for severity level\n  1137→ */\n  1138→export function getSeverityColor(severity: SeverityLevel): string {\n  1139→  switch (severity) {\n  1140→    case 'ideal': return 'green';\n  1141→    case 'good': return 'blue';\n  1142→    case 'moderate': return 'yellow';\n  1143→    case 'severe': return 'red';\n  1144→    default: return 'gray';\n  1145→  }\n  1146→}\n  1147→\n  1148→/**\n  1149→ * Get severity label for display\n  1150→ */\n  1151→export function getSeverityLabel(severity: SeverityLevel): string {\n  1152→  switch (severity) {\n  1153→    case 'ideal': return 'Ideal';\n  1154→    case 'good': return 'Good';\n  1155→    case 'moderate': return 'Moderate';\n  1156→    case 'severe': return 'Severe';\n  1157→    default: return 'Unknown';\n  1158→  }\n  1159→}\n  1160→\n  1161→// ============================================\n  1162→// INSIGHT DEFINITION TYPES\n  1163→// ============================================\n  1164→\n  1165→export interface InsightSeverityLogic {\n  1166→  metrics: string[];  // Display names of metrics (e.g., \"Face Width to Height Ratio\")\n  1167→  threshold: number;  // Score threshold for classification\n  1168→}\n  1169→\n  1170→export interface WeaknessSeverityLabels {\n  1171→  minor: string;\n  1172→  moderate: string;\n  1173→  severe: string;\n  1174→}\n  1175→\n  1176→export interface StrengthGradeLabels {\n  1177→  good: string;\n  1178→  excellent: string;\n  1179→  ideal: string;\n  1180→}\n  1181→\n  1182→export interface InsightContent {\n  1183→  description: string;\n  1184→  severity_labels?: WeaknessSeverityLabels;  // For weaknesses\n  1185→  grade_labels?: StrengthGradeLabels;        // For strengths\n  1186→}\n  1187→\n  1188→export interface InsightDefinition {\n  1189→  id: string;\n  1190→  title: string;\n  1191→  type: 'weakness' | 'strength';\n  1192→  severity_logic: InsightSeverityLogic;\n  1193→  content: InsightContent;\n  1194→}\n  1195→\n  1196→// ============================================\n  1197→// CLASSIFICATION RESULT TYPES\n  1198→// ============================================\n  1199→\n  1200→export type WeaknessSeverity = 'severe' | 'moderate' | 'minor';\n  1201→export type StrengthGrade = 'ideal' | 'excellent' | 'good';\n  1202→\n  1203→export interface ClassifiedWeakness {\n  1204→  insightId: string;\n  1205→  title: string;\n  1206→  description: string;\n  1207→  severity: WeaknessSeverity;\n  1208→  severityLabel: string;  // Custom label from definition (e.g., \"Extremely Long\")\n  1209→  avgScore: number;\n  1210→  matchedMetrics: MatchedMetric[];\n  1211→}\n  1212→\n  1213→export interface ClassifiedStrength {\n  1214→  insightId: string;\n  1215→  title: string;\n  1216→  description: string;\n  1217→  grade: StrengthGrade;\n  1218→  gradeLabel: string;  // Custom label from definition (e.g., \"Ideal\")\n  1219→  avgScore: number;\n  1220→  matchedMetrics: MatchedMetric[];\n  1221→}\n  1222→\n  1223→export interface MatchedMetric {\n  1224→  metricId: string;\n  1225→  metricName: string;\n  1226→  score: number;\n  1227→  value: number;\n  1228→  idealMin: number;\n  1229→  idealMax: number;\n  1230→  unit: string;\n  1231→  category: string;\n  1232→}\n  1233→\n  1234→export interface InsightClassificationResult {\n  1235→  strengths: ClassifiedStrength[];\n  1236→  weaknesses: ClassifiedWeakness[];\n  1237→}\n  1238→\n  1239→// ============================================\n  1240→// INSIGHTS DATABASE\n  1241→// ============================================\n  1242→\n  1243→export const INSIGHTS_DEFINITIONS: InsightDefinition[] = [\n  1244→  {\n  1245→    id: \"long_midface\",\n  1246→    title: \"Long Midface\",\n  1247→    type: \"weakness\",\n  1248→    severity_logic: {\n  1249→      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\", \"Ipsilateral Alar Angle\"],\n  1250→      threshold: 6.0\n  1251→    },\n  1252→    content: {\n  1253→      description: \"The middle of the face is elongated, creating an unbalanced vertical proportion.\",\n  1254→      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Extremely Long\" }\n  1255→    }\n  1256→  },\n  1257→  {\n  1258→    id: \"short_midface\",\n  1259→    title: \"Short Midface\",\n  1260→    type: \"strength\",\n  1261→    severity_logic: {\n  1262→      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\"],\n  1263→      threshold: 8.0\n  1264→    },\n  1265→    content: {\n  1266→      description: \"The midface has ideal vertical proportions, contributing to facial harmony.\",\n  1267→      grade_labels: { good: \"Proportionate\", excellent: \"Well-Balanced\", ideal: \"Ideal\" }\n  1268→    }\n  1269→  },\n  1270→  {\n  1271→    id: \"weak_jaw\",\n  1272→    title: \"Weak/Soft Jaw Structure\",\n  1273→    type: \"weakness\",\n  1274→    severity_logic: {\n  1275→      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Chin to Philtrum Ratio\", \"Jaw Slope\"],\n  1276→      threshold: 5.0\n  1277→    },\n  1278→    content: {\n  1279→      description: \"The jaw has a softer, rounder shape, often less angular and robust than the ideal.\",\n  1280→      severity_labels: { minor: \"Soft\", moderate: \"Recessed\", severe: \"Weak\" }\n  1281→    }\n  1282→  },\n  1283→  {\n  1284→    id: \"strong_jaw\",\n  1285→    title: \"Strong Jaw Definition\",\n  1286→    type: \"strength\",\n  1287→    severity_logic: {\n  1288→      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Jaw Width Ratio\", \"Bigonial Width\"],\n  1289→      threshold: 8.0\n  1290→    },\n  1291→    content: {\n  1292→      description: \"The jaw displays strong definition with well-defined angles and proportionate width.\",\n  1293→      grade_labels: { good: \"Defined\", excellent: \"Strong\", ideal: \"Ideal Angular\" }\n  1294→    }\n  1295→  },\n  1296→  {\n  1297→    id: \"refined_nasal_tip\",\n  1298→    title: \"Refined Nasal Tip\",\n  1299→    type: \"strength\",\n  1300→    severity_logic: {\n  1301→      metrics: [\"Nasal Tip Angle\", \"Nose Tip Position\", \"Frankfort-tip Angle\"],\n  1302→      threshold: 8.5\n  1303→    },\n  1304→    content: {\n  1305→      description: \"This contributes to a harmonious nasal profile due to the nasal tip being well-defined and proportionate.\",\n  1306→      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n  1307→    }\n  1308→  },\n  1309→  {\n  1310→    id: \"bulbous_nose\",\n  1311→    title: \"Bulbous Nasal Tip\",\n  1312→    type: \"weakness\",\n  1313→    severity_logic: {\n  1314→      metrics: [\"Nasal Index\", \"Nose Width\", \"Nasal Tip Angle\"],\n  1315→      threshold: 5.5\n  1316→    },\n  1317→    content: {\n  1318→      description: \"The nasal tip appears rounded and less defined, affecting nasal aesthetics.\",\n  1319→      severity_labels: { minor: \"Slightly Rounded\", moderate: \"Rounded\", severe: \"Bulbous\" }\n  1320→    }\n  1321→  },\n  1322→  {\n  1323→    id: \"ideal_upper_lip\",\n  1324→    title: \"Well-Positioned Upper Lip\",\n  1325→    type: \"strength\",\n  1326→    severity_logic: {\n  1327→      metrics: [\"Upper Lip E-Line Position\", \"Upper Lip S-Line Position\", \"Nasolabial Angle\"],\n  1328→      threshold: 9.0\n  1329→    },\n  1330→    content: {\n  1331→      description: \"This contributes to a harmonious mouth region due to the upper lip sitting neither too far forward nor too far back.\",\n  1332→      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n  1333→    }\n  1334→  },\n  1335→  {\n  1336→    id: \"negative_canthal_tilt\",\n  1337→    title: \"Negative Canthal Tilt\",\n  1338→    type: \"weakness\",\n  1339→    severity_logic: {\n  1340→      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n  1341→      threshold: 5.0\n  1342→    },\n  1343→    content: {\n  1344→      description: \"The outer corners of the eyes sit lower than the inner corners, creating a downturned appearance.\",\n  1345→      severity_labels: { minor: \"Slight Downturn\", moderate: \"Noticeable\", severe: \"Pronounced\" }\n  1346→    }\n  1347→  },\n  1348→  {\n  1349→    id: \"positive_canthal_tilt\",\n  1350→    title: \"Positive Canthal Tilt\",\n  1351→    type: \"strength\",\n  1352→    severity_logic: {\n  1353→      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n  1354→      threshold: 8.0\n  1355→    },\n  1356→    content: {\n  1357→      description: \"The outer corners of the eyes are elevated, creating an attractive upswept eye shape.\",\n  1358→      grade_labels: { good: \"Slight Upturn\", excellent: \"Well-Tilted\", ideal: \"Hunter Eyes\" }\n  1359→    }\n  1360→  },\n  1361→  {\n  1362→    id: \"balanced_facial_thirds\",\n  1363→    title: \"Balanced Facial Thirds\",\n  1364→    type: \"strength\",\n  1365→    severity_logic: {\n  1366→      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n  1367→      threshold: 8.5\n  1368→    },\n  1369→    content: {\n  1370→      description: \"The face displays well-balanced vertical proportions across all three facial thirds.\",\n  1371→      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfectly Proportioned\" }\n  1372→    }\n  1373→  },\n  1374→  {\n  1375→    id: \"imbalanced_thirds\",\n  1376→    title: \"Facial Third Imbalance\",\n  1377→    type: \"weakness\",\n  1378→    severity_logic: {\n  1379→      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n  1380→      threshold: 5.5\n  1381→    },\n  1382→    content: {\n  1383→      description: \"The vertical face proportions show imbalance between the three facial thirds.\",\n  1384→      severity_labels: { minor: \"Slight Imbalance\", moderate: \"Noticeable Disproportion\", severe: \"Significant Imbalance\" }\n  1385→    }\n  1386→  },\n  1387→  {\n  1388→    id: \"high_cheekbones\",\n  1389→    title: \"High Cheekbones\",\n  1390→    type: \"strength\",\n  1391→    severity_logic: {\n  1392→      metrics: [\"Cheekbone Height\", \"Cheekbone Width\", \"Midface Ratio\"],\n  1393→      threshold: 8.5\n  1394→    },\n  1395→    content: {\n  1396→      description: \"Well-positioned cheekbones that create attractive facial contours and catch light beautifully.\",\n  1397→      grade_labels: { good: \"Visible\", excellent: \"Prominent\", ideal: \"Model-Tier\" }\n  1398→    }\n  1399→  },\n  1400→  {\n  1401→    id: \"flat_midface\",\n  1402→    title: \"Flat Midface\",\n  1403→    type: \"weakness\",\n  1404→    severity_logic: {\n  1405→      metrics: [\"Cheekbone Height\", \"Midface Ratio\", \"Total Facial Width to Height\"],\n  1406→      threshold: 5.0\n  1407→    },\n  1408→    content: {\n  1409→      description: \"The midface lacks forward projection, resulting in flatter facial contours.\",\n  1410→      severity_labels: { minor: \"Slightly Flat\", moderate: \"Underprojected\", severe: \"Recessed\" }\n  1411→    }\n  1412→  },\n  1413→  {\n  1414→    id: \"ideal_lip_ratio\",\n  1415→    title: \"Ideal Lip Proportions\",\n  1416→    type: \"strength\",\n  1417→    severity_logic: {\n  1418→      metrics: [\"Lip Ratio\", \"Philtrum Length\", \"Lip Chin Distance\"],\n  1419→      threshold: 8.5\n  1420→    },\n  1421→    content: {\n  1422→      description: \"The lips demonstrate excellent proportions with balanced upper-to-lower lip ratio.\",\n  1423→      grade_labels: { good: \"Balanced\", excellent: \"Well-Proportioned\", ideal: \"Perfect Ratio\" }\n  1424→    }\n  1425→  },\n  1426→  {\n  1427→    id: \"thin_lips\",\n  1428→    title: \"Thin Lip Profile\",\n  1429→    type: \"weakness\",\n  1430→    severity_logic: {\n  1431→      metrics: [\"Lip Ratio\", \"Upper Lip Projection\", \"Lower Lip Projection\"],\n  1432→      threshold: 5.0\n  1433→    },\n  1434→    content: {\n  1435→      description: \"The lips appear thinner than ideal proportions, affecting lower face harmony.\",\n  1436→      severity_labels: { minor: \"Slightly Thin\", moderate: \"Thin\", severe: \"Very Thin\" }\n  1437→    }\n  1438→  },\n  1439→  {\n  1440→    id: \"ideal_ipd\",\n  1441→    title: \"Ideal Eye Spacing\",\n  1442→    type: \"strength\",\n  1443→    severity_logic: {\n  1444→      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n  1445→      threshold: 8.5\n  1446→    },\n  1447→    content: {\n  1448→      description: \"The eyes are ideally spaced, creating facial balance and attractiveness.\",\n  1449→      grade_labels: { good: \"Good Spacing\", excellent: \"Ideal Distance\", ideal: \"Perfect IPD\" }\n  1450→    }\n  1451→  },\n  1452→  {\n  1453→    id: \"wide_set_eyes\",\n  1454→    title: \"Wide-Set Eyes\",\n  1455→    type: \"weakness\",\n  1456→    severity_logic: {\n  1457→      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n  1458→      threshold: 5.5\n  1459→    },\n  1460→    content: {\n  1461→      description: \"The eyes are spaced wider apart than the aesthetic ideal.\",\n  1462→      severity_labels: { minor: \"Slightly Wide\", moderate: \"Noticeably Wide\", severe: \"Very Wide\" }\n  1463→    }\n  1464→  },\n  1465→  {\n  1466→    id: \"close_set_eyes\",\n  1467→    title: \"Close-Set Eyes\",\n  1468→    type: \"weakness\",\n  1469→    severity_logic: {\n  1470→      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"Intercanthal Width\"],\n  1471→      threshold: 5.5\n  1472→    },\n  1473→    content: {\n  1474→      description: \"The eyes are positioned closer together than the aesthetic ideal.\",\n  1475→      severity_labels: { minor: \"Slightly Close\", moderate: \"Noticeably Close\", severe: \"Very Close\" }\n  1476→    }\n  1477→  },\n  1478→  {\n  1479→    id: \"ideal_nose_projection\",\n  1480→    title: \"Ideal Nasal Projection\",\n  1481→    type: \"strength\",\n  1482→    severity_logic: {\n  1483→      metrics: [\"Nasofrontal Angle\", \"Nasofacial Angle\", \"Nasomenta Angle\"],\n  1484→      threshold: 8.5\n  1485→    },\n  1486→    content: {\n  1487→      description: \"The nose has ideal forward projection relative to the face, creating profile harmony.\",\n  1488→      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect Projection\" }\n  1489→    }\n  1490→  },\n  1491→  {\n  1492→    id: \"recessed_chin\",\n  1493→    title: \"Recessed Chin\",\n  1494→    type: \"weakness\",\n  1495→    severity_logic: {\n  1496→      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Facial Depth to Height\"],\n  1497→      threshold: 5.0\n  1498→    },\n  1499→    content: {\n  1500→      description: \"The chin sits behind the ideal position, affecting profile balance.\",\n  1501→      severity_labels: { minor: \"Slightly Recessed\", moderate: \"Recessed\", severe: \"Severely Recessed\" }\n  1502→    }\n  1503→  },\n  1504→  {\n  1505→    id: \"ideal_chin_projection\",\n  1506→    title: \"Ideal Chin Projection\",\n  1507→    type: \"strength\",\n  1508→    severity_logic: {\n  1509→      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Anterior Facial Depth\"],\n  1510→      threshold: 8.5\n  1511→    },\n  1512→    content: {\n  1513→      description: \"The chin demonstrates ideal projection and proportions relative to the face.\",\n  1514→      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect\" }\n  1515→    }\n  1516→  },\n  1517→  {\n  1518→    id: \"long_philtrum\",\n  1519→    title: \"Long Philtrum\",\n  1520→    type: \"weakness\",\n  1521→    severity_logic: {\n  1522→      metrics: [\"Philtrum Length\", \"Lip Chin Distance\", \"Upper Lip Height\"],\n  1523→      threshold: 5.5\n  1524→    },\n  1525→    content: {\n  1526→      description: \"The distance between nose and upper lip is longer than ideal.\",\n  1527→      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n  1528→    }\n  1529→  },\n  1530→  {\n  1531→    id: \"short_philtrum\",\n  1532→    title: \"Short Philtrum\",\n  1533→    type: \"strength\",\n  1534→    severity_logic: {\n  1535→      metrics: [\"Philtrum Length\", \"Upper Lip Height\"],\n  1536→      threshold: 8.0\n  1537→    },\n  1538→    content: {\n  1539→      description: \"The philtrum has ideal or shorter length, considered youthful and attractive.\",\n  1540→      grade_labels: { good: \"Good Length\", excellent: \"Short\", ideal: \"Ideal\" }\n  1541→    }\n  1542→  },\n  1543→  {\n  1544→    id: \"wide_nose\",\n  1545→    title: \"Wide Nasal Base\",\n  1546→    type: \"weakness\",\n  1547→    severity_logic: {\n  1548→      metrics: [\"Nasal Index\", \"Intercanthal Nasal Ratio\", \"Nose Bridge Width\"],\n  1549→      threshold: 5.0\n  1550→    },\n  1551→    content: {\n  1552→      description: \"The base of the nose is wider than the aesthetic ideal for facial harmony.\",\n  1553→      severity_labels: { minor: \"Slightly Wide\", moderate: \"Wide\", severe: \"Very Wide\" }\n  1554→    }\n  1555→  },\n  1556→  {\n  1557→    id: \"ideal_brow_position\",\n  1558→    title: \"Ideal Brow Position\",\n  1559→    type: \"strength\",\n  1560→    severity_logic: {\n  1561→      metrics: [\"Eyebrow Height\", \"Brow Length Ratio\"],\n  1562→      threshold: 8.0\n  1563→    },\n  1564→    content: {\n  1565→      description: \"The eyebrows are ideally positioned relative to the eyes and facial structure.\",\n  1566→      grade_labels: { good: \"Good Position\", excellent: \"Well-Arched\", ideal: \"Perfect Frame\" }\n  1567→    }\n  1568→  },\n  1569→  {\n  1570→    id: \"narrow_jaw\",\n  1571→    title: \"Narrow Jaw\",\n  1572→    type: \"weakness\",\n  1573→    severity_logic: {\n  1574→      metrics: [\"Jaw Width Ratio\", \"Bigonial Width\", \"Jaw Frontal Angle\"],\n  1575→      threshold: 5.0\n  1576→    },\n  1577→    content: {\n  1578→      description: \"The jaw is narrower than ideal, affecting lower face width and definition.\",\n  1579→      severity_labels: { minor: \"Slightly Narrow\", moderate: \"Narrow\", severe: \"Very Narrow\" }\n  1580→    }\n  1581→  },\n  1582→  {\n  1583→    id: \"steep_mandibular_plane\",\n  1584→    title: \"Steep Mandibular Plane\",\n  1585→    type: \"weakness\",\n  1586→    severity_logic: {\n  1587→      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n  1588→      threshold: 5.0\n  1589→    },\n  1590→    content: {\n  1591→      description: \"The mandibular plane angle is steeper than ideal, often indicating vertical growth pattern.\",\n  1592→      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n  1593→    }\n  1594→  },\n  1595→  // ============================================\n  1596→  // SCRAPED FROM FACEIQ (element.html / element1.html)\n  1597→  // ============================================\n  1598→  // --- WEAKNESSES ---\n  1599→  {\n  1600→    id: \"steep_jaw\",\n  1601→    title: \"Steep Jaw\",\n  1602→    type: \"weakness\",\n  1603→    severity_logic: {\n  1604→      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Jaw Frontal Angle\"],\n  1605→      threshold: 6.0\n  1606→    },\n  1607→    content: {\n  1608→      description: \"The jaw angles sharply downward, creating a narrow or pointed chin effect.\",\n  1609→      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n  1610→    }\n  1611→  },\n  1612→  {\n  1613→    id: \"maxillary_recession\",\n  1614→    title: \"Maxillary Recession\",\n  1615→    type: \"weakness\",\n  1616→    severity_logic: {\n  1617→      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Facial Depth to Height Ratio\"],\n  1618→      threshold: 6.0\n  1619→    },\n  1620→    content: {\n  1621→      description: \"The upper jaw is less forward than ideal, reducing midface projection and facial harmony.\",\n  1622→      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n  1623→    }\n  1624→  },\n  1625→  {\n  1626→    id: \"mandibular_recession\",\n  1627→    title: \"Mandibular Recession\",\n  1628→    type: \"weakness\",\n  1629→    severity_logic: {\n  1630→      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\"],\n  1631→      threshold: 6.0\n  1632→    },\n  1633→    content: {\n  1634→      description: \"The lower jaw is set back, creating a less prominent chin and an unbalanced profile.\",\n  1635→      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n  1636→    }\n  1637→  },\n  1638→  {\n  1639→    id: \"underprojected_chin\",\n  1640→    title: \"Underprojected Chin\",\n  1641→    type: \"weakness\",\n  1642→    severity_logic: {\n  1643→      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\", \"Chin Height\"],\n  1644→      threshold: 6.0\n  1645→    },\n  1646→    content: {\n  1647→      description: \"The chin lacks forward projection, creating a weak lower face appearance.\",\n  1648→      severity_labels: { minor: \"Slightly Weak\", moderate: \"Underprojected\", severe: \"Severely Underprojected\" }\n  1649→    }\n  1650→  },\n  1651→  {\n  1652→    id: \"overly_long_face\",\n  1653→    title: \"Overly Long Face Shape\",\n  1654→    type: \"weakness\",\n  1655→    severity_logic: {\n  1656→      metrics: [\"Total Facial Width to Height Ratio\", \"Face Width to Height Ratio\"],\n  1657→      threshold: 6.0\n  1658→    },\n  1659→    content: {\n  1660→      description: \"The face is excessively tall and narrow, creating an elongated appearance.\",\n  1661→      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n  1662→    }\n  1663→  },\n  1664→  {\n  1665→    id: \"hyper_divergent_jaw\",\n  1666→    title: \"Hyper-Divergent Jaw Growth\",\n  1667→    type: \"weakness\",\n  1668→    severity_logic: {\n  1669→      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n  1670→      threshold: 5.5\n  1671→    },\n  1672→    content: {\n  1673→      description: \"The jaw grows with an overly steep angle, resulting in a long or narrow lower face. This can indicate malocclusion.\",\n  1674→      severity_labels: { minor: \"Mildly Divergent\", moderate: \"Divergent\", severe: \"Hyper-Divergent\" }\n  1675→    }\n  1676→  },\n  1677→  {\n  1678→    id: \"weak_brow_ridge\",\n  1679→    title: \"Soft/Weak Brow Ridge\",\n  1680→    type: \"weakness\",\n  1681→    severity_logic: {\n  1682→      metrics: [\"Browridge Inclination Angle\", \"Eyebrow Height\"],\n  1683→      threshold: 5.5\n  1684→    },\n  1685→    content: {\n  1686→      description: \"The forehead has a softer, less prominent ridge than the ideal, reducing masculine definition.\",\n  1687→      severity_labels: { minor: \"Slightly Soft\", moderate: \"Soft\", severe: \"Very Weak\" }\n  1688→    }\n  1689→  },\n  1690→  {\n  1691→    id: \"droopy_nasal_tip\",\n  1692→    title: \"Droopy Nasal Tip\",\n  1693→    type: \"weakness\",\n  1694→    severity_logic: {\n  1695→      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\", \"Nasofacial Angle\"],\n  1696→      threshold: 5.5\n  1697→    },\n  1698→    content: {\n  1699→      description: \"The nasal tip points downward more than ideal, creating a drooping appearance.\",\n  1700→      severity_labels: { minor: \"Slightly Droopy\", moderate: \"Droopy\", severe: \"Very Droopy\" }\n  1701→    }\n  1702→  },\n  1703→  {\n  1704→    id: \"overprojected_nose\",\n  1705→    title: \"Overprojected Nose\",\n  1706→    type: \"weakness\",\n  1707→    severity_logic: {\n  1708→      metrics: [\"Nasal Projection\", \"Nasofacial Angle\", \"Nose Length Ratio\"],\n  1709→      threshold: 5.5\n  1710→    },\n  1711→    content: {\n  1712→      description: \"The nose projects too far forward relative to the face, creating imbalance.\",\n  1713→      severity_labels: { minor: \"Slightly Projected\", moderate: \"Overprojected\", severe: \"Very Overprojected\" }\n  1714→    }\n  1715→  },\n  1716→  {\n  1717→    id: \"small_eyes\",\n  1718→    title: \"Small Eyes\",\n  1719→    type: \"weakness\",\n  1720→    severity_logic: {\n  1721→      metrics: [\"Eye Aspect Ratio\", \"Palpebral Fissure Length\", \"Eye Width\"],\n  1722→      threshold: 5.5\n  1723→    },\n  1724→    content: {\n  1725→      description: \"The eyes appear smaller than the aesthetic ideal relative to the face.\",\n  1726→      severity_labels: { minor: \"Slightly Small\", moderate: \"Small\", severe: \"Very Small\" }\n  1727→    }\n  1728→  },\n  1729→  {\n  1730→    id: \"low_set_eyebrows\",\n  1731→    title: \"Low-Set Eyebrows\",\n  1732→    type: \"weakness\",\n  1733→    severity_logic: {\n  1734→      metrics: [\"Eyebrow Height\", \"Brow to Hairline Distance\"],\n  1735→      threshold: 5.5\n  1736→    },\n  1737→    content: {\n  1738→      description: \"The eyebrows sit lower than ideal, reducing the visible upper eyelid space.\",\n  1739→      severity_labels: { minor: \"Slightly Low\", moderate: \"Low\", severe: \"Very Low\" }\n  1740→    }\n  1741→  },\n  1742→  {\n  1743→    id: \"asymmetrical_face\",\n  1744→    title: \"Facial Asymmetry\",\n  1745→    type: \"weakness\",\n  1746→    severity_logic: {\n  1747→      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n  1748→      threshold: 5.5\n  1749→    },\n  1750→    content: {\n  1751→      description: \"The left and right sides of the face show noticeable differences in proportion or position.\",\n  1752→      severity_labels: { minor: \"Slight Asymmetry\", moderate: \"Noticeable Asymmetry\", severe: \"Significant Asymmetry\" }\n  1753→    }\n  1754→  },\n  1755→  // --- STRENGTHS ---\n  1756→  {\n  1757→    id: \"good_jaw_width\",\n  1758→    title: \"Good Jaw Width\",\n  1759→    type: \"strength\",\n  1760→    severity_logic: {\n  1761→      metrics: [\"Bigonial Width\", \"Jaw Width Ratio\", \"Jaw Frontal Angle\"],\n  1762→      threshold: 8.5\n  1763→    },\n  1764→    content: {\n  1765→      description: \"This contributes to a pleasant jaw contour due to the jaw being neither too wide nor too narrow.\",\n  1766→      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n  1767→    }\n  1768→  },\n  1769→  {\n  1770→    id: \"good_forehead_slope\",\n  1771→    title: \"Good Forehead Slope\",\n  1772→    type: \"strength\",\n  1773→    severity_logic: {\n  1774→      metrics: [\"Browridge Inclination Angle\", \"Forehead Height\"],\n  1775→      threshold: 8.5\n  1776→    },\n  1777→    content: {\n  1778→      description: \"This contributes to a pleasant forehead contour by indicating that the forehead is neither too steep nor too flat.\",\n  1779→      grade_labels: { good: \"Good Slope\", excellent: \"Well-Angled\", ideal: \"Ideal Slope\" }\n  1780→    }\n  1781→  },\n  1782→  {\n  1783→    id: \"good_cupids_bow\",\n  1784→    title: \"Good Cupid's Bow Depth\",\n  1785→    type: \"strength\",\n  1786→    severity_logic: {\n  1787→      metrics: [\"Cupids Bow Depth\", \"Upper Lip Height\"],\n  1788→      threshold: 8.5\n  1789→    },\n  1790→    content: {\n  1791→      description: \"This contributes to a harmonious lip region due to the cupid's bow having ideal definition and depth.\",\n  1792→      grade_labels: { good: \"Defined\", excellent: \"Well-Defined\", ideal: \"Perfectly Defined\" }\n  1793→    }\n  1794→  },\n  1795→  {\n  1796→    id: \"good_eyebrow_length\",\n  1797→    title: \"Good Eyebrow Length\",\n  1798→    type: \"strength\",\n  1799→    severity_logic: {\n  1800→      metrics: [\"Brow Length to Face Width Ratio\", \"Brow Length Ratio\"],\n  1801→      threshold: 8.5\n  1802→    },\n  1803→    content: {\n  1804→      description: \"This contributes to a harmonious eye region due to the eyebrows having ideal horizontal length relative to face width.\",\n  1805→      grade_labels: { good: \"Good Length\", excellent: \"Well-Proportioned\", ideal: \"Ideal Length\" }\n  1806→    }\n  1807→  },\n  1808→  {\n  1809→    id: \"good_neck_width\",\n  1810→    title: \"Good Neck Width\",\n  1811→    type: \"strength\",\n  1812→    severity_logic: {\n  1813→      metrics: [\"Neck Width\", \"Neck to Jaw Ratio\"],\n  1814→      threshold: 8.5\n  1815→    },\n  1816→    content: {\n  1817→      description: \"This contributes to a harmonious lower face due to the neck being neither too wide nor too thin.\",\n  1818→      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n  1819→    }\n  1820→  },\n  1821→  {\n  1822→    id: \"ideal_nasolabial_angle\",\n  1823→    title: \"Ideal Nasolabial Angle\",\n  1824→    type: \"strength\",\n  1825→    severity_logic: {\n  1826→      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\"],\n  1827→      threshold: 8.5\n  1828→    },\n  1829→    content: {\n  1830→      description: \"The angle between nose and upper lip is in the ideal range, creating profile harmony.\",\n  1831→      grade_labels: { good: \"Good Angle\", excellent: \"Well-Angled\", ideal: \"Perfect Angle\" }\n  1832→    }\n  1833→  },\n  1834→  {\n  1835→    id: \"ideal_facial_depth\",\n  1836→    title: \"Ideal Facial Depth\",\n  1837→    type: \"strength\",\n  1838→    severity_logic: {\n  1839→      metrics: [\"Facial Depth to Height Ratio\", \"Anterior Facial Depth\"],\n  1840→      threshold: 8.5\n  1841→    },\n  1842→    content: {\n  1843→      description: \"The face has ideal forward projection creating attractive three-dimensional contours.\",\n  1844→      grade_labels: { good: \"Good Depth\", excellent: \"Well-Projected\", ideal: \"Ideal Projection\" }\n  1845→    }\n  1846→  },\n  1847→  {\n  1848→    id: \"ideal_eye_shape\",\n  1849→    title: \"Ideal Eye Shape\",\n  1850→    type: \"strength\",\n  1851→    severity_logic: {\n  1852→      metrics: [\"Eye Aspect Ratio\", \"Lateral Canthal Tilt\", \"Palpebral Fissure Length\"],\n  1853→      threshold: 8.5\n  1854→    },\n  1855→    content: {\n  1856→      description: \"The eyes have an attractive almond shape with ideal proportions and tilt.\",\n  1857→      grade_labels: { good: \"Attractive\", excellent: \"Well-Shaped\", ideal: \"Hunter Eyes\" }\n  1858→    }\n  1859→  },\n  1860→  {\n  1861→    id: \"harmonious_profile\",\n  1862→    title: \"Harmonious Profile\",\n  1863→    type: \"strength\",\n  1864→    severity_logic: {\n  1865→      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Total Profile Angle\"],\n  1866→      threshold: 8.5\n  1867→    },\n  1868→    content: {\n  1869→      description: \"The facial profile shows excellent balance between nose, lips, and chin positions.\",\n  1870→      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfect Profile\" }\n  1871→    }\n  1872→  },\n  1873→  {\n  1874→    id: \"good_facial_symmetry\",\n  1875→    title: \"Good Facial Symmetry\",\n  1876→    type: \"strength\",\n  1877→    severity_logic: {\n  1878→      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n  1879→      threshold: 8.5\n  1880→    },\n  1881→    content: {\n  1882→      description: \"The face displays excellent bilateral symmetry, a key component of attractiveness.\",\n  1883→      grade_labels: { good: \"Symmetric\", excellent: \"Very Symmetric\", ideal: \"Near-Perfect Symmetry\" }\n  1884→    }\n  1885→  }\n  1886→];\n  1887→\n  1888→// ============================================\n  1889→// METRIC NAME MAPPING\n  1890→// ============================================\n  1891→\n  1892→// Map display names to metric IDs for lookup\n  1893→const METRIC_NAME_TO_ID: Record<string, string> = {\n  1894→  // Face Shape/Proportions\n  1895→  \"Face Width to Height Ratio\": \"faceWidthToHeight\",\n  1896→  \"Total Facial Width to Height\": \"totalFacialWidthToHeight\",\n  1897→  \"Total Facial Width to Height Ratio\": \"totalFacialWidthToHeight\",\n  1898→  \"Midface Ratio\": \"midfaceRatio\",\n  1899→  \"Upper Third Proportion\": \"upperThirdProportion\",\n  1900→  \"Middle Third Proportion\": \"middleThirdProportion\",\n  1901→  \"Lower Third Proportion\": \"lowerThirdProportion\",\n  1902→  \"Cheekbone Height\": \"cheekboneHeight\",\n  1903→  \"Cheekbone Width\": \"cheekboneWidth\",\n  1904→  \"Bitemporal Width\": \"bitemporalWidth\",\n  1905→  \"Forehead Height\": \"foreheadHeight\",\n  1906→  \"Facial Asymmetry Index\": \"facialAsymmetryIndex\",\n  1907→\n  1908→  // Jaw\n  1909→  \"Gonial Angle\": \"gonialAngle\",\n  1910→  \"Mandibular Plane Angle\": \"mandibularPlaneAngle\",\n  1911→  \"Jaw Width Ratio\": \"jawWidthRatio\",\n  1912→  \"Bigonial Width\": \"bigonialWidth\",\n  1913→  \"Jaw Frontal Angle\": \"jawFrontalAngle\",\n  1914→  \"Jaw Slope\": \"jawSlope\",\n  1915→  \"Jaw Asymmetry\": \"jawAsymmetry\",\n  1916→\n  1917→  // Chin\n  1918→  \"Chin to Philtrum Ratio\": \"chinPhiltrumRatio\",\n  1919→  \"Chin Height\": \"chinHeight\",\n  1920→  \"Facial Depth to Height\": \"facialDepthToHeight\",\n  1921→  \"Facial Depth to Height Ratio\": \"facialDepthToHeight\",\n  1922→  \"Anterior Facial Depth\": \"anteriorFacialDepth\",\n  1923→  \"Recession Relative to Frankfort Plane\": \"recessionFrankfort\",\n  1924→\n  1925→  // Eyes\n  1926→  \"Lateral Canthal Tilt\": \"lateralCanthalTilt\",\n  1927→  \"Eye Aspect Ratio\": \"eyeAspectRatio\",\n  1928→  \"Eye Separation Ratio\": \"eyeSeparationRatio\",\n  1929→  \"Interpupillary Ratio\": \"interpupillaryRatio\",\n  1930→  \"One Eye Apart Test\": \"oneEyeApartTest\",\n  1931→  \"Intercanthal Width\": \"intercanthalWidth\",\n  1932→  \"Eyebrow Height\": \"eyebrowHeight\",\n  1933→  \"Brow Length Ratio\": \"browLengthRatio\",\n  1934→  \"Brow Length to Face Width Ratio\": \"browLengthToFaceWidth\",\n  1935→  \"Palpebral Fissure Length\": \"palpebralFissureLength\",\n  1936→  \"Eye Width\": \"eyeWidth\",\n  1937→  \"Eye Asymmetry\": \"eyeAsymmetry\",\n  1938→  \"Brow to Hairline Distance\": \"browToHairlineDistance\",\n  1939→\n  1940→  // Brow\n  1941→  \"Browridge Inclination Angle\": \"browridgeInclinationAngle\",\n  1942→\n  1943→  // Nose\n  1944→  \"Nasal Index\": \"nasalIndex\",\n  1945→  \"Nasal Tip Angle\": \"nasalTipAngle\",\n  1946→  \"Nose Tip Position\": \"noseTipPosition\",\n  1947→  \"Frankfort-tip Angle\": \"frankfortTipAngle\",\n  1948→  \"Nasofrontal Angle\": \"nasofrontalAngle\",\n  1949→  \"Nasofacial Angle\": \"nasofacialAngle\",\n  1950→  \"Nasomenta Angle\": \"nasomentaAngle\",\n  1951→  \"Nasomental Angle\": \"nasomentaAngle\",\n  1952→  \"Intercanthal Nasal Ratio\": \"intercanthalNasalRatio\",\n  1953→  \"Nose Bridge Width\": \"noseBridgeWidth\",\n  1954→  \"Nose Width\": \"noseWidth\",\n  1955→  \"Nasal Projection\": \"nasalProjection\",\n  1956→  \"Nose Length Ratio\": \"noseLengthRatio\",\n  1957→  \"Ipsilateral Alar Angle\": \"ipsilateralAlarAngle\",\n  1958→\n  1959→  // Lips\n  1960→  \"Lip Ratio\": \"lipRatio\",\n  1961→  \"Philtrum Length\": \"philtrumLength\",\n  1962→  \"Upper Lip Projection\": \"upperLipProjection\",\n  1963→  \"Lower Lip Projection\": \"lowerLipProjection\",\n  1964→  \"Lip Chin Distance\": \"lipChinDistance\",\n  1965→  \"Upper Lip Height\": \"upperLipHeight\",\n  1966→  \"Upper Lip E-Line Position\": \"upperLipELine\",\n  1967→  \"Upper Lip S-Line Position\": \"upperLipSLine\",\n  1968→  \"Nasolabial Angle\": \"nasolabialAngle\",\n  1969→  \"Cupids Bow Depth\": \"cupidsBowDepth\",\n  1970→\n  1971→  // Neck\n  1972→  \"Neck Width\": \"neckWidth\",\n  1973→  \"Neck to Jaw Ratio\": \"neckToJawRatio\",\n  1974→\n  1975→  // Profile\n  1976→  \"Total Profile Angle\": \"totalProfileAngle\",\n  1977→};\n  1978→\n  1979→// ============================================\n  1980→// CLASSIFICATION FUNCTIONS\n  1981→// ============================================\n  1982→\n  1983→/**\n  1984→ * Get weakness severity based on average score\n  1985→ * 0-3 = \"Severe\", 3-5 = \"Moderate\", 5-7 = \"Minor\"\n  1986→ */\n  1987→function getWeaknessSeverity(avgScore: number): WeaknessSeverity {\n  1988→  if (avgScore <= 3) return 'severe';\n  1989→  if (avgScore <= 5) return 'moderate';\n  1990→  return 'minor';\n  1991→}\n  1992→\n  1993→/**\n  1994→ * Get strength grade based on average score\n  1995→ * 8-9 = \"Good\", 9-9.5 = \"Excellent\", 9.5-10 = \"Ideal\"\n  1996→ */\n  1997→function getStrengthGrade(avgScore: number): StrengthGrade {\n  1998→  if (avgScore >= 9.5) return 'ideal';\n  1999→  if (avgScore >= 9) return 'excellent';\n  2000→  return 'good';\n  2001→}\n  2002→\n  2003→/**\n  2004→ * Find metric by display name from measurements array\n  2005→ */\n  2006→function findMetricByName(\n  2007→  metricName: string,\n  2008→  measurements: FaceIQScoreResult[]\n  2009→): FaceIQScoreResult | undefined {\n  2010→  // First try direct ID mapping\n  2011→  const metricId = METRIC_NAME_TO_ID[metricName];\n  2012→  if (metricId) {\n  2013→    return measurements.find(m => m.metricId === metricId);\n  2014→  }\n  2015→\n  2016→  // Fallback: try fuzzy matching on name\n  2017→  const normalizedName = metricName.toLowerCase().replace(/[^a-z0-9]/g, '');\n  2018→  return measurements.find(m => {\n  2019→    const normalizedMetricName = m.name.toLowerCase().replace(/[^a-z0-9]/g, '');\n  2020→    return normalizedMetricName.includes(normalizedName) ||\n  2021→           normalizedName.includes(normalizedMetricName);\n  2022→  });\n  2023→}\n  2024→\n  2025→/**\n  2026→ * Check if a metric should be considered a \"false positive\" weakness.\n  2027→ * This handles directional/dimorphic metrics where low scores don't mean weakness.\n  2028→ *\n  2029→ * Example: Canthal Tilt of 3° gets a low score (not in 6-8° ideal range)\n  2030→ * but is still a POSITIVE trait, not a weakness.\n  2031→ */\n  2032→function isFalsePositiveWeakness(metric: MatchedMetric): boolean {\n  2033→  const config = FACEIQ_METRICS[metric.metricId];\n  2034→  if (!config) return false;\n  2035→\n  2036→  // Check if the value is actually acceptable based on polarity\n  2037→  const { acceptable } = isValueAcceptable(metric.value, config);\n  2038→  return acceptable;\n  2039→}\n  2040→\n  2041→/**\n  2042→ * Process all insight definitions against user's measurements\n  2043→ */\n  2044→export function classifyInsights(\n  2045→  measurements: FaceIQScoreResult[],\n  2046→  insightDefinitions: InsightDefinition[] = INSIGHTS_DEFINITIONS\n  2047→): InsightClassificationResult {\n  2048→  const strengths: ClassifiedStrength[] = [];\n  2049→  const weaknesses: ClassifiedWeakness[] = [];\n  2050→\n  2051→  for (const insight of insightDefinitions) {\n  2052→    const { metrics, threshold } = insight.severity_logic;\n  2053→\n  2054→    // Find matching measurements for this insight\n  2055→    const matchedMetrics: MatchedMetric[] = [];\n  2056→    for (const metricName of metrics) {\n  2057→      const measurement = findMetricByName(metricName, measurements);\n  2058→      if (measurement) {\n  2059→        matchedMetrics.push({\n  2060→          metricId: measurement.metricId,\n  2061→          metricName: measurement.name,\n  2062→          score: measurement.score,\n  2063→          value: measurement.value,\n  2064→          idealMin: measurement.idealMin,\n  2065→          idealMax: measurement.idealMax,\n  2066→          unit: measurement.unit,\n  2067→          category: measurement.category,\n  2068→        });\n  2069→      }\n  2070→    }\n  2071→\n  2072→    // Skip if no metrics matched (need at least 1)\n  2073→    if (matchedMetrics.length === 0) continue;\n  2074→\n  2075→    // Calculate average score\n  2076→    const avgScore = matchedMetrics.reduce((sum, m) => sum + m.score, 0) / matchedMetrics.length;\n  2077→\n  2078→    // Classify based on type and threshold\n  2079→    if (insight.type === 'weakness') {\n  2080→      // Weakness: avg < threshold → add to areas of improvement\n  2081→      if (avgScore < threshold) {\n  2082→        // ========== FALSE POSITIVE CHECK ==========\n  2083→        // Before adding to weaknesses, check if ANY of the matched metrics\n  2084→        // are actually in an \"acceptable\" zone based on their polarity.\n  2085→        // If so, this is a false positive and should be skipped or reclassified.\n  2086→        const falsePositiveMetrics = matchedMetrics.filter(isFalsePositiveWeakness);\n  2087→\n  2088→        // If ALL matched metrics are false positives, skip this weakness entirely\n  2089→        if (falsePositiveMetrics.length === matchedMetrics.length) {\n  2090→          // This is a false positive weakness - the values are actually acceptable\n  2091→          // Consider adding to strengths if scores are decent\n  2092→          if (avgScore >= 6) {\n  2093→            strengths.push({\n  2094→              insightId: `${insight.id}_acceptable`,\n  2095→              title: insight.title.replace('Negative', 'Neutral').replace('Weak', 'Moderate'),\n  2096→              description: `While not in the peak ideal range, the measured values are within acceptable limits.`,\n  2097→              grade: 'good',\n  2098→              gradeLabel: 'Acceptable',\n  2099→              avgScore,\n  2100→              matchedMetrics,\n  2101→            });\n  2102→          }\n  2103→          continue; // Skip adding as weakness\n  2104→        }\n  2105→\n  2106→        // If SOME metrics are false positives, filter them out\n  2107→        const trueWeaknessMetrics = matchedMetrics.filter(m => !isFalsePositiveWeakness(m));\n  2108→        if (trueWeaknessMetrics.length === 0) continue;\n  2109→\n  2110→        // Recalculate average with only true weakness metrics\n  2111→        const trueAvgScore = trueWeaknessMetrics.reduce((sum, m) => sum + m.score, 0) / trueWeaknessMetrics.length;\n  2112→\n  2113→        // Only add as weakness if true average is still below threshold\n  2114→        if (trueAvgScore < threshold) {\n  2115→          const severity = getWeaknessSeverity(trueAvgScore);\n  2116→          const labels = insight.content.severity_labels;\n  2117→          const severityLabel = labels?.[severity] || severity;\n  2118→\n  2119→          weaknesses.push({\n  2120→            insightId: insight.id,\n  2121→            title: insight.title,\n  2122→            description: insight.content.description,\n  2123→            severity,\n  2124→            severityLabel,\n  2125→            avgScore: trueAvgScore,\n  2126→            matchedMetrics: trueWeaknessMetrics,\n  2127→          });\n  2128→        }\n  2129→      }\n  2130→    } else {\n  2131→      // Strength: avg > threshold → add to key strengths\n  2132→      if (avgScore > threshold) {\n  2133→        const grade = getStrengthGrade(avgScore);\n  2134→        const labels = insight.content.grade_labels;\n  2135→        const gradeLabel = labels?.[grade] || grade;\n  2136→\n  2137→        strengths.push({\n  2138→          insightId: insight.id,\n  2139→          title: insight.title,\n  2140→          description: insight.content.description,\n  2141→          grade,\n  2142→          gradeLabel,\n  2143→          avgScore,\n  2144→          matchedMetrics,\n  2145→        });\n  2146→      }\n  2147→    }\n  2148→  }\n  2149→\n  2150→  // Sort by score (weaknesses by lowest score first, strengths by highest first)\n  2151→  weaknesses.sort((a, b) => a.avgScore - b.avgScore);\n  2152→  strengths.sort((a, b) => b.avgScore - a.avgScore);\n  2153→\n  2154→  return { strengths, weaknesses };\n  2155→}\n  2156→\n  2157→/**\n  2158→ * Convert ClassifiedStrength to Strength type for UI compatibility\n  2159→ */\n  2160→export function convertToStrength(classified: ClassifiedStrength): Strength {\n  2161→  return {\n  2162→    id: `insight_strength_${classified.insightId}`,\n  2163→    strengthName: `${classified.title} (${classified.gradeLabel})`,\n  2164→    summary: classified.description,\n  2165→    avgScore: classified.avgScore,\n  2166→    qualityLevel: classified.grade === 'ideal' ? 'ideal' :\n  2167→                  classified.grade === 'excellent' ? 'excellent' : 'good',\n  2168→    categoryName: classified.matchedMetrics[0]?.category || 'General',\n  2169→    responsibleRatios: classified.matchedMetrics.map(m => ({\n  2170→      ratioName: m.metricName,\n  2171→      ratioId: m.metricId,\n  2172→      score: m.score,\n  2173→      value: m.value,\n  2174→      idealMin: m.idealMin,\n  2175→      idealMax: m.idealMax,\n  2176→      unit: m.unit,\n  2177→      category: m.category,\n  2178→    })),\n  2179→  };\n  2180→}\n  2181→\n  2182→/**\n  2183→ * Convert ClassifiedWeakness to Flaw type for UI compatibility\n  2184→ */\n  2185→export function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  2186→  const impact = (10 - classified.avgScore) * 0.5 * classified.matchedMetrics.length;\n  2187→  const newRollingLost = rollingLost + impact;\n  2188→\n  2189→  return {\n  2190→    id: `insight_flaw_${classified.insightId}`,\n  2191→    flawName: `${classified.title} (${classified.severityLabel})`,\n  2192→    summary: classified.description,\n  2193→    harmonyPercentageLost: impact,\n  2194→    standardizedImpact: impact / 10,\n  2195→    categoryName: classified.matchedMetrics[0]?.category || 'General',\n  2196→    responsibleRatios: classified.matchedMetrics.map(m => ({\n  2197→      ratioName: m.metricName,\n  2198→      ratioId: m.metricId,\n  2199→      score: m.score,\n  2200→      value: m.value,\n  2201→      idealMin: m.idealMin,\n  2202→      idealMax: m.idealMax,\n  2203→      unit: m.unit,\n  2204→      category: m.category,\n  2205→    })),\n  2206→    rollingPointsDeducted: newRollingLost,\n  2207→    rollingHarmonyPercentageLost: newRollingLost,\n  2208→    rollingStandardizedImpact: newRollingLost / 10,\n  2209→  };\n  2210→}\n  2211→\n  2212→/**\n  2213→ * Main function: Generate strengths and flaws from measurements using insights\n  2214→ */\n  2215→export function generateInsightBasedResults(\n  2216→  measurements: FaceIQScoreResult[]\n  2217→): { strengths: Strength[]; flaws: Flaw[] } {\n  2218→  const { strengths: classifiedStrengths, weaknesses: classifiedWeaknesses } = classifyInsights(measurements);\n  2219→\n  2220→  // Convert to UI-compatible types\n  2221→  const strengths = classifiedStrengths.map((s) => convertToStrength(s));\n  2222→\n  2223→  let rollingLost = 0;\n  2224→  const flaws = classifiedWeaknesses.map((w, i) => {\n  2225→    const flaw = convertToFlaw(w, i, rollingLost);\n  2226→    rollingLost = flaw.rollingPointsDeducted || 0;\n  2227→    return flaw;\n  2228→  });\n  2229→\n  2230→  return { strengths, flaws };\n  2231→}\n  2232→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"8a69b0a6-e041-4305-a20c-cb2520ddfc31","timestamp":"2025-12-21T18:33:06.798Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/insights-engine.ts","content":"/**\n * Insights Engine\n *\n * Processes insight definitions from insights.json and classifies them\n * as strengths or areas of improvement based on user's metric scores.\n *\n * Logic:\n * - For each insight definition, calculate average score of affected metrics\n * - Weakness: if avg score < threshold → classify with severity label\n * - Strength: if avg score > threshold → classify with grade label\n *\n * Z-Score Based Severity Logic (NEW):\n * - Ideal (Green): User is inside the ideal range\n * - Good (Blue): Within 1 Standard Deviation of the mean (|z| < 1)\n * - Moderate (Yellow): Between 1 and 2 Standard Deviations (1 ≤ |z| < 2)\n * - Severe (Red): More than 2 Standard Deviations away (|z| ≥ 2)\n *\n * Severity Labels (Weaknesses):\n *   0-3 = \"Severe\"\n *   3-5 = \"Moderate\"\n *   5-7 = \"Minor\"\n *\n * Grade Labels (Strengths):\n *   8-9   = \"Good\"\n *   9-9.5 = \"Excellent\"\n *   9.5-10 = \"Ideal\"\n */\n\nimport { Strength, Flaw } from '@/types/results';\nimport { FaceIQScoreResult, FACEIQ_METRICS, isValueAcceptable } from '@/lib/faceiq-scoring';\n\n// ============================================\n// MASTER SCORING DATABASE (Z-Score Based)\n// ============================================\n\nexport type SeverityLevel = 'ideal' | 'good' | 'moderate' | 'severe';\nexport type Gender = 'male' | 'female';\nexport type Ethnicity = 'white' | 'black' | 'east_asian' | 'south_asian' | 'hispanic' | 'middle_eastern';\n\nexport interface MasterMetricConfig {\n  ideal: [number, number];  // [min, max] ideal range\n  mean: number;             // Population mean\n  std_dev: number;          // Standard deviation\n  flaws?: {\n    low?: string[];         // Flaws when value is too low\n    high?: string[];        // Flaws when value is too high\n  };\n}\n\n// Base/Default standards (White Male baseline)\nexport const MASTER_SCORING_DB: Record<string, MasterMetricConfig> = {\n  // MIDFACE & PROPORTIONS\n  \"midface_ratio\": {\n    ideal: [0.97, 1.00],\n    mean: 1.0,\n    std_dev: 0.115,\n    flaws: { low: [\"Long midface\", \"Long upper jaw\"] }\n  },\n  \"faceWidthToHeight\": {\n    ideal: [1.30, 1.45],\n    mean: 1.38,\n    std_dev: 0.08,\n    flaws: {\n      low: [\"Overly long face\", \"Narrow face\"],\n      high: [\"Wide face\", \"Short face\"]\n    }\n  },\n  \"totalFacialWidthToHeight\": {\n    ideal: [1.25, 1.40],\n    mean: 1.33,\n    std_dev: 0.075,\n    flaws: {\n      low: [\"Long face shape\"],\n      high: [\"Wide face shape\"]\n    }\n  },\n  \"upperThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short forehead\"],\n      high: [\"Long forehead\"]\n    }\n  },\n  \"middleThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short midface\"],\n      high: [\"Long midface\"]\n    }\n  },\n  \"lowerThirdProportion\": {\n    ideal: [0.30, 0.36],\n    mean: 0.33,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Short lower face\"],\n      high: [\"Long lower face\"]\n    }\n  },\n\n  // EYE SPACING & IPD\n  \"eye_separation_ratio\": {\n    ideal: [0.45, 0.47],\n    mean: 0.46,\n    std_dev: 0.03,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"interpupillaryRatio\": {\n    ideal: [0.44, 0.48],\n    mean: 0.46,\n    std_dev: 0.025,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"oneEyeApartTest\": {\n    ideal: [0.95, 1.05],\n    mean: 1.0,\n    std_dev: 0.08,\n    flaws: {\n      low: [\"Close-set eyes\"],\n      high: [\"Wide-set eyes\"]\n    }\n  },\n  \"intercanthalWidth\": {\n    ideal: [30, 35],\n    mean: 32.5,\n    std_dev: 2.5,\n    flaws: {\n      low: [\"Narrow eye spacing\"],\n      high: [\"Wide eye spacing\"]\n    }\n  },\n\n  // EYE SHAPE & FEATURES\n  \"lateralCanthalTilt\": {\n    ideal: [6, 8],\n    mean: 5.0,\n    std_dev: 3.5,\n    flaws: {\n      low: [\"Negative canthal tilt\", \"Downturned eyes\"],\n      high: [\"Excessively upturned eyes\"]\n    }\n  },\n  \"eyeAspectRatio\": {\n    ideal: [0.30, 0.35],\n    mean: 0.32,\n    std_dev: 0.04,\n    flaws: {\n      low: [\"Narrow eyes\"],\n      high: [\"Round eyes\"]\n    }\n  },\n  \"palpebralFissureLength\": {\n    ideal: [28, 32],\n    mean: 30.0,\n    std_dev: 2.5,\n    flaws: {\n      low: [\"Small eyes\"],\n      high: [\"Large eyes\"]\n    }\n  },\n  \"eyeWidth\": {\n    ideal: [28, 32],\n    mean: 30.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Narrow eyes\"],\n      high: [\"Wide eyes\"]\n    }\n  },\n  \"upperEyelidExposure\": {\n    ideal: [0.5, 1.2],\n    mean: 0.85,\n    std_dev: 0.35,\n    flaws: {\n      low: [\"Hooded eyes\"],\n      high: [\"Excessive upper lid exposure\"]\n    }\n  },\n  \"tearTroughDepth\": {\n    ideal: [0.0, 0.3],\n    mean: 0.15,\n    std_dev: 0.15,\n    flaws: {\n      high: [\"Dark circles / Tear troughs\", \"Under-eye hollowness\"]\n    }\n  },\n\n  // JAW ANGLES & STRUCTURE\n  \"gonial_angle\": {\n    ideal: [115, 125],\n    mean: 118.0,\n    std_dev: 6.5,\n    flaws: {\n      high: [\"Weak/soft jaw structure\", \"Rounded jaw\"]\n    }\n  },\n  \"mandibularPlaneAngle\": {\n    ideal: [20, 28],\n    mean: 24.0,\n    std_dev: 4.0,\n    flaws: {\n      low: [\"Flat mandibular plane\"],\n      high: [\"Steep mandibular plane\", \"Hyper-divergent jaw\"]\n    }\n  },\n  \"jawFrontalAngle\": {\n    ideal: [125, 135],\n    mean: 130.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Steep jaw\"],\n      high: [\"Flat jaw angle\"]\n    }\n  },\n  \"jawSlope\": {\n    ideal: [25, 35],\n    mean: 30.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat jawline\"],\n      high: [\"Steep jawline\"]\n    }\n  },\n\n  // JAW WIDTH\n  \"jawWidthRatio\": {\n    ideal: [0.85, 0.95],\n    mean: 0.90,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Narrow jaw\"],\n      high: [\"Wide jaw\"]\n    }\n  },\n  \"bigonialWidth\": {\n    ideal: [110, 125],\n    mean: 117.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow jaw width\"],\n      high: [\"Excessively wide jaw\"]\n    }\n  },\n\n  // CHEEKBONES\n  \"cheekbone_height\": {\n    ideal: [83.0, 100.0],\n    mean: 85.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Low-set cheekbones\", \"Flat midface\"]\n    }\n  },\n  \"cheekboneWidth\": {\n    ideal: [130, 145],\n    mean: 137.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow cheekbones\"],\n      high: [\"Wide cheekbones\"]\n    }\n  },\n\n  // CHIN\n  \"chinPhiltrumRatio\": {\n    ideal: [1.8, 2.2],\n    mean: 2.0,\n    std_dev: 0.2,\n    flaws: {\n      low: [\"Recessed chin\", \"Short chin\"],\n      high: [\"Long chin\", \"Projected chin\"]\n    }\n  },\n  \"chinHeight\": {\n    ideal: [35, 45],\n    mean: 40.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Short chin\"],\n      high: [\"Long chin\"]\n    }\n  },\n  \"chinWidth\": {\n    ideal: [35, 45],\n    mean: 40.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Pointed/Narrow chin\"],\n      high: [\"Wide chin\"]\n    }\n  },\n\n  // NOSE ANGLES\n  \"nasalTipAngle\": {\n    ideal: [95, 115],\n    mean: 105.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Droopy nasal tip\"],\n      high: [\"Upturned nasal tip\"]\n    }\n  },\n  \"nasolabialAngle\": {\n    ideal: [95, 110],\n    mean: 102.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Droopy nasal tip\"],\n      high: [\"Upturned nose\"]\n    }\n  },\n  \"nasofrontalAngle\": {\n    ideal: [115, 135],\n    mean: 125.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Deep nasal root\"],\n      high: [\"Flat nasal root\"]\n    }\n  },\n  \"nasofacialAngle\": {\n    ideal: [30, 40],\n    mean: 35.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat nose profile\"],\n      high: [\"Overprojected nose\"]\n    }\n  },\n  \"nasomentaAngle\": {\n    ideal: [120, 135],\n    mean: 127.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Convex profile\"],\n      high: [\"Concave profile\"]\n    }\n  },\n\n  // NOSE WIDTH & PROPORTIONS\n  \"nasalIndex\": {\n    ideal: [65, 75],\n    mean: 70.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Narrow nose\"],\n      high: [\"Wide nose\", \"Bulbous nose\"]\n    }\n  },\n  \"noseWidth\": {\n    ideal: [35, 42],\n    mean: 38.5,\n    std_dev: 3.5,\n    flaws: {\n      low: [\"Narrow nose\"],\n      high: [\"Wide nasal base\"]\n    }\n  },\n  \"noseBridgeWidth\": {\n    ideal: [12, 18],\n    mean: 15.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Narrow nose bridge\"],\n      high: [\"Wide nose bridge\"]\n    }\n  },\n  \"nasalProjection\": {\n    ideal: [16, 22],\n    mean: 19.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Underprojected nose\"],\n      high: [\"Overprojected nose\"]\n    }\n  },\n  \"noseLengthRatio\": {\n    ideal: [0.45, 0.55],\n    mean: 0.50,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Short nose\"],\n      high: [\"Long nose\"]\n    }\n  },\n\n  // LIPS & PHILTRUM\n  \"lipRatio\": {\n    ideal: [1.4, 1.6],\n    mean: 1.5,\n    std_dev: 0.15,\n    flaws: {\n      low: [\"Thin upper lip\"],\n      high: [\"Thick upper lip\"]\n    }\n  },\n  \"philtrumLength\": {\n    ideal: [11, 15],\n    mean: 13.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Short philtrum\"],\n      high: [\"Long philtrum\"]\n    }\n  },\n  \"upperLipHeight\": {\n    ideal: [18, 24],\n    mean: 21.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Thin upper lip\"],\n      high: [\"Thick upper lip\"]\n    }\n  },\n  \"lipChinDistance\": {\n    ideal: [40, 50],\n    mean: 45.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Short lower third\"],\n      high: [\"Long lower third\"]\n    }\n  },\n  \"upperLipProjection\": {\n    ideal: [-2, 2],\n    mean: 0.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Recessed upper lip\"],\n      high: [\"Protruding upper lip\"]\n    }\n  },\n  \"lowerLipProjection\": {\n    ideal: [-1, 3],\n    mean: 1.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Recessed lower lip\"],\n      high: [\"Protruding lower lip\"]\n    }\n  },\n  \"cupidsBowDepth\": {\n    ideal: [3, 6],\n    mean: 4.5,\n    std_dev: 1.5,\n    flaws: {\n      low: [\"Flat cupid's bow\"],\n      high: [\"Pronounced cupid's bow\"]\n    }\n  },\n\n  // EYEBROWS\n  \"eyebrowHeight\": {\n    ideal: [8, 14],\n    mean: 11.0,\n    std_dev: 3.0,\n    flaws: {\n      low: [\"Low-set eyebrows\"],\n      high: [\"High eyebrows\"]\n    }\n  },\n  \"browLengthRatio\": {\n    ideal: [0.50, 0.60],\n    mean: 0.55,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Short eyebrows\"],\n      high: [\"Long eyebrows\"]\n    }\n  },\n  \"browLengthToFaceWidth\": {\n    ideal: [0.30, 0.38],\n    mean: 0.34,\n    std_dev: 0.04,\n    flaws: {\n      low: [\"Short eyebrows\"],\n      high: [\"Long eyebrows\"]\n    }\n  },\n  \"browridgeInclinationAngle\": {\n    ideal: [10, 20],\n    mean: 15.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Flat brow ridge\"],\n      high: [\"Prominent brow ridge\"]\n    }\n  },\n  \"eyebrowThickness\": {\n    ideal: [1.5, 3.0],\n    mean: 2.25,\n    std_dev: 0.75,\n    flaws: {\n      low: [\"Sparse/Weak eyebrows\"],\n      high: [\"Overly thick eyebrows\"]\n    }\n  },\n\n  // FOREHEAD\n  \"foreheadHeight\": {\n    ideal: [55, 70],\n    mean: 62.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Short forehead\"],\n      high: [\"Tall forehead\"]\n    }\n  },\n  \"bitemporalWidth\": {\n    ideal: [120, 135],\n    mean: 127.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Narrow forehead\"],\n      high: [\"Wide forehead\"]\n    }\n  },\n\n  // PROFILE & DEPTH\n  \"facialDepthToHeight\": {\n    ideal: [0.75, 0.85],\n    mean: 0.80,\n    std_dev: 0.05,\n    flaws: {\n      low: [\"Flat facial profile\"],\n      high: [\"Overprojected profile\"]\n    }\n  },\n  \"anteriorFacialDepth\": {\n    ideal: [115, 130],\n    mean: 122.5,\n    std_dev: 7.5,\n    flaws: {\n      low: [\"Shallow face depth\"],\n      high: [\"Deep face projection\"]\n    }\n  },\n  \"totalProfileAngle\": {\n    ideal: [165, 175],\n    mean: 170.0,\n    std_dev: 5.0,\n    flaws: {\n      low: [\"Convex profile\"],\n      high: [\"Concave profile\"]\n    }\n  },\n\n  // ASYMMETRY\n  \"facialAsymmetryIndex\": {\n    ideal: [0, 3],\n    mean: 2.0,\n    std_dev: 1.5,\n    flaws: {\n      high: [\"Facial asymmetry\"]\n    }\n  },\n  \"eyeAsymmetry\": {\n    ideal: [0, 2],\n    mean: 1.0,\n    std_dev: 1.0,\n    flaws: {\n      high: [\"Eye asymmetry\"]\n    }\n  },\n  \"jawAsymmetry\": {\n    ideal: [0, 3],\n    mean: 1.5,\n    std_dev: 1.5,\n    flaws: {\n      high: [\"Jaw asymmetry\"]\n    }\n  },\n\n  // OTHER\n  \"recessionFrankfort\": {\n    ideal: [-2, 2],\n    mean: 0.0,\n    std_dev: 2.0,\n    flaws: {\n      low: [\"Maxillary recession\"],\n      high: [\"Maxillary protrusion\"]\n    }\n  },\n  \"neckWidth\": {\n    ideal: [110, 130],\n    mean: 120.0,\n    std_dev: 10.0,\n    flaws: {\n      low: [\"Narrow neck\"],\n      high: [\"Wide neck\"]\n    }\n  },\n  \"neckToJawRatio\": {\n    ideal: [0.90, 1.10],\n    mean: 1.0,\n    std_dev: 0.10,\n    flaws: {\n      low: [\"Narrow neck\"],\n      high: [\"Thick neck\"]\n    }\n  }\n};\n\n// ============================================\n// ETHNICITY-SPECIFIC OVERRIDES\n// ============================================\n\n/**\n * Ethnicity and gender-specific metric standards\n * These override the base MASTER_SCORING_DB values for specific populations\n */\nexport const ETHNICITY_OVERRIDES: Record<string, Record<string, Partial<MasterMetricConfig>>> = {\n  // ========================================\n  // MALE WHITE STANDARDS (Neoclassical Baseline)\n  // ========================================\n  \"male_white\": {\n    // NOSE WIDTH - Strict 1:1 ratio (Eye Width = Nose Width)\n    \"noseWidth\": {\n      ideal: [35, 42],  // Corresponds to alar_base_ratio [0.98, 1.05]\n      mean: 38.5,\n      std_dev: 3.5,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // MIDFACE - Prefers compact midface (Hunter look)\n    \"midface_ratio\": {\n      ideal: [0.95, 1.02],\n      mean: 0.985,\n      std_dev: 0.035,\n      flaws: {\n        low: [\"Long midface\"]\n      }\n    },\n\n    // JAW - Square/Robust jaw preference\n    \"gonial_angle\": {\n      ideal: [115.0, 125.0],\n      mean: 120.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Weak/Soft jaw structure\"]\n      }\n    },\n\n    // FACE WIDTH - Standard Mesoprosopic range\n    \"faceWidthToHeight\": {\n      ideal: [1.90, 2.05],\n      mean: 1.975,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Narrow face\"],\n        high: [\"Short/Wide face\"]\n      }\n    },\n\n    // EYE TILT - Neutral to slightly positive\n    \"lateralCanthalTilt\": {\n      ideal: [4.0, 8.0],\n      mean: 6.0,\n      std_dev: 2.0,\n      flaws: {\n        low: [\"Negative canthal tilt\"]\n      }\n    },\n\n    // LOWER FACE BALANCE\n    \"chinPhiltrumRatio\": {\n      ideal: [2.10, 2.30],\n      mean: 2.20,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Long philtrum / Short chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE BLACK / AFRICAN STANDARDS\n  // ========================================\n  \"male_black\": {\n    // NOSE WIDTH - Significantly wider tolerance\n    \"noseWidth\": {\n      ideal: [40, 50],  // Wider range (corresponds to alar_base_ratio [1.12, 1.25])\n      mean: 45.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n    \"nasalIndex\": {\n      ideal: [80, 95],  // Wider nasal index\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        high: [\"Wide nose\"]\n      }\n    },\n\n    // LIPS - Prefers fuller lips\n    \"lipRatio\": {\n      ideal: [1.2, 1.5],\n      mean: 1.35,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Thin lips\"]\n      }\n    },\n\n    // PHILTRUM - Shorter visible philtrum is ideal\n    \"philtrumLength\": {\n      ideal: [11.0, 14.0],\n      mean: 12.5,\n      std_dev: 1.5,\n      flaws: {\n        high: [\"Long philtrum\"]\n      }\n    },\n\n    // CHIN - Adjusts for natural forward mouth projection (Prognathism)\n    \"chinPhiltrumRatio\": {\n      ideal: [1.80, 2.10],  // Lower range to account for prognathism\n      mean: 1.95,\n      std_dev: 0.15,\n      flaws: {\n        low: [\"Recessed chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE EAST ASIAN STANDARDS\n  // ========================================\n  \"male_east_asian\": {\n    // EYE SPACING - Shifted WIDER for East Asian males\n    \"eye_separation_ratio\": {\n      ideal: [0.48, 0.53],  // Shifted wider (0.46 is \"close-set\" here)\n      mean: 0.505,\n      std_dev: 0.025,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Wide-set eyes\"]\n      }\n    },\n    \"interpupillaryRatio\": {\n      ideal: [0.48, 0.53],\n      mean: 0.505,\n      std_dev: 0.025,\n      flaws: {\n        low: [\"Close-set eyes\"],\n        high: [\"Wide-set eyes\"]\n      }\n    },\n\n    // EYE SHAPE - Prefers narrower/longer eyes (Hunter Eyes)\n    \"eyeAspectRatio\": {\n      ideal: [0.25, 0.29],  // Lower ratio = more elongated\n      mean: 0.27,\n      std_dev: 0.02,\n      flaws: {\n        low: [\"Overly narrow eyes\"],\n        high: [\"Overly round eye shape\"]\n      }\n    },\n    \"palpebralFissureLength\": {\n      ideal: [29, 33],\n      mean: 31.0,\n      std_dev: 2.0,\n      flaws: {\n        low: [\"Small eyes\"],\n        high: [\"Large eyes\"]\n      }\n    },\n\n    // NOSE - Asian noses typically allowed to be wider\n    \"nasalIndex\": {\n      ideal: [75, 85],\n      mean: 80.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nose\"]\n      }\n    },\n    \"noseWidth\": {\n      ideal: [38, 45],\n      mean: 41.5,\n      std_dev: 3.5,\n      flaws: {\n        low: [\"Narrow nose\"],\n        high: [\"Very wide nasal base\"]\n      }\n    },\n    \"noseBridgeWidth\": {\n      ideal: [14, 20],\n      mean: 17.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Narrow nose bridge\"],\n        high: [\"Wide nose bridge\"]\n      }\n    },\n\n    // CHEEKS - Rewards slightly fuller cheeks (Youth/K-Pop aesthetic)\n    \"cheekbone_height\": {\n      ideal: [80.0, 95.0],\n      mean: 87.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Gaunt/Hollow face\"]\n      }\n    },\n\n    // JAW - Slightly softer angles acceptable\n    \"gonial_angle\": {\n      ideal: [118, 128],\n      mean: 123.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Weak/soft jaw structure\"]\n      }\n    },\n    \"mandibularPlaneAngle\": {\n      ideal: [20, 30],\n      mean: 25.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Flat mandibular plane\"],\n        high: [\"Steep mandibular plane\"]\n      }\n    },\n\n    // FACIAL PROPORTIONS - Wider faces more common\n    \"faceWidthToHeight\": {\n      ideal: [1.35, 1.50],\n      mean: 1.425,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long face\"],\n        high: [\"Very wide face\"]\n      }\n    },\n    \"totalFacialWidthToHeight\": {\n      ideal: [1.30, 1.45],\n      mean: 1.375,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long face shape\"],\n        high: [\"Wide face shape\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE SOUTH ASIAN STANDARDS\n  // ========================================\n  \"male_south_asian\": {\n    // NOSE WIDTH - Slightly wider tolerance than White\n    \"noseWidth\": {\n      ideal: [36, 43],  // alar_base_ratio [1.00, 1.08]\n      mean: 39.5,\n      std_dev: 3.5,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // TEAR TROUGH - VERY STRICT. High penalty for dark circles\n    \"tearTroughDepth\": {\n      ideal: [0.0, 0.5],\n      mean: 0.25,\n      std_dev: 0.25,\n      flaws: {\n        high: [\"Dark circles / Tear troughs\"]\n      }\n    },\n\n    // UPPER EYELID - Often prefers visible lid platform\n    \"upperEyelidExposure\": {\n      ideal: [0.5, 2.0],\n      mean: 1.25,\n      std_dev: 0.75,\n      flaws: {\n        low: [\"Hooded eyes\"]\n      }\n    },\n\n    // CHEEKS - Penalizes \"Gaunt\" looks heavily\n    \"cheekbone_height\": {\n      ideal: [83.0, 95.0],\n      mean: 89.0,\n      std_dev: 6.0,\n      flaws: {\n        low: [\"Volume loss / Gauntness\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE HISPANIC STANDARDS (\"The Bridge Model\")\n  // ========================================\n  \"male_hispanic\": {\n    // FACE WIDTH - Rewards broader, more robust face shapes (Mestizo)\n    \"faceWidthToHeight\": {\n      ideal: [1.95, 2.10],\n      mean: 2.025,\n      std_dev: 0.075,\n      flaws: {\n        low: [\"Long/Narrow face\"]\n      }\n    },\n\n    // NOSE WIDTH - Bridge tolerance (Wider than White, narrower than Black)\n    \"noseWidth\": {\n      ideal: [36, 44],  // alar_base_ratio [1.00, 1.12]\n      mean: 40.0,\n      std_dev: 4.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // EYE TILT - Strong preference for positive tilt\n    \"lateralCanthalTilt\": {\n      ideal: [6.0, 12.0],\n      mean: 9.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Negative/Neutral canthal tilt\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE MIDDLE EASTERN STANDARDS\n  // ========================================\n  \"male_middle_eastern\": {\n    // EYEBROW THICKNESS - Prefers significantly thicker/darker brows\n    \"eyebrowThickness\": {\n      ideal: [2.0, 4.0],\n      mean: 3.0,\n      std_dev: 1.0,\n      flaws: {\n        low: [\"Sparse/Weak eyebrows\"],\n        high: [\"Unibrow\"]\n      }\n    },\n\n    // NASOLABIAL ANGLE - Penalizes droopy tip (<90) or hooked noses\n    \"nasolabialAngle\": {\n      ideal: [90.0, 100.0],\n      mean: 95.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Droopy nose tip / Hooked nose\"]\n      }\n    },\n\n    // EYE TILT - Strong preference for Almond/Hunter eye shape\n    \"lateralCanthalTilt\": {\n      ideal: [4.0, 10.0],\n      mean: 7.0,\n      std_dev: 3.0,\n      flaws: {\n        low: [\"Downturned eyes\"]\n      }\n    },\n\n    // MIDFACE - Similar to White model (Compact is better)\n    \"midface_ratio\": {\n      ideal: [0.95, 1.02],\n      mean: 0.985,\n      std_dev: 0.035,\n      flaws: {\n        low: [\"Long midface\"]\n      }\n    }\n  },\n\n  // ========================================\n  // MALE PACIFIC ISLANDER STANDARDS (\"The Warrior Skull\")\n  // ========================================\n  \"male_pacific_islander\": {\n    // FACE WIDTH - The Highest Width Standard (Very broad)\n    \"faceWidthToHeight\": {\n      ideal: [2.10, 2.30],\n      mean: 2.20,\n      std_dev: 0.10,\n      flaws: {\n        low: [\"Narrow/Long face\"]\n      }\n    },\n\n    // NOSE WIDTH - Wide tolerance\n    \"noseWidth\": {\n      ideal: [38, 48],  // alar_base_ratio [1.05, 1.20]\n      mean: 43.0,\n      std_dev: 5.0,\n      flaws: {\n        high: [\"Wide nasal base\"]\n      }\n    },\n\n    // CHEEKS - Rewards high mass/robustness\n    \"cheekbone_height\": {\n      ideal: [85.0, 100.0],\n      mean: 92.5,\n      std_dev: 7.5,\n      flaws: {\n        low: [\"Gaunt/Weak face structure\"]\n      }\n    },\n\n    // CHIN WIDTH - Prefers a very broad, square chin\n    \"chinWidth\": {\n      ideal: [40.0, 50.0],\n      mean: 45.0,\n      std_dev: 5.0,\n      flaws: {\n        low: [\"Pointed/Narrow chin\"]\n      }\n    }\n  },\n\n  // ========================================\n  // FEMALE OVERRIDES (to be added)\n  // ========================================\n  \"female_white\": {\n    // TODO: Add female-specific standards\n    // Generally: softer jaw angles, fuller lips, higher eyebrows, etc.\n  },\n  \"female_east_asian\": {\n    // TODO: Add female East Asian standards\n  }\n};\n\n/**\n * Get the appropriate metric configuration for a given gender and ethnicity\n * Falls back to base config if no override exists\n */\nexport function getMetricConfig(\n  metricId: string,\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'white'\n): MasterMetricConfig | undefined {\n  const key = `${gender}_${ethnicity}`;\n  const override = ETHNICITY_OVERRIDES[key]?.[metricId];\n  const baseConfig = MASTER_SCORING_DB[metricId];\n\n  if (!baseConfig) return undefined;\n\n  // Merge override with base config\n  if (override) {\n    return {\n      ...baseConfig,\n      ...override,\n      flaws: {\n        ...baseConfig.flaws,\n        ...override.flaws\n      }\n    } as MasterMetricConfig;\n  }\n\n  return baseConfig;\n}\n\n// ============================================\n// Z-SCORE SEVERITY FUNCTIONS\n// ============================================\n\n/**\n * Calculate Z-score for a given value\n * Z = (value - mean) / std_dev\n */\nexport function calculateZScore(value: number, mean: number, stdDev: number): number {\n  if (stdDev === 0) return 0;\n  return Math.abs((value - mean) / stdDev);\n}\n\n/**\n * Determine severity level based on Z-score and ideal range\n * - Ideal: Value is within ideal range\n * - Good: |z| < 1 (within 1 standard deviation)\n * - Moderate: 1 ≤ |z| < 2 (between 1-2 standard deviations)\n * - Severe: |z| ≥ 2 (more than 2 standard deviations away)\n */\nexport function getSeverityFromZScore(\n  value: number,\n  config: MasterMetricConfig\n): { severity: SeverityLevel; zScore: number; isInIdeal: boolean } {\n  const { ideal, mean, std_dev } = config;\n  const isInIdeal = value >= ideal[0] && value <= ideal[1];\n  const zScore = calculateZScore(value, mean, std_dev);\n\n  let severity: SeverityLevel;\n  if (isInIdeal) {\n    severity = 'ideal';\n  } else if (zScore < 1) {\n    severity = 'good';\n  } else if (zScore < 2) {\n    severity = 'moderate';\n  } else {\n    severity = 'severe';\n  }\n\n  return { severity, zScore, isInIdeal };\n}\n\n/**\n * Get severity for a metric value with ethnicity/gender awareness\n */\nexport function getSeverityForMetric(\n  metricId: string,\n  value: number,\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'white'\n): { severity: SeverityLevel; zScore: number; isInIdeal: boolean; config: MasterMetricConfig } | null {\n  const config = getMetricConfig(metricId, gender, ethnicity);\n  if (!config) return null;\n\n  const result = getSeverityFromZScore(value, config);\n  return { ...result, config };\n}\n\n/**\n * Get badge color for severity level\n */\nexport function getSeverityColor(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'green';\n    case 'good': return 'blue';\n    case 'moderate': return 'yellow';\n    case 'severe': return 'red';\n    default: return 'gray';\n  }\n}\n\n/**\n * Get severity label for display\n */\nexport function getSeverityLabel(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'ideal': return 'Ideal';\n    case 'good': return 'Good';\n    case 'moderate': return 'Moderate';\n    case 'severe': return 'Severe';\n    default: return 'Unknown';\n  }\n}\n\n// ============================================\n// INSIGHT DEFINITION TYPES\n// ============================================\n\nexport interface InsightSeverityLogic {\n  metrics: string[];  // Display names of metrics (e.g., \"Face Width to Height Ratio\")\n  threshold: number;  // Score threshold for classification\n}\n\nexport interface WeaknessSeverityLabels {\n  minor: string;\n  moderate: string;\n  severe: string;\n}\n\nexport interface StrengthGradeLabels {\n  good: string;\n  excellent: string;\n  ideal: string;\n}\n\nexport interface InsightContent {\n  description: string;\n  severity_labels?: WeaknessSeverityLabels;  // For weaknesses\n  grade_labels?: StrengthGradeLabels;        // For strengths\n}\n\nexport interface InsightDefinition {\n  id: string;\n  title: string;\n  type: 'weakness' | 'strength';\n  severity_logic: InsightSeverityLogic;\n  content: InsightContent;\n}\n\n// ============================================\n// CLASSIFICATION RESULT TYPES\n// ============================================\n\nexport type WeaknessSeverity = 'severe' | 'moderate' | 'minor';\nexport type StrengthGrade = 'ideal' | 'excellent' | 'good';\n\nexport interface ClassifiedWeakness {\n  insightId: string;\n  title: string;\n  description: string;\n  severity: WeaknessSeverity;\n  severityLabel: string;  // Custom label from definition (e.g., \"Extremely Long\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n}\n\nexport interface ClassifiedStrength {\n  insightId: string;\n  title: string;\n  description: string;\n  grade: StrengthGrade;\n  gradeLabel: string;  // Custom label from definition (e.g., \"Ideal\")\n  avgScore: number;\n  matchedMetrics: MatchedMetric[];\n}\n\nexport interface MatchedMetric {\n  metricId: string;\n  metricName: string;\n  score: number;\n  value: number;\n  idealMin: number;\n  idealMax: number;\n  unit: string;\n  category: string;\n}\n\nexport interface InsightClassificationResult {\n  strengths: ClassifiedStrength[];\n  weaknesses: ClassifiedWeakness[];\n}\n\n// ============================================\n// INSIGHTS DATABASE\n// ============================================\n\nexport const INSIGHTS_DEFINITIONS: InsightDefinition[] = [\n  {\n    id: \"long_midface\",\n    title: \"Long Midface\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\", \"Ipsilateral Alar Angle\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The middle of the face is elongated, creating an unbalanced vertical proportion.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Extremely Long\" }\n    }\n  },\n  {\n    id: \"short_midface\",\n    title: \"Short Midface\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Face Width to Height Ratio\", \"Midface Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The midface has ideal vertical proportions, contributing to facial harmony.\",\n      grade_labels: { good: \"Proportionate\", excellent: \"Well-Balanced\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"weak_jaw\",\n    title: \"Weak/Soft Jaw Structure\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Chin to Philtrum Ratio\", \"Jaw Slope\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The jaw has a softer, rounder shape, often less angular and robust than the ideal.\",\n      severity_labels: { minor: \"Soft\", moderate: \"Recessed\", severe: \"Weak\" }\n    }\n  },\n  {\n    id: \"strong_jaw\",\n    title: \"Strong Jaw Definition\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Gonial Angle\", \"Mandibular Plane Angle\", \"Jaw Width Ratio\", \"Bigonial Width\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The jaw displays strong definition with well-defined angles and proportionate width.\",\n      grade_labels: { good: \"Defined\", excellent: \"Strong\", ideal: \"Ideal Angular\" }\n    }\n  },\n  {\n    id: \"refined_nasal_tip\",\n    title: \"Refined Nasal Tip\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasal Tip Angle\", \"Nose Tip Position\", \"Frankfort-tip Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious nasal profile due to the nasal tip being well-defined and proportionate.\",\n      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"bulbous_nose\",\n    title: \"Bulbous Nasal Tip\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Index\", \"Nose Width\", \"Nasal Tip Angle\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nasal tip appears rounded and less defined, affecting nasal aesthetics.\",\n      severity_labels: { minor: \"Slightly Rounded\", moderate: \"Rounded\", severe: \"Bulbous\" }\n    }\n  },\n  {\n    id: \"ideal_upper_lip\",\n    title: \"Well-Positioned Upper Lip\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Upper Lip E-Line Position\", \"Upper Lip S-Line Position\", \"Nasolabial Angle\"],\n      threshold: 9.0\n    },\n    content: {\n      description: \"This contributes to a harmonious mouth region due to the upper lip sitting neither too far forward nor too far back.\",\n      grade_labels: { good: \"Good\", excellent: \"Excellent\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"negative_canthal_tilt\",\n    title: \"Negative Canthal Tilt\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The outer corners of the eyes sit lower than the inner corners, creating a downturned appearance.\",\n      severity_labels: { minor: \"Slight Downturn\", moderate: \"Noticeable\", severe: \"Pronounced\" }\n    }\n  },\n  {\n    id: \"positive_canthal_tilt\",\n    title: \"Positive Canthal Tilt\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Lateral Canthal Tilt\", \"Eye Aspect Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The outer corners of the eyes are elevated, creating an attractive upswept eye shape.\",\n      grade_labels: { good: \"Slight Upturn\", excellent: \"Well-Tilted\", ideal: \"Hunter Eyes\" }\n    }\n  },\n  {\n    id: \"balanced_facial_thirds\",\n    title: \"Balanced Facial Thirds\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face displays well-balanced vertical proportions across all three facial thirds.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfectly Proportioned\" }\n    }\n  },\n  {\n    id: \"imbalanced_thirds\",\n    title: \"Facial Third Imbalance\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Upper Third Proportion\", \"Middle Third Proportion\", \"Lower Third Proportion\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The vertical face proportions show imbalance between the three facial thirds.\",\n      severity_labels: { minor: \"Slight Imbalance\", moderate: \"Noticeable Disproportion\", severe: \"Significant Imbalance\" }\n    }\n  },\n  {\n    id: \"high_cheekbones\",\n    title: \"High Cheekbones\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Cheekbone Height\", \"Cheekbone Width\", \"Midface Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"Well-positioned cheekbones that create attractive facial contours and catch light beautifully.\",\n      grade_labels: { good: \"Visible\", excellent: \"Prominent\", ideal: \"Model-Tier\" }\n    }\n  },\n  {\n    id: \"flat_midface\",\n    title: \"Flat Midface\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Cheekbone Height\", \"Midface Ratio\", \"Total Facial Width to Height\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The midface lacks forward projection, resulting in flatter facial contours.\",\n      severity_labels: { minor: \"Slightly Flat\", moderate: \"Underprojected\", severe: \"Recessed\" }\n    }\n  },\n  {\n    id: \"ideal_lip_ratio\",\n    title: \"Ideal Lip Proportions\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Lip Ratio\", \"Philtrum Length\", \"Lip Chin Distance\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The lips demonstrate excellent proportions with balanced upper-to-lower lip ratio.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Well-Proportioned\", ideal: \"Perfect Ratio\" }\n    }\n  },\n  {\n    id: \"thin_lips\",\n    title: \"Thin Lip Profile\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Lip Ratio\", \"Upper Lip Projection\", \"Lower Lip Projection\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The lips appear thinner than ideal proportions, affecting lower face harmony.\",\n      severity_labels: { minor: \"Slightly Thin\", moderate: \"Thin\", severe: \"Very Thin\" }\n    }\n  },\n  {\n    id: \"ideal_ipd\",\n    title: \"Ideal Eye Spacing\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The eyes are ideally spaced, creating facial balance and attractiveness.\",\n      grade_labels: { good: \"Good Spacing\", excellent: \"Ideal Distance\", ideal: \"Perfect IPD\" }\n    }\n  },\n  {\n    id: \"wide_set_eyes\",\n    title: \"Wide-Set Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"One Eye Apart Test\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes are spaced wider apart than the aesthetic ideal.\",\n      severity_labels: { minor: \"Slightly Wide\", moderate: \"Noticeably Wide\", severe: \"Very Wide\" }\n    }\n  },\n  {\n    id: \"close_set_eyes\",\n    title: \"Close-Set Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Interpupillary Ratio\", \"Eye Separation Ratio\", \"Intercanthal Width\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes are positioned closer together than the aesthetic ideal.\",\n      severity_labels: { minor: \"Slightly Close\", moderate: \"Noticeably Close\", severe: \"Very Close\" }\n    }\n  },\n  {\n    id: \"ideal_nose_projection\",\n    title: \"Ideal Nasal Projection\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasofrontal Angle\", \"Nasofacial Angle\", \"Nasomenta Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The nose has ideal forward projection relative to the face, creating profile harmony.\",\n      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect Projection\" }\n    }\n  },\n  {\n    id: \"recessed_chin\",\n    title: \"Recessed Chin\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Facial Depth to Height\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The chin sits behind the ideal position, affecting profile balance.\",\n      severity_labels: { minor: \"Slightly Recessed\", moderate: \"Recessed\", severe: \"Severely Recessed\" }\n    }\n  },\n  {\n    id: \"ideal_chin_projection\",\n    title: \"Ideal Chin Projection\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Chin to Philtrum Ratio\", \"Chin Height\", \"Anterior Facial Depth\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The chin demonstrates ideal projection and proportions relative to the face.\",\n      grade_labels: { good: \"Good\", excellent: \"Well-Projected\", ideal: \"Perfect\" }\n    }\n  },\n  {\n    id: \"long_philtrum\",\n    title: \"Long Philtrum\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Philtrum Length\", \"Lip Chin Distance\", \"Upper Lip Height\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The distance between nose and upper lip is longer than ideal.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n    }\n  },\n  {\n    id: \"short_philtrum\",\n    title: \"Short Philtrum\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Philtrum Length\", \"Upper Lip Height\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The philtrum has ideal or shorter length, considered youthful and attractive.\",\n      grade_labels: { good: \"Good Length\", excellent: \"Short\", ideal: \"Ideal\" }\n    }\n  },\n  {\n    id: \"wide_nose\",\n    title: \"Wide Nasal Base\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Index\", \"Intercanthal Nasal Ratio\", \"Nose Bridge Width\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The base of the nose is wider than the aesthetic ideal for facial harmony.\",\n      severity_labels: { minor: \"Slightly Wide\", moderate: \"Wide\", severe: \"Very Wide\" }\n    }\n  },\n  {\n    id: \"ideal_brow_position\",\n    title: \"Ideal Brow Position\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Eyebrow Height\", \"Brow Length Ratio\"],\n      threshold: 8.0\n    },\n    content: {\n      description: \"The eyebrows are ideally positioned relative to the eyes and facial structure.\",\n      grade_labels: { good: \"Good Position\", excellent: \"Well-Arched\", ideal: \"Perfect Frame\" }\n    }\n  },\n  {\n    id: \"narrow_jaw\",\n    title: \"Narrow Jaw\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Jaw Width Ratio\", \"Bigonial Width\", \"Jaw Frontal Angle\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The jaw is narrower than ideal, affecting lower face width and definition.\",\n      severity_labels: { minor: \"Slightly Narrow\", moderate: \"Narrow\", severe: \"Very Narrow\" }\n    }\n  },\n  {\n    id: \"steep_mandibular_plane\",\n    title: \"Steep Mandibular Plane\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n      threshold: 5.0\n    },\n    content: {\n      description: \"The mandibular plane angle is steeper than ideal, often indicating vertical growth pattern.\",\n      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n    }\n  },\n  // ============================================\n  // SCRAPED FROM FACEIQ (element.html / element1.html)\n  // ============================================\n  // --- WEAKNESSES ---\n  {\n    id: \"steep_jaw\",\n    title: \"Steep Jaw\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Jaw Frontal Angle\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The jaw angles sharply downward, creating a narrow or pointed chin effect.\",\n      severity_labels: { minor: \"Slightly Steep\", moderate: \"Steep\", severe: \"Very Steep\" }\n    }\n  },\n  {\n    id: \"maxillary_recession\",\n    title: \"Maxillary Recession\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Facial Depth to Height Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The upper jaw is less forward than ideal, reducing midface projection and facial harmony.\",\n      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n    }\n  },\n  {\n    id: \"mandibular_recession\",\n    title: \"Mandibular Recession\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The lower jaw is set back, creating a less prominent chin and an unbalanced profile.\",\n      severity_labels: { minor: \"Slight Recession\", moderate: \"Noticeable Recession\", severe: \"Severe Recession\" }\n    }\n  },\n  {\n    id: \"underprojected_chin\",\n    title: \"Underprojected Chin\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Recession Relative to Frankfort Plane\", \"Chin to Philtrum Ratio\", \"Chin Height\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The chin lacks forward projection, creating a weak lower face appearance.\",\n      severity_labels: { minor: \"Slightly Weak\", moderate: \"Underprojected\", severe: \"Severely Underprojected\" }\n    }\n  },\n  {\n    id: \"overly_long_face\",\n    title: \"Overly Long Face Shape\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Total Facial Width to Height Ratio\", \"Face Width to Height Ratio\"],\n      threshold: 6.0\n    },\n    content: {\n      description: \"The face is excessively tall and narrow, creating an elongated appearance.\",\n      severity_labels: { minor: \"Slightly Long\", moderate: \"Long\", severe: \"Very Long\" }\n    }\n  },\n  {\n    id: \"hyper_divergent_jaw\",\n    title: \"Hyper-Divergent Jaw Growth\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Mandibular Plane Angle\", \"Gonial Angle\", \"Lower Third Proportion\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The jaw grows with an overly steep angle, resulting in a long or narrow lower face. This can indicate malocclusion.\",\n      severity_labels: { minor: \"Mildly Divergent\", moderate: \"Divergent\", severe: \"Hyper-Divergent\" }\n    }\n  },\n  {\n    id: \"weak_brow_ridge\",\n    title: \"Soft/Weak Brow Ridge\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Browridge Inclination Angle\", \"Eyebrow Height\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The forehead has a softer, less prominent ridge than the ideal, reducing masculine definition.\",\n      severity_labels: { minor: \"Slightly Soft\", moderate: \"Soft\", severe: \"Very Weak\" }\n    }\n  },\n  {\n    id: \"droopy_nasal_tip\",\n    title: \"Droopy Nasal Tip\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\", \"Nasofacial Angle\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nasal tip points downward more than ideal, creating a drooping appearance.\",\n      severity_labels: { minor: \"Slightly Droopy\", moderate: \"Droopy\", severe: \"Very Droopy\" }\n    }\n  },\n  {\n    id: \"overprojected_nose\",\n    title: \"Overprojected Nose\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Nasal Projection\", \"Nasofacial Angle\", \"Nose Length Ratio\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The nose projects too far forward relative to the face, creating imbalance.\",\n      severity_labels: { minor: \"Slightly Projected\", moderate: \"Overprojected\", severe: \"Very Overprojected\" }\n    }\n  },\n  {\n    id: \"small_eyes\",\n    title: \"Small Eyes\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Eye Aspect Ratio\", \"Palpebral Fissure Length\", \"Eye Width\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyes appear smaller than the aesthetic ideal relative to the face.\",\n      severity_labels: { minor: \"Slightly Small\", moderate: \"Small\", severe: \"Very Small\" }\n    }\n  },\n  {\n    id: \"low_set_eyebrows\",\n    title: \"Low-Set Eyebrows\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Eyebrow Height\", \"Brow to Hairline Distance\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The eyebrows sit lower than ideal, reducing the visible upper eyelid space.\",\n      severity_labels: { minor: \"Slightly Low\", moderate: \"Low\", severe: \"Very Low\" }\n    }\n  },\n  {\n    id: \"asymmetrical_face\",\n    title: \"Facial Asymmetry\",\n    type: \"weakness\",\n    severity_logic: {\n      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n      threshold: 5.5\n    },\n    content: {\n      description: \"The left and right sides of the face show noticeable differences in proportion or position.\",\n      severity_labels: { minor: \"Slight Asymmetry\", moderate: \"Noticeable Asymmetry\", severe: \"Significant Asymmetry\" }\n    }\n  },\n  // --- STRENGTHS ---\n  {\n    id: \"good_jaw_width\",\n    title: \"Good Jaw Width\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Bigonial Width\", \"Jaw Width Ratio\", \"Jaw Frontal Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a pleasant jaw contour due to the jaw being neither too wide nor too narrow.\",\n      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n    }\n  },\n  {\n    id: \"good_forehead_slope\",\n    title: \"Good Forehead Slope\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Browridge Inclination Angle\", \"Forehead Height\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a pleasant forehead contour by indicating that the forehead is neither too steep nor too flat.\",\n      grade_labels: { good: \"Good Slope\", excellent: \"Well-Angled\", ideal: \"Ideal Slope\" }\n    }\n  },\n  {\n    id: \"good_cupids_bow\",\n    title: \"Good Cupid's Bow Depth\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Cupids Bow Depth\", \"Upper Lip Height\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious lip region due to the cupid's bow having ideal definition and depth.\",\n      grade_labels: { good: \"Defined\", excellent: \"Well-Defined\", ideal: \"Perfectly Defined\" }\n    }\n  },\n  {\n    id: \"good_eyebrow_length\",\n    title: \"Good Eyebrow Length\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Brow Length to Face Width Ratio\", \"Brow Length Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious eye region due to the eyebrows having ideal horizontal length relative to face width.\",\n      grade_labels: { good: \"Good Length\", excellent: \"Well-Proportioned\", ideal: \"Ideal Length\" }\n    }\n  },\n  {\n    id: \"good_neck_width\",\n    title: \"Good Neck Width\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Neck Width\", \"Neck to Jaw Ratio\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"This contributes to a harmonious lower face due to the neck being neither too wide nor too thin.\",\n      grade_labels: { good: \"Good Width\", excellent: \"Well-Proportioned\", ideal: \"Ideal Width\" }\n    }\n  },\n  {\n    id: \"ideal_nasolabial_angle\",\n    title: \"Ideal Nasolabial Angle\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasolabial Angle\", \"Nasal Tip Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The angle between nose and upper lip is in the ideal range, creating profile harmony.\",\n      grade_labels: { good: \"Good Angle\", excellent: \"Well-Angled\", ideal: \"Perfect Angle\" }\n    }\n  },\n  {\n    id: \"ideal_facial_depth\",\n    title: \"Ideal Facial Depth\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Facial Depth to Height Ratio\", \"Anterior Facial Depth\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face has ideal forward projection creating attractive three-dimensional contours.\",\n      grade_labels: { good: \"Good Depth\", excellent: \"Well-Projected\", ideal: \"Ideal Projection\" }\n    }\n  },\n  {\n    id: \"ideal_eye_shape\",\n    title: \"Ideal Eye Shape\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Eye Aspect Ratio\", \"Lateral Canthal Tilt\", \"Palpebral Fissure Length\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The eyes have an attractive almond shape with ideal proportions and tilt.\",\n      grade_labels: { good: \"Attractive\", excellent: \"Well-Shaped\", ideal: \"Hunter Eyes\" }\n    }\n  },\n  {\n    id: \"harmonious_profile\",\n    title: \"Harmonious Profile\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Nasofacial Angle\", \"Nasomental Angle\", \"Total Profile Angle\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The facial profile shows excellent balance between nose, lips, and chin positions.\",\n      grade_labels: { good: \"Balanced\", excellent: \"Harmonious\", ideal: \"Perfect Profile\" }\n    }\n  },\n  {\n    id: \"good_facial_symmetry\",\n    title: \"Good Facial Symmetry\",\n    type: \"strength\",\n    severity_logic: {\n      metrics: [\"Facial Asymmetry Index\", \"Eye Asymmetry\", \"Jaw Asymmetry\"],\n      threshold: 8.5\n    },\n    content: {\n      description: \"The face displays excellent bilateral symmetry, a key component of attractiveness.\",\n      grade_labels: { good: \"Symmetric\", excellent: \"Very Symmetric\", ideal: \"Near-Perfect Symmetry\" }\n    }\n  }\n];\n\n// ============================================\n// METRIC NAME MAPPING\n// ============================================\n\n// Map display names to metric IDs for lookup\nconst METRIC_NAME_TO_ID: Record<string, string> = {\n  // Face Shape/Proportions\n  \"Face Width to Height Ratio\": \"faceWidthToHeight\",\n  \"Total Facial Width to Height\": \"totalFacialWidthToHeight\",\n  \"Total Facial Width to Height Ratio\": \"totalFacialWidthToHeight\",\n  \"Midface Ratio\": \"midfaceRatio\",\n  \"Upper Third Proportion\": \"upperThirdProportion\",\n  \"Middle Third Proportion\": \"middleThirdProportion\",\n  \"Lower Third Proportion\": \"lowerThirdProportion\",\n  \"Cheekbone Height\": \"cheekboneHeight\",\n  \"Cheekbone Width\": \"cheekboneWidth\",\n  \"Bitemporal Width\": \"bitemporalWidth\",\n  \"Forehead Height\": \"foreheadHeight\",\n  \"Facial Asymmetry Index\": \"facialAsymmetryIndex\",\n\n  // Jaw\n  \"Gonial Angle\": \"gonialAngle\",\n  \"Mandibular Plane Angle\": \"mandibularPlaneAngle\",\n  \"Jaw Width Ratio\": \"jawWidthRatio\",\n  \"Bigonial Width\": \"bigonialWidth\",\n  \"Jaw Frontal Angle\": \"jawFrontalAngle\",\n  \"Jaw Slope\": \"jawSlope\",\n  \"Jaw Asymmetry\": \"jawAsymmetry\",\n\n  // Chin\n  \"Chin to Philtrum Ratio\": \"chinPhiltrumRatio\",\n  \"Chin Height\": \"chinHeight\",\n  \"Facial Depth to Height\": \"facialDepthToHeight\",\n  \"Facial Depth to Height Ratio\": \"facialDepthToHeight\",\n  \"Anterior Facial Depth\": \"anteriorFacialDepth\",\n  \"Recession Relative to Frankfort Plane\": \"recessionFrankfort\",\n\n  // Eyes\n  \"Lateral Canthal Tilt\": \"lateralCanthalTilt\",\n  \"Eye Aspect Ratio\": \"eyeAspectRatio\",\n  \"Eye Separation Ratio\": \"eyeSeparationRatio\",\n  \"Interpupillary Ratio\": \"interpupillaryRatio\",\n  \"One Eye Apart Test\": \"oneEyeApartTest\",\n  \"Intercanthal Width\": \"intercanthalWidth\",\n  \"Eyebrow Height\": \"eyebrowHeight\",\n  \"Brow Length Ratio\": \"browLengthRatio\",\n  \"Brow Length to Face Width Ratio\": \"browLengthToFaceWidth\",\n  \"Palpebral Fissure Length\": \"palpebralFissureLength\",\n  \"Eye Width\": \"eyeWidth\",\n  \"Eye Asymmetry\": \"eyeAsymmetry\",\n  \"Brow to Hairline Distance\": \"browToHairlineDistance\",\n\n  // Brow\n  \"Browridge Inclination Angle\": \"browridgeInclinationAngle\",\n\n  // Nose\n  \"Nasal Index\": \"nasalIndex\",\n  \"Nasal Tip Angle\": \"nasalTipAngle\",\n  \"Nose Tip Position\": \"noseTipPosition\",\n  \"Frankfort-tip Angle\": \"frankfortTipAngle\",\n  \"Nasofrontal Angle\": \"nasofrontalAngle\",\n  \"Nasofacial Angle\": \"nasofacialAngle\",\n  \"Nasomenta Angle\": \"nasomentaAngle\",\n  \"Nasomental Angle\": \"nasomentaAngle\",\n  \"Intercanthal Nasal Ratio\": \"intercanthalNasalRatio\",\n  \"Nose Bridge Width\": \"noseBridgeWidth\",\n  \"Nose Width\": \"noseWidth\",\n  \"Nasal Projection\": \"nasalProjection\",\n  \"Nose Length Ratio\": \"noseLengthRatio\",\n  \"Ipsilateral Alar Angle\": \"ipsilateralAlarAngle\",\n\n  // Lips\n  \"Lip Ratio\": \"lipRatio\",\n  \"Philtrum Length\": \"philtrumLength\",\n  \"Upper Lip Projection\": \"upperLipProjection\",\n  \"Lower Lip Projection\": \"lowerLipProjection\",\n  \"Lip Chin Distance\": \"lipChinDistance\",\n  \"Upper Lip Height\": \"upperLipHeight\",\n  \"Upper Lip E-Line Position\": \"upperLipELine\",\n  \"Upper Lip S-Line Position\": \"upperLipSLine\",\n  \"Nasolabial Angle\": \"nasolabialAngle\",\n  \"Cupids Bow Depth\": \"cupidsBowDepth\",\n\n  // Neck\n  \"Neck Width\": \"neckWidth\",\n  \"Neck to Jaw Ratio\": \"neckToJawRatio\",\n\n  // Profile\n  \"Total Profile Angle\": \"totalProfileAngle\",\n};\n\n// ============================================\n// CLASSIFICATION FUNCTIONS\n// ============================================\n\n/**\n * Get weakness severity based on average score\n * 0-3 = \"Severe\", 3-5 = \"Moderate\", 5-7 = \"Minor\"\n */\nfunction getWeaknessSeverity(avgScore: number): WeaknessSeverity {\n  if (avgScore <= 3) return 'severe';\n  if (avgScore <= 5) return 'moderate';\n  return 'minor';\n}\n\n/**\n * Get strength grade based on average score\n * 8-9 = \"Good\", 9-9.5 = \"Excellent\", 9.5-10 = \"Ideal\"\n */\nfunction getStrengthGrade(avgScore: number): StrengthGrade {\n  if (avgScore >= 9.5) return 'ideal';\n  if (avgScore >= 9) return 'excellent';\n  return 'good';\n}\n\n/**\n * Find metric by display name from measurements array\n */\nfunction findMetricByName(\n  metricName: string,\n  measurements: FaceIQScoreResult[]\n): FaceIQScoreResult | undefined {\n  // First try direct ID mapping\n  const metricId = METRIC_NAME_TO_ID[metricName];\n  if (metricId) {\n    return measurements.find(m => m.metricId === metricId);\n  }\n\n  // Fallback: try fuzzy matching on name\n  const normalizedName = metricName.toLowerCase().replace(/[^a-z0-9]/g, '');\n  return measurements.find(m => {\n    const normalizedMetricName = m.name.toLowerCase().replace(/[^a-z0-9]/g, '');\n    return normalizedMetricName.includes(normalizedName) ||\n           normalizedName.includes(normalizedMetricName);\n  });\n}\n\n/**\n * Check if a metric should be considered a \"false positive\" weakness.\n * This handles directional/dimorphic metrics where low scores don't mean weakness.\n *\n * Example: Canthal Tilt of 3° gets a low score (not in 6-8° ideal range)\n * but is still a POSITIVE trait, not a weakness.\n */\nfunction isFalsePositiveWeakness(metric: MatchedMetric): boolean {\n  const config = FACEIQ_METRICS[metric.metricId];\n  if (!config) return false;\n\n  // Check if the value is actually acceptable based on polarity\n  const { acceptable } = isValueAcceptable(metric.value, config);\n  return acceptable;\n}\n\n/**\n * Process all insight definitions against user's measurements\n */\nexport function classifyInsights(\n  measurements: FaceIQScoreResult[],\n  insightDefinitions: InsightDefinition[] = INSIGHTS_DEFINITIONS\n): InsightClassificationResult {\n  const strengths: ClassifiedStrength[] = [];\n  const weaknesses: ClassifiedWeakness[] = [];\n\n  for (const insight of insightDefinitions) {\n    const { metrics, threshold } = insight.severity_logic;\n\n    // Find matching measurements for this insight\n    const matchedMetrics: MatchedMetric[] = [];\n    for (const metricName of metrics) {\n      const measurement = findMetricByName(metricName, measurements);\n      if (measurement) {\n        matchedMetrics.push({\n          metricId: measurement.metricId,\n          metricName: measurement.name,\n          score: measurement.score,\n          value: measurement.value,\n          idealMin: measurement.idealMin,\n          idealMax: measurement.idealMax,\n          unit: measurement.unit,\n          category: measurement.category,\n        });\n      }\n    }\n\n    // Skip if no metrics matched (need at least 1)\n    if (matchedMetrics.length === 0) continue;\n\n    // Calculate average score\n    const avgScore = matchedMetrics.reduce((sum, m) => sum + m.score, 0) / matchedMetrics.length;\n\n    // Classify based on type and threshold\n    if (insight.type === 'weakness') {\n      // Weakness: avg < threshold → add to areas of improvement\n      if (avgScore < threshold) {\n        // ========== FALSE POSITIVE CHECK ==========\n        // Before adding to weaknesses, check if ANY of the matched metrics\n        // are actually in an \"acceptable\" zone based on their polarity.\n        // If so, this is a false positive and should be skipped or reclassified.\n        const falsePositiveMetrics = matchedMetrics.filter(isFalsePositiveWeakness);\n\n        // If ALL matched metrics are false positives, skip this weakness entirely\n        if (falsePositiveMetrics.length === matchedMetrics.length) {\n          // This is a false positive weakness - the values are actually acceptable\n          // Consider adding to strengths if scores are decent\n          if (avgScore >= 6) {\n            strengths.push({\n              insightId: `${insight.id}_acceptable`,\n              title: insight.title.replace('Negative', 'Neutral').replace('Weak', 'Moderate'),\n              description: `While not in the peak ideal range, the measured values are within acceptable limits.`,\n              grade: 'good',\n              gradeLabel: 'Acceptable',\n              avgScore,\n              matchedMetrics,\n            });\n          }\n          continue; // Skip adding as weakness\n        }\n\n        // If SOME metrics are false positives, filter them out\n        const trueWeaknessMetrics = matchedMetrics.filter(m => !isFalsePositiveWeakness(m));\n        if (trueWeaknessMetrics.length === 0) continue;\n\n        // Recalculate average with only true weakness metrics\n        const trueAvgScore = trueWeaknessMetrics.reduce((sum, m) => sum + m.score, 0) / trueWeaknessMetrics.length;\n\n        // Only add as weakness if true average is still below threshold\n        if (trueAvgScore < threshold) {\n          const severity = getWeaknessSeverity(trueAvgScore);\n          const labels = insight.content.severity_labels;\n          const severityLabel = labels?.[severity] || severity;\n\n          weaknesses.push({\n            insightId: insight.id,\n            title: insight.title,\n            description: insight.content.description,\n            severity,\n            severityLabel,\n            avgScore: trueAvgScore,\n            matchedMetrics: trueWeaknessMetrics,\n          });\n        }\n      }\n    } else {\n      // Strength: avg > threshold → add to key strengths\n      if (avgScore > threshold) {\n        const grade = getStrengthGrade(avgScore);\n        const labels = insight.content.grade_labels;\n        const gradeLabel = labels?.[grade] || grade;\n\n        strengths.push({\n          insightId: insight.id,\n          title: insight.title,\n          description: insight.content.description,\n          grade,\n          gradeLabel,\n          avgScore,\n          matchedMetrics,\n        });\n      }\n    }\n  }\n\n  // Sort by score (weaknesses by lowest score first, strengths by highest first)\n  weaknesses.sort((a, b) => a.avgScore - b.avgScore);\n  strengths.sort((a, b) => b.avgScore - a.avgScore);\n\n  return { strengths, weaknesses };\n}\n\n/**\n * Convert ClassifiedStrength to Strength type for UI compatibility\n */\nexport function convertToStrength(classified: ClassifiedStrength): Strength {\n  return {\n    id: `insight_strength_${classified.insightId}`,\n    strengthName: `${classified.title} (${classified.gradeLabel})`,\n    summary: classified.description,\n    avgScore: classified.avgScore,\n    qualityLevel: classified.grade === 'ideal' ? 'ideal' :\n                  classified.grade === 'excellent' ? 'excellent' : 'good',\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: m.score,\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n  };\n}\n\n/**\n * Convert ClassifiedWeakness to Flaw type for UI compatibility\n */\nexport function convertToFlaw(classified: ClassifiedWeakness, index: number, rollingLost: number): Flaw {\n  const impact = (10 - classified.avgScore) * 0.5 * classified.matchedMetrics.length;\n  const newRollingLost = rollingLost + impact;\n\n  return {\n    id: `insight_flaw_${classified.insightId}`,\n    flawName: `${classified.title} (${classified.severityLabel})`,\n    summary: classified.description,\n    harmonyPercentageLost: impact,\n    standardizedImpact: impact / 10,\n    categoryName: classified.matchedMetrics[0]?.category || 'General',\n    responsibleRatios: classified.matchedMetrics.map(m => ({\n      ratioName: m.metricName,\n      ratioId: m.metricId,\n      score: m.score,\n      value: m.value,\n      idealMin: m.idealMin,\n      idealMax: m.idealMax,\n      unit: m.unit,\n      category: m.category,\n    })),\n    rollingPointsDeducted: newRollingLost,\n    rollingHarmonyPercentageLost: newRollingLost,\n    rollingStandardizedImpact: newRollingLost / 10,\n  };\n}\n\n/**\n * Main function: Generate strengths and flaws from measurements using insights\n */\nexport function generateInsightBasedResults(\n  measurements: FaceIQScoreResult[]\n): { strengths: Strength[]; flaws: Flaw[] } {\n  const { strengths: classifiedStrengths, weaknesses: classifiedWeaknesses } = classifyInsights(measurements);\n\n  // Convert to UI-compatible types\n  const strengths = classifiedStrengths.map((s) => convertToStrength(s));\n\n  let rollingLost = 0;\n  const flaws = classifiedWeaknesses.map((w, i) => {\n    const flaw = convertToFlaw(w, i, rollingLost);\n    rollingLost = flaw.rollingPointsDeducted || 0;\n    return flaw;\n  });\n\n  return { strengths, flaws };\n}\n","numLines":2232,"startLine":1,"totalLines":2232}}}
{"parentUuid":"8a69b0a6-e041-4305-a20c-cb2520ddfc31","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"bd90a391-e385-4284-8226-9645391dc38b","version":"2.0.70","gitBranch":"main","agentId":"a9a1bac","slug":"golden-bouncing-hennessy","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01NfpKmtpfkJHq3H4Yo7B5Yx","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me analyze the remediation system by checking if ethnicity and gender context are used in advice generation.\n\nLet me trace through each test scenario:\n\n## VERIFICATION REPORT: REMEDIATION SYSTEM CULTURAL APPROPRIATENESS\n\n### System Architecture Analysis\n\nThe system has **TWO SEPARATE** advice systems:\n\n1. **`advice-engine.ts`** - Threshold-based surgical/non-surgical plan triggering (NO ethnicity awareness)\n2. **`looksmax-scoring.ts`** - Metric-specific advice strings in `ADVICE_DATABASE` (NO ethnicity awareness)\n3. **`insights-engine.ts`** - Has ethnicity-specific scoring configs via `getMetricConfig()` (HAS ethnicity awareness for scoring)\n\n**CRITICAL FINDING**: While `insights-engine.ts` has ethnicity overrides for **scoring**, the **advice generation** in `looksmax-scoring.ts` does NOT use ethnicity context.\n\n---\n\n### Test Scenario Results\n\n#### **Scenario A: Wide Nose (Ethnicity-Aware)**\n\n**Test 1: male_white, noseWidth = 48mm**\n\nTrace:\n- `insights-engine.ts` `getMetricConfig('noseWidth', 'male', 'white')` → ideal: [35, 42]\n- Value 48mm is ABOVE ideal max (42mm)\n- `looksmax-scoring.ts` `ADVICE_DATABASE['noseWidth'].tooHigh` → **\"Wide nasal base\"**\n- `advice-engine.ts` Rhinoplasty plan triggers if \"Nasal W to H Ratio\" > 0.85\n\n**Result**: ✅ **PASS** - Suggests nasal reduction/rhinoplasty for White males\n\n---\n\n**Test 2: male_black, noseWidth = 48mm**\n\nTrace:\n- `insights-engine.ts` `getMetricConfig('noseWidth', 'male', 'black')` → ideal: [40, 50] (ethnicity override)\n- Value 48mm is WITHIN ideal range [40, 50]\n- Score: 10.0 (perfect)\n- `generateAdvice()` in `looksmax-scoring.ts` (line 367-397):\n  - Line 375: `if (score >= 9.0) return \"Ideal proportions. No action needed.\"`\n  \n**Result**: ✅ **PASS** - Correctly says \"Ideal proportions. No action needed\" for Black males\n\n---\n\n#### **Scenario B: Soft Jaw (Gender-Aware)**\n\n**Test 1: male_white, gonial_angle = 130°**\n\nTrace:\n- `getMetricConfig('gonial_angle', 'male', 'white')` → ideal: [115.0, 125.0]\n- Value 130° is ABOVE ideal max (125°)\n- Score: ~6.5 (using Gaussian decay)\n- `ADVICE_DATABASE['gonialAngle'].tooHigh` → **\"Jaw angle is steep (obtuse). Lowering body fat or chewing hard gum may improve definition.\"**\n- `advice-engine.ts` \"Jaw Fillers\" plan triggers if \"Gonial Angle\" > 128.0\n\n**Result**: ❌ **FAIL** - Generic advice about \"body fat and chewing gum\". Does NOT mention specific surgical options like \"Jaw angle implants\" or \"BSSO\" (bilateral sagittal split osteotomy). The `advice-engine.ts` triggers \"Jaw Fillers\" but advice string is too soft.\n\n---\n\n**Test 2: female_east_asian, gonial_angle = 130°**\n\nTrace:\n- `getMetricConfig('gonial_angle', 'female', 'east_asian')` → Falls back to base config (NO female override exists!)\n- Base config ideal: [115, 125] (same as male)\n- Value 130° is ABOVE ideal\n- Score: ~6.5\n- Advice: **\"Jaw angle is steep (obtuse)...\"**\n\n**Result**: ❌ **FAIL** - System has NO female-specific standards! Lines 1038-1044 show empty `female_white` and `female_east_asian` overrides marked as TODO. A soft jaw (130°) is DESIRABLE for East Asian females but system treats it as a flaw.\n\n---\n\n#### **Scenario C: Philtrum Length (Universal)**\n\n**Test: Any gender/ethnicity, philtrumLength = 18mm**\n\nTrace:\n- Base config ideal: [11, 15]\n- Value 18mm is ABOVE ideal max\n- `ADVICE_DATABASE['philtrumLength'].tooHigh` → **\"Long philtrum\"**\n- NO specific mention of \"Lip lift\" or \"Upper lip surgery\"\n\n**Result**: ❌ **FAIL** - Generic \"Long philtrum\" advice. Does NOT mention specific surgical remediation like \"Lip lift\" procedure.\n\n---\n\n### Summary of Findings\n\n| Scenario | Test | Result | Issue |\n|----------|------|--------|-------|\n| Wide Nose (White Male) | 48mm | ✅ PASS | Correctly flags for reduction |\n| Wide Nose (Black Male) | 48mm | ✅ PASS | Correctly accepts within range |\n| Soft Jaw (White Male) | 130° | ❌ FAIL | No surgical options mentioned |\n| Soft Jaw (Female EA) | 130° | ❌ FAIL | No female standards exist |\n| Long Philtrum | 18mm | ❌ FAIL | No specific procedure mentioned |\n\n---\n\n### Critical Issues Identified\n\n1. **NO FEMALE STANDARDS** - Lines 1038-1044 show empty placeholders. Female faces scored using male standards.\n\n2. **EUROCENTRIC NOSE BIAS AVOIDED** - System correctly handles ethnicity for nose width scoring (✅)\n\n3. **ADVICE STRINGS LACK SPECIFICITY** - The `ADVICE_DATABASE` contains generic phrases like \"Consider hairstyles\" instead of specific procedures like \"Alarplasty\", \"Lip lift\", \"BSSO\"\n\n4. **ADVICE ENGINE DOESN'T USE ETHNICITY** - `advice-engine.ts` triggers plans based on raw thresholds without ethnicity context. For example:\n   - Rhinoplasty triggers if \"Nasal W to H Ratio\" > 0.85 (line 193)\n   - But this threshold is NOT adjusted for ethnicity!\n\n5. **NO GENDER DIMORPHISM IN ADVICE** - The advice strings don't change based on gender. A soft jaw angle suggestion is the same for male/female.\n\n---\n\n### Remediation System Verdict\n\n**STATUS**: ❌ **REMEDIATION SYSTEM NEEDS GENDER AWARENESS**\n\n**Score**: \n- ✅ Ethnicity awareness: 7/10 (nose scoring works, but plan triggers don't use ethnicity)\n- ❌ Gender awareness: 2/10 (no female standards exist)\n- ❌ Advice specificity: 4/10 (too generic, lacks procedure names)\n\n**Recommendations**:\n1. Add female-specific standards to `ETHNICITY_OVERRIDES`\n2. Make `advice-engine.ts` plans ethnicity/gender-aware\n3. Enhance `ADVICE_DATABASE` with specific procedure names\n4. Add gender-conditional advice (e.g., \"soft jaw ideal for females, consider fillers for males\")"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":43258,"cache_read_input_tokens":12513,"cache_creation":{"ephemeral_5m_input_tokens":43258,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLK3E2SsFpyYchxCLZGH","type":"assistant","uuid":"c85cbd71-2c42-4c71-8fd4-ac78ff7185ad","timestamp":"2025-12-21T18:33:46.004Z"}
