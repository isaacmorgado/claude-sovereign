     1→'use client';
     2→
     3→import { useEffect, useState, useCallback } from 'react';
     4→import { useParams, useRouter } from 'next/navigation';
     5→import Link from 'next/link';
     6→import { api } from '@/lib/api';
     7→import { ForumUserProfile, UserPostItem, UserCommentItem, VoteType } from '@/types/forum';
     8→import { UserProfileCard } from '@/components/forum/UserProfileCard';
     9→import { ForumHeader, ForumBreadcrumb, VoteButtons } from '@/components/forum';
    10→import { formatDistanceToNow } from '@/lib/utils';
    11→import { MessageSquare, FileText, User, Pin, Sparkles, ArrowUpRight } from 'lucide-react';
    12→
    13→/**
    14→ * Check if a string is a valid UUID v4
    15→ */
    16→function isUUID(str: string): boolean {
    17→  const uuidRegex = /^[0-9a-f]{8}-[0-9a-f]{4}-4[0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;
    18→  return uuidRegex.test(str);
    19→}
    20→
    21→// ============================================
    22→// SKELETON COMPONENTS
    23→// ============================================
    24→
    25→function ProfileSkeleton() {
    26→  return (
    27→    <div className="rounded-2xl bg-neutral-900/30 border border-white/5 overflow-hidden animate-pulse">
    28→      <div className="h-24 bg-neutral-800" />
    29→      <div className="px-6 pt-12 pb-6">
    30→        <div className="h-7 w-40 bg-neutral-800 rounded mb-2" />
    31→        <div className="h-4 w-32 bg-neutral-800 rounded mb-6" />
    32→        <div className="grid grid-cols-3 gap-4">
    33→          {[1, 2, 3].map((i) => (
    34→            <div key={i} className="h-24 bg-neutral-800 rounded-xl" />
    35→          ))}
    36→        </div>
    37→      </div>
    38→    </div>
    39→  );
    40→}
    41→
    42→function PostItemSkeleton() {
    43→  return (
    44→    <div className="p-4 rounded-xl bg-neutral-900/30 border border-white/5 animate-pulse">
    45→      <div className="flex gap-4">
    46→        <div className="w-10 space-y-2">
    47→          <div className="h-5 w-5 bg-neutral-800 rounded mx-auto" />
    48→          <div className="h-4 w-4 bg-neutral-800 rounded mx-auto" />
    49→        </div>
    50→        <div className="flex-1 space-y-2">
    51→          <div className="h-5 w-3/4 bg-neutral-800 rounded" />
    52→          <div className="h-4 w-full bg-neutral-800 rounded" />
    53→          <div className="h-3 w-32 bg-neutral-800 rounded" />
    54→        </div>
    55→      </div>
    56→    </div>
    57→  );
    58→}
    59→
    60→function CommentItemSkeleton() {
    61→  return (
    62→    <div className="p-4 rounded-xl bg-neutral-900/30 border border-white/5 animate-pulse">
    63→      <div className="flex gap-4">
    64→        <div className="w-10 space-y-2">
    65→          <div className="h-5 w-5 bg-neutral-800 rounded mx-auto" />
    66→          <div className="h-4 w-4 bg-neutral-800 rounded mx-auto" />
    67→        </div>
    68→        <div className="flex-1 space-y-2">
    69→          <div className="h-4 w-48 bg-neutral-800 rounded" />
    70→          <div className="h-4 w-full bg-neutral-800 rounded" />
    71→          <div className="h-3 w-24 bg-neutral-800 rounded" />
    72→        </div>
    73→      </div>
    74→    </div>
    75→  );
    76→}
    77→
    78→// ============================================
    79→// POST ITEM COMPONENT
    80→// ============================================
    81→
    82→interface UserPostCardProps {
    83→  post: UserPostItem;
    84→  onVote?: (postId: string, voteType: VoteType) => void;
    85→}
    86→
    87→function UserPostCard({ post, onVote }: UserPostCardProps) {
    88→  return (
    89→    <article className="group relative rounded-xl bg-neutral-900/30 border border-white/5 hover:border-cyan-500/20 transition-all overflow-hidden">
    90→      <div className="flex">
    91→        {/* Vote column */}
    92→        <div className="w-12 bg-neutral-900/50 border-r border-white/5 flex flex-col items-center py-4">
    93→          <VoteButtons
    94→            voteCount={post.voteCount}
    95→            userVote={post.userVote}
    96→            onVote={(voteType) => onVote?.(post.id, voteType)}
    97→            size="sm"
    98→          />
    99→        </div>
   100→
   101→        {/* Content */}
   102→        <div className="flex-1 p-4 min-w-0">
   103→          {/* Meta line */}
   104→          <div className="flex items-center flex-wrap gap-2 mb-2">
   105→            {post.isPinned && (
   106→              <span className="flex items-center gap-1 px-2 py-0.5 rounded-md bg-cyan-500/10 border border-cyan-500/20 text-[9px] font-black uppercase tracking-wider text-cyan-400">
   107→                <Pin size={10} />
   108→                Pinned
   109→              </span>
   110→            )}
   111→            {post.isGuide && (
   112→              <span className="flex items-center gap-1 px-2 py-0.5 rounded-md bg-green-500/10 border border-green-500/20 text-[9px] font-black uppercase tracking-wider text-green-400">
   113→                <Sparkles size={10} />
   114→                Guide
   115→              </span>
   116→            )}
   117→            <Link
   118→              href={`/forum/${post.categorySlug}`}
   119→              className="text-[10px] font-black uppercase tracking-widest text-cyan-400 hover:text-cyan-300"
   120→            >
   121→              {post.subForumSlug}
   122→            </Link>
   123→            <span className="text-[10px] text-neutral-700">|</span>
   124→            <span className="text-[10px] text-neutral-600">{formatDistanceToNow(post.createdAt)}</span>
   125→          </div>
   126→
   127→          {/* Title */}
   128→          <Link href={`/forum/post/${post.id}`}>
   129→            <h3 className="text-base font-bold text-white group-hover:text-cyan-400 transition-colors leading-snug mb-2">
   130→              {post.title}
   131→            </h3>
   132→          </Link>
   133→
   134→          {/* Preview text */}
   135→          {post.contentPreview && (
   136→            <p className="text-neutral-500 text-sm line-clamp-2 mb-3 leading-relaxed">
   137→              {post.contentPreview}
   138→            </p>
   139→          )}
   140→
   141→          {/* Stats */}
   142→          <div className="flex items-center gap-3">
   143→            <span className="flex items-center gap-1.5 text-[10px] font-medium text-neutral-500">
   144→              <MessageSquare size={12} />
   145→              {post.commentCount}
   146→            </span>
   147→          </div>
   148→        </div>
   149→      </div>
   150→    </article>
   151→  );
   152→}
   153→
   154→// ============================================
   155→// COMMENT ITEM COMPONENT
   156→// ============================================
   157→
   158→interface UserCommentCardProps {
   159→  comment: UserCommentItem;
   160→  onVote?: (commentId: string, voteType: VoteType) => void;
   161→}
   162→
   163→function UserCommentCard({ comment, onVote }: UserCommentCardProps) {
   164→  return (
   165→    <article className="group relative rounded-xl bg-neutral-900/30 border border-white/5 hover:border-cyan-500/20 transition-all overflow-hidden">
   166→      <div className="flex">
   167→        {/* Vote column */}
   168→        <div className="w-12 bg-neutral-900/50 border-r border-white/5 flex flex-col items-center py-4">
   169→          <VoteButtons
   170→            voteCount={comment.voteCount}
   171→            userVote={comment.userVote}
   172→            onVote={(voteType) => onVote?.(comment.id, voteType)}
   173→            size="sm"
   174→          />
   175→        </div>
   176→
   177→        {/* Content */}
   178→        <div className="flex-1 p-4 min-w-0">
   179→          {/* Post reference */}
   180→          <Link
   181→            href={`/forum/post/${comment.postId}`}
   182→            className="flex items-center gap-2 text-[10px] font-medium text-neutral-500 hover:text-cyan-400 transition-colors mb-2"
   183→          >
   184→            <ArrowUpRight size={12} />
   185→            <span className="line-clamp-1">{comment.postTitle}</span>
   186→          </Link>
   187→
   188→          {/* Comment content */}
   189→          <p className="text-neutral-300 text-sm leading-relaxed line-clamp-3 mb-3">
   190→            {comment.content}
   191→          </p>
   192→
   193→          {/* Meta */}
   194→          <div className="flex items-center gap-3">
   195→            <span className="text-[10px] text-neutral-600">
   196→              {formatDistanceToNow(comment.createdAt)}
   197→            </span>
   198→          </div>
   199→        </div>
   200→      </div>
   201→    </article>
   202→  );
   203→}
   204→
   205→// ============================================
   206→// MAIN PAGE
   207→// ============================================
   208→
   209→type TabType = 'posts' | 'comments';
   210→
   211→export default function UserProfilePage() {
   212→  const params = useParams();
   213→  const router = useRouter();
   214→  const identifier = params.userId as string; // Could be UUID or username
   215→
   216→  const [profile, setProfile] = useState<ForumUserProfile | null>(null);
   217→  const [posts, setPosts] = useState<UserPostItem[]>([]);
   218→  const [comments, setComments] = useState<UserCommentItem[]>([]);
   219→  const [activeTab, setActiveTab] = useState<TabType>('posts');
   220→
   221→  const [isLoadingProfile, setIsLoadingProfile] = useState(true);
   222→  const [isLoadingContent, setIsLoadingContent] = useState(false);
   223→  const [hasMorePosts, setHasMorePosts] = useState(true);
   224→  const [hasMoreComments, setHasMoreComments] = useState(true);
   225→  const [error, setError] = useState<string | null>(null);
   226→
   227→  const PAGE_SIZE = 20;
   228→
   229→  // Fetch profile - handles both UUID and username
   230→  useEffect(() => {
   231→    async function fetchProfile() {
   232→      setIsLoadingProfile(true);
   233→      setError(null);
   234→      try {
   235→        let data: ForumUserProfile;
   236→
   237→        // Check if identifier is a UUID or username
   238→        if (isUUID(identifier)) {
   239→          // It's a UUID, use the standard endpoint
   240→          data = await api.getForumUserProfile(identifier);
   241→        } else {
   242→          // It's a username, use the username lookup endpoint
   243→          data = await api.getForumUserProfileByUsername(identifier);
   244→          // Redirect to canonical URL with user ID for cleaner URLs
   245→          router.replace(`/forum/user/${data.id}`);
   246→        }
   247→
   248→        setProfile(data);
   249→      } catch (err) {
   250→        setError(err instanceof Error ? err.message : 'Failed to load profile');
   251→      } finally {
   252→        setIsLoadingProfile(false);
   253→      }
   254→    }
   255→
   256→    fetchProfile();
   257→  }, [identifier, router]);
   258→
   259→  // Fetch posts - uses profile.id (UUID) to ensure correct API call
   260→  const fetchPosts = useCallback(async (offset = 0, userId?: string) => {
   261→    const userIdToUse = userId || profile?.id;
   262→    if (!userIdToUse) return;
   263→
   264→    setIsLoadingContent(true);
   265→    try {
   266→      const data = await api.getUserForumPosts(userIdToUse, { limit: PAGE_SIZE, offset });
   267→      if (offset === 0) {
   268→        setPosts(data.posts);
   269→      } else {
   270→        setPosts((prev) => [...prev, ...data.posts]);
   271→      }
   272→      setHasMorePosts(data.hasMore);
   273→    } catch {
   274→      // Silent fail for content loading
   275→    } finally {
   276→      setIsLoadingContent(false);
   277→    }
   278→  }, [profile?.id]);
   279→
   280→  // Fetch comments - uses profile.id (UUID) to ensure correct API call
   281→  const fetchComments = useCallback(async (offset = 0, userId?: string) => {
   282→    const userIdToUse = userId || profile?.id;
   283→    if (!userIdToUse) return;
   284→
   285→    setIsLoadingContent(true);
   286→    try {
   287→      const data = await api.getUserForumComments(userIdToUse, { limit: PAGE_SIZE, offset });
   288→      if (offset === 0) {
   289→        setComments(data.comments);
   290→      } else {
   291→        setComments((prev) => [...prev, ...data.comments]);
   292→      }
   293→      setHasMoreComments(data.hasMore);
   294→    } catch {
   295→      // Silent fail for content loading
   296→    } finally {
   297→      setIsLoadingContent(false);
   298→    }
   299→  }, [profile?.id]);
   300→
   301→  // Fetch content when tab changes or when profile is loaded
   302→  useEffect(() => {
   303→    if (!profile) return; // Wait for profile to be loaded
   304→
   305→    if (activeTab === 'posts' && posts.length === 0) {
   306→      fetchPosts(0, profile.id);
   307→    } else if (activeTab === 'comments' && comments.length === 0) {
   308→      fetchComments(0, profile.id);
   309→    }
   310→  }, [activeTab, posts.length, comments.length, fetchPosts, fetchComments, profile]);
   311→
   312→  const handleLoadMore = () => {
   313→    if (activeTab === 'posts' && hasMorePosts) {
   314→      fetchPosts(posts.length);
   315→    } else if (activeTab === 'comments' && hasMoreComments) {
   316→      fetchComments(comments.length);
   317→    }
   318→  };
   319→
   320→  const handleVotePost = async (postId: string, voteType: VoteType) => {
   321→    try {
   322→      const result = await api.voteForumPost(postId, voteType);
   323→      setPosts((prev) =>
   324→        prev.map((p) =>
   325→          p.id === postId
   326→            ? { ...p, voteCount: result.newVoteCount, userVote: result.userVote }
   327→            : p
   328→        )
   329→      );
   330→    } catch {
   331→      // Silent fail
   332→    }
   333→  };
   334→
   335→  const handleVoteComment = async (commentId: string, voteType: VoteType) => {
   336→    try {
   337→      const result = await api.voteForumComment(commentId, voteType);
   338→      setComments((prev) =>
   339→        prev.map((c) =>
   340→          c.id === commentId
   341→            ? { ...c, voteCount: result.newVoteCount, userVote: result.userVote }
   342→            : c
   343→        )
   344→      );
   345→    } catch {
   346→      // Silent fail
   347→    }
   348→  };
   349→
   350→  return (
   351→    <div className="min-h-screen bg-black selection:bg-cyan-500/30">
   352→      <ForumHeader />
   353→      <ForumBreadcrumb
   354→        items={[
   355→          { label: 'Community', href: '/forum' },
   356→          { label: profile?.username || 'User Profile' },
   357→        ]}
   358→      />
   359→
   360→      {/* Content */}
   361→      <div className="max-w-4xl mx-auto px-6 py-10">
   362→        {/* Error */}
   363→        {error && (
   364→          <div className="p-4 rounded-xl bg-red-500/10 border border-red-500/20 mb-6">
   365→            <p className="text-red-400 text-sm">{error}</p>
   366→          </div>
   367→        )}
   368→
   369→        {/* Profile Card */}
   370→        {isLoadingProfile ? (
   371→          <ProfileSkeleton />
   372→        ) : profile ? (
   373→          <UserProfileCard profile={profile} variant="full" />
   374→        ) : !error ? (
   375→          <div className="text-center py-16 rounded-2xl bg-neutral-900/30 border border-white/5">
   376→            <User size={48} className="mx-auto text-neutral-700 mb-4" />
   377→            <h2 className="text-xl font-black text-white mb-3">User not found</h2>
   378→            <p className="text-neutral-400 mb-6">
   379→              This user doesn&apos;t exist or has been banned.
   380→            </p>
   381→            <Link
   382→              href="/forum"
   383→              className="inline-flex items-center gap-2 px-6 py-3 bg-cyan-500 text-black text-[10px] font-black uppercase tracking-widest rounded-xl hover:bg-cyan-400 transition-all"
   384→            >
   385→              Go back to forum
   386→            </Link>
   387→          </div>
   388→        ) : null}
   389→
   390→        {/* Tabs */}
   391→        {profile && (
   392→          <>
   393→            <div className="flex gap-2 mt-8 mb-6">
   394→              <button
   395→                onClick={() => setActiveTab('posts')}
   396→                className={`flex items-center gap-2 px-5 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${
   397→                  activeTab === 'posts'
   398→                    ? 'bg-cyan-500 text-black'
   399→                    : 'bg-neutral-900/30 text-neutral-400 border border-white/5 hover:border-cyan-500/20 hover:text-cyan-400'
   400→                }`}
   401→              >
   402→                <FileText size={14} />
   403→                Posts ({profile.forumPostsCount})
   404→              </button>
   405→              <button
   406→                onClick={() => setActiveTab('comments')}
   407→                className={`flex items-center gap-2 px-5 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${
   408→                  activeTab === 'comments'
   409→                    ? 'bg-cyan-500 text-black'
   410→                    : 'bg-neutral-900/30 text-neutral-400 border border-white/5 hover:border-cyan-500/20 hover:text-cyan-400'
   411→                }`}
   412→              >
   413→                <MessageSquare size={14} />
   414→                Comments ({profile.forumCommentsCount})
   415→              </button>
   416→            </div>
   417→
   418→            {/* Content */}
   419→            {activeTab === 'posts' && (
   420→              <div className="space-y-4">
   421→                {isLoadingContent && posts.length === 0 ? (
   422→                  <>
   423→                    {[1, 2, 3].map((i) => (
   424→                      <PostItemSkeleton key={i} />
   425→                    ))}
   426→                  </>
   427→                ) : posts.length > 0 ? (
   428→                  <>
   429→                    {posts.map((post) => (
   430→                      <UserPostCard key={post.id} post={post} onVote={handleVotePost} />
   431→                    ))}
   432→                    {hasMorePosts && (
   433→                      <button
   434→                        onClick={handleLoadMore}
   435→                        disabled={isLoadingContent}
   436→                        className="w-full py-4 rounded-xl bg-neutral-900/30 border border-white/5 text-neutral-400 text-[10px] font-black uppercase tracking-widest hover:border-cyan-500/20 hover:text-cyan-400 transition-all disabled:opacity-50"
   437→                      >
   438→                        {isLoadingContent ? 'Loading...' : 'Load More Posts'}
   439→                      </button>
   440→                    )}
   441→                  </>
   442→                ) : (
   443→                  <div className="text-center py-12 rounded-2xl bg-neutral-900/30 border border-white/5">
   444→                    <FileText size={32} className="mx-auto text-neutral-700 mb-3" />
   445→                    <p className="text-neutral-400">No posts yet</p>
   446→                  </div>
   447→                )}
   448→              </div>
   449→            )}
   450→
   451→            {activeTab === 'comments' && (
   452→              <div className="space-y-4">
   453→                {isLoadingContent && comments.length === 0 ? (
   454→                  <>
   455→                    {[1, 2, 3].map((i) => (
   456→                      <CommentItemSkeleton key={i} />
   457→                    ))}
   458→                  </>
   459→                ) : comments.length > 0 ? (
   460→                  <>
   461→                    {comments.map((comment) => (
   462→                      <UserCommentCard
   463→                        key={comment.id}
   464→                        comment={comment}
   465→                        onVote={handleVoteComment}
   466→                      />
   467→                    ))}
   468→                    {hasMoreComments && (
   469→                      <button
   470→                        onClick={handleLoadMore}
   471→                        disabled={isLoadingContent}
   472→                        className="w-full py-4 rounded-xl bg-neutral-900/30 border border-white/5 text-neutral-400 text-[10px] font-black uppercase tracking-widest hover:border-cyan-500/20 hover:text-cyan-400 transition-all disabled:opacity-50"
   473→                      >
   474→                        {isLoadingContent ? 'Loading...' : 'Load More Comments'}
   475→                      </button>
   476→                    )}
   477→                  </>
   478→                ) : (
   479→                  <div className="text-center py-12 rounded-2xl bg-neutral-900/30 border border-white/5">
   480→                    <MessageSquare size={32} className="mx-auto text-neutral-700 mb-3" />
   481→                    <p className="text-neutral-400">No comments yet</p>
   482→                  </div>
   483→                )}
   484→              </div>
   485→            )}
   486→          </>
   487→        )}
   488→      </div>
   489→    </div>
   490→  );
   491→}
   492→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
