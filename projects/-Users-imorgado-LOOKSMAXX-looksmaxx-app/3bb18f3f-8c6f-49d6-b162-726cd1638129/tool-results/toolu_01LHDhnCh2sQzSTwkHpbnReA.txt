     1â†’'use client';
     2â†’
     3â†’import React, { useEffect, useRef, useState } from 'react';
     4â†’import Link from 'next/link';
     5â†’import { motion } from 'framer-motion';
     6â†’import { useForum } from '@/contexts/ForumContext';
     7â†’import { ForumHeader, KarmaLeaderboard } from '@/components/forum';
     8â†’import { QuotaIndicator } from '@/components/forum/QuotaIndicator';
     9â†’import {
    10â†’  ArrowRight,
    11â†’  Users,
    12â†’  MessageSquare,
    13â†’  Flame,
    14â†’  Clock,
    15â†’  Star,
    16â†’  Zap,
    17â†’  ChevronRight,
    18â†’  BookOpen,
    19â†’  ShieldCheck,
    20â†’} from 'lucide-react';
    21â†’
    22â†’// ============================================
    23â†’// SECTION HEADER
    24â†’// ============================================
    25â†’function SectionHeader({ title }: { title: string }) {
    26â†’  return (
    27â†’    <h2 className="text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-8 flex items-center gap-4">
    28â†’      {title}
    29â†’      <div className="flex-1 h-px bg-neutral-900" />
    30â†’    </h2>
    31â†’  );
    32â†’}
    33â†’
    34â†’// ============================================
    35â†’// STAT CARD
    36â†’// ============================================
    37â†’function StatCard({ value, label, icon: Icon }: {
    38â†’  value: number;
    39â†’  label: string;
    40â†’  icon: React.ElementType;
    41â†’}) {
    42â†’  return (
    43â†’    <div className="p-5 rounded-2xl bg-neutral-900/30 border border-white/5 text-center">
    44â†’      <div className="w-10 h-10 rounded-xl bg-cyan-500/10 flex items-center justify-center mx-auto mb-3">
    45â†’        <Icon size={18} className="text-cyan-400" />
    46â†’      </div>
    47â†’      <p className="text-2xl font-black italic text-white mb-1">{value}</p>
    48â†’      <p className="text-[9px] font-black uppercase tracking-widest text-neutral-600">{label}</p>
    49â†’    </div>
    50â†’  );
    51â†’}
    52â†’
    53â†’// ============================================
    54â†’// CATEGORY CARD
    55â†’// ============================================
    56â†’function CategoryCard({ category, index }: {
    57â†’  category: {
    58â†’    id: string;
    59â†’    slug: string;
    60â†’    name: string;
    61â†’    description: string | null;
    62â†’    icon: string | null;
    63â†’    postCount: number;
    64â†’    subForums: { id: string; name: string; slug: string; postCount: number }[];
    65â†’  };
    66â†’  index: number;
    67â†’}) {
    68â†’  return (
    69â†’    <motion.div
    70â†’      initial={{ opacity: 0, y: 20 }}
    71â†’      animate={{ opacity: 1, y: 0 }}
    72â†’      transition={{ delay: index * 0.05 }}
    73â†’    >
    74â†’      <Link href={`/forum/${category.slug}`}>
    75â†’        <div className="group h-full p-6 rounded-2xl bg-neutral-900/30 border border-white/5 hover:border-cyan-500/20 transition-all">
    76â†’          <div className="flex items-start gap-4">
    77â†’            {/* Icon */}
    78â†’            <div className="w-12 h-12 rounded-xl bg-gradient-to-br from-cyan-500/20 to-blue-500/20 border border-white/5 flex items-center justify-center text-xl flex-shrink-0">
    79â†’              {category.icon || 'ðŸ’¬'}
    80â†’            </div>
    81â†’
    82â†’            {/* Content */}
    83â†’            <div className="flex-1 min-w-0">
    84â†’              <div className="flex items-center gap-3 mb-2">
    85â†’                <h3 className="text-sm font-black uppercase tracking-wider text-white group-hover:text-cyan-400 transition-colors truncate">
    86â†’                  {category.name}
    87â†’                </h3>
    88â†’                <ChevronRight size={14} className="text-neutral-700 group-hover:text-cyan-400 transition-colors" />
    89â†’              </div>
    90â†’              <p className="text-[11px] text-neutral-500 line-clamp-2 mb-4 leading-relaxed">
    91â†’                {category.description || 'No description available'}
    92â†’              </p>
    93â†’
    94â†’              {/* Sub-forums as tags */}
    95â†’              <div className="flex flex-wrap gap-2">
    96â†’                {category.subForums.slice(0, 3).map((sf) => (
    97â†’                  <span
    98â†’                    key={sf.id}
    99â†’                    className="px-2 py-1 text-[9px] font-black uppercase tracking-wider bg-neutral-900/50 border border-white/5 text-neutral-500 rounded-md"
   100â†’                  >
   101â†’                    {sf.name}
   102â†’                  </span>
   103â†’                ))}
   104â†’                {category.subForums.length > 3 && (
   105â†’                  <span className="px-2 py-1 text-[9px] text-neutral-600">
   106â†’                    +{category.subForums.length - 3} more
   107â†’                  </span>
   108â†’                )}
   109â†’              </div>
   110â†’            </div>
   111â†’
   112â†’            {/* Stats */}
   113â†’            <div className="text-right flex-shrink-0">
   114â†’              <p className="text-lg font-black italic text-white">{category.postCount}</p>
   115â†’              <p className="text-[9px] font-black uppercase tracking-widest text-neutral-600">Posts</p>
   116â†’            </div>
   117â†’          </div>
   118â†’        </div>
   119â†’      </Link>
   120â†’    </motion.div>
   121â†’  );
   122â†’}
   123â†’
   124â†’// ============================================
   125â†’// FILTER TABS
   126â†’// ============================================
   127â†’function FilterTabs({
   128â†’  activeFilter,
   129â†’  setActiveFilter
   130â†’}: {
   131â†’  activeFilter: 'all' | 'trending' | 'new';
   132â†’  setActiveFilter: (filter: 'all' | 'trending' | 'new') => void;
   133â†’}) {
   134â†’  const filters = [
   135â†’    { id: 'all', label: 'All', icon: Star },
   136â†’    { id: 'trending', label: 'Trending', icon: Flame },
   137â†’    { id: 'new', label: 'Recent', icon: Clock },
   138â†’  ] as const;
   139â†’
   140â†’  return (
   141â†’    <div className="flex items-center gap-1 p-1.5 bg-neutral-900/30 border border-white/5 rounded-xl w-fit">
   142â†’      {filters.map((filter) => (
   143â†’        <button
   144â†’          key={filter.id}
   145â†’          onClick={() => setActiveFilter(filter.id)}
   146â†’          className={`flex items-center gap-2 px-4 py-2 rounded-lg text-[10px] font-black uppercase tracking-widest transition-all ${activeFilter === filter.id
   147â†’            ? 'bg-cyan-500/10 text-cyan-400 border border-cyan-500/20'
   148â†’            : 'text-neutral-600 hover:text-white border border-transparent'
   149â†’            }`}
   150â†’        >
   151â†’          <filter.icon size={12} />
   152â†’          {filter.label}
   153â†’        </button>
   154â†’      ))}
   155â†’    </div>
   156â†’  );
   157â†’}
   158â†’
   159â†’// ============================================
   160â†’// LOADING SKELETON
   161â†’// ============================================
   162â†’function CategorySkeleton() {
   163â†’  return (
   164â†’    <div className="p-6 rounded-2xl bg-neutral-900/30 border border-white/5 animate-pulse">
   165â†’      <div className="flex items-start gap-4">
   166â†’        <div className="w-12 h-12 rounded-xl bg-neutral-800" />
   167â†’        <div className="flex-1 space-y-3">
   168â†’          <div className="h-4 w-1/3 bg-neutral-800 rounded" />
   169â†’          <div className="h-3 w-2/3 bg-neutral-800 rounded" />
   170â†’          <div className="flex gap-2">
   171â†’            <div className="h-6 w-16 bg-neutral-800 rounded" />
   172â†’            <div className="h-6 w-20 bg-neutral-800 rounded" />
   173â†’          </div>
   174â†’        </div>
   175â†’        <div className="text-right space-y-2">
   176â†’          <div className="h-5 w-8 bg-neutral-800 rounded ml-auto" />
   177â†’          <div className="h-3 w-10 bg-neutral-800 rounded ml-auto" />
   178â†’        </div>
   179â†’      </div>
   180â†’    </div>
   181â†’  );
   182â†’}
   183â†’
   184â†’// ============================================
   185â†’// MAIN PAGE
   186â†’// ============================================
   187â†’export default function ForumPage() {
   188â†’  const { categories, isLoadingCategories, fetchCategories, error } = useForum();
   189â†’  const [activeFilter, setActiveFilter] = useState<'all' | 'trending' | 'new'>('all');
   190â†’  const hasFetchedRef = useRef(false);
   191â†’
   192â†’  useEffect(() => {
   193â†’    if (!hasFetchedRef.current) {
   194â†’      hasFetchedRef.current = true;
   195â†’      fetchCategories();
   196â†’    }
   197â†’  }, [fetchCategories]);
   198â†’
   199â†’  // Sort categories based on filter
   200â†’  const sortedCategories = [...categories].sort((a, b) => {
   201â†’    if (activeFilter === 'trending') return b.postCount - a.postCount;
   202â†’    if (activeFilter === 'new') return 0;
   203â†’    return a.displayOrder - b.displayOrder;
   204â†’  });
   205â†’
   206â†’  const totalPosts = categories.reduce((sum, c) => sum + c.postCount, 0);
   207â†’  const totalTopics = categories.reduce((sum, c) => sum + c.subForums.length, 0);
   208â†’
   209â†’  return (
   210â†’    <div className="min-h-screen bg-black selection:bg-cyan-500/30">
   211â†’      <ForumHeader />
   212â†’
   213â†’      {/* Hero */}
   214â†’      <section className="border-b border-white/5">
   215â†’        <div className="max-w-6xl mx-auto px-6 pt-16 pb-12">
   216â†’          <div className="flex flex-col lg:flex-row lg:items-end lg:justify-between gap-8">
   217â†’            <div>
   218â†’              <h1 className="text-5xl md:text-6xl font-black tracking-tighter italic uppercase mb-4">
   219â†’                Community <span className="text-cyan-400">Hub</span>
   220â†’              </h1>
   221â†’              <p className="text-neutral-500 font-medium uppercase text-xs tracking-[0.2em] max-w-lg mb-6">
   222â†’                Connect with others, share experiences, and discover evidence-based treatments
   223â†’              </p>
   224â†’              <div className="flex flex-wrap gap-3">
   225â†’                <Link
   226â†’                  href="/signup"
   227â†’                  className="h-11 px-6 rounded-xl bg-cyan-500 text-black text-[10px] font-black uppercase tracking-widest flex items-center gap-2 hover:bg-cyan-400 transition-all shadow-lg shadow-cyan-500/20"
   228â†’                >
   229â†’                  Join Community <ArrowRight size={14} />
   230â†’                </Link>
   231â†’                <Link
   232â†’                  href="/upload"
   233â†’                  className="h-11 px-6 rounded-xl bg-neutral-900/50 border border-white/10 text-white text-[10px] font-black uppercase tracking-widest flex items-center gap-2 hover:border-white/20 transition-all"
   234â†’                >
   235â†’                  <Zap size={14} className="text-cyan-400" /> Get Matched
   236â†’                </Link>
   237â†’              </div>
   238â†’            </div>
   239â†’
   240â†’            {/* Stats */}
   241â†’            <div className="grid grid-cols-3 gap-4">
   242â†’              <StatCard value={categories.length} label="Communities" icon={Users} />
   243â†’              <StatCard value={totalPosts} label="Discussions" icon={MessageSquare} />
   244â†’              <StatCard value={totalTopics} label="Topics" icon={BookOpen} />
   245â†’            </div>
   246â†’          </div>
   247â†’        </div>
   248â†’      </section>
   249â†’
   250â†’      {/* Main Content */}
   251â†’      <main className="max-w-6xl mx-auto px-6 py-12">
   252â†’        <div className="flex flex-col lg:flex-row gap-10">
   253â†’          {/* Communities List */}
   254â†’          <div className="flex-1">
   255â†’            {/* Filter + Header */}
   256â†’            <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-8">
   257â†’              <SectionHeader title="Communities" />
   258â†’              <FilterTabs activeFilter={activeFilter} setActiveFilter={setActiveFilter} />
   259â†’            </div>
   260â†’
   261â†’            {/* Error State */}
   262â†’            {error && (
   263â†’              <div className="p-4 rounded-xl bg-red-500/10 border border-red-500/20 mb-6">
   264â†’                <p className="text-red-400 text-sm">{error}</p>
   265â†’              </div>
   266â†’            )}
   267â†’
   268â†’            {/* Loading State */}
   269â†’            {isLoadingCategories && categories.length === 0 && (
   270â†’              <div className="space-y-4">
   271â†’                {[1, 2, 3, 4, 5].map((i) => (
   272â†’                  <CategorySkeleton key={i} />
   273â†’                ))}
   274â†’              </div>
   275â†’            )}
   276â†’
   277â†’            {/* Categories Grid */}
   278â†’            {!isLoadingCategories && sortedCategories.length > 0 && (
   279â†’              <div className="space-y-4">
   280â†’                {sortedCategories.map((category, index) => (
   281â†’                  <CategoryCard key={category.id} category={category} index={index} />
   282â†’                ))}
   283â†’              </div>
   284â†’            )}
   285â†’
   286â†’            {/* Empty State */}
   287â†’            {!isLoadingCategories && categories.length === 0 && !error && (
   288â†’              <div className="text-center py-16 rounded-2xl bg-neutral-900/30 border border-white/5">
   289â†’                <div className="w-14 h-14 rounded-2xl bg-neutral-900/50 flex items-center justify-center mx-auto mb-4">
   290â†’                  <MessageSquare size={24} className="text-neutral-600" />
   291â†’                </div>
   292â†’                <p className="text-neutral-400 text-sm mb-4">No communities available yet.</p>
   293â†’                <Link href="/signup" className="text-cyan-400 text-sm hover:text-cyan-300">
   294â†’                  Be the first to start a discussion â†’
   295â†’                </Link>
   296â†’              </div>
   297â†’            )}
   298â†’          </div>
   299â†’
   300â†’          {/* Sidebar */}
   301â†’          <aside className="lg:w-80 space-y-6">
   302â†’            {/* Your Quota */}
   303â†’            <QuotaIndicator type="posts" />
   304â†’
   305â†’            {/* CTA Card */}
   306â†’            <div className="p-6 rounded-2xl bg-gradient-to-br from-cyan-500/10 to-blue-500/10 border border-cyan-500/20">
   307â†’              <div className="w-10 h-10 rounded-xl bg-cyan-500/20 flex items-center justify-center mb-4">
   308â†’                <Zap size={18} className="text-cyan-400" />
   309â†’              </div>
   310â†’              <h3 className="text-sm font-black uppercase tracking-wider text-white mb-2">Get Matched</h3>
   311â†’              <p className="text-[11px] text-neutral-400 mb-4 leading-relaxed">
   312â†’                AI face analysis to find your best communities based on your unique features.
   313â†’              </p>
   314â†’              <Link
   315â†’                href="/upload"
   316â†’                className="block w-full py-3 bg-cyan-500 text-black text-[10px] font-black uppercase tracking-widest rounded-xl text-center hover:bg-cyan-400 transition-all"
   317â†’              >
   318â†’                Start Free Analysis
   319â†’              </Link>
   320â†’            </div>
   321â†’
   322â†’            {/* Popular Topics */}
   323â†’            <div className="p-6 rounded-2xl bg-neutral-900/30 border border-white/5">
   324â†’              <div className="flex items-center gap-2 mb-6">
   325â†’                <Flame size={14} className="text-orange-400" />
   326â†’                <h3 className="text-[10px] font-black uppercase tracking-[0.2em] text-neutral-500">Popular Topics</h3>
   327â†’              </div>
   328â†’              <div className="space-y-3">
   329â†’                {categories.slice(0, 5).flatMap(c => c.subForums.slice(0, 1).map(sf => ({ ...sf, categorySlug: c.slug }))).slice(0, 5).map((sf, i) => (
   330â†’                  <Link href={`/forum/${sf.categorySlug}?topic=${sf.slug}`} key={sf.id}>
   331â†’                    <div className="flex items-center gap-3 group cursor-pointer">
   332â†’                      <span className="w-5 h-5 rounded-md bg-neutral-900 border border-white/5 flex items-center justify-center text-[10px] text-neutral-600 font-black">
   333â†’                        {i + 1}
   334â†’                      </span>
   335â†’                      <span className="text-xs text-neutral-400 group-hover:text-cyan-400 transition-colors truncate">
   336â†’                        {sf.name}
   337â†’                      </span>
   338â†’                    </div>
   339â†’                  </Link>
   340â†’                ))}
   341â†’              </div>
   342â†’            </div>
   343â†’
   344â†’            {/* Karma Leaderboard */}
   345â†’            <KarmaLeaderboard limit={5} />
   346â†’
   347â†’            {/* Guidelines */}
   348â†’            <div className="p-6 rounded-2xl bg-neutral-900/30 border border-white/5">
   349â†’              <div className="flex items-center gap-2 mb-6">
   350â†’                <ShieldCheck size={14} className="text-cyan-400" />
   351â†’                <h3 className="text-[10px] font-black uppercase tracking-[0.2em] text-neutral-500">Guidelines</h3>
   352â†’              </div>
   353â†’              <ul className="space-y-3 text-xs text-neutral-500">
   354â†’                <li className="flex items-start gap-3">
   355â†’                  <span className="text-cyan-400 font-black">1.</span>
   356â†’                  Be respectful to others
   357â†’                </li>
   358â†’                <li className="flex items-start gap-3">
   359â†’                  <span className="text-cyan-400 font-black">2.</span>
   360â†’                  Share evidence-based info
   361â†’                </li>
   362â†’                <li className="flex items-start gap-3">
   363â†’                  <span className="text-cyan-400 font-black">3.</span>
   364â†’                  Add medical disclaimers
   365â†’                </li>
   366â†’                <li className="flex items-start gap-3">
   367â†’                  <span className="text-cyan-400 font-black">4.</span>
   368â†’                  Respect privacy
   369â†’                </li>
   370â†’              </ul>
   371â†’            </div>
   372â†’          </aside>
   373â†’        </div>
   374â†’      </main>
   375â†’    </div>
   376â†’  );
   377â†’}
   378â†’

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
