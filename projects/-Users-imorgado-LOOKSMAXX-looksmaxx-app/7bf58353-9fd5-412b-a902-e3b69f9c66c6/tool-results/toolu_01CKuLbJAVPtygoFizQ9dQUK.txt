     1→     1→/**
     2→     2→ * API Client for LOOKSMAXX Backend
     3→     3→ *
     4→     4→ * Handles all authenticated requests to the Railway-hosted API
     5→     5→ */
     6→     6→
     7→     7→import type { UserRank, LeaderboardEntry, LeaderboardData, UserProfile } from '@/types/results';
     8→     8→import type {
     9→     9→  Category,
    10→    10→  SubForum,
    11→    11→  Post,
    12→    12→  PostListItem,
    13→    13→  PostListResponse,
    14→    14→  PostCreate,
    15→    15→  PostUpdate,
    16→    16→  Comment,
    17→    17→  CommentCreate,
    18→    18→  VoteType,
    19→    19→  VoteResponse,
    20→    20→  ReportCreate,
    21→    21→  Report,
    22→    22→  GuideSection,
    23→    23→  RecommendedForum,
    24→    24→  SortOrder,
    25→    25→  CategoryListItem,
    26→    26→  PostAuthor,
    27→    27→  ForumSearchResult,
    28→    28→  ForumSearchResponse,
    29→    29→  SearchResultType,
    30→    30→  ForumUserProfile,
    31→    31→  UserPostItem,
    32→    32→  UserPostListResponse,
    33→    33→  UserCommentItem,
    34→    34→  UserCommentListResponse,
    35→    35→  BookmarkToggleResponse,
    36→    36→  BookmarkStatus,
    37→    37→  BookmarkedPostsResponse,
    38→    38→  // Admin/Moderation types
    39→    39→  ReportDetail,
    40→    40→  AdminReportListResponse,
    41→    41→  ResolveReportRequest,
    42→    42→  ModerationStats,
    43→    43→  BanUserRequest,
    44→    44→  BanUserResponse,
    45→    45→  BannedUser,
    46→    46→  BannedUsersResponse,
    47→    47→  ReportStatusEnum,
    48→    48→  ActionTaken,
    49→    49→  TargetType,
    50→    50→  ReportReason,
    51→    51→} from '@/types/forum';
    52→    52→
    53→    53→const API_URL = (process.env.NEXT_PUBLIC_API_URL || 'http://localhost:8000').trim();
    54→    54→
    55→    55→// API Response types (snake_case from backend)
    56→    56→interface LeaderboardApiResponse {
    57→    57→  user_id: string;
    58→    58→  score: number;
    59→    59→  global_rank: number;
    60→    60→  gender_rank: number;
    61→    61→  percentile: number;
    62→    62→  total_users: number;
    63→    63→  gender_total: number;
    64→    64→  anonymous_name: string;
    65→    65→  updated_at: string;
    66→    66→}
    67→    67→
    68→    68→interface LeaderboardEntryResponse {
    69→    69→  user_id: string;
    70→    70→  rank: number;
    71→    71→  score: number;
    72→    72→  anonymous_name: string;
    73→    73→  gender: 'male' | 'female';
    74→    74→  face_photo_url: string | null;
    75→    75→  is_current_user: boolean;
    76→    76→  top_strengths: string[];
    77→    77→  top_improvements: string[];
    78→    78→}
    79→    79→
    80→    80→interface LeaderboardListResponse {
    81→    81→  entries: LeaderboardEntryResponse[];
    82→    82→  total_count: number;
    83→    83→  user_rank: LeaderboardApiResponse | null;
    84→    84→}
    85→    85→
    86→    86→interface UserProfileResponse {
    87→    87→  user_id: string;
    88→    88→  rank: number;
    89→    89→  score: number;
    90→    90→  anonymous_name: string;
    91→    91→  gender: 'male' | 'female';
    92→    92→  face_photo_url: string | null;
    93→    93→  top_strengths: string[];
    94→    94→  top_improvements: string[];
    95→    95→}
    96→    96→
    97→    97→// Transform functions (snake_case -> camelCase)
    98→    98→function transformUserRank(data: LeaderboardApiResponse): UserRank {
    99→    99→  return {
   100→   100→    userId: data.user_id,
   101→   101→    score: data.score,
   102→   102→    globalRank: data.global_rank,
   103→   103→    genderRank: data.gender_rank,
   104→   104→    percentile: data.percentile,
   105→   105→    totalUsers: data.total_users,
   106→   106→    genderTotal: data.gender_total,
   107→   107→    anonymousName: data.anonymous_name,
   108→   108→    updatedAt: data.updated_at,
   109→   109→  };
   110→   110→}
   111→   111→
   112→   112→function transformLeaderboardEntry(data: LeaderboardEntryResponse): LeaderboardEntry {
   113→   113→  return {
   114→   114→    userId: data.user_id,
   115→   115→    rank: data.rank,
   116→   116→    score: data.score,
   117→   117→    anonymousName: data.anonymous_name,
   118→   118→    gender: data.gender,
   119→   119→    facePhotoUrl: data.face_photo_url,
   120→   120→    isCurrentUser: data.is_current_user,
   121→   121→    topStrengths: data.top_strengths || [],
   122→   122→    topImprovements: data.top_improvements || [],
   123→   123→  };
   124→   124→}
   125→   125→
   126→   126→function transformLeaderboardData(data: LeaderboardListResponse): LeaderboardData {
   127→   127→  return {
   128→   128→    entries: data.entries.map(transformLeaderboardEntry),
   129→   129→    totalCount: data.total_count,
   130→   130→    userRank: data.user_rank ? transformUserRank(data.user_rank) : null,
   131→   131→  };
   132→   132→}
   133→   133→
   134→   134→function transformUserProfile(data: UserProfileResponse): UserProfile {
   135→   135→  return {
   136→   136→    userId: data.user_id,
   137→   137→    rank: data.rank,
   138→   138→    score: data.score,
   139→   139→    anonymousName: data.anonymous_name,
   140→   140→    gender: data.gender,
   141→   141→    facePhotoUrl: data.face_photo_url,
   142→   142→    topStrengths: data.top_strengths,
   143→   143→    topImprovements: data.top_improvements,
   144→   144→  };
   145→   145→}
   146→   146→
   147→   147→// === FORUM API RESPONSE TYPES ===
   148→   148→
   149→   149→interface SubForumApiResponse {
   150→   150→  id: string;
   151→   151→  name: string;
   152→   152→  slug: string;
   153→   153→  description: string | null;
   154→   154→  icon: string | null;
   155→   155→  display_order: number;
   156→   156→  post_count: number;
   157→   157→}
   158→   158→
   159→   159→interface CategoryApiResponse {
   160→   160→  id: string;
   161→   161→  name: string;
   162→   162→  slug: string;
   163→   163→  description: string | null;
   164→   164→  icon: string | null;
   165→   165→  display_order: number;
   166→   166→  post_count: number;
   167→   167→  sub_forums: SubForumApiResponse[];
   168→   168→}
   169→   169→
   170→   170→interface CategoryListApiResponse {
   171→   171→  id: string;
   172→   172→  name: string;
   173→   173→  slug: string;
   174→   174→  description: string | null;
   175→   175→  icon: string | null;
   176→   176→  display_order: number;
   177→   177→  post_count: number;
   178→   178→}
   179→   179→
   180→   180→interface PostAuthorApiResponse {
   181→   181→  id: string;
   182→   182→  username: string;
   183→   183→}
   184→   184→
   185→   185→interface PostApiResponse {
   186→   186→  id: string;
   187→   187→  title: string;
   188→   188→  content: string;
   189→   189→  sub_forum_id: string;
   190→   190→  sub_forum_slug: string;
   191→   191→  category_slug: string;
   192→   192→  author: PostAuthorApiResponse;
   193→   193→  is_pinned: boolean;
   194→   194→  is_guide: boolean;
   195→   195→  vote_count: number;
   196→   196→  comment_count: number;
   197→   197→  user_vote: VoteType | null;
   198→   198→  created_at: string;
   199→   199→  updated_at: string;
   200→   200→}
   201→   201→
   202→   202→interface PostListItemApiResponse {
   203→   203→  id: string;
   204→   204→  title: string;
   205→   205→  content_preview: string;
   206→   206→  sub_forum_slug: string;
   207→   207→  category_slug: string;
   208→   208→  author: PostAuthorApiResponse;
   209→   209→  is_pinned: boolean;
   210→   210→  is_guide: boolean;
   211→   211→  vote_count: number;
   212→   212→  comment_count: number;
   213→   213→  user_vote: VoteType | null;
   214→   214→  created_at: string;
   215→   215→}
   216→   216→
   217→   217→interface PostListApiResponse {
   218→   218→  posts: PostListItemApiResponse[];
   219→   219→  total_count: number;
   220→   220→  has_more: boolean;
   221→   221→}
   222→   222→
   223→   223→interface CommentApiResponse {
   224→   224→  id: string;
   225→   225→  content: string;
   226→   226→  post_id: string;
   227→   227→  author: PostAuthorApiResponse;
   228→   228→  parent_id: string | null;
   229→   229→  vote_count: number;
   230→   230→  user_vote: VoteType | null;
   231→   231→  depth: number;
   232→   232→  replies: CommentApiResponse[];
   233→   233→  created_at: string;
   234→   234→  updated_at: string;
   235→   235→}
   236→   236→
   237→   237→interface VoteApiResponse {
   238→   238→  success: boolean;
   239→   239→  new_vote_count: number;
   240→   240→  user_vote: VoteType | null;
   241→   241→}
   242→   242→
   243→   243→interface ReportApiResponse {
   244→   244→  id: string;
   245→   245→  target_type: 'post' | 'comment';
   246→   246→  target_id: string;
   247→   247→  reason: string;
   248→   248→  status: string;
   249→   249→  created_at: string;
   250→   250→}
   251→   251→
   252→   252→interface GuideSectionApiResponse {
   253→   253→  category: CategoryListApiResponse;
   254→   254→  guides: PostListItemApiResponse[];
   255→   255→}
   256→   256→
   257→   257→interface RecommendedForumApiResponse {
   258→   258→  category: CategoryListApiResponse;
   259→   259→  matched_flaws: string[];
   260→   260→  priority: number;
   261→   261→}
   262→   262→
   263→   263→interface ArchetypeForumRecommendationApiResponse {
   264→   264→  category: CategoryListApiResponse;
   265→   265→  archetype: string;
   266→   266→  reason: string | null;
   267→   267→  priority: number;
   268→   268→}
   269→   269→
   270→   270→interface ForumSearchResultApiResponse {
   271→   271→  id: string;
   272→   272→  type: 'post' | 'comment';
   273→   273→  title: string | null;
   274→   274→  content_preview: string;
   275→   275→  post_id: string | null;
   276→   276→  post_title: string | null;
   277→   277→  author: PostAuthorApiResponse;
   278→   278→  vote_count: number;
   279→   279→  category_slug: string;
   280→   280→  sub_forum_slug: string;
   281→   281→  created_at: string;
   282→   282→}
   283→   283→
   284→   284→interface ForumSearchApiResponse {
   285→   285→  results: ForumSearchResultApiResponse[];
   286→   286→  total_count: number;
   287→   287→  query: string;
   288→   288→  search_type: string;
   289→   289→  has_more: boolean;
   290→   290→}
   291→   291→
   292→   292→// === USER PROFILE API RESPONSE TYPES ===
   293→   293→
   294→   294→interface ForumUserProfileApiResponse {
   295→   295→  id: string;
   296→   296→  username: string;
   297→   297→  forum_posts_count: number;
   298→   298→  forum_comments_count: number;
   299→   299→  forum_karma: number;
   300→   300→  member_since: string;
   301→   301→}
   302→   302→
   303→   303→interface UserPostItemApiResponse {
   304→   304→  id: string;
   305→   305→  title: string;
   306→   306→  content_preview: string;
   307→   307→  sub_forum_slug: string;
   308→   308→  category_slug: string;
   309→   309→  is_pinned: boolean;
   310→   310→  is_guide: boolean;
   311→   311→  vote_count: number;
   312→   312→  comment_count: number;
   313→   313→  user_vote: VoteType | null;
   314→   314→  created_at: string;
   315→   315→}
   316→   316→
   317→   317→interface UserPostListApiResponse {
   318→   318→  posts: UserPostItemApiResponse[];
   319→   319→  total_count: number;
   320→   320→  has_more: boolean;
   321→   321→}
   322→   322→
   323→   323→interface UserCommentItemApiResponse {
   324→   324→  id: string;
   325→   325→  content: string;
   326→   326→  post_id: string;
   327→   327→  post_title: string;
   328→   328→  category_slug: string;
   329→   329→  vote_count: number;
   330→   330→  user_vote: VoteType | null;
   331→   331→  created_at: string;
   332→   332→}
   333→   333→
   334→   334→interface UserCommentListApiResponse {
   335→   335→  comments: UserCommentItemApiResponse[];
   336→   336→  total_count: number;
   337→   337→  has_more: boolean;
   338→   338→}
   339→   339→
   340→   340→// === BOOKMARK API RESPONSE TYPES ===
   341→   341→
   342→   342→interface BookmarkToggleApiResponse {
   343→   343→  is_bookmarked: boolean;
   344→   344→  message: string;
   345→   345→}
   346→   346→
   347→   347→interface BookmarkStatusApiResponse {
   348→   348→  post_id: string;
   349→   349→  is_bookmarked: boolean;
   350→   350→  bookmarked_at: string | null;
   351→   351→}
   352→   352→
   353→   353→interface BookmarkedPostsApiResponse {
   354→   354→  posts: PostListItemApiResponse[];
   355→   355→  total_count: number;
   356→   356→  has_more: boolean;
   357→   357→}
   358→   358→
   359→   359→// === FORUM TRANSFORM FUNCTIONS ===
   360→   360→
   361→   361→function transformSubForum(data: SubForumApiResponse): SubForum {
   362→   362→  return {
   363→   363→    id: data.id,
   364→   364→    name: data.name,
   365→   365→    slug: data.slug,
   366→   366→    description: data.description,
   367→   367→    icon: data.icon,
   368→   368→    displayOrder: data.display_order,
   369→   369→    postCount: data.post_count,
   370→   370→  };
   371→   371→}
   372→   372→
   373→   373→function transformCategory(data: CategoryApiResponse): Category {
   374→   374→  return {
   375→   375→    id: data.id,
   376→   376→    name: data.name,
   377→   377→    slug: data.slug,
   378→   378→    description: data.description,
   379→   379→    icon: data.icon,
   380→   380→    displayOrder: data.display_order,
   381→   381→    postCount: data.post_count,
   382→   382→    subForums: data.sub_forums.map(transformSubForum),
   383→   383→  };
   384→   384→}
   385→   385→
   386→   386→function transformCategoryListItem(data: CategoryListApiResponse): CategoryListItem {
   387→   387→  return {
   388→   388→    id: data.id,
   389→   389→    name: data.name,
   390→   390→    slug: data.slug,
   391→   391→    description: data.description,
   392→   392→    icon: data.icon,
   393→   393→    displayOrder: data.display_order,
   394→   394→    postCount: data.post_count,
   395→   395→  };
   396→   396→}
   397→   397→
   398→   398→function transformPostAuthor(data: PostAuthorApiResponse): PostAuthor {
   399→   399→  return {
   400→   400→    id: data.id,
   401→   401→    username: data.username,
   402→   402→  };
   403→   403→}
   404→   404→
   405→   405→function transformPost(data: PostApiResponse): Post {
   406→   406→  return {
   407→   407→    id: data.id,
   408→   408→    title: data.title,
   409→   409→    content: data.content,
   410→   410→    subForumId: data.sub_forum_id,
   411→   411→    subForumSlug: data.sub_forum_slug,
   412→   412→    categorySlug: data.category_slug,
   413→   413→    author: transformPostAuthor(data.author),
   414→   414→    isPinned: data.is_pinned,
   415→   415→    isGuide: data.is_guide,
   416→   416→    voteCount: data.vote_count,
   417→   417→    commentCount: data.comment_count,
   418→   418→    userVote: data.user_vote,
   419→   419→    createdAt: data.created_at,
   420→   420→    updatedAt: data.updated_at,
   421→   421→  };
   422→   422→}
   423→   423→
   424→   424→function transformPostListItem(data: PostListItemApiResponse): PostListItem {
   425→   425→  return {
   426→   426→    id: data.id,
   427→   427→    title: data.title,
   428→   428→    contentPreview: data.content_preview,
   429→   429→    subForumSlug: data.sub_forum_slug,
   430→   430→    categorySlug: data.category_slug,
   431→   431→    author: transformPostAuthor(data.author),
   432→   432→    isPinned: data.is_pinned,
   433→   433→    isGuide: data.is_guide,
   434→   434→    voteCount: data.vote_count,
   435→   435→    commentCount: data.comment_count,
   436→   436→    userVote: data.user_vote,
   437→   437→    createdAt: data.created_at,
   438→   438→  };
   439→   439→}
   440→   440→
   441→   441→function transformPostListResponse(data: PostListApiResponse): PostListResponse {
   442→   442→  return {
   443→   443→    posts: data.posts.map(transformPostListItem),
   444→   444→    totalCount: data.total_count,
   445→   445→    hasMore: data.has_more,
   446→   446→  };
   447→   447→}
   448→   448→
   449→   449→function transformComment(data: CommentApiResponse): Comment {
   450→   450→  return {
   451→   451→    id: data.id,
   452→   452→    content: data.content,
   453→   453→    postId: data.post_id,
   454→   454→    author: transformPostAuthor(data.author),
   455→   455→    parentId: data.parent_id,
   456→   456→    voteCount: data.vote_count,
   457→   457→    userVote: data.user_vote,
   458→   458→    depth: data.depth,
   459→   459→    replies: data.replies.map(transformComment),
   460→   460→    createdAt: data.created_at,
   461→   461→    updatedAt: data.updated_at,
   462→   462→  };
   463→   463→}
   464→   464→
   465→   465→function transformVoteResponse(data: VoteApiResponse): VoteResponse {
   466→   466→  return {
   467→   467→    success: data.success,
   468→   468→    newVoteCount: data.new_vote_count,
   469→   469→    userVote: data.user_vote,
   470→   470→  };
   471→   471→}
   472→   472→
   473→   473→function transformReport(data: ReportApiResponse): Report {
   474→   474→  return {
   475→   475→    id: data.id,
   476→   476→    targetType: data.target_type,
   477→   477→    targetId: data.target_id,
   478→   478→    reason: data.reason as Report['reason'],
   479→   479→    status: data.status,
   480→   480→    createdAt: data.created_at,
   481→   481→  };
   482→   482→}
   483→   483→
   484→   484→function transformGuideSection(data: GuideSectionApiResponse): GuideSection {
   485→   485→  return {
   486→   486→    category: transformCategoryListItem(data.category),
   487→   487→    guides: data.guides.map(transformPostListItem),
   488→   488→  };
   489→   489→}
   490→   490→
   491→   491→function transformRecommendedForum(data: RecommendedForumApiResponse): RecommendedForum {
   492→   492→  return {
   493→   493→    category: transformCategoryListItem(data.category),
   494→   494→    matchedFlaws: data.matched_flaws,
   495→   495→    priority: data.priority,
   496→   496→  };
   497→   497→}
   498→   498→
   499→   499→export interface ArchetypeForumRecommendation {
   500→   500→  category: CategoryListItem;
   501→   501→  archetype: string;
   502→   502→  reason: string | null;
   503→   503→  priority: number;
   504→   504→}
   505→   505→
   506→   506→function transformArchetypeForumRecommendation(data: ArchetypeForumRecommendationApiResponse): ArchetypeForumRecommendation {
   507→   507→  return {
   508→   508→    category: transformCategoryListItem(data.category),
   509→   509→    archetype: data.archetype,
   510→   510→    reason: data.reason,
   511→   511→    priority: data.priority,
   512→   512→  };
   513→   513→}
   514→   514→
   515→   515→function transformForumSearchResult(data: ForumSearchResultApiResponse): ForumSearchResult {
   516→   516→  return {
   517→   517→    id: data.id,
   518→   518→    type: data.type as SearchResultType,
   519→   519→    title: data.title,
   520→   520→    contentPreview: data.content_preview,
   521→   521→    postId: data.post_id,
   522→   522→    postTitle: data.post_title,
   523→   523→    author: transformPostAuthor(data.author),
   524→   524→    voteCount: data.vote_count,
   525→   525→    categorySlug: data.category_slug,
   526→   526→    subForumSlug: data.sub_forum_slug,
   527→   527→    createdAt: data.created_at,
   528→   528→  };
   529→   529→}
   530→   530→
   531→   531→function transformForumSearchResponse(data: ForumSearchApiResponse): ForumSearchResponse {
   532→   532→  return {
   533→   533→    results: data.results.map(transformForumSearchResult),
   534→   534→    totalCount: data.total_count,
   535→   535→    query: data.query,
   536→   536→    searchType: data.search_type,
   537→   537→    hasMore: data.has_more,
   538→   538→  };
   539→   539→}
   540→   540→
   541→   541→// === USER PROFILE TRANSFORM FUNCTIONS ===
   542→   542→
   543→   543→function transformForumUserProfile(data: ForumUserProfileApiResponse): ForumUserProfile {
   544→   544→  return {
   545→   545→    id: data.id,
   546→   546→    username: data.username,
   547→   547→    forumPostsCount: data.forum_posts_count,
   548→   548→    forumCommentsCount: data.forum_comments_count,
   549→   549→    forumKarma: data.forum_karma,
   550→   550→    memberSince: data.member_since,
   551→   551→  };
   552→   552→}
   553→   553→
   554→   554→function transformUserPostItem(data: UserPostItemApiResponse): UserPostItem {
   555→   555→  return {
   556→   556→    id: data.id,
   557→   557→    title: data.title,
   558→   558→    contentPreview: data.content_preview,
   559→   559→    subForumSlug: data.sub_forum_slug,
   560→   560→    categorySlug: data.category_slug,
   561→   561→    isPinned: data.is_pinned,
   562→   562→    isGuide: data.is_guide,
   563→   563→    voteCount: data.vote_count,
   564→   564→    commentCount: data.comment_count,
   565→   565→    userVote: data.user_vote,
   566→   566→    createdAt: data.created_at,
   567→   567→  };
   568→   568→}
   569→   569→
   570→   570→function transformUserPostListResponse(data: UserPostListApiResponse): UserPostListResponse {
   571→   571→  return {
   572→   572→    posts: data.posts.map(transformUserPostItem),
   573→   573→    totalCount: data.total_count,
   574→   574→    hasMore: data.has_more,
   575→   575→  };
   576→   576→}
   577→   577→
   578→   578→function transformUserCommentItem(data: UserCommentItemApiResponse): UserCommentItem {
   579→   579→  return {
   580→   580→    id: data.id,
   581→   581→    content: data.content,
   582→   582→    postId: data.post_id,
   583→   583→    postTitle: data.post_title,
   584→   584→    categorySlug: data.category_slug,
   585→   585→    voteCount: data.vote_count,
   586→   586→    userVote: data.user_vote,
   587→   587→    createdAt: data.created_at,
   588→   588→  };
   589→   589→}
   590→   590→
   591→   591→function transformUserCommentListResponse(data: UserCommentListApiResponse): UserCommentListResponse {
   592→   592→  return {
   593→   593→    comments: data.comments.map(transformUserCommentItem),
   594→   594→    totalCount: data.total_count,
   595→   595→    hasMore: data.has_more,
   596→   596→  };
   597→   597→}
   598→   598→
   599→   599→// === ADMIN/MODERATION API RESPONSE TYPES ===
   600→   600→
   601→   601→interface ReportDetailApiResponse {
   602→   602→  id: string;
   603→   603→  target_type: 'post' | 'comment';
   604→   604→  target_id: string;
   605→   605→  reason: string;
   606→   606→  details: string | null;
   607→   607→  status: string;
   608→   608→  reporter_id: string;
   609→   609→  reporter_username: string;
   610→   610→  reviewed_by: string | null;
   611→   611→  reviewed_at: string | null;
   612→   612→  resolution_notes: string | null;
   613→   613→  action_taken: string | null;
   614→   614→  created_at: string;
   615→   615→  content_preview: string | null;
   616→   616→  content_author_id: string | null;
   617→   617→  content_author_username: string | null;
   618→   618→}
   619→   619→
   620→   620→interface AdminReportListApiResponse {
   621→   621→  reports: ReportDetailApiResponse[];
   622→   622→  total_count: number;
   623→   623→  has_more: boolean;
   624→   624→}
   625→   625→
   626→   626→interface ModerationStatsApiResponse {
   627→   627→  pending_reports: number;
   628→   628→  resolved_today: number;
   629→   629→  resolved_this_week: number;
   630→   630→  total_reports: number;
   631→   631→  reports_by_reason: Record<string, number>;
   632→   632→  reports_by_status: Record<string, number>;
   633→   633→}
   634→   634→
   635→   635→interface BanUserApiResponse {
   636→   636→  user_id: string;
   637→   637→  username: string;
   638→   638→  is_banned: boolean;
   639→   639→  message: string;
   640→   640→}
   641→   641→
   642→   642→interface BannedUserApiResponse {
   643→   643→  id: string;
   644→   644→  username: string;
   645→   645→  email: string;
   646→   646→  is_banned: boolean;
   647→   647→  created_at: string | null;
   648→   648→  updated_at: string | null;
   649→   649→}
   650→   650→
   651→   651→interface BannedUsersApiResponse {
   652→   652→  users: BannedUserApiResponse[];
   653→   653→  total_count: number;
   654→   654→  has_more: boolean;
   655→   655→}
   656→   656→
   657→   657→// === ADMIN/MODERATION TRANSFORM FUNCTIONS ===
   658→   658→
   659→   659→function transformReportDetail(data: ReportDetailApiResponse): ReportDetail {
   660→   660→  return {
   661→   661→    id: data.id,
   662→   662→    targetType: data.target_type as TargetType,
   663→   663→    targetId: data.target_id,
   664→   664→    reason: data.reason as ReportReason,
   665→   665→    details: data.details,
   666→   666→    status: data.status as ReportStatusEnum,
   667→   667→    reporterId: data.reporter_id,
   668→   668→    reporterUsername: data.reporter_username,
   669→   669→    reviewedBy: data.reviewed_by,
   670→   670→    reviewedAt: data.reviewed_at,
   671→   671→    resolutionNotes: data.resolution_notes,
   672→   672→    actionTaken: data.action_taken as ActionTaken | null,
   673→   673→    createdAt: data.created_at,
   674→   674→    contentPreview: data.content_preview,
   675→   675→    contentAuthorId: data.content_author_id,
   676→   676→    contentAuthorUsername: data.content_author_username,
   677→   677→  };
   678→   678→}
   679→   679→
   680→   680→function transformAdminReportListResponse(data: AdminReportListApiResponse): AdminReportListResponse {
   681→   681→  return {
   682→   682→    reports: data.reports.map(transformReportDetail),
   683→   683→    totalCount: data.total_count,
   684→   684→    hasMore: data.has_more,
   685→   685→  };
   686→   686→}
   687→   687→
   688→   688→function transformModerationStats(data: ModerationStatsApiResponse): ModerationStats {
   689→   689→  return {
   690→   690→    pendingReports: data.pending_reports,
   691→   691→    resolvedToday: data.resolved_today,
   692→   692→    resolvedThisWeek: data.resolved_this_week,
   693→   693→    totalReports: data.total_reports,
   694→   694→    reportsByReason: data.reports_by_reason,
   695→   695→    reportsByStatus: data.reports_by_status,
   696→   696→  };
   697→   697→}
   698→   698→
   699→   699→function transformBanUserResponse(data: BanUserApiResponse): BanUserResponse {
   700→   700→  return {
   701→   701→    userId: data.user_id,
   702→   702→    username: data.username,
   703→   703→    isBanned: data.is_banned,
   704→   704→    message: data.message,
   705→   705→  };
   706→   706→}
   707→   707→
   708→   708→function transformBannedUser(data: BannedUserApiResponse): BannedUser {
   709→   709→  return {
   710→   710→    id: data.id,
   711→   711→    username: data.username,
   712→   712→    email: data.email,
   713→   713→    isBanned: data.is_banned,
   714→   714→    createdAt: data.created_at,
   715→   715→    updatedAt: data.updated_at,
   716→   716→  };
   717→   717→}
   718→   718→
   719→   719→function transformBannedUsersResponse(data: BannedUsersApiResponse): BannedUsersResponse {
   720→   720→  return {
   721→   721→    users: data.users.map(transformBannedUser),
   722→   722→    totalCount: data.total_count,
   723→   723→    hasMore: data.has_more,
   724→   724→  };
   725→   725→}
   726→   726→
   727→   727→interface ApiOptions {
   728→   728→  method?: 'GET' | 'POST' | 'PUT' | 'DELETE';
   729→   729→  body?: unknown;
   730→   730→  token?: string;
   731→   731→}
   732→   732→
   733→   733→interface Analysis {
   734→   734→  id: string;
   735→   735→  front_image_url: string | null;
   736→   736→  side_image_url: string | null;
   737→   737→  front_landmarks: Record<string, unknown> | null;
   738→   738→  side_landmarks: Record<string, unknown> | null;
   739→   739→  scores: Record<string, unknown> | null;
   740→   740→  gender: string | null;
   741→   741→  ethnicity: string | null;
   742→   742→  created_at: string;
   743→   743→}
   744→   744→
   745→   745→class ApiClient {
   746→   746→  private token: string | null = null;
   747→   747→
   748→   748→  setToken(token: string | null) {
   749→   749→    this.token = token;
   750→   750→  }
   751→   751→
   752→   752→  getToken(): string | null {
   753→   753→    if (typeof window !== 'undefined') {
   754→   754→      return this.token || localStorage.getItem('auth_token');
   755→   755→    }
   756→   756→    return this.token;
   757→   757→  }
   758→   758→
   759→   759→  private async request<T>(endpoint: string, options: ApiOptions = {}): Promise<T> {
   760→   760→    const { method = 'GET', body, token } = options;
   761→   761→    const authToken = token || this.getToken();
   762→   762→
   763→   763→    const headers: Record<string, string> = {
   764→   764→      'Content-Type': 'application/json',
   765→   765→    };
   766→   766→
   767→   767→    if (authToken) {
   768→   768→      headers['Authorization'] = `Bearer ${authToken}`;
   769→   769→    }
   770→   770→
   771→   771→    try {
   772→   772→      const response = await fetch(`${API_URL}${endpoint}`, {
   773→   773→        method,
   774→   774→        headers,
   775→   775→        body: body ? JSON.stringify(body) : undefined,
   776→   776→      });
   777→   777→
   778→   778→      if (!response.ok) {
   779→   779→        const error = await response.json().catch(() => ({ detail: 'Request failed' }));
   780→   780→        throw new Error(error.detail || `HTTP ${response.status}`);
   781→   781→      }
   782→   782→
   783→   783→      // Handle empty responses (204 No Content)
   784→   784→      if (response.status === 204) {
   785→   785→        return undefined as T;
   786→   786→      }
   787→   787→
   788→   788→      return response.json();
   789→   789→    } catch (err) {
   790→   790→      // Network errors, CORS issues, etc.
   791→   791→      if (err instanceof TypeError && err.message.includes('fetch')) {
   792→   792→        throw new Error('Network error - please check your internet connection');
   793→   793→      }
   794→   794→      throw err;
   795→   795→    }
   796→   796→  }
   797→   797→
   798→   798→  // Health check
   799→   799→  async health(): Promise<{ status: string; detection_ready: boolean }> {
   800→   800→    return this.request('/health');
   801→   801→  }
   802→   802→
   803→   803→  // Analyses CRUD
   804→   804→  async listAnalyses(limit = 50, offset = 0): Promise<Analysis[]> {
   805→   805→    return this.request(`/analyses?limit=${limit}&offset=${offset}`);
   806→   806→  }
   807→   807→
   808→   808→  async createAnalysis(data: {
   809→   809→    front_image_url?: string;
   810→   810→    side_image_url?: string;
   811→   811→    front_landmarks?: Record<string, unknown>;
   812→   812→    side_landmarks?: Record<string, unknown>;
   813→   813→    scores?: Record<string, unknown>;
   814→   814→    gender?: string;
   815→   815→    ethnicity?: string;
   816→   816→  }): Promise<Analysis> {
   817→   817→    return this.request('/analyses', { method: 'POST', body: data });
   818→   818→  }
   819→   819→
   820→   820→  async getAnalysis(id: string): Promise<Analysis> {
   821→   821→    return this.request(`/analyses/${id}`);
   822→   822→  }
   823→   823→
   824→   824→  async deleteAnalysis(id: string): Promise<void> {
   825→   825→    return this.request(`/analyses/${id}`, { method: 'DELETE' });
   826→   826→  }
   827→   827→
   828→   828→  // Payments
   829→   829→  async createCheckout(plan: 'basic' | 'pro'): Promise<{ checkout_url: string; session_id: string }> {
   830→   830→    return this.request(`/payments/checkout?plan=${plan}`, { method: 'POST' });
   831→   831→  }
   832→   832→
   833→   833→  async getPaymentHistory(): Promise<Array<{
   834→   834→    id: string;
   835→   835→    amount: number;
   836→   836→    currency: string;
   837→   837→    status: string;
   838→   838→    created_at: string;
   839→   839→  }>> {
   840→   840→    return this.request('/payments/history');
   841→   841→  }
   842→   842→
   843→   843→  // Leaderboard
   844→   844→  async submitScore(data: {
   845→   845→    score: number;
   846→   846→    analysis_id?: string;
   847→   847→    gender: 'male' | 'female';
   848→   848→    ethnicity?: string;
   849→   849→    face_photo_url?: string;
   850→   850→    top_strengths?: string[];
   851→   851→    top_improvements?: string[];
   852→   852→  }): Promise<UserRank> {
   853→   853→    const response = await this.request<LeaderboardApiResponse>('/leaderboard/score', {
   854→   854→      method: 'POST',
   855→   855→      body: data,
   856→   856→    });
   857→   857→    return transformUserRank(response);
   858→   858→  }
   859→   859→
   860→   860→  async getMyRank(): Promise<UserRank> {
   861→   861→    const response = await this.request<LeaderboardApiResponse>('/leaderboard/rank');
   862→   862→    return transformUserRank(response);
   863→   863→  }
   864→   864→
   865→   865→  async getLeaderboard(options?: {
   866→   866→    gender?: 'male' | 'female';
   867→   867→    limit?: number;
   868→   868→    offset?: number;
   869→   869→  }): Promise<LeaderboardData> {
   870→   870→    const params = new URLSearchParams();
   871→   871→    if (options?.gender) params.set('gender', options.gender);
   872→   872→    if (options?.limit) params.set('limit', String(options.limit));
   873→   873→    if (options?.offset) params.set('offset', String(options.offset));
   874→   874→    const query = params.toString() ? `?${params}` : '';
   875→   875→    const response = await this.request<LeaderboardListResponse>(`/leaderboard${query}`);
   876→   876→    return transformLeaderboardData(response);
   877→   877→  }
   878→   878→
   879→   879→  async getLeaderboardAroundMe(rangeSize?: number): Promise<LeaderboardData> {
   880→   880→    const query = rangeSize ? `?range_size=${rangeSize}` : '';
   881→   881→    const response = await this.request<LeaderboardListResponse>(`/leaderboard/around-me${query}`);
   882→   882→    return transformLeaderboardData(response);
   883→   883→  }
   884→   884→
   885→   885→  async getUserProfile(userId: string): Promise<UserProfile> {
   886→   886→    const response = await this.request<UserProfileResponse>(`/leaderboard/user/${userId}`);
   887→   887→    return transformUserProfile(response);
   888→   888→  }
   889→   889→
   890→   890→  // Auth
   891→   891→  async checkUsername(username: string): Promise<{ available: boolean; reason: string | null }> {
   892→   892→    return this.request(`/auth/check-username/${encodeURIComponent(username)}`);
   893→   893→  }
   894→   894→
   895→   895→  async register(data: {
   896→   896→    email: string;
   897→   897→    password: string;
   898→   898→    username: string;
   899→   899→    termsAccepted: boolean;
   900→   900→    referralCode?: string;
   901→   901→  }): Promise<{ access_token: string; token_type: string; user: { id: string; email: string; username: string; plan: string } }> {
   902→   902→    return this.request('/auth/register', {
   903→   903→      method: 'POST',
   904→   904→      body: {
   905→   905→        email: data.email,
   906→   906→        password: data.password,
   907→   907→        username: data.username,
   908→   908→        terms_accepted: data.termsAccepted,
   909→   909→        referral_code: data.referralCode,
   910→   910→      },
   911→   911→    });
   912→   912→  }
   913→   913→
   914→   914→  async login(data: { email: string; password: string }): Promise<{ access_token: string; token_type: string; user: { id: string; email: string; username: string; plan: string } }> {
   915→   915→    return this.request('/auth/login', {
   916→   916→      method: 'POST',
   917→   917→      body: data,
   918→   918→    });
   919→   919→  }
   920→   920→
   921→   921→  async validateReferralCode(code: string): Promise<{ valid: boolean; message: string | null }> {
   922→   922→    return this.request(`/auth/validate-referral/${encodeURIComponent(code)}`);
   923→   923→  }
   924→   924→
   925→   925→  async requestPasswordReset(email: string): Promise<{ message: string }> {
   926→   926→    return this.request('/auth/forgot-password', {
   927→   927→      method: 'POST',
   928→   928→      body: { email },
   929→   929→    });
   930→   930→  }
   931→   931→
   932→   932→  async resetPassword(token: string, newPassword: string): Promise<{ message: string }> {
   933→   933→    return this.request('/auth/reset-password', {
   934→   934→      method: 'POST',
   935→   935→      body: { token, new_password: newPassword },
   936→   936→    });
   937→   937→  }
   938→   938→
   939→   939→  async verifyEmail(token: string): Promise<{ message: string; email: string }> {
   940→   940→    return this.request(`/auth/verify-email?token=${encodeURIComponent(token)}`);
   941→   941→  }
   942→   942→
   943→   943→  async resendVerification(): Promise<{ message: string }> {
   944→   944→    return this.request('/auth/resend-verification', {
   945→   945→      method: 'POST',
   946→   946→    });
   947→   947→  }
   948→   948→
   949→   949→  // === FORUM ===
   950→   950→
   951→   951→  // Categories
   952→   952→  async getForumCategories(): Promise<Category[]> {
   953→   953→    const response = await this.request<CategoryApiResponse[]>('/forum/categories');
   954→   954→    return response.map(transformCategory);
   955→   955→  }
   956→   956→
   957→   957→  async getForumCategory(slug: string): Promise<Category> {
   958→   958→    const response = await this.request<CategoryApiResponse>(`/forum/categories/${slug}`);
   959→   959→    return transformCategory(response);
   960→   960→  }
   961→   961→
   962→   962→  // Guides
   963→   963→  async getForumGuides(): Promise<GuideSection[]> {
   964→   964→    const response = await this.request<GuideSectionApiResponse[]>('/forum/guides');
   965→   965→    return response.map(transformGuideSection);
   966→   966→  }
   967→   967→
   968→   968→  // Recommended forums based on flaws
   969→   969→  async getRecommendedForums(flaws: string[]): Promise<RecommendedForum[]> {
   970→   970→    const params = new URLSearchParams();
   971→   971→    params.set('flaws', flaws.join(','));
   972→   972→    const response = await this.request<RecommendedForumApiResponse[]>(`/forum/recommended?${params}`);
   973→   973→    return response.map(transformRecommendedForum);
   974→   974→  }
   975→   975→
   976→   976→  // Recommended forums based on archetype
   977→   977→  async getArchetypeForumRecommendations(archetype: string): Promise<ArchetypeForumRecommendation[]> {
   978→   978→    const params = new URLSearchParams();
   979→   979→    params.set('archetype', archetype);
   980→   980→    const response = await this.request<ArchetypeForumRecommendationApiResponse[]>(`/forum/archetype-recommendations?${params}`);
   981→   981→    return response.map(transformArchetypeForumRecommendation);
   982→   982→  }
   983→   983→
   984→   984→  // Posts
   985→   985→  async getForumPosts(
   986→   986→    categorySlug: string,
   987→   987→    options?: {
   988→   988→      subForumSlug?: string;
   989→   989→      sort?: SortOrder;
   990→   990→      limit?: number;
   991→   991→      offset?: number;
   992→   992→    }
   993→   993→  ): Promise<PostListResponse> {
   994→   994→    const params = new URLSearchParams();
   995→   995→    if (options?.sort) params.set('sort', options.sort);
   996→   996→    if (options?.limit) params.set('limit', String(options.limit));
   997→   997→    if (options?.offset) params.set('offset', String(options.offset));
   998→   998→    const query = params.toString() ? `?${params}` : '';
   999→   999→
  1000→  1000→    const endpoint = options?.subForumSlug
  1001→  1001→      ? `/forum/categories/${categorySlug}/${options.subForumSlug}/posts${query}`
  1002→  1002→      : `/forum/categories/${categorySlug}/posts${query}`;
  1003→  1003→
  1004→  1004→    const response = await this.request<PostListApiResponse>(endpoint);
  1005→  1005→    return transformPostListResponse(response);
  1006→  1006→  }
  1007→  1007→
  1008→  1008→  async getForumPost(postId: string): Promise<Post> {
  1009→  1009→    const response = await this.request<PostApiResponse>(`/forum/posts/${postId}`);
  1010→  1010→    return transformPost(response);
  1011→  1011→  }
  1012→  1012→
  1013→  1013→  async createForumPost(data: PostCreate): Promise<Post> {
  1014→  1014→    const response = await this.request<PostApiResponse>('/forum/posts', {
  1015→  1015→      method: 'POST',
  1016→  1016→      body: {
  1017→  1017→        title: data.title,
  1018→  1018→        content: data.content,
  1019→  1019→        sub_forum_id: data.subForumId,
  1020→  1020→      },
  1021→  1021→    });
  1022→  1022→    return transformPost(response);
  1023→  1023→  }
  1024→  1024→
  1025→  1025→  async updateForumPost(postId: string, data: PostUpdate): Promise<Post> {
  1026→  1026→    const response = await this.request<PostApiResponse>(`/forum/posts/${postId}`, {
  1027→  1027→      method: 'PUT',
  1028→  1028→      body: data,
  1029→  1029→    });
  1030→  1030→    return transformPost(response);
  1031→  1031→  }
  1032→  1032→
  1033→  1033→  async deleteForumPost(postId: string): Promise<void> {
  1034→  1034→    await this.request(`/forum/posts/${postId}`, { method: 'DELETE' });
  1035→  1035→  }
  1036→  1036→
  1037→  1037→  // Comments
  1038→  1038→  async getForumComments(postId: string): Promise<Comment[]> {
  1039→  1039→    const response = await this.request<CommentApiResponse[]>(`/forum/posts/${postId}/comments`);
  1040→  1040→    return response.map(transformComment);
  1041→  1041→  }
  1042→  1042→
  1043→  1043→  async createForumComment(postId: string, data: CommentCreate): Promise<Comment> {
  1044→  1044→    const response = await this.request<CommentApiResponse>(`/forum/posts/${postId}/comments`, {
  1045→  1045→      method: 'POST',
  1046→  1046→      body: {
  1047→  1047→        content: data.content,
  1048→  1048→        parent_id: data.parentId,
  1049→  1049→      },
  1050→  1050→    });
  1051→  1051→    return transformComment(response);
  1052→  1052→  }
  1053→  1053→
  1054→  1054→  async updateForumComment(commentId: string, content: string): Promise<Comment> {
  1055→  1055→    const response = await this.request<CommentApiResponse>(`/forum/comments/${commentId}`, {
  1056→  1056→      method: 'PUT',
  1057→  1057→      body: { content },
  1058→  1058→    });
  1059→  1059→    return transformComment(response);
  1060→  1060→  }
  1061→  1061→
  1062→  1062→  async deleteForumComment(commentId: string): Promise<void> {
  1063→  1063→    await this.request(`/forum/comments/${commentId}`, { method: 'DELETE' });
  1064→  1064→  }
  1065→  1065→
  1066→  1066→  // Voting
  1067→  1067→  async voteForumPost(postId: string, voteType: VoteType): Promise<VoteResponse> {
  1068→  1068→    const response = await this.request<VoteApiResponse>(`/forum/posts/${postId}/vote`, {
  1069→  1069→      method: 'POST',
  1070→  1070→      body: { vote_type: voteType },
  1071→  1071→    });
  1072→  1072→    return transformVoteResponse(response);
  1073→  1073→  }
  1074→  1074→
  1075→  1075→  async voteForumComment(commentId: string, voteType: VoteType): Promise<VoteResponse> {
  1076→  1076→    const response = await this.request<VoteApiResponse>(`/forum/comments/${commentId}/vote`, {
  1077→  1077→      method: 'POST',
  1078→  1078→      body: { vote_type: voteType },
  1079→  1079→    });
  1080→  1080→    return transformVoteResponse(response);
  1081→  1081→  }
  1082→  1082→
  1083→  1083→  // Reports
  1084→  1084→  async createForumReport(data: ReportCreate): Promise<Report> {
  1085→  1085→    const response = await this.request<ReportApiResponse>('/forum/reports', {
  1086→  1086→      method: 'POST',
  1087→  1087→      body: {
  1088→  1088→        target_type: data.targetType,
  1089→  1089→        target_id: data.targetId,
  1090→  1090→        reason: data.reason,
  1091→  1091→        details: data.details,
  1092→  1092→      },
  1093→  1093→    });
  1094→  1094→    return transformReport(response);
  1095→  1095→  }
  1096→  1096→
  1097→  1097→  // Search
  1098→  1098→  async searchForum(options: {
  1099→  1099→    query: string;
  1100→  1100→    type?: 'posts' | 'comments' | 'all';
  1101→  1101→    limit?: number;
  1102→  1102→    offset?: number;
  1103→  1103→  }): Promise<ForumSearchResponse> {
  1104→  1104→    const params = new URLSearchParams();
  1105→  1105→    params.set('q', options.query);
  1106→  1106→    if (options.type) params.set('type', options.type);
  1107→  1107→    if (options.limit) params.set('limit', String(options.limit));
  1108→  1108→    if (options.offset) params.set('offset', String(options.offset));
  1109→  1109→    const response = await this.request<ForumSearchApiResponse>(`/forum/search?${params}`);
  1110→  1110→    return transformForumSearchResponse(response);
  1111→  1111→  }
  1112→  1112→
  1113→  1113→  // Bookmarks
  1114→  1114→  async toggleBookmark(postId: string): Promise<BookmarkToggleResponse> {
  1115→  1115→    const response = await this.request<BookmarkToggleApiResponse>(`/forum/posts/${postId}/bookmark`, {
  1116→  1116→      method: 'POST',
  1117→  1117→    });
  1118→  1118→    return {
  1119→  1119→      isBookmarked: response.is_bookmarked,
  1120→  1120→      message: response.message,
  1121→  1121→    };
  1122→  1122→  }
  1123→  1123→
  1124→  1124→  async removeBookmark(postId: string): Promise<BookmarkToggleResponse> {
  1125→  1125→    const response = await this.request<BookmarkToggleApiResponse>(`/forum/posts/${postId}/bookmark`, {
  1126→  1126→      method: 'DELETE',
  1127→  1127→    });
  1128→  1128→    return {
  1129→  1129→      isBookmarked: response.is_bookmarked,
  1130→  1130→      message: response.message,
  1131→  1131→    };
  1132→  1132→  }
  1133→  1133→
  1134→  1134→  async getBookmarkedPosts(options?: {
  1135→  1135→    limit?: number;
  1136→  1136→    offset?: number;
  1137→  1137→  }): Promise<BookmarkedPostsResponse> {
  1138→  1138→    const params = new URLSearchParams();
  1139→  1139→    if (options?.limit) params.set('limit', String(options.limit));
  1140→  1140→    if (options?.offset) params.set('offset', String(options.offset));
  1141→  1141→    const query = params.toString() ? `?${params}` : '';
  1142→  1142→    const response = await this.request<BookmarkedPostsApiResponse>(`/forum/bookmarks${query}`);
  1143→  1143→    return {
  1144→  1144→      posts: response.posts.map(transformPostListItem),
  1145→  1145→      totalCount: response.total_count,
  1146→  1146→      hasMore: response.has_more,
  1147→  1147→    };
  1148→  1148→  }
  1149→  1149→
  1150→  1150→  async getBookmarkStatus(postId: string): Promise<BookmarkStatus> {
  1151→  1151→    const response = await this.request<BookmarkStatusApiResponse>(`/forum/posts/${postId}/bookmark-status`);
  1152→  1152→    return {
  1153→  1153→      postId: response.post_id,
  1154→  1154→      isBookmarked: response.is_bookmarked,
  1155→  1155→      bookmarkedAt: response.bookmarked_at,
  1156→  1156→    };
  1157→  1157→  }
  1158→  1158→
  1159→  1159→  async getBookmarkedPostIds(): Promise<string[]> {
  1160→  1160→    const response = await this.request<{ bookmarked_post_ids: string[] }>('/forum/bookmarks/ids');
  1161→  1161→    return response.bookmarked_post_ids;
  1162→  1162→  }
  1163→  1163→
  1164→  1164→  // === PSL ===
  1165→  1165→
  1166→  1166→  async calculatePSL(data: {
  1167→  1167→    face_score: number;
  1168→  1168→    height_cm: number;
  1169→  1169→    gender: 'male' | 'female';
  1170→  1170→    body_fat_percent?: number;
  1171→  1171→    muscle_level?: string;
  1172→  1172→    failos?: string[];
  1173→  1173→  }): Promise<{
  1174→  1174→    score: number;
  1175→  1175→    tier: string;
  1176→  1176→    percentile: number;
  1177→  1177→    breakdown: {
  1178→  1178→      face: { raw: number; weighted: number };
  1179→  1179→      height: { raw: number; weighted: number };
  1180→  1180→      body: { raw: number; weighted: number };
  1181→  1181→      bonuses: { threshold: number; synergy: number; total: number };
  1182→  1182→      penalties: number;
  1183→  1183→    };
  1184→  1184→    potential: number;
  1185→  1185→  }> {
  1186→  1186→    return this.request('/psl/calculate', { method: 'POST', body: data });
  1187→  1187→  }
  1188→  1188→
  1189→  1189→  async getHeightRating(height_cm: number, gender: 'male' | 'female'): Promise<{
  1190→  1190→    height_cm: number;
  1191→  1191→    height_rating: number;
  1192→  1192→    height_display: string;
  1193→  1193→  }> {
  1194→  1194→    return this.request(`/psl/height-rating?height_cm=${height_cm}&gender=${gender}`);
  1195→  1195→  }
  1196→  1196→
  1197→  1197→  async updateUserHeight(height_cm: number): Promise<{
  1198→  1198→    height_cm: number;
  1199→  1199→    height_rating: number;
  1200→  1200→    height_display: string;
  1201→  1201→  }> {
  1202→  1202→    return this.request('/psl/height', { method: 'PUT', body: { height_cm } });
  1203→  1203→  }
  1204→  1204→
  1205→  1205→  async getMyHeight(): Promise<{
  1206→  1206→    height_cm: number;
  1207→  1207→    height_rating: number;
  1208→  1208→    height_display: string;
  1209→  1209→  } | null> {
  1210→  1210→    return this.request('/psl/my-height');
  1211→  1211→  }
  1212→  1212→
  1213→  1213→  async updateUserWeight(weight_kg: number): Promise<{
  1214→  1214→    weight_kg: number;
  1215→  1215→    weight_display: string;
  1216→  1216→    bmi: number | null;
  1217→  1217→  }> {
  1218→  1218→    return this.request('/psl/weight', { method: 'PUT', body: { weight_kg } });
  1219→  1219→  }
  1220→  1220→
  1221→  1221→  async getMyWeight(): Promise<{
  1222→  1222→    weight_kg: number;
  1223→  1223→    weight_display: string;
  1224→  1224→    bmi: number | null;
  1225→  1225→  } | null> {
  1226→  1226→    return this.request('/psl/my-weight');
  1227→  1227→  }
  1228→  1228→
  1229→  1229→  async getPSLTiers(): Promise<{
  1230→  1230→    tiers: Array<{ name: string; min: number; max: number; percentile: number }>;
  1231→  1231→    weights: { face: number; height: number; body: number };
  1232→  1232→  }> {
  1233→  1233→    return this.request('/psl/tiers');
  1234→  1234→  }
  1235→  1235→
  1236→  1236→  // === ARCHETYPE ===
  1237→  1237→
  1238→  1238→  async classifyArchetype(data: {
  1239→  1239→    gonial_angle?: number;
  1240→  1240→    fwhr?: number;
  1241→  1241→    canthal_tilt?: number;
  1242→  1242→    cheekbone_height?: number;
  1243→  1243→    brow_ridge?: number;
  1244→  1244→    jaw_width_ratio?: number;
  1245→  1245→    gender: 'male' | 'female';
  1246→  1246→    ethnicity: string;
  1247→  1247→  }): Promise<{
  1248→  1248→    primary: {
  1249→  1249→      category: string;
  1250→  1250→      sub_archetype: string;
  1251→  1251→      confidence: number;
  1252→  1252→      traits: string[];
  1253→  1253→    };
  1254→  1254→    secondary: {
  1255→  1255→      category: string;
  1256→  1256→      sub_archetype: string;
  1257→  1257→      confidence: number;
  1258→  1258→      traits: string[];
  1259→  1259→    } | null;
  1260→  1260→    all_scores: Array<{ category: string; score: number; confidence: number }>;
  1261→  1261→    dimorphism_level: string;
  1262→  1262→    style_guide: {
  1263→  1263→      clothing: string[];
  1264→  1264→      hair: string[];
  1265→  1265→      colors: string[];
  1266→  1266→    };
  1267→  1267→    transition_path: {
  1268→  1268→      target: string;
  1269→  1269→      requirements: string[];
  1270→  1270→    } | null;
  1271→  1271→  }> {
  1272→  1272→    return this.request('/archetype/classify', { method: 'POST', body: data });
  1273→  1273→  }
  1274→  1274→
  1275→  1275→  async getArchetypeDefinitions(): Promise<{
  1276→  1276→    archetypes: Array<{
  1277→  1277→      id: string;
  1278→  1278→      name: string;
  1279→  1279→      description: string;
  1280→  1280→      traits: string[];
  1281→  1281→      ideal_metrics: {
  1282→  1282→        gonial_angle: { min: number; max: number };
  1283→  1283→        fwhr: { min: number; max: number };
  1284→  1284→        canthal_tilt: { min: number; max: number };
  1285→  1285→      };
  1286→  1286→    }>;
  1287→  1287→  }> {
  1288→  1288→    return this.request('/archetype/definitions');
  1289→  1289→  }
  1290→  1290→
  1291→  1291→  async getArchetypeDefinition(archetypeId: string): Promise<{
  1292→  1292→    id: string;
  1293→  1293→    name: string;
  1294→  1294→    description: string;
  1295→  1295→    traits: string[];
  1296→  1296→    ideal_metrics: {
  1297→  1297→      gonial_angle: { min: number; max: number };
  1298→  1298→      fwhr: { min: number; max: number };
  1299→  1299→      canthal_tilt: { min: number; max: number };
  1300→  1300→    };
  1301→  1301→  }> {
  1302→  1302→    return this.request(`/archetype/definitions/${archetypeId}`);
  1303→  1303→  }
  1304→  1304→
  1305→  1305→  async getDimorphismInfo(): Promise<{
  1306→  1306→    levels: Record<string, {
  1307→  1307→      gonial_angle_min?: number;
  1308→  1308→      gonial_angle_max?: number;
  1309→  1309→      description: string;
  1310→  1310→    }>;
  1311→  1311→  }> {
  1312→  1312→    return this.request('/archetype/dimorphism');
  1313→  1313→  }
  1314→  1314→
  1315→  1315→  // === PHYSIQUE ===
  1316→  1316→
  1317→  1317→  async uploadPhysiquePhotos(
  1318→  1318→    front?: File,
  1319→  1319→    side?: File,
  1320→  1320→    back?: File
  1321→  1321→  ): Promise<{
  1322→  1322→    front_photo_url: string | null;
  1323→  1323→    side_photo_url: string | null;
  1324→  1324→    back_photo_url: string | null;
  1325→  1325→    created_at: string;
  1326→  1326→    updated_at: string;
  1327→  1327→  }> {
  1328→  1328→    const formData = new FormData();
  1329→  1329→    if (front) formData.append('front', front);
  1330→  1330→    if (side) formData.append('side', side);
  1331→  1331→    if (back) formData.append('back', back);
  1332→  1332→
  1333→  1333→    const authToken = this.getToken();
  1334→  1334→    const headers: Record<string, string> = {};
  1335→  1335→    if (authToken) {
  1336→  1336→      headers['Authorization'] = `Bearer ${authToken}`;
  1337→  1337→    }
  1338→  1338→
  1339→  1339→    const response = await fetch(`${API_URL}/physique/upload`, {
  1340→  1340→      method: 'POST',
  1341→  1341→      headers,
  1342→  1342→      body: formData,
  1343→  1343→    });
  1344→  1344→
  1345→  1345→    if (!response.ok) {
  1346→  1346→      const error = await response.json().catch(() => ({ detail: 'Upload failed' }));
  1347→  1347→      throw new Error(error.detail || `HTTP ${response.status}`);
  1348→  1348→    }
  1349→  1349→
  1350→  1350→    return response.json();
  1351→  1351→  }
  1352→  1352→
  1353→  1353→  async getMyPhysiquePhotos(): Promise<{
  1354→  1354→    front_photo_url: string | null;
  1355→  1355→    side_photo_url: string | null;
  1356→  1356→    back_photo_url: string | null;
  1357→  1357→    created_at: string;
  1358→  1358→    updated_at: string;
  1359→  1359→  } | null> {
  1360→  1360→    return this.request('/physique/my-photos');
  1361→  1361→  }
  1362→  1362→
  1363→  1363→  async analyzePhysique(gender: 'male' | 'female'): Promise<BodyAnalysisResult> {
  1364→  1364→    return this.request('/physique/analyze', {
  1365→  1365→      method: 'POST',
  1366→  1366→      body: { gender },
  1367→  1367→    });
  1368→  1368→  }
  1369→  1369→
  1370→  1370→  async getMyPhysiqueAnalysis(): Promise<{
  1371→  1371→    front_photo_url: string | null;
  1372→  1372→    side_photo_url: string | null;
  1373→  1373→    back_photo_url: string | null;
  1374→  1374→    estimated_body_fat: number | null;
  1375→  1375→    muscle_mass: string | null;
  1376→  1376→    frame_size: string | null;
  1377→  1377→    shoulder_width: string | null;
  1378→  1378→    waist_definition: string | null;
  1379→  1379→    posture: string | null;
  1380→  1380→    analysis_confidence: number | null;
  1381→  1381→    analysis_notes: string | null;
  1382→  1382→    analyzed_at: string | null;
  1383→  1383→  } | null> {
  1384→  1384→    return this.request('/physique/my-analysis');
  1385→  1385→  }
  1386→  1386→
  1387→  1387→  async extractFaceFeatures(frontFaceUrl: string, sideFaceUrl?: string): Promise<FaceExtractionResult> {
  1388→  1388→    return this.request('/physique/extract-face', {
  1389→  1389→      method: 'POST',
  1390→  1390→      body: {
  1391→  1391→        front_face_url: frontFaceUrl,
  1392→  1392→        side_face_url: sideFaceUrl,
  1393→  1393→      },
  1394→  1394→    });
  1395→  1395→  }
  1396→  1396→
  1397→  1397→  async getMyFaceFeatures(): Promise<FaceExtractionResult | null> {
  1398→  1398→    return this.request('/physique/my-face-features');
  1399→  1399→  }
  1400→  1400→
  1401→  1401→  // === REFERRALS ===
  1402→  1402→  async getReferralStats(): Promise<{
  1403→  1403→    code: string;
  1404→  1404→    referral_link: string;
  1405→  1405→    total_invites: number;
  1406→  1406→    earnings: number;
  1407→  1407→    discount_percent: number;
  1408→  1408→  }> {
  1409→  1409→    return this.request('/referrals/my-stats');
  1410→  1410→  }
  1411→  1411→
  1412→  1412→  // === USER PROFILES ===
  1413→  1413→
  1414→  1414→  async getForumUserProfile(userId: string): Promise<ForumUserProfile> {
  1415→  1415→    const response = await this.request<ForumUserProfileApiResponse>(`/users/${userId}/profile`);
  1416→  1416→    return transformForumUserProfile(response);
  1417→  1417→  }
  1418→  1418→
  1419→  1419→  async getUserForumPosts(
  1420→  1420→    userId: string,
  1421→  1421→    options?: { limit?: number; offset?: number }
  1422→  1422→  ): Promise<UserPostListResponse> {
  1423→  1423→    const params = new URLSearchParams();
  1424→  1424→    if (options?.limit) params.set('limit', String(options.limit));
  1425→  1425→    if (options?.offset) params.set('offset', String(options.offset));
  1426→  1426→    const query = params.toString() ? `?${params}` : '';
  1427→  1427→
  1428→  1428→    const response = await this.request<UserPostListApiResponse>(`/users/${userId}/posts${query}`);
  1429→  1429→    return transformUserPostListResponse(response);
  1430→  1430→  }
  1431→  1431→
  1432→  1432→  async getUserForumComments(
  1433→  1433→    userId: string,
  1434→  1434→    options?: { limit?: number; offset?: number }
  1435→  1435→  ): Promise<UserCommentListResponse> {
  1436→  1436→    const params = new URLSearchParams();
  1437→  1437→    if (options?.limit) params.set('limit', String(options.limit));
  1438→  1438→    if (options?.offset) params.set('offset', String(options.offset));
  1439→  1439→    const query = params.toString() ? `?${params}` : '';
  1440→  1440→
  1441→  1441→    const response = await this.request<UserCommentListApiResponse>(`/users/${userId}/comments${query}`);
  1442→  1442→    return transformUserCommentListResponse(response);
  1443→  1443→  }
  1444→  1444→
  1445→  1445→  // === ADMIN/MODERATION ===
  1446→  1446→
  1447→  1447→  async getModerationStats(): Promise<ModerationStats> {
  1448→  1448→    const response = await this.request<ModerationStatsApiResponse>('/admin/moderation/stats');
  1449→  1449→    return transformModerationStats(response);
  1450→  1450→  }
  1451→  1451→
  1452→  1452→  async getAdminReports(options?: {
  1453→  1453→    status?: ReportStatusEnum;
  1454→  1454→    reason?: ReportReason;
  1455→  1455→    targetType?: TargetType;
  1456→  1456→    limit?: number;
  1457→  1457→    offset?: number;
  1458→  1458→  }): Promise<AdminReportListResponse> {
  1459→  1459→    const params = new URLSearchParams();
  1460→  1460→    if (options?.status) params.set('status', options.status);
  1461→  1461→    if (options?.reason) params.set('reason', options.reason);
  1462→  1462→    if (options?.targetType) params.set('target_type', options.targetType);
  1463→  1463→    if (options?.limit) params.set('limit', String(options.limit));
  1464→  1464→    if (options?.offset) params.set('offset', String(options.offset));
  1465→  1465→    const query = params.toString() ? `?${params}` : '';
  1466→  1466→
  1467→  1467→    const response = await this.request<AdminReportListApiResponse>(`/admin/reports${query}`);
  1468→  1468→    return transformAdminReportListResponse(response);
  1469→  1469→  }
  1470→  1470→
  1471→  1471→  async getAdminReport(reportId: string): Promise<ReportDetail> {
  1472→  1472→    const response = await this.request<ReportDetailApiResponse>(`/admin/reports/${reportId}`);
  1473→  1473→    return transformReportDetail(response);
  1474→  1474→  }
  1475→  1475→
  1476→  1476→  async resolveReport(
  1477→  1477→    reportId: string,
  1478→  1478→    data: ResolveReportRequest
  1479→  1479→  ): Promise<{ success: boolean; report_id: string; status: string; action_taken: string | null }> {
  1480→  1480→    return this.request(`/admin/reports/${reportId}/resolve`, {
  1481→  1481→      method: 'PUT',
  1482→  1482→      body: {
  1483→  1483→        status: data.status,
  1484→  1484→        resolution_notes: data.resolutionNotes,
  1485→  1485→        action_taken: data.actionTaken,
  1486→  1486→      },
  1487→  1487→    });
  1488→  1488→  }
  1489→  1489→
  1490→  1490→  async removePost(postId: string): Promise<{ success: boolean; post_id: string; message: string }> {
  1491→  1491→    return this.request(`/admin/posts/${postId}/remove`, { method: 'PUT' });
  1492→  1492→  }
  1493→  1493→
  1494→  1494→  async restorePost(postId: string): Promise<{ success: boolean; post_id: string; message: string }> {
  1495→  1495→    return this.request(`/admin/posts/${postId}/restore`, { method: 'PUT' });
  1496→  1496→  }
  1497→  1497→
  1498→  1498→  async removeComment(commentId: string): Promise<{ success: boolean; comment_id: string; message: string }> {
  1499→  1499→    return this.request(`/admin/comments/${commentId}/remove`, { method: 'PUT' });
  1500→  1500→  }
  1501→  1501→
  1502→  1502→  async restoreComment(commentId: string): Promise<{ success: boolean; comment_id: string; message: string }> {
  1503→  1503→    return this.request(`/admin/comments/${commentId}/restore`, { method: 'PUT' });
  1504→  1504→  }
  1505→  1505→
  1506→  1506→  async banUser(userId: string, data?: BanUserRequest): Promise<BanUserResponse> {
  1507→  1507→    const response = await this.request<BanUserApiResponse>(`/admin/users/${userId}/ban`, {
  1508→  1508→      method: 'PUT',
  1509→  1509→      body: data || {},
  1510→  1510→    });
  1511→  1511→    return transformBanUserResponse(response);
  1512→  1512→  }
  1513→  1513→
  1514→  1514→  async unbanUser(userId: string): Promise<BanUserResponse> {
  1515→  1515→    const response = await this.request<BanUserApiResponse>(`/admin/users/${userId}/unban`, {
  1516→  1516→      method: 'PUT',
  1517→  1517→    });
  1518→  1518→    return transformBanUserResponse(response);
  1519→  1519→  }
  1520→  1520→
  1521→  1521→  async getBannedUsers(options?: {
  1522→  1522→    limit?: number;
  1523→  1523→    offset?: number;
  1524→  1524→  }): Promise<BannedUsersResponse> {
  1525→  1525→    const params = new URLSearchParams();
  1526→  1526→    if (options?.limit) params.set('limit', String(options.limit));
  1527→  1527→    if (options?.offset) params.set('offset', String(options.offset));
  1528→  1528→    const query = params.toString() ? `?${params}` : '';
  1529→  1529→
  1530→  1530→    const response = await this.request<BannedUsersApiResponse>(`/admin/users/banned${query}`);
  1531→  1531→    return transformBannedUsersResponse(response);
  1532→  1532→  }
  1533→  1533→}
  1534→  1534→
  1535→  1535→// === TYPES ===
  1536→  1536→
  1537→  1537→export interface SkinAnalysis {
  1538→  1538→  clarity: number;
  1539→  1539→  tone: string;
  1540→  1540→  acne_level: string;
  1541→  1541→  acne_scarring: string;
  1542→  1542→  pore_visibility: string;
  1543→  1543→  texture_issues: string[];
  1544→  1544→}
  1545→  1545→
  1546→  1546→export interface HairAnalysis {
  1547→  1547→  hairline_nw: number;
  1548→  1548→  density: string;
  1549→  1549→  texture: string;
  1550→  1550→  color: string;
  1551→  1551→}
  1552→  1552→
  1553→  1553→export interface EyesAnalysis {
  1554→  1554→  color: string;
  1555→  1555→  under_eye_darkness: number;
  1556→  1556→  under_eye_puffiness: number;
  1557→  1557→}
  1558→  1558→
  1559→  1559→export interface FacialFeaturesAnalysis {
  1560→  1560→  hollow_cheeks: number;
  1561→  1561→  eyebrow_density: string;
  1562→  1562→  facial_hair_potential: string;
  1563→  1563→}
  1564→  1564→
  1565→  1565→export interface TeethAnalysis {
  1566→  1566→  color: string;
  1567→  1567→  alignment: string;
  1568→  1568→  visible_in_photo: boolean;
  1569→  1569→}
  1570→  1570→
  1571→  1571→export interface FaceExtractionResult {
  1572→  1572→  skin: SkinAnalysis;
  1573→  1573→  hair: HairAnalysis;
  1574→  1574→  eyes: EyesAnalysis;
  1575→  1575→  facial_features: FacialFeaturesAnalysis;
  1576→  1576→  teeth: TeethAnalysis;
  1577→  1577→  confidence: number;
  1578→  1578→}
  1579→  1579→
  1580→  1580→export interface BodyAnalysisResult {
  1581→  1581→  estimated_body_fat: number;
  1582→  1582→  muscle_mass: string;
  1583→  1583→  frame_size: string;
  1584→  1584→  shoulder_width: string;
  1585→  1585→  waist_definition: string;
  1586→  1586→  posture: string;
  1587→  1587→  confidence: number;
  1588→  1588→  notes: string | null;
  1589→  1589→}
  1590→  1590→
  1591→  1591→// Export singleton instance
  1592→  1592→export const api = new ApiClient();
  1593→  1593→
  1594→  1594→// Export types
  1595→  1595→export type { Analysis };
  1596→  1596→
  1597→
  1598→<system-reminder>
  1599→Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
  1600→</system-reminder>
  1601→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
