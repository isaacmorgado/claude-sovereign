     1→'use client';
     2→
     3→import { useEffect, useState, useCallback } from 'react';
     4→import { useParams } from 'next/navigation';
     5→import Link from 'next/link';
     6→import { api } from '@/lib/api';
     7→import { ForumUserProfile, UserPostItem, UserCommentItem, VoteType } from '@/types/forum';
     8→import { UserProfileCard } from '@/components/forum/UserProfileCard';
     9→import { ForumHeader, ForumBreadcrumb, VoteButtons } from '@/components/forum';
    10→import { formatDistanceToNow } from '@/lib/utils';
    11→import { MessageSquare, FileText, User, Pin, Sparkles, ArrowUpRight } from 'lucide-react';
    12→
    13→// ============================================
    14→// SKELETON COMPONENTS
    15→// ============================================
    16→
    17→function ProfileSkeleton() {
    18→  return (
    19→    <div className="rounded-2xl bg-neutral-900/30 border border-white/5 overflow-hidden animate-pulse">
    20→      <div className="h-24 bg-neutral-800" />
    21→      <div className="px-6 pt-12 pb-6">
    22→        <div className="h-7 w-40 bg-neutral-800 rounded mb-2" />
    23→        <div className="h-4 w-32 bg-neutral-800 rounded mb-6" />
    24→        <div className="grid grid-cols-3 gap-4">
    25→          {[1, 2, 3].map((i) => (
    26→            <div key={i} className="h-24 bg-neutral-800 rounded-xl" />
    27→          ))}
    28→        </div>
    29→      </div>
    30→    </div>
    31→  );
    32→}
    33→
    34→function PostItemSkeleton() {
    35→  return (
    36→    <div className="p-4 rounded-xl bg-neutral-900/30 border border-white/5 animate-pulse">
    37→      <div className="flex gap-4">
    38→        <div className="w-10 space-y-2">
    39→          <div className="h-5 w-5 bg-neutral-800 rounded mx-auto" />
    40→          <div className="h-4 w-4 bg-neutral-800 rounded mx-auto" />
    41→        </div>
    42→        <div className="flex-1 space-y-2">
    43→          <div className="h-5 w-3/4 bg-neutral-800 rounded" />
    44→          <div className="h-4 w-full bg-neutral-800 rounded" />
    45→          <div className="h-3 w-32 bg-neutral-800 rounded" />
    46→        </div>
    47→      </div>
    48→    </div>
    49→  );
    50→}
    51→
    52→function CommentItemSkeleton() {
    53→  return (
    54→    <div className="p-4 rounded-xl bg-neutral-900/30 border border-white/5 animate-pulse">
    55→      <div className="flex gap-4">
    56→        <div className="w-10 space-y-2">
    57→          <div className="h-5 w-5 bg-neutral-800 rounded mx-auto" />
    58→          <div className="h-4 w-4 bg-neutral-800 rounded mx-auto" />
    59→        </div>
    60→        <div className="flex-1 space-y-2">
    61→          <div className="h-4 w-48 bg-neutral-800 rounded" />
    62→          <div className="h-4 w-full bg-neutral-800 rounded" />
    63→          <div className="h-3 w-24 bg-neutral-800 rounded" />
    64→        </div>
    65→      </div>
    66→    </div>
    67→  );
    68→}
    69→
    70→// ============================================
    71→// POST ITEM COMPONENT
    72→// ============================================
    73→
    74→interface UserPostCardProps {
    75→  post: UserPostItem;
    76→  onVote?: (postId: string, voteType: VoteType) => void;
    77→}
    78→
    79→function UserPostCard({ post, onVote }: UserPostCardProps) {
    80→  return (
    81→    <article className="group relative rounded-xl bg-neutral-900/30 border border-white/5 hover:border-cyan-500/20 transition-all overflow-hidden">
    82→      <div className="flex">
    83→        {/* Vote column */}
    84→        <div className="w-12 bg-neutral-900/50 border-r border-white/5 flex flex-col items-center py-4">
    85→          <VoteButtons
    86→            voteCount={post.voteCount}
    87→            userVote={post.userVote}
    88→            onVote={(voteType) => onVote?.(post.id, voteType)}
    89→            size="sm"
    90→          />
    91→        </div>
    92→
    93→        {/* Content */}
    94→        <div className="flex-1 p-4 min-w-0">
    95→          {/* Meta line */}
    96→          <div className="flex items-center flex-wrap gap-2 mb-2">
    97→            {post.isPinned && (
    98→              <span className="flex items-center gap-1 px-2 py-0.5 rounded-md bg-cyan-500/10 border border-cyan-500/20 text-[9px] font-black uppercase tracking-wider text-cyan-400">
    99→                <Pin size={10} />
   100→                Pinned
   101→              </span>
   102→            )}
   103→            {post.isGuide && (
   104→              <span className="flex items-center gap-1 px-2 py-0.5 rounded-md bg-green-500/10 border border-green-500/20 text-[9px] font-black uppercase tracking-wider text-green-400">
   105→                <Sparkles size={10} />
   106→                Guide
   107→              </span>
   108→            )}
   109→            <Link
   110→              href={`/forum/${post.categorySlug}`}
   111→              className="text-[10px] font-black uppercase tracking-widest text-cyan-400 hover:text-cyan-300"
   112→            >
   113→              {post.subForumSlug}
   114→            </Link>
   115→            <span className="text-[10px] text-neutral-700">|</span>
   116→            <span className="text-[10px] text-neutral-600">{formatDistanceToNow(post.createdAt)}</span>
   117→          </div>
   118→
   119→          {/* Title */}
   120→          <Link href={`/forum/post/${post.id}`}>
   121→            <h3 className="text-base font-bold text-white group-hover:text-cyan-400 transition-colors leading-snug mb-2">
   122→              {post.title}
   123→            </h3>
   124→          </Link>
   125→
   126→          {/* Preview text */}
   127→          {post.contentPreview && (
   128→            <p className="text-neutral-500 text-sm line-clamp-2 mb-3 leading-relaxed">
   129→              {post.contentPreview}
   130→            </p>
   131→          )}
   132→
   133→          {/* Stats */}
   134→          <div className="flex items-center gap-3">
   135→            <span className="flex items-center gap-1.5 text-[10px] font-medium text-neutral-500">
   136→              <MessageSquare size={12} />
   137→              {post.commentCount}
   138→            </span>
   139→          </div>
   140→        </div>
   141→      </div>
   142→    </article>
   143→  );
   144→}
   145→
   146→// ============================================
   147→// COMMENT ITEM COMPONENT
   148→// ============================================
   149→
   150→interface UserCommentCardProps {
   151→  comment: UserCommentItem;
   152→  onVote?: (commentId: string, voteType: VoteType) => void;
   153→}
   154→
   155→function UserCommentCard({ comment, onVote }: UserCommentCardProps) {
   156→  return (
   157→    <article className="group relative rounded-xl bg-neutral-900/30 border border-white/5 hover:border-cyan-500/20 transition-all overflow-hidden">
   158→      <div className="flex">
   159→        {/* Vote column */}
   160→        <div className="w-12 bg-neutral-900/50 border-r border-white/5 flex flex-col items-center py-4">
   161→          <VoteButtons
   162→            voteCount={comment.voteCount}
   163→            userVote={comment.userVote}
   164→            onVote={(voteType) => onVote?.(comment.id, voteType)}
   165→            size="sm"
   166→          />
   167→        </div>
   168→
   169→        {/* Content */}
   170→        <div className="flex-1 p-4 min-w-0">
   171→          {/* Post reference */}
   172→          <Link
   173→            href={`/forum/post/${comment.postId}`}
   174→            className="flex items-center gap-2 text-[10px] font-medium text-neutral-500 hover:text-cyan-400 transition-colors mb-2"
   175→          >
   176→            <ArrowUpRight size={12} />
   177→            <span className="line-clamp-1">{comment.postTitle}</span>
   178→          </Link>
   179→
   180→          {/* Comment content */}
   181→          <p className="text-neutral-300 text-sm leading-relaxed line-clamp-3 mb-3">
   182→            {comment.content}
   183→          </p>
   184→
   185→          {/* Meta */}
   186→          <div className="flex items-center gap-3">
   187→            <span className="text-[10px] text-neutral-600">
   188→              {formatDistanceToNow(comment.createdAt)}
   189→            </span>
   190→          </div>
   191→        </div>
   192→      </div>
   193→    </article>
   194→  );
   195→}
   196→
   197→// ============================================
   198→// MAIN PAGE
   199→// ============================================
   200→
   201→type TabType = 'posts' | 'comments';
   202→
   203→export default function UserProfilePage() {
   204→  const params = useParams();
   205→  const userId = params.userId as string;
   206→
   207→  const [profile, setProfile] = useState<ForumUserProfile | null>(null);
   208→  const [posts, setPosts] = useState<UserPostItem[]>([]);
   209→  const [comments, setComments] = useState<UserCommentItem[]>([]);
   210→  const [activeTab, setActiveTab] = useState<TabType>('posts');
   211→
   212→  const [isLoadingProfile, setIsLoadingProfile] = useState(true);
   213→  const [isLoadingContent, setIsLoadingContent] = useState(false);
   214→  const [hasMorePosts, setHasMorePosts] = useState(true);
   215→  const [hasMoreComments, setHasMoreComments] = useState(true);
   216→  const [error, setError] = useState<string | null>(null);
   217→
   218→  const PAGE_SIZE = 20;
   219→
   220→  // Fetch profile
   221→  useEffect(() => {
   222→    async function fetchProfile() {
   223→      setIsLoadingProfile(true);
   224→      setError(null);
   225→      try {
   226→        const data = await api.getForumUserProfile(userId);
   227→        setProfile(data);
   228→      } catch (err) {
   229→        setError(err instanceof Error ? err.message : 'Failed to load profile');
   230→      } finally {
   231→        setIsLoadingProfile(false);
   232→      }
   233→    }
   234→
   235→    fetchProfile();
   236→  }, [userId]);
   237→
   238→  // Fetch posts
   239→  const fetchPosts = useCallback(async (offset = 0) => {
   240→    setIsLoadingContent(true);
   241→    try {
   242→      const data = await api.getUserForumPosts(userId, { limit: PAGE_SIZE, offset });
   243→      if (offset === 0) {
   244→        setPosts(data.posts);
   245→      } else {
   246→        setPosts((prev) => [...prev, ...data.posts]);
   247→      }
   248→      setHasMorePosts(data.hasMore);
   249→    } catch {
   250→      // Silent fail for content loading
   251→    } finally {
   252→      setIsLoadingContent(false);
   253→    }
   254→  }, [userId]);
   255→
   256→  // Fetch comments
   257→  const fetchComments = useCallback(async (offset = 0) => {
   258→    setIsLoadingContent(true);
   259→    try {
   260→      const data = await api.getUserForumComments(userId, { limit: PAGE_SIZE, offset });
   261→      if (offset === 0) {
   262→        setComments(data.comments);
   263→      } else {
   264→        setComments((prev) => [...prev, ...data.comments]);
   265→      }
   266→      setHasMoreComments(data.hasMore);
   267→    } catch {
   268→      // Silent fail for content loading
   269→    } finally {
   270→      setIsLoadingContent(false);
   271→    }
   272→  }, [userId]);
   273→
   274→  // Fetch content when tab changes or on initial load
   275→  useEffect(() => {
   276→    if (activeTab === 'posts' && posts.length === 0) {
   277→      fetchPosts();
   278→    } else if (activeTab === 'comments' && comments.length === 0) {
   279→      fetchComments();
   280→    }
   281→  }, [activeTab, posts.length, comments.length, fetchPosts, fetchComments]);
   282→
   283→  const handleLoadMore = () => {
   284→    if (activeTab === 'posts' && hasMorePosts) {
   285→      fetchPosts(posts.length);
   286→    } else if (activeTab === 'comments' && hasMoreComments) {
   287→      fetchComments(comments.length);
   288→    }
   289→  };
   290→
   291→  const handleVotePost = async (postId: string, voteType: VoteType) => {
   292→    try {
   293→      const result = await api.voteForumPost(postId, voteType);
   294→      setPosts((prev) =>
   295→        prev.map((p) =>
   296→          p.id === postId
   297→            ? { ...p, voteCount: result.newVoteCount, userVote: result.userVote }
   298→            : p
   299→        )
   300→      );
   301→    } catch {
   302→      // Silent fail
   303→    }
   304→  };
   305→
   306→  const handleVoteComment = async (commentId: string, voteType: VoteType) => {
   307→    try {
   308→      const result = await api.voteForumComment(commentId, voteType);
   309→      setComments((prev) =>
   310→        prev.map((c) =>
   311→          c.id === commentId
   312→            ? { ...c, voteCount: result.newVoteCount, userVote: result.userVote }
   313→            : c
   314→        )
   315→      );
   316→    } catch {
   317→      // Silent fail
   318→    }
   319→  };
   320→
   321→  return (
   322→    <div className="min-h-screen bg-black selection:bg-cyan-500/30">
   323→      <ForumHeader />
   324→      <ForumBreadcrumb
   325→        items={[
   326→          { label: 'Community', href: '/forum' },
   327→          { label: profile?.username || 'User Profile' },
   328→        ]}
   329→      />
   330→
   331→      {/* Content */}
   332→      <div className="max-w-4xl mx-auto px-6 py-10">
   333→        {/* Error */}
   334→        {error && (
   335→          <div className="p-4 rounded-xl bg-red-500/10 border border-red-500/20 mb-6">
   336→            <p className="text-red-400 text-sm">{error}</p>
   337→          </div>
   338→        )}
   339→
   340→        {/* Profile Card */}
   341→        {isLoadingProfile ? (
   342→          <ProfileSkeleton />
   343→        ) : profile ? (
   344→          <UserProfileCard profile={profile} variant="full" />
   345→        ) : !error ? (
   346→          <div className="text-center py-16 rounded-2xl bg-neutral-900/30 border border-white/5">
   347→            <User size={48} className="mx-auto text-neutral-700 mb-4" />
   348→            <h2 className="text-xl font-black text-white mb-3">User not found</h2>
   349→            <p className="text-neutral-400 mb-6">
   350→              This user doesn&apos;t exist or has been banned.
   351→            </p>
   352→            <Link
   353→              href="/forum"
   354→              className="inline-flex items-center gap-2 px-6 py-3 bg-cyan-500 text-black text-[10px] font-black uppercase tracking-widest rounded-xl hover:bg-cyan-400 transition-all"
   355→            >
   356→              Go back to forum
   357→            </Link>
   358→          </div>
   359→        ) : null}
   360→
   361→        {/* Tabs */}
   362→        {profile && (
   363→          <>
   364→            <div className="flex gap-2 mt-8 mb-6">
   365→              <button
   366→                onClick={() => setActiveTab('posts')}
   367→                className={`flex items-center gap-2 px-5 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${
   368→                  activeTab === 'posts'
   369→                    ? 'bg-cyan-500 text-black'
   370→                    : 'bg-neutral-900/30 text-neutral-400 border border-white/5 hover:border-cyan-500/20 hover:text-cyan-400'
   371→                }`}
   372→              >
   373→                <FileText size={14} />
   374→                Posts ({profile.forumPostsCount})
   375→              </button>
   376→              <button
   377→                onClick={() => setActiveTab('comments')}
   378→                className={`flex items-center gap-2 px-5 py-2.5 rounded-xl text-[10px] font-black uppercase tracking-widest transition-all ${
   379→                  activeTab === 'comments'
   380→                    ? 'bg-cyan-500 text-black'
   381→                    : 'bg-neutral-900/30 text-neutral-400 border border-white/5 hover:border-cyan-500/20 hover:text-cyan-400'
   382→                }`}
   383→              >
   384→                <MessageSquare size={14} />
   385→                Comments ({profile.forumCommentsCount})
   386→              </button>
   387→            </div>
   388→
   389→            {/* Content */}
   390→            {activeTab === 'posts' && (
   391→              <div className="space-y-4">
   392→                {isLoadingContent && posts.length === 0 ? (
   393→                  <>
   394→                    {[1, 2, 3].map((i) => (
   395→                      <PostItemSkeleton key={i} />
   396→                    ))}
   397→                  </>
   398→                ) : posts.length > 0 ? (
   399→                  <>
   400→                    {posts.map((post) => (
   401→                      <UserPostCard key={post.id} post={post} onVote={handleVotePost} />
   402→                    ))}
   403→                    {hasMorePosts && (
   404→                      <button
   405→                        onClick={handleLoadMore}
   406→                        disabled={isLoadingContent}
   407→                        className="w-full py-4 rounded-xl bg-neutral-900/30 border border-white/5 text-neutral-400 text-[10px] font-black uppercase tracking-widest hover:border-cyan-500/20 hover:text-cyan-400 transition-all disabled:opacity-50"
   408→                      >
   409→                        {isLoadingContent ? 'Loading...' : 'Load More Posts'}
   410→                      </button>
   411→                    )}
   412→                  </>
   413→                ) : (
   414→                  <div className="text-center py-12 rounded-2xl bg-neutral-900/30 border border-white/5">
   415→                    <FileText size={32} className="mx-auto text-neutral-700 mb-3" />
   416→                    <p className="text-neutral-400">No posts yet</p>
   417→                  </div>
   418→                )}
   419→              </div>
   420→            )}
   421→
   422→            {activeTab === 'comments' && (
   423→              <div className="space-y-4">
   424→                {isLoadingContent && comments.length === 0 ? (
   425→                  <>
   426→                    {[1, 2, 3].map((i) => (
   427→                      <CommentItemSkeleton key={i} />
   428→                    ))}
   429→                  </>
   430→                ) : comments.length > 0 ? (
   431→                  <>
   432→                    {comments.map((comment) => (
   433→                      <UserCommentCard
   434→                        key={comment.id}
   435→                        comment={comment}
   436→                        onVote={handleVoteComment}
   437→                      />
   438→                    ))}
   439→                    {hasMoreComments && (
   440→                      <button
   441→                        onClick={handleLoadMore}
   442→                        disabled={isLoadingContent}
   443→                        className="w-full py-4 rounded-xl bg-neutral-900/30 border border-white/5 text-neutral-400 text-[10px] font-black uppercase tracking-widest hover:border-cyan-500/20 hover:text-cyan-400 transition-all disabled:opacity-50"
   444→                      >
   445→                        {isLoadingContent ? 'Loading...' : 'Load More Comments'}
   446→                      </button>
   447→                    )}
   448→                  </>
   449→                ) : (
   450→                  <div className="text-center py-12 rounded-2xl bg-neutral-900/30 border border-white/5">
   451→                    <MessageSquare size={32} className="mx-auto text-neutral-700 mb-3" />
   452→                    <p className="text-neutral-400">No comments yet</p>
   453→                  </div>
   454→                )}
   455→              </div>
   456→            )}
   457→          </>
   458→        )}
   459→      </div>
   460→    </div>
   461→  );
   462→}
   463→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
