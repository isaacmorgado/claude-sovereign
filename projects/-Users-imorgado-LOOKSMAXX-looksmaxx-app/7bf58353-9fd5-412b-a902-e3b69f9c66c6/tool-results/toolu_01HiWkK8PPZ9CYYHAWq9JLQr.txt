     1→     1→'use client';
     2→     2→
     3→     3→import { useEffect, useState, useCallback, Suspense } from 'react';
     4→     4→import { useSearchParams } from 'next/navigation';
     5→     5→import Link from 'next/link';
     6→     6→import { motion } from 'framer-motion';
     7→     7→import {
     8→     8→  Search,
     9→     9→  MessageSquare,
    10→    10→  FileText,
    11→    11→  ThumbsUp,
    12→    12→  Clock,
    13→    13→  ArrowRight,
    14→    14→  User,
    15→    15→  ChevronLeft,
    16→    16→  ChevronRight,
    17→    17→  AlertCircle,
    18→    18→} from 'lucide-react';
    19→    19→import { ForumHeader, ForumBreadcrumb, SearchBar } from '@/components/forum';
    20→    20→import { api } from '@/lib/api';
    21→    21→import type { ForumSearchResult } from '@/types/forum';
    22→    22→
    23→    23→// ============================================
    24→    24→// SEARCH RESULT CARD
    25→    25→// ============================================
    26→    26→function SearchResultCard({ result, index }: { result: ForumSearchResult; index: number }) {
    27→    27→  const isPost = result.type === 'post';
    28→    28→  const linkUrl = isPost
    29→    29→    ? `/forum/post/${result.id}`
    30→    30→    : `/forum/post/${result.postId}#comment-${result.id}`;
    31→    31→
    32→    32→  // Format date
    33→    33→  const date = new Date(result.createdAt);
    34→    34→  const timeAgo = getTimeAgo(date);
    35→    35→
    36→    36→  return (
    37→    37→    <motion.div
    38→    38→      initial={{ opacity: 0, y: 20 }}
    39→    39→      animate={{ opacity: 1, y: 0 }}
    40→    40→      transition={{ delay: index * 0.05 }}
    41→    41→    >
    42→    42→      <Link href={linkUrl}>
    43→    43→        <div className="group p-6 rounded-2xl bg-neutral-900/30 border border-white/5 hover:border-cyan-500/20 transition-all">
    44→    44→          <div className="flex items-start gap-4">
    45→    45→            {/* Type Icon */}
    46→    46→            <div className={`w-10 h-10 rounded-xl flex items-center justify-center flex-shrink-0 ${
    47→    47→              isPost
    48→    48→                ? 'bg-gradient-to-br from-cyan-500/20 to-blue-500/20 border border-cyan-500/30'
    49→    49→                : 'bg-gradient-to-br from-purple-500/20 to-pink-500/20 border border-purple-500/30'
    50→    50→            }`}>
    51→    51→              {isPost ? (
    52→    52→                <FileText size={16} className="text-cyan-400" />
    53→    53→              ) : (
    54→    54→                <MessageSquare size={16} className="text-purple-400" />
    55→    55→              )}
    56→    56→            </div>
    57→    57→
    58→    58→            {/* Content */}
    59→    59→            <div className="flex-1 min-w-0">
    60→    60→              {/* Type badge + title/post reference */}
    61→    61→              <div className="flex flex-wrap items-center gap-2 mb-2">
    62→    62→                <span className={`px-2 py-0.5 rounded-md text-[9px] font-black uppercase tracking-widest ${
    63→    63→                  isPost
    64→    64→                    ? 'bg-cyan-500/10 text-cyan-400 border border-cyan-500/20'
    65→    65→                    : 'bg-purple-500/10 text-purple-400 border border-purple-500/20'
    66→    66→                }`}>
    67→    67→                  {isPost ? 'Post' : 'Comment'}
    68→    68→                </span>
    69→    69→
    70→    70→                {isPost && result.title && (
    71→    71→                  <h3 className="text-sm font-bold text-white group-hover:text-cyan-400 transition-colors truncate">
    72→    72→                    {result.title}
    73→    73→                  </h3>
    74→    74→                )}
    75→    75→
    76→    76→                {!isPost && result.postTitle && (
    77→    77→                  <span className="text-xs text-neutral-500 truncate">
    78→    78→                    on &quot;{result.postTitle}&quot;
    79→    79→                  </span>
    80→    80→                )}
    81→    81→              </div>
    82→    82→
    83→    83→              {/* Content preview */}
    84→    84→              <p className="text-[12px] text-neutral-400 line-clamp-2 leading-relaxed mb-3">
    85→    85→                {result.contentPreview}
    86→    86→              </p>
    87→    87→
    88→    88→              {/* Meta info */}
    89→    89→              <div className="flex flex-wrap items-center gap-4 text-[10px] text-neutral-500">
    90→    90→                <span className="flex items-center gap-1.5">
    91→    91→                  <User size={12} />
    92→    92→                  {result.author.username}
    93→    93→                </span>
    94→    94→                <span className="flex items-center gap-1.5">
    95→    95→                  <ThumbsUp size={12} />
    96→    96→                  {result.voteCount} votes
    97→    97→                </span>
    98→    98→                <span className="flex items-center gap-1.5">
    99→    99→                  <Clock size={12} />
   100→   100→                  {timeAgo}
   101→   101→                </span>
   102→   102→                {result.categorySlug && (
   103→   103→                  <span className="px-2 py-0.5 rounded-md bg-neutral-800 text-neutral-400 uppercase tracking-wider font-bold">
   104→   104→                    {result.categorySlug.replace(/-/g, ' ')}
   105→   105→                  </span>
   106→   106→                )}
   107→   107→              </div>
   108→   108→            </div>
   109→   109→
   110→   110→            {/* Arrow */}
   111→   111→            <div className="flex-shrink-0 w-8 h-8 rounded-lg bg-neutral-800/50 flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity">
   112→   112→              <ArrowRight size={14} className="text-cyan-400" />
   113→   113→            </div>
   114→   114→          </div>
   115→   115→        </div>
   116→   116→      </Link>
   117→   117→    </motion.div>
   118→   118→  );
   119→   119→}
   120→   120→
   121→   121→// ============================================
   122→   122→// LOADING SKELETON
   123→   123→// ============================================
   124→   124→function SearchResultSkeleton() {
   125→   125→  return (
   126→   126→    <div className="p-6 rounded-2xl bg-neutral-900/30 border border-white/5 animate-pulse">
   127→   127→      <div className="flex items-start gap-4">
   128→   128→        <div className="w-10 h-10 rounded-xl bg-neutral-800" />
   129→   129→        <div className="flex-1 space-y-3">
   130→   130→          <div className="flex items-center gap-2">
   131→   131→            <div className="h-5 w-16 bg-neutral-800 rounded" />
   132→   132→            <div className="h-4 w-48 bg-neutral-800 rounded" />
   133→   133→          </div>
   134→   134→          <div className="h-3 w-full bg-neutral-800 rounded" />
   135→   135→          <div className="h-3 w-2/3 bg-neutral-800 rounded" />
   136→   136→          <div className="flex gap-4">
   137→   137→            <div className="h-3 w-20 bg-neutral-800 rounded" />
   138→   138→            <div className="h-3 w-16 bg-neutral-800 rounded" />
   139→   139→            <div className="h-3 w-24 bg-neutral-800 rounded" />
   140→   140→          </div>
   141→   141→        </div>
   142→   142→      </div>
   143→   143→    </div>
   144→   144→  );
   145→   145→}
   146→   146→
   147→   147→// ============================================
   148→   148→// PAGINATION
   149→   149→// ============================================
   150→   150→function Pagination({
   151→   151→  currentPage,
   152→   152→  totalPages,
   153→   153→  onPageChange,
   154→   154→}: {
   155→   155→  currentPage: number;
   156→   156→  totalPages: number;
   157→   157→  onPageChange: (page: number) => void;
   158→   158→}) {
   159→   159→  if (totalPages <= 1) return null;
   160→   160→
   161→   161→  return (
   162→   162→    <div className="flex items-center justify-center gap-2 mt-8">
   163→   163→      <button
   164→   164→        onClick={() => onPageChange(currentPage - 1)}
   165→   165→        disabled={currentPage === 1}
   166→   166→        className="h-10 px-4 rounded-xl bg-neutral-900/50 border border-white/10 text-neutral-400
   167→   167→                   hover:text-white hover:border-white/20 disabled:opacity-50 disabled:cursor-not-allowed
   168→   168→                   flex items-center gap-2 text-[10px] font-black uppercase tracking-widest transition-all"
   169→   169→      >
   170→   170→        <ChevronLeft size={14} />
   171→   171→        Prev
   172→   172→      </button>
   173→   173→
   174→   174→      <span className="px-4 text-sm text-neutral-500">
   175→   175→        Page <span className="text-white font-bold">{currentPage}</span> of{' '}
   176→   176→        <span className="text-white font-bold">{totalPages}</span>
   177→   177→      </span>
   178→   178→
   179→   179→      <button
   180→   180→        onClick={() => onPageChange(currentPage + 1)}
   181→   181→        disabled={currentPage === totalPages}
   182→   182→        className="h-10 px-4 rounded-xl bg-neutral-900/50 border border-white/10 text-neutral-400
   183→   183→                   hover:text-white hover:border-white/20 disabled:opacity-50 disabled:cursor-not-allowed
   184→   184→                   flex items-center gap-2 text-[10px] font-black uppercase tracking-widest transition-all"
   185→   185→      >
   186→   186→        Next
   187→   187→        <ChevronRight size={14} />
   188→   188→      </button>
   189→   189→    </div>
   190→   190→  );
   191→   191→}
   192→   192→
   193→   193→// ============================================
   194→   194→// EMPTY STATE
   195→   195→// ============================================
   196→   196→function EmptyState({ query }: { query: string }) {
   197→   197→  return (
   198→   198→    <div className="text-center py-16 rounded-2xl bg-neutral-900/30 border border-white/5">
   199→   199→      <div className="w-14 h-14 rounded-2xl bg-neutral-900/50 flex items-center justify-center mx-auto mb-4">
   200→   200→        <Search size={24} className="text-neutral-600" />
   201→   201→      </div>
   202→   202→      <h3 className="text-lg font-bold text-white mb-2">No results found</h3>
   203→   203→      <p className="text-neutral-500 text-sm mb-4 max-w-md mx-auto">
   204→   204→        We couldn&apos;t find any posts or comments matching &quot;{query}&quot;.
   205→   205→        Try different keywords or check your spelling.
   206→   206→      </p>
   207→   207→      <Link
   208→   208→        href="/forum"
   209→   209→        className="inline-flex items-center gap-2 text-cyan-400 text-sm hover:text-cyan-300 transition-colors"
   210→   210→      >
   211→   211→        <ArrowRight size={14} className="rotate-180" />
   212→   212→        Browse all communities
   213→   213→      </Link>
   214→   214→    </div>
   215→   215→  );
   216→   216→}
   217→   217→
   218→   218→// ============================================
   219→   219→// SEARCH CONTENT COMPONENT
   220→   220→// ============================================
   221→   221→function SearchContent() {
   222→   222→  const searchParams = useSearchParams();
   223→   223→  const [results, setResults] = useState<ForumSearchResult[]>([]);
   224→   224→  const [totalCount, setTotalCount] = useState(0);
   225→   225→  const [isLoading, setIsLoading] = useState(false);
   226→   226→  const [error, setError] = useState<string | null>(null);
   227→   227→  const [currentPage, setCurrentPage] = useState(1);
   228→   228→
   229→   229→  const query = searchParams.get('q') || '';
   230→   230→  const type = (searchParams.get('type') || 'all') as 'posts' | 'comments' | 'all';
   231→   231→  const PAGE_SIZE = 20;
   232→   232→
   233→   233→  const totalPages = Math.ceil(totalCount / PAGE_SIZE);
   234→   234→
   235→   235→  // Perform search
   236→   236→  const performSearch = useCallback(async (searchQuery: string, searchType: 'posts' | 'comments' | 'all', page: number) => {
   237→   237→    if (!searchQuery || searchQuery.length < 2) {
   238→   238→      setResults([]);
   239→   239→      setTotalCount(0);
   240→   240→      return;
   241→   241→    }
   242→   242→
   243→   243→    setIsLoading(true);
   244→   244→    setError(null);
   245→   245→
   246→   246→    try {
   247→   247→      const response = await api.searchForum({
   248→   248→        query: searchQuery,
   249→   249→        type: searchType,
   250→   250→        limit: PAGE_SIZE,
   251→   251→        offset: (page - 1) * PAGE_SIZE,
   252→   252→      });
   253→   253→      setResults(response.results);
   254→   254→      setTotalCount(response.totalCount);
   255→   255→    } catch (err) {
   256→   256→      console.error('Search error:', err);
   257→   257→      setError(err instanceof Error ? err.message : 'Search failed. Please try again.');
   258→   258→      setResults([]);
   259→   259→      setTotalCount(0);
   260→   260→    } finally {
   261→   261→      setIsLoading(false);
   262→   262→    }
   263→   263→  }, []);
   264→   264→
   265→   265→  // Search when params change
   266→   266→  useEffect(() => {
   267→   267→    setCurrentPage(1);
   268→   268→    performSearch(query, type, 1);
   269→   269→  }, [query, type, performSearch]);
   270→   270→
   271→   271→  // Handle page change
   272→   272→  const handlePageChange = (page: number) => {
   273→   273→    setCurrentPage(page);
   274→   274→    performSearch(query, type, page);
   275→   275→    window.scrollTo({ top: 0, behavior: 'smooth' });
   276→   276→  };
   277→   277→
   278→   278→  // Handle new search from SearchBar
   279→   279→  const handleSearch = (newQuery: string, newType: 'posts' | 'comments' | 'all') => {
   280→   280→    const params = new URLSearchParams();
   281→   281→    params.set('q', newQuery);
   282→   282→    if (newType !== 'all') params.set('type', newType);
   283→   283→    window.history.pushState({}, '', `/forum/search?${params.toString()}`);
   284→   284→    setCurrentPage(1);
   285→   285→    performSearch(newQuery, newType, 1);
   286→   286→  };
   287→   287→
   288→   288→  return (
   289→   289→    <>
   290→   290→      {/* Search Header */}
   291→   291→      <section className="border-b border-white/5">
   292→   292→        <div className="max-w-4xl mx-auto px-6 py-8">
   293→   293→          <h1 className="text-3xl md:text-4xl font-black tracking-tighter italic uppercase mb-6">
   294→   294→            Search <span className="text-cyan-400">Results</span>
   295→   295→          </h1>
   296→   296→
   297→   297→          <SearchBar
   298→   298→            initialQuery={query}
   299→   299→            initialType={type}
   300→   300→            onSearch={handleSearch}
   301→   301→            placeholder="Search posts and comments..."
   302→   302→          />
   303→   303→
   304→   304→          {query && !isLoading && (
   305→   305→            <p className="mt-4 text-sm text-neutral-500">
   306→   306→              {totalCount > 0 ? (
   307→   307→                <>Found <span className="text-white font-bold">{totalCount}</span> result{totalCount !== 1 ? 's' : ''} for &quot;{query}&quot;</>
   308→   308→              ) : (
   309→   309→                <>Searching for &quot;{query}&quot;...</>
   310→   310→              )}
   311→   311→            </p>
   312→   312→          )}
   313→   313→        </div>
   314→   314→      </section>
   315→   315→
   316→   316→      {/* Results */}
   317→   317→      <main className="max-w-4xl mx-auto px-6 py-8">
   318→   318→        {/* Error State */}
   319→   319→        {error && (
   320→   320→          <div className="p-4 rounded-xl bg-red-500/10 border border-red-500/20 mb-6 flex items-center gap-3">
   321→   321→            <AlertCircle size={18} className="text-red-400" />
   322→   322→            <p className="text-red-400 text-sm">{error}</p>
   323→   323→          </div>
   324→   324→        )}
   325→   325→
   326→   326→        {/* Loading State */}
   327→   327→        {isLoading && (
   328→   328→          <div className="space-y-4">
   329→   329→            {[1, 2, 3, 4, 5].map((i) => (
   330→   330→              <SearchResultSkeleton key={i} />
   331→   331→            ))}
   332→   332→          </div>
   333→   333→        )}
   334→   334→
   335→   335→        {/* Results List */}
   336→   336→        {!isLoading && results.length > 0 && (
   337→   337→          <>
   338→   338→            <div className="space-y-4">
   339→   339→              {results.map((result, index) => (
   340→   340→                <SearchResultCard key={`${result.type}-${result.id}`} result={result} index={index} />
   341→   341→              ))}
   342→   342→            </div>
   343→   343→
   344→   344→            <Pagination
   345→   345→              currentPage={currentPage}
   346→   346→              totalPages={totalPages}
   347→   347→              onPageChange={handlePageChange}
   348→   348→            />
   349→   349→          </>
   350→   350→        )}
   351→   351→
   352→   352→        {/* Empty State */}
   353→   353→        {!isLoading && !error && query && results.length === 0 && (
   354→   354→          <EmptyState query={query} />
   355→   355→        )}
   356→   356→
   357→   357→        {/* No Query State */}
   358→   358→        {!isLoading && !query && (
   359→   359→          <div className="text-center py-16 rounded-2xl bg-neutral-900/30 border border-white/5">
   360→   360→            <div className="w-14 h-14 rounded-2xl bg-neutral-900/50 flex items-center justify-center mx-auto mb-4">
   361→   361→              <Search size={24} className="text-neutral-600" />
   362→   362→            </div>
   363→   363→            <h3 className="text-lg font-bold text-white mb-2">Search the forum</h3>
   364→   364→            <p className="text-neutral-500 text-sm max-w-md mx-auto">
   365→   365→              Enter a search term above to find posts and comments across all communities.
   366→   366→            </p>
   367→   367→          </div>
   368→   368→        )}
   369→   369→      </main>
   370→   370→    </>
   371→   371→  );
   372→   372→}
   373→   373→
   374→   374→// ============================================
   375→   375→// MAIN PAGE
   376→   376→// ============================================
   377→   377→export default function ForumSearchPage() {
   378→   378→  return (
   379→   379→    <div className="min-h-screen bg-black selection:bg-cyan-500/30">
   380→   380→      <ForumHeader />
   381→   381→      <ForumBreadcrumb
   382→   382→        items={[
   383→   383→          { label: 'Forum', href: '/forum' },
   384→   384→          { label: 'Search' },
   385→   385→        ]}
   386→   386→      />
   387→   387→      <Suspense fallback={
   388→   388→        <div className="max-w-4xl mx-auto px-6 py-8">
   389→   389→          <div className="space-y-4">
   390→   390→            {[1, 2, 3, 4, 5].map((i) => (
   391→   391→              <SearchResultSkeleton key={i} />
   392→   392→            ))}
   393→   393→          </div>
   394→   394→        </div>
   395→   395→      }>
   396→   396→        <SearchContent />
   397→   397→      </Suspense>
   398→   398→    </div>
   399→   399→  );
   400→   400→}
   401→   401→
   402→   402→// ============================================
   403→   403→// HELPER FUNCTIONS
   404→   404→// ============================================
   405→   405→function getTimeAgo(date: Date): string {
   406→   406→  const now = new Date();
   407→   407→  const seconds = Math.floor((now.getTime() - date.getTime()) / 1000);
   408→   408→
   409→   409→  if (seconds < 60) return 'just now';
   410→   410→  if (seconds < 3600) return `${Math.floor(seconds / 60)}m ago`;
   411→   411→  if (seconds < 86400) return `${Math.floor(seconds / 3600)}h ago`;
   412→   412→  if (seconds < 604800) return `${Math.floor(seconds / 86400)}d ago`;
   413→   413→  if (seconds < 2592000) return `${Math.floor(seconds / 604800)}w ago`;
   414→   414→  if (seconds < 31536000) return `${Math.floor(seconds / 2592000)}mo ago`;
   415→   415→  return `${Math.floor(seconds / 31536000)}y ago`;
   416→   416→}
   417→   417→
   418→
   419→<system-reminder>
   420→Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
   421→</system-reminder>
   422→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
