     1→     1→'use client';
     2→     2→
     3→     3→import { useState, useCallback, useEffect, useRef } from 'react';
     4→     4→import { useRouter } from 'next/navigation';
     5→     5→import { Search, X, Filter, ChevronDown } from 'lucide-react';
     6→     6→import { motion, AnimatePresence } from 'framer-motion';
     7→     7→
     8→     8→interface SearchBarProps {
     9→     9→  initialQuery?: string;
    10→    10→  initialType?: 'posts' | 'comments' | 'all';
    11→    11→  onSearch?: (query: string, type: 'posts' | 'comments' | 'all') => void;
    12→    12→  showFilters?: boolean;
    13→    13→  placeholder?: string;
    14→    14→  className?: string;
    15→    15→  autoFocus?: boolean;
    16→    16→}
    17→    17→
    18→    18→export function SearchBar({
    19→    19→  initialQuery = '',
    20→    20→  initialType = 'all',
    21→    21→  onSearch,
    22→    22→  showFilters = true,
    23→    23→  placeholder = 'Search posts and comments...',
    24→    24→  className = '',
    25→    25→  autoFocus = false,
    26→    26→}: SearchBarProps) {
    27→    27→  const router = useRouter();
    28→    28→  const [query, setQuery] = useState(initialQuery);
    29→    29→  const [searchType, setSearchType] = useState<'posts' | 'comments' | 'all'>(initialType);
    30→    30→  const [showFilterDropdown, setShowFilterDropdown] = useState(false);
    31→    31→  const inputRef = useRef<HTMLInputElement>(null);
    32→    32→  const dropdownRef = useRef<HTMLDivElement>(null);
    33→    33→  const debounceTimerRef = useRef<NodeJS.Timeout | null>(null);
    34→    34→
    35→    35→  // Close dropdown when clicking outside
    36→    36→  useEffect(() => {
    37→    37→    function handleClickOutside(event: MouseEvent) {
    38→    38→      if (dropdownRef.current && !dropdownRef.current.contains(event.target as Node)) {
    39→    39→        setShowFilterDropdown(false);
    40→    40→      }
    41→    41→    }
    42→    42→    document.addEventListener('mousedown', handleClickOutside);
    43→    43→    return () => document.removeEventListener('mousedown', handleClickOutside);
    44→    44→  }, []);
    45→    45→
    46→    46→  // Handle search with debounce
    47→    47→  const handleSearch = useCallback(() => {
    48→    48→    if (query.trim().length < 2) return;
    49→    49→
    50→    50→    if (onSearch) {
    51→    51→      onSearch(query.trim(), searchType);
    52→    52→    } else {
    53→    53→      // Navigate to search results page
    54→    54→      const params = new URLSearchParams();
    55→    55→      params.set('q', query.trim());
    56→    56→      if (searchType !== 'all') params.set('type', searchType);
    57→    57→      router.push(`/forum/search?${params.toString()}`);
    58→    58→    }
    59→    59→  }, [query, searchType, onSearch, router]);
    60→    60→
    61→    61→  // Debounced search (300ms)
    62→    62→  const handleInputChange = useCallback((value: string) => {
    63→    63→    setQuery(value);
    64→    64→
    65→    65→    if (debounceTimerRef.current) {
    66→    66→      clearTimeout(debounceTimerRef.current);
    67→    67→    }
    68→    68→
    69→    69→    // Only auto-search if we have an onSearch callback (inline search)
    70→    70→    if (onSearch && value.trim().length >= 2) {
    71→    71→      debounceTimerRef.current = setTimeout(() => {
    72→    72→        onSearch(value.trim(), searchType);
    73→    73→      }, 300);
    74→    74→    }
    75→    75→  }, [onSearch, searchType]);
    76→    76→
    77→    77→  // Handle Enter key
    78→    78→  const handleKeyDown = (e: React.KeyboardEvent) => {
    79→    79→    if (e.key === 'Enter') {
    80→    80→      e.preventDefault();
    81→    81→      if (debounceTimerRef.current) {
    82→    82→        clearTimeout(debounceTimerRef.current);
    83→    83→      }
    84→    84→      handleSearch();
    85→    85→    }
    86→    86→  };
    87→    87→
    88→    88→  // Clear search
    89→    89→  const handleClear = () => {
    90→    90→    setQuery('');
    91→    91→    inputRef.current?.focus();
    92→    92→  };
    93→    93→
    94→    94→  const filterOptions = [
    95→    95→    { value: 'all', label: 'All' },
    96→    96→    { value: 'posts', label: 'Posts' },
    97→    97→    { value: 'comments', label: 'Comments' },
    98→    98→  ] as const;
    99→    99→
   100→   100→  const selectedFilter = filterOptions.find(f => f.value === searchType);
   101→   101→
   102→   102→  return (
   103→   103→    <div className={`relative flex items-center gap-2 ${className}`}>
   104→   104→      {/* Search Input */}
   105→   105→      <div className="relative flex-1">
   106→   106→        <div className="absolute left-4 top-1/2 -translate-y-1/2 pointer-events-none">
   107→   107→          <Search size={16} className="text-neutral-500" />
   108→   108→        </div>
   109→   109→        <input
   110→   110→          ref={inputRef}
   111→   111→          type="text"
   112→   112→          value={query}
   113→   113→          onChange={(e) => handleInputChange(e.target.value)}
   114→   114→          onKeyDown={handleKeyDown}
   115→   115→          placeholder={placeholder}
   116→   116→          autoFocus={autoFocus}
   117→   117→          className="w-full h-11 pl-11 pr-10 rounded-xl bg-neutral-900/50 border border-white/10
   118→   118→                     text-sm text-white placeholder:text-neutral-600
   119→   119→                     focus:outline-none focus:border-cyan-500/30 focus:ring-1 focus:ring-cyan-500/20
   120→   120→                     transition-all"
   121→   121→        />
   122→   122→        {query && (
   123→   123→          <button
   124→   124→            onClick={handleClear}
   125→   125→            className="absolute right-3 top-1/2 -translate-y-1/2 p-1 rounded-md
   126→   126→                       text-neutral-500 hover:text-white hover:bg-white/10 transition-all"
   127→   127→          >
   128→   128→            <X size={14} />
   129→   129→          </button>
   130→   130→        )}
   131→   131→      </div>
   132→   132→
   133→   133→      {/* Filter Dropdown */}
   134→   134→      {showFilters && (
   135→   135→        <div className="relative" ref={dropdownRef}>
   136→   136→          <button
   137→   137→            onClick={() => setShowFilterDropdown(!showFilterDropdown)}
   138→   138→            className="h-11 px-4 rounded-xl bg-neutral-900/50 border border-white/10
   139→   139→                       flex items-center gap-2 text-[10px] font-black uppercase tracking-widest
   140→   140→                       text-neutral-400 hover:text-white hover:border-white/20 transition-all"
   141→   141→          >
   142→   142→            <Filter size={14} />
   143→   143→            <span className="hidden sm:inline">{selectedFilter?.label}</span>
   144→   144→            <ChevronDown size={12} className={`transition-transform ${showFilterDropdown ? 'rotate-180' : ''}`} />
   145→   145→          </button>
   146→   146→
   147→   147→          <AnimatePresence>
   148→   148→            {showFilterDropdown && (
   149→   149→              <motion.div
   150→   150→                initial={{ opacity: 0, y: -8 }}
   151→   151→                animate={{ opacity: 1, y: 0 }}
   152→   152→                exit={{ opacity: 0, y: -8 }}
   153→   153→                transition={{ duration: 0.15 }}
   154→   154→                className="absolute right-0 top-full mt-2 w-36 py-2 rounded-xl
   155→   155→                           bg-neutral-900 border border-white/10 shadow-xl shadow-black/50 z-50"
   156→   156→              >
   157→   157→                {filterOptions.map((option) => (
   158→   158→                  <button
   159→   159→                    key={option.value}
   160→   160→                    onClick={() => {
   161→   161→                      setSearchType(option.value);
   162→   162→                      setShowFilterDropdown(false);
   163→   163→                    }}
   164→   164→                    className={`w-full px-4 py-2.5 text-left text-[11px] font-bold uppercase tracking-wider
   165→   165→                               transition-colors ${
   166→   166→                                 searchType === option.value
   167→   167→                                   ? 'text-cyan-400 bg-cyan-500/10'
   168→   168→                                   : 'text-neutral-400 hover:text-white hover:bg-white/5'
   169→   169→                               }`}
   170→   170→                  >
   171→   171→                    {option.label}
   172→   172→                  </button>
   173→   173→                ))}
   174→   174→              </motion.div>
   175→   175→            )}
   176→   176→          </AnimatePresence>
   177→   177→        </div>
   178→   178→      )}
   179→   179→
   180→   180→      {/* Search Button */}
   181→   181→      <button
   182→   182→        onClick={handleSearch}
   183→   183→        disabled={query.trim().length < 2}
   184→   184→        className="h-11 px-5 rounded-xl bg-cyan-500 text-black text-[10px] font-black uppercase tracking-widest
   185→   185→                   flex items-center gap-2 hover:bg-cyan-400 transition-all shadow-lg shadow-cyan-500/20
   186→   186→                   disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:bg-cyan-500"
   187→   187→      >
   188→   188→        <Search size={14} />
   189→   189→        <span className="hidden sm:inline">Search</span>
   190→   190→      </button>
   191→   191→    </div>
   192→   192→  );
   193→   193→}
   194→   194→
   195→
   196→<system-reminder>
   197→Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
   198→</system-reminder>
   199→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
