     1→# LOOKSMAXX - FaceIQ Parity Fixes
     2→
     3→## Session Date: 2025-12-20
     4→
     5→## Current State Summary
     6→
     7→### What's Complete
     8→- [x] Core exponential decay scoring formula (exact match)
     9→- [x] Bezier curve interpolation with Newton-Raphson
    10→- [x] Updated all metric ideal ranges to match FaceIQ exactly
    11→- [x] Updated maxScore weights (2.5-30 scale)
    12→- [x] Results page layout with 6 tabs
    13→- [x] Surgery database (100+ procedures in `hardmaxxing.ts`)
    14→- [x] Softmaxxing treatments database
    15→- [x] Non-surgical treatments database
    16→- [x] Supplements database
    17→- [x] TypeScript compilation passing
    18→
    19→### What's Complete (Added 2025-12-20)
    20→- [x] InsightFace on Railway - FIXED! detection_ready: true
    21→- [x] Detailed flaw mappings for 28 metrics (METRIC_FLAW_MAPPINGS)
    22→- [x] Custom Bezier curves for 12 metrics (METRIC_CUSTOM_CURVES) - expanded from 5
    23→
    24→---
    25→
    26→## Gaps to Fix (FaceIQ Parity)
    27→
    28→### 1. Detailed Flaw Mappings Per Metric [COMPLETED]
    29→
    30→**Current:** Basic string arrays like `["Wide face", "Long midface"]`
    31→
    32→**FaceIQ Format:**
    33→```typescript
    34→interface FlawMapping {
    35→  category: string;           // "Occlusion/Jaw Growth"
    36→  flawName: string;           // "Hyper-divergent jaw growth"
    37→  confidence: 'confirmed' | 'likely' | 'possible';
    38→  actualValue: string;        // "38.05%"
    39→  idealRange: string;         // "31-33.5%"
    40→  deviation: string;          // "4.55% above ideal"
    41→  score: number;              // 0.19
    42→  severity: 'extremely severe' | 'severe' | 'major' | 'moderate' | 'minor';
    43→  reasoning: string;          // AI-generated explanation
    44→  isUnlocked: boolean;
    45→}
    46→```
    47→
    48→**Example from FaceIQ (Lower Third Proportion at 38.05%):**
    49→```json
    50→{
    51→  "mayIndicateFlaws": [
    52→    {
    53→      "category": "Occlusion/Jaw Growth",
    54→      "flawName": "Hyper-divergent jaw growth",
    55→      "confidence": "confirmed",
    56→      "actualValue": "38.05%",
    57→      "idealRange": "31-33.5%",
    58→      "deviation": "4.55% above ideal",
    59→      "score": 0.19,
    60→      "severity": "extremely severe",
    61→      "reasoning": "The upper jaw is too long relative to lower jaw, possibly from a long upper jaw or short lower jaw, or a combination of both. This disrupts facial harmony by elongating the lower face."
    62→    },
    63→    {
    64→      "category": "Jaw Shape",
    65→      "flawName": "Disproportionate lower face (short chin or long philtrum)",
    66→      "confidence": "confirmed",
    67→      ...
    68→    },
    69→    {
    70→      "category": "Midface/Face Shape",
    71→      "flawName": "Long upper jaw",
    72→      "confidence": "confirmed",
    73→      ...
    74→    },
    75→    {
    76→      "category": "Midface/Face Shape",
    77→      "flawName": "Short lower jaw",
    78→      "confidence": "confirmed",
    79→      ...
    80→    }
    81→  ]
    82→}
    83→```
    84→
    85→**Files to modify:**
    86→- `src/lib/faceiq-scoring.ts` - Add FLAW_MAPPINGS constant
    87→- `src/contexts/ResultsContext.tsx` - Update `getFlawStrengthMappings()` function
    88→- `src/types/results.ts` - Add FlawMapping interface
    89→
    90→---
    91→
    92→### 2. Custom Bezier Curves for ALL Metrics [MOSTLY COMPLETE - 12 metrics added]
    93→
    94→**Current:** 12 metrics have custom Bezier curves extracted from FaceIQ:
    95→- faceWidthToHeight, lowerThirdProportion, lateralCanthalTilt, gonialAngle, nasolabialAngle
    96→- middleThirdProportion, upperThirdProportion, eyeSeparationRatio, eyebrowLowSetedness
    97→- submentalCervicalAngle, facialConvexityGlabella
    98→
    99→**Remaining:** ~8 more curves could be extracted for remaining metrics
   100→
   101→**FaceIQ Format:** 12 control points with Bezier handles per metric
   102→```typescript
   103→interface CurvePoint {
   104→  x: number;
   105→  y: number;
   106→  leftHandleX?: number;
   107→  leftHandleY?: number;
   108→  rightHandleX?: number;
   109→  rightHandleY?: number;
   110→  fixed?: boolean;
   111→}
   112→
   113→interface CurveConfig {
   114→  mode: 'custom' | 'exponential';
   115→  customPoints?: CurvePoint[];
   116→  idealMin: number;
   117→  idealMax: number;
   118→  maxScore: number;
   119→  chartRange: { min: number; max: number };
   120→  decayRate?: number;
   121→}
   122→```
   123→
   124→**Example from FaceIQ (Lower Third Proportion):**
   125→```json
   126→{
   127→  "customPoints": [
   128→    {"x": 25.6, "y": 0, "leftHandleX": 24.8, "leftHandleY": 0, "rightHandleX": 26.4, "rightHandleY": 0},
   129→    {"x": 28.01, "y": 1.58, "leftHandleX": 27.23, "leftHandleY": 0.53, "rightHandleX": 28.27, "rightHandleY": 1.97},
   130→    {"x": 28.83, "y": 3.21, ...},
   131→    {"x": 29.63, "y": 5.85, ...},
   132→    {"x": 30.27, "y": 8.56, ...},
   133→    {"x": 31, "y": 10, "fixed": true},
   134→    {"x": 33.5, "y": 10, "fixed": true},
   135→    {"x": 34.23, "y": 8.56, ...},
   136→    {"x": 34.87, "y": 5.85, ...},
   137→    {"x": 35.67, "y": 3.21, ...},
   138→    {"x": 36.49, "y": 1.58, ...},
   139→    {"x": 38.9, "y": 0, ...}
   140→  ]
   141→}
   142→```
   143→
   144→**Files to modify:**
   145→- `src/lib/faceiq-scoring.ts` - Add `customCurve` to each metric in FACEIQ_METRICS
   146→
   147→**Data source:** Extract from `/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/FACEIQ-FRONT RATIOS.html`
   148→
   149→---
   150→
   151→### 3. Enhanced Illustration Configs [COMPLETED]
   152→
   153→**Status:** DONE - Added 30+ illustration configs for all metrics
   154→
   155→**Changes made:**
   156→- Added illustration configs for all missing front profile metrics (cupidsBow, mouthCorner, iaaJfa, etc.)
   157→- Added illustration configs for all missing side profile metrics (nasolabialAngle, nasalTipAngle, mentolabialAngle, etc.)
   158→- Now have ~70 metric illustration configs total covering front and side profiles
   159→
   160→**Files modified:**
   161→- `src/contexts/ResultsContext.tsx` - Expanded `ILLUSTRATION_CONFIGS` constant
   162→
   163→---
   164→
   165→### 4. Improved Flaw-to-Treatment Matching [COMPLETED]
   166→
   167→**Status:** DONE - Enhanced scoring algorithm with metric-based prioritization
   168→
   169→**Changes made:**
   170→- Enhanced `calculateRelevanceScore()` with metric score weighting (lower scores get higher priority)
   171→- Added `calculateExpectedImprovement()` function for severity-based improvement calculations
   172→- Improved `generateRecommendations()` with:
   173→  - Priority scoring based on relevance, multi-flaw bonus, severity weight, and procedure effectiveness
   174→  - Direction-aware ratio impacts (increase/decrease based on deviation)
   175→  - Percentage effect calculations based on how far metrics are from ideal
   176→- Added keyword weighting (primary matches worth more than secondary)
   177→
   178→**Files modified:**
   179→- `src/contexts/ResultsContext.tsx` - Enhanced all recommendation functions
   180→
   181→---
   182→
   183→### 5. Severity Display Enhancement [COMPLETED]
   184→
   185→**Status:** DONE - Severity badges now prominently displayed in card headers
   186→
   187→**Changes made:**
   188→- Added `getSeverityIndicator()` helper function with FaceIQ-style colors
   189→- MeasurementCard collapsed header now shows:
   190→  - Severity-colored ring around score box for moderate+ issues
   191→  - Colored severity indicator dot in top-right corner
   192→  - Compact severity badge next to metric name
   193→- CompactMeasurementCard now shows:
   194→  - Severity dot indicator for non-optimal metrics
   195→  - Inline "Severe" or "Critical" badges for severe issues
   196→- Color scheme matches FaceIQ:
   197→  - Extremely Severe: #dc2626 (deep red)
   198→  - Severe: #ef4444 (red)
   199→  - Major: #f97316 (orange)
   200→  - Moderate: #fbbf24 (yellow)
   201→  - Minor/Optimal: #22c55e / #67e8f9 (green/cyan)
   202→
   203→**Files modified:**
   204→- `src/components/results/cards/MeasurementCard.tsx` - Added severity indicators to headers
   205→
   206→---
   207→
   208→### 6. Railway InsightFace Deployment [FIXED ✓]
   209→
   210→**Status:** WORKING - detection_ready: true
   211→- Deployed using `railway up --service api`
   212→- python:3.11-bookworm base with cmake & libopenblas-dev
   213→- onnxruntime-cpu==1.16.3
   214→
   215→---
   216→
   217→### 7. AI-Generated Descriptions [LOW PRIORITY]
   218→
   219→**Current:** Static descriptions per metric
   220→
   221→**Target:** Add `aiDescription` field with personalized explanations based on the user's actual values
   222→
   223→---
   224→
   225→### 8. Decay Curve Charts [LOW PRIORITY]
   226→
   227→**Current:** Not implemented
   228→
   229→**Target:** Visualize the scoring curve showing where user's value falls
   230→
   231→---
   232→
   233→### 9. Potential Score Calculations [LOW PRIORITY]
   234→
   235→**Current:** Basic in Plan tab
   236→
   237→**Target:** "Your score could be X with treatment Y" with projected improvements
   238→
   239→---
   240→
   241→### 10. Radar Chart Visualization [LOW PRIORITY]
   242→
   243→**Current:** Not implemented
   244→
   245→**Target:** Add a radar/spider chart showing scores across facial categories (Eyes, Jaw, Nose, Lips, Proportions, etc.) for quick visual overview of strengths/weaknesses.
   246→
   247→**Implementation:** Use Recharts RadarChart component
   248→```bash
   249→npm install recharts
   250→```
   251→
   252→```typescript
   253→// src/components/results/visualization/FacialRadarChart.tsx
   254→import { ResponsiveContainer, RadarChart, PolarGrid, PolarAngleAxis, Radar } from 'recharts';
   255→
   256→const data = [
   257→  { category: 'Eyes', score: 8.5, fullMark: 10 },
   258→  { category: 'Jaw', score: 7.2, fullMark: 10 },
   259→  { category: 'Nose', score: 6.8, fullMark: 10 },
   260→  { category: 'Lips', score: 9.1, fullMark: 10 },
   261→  { category: 'Proportions', score: 7.5, fullMark: 10 },
   262→  { category: 'Symmetry', score: 8.0, fullMark: 10 },
   263→];
   264→
   265→export const FacialRadarChart = () => (
   266→  <ResponsiveContainer width="100%" height={300}>
   267→    <RadarChart outerRadius="80%" data={data}>
   268→      <PolarGrid stroke="#374151" />
   269→      <PolarAngleAxis dataKey="category" stroke="#9ca3af" />
   270→      <Radar name="Score" dataKey="score" stroke="#00f3ff" fill="#00f3ff" fillOpacity={0.3} />
   271→    </RadarChart>
   272→  </ResponsiveContainer>
   273→);
   274→```
   275→
   276→**Reference:** [recharts/recharts](https://github.com/recharts/recharts), [yezihaohao/react-admin](https://github.com/yezihaohao/react-admin)
   277→
   278→**Files to modify:**
   279→- `src/components/results/visualization/FacialRadarChart.tsx` (new)
   280→- `src/components/results/tabs/OverviewTab.tsx`
   281→
   282→---
   283→
   284→### 11. Before/After Comparison Slider [LOW PRIORITY]
   285→
   286→**Current:** Not implemented
   287→
   288→**Target:** Allow users to upload a "before" photo and compare with current analysis using an interactive slider
   289→
   290→**Implementation:** Use `react-compare-slider` package
   291→```bash
   292→npm install react-compare-slider
   293→```
   294→
   295→```typescript
   296→// src/components/results/visualization/CompareSlider.tsx
   297→import { ReactCompareSlider, ReactCompareSliderImage } from 'react-compare-slider';
   298→
   299→interface CompareSliderProps {
   300→  beforeImage: string;
   301→  afterImage: string;
   302→}
   303→
   304→export const CompareSlider = ({ beforeImage, afterImage }: CompareSliderProps) => (
   305→  <ReactCompareSlider
   306→    itemOne={<ReactCompareSliderImage src={beforeImage} alt="Before" />}
   307→    itemTwo={<ReactCompareSliderImage src={afterImage} alt="After" />}
   308→    style={{ width: '100%', height: '400px' }}
   309→  />
   310→);
   311→```
   312→
   313→**Reference:** [nerdyman/react-compare-slider](https://github.com/nerdyman/react-compare-slider), [Nutlope/roomGPT](https://github.com/Nutlope/roomGPT)
   314→
   315→**Files to modify:**
   316→- `src/components/results/visualization/CompareSlider.tsx` (new)
   317→- `src/components/results/tabs/OverviewTab.tsx`
   318→
   319→---
   320→
   321→### 12. Share Results Functionality [LOW PRIORITY]
   322→
   323→**Current:** Not implemented
   324→
   325→**Target:** Allow users to share their results via:
   326→- Native share API (mobile)
   327→- Copy link to clipboard
   328→- Social media sharing (Twitter, Instagram stories)
   329→
   330→**Implementation:**
   331→```typescript
   332→// src/lib/shareResults.ts
   333→export async function shareResults(score: number, shareableUrl: string) {
   334→  const shareData = {
   335→    title: 'My LOOKSMAXX Analysis',
   336→    text: `My facial harmony score: ${score.toFixed(1)}/10`,
   337→    url: shareableUrl,
   338→  };
   339→
   340→  if (navigator.share && navigator.canShare?.(shareData)) {
   341→    try {
   342→      await navigator.share(shareData);
   343→      return { success: true };
   344→    } catch (error) {
   345→      if ((error as Error).name !== 'AbortError') {
   346→        console.error('Share failed:', error);
   347→      }
   348→    }
   349→  }
   350→
   351→  // Fallback: copy to clipboard
   352→  await navigator.clipboard.writeText(shareableUrl);
   353→  return { success: true, fallback: 'clipboard' };
   354→}
   355→```
   356→
   357→**Reference:** [excalidraw/excalidraw](https://github.com/excalidraw/excalidraw), [mastodon/mastodon](https://github.com/mastodon/mastodon)
   358→
   359→**Files to modify:**
   360→- `src/lib/shareResults.ts` (new)
   361→- `src/components/results/shared/ShareButton.tsx` (new)
   362→- `src/components/results/tabs/OverviewTab.tsx`
   363→
   364→---
   365→
   366→### 13. PDF/Image Export [LOW PRIORITY]
   367→
   368→**Current:** Not implemented
   369→
   370→**Target:** Export analysis results as:
   371→- PDF report with all metrics
   372→- Image summary for sharing
   373→- Printable format
   374→
   375→**Implementation:** Use `html2canvas` + `jsPDF`
   376→```bash
   377→npm install html2canvas jspdf
   378→```
   379→
   380→```typescript
   381→// src/lib/exportReport.ts
   382→import html2canvas from 'html2canvas';
   383→import { jsPDF } from 'jspdf';
   384→
   385→export async function exportToPDF(elementId: string, filename: string) {
   386→  const element = document.getElementById(elementId);
   387→  if (!element) return;
   388→
   389→  const canvas = await html2canvas(element);
   390→  const dataUrl = canvas.toDataURL('image/png');
   391→
   392→  const contentWidth = canvas.width;
   393→  const contentHeight = canvas.height;
   394→  const orientation = contentWidth > contentHeight ? 'l' : 'p';
   395→
   396→  const pdf = new jsPDF(orientation, 'pt', [contentWidth, contentHeight]);
   397→  pdf.addImage(dataUrl, 'PNG', 0, 0, contentWidth, contentHeight);
   398→  pdf.save(`${filename}.pdf`);
   399→}
   400→
   401→export async function exportToImage(elementId: string, filename: string) {
   402→  const element = document.getElementById(elementId);
   403→  if (!element) return;
   404→
   405→  const canvas = await html2canvas(element);
   406→  const link = document.createElement('a');
   407→  link.href = canvas.toDataURL('image/png');
   408→  link.download = `${filename}.png`;
   409→  link.click();
   410→}
   411→```
   412→
   413→**Reference:** [metabase/metabase](https://github.com/metabase/metabase), [dataease/dataease](https://github.com/dataease/dataease)
   414→
   415→**Files to modify:**
   416→- `src/lib/exportReport.ts` (new)
   417→- `src/components/results/tabs/OptionsTab.tsx`
   418→
   419→---
   420→
   421→### 14. Analysis History & Progress Tracking [LOW PRIORITY]
   422→
   423→**Current:** Not implemented
   424→
   425→**Target:** Store analysis history and show:
   426→- Timeline of past analyses
   427→- Score progression over time
   428→- Changes after treatments
   429→
   430→**Implementation:** Store in localStorage or database
   431→```typescript
   432→// src/lib/analysisHistory.ts
   433→interface AnalysisRecord {
   434→  id: string;
   435→  date: string;
   436→  overallScore: number;
   437→  categoryScores: Record<string, number>;
   438→  photoThumbnail?: string;
   439→}
   440→
   441→const HISTORY_KEY = 'looksmaxx_history';
   442→const MAX_HISTORY = 50;
   443→
   444→export function getHistory(): AnalysisRecord[] {
   445→  return JSON.parse(localStorage.getItem(HISTORY_KEY) || '[]');
   446→}
   447→
   448→export function saveToHistory(record: AnalysisRecord) {
   449→  const history = getHistory();
   450→  history.unshift(record);
   451→  if (history.length > MAX_HISTORY) history.pop();
   452→  localStorage.setItem(HISTORY_KEY, JSON.stringify(history));
   453→}
   454→
   455→export function clearHistory() {
   456→  localStorage.setItem(HISTORY_KEY, JSON.stringify([]));
   457→}
   458→```
   459→
   460→**Reference:** [gedoor/legado](https://github.com/gedoor/legado), [m4tt72/terminal](https://github.com/m4tt72/terminal)
   461→
   462→**Files to modify:**
   463→- `src/lib/analysisHistory.ts` (new)
   464→- `src/contexts/HistoryContext.tsx` (new)
   465→- `src/components/results/tabs/HistoryTab.tsx` (new)
   466→
   467→---
   468→
   469→### 15. Detailed Symmetry Analysis [LOW PRIORITY]
   470→
   471→**Current:** Basic asymmetry detection
   472→
   473→**Target:** Show detailed left/right comparison:
   474→- Per-feature symmetry scores (eyes, brows, jaw, etc.)
   475→- Visual overlay showing asymmetric regions
   476→- Percentage deviation per side
   477→
   478→**Files to modify:**
   479→- `src/lib/symmetryAnalysis.ts` (new)
   480→- `src/components/results/visualization/SymmetryOverlay.tsx` (new)
   481→
   482→---
   483→
   484→### 16. Ethnicity-Based Ideal Ranges [LOW PRIORITY]
   485→
   486→**Current:** Single set of ideal ranges
   487→
   488→**Target:** Adjust ideal ranges based on user's selected ethnicity:
   489→- Different nose width ideals for different ethnicities
   490→- Adjusted eye shape parameters
   491→- Cultural beauty standard variations
   492→
   493→**Files to modify:**
   494→- `src/lib/faceiq-scoring.ts` - Add ethnicity parameter to scoring functions
   495→- `src/lib/ethnicityRanges.ts` (new) - Ethnicity-specific ideal ranges
   496→
   497→---
   498→
   499→### 17. Animated Score Reveal [LOW PRIORITY]
   500→
   501→**Current:** Static score display
   502→
   503→**Target:** Add engaging animations when revealing scores:
   504→- Count-up animation for overall score
   505→- Staggered reveal of individual metrics
   506→- Confetti/celebration for high scores
   507→
   508→**Implementation:** Use `react-countup` + `canvas-confetti`
   509→```bash
   510→npm install react-countup canvas-confetti
   511→npm install -D @types/canvas-confetti
   512→```
   513→
   514→```typescript
   515→// src/components/results/shared/AnimatedScore.tsx
   516→'use client';
   517→import CountUp from 'react-countup';
   518→import confetti from 'canvas-confetti';
   519→import { useEffect } from 'react';
   520→
   521→interface AnimatedScoreProps {
   522→  score: number;
   523→  duration?: number;
   524→}
   525→
   526→export const AnimatedScore = ({ score, duration = 2 }: AnimatedScoreProps) => {
   527→  useEffect(() => {
   528→    // Trigger confetti for high scores
   529→    if (score >= 7.5) {
   530→      confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
   531→    }
   532→  }, [score]);
   533→
   534→  return (
   535→    <CountUp
   536→      end={score}
   537→      decimals={1}
   538→      duration={duration}
   539→      suffix="/10"
   540→      className="text-5xl font-bold text-[#00f3ff]"
   541→    />
   542→  );
   543→};
   544→```
   545→
   546→**Reference:** [ant-design/ant-design](https://github.com/ant-design/ant-design), [adrianhajdin/banking](https://github.com/adrianhajdin/banking), [openai/openai-testing-agent-demo](https://github.com/openai/openai-testing-agent-demo)
   547→
   548→**Files to modify:**
   549→- `src/components/results/shared/AnimatedScore.tsx` (new)
   550→- `src/components/results/tabs/OverviewTab.tsx`
   551→
   552→---
   553→
   554→### 18. Celebrity Comparison [LOW PRIORITY]
   555→
   556→**Current:** Not implemented
   557→
   558→**Target:** Compare user's metrics to celebrity facial proportions:
   559→- "Your eye shape is similar to X"
   560→- Show celebrities with similar scores
   561→- Aspirational comparisons
   562→
   563→**Note:** Requires celebrity metrics database
   564→
   565→---
   566→
   567→### 19. Mobile Camera Capture [LOW PRIORITY]
   568→
   569→**Current:** File upload only
   570→
   571→**Target:** Direct camera capture with:
   572→- Face positioning guide overlay
   573→- Auto-capture when face is aligned
   574→- Front/side profile guidance
   575→
   576→**Implementation:**
   577→```typescript
   578→// src/components/CameraCapture.tsx
   579→'use client';
   580→import { useRef, useState, useEffect } from 'react';
   581→
   582→interface CameraCaptureProps {
   583→  onCapture: (imageData: string) => void;
   584→  facingMode?: 'user' | 'environment';
   585→}
   586→
   587→export function CameraCapture({ onCapture, facingMode = 'user' }: CameraCaptureProps) {
   588→  const videoRef = useRef<HTMLVideoElement>(null);
   589→  const [stream, setStream] = useState<MediaStream | null>(null);
   590→
   591→  useEffect(() => {
   592→    const startCamera = async () => {
   593→      try {
   594→        const mediaStream = await navigator.mediaDevices.getUserMedia({
   595→          video: { facingMode },
   596→          audio: false,
   597→        });
   598→        setStream(mediaStream);
   599→        if (videoRef.current) {
   600→          videoRef.current.srcObject = mediaStream;
   601→        }
   602→      } catch (err) {
   603→        console.error('Camera access denied:', err);
   604→      }
   605→    };
   606→    startCamera();
   607→
   608→    return () => {
   609→      stream?.getTracks().forEach(track => track.stop());
   610→    };
   611→  }, [facingMode]);
   612→
   613→  const capture = () => {
   614→    if (!videoRef.current) return;
   615→    const canvas = document.createElement('canvas');
   616→    canvas.width = videoRef.current.videoWidth;
   617→    canvas.height = videoRef.current.videoHeight;
   618→    canvas.getContext('2d')?.drawImage(videoRef.current, 0, 0);
   619→    onCapture(canvas.toDataURL('image/jpeg', 0.9));
   620→  };
   621→
   622→  return (
   623→    <div className="relative">
   624→      <video ref={videoRef} autoPlay playsInline className="rounded-xl" />
   625→      {/* Face positioning guide overlay */}
   626→      <div className="absolute inset-0 flex items-center justify-center pointer-events-none">
   627→        <div className="w-64 h-80 border-2 border-dashed border-cyan-400 rounded-full opacity-50" />
   628→      </div>
   629→      <button onClick={capture} className="mt-4 btn-primary w-full">
   630→        Capture Photo
   631→      </button>
   632→    </div>
   633→  );
   634→}
   635→```
   636→
   637→**Reference:** [weaigc/bingo](https://github.com/weaigc/bingo), [acmutd/hackportal](https://github.com/acmutd/hackportal)
   638→
   639→**Files to modify:**
   640→- `src/components/CameraCapture.tsx` (new)
   641→- `src/app/upload/page.tsx`
   642→
   643→---
   644→
   645→### 20. Metric Tooltips & Education [LOW PRIORITY]
   646→
   647→**Current:** Basic descriptions
   648→
   649→**Target:** Rich educational content:
   650→- Interactive diagrams showing what each metric measures
   651→- Video explanations
   652→- "Why this matters" sections
   653→- Scientific references
   654→
   655→**Implementation:**
   656→```typescript
   657→// src/lib/metricEducation.ts
   658→interface MetricEducation {
   659→  id: string;
   660→  title: string;
   661→  shortDescription: string;
   662→  detailedExplanation: string;
   663→  whyItMatters: string;
   664→  scientificReference?: string;
   665→  diagramUrl?: string;
   666→  videoUrl?: string;
   667→}
   668→
   669→export const METRIC_EDUCATION: Record<string, MetricEducation> = {
   670→  totalFacialWidthToHeight: {
   671→    id: 'totalFacialWidthToHeight',
   672→    title: 'Facial Width-to-Height Ratio',
   673→    shortDescription: 'The ratio of face width to face height',
   674→    detailedExplanation: 'Measured from zygion to zygion (bizygomatic width) divided by the height from nasion to menton.',
   675→    whyItMatters: 'This ratio affects perceived masculinity/femininity and facial harmony. Values around 1.96-2.0 are considered ideal.',
   676→    scientificReference: 'Carré & McCormick, 2008 - Proceedings of the Royal Society B',
   677→  },
   678→  // ... more metrics
   679→};
   680→
   681→// src/components/results/shared/MetricTooltip.tsx
   682→import { Tooltip, TooltipContent, TooltipProvider, TooltipTrigger } from '@/components/ui/tooltip';
   683→import { Info } from 'lucide-react';
   684→import { METRIC_EDUCATION } from '@/lib/metricEducation';
   685→
   686→export function MetricTooltip({ metricId }: { metricId: string }) {
   687→  const edu = METRIC_EDUCATION[metricId];
   688→  if (!edu) return null;
   689→
   690→  return (
   691→    <TooltipProvider>
   692→      <Tooltip>
   693→        <TooltipTrigger>
   694→          <Info size={14} className="text-neutral-500 hover:text-cyan-400" />
   695→        </TooltipTrigger>
   696→        <TooltipContent className="max-w-xs">
   697→          <p className="font-medium">{edu.title}</p>
   698→          <p className="text-sm text-neutral-400 mt-1">{edu.detailedExplanation}</p>
   699→          <p className="text-xs text-cyan-400 mt-2">{edu.whyItMatters}</p>
   700→        </TooltipContent>
   701→      </Tooltip>
   702→    </TooltipProvider>
   703→  );
   704→}
   705→```
   706→
   707→**Reference:** [facebook/sapling](https://github.com/facebook/sapling), [recharts/recharts](https://github.com/recharts/recharts)
   708→
   709→**Files to modify:**
   710→- `src/lib/metricEducation.ts` (new)
   711→- `src/components/results/shared/MetricTooltip.tsx` (new)
   712→- `src/components/results/cards/MeasurementCard.tsx`
   713→
   714→---
   715→
   716→### 21. Facial Landmark Visualization Overlay [LOW PRIORITY]
   717→
   718→**Current:** Landmarks calculated but not displayed on photo
   719→
   720→**Target:** Draw facial landmarks and connections on the uploaded photo:
   721→- Toggle overlay on/off
   722→- Show measurement lines between key points
   723→- Color-code by metric category (eyes, nose, jaw, etc.)
   724→
   725→**Implementation:**
   726→```typescript
   727→// src/components/results/visualization/LandmarkOverlay.tsx
   728→'use client';
   729→import { useRef, useEffect } from 'react';
   730→import { DrawingUtils, FaceLandmarker } from '@mediapipe/tasks-vision';
   731→
   732→interface LandmarkOverlayProps {
   733→  imageUrl: string;
   734→  landmarks: { x: number; y: number; z: number }[];
   735→  showConnections?: boolean;
   736→}
   737→
   738→export function LandmarkOverlay({ imageUrl, landmarks, showConnections = true }: LandmarkOverlayProps) {
   739→  const canvasRef = useRef<HTMLCanvasElement>(null);
   740→  const imgRef = useRef<HTMLImageElement>(null);
   741→
   742→  useEffect(() => {
   743→    const canvas = canvasRef.current;
   744→    const img = imgRef.current;
   745→    if (!canvas || !img || !landmarks.length) return;
   746→
   747→    const ctx = canvas.getContext('2d');
   748→    if (!ctx) return;
   749→
   750→    canvas.width = img.naturalWidth;
   751→    canvas.height = img.naturalHeight;
   752→
   753→    ctx.clearRect(0, 0, canvas.width, canvas.height);
   754→    ctx.drawImage(img, 0, 0);
   755→
   756→    const drawingUtils = new DrawingUtils(ctx);
   757→
   758→    // Draw face mesh tesselation
   759→    if (showConnections) {
   760→      drawingUtils.drawConnectors(landmarks, FaceLandmarker.FACE_LANDMARKS_TESSELATION, {
   761→        color: 'rgba(0, 243, 255, 0.3)',
   762→        lineWidth: 1,
   763→      });
   764→    }
   765→
   766→    // Draw key landmarks as points
   767→    drawingUtils.drawLandmarks(landmarks, {
   768→      color: '#00f3ff',
   769→      lineWidth: 1,
   770→      radius: 2,
   771→    });
   772→  }, [landmarks, showConnections]);
   773→
   774→  return (
   775→    <div className="relative">
   776→      <img ref={imgRef} src={imageUrl} alt="Face" className="hidden" onLoad={() => {}} />
   777→      <canvas ref={canvasRef} className="w-full h-auto rounded-xl" />
   778→    </div>
   779→  );
   780→}
   781→```
   782→
   783→**Reference:** [Suryansh777777/Jarvis-CV](https://github.com/Suryansh777777/Jarvis-CV), [ayushgdev/MediaPipeCodeSamples](https://github.com/ayushgdev/MediaPipeCodeSamples)
   784→
   785→**Files to modify:**
   786→- `src/components/results/visualization/LandmarkOverlay.tsx` (new)
   787→- `src/components/results/tabs/OverviewTab.tsx`
   788→
   789→---
   790→
   791→### 22. Dark Mode / Theme Toggle [LOW PRIORITY]
   792→
   793→**Current:** Single dark theme
   794→
   795→**Target:** Add theme toggle with:
   796→- Dark mode (current)
   797→- Light mode
   798→- System preference detection
   799→
   800→**Implementation:**
   801→```typescript
   802→// src/components/ThemeToggle.tsx
   803→'use client';
   804→import { useTheme } from 'next-themes';
   805→import { Sun, Moon, Monitor } from 'lucide-react';
   806→
   807→export function ThemeToggle() {
   808→  const { theme, setTheme } = useTheme();
   809→
   810→  return (
   811→    <div className="flex items-center gap-1 p-1 rounded-lg bg-neutral-800">
   812→      <button
   813→        onClick={() => setTheme('light')}
   814→        className={`p-2 rounded ${theme === 'light' ? 'bg-neutral-700' : ''}`}
   815→        title="Light theme"
   816→      >
   817→        <Sun size={16} className={theme === 'light' ? 'text-white' : 'text-neutral-400'} />
   818→      </button>
   819→      <button
   820→        onClick={() => setTheme('dark')}
   821→        className={`p-2 rounded ${theme === 'dark' ? 'bg-neutral-700' : ''}`}
   822→        title="Dark theme"
   823→      >
   824→        <Moon size={16} className={theme === 'dark' ? 'text-white' : 'text-neutral-400'} />
   825→      </button>
   826→      <button
   827→        onClick={() => setTheme('system')}
   828→        className={`p-2 rounded ${theme === 'system' ? 'bg-neutral-700' : ''}`}
   829→        title="System theme"
   830→      >
   831→        <Monitor size={16} className={theme === 'system' ? 'text-white' : 'text-neutral-400'} />
   832→      </button>
   833→    </div>
   834→  );
   835→}
   836→```
   837→
   838→```bash
   839→npm install next-themes
   840→```
   841→
   842→**Reference:** [supabase/supabase](https://github.com/supabase/supabase), [prometheus/prometheus](https://github.com/prometheus/prometheus), [boxyhq/saas-starter-kit](https://github.com/boxyhq/saas-starter-kit)
   843→
   844→**Files to modify:**
   845→- `src/components/ThemeToggle.tsx` (new)
   846→- `src/app/layout.tsx` - wrap with ThemeProvider
   847→- `tailwind.config.ts` - add darkMode: 'class'
   848→
   849→---
   850→
   851→### 23. PWA / Offline Support [LOW PRIORITY]
   852→
   853→**Current:** Web-only, requires internet
   854→
   855→**Target:** Progressive Web App with:
   856→- Offline access to previous results
   857→- Install to home screen
   858→- Service worker caching
   859→
   860→**Implementation:**
   861→```bash
   862→npm install next-pwa
   863→```
   864→
   865→```typescript
   866→// next.config.js
   867→const withPWA = require('next-pwa')({
   868→  dest: 'public',
   869→  register: true,
   870→  skipWaiting: true,
   871→  disable: process.env.NODE_ENV === 'development',
   872→});
   873→
   874→module.exports = withPWA({
   875→  // existing config
   876→});
   877→
   878→// public/manifest.json
   879→{
   880→  "name": "LOOKSMAXX",
   881→  "short_name": "LOOKSMAXX",
   882→  "description": "Facial metrics analysis and visualization",
   883→  "start_url": "/",
   884→  "display": "standalone",
   885→  "background_color": "#0a0a0a",
   886→  "theme_color": "#00f3ff",
   887→  "icons": [
   888→    { "src": "/icon-192.png", "sizes": "192x192", "type": "image/png" },
   889→    { "src": "/icon-512.png", "sizes": "512x512", "type": "image/png" }
   890→  ]
   891→}
   892→```
   893→
   894→**Reference:** [vite-pwa/vite-plugin-pwa](https://github.com/vite-pwa/vite-plugin-pwa), [GoogleChrome/workbox](https://github.com/GoogleChrome/workbox), [vuetifyjs/vuetify](https://github.com/vuetifyjs/vuetify)
   895→
   896→**Files to modify:**
   897→- `next.config.js`
   898→- `public/manifest.json` (new)
   899→- `src/app/layout.tsx` - add manifest link
   900→
   901→---
   902→
   903→### 24. Premium Tier / Stripe Subscriptions [LOW PRIORITY]
   904→
   905→**Current:** All features free
   906→
   907→**Target:** Monetization with:
   908→- Free tier (basic metrics)
   909→- Premium tier (all metrics, recommendations, exports)
   910→- Stripe checkout integration
   911→
   912→**Implementation:**
   913→```typescript
   914→// src/lib/stripe.ts
   915→import Stripe from 'stripe';
   916→
   917→export const stripe = new Stripe(process.env.STRIPE_SECRET_KEY!, {
   918→  apiVersion: '2023-10-16',
   919→});
   920→
   921→// src/app/api/checkout/route.ts
   922→import { stripe } from '@/lib/stripe';
   923→import { NextResponse } from 'next/server';
   924→
   925→export async function POST(req: Request) {
   926→  const { priceId, userId } = await req.json();
   927→
   928→  const session = await stripe.checkout.sessions.create({
   929→    mode: 'subscription',
   930→    line_items: [{ price: priceId, quantity: 1 }],
   931→    success_url: `${process.env.NEXT_PUBLIC_URL}/billing?success=true`,
   932→    cancel_url: `${process.env.NEXT_PUBLIC_URL}/billing?canceled=true`,
   933→    metadata: { userId },
   934→  });
   935→
   936→  return NextResponse.json({ url: session.url });
   937→}
   938→```
   939→
   940→```bash
   941→npm install stripe @stripe/stripe-js
   942→```
   943→
   944→**Reference:** [calcom/cal.com](https://github.com/calcom/cal.com), [civitai/civitai](https://github.com/civitai/civitai), [toeverything/AFFiNE](https://github.com/toeverything/AFFiNE)
   945→
   946→**Files to modify:**
   947→- `src/lib/stripe.ts` (new)
   948→- `src/app/api/checkout/route.ts` (new)
   949→- `src/app/api/webhooks/stripe/route.ts` (new)
   950→- `src/components/PricingCard.tsx` (new)
   951→
   952→---
   953→
   954→### 25. Analytics Integration (Mixpanel) [LOW PRIORITY]
   955→
   956→**Current:** No analytics
   957→
   958→**Target:** Track user behavior:
   959→- Photo uploads
   960→- Feature usage
   961→- Conversion funnel
   962→- Session recordings
   963→
   964→**Implementation:**
   965→```typescript
   966→// src/lib/analytics.ts
   967→import mixpanel from 'mixpanel-browser';
   968→
   969→const MIXPANEL_TOKEN = process.env.NEXT_PUBLIC_MIXPANEL_TOKEN;
   970→
   971→export function initAnalytics() {
   972→  if (MIXPANEL_TOKEN) {
   973→    mixpanel.init(MIXPANEL_TOKEN, {
   974→      debug: process.env.NODE_ENV === 'development',
   975→      track_pageview: true,
   976→      persistence: 'localStorage',
   977→    });
   978→  }
   979→}
   980→
   981→export function trackEvent(event: string, properties?: Record<string, unknown>) {
   982→  if (MIXPANEL_TOKEN) {
   983→    mixpanel.track(event, properties);
   984→  }
   985→}
   986→
   987→export function identifyUser(userId: string, traits?: Record<string, unknown>) {
   988→  if (MIXPANEL_TOKEN) {
   989→    mixpanel.identify(userId);
   990→    if (traits) mixpanel.people.set(traits);
   991→  }
   992→}
   993→
   994→// Usage in components
   995→trackEvent('analysis_completed', { score: 7.5, metricsCount: 45 });
   996→trackEvent('recommendation_viewed', { type: 'surgery', procedure: 'rhinoplasty' });
   997→```
   998→
   999→```bash
  1000→npm install mixpanel-browser
  1001→npm install -D @types/mixpanel-browser
  1002→```
  1003→
  1004→**Reference:** [novuhq/novu](https://github.com/novuhq/novu), [appsmithorg/appsmith](https://github.com/appsmithorg/appsmith), [toeverything/AFFiNE](https://github.com/toeverything/AFFiNE)
  1005→
  1006→**Files to modify:**
  1007→- `src/lib/analytics.ts` (new)
  1008→- `src/app/layout.tsx` - initialize analytics
  1009→- Components - add tracking calls
  1010→
  1011→---
  1012→
  1013→### 26. Error Tracking (Sentry) [LOW PRIORITY]
  1014→
  1015→**Current:** Console errors only
  1016→
  1017→**Target:** Production error monitoring:
  1018→- Automatic error capture
  1019→- Performance monitoring
  1020→- Session replay for debugging
  1021→
  1022→**Implementation:**
  1023→```bash
  1024→npx @sentry/wizard@latest -i nextjs
  1025→```
  1026→
  1027→```typescript
  1028→// sentry.client.config.ts
  1029→import * as Sentry from '@sentry/nextjs';
  1030→
  1031→Sentry.init({
  1032→  dsn: process.env.NEXT_PUBLIC_SENTRY_DSN,
  1033→  tracesSampleRate: 0.1,
  1034→  replaysSessionSampleRate: 0.1,
  1035→  replaysOnErrorSampleRate: 1.0,
  1036→  integrations: [
  1037→    Sentry.replayIntegration(),
  1038→  ],
  1039→});
  1040→
  1041→// Usage - errors are auto-captured, but you can add context:
  1042→Sentry.setUser({ id: userId });
  1043→Sentry.addBreadcrumb({ category: 'analysis', message: 'Started face detection' });
  1044→```
  1045→
  1046→**Reference:** [getsentry/sentry-javascript](https://github.com/getsentry/sentry-javascript), [electron/fiddle](https://github.com/electron/fiddle)
  1047→
  1048→**Files to modify:**
  1049→- `sentry.client.config.ts` (new)
  1050→- `sentry.server.config.ts` (new)
  1051→- `next.config.js` - wrap with withSentryConfig
  1052→
  1053→---
  1054→
  1055→### 27. Internationalization (i18n) [LOW PRIORITY]
  1056→
  1057→**Current:** English only
  1058→
  1059→**Target:** Multi-language support:
  1060→- English (default)
  1061→- Spanish, Portuguese, French, German
  1062→- RTL support for Arabic
  1063→
  1064→**Implementation:**
  1065→```bash
  1066→npm install next-intl
  1067→```
  1068→
  1069→```typescript
  1070→// src/i18n.ts
  1071→import { getRequestConfig } from 'next-intl/server';
  1072→
  1073→export default getRequestConfig(async ({ locale }) => ({
  1074→  messages: (await import(`./messages/${locale}.json`)).default,
  1075→}));
  1076→
  1077→// src/messages/en.json
  1078→{
  1079→  "results": {
  1080→    "overallScore": "Overall Score",
  1081→    "flaws": "Areas for Improvement",
  1082→    "strengths": "Your Strengths",
  1083→    "recommendations": "Recommendations"
  1084→  },
  1085→  "metrics": {
  1086→    "totalFacialWidthToHeight": "Facial Width-to-Height Ratio",
  1087→    "middleThirdProportion": "Middle Third Proportion"
  1088→  }
  1089→}
  1090→
  1091→// Usage in components
  1092→import { useTranslations } from 'next-intl';
  1093→
  1094→export function OverviewTab() {
  1095→  const t = useTranslations('results');
  1096→  return <h1>{t('overallScore')}</h1>;
  1097→}
  1098→```
  1099→
  1100→**Reference:** [flowinquiry/flowinquiry](https://github.com/flowinquiry/flowinquiry)
  1101→
  1102→**Files to modify:**
  1103→- `src/i18n.ts` (new)
  1104→- `src/messages/en.json` (new)
  1105→- `src/messages/es.json` (new)
  1106→- `src/middleware.ts` - locale detection
  1107→- Components - use useTranslations hook
  1108→
  1109→---
  1110→
  1111→## File Locations
  1112→
  1113→### Key Files to Modify
  1114→```
  1115→src/lib/faceiq-scoring.ts          # Scoring configs, ideal ranges, curves
  1116→src/contexts/ResultsContext.tsx     # Data transformation, flaw mappings
  1117→src/types/results.ts                # Type definitions
  1118→src/lib/recommendations/severity.ts # Flaw-to-treatment mapping
  1119→src/components/results/cards/       # UI components for flaws/strengths
  1120→```
  1121→
  1122→### FaceIQ Reference Data
  1123→```
  1124→/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/
  1125→├── FACEIQ-FRONT RATIOS.html   # Front profile metrics with curves
  1126→├── FACEIQ-SIDERATIOS.html     # Side profile metrics
  1127→├── FACEIQ-ALL.har             # API calls with full response data
  1128→├── FACEIQALL-HTML.html        # Full page capture
  1129→└── site-capture-*.json        # Additional capture data
  1130→```
  1131→
  1132→---
  1133→
  1134→## Metrics Updated This Session
  1135→
  1136→### Front Profile (Updated ideal ranges + maxScores)
  1137→| Metric | New Ideal | maxScore |
  1138→|--------|-----------|----------|
  1139→| Face Width to Height | 1.96-2.0 | 30 |
  1140→| Middle Third | 31.4-33.4% | 10 |
  1141→| Upper Third | 30-32% | 10 |
  1142→| Cheekbone Height | 83-100% | 15 |
  1143→| Midface Ratio | 0.97-1.0 | 12.5 |
  1144→| Jaw Frontal Angle | 86.5-92.5° | 20 |
  1145→| Bigonial Width | 87.75-91.75% | 15 |
  1146→| Lateral Canthal Tilt | 6.1-7.8° | 10 |
  1147→| Eye Aspect Ratio | 3.0-3.5 | 15 |
  1148→| Eye Separation | 45.7-46.8% | 10 |
  1149→| IPD-Mouth Ratio | 0.83-0.87 | 10 |
  1150→| Eyebrow Tilt | 6.5-11° | 10 |
  1151→| Eyebrow Low Setedness | 0-0.45 | 10 |
  1152→| Intercanthal-Nasal | 1.04-1.16 | 10 |
  1153→| Nose Tip Position | 0.5-3.5mm | 2.5 |
  1154→| Mouth/Nose Ratio | 1.43-1.51 | 10 |
  1155→| Lower/Upper Lip | 1.58-1.88 | 7.5 |
  1156→| Chin/Philtrum | 2.15-2.45 | 12.5 |
  1157→| IAA-JFA Deviation | 0-2.5° | 10 |
  1158→| Neck Width | 92-98% | 10 |
  1159→
  1160→### Side Profile (Updated ideal ranges)
  1161→| Metric | New Ideal |
  1162→|--------|-----------|
  1163→| Nasofrontal Angle | 116-128° |
  1164→| Nasofacial Angle | 31-35° |
  1165→| Nasomental Angle | 126-131° |
  1166→| Submental Cervical | 94-106° |
  1167→| Facial Depth/Height | 1.3-1.44 |
  1168→| Anterior Facial Depth | 64.5-67.5° |
  1169→| S-Line Lower Lip | -0.4 to 0.4mm |
  1170→
  1171→### New Metrics Added
  1172→- Ipsilateral Alar Angle (front)
  1173→- Ear Protrusion Angle (front)
  1174→- Ear Protrusion Ratio (front)
  1175→- Interior Midface Projection Angle (side)
  1176→- Recession from Frankfort Plane (side)
  1177→
  1178→---
  1179→
  1180→## Commands Reference
  1181→
  1182→### Run Type Check
  1183→```bash
  1184→cd /Users/imorgado/LOOKSMAXX/looksmaxx-app && npx tsc --noEmit
  1185→```
  1186→
  1187→### Run Lint
  1188→```bash
  1189→cd /Users/imorgado/LOOKSMAXX/looksmaxx-app && npm run lint
  1190→```
  1191→
  1192→### Extract FaceIQ Data
  1193→```bash
  1194→# Extract metric configs from HTML
  1195→cat "/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/FACEIQ-FRONT RATIOS.html" | sed 's/\\"/"/g' | grep -oE '"name":"[^"]+","value":[0-9.-]+.*?"idealMax":[0-9.-]+'
  1196→
  1197→# Extract flaw mappings
  1198→cat "/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/FACEIQ-FRONT RATIOS.html" | sed 's/\\"/"/g' | grep -oE '"mayIndicateFlaws":\[\{[^]]+'
  1199→
  1200→# Extract custom curves
  1201→cat "/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/FACEIQ-FRONT RATIOS.html" | sed 's/\\"/"/g' | grep -oE '"customPoints":\[[^\]]+\]'
  1202→```
  1203→
  1204→---
  1205→
  1206→## Continuation Prompt
  1207→
  1208→Use this prompt to continue this work:
  1209→
  1210→```
  1211→Continue work on LOOKSMAXX FaceIQ parity. Read /Users/imorgado/LOOKSMAXX/fixit.md for context.
  1212→
  1213→Current priorities:
  1214→1. Add detailed FLAW_MAPPINGS to faceiq-scoring.ts with FaceIQ's structure (category, flawName, confidence, severity, reasoning)
  1215→2. Extract and add custom Bezier curves for all metrics from the FaceIQ HTML files
  1216→3. Update ResultsContext.tsx to use the new flaw mappings
  1217→
  1218→Reference data is in /Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/
  1219→
  1220→Start with the flaw mappings - extract them from FACEIQ-FRONT RATIOS.html and create a comprehensive FLAW_MAPPINGS constant.
  1221→```
  1222→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
