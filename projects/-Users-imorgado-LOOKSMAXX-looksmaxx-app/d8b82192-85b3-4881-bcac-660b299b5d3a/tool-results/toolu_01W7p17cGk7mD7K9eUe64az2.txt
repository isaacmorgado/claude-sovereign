     1→'use client';
     2→
     3→import { useState, useEffect } from 'react';
     4→import { motion, AnimatePresence } from 'framer-motion';
     5→import Image from 'next/image';
     6→import {
     7→  LayoutDashboard,
     8→  User,
     9→  ScanFace,
    10→  Sparkles,
    11→  Settings,
    12→  HelpCircle,
    13→  Menu,
    14→  X,
    15→  ChevronRight,
    16→  Trophy,
    17→  Users,
    18→  Gauge,
    19→} from 'lucide-react';
    20→import { useResults } from '@/contexts/ResultsContext';
    21→import { useLeaderboardOptional } from '@/contexts/LeaderboardContext';
    22→import { ResultsTab } from '@/types/results';
    23→import { ScoreCircle, RankBadge } from './shared';
    24→import { api } from '@/lib/api';
    25→
    26→// ============================================
    27→// TAB NAVIGATION
    28→// ============================================
    29→
    30→interface TabConfig {
    31→  id: ResultsTab;
    32→  label: string;
    33→  icon: React.ReactNode;
    34→}
    35→
    36→const TABS: TabConfig[] = [
    37→  { id: 'overview', label: 'Overview', icon: <LayoutDashboard size={18} /> },
    38→  { id: 'front-ratios', label: 'Front Ratios', icon: <User size={18} /> },
    39→  { id: 'side-ratios', label: 'Side Ratios', icon: <ScanFace size={18} /> },
    40→  { id: 'leaderboard', label: 'Leaderboard', icon: <Trophy size={18} /> },
    41→  { id: 'psl', label: 'PSL Rating', icon: <Gauge size={18} /> },
    42→  { id: 'plan', label: 'Your Plan', icon: <Sparkles size={18} /> },
    43→  { id: 'community', label: 'Community', icon: <Users size={18} /> },
    44→  { id: 'options', label: 'Options', icon: <Settings size={18} /> },
    45→  { id: 'support', label: 'Support', icon: <HelpCircle size={18} /> },
    46→];
    47→
    48→// ============================================
    49→// SIDEBAR
    50→// ============================================
    51→
    52→interface SidebarProps {
    53→  onClose?: () => void;
    54→}
    55→
    56→function Sidebar({ onClose }: SidebarProps) {
    57→  const { activeTab, setActiveTab, overallScore, frontPhoto } = useResults();
    58→
    59→  return (
    60→    <div className="flex flex-col h-full bg-neutral-950 border-r border-neutral-800">
    61→      {/* Header */}
    62→      <div className="flex items-center justify-between p-4 border-b border-neutral-800">
    63→        <div className="flex items-center gap-2">
    64→          <div className="w-8 h-8 rounded-lg bg-gradient-to-br from-cyan-500 to-blue-600 flex items-center justify-center">
    65→            <ScanFace size={18} className="text-white" />
    66→          </div>
    67→          <span className="font-semibold text-white">LOOKSMAXX</span>
    68→        </div>
    69→        {onClose && (
    70→          <button
    71→            onClick={onClose}
    72→            className="p-2 hover:bg-neutral-800 rounded-lg transition-colors md:hidden"
    73→          >
    74→            <X size={20} className="text-neutral-400" />
    75→          </button>
    76→        )}
    77→      </div>
    78→
    79→      {/* Profile Photo & Score */}
    80→      <div className="p-4 border-b border-neutral-800">
    81→        <div className="relative aspect-square rounded-xl overflow-hidden bg-neutral-900 mb-3">
    82→          {frontPhoto ? (
    83→            <Image
    84→              src={frontPhoto}
    85→              alt="Your face"
    86→              fill
    87→              className="object-cover"
    88→              unoptimized
    89→            />
    90→          ) : (
    91→            <div className="w-full h-full flex items-center justify-center">
    92→              <User size={48} className="text-neutral-700" />
    93→            </div>
    94→          )}
    95→          {/* Score badge */}
    96→          <div className="absolute bottom-2 right-2">
    97→            <ScoreCircle score={overallScore} size="sm" animate={false} />
    98→          </div>
    99→        </div>
   100→        <div className="text-center">
   101→          <p className="text-sm text-neutral-400">Harmony Score</p>
   102→          <p className="text-2xl font-bold text-white">{overallScore.toFixed(2)}</p>
   103→          <div className="mt-2">
   104→            <RankBadge size="md" alwaysShow showPercentile />
   105→          </div>
   106→        </div>
   107→      </div>
   108→
   109→      {/* Navigation */}
   110→      <nav className="flex-1 p-2 overflow-y-auto">
   111→        {TABS.map((tab) => (
   112→          <button
   113→            key={tab.id}
   114→            onClick={() => {
   115→              setActiveTab(tab.id);
   116→              onClose?.();
   117→            }}
   118→            className={`w-full flex items-center gap-3 px-3 py-2.5 rounded-lg mb-1 transition-all ${
   119→              activeTab === tab.id
   120→                ? 'bg-cyan-500/20 text-cyan-400'
   121→                : 'text-neutral-400 hover:bg-neutral-800 hover:text-white'
   122→            }`}
   123→          >
   124→            {tab.icon}
   125→            <span className="font-medium">{tab.label}</span>
   126→            {activeTab === tab.id && (
   127→              <ChevronRight size={16} className="ml-auto" />
   128→            )}
   129→          </button>
   130→        ))}
   131→      </nav>
   132→
   133→      {/* Footer */}
   134→      <div className="p-4 border-t border-neutral-800">
   135→        <button className="w-full py-2.5 px-4 bg-gradient-to-r from-cyan-500 to-blue-600 text-white font-medium rounded-lg hover:from-cyan-400 hover:to-blue-500 transition-all">
   136→          New Analysis
   137→        </button>
   138→      </div>
   139→    </div>
   140→  );
   141→}
   142→
   143→// ============================================
   144→// FLOATING RANK CARD (Desktop)
   145→// ============================================
   146→
   147→function FloatingRankCard() {
   148→  const { setActiveTab } = useResults();
   149→  const leaderboard = useLeaderboardOptional();
   150→  const userRank = leaderboard?.userRank;
   151→  const isAuthenticated = !!api.getToken();
   152→
   153→  // Auto-fetch user's rank on mount if authenticated
   154→  useEffect(() => {
   155→    if (isAuthenticated && !userRank && leaderboard?.fetchMyRank) {
   156→      leaderboard.fetchMyRank();
   157→    }
   158→  }, [isAuthenticated, userRank, leaderboard]);
   159→
   160→  return (
   161→    <motion.button
   162→      initial={{ opacity: 0, y: -20 }}
   163→      animate={{ opacity: 1, y: 0 }}
   164→      onClick={() => setActiveTab('leaderboard')}
   165→      className="flex items-center gap-3 px-4 py-3 bg-neutral-900/95 backdrop-blur-sm border border-neutral-800 rounded-xl shadow-lg hover:border-yellow-500/30 transition-all group"
   166→    >
   167→      {userRank ? (
   168→        <>
   169→          <div className="flex items-center justify-center w-10 h-10 rounded-lg bg-gradient-to-br from-yellow-500/20 to-amber-500/20 border border-yellow-500/30">
   170→            <Trophy size={20} className="text-yellow-400" />
   171→          </div>
   172→          <div className="text-left">
   173→            <p className="text-xs text-neutral-500 uppercase tracking-wide">Your Rank</p>
   174→            <div className="flex items-baseline gap-2">
   175→              <span className="text-xl font-bold text-yellow-400">#{userRank.genderRank}</span>
   176→              <span className="text-xs text-neutral-500">Top {userRank.percentile.toFixed(1)}%</span>
   177→            </div>
   178→          </div>
   179→          <ChevronRight size={16} className="text-neutral-600 group-hover:text-yellow-400 transition-colors ml-1" />
   180→        </>
   181→      ) : (
   182→        <>
   183→          <div className="flex items-center justify-center w-10 h-10 rounded-lg bg-neutral-800 border border-neutral-700">
   184→            <Trophy size={20} className="text-neutral-500" />
   185→          </div>
   186→          <div className="text-left">
   187→            <p className="text-xs text-neutral-500 uppercase tracking-wide">Your Rank</p>
   188→            <span className="text-sm text-neutral-400">
   189→              {isAuthenticated ? 'Not ranked yet' : 'Sign in to rank'}
   190→            </span>
   191→          </div>
   192→          <ChevronRight size={16} className="text-neutral-600 group-hover:text-neutral-400 transition-colors ml-1" />
   193→        </>
   194→      )}
   195→    </motion.button>
   196→  );
   197→}
   198→
   199→// ============================================
   200→// MOBILE HEADER
   201→// ============================================
   202→
   203→interface MobileHeaderProps {
   204→  onMenuClick: () => void;
   205→}
   206→
   207→function MobileHeader({ onMenuClick }: MobileHeaderProps) {
   208→  const { activeTab, overallScore } = useResults();
   209→  const currentTab = TABS.find((t) => t.id === activeTab);
   210→
   211→  return (
   212→    <header className="flex items-center justify-between px-4 py-3 bg-neutral-950 border-b border-neutral-800">
   213→      <button
   214→        onClick={onMenuClick}
   215→        className="p-2 hover:bg-neutral-800 rounded-lg transition-colors"
   216→      >
   217→        <Menu size={20} className="text-neutral-400" />
   218→      </button>
   219→      <div className="flex items-center gap-2">
   220→        {currentTab?.icon}
   221→        <span className="font-medium text-white">{currentTab?.label}</span>
   222→      </div>
   223→      <div className="flex items-center gap-2">
   224→        <RankBadge size="sm" alwaysShow />
   225→        <div className="w-6 h-6 rounded-full bg-cyan-500/20 flex items-center justify-center">
   226→          <span className="text-xs text-cyan-400 font-bold">{Math.round(overallScore)}</span>
   227→        </div>
   228→      </div>
   229→    </header>
   230→  );
   231→}
   232→
   233→// ============================================
   234→// MAIN LAYOUT
   235→// ============================================
   236→
   237→interface ResultsLayoutProps {
   238→  children: React.ReactNode;
   239→}
   240→
   241→export function ResultsLayout({ children }: ResultsLayoutProps) {
   242→  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
   243→  const { activeTab } = useResults();
   244→
   245→  return (
   246→    <div className="flex min-h-screen bg-black">
   247→      {/* Desktop Sidebar */}
   248→      <aside className="hidden md:flex md:w-[280px] md:flex-col md:fixed md:inset-y-0 z-40">
   249→        <Sidebar />
   250→      </aside>
   251→
   252→      {/* Mobile Menu Overlay */}
   253→      <AnimatePresence>
   254→        {mobileMenuOpen && (
   255→          <>
   256→            <motion.div
   257→              initial={{ opacity: 0 }}
   258→              animate={{ opacity: 1 }}
   259→              exit={{ opacity: 0 }}
   260→              onClick={() => setMobileMenuOpen(false)}
   261→              className="fixed inset-0 bg-black/60 z-40 md:hidden"
   262→            />
   263→            <motion.aside
   264→              initial={{ x: -280 }}
   265→              animate={{ x: 0 }}
   266→              exit={{ x: -280 }}
   267→              transition={{ type: 'spring', damping: 25, stiffness: 200 }}
   268→              className="fixed inset-y-0 left-0 w-[280px] z-50 md:hidden"
   269→            >
   270→              <Sidebar onClose={() => setMobileMenuOpen(false)} />
   271→            </motion.aside>
   272→          </>
   273→        )}
   274→      </AnimatePresence>
   275→
   276→      {/* Main Content */}
   277→      <div className="flex-1 md:pl-[280px] flex flex-col min-h-screen">
   278→        {/* Mobile Header */}
   279→        <div className="md:hidden">
   280→          <MobileHeader onMenuClick={() => setMobileMenuOpen(true)} />
   281→        </div>
   282→
   283→        {/* Desktop Floating Rank Indicator */}
   284→        <div className="hidden md:block fixed top-4 right-4 z-30">
   285→          <FloatingRankCard />
   286→        </div>
   287→
   288→        {/* Content Area - no overflow so sticky works */}
   289→        <main className="flex-1">
   290→          <AnimatePresence mode="wait">
   291→            <motion.div
   292→              key={activeTab}
   293→              initial={{ opacity: 0, y: 10 }}
   294→              animate={{ opacity: 1, y: 0 }}
   295→              exit={{ opacity: 0, y: -10 }}
   296→              transition={{ duration: 0.2 }}
   297→            >
   298→              {children}
   299→            </motion.div>
   300→          </AnimatePresence>
   301→        </main>
   302→      </div>
   303→    </div>
   304→  );
   305→}
   306→
   307→// ============================================
   308→// TAB CONTENT WRAPPER
   309→// ============================================
   310→
   311→interface TabContentProps {
   312→  title: string;
   313→  subtitle?: string;
   314→  children: React.ReactNode;
   315→  rightContent?: React.ReactNode;
   316→}
   317→
   318→export function TabContent({ title, subtitle, children, rightContent }: TabContentProps) {
   319→  return (
   320→    <div className="p-4 md:p-6 lg:p-8 max-w-7xl mx-auto">
   321→      {/* Header */}
   322→      <div className="flex flex-col md:flex-row md:items-center md:justify-between mb-6">
   323→        <div>
   324→          <h1 className="text-2xl md:text-3xl font-bold text-white">{title}</h1>
   325→          {subtitle && (
   326→            <p className="text-neutral-400 mt-1">{subtitle}</p>
   327→          )}
   328→        </div>
   329→        {rightContent && (
   330→          <div className="mt-4 md:mt-0">{rightContent}</div>
   331→        )}
   332→      </div>
   333→
   334→      {/* Content */}
   335→      {children}
   336→    </div>
   337→  );
   338→}
   339→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
