     1→'use client';
     2→
     3→import { useMemo, useState } from 'react';
     4→import { motion } from 'framer-motion';
     5→import { Ruler, Info, TrendingUp, Calculator, AlertCircle } from 'lucide-react';
     6→import { useResults } from '@/contexts/ResultsContext';
     7→import { useHeightOptional } from '@/contexts/HeightContext';
     8→import { TabContent } from '../ResultsLayout';
     9→import { PSLScoreCard } from '@/components/psl/PSLScoreCard';
    10→import { PSLTierBadge } from '@/components/psl/PSLTierBadge';
    11→import { calculatePSL, getHeightRating, cmToFeetInches } from '@/lib/psl-calculator';
    12→import { TIER_DEFINITIONS, PSLResult } from '@/types/psl';
    13→
    14→// Height input form for users who skipped height entry
    15→function HeightInputPrompt({ onHeightSet }: { onHeightSet: (cm: number) => void }) {
    16→  const [feet, setFeet] = useState(5);
    17→  const [inches, setInches] = useState(9);
    18→
    19→  const handleSubmit = () => {
    20→    const totalInches = feet * 12 + inches;
    21→    const cm = Math.round(totalInches * 2.54);
    22→    onHeightSet(cm);
    23→  };
    24→
    25→  return (
    26→    <motion.div
    27→      initial={{ opacity: 0, y: 20 }}
    28→      animate={{ opacity: 1, y: 0 }}
    29→      className="bg-neutral-900 rounded-xl p-6 border border-neutral-800"
    30→    >
    31→      <div className="flex items-center gap-3 mb-4">
    32→        <div className="w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center">
    33→          <Ruler className="w-5 h-5 text-cyan-400" />
    34→        </div>
    35→        <div>
    36→          <h3 className="font-semibold text-white">Enter Your Height</h3>
    37→          <p className="text-sm text-neutral-400">Required for PSL calculation</p>
    38→        </div>
    39→      </div>
    40→
    41→      <div className="flex items-center gap-4 mb-4">
    42→        <div className="flex-1">
    43→          <label className="text-xs text-neutral-500 mb-1 block">Feet</label>
    44→          <select
    45→            value={feet}
    46→            onChange={(e) => setFeet(Number(e.target.value))}
    47→            className="w-full bg-neutral-800 border border-neutral-700 rounded-lg px-3 py-2 text-white"
    48→          >
    49→            {[4, 5, 6, 7].map((f) => (
    50→              <option key={f} value={f}>{f}&apos;</option>
    51→            ))}
    52→          </select>
    53→        </div>
    54→        <div className="flex-1">
    55→          <label className="text-xs text-neutral-500 mb-1 block">Inches</label>
    56→          <select
    57→            value={inches}
    58→            onChange={(e) => setInches(Number(e.target.value))}
    59→            className="w-full bg-neutral-800 border border-neutral-700 rounded-lg px-3 py-2 text-white"
    60→          >
    61→            {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11].map((i) => (
    62→              <option key={i} value={i}>{i}&quot;</option>
    63→            ))}
    64→          </select>
    65→        </div>
    66→      </div>
    67→
    68→      <button
    69→        onClick={handleSubmit}
    70→        className="w-full py-2.5 bg-cyan-500 text-black font-medium rounded-lg hover:bg-cyan-400 transition-colors"
    71→      >
    72→        Calculate PSL
    73→      </button>
    74→    </motion.div>
    75→  );
    76→}
    77→
    78→// Tier comparison visualization
    79→function TierComparisonChart({ currentTier, currentScore }: { currentTier: string; currentScore: number }) {
    80→  return (
    81→    <motion.div
    82→      initial={{ opacity: 0 }}
    83→      animate={{ opacity: 1 }}
    84→      transition={{ delay: 0.2 }}
    85→      className="bg-neutral-900 rounded-xl p-6 border border-neutral-800"
    86→    >
    87→      <h3 className="font-semibold text-white mb-4">Tier Distribution</h3>
    88→
    89→      <div className="space-y-3">
    90→        {TIER_DEFINITIONS.slice().reverse().map((tier) => {
    91→          const isCurrentTier = tier.name === currentTier;
    92→          const isPassed = currentScore >= tier.minScore;
    93→
    94→          return (
    95→            <div key={tier.name} className="flex items-center gap-3">
    96→              <div
    97→                className={`w-24 text-xs font-medium truncate ${
    98→                  isCurrentTier ? 'text-white' : 'text-neutral-500'
    99→                }`}
   100→              >
   101→                {tier.name}
   102→              </div>
   103→
   104→              <div className="flex-1 h-3 bg-neutral-800 rounded-full overflow-hidden relative">
   105→                {/* Tier range */}
   106→                <div
   107→                  className="absolute inset-y-0 rounded-full transition-all"
   108→                  style={{
   109→                    left: `${(tier.minScore / 10) * 100}%`,
   110→                    right: `${100 - (tier.maxScore / 10) * 100}%`,
   111→                    backgroundColor: isPassed ? tier.color : `${tier.color}40`,
   112→                  }}
   113→                />
   114→
   115→                {/* Current score marker */}
   116→                {isCurrentTier && (
   117→                  <motion.div
   118→                    initial={{ scale: 0 }}
   119→                    animate={{ scale: 1 }}
   120→                    className="absolute top-1/2 -translate-y-1/2 w-4 h-4 rounded-full bg-white border-2 shadow-lg"
   121→                    style={{
   122→                      left: `${(currentScore / 10) * 100}%`,
   123→                      borderColor: tier.color,
   124→                      transform: 'translateX(-50%) translateY(-50%)',
   125→                    }}
   126→                  />
   127→                )}
   128→              </div>
   129→
   130→              <div className={`w-16 text-right text-xs ${
   131→                isCurrentTier ? 'text-white font-semibold' : 'text-neutral-500'
   132→              }`}>
   133→                {tier.minScore.toFixed(1)} - {tier.maxScore.toFixed(1)}
   134→              </div>
   135→            </div>
   136→          );
   137→        })}
   138→      </div>
   139→
   140→      {/* Score scale */}
   141→      <div className="flex justify-between mt-4 text-xs text-neutral-500">
   142→        <span>0</span>
   143→        <span>2</span>
   144→        <span>4</span>
   145→        <span>6</span>
   146→        <span>8</span>
   147→        <span>10</span>
   148→      </div>
   149→    </motion.div>
   150→  );
   151→}
   152→
   153→// PSL Formula explanation
   154→function PSLFormulaExplainer() {
   155→  return (
   156→    <motion.div
   157→      initial={{ opacity: 0 }}
   158→      animate={{ opacity: 1 }}
   159→      transition={{ delay: 0.3 }}
   160→      className="bg-neutral-900 rounded-xl p-6 border border-neutral-800"
   161→    >
   162→      <div className="flex items-center gap-2 mb-4">
   163→        <Calculator className="w-5 h-5 text-cyan-400" />
   164→        <h3 className="font-semibold text-white">How PSL is Calculated</h3>
   165→      </div>
   166→
   167→      <div className="bg-neutral-800/50 rounded-lg p-4 mb-4 font-mono text-sm">
   168→        <span className="text-cyan-400">PSL</span>
   169→        <span className="text-neutral-400"> = </span>
   170→        <span className="text-purple-400">(Face × 0.75)</span>
   171→        <span className="text-neutral-400"> + </span>
   172→        <span className="text-green-400">(Height × 0.20)</span>
   173→        <span className="text-neutral-400"> + </span>
   174→        <span className="text-orange-400">(Body × 0.05)</span>
   175→        <span className="text-neutral-400"> + </span>
   176→        <span className="text-yellow-400">Bonuses</span>
   177→      </div>
   178→
   179→      <div className="space-y-3 text-sm">
   180→        <div className="flex items-start gap-2">
   181→          <span className="text-purple-400 font-semibold w-16">Face</span>
   182→          <span className="text-neutral-400">
   183→            Your facial harmony score (75% weight) - the primary driver of attractiveness
   184→          </span>
   185→        </div>
   186→        <div className="flex items-start gap-2">
   187→          <span className="text-green-400 font-semibold w-16">Height</span>
   188→          <span className="text-neutral-400">
   189→            Your height rating (20% weight) - varies by gender
   190→          </span>
   191→        </div>
   192→        <div className="flex items-start gap-2">
   193→          <span className="text-orange-400 font-semibold w-16">Body</span>
   194→          <span className="text-neutral-400">
   195→            Body composition (5% weight) - defaults to 5/10 without AI vision
   196→          </span>
   197→        </div>
   198→        <div className="flex items-start gap-2">
   199→          <span className="text-yellow-400 font-semibold w-16">Bonuses</span>
   200→          <span className="text-neutral-400">
   201→            Threshold (+0.1-0.3) and synergy (+0.05-0.35) bonuses for elite scores (≥8.5)
   202→          </span>
   203→        </div>
   204→      </div>
   205→
   206→      <div className="mt-4 p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg flex items-start gap-2">
   207→        <AlertCircle className="w-4 h-4 text-amber-400 flex-shrink-0 mt-0.5" />
   208→        <p className="text-xs text-amber-200">
   209→          Height ≥8.0 rating is required to reach Gigachad tier. Major facial flaws cap your tier regardless of score.
   210→        </p>
   211→      </div>
   212→    </motion.div>
   213→  );
   214→}
   215→
   216→// Main PSL Tab component
   217→export function PSLTab() {
   218→  const { overallScore, gender } = useResults();
   219→  const heightContext = useHeightOptional();
   220→
   221→  // Local state for height if context not available
   222→  const [localHeightCm, setLocalHeightCm] = useState<number | null>(null);
   223→
   224→  // Get height from context or local state
   225→  const heightCm = heightContext?.heightCm ?? localHeightCm;
   226→  const setHeightCm = heightContext?.setHeightCm ?? setLocalHeightCm;
   227→
   228→  // Calculate PSL using the face score and height
   229→  const pslResult: PSLResult | null = useMemo(() => {
   230→    if (!heightCm || !overallScore) return null;
   231→
   232→    // Use the overall harmony score as the face score
   233→    const faceScore = overallScore;
   234→    const currentGender = gender || 'male';
   235→
   236→    return calculatePSL({
   237→      faceScore,
   238→      heightCm,
   239→      gender: currentGender,
   240→      // No body analysis for now (defaults to 5.0)
   241→    });
   242→  }, [heightCm, overallScore, gender]);
   243→
   244→  // Get height rating for display
   245→  const heightRating = heightCm ? getHeightRating(heightCm, gender || 'male') : null;
   246→  const heightDisplay = heightCm ? cmToFeetInches(heightCm) : null;
   247→
   248→  return (
   249→    <TabContent
   250→      title="PSL Rating"
   251→      subtitle="Your Pretty Scale Level score based on face, height, and body"
   252→    >
   253→      {/* Height prompt if not set */}
   254→      {!heightCm && (
   255→        <div className="mb-6">
   256→          <HeightInputPrompt onHeightSet={setHeightCm} />
   257→        </div>
   258→      )}
   259→
   260→      {/* PSL Results */}
   261→      {pslResult && (
   262→        <div className="space-y-6">
   263→          {/* Main score card */}
   264→          <PSLScoreCard psl={pslResult} showBreakdown showPotential />
   265→
   266→          {/* Height info */}
   267→          {heightDisplay && (
   268→            <motion.div
   269→              initial={{ opacity: 0, y: 10 }}
   270→              animate={{ opacity: 1, y: 0 }}
   271→              className="bg-neutral-900 rounded-xl p-4 border border-neutral-800"
   272→            >
   273→              <div className="flex items-center justify-between">
   274→                <div className="flex items-center gap-3">
   275→                  <div className="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center">
   276→                    <Ruler className="w-5 h-5 text-green-400" />
   277→                  </div>
   278→                  <div>
   279→                    <p className="text-sm text-neutral-400">Your Height</p>
   280→                    <p className="text-lg font-semibold text-white">
   281→                      {heightDisplay.feet}&apos;{heightDisplay.inches}&quot; ({heightCm}cm)
   282→                    </p>
   283→                  </div>
   284→                </div>
   285→                <div className="text-right">
   286→                  <p className="text-sm text-neutral-400">Height Rating</p>
   287→                  <p className="text-lg font-bold text-green-400">
   288→                    {heightRating?.toFixed(1)}/10
   289→                  </p>
   290→                </div>
   291→              </div>
   292→            </motion.div>
   293→          )}
   294→
   295→          {/* Tier comparison */}
   296→          <TierComparisonChart
   297→            currentTier={pslResult.tier}
   298→            currentScore={pslResult.score}
   299→          />
   300→
   301→          {/* Formula explainer */}
   302→          <PSLFormulaExplainer />
   303→
   304→          {/* Potential improvements */}
   305→          {pslResult.potential > pslResult.score && (
   306→            <motion.div
   307→              initial={{ opacity: 0 }}
   308→              animate={{ opacity: 1 }}
   309→              transition={{ delay: 0.4 }}
   310→              className="bg-gradient-to-r from-green-500/10 to-cyan-500/10 rounded-xl p-6 border border-green-500/20"
   311→            >
   312→              <div className="flex items-center gap-3 mb-4">
   313→                <TrendingUp className="w-6 h-6 text-green-400" />
   314→                <h3 className="font-semibold text-white">Improvement Potential</h3>
   315→              </div>
   316→
   317→              <div className="grid grid-cols-2 gap-4 mb-4">
   318→                <div className="bg-neutral-900/50 rounded-lg p-4 text-center">
   319→                  <p className="text-sm text-neutral-400 mb-1">Current</p>
   320→                  <p className="text-2xl font-bold text-white">{pslResult.score.toFixed(2)}</p>
   321→                  <PSLTierBadge tier={pslResult.tier} size="sm" />
   322→                </div>
   323→                <div className="bg-neutral-900/50 rounded-lg p-4 text-center">
   324→                  <p className="text-sm text-neutral-400 mb-1">Potential</p>
   325→                  <p className="text-2xl font-bold text-green-400">{pslResult.potential.toFixed(2)}</p>
   326→                  <p className="text-xs text-green-400 mt-1">
   327→                    +{(pslResult.potential - pslResult.score).toFixed(2)} gain
   328→                  </p>
   329→                </div>
   330→              </div>
   331→
   332→              <div className="space-y-2 text-sm text-neutral-400">
   333→                <p>To reach your potential:</p>
   334→                <ul className="list-disc list-inside space-y-1 text-neutral-300">
   335→                  <li>Optimize body composition (target 12-15% body fat)</li>
   336→                  <li>Follow personalized skincare and grooming</li>
   337→                  <li>Address soft tissue improvements from your plan</li>
   338→                </ul>
   339→              </div>
   340→            </motion.div>
   341→          )}
   342→        </div>
   343→      )}
   344→
   345→      {/* Info section */}
   346→      <motion.div
   347→        initial={{ opacity: 0 }}
   348→        animate={{ opacity: 1 }}
   349→        transition={{ delay: 0.5 }}
   350→        className="mt-6 p-4 bg-neutral-900/50 rounded-lg border border-neutral-800"
   351→      >
   352→        <div className="flex items-start gap-2">
   353→          <Info className="w-4 h-4 text-neutral-500 flex-shrink-0 mt-0.5" />
   354→          <p className="text-xs text-neutral-500">
   355→            PSL (Pretty Scale Level) is a comprehensive attractiveness rating that combines
   356→            facial harmony (75%), height (20%), and body composition (5%). Bonuses are applied
   357→            for exceptional scores (≥8.5) in any category, with synergy bonuses for multiple
   358→            high-scoring areas.
   359→          </p>
   360→        </div>
   361→      </motion.div>
   362→    </TabContent>
   363→  );
   364→}
   365→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
