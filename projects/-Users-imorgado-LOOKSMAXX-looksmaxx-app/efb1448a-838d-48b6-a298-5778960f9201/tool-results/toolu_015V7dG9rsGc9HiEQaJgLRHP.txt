     1â†’(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,664659,e=>{"use strict";let t=(0,e.i(475254).default)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);e.s(["ChevronDown",()=>t],664659)},655900,e=>{"use strict";let t=(0,e.i(475254).default)("chevron-up",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);e.s(["ChevronUp",()=>t],655900)},952571,e=>{"use strict";let t=(0,e.i(475254).default)("info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);e.s(["Info",()=>t],952571)},910510,e=>{"use strict";var t=e.i(271645);function i(e,a=!0){let o=(0,t.useRef)(!1),r=(0,t.useRef)([]);(0,t.useEffect)(()=>{if(!a||o.current||0===e.length)return;o.current=!0;let t=()=>{let t=Array.from(new Set([...e.map(e=>e.referenceImage).filter(e=>e&&e.length>0),...e.map(e=>`/images/landmarks/infographic/${e.key}.webp`).filter(e=>e&&e.length>0)]));t.forEach(e=>{let t=document.createElement("link");t.rel="preload",t.as="image",t.href=e,t.fetchPriority="high",document.head.appendChild(t),r.current.push(t)}),Promise.all(t.map(e=>new Promise(t=>{if(!e)return void t();let i=new Image;"fetchPriority"in i&&(i.fetchPriority="high"),i.onload=()=>t(),i.onerror=()=>t(),i.src=e})))};return"complete"===document.readyState?setTimeout(t,0):window.addEventListener("load",t,{once:!0}),()=>{r.current.forEach(e=>{e.parentNode&&e.parentNode.removeChild(e)}),r.current=[]}},[e,a])}e.s(["usePreloadLandmarkImages",()=>i])},320910,e=>{"use strict";let t=null,i=null,a=null,o=null,r=!1,n=["Created TensorFlow Lite XNNPACK delegate for CPU","INFO: Created TensorFlow Lite XNNPACK delegate","TensorFlow Lite","XNNPACK","INFO:"];function l(e){return(...t)=>{let i;i=Array.isArray(t)?t.join(" "):String(t),n.some(e=>i.includes(e))||e.apply(console,t)}}let s=e=>{let t=null,i=-1;for(let a of e){let e=1e9,o=1e9,r=-1e9,n=-1e9;for(let t of a)e=Math.min(e,t.x),o=Math.min(o,t.y),r=Math.max(r,t.x),n=Math.max(n,t.y);let l=(r-e)*(n-o);l>i&&(i=l,t=a)}return t},h=null,d=null,c=async()=>h||d||(d=(async()=>{try{let n;r||(t=console.error,i=console.info,a=console.log,o=console.warn,console.error=l(t),console.info=l(i),console.log=l(a),console.warn=l(o),r=!0);let{FaceLandmarker:s,FilesetResolver:d}=await e.A(826368);for(let e of["https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm","https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm/"])try{let t=await d.forVisionTasks(e),i=await s.createFromOptions(t,{baseOptions:{modelAssetPath:"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task",delegate:"CPU"},runningMode:"IMAGE",numFaces:3,outputFaceBlendshapes:!1,outputFacialTransformationMatrixes:!1});return h=i,console.log("MediaPipe Face Landmarker initialized successfully"),i}catch(t){n=t,console.error("MediaPipe init failed for",e,t)}throw n||Error("MediaPipe initialization failed")}catch(e){throw console.error("Failed to initialize MediaPipe:",e),d=null,e}})());async function f(e){try{let t,i,a,o=await c();if(e instanceof HTMLImageElement)(t=document.createElement("canvas")).width=e.naturalWidth||e.width,t.height=e.naturalHeight||e.height,t.getContext("2d").drawImage(e,0,0);else throw Error("Invalid image input. Must be an HTMLImageElement");try{i=o.detect(t),a=i?.faceLandmarks||[]}catch(e){console.warn("MediaPipe detection had a minor issue, but continuing:",e.message);try{await new Promise(e=>setTimeout(e,100)),i=o.detect(t),a=i?.faceLandmarks||[]}catch(e){console.warn("Face detection failed after retry:",e.message),a=[]}}if(!a.length)throw Error("No face detected in the image");let r=s(a);if(!r)throw Error("No face detected in the image");return{standardizedImage:((e,t)=>{var i;let a,o,r,n,l=e.width,s=e.height,h=t.map(e=>({x:e.x*l,y:e.y*s})),d=h[33],c=h[263],f={x:(d.x+c.x)/2,y:(d.y+c.y)/2},p=Math.atan2(c.y-d.y,c.x-d.x),m=f.x,u=f.y,g=e=>{let t=Math.sin(-p),i=Math.cos(-p),a=e.x-m,o=e.y-u;return{x:m+a*i-o*t,y:u+a*t+o*i}},w=g(h[152]||f),y=g(h[10]||f),k=g(f),b=Math.max(8,w.y-y.y);if(!(b>0&&isFinite(b))){let e=h[152]||f;b=Math.hypot(e.x-f.x,e.y-f.y)/.55}let x=Math.min(Math.max(32,(b*=1.12)/.65),2*Math.max(l,s)),T=k.y-.5*x,F=(i=m-x/2,(a=document.createElement("canvas")).width=e.width,a.height=e.height,(o=a.getContext("2d")).fillStyle="white",o.fillRect(0,0,a.width,a.height),o.save(),o.translate(m,u),o.rotate(-p),o.translate(-m,-u),o.drawImage(e,0,0),o.restore(),(r=document.createElement("canvas")).width=Math.max(1,Math.round(x)),r.height=Math.max(1,Math.round(x)),(n=r.getContext("2d")).fillStyle="white",n.fillRect(0,0,r.width,r.height),n.drawImage(a,Math.round(i),Math.round(T),Math.round(x),Math.round(x),0,0,r.width,r.height),r),L=document.createElement("canvas");L.width=1024,L.height=1024;let E=L.getContext("2d");return E.imageSmoothingQuality="high",E.fillStyle="white",E.fillRect(0,0,1024,1024),E.drawImage(F,0,0,F.width,F.height,0,0,1024,1024),L})(t,r)}}catch(e){throw console.error("Face standardization failed:",e),e}}let p={hairline:10,leftEyePupil:468,rightEyePupil:473,noseLeft:48,noseRight:278,lowerLip:17,chinBottom:152,leftEyeMedialCanthus:133,leftEyeLateralCanthus:33,leftEyeUpperEyelid:470,leftEyeLowerEyelid:472,leftEyelidHoodEnd:247,leftBrowHead:107,leftBrowInnerCorner:55,leftBrowArch:52,leftBrowPeak:105,leftBrowTail:70,leftUpperEyelidCrease:470,rightEyeMedialCanthus:362,rightEyeLateralCanthus:263,rightEyeUpperEyelid:475,rightEyeLowerEyelid:374,rightEyelidHoodEnd:467,rightBrowHead:336,rightBrowInnerCorner:285,rightBrowArch:282,rightBrowPeak:334,rightBrowTail:276,rightUpperEyelidCrease:475,nasalBase:290,noseBottom:2,leftNoseBridge:174,rightNoseBridge:399,cupidsBow:267,innerCupidsBow:0,mouthMiddle:14,mouthLeft:61,mouthRight:306,chinLeft:176,chinRight:400,leftCheek:234,rightCheek:454,leftTemple:54,rightTemple:284,leftOuterEar:127,rightOuterEar:356,leftTopGonion:58,leftBottomGonion:172,rightTopGonion:288,rightBottomGonion:397,neckLeft:172,neckRight:397},m={hairline:{yOffset:-.06},leftEyePupil:{xOffset:.0015,yOffset:-.005},rightEyePupil:{xOffset:-.0015,yOffset:-.005},noseLeft:{xOffset:.0025},noseRight:{xOffset:-.0025},leftTemple:{yOffset:-.01},rightTemple:{yOffset:-.01},leftOuterEar:{xOffset:-.04},rightOuterEar:{xOffset:.04},neckLeft:{xOffset:0,yOffset:.05},neckRight:{xOffset:0,yOffset:.05},leftUpperEyelidCrease:{yOffset:-.015},rightUpperEyelidCrease:{yOffset:-.015}};async function u(){try{await c()}catch(e){console.warn("MediaPipe preload failed:",e)}}async function g(e,t,i){try{let a,o,r,n,l=await c(),h=document.createElement("canvas");h.width=e.naturalWidth||e.width,h.height=e.naturalHeight||e.height,h.getContext("2d").drawImage(e,0,0);let d=l.detect(h),f=d?.faceLandmarks||[];if(!f.length)return null;let u=s(f);if(!u)return null;let g=h.width,w=h.height,y=g/w;y>t/i?(a=t,o=t/y,r=0,n=(i-o)/2):(o=i,a=i*y,r=(t-a)/2,n=0);let k={};for(let[e,t]of Object.entries(p))if(u[t]){let i=u[t],l=i.x*a+r,s=i.y*o+n,h=m[e];h&&(h.xOffset&&(l+=a*h.xOffset),h.yOffset&&(s+=o*h.yOffset)),k[e]={x:l,y:s}}return k}catch(e){return console.error("Face landmark detection error:",e),null}}e.s(["detectFrontLandmarks",()=>g,"preloadMediaPipe",()=>u,"standardizeFaceImage",()=>f],320910)},837647,e=>{"use strict";let t=(0,e.i(475254).default)("undo-2",[["path",{d:"M9 14 4 9l5-5",key:"102s5s"}],["path",{d:"M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11",key:"f3b9sd"}]]);e.s(["Undo2",()=>t],837647)},373375,e=>{"use strict";let t=(0,e.i(475254).default)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);e.s(["ChevronLeft",()=>t],373375)},463059,e=>{"use strict";let t=(0,e.i(475254).default)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);e.s(["ChevronRight",()=>t],463059)},767850,293060,e=>{"use strict";let t={hairline:{description:"The hairline represents the junction between the scalp and forehead skin. Located at the highest point of the forehead where hair growth begins.",name:"Hairline",scientificName:"Trichion (frontal view)",path:"landmarksFront/hairline",howToFind:"Identify the highest point of the frontal hairline in the middle of the forehead."},leftTemple:{description:"The left temporal region landmark, located at the side of the forehead above the eyebrow.",name:"Left Temple",scientificName:"Left Temporal Point",path:"landmarksFront/leftTemple",howToFind:"Mark the widest point of the hairline on the left side, halfway between the hairline and eyebrow."},rightTemple:{description:"The right temporal region landmark, located at the side of the forehead above the eyebrow.",name:"Right Temple",scientificName:"Right Temporal Point",path:"landmarksFront/rightTemple",howToFind:"Mark the widest point of the hairline on the right side, halfway between the hairline and eyebrow."},leftOuterEar:{description:"The outermost point of the left ear attachment to the head.",name:"Left Outer Ear",scientificName:"Left Auricular Lateral Point",path:"landmarksFront/leftOuterEar",howToFind:"Locate the most protruded point of the left ear on the side of the head."},rightOuterEar:{description:"The outermost point of the right ear attachment to the head.",name:"Right Outer Ear",scientificName:"Right Auricular Lateral Point",path:"landmarksFront/rightOuterEar",howToFind:"Locate the most protruded point of the right ear on the side of the head."},leftBrowHead:{description:"The starting point of the left eyebrow, closest to the nose.",name:"Left Brow Head",scientificName:"Left Supercilium Medialis",path:"landmarksFront/leftBrowHead",howToFind:"Locate the innermost and highest point of the left eyebrow, at the edge where brow hairs end."},leftBrowInnerCorner:{description:"The inner corner point of the left eyebrow area.",name:"Left Brow Inner Corner",scientificName:"Left Supercilium Medial Corner",path:"landmarksFront/leftBrowInnerCorner",howToFind:"Locate the lowest point at the inner edge of the left eyebrow, where brow hairs end."},leftBrowArch:{description:"The highest point of the left eyebrow arch.",name:"Left Brow Arch",scientificName:"Left Supercilium Superior",path:"landmarksFront/leftBrowArch",howToFind:"Find the highest point along the lower side of the left eyebrow, where the brow reaches its peak."},leftBrowPeak:{description:"The peak point of the left eyebrow, often the most prominent part of the arch.",name:"Left Brow Peak",scientificName:"Left Supercilium Apex",path:"landmarksFront/leftBrowPeak",howToFind:"Identify the most elevated point along the top of the left eyebrow, which may be slightly to the right or left of the arch."},rightBrowHead:{description:"The starting point of the right eyebrow, closest to the nose.",name:"Right Brow Head",scientificName:"Right Supercilium Medialis",path:"landmarksFront/rightBrowHead",howToFind:"Locate the innermost and highest point of the right eyebrow, at the edge where brow hairs end."},rightBrowInnerCorner:{description:"The inner corner point of the right eyebrow area.",name:"Right Brow Inner Corner",scientificName:"Right Supercilium Medial Corner",path:"landmarksFront/rightBrowInnerCorner",howToFind:"Locate the lowest point at the inner edge of the right eyebrow, where brow hairs end."},rightBrowArch:{description:"The highest point of the right eyebrow arch.",name:"Right Brow Arch",scientificName:"Right Supercilium Superior",path:"landmarksFront/rightBrowArch",howToFind:"Find the highest point along the lower side of the right eyebrow, where the brow reaches its peak."},rightBrowPeak:{description:"The peak point of the right eyebrow, often the most prominent part of the arch.",name:"Right Brow Peak",scientificName:"Right Supercilium Apex",path:"landmarksFront/rightBrowPeak",howToFind:"Identify the most elevated point along the top of the right eyebrow, which may be slightly to the right or left of the arch."},leftBrowTail:{description:"The outer endpoint of the left eyebrow, closest to the cheekbone.",name:"Left Brow Tail",scientificName:"Left Supercilium Lateralis",path:"landmarksFront/leftBrowTail",howToFind:"Locate the outermost point of the left eyebrow where the brow hairs taper off toward the temple."},rightBrowTail:{description:"The outer endpoint of the right eyebrow, closest to the cheekbone.",name:"Right Brow Tail",scientificName:"Right Supercilium Lateralis",path:"landmarksFront/rightBrowTail",howToFind:"Locate the outermost point of the right eyebrow where the brow hairs taper off toward the temple."},leftEyeMedialCanthus:{description:"The inner corner of the left eye where the upper and lower eyelids meet.",name:"Left Medial Canthus",scientificName:"Left Canthus Medialis",path:"landmarksFront/leftEyeMedialCanthus",howToFind:"Locate the inner corner of the left eye."},leftEyeLateralCanthus:{description:"The outer corner of the left eye where the upper and lower eyelids meet.",name:"Left Lateral Canthus",scientificName:"Left Canthus Lateralis",path:"landmarksFront/leftEyeLateralCanthus",howToFind:"Locate the outer corner of the left eye where the eyelids meet."},leftEyePupil:{description:"The center of the left eye's pupil.",name:"Left Pupil",scientificName:"Left Pupilla",path:"landmarksFront/leftEyePupil",howToFind:"Mark the center of the left eye's pupil."},leftEyeUpperEyelid:{description:"The highest point of the left upper eyelid.",name:"Left Upper Eyelid",scientificName:"Left Palpebra Superior",path:"landmarksFront/leftEyeUpperEyelid",howToFind:"Identify the highest point of the left upper eyelid, above the iris."},leftEyeLowerEyelid:{description:"The lowest point of the left lower eyelid.",name:"Left Lower Eyelid",scientificName:"Left Palpebra Inferior",path:"landmarksFront/leftEyeLowerEyelid",howToFind:"Identify the lowest point of the left lower eyelid, below the iris."},leftEyelidHoodEnd:{description:"The lateral end of the left upper eyelid fold where hooding is assessed.",name:"Left Eyelid Hood End",scientificName:"Left Sulcus Palpebralis Lateralis",path:"landmarksFront/leftEyelidHoodEnd",howToFind:"Locate the outer end of the left upper eyelid fold, just outside the outer corner of the eye."},leftUpperEyelidCrease:{description:"The crease line of the left upper eyelid where the eyelid folds when the eye is open.",name:"Left Upper Eyelid Crease",scientificName:"Left Pretarsal Skin Crease",path:"landmarksFront/leftUpperEyelidCrease",howToFind:"Locate the horizontal fold line on the left upper eyelid, visible when the eye is open, above the lash line. This may be directly in-line with the upper eyelid point if there is no visible upper eyelid exposure"},rightEyeMedialCanthus:{description:"The inner corner of the right eye where the upper and lower eyelids meet.",name:"Right Medial Canthus",scientificName:"Right Canthus Medialis",path:"landmarksFront/rightEyeMedialCanthus",howToFind:"Locate the inner corner of the right eye."},rightEyeLateralCanthus:{description:"The outer corner of the right eye where the upper and lower eyelids meet.",name:"Right Lateral Canthus",scientificName:"Right Canthus Lateralis",path:"landmarksFront/rightEyeLateralCanthus",howToFind:"Locate the outer corner of the right eye where the eyelids meet."},rightEyePupil:{description:"The center of the right eye's pupil.",name:"Right Pupil",scientificName:"Right Pupilla",path:"landmarksFront/rightEyePupil",howToFind:"Mark the center of the right eye's pupil."},rightEyeUpperEyelid:{description:"The highest point of the right upper eyelid.",name:"Right Upper Eyelid",scientificName:"Right Palpebra Superior",path:"landmarksFront/rightEyeUpperEyelid",howToFind:"Identify the highest point of the right upper eyelid, above the iris."},rightEyeLowerEyelid:{description:"The lowest point of the right lower eyelid.",name:"Right Lower Eyelid",scientificName:"Right Palpebra Inferior",path:"landmarksFront/rightEyeLowerEyelid",howToFind:"Identify the lowest point of the right lower eyelid, below the iris."},rightEyelidHoodEnd:{description:"The lateral end of the right upper eyelid fold where hooding is assessed.",name:"Right Eyelid Hood End",scientificName:"Right Sulcus Palpebralis Lateralis",path:"landmarksFront/rightEyelidHoodEnd",howToFind:"Locate the outer end of the right upper eyelid fold, just outside the outer corner of the eye."},rightUpperEyelidCrease:{description:"The crease line of the right upper eyelid where the eyelid folds when the eye is open.",name:"Right Upper Eyelid Crease",scientificName:"Right Pretarsal Skin Crease",path:"landmarksFront/rightUpperEyelidCrease",howToFind:"Locate the horizontal fold line on the right upper eyelid, visible when the eye is open, above the lash line. This may be directly in-line with the upper eyelid point if there is no visible upper eyelid exposure"},noseLeft:{description:"The left side of the nose at its widest point.",name:"Left Nose Side",scientificName:"Left Ala Nasi",path:"landmarksFront/noseLeft",howToFind:"Mark the leftmost point of the nose at the widest part of the nostrils."},noseRight:{description:"The right side of the nose at its widest point.",name:"Right Nose Side",scientificName:"Right Ala Nasi",path:"landmarksFront/noseRight",howToFind:"Mark the rightmost point of the nose at the widest part of the nostrils."},leftNoseBridge:{description:"The left edge of the nasal bridge.",name:"Left Nose Bridge",scientificName:"Left Dorsum Nasi",path:"landmarksFront/leftNoseBridge",howToFind:"Locate the left edge of the nose bridge, where it transitions from the nasal bone to the facial skin, typically around the middle of the nose."},rightNoseBridge:{description:"The right edge of the nasal bridge.",name:"Right Nose Bridge",scientificName:"Right Dorsum Nasi",path:"landmarksFront/rightNoseBridge",howToFind:"Locate the right edge of the nose bridge, where it transitions from the nasal bone to the facial skin, typically around the middle of the nose."},nasalBase:{description:"The base of the nose.",name:"Nasal Base",scientificName:"Nasal Base",path:"landmarksFront/nasalBase",howToFind:"Locate the base of the nose where the lower nostril ends, typically to the right of the nose tip."},noseBottom:{description:"The bottom point of the nose between the nostrils.",name:"Nose Bottom",scientificName:"Subnasale",path:"landmarksFront/noseBottom",howToFind:"Locate the lowest point of the nose tip around the middle of the nose."},leftCheek:{description:"The most prominent point of the left cheekbone.",name:"Left Cheekbone",scientificName:"Left Zygion",path:"landmarksFront/leftCheek",howToFind:"Locate the most laterally prominent point of the left cheekbone, typically the widest part of the midface."},rightCheek:{description:"The most prominent point of the right cheekbone.",name:"Right Cheekbone",scientificName:"Right Zygion",path:"landmarksFront/rightCheek",howToFind:"Locate the most laterally prominent point of the right cheekbone, typically the widest part of the midface."},mouthLeft:{description:"The left corner of the mouth where the lips meet.",name:"Left Mouth Corner",scientificName:"Left Cheilion",path:"landmarksFront/mouthLeft",howToFind:"Mark the leftmost corner of the mouth, where the lip border ends."},mouthRight:{description:"The right corner of the mouth where the lips meet.",name:"Right Mouth Corner",scientificName:"Right Cheilion",path:"landmarksFront/mouthRight",howToFind:"Mark the rightmost corner of the mouth, where the lip border ends."},cupidsBow:{description:"The center peak of the upper lip, forming the characteristic 'cupid's bow' shape.",name:"Cupid's Bow",scientificName:"Labrale Superius",path:"landmarksFront/cupidsBow",howToFind:"Locate the highest point of the upper lip, typically to the right or left of center."},innerCupidsBow:{description:"The inner dip of the cupid's bow at the center of the upper lip vermilion border.",name:"Inner Cupid's Bow",scientificName:"Cupid's Bow",path:"landmarksFront/innerCupidsBow",howToFind:"Mark the central dip between the two peaks of the cupid's bow, at the vermilion border of the upper lip."},mouthMiddle:{description:"The center point of the mouth.",name:"Mouth Middle",scientificName:"Mouth Middle",path:"landmarksFront/mouthMiddle",howToFind:"Locate the center point of the mouth, where the upper and lower lips meet."},lowerLip:{description:"The center point of the lower lip at its fullest part.",name:"Lower Lip Center",scientificName:"Labrale Inferius",path:"landmarksFront/lowerLip",howToFind:"Mark the center of the lower lip at the most prominent or fullest part."},leftTopGonion:{description:"The upper angle point of the left jaw.",name:"Left Upper Jaw Angle",scientificName:"Left Gonion Superior",path:"landmarksFront/leftTopGonion",howToFind:"Locate the upper part of the left jaw angle where it begins to curve, typically the most prominent point near mouth level."},rightTopGonion:{description:"The upper angle point of the right jaw.",name:"Right Upper Jaw Angle",scientificName:"Right Gonion Superior",path:"landmarksFront/rightTopGonion",howToFind:"Locate the upper part of the right jaw angle where it begins to curve, typically the most prominent point near mouth level."},leftBottomGonion:{description:"The lower angle point of the left jaw.",name:"Left Lower Jaw Angle",scientificName:"Left Gonion Inferior",path:"landmarksFront/leftBottomGonion",howToFind:"Locate the lower part of the left jaw angle below the upper angle, where the jaw curves toward the chin."},rightBottomGonion:{description:"The lower angle point of the right jaw.",name:"Right Lower Jaw Angle",scientificName:"Right Gonion Inferior",path:"landmarksFront/rightBottomGonion",howToFind:"Locate the lower part of the right jaw angle below the upper angle, where the jaw curves toward the chin."},chinLeft:{description:"The left side point of the chin.",name:"Left Chin",scientificName:"Left Mentum Lateralis",path:"landmarksFront/chinLeft",howToFind:"Mark the left side of the chin, where the chin begins to curve and form an angle."},chinRight:{description:"The right side point of the chin.",name:"Right Chin",scientificName:"Right Mentum Lateralis",path:"landmarksFront/chinRight",howToFind:"Mark the right side of the chin, where the chin begins to curve and form an angle."},chinBottom:{description:"The lowest point of the chin.",name:"Chin Bottom",scientificName:"Menton",path:"landmarksFront/chinBottom",howToFind:"Locate the lowest point of the chin between the left and right chin points."},neckLeft:{description:"The left side of the neck at the jawline.",name:"Left Neck Point",scientificName:"Left Cervical Lateralis",path:"landmarksFront/neckLeft",howToFind:"Mark the widest point of the left side of the neck, typically right below the jawline."},neckRight:{description:"The right side of the neck at the jawline.",name:"Right Neck Point",scientificName:"Right Cervical Lateralis",path:"landmarksFront/neckRight",howToFind:"Mark the widest point of the right side of the neck, typically right below the jawline."}},i={vertex:{description:"Highest point on the head in profile.",name:"Top of Head",scientificName:"Vertex",path:"landmarksSide/vertex",howToFind:"Mark the highest point of the head's curve, typically around the middle of the upper head."},occiput:{description:"Back-of-head prominence.",name:"Occiput",scientificName:"External Occipital Region",path:"landmarksSide/occiput",howToFind:"Mark the most prominent point on the back of the head's curve, typically above the ear."},pronasale:{description:"Most forward point of the nose tip.",name:"Nose Tip",scientificName:"Pronasale",path:"landmarksSide/pronasale",howToFind:"Mark the farthest projecting point of the nose tip."},neckPoint:{description:"Lower neck inflection on the front border.",name:"Neck Point",scientificName:"Anterior Cervical Landmark",path:"landmarksSide/neckPoint",howToFind:"Follow the neck contour down to the Adam's apple and mark a point above the collar region."},porion:{description:"The upper margin of the ear canal opening, used for Frankfort horizontal plane.",name:"Porion",scientificName:"Porion (soft tissue)",path:"landmarksSide/porion",howToFind:"Mark the uppermost point of the ear canal opening, right above the tragus (the small flap in front of the ear canal)."},orbitale:{description:"Lowest point on the orbital rim.",name:"Orbitale",scientificName:"Orbitale",path:"landmarksSide/orbitale",howToFind:"Trace the undereye contour and mark the most prominent part of the orbital rim."},eyelidEnd:{description:"The lateral end point of the visible eyelid in profile view.",name:"Eyelid End",scientificName:"Lateral Eyelid",path:"landmarksSide/eyelidEnd",howToFind:"From the side profile, mark the outermost visible point of the eyelid."},lowerEyelid:{description:"The lower eyelid margin as seen from the side profile.",name:"Lower Eyelid",scientificName:"Left Palpebra Inferior",path:"landmarksSide/lowerEyelid",howToFind:"From the side profile, locate the lower edge of the lower eyelid, typically the most prominent point of the lower lid margin."},tragus:{description:"Cartilage nub in front of the ear canal.",name:"Tragus",scientificName:"Tragion (soft tissue)",path:"landmarksSide/tragus",howToFind:"Mark the back part of the small flap in front of the ear canal."},intertragicNotch:{description:"The notch between the tragus and antitragus cartilages, marking the deepest depression in the anterior ear margin.",name:"Intertragic Notch",scientificName:"Incisura Intertragica",path:"landmarksSide/intertragicNotch",howToFind:"Locate the small groove between the tragus (small flap in front of the ear canal) and the antitragus (small bump opposite to it). This is where the jawline construction begins."},gonionTop:{description:"Upper angle point of the jaw from side profile.",name:"Upper Jaw Angle",scientificName:"Gonion Superior",path:"landmarksSide/gonionTop",howToFind:"Locate the upper part of the jaw angle where the ramus (back part of the jaw) forms an angle with the mandible (lower part of the jaw)."},gonionBottom:{description:"Lower angle point of the jaw from side profile.",name:"Lower Jaw Angle",scientificName:"Gonion Inferior",path:"landmarksSide/gonionBottom",howToFind:"Locate the lower part of the jaw angle that sits below the upper jaw angle, where the jaw begins to curve towards the chin."},menton:{description:"Lowest point on the soft-tissue chin.",name:"Chin Bottom",scientificName:"Menton (soft tissue)",path:"landmarksSide/menton",howToFind:"Trace the chin contour downward and mark its lowest point. This should form an angle with the upper and lower jaw points, outlining the jawline shape."},trichion:{description:"Forehead hairline point.",name:"Hairline (Profile)",scientificName:"Trichion",path:"landmarksSide/trichion",howToFind:"Mark the highest point of the hairline, where the forehead ends."},forehead:{description:"The most prominent point of the forehead between the hairline and brow ridge, where the forehead may begin to curve towards the hairline.",name:"Forehead",scientificName:"Frontalis",path:"landmarksSide/forehead",howToFind:"From the side profile, locate the most forward-projecting point of the forehead, typically between the hairline and the brow ridge."},glabella:{description:"Mid-forehead point between brows.",name:"Glabella",scientificName:"Glabella",path:"landmarksSide/glabella",howToFind:"Locate the most prominent point of the brow ridge between the eyebrows, above the indented part of the upper nose bridge."},nasion:{description:"Nasal root depression.",name:"Nasal Bridge Root",scientificName:"Nasion",path:"landmarksSide/nasion",howToFind:"Mark the small dip between the brow ridge and nose bridge, typically around eye level."},rhinion:{description:"Dorsal point of the nose.",name:"Rhinion",scientificName:"Rhinion",path:"landmarksSide/rhinion",howToFind:"Mark the dorsal point of the nose, typically the most prominent point of the nose bridge around the middle."},supratip:{description:"Dorsal point just above the tip.",name:"Supratip",scientificName:"Supratip Break",path:"landmarksSide/supratip",howToFind:"Follow the bridge toward the tip and mark the highest point right before the nose tip."},infratip:{description:"The point between the nose tip and columella on the nasal profile.",name:"Infratip",scientificName:"Infratip Lobule",path:"landmarksSide/infratip",howToFind:"Follow the nose contour down from the tip and mark the lowest point before the nostrils."},columella:{description:"Inferior border of the nasal septum between nostrils.",name:"Columella",scientificName:"Columella Nasi",path:"landmarksSide/columella",howToFind:"Mark the part of the nose that connects the nostrils, to the left of the infratip."},subnasale:{description:"Where nose base meets upper lip.",name:"Subnasale",scientificName:"Subnasale",path:"landmarksSide/subnasale",howToFind:"Mark the crease point at the base of the nose, where the nose creates an angle with the upper lip."},subalare:{description:"Lowest point of the nostril wing on the visible side.",name:"Subalare",scientificName:"Subalare",path:"landmarksSide/subalare",howToFind:"Mark the most prominent edge of the nose wing, the part of the lower nose near the cheek closest to the eyes."},labraleSuperius:{description:"Most forward point of the upper lip vermilion.",name:"Upper Lip",scientificName:"Labrale Superius",path:"landmarksSide/labraleSuperius",howToFind:"Find the most prominent point of the upper lip, typically the highest point of the lip's natural curve."},cheilion:{description:"Mouth corner where the lips meet.",name:"Mouth Corner",scientificName:"Cheilion",path:"landmarksSide/cheilion",howToFind:"Mark the rearmost lip corner where the upper and lower lips touch in profile."},labraleInferius:{description:"Most forward point of the lower lip vermilion.",name:"Lower Lip",scientificName:"Labrale Inferius",path:"landmarksSide/labraleInferius",howToFind:"Find the most prominent point of the lower lip, typically the lowest point of the lip's natural curve."},sublabiale:{description:"Deepest point of the crease between lower lip and chin.",name:"Labiomental Fold",scientificName:"Sublabiale",path:"landmarksSide/sublabiale",howToFind:"From profile, mark the deepest spot between the lower lip and chin."},pogonion:{description:"Most forward point on the soft-tissue chin.",name:"Chin Point",scientificName:"Pogonion (soft tissue)",path:"landmarksSide/pogonion",howToFind:"Mark the most prominent and forward point of the chin."},cervicalPoint:{description:"High neck point just under the jaw.",name:"Cervical Point",scientificName:"Cervicale (soft-tissue reference)",path:"landmarksSide/cervicalPoint",howToFind:"Mark the most indented point where the underside of the jaw turns into the neck."},cheekbone:{description:"Zygomatic prominence.",name:"Cheekbone",scientificName:"Zygion (soft-tissue over zygoma)",path:"landmarksSide/cheekbone",howToFind:"From the side, mark the bump of the cheekbone just below/behind the eye."},cornealApex:{description:"Most forward point of the eye (cornea).",name:"Corneal Apex",scientificName:"Corneal Apex",path:"landmarksSide/cornealApex",howToFind:"Mark the most prominent and forward point of the eye."}},a=e=>"front"===e?t:"side"===e?i:{},o=(e,t,i="male",o="white")=>{if(!a(e)[t])return null;let r=function(e){let t=[];if(Array.isArray(e)?t=e:"string"==typeof e&&(t=e.includes(",")?e.split(",").map(e=>e.trim()).filter(Boolean):[e]),0===t.length)return"white";for(let e of[{matches:["east_asian","asian"],imageRace:"asian"},{matches:["south_asian"],imageRace:"south-asian"},{matches:["black","african"],imageRace:"black"},{matches:["hispanic","latino","latina","latinx"],imageRace:"hispanic"},{matches:["native_american","indigenous"],imageRace:"native-american"},{matches:["middle_eastern","middle-eastern"],imageRace:"middle-eastern"},{matches:["pacific_islander","pacific-islander","polynesian","melanesian","micronesian"],imageRace:"pacific-islander"},{matches:["white","caucasian"],imageRace:"white"}])if(t.some(t=>e.matches.includes(t.toLowerCase())))return e.imageRace;return"white"}(o);return`/images/landmarks/${i}/${r}/${t}.webp?v=1`};function r(e,t,i="male",a="white"){let n="male"===i||"female"===i?i:"female";return Object.entries(t).map(([t,i])=>{let r=o(e,t,n,a);return{key:t,...i,referenceImage:r||""}})}function n(e="male",t="white"){return r("front",a("front"),e,t)}function l(e="male",t="white"){let i=r("front",a("front"),e,t),o=new Map(i.map(e=>[e.key,e])),n=[],s=new Set(i.map(e=>e.key));for(let e of["hairline","leftEyePupil","rightEyePupil","noseLeft","noseRight","lowerLip","chinBottom","leftOuterEar","rightOuterEar","leftTemple","rightTemple","leftEyeMedialCanthus","leftEyeLateralCanthus","leftEyeUpperEyelid","leftEyeLowerEyelid","leftEyelidHoodEnd","leftBrowHead","leftBrowInnerCorner","leftBrowArch","leftBrowPeak","leftBrowTail","leftUpperEyelidCrease","rightEyeMedialCanthus","rightEyeLateralCanthus","rightEyeUpperEyelid","rightEyeLowerEyelid","rightEyelidHoodEnd","rightBrowHead","rightBrowInnerCorner","rightBrowArch","rightBrowPeak","rightBrowTail","rightUpperEyelidCrease","nasalBase","noseBottom","leftNoseBridge","rightNoseBridge","mouthLeft","mouthRight","cupidsBow","innerCupidsBow","mouthMiddle","leftTopGonion","rightTopGonion","leftBottomGonion","rightBottomGonion","chinLeft","chinRight","neckLeft","neckRight","leftCheek","rightCheek"]){let t=o.get(e);t&&(n.push(t),s.delete(e))}for(let e of s){let t=o.get(e);t&&n.push(t)}return n}function s(e="male",t="white"){return r("side",a("side"),e,t)}function h(e="male",t="white"){let i=r("side",a("side"),e,t),o=new Map(i.map(e=>[e.key,e])),n=[],l=new Set(i.map(e=>e.key));for(let e of["vertex","occiput","pronasale","neckPoint","porion","orbitale","tragus","intertragicNotch","cornealApex","cheekbone","eyelidEnd","lowerEyelid","trichion","glabella","forehead","nasion","rhinion","supratip","infratip","columella","subnasale","subalare","labraleSuperius","cheilion","labraleInferius","sublabiale","pogonion","menton","cervicalPoint","gonionTop","gonionBottom"]){let t=o.get(e);t&&(n.push(t),l.delete(e))}for(let e of l){let t=o.get(e);t&&n.push(t)}return n}e.s(["getAllLandmarks",0,a,"getLandmarkImagePath",0,o],293060),e.s(["getFrontLandmarkList",()=>n,"getFrontLandmarkListMobile",()=>l,"getSideLandmarkList",()=>s,"getSideLandmarkListMobile",()=>h],767850)},837794,e=>{"use strict";async function t(e,t){let i,a,o,r;if(["orbitale","porion","vertex","occiput","pronasale","neckPoint"].filter(e=>!t[e]).length>0)return null;let n=e.naturalWidth||e.width,l=e.naturalHeight||e.height,s=t.orbitale,h=t.porion,d=t.vertex,c=t.occiput,f=t.pronasale,p=t.neckPoint;if(!isFinite(s.x)||!isFinite(s.y)||!isFinite(h.x)||!isFinite(h.y)||!isFinite(d.x)||!isFinite(d.y)||!isFinite(c.x)||!isFinite(c.y)||!isFinite(f.x)||!isFinite(f.y)||!isFinite(p.x)||!isFinite(p.y))return console.error("[frankfort-standardization] Invalid landmark coordinates detected"),null;let m=f.x<c.x,u=-Math.atan2(s.y-h.y,s.x-h.x);u>Math.PI/2&&(u-=Math.PI),u<=-Math.PI/2&&(u+=Math.PI);let g=Math.ceil(Math.sqrt(n*n+l*l)),w=document.createElement("canvas");w.width=g,w.height=g;let y=w.getContext("2d");y.imageSmoothingQuality="high",y.save(),y.translate(g/2,g/2),m&&y.scale(-1,1),y.rotate(u),y.drawImage(e,-n/2,-l/2),y.restore();let k=n/2,b=l/2,x=Math.sin(u),T=Math.cos(u),F=e=>{let t=e.x-k,i=e.y-b;return{x:g/2+(t*T-i*x),y:g/2+(t*x+i*T)}},L=F(d),E=F(c),N=F(f),C=F(p);m&&(L={x:g-L.x,y:L.y},E={x:g-E.x,y:E.y},N={x:g-N.x,y:N.y},C={x:g-C.x,y:C.y});let v=Math.max(0,Math.min(E.x,N.x)-10),M=Math.min(w.width,Math.max(E.x,N.x)+10),B=Math.max(0,Math.min(L.y,C.y)-10),j=Math.min(w.height,Math.max(L.y,C.y)+10),P=Math.floor(v),S=Math.floor(B),R=Math.max(10,Math.floor(M-v)),I=Math.max(10,Math.floor(j-B));if(!isFinite(P)||!isFinite(S)||!isFinite(R)||!isFinite(I)||R<=0||I<=0||R>1e4||I>1e4)return console.error("[frankfort-standardization] Invalid crop dimensions:",{cropX:P,cropY:S,cropW:R,cropH:I}),null;let O=document.createElement("canvas");O.width=R,O.height=I;let A=O.getContext("2d");A.imageSmoothingQuality="high",A.drawImage(w,P,S,R,I,0,0,R,I);let U=R/I;if(U>1?(i=1024,o=0,r=(1024-(a=1024/U))/2):(a=1024,o=(1024-(i=1024*U))/2,r=0),!isFinite(i)||!isFinite(a)||!isFinite(o)||!isFinite(r)||i<=0||a<=0)return console.error("[frankfort-standardization] Invalid draw dimensions:",{drawWidth:i,drawHeight:a,offsetX:o,offsetY:r}),null;let H=document.createElement("canvas");H.width=1024,H.height=1024;let z=H.getContext("2d");z.fillStyle="#FFFFFF",z.fillRect(0,0,1024,1024),z.imageSmoothingQuality="high",z.drawImage(O,o,r,i,a);let G=await new Promise(e=>H.toBlob(e,"image/jpeg",.8));if(!G)throw Error("Failed to export final canvas");let D=i/R,$={};console.log("ðŸ”µ [frankfort-standardization] Transform params:",{scaleFactor:D,cropX:P,cropY:S,offsetX:o,offsetY:r,needsMirroring:m,diag:g}),Object.entries(t).forEach(([e,t])=>{if(!t||!isFinite(t.x)||!isFinite(t.y))return void console.warn(`[frankfort-standardization] Skipping invalid landmark ${e}:`,t);console.log(`ðŸ”µ [frankfort-standardization] Transforming ${e}:`,{inputCoords:t,base:t,isFiniteBaseX:isFinite(t.x),isFiniteBaseY:isFinite(t.y)});let i=F(t),a=i;m&&(a={x:g-i.x,y:i.y});let n={x:a.x-P,y:a.y-S},l={x:n.x*D,y:n.y*D},s={x:l.x+o,y:l.y+r};console.log(`ðŸ”µ [frankfort-standardization] ${e} transformation steps:`,{rotated:i,rotatedThenMirrored:a,cropped:n,scaled:l,letterboxed:s,final:{x:Math.round(s.x),y:Math.round(s.y)}}),$[e]={x:Math.round(s.x),y:Math.round(s.y)}});let W=new FileReader;return{standardizedImageDataUrl:await new Promise(e=>{W.onload=()=>e(W.result),W.readAsDataURL(G)}),transformedLandmarks:$,width:1024,height:1024}}e.s(["standardizeToFrankfortPlane",()=>t])},922524,e=>{"use strict";var t=e.i(843476),i=e.i(271645),a=e.i(618566),o=e.i(751994),r=e.i(646034),n=e.i(910510),l=e.i(767850),s=e.i(320910),h=e.i(938183),d=e.i(837794),c=e.i(267051),f=e.i(999109),p=e.i(695904),m=e.i(918370),u=e.i(889500),g=e.i(37727);function w({isOpen:e,onClose:i}){return e?(0,t.jsxs)("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4",children:[(0,t.jsx)("div",{className:"absolute inset-0 bg-black/50",onClick:i}),(0,t.jsxs)("div",{className:"relative bg-white rounded-2xl shadow-xl max-w-md w-full p-6",children:[(0,t.jsx)("button",{onClick:i,className:"absolute top-4 right-4 p-2 text-gray-400 hover:text-gray-600 transition-colors",children:(0,t.jsx)(g.X,{size:20})}),(0,t.jsx)("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Frankfort Horizontal Plane"}),(0,t.jsxs)("div",{className:"space-y-4 text-sm text-gray-600",children:[(0,t.jsx)("p",{children:"The Frankfort Horizontal Plane is a standardized anatomical reference plane used in craniofacial analysis. It provides a consistent baseline for measuring facial features and proportions."}),(0,t.jsxs)("div",{className:"bg-gray-50 rounded-lg p-4",children:[(0,t.jsx)("h3",{className:"font-medium text-gray-900 mb-2",children:"Defined by two points:"}),(0,t.jsxs)("ul",{className:"space-y-2",children:[(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"w-2 h-2 rounded-full bg-green-500 mt-1.5 flex-shrink-0"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-800",children:"Orbitale"}),(0,t.jsx)("span",{className:"text-gray-500",children:" â€“ The lowest point on the inferior margin of the eye socket"})]})]}),(0,t.jsxs)("li",{className:"flex gap-2",children:[(0,t.jsx)("span",{className:"w-2 h-2 rounded-full bg-green-500 mt-1.5 flex-shrink-0"}),(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"font-medium text-gray-800",children:"Porion"}),(0,t.jsx)("span",{className:"text-gray-500",children:" â€“ The uppermost point of the external auditory canal (ear opening)"})]})]})]})]}),(0,t.jsx)("p",{children:"When the Frankfort Plane is horizontal, it represents the natural head position for most individuals looking straight ahead. This standardization allows for accurate comparison of facial measurements and proportions."}),(0,t.jsx)("p",{className:"text-xs text-gray-400",children:"The green reference line on your image shows where the Frankfort Plane is located based on your placed landmarks."})]}),(0,t.jsx)("button",{onClick:i,className:"mt-6 w-full py-3 bg-gray-900 text-white text-sm font-medium rounded-lg hover:bg-gray-800 transition-colors",children:"Got it"})]})]}):null}var y=e.i(952571);let k=[2,4,8],b={hairline:2,leftTemple:2,rightTemple:2,leftEyePupil:4,leftEyeMedialCanthus:4,leftEyeLateralCanthus:4,leftEyeUpperEyelid:8,leftEyeLowerEyelid:8,leftEyelidHoodEnd:4,leftBrowHead:4,leftBrowInnerCorner:4,leftBrowArch:4,leftBrowPeak:4,leftBrowTail:4,leftUpperEyelidCrease:8,rightEyePupil:4,rightEyeMedialCanthus:4,rightEyeLateralCanthus:4,rightEyeUpperEyelid:8,rightEyeLowerEyelid:8,rightEyelidHoodEnd:4,rightBrowHead:4,rightBrowInnerCorner:4,rightBrowArch:4,rightBrowPeak:4,rightBrowTail:4,rightUpperEyelidCrease:8,noseLeft:4,noseRight:4,nasalBase:4,noseBottom:4,leftNoseBridge:4,rightNoseBridge:4,lowerLip:4,mouthLeft:4,mouthRight:4,cupidsBow:4,innerCupidsBow:4,mouthMiddle:4,chinBottom:4,chinLeft:4,chinRight:4,neckLeft:4,neckRight:4,leftOuterEar:2,leftCheek:2,leftTopGonion:4,leftBottomGonion:4,rightOuterEar:2,rightCheek:2,rightTopGonion:4,rightBottomGonion:4,vertex:2,occiput:2,trichion:2,neckPoint:2,porion:4,orbitale:4,tragus:4,intertragicNotch:4,cornealApex:4,eyelidEnd:4,lowerEyelid:4,cheekbone:4,forehead:2,glabella:4,nasion:4,pronasale:4,rhinion:4,supratip:4,infratip:4,columella:4,subnasale:4,subalare:4,labraleSuperius:4,cheilion:4,labraleInferius:4,sublabiale:4,pogonion:4,menton:4,cervicalPoint:4,gonionTop:4,gonionBottom:4};function x({profileType:e,imageUrl:a,gender:o,ethnicity:g,sideDirection:x,initialLandmarks:T,initialReviewMode:F,onComplete:L,onBack:E,onReturnToFrontReview:N}){let C=(0,i.useRef)(null),v=(0,i.useRef)(null),M=(0,i.useRef)(!1),B=(0,i.useRef)(null),j=(0,i.useRef)(null),P=(0,i.useRef)(null),[S,R]=(0,i.useState)(!1),[I,O]=(0,i.useState)(!1),[A,U]=(0,i.useState)(!1),[H,z]=(0,i.useState)(null),[G,D]=(0,i.useState)(new Set),[$,W]=(0,i.useState)(!1),[J,_]=(0,i.useState)(()=>"true"===localStorage.getItem("landmarking-show-dial-arrows")),Z=(0,i.useMemo)(()=>"front"===e?(0,l.getFrontLandmarkListMobile)(o,g):(0,l.getSideLandmarkListMobile)(o,g),[e,o,g]);(0,n.usePreloadLandmarkImages)(Z,!0);let{landmarks:q,currentLandmark:K,currentIndex:X,mode:Q,zoom:V,hasVisitedReview:Y,placeLandmark:ee,moveLandmark:et,resetLandmark:ei,setLandmarkPosition:ea,goNext:eo,goPrevious:er,setZoom:en,enterReviewMode:el,exitReviewMode:es,editLandmark:eh,confirmFromEdit:ed,loadLandmarks:ec,isCurrentPlaced:ef,isComplete:ep,isLastLandmark:em,isFirstLandmark:eu}=(0,r.useLandmarking)({landmarkList:Z,initialLandmarks:T,initialReviewMode:F,canvasRef:C,imageRef:v});(0,i.useEffect)(()=>{if(!K||"cycling"!==Q)return;let e=b[K.key];e&&e!==V&&en(e)},[K?.key,Q]);let eg=(0,i.useCallback)(async()=>{if("front"===e&&!M.current&&!T){M.current=!0,U(!0);try{let e=new Image;e.crossOrigin="anonymous",await new Promise((t,i)=>{e.onload=()=>t(),e.onerror=i,e.src=a});let t=e.naturalWidth||e.width,i=e.naturalHeight||e.height,o=await (0,s.detectFrontLandmarks)(e,t,i);if(o){let e={};for(let[a,r]of Object.entries(o))e[a]={x:Math.max(0,Math.min(1,r.x/t)),y:Math.max(0,Math.min(1,r.y/i))};P.current=e,ec(e)}}catch(e){console.error("MediaPipe detection failed:",e)}finally{U(!1)}}},[e,a,T,ec]),ew=(0,i.useCallback)(async e=>new Promise((t,i)=>{let a=new Image;a.crossOrigin="anonymous",a.onload=()=>{let e=document.createElement("canvas");e.width=a.naturalWidth||a.width,e.height=a.naturalHeight||a.height;let i=e.getContext("2d");i.translate(e.width,0),i.scale(-1,1),i.drawImage(a,0,0),t(e.toDataURL("image/jpeg",.9))},a.onerror=i,a.src=e}),[]),ey=(0,i.useCallback)(async()=>{if("side"===e&&!M.current&&!T){M.current=!0,U(!0);try{let e=a;"left"===x?(e=await ew(a),z(e)):z(a);let t=new Image;t.crossOrigin="anonymous",await new Promise((i,a)=>{t.onload=()=>i(),t.onerror=a,t.src=e});let i=t.naturalWidth||t.width,o=t.naturalHeight||t.height,r=await fetch(e),n=await r.blob(),l=new FormData;l.append("image",n,"side.jpg");let s=await fetch("/api/side-landmarks",{method:"POST",body:l});if(!s.ok)throw Error("Failed to detect side landmarks");let d=await s.json();if(d.success&&d.data){let e={landmarks:d.data.landmarks,bbox:d.data.bbox,direction:d.data.direction,imageWidth:i,imageHeight:o};B.current=e,j.current={width:i,height:o};let t=(0,h.applyAutoPlacement)(e,i,o);Object.keys(t).length>0&&ec(t)}}catch(e){console.error("Lambda detection failed:",e)}finally{U(!1)}}},[e,a,x,T,ec,ew]);(0,i.useEffect)(()=>{"front"!==e||T||M.current?"side"!==e||T||M.current||ey():eg()},[e,T,eg,ey]);let ek=(0,i.useCallback)(e=>{if(!B.current||!j.current)return null;let{width:t,height:i}=j.current,a={};return G.forEach(e=>{q[e]&&(a[e]=q[e])}),(0,h.applyAutoPlacementWithOverrides)(B.current,t,i,a)[e]||null},[q,G]);(0,i.useEffect)(()=>{if("side"!==e||!B.current||!K||G.has(K.key)||!j.current)return;let{width:t,height:i}=j.current,a={};G.forEach(e=>{q[e]&&(a[e]=q[e])});let o=(0,h.applyAutoPlacementWithOverrides)(B.current,t,i,a)[K.key];o&&ea(K.key,o)},[e,X]);let eb=(0,i.useCallback)(e=>{K&&D(e=>new Set(e).add(K.key)),ee(e)},[K,ee]),ex=(0,i.useRef)(K);ex.current=K;let eT=(0,i.useRef)(et);eT.current=et;let eF=(0,i.useCallback)((e,t)=>{ex.current&&D(e=>new Set(e).add(ex.current.key)),eT.current(e,t)},[]),eL=(0,i.useCallback)(()=>{if(K){if(D(e=>{let t=new Set(e);return t.delete(K.key),t}),"side"===e){let e=ek(K.key);if(e)return void ea(K.key,e)}if("front"===e&&P.current){let e=P.current[K.key];if(e)return void ea(K.key,e)}ei()}},[K,e,ek,ea,ei]),eE=(0,i.useCallback)((e,t)=>{eF(e,t)},[eF]),eN=(0,i.useCallback)(e=>{eF("left"===e?-1:+("right"===e),"up"===e?-1:+("down"===e))},[eF]),eC=(0,i.useCallback)(()=>{let e=(k.indexOf(V)+1)%k.length;en(k[e])},[V,en]),ev=(0,i.useCallback)(async()=>{if("editing"===Q)ed();else{O(!0);try{if("side"===e){let e=H||a,t=new Image;t.crossOrigin="anonymous",await new Promise((i,a)=>{t.onload=()=>i(),t.onerror=a,t.src=e});let i=t.naturalWidth||t.width,o=t.naturalHeight||t.height,r={};Object.entries(q).forEach(([e,t])=>{r[e]={x:t.x*i,y:t.y*o}});let n=await (0,d.standardizeToFrankfortPlane)(t,r);if(n){let e={};Object.entries(n.transformedLandmarks).forEach(([t,i])=>{e[t]={x:i.x/n.width,y:i.y/n.height}}),L(e,n.standardizedImageDataUrl)}else L(q,e)}else L(q)}finally{O(!1)}}},[Q,ed,L,q,e,H,a]),eM=(0,i.useCallback)(()=>{es()},[es]),eB=(0,i.useMemo)(()=>"side"===e&&!!(q.orbitale&&q.porion),[e,q]),ej="side"===e&&H?H:a;return A?(0,t.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-10 h-10 border-4 border-gray-200 border-t-gray-900 rounded-full animate-spin mx-auto mb-3"}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:"Detecting landmarks..."})]})}):"review"===Q?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(u.ReviewMode,{imageUrl:ej,landmarks:q,profileType:e,isSubmitting:I,onEditLandmark:eh,onBack:eM,onConfirm:ev}),(0,t.jsx)(w,{isOpen:S,onClose:()=>R(!1)})]}):(0,t.jsxs)("div",{className:"flex flex-col md:flex-row h-[100dvh] md:h-full gap-2 md:gap-4 p-2 md:p-4 overflow-hidden",children:[(0,t.jsxs)("div",{className:"w-full md:w-80 flex-shrink-0 flex flex-col gap-2 md:gap-4 md:order-2 md:overflow-y-auto md:max-h-full",children:[(0,t.jsx)(f.LandmarkCard,{landmark:K,currentIndex:X,totalCount:Z.length,isPlaced:ef,onUndo:eL,showArrows:J,onToggleArrows:()=>_(e=>{let t=!e;return localStorage.setItem("landmarking-show-dial-arrows",String(t)),t})}),(0,t.jsx)(m.DesktopControls,{zoom:V,isFirstLandmark:eu,isLastLandmark:em,hasVisitedReview:Y,showReturnToFront:"side"===e,profileType:e,isEditing:"editing"===Q,onMove:eE,onReset:eL,onSetZoom:en,onPrevious:er,onNext:eo,onConfirm:em&&ep?el:void 0,onConfirmEdit:"editing"===Q?ed:void 0,onReturnToFront:N}),"front"===e&&E&&(0,t.jsx)("button",{onClick:E,className:"hidden md:block w-full py-2.5 text-sm text-gray-600 font-medium bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:"Back to Photos"}),"side"===e&&N&&(0,t.jsx)("button",{onClick:N,className:"hidden md:block w-full py-2.5 text-sm text-gray-600 font-medium bg-white border border-gray-200 rounded-lg hover:bg-gray-50 transition-colors",children:"Back to Front"})]}),(0,t.jsxs)("div",{className:"flex-1 min-h-0 relative md:order-1",children:[(0,t.jsx)(c.LandmarkCanvas,{imageUrl:ej,landmarks:q,currentLandmark:K,currentIndex:X,landmarkList:Z,mode:Q,zoom:V,profileType:e,onPlaceLandmark:eb,onEditLandmark:eh,onZoomChange:en,onDraggingChange:W}),(0,t.jsx)("div",{className:"md:hidden",children:(0,t.jsx)(p.MobileDial,{zoom:V,isFirstLandmark:eu,isLastLandmark:em,hasVisitedReview:Y,showReturnToFront:"side"===e,profileType:e,isDragging:$,isEditing:"editing"===Q,showArrows:J,onMove:eN,onReset:eL,onZoomCycle:eC,onPrevious:er,onNext:eo,onConfirm:em&&ep?el:void 0,onConfirmEdit:"editing"===Q?ed:void 0,onReturnToFront:N})}),eB&&(0,t.jsxs)("button",{onClick:()=>R(!0),className:"absolute top-4 right-4 flex items-center gap-2 px-3 py-2 bg-white/90 border border-gray-200 rounded-lg text-xs text-gray-600 hover:bg-white transition-colors",children:[(0,t.jsx)(y.Info,{size:14}),"Frankfort Plane"]}),(0,t.jsxs)("a",{href:"https://discord.gg/vmqgmrry8q",target:"_blank",rel:"noopener noreferrer",className:"absolute bottom-4 left-4 flex items-center gap-1.5 px-2 py-1 bg-black/50 backdrop-blur-sm rounded-full text-[10px] text-white/80 hover:text-white hover:bg-black/60 transition-colors",children:[(0,t.jsx)("span",{className:"px-1.5 py-0.5 bg-amber-500/90 rounded text-[9px] font-medium text-black",children:"BETA"}),(0,t.jsx)("span",{children:"Report bugs on Discord"})]})]}),(0,t.jsx)(w,{isOpen:S,onClose:()=>R(!1)})]})}function T(e){let t={};for(let[i,a]of Object.entries(e))t[i]={x:Math.round(1024*a.x),y:Math.round(1024*a.y)};return t}function F(){let e=(0,a.useRouter)(),r=(0,a.useSearchParams)(),n="true"===r.get("frontOnly"),l="true"===r.get("addSide"),s=r.get("analysisId"),h=r.get("direction"),{getFrontPhoto:d,getSidePhoto:c,getGender:f,getRace:p,getSideDirection:m,saveFrontLandmarks:u,saveSideLandmarks:g,getFrontLandmarks:w,getSideLandmarks:y}=(0,o.useAnalysis)(),[k,b]=(0,i.useState)(l?"side":"front"),[F,L]=(0,i.useState)(null),[E,N]=(0,i.useState)(!1),C=d(),v=c(),M=f(),B=p(),j=m(),P=w(),S=y();(0,i.useEffect)(()=>{l?v?.original||e.replace(`/facial-analysis?mode=addSide&analysisId=${s}`):C?.processed||e.replace("/facial-analysis")},[C,v,e,l,s]);let R=(0,i.useCallback)(async(t,i)=>{if(u(t),n||!v?.original){b("submitting");try{let i=await fetch("/api/faces",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({frontPhotoUrl:C?.processed,frontLandmarks:T(t),gender:M,race:B})});if(!i.ok)throw Error("Failed to create analysis");let a=await i.json();e.push(`/dashboard/${a.face.id}?new=true`)}catch(e){L(e instanceof Error?e.message:"Failed to submit analysis"),b("front")}}else b("side")},[n,v,C,u,M,B,e]),I=(0,i.useCallback)(async(t,i)=>{g(t),b("submitting");let a=i||v?.original;try{if(l&&s){if(!(await fetch(`/api/faces/${s}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({sidePhotoUrl:a,sideLandmarks:T(t)})})).ok)throw Error("Failed to update analysis");e.push(`/dashboard/${s}`)}else{let i=w(),o=await fetch("/api/faces",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({frontPhotoUrl:C?.processed,sidePhotoUrl:a,frontLandmarks:i?T(i):null,sideLandmarks:T(t),gender:M,race:B})});if(!o.ok)throw Error("Failed to create analysis");let r=await o.json();e.push(`/dashboard/${r.face.id}?new=true`)}}catch(e){L(e instanceof Error?e.message:"Failed to submit analysis"),b("side")}},[C,v,g,w,M,B,e,l,s]),O=(0,i.useCallback)(()=>{b("front"),N(!1)},[]),A=(0,i.useCallback)(()=>{b("front"),N(!0)},[]);if(l){if(!v?.original)return null}else if(!C?.processed)return null;return"submitting"===k?(0,t.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-white",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"w-12 h-12 border-4 border-gray-200 border-t-gray-900 rounded-full animate-spin mx-auto mb-4"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Analyzing your face..."})]})}):F?(0,t.jsx)("div",{className:"fixed inset-0 flex items-center justify-center bg-white",children:(0,t.jsxs)("div",{className:"text-center max-w-md p-6",children:[(0,t.jsx)("div",{className:"w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4",children:(0,t.jsx)("svg",{className:"w-6 h-6 text-red-600",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,t.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})}),(0,t.jsx)("h2",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Something went wrong"}),(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:F}),(0,t.jsx)("button",{onClick:()=>L(null),className:"px-6 py-2 bg-gray-900 text-white rounded-lg hover:bg-gray-800 transition-colors",children:"Try Again"})]})}):(0,t.jsxs)("div",{className:"fixed inset-0 bg-white",children:["front"===k&&C?.processed&&(0,t.jsx)(x,{profileType:"front",imageUrl:C.processed,gender:M||"male",ethnicity:B?.split(",")[0]||null,initialLandmarks:P||void 0,initialReviewMode:E,onComplete:R,onBack:()=>e.push("/facial-analysis")}),"side"===k&&v?.original&&(0,t.jsx)(x,{profileType:"side",imageUrl:v.original,gender:M||"male",ethnicity:B?.split(",")[0]||null,sideDirection:j||h,initialLandmarks:S||void 0,onComplete:I,onBack:l&&s?()=>e.push(`/facial-analysis?mode=addSide&analysisId=${s}`):O,onReturnToFrontReview:l?void 0:A})]})}e.s(["default",()=>F],922524)},826368,e=>{e.v(t=>Promise.all(["static/chunks/72b6e4a245580a73.js"].map(t=>e.l(t))).then(()=>t(57166)))}]);

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
