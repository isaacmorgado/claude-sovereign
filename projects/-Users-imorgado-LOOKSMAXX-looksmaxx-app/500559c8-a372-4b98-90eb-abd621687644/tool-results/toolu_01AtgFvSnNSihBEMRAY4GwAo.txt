     1→-- Migration: Add audit timestamps for soft deletes
     2→-- Date: 2025-12-27
     3→-- Purpose: GDPR compliance and audit trails
     4→
     5→-- Add deleted_at and deleted_by columns to forum_posts
     6→ALTER TABLE forum_posts ADD COLUMN IF NOT EXISTS deleted_at TIMESTAMP WITH TIME ZONE;
     7→ALTER TABLE forum_posts ADD COLUMN IF NOT EXISTS deleted_by UUID REFERENCES users(id);
     8→
     9→-- Add deleted_at and deleted_by columns to forum_comments
    10→ALTER TABLE forum_comments ADD COLUMN IF NOT EXISTS deleted_at TIMESTAMP WITH TIME ZONE;
    11→ALTER TABLE forum_comments ADD COLUMN IF NOT EXISTS deleted_by UUID REFERENCES users(id);
    12→
    13→-- Create indexes for efficient querying of non-deleted content
    14→CREATE INDEX IF NOT EXISTS idx_posts_deleted_at ON forum_posts(deleted_at) WHERE deleted_at IS NOT NULL;
    15→CREATE INDEX IF NOT EXISTS idx_comments_deleted_at ON forum_comments(deleted_at) WHERE deleted_at IS NOT NULL;
    16→
    17→-- Comments
    18→COMMENT ON COLUMN forum_posts.deleted_at IS 'Timestamp when post was soft-deleted, NULL if active';
    19→COMMENT ON COLUMN forum_posts.deleted_by IS 'User ID who deleted the post (self or moderator)';
    20→COMMENT ON COLUMN forum_comments.deleted_at IS 'Timestamp when comment was soft-deleted, NULL if active';
    21→COMMENT ON COLUMN forum_comments.deleted_by IS 'User ID who deleted the comment (self or moderator)';
    22→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
