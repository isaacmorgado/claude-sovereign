     1→'use client';
     2→
     3→import { useState, useEffect } from 'react';
     4→import Link from 'next/link';
     5→import { MessageSquare, Share2, Bookmark, BookmarkCheck, MoreHorizontal, Pin, Sparkles, Check, Flag } from 'lucide-react';
     6→import { PostListItem, VoteType } from '@/types/forum';
     7→import { formatDistanceToNow } from '@/lib/utils';
     8→import { VoteButtons } from './VoteButtons';
     9→
    10→// ============================================
    11→// SAVED POSTS HELPER
    12→// ============================================
    13→function getSavedPosts(): string[] {
    14→  if (typeof window === 'undefined') return [];
    15→  try {
    16→    return JSON.parse(localStorage.getItem('saved_posts') || '[]');
    17→  } catch {
    18→    return [];
    19→  }
    20→}
    21→
    22→function toggleSavedPost(postId: string): boolean {
    23→  const saved = getSavedPosts();
    24→  const isSaved = saved.includes(postId);
    25→  if (isSaved) {
    26→    localStorage.setItem('saved_posts', JSON.stringify(saved.filter(id => id !== postId)));
    27→    return false;
    28→  } else {
    29→    localStorage.setItem('saved_posts', JSON.stringify([...saved, postId]));
    30→    return true;
    31→  }
    32→}
    33→
    34→interface PostCardProps {
    35→  post: PostListItem;
    36→  onVote?: (postId: string, voteType: VoteType) => void;
    37→  showSubForum?: boolean;
    38→  onReport?: (postId: string) => void;
    39→}
    40→
    41→export function PostCard({ post, onVote, showSubForum = false, onReport }: PostCardProps) {
    42→  const [isSaved, setIsSaved] = useState(false);
    43→  const [copied, setCopied] = useState(false);
    44→  const [showMenu, setShowMenu] = useState(false);
    45→
    46→  // Check saved state on mount
    47→  useEffect(() => {
    48→    setIsSaved(getSavedPosts().includes(post.id));
    49→  }, [post.id]);
    50→
    51→  const handleShare = async () => {
    52→    const url = `${window.location.origin}/forum/post/${post.id}`;
    53→    try {
    54→      await navigator.clipboard.writeText(url);
    55→      setCopied(true);
    56→      setTimeout(() => setCopied(false), 2000);
    57→    } catch {
    58→      // Fallback for older browsers
    59→      const input = document.createElement('input');
    60→      input.value = url;
    61→      document.body.appendChild(input);
    62→      input.select();
    63→      document.execCommand('copy');
    64→      document.body.removeChild(input);
    65→      setCopied(true);
    66→      setTimeout(() => setCopied(false), 2000);
    67→    }
    68→  };
    69→
    70→  const handleSave = () => {
    71→    const newSavedState = toggleSavedPost(post.id);
    72→    setIsSaved(newSavedState);
    73→  };
    74→
    75→  const handleReport = () => {
    76→    setShowMenu(false);
    77→    onReport?.(post.id);
    78→  };
    79→
    80→  return (
    81→    <article className="group relative rounded-2xl bg-neutral-900/30 border border-white/5 hover:border-cyan-500/20 transition-all overflow-hidden">
    82→      <div className="flex">
    83→        {/* Vote column */}
    84→        <div className="w-12 bg-neutral-900/50 border-r border-white/5 flex flex-col items-center py-4">
    85→          <VoteButtons
    86→            voteCount={post.voteCount}
    87→            userVote={post.userVote}
    88→            onVote={(voteType) => onVote?.(post.id, voteType)}
    89→            size="sm"
    90→          />
    91→        </div>
    92→
    93→        {/* Content */}
    94→        <div className="flex-1 p-4 min-w-0">
    95→          {/* Meta line */}
    96→          <div className="flex items-center flex-wrap gap-2 mb-3">
    97→            {post.isPinned && (
    98→              <span className="flex items-center gap-1 px-2 py-0.5 rounded-md bg-cyan-500/10 border border-cyan-500/20 text-[9px] font-black uppercase tracking-wider text-cyan-400">
    99→                <Pin size={10} />
   100→                Pinned
   101→              </span>
   102→            )}
   103→            {post.isGuide && (
   104→              <span className="flex items-center gap-1 px-2 py-0.5 rounded-md bg-green-500/10 border border-green-500/20 text-[9px] font-black uppercase tracking-wider text-green-400">
   105→                <Sparkles size={10} />
   106→                Guide
   107→              </span>
   108→            )}
   109→            {showSubForum && (
   110→              <Link
   111→                href={`/forum/${post.categorySlug}`}
   112→                className="text-[10px] font-black uppercase tracking-widest text-cyan-400 hover:text-cyan-300"
   113→              >
   114→                {post.subForumSlug}
   115→              </Link>
   116→            )}
   117→            <span className="text-[10px] font-medium text-neutral-600">
   118→              by <span className="text-neutral-400">u/{post.author.username}</span>
   119→            </span>
   120→            <span className="text-[10px] text-neutral-700">•</span>
   121→            <span className="text-[10px] text-neutral-600">{formatDistanceToNow(post.createdAt)}</span>
   122→          </div>
   123→
   124→          {/* Title */}
   125→          <Link href={`/forum/post/${post.id}`}>
   126→            <h3 className="text-base font-bold text-white group-hover:text-cyan-400 transition-colors leading-snug mb-2">
   127→              {post.title}
   128→            </h3>
   129→          </Link>
   130→
   131→          {/* Preview text */}
   132→          {post.contentPreview && (
   133→            <p className="text-neutral-500 text-sm line-clamp-2 mb-4 leading-relaxed">
   134→              {post.contentPreview}
   135→            </p>
   136→          )}
   137→
   138→          {/* Action bar */}
   139→          <div className="flex items-center gap-1">
   140→            <Link
   141→              href={`/forum/post/${post.id}`}
   142→              className="flex items-center gap-2 px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-wider text-neutral-500 hover:bg-white/5 hover:text-cyan-400 transition-all"
   143→            >
   144→              <MessageSquare size={14} />
   145→              <span>{post.commentCount} Comments</span>
   146→            </Link>
   147→            <button
   148→              onClick={handleShare}
   149→              className={`flex items-center gap-2 px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${
   150→                copied
   151→                  ? 'text-emerald-400 bg-emerald-500/10'
   152→                  : 'text-neutral-500 hover:bg-white/5 hover:text-white'
   153→              }`}
   154→            >
   155→              {copied ? <Check size={14} /> : <Share2 size={14} />}
   156→              <span className="hidden sm:inline">{copied ? 'Copied!' : 'Share'}</span>
   157→            </button>
   158→            <button
   159→              onClick={handleSave}
   160→              className={`flex items-center gap-2 px-3 py-1.5 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${
   161→                isSaved
   162→                  ? 'text-cyan-400 bg-cyan-500/10'
   163→                  : 'text-neutral-500 hover:bg-white/5 hover:text-white'
   164→              }`}
   165→            >
   166→              {isSaved ? <BookmarkCheck size={14} /> : <Bookmark size={14} />}
   167→              <span className="hidden sm:inline">{isSaved ? 'Saved' : 'Save'}</span>
   168→            </button>
   169→            <div className="relative">
   170→              <button
   171→                onClick={() => setShowMenu(!showMenu)}
   172→                className="flex items-center gap-2 p-1.5 rounded-lg text-neutral-500 hover:bg-white/5 hover:text-white transition-all"
   173→              >
   174→                <MoreHorizontal size={14} />
   175→              </button>
   176→              {showMenu && (
   177→                <>
   178→                  <div
   179→                    className="fixed inset-0 z-40"
   180→                    onClick={() => setShowMenu(false)}
   181→                  />
   182→                  <div className="absolute right-0 top-full mt-1 z-50 min-w-[140px] rounded-xl bg-neutral-900 border border-white/10 shadow-xl overflow-hidden">
   183→                    <button
   184→                      onClick={handleReport}
   185→                      className="w-full flex items-center gap-2 px-4 py-2.5 text-[10px] font-black uppercase tracking-wider text-neutral-400 hover:bg-white/5 hover:text-red-400 transition-all"
   186→                    >
   187→                      <Flag size={12} />
   188→                      Report
   189→                    </button>
   190→                  </div>
   191→                </>
   192→              )}
   193→            </div>
   194→          </div>
   195→        </div>
   196→      </div>
   197→    </article>
   198→  );
   199→}
   200→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
