     1→'use client';
     2→
     3→import { useState, useCallback } from 'react';
     4→import { useRouter } from 'next/navigation';
     5→import Image from 'next/image';
     6→import { useDropzone } from 'react-dropzone';
     7→import { Upload, X, Image as ImageIcon, ArrowRight, ArrowLeft, User, UserCircle, Check } from 'lucide-react';
     8→import { useUpload } from '@/contexts/UploadContext';
     9→
    10→type UploadStep = 'front' | 'side';
    11→
    12→export default function UploadPage() {
    13→  const router = useRouter();
    14→  const { frontPhoto, sidePhoto, setFrontPhoto, setSidePhoto } = useUpload();
    15→  const [currentStep, setCurrentStep] = useState<UploadStep>('front');
    16→
    17→  const currentPhoto = currentStep === 'front' ? frontPhoto : sidePhoto;
    18→  const setCurrentPhoto = currentStep === 'front' ? setFrontPhoto : setSidePhoto;
    19→
    20→  const onDrop = useCallback((acceptedFiles: File[]) => {
    21→    const selectedFile = acceptedFiles[0];
    22→    if (selectedFile) {
    23→      const objectUrl = URL.createObjectURL(selectedFile);
    24→      setCurrentPhoto({ file: selectedFile, preview: objectUrl });
    25→    }
    26→  }, [setCurrentPhoto]);
    27→
    28→  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    29→    onDrop,
    30→    accept: {
    31→      'image/*': ['.jpeg', '.jpg', '.png', '.webp']
    32→    },
    33→    maxFiles: 1,
    34→    multiple: false
    35→  });
    36→
    37→  const removeImage = () => {
    38→    if (currentPhoto?.preview) {
    39→      URL.revokeObjectURL(currentPhoto.preview);
    40→    }
    41→    setCurrentPhoto(null);
    42→  };
    43→
    44→  const handleNext = () => {
    45→    if (currentStep === 'front' && frontPhoto) {
    46→      setCurrentStep('side');
    47→    } else if (currentStep === 'side' && sidePhoto) {
    48→      router.push('/analysis');
    49→    }
    50→  };
    51→
    52→  const handleBack = () => {
    53→    if (currentStep === 'side') {
    54→      setCurrentStep('front');
    55→    } else {
    56→      router.push('/ethnicity');
    57→    }
    58→  };
    59→
    60→  const stepConfig = {
    61→    front: {
    62→      title: 'Upload Front-Facing Photo',
    63→      subtitle: 'Upload a clear, front-facing photo looking straight at the camera',
    64→      icon: User,
    65→    },
    66→    side: {
    67→      title: 'Upload Side Profile Photo',
    68→      subtitle: 'Upload a clear side profile photo showing your facial structure',
    69→      icon: UserCircle,
    70→    },
    71→  };
    72→
    73→  const config = stepConfig[currentStep];
    74→  const StepIcon = config.icon;
    75→
    76→  return (
    77→    <main className="min-h-screen bg-black flex flex-col items-center justify-center px-4 py-12">
    78→      {/* Back button */}
    79→      <div className="absolute top-6 left-6">
    80→        <button
    81→          onClick={handleBack}
    82→          className="text-sm text-neutral-400 hover:text-white transition-colors flex items-center gap-1"
    83→        >
    84→          <ArrowLeft className="w-4 h-4" />
    85→          Back
    86→        </button>
    87→      </div>
    88→
    89→      {/* Progress Steps */}
    90→      <div className="flex items-center gap-4 mb-8">
    91→        {/* Step 1 */}
    92→        <div className="flex items-center gap-2">
    93→          <div className={`
    94→            w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold
    95→            transition-all duration-200
    96→            ${currentStep === 'front' || frontPhoto
    97→              ? 'bg-[#00f3ff] text-black'
    98→              : 'bg-neutral-800 text-neutral-500'
    99→            }
   100→          `}>
   101→            {frontPhoto ? <Check className="w-4 h-4" /> : '1'}
   102→          </div>
   103→          <span className={`text-sm hidden sm:block ${currentStep === 'front' ? 'text-white font-medium' : 'text-neutral-500'}`}>
   104→            Front Photo
   105→          </span>
   106→        </div>
   107→
   108→        {/* Connector */}
   109→        <div className={`w-12 h-0.5 ${frontPhoto ? 'bg-[#00f3ff]' : 'bg-neutral-800'} transition-colors duration-200`} />
   110→
   111→        {/* Step 2 */}
   112→        <div className="flex items-center gap-2">
   113→          <div className={`
   114→            w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold
   115→            transition-all duration-200
   116→            ${currentStep === 'side'
   117→              ? 'bg-[#00f3ff] text-black'
   118→              : sidePhoto
   119→                ? 'bg-[#00f3ff] text-black'
   120→                : 'bg-neutral-800 text-neutral-500'
   121→            }
   122→          `}>
   123→            {sidePhoto ? <Check className="w-4 h-4" /> : '2'}
   124→          </div>
   125→          <span className={`text-sm hidden sm:block ${currentStep === 'side' ? 'text-white font-medium' : 'text-neutral-500'}`}>
   126→            Side Profile
   127→          </span>
   128→        </div>
   129→      </div>
   130→
   131→      {/* Header */}
   132→      <div className="text-center mb-8">
   133→        <div className="flex items-center justify-center gap-3 mb-3">
   134→          <StepIcon className="w-6 h-6 text-[#00f3ff]" />
   135→          <h1 className="text-2xl md:text-3xl font-semibold tracking-tight text-white">
   136→            {config.title}
   137→          </h1>
   138→        </div>
   139→        <p className="text-neutral-400 text-sm md:text-base max-w-md mx-auto">
   140→          {config.subtitle}
   141→        </p>
   142→      </div>
   143→
   144→      {/* Upload Container */}
   145→      <div className="w-full max-w-xl">
   146→        {!currentPhoto ? (
   147→          <div
   148→            {...getRootProps()}
   149→            className={`
   150→              relative w-full aspect-[4/3] rounded-xl border-2 border-dashed
   151→              flex flex-col items-center justify-center gap-4
   152→              cursor-pointer transition-all duration-200
   153→              ${isDragActive
   154→                ? 'border-[#00f3ff] bg-[#00f3ff]/5'
   155→                : 'border-neutral-700 bg-neutral-900/50 hover:border-neutral-600 hover:bg-neutral-900'
   156→              }
   157→            `}
   158→          >
   159→            <input {...getInputProps()} />
   160→
   161→            {/* Upload Icon */}
   162→            <div className={`
   163→              p-5 rounded-full transition-colors duration-200
   164→              ${isDragActive ? 'bg-[#00f3ff]/20' : 'bg-neutral-800'}
   165→            `}>
   166→              <Upload className={`
   167→                w-10 h-10 transition-colors duration-200
   168→                ${isDragActive ? 'text-[#00f3ff]' : 'text-neutral-500'}
   169→              `} />
   170→            </div>
   171→
   172→            {/* Text */}
   173→            <div className="text-center px-4">
   174→              <p className={`
   175→                text-base font-medium transition-colors duration-200
   176→                ${isDragActive ? 'text-[#00f3ff]' : 'text-neutral-300'}
   177→              `}>
   178→                {isDragActive ? 'Drop your image here' : 'Drag & drop your image here'}
   179→              </p>
   180→              <p className="text-neutral-500 mt-1.5 text-sm">
   181→                or <span className="text-neutral-300 underline underline-offset-2">browse</span> to upload
   182→              </p>
   183→            </div>
   184→
   185→            {/* Supported formats */}
   186→            <div className="flex items-center gap-2 text-xs text-neutral-500 mt-2">
   187→              <ImageIcon className="w-4 h-4" />
   188→              <span>JPG, PNG, WEBP supported</span>
   189→            </div>
   190→
   191→            {/* Photo guide hint */}
   192→            <div className="absolute bottom-4 left-4 right-4 text-center">
   193→              <p className="text-xs text-neutral-500">
   194→                {currentStep === 'front'
   195→                  ? 'Tip: Face the camera directly with neutral expression'
   196→                  : 'Tip: Turn 90° to show your side profile clearly'
   197→                }
   198→              </p>
   199→            </div>
   200→          </div>
   201→        ) : (
   202→          /* Preview */
   203→          <div className="relative w-full aspect-[4/3] rounded-xl overflow-hidden bg-neutral-900 border border-neutral-800">
   204→            {/* Image */}
   205→            <Image
   206→              src={currentPhoto.preview}
   207→              alt={`${currentStep} preview`}
   208→              fill
   209→              className="object-contain"
   210→              unoptimized
   211→            />
   212→
   213→            {/* Photo type badge */}
   214→            <div className="absolute top-4 left-4 px-3 py-1.5 rounded-full bg-black/80 border border-neutral-700 z-10">
   215→              <span className="text-white text-sm font-medium flex items-center gap-2">
   216→                <StepIcon className="w-4 h-4 text-[#00f3ff]" />
   217→                {currentStep === 'front' ? 'Front Photo' : 'Side Profile'}
   218→              </span>
   219→            </div>
   220→
   221→            {/* Remove button */}
   222→            <button
   223→              onClick={removeImage}
   224→              className="
   225→                absolute top-4 right-4 p-2 rounded-full
   226→                bg-black/80 border border-neutral-700
   227→                text-neutral-400 hover:text-white hover:border-neutral-600
   228→                transition-all duration-200 z-10
   229→              "
   230→            >
   231→              <X className="w-5 h-5" />
   232→            </button>
   233→
   234→            {/* File info */}
   235→            <div className="absolute bottom-4 left-4 right-4 px-4 py-3 rounded-lg bg-black/80 border border-neutral-700 z-10">
   236→              <p className="text-white font-medium truncate text-sm">{currentPhoto.file.name}</p>
   237→              <p className="text-neutral-500 text-xs mt-0.5">
   238→                {(currentPhoto.file.size / 1024 / 1024).toFixed(2)} MB
   239→              </p>
   240→            </div>
   241→          </div>
   242→        )}
   243→      </div>
   244→
   245→      {/* Navigation Buttons */}
   246→      <div className="flex items-center gap-4 mt-8">
   247→        {/* Back Button */}
   248→        <button
   249→          onClick={handleBack}
   250→          className="h-12 px-6 rounded-xl font-medium flex items-center gap-2 border border-neutral-700 bg-black text-white hover:bg-white/5 hover:border-neutral-600 transition-all duration-200"
   251→        >
   252→          <ArrowLeft className="w-4 h-4" />
   253→          Back
   254→        </button>
   255→
   256→        {/* Next Button */}
   257→        <button
   258→          onClick={handleNext}
   259→          disabled={!currentPhoto}
   260→          className={`
   261→            h-12 px-8 rounded-xl font-medium text-base
   262→            flex items-center gap-2
   263→            transition-all duration-200
   264→            ${currentPhoto
   265→              ? 'bg-[#00f3ff] text-black hover:shadow-[0_0_20px_rgba(0,243,255,0.3)] cursor-pointer'
   266→              : 'bg-neutral-800 text-neutral-500 cursor-not-allowed'
   267→            }
   268→          `}
   269→        >
   270→          {currentStep === 'front' ? 'Next: Side Profile' : 'Start Analysis'}
   271→          <ArrowRight className="w-4 h-4" />
   272→        </button>
   273→      </div>
   274→
   275→      {/* Thumbnails for both photos when on step 2 */}
   276→      {currentStep === 'side' && frontPhoto && (
   277→        <div className="mt-8 flex items-center gap-4">
   278→          <span className="text-neutral-500 text-sm">Uploaded:</span>
   279→          <button
   280→            className="relative w-16 h-16 rounded-lg overflow-hidden border-2 border-[#00f3ff] cursor-pointer hover:opacity-90 transition-opacity"
   281→            onClick={() => setCurrentStep('front')}
   282→          >
   283→            <Image
   284→              src={frontPhoto.preview}
   285→              alt="Front photo thumbnail"
   286→              fill
   287→              className="object-cover"
   288→              unoptimized
   289→            />
   290→            <div className="absolute inset-0 bg-black/30 flex items-center justify-center">
   291→              <User className="w-5 h-5 text-white" />
   292→            </div>
   293→          </button>
   294→          {sidePhoto && (
   295→            <div className="relative w-16 h-16 rounded-lg overflow-hidden border-2 border-[#00f3ff]">
   296→              <Image
   297→                src={sidePhoto.preview}
   298→                alt="Side photo thumbnail"
   299→                fill
   300→                className="object-cover"
   301→                unoptimized
   302→              />
   303→              <div className="absolute inset-0 bg-black/30 flex items-center justify-center">
   304→                <UserCircle className="w-5 h-5 text-white" />
   305→              </div>
   306→            </div>
   307→          )}
   308→        </div>
   309→      )}
   310→    </main>
   311→  );
   312→}
   313→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
