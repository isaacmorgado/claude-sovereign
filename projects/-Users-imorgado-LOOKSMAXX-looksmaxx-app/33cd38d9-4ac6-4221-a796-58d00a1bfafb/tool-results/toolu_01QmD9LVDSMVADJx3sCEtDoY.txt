     1→'use client';
     2→
     3→import { useState, useCallback } from 'react';
     4→import { useRouter } from 'next/navigation';
     5→import Image from 'next/image';
     6→import { useDropzone } from 'react-dropzone';
     7→import { motion, AnimatePresence } from 'framer-motion';
     8→import { Upload, X, Image as ImageIcon, ArrowRight, ArrowLeft, User, UserCircle } from 'lucide-react';
     9→import { useUpload } from '@/contexts/UploadContext';
    10→
    11→type UploadStep = 'front' | 'side';
    12→
    13→export default function UploadPage() {
    14→  const router = useRouter();
    15→  const { frontPhoto, sidePhoto, setFrontPhoto, setSidePhoto } = useUpload();
    16→  const [currentStep, setCurrentStep] = useState<UploadStep>('front');
    17→
    18→  const currentPhoto = currentStep === 'front' ? frontPhoto : sidePhoto;
    19→  const setCurrentPhoto = currentStep === 'front' ? setFrontPhoto : setSidePhoto;
    20→
    21→  const onDrop = useCallback((acceptedFiles: File[]) => {
    22→    const selectedFile = acceptedFiles[0];
    23→    if (selectedFile) {
    24→      const objectUrl = URL.createObjectURL(selectedFile);
    25→      setCurrentPhoto({ file: selectedFile, preview: objectUrl });
    26→    }
    27→  }, [setCurrentPhoto]);
    28→
    29→  const { getRootProps, getInputProps, isDragActive } = useDropzone({
    30→    onDrop,
    31→    accept: {
    32→      'image/*': ['.jpeg', '.jpg', '.png', '.webp']
    33→    },
    34→    maxFiles: 1,
    35→    multiple: false
    36→  });
    37→
    38→  const removeImage = () => {
    39→    if (currentPhoto?.preview) {
    40→      URL.revokeObjectURL(currentPhoto.preview);
    41→    }
    42→    setCurrentPhoto(null);
    43→  };
    44→
    45→  const handleNext = () => {
    46→    if (currentStep === 'front' && frontPhoto) {
    47→      setCurrentStep('side');
    48→    } else if (currentStep === 'side' && sidePhoto) {
    49→      router.push('/analysis');
    50→    }
    51→  };
    52→
    53→  const handleBack = () => {
    54→    if (currentStep === 'side') {
    55→      setCurrentStep('front');
    56→    } else {
    57→      router.push('/ethnicity');
    58→    }
    59→  };
    60→
    61→  const stepConfig = {
    62→    front: {
    63→      title: 'Upload Front-Facing Photo',
    64→      subtitle: 'Upload a clear, front-facing photo looking straight at the camera',
    65→      icon: User,
    66→      stepNumber: 1,
    67→    },
    68→    side: {
    69→      title: 'Upload Side Profile Photo',
    70→      subtitle: 'Upload a clear side profile photo showing your facial structure',
    71→      icon: UserCircle,
    72→      stepNumber: 2,
    73→    },
    74→  };
    75→
    76→  const config = stepConfig[currentStep];
    77→  const StepIcon = config.icon;
    78→
    79→  return (
    80→    <main className="min-h-screen bg-black flex flex-col items-center justify-center px-4 py-12">
    81→      {/* Progress Steps */}
    82→      <motion.div
    83→        initial={{ opacity: 0, y: -20 }}
    84→        animate={{ opacity: 1, y: 0 }}
    85→        className="flex items-center gap-4 mb-8"
    86→      >
    87→        {/* Step 1 */}
    88→        <div className="flex items-center gap-2">
    89→          <div className={`
    90→            w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold
    91→            transition-all duration-300
    92→            ${currentStep === 'front' || frontPhoto
    93→              ? 'bg-accent text-black shadow-[0_0_15px_rgba(0,243,255,0.5)]'
    94→              : 'bg-background-tertiary text-foreground-dim'
    95→            }
    96→          `}>
    97→            {frontPhoto ? '✓' : '1'}
    98→          </div>
    99→          <span className={`text-sm hidden sm:block ${currentStep === 'front' ? 'text-white' : 'text-foreground-dim'}`}>
   100→            Front Photo
   101→          </span>
   102→        </div>
   103→
   104→        {/* Connector */}
   105→        <div className={`w-12 h-0.5 ${frontPhoto ? 'bg-accent' : 'bg-border'} transition-colors duration-300`} />
   106→
   107→        {/* Step 2 */}
   108→        <div className="flex items-center gap-2">
   109→          <div className={`
   110→            w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold
   111→            transition-all duration-300
   112→            ${currentStep === 'side'
   113→              ? 'bg-accent text-black shadow-[0_0_15px_rgba(0,243,255,0.5)]'
   114→              : sidePhoto
   115→                ? 'bg-accent text-black'
   116→                : 'bg-background-tertiary text-foreground-dim'
   117→            }
   118→          `}>
   119→            {sidePhoto ? '✓' : '2'}
   120→          </div>
   121→          <span className={`text-sm hidden sm:block ${currentStep === 'side' ? 'text-white' : 'text-foreground-dim'}`}>
   122→            Side Profile
   123→          </span>
   124→        </div>
   125→      </motion.div>
   126→
   127→      {/* Header */}
   128→      <AnimatePresence mode="wait">
   129→        <motion.div
   130→          key={currentStep}
   131→          initial={{ opacity: 0, y: -20 }}
   132→          animate={{ opacity: 1, y: 0 }}
   133→          exit={{ opacity: 0, y: 20 }}
   134→          transition={{ duration: 0.3 }}
   135→          className="text-center mb-10"
   136→        >
   137→          <div className="flex items-center justify-center gap-3 mb-4">
   138→            <StepIcon className="w-8 h-8 text-accent" />
   139→            <h1 className="text-3xl md:text-4xl font-bold text-white">
   140→              {config.title}
   141→            </h1>
   142→          </div>
   143→          <p className="text-foreground-dim text-lg max-w-md mx-auto">
   144→            {config.subtitle}
   145→          </p>
   146→        </motion.div>
   147→      </AnimatePresence>
   148→
   149→      {/* Upload Container */}
   150→      <motion.div
   151→        initial={{ opacity: 0, scale: 0.95 }}
   152→        animate={{ opacity: 1, scale: 1 }}
   153→        transition={{ duration: 0.5, delay: 0.1 }}
   154→        className="w-full max-w-xl"
   155→      >
   156→        <AnimatePresence mode="wait">
   157→          {!currentPhoto ? (
   158→            /* Dropzone */
   159→            <motion.div
   160→              key={`dropzone-${currentStep}`}
   161→              initial={{ opacity: 0 }}
   162→              animate={{ opacity: 1 }}
   163→              exit={{ opacity: 0 }}
   164→            >
   165→              <div
   166→                {...getRootProps()}
   167→                className={`
   168→                  relative w-full aspect-[4/3] rounded-2xl border-2 border-dashed
   169→                  flex flex-col items-center justify-center gap-4
   170→                  cursor-pointer transition-all duration-300
   171→                  ${isDragActive
   172→                    ? 'border-accent bg-accent/10 shadow-[0_0_40px_rgba(0,243,255,0.3)]'
   173→                    : 'border-border bg-background-secondary hover:border-accent/50 hover:bg-background-tertiary'
   174→                  }
   175→                `}
   176→              >
   177→                <input {...getInputProps()} />
   178→
   179→                {/* Upload Icon */}
   180→                <motion.div
   181→                  animate={isDragActive ? { scale: 1.1, y: -5 } : { scale: 1, y: 0 }}
   182→                  transition={{ duration: 0.2 }}
   183→                  className={`
   184→                    p-6 rounded-full
   185→                    ${isDragActive ? 'bg-accent/20' : 'bg-background-tertiary'}
   186→                    transition-colors duration-300
   187→                  `}
   188→                >
   189→                  <Upload
   190→                    className={`
   191→                      w-12 h-12 transition-colors duration-300
   192→                      ${isDragActive ? 'text-accent' : 'text-foreground-dim'}
   193→                    `}
   194→                  />
   195→                </motion.div>
   196→
   197→                {/* Text */}
   198→                <div className="text-center px-4">
   199→                  <p className={`
   200→                    text-lg font-medium transition-colors duration-300
   201→                    ${isDragActive ? 'text-accent' : 'text-white'}
   202→                  `}>
   203→                    {isDragActive ? 'Drop your image here' : 'Drag & drop your image here'}
   204→                  </p>
   205→                  <p className="text-foreground-dim mt-2">
   206→                    or <span className="text-accent hover:text-accent-hover underline">browse</span> to upload
   207→                  </p>
   208→                </div>
   209→
   210→                {/* Supported formats */}
   211→                <div className="flex items-center gap-2 text-sm text-foreground-dim mt-2">
   212→                  <ImageIcon className="w-4 h-4" />
   213→                  <span>JPG, PNG, WEBP supported</span>
   214→                </div>
   215→
   216→                {/* Photo guide hint */}
   217→                <div className="absolute bottom-4 left-4 right-4 text-center">
   218→                  <p className="text-xs text-foreground-dim">
   219→                    {currentStep === 'front'
   220→                      ? 'Tip: Face the camera directly with neutral expression'
   221→                      : 'Tip: Turn 90° to show your side profile clearly'
   222→                    }
   223→                  </p>
   224→                </div>
   225→
   226→                {/* Decorative corners */}
   227→                <div className="absolute top-4 left-4 w-8 h-8 border-l-2 border-t-2 border-border-light rounded-tl-lg" />
   228→                <div className="absolute top-4 right-4 w-8 h-8 border-r-2 border-t-2 border-border-light rounded-tr-lg" />
   229→                <div className="absolute bottom-12 left-4 w-8 h-8 border-l-2 border-b-2 border-border-light rounded-bl-lg" />
   230→                <div className="absolute bottom-12 right-4 w-8 h-8 border-r-2 border-b-2 border-border-light rounded-br-lg" />
   231→              </div>
   232→            </motion.div>
   233→          ) : (
   234→            /* Preview */
   235→            <motion.div
   236→              key={`preview-${currentStep}`}
   237→              initial={{ opacity: 0, scale: 0.95 }}
   238→              animate={{ opacity: 1, scale: 1 }}
   239→              exit={{ opacity: 0, scale: 0.95 }}
   240→              className="relative w-full aspect-[4/3] rounded-2xl overflow-hidden bg-black border border-border"
   241→            >
   242→              {/* Image */}
   243→              <Image
   244→                src={currentPhoto.preview}
   245→                alt={`${currentStep} preview`}
   246→                fill
   247→                className="object-contain bg-black"
   248→                unoptimized
   249→              />
   250→
   251→              {/* Photo type badge */}
   252→              <div className="absolute top-4 left-4 px-3 py-1.5 rounded-full bg-accent/20 border border-accent/50 z-10">
   253→                <span className="text-accent text-sm font-medium flex items-center gap-2">
   254→                  <StepIcon className="w-4 h-4" />
   255→                  {currentStep === 'front' ? 'Front Photo' : 'Side Profile'}
   256→                </span>
   257→              </div>
   258→
   259→              {/* Remove button */}
   260→              <motion.button
   261→                initial={{ opacity: 0, scale: 0 }}
   262→                animate={{ opacity: 1, scale: 1 }}
   263→                transition={{ delay: 0.2 }}
   264→                onClick={removeImage}
   265→                className="
   266→                  absolute top-4 right-4 p-2 rounded-full
   267→                  bg-black/80 border border-border hover:border-error
   268→                  text-white hover:text-error
   269→                  transition-all duration-200
   270→                  hover:shadow-[0_0_15px_rgba(239,68,68,0.5)]
   271→                  z-10
   272→                "
   273→              >
   274→                <X className="w-5 h-5" />
   275→              </motion.button>
   276→
   277→              {/* File info */}
   278→              <div className="absolute bottom-4 left-4 right-4 px-4 py-3 rounded-lg bg-black/80 border border-border z-10">
   279→                <p className="text-white font-medium truncate">{currentPhoto.file.name}</p>
   280→                <p className="text-foreground-dim text-sm">
   281→                  {(currentPhoto.file.size / 1024 / 1024).toFixed(2)} MB
   282→                </p>
   283→              </div>
   284→            </motion.div>
   285→          )}
   286→        </AnimatePresence>
   287→      </motion.div>
   288→
   289→      {/* Navigation Buttons */}
   290→      <div className="flex items-center gap-4 mt-10">
   291→        {/* Back Button */}
   292→        <motion.button
   293→          initial={{ opacity: 0, x: -20 }}
   294→          animate={{ opacity: 1, x: 0 }}
   295→          transition={{ duration: 0.3, delay: 0.2 }}
   296→          onClick={handleBack}
   297→          className="
   298→            px-6 py-4 rounded-lg font-semibold
   299→            flex items-center gap-2
   300→            bg-background-tertiary text-foreground-dim
   301→            hover:text-white hover:border-accent/50
   302→            border border-border
   303→            transition-all duration-300
   304→          "
   305→        >
   306→          <ArrowLeft className="w-5 h-5" />
   307→          Back
   308→        </motion.button>
   309→
   310→        {/* Next Button */}
   311→        <motion.button
   312→          initial={{ opacity: 0, x: 20 }}
   313→          animate={{ opacity: 1, x: 0 }}
   314→          transition={{ duration: 0.3, delay: 0.2 }}
   315→          onClick={handleNext}
   316→          disabled={!currentPhoto}
   317→          className={`
   318→            px-8 py-4 rounded-lg font-semibold text-lg
   319→            flex items-center gap-3
   320→            transition-all duration-300
   321→            ${currentPhoto
   322→              ? 'bg-accent text-black hover:bg-accent-hover hover:shadow-[0_0_30px_rgba(0,243,255,0.5)] cursor-pointer'
   323→              : 'bg-background-tertiary text-foreground-dim cursor-not-allowed'
   324→            }
   325→          `}
   326→        >
   327→          {currentStep === 'front' ? 'Next: Side Profile' : 'Start Analysis'}
   328→          <ArrowRight className="w-5 h-5" />
   329→        </motion.button>
   330→      </div>
   331→
   332→      {/* Thumbnails for both photos when on step 2 */}
   333→      {currentStep === 'side' && frontPhoto && (
   334→        <motion.div
   335→          initial={{ opacity: 0, y: 20 }}
   336→          animate={{ opacity: 1, y: 0 }}
   337→          transition={{ delay: 0.3 }}
   338→          className="mt-8 flex items-center gap-4"
   339→        >
   340→          <div className="text-foreground-dim text-sm">Uploaded:</div>
   341→          <div
   342→            className="relative w-16 h-16 rounded-lg overflow-hidden border-2 border-accent cursor-pointer hover:scale-105 transition-transform"
   343→            onClick={() => setCurrentStep('front')}
   344→          >
   345→            <Image
   346→              src={frontPhoto.preview}
   347→              alt="Front photo thumbnail"
   348→              fill
   349→              className="object-cover"
   350→              unoptimized
   351→            />
   352→            <div className="absolute inset-0 bg-black/40 flex items-center justify-center">
   353→              <User className="w-5 h-5 text-white" />
   354→            </div>
   355→          </div>
   356→          {sidePhoto && (
   357→            <div className="relative w-16 h-16 rounded-lg overflow-hidden border-2 border-accent">
   358→              <Image
   359→                src={sidePhoto.preview}
   360→                alt="Side photo thumbnail"
   361→                fill
   362→                className="object-cover"
   363→                unoptimized
   364→              />
   365→              <div className="absolute inset-0 bg-black/40 flex items-center justify-center">
   366→                <UserCircle className="w-5 h-5 text-white" />
   367→              </div>
   368→            </div>
   369→          )}
   370→        </motion.div>
   371→      )}
   372→    </main>
   373→  );
   374→}
   375→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
