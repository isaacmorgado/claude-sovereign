     1→'use client';
     2→
     3→import { useState } from 'react';
     4→import { useRouter } from 'next/navigation';
     5→import { motion, AnimatePresence } from 'framer-motion';
     6→import { ArrowLeft, User, UserCircle, Check, BarChart3 } from 'lucide-react';
     7→import { useUpload } from '@/contexts/UploadContext';
     8→import { useGender } from '@/contexts/GenderContext';
     9→import { FrontProfileLandmarks } from '@/components/FrontProfileLandmarks';
    10→import { SideProfileManualTool } from '@/components/SideProfileManualTool';
    11→import { ResultsDashboard } from '@/components/ResultsDashboard';
    12→import { LandmarkPoint } from '@/lib/landmarks';
    13→
    14→type AnalysisStep = 'front' | 'side' | 'results';
    15→
    16→export default function AnalysisPage() {
    17→  const router = useRouter();
    18→  const { frontPhoto, sidePhoto } = useUpload();
    19→  const { gender } = useGender();
    20→  const [currentStep, setCurrentStep] = useState<AnalysisStep>('front');
    21→  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>([]);
    22→  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>([]);
    23→
    24→  // Redirect if no photos uploaded
    25→  if (!frontPhoto && !sidePhoto) {
    26→    return (
    27→      <main className="min-h-screen bg-black flex flex-col items-center justify-center px-4">
    28→        <motion.div
    29→          initial={{ opacity: 0, y: 20 }}
    30→          animate={{ opacity: 1, y: 0 }}
    31→          className="text-center"
    32→        >
    33→          <h1 className="text-2xl font-bold text-white mb-4">No Photos Found</h1>
    34→          <p className="text-foreground-dim mb-8">
    35→            Please upload your photos first to begin the analysis.
    36→          </p>
    37→          <button
    38→            onClick={() => router.push('/upload')}
    39→            className="px-6 py-3 rounded-lg bg-accent text-black font-semibold hover:bg-accent-hover transition-colors"
    40→          >
    41→            Go to Upload
    42→          </button>
    43→        </motion.div>
    44→      </main>
    45→    );
    46→  }
    47→
    48→  const handleFrontComplete = (landmarks: LandmarkPoint[]) => {
    49→    setFrontLandmarks(landmarks);
    50→    if (sidePhoto) {
    51→      setCurrentStep('side');
    52→    } else {
    53→      setCurrentStep('results');
    54→    }
    55→  };
    56→
    57→  const handleSideComplete = (landmarks: LandmarkPoint[]) => {
    58→    setSideLandmarks(landmarks);
    59→    setCurrentStep('results');
    60→  };
    61→
    62→  const handleBack = () => {
    63→    if (currentStep === 'side') {
    64→      setCurrentStep('front');
    65→    } else if (currentStep === 'results') {
    66→      setCurrentStep(sidePhoto ? 'side' : 'front');
    67→    } else {
    68→      router.push('/upload');
    69→    }
    70→  };
    71→
    72→  const stepConfig = {
    73→    front: {
    74→      title: 'Front Profile Analysis',
    75→      number: 1,
    76→      icon: User,
    77→    },
    78→    side: {
    79→      title: 'Side Profile Analysis',
    80→      number: 2,
    81→      icon: UserCircle,
    82→    },
    83→    results: {
    84→      title: 'Analysis Results',
    85→      number: 3,
    86→      icon: BarChart3,
    87→    },
    88→  };
    89→
    90→  const config = stepConfig[currentStep];
    91→
    92→  return (
    93→    <main className="min-h-screen bg-black flex flex-col items-center px-4 py-8">
    94→      {/* Header */}
    95→      <motion.div
    96→        initial={{ opacity: 0, y: -20 }}
    97→        animate={{ opacity: 1, y: 0 }}
    98→        className="w-full max-w-4xl mb-6"
    99→      >
   100→        <div className="flex items-center justify-between">
   101→          <button
   102→            onClick={handleBack}
   103→            className="flex items-center gap-2 text-foreground-dim hover:text-white transition-colors"
   104→          >
   105→            <ArrowLeft className="w-5 h-5" />
   106→            Back
   107→          </button>
   108→
   109→          {/* Step Indicators */}
   110→          <div className="flex items-center gap-3">
   111→            {/* Front Step */}
   112→            <div className="flex items-center gap-2">
   113→              <div
   114→                className={`
   115→                  w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold
   116→                  transition-all duration-300
   117→                  ${
   118→                    currentStep === 'front'
   119→                      ? 'bg-accent text-black shadow-[0_0_15px_rgba(0,243,255,0.5)]'
   120→                      : frontLandmarks.length > 0
   121→                        ? 'bg-green-500 text-white'
   122→                        : 'bg-background-tertiary text-foreground-dim'
   123→                  }
   124→                `}
   125→              >
   126→                {frontLandmarks.length > 0 && currentStep !== 'front' ? (
   127→                  <Check className="w-4 h-4" />
   128→                ) : (
   129→                  '1'
   130→                )}
   131→              </div>
   132→              <span
   133→                className={`text-sm hidden sm:block ${
   134→                  currentStep === 'front' ? 'text-white' : 'text-foreground-dim'
   135→                }`}
   136→              >
   137→                Front
   138→              </span>
   139→            </div>
   140→
   141→            {/* Connector */}
   142→            <div
   143→              className={`w-8 h-0.5 ${
   144→                frontLandmarks.length > 0 ? 'bg-accent' : 'bg-border'
   145→              } transition-colors duration-300`}
   146→            />
   147→
   148→            {/* Side Step */}
   149→            {sidePhoto && (
   150→              <>
   151→                <div className="flex items-center gap-2">
   152→                  <div
   153→                    className={`
   154→                      w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold
   155→                      transition-all duration-300
   156→                      ${
   157→                        currentStep === 'side'
   158→                          ? 'bg-accent text-black shadow-[0_0_15px_rgba(0,243,255,0.5)]'
   159→                          : sideLandmarks.length > 0
   160→                            ? 'bg-green-500 text-white'
   161→                            : 'bg-background-tertiary text-foreground-dim'
   162→                      }
   163→                    `}
   164→                  >
   165→                    {sideLandmarks.length > 0 && currentStep !== 'side' ? (
   166→                      <Check className="w-4 h-4" />
   167→                    ) : (
   168→                      '2'
   169→                    )}
   170→                  </div>
   171→                  <span
   172→                    className={`text-sm hidden sm:block ${
   173→                      currentStep === 'side' ? 'text-white' : 'text-foreground-dim'
   174→                    }`}
   175→                  >
   176→                    Side
   177→                  </span>
   178→                </div>
   179→
   180→                {/* Connector */}
   181→                <div
   182→                  className={`w-8 h-0.5 ${
   183→                    sideLandmarks.length > 0 ? 'bg-accent' : 'bg-border'
   184→                  } transition-colors duration-300`}
   185→                />
   186→              </>
   187→            )}
   188→
   189→            {/* Results Step */}
   190→            <div className="flex items-center gap-2">
   191→              <div
   192→                className={`
   193→                  w-8 h-8 rounded-full flex items-center justify-center text-sm font-semibold
   194→                  transition-all duration-300
   195→                  ${
   196→                    currentStep === 'results'
   197→                      ? 'bg-accent text-black shadow-[0_0_15px_rgba(0,243,255,0.5)]'
   198→                      : 'bg-background-tertiary text-foreground-dim'
   199→                  }
   200→                `}
   201→              >
   202→                {sidePhoto ? '3' : '2'}
   203→              </div>
   204→              <span
   205→                className={`text-sm hidden sm:block ${
   206→                  currentStep === 'results' ? 'text-white' : 'text-foreground-dim'
   207→                }`}
   208→              >
   209→                Results
   210→              </span>
   211→            </div>
   212→          </div>
   213→
   214→          {/* Current step badge */}
   215→          <div className="px-3 py-1 rounded-full bg-accent/20 border border-accent/50">
   216→            <span className="text-accent text-sm font-medium flex items-center gap-2">
   217→              <config.icon className="w-4 h-4" />
   218→              {config.title}
   219→            </span>
   220→          </div>
   221→        </div>
   222→      </motion.div>
   223→
   224→      {/* Main Content */}
   225→      <AnimatePresence mode="wait">
   226→        {currentStep === 'front' && frontPhoto && (
   227→          <motion.div
   228→            key="front"
   229→            initial={{ opacity: 0, x: -20 }}
   230→            animate={{ opacity: 1, x: 0 }}
   231→            exit={{ opacity: 0, x: 20 }}
   232→            className="w-full"
   233→          >
   234→            <FrontProfileLandmarks
   235→              imageUrl={frontPhoto.preview}
   236→              onLandmarksChange={setFrontLandmarks}
   237→              onComplete={handleFrontComplete}
   238→            />
   239→          </motion.div>
   240→        )}
   241→
   242→        {currentStep === 'side' && sidePhoto && (
   243→          <motion.div
   244→            key="side"
   245→            initial={{ opacity: 0, x: -20 }}
   246→            animate={{ opacity: 1, x: 0 }}
   247→            exit={{ opacity: 0, x: 20 }}
   248→            className="w-full"
   249→          >
   250→            <SideProfileManualTool
   251→              imageUrl={sidePhoto.preview}
   252→              onLandmarksChange={setSideLandmarks}
   253→              onComplete={handleSideComplete}
   254→            />
   255→          </motion.div>
   256→        )}
   257→
   258→        {currentStep === 'results' && (
   259→          <motion.div
   260→            key="results"
   261→            initial={{ opacity: 0, x: -20 }}
   262→            animate={{ opacity: 1, x: 0 }}
   263→            exit={{ opacity: 0, x: 20 }}
   264→            className="w-full max-w-5xl"
   265→          >
   266→            <ResultsDashboard
   267→              frontLandmarks={frontLandmarks}
   268→              sideLandmarks={sideLandmarks}
   269→              gender={gender || 'male'}
   270→            />
   271→
   272→            {/* Debug Output */}
   273→            <details className="mt-8">
   274→              <summary className="text-foreground-dim text-sm cursor-pointer hover:text-white">
   275→                View Raw Landmark Data (Debug)
   276→              </summary>
   277→              <pre className="mt-4 p-4 rounded-lg bg-background-secondary border border-border text-xs text-foreground-dim overflow-auto max-h-64">
   278→                {JSON.stringify(
   279→                  {
   280→                    front: frontLandmarks.map((l) => ({
   281→                      id: l.id,
   282→                      x: l.x.toFixed(4),
   283→                      y: l.y.toFixed(4),
   284→                    })),
   285→                    side: sideLandmarks.map((l) => ({
   286→                      id: l.id,
   287→                      x: l.x.toFixed(4),
   288→                      y: l.y.toFixed(4),
   289→                    })),
   290→                  },
   291→                  null,
   292→                  2
   293→                )}
   294→              </pre>
   295→            </details>
   296→          </motion.div>
   297→        )}
   298→      </AnimatePresence>
   299→    </main>
   300→  );
   301→}
   302→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
