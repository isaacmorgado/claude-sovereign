     1→'use client';
     2→
     3→import { useState, useMemo } from 'react';
     4→import { motion, AnimatePresence } from 'framer-motion';
     5→import { Search, Grid, List } from 'lucide-react';
     6→import { useResults } from '@/contexts/ResultsContext';
     7→import { TabContent } from '../ResultsLayout';
     8→import { MeasurementCard } from '../cards/MeasurementCard';
     9→import { ScoreCircle } from '../shared';
    10→import { FaceOverlay } from '../visualization/FaceOverlay';
    11→import { Ratio, MEASUREMENT_CATEGORIES } from '@/types/results';
    12→
    13→// ============================================
    14→// CATEGORY FILTER
    15→// ============================================
    16→
    17→interface CategoryFilterProps {
    18→  selectedCategory: string | null;
    19→  onSelect: (category: string | null) => void;
    20→  ratios: Ratio[];
    21→}
    22→
    23→function CategoryFilter({ selectedCategory, onSelect, ratios }: CategoryFilterProps) {
    24→  // Get unique categories from ratios
    25→  const categories = useMemo(() => {
    26→    const cats = new Set(ratios.map(r => r.category));
    27→    return Array.from(cats);
    28→  }, [ratios]);
    29→
    30→  // Count ratios per category
    31→  const categoryCounts = useMemo(() => {
    32→    const counts: Record<string, number> = {};
    33→    ratios.forEach(r => {
    34→      counts[r.category] = (counts[r.category] || 0) + 1;
    35→    });
    36→    return counts;
    37→  }, [ratios]);
    38→
    39→  return (
    40→    <div className="flex flex-wrap gap-2">
    41→      <button
    42→        onClick={() => onSelect(null)}
    43→        className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${
    44→          selectedCategory === null
    45→            ? 'bg-cyan-500 text-black'
    46→            : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'
    47→        }`}
    48→      >
    49→        All ({ratios.length})
    50→      </button>
    51→      {categories.map(cat => {
    52→        const catConfig = MEASUREMENT_CATEGORIES.find(c =>
    53→          c.name.toLowerCase().includes(cat.toLowerCase()) ||
    54→          cat.toLowerCase().includes(c.name.toLowerCase())
    55→        );
    56→        return (
    57→          <button
    58→            key={cat}
    59→            onClick={() => onSelect(cat)}
    60→            className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${
    61→              selectedCategory === cat
    62→                ? 'text-black'
    63→                : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'
    64→            }`}
    65→            style={selectedCategory === cat ? { backgroundColor: catConfig?.color || '#67e8f9' } : {}}
    66→          >
    67→            {cat} ({categoryCounts[cat] || 0})
    68→          </button>
    69→        );
    70→      })}
    71→    </div>
    72→  );
    73→}
    74→
    75→// ============================================
    76→// SEARCH BAR
    77→// ============================================
    78→
    79→interface SearchBarProps {
    80→  value: string;
    81→  onChange: (value: string) => void;
    82→}
    83→
    84→function SearchBar({ value, onChange }: SearchBarProps) {
    85→  return (
    86→    <div className="relative">
    87→      <Search size={18} className="absolute left-3 top-1/2 -translate-y-1/2 text-neutral-500" />
    88→      <input
    89→        type="text"
    90→        value={value}
    91→        onChange={(e) => onChange(e.target.value)}
    92→        placeholder="Search measurements..."
    93→        className="w-full pl-10 pr-4 py-2 bg-neutral-800 border border-neutral-700 rounded-lg text-white placeholder-neutral-500 focus:outline-none focus:border-cyan-500 transition-colors"
    94→      />
    95→    </div>
    96→  );
    97→}
    98→
    99→// ============================================
   100→// RATIOS TAB (SHARED FOR FRONT/SIDE)
   101→// ============================================
   102→
   103→interface RatiosTabProps {
   104→  profileType: 'front' | 'side';
   105→}
   106→
   107→export function RatiosTab({ profileType }: RatiosTabProps) {
   108→  const {
   109→    frontRatios,
   110→    sideRatios,
   111→    frontScore,
   112→    sideScore,
   113→    frontPhoto,
   114→    sidePhoto,
   115→    frontLandmarks,
   116→    sideLandmarks,
   117→    expandedMeasurementId,
   118→    setExpandedMeasurementId,
   119→    selectedVisualizationMetric,
   120→    setSelectedVisualizationMetric,
   121→  } = useResults();
   122→
   123→  const [searchQuery, setSearchQuery] = useState('');
   124→  const [categoryFilter, setCategoryFilter] = useState<string | null>(null);
   125→  const [viewMode, setViewMode] = useState<'list' | 'grid'>('list');
   126→
   127→  // Select data based on profile type
   128→  const ratios = profileType === 'front' ? frontRatios : sideRatios;
   129→  const score = profileType === 'front' ? frontScore : sideScore;
   130→  const photo = profileType === 'front' ? frontPhoto : sidePhoto;
   131→  const landmarks = profileType === 'front' ? frontLandmarks : sideLandmarks;
   132→
   133→  // Filter ratios
   134→  const filteredRatios = useMemo(() => {
   135→    let filtered = ratios;
   136→
   137→    if (categoryFilter) {
   138→      filtered = filtered.filter(r => r.category === categoryFilter);
   139→    }
   140→
   141→    if (searchQuery) {
   142→      const query = searchQuery.toLowerCase();
   143→      filtered = filtered.filter(r =>
   144→        r.name.toLowerCase().includes(query) ||
   145→        r.category.toLowerCase().includes(query)
   146→      );
   147→    }
   148→
   149→    return filtered;
   150→  }, [ratios, categoryFilter, searchQuery]);
   151→
   152→  // Get selected ratio for visualization
   153→  const selectedRatio = ratios.find(r => r.id === selectedVisualizationMetric);
   154→
   155→  return (
   156→    <TabContent
   157→      title={`${profileType === 'front' ? 'Front' : 'Side'} Profile Ratios`}
   158→      subtitle={`${ratios.length} measurements analyzed`}
   159→      rightContent={
   160→        <div className="flex items-center gap-3">
   161→          <ScoreCircle score={score} size="md" animate={false} />
   162→        </div>
   163→      }
   164→    >
   165→      <div className="flex flex-col lg:flex-row gap-6">
   166→        {/* Main Content */}
   167→        <div className="flex-1 min-w-0">
   168→          {/* Filters */}
   169→          <div className="mb-6 space-y-4">
   170→            <div className="flex flex-col sm:flex-row gap-4">
   171→              <div className="flex-1">
   172→                <SearchBar value={searchQuery} onChange={setSearchQuery} />
   173→              </div>
   174→              <div className="flex gap-2">
   175→                <button
   176→                  onClick={() => setViewMode('list')}
   177→                  className={`p-2 rounded-lg transition-colors ${
   178→                    viewMode === 'list'
   179→                      ? 'bg-cyan-500 text-black'
   180→                      : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'
   181→                  }`}
   182→                >
   183→                  <List size={18} />
   184→                </button>
   185→                <button
   186→                  onClick={() => setViewMode('grid')}
   187→                  className={`p-2 rounded-lg transition-colors ${
   188→                    viewMode === 'grid'
   189→                      ? 'bg-cyan-500 text-black'
   190→                      : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'
   191→                  }`}
   192→                >
   193→                  <Grid size={18} />
   194→                </button>
   195→              </div>
   196→            </div>
   197→
   198→            <CategoryFilter
   199→              selectedCategory={categoryFilter}
   200→              onSelect={setCategoryFilter}
   201→              ratios={ratios}
   202→            />
   203→          </div>
   204→
   205→          {/* Results count */}
   206→          <p className="text-sm text-neutral-500 mb-4">
   207→            Showing {filteredRatios.length} of {ratios.length} measurements
   208→          </p>
   209→
   210→          {/* Ratios List */}
   211→          <motion.div
   212→            className={viewMode === 'grid' ? 'grid grid-cols-1 md:grid-cols-2 gap-4' : 'space-y-3'}
   213→            layout
   214→          >
   215→            <AnimatePresence mode="popLayout">
   216→              {filteredRatios.map((ratio) => (
   217→                <motion.div
   218→                  key={ratio.id}
   219→                  layout
   220→                  initial={{ opacity: 0, scale: 0.95 }}
   221→                  animate={{ opacity: 1, scale: 1 }}
   222→                  exit={{ opacity: 0, scale: 0.95 }}
   223→                  transition={{ duration: 0.2 }}
   224→                >
   225→                  <MeasurementCard
   226→                    ratio={ratio}
   227→                    isExpanded={expandedMeasurementId === ratio.id}
   228→                    onToggle={() => {
   229→                      const isExpanding = expandedMeasurementId !== ratio.id;
   230→                      setExpandedMeasurementId(isExpanding ? ratio.id : null);
   231→                      // Auto-update face preview when expanding
   232→                      if (isExpanding) {
   233→                        setSelectedVisualizationMetric(ratio.id);
   234→                      }
   235→                    }}
   236→                  />
   237→                </motion.div>
   238→              ))}
   239→            </AnimatePresence>
   240→          </motion.div>
   241→
   242→          {filteredRatios.length === 0 && (
   243→            <div className="text-center py-12">
   244→              <Search size={48} className="mx-auto text-neutral-700 mb-4" />
   245→              <p className="text-neutral-500">No measurements found matching your criteria</p>
   246→            </div>
   247→          )}
   248→        </div>
   249→
   250→        {/* Face Visualization Panel (sticky on desktop) */}
   251→        {photo && (
   252→          <div className="lg:w-[380px] lg:flex-shrink-0">
   253→            <div className="lg:sticky lg:top-6 lg:max-h-[calc(100vh-3rem)]">
   254→              <FaceOverlay
   255→                photo={photo}
   256→                landmarks={landmarks}
   257→                selectedRatio={selectedRatio || null}
   258→                profileType={profileType}
   259→              />
   260→            </div>
   261→          </div>
   262→        )}
   263→      </div>
   264→    </TabContent>
   265→  );
   266→}
   267→
   268→// ============================================
   269→// FRONT RATIOS TAB
   270→// ============================================
   271→
   272→export function FrontRatiosTab() {
   273→  return <RatiosTab profileType="front" />;
   274→}
   275→
   276→// ============================================
   277→// SIDE RATIOS TAB
   278→// ============================================
   279→
   280→export function SideRatiosTab() {
   281→  return <RatiosTab profileType="side" />;
   282→}
   283→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
