     1→'use client';
     2→
     3→import { motion } from 'framer-motion';
     4→import { User, ScanFace, Sparkles, ChevronRight, TrendingUp, TrendingDown, Lightbulb } from 'lucide-react';
     5→import { useResults } from '@/contexts/ResultsContext';
     6→import { TabContent } from '../ResultsLayout';
     7→import { ScoreBar, AnimatedScore, ShareButton, ExportButton } from '../shared';
     8→import { KeyStrengthsSection, AreasOfImprovementSection } from '../cards/KeyStrengthsFlaws';
     9→import { FacialRadarChart } from '../visualization/FacialRadarChart';
    10→import { RatioDetailModal } from '../modals/RatioDetailModal';
    11→import { getScoreColor, ResponsibleRatio, Ratio } from '@/types/results';
    12→import { FaceIQScoreResult } from '@/lib/faceiq-scoring';
    13→import { RankedMetric, getWeightTierColor } from '@/lib/looksmax-scoring';
    14→import { useState, useCallback, useMemo } from 'react';
    15→
    16→// ============================================
    17→// SCORE SUMMARY CARDS
    18→// ============================================
    19→
    20→interface ProfileScoreCardProps {
    21→  title: string;
    22→  score: number;
    23→  icon: React.ReactNode;
    24→  photo?: string;
    25→  ratioCount: number;
    26→  onClick?: () => void;
    27→}
    28→
    29→function ProfileScoreCard({ title, score, icon, photo, ratioCount, onClick }: ProfileScoreCardProps) {
    30→  const color = getScoreColor(score);
    31→
    32→  return (
    33→    <motion.button
    34→      onClick={onClick}
    35→      className="bg-neutral-900/80 border border-neutral-800 rounded-xl p-4 hover:border-neutral-700 transition-all text-left w-full"
    36→      whileHover={{ scale: 1.02 }}
    37→      whileTap={{ scale: 0.98 }}
    38→    >
    39→      <div className="flex items-center gap-4">
    40→        {/* Photo or icon */}
    41→        <div className="relative w-16 h-16 rounded-lg overflow-hidden bg-neutral-800 flex-shrink-0">
    42→          {photo ? (
    43→            <img src={photo} alt={title} className="w-full h-full object-cover" />
    44→          ) : (
    45→            <div className="w-full h-full flex items-center justify-center">
    46→              {icon}
    47→            </div>
    48→          )}
    49→        </div>
    50→
    51→        {/* Info */}
    52→        <div className="flex-1">
    53→          <h3 className="text-sm font-medium text-neutral-400 mb-1">{title}</h3>
    54→          <div className="flex items-baseline gap-2">
    55→            <span className="text-2xl font-bold" style={{ color }}>
    56→              {score.toFixed(2)}
    57→            </span>
    58→            <span className="text-sm text-neutral-500">/ 10</span>
    59→          </div>
    60→          <p className="text-xs text-neutral-500 mt-1">{ratioCount} measurements</p>
    61→        </div>
    62→
    63→        {/* Arrow */}
    64→        <ChevronRight size={20} className="text-neutral-600" />
    65→      </div>
    66→
    67→      {/* Score bar */}
    68→      <div className="mt-3">
    69→        <ScoreBar score={score} height={6} />
    70→      </div>
    71→    </motion.button>
    72→  );
    73→}
    74→
    75→// ============================================
    76→// QUICK INSIGHTS - TOP/BOTTOM METRICS WITH ADVICE
    77→// ============================================
    78→
    79→interface MetricInsightCardProps {
    80→  metric: RankedMetric;
    81→  type: 'strength' | 'improvement';
    82→  index: number;
    83→}
    84→
    85→function MetricInsightCard({ metric, type, index }: MetricInsightCardProps) {
    86→  const isStrength = type === 'strength';
    87→  const color = getScoreColor(metric.score);
    88→  const weightTierClass = getWeightTierColor(metric.weightTier);
    89→
    90→  return (
    91→    <motion.div
    92→      className={`bg-neutral-900/80 border rounded-xl p-4 ${
    93→        isStrength ? 'border-green-500/30' : 'border-orange-500/30'
    94→      }`}
    95→      initial={{ opacity: 0, x: isStrength ? -20 : 20 }}
    96→      animate={{ opacity: 1, x: 0 }}
    97→      transition={{ delay: 0.1 * index }}
    98→    >
    99→      <div className="flex items-start gap-3">
   100→        <div className={`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${
   101→          isStrength ? 'bg-green-500/20' : 'bg-orange-500/20'
   102→        }`}>
   103→          {isStrength ? (
   104→            <TrendingUp size={16} className="text-green-400" />
   105→          ) : (
   106→            <TrendingDown size={16} className="text-orange-400" />
   107→          )}
   108→        </div>
   109→
   110→        <div className="flex-1 min-w-0">
   111→          <div className="flex items-center gap-2 mb-1">
   112→            <h4 className="font-medium text-white text-sm truncate">{metric.name}</h4>
   113→            <span className={`text-xs px-1.5 py-0.5 rounded border ${weightTierClass}`}>
   114→              {metric.weightTier === 'high' ? '3x' : metric.weightTier === 'medium' ? '2x' : '1x'}
   115→            </span>
   116→          </div>
   117→
   118→          <div className="flex items-center gap-3 mb-2">
   119→            <span className="text-lg font-bold" style={{ color }}>
   120→              {metric.score.toFixed(1)}
   121→            </span>
   122→            <span className="text-xs text-neutral-500">
   123→              Ideal: {metric.idealMin.toFixed(1)} - {metric.idealMax.toFixed(1)}
   124→            </span>
   125→          </div>
   126→
   127→          {/* Advice */}
   128→          <div className="flex items-start gap-2 mt-2 p-2 bg-neutral-800/50 rounded-lg">
   129→            <Lightbulb size={14} className={isStrength ? 'text-green-400 mt-0.5' : 'text-orange-400 mt-0.5'} />
   130→            <p className="text-xs text-neutral-300 leading-relaxed">{metric.advice}</p>
   131→          </div>
   132→        </div>
   133→      </div>
   134→    </motion.div>
   135→  );
   136→}
   137→
   138→interface QuickInsightsSectionProps {
   139→  topMetrics: RankedMetric[];
   140→  bottomMetrics: RankedMetric[];
   141→}
   142→
   143→function QuickInsightsSection({ topMetrics, bottomMetrics }: QuickInsightsSectionProps) {
   144→  if (topMetrics.length === 0 && bottomMetrics.length === 0) return null;
   145→
   146→  return (
   147→    <div className="mb-8">
   148→      <h3 className="text-lg font-semibold text-white mb-4 flex items-center gap-2">
   149→        <Lightbulb size={20} className="text-cyan-400" />
   150→        Quick Insights
   151→      </h3>
   152→
   153→      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
   154→        {/* Top 3 Strengths */}
   155→        <div>
   156→          <h4 className="text-sm font-medium text-green-400 mb-3 flex items-center gap-2">
   157→            <TrendingUp size={14} />
   158→            Top Strengths
   159→          </h4>
   160→          <div className="space-y-3">
   161→            {topMetrics.map((metric, index) => (
   162→              <MetricInsightCard
   163→                key={metric.metricId}
   164→                metric={metric}
   165→                type="strength"
   166→                index={index}
   167→              />
   168→            ))}
   169→          </div>
   170→        </div>
   171→
   172→        {/* Bottom 3 - Areas to Improve */}
   173→        <div>
   174→          <h4 className="text-sm font-medium text-orange-400 mb-3 flex items-center gap-2">
   175→            <TrendingDown size={14} />
   176→            Areas to Improve
   177→          </h4>
   178→          <div className="space-y-3">
   179→            {bottomMetrics.map((metric, index) => (
   180→              <MetricInsightCard
   181→                key={metric.metricId}
   182→                metric={metric}
   183→                type="improvement"
   184→                index={index}
   185→              />
   186→            ))}
   187→          </div>
   188→        </div>
   189→      </div>
   190→    </div>
   191→  );
   192→}
   193→
   194→// ============================================
   195→// HARMONY SCORE DISPLAY (with AnimatedScore and Radar Chart)
   196→// ============================================
   197→
   198→function HarmonyScoreDisplay() {
   199→  const { overallScore, frontScore, sideScore, harmonyPercentage, harmonyScoreResult } = useResults();
   200→  const [showRadar, setShowRadar] = useState(true);
   201→
   202→  return (
   203→    <motion.div
   204→      className="bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-2xl p-6 md:p-8"
   205→      initial={{ opacity: 0, y: 20 }}
   206→      animate={{ opacity: 1, y: 0 }}
   207→      transition={{ duration: 0.5 }}
   208→    >
   209→      <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
   210→        {/* Left: Score Display */}
   211→        <div className="text-center flex flex-col justify-center">
   212→          <h2 className="text-lg font-medium text-neutral-400 mb-2">Weighted Harmony Score</h2>
   213→
   214→          {/* Harmony Percentage Badge */}
   215→          <motion.div
   216→            className="flex justify-center mb-4"
   217→            initial={{ scale: 0 }}
   218→            animate={{ scale: 1 }}
   219→            transition={{ delay: 0.3, type: 'spring' }}
   220→          >
   221→            <div className="px-4 py-1 bg-gradient-to-r from-purple-500/20 to-cyan-500/20 border border-purple-500/30 rounded-full">
   222→              <span className="text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-cyan-400">
   223→                {harmonyPercentage.toFixed(1)}%
   224→              </span>
   225→            </div>
   226→          </motion.div>
   227→
   228→          {/* Animated Score */}
   229→          <div className="flex justify-center mb-4">
   230→            <AnimatedScore
   231→              score={overallScore}
   232→              duration={2.5}
   233→              delay={0.5}
   234→              showConfetti={true}
   235→              confettiThreshold={7.5}
   236→            />
   237→          </div>
   238→
   239→          {/* Profile Breakdowns */}
   240→          <div className="flex justify-center gap-8 mb-4">
   241→            <div className="text-center">
   242→              <p className="text-xs text-neutral-500 mb-1">Front Profile</p>
   243→              <p className="text-xl font-bold" style={{ color: getScoreColor(frontScore) }}>
   244→                {frontScore.toFixed(2)}
   245→              </p>
   246→            </div>
   247→            <div className="w-px bg-neutral-800" />
   248→            <div className="text-center">
   249→              <p className="text-xs text-neutral-500 mb-1">Side Profile</p>
   250→              <p className="text-xl font-bold" style={{ color: getScoreColor(sideScore) }}>
   251→                {sideScore.toFixed(2)}
   252→              </p>
   253→            </div>
   254→          </div>
   255→
   256→          {/* Weight Distribution */}
   257→          {harmonyScoreResult && (
   258→            <div className="flex justify-center gap-3 mb-4 text-xs">
   259→              <span className="px-2 py-1 rounded bg-purple-500/20 text-purple-400 border border-purple-500/30">
   260→                High Impact: {harmonyScoreResult.weightDistribution.highImpact.count}
   261→              </span>
   262→              <span className="px-2 py-1 rounded bg-blue-500/20 text-blue-400 border border-blue-500/30">
   263→                Medium: {harmonyScoreResult.weightDistribution.mediumImpact.count}
   264→              </span>
   265→              <span className="px-2 py-1 rounded bg-gray-500/20 text-gray-400 border border-gray-500/30">
   266→                Standard: {harmonyScoreResult.weightDistribution.standard.count}
   267→              </span>
   268→            </div>
   269→          )}
   270→
   271→          <p className="text-sm text-neutral-400 max-w-md mx-auto">
   272→            {harmonyPercentage >= 80 ? 'Exceptional facial harmony. Your features are well-balanced and proportioned.' :
   273→              harmonyPercentage >= 60 ? 'Good facial harmony with some areas that could be optimized.' :
   274→                harmonyPercentage >= 40 ? 'Average facial harmony. Several areas have room for improvement.' :
   275→                  'Below average facial harmony. Multiple areas could benefit from attention.'}
   276→          </p>
   277→        </div>
   278→
   279→        {/* Right: Radar Chart */}
   280→        <div className="flex flex-col">
   281→          <div className="flex items-center justify-between mb-2">
   282→            <h3 className="text-sm font-medium text-neutral-400">Category Breakdown</h3>
   283→            <button
   284→              onClick={() => setShowRadar(!showRadar)}
   285→              className="text-xs text-cyan-400 hover:text-cyan-300 transition-colors"
   286→            >
   287→              {showRadar ? 'Hide' : 'Show'}
   288→            </button>
   289→          </div>
   290→          {showRadar && (
   291→            <motion.div
   292→              initial={{ opacity: 0, scale: 0.95 }}
   293→              animate={{ opacity: 1, scale: 1 }}
   294→              transition={{ duration: 0.5, delay: 0.3 }}
   295→              className="flex-1 min-h-[280px]"
   296→            >
   297→              <FacialRadarChart height={280} />
   298→            </motion.div>
   299→          )}
   300→        </div>
   301→      </div>
   302→    </motion.div>
   303→  );
   304→}
   305→
   306→// ============================================
   307→// OVERVIEW TAB
   308→// ============================================
   309→
   310→export function OverviewTab() {
   311→  const {
   312→    overallScore,
   313→    frontScore,
   314→    sideScore,
   315→    frontRatios,
   316→    sideRatios,
   317→    strengths,
   318→    flaws,
   319→    frontPhoto,
   320→    sidePhoto,
   321→    gender,
   322→    ethnicity,
   323→    setActiveTab,
   324→    topMetrics,
   325→    bottomMetrics,
   326→  } = useResults();
   327→
   328→  const [selectedRatio, setSelectedRatio] = useState<FaceIQScoreResult | null>(null);
   329→  const [isModalOpen, setIsModalOpen] = useState(false);
   330→
   331→  // All ratios combined for modal navigation
   332→  const allRatios = useMemo(() => [...frontRatios, ...sideRatios], [frontRatios, sideRatios]);
   333→
   334→  // Current ratio index for navigation
   335→  const currentRatioIndex = useMemo(() => {
   336→    if (!selectedRatio) return -1;
   337→    return allRatios.findIndex(r => r.id === selectedRatio.metricId);
   338→  }, [selectedRatio, allRatios]);
   339→
   340→  // Convert Ratio to FaceIQScoreResult for modal
   341→  const ratioToFaceIQResult = useCallback((ratio: Ratio): FaceIQScoreResult => {
   342→    return {
   343→      metricId: ratio.id,
   344→      name: ratio.name,
   345→      value: ratio.value,
   346→      score: ratio.score,
   347→      standardizedScore: ratio.standardizedScore,
   348→      idealMin: ratio.idealMin,
   349→      idealMax: ratio.idealMax,
   350→      deviation: 0,
   351→      deviationDirection: 'within',
   352→      unit: ratio.unit === 'x' ? 'ratio' : ratio.unit === '%' ? 'percent' : ratio.unit === '°' ? 'degrees' : ratio.unit,
   353→      category: ratio.category,
   354→      qualityTier: ratio.qualityLevel,
   355→      severity: ratio.severity,
   356→    } as FaceIQScoreResult;
   357→  }, []);
   358→
   359→  // Handle ratio click from strengths/flaws sections
   360→  const handleRatioClick = useCallback((ratio: ResponsibleRatio, categoryName: string) => {
   361→    // Find the full ratio data from frontRatios or sideRatios
   362→    const fullRatio = allRatios.find(
   363→      (r) => r.name === ratio.ratioName || r.id === ratio.ratioId
   364→    );
   365→
   366→    if (fullRatio) {
   367→      setSelectedRatio(ratioToFaceIQResult(fullRatio));
   368→    } else {
   369→      // Create a minimal FaceIQScoreResult from ResponsibleRatio
   370→      setSelectedRatio({
   371→        metricId: ratio.ratioId,
   372→        name: ratio.ratioName,
   373→        value: ratio.value,
   374→        score: ratio.score,
   375→        standardizedScore: ratio.score,
   376→        idealMin: ratio.idealMin,
   377→        idealMax: ratio.idealMax,
   378→        deviation: 0,
   379→        deviationDirection: 'within',
   380→        unit: (ratio.unit as 'ratio' | 'percent' | 'degrees' | 'mm' | 'none') || 'ratio',
   381→        category: ratio.category || categoryName,
   382→        qualityTier: ratio.score >= 8 ? 'ideal' : ratio.score >= 6 ? 'excellent' : ratio.score >= 4 ? 'good' : 'below_average',
   383→        severity: 'optimal',
   384→      } as FaceIQScoreResult);
   385→    }
   386→    setIsModalOpen(true);
   387→  }, [allRatios, ratioToFaceIQResult]);
   388→
   389→  // Navigate to previous/next ratio in modal
   390→  const handlePreviousRatio = useCallback(() => {
   391→    if (currentRatioIndex > 0) {
   392→      setSelectedRatio(ratioToFaceIQResult(allRatios[currentRatioIndex - 1]));
   393→    }
   394→  }, [currentRatioIndex, allRatios, ratioToFaceIQResult]);
   395→
   396→  const handleNextRatio = useCallback(() => {
   397→    if (currentRatioIndex < allRatios.length - 1) {
   398→      setSelectedRatio(ratioToFaceIQResult(allRatios[currentRatioIndex + 1]));
   399→    }
   400→  }, [currentRatioIndex, allRatios, ratioToFaceIQResult]);
   401→
   402→  // Get appropriate face photo for modal
   403→  const getModalPhoto = useCallback(() => {
   404→    if (!selectedRatio) return frontPhoto;
   405→
   406→    // Check if this is a side profile metric
   407→    const sideMetricIds = sideRatios.map(r => r.id);
   408→    if (sideMetricIds.includes(selectedRatio.metricId)) {
   409→      return sidePhoto || frontPhoto;
   410→    }
   411→    return frontPhoto;
   412→  }, [selectedRatio, sideRatios, frontPhoto, sidePhoto]);
   413→
   414→  return (
   415→    <TabContent
   416→      title="Overview"
   417→      subtitle="Your complete facial harmony analysis"
   418→      rightContent={
   419→        <div className="flex items-center gap-2">
   420→          <ShareButton score={overallScore} frontScore={frontScore} sideScore={sideScore} />
   421→          <ExportButton elementId="results-overview" />
   422→        </div>
   423→      }
   424→    >
   425→      {/* Main content with ID for export */}
   426→      <div id="results-overview">
   427→        {/* Harmony Score */}
   428→        <div className="mb-8">
   429→          <HarmonyScoreDisplay />
   430→        </div>
   431→
   432→        {/* Profile Scores */}
   433→        <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
   434→          <ProfileScoreCard
   435→            title="Front Profile"
   436→            score={frontScore}
   437→            icon={<User size={24} className="text-neutral-600" />}
   438→            photo={frontPhoto}
   439→            ratioCount={frontRatios.length}
   440→            onClick={() => setActiveTab('front-ratios')}
   441→          />
   442→          <ProfileScoreCard
   443→            title="Side Profile"
   444→            score={sideScore}
   445→            icon={<ScanFace size={24} className="text-neutral-600" />}
   446→            photo={sidePhoto || undefined}
   447→            ratioCount={sideRatios.length}
   448→            onClick={() => setActiveTab('side-ratios')}
   449→          />
   450→        </div>
   451→
   452→        {/* Quick Insights - Top/Bottom Metrics with Advice (from looksmax_engine.py) */}
   453→        <QuickInsightsSection topMetrics={topMetrics} bottomMetrics={bottomMetrics} />
   454→
   455→        {/* Strengths & Flaws Grid - FaceIQ Style */}
   456→        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
   457→          {/* Key Strengths */}
   458→          <KeyStrengthsSection
   459→            strengths={strengths}
   460→            onRatioClick={handleRatioClick}
   461→            initialShowCount={3}
   462→          />
   463→
   464→          {/* Areas of Improvement */}
   465→          <AreasOfImprovementSection
   466→            flaws={flaws}
   467→            onRatioClick={handleRatioClick}
   468→            initialShowCount={3}
   469→          />
   470→        </div>
   471→
   472→        {/* Call to Action */}
   473→        <motion.div
   474→          className="bg-gradient-to-r from-cyan-500/20 to-blue-600/20 border border-cyan-500/30 rounded-xl p-6 flex items-center justify-between"
   475→          initial={{ opacity: 0 }}
   476→          animate={{ opacity: 1 }}
   477→          transition={{ delay: 0.5 }}
   478→        >
   479→          <div className="flex items-center gap-4">
   480→            <div className="w-12 h-12 rounded-xl bg-cyan-500/20 flex items-center justify-center">
   481→              <Sparkles size={24} className="text-cyan-400" />
   482→            </div>
   483→            <div>
   484→              <h3 className="font-semibold text-white">Unlock Your Potential</h3>
   485→              <p className="text-sm text-neutral-400">
   486→                See personalized recommendations to improve your harmony score
   487→              </p>
   488→            </div>
   489→          </div>
   490→          <button
   491→            onClick={() => setActiveTab('plan')}
   492→            className="px-4 py-2 bg-cyan-500 text-black font-medium rounded-lg hover:bg-cyan-400 transition-colors flex items-center gap-2"
   493→          >
   494→            View Plan
   495→            <ChevronRight size={16} />
   496→          </button>
   497→        </motion.div>
   498→      </div>{/* End of results-overview */}
   499→
   500→      {/* Ratio Detail Modal */}
   501→      <RatioDetailModal
   502→        isOpen={isModalOpen}
   503→        onClose={() => setIsModalOpen(false)}
   504→        ratio={selectedRatio}
   505→        onPrevious={handlePreviousRatio}
   506→        onNext={handleNextRatio}
   507→        hasPrevious={currentRatioIndex > 0}
   508→        hasNext={currentRatioIndex < allRatios.length - 1}
   509→        facePhoto={getModalPhoto()}
   510→        gender={gender}
   511→        ethnicity={ethnicity}
   512→      />
   513→    </TabContent>
   514→  );
   515→}
   516→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
