{"type":"file-history-snapshot","messageId":"d88a6918-cf92-4726-8626-8a52fe8c8cbf","snapshot":{"messageId":"d88a6918-cf92-4726-8626-8a52fe8c8cbf","trackedFileBackups":{},"timestamp":"2025-12-20T20:50:03.410Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","type":"user","message":{"role":"user","content":"Caveat: The messages below were generated by the user while running local commands. DO NOT respond to these messages or otherwise consider them in your response unless the user explicitly asks you to."},"isMeta":true,"uuid":"2535d6d0-bc53-4a5f-b136-98dd9e7e420d","timestamp":"2025-12-20T20:50:03.409Z"}
{"parentUuid":"2535d6d0-bc53-4a5f-b136-98dd9e7e420d","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","type":"user","message":{"role":"user","content":"<command-name>/clear</command-name>\n            <command-message>clear</command-message>\n            <command-args></command-args>"},"uuid":"d88a6918-cf92-4726-8626-8a52fe8c8cbf","timestamp":"2025-12-20T20:50:03.403Z"}
{"parentUuid":"d88a6918-cf92-4726-8626-8a52fe8c8cbf","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","type":"user","message":{"role":"user","content":"<local-command-stdout></local-command-stdout>"},"uuid":"baa88d7c-1710-420d-bf10-dd51c678608a","timestamp":"2025-12-20T20:50:03.409Z"}
{"type":"file-history-snapshot","messageId":"2e08c307-8b28-49bb-9983-28482f596229","snapshot":{"messageId":"2e08c307-8b28-49bb-9983-28482f596229","trackedFileBackups":{},"timestamp":"2025-12-20T20:50:19.769Z"},"isSnapshotUpdate":false}
{"parentUuid":"baa88d7c-1710-420d-bf10-dd51c678608a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","type":"user","message":{"role":"user","content":"reference the fixit.md, complete the medium priority issues"},"uuid":"2e08c307-8b28-49bb-9983-28482f596229","timestamp":"2025-12-20T20:50:19.764Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]}}
{"parentUuid":"2e08c307-8b28-49bb-9983-28482f596229","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Q5BMryZX1vTRViHzd428DM","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user wants me to reference a file called `fixit.md` and complete the medium priority issues. Let me first read this file to understand what needs to be done.","signature":"EsoCCkYIChgCKkD0olejKC7BsEj2U+mX1E6hsK4GJ0nG2Wsc5PvSAiL2rz8MqoyUdrwiD+s9OPvY0BzYIbad+lXPQsxcOO8NaS4bEgxDVb9zo5rZ7Ybpf44aDKCxS7qP/mhj5sPEKiIwpJBsRMSrdnLw4YXenmwAQ5F7Xs13puvg6DM6q6t6psj1Axu1hOy1f+eBxaJfPlOrKrEBXdJhTllTkhcrKlg0SituXEIt0UKgrweFiP7ZB9YufLxUrpVLc3sIaEAzdeVH+dKzvaHlRFRWLsj+KwODehXSYDOBQCyLxAzmsR+aejH33cHgss4UXNR/XiS8BsuuTkluvdr9YZGJDFf8xZIY0yniqV9pjyBeaREAVHyPZh9vken7+KCc+2CFwsF4PFZKgNgWPMgHzMIsWEqbLsYkYxc7hUcA/EpKpaVz2kWFlZ8yPJhyGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4578,"cache_read_input_tokens":16132,"cache_creation":{"ephemeral_5m_input_tokens":4578,"ephemeral_1h_input_tokens":0},"output_tokens":6,"service_tier":"standard"}},"requestId":"req_011CWJbhCBUqwRZ3f5NrZLxV","type":"assistant","uuid":"9ceeb1d7-5cec-46ee-9bbe-0e313a7b7a22","timestamp":"2025-12-20T20:50:25.129Z"}
{"parentUuid":"9ceeb1d7-5cec-46ee-9bbe-0e313a7b7a22","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Q5BMryZX1vTRViHzd428DM","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01X9e3Lyg77XcY8t3FWZg65J","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/fixit.md"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":4578,"cache_read_input_tokens":16132,"cache_creation":{"ephemeral_5m_input_tokens":4578,"ephemeral_1h_input_tokens":0},"output_tokens":120,"service_tier":"standard"}},"requestId":"req_011CWJbhCBUqwRZ3f5NrZLxV","type":"assistant","uuid":"78457823-467d-4c0d-95b3-831fe66fc6a0","timestamp":"2025-12-20T20:50:25.620Z"}
{"parentUuid":"78457823-467d-4c0d-95b3-831fe66fc6a0","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"<tool_use_error>File does not exist.</tool_use_error>","is_error":true,"tool_use_id":"toolu_01X9e3Lyg77XcY8t3FWZg65J"}]},"uuid":"a1998a2d-2046-42b1-bbdf-1098fc27ff4e","timestamp":"2025-12-20T20:50:25.634Z","toolUseResult":"Error: File does not exist."}
{"parentUuid":"a1998a2d-2046-42b1-bbdf-1098fc27ff4e","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","message":{"model":"claude-opus-4-5-20251101","id":"msg_01SnTEAtdhWoA9YU2VMxHbZn","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The file doesn't exist in that location. Let me search for it in the parent directory or elsewhere.","signature":"EosCCkYIChgCKkAwC5Dgdi3I1p2afkW2z3uGd0uq9jCDlmL2eb0TUlsE1IEZdbik3ZEFy/KyW/xdkLP/xGGtTILSgdjFa7OhZHXIEgwVSycKOCAmMFQglU8aDKVIp3Q1X74MYukZ0yIwbUoM5SnYeaxQJRgkKoINcEJLV0KPy78BjrLuR0d9U7bwcRjoeUqC80jiSsd7SrFZKnOUJmTjiRy6Zmp9hRNVB2xdkh0Tsrnwo46M0hOLCB4+gw55itTvI/Mubqz84LCfuOjIY5n9SZppZy8vaY1RUfaMcxUK1Xgb1K50E50QrMK1WFQ8QNnH+EtqkIMDeTjrvSIbEozbgw+rJ/uLtyOCeOWZGgr8GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":165,"cache_read_input_tokens":20710,"cache_creation":{"ephemeral_5m_input_tokens":165,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbhdGMF4cyUkM8CJgkC","type":"assistant","uuid":"59c94c73-f6b7-4ede-a145-e93b17ff755c","timestamp":"2025-12-20T20:50:30.936Z"}
{"parentUuid":"59c94c73-f6b7-4ede-a145-e93b17ff755c","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","message":{"model":"claude-opus-4-5-20251101","id":"msg_01SnTEAtdhWoA9YU2VMxHbZn","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BSvMAGP5dvQZrnBoxuUhWR","name":"Glob","input":{"pattern":"**/fixit.md"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":165,"cache_read_input_tokens":20710,"cache_creation":{"ephemeral_5m_input_tokens":165,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbhdGMF4cyUkM8CJgkC","type":"assistant","uuid":"8fd16443-9da1-4b43-a553-21f736bfb6de","timestamp":"2025-12-20T20:50:31.191Z"}
{"parentUuid":"8fd16443-9da1-4b43-a553-21f736bfb6de","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BSvMAGP5dvQZrnBoxuUhWR","type":"tool_result","content":"No files found"}]},"uuid":"69eee5bf-c32d-4bc0-b6ec-e868c7bcd4f8","timestamp":"2025-12-20T20:50:31.737Z","toolUseResult":{"filenames":[],"durationMs":456,"numFiles":0,"truncated":false}}
{"parentUuid":"69eee5bf-c32d-4bc0-b6ec-e868c7bcd4f8","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_0128B4f7GTBUa2P1phEp8JH3","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"No fixit.md file found. Let me try a case-insensitive search or look for similar filenames.","signature":"EoMCCkYIChgCKkAk7Re5F+7uonxW0eNQ9RJmtELNsjZ3h3Vj5rY12axcLoLk85AWTvsZfikZRmr1JtPKFgn5tnZmV4I6p9mDxD85EgxMDxNd6el5g0Ro9K0aDHGfJalb1jRq2UP4WyIwvopX7jVPrgH1fBMKhoi5SVfNJeKyAalNCT8SMR6slBGEgRO/OE3lEMwGhkWEMIstKmsFov3fYrI6N/IvrTc8LHvtak4YmXzUzk4x/kzB8B9CKYaau7ccVknai6CTnp9YLOWZyiZixJsbpVCn/QjMXKdvlxTYqjawY5/DaI73jAQzallgJW31M7smgPS+PiRp8FGpEkrysBfdg0n3FRgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":108,"cache_read_input_tokens":20875,"cache_creation":{"ephemeral_5m_input_tokens":108,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbi5LW1SHsd3ftB9zWY","type":"assistant","uuid":"e267baba-eb1c-4266-b016-d98e4a36a57a","timestamp":"2025-12-20T20:50:36.497Z"}
{"parentUuid":"e267baba-eb1c-4266-b016-d98e4a36a57a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_0128B4f7GTBUa2P1phEp8JH3","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PoS7BaRYo65DX7Vyp4jqWD","name":"Glob","input":{"pattern":"**/*fix*.md"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":108,"cache_read_input_tokens":20875,"cache_creation":{"ephemeral_5m_input_tokens":108,"ephemeral_1h_input_tokens":0},"output_tokens":89,"service_tier":"standard"}},"requestId":"req_011CWJbi5LW1SHsd3ftB9zWY","type":"assistant","uuid":"dea11c53-064d-4463-bcdb-b0a3d7879832","timestamp":"2025-12-20T20:50:37.028Z"}
{"parentUuid":"dea11c53-064d-4463-bcdb-b0a3d7879832","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PoS7BaRYo65DX7Vyp4jqWD","type":"tool_result","content":"No files found"}]},"uuid":"cc8f8f97-7f4d-4a35-b713-82d66b17272d","timestamp":"2025-12-20T20:50:37.436Z","toolUseResult":{"filenames":[],"durationMs":382,"numFiles":0,"truncated":false}}
{"parentUuid":"cc8f8f97-7f4d-4a35-b713-82d66b17272d","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RDYVM8AubBK3LXpb51m1A6","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Still no results. Let me check the parent LOOKSMAXX directory.","signature":"EuYBCkYIChgCKkBUXAecRmDwGStlrd9C48S9DUNrxQK6Vb9JYn8+sPUXAUiST+2YbyLpV0EAEWhWoAvq2/E73SpLy5b0o8nwlk5YEgz+wKg6mGUtVcC/cg4aDOUiaHUxsrSA761bISIwThepxq5PVGkiPVLwv2idm7X2KaDi9Yikf+2PyXG5YTcI0S8ec11I6XjqJWDDfcGoKk5vqUOP4rT1pxV+MyA+xVMOpcKUbVVhXKVQyltul/mscql0OUbsnznK4IjoK3OoJEqZ2WPCysbqpjwncaAoC6TS6en8HDXjDyQGOgWMp5EYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":111,"cache_read_input_tokens":20983,"cache_creation":{"ephemeral_5m_input_tokens":111,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbiVhTvf5apQtQkXUNH","type":"assistant","uuid":"0deaac35-2087-4a9f-bbab-09bd24058d61","timestamp":"2025-12-20T20:50:42.763Z"}
{"parentUuid":"0deaac35-2087-4a9f-bbab-09bd24058d61","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01RDYVM8AubBK3LXpb51m1A6","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01J4fq5BrmktuYMYbwdRpDc1","name":"Bash","input":{"command":"ls -la /Users/imorgado/LOOKSMAXX/","description":"List files in LOOKSMAXX directory"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":111,"cache_read_input_tokens":20983,"cache_creation":{"ephemeral_5m_input_tokens":111,"ephemeral_1h_input_tokens":0},"output_tokens":116,"service_tier":"standard"}},"requestId":"req_011CWJbiVhTvf5apQtQkXUNH","type":"assistant","uuid":"ab020482-2efc-49a5-88b0-ec69f479f4e0","timestamp":"2025-12-20T20:50:43.530Z"}
{"parentUuid":"ab020482-2efc-49a5-88b0-ec69f479f4e0","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01J4fq5BrmktuYMYbwdRpDc1","type":"tool_result","content":"total 135104\ndrwxr-xr-x  12 imorgado  staff       384 Dec 20 14:14 .\ndrwxr-x---+ 61 imorgado  staff      1952 Dec 20 15:19 ..\ndrwxr-xr-x@  3 imorgado  staff        96 Dec 17 21:56 .claude\n-rw-r--r--@  1 imorgado  staff      6148 Dec 17 22:03 .DS_Store\n-rw-------@  1 imorgado  staff  68990189 Dec 17 20:52 beta.faceiqlabs.com.har\n-rw-------@  1 imorgado  staff      1976 Dec 20 14:14 CLAUDE.md\n-rw-r--r--@  1 imorgado  staff     89283 Dec 18 23:49 faceiqlabs-landmarks.html\n-rw-------@  1 imorgado  staff     10114 Dec 20 13:54 fixit.md\ndrwxr-xr-x@ 12 imorgado  staff       384 Dec 20 13:57 looksmaxx-api\ndrwxr-xr-x@ 27 imorgado  staff       864 Dec 20 15:48 looksmaxx-app\n-rw-------@  1 imorgado  staff     20217 Dec 17 21:34 side_profile_analyzer.py\n-rw-------@  1 imorgado  staff     44299 Dec 17 21:29 TECHNICAL_SPECS.md","is_error":false}]},"uuid":"f2cad87d-c103-400a-ae75-a846412872f4","timestamp":"2025-12-20T20:50:43.628Z","toolUseResult":{"stdout":"total 135104\ndrwxr-xr-x  12 imorgado  staff       384 Dec 20 14:14 .\ndrwxr-x---+ 61 imorgado  staff      1952 Dec 20 15:19 ..\ndrwxr-xr-x@  3 imorgado  staff        96 Dec 17 21:56 .claude\n-rw-r--r--@  1 imorgado  staff      6148 Dec 17 22:03 .DS_Store\n-rw-------@  1 imorgado  staff  68990189 Dec 17 20:52 beta.faceiqlabs.com.har\n-rw-------@  1 imorgado  staff      1976 Dec 20 14:14 CLAUDE.md\n-rw-r--r--@  1 imorgado  staff     89283 Dec 18 23:49 faceiqlabs-landmarks.html\n-rw-------@  1 imorgado  staff     10114 Dec 20 13:54 fixit.md\ndrwxr-xr-x@ 12 imorgado  staff       384 Dec 20 13:57 looksmaxx-api\ndrwxr-xr-x@ 27 imorgado  staff       864 Dec 20 15:48 looksmaxx-app\n-rw-------@  1 imorgado  staff     20217 Dec 17 21:34 side_profile_analyzer.py\n-rw-------@  1 imorgado  staff     44299 Dec 17 21:29 TECHNICAL_SPECS.md","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"f2cad87d-c103-400a-ae75-a846412872f4","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MREPNB6hVmihcBq46ewU1t","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Found it! The file is at `/Users/imorgado/LOOKSMAXX/fixit.md`. Let me read it.","signature":"EvYBCkYIChgCKkDqb0KnTkXkNTcZQIHK5wHqCZgpgpyTFbW4YjqN6krXYmQPzHV6s9hlbK4+ZWaRFe7t3KmFNrjNzT1hPvgSdk+MEgxvxNdd8m7Bmm2pmNoaDCcRjhi+5pvziTZJ3yIwwgdPKo8JaUhe2OXnS88biOv6Foc/56MZjqukMQUS8RIsQ7ZBoGFoYymL5F2ECYtfKl6A3RL1tIV1yNRJLeMbcC+3ACY1wjse4hEQWspk+lRuHXEE0jHz3n5WhhEPAAdanTs8v1ayoyQfH1GxSUT9mX8aKBZmdcEyIrUw+3KdJVaadw0KhqlLLgOfRGxpp5svGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":538,"cache_read_input_tokens":21094,"cache_creation":{"ephemeral_5m_input_tokens":538,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbixCAKpLotEjKaExfE","type":"assistant","uuid":"b9783897-4776-4eb1-ab8e-fef3d6443a1b","timestamp":"2025-12-20T20:50:48.569Z"}
{"parentUuid":"b9783897-4776-4eb1-ab8e-fef3d6443a1b","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MREPNB6hVmihcBq46ewU1t","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01A2cHfbHkdGU83FjBDVWiQh","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/fixit.md"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":538,"cache_read_input_tokens":21094,"cache_creation":{"ephemeral_5m_input_tokens":538,"ephemeral_1h_input_tokens":0},"output_tokens":107,"service_tier":"standard"}},"requestId":"req_011CWJbixCAKpLotEjKaExfE","type":"assistant","uuid":"ebde40dc-dc5a-43b0-bebb-41776cf90e64","timestamp":"2025-12-20T20:50:48.956Z"}
{"parentUuid":"ebde40dc-dc5a-43b0-bebb-41776cf90e64","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01A2cHfbHkdGU83FjBDVWiQh","type":"tool_result","content":"     1→# LOOKSMAXX - FaceIQ Parity Fixes\n     2→\n     3→## Session Date: 2025-12-20\n     4→\n     5→## Current State Summary\n     6→\n     7→### What's Complete\n     8→- [x] Core exponential decay scoring formula (exact match)\n     9→- [x] Bezier curve interpolation with Newton-Raphson\n    10→- [x] Updated all metric ideal ranges to match FaceIQ exactly\n    11→- [x] Updated maxScore weights (2.5-30 scale)\n    12→- [x] Results page layout with 6 tabs\n    13→- [x] Surgery database (100+ procedures in `hardmaxxing.ts`)\n    14→- [x] Softmaxxing treatments database\n    15→- [x] Non-surgical treatments database\n    16→- [x] Supplements database\n    17→- [x] TypeScript compilation passing\n    18→\n    19→### What's Complete (Added 2025-12-20)\n    20→- [x] InsightFace on Railway - FIXED! detection_ready: true\n    21→- [x] Detailed flaw mappings for 28 metrics (METRIC_FLAW_MAPPINGS)\n    22→- [x] Custom Bezier curves for 5 key metrics (METRIC_CUSTOM_CURVES)\n    23→\n    24→---\n    25→\n    26→## Gaps to Fix (FaceIQ Parity)\n    27→\n    28→### 1. Detailed Flaw Mappings Per Metric [COMPLETED]\n    29→\n    30→**Current:** Basic string arrays like `[\"Wide face\", \"Long midface\"]`\n    31→\n    32→**FaceIQ Format:**\n    33→```typescript\n    34→interface FlawMapping {\n    35→  category: string;           // \"Occlusion/Jaw Growth\"\n    36→  flawName: string;           // \"Hyper-divergent jaw growth\"\n    37→  confidence: 'confirmed' | 'likely' | 'possible';\n    38→  actualValue: string;        // \"38.05%\"\n    39→  idealRange: string;         // \"31-33.5%\"\n    40→  deviation: string;          // \"4.55% above ideal\"\n    41→  score: number;              // 0.19\n    42→  severity: 'extremely severe' | 'severe' | 'major' | 'moderate' | 'minor';\n    43→  reasoning: string;          // AI-generated explanation\n    44→  isUnlocked: boolean;\n    45→}\n    46→```\n    47→\n    48→**Example from FaceIQ (Lower Third Proportion at 38.05%):**\n    49→```json\n    50→{\n    51→  \"mayIndicateFlaws\": [\n    52→    {\n    53→      \"category\": \"Occlusion/Jaw Growth\",\n    54→      \"flawName\": \"Hyper-divergent jaw growth\",\n    55→      \"confidence\": \"confirmed\",\n    56→      \"actualValue\": \"38.05%\",\n    57→      \"idealRange\": \"31-33.5%\",\n    58→      \"deviation\": \"4.55% above ideal\",\n    59→      \"score\": 0.19,\n    60→      \"severity\": \"extremely severe\",\n    61→      \"reasoning\": \"The upper jaw is too long relative to lower jaw, possibly from a long upper jaw or short lower jaw, or a combination of both. This disrupts facial harmony by elongating the lower face.\"\n    62→    },\n    63→    {\n    64→      \"category\": \"Jaw Shape\",\n    65→      \"flawName\": \"Disproportionate lower face (short chin or long philtrum)\",\n    66→      \"confidence\": \"confirmed\",\n    67→      ...\n    68→    },\n    69→    {\n    70→      \"category\": \"Midface/Face Shape\",\n    71→      \"flawName\": \"Long upper jaw\",\n    72→      \"confidence\": \"confirmed\",\n    73→      ...\n    74→    },\n    75→    {\n    76→      \"category\": \"Midface/Face Shape\",\n    77→      \"flawName\": \"Short lower jaw\",\n    78→      \"confidence\": \"confirmed\",\n    79→      ...\n    80→    }\n    81→  ]\n    82→}\n    83→```\n    84→\n    85→**Files to modify:**\n    86→- `src/lib/faceiq-scoring.ts` - Add FLAW_MAPPINGS constant\n    87→- `src/contexts/ResultsContext.tsx` - Update `getFlawStrengthMappings()` function\n    88→- `src/types/results.ts` - Add FlawMapping interface\n    89→\n    90→---\n    91→\n    92→### 2. Custom Bezier Curves for ALL Metrics [PARTIALLY COMPLETE - 5 key metrics added]\n    93→\n    94→**Current:** Only `totalFacialWidthToHeight` has custom curves\n    95→\n    96→**FaceIQ Format:** 12 control points with Bezier handles per metric\n    97→```typescript\n    98→interface CurvePoint {\n    99→  x: number;\n   100→  y: number;\n   101→  leftHandleX?: number;\n   102→  leftHandleY?: number;\n   103→  rightHandleX?: number;\n   104→  rightHandleY?: number;\n   105→  fixed?: boolean;\n   106→}\n   107→\n   108→interface CurveConfig {\n   109→  mode: 'custom' | 'exponential';\n   110→  customPoints?: CurvePoint[];\n   111→  idealMin: number;\n   112→  idealMax: number;\n   113→  maxScore: number;\n   114→  chartRange: { min: number; max: number };\n   115→  decayRate?: number;\n   116→}\n   117→```\n   118→\n   119→**Example from FaceIQ (Lower Third Proportion):**\n   120→```json\n   121→{\n   122→  \"customPoints\": [\n   123→    {\"x\": 25.6, \"y\": 0, \"leftHandleX\": 24.8, \"leftHandleY\": 0, \"rightHandleX\": 26.4, \"rightHandleY\": 0},\n   124→    {\"x\": 28.01, \"y\": 1.58, \"leftHandleX\": 27.23, \"leftHandleY\": 0.53, \"rightHandleX\": 28.27, \"rightHandleY\": 1.97},\n   125→    {\"x\": 28.83, \"y\": 3.21, ...},\n   126→    {\"x\": 29.63, \"y\": 5.85, ...},\n   127→    {\"x\": 30.27, \"y\": 8.56, ...},\n   128→    {\"x\": 31, \"y\": 10, \"fixed\": true},\n   129→    {\"x\": 33.5, \"y\": 10, \"fixed\": true},\n   130→    {\"x\": 34.23, \"y\": 8.56, ...},\n   131→    {\"x\": 34.87, \"y\": 5.85, ...},\n   132→    {\"x\": 35.67, \"y\": 3.21, ...},\n   133→    {\"x\": 36.49, \"y\": 1.58, ...},\n   134→    {\"x\": 38.9, \"y\": 0, ...}\n   135→  ]\n   136→}\n   137→```\n   138→\n   139→**Files to modify:**\n   140→- `src/lib/faceiq-scoring.ts` - Add `customCurve` to each metric in FACEIQ_METRICS\n   141→\n   142→**Data source:** Extract from `/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/FACEIQ-FRONT RATIOS.html`\n   143→\n   144→---\n   145→\n   146→### 3. Enhanced Illustration Configs [MEDIUM PRIORITY]\n   147→\n   148→**Current:** Basic configs for ~8 metrics\n   149→\n   150→**FaceIQ Format:**\n   151→```typescript\n   152→interface IllustrationConfig {\n   153→  points: Record<string, {\n   154→    type: 'landmark' | 'calculated';\n   155→    x?: number;\n   156→    y?: number;\n   157→  }>;\n   158→  lines: Array<{\n   159→    from: string;\n   160→    to: string;\n   161→    label: string;\n   162→    color: string;\n   163→    labelColor: string;\n   164→    labelPosition: 'left' | 'right' | 'top' | 'bottom';\n   165→  }>;\n   166→}\n   167→```\n   168→\n   169→**Files to modify:**\n   170→- `src/contexts/ResultsContext.tsx` - Expand `generateIllustration()` function\n   171→\n   172→---\n   173→\n   174→### 4. Improved Flaw-to-Treatment Matching [MEDIUM PRIORITY]\n   175→\n   176→**Current:** Basic keyword matching in `generateRecommendations()`\n   177→\n   178→**Target:**\n   179→- Use metric scores to prioritize treatments\n   180→- Match specific flaws to specific procedures\n   181→- Calculate expected improvement percentages\n   182→\n   183→**Files to modify:**\n   184→- `src/contexts/ResultsContext.tsx` - `generateRecommendations()` function\n   185→- `src/lib/recommendations/severity.ts` - Enhance `getTreatmentIdsForMetric()`\n   186→\n   187→---\n   188→\n   189→### 5. Severity Display Enhancement [MEDIUM PRIORITY]\n   190→\n   191→**Current:** 5-tier but not prominently displayed\n   192→\n   193→**Target:** Show severity badges like FaceIQ:\n   194→- \"Extremely Severe\" (red)\n   195→- \"Severe\" (orange)\n   196→- \"Major\" (yellow)\n   197→- \"Moderate\" (light yellow)\n   198→- \"Minor\" (gray)\n   199→\n   200→**Files to modify:**\n   201→- `src/components/results/cards/StrengthFlawCards.tsx`\n   202→- `src/types/results.ts` - Add severity color mapping\n   203→\n   204→---\n   205→\n   206→### 6. Railway InsightFace Deployment [FIXED ✓]\n   207→\n   208→**Status:** WORKING - detection_ready: true\n   209→- Deployed using `railway up --service api`\n   210→- python:3.11-bookworm base with cmake & libopenblas-dev\n   211→- onnxruntime-cpu==1.16.3\n   212→\n   213→---\n   214→\n   215→### 7. AI-Generated Descriptions [LOW PRIORITY]\n   216→\n   217→**Current:** Static descriptions per metric\n   218→\n   219→**Target:** Add `aiDescription` field with personalized explanations based on the user's actual values\n   220→\n   221→---\n   222→\n   223→### 8. Decay Curve Charts [LOW PRIORITY]\n   224→\n   225→**Current:** Not implemented\n   226→\n   227→**Target:** Visualize the scoring curve showing where user's value falls\n   228→\n   229→---\n   230→\n   231→### 9. Potential Score Calculations [LOW PRIORITY]\n   232→\n   233→**Current:** Basic in Plan tab\n   234→\n   235→**Target:** \"Your score could be X with treatment Y\" with projected improvements\n   236→\n   237→---\n   238→\n   239→## File Locations\n   240→\n   241→### Key Files to Modify\n   242→```\n   243→src/lib/faceiq-scoring.ts          # Scoring configs, ideal ranges, curves\n   244→src/contexts/ResultsContext.tsx     # Data transformation, flaw mappings\n   245→src/types/results.ts                # Type definitions\n   246→src/lib/recommendations/severity.ts # Flaw-to-treatment mapping\n   247→src/components/results/cards/       # UI components for flaws/strengths\n   248→```\n   249→\n   250→### FaceIQ Reference Data\n   251→```\n   252→/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/\n   253→├── FACEIQ-FRONT RATIOS.html   # Front profile metrics with curves\n   254→├── FACEIQ-SIDERATIOS.html     # Side profile metrics\n   255→├── FACEIQ-ALL.har             # API calls with full response data\n   256→├── FACEIQALL-HTML.html        # Full page capture\n   257→└── site-capture-*.json        # Additional capture data\n   258→```\n   259→\n   260→---\n   261→\n   262→## Metrics Updated This Session\n   263→\n   264→### Front Profile (Updated ideal ranges + maxScores)\n   265→| Metric | New Ideal | maxScore |\n   266→|--------|-----------|----------|\n   267→| Face Width to Height | 1.96-2.0 | 30 |\n   268→| Middle Third | 31.4-33.4% | 10 |\n   269→| Upper Third | 30-32% | 10 |\n   270→| Cheekbone Height | 83-100% | 15 |\n   271→| Midface Ratio | 0.97-1.0 | 12.5 |\n   272→| Jaw Frontal Angle | 86.5-92.5° | 20 |\n   273→| Bigonial Width | 87.75-91.75% | 15 |\n   274→| Lateral Canthal Tilt | 6.1-7.8° | 10 |\n   275→| Eye Aspect Ratio | 3.0-3.5 | 15 |\n   276→| Eye Separation | 45.7-46.8% | 10 |\n   277→| IPD-Mouth Ratio | 0.83-0.87 | 10 |\n   278→| Eyebrow Tilt | 6.5-11° | 10 |\n   279→| Eyebrow Low Setedness | 0-0.45 | 10 |\n   280→| Intercanthal-Nasal | 1.04-1.16 | 10 |\n   281→| Nose Tip Position | 0.5-3.5mm | 2.5 |\n   282→| Mouth/Nose Ratio | 1.43-1.51 | 10 |\n   283→| Lower/Upper Lip | 1.58-1.88 | 7.5 |\n   284→| Chin/Philtrum | 2.15-2.45 | 12.5 |\n   285→| IAA-JFA Deviation | 0-2.5° | 10 |\n   286→| Neck Width | 92-98% | 10 |\n   287→\n   288→### Side Profile (Updated ideal ranges)\n   289→| Metric | New Ideal |\n   290→|--------|-----------|\n   291→| Nasofrontal Angle | 116-128° |\n   292→| Nasofacial Angle | 31-35° |\n   293→| Nasomental Angle | 126-131° |\n   294→| Submental Cervical | 94-106° |\n   295→| Facial Depth/Height | 1.3-1.44 |\n   296→| Anterior Facial Depth | 64.5-67.5° |\n   297→| S-Line Lower Lip | -0.4 to 0.4mm |\n   298→\n   299→### New Metrics Added\n   300→- Ipsilateral Alar Angle (front)\n   301→- Ear Protrusion Angle (front)\n   302→- Ear Protrusion Ratio (front)\n   303→- Interior Midface Projection Angle (side)\n   304→- Recession from Frankfort Plane (side)\n   305→\n   306→---\n   307→\n   308→## Commands Reference\n   309→\n   310→### Run Type Check\n   311→```bash\n   312→cd /Users/imorgado/LOOKSMAXX/looksmaxx-app && npx tsc --noEmit\n   313→```\n   314→\n   315→### Run Lint\n   316→```bash\n   317→cd /Users/imorgado/LOOKSMAXX/looksmaxx-app && npm run lint\n   318→```\n   319→\n   320→### Extract FaceIQ Data\n   321→```bash\n   322→# Extract metric configs from HTML\n   323→cat \"/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/FACEIQ-FRONT RATIOS.html\" | sed 's/\\\\\"/\"/g' | grep -oE '\"name\":\"[^\"]+\",\"value\":[0-9.-]+.*?\"idealMax\":[0-9.-]+'\n   324→\n   325→# Extract flaw mappings\n   326→cat \"/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/FACEIQ-FRONT RATIOS.html\" | sed 's/\\\\\"/\"/g' | grep -oE '\"mayIndicateFlaws\":\\[\\{[^]]+'\n   327→\n   328→# Extract custom curves\n   329→cat \"/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/FACEIQ-FRONT RATIOS.html\" | sed 's/\\\\\"/\"/g' | grep -oE '\"customPoints\":\\[[^\\]]+\\]'\n   330→```\n   331→\n   332→---\n   333→\n   334→## Continuation Prompt\n   335→\n   336→Use this prompt to continue this work:\n   337→\n   338→```\n   339→Continue work on LOOKSMAXX FaceIQ parity. Read /Users/imorgado/LOOKSMAXX/fixit.md for context.\n   340→\n   341→Current priorities:\n   342→1. Add detailed FLAW_MAPPINGS to faceiq-scoring.ts with FaceIQ's structure (category, flawName, confidence, severity, reasoning)\n   343→2. Extract and add custom Bezier curves for all metrics from the FaceIQ HTML files\n   344→3. Update ResultsContext.tsx to use the new flaw mappings\n   345→\n   346→Reference data is in /Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/\n   347→\n   348→Start with the flaw mappings - extract them from FACEIQ-FRONT RATIOS.html and create a comprehensive FLAW_MAPPINGS constant.\n   349→```\n   350→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"0092071c-e321-4472-82f9-60d7acec6c49","timestamp":"2025-12-20T20:50:48.995Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/fixit.md","content":"# LOOKSMAXX - FaceIQ Parity Fixes\n\n## Session Date: 2025-12-20\n\n## Current State Summary\n\n### What's Complete\n- [x] Core exponential decay scoring formula (exact match)\n- [x] Bezier curve interpolation with Newton-Raphson\n- [x] Updated all metric ideal ranges to match FaceIQ exactly\n- [x] Updated maxScore weights (2.5-30 scale)\n- [x] Results page layout with 6 tabs\n- [x] Surgery database (100+ procedures in `hardmaxxing.ts`)\n- [x] Softmaxxing treatments database\n- [x] Non-surgical treatments database\n- [x] Supplements database\n- [x] TypeScript compilation passing\n\n### What's Complete (Added 2025-12-20)\n- [x] InsightFace on Railway - FIXED! detection_ready: true\n- [x] Detailed flaw mappings for 28 metrics (METRIC_FLAW_MAPPINGS)\n- [x] Custom Bezier curves for 5 key metrics (METRIC_CUSTOM_CURVES)\n\n---\n\n## Gaps to Fix (FaceIQ Parity)\n\n### 1. Detailed Flaw Mappings Per Metric [COMPLETED]\n\n**Current:** Basic string arrays like `[\"Wide face\", \"Long midface\"]`\n\n**FaceIQ Format:**\n```typescript\ninterface FlawMapping {\n  category: string;           // \"Occlusion/Jaw Growth\"\n  flawName: string;           // \"Hyper-divergent jaw growth\"\n  confidence: 'confirmed' | 'likely' | 'possible';\n  actualValue: string;        // \"38.05%\"\n  idealRange: string;         // \"31-33.5%\"\n  deviation: string;          // \"4.55% above ideal\"\n  score: number;              // 0.19\n  severity: 'extremely severe' | 'severe' | 'major' | 'moderate' | 'minor';\n  reasoning: string;          // AI-generated explanation\n  isUnlocked: boolean;\n}\n```\n\n**Example from FaceIQ (Lower Third Proportion at 38.05%):**\n```json\n{\n  \"mayIndicateFlaws\": [\n    {\n      \"category\": \"Occlusion/Jaw Growth\",\n      \"flawName\": \"Hyper-divergent jaw growth\",\n      \"confidence\": \"confirmed\",\n      \"actualValue\": \"38.05%\",\n      \"idealRange\": \"31-33.5%\",\n      \"deviation\": \"4.55% above ideal\",\n      \"score\": 0.19,\n      \"severity\": \"extremely severe\",\n      \"reasoning\": \"The upper jaw is too long relative to lower jaw, possibly from a long upper jaw or short lower jaw, or a combination of both. This disrupts facial harmony by elongating the lower face.\"\n    },\n    {\n      \"category\": \"Jaw Shape\",\n      \"flawName\": \"Disproportionate lower face (short chin or long philtrum)\",\n      \"confidence\": \"confirmed\",\n      ...\n    },\n    {\n      \"category\": \"Midface/Face Shape\",\n      \"flawName\": \"Long upper jaw\",\n      \"confidence\": \"confirmed\",\n      ...\n    },\n    {\n      \"category\": \"Midface/Face Shape\",\n      \"flawName\": \"Short lower jaw\",\n      \"confidence\": \"confirmed\",\n      ...\n    }\n  ]\n}\n```\n\n**Files to modify:**\n- `src/lib/faceiq-scoring.ts` - Add FLAW_MAPPINGS constant\n- `src/contexts/ResultsContext.tsx` - Update `getFlawStrengthMappings()` function\n- `src/types/results.ts` - Add FlawMapping interface\n\n---\n\n### 2. Custom Bezier Curves for ALL Metrics [PARTIALLY COMPLETE - 5 key metrics added]\n\n**Current:** Only `totalFacialWidthToHeight` has custom curves\n\n**FaceIQ Format:** 12 control points with Bezier handles per metric\n```typescript\ninterface CurvePoint {\n  x: number;\n  y: number;\n  leftHandleX?: number;\n  leftHandleY?: number;\n  rightHandleX?: number;\n  rightHandleY?: number;\n  fixed?: boolean;\n}\n\ninterface CurveConfig {\n  mode: 'custom' | 'exponential';\n  customPoints?: CurvePoint[];\n  idealMin: number;\n  idealMax: number;\n  maxScore: number;\n  chartRange: { min: number; max: number };\n  decayRate?: number;\n}\n```\n\n**Example from FaceIQ (Lower Third Proportion):**\n```json\n{\n  \"customPoints\": [\n    {\"x\": 25.6, \"y\": 0, \"leftHandleX\": 24.8, \"leftHandleY\": 0, \"rightHandleX\": 26.4, \"rightHandleY\": 0},\n    {\"x\": 28.01, \"y\": 1.58, \"leftHandleX\": 27.23, \"leftHandleY\": 0.53, \"rightHandleX\": 28.27, \"rightHandleY\": 1.97},\n    {\"x\": 28.83, \"y\": 3.21, ...},\n    {\"x\": 29.63, \"y\": 5.85, ...},\n    {\"x\": 30.27, \"y\": 8.56, ...},\n    {\"x\": 31, \"y\": 10, \"fixed\": true},\n    {\"x\": 33.5, \"y\": 10, \"fixed\": true},\n    {\"x\": 34.23, \"y\": 8.56, ...},\n    {\"x\": 34.87, \"y\": 5.85, ...},\n    {\"x\": 35.67, \"y\": 3.21, ...},\n    {\"x\": 36.49, \"y\": 1.58, ...},\n    {\"x\": 38.9, \"y\": 0, ...}\n  ]\n}\n```\n\n**Files to modify:**\n- `src/lib/faceiq-scoring.ts` - Add `customCurve` to each metric in FACEIQ_METRICS\n\n**Data source:** Extract from `/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/FACEIQ-FRONT RATIOS.html`\n\n---\n\n### 3. Enhanced Illustration Configs [MEDIUM PRIORITY]\n\n**Current:** Basic configs for ~8 metrics\n\n**FaceIQ Format:**\n```typescript\ninterface IllustrationConfig {\n  points: Record<string, {\n    type: 'landmark' | 'calculated';\n    x?: number;\n    y?: number;\n  }>;\n  lines: Array<{\n    from: string;\n    to: string;\n    label: string;\n    color: string;\n    labelColor: string;\n    labelPosition: 'left' | 'right' | 'top' | 'bottom';\n  }>;\n}\n```\n\n**Files to modify:**\n- `src/contexts/ResultsContext.tsx` - Expand `generateIllustration()` function\n\n---\n\n### 4. Improved Flaw-to-Treatment Matching [MEDIUM PRIORITY]\n\n**Current:** Basic keyword matching in `generateRecommendations()`\n\n**Target:**\n- Use metric scores to prioritize treatments\n- Match specific flaws to specific procedures\n- Calculate expected improvement percentages\n\n**Files to modify:**\n- `src/contexts/ResultsContext.tsx` - `generateRecommendations()` function\n- `src/lib/recommendations/severity.ts` - Enhance `getTreatmentIdsForMetric()`\n\n---\n\n### 5. Severity Display Enhancement [MEDIUM PRIORITY]\n\n**Current:** 5-tier but not prominently displayed\n\n**Target:** Show severity badges like FaceIQ:\n- \"Extremely Severe\" (red)\n- \"Severe\" (orange)\n- \"Major\" (yellow)\n- \"Moderate\" (light yellow)\n- \"Minor\" (gray)\n\n**Files to modify:**\n- `src/components/results/cards/StrengthFlawCards.tsx`\n- `src/types/results.ts` - Add severity color mapping\n\n---\n\n### 6. Railway InsightFace Deployment [FIXED ✓]\n\n**Status:** WORKING - detection_ready: true\n- Deployed using `railway up --service api`\n- python:3.11-bookworm base with cmake & libopenblas-dev\n- onnxruntime-cpu==1.16.3\n\n---\n\n### 7. AI-Generated Descriptions [LOW PRIORITY]\n\n**Current:** Static descriptions per metric\n\n**Target:** Add `aiDescription` field with personalized explanations based on the user's actual values\n\n---\n\n### 8. Decay Curve Charts [LOW PRIORITY]\n\n**Current:** Not implemented\n\n**Target:** Visualize the scoring curve showing where user's value falls\n\n---\n\n### 9. Potential Score Calculations [LOW PRIORITY]\n\n**Current:** Basic in Plan tab\n\n**Target:** \"Your score could be X with treatment Y\" with projected improvements\n\n---\n\n## File Locations\n\n### Key Files to Modify\n```\nsrc/lib/faceiq-scoring.ts          # Scoring configs, ideal ranges, curves\nsrc/contexts/ResultsContext.tsx     # Data transformation, flaw mappings\nsrc/types/results.ts                # Type definitions\nsrc/lib/recommendations/severity.ts # Flaw-to-treatment mapping\nsrc/components/results/cards/       # UI components for flaws/strengths\n```\n\n### FaceIQ Reference Data\n```\n/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/\n├── FACEIQ-FRONT RATIOS.html   # Front profile metrics with curves\n├── FACEIQ-SIDERATIOS.html     # Side profile metrics\n├── FACEIQ-ALL.har             # API calls with full response data\n├── FACEIQALL-HTML.html        # Full page capture\n└── site-capture-*.json        # Additional capture data\n```\n\n---\n\n## Metrics Updated This Session\n\n### Front Profile (Updated ideal ranges + maxScores)\n| Metric | New Ideal | maxScore |\n|--------|-----------|----------|\n| Face Width to Height | 1.96-2.0 | 30 |\n| Middle Third | 31.4-33.4% | 10 |\n| Upper Third | 30-32% | 10 |\n| Cheekbone Height | 83-100% | 15 |\n| Midface Ratio | 0.97-1.0 | 12.5 |\n| Jaw Frontal Angle | 86.5-92.5° | 20 |\n| Bigonial Width | 87.75-91.75% | 15 |\n| Lateral Canthal Tilt | 6.1-7.8° | 10 |\n| Eye Aspect Ratio | 3.0-3.5 | 15 |\n| Eye Separation | 45.7-46.8% | 10 |\n| IPD-Mouth Ratio | 0.83-0.87 | 10 |\n| Eyebrow Tilt | 6.5-11° | 10 |\n| Eyebrow Low Setedness | 0-0.45 | 10 |\n| Intercanthal-Nasal | 1.04-1.16 | 10 |\n| Nose Tip Position | 0.5-3.5mm | 2.5 |\n| Mouth/Nose Ratio | 1.43-1.51 | 10 |\n| Lower/Upper Lip | 1.58-1.88 | 7.5 |\n| Chin/Philtrum | 2.15-2.45 | 12.5 |\n| IAA-JFA Deviation | 0-2.5° | 10 |\n| Neck Width | 92-98% | 10 |\n\n### Side Profile (Updated ideal ranges)\n| Metric | New Ideal |\n|--------|-----------|\n| Nasofrontal Angle | 116-128° |\n| Nasofacial Angle | 31-35° |\n| Nasomental Angle | 126-131° |\n| Submental Cervical | 94-106° |\n| Facial Depth/Height | 1.3-1.44 |\n| Anterior Facial Depth | 64.5-67.5° |\n| S-Line Lower Lip | -0.4 to 0.4mm |\n\n### New Metrics Added\n- Ipsilateral Alar Angle (front)\n- Ear Protrusion Angle (front)\n- Ear Protrusion Ratio (front)\n- Interior Midface Projection Angle (side)\n- Recession from Frankfort Plane (side)\n\n---\n\n## Commands Reference\n\n### Run Type Check\n```bash\ncd /Users/imorgado/LOOKSMAXX/looksmaxx-app && npx tsc --noEmit\n```\n\n### Run Lint\n```bash\ncd /Users/imorgado/LOOKSMAXX/looksmaxx-app && npm run lint\n```\n\n### Extract FaceIQ Data\n```bash\n# Extract metric configs from HTML\ncat \"/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/FACEIQ-FRONT RATIOS.html\" | sed 's/\\\\\"/\"/g' | grep -oE '\"name\":\"[^\"]+\",\"value\":[0-9.-]+.*?\"idealMax\":[0-9.-]+'\n\n# Extract flaw mappings\ncat \"/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/FACEIQ-FRONT RATIOS.html\" | sed 's/\\\\\"/\"/g' | grep -oE '\"mayIndicateFlaws\":\\[\\{[^]]+'\n\n# Extract custom curves\ncat \"/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/FACEIQ-FRONT RATIOS.html\" | sed 's/\\\\\"/\"/g' | grep -oE '\"customPoints\":\\[[^\\]]+\\]'\n```\n\n---\n\n## Continuation Prompt\n\nUse this prompt to continue this work:\n\n```\nContinue work on LOOKSMAXX FaceIQ parity. Read /Users/imorgado/LOOKSMAXX/fixit.md for context.\n\nCurrent priorities:\n1. Add detailed FLAW_MAPPINGS to faceiq-scoring.ts with FaceIQ's structure (category, flawName, confidence, severity, reasoning)\n2. Extract and add custom Bezier curves for all metrics from the FaceIQ HTML files\n3. Update ResultsContext.tsx to use the new flaw mappings\n\nReference data is in /Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/\n\nStart with the flaw mappings - extract them from FACEIQ-FRONT RATIOS.html and create a comprehensive FLAW_MAPPINGS constant.\n```\n","numLines":350,"startLine":1,"totalLines":350}}}
{"parentUuid":"0092071c-e321-4472-82f9-60d7acec6c49","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VbaUMa8DZ1gNkvE9bFty25","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I understand the context. The user wants me to complete the medium priority issues from this fixit.md file. Looking at the document, I can see the medium priority issues are:\n\n1. **Section 3: Enhanced Illustration Configs [MEDIUM PRIORITY]** - Expand `generateIllustration()` function in `src/contexts/ResultsContext.tsx`\n\n2. **Section 4: Improved Flaw-to-Treatment Matching [MEDIUM PRIORITY]** - Use metric scores to prioritize treatments, match specific flaws to specific procedures, calculate expected improvement percentages\n\n3. **Section 5: Severity Display Enhancement [MEDIUM PRIORITY]** - Show severity badges like FaceIQ with colors\n\nLet me start by reading the relevant files to understand the current implementation. I'll need to:\n1. Read `src/contexts/ResultsContext.tsx` to understand `generateIllustration()` and `generateRecommendations()`\n2. Read `src/lib/recommendations/severity.ts` to understand `getTreatmentIdsForMetric()`\n3. Read `src/components/results/cards/StrengthFlawCards.tsx` to understand the current severity display\n4. Read `src/types/results.ts` to see the type definitions\n\nLet me create a todo list and start reading the files.","signature":"Eq8KCkYIChgCKkA4zBGWSHaJT4H3CKFrXAPYZN7tJLWViljTD1XSL3FT4xC/XM2aYtyQP8qPnQ7vrnCcq6HUeMildBQa79g+BlfQEgzdPYoeaP75yGSR3ioaDCvwdVXNS+FS+mQRWyIwQgYaDHU/5Ba8sOMFtA/uWMWurvbCAkwqZZ1Q0hJ99SwcA9PLMdIFzJjugtO9bu9XKpYJSniHymtca3kpAE4oG6IrV4MNudW0b0HrBSKRvbyY+MspTAG8jDfNxFXNg7h4fyowi80/GFlRq9RZuLeDy/3R6PKP8D2pHL69vzHZsjBt31/bEEOh1iAH0XBHaot2sSqJmsgrv7nsPNIxgaMH1EmI6pfaQ8ZH8ejmNx/VHzCuJBKNZ7opuHMXxDWpw+0WGvx7ymmtrnlqyFBkMoDqokVnJEiFSlIywvfhjCJQxEtgKSgMllErZwBSazdf+gPuAiuxZRgGRfHBxPc8foEb2P84eKK+dWxt7x9MMp/YPwu35BOKgmwAJmmEs1q1HUzYTekh70plR8/tkWgF9ArfP3iIdLKod2c7IskaD+O9iWOwNsfZ+kWheY6MxqM+JpboAEIPOgHl3F0Xvs/vUc93wgTp8LTvf3CUNgrk5Hwda7E+AU2YxPBIL1LAwGRB7NyhbZ3HHMcdFgHi2Saor/+KvUs8ndRRucmKElPWDV4tdI3lH47xqvkOlrHzke9rSdHiyedzg6j+V5WGYS7T4ADyd1gJ1kbHIahreQiIO3yOuWtxecRMSz4/IMwqQTMsROdGVNg3eOvOpHjOfrhprR1fGX3P1aWANRaOkw0xgBIskbEjZ1tL5aZ89RGX+LBnfIU/f6EKFFhRA1L6GMIb+DNIfNxLCi2zWt5VvB3YAtahsodMfmdSQ1laUh5P8VjkCI03bQXJFjWZEu/ipOkRzSVO/g2jftA5zAPf0zV6XNqwqSuiGaJYwPNCi3sRVGrebUusDgI+rxXHZp1hwvDzit1D+Ckvzgh0yJIQxnwA2IZPe1/mGlteIZqgbeKvRBgC77/bz7tvdij+i1wc72hhCrwT9/lMpiWS7CzqtEwrXOnIeAOQl/eTq6rKy6lWSrnN+xWCMM7xptJl8i3xglZTtftZcGNJ5U6Ff4EmvRnKCM86uRyeEIoYp2slllFxAi+BJRHMvdbJRvTFE974C9CrxN5TarBFx7VNMVSFBXkIgBf7zHUh65ZZLSYQYKl0GY4SFG0Fo+M1xXfQfqCudjrmQXDYZ2RXBHl1IviMB1eWo+kh34Wx5tD9hYpGD7tCWnlSaBHF0+cLcmt5Uy54Evfwr1eA8OTpcOopXJydzzoK7xjDlEvmkBwUz0BE1B/k1x/GcofX9sH4EXWw8Nzh53mZfvURSQt1WgB719Y+gveEZ8MiDcZ78d6v7s01E/5J2pgcf4mMTonONmU0H5U2QwdBdrrzy/t7DR8tjwy2joqCwifF+Y3G7kc9DyKQE6hdpz6dagO6eszBYbdmGPxmlnjZmj8NA3hOgg6k2vexALxofXFwM8aVO2Nddy+Diy7RfbJ9zRM6JFvzhZaIR11kFT7wUUqPkBwvD+py8+yBIrywvKTVyyAUKLK8mGnOovdpCXTSBhA7AyETR+SZucwy2Bb/Fp5GdJYa8B+NC052A7Vt8DBznV10njHVHfVX+u4aUc7tbcCszlCyNJjiANGTPbwz+bM0FHFtN7qzliHyRwEbKwH/mFbHCSqaP47owf+Ez6WfLFH6F+szfNMguTT6E+z2bX4stqY8LZpJk0qmgxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":5007,"cache_read_input_tokens":21632,"cache_creation":{"ephemeral_5m_input_tokens":5007,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbjM9YNjVtezmoKeRx1","type":"assistant","uuid":"4cbc7bf3-816a-4cca-a715-067e01170b15","timestamp":"2025-12-20T20:50:57.963Z"}
{"parentUuid":"4cbc7bf3-816a-4cca-a715-067e01170b15","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VbaUMa8DZ1gNkvE9bFty25","type":"message","role":"assistant","content":[{"type":"text","text":"Let me create a todo list for the medium priority issues and read the relevant files."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":5007,"cache_read_input_tokens":21632,"cache_creation":{"ephemeral_5m_input_tokens":5007,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbjM9YNjVtezmoKeRx1","type":"assistant","uuid":"9ba21a2b-9ee6-422e-9c24-ccde6cd1b5c5","timestamp":"2025-12-20T20:50:58.505Z"}
{"parentUuid":"9ba21a2b-9ee6-422e-9c24-ccde6cd1b5c5","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VbaUMa8DZ1gNkvE9bFty25","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0134keN7f5cLoEP2z1Y7VppL","name":"TodoWrite","input":{"todos":[{"content":"Enhanced Illustration Configs - Expand generateIllustration() function","status":"pending","activeForm":"Expanding generateIllustration() function"},{"content":"Improved Flaw-to-Treatment Matching - Use metric scores and match flaws to procedures","status":"pending","activeForm":"Improving flaw-to-treatment matching"},{"content":"Severity Display Enhancement - Add severity badges with colors","status":"pending","activeForm":"Enhancing severity display with badges"}]}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":5007,"cache_read_input_tokens":21632,"cache_creation":{"ephemeral_5m_input_tokens":5007,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbjM9YNjVtezmoKeRx1","type":"assistant","uuid":"de592cf0-241f-4b32-873b-adfb28583fce","timestamp":"2025-12-20T20:51:01.053Z"}
{"parentUuid":"de592cf0-241f-4b32-873b-adfb28583fce","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VbaUMa8DZ1gNkvE9bFty25","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HJRdthANz2EoMEFmC2yZxZ","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":5007,"cache_read_input_tokens":21632,"cache_creation":{"ephemeral_5m_input_tokens":5007,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbjM9YNjVtezmoKeRx1","type":"assistant","uuid":"1886aee7-0553-4516-b5b3-86d8cff700a0","timestamp":"2025-12-20T20:51:01.857Z"}
{"parentUuid":"1886aee7-0553-4516-b5b3-86d8cff700a0","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VbaUMa8DZ1gNkvE9bFty25","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KZKNz76sFc2udgfCTbNyqU","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/types/results.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":5007,"cache_read_input_tokens":21632,"cache_creation":{"ephemeral_5m_input_tokens":5007,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbjM9YNjVtezmoKeRx1","type":"assistant","uuid":"692724c3-b3f3-4a6e-8843-fd719470205f","timestamp":"2025-12-20T20:51:02.526Z"}
{"parentUuid":"692724c3-b3f3-4a6e-8843-fd719470205f","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VbaUMa8DZ1gNkvE9bFty25","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GZfZo71hMCguy1EWGHMUxQ","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/severity.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":5007,"cache_read_input_tokens":21632,"cache_creation":{"ephemeral_5m_input_tokens":5007,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbjM9YNjVtezmoKeRx1","type":"assistant","uuid":"d07d8075-53ff-4f1c-b708-f225783b5cb1","timestamp":"2025-12-20T20:51:03.187Z"}
{"parentUuid":"d07d8075-53ff-4f1c-b708-f225783b5cb1","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VbaUMa8DZ1gNkvE9bFty25","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AecQqALv69dBGsxBtiuFNS","name":"Glob","input":{"pattern":"**/StrengthFlawCards.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":5007,"cache_read_input_tokens":21632,"cache_creation":{"ephemeral_5m_input_tokens":5007,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbjM9YNjVtezmoKeRx1","type":"assistant","uuid":"8fcb7c7f-43bc-4005-8556-1c968f5731b7","timestamp":"2025-12-20T20:51:03.672Z"}
{"parentUuid":"8fcb7c7f-43bc-4005-8556-1c968f5731b7","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0134keN7f5cLoEP2z1Y7VppL","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"fb0b4566-317f-4846-b19b-9bda1e8696d3","timestamp":"2025-12-20T20:51:03.747Z","toolUseResult":{"oldTodos":[],"newTodos":[{"content":"Enhanced Illustration Configs - Expand generateIllustration() function","status":"pending","activeForm":"Expanding generateIllustration() function"},{"content":"Improved Flaw-to-Treatment Matching - Use metric scores and match flaws to procedures","status":"pending","activeForm":"Improving flaw-to-treatment matching"},{"content":"Severity Display Enhancement - Add severity badges with colors","status":"pending","activeForm":"Enhancing severity display with badges"}]}}
{"parentUuid":"fb0b4566-317f-4846-b19b-9bda1e8696d3","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HJRdthANz2EoMEFmC2yZxZ","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import React, { createContext, useContext, useState, useMemo, useCallback, ReactNode } from 'react';\n     4→import { LandmarkPoint } from '@/lib/landmarks';\n     5→import {\n     6→  analyzeFrontProfile,\n     7→  analyzeSideProfile,\n     8→  analyzeHarmony,\n     9→  HarmonyAnalysis,\n    10→  FaceIQScoreResult,\n    11→  FACEIQ_METRICS,\n    12→  Ethnicity,\n    13→  Gender,\n    14→} from '@/lib/faceiq-scoring';\n    15→import {\n    16→  Ratio,\n    17→  Strength,\n    18→  Flaw,\n    19→  Recommendation,\n    20→  ResultsTab,\n    21→  FullHarmonyAnalysis,\n    22→} from '@/types/results';\n    23→\n    24→// ============================================\n    25→// CONTEXT TYPES\n    26→// ============================================\n    27→\n    28→interface ResultsContextType {\n    29→  // Raw data\n    30→  frontLandmarks: LandmarkPoint[];\n    31→  sideLandmarks: LandmarkPoint[];\n    32→  gender: Gender;\n    33→  ethnicity: Ethnicity;\n    34→  frontPhoto: string;\n    35→  sidePhoto: string | null;\n    36→\n    37→  // Computed results\n    38→  harmonyAnalysis: FullHarmonyAnalysis | null;\n    39→  frontRatios: Ratio[];\n    40→  sideRatios: Ratio[];\n    41→  strengths: Strength[];\n    42→  flaws: Flaw[];\n    43→  recommendations: Recommendation[];\n    44→\n    45→  // Scores\n    46→  overallScore: number;\n    47→  frontScore: number;\n    48→  sideScore: number;\n    49→\n    50→  // UI state\n    51→  activeTab: ResultsTab;\n    52→  setActiveTab: (tab: ResultsTab) => void;\n    53→  expandedMeasurementId: string | null;\n    54→  setExpandedMeasurementId: (id: string | null) => void;\n    55→  selectedVisualizationMetric: string | null;\n    56→  setSelectedVisualizationMetric: (id: string | null) => void;\n    57→  categoryFilter: string | null;\n    58→  setCategoryFilter: (category: string | null) => void;\n    59→  showLandmarkOverlay: boolean;\n    60→  setShowLandmarkOverlay: (show: boolean) => void;\n    61→\n    62→  // Actions\n    63→  setResultsData: (data: ResultsInputData) => void;\n    64→}\n    65→\n    66→interface ResultsInputData {\n    67→  frontLandmarks: LandmarkPoint[];\n    68→  sideLandmarks: LandmarkPoint[];\n    69→  frontPhoto: string;\n    70→  sidePhoto?: string;\n    71→  gender: Gender;\n    72→  ethnicity?: Ethnicity;\n    73→}\n    74→\n    75→// ============================================\n    76→// HELPER FUNCTIONS\n    77→// ============================================\n    78→\n    79→function convertUnitToRatioUnit(unit: string): 'x' | 'mm' | '%' | '°' {\n    80→  switch (unit) {\n    81→    case 'ratio': return 'x';\n    82→    case 'percent': return '%';\n    83→    case 'degrees': return '°';\n    84→    case 'mm': return 'mm';\n    85→    default: return 'x';\n    86→  }\n    87→}\n    88→\n    89→function transformToRatio(result: FaceIQScoreResult, landmarks: LandmarkPoint[]): Ratio {\n    90→  const metricConfig = FACEIQ_METRICS[result.metricId];\n    91→\n    92→  // Generate illustration based on metric\n    93→  const illustration = generateIllustration(result.metricId, landmarks);\n    94→\n    95→  // Get flaw/strength mappings\n    96→  const { mayIndicateFlaws, mayIndicateStrengths } = getFlawStrengthMappings(result);\n    97→\n    98→  return {\n    99→    id: result.metricId,\n   100→    name: result.name,\n   101→    value: result.value,\n   102→    score: result.score,\n   103→    standardizedScore: result.standardizedScore,\n   104→    unit: convertUnitToRatioUnit(result.unit),\n   105→    idealMin: result.idealMin,\n   106→    idealMax: result.idealMax,\n   107→    rangeMin: metricConfig?.rangeMin || result.idealMin - 0.5,\n   108→    rangeMax: metricConfig?.rangeMax || result.idealMax + 0.5,\n   109→    description: metricConfig?.description || '',\n   110→    category: result.category,\n   111→    qualityLevel: result.qualityTier,\n   112→    severity: result.severity,\n   113→    illustration,\n   114→    mayIndicateFlaws,\n   115→    mayIndicateStrengths,\n   116→    usedLandmarks: getUsedLandmarks(result.metricId),\n   117→    scoringCurveConfig: metricConfig ? {\n   118→      decayRate: metricConfig.decayRate,\n   119→      maxScore: metricConfig.maxScore,\n   120→    } : undefined,\n   121→  };\n   122→}\n   123→\n   124→function generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n   125→  // Default illustration - will be enhanced with metric-specific data\n   126→  const landmarkMap: Record<string, LandmarkPoint> = {};\n   127→  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n   128→\n   129→  // Metric-specific illustration configurations\n   130→  const illustrationConfigs: Record<string, { points: string[]; lines: Array<{ from: string; to: string }> }> = {\n   131→    faceWidthToHeight: {\n   132→      points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n   133→      lines: [\n   134→        { from: 'left_zygion', to: 'right_zygion' },\n   135→        { from: 'trichion', to: 'menton' },\n   136→      ],\n   137→    },\n   138→    lateralCanthalTilt: {\n   139→      points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n   140→      lines: [\n   141→        { from: 'left_canthus_medialis', to: 'left_canthus_lateralis' },\n   142→        { from: 'right_canthus_medialis', to: 'right_canthus_lateralis' },\n   143→      ],\n   144→    },\n   145→    nasalIndex: {\n   146→      points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n   147→      lines: [\n   148→        { from: 'left_ala_nasi', to: 'right_ala_nasi' },\n   149→        { from: 'nasal_base', to: 'subnasale' },\n   150→      ],\n   151→    },\n   152→    mouthWidth: {\n   153→      points: ['left_cheilion', 'right_cheilion'],\n   154→      lines: [{ from: 'left_cheilion', to: 'right_cheilion' }],\n   155→    },\n   156→    jawWidth: {\n   157→      points: ['left_gonion_inferior', 'right_gonion_inferior'],\n   158→      lines: [{ from: 'left_gonion_inferior', to: 'right_gonion_inferior' }],\n   159→    },\n   160→    chinHeight: {\n   161→      points: ['labrale_inferius', 'menton'],\n   162→      lines: [{ from: 'labrale_inferius', to: 'menton' }],\n   163→    },\n   164→  };\n   165→\n   166→  const config = illustrationConfigs[metricId];\n   167→  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n   168→  const lines: Record<string, { from: string; to: string; color: string }> = {};\n   169→\n   170→  if (config) {\n   171→    config.points.forEach((pointId, i) => {\n   172→      if (landmarkMap[pointId]) {\n   173→        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n   174→      }\n   175→    });\n   176→    config.lines.forEach((line, i) => {\n   177→      lines[`line_${i}`] = { from: line.from, to: line.to, color: '#67e8f9' };\n   178→    });\n   179→  }\n   180→\n   181→  return { points, lines };\n   182→}\n   183→\n   184→function getUsedLandmarks(metricId: string): string[] {\n   185→  const landmarkMappings: Record<string, string[]> = {\n   186→    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n   187→    lateralCanthalTilt: ['left_canthus_medialis', 'left_canthus_lateralis'],\n   188→    nasalIndex: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n   189→    ipd: ['left_pupila', 'right_pupila'],\n   190→    mouthWidth: ['left_cheilion', 'right_cheilion'],\n   191→    jawWidth: ['left_gonion_inferior', 'right_gonion_inferior'],\n   192→    chinHeight: ['labrale_inferius', 'menton'],\n   193→    gonialAngle: ['tragus', 'gonionBottom', 'menton'],\n   194→  };\n   195→  return landmarkMappings[metricId] || [];\n   196→}\n   197→\n   198→function getFlawStrengthMappings(result: FaceIQScoreResult): { mayIndicateFlaws: string[]; mayIndicateStrengths: string[] } {\n   199→  const flawMappings: Record<string, { low: string[]; high: string[] }> = {\n   200→    faceWidthToHeight: {\n   201→      low: ['Narrow face', 'Vertically elongated face'],\n   202→      high: ['Wide face', 'Horizontally expanded face'],\n   203→    },\n   204→    lowerThirdProportion: {\n   205→      low: ['Short lower third', 'Deficient mandible'],\n   206→      high: ['Long lower third', 'Mandibular excess'],\n   207→    },\n   208→    lateralCanthalTilt: {\n   209→      low: ['Negative canthal tilt', 'Drooping eyes'],\n   210→      high: ['Excessive positive canthal tilt'],\n   211→    },\n   212→    nasalIndex: {\n   213→      low: ['Narrow nose', 'Leptorrhine nose'],\n   214→      high: ['Wide nose', 'Platyrrhine nose'],\n   215→    },\n   216→    gonialAngle: {\n   217→      low: ['Steep mandibular plane'],\n   218→      high: ['Flat mandibular plane', 'Weak jaw definition'],\n   219→    },\n   220→  };\n   221→\n   222→  const strengthMappings: Record<string, { ideal: string[] }> = {\n   223→    faceWidthToHeight: { ideal: ['Balanced facial proportions', 'Harmonious face shape'] },\n   224→    lateralCanthalTilt: { ideal: ['Attractive eye shape', 'Positive canthal tilt'] },\n   225→    nasalIndex: { ideal: ['Well-proportioned nose', 'Balanced nasal width'] },\n   226→    gonialAngle: { ideal: ['Well-defined jawline', 'Strong jaw structure'] },\n   227→  };\n   228→\n   229→  const mapping = flawMappings[result.metricId];\n   230→  const strengthMapping = strengthMappings[result.metricId];\n   231→\n   232→  let mayIndicateFlaws: string[] = [];\n   233→  let mayIndicateStrengths: string[] = [];\n   234→\n   235→  if (result.qualityTier === 'ideal' || result.qualityTier === 'excellent') {\n   236→    mayIndicateStrengths = strengthMapping?.ideal || [];\n   237→  } else if (mapping) {\n   238→    mayIndicateFlaws = result.deviationDirection === 'below' ? mapping.low : mapping.high;\n   239→  }\n   240→\n   241→  return { mayIndicateFlaws, mayIndicateStrengths };\n   242→}\n   243→\n   244→function generateStrengthsFromAnalysis(analysis: HarmonyAnalysis): Strength[] {\n   245→  const strengths: Strength[] = [];\n   246→\n   247→  analysis.strengths.forEach((s, i) => {\n   248→    const matchingMeasurement = analysis.measurements.find(m => m.metricId === s.metricId);\n   249→\n   250→    strengths.push({\n   251→      id: `strength_${i}`,\n   252→      strengthName: s.metricName,\n   253→      summary: s.reasoning,\n   254→      avgScore: matchingMeasurement?.score || 8,\n   255→      qualityLevel: s.qualityTier,\n   256→      categoryName: s.category,\n   257→      responsibleRatios: [{\n   258→        ratioName: s.metricName,\n   259→        ratioId: s.metricId,\n   260→        score: matchingMeasurement?.score || 8,\n   261→        value: s.value,\n   262→      }],\n   263→    });\n   264→  });\n   265→\n   266→  return strengths;\n   267→}\n   268→\n   269→function generateFlawsFromAnalysis(analysis: HarmonyAnalysis): Flaw[] {\n   270→  const flaws: Flaw[] = [];\n   271→  let rollingLost = 0;\n   272→\n   273→  analysis.flaws.forEach((f, i) => {\n   274→    const matchingMeasurement = analysis.measurements.find(m => m.metricId === f.metricId);\n   275→    const impact = matchingMeasurement ? (10 - matchingMeasurement.score) * 0.5 : 2;\n   276→    rollingLost += impact;\n   277→\n   278→    flaws.push({\n   279→      id: `flaw_${i}`,\n   280→      flawName: f.metricName,\n   281→      summary: f.reasoning,\n   282→      harmonyPercentageLost: impact,\n   283→      standardizedImpact: impact / 10,\n   284→      categoryName: f.category,\n   285→      responsibleRatios: [{\n   286→        ratioName: f.metricName,\n   287→        ratioId: f.metricId,\n   288→        score: matchingMeasurement?.score || 3,\n   289→        value: matchingMeasurement?.value || 0,\n   290→      }],\n   291→      rollingPointsDeducted: rollingLost,\n   292→      rollingHarmonyPercentageLost: rollingLost,\n   293→      rollingStandardizedImpact: rollingLost / 10,\n   294→    });\n   295→  });\n   296→\n   297→  return flaws.sort((a, b) => b.harmonyPercentageLost - a.harmonyPercentageLost);\n   298→}\n   299→\n   300→function generateRecommendations(flaws: Flaw[]): Recommendation[] {\n   301→  // Generate recommendations based on detected flaws\n   302→  const recommendations: Recommendation[] = [];\n   303→\n   304→  const procedureDatabase: Array<Omit<Recommendation, 'matchedFlaws' | 'matchedRatios' | 'ratios_impacted'> & { targetFlaws: string[] }> = [\n   305→    {\n   306→      ref_id: 'SUR-01',\n   307→      name: 'Genioplasty',\n   308→      description: 'Surgical chin repositioning to improve chin projection and facial harmony. Can move the chin forward, backward, up, or down.',\n   309→      phase: 'Surgical',\n   310→      impact: 0.85,\n   311→      coverage: 8,\n   312→      percentage: '15-25%',\n   313→      expectedImprovementRange: { min: 0.5, max: 1.5 },\n   314→      targetFlaws: ['Weak chin', 'Recessed chin', 'Short chin', 'chin'],\n   315→      timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n   316→      cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n   317→      risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage.',\n   318→      warnings: [],\n   319→      gender: 'both',\n   320→    },\n   321→    {\n   322→      ref_id: 'SUR-02',\n   323→      name: 'Rhinoplasty',\n   324→      description: 'Nose reshaping surgery to improve nasal proportions, reduce or increase size, change angle, or correct breathing issues.',\n   325→      phase: 'Surgical',\n   326→      impact: 0.8,\n   327→      coverage: 6,\n   328→      percentage: '10-20%',\n   329→      targetFlaws: ['Wide nose', 'Long nose', 'Crooked nose', 'nose', 'nasal'],\n   330→      timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n   331→      cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n   332→      risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n   333→      warnings: [],\n   334→      gender: 'both',\n   335→    },\n   336→    {\n   337→      ref_id: 'SUR-03',\n   338→      name: 'Jaw Implants',\n   339→      description: 'Custom or standard implants to enhance jaw width and definition. Creates a more angular, masculine jawline.',\n   340→      phase: 'Surgical',\n   341→      impact: 0.75,\n   342→      coverage: 5,\n   343→      percentage: '10-15%',\n   344→      targetFlaws: ['Narrow jaw', 'Weak jaw', 'jaw'],\n   345→      timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n   346→      cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n   347→      risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection.',\n   348→      warnings: [],\n   349→      gender: 'both',\n   350→    },\n   351→    {\n   352→      ref_id: 'MIN-01',\n   353→      name: 'Dermal Fillers',\n   354→      description: 'Hyaluronic acid injections to add volume to chin, jawline, or cheeks. Non-permanent and reversible.',\n   355→      phase: 'Minimally Invasive',\n   356→      impact: 0.4,\n   357→      coverage: 4,\n   358→      percentage: '5-10%',\n   359→      targetFlaws: ['Weak chin', 'Flat cheeks', 'chin', 'midface'],\n   360→      timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n   361→      cost: { type: 'per_session', min: 600, max: 2000, currency: 'USD' },\n   362→      risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n   363→      warnings: ['Results temporary (6-18 months)'],\n   364→      gender: 'both',\n   365→    },\n   366→    {\n   367→      ref_id: 'MIN-02',\n   368→      name: 'Orthodontic Treatment',\n   369→      description: 'Braces or clear aligners to correct bite alignment and tooth positioning. Can impact facial profile over time.',\n   370→      phase: 'Minimally Invasive',\n   371→      impact: 0.5,\n   372→      coverage: 3,\n   373→      percentage: '5-15%',\n   374→      targetFlaws: ['Bite issues', 'Midface recession', 'jaw'],\n   375→      timeline: { effect_start: 'gradual', full_results_weeks: 52, full_results_weeks_max: 104 },\n   376→      cost: { type: 'flat', min: 3000, max: 10000, currency: 'USD' },\n   377→      risks_side_effects: 'Temporary discomfort, requires compliance.',\n   378→      warnings: [],\n   379→      gender: 'both',\n   380→    },\n   381→    {\n   382→      ref_id: 'FND-01',\n   383→      name: 'Mewing / Proper Tongue Posture',\n   384→      description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n   385→      phase: 'Foundational',\n   386→      impact: 0.2,\n   387→      coverage: 4,\n   388→      percentage: '2-5%',\n   389→      targetFlaws: ['Midface recession', 'Narrow palate', 'jaw', 'midface'],\n   390→      timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n   391→      cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n   392→      risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n   393→      warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n   394→      gender: 'both',\n   395→    },\n   396→    {\n   397→      ref_id: 'FND-02',\n   398→      name: 'Body Recomposition',\n   399→      description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n   400→      phase: 'Foundational',\n   401→      impact: 0.3,\n   402→      coverage: 6,\n   403→      percentage: '5-10%',\n   404→      targetFlaws: ['Undefined jawline', 'Soft features', 'jaw', 'face'],\n   405→      timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n   406→      cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n   407→      risks_side_effects: 'None if done healthily.',\n   408→      warnings: [],\n   409→      gender: 'both',\n   410→    },\n   411→  ];\n   412→\n   413→  flaws.forEach(flaw => {\n   414→    procedureDatabase.forEach(proc => {\n   415→      const flawLower = flaw.flawName.toLowerCase();\n   416→      const matches = proc.targetFlaws.some(target =>\n   417→        flawLower.includes(target.toLowerCase()) || target.toLowerCase().includes(flawLower)\n   418→      );\n   419→\n   420→      if (matches && !recommendations.find(r => r.ref_id === proc.ref_id)) {\n   421→        recommendations.push({\n   422→          ...proc,\n   423→          matchedFlaws: [flaw.flawName],\n   424→          matchedRatios: flaw.responsibleRatios.map(r => r.ratioName),\n   425→          ratios_impacted: flaw.responsibleRatios.map(r => ({\n   426→            ratioId: r.ratioId,\n   427→            ratioName: r.ratioName,\n   428→            direction: 'both' as const,\n   429→            percentageEffect: 1.0,\n   430→          })),\n   431→        });\n   432→      }\n   433→    });\n   434→  });\n   435→\n   436→  return recommendations.sort((a, b) => b.impact - a.impact);\n   437→}\n   438→\n   439→// ============================================\n   440→// CONTEXT CREATION\n   441→// ============================================\n   442→\n   443→const ResultsContext = createContext<ResultsContextType | null>(null);\n   444→\n   445→export function useResults(): ResultsContextType {\n   446→  const context = useContext(ResultsContext);\n   447→  if (!context) {\n   448→    throw new Error('useResults must be used within a ResultsProvider');\n   449→  }\n   450→  return context;\n   451→}\n   452→\n   453→interface ResultsProviderProps {\n   454→  children: ReactNode;\n   455→  initialData?: ResultsInputData;\n   456→}\n   457→\n   458→export function ResultsProvider({ children, initialData }: ResultsProviderProps) {\n   459→  // Raw data state\n   460→  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>(initialData?.frontLandmarks || []);\n   461→  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>(initialData?.sideLandmarks || []);\n   462→  const [gender, setGender] = useState<Gender>(initialData?.gender || 'male');\n   463→  const [ethnicity, setEthnicity] = useState<Ethnicity>(initialData?.ethnicity || 'other');\n   464→  const [frontPhoto, setFrontPhoto] = useState<string>(initialData?.frontPhoto || '');\n   465→  const [sidePhoto, setSidePhoto] = useState<string | null>(initialData?.sidePhoto || null);\n   466→\n   467→  // UI state\n   468→  const [activeTab, setActiveTab] = useState<ResultsTab>('overview');\n   469→  const [expandedMeasurementId, setExpandedMeasurementId] = useState<string | null>(null);\n   470→  const [selectedVisualizationMetric, setSelectedVisualizationMetric] = useState<string | null>(null);\n   471→  const [categoryFilter, setCategoryFilter] = useState<string | null>(null);\n   472→  const [showLandmarkOverlay, setShowLandmarkOverlay] = useState(true);\n   473→\n   474→  // Compute analysis results (now with demographic-specific scoring)\n   475→  const analysisResults = useMemo(() => {\n   476→    if (frontLandmarks.length === 0) {\n   477→      return null;\n   478→    }\n   479→\n   480→    try {\n   481→      const frontAnalysis = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n   482→      const sideAnalysis = sideLandmarks.length > 0\n   483→        ? analyzeSideProfile(sideLandmarks, gender, ethnicity)\n   484→        : null;\n   485→      // analyzeHarmony expects landmarks directly, not analysis results\n   486→      const harmony = analyzeHarmony(frontLandmarks, sideLandmarks, gender, ethnicity);\n   487→\n   488→      return { frontAnalysis, sideAnalysis, harmony };\n   489→    } catch (error) {\n   490→      console.error('Analysis error:', error);\n   491→      return null;\n   492→    }\n   493→  }, [frontLandmarks, sideLandmarks, gender, ethnicity]);\n   494→\n   495→  // Transform to Ratio format\n   496→  const frontRatios = useMemo(() => {\n   497→    if (!analysisResults?.frontAnalysis) return [];\n   498→    return analysisResults.frontAnalysis.measurements.map(m => transformToRatio(m, frontLandmarks));\n   499→  }, [analysisResults, frontLandmarks]);\n   500→\n   501→  const sideRatios = useMemo(() => {\n   502→    if (!analysisResults?.sideAnalysis) return [];\n   503→    return analysisResults.sideAnalysis.measurements.map(m => transformToRatio(m, sideLandmarks));\n   504→  }, [analysisResults, sideLandmarks]);\n   505→\n   506→  // Generate strengths and flaws\n   507→  const strengths = useMemo(() => {\n   508→    if (!analysisResults?.harmony) return [];\n   509→    return generateStrengthsFromAnalysis(analysisResults.harmony);\n   510→  }, [analysisResults]);\n   511→\n   512→  const flaws = useMemo(() => {\n   513→    if (!analysisResults?.harmony) return [];\n   514→    return generateFlawsFromAnalysis(analysisResults.harmony);\n   515→  }, [analysisResults]);\n   516→\n   517→  // Generate recommendations\n   518→  const recommendations = useMemo(() => {\n   519→    return generateRecommendations(flaws);\n   520→  }, [flaws]);\n   521→\n   522→  // Build full harmony analysis\n   523→  const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {\n   524→    if (!analysisResults?.harmony) return null;\n   525→\n   526→    return {\n   527→      standardizedScore: analysisResults.harmony.overallScore,\n   528→      front: {\n   529→        standardizedScore: analysisResults.harmony.frontScore,\n   530→        ratios: frontRatios,\n   531→      },\n   532→      side: {\n   533→        standardizedScore: analysisResults.harmony.sideScore,\n   534→        ratios: sideRatios,\n   535→      },\n   536→      strengths,\n   537→      flaws,\n   538→    };\n   539→  }, [analysisResults, frontRatios, sideRatios, strengths, flaws]);\n   540→\n   541→  // Scores\n   542→  const overallScore = analysisResults?.harmony?.overallScore || 0;\n   543→  const frontScore = analysisResults?.harmony?.frontScore || 0;\n   544→  const sideScore = analysisResults?.harmony?.sideScore || 0;\n   545→\n   546→  // Action to set all results data\n   547→  const setResultsData = useCallback((data: ResultsInputData) => {\n   548→    setFrontLandmarks(data.frontLandmarks);\n   549→    setSideLandmarks(data.sideLandmarks);\n   550→    setFrontPhoto(data.frontPhoto);\n   551→    setSidePhoto(data.sidePhoto || null);\n   552→    setGender(data.gender);\n   553→    setEthnicity(data.ethnicity || 'other');\n   554→  }, []);\n   555→\n   556→  const value: ResultsContextType = {\n   557→    frontLandmarks,\n   558→    sideLandmarks,\n   559→    gender,\n   560→    ethnicity,\n   561→    frontPhoto,\n   562→    sidePhoto,\n   563→    harmonyAnalysis,\n   564→    frontRatios,\n   565→    sideRatios,\n   566→    strengths,\n   567→    flaws,\n   568→    recommendations,\n   569→    overallScore,\n   570→    frontScore,\n   571→    sideScore,\n   572→    activeTab,\n   573→    setActiveTab,\n   574→    expandedMeasurementId,\n   575→    setExpandedMeasurementId,\n   576→    selectedVisualizationMetric,\n   577→    setSelectedVisualizationMetric,\n   578→    categoryFilter,\n   579→    setCategoryFilter,\n   580→    showLandmarkOverlay,\n   581→    setShowLandmarkOverlay,\n   582→    setResultsData,\n   583→  };\n   584→\n   585→  return (\n   586→    <ResultsContext.Provider value={value}>\n   587→      {children}\n   588→    </ResultsContext.Provider>\n   589→  );\n   590→}\n   591→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"ac44fb6e-e877-43ac-bb10-44a448f8e9c6","timestamp":"2025-12-20T20:51:03.791Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","content":"'use client';\n\nimport React, { createContext, useContext, useState, useMemo, useCallback, ReactNode } from 'react';\nimport { LandmarkPoint } from '@/lib/landmarks';\nimport {\n  analyzeFrontProfile,\n  analyzeSideProfile,\n  analyzeHarmony,\n  HarmonyAnalysis,\n  FaceIQScoreResult,\n  FACEIQ_METRICS,\n  Ethnicity,\n  Gender,\n} from '@/lib/faceiq-scoring';\nimport {\n  Ratio,\n  Strength,\n  Flaw,\n  Recommendation,\n  ResultsTab,\n  FullHarmonyAnalysis,\n} from '@/types/results';\n\n// ============================================\n// CONTEXT TYPES\n// ============================================\n\ninterface ResultsContextType {\n  // Raw data\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  gender: Gender;\n  ethnicity: Ethnicity;\n  frontPhoto: string;\n  sidePhoto: string | null;\n\n  // Computed results\n  harmonyAnalysis: FullHarmonyAnalysis | null;\n  frontRatios: Ratio[];\n  sideRatios: Ratio[];\n  strengths: Strength[];\n  flaws: Flaw[];\n  recommendations: Recommendation[];\n\n  // Scores\n  overallScore: number;\n  frontScore: number;\n  sideScore: number;\n\n  // UI state\n  activeTab: ResultsTab;\n  setActiveTab: (tab: ResultsTab) => void;\n  expandedMeasurementId: string | null;\n  setExpandedMeasurementId: (id: string | null) => void;\n  selectedVisualizationMetric: string | null;\n  setSelectedVisualizationMetric: (id: string | null) => void;\n  categoryFilter: string | null;\n  setCategoryFilter: (category: string | null) => void;\n  showLandmarkOverlay: boolean;\n  setShowLandmarkOverlay: (show: boolean) => void;\n\n  // Actions\n  setResultsData: (data: ResultsInputData) => void;\n}\n\ninterface ResultsInputData {\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  frontPhoto: string;\n  sidePhoto?: string;\n  gender: Gender;\n  ethnicity?: Ethnicity;\n}\n\n// ============================================\n// HELPER FUNCTIONS\n// ============================================\n\nfunction convertUnitToRatioUnit(unit: string): 'x' | 'mm' | '%' | '°' {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return '°';\n    case 'mm': return 'mm';\n    default: return 'x';\n  }\n}\n\nfunction transformToRatio(result: FaceIQScoreResult, landmarks: LandmarkPoint[]): Ratio {\n  const metricConfig = FACEIQ_METRICS[result.metricId];\n\n  // Generate illustration based on metric\n  const illustration = generateIllustration(result.metricId, landmarks);\n\n  // Get flaw/strength mappings\n  const { mayIndicateFlaws, mayIndicateStrengths } = getFlawStrengthMappings(result);\n\n  return {\n    id: result.metricId,\n    name: result.name,\n    value: result.value,\n    score: result.score,\n    standardizedScore: result.standardizedScore,\n    unit: convertUnitToRatioUnit(result.unit),\n    idealMin: result.idealMin,\n    idealMax: result.idealMax,\n    rangeMin: metricConfig?.rangeMin || result.idealMin - 0.5,\n    rangeMax: metricConfig?.rangeMax || result.idealMax + 0.5,\n    description: metricConfig?.description || '',\n    category: result.category,\n    qualityLevel: result.qualityTier,\n    severity: result.severity,\n    illustration,\n    mayIndicateFlaws,\n    mayIndicateStrengths,\n    usedLandmarks: getUsedLandmarks(result.metricId),\n    scoringCurveConfig: metricConfig ? {\n      decayRate: metricConfig.decayRate,\n      maxScore: metricConfig.maxScore,\n    } : undefined,\n  };\n}\n\nfunction generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  // Default illustration - will be enhanced with metric-specific data\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  // Metric-specific illustration configurations\n  const illustrationConfigs: Record<string, { points: string[]; lines: Array<{ from: string; to: string }> }> = {\n    faceWidthToHeight: {\n      points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n      lines: [\n        { from: 'left_zygion', to: 'right_zygion' },\n        { from: 'trichion', to: 'menton' },\n      ],\n    },\n    lateralCanthalTilt: {\n      points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n      lines: [\n        { from: 'left_canthus_medialis', to: 'left_canthus_lateralis' },\n        { from: 'right_canthus_medialis', to: 'right_canthus_lateralis' },\n      ],\n    },\n    nasalIndex: {\n      points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n      lines: [\n        { from: 'left_ala_nasi', to: 'right_ala_nasi' },\n        { from: 'nasal_base', to: 'subnasale' },\n      ],\n    },\n    mouthWidth: {\n      points: ['left_cheilion', 'right_cheilion'],\n      lines: [{ from: 'left_cheilion', to: 'right_cheilion' }],\n    },\n    jawWidth: {\n      points: ['left_gonion_inferior', 'right_gonion_inferior'],\n      lines: [{ from: 'left_gonion_inferior', to: 'right_gonion_inferior' }],\n    },\n    chinHeight: {\n      points: ['labrale_inferius', 'menton'],\n      lines: [{ from: 'labrale_inferius', to: 'menton' }],\n    },\n  };\n\n  const config = illustrationConfigs[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = { from: line.from, to: line.to, color: '#67e8f9' };\n    });\n  }\n\n  return { points, lines };\n}\n\nfunction getUsedLandmarks(metricId: string): string[] {\n  const landmarkMappings: Record<string, string[]> = {\n    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lateralCanthalTilt: ['left_canthus_medialis', 'left_canthus_lateralis'],\n    nasalIndex: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    ipd: ['left_pupila', 'right_pupila'],\n    mouthWidth: ['left_cheilion', 'right_cheilion'],\n    jawWidth: ['left_gonion_inferior', 'right_gonion_inferior'],\n    chinHeight: ['labrale_inferius', 'menton'],\n    gonialAngle: ['tragus', 'gonionBottom', 'menton'],\n  };\n  return landmarkMappings[metricId] || [];\n}\n\nfunction getFlawStrengthMappings(result: FaceIQScoreResult): { mayIndicateFlaws: string[]; mayIndicateStrengths: string[] } {\n  const flawMappings: Record<string, { low: string[]; high: string[] }> = {\n    faceWidthToHeight: {\n      low: ['Narrow face', 'Vertically elongated face'],\n      high: ['Wide face', 'Horizontally expanded face'],\n    },\n    lowerThirdProportion: {\n      low: ['Short lower third', 'Deficient mandible'],\n      high: ['Long lower third', 'Mandibular excess'],\n    },\n    lateralCanthalTilt: {\n      low: ['Negative canthal tilt', 'Drooping eyes'],\n      high: ['Excessive positive canthal tilt'],\n    },\n    nasalIndex: {\n      low: ['Narrow nose', 'Leptorrhine nose'],\n      high: ['Wide nose', 'Platyrrhine nose'],\n    },\n    gonialAngle: {\n      low: ['Steep mandibular plane'],\n      high: ['Flat mandibular plane', 'Weak jaw definition'],\n    },\n  };\n\n  const strengthMappings: Record<string, { ideal: string[] }> = {\n    faceWidthToHeight: { ideal: ['Balanced facial proportions', 'Harmonious face shape'] },\n    lateralCanthalTilt: { ideal: ['Attractive eye shape', 'Positive canthal tilt'] },\n    nasalIndex: { ideal: ['Well-proportioned nose', 'Balanced nasal width'] },\n    gonialAngle: { ideal: ['Well-defined jawline', 'Strong jaw structure'] },\n  };\n\n  const mapping = flawMappings[result.metricId];\n  const strengthMapping = strengthMappings[result.metricId];\n\n  let mayIndicateFlaws: string[] = [];\n  let mayIndicateStrengths: string[] = [];\n\n  if (result.qualityTier === 'ideal' || result.qualityTier === 'excellent') {\n    mayIndicateStrengths = strengthMapping?.ideal || [];\n  } else if (mapping) {\n    mayIndicateFlaws = result.deviationDirection === 'below' ? mapping.low : mapping.high;\n  }\n\n  return { mayIndicateFlaws, mayIndicateStrengths };\n}\n\nfunction generateStrengthsFromAnalysis(analysis: HarmonyAnalysis): Strength[] {\n  const strengths: Strength[] = [];\n\n  analysis.strengths.forEach((s, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === s.metricId);\n\n    strengths.push({\n      id: `strength_${i}`,\n      strengthName: s.metricName,\n      summary: s.reasoning,\n      avgScore: matchingMeasurement?.score || 8,\n      qualityLevel: s.qualityTier,\n      categoryName: s.category,\n      responsibleRatios: [{\n        ratioName: s.metricName,\n        ratioId: s.metricId,\n        score: matchingMeasurement?.score || 8,\n        value: s.value,\n      }],\n    });\n  });\n\n  return strengths;\n}\n\nfunction generateFlawsFromAnalysis(analysis: HarmonyAnalysis): Flaw[] {\n  const flaws: Flaw[] = [];\n  let rollingLost = 0;\n\n  analysis.flaws.forEach((f, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === f.metricId);\n    const impact = matchingMeasurement ? (10 - matchingMeasurement.score) * 0.5 : 2;\n    rollingLost += impact;\n\n    flaws.push({\n      id: `flaw_${i}`,\n      flawName: f.metricName,\n      summary: f.reasoning,\n      harmonyPercentageLost: impact,\n      standardizedImpact: impact / 10,\n      categoryName: f.category,\n      responsibleRatios: [{\n        ratioName: f.metricName,\n        ratioId: f.metricId,\n        score: matchingMeasurement?.score || 3,\n        value: matchingMeasurement?.value || 0,\n      }],\n      rollingPointsDeducted: rollingLost,\n      rollingHarmonyPercentageLost: rollingLost,\n      rollingStandardizedImpact: rollingLost / 10,\n    });\n  });\n\n  return flaws.sort((a, b) => b.harmonyPercentageLost - a.harmonyPercentageLost);\n}\n\nfunction generateRecommendations(flaws: Flaw[]): Recommendation[] {\n  // Generate recommendations based on detected flaws\n  const recommendations: Recommendation[] = [];\n\n  const procedureDatabase: Array<Omit<Recommendation, 'matchedFlaws' | 'matchedRatios' | 'ratios_impacted'> & { targetFlaws: string[] }> = [\n    {\n      ref_id: 'SUR-01',\n      name: 'Genioplasty',\n      description: 'Surgical chin repositioning to improve chin projection and facial harmony. Can move the chin forward, backward, up, or down.',\n      phase: 'Surgical',\n      impact: 0.85,\n      coverage: 8,\n      percentage: '15-25%',\n      expectedImprovementRange: { min: 0.5, max: 1.5 },\n      targetFlaws: ['Weak chin', 'Recessed chin', 'Short chin', 'chin'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n      cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n      risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'SUR-02',\n      name: 'Rhinoplasty',\n      description: 'Nose reshaping surgery to improve nasal proportions, reduce or increase size, change angle, or correct breathing issues.',\n      phase: 'Surgical',\n      impact: 0.8,\n      coverage: 6,\n      percentage: '10-20%',\n      targetFlaws: ['Wide nose', 'Long nose', 'Crooked nose', 'nose', 'nasal'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n      cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n      risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'SUR-03',\n      name: 'Jaw Implants',\n      description: 'Custom or standard implants to enhance jaw width and definition. Creates a more angular, masculine jawline.',\n      phase: 'Surgical',\n      impact: 0.75,\n      coverage: 5,\n      percentage: '10-15%',\n      targetFlaws: ['Narrow jaw', 'Weak jaw', 'jaw'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n      cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n      risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'MIN-01',\n      name: 'Dermal Fillers',\n      description: 'Hyaluronic acid injections to add volume to chin, jawline, or cheeks. Non-permanent and reversible.',\n      phase: 'Minimally Invasive',\n      impact: 0.4,\n      coverage: 4,\n      percentage: '5-10%',\n      targetFlaws: ['Weak chin', 'Flat cheeks', 'chin', 'midface'],\n      timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n      cost: { type: 'per_session', min: 600, max: 2000, currency: 'USD' },\n      risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n      warnings: ['Results temporary (6-18 months)'],\n      gender: 'both',\n    },\n    {\n      ref_id: 'MIN-02',\n      name: 'Orthodontic Treatment',\n      description: 'Braces or clear aligners to correct bite alignment and tooth positioning. Can impact facial profile over time.',\n      phase: 'Minimally Invasive',\n      impact: 0.5,\n      coverage: 3,\n      percentage: '5-15%',\n      targetFlaws: ['Bite issues', 'Midface recession', 'jaw'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 52, full_results_weeks_max: 104 },\n      cost: { type: 'flat', min: 3000, max: 10000, currency: 'USD' },\n      risks_side_effects: 'Temporary discomfort, requires compliance.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'FND-01',\n      name: 'Mewing / Proper Tongue Posture',\n      description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n      phase: 'Foundational',\n      impact: 0.2,\n      coverage: 4,\n      percentage: '2-5%',\n      targetFlaws: ['Midface recession', 'Narrow palate', 'jaw', 'midface'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n      cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n      risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n      warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n      gender: 'both',\n    },\n    {\n      ref_id: 'FND-02',\n      name: 'Body Recomposition',\n      description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n      phase: 'Foundational',\n      impact: 0.3,\n      coverage: 6,\n      percentage: '5-10%',\n      targetFlaws: ['Undefined jawline', 'Soft features', 'jaw', 'face'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n      cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n      risks_side_effects: 'None if done healthily.',\n      warnings: [],\n      gender: 'both',\n    },\n  ];\n\n  flaws.forEach(flaw => {\n    procedureDatabase.forEach(proc => {\n      const flawLower = flaw.flawName.toLowerCase();\n      const matches = proc.targetFlaws.some(target =>\n        flawLower.includes(target.toLowerCase()) || target.toLowerCase().includes(flawLower)\n      );\n\n      if (matches && !recommendations.find(r => r.ref_id === proc.ref_id)) {\n        recommendations.push({\n          ...proc,\n          matchedFlaws: [flaw.flawName],\n          matchedRatios: flaw.responsibleRatios.map(r => r.ratioName),\n          ratios_impacted: flaw.responsibleRatios.map(r => ({\n            ratioId: r.ratioId,\n            ratioName: r.ratioName,\n            direction: 'both' as const,\n            percentageEffect: 1.0,\n          })),\n        });\n      }\n    });\n  });\n\n  return recommendations.sort((a, b) => b.impact - a.impact);\n}\n\n// ============================================\n// CONTEXT CREATION\n// ============================================\n\nconst ResultsContext = createContext<ResultsContextType | null>(null);\n\nexport function useResults(): ResultsContextType {\n  const context = useContext(ResultsContext);\n  if (!context) {\n    throw new Error('useResults must be used within a ResultsProvider');\n  }\n  return context;\n}\n\ninterface ResultsProviderProps {\n  children: ReactNode;\n  initialData?: ResultsInputData;\n}\n\nexport function ResultsProvider({ children, initialData }: ResultsProviderProps) {\n  // Raw data state\n  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>(initialData?.frontLandmarks || []);\n  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>(initialData?.sideLandmarks || []);\n  const [gender, setGender] = useState<Gender>(initialData?.gender || 'male');\n  const [ethnicity, setEthnicity] = useState<Ethnicity>(initialData?.ethnicity || 'other');\n  const [frontPhoto, setFrontPhoto] = useState<string>(initialData?.frontPhoto || '');\n  const [sidePhoto, setSidePhoto] = useState<string | null>(initialData?.sidePhoto || null);\n\n  // UI state\n  const [activeTab, setActiveTab] = useState<ResultsTab>('overview');\n  const [expandedMeasurementId, setExpandedMeasurementId] = useState<string | null>(null);\n  const [selectedVisualizationMetric, setSelectedVisualizationMetric] = useState<string | null>(null);\n  const [categoryFilter, setCategoryFilter] = useState<string | null>(null);\n  const [showLandmarkOverlay, setShowLandmarkOverlay] = useState(true);\n\n  // Compute analysis results (now with demographic-specific scoring)\n  const analysisResults = useMemo(() => {\n    if (frontLandmarks.length === 0) {\n      return null;\n    }\n\n    try {\n      const frontAnalysis = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n      const sideAnalysis = sideLandmarks.length > 0\n        ? analyzeSideProfile(sideLandmarks, gender, ethnicity)\n        : null;\n      // analyzeHarmony expects landmarks directly, not analysis results\n      const harmony = analyzeHarmony(frontLandmarks, sideLandmarks, gender, ethnicity);\n\n      return { frontAnalysis, sideAnalysis, harmony };\n    } catch (error) {\n      console.error('Analysis error:', error);\n      return null;\n    }\n  }, [frontLandmarks, sideLandmarks, gender, ethnicity]);\n\n  // Transform to Ratio format\n  const frontRatios = useMemo(() => {\n    if (!analysisResults?.frontAnalysis) return [];\n    return analysisResults.frontAnalysis.measurements.map(m => transformToRatio(m, frontLandmarks));\n  }, [analysisResults, frontLandmarks]);\n\n  const sideRatios = useMemo(() => {\n    if (!analysisResults?.sideAnalysis) return [];\n    return analysisResults.sideAnalysis.measurements.map(m => transformToRatio(m, sideLandmarks));\n  }, [analysisResults, sideLandmarks]);\n\n  // Generate strengths and flaws\n  const strengths = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateStrengthsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  const flaws = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateFlawsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  // Generate recommendations\n  const recommendations = useMemo(() => {\n    return generateRecommendations(flaws);\n  }, [flaws]);\n\n  // Build full harmony analysis\n  const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {\n    if (!analysisResults?.harmony) return null;\n\n    return {\n      standardizedScore: analysisResults.harmony.overallScore,\n      front: {\n        standardizedScore: analysisResults.harmony.frontScore,\n        ratios: frontRatios,\n      },\n      side: {\n        standardizedScore: analysisResults.harmony.sideScore,\n        ratios: sideRatios,\n      },\n      strengths,\n      flaws,\n    };\n  }, [analysisResults, frontRatios, sideRatios, strengths, flaws]);\n\n  // Scores\n  const overallScore = analysisResults?.harmony?.overallScore || 0;\n  const frontScore = analysisResults?.harmony?.frontScore || 0;\n  const sideScore = analysisResults?.harmony?.sideScore || 0;\n\n  // Action to set all results data\n  const setResultsData = useCallback((data: ResultsInputData) => {\n    setFrontLandmarks(data.frontLandmarks);\n    setSideLandmarks(data.sideLandmarks);\n    setFrontPhoto(data.frontPhoto);\n    setSidePhoto(data.sidePhoto || null);\n    setGender(data.gender);\n    setEthnicity(data.ethnicity || 'other');\n  }, []);\n\n  const value: ResultsContextType = {\n    frontLandmarks,\n    sideLandmarks,\n    gender,\n    ethnicity,\n    frontPhoto,\n    sidePhoto,\n    harmonyAnalysis,\n    frontRatios,\n    sideRatios,\n    strengths,\n    flaws,\n    recommendations,\n    overallScore,\n    frontScore,\n    sideScore,\n    activeTab,\n    setActiveTab,\n    expandedMeasurementId,\n    setExpandedMeasurementId,\n    selectedVisualizationMetric,\n    setSelectedVisualizationMetric,\n    categoryFilter,\n    setCategoryFilter,\n    showLandmarkOverlay,\n    setShowLandmarkOverlay,\n    setResultsData,\n  };\n\n  return (\n    <ResultsContext.Provider value={value}>\n      {children}\n    </ResultsContext.Provider>\n  );\n}\n","numLines":591,"startLine":1,"totalLines":591}}}
{"parentUuid":"ac44fb6e-e877-43ac-bb10-44a448f8e9c6","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KZKNz76sFc2udgfCTbNyqU","type":"tool_result","content":"     1→/**\n     2→ * FaceIQ-Style Results Page Types\n     3→ * Complete type definitions for the results UI\n     4→ */\n     5→\n     6→import { QualityTier, SeverityLevel, MeasurementUnit } from '@/lib/faceiq-scoring';\n     7→\n     8→// ============================================\n     9→// ILLUSTRATION TYPES\n    10→// ============================================\n    11→\n    12→export interface IllustrationPoint {\n    13→  type: 'landmark' | 'calculated';\n    14→  landmarkId?: string;\n    15→  x?: number;\n    16→  y?: number;\n    17→  label?: string;\n    18→}\n    19→\n    20→export interface IllustrationLine {\n    21→  from: string;\n    22→  to: string;\n    23→  color: string;\n    24→  style?: 'solid' | 'dashed';\n    25→  label?: string;\n    26→  labelColor?: string;\n    27→  labelPosition?: 'start' | 'middle' | 'end';\n    28→}\n    29→\n    30→export interface RatioIllustration {\n    31→  points: Record<string, IllustrationPoint>;\n    32→  lines: Record<string, IllustrationLine>;\n    33→}\n    34→\n    35→// ============================================\n    36→// RATIO/MEASUREMENT TYPES\n    37→// ============================================\n    38→\n    39→export interface Ratio {\n    40→  id: string;\n    41→  name: string;\n    42→  value: number;\n    43→  score: number;  // 0-10 scale\n    44→  standardizedScore: number;\n    45→  unit: 'x' | 'mm' | '%' | '°';\n    46→  idealMin: number;\n    47→  idealMax: number;\n    48→  rangeMin: number;\n    49→  rangeMax: number;\n    50→  description: string;\n    51→  category: string;\n    52→  qualityLevel: QualityTier;\n    53→  severity: SeverityLevel;\n    54→  illustration: RatioIllustration;\n    55→  mayIndicateFlaws: string[];\n    56→  mayIndicateStrengths: string[];\n    57→  usedLandmarks: string[];\n    58→  scoringCurveConfig?: {\n    59→    decayRate: number;\n    60→    maxScore: number;\n    61→  };\n    62→}\n    63→\n    64→// ============================================\n    65→// STRENGTH/FLAW TYPES\n    66→// ============================================\n    67→\n    68→export interface ResponsibleRatio {\n    69→  ratioName: string;\n    70→  ratioId: string;\n    71→  score: number;\n    72→  value: number;\n    73→  isObfuscated?: boolean;\n    74→}\n    75→\n    76→export interface Strength {\n    77→  id: string;\n    78→  strengthName: string;\n    79→  summary: string;\n    80→  avgScore: number;\n    81→  qualityLevel: QualityTier;\n    82→  categoryName: string;\n    83→  responsibleRatios: ResponsibleRatio[];\n    84→}\n    85→\n    86→export interface Flaw {\n    87→  id: string;\n    88→  flawName: string;\n    89→  summary: string;\n    90→  harmonyPercentageLost: number;\n    91→  standardizedImpact: number;\n    92→  categoryName: string;\n    93→  isOther?: boolean;\n    94→  responsibleRatios: ResponsibleRatio[];\n    95→  rollingPointsDeducted?: number;\n    96→  rollingHarmonyPercentageLost?: number;\n    97→  rollingStandardizedImpact?: number;\n    98→}\n    99→\n   100→// ============================================\n   101→// RECOMMENDATION TYPES\n   102→// ============================================\n   103→\n   104→export type RecommendationPhase = 'Surgical' | 'Minimally Invasive' | 'Foundational';\n   105→\n   106→export interface RecommendationTimeline {\n   107→  effect_start: 'immediate' | 'delayed' | 'gradual';\n   108→  full_results_weeks: number;\n   109→  full_results_weeks_max?: number;\n   110→}\n   111→\n   112→export interface RecommendationCost {\n   113→  type: 'flat' | 'per_month' | 'per_session';\n   114→  min: number;\n   115→  max: number;\n   116→  currency: string;\n   117→}\n   118→\n   119→export interface RatioImpact {\n   120→  ratioId: string;\n   121→  ratioName: string;\n   122→  direction: 'increase' | 'decrease' | 'both';\n   123→  percentageEffect: number;\n   124→}\n   125→\n   126→export interface Recommendation {\n   127→  ref_id: string;\n   128→  name: string;\n   129→  description: string;\n   130→  phase: RecommendationPhase;\n   131→  impact: number;  // 0-1 effectiveness score\n   132→  coverage: number;  // Number of metrics improved\n   133→  percentage: string;  // e.g., \"10-20%\"\n   134→  expectedImprovementRange?: { min: number; max: number };\n   135→  matchedFlaws: string[];\n   136→  matchedRatios: string[];\n   137→  ratios_impacted: RatioImpact[];\n   138→  timeline: RecommendationTimeline;\n   139→  cost: RecommendationCost;\n   140→  risks_side_effects: string | null;\n   141→  warnings: string[];\n   142→  gender: 'male' | 'female' | 'both';\n   143→}\n   144→\n   145→// ============================================\n   146→// HARMONY ANALYSIS TYPES\n   147→// ============================================\n   148→\n   149→export interface ProfileAnalysis {\n   150→  standardizedScore: number;\n   151→  ratios: Ratio[];\n   152→  overallAIDescription?: string | null;\n   153→}\n   154→\n   155→export interface FullHarmonyAnalysis {\n   156→  standardizedScore: number;\n   157→  front: ProfileAnalysis;\n   158→  side: ProfileAnalysis;\n   159→  strengths: Strength[];\n   160→  flaws: Flaw[];\n   161→}\n   162→\n   163→// ============================================\n   164→// FACE DATA TYPES\n   165→// ============================================\n   166→\n   167→export interface FaceData {\n   168→  id: string;\n   169→  userId?: string;\n   170→  frontPhotoUrl: string;\n   171→  sidePhotoUrl?: string;\n   172→  harmonyScore: number | null;\n   173→  frontHarmonyScore: number | null;\n   174→  sideHarmonyScore: number | null;\n   175→  gender: 'male' | 'female';\n   176→  race?: string;\n   177→  unlocked: boolean;\n   178→  actionPlanUnlocked: boolean;\n   179→  harmonyAnalysis: FullHarmonyAnalysis;\n   180→}\n   181→\n   182→// ============================================\n   183→// UI STATE TYPES\n   184→// ============================================\n   185→\n   186→export type ResultsTab =\n   187→  | 'overview'\n   188→  | 'front-ratios'\n   189→  | 'side-ratios'\n   190→  | 'plan'\n   191→  | 'options'\n   192→  | 'support';\n   193→\n   194→export interface ResultsUIState {\n   195→  activeTab: ResultsTab;\n   196→  expandedMeasurementId: string | null;\n   197→  selectedVisualizationMetric: string | null;\n   198→  categoryFilter: string | null;\n   199→  showLandmarkOverlay: boolean;\n   200→}\n   201→\n   202→// ============================================\n   203→// CATEGORY TYPES\n   204→// ============================================\n   205→\n   206→export interface MeasurementCategory {\n   207→  id: string;\n   208→  name: string;\n   209→  color: string;\n   210→  description: string;\n   211→}\n   212→\n   213→export const MEASUREMENT_CATEGORIES: MeasurementCategory[] = [\n   214→  { id: 'midface', name: 'Midface/Face Shape', color: '#67e8f9', description: 'Facial proportions and overall shape' },\n   215→  { id: 'jaw-growth', name: 'Occlusion/Jaw Growth', color: '#a78bfa', description: 'Jaw development and bite alignment' },\n   216→  { id: 'jaw-shape', name: 'Jaw Shape', color: '#f97316', description: 'Jawline contour and angles' },\n   217→  { id: 'upper-third', name: 'Upper Third', color: '#84cc16', description: 'Forehead and hairline proportions' },\n   218→  { id: 'eyes', name: 'Eyes', color: '#06b6d4', description: 'Eye shape, spacing, and canthal tilt' },\n   219→  { id: 'nose', name: 'Nose', color: '#fbbf24', description: 'Nasal proportions and angles' },\n   220→  { id: 'lips', name: 'Lips', color: '#ec4899', description: 'Lip proportions and projection' },\n   221→  { id: 'chin', name: 'Chin', color: '#ef4444', description: 'Chin projection and shape' },\n   222→  { id: 'neck', name: 'Neck', color: '#14b8a6', description: 'Neck angle and throat definition' },\n   223→  { id: 'other', name: 'Other', color: '#6b7280', description: 'Additional measurements' },\n   224→];\n   225→\n   226→// ============================================\n   227→// SCORE COLOR HELPERS\n   228→// ============================================\n   229→\n   230→export function getScoreColor(score: number): string {\n   231→  if (score >= 8) return '#67e8f9';  // Cyan - ideal\n   232→  if (score >= 6) return '#22c55e';  // Green - good\n   233→  if (score >= 4) return '#fbbf24';  // Yellow - fair\n   234→  return 'rgb(227, 67, 67)';         // Red - poor\n   235→}\n   236→\n   237→export function getQualityColor(quality: QualityTier): string {\n   238→  switch (quality) {\n   239→    case 'ideal': return '#67e8f9';\n   240→    case 'excellent': return '#22c55e';\n   241→    case 'good': return '#fbbf24';\n   242→    case 'below_average': return 'rgb(227, 67, 67)';\n   243→    default: return '#6b7280';\n   244→  }\n   245→}\n   246→\n   247→export function getSeverityColor(severity: SeverityLevel): string {\n   248→  switch (severity) {\n   249→    case 'optimal': return '#67e8f9';\n   250→    case 'minor': return '#22c55e';\n   251→    case 'moderate': return '#fbbf24';\n   252→    case 'major': return '#f97316';\n   253→    case 'severe': return '#ef4444';\n   254→    case 'extremely_severe': return '#dc2626';\n   255→    default: return '#6b7280';\n   256→  }\n   257→}\n   258→\n   259→export function getCategoryColor(categoryName: string): string {\n   260→  const cat = MEASUREMENT_CATEGORIES.find(c =>\n   261→    c.name.toLowerCase().includes(categoryName.toLowerCase()) ||\n   262→    categoryName.toLowerCase().includes(c.name.toLowerCase())\n   263→  );\n   264→  return cat?.color || '#6b7280';\n   265→}\n   266→\n   267→// ============================================\n   268→// UNIT FORMATTING\n   269→// ============================================\n   270→\n   271→export function formatUnit(unit: 'x' | 'mm' | '%' | '°' | MeasurementUnit): string {\n   272→  switch (unit) {\n   273→    case 'x':\n   274→    case 'ratio': return 'x';\n   275→    case 'mm': return 'mm';\n   276→    case '%':\n   277→    case 'percent': return '%';\n   278→    case '°':\n   279→    case 'degrees': return '°';\n   280→    default: return '';\n   281→  }\n   282→}\n   283→\n   284→export function formatValue(value: number, unit: 'x' | 'mm' | '%' | '°' | MeasurementUnit): string {\n   285→  const unitStr = formatUnit(unit);\n   286→  if (unit === '%' || unit === 'percent') {\n   287→    return `${value.toFixed(1)}${unitStr}`;\n   288→  }\n   289→  if (unit === '°' || unit === 'degrees') {\n   290→    return `${value.toFixed(1)}${unitStr}`;\n   291→  }\n   292→  return `${value.toFixed(2)}${unitStr}`;\n   293→}\n   294→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"19069794-3bad-4225-a698-7a93674f6119","timestamp":"2025-12-20T20:51:03.792Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/types/results.ts","content":"/**\n * FaceIQ-Style Results Page Types\n * Complete type definitions for the results UI\n */\n\nimport { QualityTier, SeverityLevel, MeasurementUnit } from '@/lib/faceiq-scoring';\n\n// ============================================\n// ILLUSTRATION TYPES\n// ============================================\n\nexport interface IllustrationPoint {\n  type: 'landmark' | 'calculated';\n  landmarkId?: string;\n  x?: number;\n  y?: number;\n  label?: string;\n}\n\nexport interface IllustrationLine {\n  from: string;\n  to: string;\n  color: string;\n  style?: 'solid' | 'dashed';\n  label?: string;\n  labelColor?: string;\n  labelPosition?: 'start' | 'middle' | 'end';\n}\n\nexport interface RatioIllustration {\n  points: Record<string, IllustrationPoint>;\n  lines: Record<string, IllustrationLine>;\n}\n\n// ============================================\n// RATIO/MEASUREMENT TYPES\n// ============================================\n\nexport interface Ratio {\n  id: string;\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  unit: 'x' | 'mm' | '%' | '°';\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  description: string;\n  category: string;\n  qualityLevel: QualityTier;\n  severity: SeverityLevel;\n  illustration: RatioIllustration;\n  mayIndicateFlaws: string[];\n  mayIndicateStrengths: string[];\n  usedLandmarks: string[];\n  scoringCurveConfig?: {\n    decayRate: number;\n    maxScore: number;\n  };\n}\n\n// ============================================\n// STRENGTH/FLAW TYPES\n// ============================================\n\nexport interface ResponsibleRatio {\n  ratioName: string;\n  ratioId: string;\n  score: number;\n  value: number;\n  isObfuscated?: boolean;\n}\n\nexport interface Strength {\n  id: string;\n  strengthName: string;\n  summary: string;\n  avgScore: number;\n  qualityLevel: QualityTier;\n  categoryName: string;\n  responsibleRatios: ResponsibleRatio[];\n}\n\nexport interface Flaw {\n  id: string;\n  flawName: string;\n  summary: string;\n  harmonyPercentageLost: number;\n  standardizedImpact: number;\n  categoryName: string;\n  isOther?: boolean;\n  responsibleRatios: ResponsibleRatio[];\n  rollingPointsDeducted?: number;\n  rollingHarmonyPercentageLost?: number;\n  rollingStandardizedImpact?: number;\n}\n\n// ============================================\n// RECOMMENDATION TYPES\n// ============================================\n\nexport type RecommendationPhase = 'Surgical' | 'Minimally Invasive' | 'Foundational';\n\nexport interface RecommendationTimeline {\n  effect_start: 'immediate' | 'delayed' | 'gradual';\n  full_results_weeks: number;\n  full_results_weeks_max?: number;\n}\n\nexport interface RecommendationCost {\n  type: 'flat' | 'per_month' | 'per_session';\n  min: number;\n  max: number;\n  currency: string;\n}\n\nexport interface RatioImpact {\n  ratioId: string;\n  ratioName: string;\n  direction: 'increase' | 'decrease' | 'both';\n  percentageEffect: number;\n}\n\nexport interface Recommendation {\n  ref_id: string;\n  name: string;\n  description: string;\n  phase: RecommendationPhase;\n  impact: number;  // 0-1 effectiveness score\n  coverage: number;  // Number of metrics improved\n  percentage: string;  // e.g., \"10-20%\"\n  expectedImprovementRange?: { min: number; max: number };\n  matchedFlaws: string[];\n  matchedRatios: string[];\n  ratios_impacted: RatioImpact[];\n  timeline: RecommendationTimeline;\n  cost: RecommendationCost;\n  risks_side_effects: string | null;\n  warnings: string[];\n  gender: 'male' | 'female' | 'both';\n}\n\n// ============================================\n// HARMONY ANALYSIS TYPES\n// ============================================\n\nexport interface ProfileAnalysis {\n  standardizedScore: number;\n  ratios: Ratio[];\n  overallAIDescription?: string | null;\n}\n\nexport interface FullHarmonyAnalysis {\n  standardizedScore: number;\n  front: ProfileAnalysis;\n  side: ProfileAnalysis;\n  strengths: Strength[];\n  flaws: Flaw[];\n}\n\n// ============================================\n// FACE DATA TYPES\n// ============================================\n\nexport interface FaceData {\n  id: string;\n  userId?: string;\n  frontPhotoUrl: string;\n  sidePhotoUrl?: string;\n  harmonyScore: number | null;\n  frontHarmonyScore: number | null;\n  sideHarmonyScore: number | null;\n  gender: 'male' | 'female';\n  race?: string;\n  unlocked: boolean;\n  actionPlanUnlocked: boolean;\n  harmonyAnalysis: FullHarmonyAnalysis;\n}\n\n// ============================================\n// UI STATE TYPES\n// ============================================\n\nexport type ResultsTab =\n  | 'overview'\n  | 'front-ratios'\n  | 'side-ratios'\n  | 'plan'\n  | 'options'\n  | 'support';\n\nexport interface ResultsUIState {\n  activeTab: ResultsTab;\n  expandedMeasurementId: string | null;\n  selectedVisualizationMetric: string | null;\n  categoryFilter: string | null;\n  showLandmarkOverlay: boolean;\n}\n\n// ============================================\n// CATEGORY TYPES\n// ============================================\n\nexport interface MeasurementCategory {\n  id: string;\n  name: string;\n  color: string;\n  description: string;\n}\n\nexport const MEASUREMENT_CATEGORIES: MeasurementCategory[] = [\n  { id: 'midface', name: 'Midface/Face Shape', color: '#67e8f9', description: 'Facial proportions and overall shape' },\n  { id: 'jaw-growth', name: 'Occlusion/Jaw Growth', color: '#a78bfa', description: 'Jaw development and bite alignment' },\n  { id: 'jaw-shape', name: 'Jaw Shape', color: '#f97316', description: 'Jawline contour and angles' },\n  { id: 'upper-third', name: 'Upper Third', color: '#84cc16', description: 'Forehead and hairline proportions' },\n  { id: 'eyes', name: 'Eyes', color: '#06b6d4', description: 'Eye shape, spacing, and canthal tilt' },\n  { id: 'nose', name: 'Nose', color: '#fbbf24', description: 'Nasal proportions and angles' },\n  { id: 'lips', name: 'Lips', color: '#ec4899', description: 'Lip proportions and projection' },\n  { id: 'chin', name: 'Chin', color: '#ef4444', description: 'Chin projection and shape' },\n  { id: 'neck', name: 'Neck', color: '#14b8a6', description: 'Neck angle and throat definition' },\n  { id: 'other', name: 'Other', color: '#6b7280', description: 'Additional measurements' },\n];\n\n// ============================================\n// SCORE COLOR HELPERS\n// ============================================\n\nexport function getScoreColor(score: number): string {\n  if (score >= 8) return '#67e8f9';  // Cyan - ideal\n  if (score >= 6) return '#22c55e';  // Green - good\n  if (score >= 4) return '#fbbf24';  // Yellow - fair\n  return 'rgb(227, 67, 67)';         // Red - poor\n}\n\nexport function getQualityColor(quality: QualityTier): string {\n  switch (quality) {\n    case 'ideal': return '#67e8f9';\n    case 'excellent': return '#22c55e';\n    case 'good': return '#fbbf24';\n    case 'below_average': return 'rgb(227, 67, 67)';\n    default: return '#6b7280';\n  }\n}\n\nexport function getSeverityColor(severity: SeverityLevel): string {\n  switch (severity) {\n    case 'optimal': return '#67e8f9';\n    case 'minor': return '#22c55e';\n    case 'moderate': return '#fbbf24';\n    case 'major': return '#f97316';\n    case 'severe': return '#ef4444';\n    case 'extremely_severe': return '#dc2626';\n    default: return '#6b7280';\n  }\n}\n\nexport function getCategoryColor(categoryName: string): string {\n  const cat = MEASUREMENT_CATEGORIES.find(c =>\n    c.name.toLowerCase().includes(categoryName.toLowerCase()) ||\n    categoryName.toLowerCase().includes(c.name.toLowerCase())\n  );\n  return cat?.color || '#6b7280';\n}\n\n// ============================================\n// UNIT FORMATTING\n// ============================================\n\nexport function formatUnit(unit: 'x' | 'mm' | '%' | '°' | MeasurementUnit): string {\n  switch (unit) {\n    case 'x':\n    case 'ratio': return 'x';\n    case 'mm': return 'mm';\n    case '%':\n    case 'percent': return '%';\n    case '°':\n    case 'degrees': return '°';\n    default: return '';\n  }\n}\n\nexport function formatValue(value: number, unit: 'x' | 'mm' | '%' | '°' | MeasurementUnit): string {\n  const unitStr = formatUnit(unit);\n  if (unit === '%' || unit === 'percent') {\n    return `${value.toFixed(1)}${unitStr}`;\n  }\n  if (unit === '°' || unit === 'degrees') {\n    return `${value.toFixed(1)}${unitStr}`;\n  }\n  return `${value.toFixed(2)}${unitStr}`;\n}\n","numLines":294,"startLine":1,"totalLines":294}}}
{"parentUuid":"19069794-3bad-4225-a698-7a93674f6119","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GZfZo71hMCguy1EWGHMUxQ","type":"tool_result","content":"     1→/**\n     2→ * Severity Classification System\n     3→ * Classifies metric deviations into severity levels with treatment recommendations\n     4→ */\n     5→\n     6→import { Severity, SeverityResult, SeverityThreshold, MetricIssueMapping, Gender } from './types';\n     7→\n     8→// ============================================\n     9→// SEVERITY THRESHOLDS BY METRIC\n    10→// ============================================\n    11→\n    12→export const SEVERITY_THRESHOLDS: SeverityThreshold[] = [\n    13→  // FRONT PROFILE METRICS\n    14→  {\n    15→    metric: 'fwhr',\n    16→    optimal: { min: 1.80, max: 2.00 },\n    17→    mild: { min: 1.65, max: 2.15 },\n    18→    moderate: { min: 1.55, max: 2.25 },\n    19→    severe: { min: 0, max: Infinity },\n    20→    unit: 'ratio',\n    21→    higherIsBetter: false, // mid-range is ideal\n    22→  },\n    23→  {\n    24→    metric: 'canthalTilt',\n    25→    optimal: { min: 4, max: 8 },\n    26→    mild: { min: 0, max: 10 },\n    27→    moderate: { min: -2, max: 12 },\n    28→    severe: { min: -Infinity, max: Infinity },\n    29→    unit: 'degrees',\n    30→    higherIsBetter: true,\n    31→  },\n    32→  {\n    33→    metric: 'facialThirdsUpper',\n    34→    optimal: { min: 30, max: 36 },\n    35→    mild: { min: 27, max: 39 },\n    36→    moderate: { min: 24, max: 42 },\n    37→    severe: { min: 0, max: Infinity },\n    38→    unit: 'percent',\n    39→  },\n    40→  {\n    41→    metric: 'facialThirdsMiddle',\n    42→    optimal: { min: 30, max: 36 },\n    43→    mild: { min: 27, max: 39 },\n    44→    moderate: { min: 24, max: 42 },\n    45→    severe: { min: 0, max: Infinity },\n    46→    unit: 'percent',\n    47→  },\n    48→  {\n    49→    metric: 'facialThirdsLower',\n    50→    optimal: { min: 30, max: 36 },\n    51→    mild: { min: 27, max: 39 },\n    52→    moderate: { min: 24, max: 42 },\n    53→    severe: { min: 0, max: Infinity },\n    54→    unit: 'percent',\n    55→  },\n    56→  {\n    57→    metric: 'nasalIndex',\n    58→    optimal: { min: 70, max: 85 },\n    59→    mild: { min: 65, max: 90 },\n    60→    moderate: { min: 60, max: 95 },\n    61→    severe: { min: 0, max: Infinity },\n    62→    unit: 'ratio',\n    63→  },\n    64→  {\n    65→    metric: 'interpupillaryDistance',\n    66→    optimal: { min: 44, max: 48 },\n    67→    mild: { min: 42, max: 50 },\n    68→    moderate: { min: 40, max: 52 },\n    69→    severe: { min: 0, max: Infinity },\n    70→    unit: 'percent',\n    71→  },\n    72→  {\n    73→    metric: 'mouthWidth',\n    74→    optimal: { min: 48, max: 54 },\n    75→    mild: { min: 44, max: 58 },\n    76→    moderate: { min: 40, max: 62 },\n    77→    severe: { min: 0, max: Infinity },\n    78→    unit: 'percent',\n    79→  },\n    80→  {\n    81→    metric: 'lipRatio',\n    82→    optimal: { min: 1.5, max: 2.0 },\n    83→    mild: { min: 1.2, max: 2.3 },\n    84→    moderate: { min: 1.0, max: 2.6 },\n    85→    severe: { min: 0, max: Infinity },\n    86→    unit: 'ratio',\n    87→  },\n    88→  {\n    89→    metric: 'jawWidthRatio',\n    90→    optimal: { min: 0.75, max: 0.80 },\n    91→    mild: { min: 0.72, max: 0.83 },\n    92→    moderate: { min: 0.68, max: 0.87 },\n    93→    severe: { min: 0, max: Infinity },\n    94→    unit: 'ratio',\n    95→  },\n    96→  {\n    97→    metric: 'facialSymmetry',\n    98→    optimal: { min: 95, max: 100 },\n    99→    mild: { min: 90, max: 100 },\n   100→    moderate: { min: 85, max: 100 },\n   101→    severe: { min: 0, max: 100 },\n   102→    unit: 'percent',\n   103→    higherIsBetter: true,\n   104→  },\n   105→  {\n   106→    metric: 'eyeSpacing',\n   107→    optimal: { min: 0.95, max: 1.05 },\n   108→    mild: { min: 0.90, max: 1.10 },\n   109→    moderate: { min: 0.85, max: 1.15 },\n   110→    severe: { min: 0, max: Infinity },\n   111→    unit: 'ratio',\n   112→  },\n   113→  {\n   114→    metric: 'noseWidth',\n   115→    optimal: { min: 0.95, max: 1.05 },\n   116→    mild: { min: 0.90, max: 1.10 },\n   117→    moderate: { min: 0.85, max: 1.15 },\n   118→    severe: { min: 0, max: Infinity },\n   119→    unit: 'ratio',\n   120→  },\n   121→  {\n   122→    metric: 'cheekboneWidth',\n   123→    optimal: { min: 0.85, max: 0.92 },\n   124→    mild: { min: 0.80, max: 0.97 },\n   125→    moderate: { min: 0.75, max: 1.02 },\n   126→    severe: { min: 0, max: Infinity },\n   127→    unit: 'ratio',\n   128→  },\n   129→\n   130→  // SIDE PROFILE METRICS\n   131→  {\n   132→    metric: 'gonialAngle',\n   133→    optimal: { min: 120, max: 130 },\n   134→    mild: { min: 115, max: 135 },\n   135→    moderate: { min: 110, max: 140 },\n   136→    severe: { min: 0, max: Infinity },\n   137→    unit: 'degrees',\n   138→  },\n   139→  {\n   140→    metric: 'nasolabialAngle',\n   141→    optimal: { min: 95, max: 110 }, // Gender-adjusted in functions\n   142→    mild: { min: 85, max: 115 },\n   143→    moderate: { min: 80, max: 120 },\n   144→    severe: { min: 0, max: Infinity },\n   145→    unit: 'degrees',\n   146→  },\n   147→  {\n   148→    metric: 'nasofrontalAngle',\n   149→    optimal: { min: 130, max: 140 },\n   150→    mild: { min: 125, max: 145 },\n   151→    moderate: { min: 120, max: 150 },\n   152→    severe: { min: 0, max: Infinity },\n   153→    unit: 'degrees',\n   154→  },\n   155→  {\n   156→    metric: 'chinProjection',\n   157→    optimal: { min: -4, max: 2 },\n   158→    mild: { min: -6, max: 4 },\n   159→    moderate: { min: -8, max: 6 },\n   160→    severe: { min: -Infinity, max: Infinity },\n   161→    unit: 'mm',\n   162→  },\n   163→  {\n   164→    metric: 'mentoLabialAngle',\n   165→    optimal: { min: 110, max: 130 },\n   166→    mild: { min: 100, max: 140 },\n   167→    moderate: { min: 90, max: 150 },\n   168→    severe: { min: 0, max: Infinity },\n   169→    unit: 'degrees',\n   170→  },\n   171→  {\n   172→    metric: 'facialConvexity',\n   173→    optimal: { min: 165, max: 175 },\n   174→    mild: { min: 160, max: 180 },\n   175→    moderate: { min: 155, max: 185 },\n   176→    severe: { min: 0, max: Infinity },\n   177→    unit: 'degrees',\n   178→  },\n   179→  {\n   180→    metric: 'eLineUpperLip',\n   181→    optimal: { min: -4, max: -1 },\n   182→    mild: { min: -6, max: 1 },\n   183→    moderate: { min: -8, max: 3 },\n   184→    severe: { min: -Infinity, max: Infinity },\n   185→    unit: 'mm',\n   186→  },\n   187→  {\n   188→    metric: 'eLineLowerLip',\n   189→    optimal: { min: -2, max: 1 },\n   190→    mild: { min: -4, max: 3 },\n   191→    moderate: { min: -6, max: 5 },\n   192→    severe: { min: -Infinity, max: Infinity },\n   193→    unit: 'mm',\n   194→  },\n   195→  {\n   196→    metric: 'submCervicalAngle',\n   197→    optimal: { min: 100, max: 120 },\n   198→    mild: { min: 90, max: 130 },\n   199→    moderate: { min: 80, max: 140 },\n   200→    severe: { min: 0, max: Infinity },\n   201→    unit: 'degrees',\n   202→  },\n   203→  {\n   204→    metric: 'totalFacialConvexity',\n   205→    optimal: { min: 135, max: 145 },\n   206→    mild: { min: 130, max: 150 },\n   207→    moderate: { min: 125, max: 155 },\n   208→    severe: { min: 0, max: Infinity },\n   209→    unit: 'degrees',\n   210→  },\n   211→];\n   212→\n   213→// ============================================\n   214→// METRIC TO ISSUE MAPPINGS\n   215→// ============================================\n   216→\n   217→export const METRIC_ISSUE_MAPPINGS: MetricIssueMapping[] = [\n   218→  // Front Profile\n   219→  {\n   220→    metric: 'fwhr',\n   221→    lowIssue: 'narrow_face',\n   222→    highIssue: 'wide_face',\n   223→    lowTreatments: ['cheek_filler', 'cheek_implants', 'jaw_implants'],\n   224→    highTreatments: ['botox_masseter', 'buccal_fat_removal', 'zygoma_reduction', 'mandible_reduction'],\n   225→  },\n   226→  {\n   227→    metric: 'canthalTilt',\n   228→    lowIssue: 'negative_canthal_tilt',\n   229→    highIssue: 'excessive_positive_tilt',\n   230→    lowTreatments: ['canthoplasty', 'pdo_threads', 'botox_brow_lift'],\n   231→    highTreatments: [], // Rarely treated\n   232→  },\n   233→  {\n   234→    metric: 'nasalIndex',\n   235→    lowIssue: 'narrow_nose',\n   236→    highIssue: 'wide_nose',\n   237→    lowTreatments: ['nose_filler'],\n   238→    highTreatments: ['rhinoplasty_reduction', 'nose_filler'],\n   239→  },\n   240→  {\n   241→    metric: 'lipRatio',\n   242→    lowIssue: 'thin_lower_lip',\n   243→    highIssue: 'thin_upper_lip',\n   244→    lowTreatments: ['lip_filler'],\n   245→    highTreatments: ['lip_filler', 'lip_lift'],\n   246→  },\n   247→  {\n   248→    metric: 'jawWidthRatio',\n   249→    lowIssue: 'narrow_jaw',\n   250→    highIssue: 'wide_jaw',\n   251→    lowTreatments: ['jaw_implants', 'jawline_filler'],\n   252→    highTreatments: ['botox_masseter', 'mandible_reduction'],\n   253→  },\n   254→  {\n   255→    metric: 'facialSymmetry',\n   256→    lowIssue: 'facial_asymmetry',\n   257→    highIssue: 'optimal',\n   258→    lowTreatments: ['filler_correction', 'botox_asymmetry', 'bimax'],\n   259→    highTreatments: [],\n   260→  },\n   261→  {\n   262→    metric: 'cheekboneWidth',\n   263→    lowIssue: 'flat_cheeks',\n   264→    highIssue: 'wide_cheekbones',\n   265→    lowTreatments: ['cheek_filler', 'cheek_implants'],\n   266→    highTreatments: ['zygoma_reduction'],\n   267→  },\n   268→\n   269→  // Side Profile\n   270→  {\n   271→    metric: 'gonialAngle',\n   272→    lowIssue: 'over_prominent_jaw',\n   273→    highIssue: 'weak_jaw',\n   274→    lowTreatments: ['mandible_reduction'],\n   275→    highTreatments: ['jaw_implants', 'jawline_filler', 'bsso'],\n   276→  },\n   277→  {\n   278→    metric: 'nasolabialAngle',\n   279→    lowIssue: 'droopy_nose_tip',\n   280→    highIssue: 'over_rotated_tip',\n   281→    lowTreatments: ['rhinoplasty_tip', 'nose_filler'],\n   282→    highTreatments: ['rhinoplasty_tip', 'rhinoplasty_reduction'],\n   283→  },\n   284→  {\n   285→    metric: 'chinProjection',\n   286→    lowIssue: 'recessed_chin',\n   287→    highIssue: 'prominent_chin',\n   288→    lowTreatments: ['genioplasty', 'chin_implant', 'chin_filler'],\n   289→    highTreatments: ['genioplasty'],\n   290→  },\n   291→  {\n   292→    metric: 'eLineUpperLip',\n   293→    lowIssue: 'lips_retrude',\n   294→    highIssue: 'lips_protrude',\n   295→    lowTreatments: ['lip_filler', 'bimax'],\n   296→    highTreatments: ['bimax', 'lip_reduction'],\n   297→  },\n   298→  {\n   299→    metric: 'eLineLowerLip',\n   300→    lowIssue: 'lips_retrude',\n   301→    highIssue: 'lips_protrude',\n   302→    lowTreatments: ['lip_filler', 'bimax'],\n   303→    highTreatments: ['bimax', 'lip_reduction'],\n   304→  },\n   305→  {\n   306→    metric: 'facialConvexity',\n   307→    lowIssue: 'concave_profile',\n   308→    highIssue: 'convex_profile',\n   309→    lowTreatments: ['bimax', 'chin_filler', 'lefort_1'],\n   310→    highTreatments: ['bimax', 'rhinoplasty_reduction'],\n   311→  },\n   312→  {\n   313→    metric: 'mentoLabialAngle',\n   314→    lowIssue: 'deep_mentolabial_fold',\n   315→    highIssue: 'flat_mentolabial_fold',\n   316→    lowTreatments: ['chin_filler', 'genioplasty'],\n   317→    highTreatments: [],\n   318→  },\n   319→  {\n   320→    metric: 'submCervicalAngle',\n   321→    lowIssue: 'undefined_neck_jaw',\n   322→    highIssue: 'excessive_neck_angle',\n   323→    lowTreatments: ['kybella', 'posture_correction', 'leanmaxxing'],\n   324→    highTreatments: [],\n   325→  },\n   326→];\n   327→\n   328→// ============================================\n   329→// SEVERITY CLASSIFICATION FUNCTIONS\n   330→// ============================================\n   331→\n   332→/**\n   333→ * Classify a score into a severity level\n   334→ */\n   335→export function classifyByScore(score: number): SeverityResult {\n   336→  if (score >= 85) {\n   337→    return {\n   338→      severity: 'optimal',\n   339→      label: 'Optimal',\n   340→      color: '#22c55e',\n   341→      icon: '✓',\n   342→      description: 'Excellent - within ideal range',\n   343→    };\n   344→  }\n   345→  if (score >= 70) {\n   346→    return {\n   347→      severity: 'mild',\n   348→      label: 'Good',\n   349→      color: '#84cc16',\n   350→      icon: '○',\n   351→      description: 'Good - minor deviation from ideal',\n   352→    };\n   353→  }\n   354→  if (score >= 50) {\n   355→    return {\n   356→      severity: 'moderate',\n   357→      label: 'Average',\n   358→      color: '#f59e0b',\n   359→      icon: '△',\n   360→      description: 'Average - noticeable deviation',\n   361→    };\n   362→  }\n   363→  return {\n   364→    severity: 'severe',\n   365→    label: 'Below Average',\n   366→    color: '#ef4444',\n   367→    icon: '✗',\n   368→    description: 'Below average - significant deviation',\n   369→  };\n   370→}\n   371→\n   372→/**\n   373→ * Get severity threshold for a specific metric\n   374→ */\n   375→export function getSeverityThreshold(metric: string): SeverityThreshold | undefined {\n   376→  return SEVERITY_THRESHOLDS.find(t => t.metric === metric);\n   377→}\n   378→\n   379→/**\n   380→ * Classify a metric value based on its specific thresholds\n   381→ */\n   382→export function classifyMetricValue(\n   383→  metric: string,\n   384→  value: number,\n   385→  gender?: Gender\n   386→): SeverityResult {\n   387→  const threshold = getSeverityThreshold(metric);\n   388→\n   389→  if (!threshold) {\n   390→    // Fallback to score-based classification if no threshold defined\n   391→    return classifyByScore(value);\n   392→  }\n   393→\n   394→  // Apply gender-specific adjustments\n   395→  const adjustedThreshold = { ...threshold };\n   396→  if (gender && metric === 'nasolabialAngle') {\n   397→    if (gender === 'male') {\n   398→      adjustedThreshold.optimal = { min: 90, max: 105 };\n   399→    } else {\n   400→      adjustedThreshold.optimal = { min: 100, max: 115 };\n   401→    }\n   402→  }\n   403→\n   404→  // Check which range the value falls into\n   405→  if (value >= adjustedThreshold.optimal.min && value <= adjustedThreshold.optimal.max) {\n   406→    return {\n   407→      severity: 'optimal',\n   408→      label: 'Optimal',\n   409→      color: '#22c55e',\n   410→      icon: '✓',\n   411→      description: `Within ideal range (${adjustedThreshold.optimal.min}-${adjustedThreshold.optimal.max}${adjustedThreshold.unit})`,\n   412→    };\n   413→  }\n   414→\n   415→  if (value >= adjustedThreshold.mild.min && value <= adjustedThreshold.mild.max) {\n   416→    return {\n   417→      severity: 'mild',\n   418→      label: 'Good',\n   419→      color: '#84cc16',\n   420→      icon: '○',\n   421→      description: 'Minor deviation from ideal',\n   422→    };\n   423→  }\n   424→\n   425→  if (value >= adjustedThreshold.moderate.min && value <= adjustedThreshold.moderate.max) {\n   426→    return {\n   427→      severity: 'moderate',\n   428→      label: 'Average',\n   429→      color: '#f59e0b',\n   430→      icon: '△',\n   431→      description: 'Noticeable deviation from ideal',\n   432→    };\n   433→  }\n   434→\n   435→  return {\n   436→    severity: 'severe',\n   437→    label: 'Below Average',\n   438→    color: '#ef4444',\n   439→    icon: '✗',\n   440→    description: 'Significant deviation from ideal',\n   441→  };\n   442→}\n   443→\n   444→/**\n   445→ * Calculate deviation from ideal for a metric\n   446→ */\n   447→export function calculateDeviation(\n   448→  metric: string,\n   449→  value: number\n   450→): { deviation: number; deviationPercent: number; direction: 'low' | 'high' | 'optimal' } {\n   451→  const threshold = getSeverityThreshold(metric);\n   452→\n   453→  if (!threshold) {\n   454→    return { deviation: 0, deviationPercent: 0, direction: 'optimal' };\n   455→  }\n   456→\n   457→  const idealMidpoint = (threshold.optimal.min + threshold.optimal.max) / 2;\n   458→  const deviation = value - idealMidpoint;\n   459→  const idealRange = threshold.optimal.max - threshold.optimal.min;\n   460→  const deviationPercent = (Math.abs(deviation) / idealRange) * 100;\n   461→\n   462→  let direction: 'low' | 'high' | 'optimal';\n   463→  if (value >= threshold.optimal.min && value <= threshold.optimal.max) {\n   464→    direction = 'optimal';\n   465→  } else if (value < threshold.optimal.min) {\n   466→    direction = 'low';\n   467→  } else {\n   468→    direction = 'high';\n   469→  }\n   470→\n   471→  return { deviation, deviationPercent, direction };\n   472→}\n   473→\n   474→/**\n   475→ * Get the issue name for a metric deviation\n   476→ */\n   477→export function getIssueForMetric(\n   478→  metric: string,\n   479→  direction: 'low' | 'high' | 'optimal'\n   480→): string | null {\n   481→  if (direction === 'optimal') return null;\n   482→\n   483→  const mapping = METRIC_ISSUE_MAPPINGS.find(m => m.metric === metric);\n   484→  if (!mapping) return null;\n   485→\n   486→  return direction === 'low' ? mapping.lowIssue : mapping.highIssue;\n   487→}\n   488→\n   489→/**\n   490→ * Get treatment IDs for a metric deviation\n   491→ */\n   492→export function getTreatmentIdsForMetric(\n   493→  metric: string,\n   494→  direction: 'low' | 'high' | 'optimal'\n   495→): string[] {\n   496→  if (direction === 'optimal') return [];\n   497→\n   498→  const mapping = METRIC_ISSUE_MAPPINGS.find(m => m.metric === metric);\n   499→  if (!mapping) return [];\n   500→\n   501→  return direction === 'low' ? mapping.lowTreatments : mapping.highTreatments;\n   502→}\n   503→\n   504→/**\n   505→ * Get overall severity from multiple metric analyses\n   506→ */\n   507→export function getOverallSeverity(severities: Severity[]): SeverityResult {\n   508→  const severeCount = severities.filter(s => s === 'severe').length;\n   509→  const moderateCount = severities.filter(s => s === 'moderate').length;\n   510→  const mildCount = severities.filter(s => s === 'mild').length;\n   511→\n   512→  // Weighted scoring\n   513→  const score = (\n   514→    (severities.filter(s => s === 'optimal').length * 100) +\n   515→    (mildCount * 75) +\n   516→    (moderateCount * 50) +\n   517→    (severeCount * 25)\n   518→  ) / severities.length;\n   519→\n   520→  return classifyByScore(score);\n   521→}\n   522→\n   523→/**\n   524→ * Prioritize metrics by severity and impact\n   525→ */\n   526→export function prioritizeMetrics(\n   527→  metricSeverities: Array<{ metric: string; severity: Severity; impact: number }>\n   528→): Array<{ metric: string; severity: Severity; priority: 'high' | 'medium' | 'low' }> {\n   529→  const severityWeight: Record<Severity, number> = {\n   530→    severe: 4,\n   531→    moderate: 3,\n   532→    mild: 2,\n   533→    optimal: 1,\n   534→  };\n   535→\n   536→  return metricSeverities\n   537→    .map(m => ({\n   538→      ...m,\n   539→      score: severityWeight[m.severity] * m.impact,\n   540→    }))\n   541→    .sort((a, b) => b.score - a.score)\n   542→    .map((m, index) => ({\n   543→      metric: m.metric,\n   544→      severity: m.severity,\n   545→      priority: index < 3 ? 'high' as const :\n   546→                index < 7 ? 'medium' as const :\n   547→                'low' as const,\n   548→    }));\n   549→}\n   550→\n   551→// ============================================\n   552→// PSL RATING CONVERSION\n   553→// ============================================\n   554→\n   555→/**\n   556→ * Convert harmony score to PSL rating\n   557→ */\n   558→export function harmonyToPSL(harmonyPercent: number): {\n   559→  psl: number;\n   560→  tier: string;\n   561→  percentile: number;\n   562→  description: string;\n   563→} {\n   564→  // Based on FaceIQ formula: Harmony % = ((Score - Min) / (Max - Min)) * 100\n   565→  // Where Max = 333.71, Min = -337.71\n   566→\n   567→  // Convert harmony percent to approximate PSL\n   568→  // Harmony 0% = PSL 3.0, Harmony 100% = PSL 7.5\n   569→  const psl = 3.0 + (harmonyPercent / 100) * 4.5;\n   570→  const clampedPSL = Math.max(3.0, Math.min(7.5, psl));\n   571→\n   572→  // Determine tier\n   573→  let tier: string;\n   574→  let percentile: number;\n   575→  let description: string;\n   576→\n   577→  if (clampedPSL >= 7.5) {\n   578→    tier = 'Top Model';\n   579→    percentile = 99.99;\n   580→    description = 'Near perfection - world-class genetics';\n   581→  } else if (clampedPSL >= 7.0) {\n   582→    tier = 'Chad';\n   583→    percentile = 99.87;\n   584→    description = 'Exceptional - top 0.1%';\n   585→  } else if (clampedPSL >= 6.5) {\n   586→    tier = 'Chadlite';\n   587→    percentile = 99.0;\n   588→    description = 'Very attractive - top 1%';\n   589→  } else if (clampedPSL >= 6.0) {\n   590→    tier = 'High Tier Normie+';\n   591→    percentile = 97.25;\n   592→    description = 'Notably attractive - top 3%';\n   593→  } else if (clampedPSL >= 5.5) {\n   594→    tier = 'High Tier Normie';\n   595→    percentile = 90.0;\n   596→    description = 'Above average - top 10%';\n   597→  } else if (clampedPSL >= 5.0) {\n   598→    tier = 'Mid Tier Normie+';\n   599→    percentile = 84.15;\n   600→    description = 'Slightly above average';\n   601→  } else if (clampedPSL >= 4.5) {\n   602→    tier = 'Mid Tier Normie';\n   603→    percentile = 65.0;\n   604→    description = 'Average';\n   605→  } else if (clampedPSL >= 4.0) {\n   606→    tier = 'Low Tier Normie';\n   607→    percentile = 50.0;\n   608→    description = 'Median';\n   609→  } else if (clampedPSL >= 3.5) {\n   610→    tier = 'Below Average';\n   611→    percentile = 30.0;\n   612→    description = 'Below average';\n   613→  } else {\n   614→    tier = 'Subpar';\n   615→    percentile = 15.0;\n   616→    description = 'Noticeably below average';\n   617→  }\n   618→\n   619→  return {\n   620→    psl: Math.round(clampedPSL * 10) / 10,\n   621→    tier,\n   622→    percentile,\n   623→    description,\n   624→  };\n   625→}\n   626→\n   627→/**\n   628→ * Estimate potential PSL improvement from treatments\n   629→ */\n   630→export function estimatePotentialPSL(\n   631→  currentPSL: number,\n   632→  treatmentImprovements: number[]\n   633→): { potentialPSL: number; totalImprovement: number } {\n   634→  // Sum improvements with diminishing returns\n   635→  const sortedImprovements = treatmentImprovements.sort((a, b) => b - a);\n   636→\n   637→  let totalImprovement = 0;\n   638→  sortedImprovements.forEach((improvement, index) => {\n   639→    // Each subsequent improvement is reduced by 20%\n   640→    const diminishingFactor = Math.pow(0.8, index);\n   641→    totalImprovement += improvement * diminishingFactor;\n   642→  });\n   643→\n   644→  // Cap total improvement at realistic level\n   645→  const cappedImprovement = Math.min(totalImprovement, 2.5);\n   646→  const potentialPSL = Math.min(7.5, currentPSL + cappedImprovement);\n   647→\n   648→  return {\n   649→    potentialPSL: Math.round(potentialPSL * 10) / 10,\n   650→    totalImprovement: Math.round(cappedImprovement * 10) / 10,\n   651→  };\n   652→}\n   653→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"12fe32bf-ec6c-42c0-af2a-672070311d83","timestamp":"2025-12-20T20:51:03.792Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/severity.ts","content":"/**\n * Severity Classification System\n * Classifies metric deviations into severity levels with treatment recommendations\n */\n\nimport { Severity, SeverityResult, SeverityThreshold, MetricIssueMapping, Gender } from './types';\n\n// ============================================\n// SEVERITY THRESHOLDS BY METRIC\n// ============================================\n\nexport const SEVERITY_THRESHOLDS: SeverityThreshold[] = [\n  // FRONT PROFILE METRICS\n  {\n    metric: 'fwhr',\n    optimal: { min: 1.80, max: 2.00 },\n    mild: { min: 1.65, max: 2.15 },\n    moderate: { min: 1.55, max: 2.25 },\n    severe: { min: 0, max: Infinity },\n    unit: 'ratio',\n    higherIsBetter: false, // mid-range is ideal\n  },\n  {\n    metric: 'canthalTilt',\n    optimal: { min: 4, max: 8 },\n    mild: { min: 0, max: 10 },\n    moderate: { min: -2, max: 12 },\n    severe: { min: -Infinity, max: Infinity },\n    unit: 'degrees',\n    higherIsBetter: true,\n  },\n  {\n    metric: 'facialThirdsUpper',\n    optimal: { min: 30, max: 36 },\n    mild: { min: 27, max: 39 },\n    moderate: { min: 24, max: 42 },\n    severe: { min: 0, max: Infinity },\n    unit: 'percent',\n  },\n  {\n    metric: 'facialThirdsMiddle',\n    optimal: { min: 30, max: 36 },\n    mild: { min: 27, max: 39 },\n    moderate: { min: 24, max: 42 },\n    severe: { min: 0, max: Infinity },\n    unit: 'percent',\n  },\n  {\n    metric: 'facialThirdsLower',\n    optimal: { min: 30, max: 36 },\n    mild: { min: 27, max: 39 },\n    moderate: { min: 24, max: 42 },\n    severe: { min: 0, max: Infinity },\n    unit: 'percent',\n  },\n  {\n    metric: 'nasalIndex',\n    optimal: { min: 70, max: 85 },\n    mild: { min: 65, max: 90 },\n    moderate: { min: 60, max: 95 },\n    severe: { min: 0, max: Infinity },\n    unit: 'ratio',\n  },\n  {\n    metric: 'interpupillaryDistance',\n    optimal: { min: 44, max: 48 },\n    mild: { min: 42, max: 50 },\n    moderate: { min: 40, max: 52 },\n    severe: { min: 0, max: Infinity },\n    unit: 'percent',\n  },\n  {\n    metric: 'mouthWidth',\n    optimal: { min: 48, max: 54 },\n    mild: { min: 44, max: 58 },\n    moderate: { min: 40, max: 62 },\n    severe: { min: 0, max: Infinity },\n    unit: 'percent',\n  },\n  {\n    metric: 'lipRatio',\n    optimal: { min: 1.5, max: 2.0 },\n    mild: { min: 1.2, max: 2.3 },\n    moderate: { min: 1.0, max: 2.6 },\n    severe: { min: 0, max: Infinity },\n    unit: 'ratio',\n  },\n  {\n    metric: 'jawWidthRatio',\n    optimal: { min: 0.75, max: 0.80 },\n    mild: { min: 0.72, max: 0.83 },\n    moderate: { min: 0.68, max: 0.87 },\n    severe: { min: 0, max: Infinity },\n    unit: 'ratio',\n  },\n  {\n    metric: 'facialSymmetry',\n    optimal: { min: 95, max: 100 },\n    mild: { min: 90, max: 100 },\n    moderate: { min: 85, max: 100 },\n    severe: { min: 0, max: 100 },\n    unit: 'percent',\n    higherIsBetter: true,\n  },\n  {\n    metric: 'eyeSpacing',\n    optimal: { min: 0.95, max: 1.05 },\n    mild: { min: 0.90, max: 1.10 },\n    moderate: { min: 0.85, max: 1.15 },\n    severe: { min: 0, max: Infinity },\n    unit: 'ratio',\n  },\n  {\n    metric: 'noseWidth',\n    optimal: { min: 0.95, max: 1.05 },\n    mild: { min: 0.90, max: 1.10 },\n    moderate: { min: 0.85, max: 1.15 },\n    severe: { min: 0, max: Infinity },\n    unit: 'ratio',\n  },\n  {\n    metric: 'cheekboneWidth',\n    optimal: { min: 0.85, max: 0.92 },\n    mild: { min: 0.80, max: 0.97 },\n    moderate: { min: 0.75, max: 1.02 },\n    severe: { min: 0, max: Infinity },\n    unit: 'ratio',\n  },\n\n  // SIDE PROFILE METRICS\n  {\n    metric: 'gonialAngle',\n    optimal: { min: 120, max: 130 },\n    mild: { min: 115, max: 135 },\n    moderate: { min: 110, max: 140 },\n    severe: { min: 0, max: Infinity },\n    unit: 'degrees',\n  },\n  {\n    metric: 'nasolabialAngle',\n    optimal: { min: 95, max: 110 }, // Gender-adjusted in functions\n    mild: { min: 85, max: 115 },\n    moderate: { min: 80, max: 120 },\n    severe: { min: 0, max: Infinity },\n    unit: 'degrees',\n  },\n  {\n    metric: 'nasofrontalAngle',\n    optimal: { min: 130, max: 140 },\n    mild: { min: 125, max: 145 },\n    moderate: { min: 120, max: 150 },\n    severe: { min: 0, max: Infinity },\n    unit: 'degrees',\n  },\n  {\n    metric: 'chinProjection',\n    optimal: { min: -4, max: 2 },\n    mild: { min: -6, max: 4 },\n    moderate: { min: -8, max: 6 },\n    severe: { min: -Infinity, max: Infinity },\n    unit: 'mm',\n  },\n  {\n    metric: 'mentoLabialAngle',\n    optimal: { min: 110, max: 130 },\n    mild: { min: 100, max: 140 },\n    moderate: { min: 90, max: 150 },\n    severe: { min: 0, max: Infinity },\n    unit: 'degrees',\n  },\n  {\n    metric: 'facialConvexity',\n    optimal: { min: 165, max: 175 },\n    mild: { min: 160, max: 180 },\n    moderate: { min: 155, max: 185 },\n    severe: { min: 0, max: Infinity },\n    unit: 'degrees',\n  },\n  {\n    metric: 'eLineUpperLip',\n    optimal: { min: -4, max: -1 },\n    mild: { min: -6, max: 1 },\n    moderate: { min: -8, max: 3 },\n    severe: { min: -Infinity, max: Infinity },\n    unit: 'mm',\n  },\n  {\n    metric: 'eLineLowerLip',\n    optimal: { min: -2, max: 1 },\n    mild: { min: -4, max: 3 },\n    moderate: { min: -6, max: 5 },\n    severe: { min: -Infinity, max: Infinity },\n    unit: 'mm',\n  },\n  {\n    metric: 'submCervicalAngle',\n    optimal: { min: 100, max: 120 },\n    mild: { min: 90, max: 130 },\n    moderate: { min: 80, max: 140 },\n    severe: { min: 0, max: Infinity },\n    unit: 'degrees',\n  },\n  {\n    metric: 'totalFacialConvexity',\n    optimal: { min: 135, max: 145 },\n    mild: { min: 130, max: 150 },\n    moderate: { min: 125, max: 155 },\n    severe: { min: 0, max: Infinity },\n    unit: 'degrees',\n  },\n];\n\n// ============================================\n// METRIC TO ISSUE MAPPINGS\n// ============================================\n\nexport const METRIC_ISSUE_MAPPINGS: MetricIssueMapping[] = [\n  // Front Profile\n  {\n    metric: 'fwhr',\n    lowIssue: 'narrow_face',\n    highIssue: 'wide_face',\n    lowTreatments: ['cheek_filler', 'cheek_implants', 'jaw_implants'],\n    highTreatments: ['botox_masseter', 'buccal_fat_removal', 'zygoma_reduction', 'mandible_reduction'],\n  },\n  {\n    metric: 'canthalTilt',\n    lowIssue: 'negative_canthal_tilt',\n    highIssue: 'excessive_positive_tilt',\n    lowTreatments: ['canthoplasty', 'pdo_threads', 'botox_brow_lift'],\n    highTreatments: [], // Rarely treated\n  },\n  {\n    metric: 'nasalIndex',\n    lowIssue: 'narrow_nose',\n    highIssue: 'wide_nose',\n    lowTreatments: ['nose_filler'],\n    highTreatments: ['rhinoplasty_reduction', 'nose_filler'],\n  },\n  {\n    metric: 'lipRatio',\n    lowIssue: 'thin_lower_lip',\n    highIssue: 'thin_upper_lip',\n    lowTreatments: ['lip_filler'],\n    highTreatments: ['lip_filler', 'lip_lift'],\n  },\n  {\n    metric: 'jawWidthRatio',\n    lowIssue: 'narrow_jaw',\n    highIssue: 'wide_jaw',\n    lowTreatments: ['jaw_implants', 'jawline_filler'],\n    highTreatments: ['botox_masseter', 'mandible_reduction'],\n  },\n  {\n    metric: 'facialSymmetry',\n    lowIssue: 'facial_asymmetry',\n    highIssue: 'optimal',\n    lowTreatments: ['filler_correction', 'botox_asymmetry', 'bimax'],\n    highTreatments: [],\n  },\n  {\n    metric: 'cheekboneWidth',\n    lowIssue: 'flat_cheeks',\n    highIssue: 'wide_cheekbones',\n    lowTreatments: ['cheek_filler', 'cheek_implants'],\n    highTreatments: ['zygoma_reduction'],\n  },\n\n  // Side Profile\n  {\n    metric: 'gonialAngle',\n    lowIssue: 'over_prominent_jaw',\n    highIssue: 'weak_jaw',\n    lowTreatments: ['mandible_reduction'],\n    highTreatments: ['jaw_implants', 'jawline_filler', 'bsso'],\n  },\n  {\n    metric: 'nasolabialAngle',\n    lowIssue: 'droopy_nose_tip',\n    highIssue: 'over_rotated_tip',\n    lowTreatments: ['rhinoplasty_tip', 'nose_filler'],\n    highTreatments: ['rhinoplasty_tip', 'rhinoplasty_reduction'],\n  },\n  {\n    metric: 'chinProjection',\n    lowIssue: 'recessed_chin',\n    highIssue: 'prominent_chin',\n    lowTreatments: ['genioplasty', 'chin_implant', 'chin_filler'],\n    highTreatments: ['genioplasty'],\n  },\n  {\n    metric: 'eLineUpperLip',\n    lowIssue: 'lips_retrude',\n    highIssue: 'lips_protrude',\n    lowTreatments: ['lip_filler', 'bimax'],\n    highTreatments: ['bimax', 'lip_reduction'],\n  },\n  {\n    metric: 'eLineLowerLip',\n    lowIssue: 'lips_retrude',\n    highIssue: 'lips_protrude',\n    lowTreatments: ['lip_filler', 'bimax'],\n    highTreatments: ['bimax', 'lip_reduction'],\n  },\n  {\n    metric: 'facialConvexity',\n    lowIssue: 'concave_profile',\n    highIssue: 'convex_profile',\n    lowTreatments: ['bimax', 'chin_filler', 'lefort_1'],\n    highTreatments: ['bimax', 'rhinoplasty_reduction'],\n  },\n  {\n    metric: 'mentoLabialAngle',\n    lowIssue: 'deep_mentolabial_fold',\n    highIssue: 'flat_mentolabial_fold',\n    lowTreatments: ['chin_filler', 'genioplasty'],\n    highTreatments: [],\n  },\n  {\n    metric: 'submCervicalAngle',\n    lowIssue: 'undefined_neck_jaw',\n    highIssue: 'excessive_neck_angle',\n    lowTreatments: ['kybella', 'posture_correction', 'leanmaxxing'],\n    highTreatments: [],\n  },\n];\n\n// ============================================\n// SEVERITY CLASSIFICATION FUNCTIONS\n// ============================================\n\n/**\n * Classify a score into a severity level\n */\nexport function classifyByScore(score: number): SeverityResult {\n  if (score >= 85) {\n    return {\n      severity: 'optimal',\n      label: 'Optimal',\n      color: '#22c55e',\n      icon: '✓',\n      description: 'Excellent - within ideal range',\n    };\n  }\n  if (score >= 70) {\n    return {\n      severity: 'mild',\n      label: 'Good',\n      color: '#84cc16',\n      icon: '○',\n      description: 'Good - minor deviation from ideal',\n    };\n  }\n  if (score >= 50) {\n    return {\n      severity: 'moderate',\n      label: 'Average',\n      color: '#f59e0b',\n      icon: '△',\n      description: 'Average - noticeable deviation',\n    };\n  }\n  return {\n    severity: 'severe',\n    label: 'Below Average',\n    color: '#ef4444',\n    icon: '✗',\n    description: 'Below average - significant deviation',\n  };\n}\n\n/**\n * Get severity threshold for a specific metric\n */\nexport function getSeverityThreshold(metric: string): SeverityThreshold | undefined {\n  return SEVERITY_THRESHOLDS.find(t => t.metric === metric);\n}\n\n/**\n * Classify a metric value based on its specific thresholds\n */\nexport function classifyMetricValue(\n  metric: string,\n  value: number,\n  gender?: Gender\n): SeverityResult {\n  const threshold = getSeverityThreshold(metric);\n\n  if (!threshold) {\n    // Fallback to score-based classification if no threshold defined\n    return classifyByScore(value);\n  }\n\n  // Apply gender-specific adjustments\n  const adjustedThreshold = { ...threshold };\n  if (gender && metric === 'nasolabialAngle') {\n    if (gender === 'male') {\n      adjustedThreshold.optimal = { min: 90, max: 105 };\n    } else {\n      adjustedThreshold.optimal = { min: 100, max: 115 };\n    }\n  }\n\n  // Check which range the value falls into\n  if (value >= adjustedThreshold.optimal.min && value <= adjustedThreshold.optimal.max) {\n    return {\n      severity: 'optimal',\n      label: 'Optimal',\n      color: '#22c55e',\n      icon: '✓',\n      description: `Within ideal range (${adjustedThreshold.optimal.min}-${adjustedThreshold.optimal.max}${adjustedThreshold.unit})`,\n    };\n  }\n\n  if (value >= adjustedThreshold.mild.min && value <= adjustedThreshold.mild.max) {\n    return {\n      severity: 'mild',\n      label: 'Good',\n      color: '#84cc16',\n      icon: '○',\n      description: 'Minor deviation from ideal',\n    };\n  }\n\n  if (value >= adjustedThreshold.moderate.min && value <= adjustedThreshold.moderate.max) {\n    return {\n      severity: 'moderate',\n      label: 'Average',\n      color: '#f59e0b',\n      icon: '△',\n      description: 'Noticeable deviation from ideal',\n    };\n  }\n\n  return {\n    severity: 'severe',\n    label: 'Below Average',\n    color: '#ef4444',\n    icon: '✗',\n    description: 'Significant deviation from ideal',\n  };\n}\n\n/**\n * Calculate deviation from ideal for a metric\n */\nexport function calculateDeviation(\n  metric: string,\n  value: number\n): { deviation: number; deviationPercent: number; direction: 'low' | 'high' | 'optimal' } {\n  const threshold = getSeverityThreshold(metric);\n\n  if (!threshold) {\n    return { deviation: 0, deviationPercent: 0, direction: 'optimal' };\n  }\n\n  const idealMidpoint = (threshold.optimal.min + threshold.optimal.max) / 2;\n  const deviation = value - idealMidpoint;\n  const idealRange = threshold.optimal.max - threshold.optimal.min;\n  const deviationPercent = (Math.abs(deviation) / idealRange) * 100;\n\n  let direction: 'low' | 'high' | 'optimal';\n  if (value >= threshold.optimal.min && value <= threshold.optimal.max) {\n    direction = 'optimal';\n  } else if (value < threshold.optimal.min) {\n    direction = 'low';\n  } else {\n    direction = 'high';\n  }\n\n  return { deviation, deviationPercent, direction };\n}\n\n/**\n * Get the issue name for a metric deviation\n */\nexport function getIssueForMetric(\n  metric: string,\n  direction: 'low' | 'high' | 'optimal'\n): string | null {\n  if (direction === 'optimal') return null;\n\n  const mapping = METRIC_ISSUE_MAPPINGS.find(m => m.metric === metric);\n  if (!mapping) return null;\n\n  return direction === 'low' ? mapping.lowIssue : mapping.highIssue;\n}\n\n/**\n * Get treatment IDs for a metric deviation\n */\nexport function getTreatmentIdsForMetric(\n  metric: string,\n  direction: 'low' | 'high' | 'optimal'\n): string[] {\n  if (direction === 'optimal') return [];\n\n  const mapping = METRIC_ISSUE_MAPPINGS.find(m => m.metric === metric);\n  if (!mapping) return [];\n\n  return direction === 'low' ? mapping.lowTreatments : mapping.highTreatments;\n}\n\n/**\n * Get overall severity from multiple metric analyses\n */\nexport function getOverallSeverity(severities: Severity[]): SeverityResult {\n  const severeCount = severities.filter(s => s === 'severe').length;\n  const moderateCount = severities.filter(s => s === 'moderate').length;\n  const mildCount = severities.filter(s => s === 'mild').length;\n\n  // Weighted scoring\n  const score = (\n    (severities.filter(s => s === 'optimal').length * 100) +\n    (mildCount * 75) +\n    (moderateCount * 50) +\n    (severeCount * 25)\n  ) / severities.length;\n\n  return classifyByScore(score);\n}\n\n/**\n * Prioritize metrics by severity and impact\n */\nexport function prioritizeMetrics(\n  metricSeverities: Array<{ metric: string; severity: Severity; impact: number }>\n): Array<{ metric: string; severity: Severity; priority: 'high' | 'medium' | 'low' }> {\n  const severityWeight: Record<Severity, number> = {\n    severe: 4,\n    moderate: 3,\n    mild: 2,\n    optimal: 1,\n  };\n\n  return metricSeverities\n    .map(m => ({\n      ...m,\n      score: severityWeight[m.severity] * m.impact,\n    }))\n    .sort((a, b) => b.score - a.score)\n    .map((m, index) => ({\n      metric: m.metric,\n      severity: m.severity,\n      priority: index < 3 ? 'high' as const :\n                index < 7 ? 'medium' as const :\n                'low' as const,\n    }));\n}\n\n// ============================================\n// PSL RATING CONVERSION\n// ============================================\n\n/**\n * Convert harmony score to PSL rating\n */\nexport function harmonyToPSL(harmonyPercent: number): {\n  psl: number;\n  tier: string;\n  percentile: number;\n  description: string;\n} {\n  // Based on FaceIQ formula: Harmony % = ((Score - Min) / (Max - Min)) * 100\n  // Where Max = 333.71, Min = -337.71\n\n  // Convert harmony percent to approximate PSL\n  // Harmony 0% = PSL 3.0, Harmony 100% = PSL 7.5\n  const psl = 3.0 + (harmonyPercent / 100) * 4.5;\n  const clampedPSL = Math.max(3.0, Math.min(7.5, psl));\n\n  // Determine tier\n  let tier: string;\n  let percentile: number;\n  let description: string;\n\n  if (clampedPSL >= 7.5) {\n    tier = 'Top Model';\n    percentile = 99.99;\n    description = 'Near perfection - world-class genetics';\n  } else if (clampedPSL >= 7.0) {\n    tier = 'Chad';\n    percentile = 99.87;\n    description = 'Exceptional - top 0.1%';\n  } else if (clampedPSL >= 6.5) {\n    tier = 'Chadlite';\n    percentile = 99.0;\n    description = 'Very attractive - top 1%';\n  } else if (clampedPSL >= 6.0) {\n    tier = 'High Tier Normie+';\n    percentile = 97.25;\n    description = 'Notably attractive - top 3%';\n  } else if (clampedPSL >= 5.5) {\n    tier = 'High Tier Normie';\n    percentile = 90.0;\n    description = 'Above average - top 10%';\n  } else if (clampedPSL >= 5.0) {\n    tier = 'Mid Tier Normie+';\n    percentile = 84.15;\n    description = 'Slightly above average';\n  } else if (clampedPSL >= 4.5) {\n    tier = 'Mid Tier Normie';\n    percentile = 65.0;\n    description = 'Average';\n  } else if (clampedPSL >= 4.0) {\n    tier = 'Low Tier Normie';\n    percentile = 50.0;\n    description = 'Median';\n  } else if (clampedPSL >= 3.5) {\n    tier = 'Below Average';\n    percentile = 30.0;\n    description = 'Below average';\n  } else {\n    tier = 'Subpar';\n    percentile = 15.0;\n    description = 'Noticeably below average';\n  }\n\n  return {\n    psl: Math.round(clampedPSL * 10) / 10,\n    tier,\n    percentile,\n    description,\n  };\n}\n\n/**\n * Estimate potential PSL improvement from treatments\n */\nexport function estimatePotentialPSL(\n  currentPSL: number,\n  treatmentImprovements: number[]\n): { potentialPSL: number; totalImprovement: number } {\n  // Sum improvements with diminishing returns\n  const sortedImprovements = treatmentImprovements.sort((a, b) => b - a);\n\n  let totalImprovement = 0;\n  sortedImprovements.forEach((improvement, index) => {\n    // Each subsequent improvement is reduced by 20%\n    const diminishingFactor = Math.pow(0.8, index);\n    totalImprovement += improvement * diminishingFactor;\n  });\n\n  // Cap total improvement at realistic level\n  const cappedImprovement = Math.min(totalImprovement, 2.5);\n  const potentialPSL = Math.min(7.5, currentPSL + cappedImprovement);\n\n  return {\n    potentialPSL: Math.round(potentialPSL * 10) / 10,\n    totalImprovement: Math.round(cappedImprovement * 10) / 10,\n  };\n}\n","numLines":653,"startLine":1,"totalLines":653}}}
{"parentUuid":"12fe32bf-ec6c-42c0-af2a-672070311d83","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AecQqALv69dBGsxBtiuFNS","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx"}]},"uuid":"dc5b114b-7006-4997-bd07-a050221a2535","timestamp":"2025-12-20T20:51:04.160Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx"],"durationMs":375,"numFiles":1,"truncated":false}}
{"parentUuid":"dc5b114b-7006-4997-bd07-a050221a2535","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_0166GnX9GANCV5iUqpqPwJxm","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me read the StrengthFlawCards.tsx file to understand the current severity display implementation.","signature":"EpECCkYIChgCKkBzbKZbET9SBg9lQTkY4p8C2P27ns0xi//rtR24IsjalTKCPNjTLog/gw+YJczCyNvPI9sO36k5u7ByyEBfhFKdEgxPdm2w/q+RLc5Ccs0aDJ/7fVDbN/rxREE3kCIw/Mdc5KVHvQGqkO2aO2GNa20G9pjqvHVw24WHzgdUcPFzbDpb8jVn3oNBMLR4a0OwKnkthWuqm+Bu2YskptVQLvOsmaoaZXEpF7pSx4CqMxYcZCbUd/J5WyszBHegktEfkjlBWYL0HqPvQ3fWMqJ8Y5li68Z9MCgVfohZ/mV4+q/u1ZTinDp9w1MwW1nSEUxUxaLWke/Gbh+a5Rhkh902qteXv00OO6m6XJsZGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":22230,"cache_read_input_tokens":26639,"cache_creation":{"ephemeral_5m_input_tokens":22230,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbkU5379Pz2BQ9eAHqY","type":"assistant","uuid":"f1de7f1a-57b2-4b77-b44c-683d5188c6f0","timestamp":"2025-12-20T20:51:06.929Z"}
{"parentUuid":"f1de7f1a-57b2-4b77-b44c-683d5188c6f0","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_0166GnX9GANCV5iUqpqPwJxm","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015TteCTybo8FvuXpesFJvM8","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":22230,"cache_read_input_tokens":26639,"cache_creation":{"ephemeral_5m_input_tokens":22230,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbkU5379Pz2BQ9eAHqY","type":"assistant","uuid":"e58054e2-df50-4753-93bc-339fa6097043","timestamp":"2025-12-20T20:51:07.647Z"}
{"parentUuid":"e58054e2-df50-4753-93bc-339fa6097043","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_0166GnX9GANCV5iUqpqPwJxm","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015QgWw7d86CuPvS3RuueJqc","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":22230,"cache_read_input_tokens":26639,"cache_creation":{"ephemeral_5m_input_tokens":22230,"ephemeral_1h_input_tokens":0},"output_tokens":186,"service_tier":"standard"}},"requestId":"req_011CWJbkU5379Pz2BQ9eAHqY","type":"assistant","uuid":"d8166141-9090-4ec9-af6c-8eec621b24c8","timestamp":"2025-12-20T20:51:08.466Z"}
{"parentUuid":"d8166141-9090-4ec9-af6c-8eec621b24c8","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015TteCTybo8FvuXpesFJvM8","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { motion } from 'framer-motion';\n     4→import { ChevronDown, TrendingDown, AlertTriangle, CheckCircle } from 'lucide-react';\n     5→import { Strength, Flaw, getScoreColor, getQualityColor } from '@/types/results';\n     6→import { QualityBadge, CategoryTag, ExpandableSection } from '../shared';\n     7→\n     8→// ============================================\n     9→// STRENGTH CARD\n    10→// ============================================\n    11→\n    12→interface StrengthCardProps {\n    13→  strength: Strength;\n    14→  isExpanded?: boolean;\n    15→  onToggle?: () => void;\n    16→}\n    17→\n    18→export function StrengthCard({ strength, isExpanded = false, onToggle }: StrengthCardProps) {\n    19→  const color = getQualityColor(strength.qualityLevel);\n    20→\n    21→  return (\n    22→    <motion.div\n    23→      layout\n    24→      className={`bg-gradient-to-br from-green-500/10 to-cyan-500/5 border rounded-xl overflow-hidden transition-all ${\n    25→        isExpanded ? 'border-green-500/50' : 'border-green-500/20 hover:border-green-500/40'\n    26→      }`}\n    27→    >\n    28→      {/* Header */}\n    29→      <button\n    30→        onClick={onToggle}\n    31→        className=\"w-full p-4 flex items-start gap-3 text-left\"\n    32→      >\n    33→        {/* Icon */}\n    34→        <div className=\"w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center flex-shrink-0\">\n    35→          <CheckCircle size={20} className=\"text-green-400\" />\n    36→        </div>\n    37→\n    38→        {/* Content */}\n    39→        <div className=\"flex-1 min-w-0\">\n    40→          <div className=\"flex items-center gap-2 mb-1\">\n    41→            <h3 className=\"font-semibold text-white\">{strength.strengthName}</h3>\n    42→            <QualityBadge quality={strength.qualityLevel} size=\"sm\" />\n    43→          </div>\n    44→          <p className=\"text-sm text-neutral-400 line-clamp-2\">{strength.summary}</p>\n    45→          <div className=\"flex items-center gap-3 mt-2\">\n    46→            <CategoryTag category={strength.categoryName} />\n    47→            <span className=\"text-sm font-medium\" style={{ color }}>\n    48→              Score: {strength.avgScore.toFixed(1)}/10\n    49→            </span>\n    50→          </div>\n    51→        </div>\n    52→\n    53→        {/* Expand indicator */}\n    54→        <motion.div\n    55→          animate={{ rotate: isExpanded ? 180 : 0 }}\n    56→          transition={{ duration: 0.2 }}\n    57→          className=\"flex-shrink-0 mt-1\"\n    58→        >\n    59→          <ChevronDown size={18} className=\"text-neutral-500\" />\n    60→        </motion.div>\n    61→      </button>\n    62→\n    63→      {/* Expanded Content */}\n    64→      <ExpandableSection isExpanded={isExpanded}>\n    65→        <div className=\"px-4 pb-4 space-y-3 border-t border-green-500/20 pt-3\">\n    66→          <h4 className=\"text-sm font-medium text-neutral-300\">Responsible Ratios</h4>\n    67→          <div className=\"space-y-2\">\n    68→            {strength.responsibleRatios.map((ratio, i) => (\n    69→              <div\n    70→                key={i}\n    71→                className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n    72→              >\n    73→                <span className=\"text-sm text-neutral-300\">{ratio.ratioName}</span>\n    74→                <div className=\"flex items-center gap-2\">\n    75→                  <span className=\"text-sm text-neutral-500\">\n    76→                    {ratio.value.toFixed(2)}\n    77→                  </span>\n    78→                  <span\n    79→                    className=\"text-sm font-medium\"\n    80→                    style={{ color: getScoreColor(ratio.score) }}\n    81→                  >\n    82→                    {ratio.score.toFixed(1)}\n    83→                  </span>\n    84→                </div>\n    85→              </div>\n    86→            ))}\n    87→          </div>\n    88→        </div>\n    89→      </ExpandableSection>\n    90→    </motion.div>\n    91→  );\n    92→}\n    93→\n    94→// ============================================\n    95→// FLAW CARD\n    96→// ============================================\n    97→\n    98→interface FlawCardProps {\n    99→  flaw: Flaw;\n   100→  isExpanded?: boolean;\n   101→  onToggle?: () => void;\n   102→  rank?: number;\n   103→}\n   104→\n   105→export function FlawCard({ flaw, isExpanded = false, onToggle, rank }: FlawCardProps) {\n   106→  const impactColor = flaw.harmonyPercentageLost > 5 ? '#ef4444' :\n   107→    flaw.harmonyPercentageLost > 2 ? '#f97316' : '#fbbf24';\n   108→\n   109→  return (\n   110→    <motion.div\n   111→      layout\n   112→      className={`bg-gradient-to-br from-red-500/10 to-orange-500/5 border rounded-xl overflow-hidden transition-all ${\n   113→        isExpanded ? 'border-red-500/50' : 'border-red-500/20 hover:border-red-500/40'\n   114→      }`}\n   115→    >\n   116→      {/* Header */}\n   117→      <button\n   118→        onClick={onToggle}\n   119→        className=\"w-full p-4 flex items-start gap-3 text-left\"\n   120→      >\n   121→        {/* Icon / Rank */}\n   122→        <div className=\"w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0\">\n   123→          {rank !== undefined ? (\n   124→            <span className=\"text-red-400 font-bold\">#{rank}</span>\n   125→          ) : (\n   126→            <AlertTriangle size={20} className=\"text-red-400\" />\n   127→          )}\n   128→        </div>\n   129→\n   130→        {/* Content */}\n   131→        <div className=\"flex-1 min-w-0\">\n   132→          <div className=\"flex items-center gap-2 mb-1\">\n   133→            <h3 className=\"font-semibold text-white\">{flaw.flawName}</h3>\n   134→          </div>\n   135→          <p className=\"text-sm text-neutral-400 line-clamp-2\">{flaw.summary}</p>\n   136→          <div className=\"flex items-center gap-3 mt-2\">\n   137→            <CategoryTag category={flaw.categoryName} />\n   138→            <div className=\"flex items-center gap-1\">\n   139→              <TrendingDown size={14} style={{ color: impactColor }} />\n   140→              <span className=\"text-sm font-medium\" style={{ color: impactColor }}>\n   141→                -{flaw.harmonyPercentageLost.toFixed(1)}%\n   142→              </span>\n   143→            </div>\n   144→          </div>\n   145→        </div>\n   146→\n   147→        {/* Expand indicator */}\n   148→        <motion.div\n   149→          animate={{ rotate: isExpanded ? 180 : 0 }}\n   150→          transition={{ duration: 0.2 }}\n   151→          className=\"flex-shrink-0 mt-1\"\n   152→        >\n   153→          <ChevronDown size={18} className=\"text-neutral-500\" />\n   154→        </motion.div>\n   155→      </button>\n   156→\n   157→      {/* Expanded Content */}\n   158→      <ExpandableSection isExpanded={isExpanded}>\n   159→        <div className=\"px-4 pb-4 space-y-3 border-t border-red-500/20 pt-3\">\n   160→          {/* Impact metrics */}\n   161→          <div className=\"grid grid-cols-2 gap-3\">\n   162→            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n   163→              <p className=\"text-xs text-neutral-500 mb-1\">Harmony Lost</p>\n   164→              <p className=\"text-lg font-bold\" style={{ color: impactColor }}>\n   165→                -{flaw.harmonyPercentageLost.toFixed(2)}%\n   166→              </p>\n   167→            </div>\n   168→            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n   169→              <p className=\"text-xs text-neutral-500 mb-1\">Impact Score</p>\n   170→              <p className=\"text-lg font-bold text-white\">\n   171→                {flaw.standardizedImpact.toFixed(2)}\n   172→              </p>\n   173→            </div>\n   174→          </div>\n   175→\n   176→          {/* Rolling impact if available */}\n   177→          {flaw.rollingHarmonyPercentageLost !== undefined && (\n   178→            <div className=\"bg-neutral-800/30 rounded-lg p-3\">\n   179→              <p className=\"text-xs text-neutral-500 mb-1\">Cumulative Impact</p>\n   180→              <div className=\"flex items-center gap-2\">\n   181→                <div className=\"flex-1 h-2 bg-neutral-700 rounded-full overflow-hidden\">\n   182→                  <div\n   183→                    className=\"h-full bg-red-500\"\n   184→                    style={{ width: `${Math.min(flaw.rollingHarmonyPercentageLost, 100)}%` }}\n   185→                  />\n   186→                </div>\n   187→                <span className=\"text-sm text-red-400\">\n   188→                  -{flaw.rollingHarmonyPercentageLost.toFixed(1)}%\n   189→                </span>\n   190→              </div>\n   191→            </div>\n   192→          )}\n   193→\n   194→          {/* Responsible ratios */}\n   195→          <div>\n   196→            <h4 className=\"text-sm font-medium text-neutral-300 mb-2\">Responsible Ratios</h4>\n   197→            <div className=\"space-y-2\">\n   198→              {flaw.responsibleRatios.map((ratio, i) => (\n   199→                <div\n   200→                  key={i}\n   201→                  className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n   202→                >\n   203→                  <span className=\"text-sm text-neutral-300\">{ratio.ratioName}</span>\n   204→                  <div className=\"flex items-center gap-2\">\n   205→                    <span className=\"text-sm text-neutral-500\">\n   206→                      {ratio.value.toFixed(2)}\n   207→                    </span>\n   208→                    <span\n   209→                      className=\"text-sm font-medium\"\n   210→                      style={{ color: getScoreColor(ratio.score) }}\n   211→                    >\n   212→                      {ratio.score.toFixed(1)}\n   213→                    </span>\n   214→                  </div>\n   215→                </div>\n   216→              ))}\n   217→            </div>\n   218→          </div>\n   219→        </div>\n   220→      </ExpandableSection>\n   221→    </motion.div>\n   222→  );\n   223→}\n   224→\n   225→// ============================================\n   226→// COMPACT STRENGTH/FLAW BADGES\n   227→// ============================================\n   228→\n   229→interface CompactStrengthBadgeProps {\n   230→  strength: Strength;\n   231→  onClick?: () => void;\n   232→}\n   233→\n   234→export function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {\n   235→  return (\n   236→    <button\n   237→      onClick={onClick}\n   238→      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-green-500/10 border border-green-500/20 rounded-lg hover:bg-green-500/20 transition-colors\"\n   239→    >\n   240→      <CheckCircle size={12} className=\"text-green-400\" />\n   241→      <span className=\"text-xs text-green-300\">{strength.strengthName}</span>\n   242→    </button>\n   243→  );\n   244→}\n   245→\n   246→interface CompactFlawBadgeProps {\n   247→  flaw: Flaw;\n   248→  onClick?: () => void;\n   249→}\n   250→\n   251→export function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n   252→  return (\n   253→    <button\n   254→      onClick={onClick}\n   255→      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-red-500/10 border border-red-500/20 rounded-lg hover:bg-red-500/20 transition-colors\"\n   256→    >\n   257→      <AlertTriangle size={12} className=\"text-red-400\" />\n   258→      <span className=\"text-xs text-red-300\">{flaw.flawName}</span>\n   259→      <span className=\"text-[10px] text-red-400\">-{flaw.harmonyPercentageLost.toFixed(1)}%</span>\n   260→    </button>\n   261→  );\n   262→}\n   263→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"a4691ac6-6a05-43a7-aaf3-ed17033228b8","timestamp":"2025-12-20T20:51:08.512Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","content":"'use client';\n\nimport { motion } from 'framer-motion';\nimport { ChevronDown, TrendingDown, AlertTriangle, CheckCircle } from 'lucide-react';\nimport { Strength, Flaw, getScoreColor, getQualityColor } from '@/types/results';\nimport { QualityBadge, CategoryTag, ExpandableSection } from '../shared';\n\n// ============================================\n// STRENGTH CARD\n// ============================================\n\ninterface StrengthCardProps {\n  strength: Strength;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n}\n\nexport function StrengthCard({ strength, isExpanded = false, onToggle }: StrengthCardProps) {\n  const color = getQualityColor(strength.qualityLevel);\n\n  return (\n    <motion.div\n      layout\n      className={`bg-gradient-to-br from-green-500/10 to-cyan-500/5 border rounded-xl overflow-hidden transition-all ${\n        isExpanded ? 'border-green-500/50' : 'border-green-500/20 hover:border-green-500/40'\n      }`}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 flex items-start gap-3 text-left\"\n      >\n        {/* Icon */}\n        <div className=\"w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center flex-shrink-0\">\n          <CheckCircle size={20} className=\"text-green-400\" />\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h3 className=\"font-semibold text-white\">{strength.strengthName}</h3>\n            <QualityBadge quality={strength.qualityLevel} size=\"sm\" />\n          </div>\n          <p className=\"text-sm text-neutral-400 line-clamp-2\">{strength.summary}</p>\n          <div className=\"flex items-center gap-3 mt-2\">\n            <CategoryTag category={strength.categoryName} />\n            <span className=\"text-sm font-medium\" style={{ color }}>\n              Score: {strength.avgScore.toFixed(1)}/10\n            </span>\n          </div>\n        </div>\n\n        {/* Expand indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0 mt-1\"\n        >\n          <ChevronDown size={18} className=\"text-neutral-500\" />\n        </motion.div>\n      </button>\n\n      {/* Expanded Content */}\n      <ExpandableSection isExpanded={isExpanded}>\n        <div className=\"px-4 pb-4 space-y-3 border-t border-green-500/20 pt-3\">\n          <h4 className=\"text-sm font-medium text-neutral-300\">Responsible Ratios</h4>\n          <div className=\"space-y-2\">\n            {strength.responsibleRatios.map((ratio, i) => (\n              <div\n                key={i}\n                className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n              >\n                <span className=\"text-sm text-neutral-300\">{ratio.ratioName}</span>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm text-neutral-500\">\n                    {ratio.value.toFixed(2)}\n                  </span>\n                  <span\n                    className=\"text-sm font-medium\"\n                    style={{ color: getScoreColor(ratio.score) }}\n                  >\n                    {ratio.score.toFixed(1)}\n                  </span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </ExpandableSection>\n    </motion.div>\n  );\n}\n\n// ============================================\n// FLAW CARD\n// ============================================\n\ninterface FlawCardProps {\n  flaw: Flaw;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  rank?: number;\n}\n\nexport function FlawCard({ flaw, isExpanded = false, onToggle, rank }: FlawCardProps) {\n  const impactColor = flaw.harmonyPercentageLost > 5 ? '#ef4444' :\n    flaw.harmonyPercentageLost > 2 ? '#f97316' : '#fbbf24';\n\n  return (\n    <motion.div\n      layout\n      className={`bg-gradient-to-br from-red-500/10 to-orange-500/5 border rounded-xl overflow-hidden transition-all ${\n        isExpanded ? 'border-red-500/50' : 'border-red-500/20 hover:border-red-500/40'\n      }`}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 flex items-start gap-3 text-left\"\n      >\n        {/* Icon / Rank */}\n        <div className=\"w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0\">\n          {rank !== undefined ? (\n            <span className=\"text-red-400 font-bold\">#{rank}</span>\n          ) : (\n            <AlertTriangle size={20} className=\"text-red-400\" />\n          )}\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h3 className=\"font-semibold text-white\">{flaw.flawName}</h3>\n          </div>\n          <p className=\"text-sm text-neutral-400 line-clamp-2\">{flaw.summary}</p>\n          <div className=\"flex items-center gap-3 mt-2\">\n            <CategoryTag category={flaw.categoryName} />\n            <div className=\"flex items-center gap-1\">\n              <TrendingDown size={14} style={{ color: impactColor }} />\n              <span className=\"text-sm font-medium\" style={{ color: impactColor }}>\n                -{flaw.harmonyPercentageLost.toFixed(1)}%\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Expand indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0 mt-1\"\n        >\n          <ChevronDown size={18} className=\"text-neutral-500\" />\n        </motion.div>\n      </button>\n\n      {/* Expanded Content */}\n      <ExpandableSection isExpanded={isExpanded}>\n        <div className=\"px-4 pb-4 space-y-3 border-t border-red-500/20 pt-3\">\n          {/* Impact metrics */}\n          <div className=\"grid grid-cols-2 gap-3\">\n            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Harmony Lost</p>\n              <p className=\"text-lg font-bold\" style={{ color: impactColor }}>\n                -{flaw.harmonyPercentageLost.toFixed(2)}%\n              </p>\n            </div>\n            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Impact Score</p>\n              <p className=\"text-lg font-bold text-white\">\n                {flaw.standardizedImpact.toFixed(2)}\n              </p>\n            </div>\n          </div>\n\n          {/* Rolling impact if available */}\n          {flaw.rollingHarmonyPercentageLost !== undefined && (\n            <div className=\"bg-neutral-800/30 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Cumulative Impact</p>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"flex-1 h-2 bg-neutral-700 rounded-full overflow-hidden\">\n                  <div\n                    className=\"h-full bg-red-500\"\n                    style={{ width: `${Math.min(flaw.rollingHarmonyPercentageLost, 100)}%` }}\n                  />\n                </div>\n                <span className=\"text-sm text-red-400\">\n                  -{flaw.rollingHarmonyPercentageLost.toFixed(1)}%\n                </span>\n              </div>\n            </div>\n          )}\n\n          {/* Responsible ratios */}\n          <div>\n            <h4 className=\"text-sm font-medium text-neutral-300 mb-2\">Responsible Ratios</h4>\n            <div className=\"space-y-2\">\n              {flaw.responsibleRatios.map((ratio, i) => (\n                <div\n                  key={i}\n                  className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n                >\n                  <span className=\"text-sm text-neutral-300\">{ratio.ratioName}</span>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm text-neutral-500\">\n                      {ratio.value.toFixed(2)}\n                    </span>\n                    <span\n                      className=\"text-sm font-medium\"\n                      style={{ color: getScoreColor(ratio.score) }}\n                    >\n                      {ratio.score.toFixed(1)}\n                    </span>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </ExpandableSection>\n    </motion.div>\n  );\n}\n\n// ============================================\n// COMPACT STRENGTH/FLAW BADGES\n// ============================================\n\ninterface CompactStrengthBadgeProps {\n  strength: Strength;\n  onClick?: () => void;\n}\n\nexport function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-green-500/10 border border-green-500/20 rounded-lg hover:bg-green-500/20 transition-colors\"\n    >\n      <CheckCircle size={12} className=\"text-green-400\" />\n      <span className=\"text-xs text-green-300\">{strength.strengthName}</span>\n    </button>\n  );\n}\n\ninterface CompactFlawBadgeProps {\n  flaw: Flaw;\n  onClick?: () => void;\n}\n\nexport function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-red-500/10 border border-red-500/20 rounded-lg hover:bg-red-500/20 transition-colors\"\n    >\n      <AlertTriangle size={12} className=\"text-red-400\" />\n      <span className=\"text-xs text-red-300\">{flaw.flawName}</span>\n      <span className=\"text-[10px] text-red-400\">-{flaw.harmonyPercentageLost.toFixed(1)}%</span>\n    </button>\n  );\n}\n","numLines":263,"startLine":1,"totalLines":263}}}
{"parentUuid":"a4691ac6-6a05-43a7-aaf3-ed17033228b8","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"File content (31983 tokens) exceeds maximum allowed tokens (25000). Please use offset and limit parameters to read specific portions of the file, or use the GrepTool to search for specific content.","is_error":true,"tool_use_id":"toolu_015QgWw7d86CuPvS3RuueJqc"}]},"uuid":"afd3364a-9b5b-4616-8bee-a11156b66983","timestamp":"2025-12-20T20:51:08.672Z","toolUseResult":"Error: File content (31983 tokens) exceeds maximum allowed tokens (25000). Please use offset and limit parameters to read specific portions of the file, or use the GrepTool to search for specific content."}
{"parentUuid":"afd3364a-9b5b-4616-8bee-a11156b66983","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_019NBrXR59w7FwvtCxF34c7h","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The faceiq-scoring.ts file is quite large. Let me read specific portions of it. I need to see the metric configs and look for any existing illustration configs and the METRIC_FLAW_MAPPINGS that were mentioned as completed. Let me read parts of this file.","signature":"EqcDCkYIChgCKkDTQ9ganIEWc5m/LKLtoikuUruQutcewmxZ7/1zIODXiOGY+OMzz85QeaPGXTVCIW0gIT9ct3QEEs9kWLyhhv26Egyc3zafKbcinvt910gaDJynaBdNAU9MdwLaRiIwyp8O3+7kjkE5OU4eNbABire6HVY5etU//dMzFvjgvKKAxOh1Q9qdBm9N3K8N2C1UKo4CWrZUelKkNr4f38fAWokOPnnh4Lhlx/IGS+wQv2cpXMO4ZFQQdfn//VZFL9SQ8C0nJItee5fAMOd4RB1UTUMfXgpXQt7G8A2Cw1IMWXbi6zJGp/tIJZFEvGgBYmcMHWXQvNp5Lvjr73bVm920wiSkDUvjkLfltO5NVIBEWN4qC5y+utaMIfNjrGkfUqzYM1VHHxLiMv+1jwjEUV/GM2GPbuKXGrZNF1RPoTl11gIJWEEry9FkPSIxfsURH7IB99odVmGtQUX/GF0knTas7gC5E7vONbi9Hq/9y33SG8VQ2wA4YcbsxQCqqEKMjdLSSvi86flcXj29mR4CzIfRkINBg8gNt5y2PzP54Dhb+iyjGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":4378,"cache_read_input_tokens":48869,"cache_creation":{"ephemeral_5m_input_tokens":4378,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJbkoQ8fkCDk8RezfUw9","type":"assistant","uuid":"2699f899-7958-4c98-9e3e-0e1b1937a849","timestamp":"2025-12-20T20:51:12.765Z"}
{"parentUuid":"2699f899-7958-4c98-9e3e-0e1b1937a849","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_019NBrXR59w7FwvtCxF34c7h","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015CxkRh4cpQKoXt6SRqMv2t","name":"TodoWrite","input":{"todos":[{"content":"Enhanced Illustration Configs - Expand generateIllustration() function","status":"in_progress","activeForm":"Expanding generateIllustration() function"},{"content":"Improved Flaw-to-Treatment Matching - Use metric scores and match flaws to procedures","status":"pending","activeForm":"Improving flaw-to-treatment matching"},{"content":"Severity Display Enhancement - Add severity badges with colors","status":"pending","activeForm":"Enhancing severity display with badges"}]}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":4378,"cache_read_input_tokens":48869,"cache_creation":{"ephemeral_5m_input_tokens":4378,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJbkoQ8fkCDk8RezfUw9","type":"assistant","uuid":"adf8bfac-7217-4b40-9cb9-f7af83685cca","timestamp":"2025-12-20T20:51:15.182Z"}
{"parentUuid":"adf8bfac-7217-4b40-9cb9-f7af83685cca","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_019NBrXR59w7FwvtCxF34c7h","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KQhTzo834oSV6J7kNWNZBn","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","offset":1,"limit":300}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":4378,"cache_read_input_tokens":48869,"cache_creation":{"ephemeral_5m_input_tokens":4378,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJbkoQ8fkCDk8RezfUw9","type":"assistant","uuid":"740eab62-5fd5-4586-92df-0c13db73ab88","timestamp":"2025-12-20T20:51:16.862Z"}
{"parentUuid":"740eab62-5fd5-4586-92df-0c13db73ab88","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_019NBrXR59w7FwvtCxF34c7h","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0131e7JcANiKPgpQix2rzpWW","name":"Grep","input":{"pattern":"METRIC_FLAW_MAPPINGS|FLAW_MAPPINGS","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","output_mode":"content","-n":true}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":4378,"cache_read_input_tokens":48869,"cache_creation":{"ephemeral_5m_input_tokens":4378,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJbkoQ8fkCDk8RezfUw9","type":"assistant","uuid":"24b7a88d-4156-442b-a1e2-0c1dc7d3a2b7","timestamp":"2025-12-20T20:51:18.704Z"}
{"parentUuid":"24b7a88d-4156-442b-a1e2-0c1dc7d3a2b7","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015CxkRh4cpQKoXt6SRqMv2t","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"fc49f949-5e75-4622-ac78-8f32d7cf3156","timestamp":"2025-12-20T20:51:18.749Z","toolUseResult":{"oldTodos":[{"content":"Enhanced Illustration Configs - Expand generateIllustration() function","status":"pending","activeForm":"Expanding generateIllustration() function"},{"content":"Improved Flaw-to-Treatment Matching - Use metric scores and match flaws to procedures","status":"pending","activeForm":"Improving flaw-to-treatment matching"},{"content":"Severity Display Enhancement - Add severity badges with colors","status":"pending","activeForm":"Enhancing severity display with badges"}],"newTodos":[{"content":"Enhanced Illustration Configs - Expand generateIllustration() function","status":"in_progress","activeForm":"Expanding generateIllustration() function"},{"content":"Improved Flaw-to-Treatment Matching - Use metric scores and match flaws to procedures","status":"pending","activeForm":"Improving flaw-to-treatment matching"},{"content":"Severity Display Enhancement - Add severity badges with colors","status":"pending","activeForm":"Enhancing severity display with badges"}]}}
{"parentUuid":"fc49f949-5e75-4622-ac78-8f32d7cf3156","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KQhTzo834oSV6J7kNWNZBn","type":"tool_result","content":"     1→/**\n     2→ * FaceIQ-Style Facial Analysis Scoring System\n     3→ * Complete replication of FaceIQ Labs scoring algorithms\n     4→ *\n     5→ * Features:\n     6→ * - Exponential decay scoring with per-metric decay rates\n     7→ * - Bezier curve custom scoring for non-linear measurements\n     8→ * - 70+ facial measurements (front + side profiles)\n     9→ * - Quality tiers: Ideal, Excellent, Good\n    10→ * - 5-tier severity: Extremely Severe, Severe, Major, Moderate, Minor\n    11→ */\n    12→\n    13→import { LandmarkPoint } from './landmarks';\n    14→\n    15→// ============================================\n    16→// CORE TYPES\n    17→// ============================================\n    18→\n    19→export interface Point {\n    20→  x: number;\n    21→  y: number;\n    22→}\n    23→\n    24→export type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\n    25→export type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\n    26→export type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n    27→\n    28→export interface MetricConfig {\n    29→  id: string;\n    30→  name: string;\n    31→  category: string;\n    32→  unit: MeasurementUnit;\n    33→  idealMin: number;\n    34→  idealMax: number;\n    35→  rangeMin: number;\n    36→  rangeMax: number;\n    37→  decayRate: number;\n    38→  maxScore: number;\n    39→  weight: number;\n    40→  description: string;\n    41→  profileType: 'front' | 'side';\n    42→  customCurve?: BezierCurveConfig;\n    43→}\n    44→\n    45→export interface BezierCurveConfig {\n    46→  mode: 'custom' | 'exponential';\n    47→  points: CurvePoint[];\n    48→}\n    49→\n    50→export interface CurvePoint {\n    51→  x: number;\n    52→  y: number;\n    53→  leftHandleX?: number;\n    54→  leftHandleY?: number;\n    55→  rightHandleX?: number;\n    56→  rightHandleY?: number;\n    57→  fixed?: boolean;\n    58→}\n    59→\n    60→export interface FaceIQScoreResult {\n    61→  metricId: string;\n    62→  name: string;\n    63→  value: number;\n    64→  score: number;  // 0-10 scale\n    65→  standardizedScore: number;\n    66→  qualityTier: QualityTier;\n    67→  severity: SeverityLevel;\n    68→  idealMin: number;\n    69→  idealMax: number;\n    70→  deviation: number;\n    71→  deviationDirection: 'above' | 'below' | 'within';\n    72→  unit: MeasurementUnit;\n    73→  category: string;\n    74→  percentile?: number;\n    75→}\n    76→\n    77→export interface HarmonyAnalysis {\n    78→  overallScore: number;  // 0-10 scale\n    79→  standardizedScore: number;\n    80→  qualityTier: QualityTier;\n    81→  percentile: number;\n    82→  frontScore: number;\n    83→  sideScore: number;\n    84→  categoryScores: Record<string, number>;\n    85→  measurements: FaceIQScoreResult[];\n    86→  flaws: FlawAssessment[];\n    87→  strengths: StrengthAssessment[];\n    88→}\n    89→\n    90→export interface FlawAssessment {\n    91→  category: string;\n    92→  metricId: string;\n    93→  metricName: string;\n    94→  severity: SeverityLevel;\n    95→  deviation: string;\n    96→  reasoning: string;\n    97→  confidence: 'confirmed' | 'likely' | 'possible';\n    98→}\n    99→\n   100→export interface StrengthAssessment {\n   101→  category: string;\n   102→  metricId: string;\n   103→  metricName: string;\n   104→  qualityTier: QualityTier;\n   105→  value: number;\n   106→  reasoning: string;\n   107→}\n   108→\n   109→// ============================================\n   110→// DEMOGRAPHIC TYPES & OVERRIDES\n   111→// ============================================\n   112→\n   113→export type Ethnicity =\n   114→  | 'east_asian'\n   115→  | 'south_asian'\n   116→  | 'black'\n   117→  | 'hispanic'\n   118→  | 'middle_eastern'\n   119→  | 'native_american'\n   120→  | 'pacific_islander'\n   121→  | 'white'\n   122→  | 'other';\n   123→\n   124→export type Gender = 'male' | 'female';\n   125→\n   126→export type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n   127→\n   128→export interface DemographicOverride {\n   129→  idealMin: number;\n   130→  idealMax: number;\n   131→}\n   132→\n   133→/**\n   134→ * Demographic-specific ideal ranges based on anthropometric research.\n   135→ * FaceIQ uses universal scoring, but this gives more accurate assessments\n   136→ * by adjusting ideals based on ethnicity and gender.\n   137→ */\n   138→export const DEMOGRAPHIC_OVERRIDES: Record<string, Partial<Record<DemographicKey, DemographicOverride>>> = {\n   139→  // ==========================================\n   140→  // NOSE METRICS - Highest ethnicity variation\n   141→  // ==========================================\n   142→  nasalIndex: {\n   143→    // Nasal Index = (Nose Width / Nose Height) × 100\n   144→    // Research: African/Pacific Islander tend platyrrhine (85-100), Asian mesorrhine (75-88), European leptorrhine (65-75)\n   145→    east_asian_male: { idealMin: 78, idealMax: 88 },\n   146→    east_asian_female: { idealMin: 76, idealMax: 86 },\n   147→    south_asian_male: { idealMin: 72, idealMax: 82 },\n   148→    south_asian_female: { idealMin: 70, idealMax: 80 },\n   149→    black_male: { idealMin: 85, idealMax: 100 },\n   150→    black_female: { idealMin: 83, idealMax: 98 },\n   151→    hispanic_male: { idealMin: 75, idealMax: 87 },\n   152→    hispanic_female: { idealMin: 73, idealMax: 85 },\n   153→    middle_eastern_male: { idealMin: 68, idealMax: 78 },\n   154→    middle_eastern_female: { idealMin: 66, idealMax: 76 },\n   155→    white_male: { idealMin: 65, idealMax: 75 },\n   156→    white_female: { idealMin: 63, idealMax: 73 },\n   157→    native_american_male: { idealMin: 72, idealMax: 82 },\n   158→    native_american_female: { idealMin: 70, idealMax: 80 },\n   159→    pacific_islander_male: { idealMin: 82, idealMax: 95 },\n   160→    pacific_islander_female: { idealMin: 80, idealMax: 93 },\n   161→  },\n   162→\n   163→  nasolabialAngle: {\n   164→    // Ideal nasolabial angle varies by ethnicity\n   165→    // African: slightly more obtuse, European: slightly more acute\n   166→    black_male: { idealMin: 95, idealMax: 110 },\n   167→    black_female: { idealMin: 100, idealMax: 115 },\n   168→    east_asian_male: { idealMin: 90, idealMax: 105 },\n   169→    east_asian_female: { idealMin: 95, idealMax: 110 },\n   170→    // Gender-only fallbacks\n   171→    male: { idealMin: 90, idealMax: 100 },\n   172→    female: { idealMin: 100, idealMax: 110 },\n   173→  },\n   174→\n   175→  nasalProjection: {\n   176→    // Nose projection relative to face depth\n   177→    // East Asian/African: typically less projection is ideal\n   178→    east_asian: { idealMin: 0.54, idealMax: 0.60 },\n   179→    black: { idealMin: 0.52, idealMax: 0.58 },\n   180→    south_asian: { idealMin: 0.56, idealMax: 0.62 },\n   181→    middle_eastern: { idealMin: 0.62, idealMax: 0.68 },\n   182→    white: { idealMin: 0.60, idealMax: 0.67 },\n   183→    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },\n   184→  },\n   185→\n   186→  // ==========================================\n   187→  // JAW METRICS - Clear gender dimorphism\n   188→  // ==========================================\n   189→  bigonialWidth: {\n   190→    // Jaw width as % of bizygomatic width\n   191→    // Males: wider, more angular; Females: narrower, softer\n   192→    male: { idealMin: 90, idealMax: 95 },\n   193→    female: { idealMin: 85, idealMax: 90 },\n   194→  },\n   195→\n   196→  jawFrontalAngle: {\n   197→    // More angular in males, softer in females\n   198→    male: { idealMin: 88, idealMax: 95 },\n   199→    female: { idealMin: 82, idealMax: 90 },\n   200→  },\n   201→\n   202→  jawWidthRatio: {\n   203→    // Males have stronger jaw width preference\n   204→    male: { idealMin: 0.78, idealMax: 0.85 },\n   205→    female: { idealMin: 0.72, idealMax: 0.80 },\n   206→  },\n   207→\n   208→  gonialAngle: {\n   209→    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n   210→    male: { idealMin: 115, idealMax: 125 },\n   211→    female: { idealMin: 120, idealMax: 135 },\n   212→  },\n   213→\n   214→  // ==========================================\n   215→  // EYE METRICS - Ethnic variation\n   216→  // ==========================================\n   217→  lateralCanthalTilt: {\n   218→    // East Asian: naturally higher positive tilt\n   219→    east_asian_male: { idealMin: 8, idealMax: 12 },\n   220→    east_asian_female: { idealMin: 9, idealMax: 13 },\n   221→    south_asian_male: { idealMin: 6, idealMax: 10 },\n   222→    south_asian_female: { idealMin: 7, idealMax: 11 },\n   223→    // Default for others is 6-8 (already in FACEIQ_METRICS)\n   224→  },\n   225→\n   226→  eyeAspectRatio: {\n   227→    // East Asian eyes often have different aspect ratio due to epicanthal fold\n   228→    east_asian_male: { idealMin: 2.6, idealMax: 3.2 },\n   229→    east_asian_female: { idealMin: 2.7, idealMax: 3.3 },\n   230→    // Larger eyes in females considered more attractive\n   231→    male: { idealMin: 2.9, idealMax: 3.4 },\n   232→    female: { idealMin: 3.1, idealMax: 3.6 },\n   233→  },\n   234→\n   235→  // ==========================================\n   236→  // FACE PROPORTIONS - Gender variation\n   237→  // ==========================================\n   238→  faceWidthToHeight: {\n   239→    // Males: slightly wider face preferred; Females: slightly narrower\n   240→    male: { idealMin: 1.98, idealMax: 2.02 },\n   241→    female: { idealMin: 1.94, idealMax: 1.98 },\n   242→  },\n   243→\n   244→  totalFacialWidthToHeight: {\n   245→    male: { idealMin: 1.35, idealMax: 1.40 },\n   246→    female: { idealMin: 1.32, idealMax: 1.37 },\n   247→  },\n   248→\n   249→  midfaceRatio: {\n   250→    // Females often have more compact midface\n   251→    male: { idealMin: 0.98, idealMax: 1.02 },\n   252→    female: { idealMin: 0.95, idealMax: 1.00 },\n   253→  },\n   254→\n   255→  // ==========================================\n   256→  // LIP METRICS - Ethnicity variation\n   257→  // ==========================================\n   258→  lipRatio: {\n   259→    // African/Hispanic: fuller lips natural\n   260→    black_male: { idealMin: 1.6, idealMax: 2.2 },\n   261→    black_female: { idealMin: 1.7, idealMax: 2.3 },\n   262→    hispanic_male: { idealMin: 1.4, idealMax: 2.0 },\n   263→    hispanic_female: { idealMin: 1.5, idealMax: 2.1 },\n   264→    // East Asian: less full lips\n   265→    east_asian_male: { idealMin: 1.2, idealMax: 1.7 },\n   266→    east_asian_female: { idealMin: 1.3, idealMax: 1.8 },\n   267→    // Default\n   268→    male: { idealMin: 1.3, idealMax: 1.8 },\n   269→    female: { idealMin: 1.4, idealMax: 2.0 },\n   270→  },\n   271→\n   272→  upperLipRatio: {\n   273→    // Fuller upper lip in African phenotypes\n   274→    black: { idealMin: 0.38, idealMax: 0.48 },\n   275→    hispanic: { idealMin: 0.36, idealMax: 0.45 },\n   276→    east_asian: { idealMin: 0.32, idealMax: 0.40 },\n   277→    female: { idealMin: 0.34, idealMax: 0.42 },\n   278→  },\n   279→\n   280→  // ==========================================\n   281→  // PROFILE METRICS - Gender & ethnicity\n   282→  // ==========================================\n   283→  chinProjection: {\n   284→    // Males: more projected chin ideal\n   285→    male: { idealMin: 0, idealMax: 3 },\n   286→    female: { idealMin: -2, idealMax: 2 },\n   287→  },\n   288→\n   289→  nasofrontalAngle: {\n   290→    // Higher brow ridge in males\n   291→    male: { idealMin: 128, idealMax: 138 },\n   292→    female: { idealMin: 132, idealMax: 142 },\n   293→  },\n   294→};\n   295→\n   296→/**\n   297→ * Get metric configuration with demographic-specific overrides applied.\n   298→ * Lookup priority: ethnicity_gender > gender > ethnicity > default\n   299→ */\n   300→export function getMetricConfigForDemographics(\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"bc73ae22-989b-4d45-973b-a96f2106783a","timestamp":"2025-12-20T20:51:18.786Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","content":"/**\n * FaceIQ-Style Facial Analysis Scoring System\n * Complete replication of FaceIQ Labs scoring algorithms\n *\n * Features:\n * - Exponential decay scoring with per-metric decay rates\n * - Bezier curve custom scoring for non-linear measurements\n * - 70+ facial measurements (front + side profiles)\n * - Quality tiers: Ideal, Excellent, Good\n * - 5-tier severity: Extremely Severe, Severe, Major, Moderate, Minor\n */\n\nimport { LandmarkPoint } from './landmarks';\n\n// ============================================\n// CORE TYPES\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\nexport interface MetricConfig {\n  id: string;\n  name: string;\n  category: string;\n  unit: MeasurementUnit;\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  decayRate: number;\n  maxScore: number;\n  weight: number;\n  description: string;\n  profileType: 'front' | 'side';\n  customCurve?: BezierCurveConfig;\n}\n\nexport interface BezierCurveConfig {\n  mode: 'custom' | 'exponential';\n  points: CurvePoint[];\n}\n\nexport interface CurvePoint {\n  x: number;\n  y: number;\n  leftHandleX?: number;\n  leftHandleY?: number;\n  rightHandleX?: number;\n  rightHandleY?: number;\n  fixed?: boolean;\n}\n\nexport interface FaceIQScoreResult {\n  metricId: string;\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  severity: SeverityLevel;\n  idealMin: number;\n  idealMax: number;\n  deviation: number;\n  deviationDirection: 'above' | 'below' | 'within';\n  unit: MeasurementUnit;\n  category: string;\n  percentile?: number;\n}\n\nexport interface HarmonyAnalysis {\n  overallScore: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  percentile: number;\n  frontScore: number;\n  sideScore: number;\n  categoryScores: Record<string, number>;\n  measurements: FaceIQScoreResult[];\n  flaws: FlawAssessment[];\n  strengths: StrengthAssessment[];\n}\n\nexport interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n}\n\nexport interface StrengthAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  qualityTier: QualityTier;\n  value: number;\n  reasoning: string;\n}\n\n// ============================================\n// DEMOGRAPHIC TYPES & OVERRIDES\n// ============================================\n\nexport type Ethnicity =\n  | 'east_asian'\n  | 'south_asian'\n  | 'black'\n  | 'hispanic'\n  | 'middle_eastern'\n  | 'native_american'\n  | 'pacific_islander'\n  | 'white'\n  | 'other';\n\nexport type Gender = 'male' | 'female';\n\nexport type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n\nexport interface DemographicOverride {\n  idealMin: number;\n  idealMax: number;\n}\n\n/**\n * Demographic-specific ideal ranges based on anthropometric research.\n * FaceIQ uses universal scoring, but this gives more accurate assessments\n * by adjusting ideals based on ethnicity and gender.\n */\nexport const DEMOGRAPHIC_OVERRIDES: Record<string, Partial<Record<DemographicKey, DemographicOverride>>> = {\n  // ==========================================\n  // NOSE METRICS - Highest ethnicity variation\n  // ==========================================\n  nasalIndex: {\n    // Nasal Index = (Nose Width / Nose Height) × 100\n    // Research: African/Pacific Islander tend platyrrhine (85-100), Asian mesorrhine (75-88), European leptorrhine (65-75)\n    east_asian_male: { idealMin: 78, idealMax: 88 },\n    east_asian_female: { idealMin: 76, idealMax: 86 },\n    south_asian_male: { idealMin: 72, idealMax: 82 },\n    south_asian_female: { idealMin: 70, idealMax: 80 },\n    black_male: { idealMin: 85, idealMax: 100 },\n    black_female: { idealMin: 83, idealMax: 98 },\n    hispanic_male: { idealMin: 75, idealMax: 87 },\n    hispanic_female: { idealMin: 73, idealMax: 85 },\n    middle_eastern_male: { idealMin: 68, idealMax: 78 },\n    middle_eastern_female: { idealMin: 66, idealMax: 76 },\n    white_male: { idealMin: 65, idealMax: 75 },\n    white_female: { idealMin: 63, idealMax: 73 },\n    native_american_male: { idealMin: 72, idealMax: 82 },\n    native_american_female: { idealMin: 70, idealMax: 80 },\n    pacific_islander_male: { idealMin: 82, idealMax: 95 },\n    pacific_islander_female: { idealMin: 80, idealMax: 93 },\n  },\n\n  nasolabialAngle: {\n    // Ideal nasolabial angle varies by ethnicity\n    // African: slightly more obtuse, European: slightly more acute\n    black_male: { idealMin: 95, idealMax: 110 },\n    black_female: { idealMin: 100, idealMax: 115 },\n    east_asian_male: { idealMin: 90, idealMax: 105 },\n    east_asian_female: { idealMin: 95, idealMax: 110 },\n    // Gender-only fallbacks\n    male: { idealMin: 90, idealMax: 100 },\n    female: { idealMin: 100, idealMax: 110 },\n  },\n\n  nasalProjection: {\n    // Nose projection relative to face depth\n    // East Asian/African: typically less projection is ideal\n    east_asian: { idealMin: 0.54, idealMax: 0.60 },\n    black: { idealMin: 0.52, idealMax: 0.58 },\n    south_asian: { idealMin: 0.56, idealMax: 0.62 },\n    middle_eastern: { idealMin: 0.62, idealMax: 0.68 },\n    white: { idealMin: 0.60, idealMax: 0.67 },\n    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },\n  },\n\n  // ==========================================\n  // JAW METRICS - Clear gender dimorphism\n  // ==========================================\n  bigonialWidth: {\n    // Jaw width as % of bizygomatic width\n    // Males: wider, more angular; Females: narrower, softer\n    male: { idealMin: 90, idealMax: 95 },\n    female: { idealMin: 85, idealMax: 90 },\n  },\n\n  jawFrontalAngle: {\n    // More angular in males, softer in females\n    male: { idealMin: 88, idealMax: 95 },\n    female: { idealMin: 82, idealMax: 90 },\n  },\n\n  jawWidthRatio: {\n    // Males have stronger jaw width preference\n    male: { idealMin: 0.78, idealMax: 0.85 },\n    female: { idealMin: 0.72, idealMax: 0.80 },\n  },\n\n  gonialAngle: {\n    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n    male: { idealMin: 115, idealMax: 125 },\n    female: { idealMin: 120, idealMax: 135 },\n  },\n\n  // ==========================================\n  // EYE METRICS - Ethnic variation\n  // ==========================================\n  lateralCanthalTilt: {\n    // East Asian: naturally higher positive tilt\n    east_asian_male: { idealMin: 8, idealMax: 12 },\n    east_asian_female: { idealMin: 9, idealMax: 13 },\n    south_asian_male: { idealMin: 6, idealMax: 10 },\n    south_asian_female: { idealMin: 7, idealMax: 11 },\n    // Default for others is 6-8 (already in FACEIQ_METRICS)\n  },\n\n  eyeAspectRatio: {\n    // East Asian eyes often have different aspect ratio due to epicanthal fold\n    east_asian_male: { idealMin: 2.6, idealMax: 3.2 },\n    east_asian_female: { idealMin: 2.7, idealMax: 3.3 },\n    // Larger eyes in females considered more attractive\n    male: { idealMin: 2.9, idealMax: 3.4 },\n    female: { idealMin: 3.1, idealMax: 3.6 },\n  },\n\n  // ==========================================\n  // FACE PROPORTIONS - Gender variation\n  // ==========================================\n  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n  },\n\n  totalFacialWidthToHeight: {\n    male: { idealMin: 1.35, idealMax: 1.40 },\n    female: { idealMin: 1.32, idealMax: 1.37 },\n  },\n\n  midfaceRatio: {\n    // Females often have more compact midface\n    male: { idealMin: 0.98, idealMax: 1.02 },\n    female: { idealMin: 0.95, idealMax: 1.00 },\n  },\n\n  // ==========================================\n  // LIP METRICS - Ethnicity variation\n  // ==========================================\n  lipRatio: {\n    // African/Hispanic: fuller lips natural\n    black_male: { idealMin: 1.6, idealMax: 2.2 },\n    black_female: { idealMin: 1.7, idealMax: 2.3 },\n    hispanic_male: { idealMin: 1.4, idealMax: 2.0 },\n    hispanic_female: { idealMin: 1.5, idealMax: 2.1 },\n    // East Asian: less full lips\n    east_asian_male: { idealMin: 1.2, idealMax: 1.7 },\n    east_asian_female: { idealMin: 1.3, idealMax: 1.8 },\n    // Default\n    male: { idealMin: 1.3, idealMax: 1.8 },\n    female: { idealMin: 1.4, idealMax: 2.0 },\n  },\n\n  upperLipRatio: {\n    // Fuller upper lip in African phenotypes\n    black: { idealMin: 0.38, idealMax: 0.48 },\n    hispanic: { idealMin: 0.36, idealMax: 0.45 },\n    east_asian: { idealMin: 0.32, idealMax: 0.40 },\n    female: { idealMin: 0.34, idealMax: 0.42 },\n  },\n\n  // ==========================================\n  // PROFILE METRICS - Gender & ethnicity\n  // ==========================================\n  chinProjection: {\n    // Males: more projected chin ideal\n    male: { idealMin: 0, idealMax: 3 },\n    female: { idealMin: -2, idealMax: 2 },\n  },\n\n  nasofrontalAngle: {\n    // Higher brow ridge in males\n    male: { idealMin: 128, idealMax: 138 },\n    female: { idealMin: 132, idealMax: 142 },\n  },\n};\n\n/**\n * Get metric configuration with demographic-specific overrides applied.\n * Lookup priority: ethnicity_gender > gender > ethnicity > default\n */\nexport function getMetricConfigForDemographics(","numLines":300,"startLine":1,"totalLines":2680}}}
{"parentUuid":"bc73ae22-989b-4d45-973b-a96f2106783a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0131e7JcANiKPgpQix2rzpWW","type":"tool_result","content":"1517:export const METRIC_FLAW_MAPPINGS: Record<string, FlawMapping[]> = {"}]},"uuid":"2e56cc29-4a0b-40f6-ba56-a90b3865a97a","timestamp":"2025-12-20T20:51:19.101Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"1517:export const METRIC_FLAW_MAPPINGS: Record<string, FlawMapping[]> = {","numLines":1}}
{"parentUuid":"2e56cc29-4a0b-40f6-ba56-a90b3865a97a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01V4oHRSoaFjWJZYmrwFsdLL","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"There's already a `METRIC_FLAW_MAPPINGS` at line 1517. Let me look at that to understand the current structure and see what's already been done. Let me also check out all the FACEIQ_METRICS to understand the metric IDs so I can expand the illustration configs.","signature":"Eq0DCkYIChgCKkB0tukfyrnVJZ30jz94nupcLFOCQe2J7U/fhLjS0QOVrqcJlsjZGtHQZg2t1hhbhAfo6YmC2a2cky0s91dx3bmBEgy83aZl/kKjzvOConsaDH3yiUCddHm+AYhxbiIwCt1sdDcUFLvlSASI8L3QQtfzPD71N5xDbHTDcE3SRZfDb/8F5xvEojR8VDHKASYYKpQCpOAcOgNxukoFcW9m2E76MPeTvVlcPZmmD03ZWhiyg3CMl2VwjTOReEi86mnpjBRYC4zkgfQmqr10rewhQeRKRxgPrNLki+Ab1rwP6ARASbbz45y0NBXCgEsW/jumC8w1m9IvyBoK5YufeWLw5nZQPcS7ADmtSpj2Qv5LzRky4hTaVlbegr6f1jEYBSYsj9hinawxCQMKT/9rZ2xyEW58PA9FHmHwkQD5MiP/5KUoUrVwb8EBlnB4Mxsb49hk6yL6PjyIBT5mawuGOQ9ZAZfXvO61PbtJEKZbkOerrgztIoNTPa4/qYPQCxiVtqkDr+BHa0vEGivb70Q8+vImYMohYF/N6+sUyHXJxgTNohb8Tl4MHdkrGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":4936,"cache_read_input_tokens":53247,"cache_creation":{"ephemeral_5m_input_tokens":4936,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbmZyX365CrMtTWbnja","type":"assistant","uuid":"ca3bc6fa-7a1c-4e29-9561-d1697e49d8c3","timestamp":"2025-12-20T20:51:22.873Z"}
{"parentUuid":"ca3bc6fa-7a1c-4e29-9561-d1697e49d8c3","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01V4oHRSoaFjWJZYmrwFsdLL","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AaEnXec9dQEsjYcxQxjFUj","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","offset":1517,"limit":150}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":4936,"cache_read_input_tokens":53247,"cache_creation":{"ephemeral_5m_input_tokens":4936,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbmZyX365CrMtTWbnja","type":"assistant","uuid":"f231ff21-6a52-4bea-af86-7515c940edf0","timestamp":"2025-12-20T20:51:24.542Z"}
{"parentUuid":"f231ff21-6a52-4bea-af86-7515c940edf0","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01V4oHRSoaFjWJZYmrwFsdLL","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XyJJNuXP4sHh8bKt92BmnY","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","offset":350,"limit":400}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":4936,"cache_read_input_tokens":53247,"cache_creation":{"ephemeral_5m_input_tokens":4936,"ephemeral_1h_input_tokens":0},"output_tokens":294,"service_tier":"standard"}},"requestId":"req_011CWJbmZyX365CrMtTWbnja","type":"assistant","uuid":"c5b4b6e7-bb38-4ce6-a8cb-c8aab606c692","timestamp":"2025-12-20T20:51:25.567Z"}
{"parentUuid":"c5b4b6e7-bb38-4ce6-a8cb-c8aab606c692","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AaEnXec9dQEsjYcxQxjFUj","type":"tool_result","content":"  1517→export const METRIC_FLAW_MAPPINGS: Record<string, FlawMapping[]> = {\n  1518→  anteriorFacialDepth: [\n  1519→    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Anterior Facial Depth measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  1520→  ],\n  1521→  bitemporalWidth: [\n  1522→    { category: 'Upper Third', flawName: 'Narrow forehead', confidence: 'confirmed', reasoning: 'Reduced bitemporal width indicates a narrower than ideal forehead relative to the cheekbones. This disrupts facial harmony by creating a compressed hairline and forehead, altering the overall shape of the face.' },\n  1523→  ],\n  1524→  cheekboneHeight: [\n  1525→    { category: 'Midface/Face Shape', flawName: 'Low-set cheekbones', confidence: 'confirmed', reasoning: 'Reduced cheekbone height indicates that the cheekbones are positioned lower than ideal. This disrupts facial harmony by creating an unpronounced appearance to the cheekbones and facial structure.' },\n  1526→  ],\n  1527→  eyeAspectRatio: [\n  1528→    { category: 'Eyes', flawName: 'Overly round eye shape', confidence: 'confirmed', reasoning: 'A reduced eye aspect ratio indicates overly narrow eyes relative to their height. This disrupts facial harmony by creating an overly surprised appearance and reducing angular definition.' },\n  1529→  ],\n  1530→  eyeSeparationRatio: [\n  1531→    { category: 'Eyes', flawName: 'Close-set eyes', confidence: 'confirmed', reasoning: 'Reduced eye separation indicates close-set eyes. This disrupts facial harmony by making the eye area appear too compressed.' },\n  1532→  ],\n  1533→  eyebrowLowSetedness: [\n  1534→    { category: 'Eyes', flawName: 'Medium-set eyebrows', confidence: 'confirmed', reasoning: 'Increased eyebrow low setedness indicates eyebrows that are positioned higher than ideal. This disrupts facial harmony by reducing the overall visual impact of the eyebrows and framing of the eyes.' },\n  1535→  ],\n  1536→  faceWidthToHeight: [\n  1537→    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced face width to height ratio indicates an overly long midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  1538→  ],\n  1539→  facialDepthToHeight: [\n  1540→    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'Reduced facial depth to height ratio indicates insufficient mid-face projection relative to height. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  1541→  ],\n  1542→  gonialAngle: [\n  1543→    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony in the lower face.' },\n  1544→    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  1545→  ],\n  1546→  holdawayHLine: [\n  1547→    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'Decreased H-line indicates the lips are positioned too far in front of the line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  1548→  ],\n  1549→  interiorMidfaceProjectionAngle: [\n  1550→    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Interior Midface Projection Angle measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  1551→  ],\n  1552→  ipsilateralAlarAngle: [\n  1553→    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A decreased ipsilateral alar angle indicates an overly narrow interior midface. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  1554→  ],\n  1555→  jawFrontalAngle: [\n  1556→    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A narrower jaw frontal angle indicates a steeper jawline or overly wide chin. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  1557→  ],\n  1558→  jawSlope: [\n  1559→    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'The Jaw Slope measurement is above the ideal range. This disrupts facial harmony in the lower face.' },\n  1560→  ],\n  1561→  lateralCanthalTilt: [\n  1562→    { category: 'Eyes', flawName: 'Insufficient eye tilt', confidence: 'confirmed', reasoning: 'A decreased lateral canthal tilt indicates insufficiently upturned eyes. This disrupts facial harmony by creating a less alert and youthful appearance.' },\n  1563→  ],\n  1564→  burstoneLowerLip: [\n  1565→    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the Burstone line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  1566→  ],\n  1567→  eLineLowerLip: [\n  1568→    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned too far in front of the E-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  1569→  ],\n  1570→  sLineLowerLip: [\n  1571→    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the S-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  1572→  ],\n  1573→  lowerThirdProportion: [\n  1574→    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'The upper jaw is too long relative to lower jaw, possibly from a long upper jaw or short lower jaw, or a combination of both. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  1575→  ],\n  1576→  mandibularPlaneAngle: [\n  1577→    { category: 'Occlusion/Jaw Growth', flawName: 'Hyper-divergent jaw growth', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by elongating the lower face.' },\n  1578→    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony in the lower face.' },\n  1579→    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  1580→  ],\n  1581→  midfaceRatio: [\n  1582→    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  1583→    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  1584→  ],\n  1585→  nasofacialAngle: [\n  1586→    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A smaller nasofacial angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  1587→  ],\n  1588→  nasofrontalAngle: [\n  1589→    { category: 'Upper Third', flawName: 'Soft and weak brow ridge', confidence: 'confirmed', reasoning: 'An increased nasofrontal angle indicates reduced brow ridge prominence and angularity. This disrupts facial harmony by creating a less defined upper face.' },\n  1590→  ],\n  1591→  nasomentaAngle: [\n  1592→    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A larger nasomental angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  1593→  ],\n  1594→  noseBridgeWidth: [\n  1595→    { category: 'Nose', flawName: 'Overly narrow nose bridge', confidence: 'confirmed', reasoning: 'The Nose Bridge to Nose Width measurement is above the ideal range. This disrupts facial harmony by creating an unbalanced nasal profile.' },\n  1596→  ],\n  1597→  orbitalVector: [\n  1598→    { category: 'Eyes', flawName: 'Sunken orbital region', confidence: 'confirmed', reasoning: 'A decreased orbital vector indicates insufficient projection and volume underneath the eye. This disrupts facial harmony due to the lacking volume underneath the eyes, reducing vibrancy and youthfulness.' },\n  1599→  ],\n  1600→  ramusToMandibleRatio: [\n  1601→    { category: 'Jaw Shape', flawName: 'Short ramus', confidence: 'confirmed', reasoning: 'A reduced ramus-to-mandible ratio indicates a shorter than ideal vertical jawbone (ramus) when compared to the mandible. This disrupts facial harmony by reducing jaw height and definition.' },\n  1602→  ],\n  1603→  submentalCervicalAngle: [\n  1604→    { category: 'Neck', flawName: 'Round neck region', confidence: 'confirmed', reasoning: 'An increased submental cervical angle indicates a round neck region, possibly from excess submental fat or tissue. This disrupts facial harmony by reducing neck definition.' },\n  1605→  ],\n  1606→  totalFacialWidthToHeight: [\n  1607→    { category: 'Midface/Face Shape', flawName: 'Overly long face shape', confidence: 'confirmed', reasoning: 'An increased total facial width to height ratio indicates an overly long face relative to its height. This disrupts facial harmony by creating a vertically stretched appearance to the face.' },\n  1608→  ],\n  1609→};\n  1610→\n  1611→// ============================================\n  1612→// CUSTOM BEZIER CURVES (Extracted from FaceIQ)\n  1613→// ============================================\n  1614→\n  1615→export const METRIC_CUSTOM_CURVES: Record<string, CurvePoint[]> = {\n  1616→  faceWidthToHeight: [\n  1617→    { x: 1.49, y: 0, leftHandleX: 1.44, leftHandleY: 0, rightHandleX: 1.55, rightHandleY: 0 },\n  1618→    { x: 1.68, y: 1.05, leftHandleX: 1.62, leftHandleY: 0.36, rightHandleX: 1.71, rightHandleY: 1.58 },\n  1619→    { x: 1.77, y: 3.07, leftHandleX: 1.74, leftHandleY: 2.15, rightHandleX: 1.79, rightHandleY: 3.88 },\n  1620→    { x: 1.83, y: 5.83, leftHandleX: 1.80, leftHandleY: 4.64, rightHandleX: 1.84, rightHandleY: 6.85 },\n  1621→    { x: 1.89, y: 8.70, leftHandleX: 1.88, leftHandleY: 8.30, rightHandleX: 1.92, rightHandleY: 9.50 },\n  1622→    { x: 1.96, y: 10, leftHandleX: 1.96, leftHandleY: 10, rightHandleX: 1.96, rightHandleY: 10, fixed: true },\n  1623→    { x: 2.00, y: 10, leftHandleX: 2.00, leftHandleY: 10, rightHandleX: 2.00, rightHandleY: 10, fixed: true },\n  1624→    { x: 2.07, y: 8.70, leftHandleX: 2.04, leftHandleY: 9.50, rightHandleX: 2.08, rightHandleY: 8.30 },\n  1625→    { x: 2.13, y: 5.83, leftHandleX: 2.12, leftHandleY: 6.85, rightHandleX: 2.16, rightHandleY: 4.64 },\n  1626→    { x: 2.19, y: 3.07, leftHandleX: 2.17, leftHandleY: 3.88, rightHandleX: 2.22, rightHandleY: 2.15 },\n  1627→    { x: 2.28, y: 1.05, leftHandleX: 2.25, leftHandleY: 1.58, rightHandleX: 2.34, rightHandleY: 0.36 },\n  1628→    { x: 2.47, y: 0, leftHandleX: 2.41, leftHandleY: 0, rightHandleX: 2.52, rightHandleY: 0 },\n  1629→  ],\n  1630→  lowerThirdProportion: [\n  1631→    { x: 25.6, y: 0, leftHandleX: 24.8, leftHandleY: 0, rightHandleX: 26.4, rightHandleY: 0 },\n  1632→    { x: 28.01, y: 1.58, leftHandleX: 27.23, leftHandleY: 0.53, rightHandleX: 28.27, rightHandleY: 1.97 },\n  1633→    { x: 28.83, y: 3.21, leftHandleX: 28.60, leftHandleY: 2.60, rightHandleX: 29.10, rightHandleY: 3.90 },\n  1634→    { x: 29.63, y: 5.85, leftHandleX: 29.40, leftHandleY: 4.90, rightHandleX: 29.85, rightHandleY: 6.80 },\n  1635→    { x: 30.27, y: 8.56, leftHandleX: 30.05, leftHandleY: 7.80, rightHandleX: 30.50, rightHandleY: 9.30 },\n  1636→    { x: 31, y: 10, leftHandleX: 30.95, leftHandleY: 10, rightHandleX: 31.05, rightHandleY: 10, fixed: true },\n  1637→    { x: 33.5, y: 10, leftHandleX: 33.45, leftHandleY: 10, rightHandleX: 33.55, rightHandleY: 10, fixed: true },\n  1638→    { x: 34.23, y: 8.56, leftHandleX: 34.00, leftHandleY: 9.30, rightHandleX: 34.45, rightHandleY: 7.80 },\n  1639→    { x: 34.87, y: 5.85, leftHandleX: 34.65, leftHandleY: 6.80, rightHandleX: 35.10, rightHandleY: 4.90 },\n  1640→    { x: 35.67, y: 3.21, leftHandleX: 35.40, leftHandleY: 3.90, rightHandleX: 35.90, rightHandleY: 2.60 },\n  1641→    { x: 36.49, y: 1.58, leftHandleX: 36.23, leftHandleY: 1.97, rightHandleX: 37.27, rightHandleY: 0.53 },\n  1642→    { x: 38.9, y: 0, leftHandleX: 38.1, leftHandleY: 0, rightHandleX: 39.7, rightHandleY: 0 },\n  1643→  ],\n  1644→  lateralCanthalTilt: [\n  1645→    { x: -4.5, y: 0, leftHandleX: -5.5, leftHandleY: 0, rightHandleX: -3.5, rightHandleY: 0 },\n  1646→    { x: 0.5, y: 1.2, leftHandleX: -0.8, leftHandleY: 0.4, rightHandleX: 1.5, rightHandleY: 1.8 },\n  1647→    { x: 2.8, y: 3.5, leftHandleX: 2.2, leftHandleY: 2.5, rightHandleX: 3.4, rightHandleY: 4.3 },\n  1648→    { x: 4.5, y: 6.8, leftHandleX: 4.0, leftHandleY: 5.5, rightHandleX: 5.0, rightHandleY: 7.8 },\n  1649→    { x: 5.8, y: 9.2, leftHandleX: 5.4, leftHandleY: 8.5, rightHandleX: 5.95, rightHandleY: 9.7 },\n  1650→    { x: 6.1, y: 10, leftHandleX: 6.05, leftHandleY: 10, rightHandleX: 6.15, rightHandleY: 10, fixed: true },\n  1651→    { x: 7.8, y: 10, leftHandleX: 7.75, leftHandleY: 10, rightHandleX: 7.85, rightHandleY: 10, fixed: true },\n  1652→    { x: 8.1, y: 9.2, leftHandleX: 7.95, leftHandleY: 9.7, rightHandleX: 8.5, rightHandleY: 8.5 },\n  1653→    { x: 9.4, y: 6.8, leftHandleX: 8.9, leftHandleY: 7.8, rightHandleX: 9.9, rightHandleY: 5.5 },\n  1654→    { x: 11.1, y: 3.5, leftHandleX: 10.5, leftHandleY: 4.3, rightHandleX: 11.7, rightHandleY: 2.5 },\n  1655→    { x: 13.4, y: 1.2, leftHandleX: 12.4, leftHandleY: 1.8, rightHandleX: 14.7, rightHandleY: 0.4 },\n  1656→    { x: 18.4, y: 0, leftHandleX: 17.4, leftHandleY: 0, rightHandleX: 19.4, rightHandleY: 0 },\n  1657→  ],\n  1658→  gonialAngle: [\n  1659→    { x: 105, y: 0, leftHandleX: 102, leftHandleY: 0, rightHandleX: 108, rightHandleY: 0 },\n  1660→    { x: 112, y: 1.5, leftHandleX: 110, leftHandleY: 0.5, rightHandleX: 114, rightHandleY: 2.3 },\n  1661→    { x: 116, y: 4.2, leftHandleX: 114.5, leftHandleY: 3.0, rightHandleX: 117.5, rightHandleY: 5.2 },\n  1662→    { x: 118.5, y: 7.5, leftHandleX: 117.5, leftHandleY: 6.3, rightHandleX: 119.5, rightHandleY: 8.5 },\n  1663→    { x: 120, y: 10, leftHandleX: 119.7, leftHandleY: 10, rightHandleX: 120.3, rightHandleY: 10, fixed: true },\n  1664→    { x: 130, y: 10, leftHandleX: 129.7, leftHandleY: 10, rightHandleX: 130.3, rightHandleY: 10, fixed: true },\n  1665→    { x: 131.5, y: 7.5, leftHandleX: 130.5, leftHandleY: 8.5, rightHandleX: 132.5, rightHandleY: 6.3 },\n  1666→    { x: 134, y: 4.2, leftHandleX: 132.5, leftHandleY: 5.2, rightHandleX: 135.5, rightHandleY: 3.0 },\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"a03ea796-354f-491c-9932-3f753271bb1f","timestamp":"2025-12-20T20:51:25.602Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","content":"export const METRIC_FLAW_MAPPINGS: Record<string, FlawMapping[]> = {\n  anteriorFacialDepth: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Anterior Facial Depth measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  bitemporalWidth: [\n    { category: 'Upper Third', flawName: 'Narrow forehead', confidence: 'confirmed', reasoning: 'Reduced bitemporal width indicates a narrower than ideal forehead relative to the cheekbones. This disrupts facial harmony by creating a compressed hairline and forehead, altering the overall shape of the face.' },\n  ],\n  cheekboneHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Low-set cheekbones', confidence: 'confirmed', reasoning: 'Reduced cheekbone height indicates that the cheekbones are positioned lower than ideal. This disrupts facial harmony by creating an unpronounced appearance to the cheekbones and facial structure.' },\n  ],\n  eyeAspectRatio: [\n    { category: 'Eyes', flawName: 'Overly round eye shape', confidence: 'confirmed', reasoning: 'A reduced eye aspect ratio indicates overly narrow eyes relative to their height. This disrupts facial harmony by creating an overly surprised appearance and reducing angular definition.' },\n  ],\n  eyeSeparationRatio: [\n    { category: 'Eyes', flawName: 'Close-set eyes', confidence: 'confirmed', reasoning: 'Reduced eye separation indicates close-set eyes. This disrupts facial harmony by making the eye area appear too compressed.' },\n  ],\n  eyebrowLowSetedness: [\n    { category: 'Eyes', flawName: 'Medium-set eyebrows', confidence: 'confirmed', reasoning: 'Increased eyebrow low setedness indicates eyebrows that are positioned higher than ideal. This disrupts facial harmony by reducing the overall visual impact of the eyebrows and framing of the eyes.' },\n  ],\n  faceWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced face width to height ratio indicates an overly long midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  facialDepthToHeight: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'Reduced facial depth to height ratio indicates insufficient mid-face projection relative to height. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  gonialAngle: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  holdawayHLine: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'Decreased H-line indicates the lips are positioned too far in front of the line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  interiorMidfaceProjectionAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Interior Midface Projection Angle measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  ipsilateralAlarAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A decreased ipsilateral alar angle indicates an overly narrow interior midface. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  jawFrontalAngle: [\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A narrower jaw frontal angle indicates a steeper jawline or overly wide chin. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  jawSlope: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'The Jaw Slope measurement is above the ideal range. This disrupts facial harmony in the lower face.' },\n  ],\n  lateralCanthalTilt: [\n    { category: 'Eyes', flawName: 'Insufficient eye tilt', confidence: 'confirmed', reasoning: 'A decreased lateral canthal tilt indicates insufficiently upturned eyes. This disrupts facial harmony by creating a less alert and youthful appearance.' },\n  ],\n  burstoneLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the Burstone line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  eLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned too far in front of the E-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  sLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the S-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  lowerThirdProportion: [\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'The upper jaw is too long relative to lower jaw, possibly from a long upper jaw or short lower jaw, or a combination of both. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  mandibularPlaneAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Hyper-divergent jaw growth', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by elongating the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  midfaceRatio: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  nasofacialAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A smaller nasofacial angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  nasofrontalAngle: [\n    { category: 'Upper Third', flawName: 'Soft and weak brow ridge', confidence: 'confirmed', reasoning: 'An increased nasofrontal angle indicates reduced brow ridge prominence and angularity. This disrupts facial harmony by creating a less defined upper face.' },\n  ],\n  nasomentaAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A larger nasomental angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  noseBridgeWidth: [\n    { category: 'Nose', flawName: 'Overly narrow nose bridge', confidence: 'confirmed', reasoning: 'The Nose Bridge to Nose Width measurement is above the ideal range. This disrupts facial harmony by creating an unbalanced nasal profile.' },\n  ],\n  orbitalVector: [\n    { category: 'Eyes', flawName: 'Sunken orbital region', confidence: 'confirmed', reasoning: 'A decreased orbital vector indicates insufficient projection and volume underneath the eye. This disrupts facial harmony due to the lacking volume underneath the eyes, reducing vibrancy and youthfulness.' },\n  ],\n  ramusToMandibleRatio: [\n    { category: 'Jaw Shape', flawName: 'Short ramus', confidence: 'confirmed', reasoning: 'A reduced ramus-to-mandible ratio indicates a shorter than ideal vertical jawbone (ramus) when compared to the mandible. This disrupts facial harmony by reducing jaw height and definition.' },\n  ],\n  submentalCervicalAngle: [\n    { category: 'Neck', flawName: 'Round neck region', confidence: 'confirmed', reasoning: 'An increased submental cervical angle indicates a round neck region, possibly from excess submental fat or tissue. This disrupts facial harmony by reducing neck definition.' },\n  ],\n  totalFacialWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Overly long face shape', confidence: 'confirmed', reasoning: 'An increased total facial width to height ratio indicates an overly long face relative to its height. This disrupts facial harmony by creating a vertically stretched appearance to the face.' },\n  ],\n};\n\n// ============================================\n// CUSTOM BEZIER CURVES (Extracted from FaceIQ)\n// ============================================\n\nexport const METRIC_CUSTOM_CURVES: Record<string, CurvePoint[]> = {\n  faceWidthToHeight: [\n    { x: 1.49, y: 0, leftHandleX: 1.44, leftHandleY: 0, rightHandleX: 1.55, rightHandleY: 0 },\n    { x: 1.68, y: 1.05, leftHandleX: 1.62, leftHandleY: 0.36, rightHandleX: 1.71, rightHandleY: 1.58 },\n    { x: 1.77, y: 3.07, leftHandleX: 1.74, leftHandleY: 2.15, rightHandleX: 1.79, rightHandleY: 3.88 },\n    { x: 1.83, y: 5.83, leftHandleX: 1.80, leftHandleY: 4.64, rightHandleX: 1.84, rightHandleY: 6.85 },\n    { x: 1.89, y: 8.70, leftHandleX: 1.88, leftHandleY: 8.30, rightHandleX: 1.92, rightHandleY: 9.50 },\n    { x: 1.96, y: 10, leftHandleX: 1.96, leftHandleY: 10, rightHandleX: 1.96, rightHandleY: 10, fixed: true },\n    { x: 2.00, y: 10, leftHandleX: 2.00, leftHandleY: 10, rightHandleX: 2.00, rightHandleY: 10, fixed: true },\n    { x: 2.07, y: 8.70, leftHandleX: 2.04, leftHandleY: 9.50, rightHandleX: 2.08, rightHandleY: 8.30 },\n    { x: 2.13, y: 5.83, leftHandleX: 2.12, leftHandleY: 6.85, rightHandleX: 2.16, rightHandleY: 4.64 },\n    { x: 2.19, y: 3.07, leftHandleX: 2.17, leftHandleY: 3.88, rightHandleX: 2.22, rightHandleY: 2.15 },\n    { x: 2.28, y: 1.05, leftHandleX: 2.25, leftHandleY: 1.58, rightHandleX: 2.34, rightHandleY: 0.36 },\n    { x: 2.47, y: 0, leftHandleX: 2.41, leftHandleY: 0, rightHandleX: 2.52, rightHandleY: 0 },\n  ],\n  lowerThirdProportion: [\n    { x: 25.6, y: 0, leftHandleX: 24.8, leftHandleY: 0, rightHandleX: 26.4, rightHandleY: 0 },\n    { x: 28.01, y: 1.58, leftHandleX: 27.23, leftHandleY: 0.53, rightHandleX: 28.27, rightHandleY: 1.97 },\n    { x: 28.83, y: 3.21, leftHandleX: 28.60, leftHandleY: 2.60, rightHandleX: 29.10, rightHandleY: 3.90 },\n    { x: 29.63, y: 5.85, leftHandleX: 29.40, leftHandleY: 4.90, rightHandleX: 29.85, rightHandleY: 6.80 },\n    { x: 30.27, y: 8.56, leftHandleX: 30.05, leftHandleY: 7.80, rightHandleX: 30.50, rightHandleY: 9.30 },\n    { x: 31, y: 10, leftHandleX: 30.95, leftHandleY: 10, rightHandleX: 31.05, rightHandleY: 10, fixed: true },\n    { x: 33.5, y: 10, leftHandleX: 33.45, leftHandleY: 10, rightHandleX: 33.55, rightHandleY: 10, fixed: true },\n    { x: 34.23, y: 8.56, leftHandleX: 34.00, leftHandleY: 9.30, rightHandleX: 34.45, rightHandleY: 7.80 },\n    { x: 34.87, y: 5.85, leftHandleX: 34.65, leftHandleY: 6.80, rightHandleX: 35.10, rightHandleY: 4.90 },\n    { x: 35.67, y: 3.21, leftHandleX: 35.40, leftHandleY: 3.90, rightHandleX: 35.90, rightHandleY: 2.60 },\n    { x: 36.49, y: 1.58, leftHandleX: 36.23, leftHandleY: 1.97, rightHandleX: 37.27, rightHandleY: 0.53 },\n    { x: 38.9, y: 0, leftHandleX: 38.1, leftHandleY: 0, rightHandleX: 39.7, rightHandleY: 0 },\n  ],\n  lateralCanthalTilt: [\n    { x: -4.5, y: 0, leftHandleX: -5.5, leftHandleY: 0, rightHandleX: -3.5, rightHandleY: 0 },\n    { x: 0.5, y: 1.2, leftHandleX: -0.8, leftHandleY: 0.4, rightHandleX: 1.5, rightHandleY: 1.8 },\n    { x: 2.8, y: 3.5, leftHandleX: 2.2, leftHandleY: 2.5, rightHandleX: 3.4, rightHandleY: 4.3 },\n    { x: 4.5, y: 6.8, leftHandleX: 4.0, leftHandleY: 5.5, rightHandleX: 5.0, rightHandleY: 7.8 },\n    { x: 5.8, y: 9.2, leftHandleX: 5.4, leftHandleY: 8.5, rightHandleX: 5.95, rightHandleY: 9.7 },\n    { x: 6.1, y: 10, leftHandleX: 6.05, leftHandleY: 10, rightHandleX: 6.15, rightHandleY: 10, fixed: true },\n    { x: 7.8, y: 10, leftHandleX: 7.75, leftHandleY: 10, rightHandleX: 7.85, rightHandleY: 10, fixed: true },\n    { x: 8.1, y: 9.2, leftHandleX: 7.95, leftHandleY: 9.7, rightHandleX: 8.5, rightHandleY: 8.5 },\n    { x: 9.4, y: 6.8, leftHandleX: 8.9, leftHandleY: 7.8, rightHandleX: 9.9, rightHandleY: 5.5 },\n    { x: 11.1, y: 3.5, leftHandleX: 10.5, leftHandleY: 4.3, rightHandleX: 11.7, rightHandleY: 2.5 },\n    { x: 13.4, y: 1.2, leftHandleX: 12.4, leftHandleY: 1.8, rightHandleX: 14.7, rightHandleY: 0.4 },\n    { x: 18.4, y: 0, leftHandleX: 17.4, leftHandleY: 0, rightHandleX: 19.4, rightHandleY: 0 },\n  ],\n  gonialAngle: [\n    { x: 105, y: 0, leftHandleX: 102, leftHandleY: 0, rightHandleX: 108, rightHandleY: 0 },\n    { x: 112, y: 1.5, leftHandleX: 110, leftHandleY: 0.5, rightHandleX: 114, rightHandleY: 2.3 },\n    { x: 116, y: 4.2, leftHandleX: 114.5, leftHandleY: 3.0, rightHandleX: 117.5, rightHandleY: 5.2 },\n    { x: 118.5, y: 7.5, leftHandleX: 117.5, leftHandleY: 6.3, rightHandleX: 119.5, rightHandleY: 8.5 },\n    { x: 120, y: 10, leftHandleX: 119.7, leftHandleY: 10, rightHandleX: 120.3, rightHandleY: 10, fixed: true },\n    { x: 130, y: 10, leftHandleX: 129.7, leftHandleY: 10, rightHandleX: 130.3, rightHandleY: 10, fixed: true },\n    { x: 131.5, y: 7.5, leftHandleX: 130.5, leftHandleY: 8.5, rightHandleX: 132.5, rightHandleY: 6.3 },\n    { x: 134, y: 4.2, leftHandleX: 132.5, leftHandleY: 5.2, rightHandleX: 135.5, rightHandleY: 3.0 },","numLines":150,"startLine":1517,"totalLines":2680}}}
{"parentUuid":"a03ea796-354f-491c-9932-3f753271bb1f","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XyJJNuXP4sHh8bKt92BmnY","type":"tool_result","content":"   350→    id: 'lowerThirdProportion',\n   351→    name: 'Lower Third Proportion',\n   352→    category: 'Midface/Face Shape',\n   353→    unit: 'percent',\n   354→    idealMin: 31,\n   355→    idealMax: 33.5,\n   356→    rangeMin: 24,\n   357→    rangeMax: 40,\n   358→    decayRate: 1.86,\n   359→    maxScore: 10,\n   360→    weight: 0.03,\n   361→    description: 'Percentage of face occupied by lower third (subnasale to menton)',\n   362→    profileType: 'front',\n   363→  },\n   364→\n   365→  middleThirdProportion: {\n   366→    id: 'middleThirdProportion',\n   367→    name: 'Middle Third Proportion',\n   368→    category: 'Midface/Face Shape',\n   369→    unit: 'percent',\n   370→    idealMin: 31.4,\n   371→    idealMax: 33.4,\n   372→    rangeMin: 24,\n   373→    rangeMax: 42,\n   374→    decayRate: 1.5,\n   375→    maxScore: 10,\n   376→    weight: 0.03,\n   377→    description: 'Percentage of face occupied by middle third',\n   378→    profileType: 'front',\n   379→  },\n   380→\n   381→  upperThirdProportion: {\n   382→    id: 'upperThirdProportion',\n   383→    name: 'Upper Third Proportion',\n   384→    category: 'Midface/Face Shape',\n   385→    unit: 'percent',\n   386→    idealMin: 30,\n   387→    idealMax: 32,\n   388→    rangeMin: 24,\n   389→    rangeMax: 42,\n   390→    decayRate: 1.2,\n   391→    maxScore: 10,\n   392→    weight: 0.02,\n   393→    description: 'Percentage of face occupied by upper third (trichion to glabella)',\n   394→    profileType: 'front',\n   395→  },\n   396→\n   397→  bitemporalWidth: {\n   398→    id: 'bitemporalWidth',\n   399→    name: 'Bitemporal Width',\n   400→    category: 'Midface/Face Shape',\n   401→    unit: 'percent',\n   402→    idealMin: 86.5,\n   403→    idealMax: 92.5,\n   404→    rangeMin: 75,\n   405→    rangeMax: 100,\n   406→    decayRate: 0.8,\n   407→    maxScore: 10,\n   408→    weight: 0.02,\n   409→    description: 'Temple width as percentage of bizygomatic width',\n   410→    profileType: 'front',\n   411→  },\n   412→\n   413→  cheekboneHeight: {\n   414→    id: 'cheekboneHeight',\n   415→    name: 'Cheekbone Height',\n   416→    category: 'Midface/Face Shape',\n   417→    unit: 'percent',\n   418→    idealMin: 83,\n   419→    idealMax: 100,\n   420→    rangeMin: 30,\n   421→    rangeMax: 140,\n   422→    decayRate: 0.5,\n   423→    maxScore: 15,  // FaceIQ: higher priority\n   424→    weight: 0.03,\n   425→    description: 'Vertical position of cheekbones relative to face height',\n   426→    profileType: 'front',\n   427→  },\n   428→\n   429→  totalFacialWidthToHeight: {\n   430→    id: 'totalFacialWidthToHeight',\n   431→    name: 'Total Facial Width to Height Ratio',\n   432→    category: 'Midface/Face Shape',\n   433→    unit: 'ratio',\n   434→    idealMin: 1.34,\n   435→    idealMax: 1.37,\n   436→    rangeMin: 1.0,\n   437→    rangeMax: 1.7,\n   438→    decayRate: 13.2,\n   439→    maxScore: 25,  // Special: higher max score\n   440→    weight: 0.05,\n   441→    description: 'Total face height divided by cheek width',\n   442→    profileType: 'front',\n   443→    customCurve: {\n   444→      mode: 'custom',\n   445→      points: [\n   446→        { x: 1.05, y: 0 },\n   447→        { x: 1.17, y: 1.41 },\n   448→        { x: 1.25, y: 3.86 },\n   449→        { x: 1.29, y: 6.01 },\n   450→        { x: 1.32, y: 8.88 },\n   451→        { x: 1.34, y: 10, fixed: true },\n   452→        { x: 1.37, y: 10, fixed: true },\n   453→        { x: 1.39, y: 8.88 },\n   454→        { x: 1.42, y: 6.01 },\n   455→        { x: 1.46, y: 3.86 },\n   456→        { x: 1.54, y: 1.41 },\n   457→        { x: 1.66, y: 0 },\n   458→      ],\n   459→    },\n   460→  },\n   461→\n   462→  midfaceRatio: {\n   463→    id: 'midfaceRatio',\n   464→    name: 'Midface Ratio',\n   465→    category: 'Midface/Face Shape',\n   466→    unit: 'ratio',\n   467→    idealMin: 0.97,\n   468→    idealMax: 1.0,\n   469→    rangeMin: 0.5,\n   470→    rangeMax: 1.5,\n   471→    decayRate: 31.6,\n   472→    maxScore: 12.5,  // FaceIQ: medium-high priority\n   473→    weight: 0.04,\n   474→    description: 'Midface width to height ratio for facial balance',\n   475→    profileType: 'front',\n   476→  },\n   477→\n   478→  // JAW MEASUREMENTS\n   479→  jawSlope: {\n   480→    id: 'jawSlope',\n   481→    name: 'Jaw Slope',\n   482→    category: 'Jaw Shape',\n   483→    unit: 'degrees',\n   484→    idealMin: 140,\n   485→    idealMax: 142.5,\n   486→    rangeMin: 120,\n   487→    rangeMax: 160,\n   488→    decayRate: 0.8,\n   489→    maxScore: 10,\n   490→    weight: 0.03,\n   491→    description: 'Angle of the jawline from gonion to chin',\n   492→    profileType: 'front',\n   493→  },\n   494→\n   495→  jawFrontalAngle: {\n   496→    id: 'jawFrontalAngle',\n   497→    name: 'Jaw Frontal Angle',\n   498→    category: 'Jaw Shape',\n   499→    unit: 'degrees',\n   500→    idealMin: 86.5,\n   501→    idealMax: 92.5,\n   502→    rangeMin: 35,\n   503→    rangeMax: 140,\n   504→    decayRate: 0.6,\n   505→    maxScore: 20,  // FaceIQ: high priority\n   506→    weight: 0.04,\n   507→    description: 'Angle of jaw corners from frontal view',\n   508→    profileType: 'front',\n   509→  },\n   510→\n   511→  bigonialWidth: {\n   512→    id: 'bigonialWidth',\n   513→    name: 'Bigonial Width',\n   514→    category: 'Jaw Shape',\n   515→    unit: 'percent',\n   516→    idealMin: 87.75,\n   517→    idealMax: 91.75,\n   518→    rangeMin: 60.25,\n   519→    rangeMax: 120.25,\n   520→    decayRate: 0.9,\n   521→    maxScore: 15,  // FaceIQ: higher priority\n   522→    weight: 0.03,\n   523→    description: 'Jaw width as percentage of bizygomatic width',\n   524→    profileType: 'front',\n   525→  },\n   526→\n   527→  jawWidthRatio: {\n   528→    id: 'jawWidthRatio',\n   529→    name: 'Jaw Width to Face Width Ratio',\n   530→    category: 'Jaw Shape',\n   531→    unit: 'ratio',\n   532→    idealMin: 0.75,\n   533→    idealMax: 0.82,\n   534→    rangeMin: 0.6,\n   535→    rangeMax: 0.95,\n   536→    decayRate: 25.0,\n   537→    maxScore: 10,\n   538→    weight: 0.03,\n   539→    description: 'Bigonial width divided by bizygomatic width',\n   540→    profileType: 'front',\n   541→  },\n   542→\n   543→  // EYE MEASUREMENTS\n   544→  lateralCanthalTilt: {\n   545→    id: 'lateralCanthalTilt',\n   546→    name: 'Lateral Canthal Tilt',\n   547→    category: 'Eyes',\n   548→    unit: 'degrees',\n   549→    idealMin: 6.1,\n   550→    idealMax: 7.8,\n   551→    rangeMin: -5,\n   552→    rangeMax: 20,\n   553→    decayRate: 2.5,\n   554→    maxScore: 10,\n   555→    weight: 0.04,\n   556→    description: 'Angle of eye from inner to outer canthus',\n   557→    profileType: 'front',\n   558→  },\n   559→\n   560→  eyeAspectRatio: {\n   561→    id: 'eyeAspectRatio',\n   562→    name: 'Eye Aspect Ratio',\n   563→    category: 'Eyes',\n   564→    unit: 'ratio',\n   565→    idealMin: 3.0,\n   566→    idealMax: 3.5,\n   567→    rangeMin: 0.8,\n   568→    rangeMax: 6,\n   569→    decayRate: 2.0,\n   570→    maxScore: 15,  // FaceIQ: higher priority\n   571→    weight: 0.03,\n   572→    description: 'Eye width divided by eye height',\n   573→    profileType: 'front',\n   574→  },\n   575→\n   576→  eyeSeparationRatio: {\n   577→    id: 'eyeSeparationRatio',\n   578→    name: 'Eye Separation Ratio',\n   579→    category: 'Eyes',\n   580→    unit: 'percent',\n   581→    idealMin: 45.7,\n   582→    idealMax: 46.8,\n   583→    rangeMin: 35,\n   584→    rangeMax: 55,\n   585→    decayRate: 2.5,\n   586→    maxScore: 10,\n   587→    weight: 0.03,\n   588→    description: 'Intercanthal distance as percentage of bizygomatic width',\n   589→    profileType: 'front',\n   590→  },\n   591→\n   592→  interpupillaryRatio: {\n   593→    id: 'interpupillaryRatio',\n   594→    name: 'Interpupillary Distance Ratio',\n   595→    category: 'Eyes',\n   596→    unit: 'percent',\n   597→    idealMin: 44,\n   598→    idealMax: 48,\n   599→    rangeMin: 38,\n   600→    rangeMax: 54,\n   601→    decayRate: 1.8,\n   602→    maxScore: 10,\n   603→    weight: 0.02,\n   604→    description: 'IPD as percentage of bizygomatic width',\n   605→    profileType: 'front',\n   606→  },\n   607→\n   608→  interpupillaryMouthWidthRatio: {\n   609→    id: 'interpupillaryMouthWidthRatio',\n   610→    name: 'Interpupillary-Mouth Width Ratio',\n   611→    category: 'Eyes',\n   612→    unit: 'ratio',\n   613→    idealMin: 0.83,\n   614→    idealMax: 0.87,\n   615→    rangeMin: 0.6,\n   616→    rangeMax: 1.1,\n   617→    decayRate: 12.0,\n   618→    maxScore: 10,\n   619→    weight: 0.02,\n   620→    description: 'Mouth width divided by interpupillary distance',\n   621→    profileType: 'front',\n   622→  },\n   623→\n   624→  oneEyeApartTest: {\n   625→    id: 'oneEyeApartTest',\n   626→    name: 'One Eye Apart Test',\n   627→    category: 'Eyes',\n   628→    unit: 'ratio',\n   629→    idealMin: 0.95,\n   630→    idealMax: 1.0,\n   631→    rangeMin: 0.7,\n   632→    rangeMax: 1.3,\n   633→    decayRate: 20.0,\n   634→    maxScore: 10,\n   635→    weight: 0.02,\n   636→    description: 'Intercanthal distance should equal one eye width',\n   637→    profileType: 'front',\n   638→  },\n   639→\n   640→  // EYEBROW MEASUREMENTS\n   641→  browLengthRatio: {\n   642→    id: 'browLengthRatio',\n   643→    name: 'Brow Length to Face Width Ratio',\n   644→    category: 'Upper Third',\n   645→    unit: 'percent',\n   646→    idealMin: 28,\n   647→    idealMax: 32,\n   648→    rangeMin: 20,\n   649→    rangeMax: 40,\n   650→    decayRate: 1.5,\n   651→    maxScore: 10,\n   652→    weight: 0.02,\n   653→    description: 'Eyebrow length as percentage of face width',\n   654→    profileType: 'front',\n   655→  },\n   656→\n   657→  eyebrowTilt: {\n   658→    id: 'eyebrowTilt',\n   659→    name: 'Eyebrow Tilt',\n   660→    category: 'Upper Third',\n   661→    unit: 'degrees',\n   662→    idealMin: 6.5,\n   663→    idealMax: 11,\n   664→    rangeMin: -5,\n   665→    rangeMax: 25,\n   666→    decayRate: 1.2,\n   667→    maxScore: 10,\n   668→    weight: 0.02,\n   669→    description: 'Angle of eyebrow from head to tail',\n   670→    profileType: 'front',\n   671→  },\n   672→\n   673→  eyebrowLowSetedness: {\n   674→    id: 'eyebrowLowSetedness',\n   675→    name: 'Eyebrow Low Setedness',\n   676→    category: 'Upper Third',\n   677→    unit: 'ratio',\n   678→    idealMin: 0,\n   679→    idealMax: 0.45,\n   680→    rangeMin: -0.2,\n   681→    rangeMax: 1.0,\n   682→    decayRate: 8.0,\n   683→    maxScore: 10,\n   684→    weight: 0.02,\n   685→    description: 'Distance from brow to eye relative to eye height',\n   686→    profileType: 'front',\n   687→  },\n   688→\n   689→  // NOSE MEASUREMENTS (FRONT)\n   690→  nasalIndex: {\n   691→    id: 'nasalIndex',\n   692→    name: 'Nasal Index',\n   693→    category: 'Nose',\n   694→    unit: 'percent',\n   695→    idealMin: 70,\n   696→    idealMax: 85,\n   697→    rangeMin: 55,\n   698→    rangeMax: 100,\n   699→    decayRate: 0.5,\n   700→    maxScore: 10,\n   701→    weight: 0.02,\n   702→    description: 'Nose width divided by nose height × 100',\n   703→    profileType: 'front',\n   704→  },\n   705→\n   706→  intercanthalNasalRatio: {\n   707→    id: 'intercanthalNasalRatio',\n   708→    name: 'Intercanthal-Nasal Width Ratio',\n   709→    category: 'Nose',\n   710→    unit: 'ratio',\n   711→    idealMin: 1.04,\n   712→    idealMax: 1.16,\n   713→    rangeMin: 0.7,\n   714→    rangeMax: 1.5,\n   715→    decayRate: 12.0,\n   716→    maxScore: 10,\n   717→    weight: 0.02,\n   718→    description: 'Alar width should roughly equal intercanthal distance',\n   719→    profileType: 'front',\n   720→  },\n   721→\n   722→  noseBridgeWidth: {\n   723→    id: 'noseBridgeWidth',\n   724→    name: 'Nose Bridge to Nose Width',\n   725→    category: 'Nose',\n   726→    unit: 'ratio',\n   727→    idealMin: 0.6,\n   728→    idealMax: 0.75,\n   729→    rangeMin: 0.4,\n   730→    rangeMax: 0.9,\n   731→    decayRate: 15.0,\n   732→    maxScore: 10,\n   733→    weight: 0.01,\n   734→    description: 'Ratio of nose bridge width to alar base width',\n   735→    profileType: 'front',\n   736→  },\n   737→\n   738→  noseTipPosition: {\n   739→    id: 'noseTipPosition',\n   740→    name: 'Nose Tip Position',\n   741→    category: 'Nose',\n   742→    unit: 'mm',\n   743→    idealMin: 0.5,\n   744→    idealMax: 3.5,\n   745→    rangeMin: -7.5,\n   746→    rangeMax: 12.5,\n   747→    decayRate: 1.5,\n   748→    maxScore: 2.5,  // FaceIQ: low priority\n   749→    weight: 0.01,\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"c07373e8-9d45-4a2c-b748-e6044bb7e72b","timestamp":"2025-12-20T20:51:25.602Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","content":"    id: 'lowerThirdProportion',\n    name: 'Lower Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31,\n    idealMax: 33.5,\n    rangeMin: 24,\n    rangeMax: 40,\n    decayRate: 1.86,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by lower third (subnasale to menton)',\n    profileType: 'front',\n  },\n\n  middleThirdProportion: {\n    id: 'middleThirdProportion',\n    name: 'Middle Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31.4,\n    idealMax: 33.4,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by middle third',\n    profileType: 'front',\n  },\n\n  upperThirdProportion: {\n    id: 'upperThirdProportion',\n    name: 'Upper Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 30,\n    idealMax: 32,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Percentage of face occupied by upper third (trichion to glabella)',\n    profileType: 'front',\n  },\n\n  bitemporalWidth: {\n    id: 'bitemporalWidth',\n    name: 'Bitemporal Width',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 75,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Temple width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  cheekboneHeight: {\n    id: 'cheekboneHeight',\n    name: 'Cheekbone Height',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 83,\n    idealMax: 100,\n    rangeMin: 30,\n    rangeMax: 140,\n    decayRate: 0.5,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Vertical position of cheekbones relative to face height',\n    profileType: 'front',\n  },\n\n  totalFacialWidthToHeight: {\n    id: 'totalFacialWidthToHeight',\n    name: 'Total Facial Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.34,\n    idealMax: 1.37,\n    rangeMin: 1.0,\n    rangeMax: 1.7,\n    decayRate: 13.2,\n    maxScore: 25,  // Special: higher max score\n    weight: 0.05,\n    description: 'Total face height divided by cheek width',\n    profileType: 'front',\n    customCurve: {\n      mode: 'custom',\n      points: [\n        { x: 1.05, y: 0 },\n        { x: 1.17, y: 1.41 },\n        { x: 1.25, y: 3.86 },\n        { x: 1.29, y: 6.01 },\n        { x: 1.32, y: 8.88 },\n        { x: 1.34, y: 10, fixed: true },\n        { x: 1.37, y: 10, fixed: true },\n        { x: 1.39, y: 8.88 },\n        { x: 1.42, y: 6.01 },\n        { x: 1.46, y: 3.86 },\n        { x: 1.54, y: 1.41 },\n        { x: 1.66, y: 0 },\n      ],\n    },\n  },\n\n  midfaceRatio: {\n    id: 'midfaceRatio',\n    name: 'Midface Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 0.97,\n    idealMax: 1.0,\n    rangeMin: 0.5,\n    rangeMax: 1.5,\n    decayRate: 31.6,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.04,\n    description: 'Midface width to height ratio for facial balance',\n    profileType: 'front',\n  },\n\n  // JAW MEASUREMENTS\n  jawSlope: {\n    id: 'jawSlope',\n    name: 'Jaw Slope',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 140,\n    idealMax: 142.5,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of the jawline from gonion to chin',\n    profileType: 'front',\n  },\n\n  jawFrontalAngle: {\n    id: 'jawFrontalAngle',\n    name: 'Jaw Frontal Angle',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 35,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 20,  // FaceIQ: high priority\n    weight: 0.04,\n    description: 'Angle of jaw corners from frontal view',\n    profileType: 'front',\n  },\n\n  bigonialWidth: {\n    id: 'bigonialWidth',\n    name: 'Bigonial Width',\n    category: 'Jaw Shape',\n    unit: 'percent',\n    idealMin: 87.75,\n    idealMax: 91.75,\n    rangeMin: 60.25,\n    rangeMax: 120.25,\n    decayRate: 0.9,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Jaw width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  jawWidthRatio: {\n    id: 'jawWidthRatio',\n    name: 'Jaw Width to Face Width Ratio',\n    category: 'Jaw Shape',\n    unit: 'ratio',\n    idealMin: 0.75,\n    idealMax: 0.82,\n    rangeMin: 0.6,\n    rangeMax: 0.95,\n    decayRate: 25.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Bigonial width divided by bizygomatic width',\n    profileType: 'front',\n  },\n\n  // EYE MEASUREMENTS\n  lateralCanthalTilt: {\n    id: 'lateralCanthalTilt',\n    name: 'Lateral Canthal Tilt',\n    category: 'Eyes',\n    unit: 'degrees',\n    idealMin: 6.1,\n    idealMax: 7.8,\n    rangeMin: -5,\n    rangeMax: 20,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle of eye from inner to outer canthus',\n    profileType: 'front',\n  },\n\n  eyeAspectRatio: {\n    id: 'eyeAspectRatio',\n    name: 'Eye Aspect Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 3.0,\n    idealMax: 3.5,\n    rangeMin: 0.8,\n    rangeMax: 6,\n    decayRate: 2.0,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Eye width divided by eye height',\n    profileType: 'front',\n  },\n\n  eyeSeparationRatio: {\n    id: 'eyeSeparationRatio',\n    name: 'Eye Separation Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 45.7,\n    idealMax: 46.8,\n    rangeMin: 35,\n    rangeMax: 55,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Intercanthal distance as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryRatio: {\n    id: 'interpupillaryRatio',\n    name: 'Interpupillary Distance Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 44,\n    idealMax: 48,\n    rangeMin: 38,\n    rangeMax: 54,\n    decayRate: 1.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'IPD as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryMouthWidthRatio: {\n    id: 'interpupillaryMouthWidthRatio',\n    name: 'Interpupillary-Mouth Width Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.83,\n    idealMax: 0.87,\n    rangeMin: 0.6,\n    rangeMax: 1.1,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Mouth width divided by interpupillary distance',\n    profileType: 'front',\n  },\n\n  oneEyeApartTest: {\n    id: 'oneEyeApartTest',\n    name: 'One Eye Apart Test',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.95,\n    idealMax: 1.0,\n    rangeMin: 0.7,\n    rangeMax: 1.3,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Intercanthal distance should equal one eye width',\n    profileType: 'front',\n  },\n\n  // EYEBROW MEASUREMENTS\n  browLengthRatio: {\n    id: 'browLengthRatio',\n    name: 'Brow Length to Face Width Ratio',\n    category: 'Upper Third',\n    unit: 'percent',\n    idealMin: 28,\n    idealMax: 32,\n    rangeMin: 20,\n    rangeMax: 40,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow length as percentage of face width',\n    profileType: 'front',\n  },\n\n  eyebrowTilt: {\n    id: 'eyebrowTilt',\n    name: 'Eyebrow Tilt',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 6.5,\n    idealMax: 11,\n    rangeMin: -5,\n    rangeMax: 25,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of eyebrow from head to tail',\n    profileType: 'front',\n  },\n\n  eyebrowLowSetedness: {\n    id: 'eyebrowLowSetedness',\n    name: 'Eyebrow Low Setedness',\n    category: 'Upper Third',\n    unit: 'ratio',\n    idealMin: 0,\n    idealMax: 0.45,\n    rangeMin: -0.2,\n    rangeMax: 1.0,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from brow to eye relative to eye height',\n    profileType: 'front',\n  },\n\n  // NOSE MEASUREMENTS (FRONT)\n  nasalIndex: {\n    id: 'nasalIndex',\n    name: 'Nasal Index',\n    category: 'Nose',\n    unit: 'percent',\n    idealMin: 70,\n    idealMax: 85,\n    rangeMin: 55,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose width divided by nose height × 100',\n    profileType: 'front',\n  },\n\n  intercanthalNasalRatio: {\n    id: 'intercanthalNasalRatio',\n    name: 'Intercanthal-Nasal Width Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 1.04,\n    idealMax: 1.16,\n    rangeMin: 0.7,\n    rangeMax: 1.5,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Alar width should roughly equal intercanthal distance',\n    profileType: 'front',\n  },\n\n  noseBridgeWidth: {\n    id: 'noseBridgeWidth',\n    name: 'Nose Bridge to Nose Width',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.6,\n    idealMax: 0.75,\n    rangeMin: 0.4,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ratio of nose bridge width to alar base width',\n    profileType: 'front',\n  },\n\n  noseTipPosition: {\n    id: 'noseTipPosition',\n    name: 'Nose Tip Position',\n    category: 'Nose',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 3.5,\n    rangeMin: -7.5,\n    rangeMax: 12.5,\n    decayRate: 1.5,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,","numLines":400,"startLine":350,"totalLines":2680}}}
{"parentUuid":"c07373e8-9d45-4a2c-b748-e6044bb7e72b","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_012uyiwmFBChKaU45ucKdVsC","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I have a good understanding of the codebase. Let me read more of the faceiq-scoring.ts to understand all the metric IDs, and then I'll also look at the landmarks file to understand what landmarks are available to create comprehensive illustration configs.\n\nNow I'll work on the medium priority tasks:\n\n1. **Enhanced Illustration Configs** - I need to expand the `generateIllustration()` function in ResultsContext.tsx with configs for all metrics.\n\n2. **Improved Flaw-to-Treatment Matching** - I need to enhance the `generateRecommendations()` function and `getTreatmentIdsForMetric()`.\n\n3. **Severity Display Enhancement** - I need to add severity badges to the StrengthFlawCards.tsx.\n\nLet me first get the landmark mappings to understand which landmarks are available for the illustrations.","signature":"Er8HCkYIChgCKkCOyGs+dhnQKeVYBjbgHlvLc2BrHXNTArF1biPR6pnUW5TGDdosly1/v4zXN4oUmOnS7iIEHVyFPImyL7u2noqtEgxk1BSL2BgsmZcSH3EaDHK5v9ionAcdTojH1iIwNWOD04fCjpAd5cGY4YArlhxCFauR+9bM95PoEz38Fh5x688YPy2mgA98yuf6S97rKqYGCu9QtTSivtNDWdCzM8iVzmoxdzmaFoQLho0oayCWyhdgWGfINaaSEuOQh9sJTVsM3zJlnxcw+YkOHk47N025s93L04+XrLP7G7+uujj/66GPMMExDME0Vr1uAk3kAa77Pwf4B/3/ksUVTZiFIvu9m16Y7c2Un6Y37c30xzB67IYU1p6l7eZp7t1A74RSUHNR2UZCyW078WMFom2S/aXnt5qSKgpE+0b5lXYy2gRHCAc757bSqL+y3WA3s2K0tS5EBC24K3rmCAC6e3EVB0tsmPCTp4+vwtpGxW3nVbjywATXzdaoeQaHSqKE6g0UjiOUkEKyyYKC3B8Lw5kE9Z+tnig2VOnkYnx7zayn8WrWWbbvIqq2+5f0qfTXp8aHsuXswMTyMQeM50+PprGCMTJ+bhvtSAJCeM/c8YdZ75ZMsPpcnSIM29ExBrwV6cq8x41n5YPx6h01wrf2fW0GLXA9uTehJjawRYO5MjS7uu8sxlpIPlAluX1OxVfDeiSrC79snufEf0ye5sJeyWkj88kzYdCgiPK6jwV3/EhGlTmKYH0s0CX6sVVhMTyE+31YGNbcdMIZjdNyuZHDtE+TUqfaYcLblikOM+aa+pXZct9Kx3p0YHuwRespMUKNN+wxMpIOLj+oFDhUz1OPmqjr1MtFIiyzxmhp9YMIrnARXxCqUZkpzLmRngza87FBaCuIbFvf21QvrZHQ45f5kAMdHvBNZvdKybVpALTFXh5Yz4p845W+vHBxD9fkCUPYrEPTWAT217UPef6ag8xaZrjJaqYnEaY+yvlUxfIlYSRXXO9Ci0th3hUkBCgu7mPHQjafJZaDfTzI5hxjM6zU8tFbsCO9ZPRC//7Jz5ghwC0/06lerHn08APO0fpqmDiWOW+38sWRqNla9xJStkysbhOGJPe9HKtZ7QDhoDL6hsp7G7FdUXK6SkhEC6ZmCS5shc6FuYKaW1QYWo6y7dlp0Khb2wNVzBl36NUKKKRObP74PYuxGacysVNhO20cnYU155V/XG05AMXNTChhpjhpg4r8W22beCQwdym5LFq29BuRusCHH0GdNb1XnhMYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":11590,"cache_read_input_tokens":58183,"cache_creation":{"ephemeral_5m_input_tokens":11590,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbn3o6XvQP95knnS1Zf","type":"assistant","uuid":"068437a2-bde6-49b0-9d8b-8e9364ffc5fb","timestamp":"2025-12-20T20:51:32.632Z"}
{"parentUuid":"068437a2-bde6-49b0-9d8b-8e9364ffc5fb","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_012uyiwmFBChKaU45ucKdVsC","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01R8z2EWkZ6gD1XAY6QTYut1","name":"Grep","input":{"pattern":"export const FRONT_LANDMARKS|export const SIDE_LANDMARKS|namedLandmarks","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib","output_mode":"files_with_matches"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":11590,"cache_read_input_tokens":58183,"cache_creation":{"ephemeral_5m_input_tokens":11590,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbn3o6XvQP95knnS1Zf","type":"assistant","uuid":"37200fdd-5c9f-4e49-9b78-7be1861e2d4a","timestamp":"2025-12-20T20:51:34.802Z"}
{"parentUuid":"37200fdd-5c9f-4e49-9b78-7be1861e2d4a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_012uyiwmFBChKaU45ucKdVsC","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HPrrxrPyEQAhLbkmsTbTnu","name":"Grep","input":{"pattern":"id:.*profileType: 'front'|id:.*profileType: 'side'","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","output_mode":"content","-n":true}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":11590,"cache_read_input_tokens":58183,"cache_creation":{"ephemeral_5m_input_tokens":11590,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbn3o6XvQP95knnS1Zf","type":"assistant","uuid":"e488596b-64ab-45a3-b9c7-779b05582a06","timestamp":"2025-12-20T20:51:36.521Z"}
{"parentUuid":"e488596b-64ab-45a3-b9c7-779b05582a06","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01R8z2EWkZ6gD1XAY6QTYut1","type":"tool_result","content":"No files found"}]},"uuid":"120d6660-a974-48ba-9d74-5836cab22c24","timestamp":"2025-12-20T20:51:36.939Z","toolUseResult":{"mode":"files_with_matches","filenames":[],"numFiles":0}}
{"parentUuid":"120d6660-a974-48ba-9d74-5836cab22c24","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HPrrxrPyEQAhLbkmsTbTnu","type":"tool_result","content":"No matches found"}]},"uuid":"a6be977a-6f9f-4043-b32d-c7d5bbcce1e8","timestamp":"2025-12-20T20:51:37.063Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"","numLines":0}}
{"parentUuid":"a6be977a-6f9f-4043-b32d-c7d5bbcce1e8","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_014hPHLAVJFSo9iSRsipPrYJ","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Let me search for the landmarks file to understand what's available.","signature":"EuwBCkYIChgCKkCacMVsZJxWuPBv0xVfE9tbbaxUqyVlqrK9/d+BONUq0L+Jf9aqwlL2huvj0TYsUqhfGgwHgP/t4WbGtutRzfIIEgzIrhEDcYh5BHtGH+gaDJJ9DcoArAGMK9ZnRCIwEpocjfstzxX9iIZ0xoCExqsgfnl9q0u5rBeEZM3Jdo3/8YmUbLKjivCqVQ+Y72ggKlRmJQA4PAYrfRobbqtbzeflrPHAhCOgWJrLevvJ5CiWV49NZtOZwF8u7k8PvZjFpYE0UUnsbO8I5TaePibmYllnbnZJO5Ny4+yLmCEEBYoJ+lMqXTMYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":728,"cache_read_input_tokens":69773,"cache_creation":{"ephemeral_5m_input_tokens":728,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbntn97BteqDAwikPSq","type":"assistant","uuid":"03a5f533-37c8-4cb6-a3d1-d910f0dcb73c","timestamp":"2025-12-20T20:51:39.800Z"}
{"parentUuid":"03a5f533-37c8-4cb6-a3d1-d910f0dcb73c","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_014hPHLAVJFSo9iSRsipPrYJ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01TvbbbmHicGnWvTjSLmAuis","name":"Glob","input":{"pattern":"**/landmarks*.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":728,"cache_read_input_tokens":69773,"cache_creation":{"ephemeral_5m_input_tokens":728,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbntn97BteqDAwikPSq","type":"assistant","uuid":"cd04c556-f86a-418e-a557-1803adc6e6b5","timestamp":"2025-12-20T20:51:40.273Z"}
{"parentUuid":"cd04c556-f86a-418e-a557-1803adc6e6b5","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01TvbbbmHicGnWvTjSLmAuis","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts"}]},"uuid":"09ed419c-2871-44ea-9945-6c81a60e962f","timestamp":"2025-12-20T20:51:40.703Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts"],"durationMs":390,"numFiles":1,"truncated":false}}
{"parentUuid":"09ed419c-2871-44ea-9945-6c81a60e962f","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MBAh36871eGCvp5EY9naVv","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Let me read the landmarks file to understand available landmark points.","signature":"Eu8BCkYIChgCKkBOvpgd4yN2Ze0d0oBST1Y38GyDALzhzIXj1Yge1pnrz4vjlg3sNVWMhwA4kz7a/4iRWw71aMmiPBNkJJGbvPdmEgxB3HBXM2hNA6SKrekaDPfDbIkFi5RfiR7N3CIwGtP75BtiT73uDRWX5W17fZjk0qatRvv9XZSZjGxO6H02mVDeMhWOM39lGGDPczGPKlcHU+G8ijFKDBCljkhZrk0KfTYkRVhQtnrDxnqDsxyYiq0590Y778h5BePEQuRSLl+tm2RepBuFEFlVmOmbKE26/rhE+Yln+yIEOJGJVGAqAJTW4g7amZ4YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":122,"cache_read_input_tokens":70501,"cache_creation":{"ephemeral_5m_input_tokens":122,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJboAJJ6ALvqPszEyg82","type":"assistant","uuid":"c12340a9-0784-42d9-8552-9a83d7667741","timestamp":"2025-12-20T20:51:43.180Z"}
{"parentUuid":"c12340a9-0784-42d9-8552-9a83d7667741","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MBAh36871eGCvp5EY9naVv","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CBd8YPcEFYU2jytv23fVVz","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":122,"cache_read_input_tokens":70501,"cache_creation":{"ephemeral_5m_input_tokens":122,"ephemeral_1h_input_tokens":0},"output_tokens":99,"service_tier":"standard"}},"requestId":"req_011CWJboAJJ6ALvqPszEyg82","type":"assistant","uuid":"83f73711-e1ac-4d2e-95e3-20cfe1ed7328","timestamp":"2025-12-20T20:51:43.797Z"}
{"parentUuid":"83f73711-e1ac-4d2e-95e3-20cfe1ed7328","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CBd8YPcEFYU2jytv23fVVz","type":"tool_result","content":"     1→/**\n     2→ * Facial Landmark Types and Default Data\n     3→ * Based on TECHNICAL_SPECS.md medical terminology\n     4→ */\n     5→\n     6→export interface LandmarkPoint {\n     7→  id: string;\n     8→  label: string;\n     9→  medicalTerm: string;\n    10→  description: string;\n    11→  x: number;\n    12→  y: number;\n    13→  category: string;\n    14→}\n    15→\n    16→export interface LandmarkCategory {\n    17→  name: string;\n    18→  color: string;\n    19→  landmarks: string[];\n    20→}\n    21→\n    22→// ============================================\n    23→// FRONT PROFILE LANDMARKS (52 Points)\n    24→// ============================================\n    25→\n    26→export const FRONT_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n    27→  {\n    28→    name: 'Head',\n    29→    color: '#FF6B6B',\n    30→    landmarks: ['trichion'],\n    31→  },\n    32→  {\n    33→    name: 'Eyes - Left',\n    34→    color: '#4ECDC4',\n    35→    landmarks: [\n    36→      'left_pupila',\n    37→      'left_canthus_medialis',\n    38→      'left_canthus_lateralis',\n    39→      'left_palpebra_superior',\n    40→      'left_palpebra_inferior',\n    41→      'left_sulcus_palpebralis_lateralis',\n    42→      'left_pretarsal_skin_crease',\n    43→    ],\n    44→  },\n    45→  {\n    46→    name: 'Eyes - Right',\n    47→    color: '#45B7D1',\n    48→    landmarks: [\n    49→      'right_pupila',\n    50→      'right_canthus_medialis',\n    51→      'right_canthus_lateralis',\n    52→      'right_palpebra_superior',\n    53→      'right_palpebra_inferior',\n    54→      'right_sulcus_palpebralis_lateralis',\n    55→      'right_pretarsal_skin_crease',\n    56→    ],\n    57→  },\n    58→  {\n    59→    name: 'Eyebrows - Left',\n    60→    color: '#96CEB4',\n    61→    landmarks: [\n    62→      'left_supercilium_medialis',\n    63→      'left_supercilium_medial_corner',\n    64→      'left_supercilium_superior',\n    65→      'left_supercilium_apex',\n    66→      'left_supercilium_lateralis',\n    67→    ],\n    68→  },\n    69→  {\n    70→    name: 'Eyebrows - Right',\n    71→    color: '#88D8B0',\n    72→    landmarks: [\n    73→      'right_supercilium_medialis',\n    74→      'right_supercilium_medial_corner',\n    75→      'right_supercilium_superior',\n    76→      'right_supercilium_apex',\n    77→      'right_supercilium_lateralis',\n    78→    ],\n    79→  },\n    80→  {\n    81→    name: 'Nose',\n    82→    color: '#FFEAA7',\n    83→    landmarks: [\n    84→      'nasal_base',\n    85→      'left_dorsum_nasi',\n    86→      'right_dorsum_nasi',\n    87→      'left_ala_nasi',\n    88→      'right_ala_nasi',\n    89→      'subnasale',\n    90→    ],\n    91→  },\n    92→  {\n    93→    name: 'Mouth',\n    94→    color: '#DDA0DD',\n    95→    landmarks: [\n    96→      'labrale_superius',\n    97→      'cupids_bow',\n    98→      'mouth_middle',\n    99→      'labrale_inferius',\n   100→      'left_cheilion',\n   101→      'right_cheilion',\n   102→    ],\n   103→  },\n   104→  {\n   105→    name: 'Jaw',\n   106→    color: '#F39C12',\n   107→    landmarks: [\n   108→      'left_gonion_superior',\n   109→      'right_gonion_superior',\n   110→      'left_gonion_inferior',\n   111→      'right_gonion_inferior',\n   112→    ],\n   113→  },\n   114→  {\n   115→    name: 'Chin',\n   116→    color: '#E74C3C',\n   117→    landmarks: ['left_mentum_lateralis', 'right_mentum_lateralis', 'menton'],\n   118→  },\n   119→  {\n   120→    name: 'Face Width',\n   121→    color: '#9B59B6',\n   122→    landmarks: [\n   123→      'left_zygion',\n   124→      'right_zygion',\n   125→      'left_temporal',\n   126→      'right_temporal',\n   127→      'left_auricular_lateral',\n   128→      'right_auricular_lateral',\n   129→    ],\n   130→  },\n   131→  {\n   132→    name: 'Neck',\n   133→    color: '#1ABC9C',\n   134→    landmarks: ['left_cervical_lateralis', 'right_cervical_lateralis'],\n   135→  },\n   136→];\n   137→\n   138→export const FRONT_PROFILE_LANDMARKS: LandmarkPoint[] = [\n   139→  // Head/Hair\n   140→  {\n   141→    id: 'trichion',\n   142→    label: 'Hairline',\n   143→    medicalTerm: 'Trichion (frontal view)',\n   144→    description: 'Anterior hairline at midline',\n   145→    x: 0.5,\n   146→    y: 0.08,\n   147→    category: 'Head',\n   148→  },\n   149→\n   150→  // Eyes - Left\n   151→  {\n   152→    id: 'left_pupila',\n   153→    label: 'Left Pupil',\n   154→    medicalTerm: 'Left Pupila',\n   155→    description: 'Center of left pupil',\n   156→    x: 0.38,\n   157→    y: 0.35,\n   158→    category: 'Eyes - Left',\n   159→  },\n   160→  {\n   161→    id: 'left_canthus_medialis',\n   162→    label: 'Left Medial Canthus',\n   163→    medicalTerm: 'Left Canthus Medialis',\n   164→    description: 'Inner corner of left eye',\n   165→    x: 0.42,\n   166→    y: 0.35,\n   167→    category: 'Eyes - Left',\n   168→  },\n   169→  {\n   170→    id: 'left_canthus_lateralis',\n   171→    label: 'Left Lateral Canthus',\n   172→    medicalTerm: 'Left Canthus Lateralis',\n   173→    description: 'Outer corner of left eye',\n   174→    x: 0.32,\n   175→    y: 0.34,\n   176→    category: 'Eyes - Left',\n   177→  },\n   178→  {\n   179→    id: 'left_palpebra_superior',\n   180→    label: 'Left Upper Eyelid',\n   181→    medicalTerm: 'Left Palpebra Superior',\n   182→    description: 'Upper eyelid of left eye',\n   183→    x: 0.37,\n   184→    y: 0.33,\n   185→    category: 'Eyes - Left',\n   186→  },\n   187→  {\n   188→    id: 'left_palpebra_inferior',\n   189→    label: 'Left Lower Eyelid',\n   190→    medicalTerm: 'Left Palpebra Inferior',\n   191→    description: 'Lower eyelid of left eye',\n   192→    x: 0.37,\n   193→    y: 0.37,\n   194→    category: 'Eyes - Left',\n   195→  },\n   196→  {\n   197→    id: 'left_sulcus_palpebralis_lateralis',\n   198→    label: 'Left Eyelid Hood End',\n   199→    medicalTerm: 'Left Sulcus Palpebralis Lateralis',\n   200→    description: 'Lateral end of left upper eyelid crease',\n   201→    x: 0.31,\n   202→    y: 0.33,\n   203→    category: 'Eyes - Left',\n   204→  },\n   205→  {\n   206→    id: 'left_pretarsal_skin_crease',\n   207→    label: 'Left Upper Eyelid Crease',\n   208→    medicalTerm: 'Left Pretarsal Skin Crease',\n   209→    description: 'Left upper eyelid crease',\n   210→    x: 0.37,\n   211→    y: 0.32,\n   212→    category: 'Eyes - Left',\n   213→  },\n   214→\n   215→  // Eyes - Right\n   216→  {\n   217→    id: 'right_pupila',\n   218→    label: 'Right Pupil',\n   219→    medicalTerm: 'Right Pupila',\n   220→    description: 'Center of right pupil',\n   221→    x: 0.62,\n   222→    y: 0.35,\n   223→    category: 'Eyes - Right',\n   224→  },\n   225→  {\n   226→    id: 'right_canthus_medialis',\n   227→    label: 'Right Medial Canthus',\n   228→    medicalTerm: 'Right Canthus Medialis',\n   229→    description: 'Inner corner of right eye',\n   230→    x: 0.58,\n   231→    y: 0.35,\n   232→    category: 'Eyes - Right',\n   233→  },\n   234→  {\n   235→    id: 'right_canthus_lateralis',\n   236→    label: 'Right Lateral Canthus',\n   237→    medicalTerm: 'Right Canthus Lateralis',\n   238→    description: 'Outer corner of right eye',\n   239→    x: 0.68,\n   240→    y: 0.34,\n   241→    category: 'Eyes - Right',\n   242→  },\n   243→  {\n   244→    id: 'right_palpebra_superior',\n   245→    label: 'Right Upper Eyelid',\n   246→    medicalTerm: 'Right Palpebra Superior',\n   247→    description: 'Upper eyelid of right eye',\n   248→    x: 0.63,\n   249→    y: 0.33,\n   250→    category: 'Eyes - Right',\n   251→  },\n   252→  {\n   253→    id: 'right_palpebra_inferior',\n   254→    label: 'Right Lower Eyelid',\n   255→    medicalTerm: 'Right Palpebra Inferior',\n   256→    description: 'Lower eyelid of right eye',\n   257→    x: 0.63,\n   258→    y: 0.37,\n   259→    category: 'Eyes - Right',\n   260→  },\n   261→  {\n   262→    id: 'right_sulcus_palpebralis_lateralis',\n   263→    label: 'Right Eyelid Hood End',\n   264→    medicalTerm: 'Right Sulcus Palpebralis Lateralis',\n   265→    description: 'Lateral end of right upper eyelid crease',\n   266→    x: 0.69,\n   267→    y: 0.33,\n   268→    category: 'Eyes - Right',\n   269→  },\n   270→  {\n   271→    id: 'right_pretarsal_skin_crease',\n   272→    label: 'Right Upper Eyelid Crease',\n   273→    medicalTerm: 'Right Pretarsal Skin Crease',\n   274→    description: 'Right upper eyelid crease',\n   275→    x: 0.63,\n   276→    y: 0.32,\n   277→    category: 'Eyes - Right',\n   278→  },\n   279→\n   280→  // Eyebrows - Left\n   281→  {\n   282→    id: 'left_supercilium_medialis',\n   283→    label: 'Left Brow Head',\n   284→    medicalTerm: 'Left Supercilium Medialis',\n   285→    description: 'Medial start of left eyebrow',\n   286→    x: 0.43,\n   287→    y: 0.28,\n   288→    category: 'Eyebrows - Left',\n   289→  },\n   290→  {\n   291→    id: 'left_supercilium_medial_corner',\n   292→    label: 'Left Brow Inner Corner',\n   293→    medicalTerm: 'Left Supercilium Medial Corner',\n   294→    description: 'Inner corner of left eyebrow',\n   295→    x: 0.41,\n   296→    y: 0.27,\n   297→    category: 'Eyebrows - Left',\n   298→  },\n   299→  {\n   300→    id: 'left_supercilium_superior',\n   301→    label: 'Left Brow Arch',\n   302→    medicalTerm: 'Left Supercilium Superior',\n   303→    description: 'Superior arc of left eyebrow',\n   304→    x: 0.36,\n   305→    y: 0.26,\n   306→    category: 'Eyebrows - Left',\n   307→  },\n   308→  {\n   309→    id: 'left_supercilium_apex',\n   310→    label: 'Left Brow Peak',\n   311→    medicalTerm: 'Left Supercilium Apex',\n   312→    description: 'Highest point of left eyebrow',\n   313→    x: 0.34,\n   314→    y: 0.26,\n   315→    category: 'Eyebrows - Left',\n   316→  },\n   317→  {\n   318→    id: 'left_supercilium_lateralis',\n   319→    label: 'Left Brow Tail',\n   320→    medicalTerm: 'Left Supercilium Lateralis',\n   321→    description: 'Lateral end of left eyebrow',\n   322→    x: 0.29,\n   323→    y: 0.28,\n   324→    category: 'Eyebrows - Left',\n   325→  },\n   326→\n   327→  // Eyebrows - Right\n   328→  {\n   329→    id: 'right_supercilium_medialis',\n   330→    label: 'Right Brow Head',\n   331→    medicalTerm: 'Right Supercilium Medialis',\n   332→    description: 'Medial start of right eyebrow',\n   333→    x: 0.57,\n   334→    y: 0.28,\n   335→    category: 'Eyebrows - Right',\n   336→  },\n   337→  {\n   338→    id: 'right_supercilium_medial_corner',\n   339→    label: 'Right Brow Inner Corner',\n   340→    medicalTerm: 'Right Supercilium Medial Corner',\n   341→    description: 'Inner corner of right eyebrow',\n   342→    x: 0.59,\n   343→    y: 0.27,\n   344→    category: 'Eyebrows - Right',\n   345→  },\n   346→  {\n   347→    id: 'right_supercilium_superior',\n   348→    label: 'Right Brow Arch',\n   349→    medicalTerm: 'Right Supercilium Superior',\n   350→    description: 'Superior arc of right eyebrow',\n   351→    x: 0.64,\n   352→    y: 0.26,\n   353→    category: 'Eyebrows - Right',\n   354→  },\n   355→  {\n   356→    id: 'right_supercilium_apex',\n   357→    label: 'Right Brow Peak',\n   358→    medicalTerm: 'Right Supercilium Apex',\n   359→    description: 'Highest point of right eyebrow',\n   360→    x: 0.66,\n   361→    y: 0.26,\n   362→    category: 'Eyebrows - Right',\n   363→  },\n   364→  {\n   365→    id: 'right_supercilium_lateralis',\n   366→    label: 'Right Brow Tail',\n   367→    medicalTerm: 'Right Supercilium Lateralis',\n   368→    description: 'Lateral end of right eyebrow',\n   369→    x: 0.71,\n   370→    y: 0.28,\n   371→    category: 'Eyebrows - Right',\n   372→  },\n   373→\n   374→  // Nose\n   375→  {\n   376→    id: 'nasal_base',\n   377→    label: 'Nasal Base',\n   378→    medicalTerm: 'Nasal Base',\n   379→    description: 'Base of nasal dorsum',\n   380→    x: 0.5,\n   381→    y: 0.38,\n   382→    category: 'Nose',\n   383→  },\n   384→  {\n   385→    id: 'left_dorsum_nasi',\n   386→    label: 'Left Nose Bridge',\n   387→    medicalTerm: 'Left Dorsum Nasi',\n   388→    description: 'Left side of nasal bridge',\n   389→    x: 0.47,\n   390→    y: 0.42,\n   391→    category: 'Nose',\n   392→  },\n   393→  {\n   394→    id: 'right_dorsum_nasi',\n   395→    label: 'Right Nose Bridge',\n   396→    medicalTerm: 'Right Dorsum Nasi',\n   397→    description: 'Right side of nasal bridge',\n   398→    x: 0.53,\n   399→    y: 0.42,\n   400→    category: 'Nose',\n   401→  },\n   402→  {\n   403→    id: 'left_ala_nasi',\n   404→    label: 'Left Nose Side',\n   405→    medicalTerm: 'Left Ala Nasi',\n   406→    description: 'Lateral aspect of left nasal ala',\n   407→    x: 0.44,\n   408→    y: 0.5,\n   409→    category: 'Nose',\n   410→  },\n   411→  {\n   412→    id: 'right_ala_nasi',\n   413→    label: 'Right Nose Side',\n   414→    medicalTerm: 'Right Ala Nasi',\n   415→    description: 'Lateral aspect of right nasal ala',\n   416→    x: 0.56,\n   417→    y: 0.5,\n   418→    category: 'Nose',\n   419→  },\n   420→  {\n   421→    id: 'subnasale',\n   422→    label: 'Nose Bottom',\n   423→    medicalTerm: 'Subnasale',\n   424→    description: 'Junction of columella and upper lip',\n   425→    x: 0.5,\n   426→    y: 0.52,\n   427→    category: 'Nose',\n   428→  },\n   429→\n   430→  // Mouth\n   431→  {\n   432→    id: 'labrale_superius',\n   433→    label: \"Cupid's Bow\",\n   434→    medicalTerm: 'Labrale Superius',\n   435→    description: 'Midpoint of upper lip vermilion',\n   436→    x: 0.5,\n   437→    y: 0.58,\n   438→    category: 'Mouth',\n   439→  },\n   440→  {\n   441→    id: 'cupids_bow',\n   442→    label: \"Inner Cupid's Bow\",\n   443→    medicalTerm: \"Cupid's Bow\",\n   444→    description: 'Central peak of upper lip',\n   445→    x: 0.5,\n   446→    y: 0.57,\n   447→    category: 'Mouth',\n   448→  },\n   449→  {\n   450→    id: 'mouth_middle',\n   451→    label: 'Mouth Middle',\n   452→    medicalTerm: 'Mouth Middle',\n   453→    description: 'Center of mouth opening',\n   454→    x: 0.5,\n   455→    y: 0.62,\n   456→    category: 'Mouth',\n   457→  },\n   458→  {\n   459→    id: 'labrale_inferius',\n   460→    label: 'Lower Lip Center',\n   461→    medicalTerm: 'Labrale Inferius',\n   462→    description: 'Midpoint of lower lip vermilion border',\n   463→    x: 0.5,\n   464→    y: 0.66,\n   465→    category: 'Mouth',\n   466→  },\n   467→  {\n   468→    id: 'left_cheilion',\n   469→    label: 'Left Mouth Corner',\n   470→    medicalTerm: 'Left Cheilion',\n   471→    description: 'Left oral commissure',\n   472→    x: 0.42,\n   473→    y: 0.62,\n   474→    category: 'Mouth',\n   475→  },\n   476→  {\n   477→    id: 'right_cheilion',\n   478→    label: 'Right Mouth Corner',\n   479→    medicalTerm: 'Right Cheilion',\n   480→    description: 'Right oral commissure',\n   481→    x: 0.58,\n   482→    y: 0.62,\n   483→    category: 'Mouth',\n   484→  },\n   485→\n   486→  // Jaw\n   487→  {\n   488→    id: 'left_gonion_superior',\n   489→    label: 'Left Upper Jaw Angle',\n   490→    medicalTerm: 'Left Gonion Superior',\n   491→    description: 'Superior aspect of left mandibular angle',\n   492→    x: 0.22,\n   493→    y: 0.55,\n   494→    category: 'Jaw',\n   495→  },\n   496→  {\n   497→    id: 'right_gonion_superior',\n   498→    label: 'Right Upper Jaw Angle',\n   499→    medicalTerm: 'Right Gonion Superior',\n   500→    description: 'Superior aspect of right mandibular angle',\n   501→    x: 0.78,\n   502→    y: 0.55,\n   503→    category: 'Jaw',\n   504→  },\n   505→  {\n   506→    id: 'left_gonion_inferior',\n   507→    label: 'Left Lower Jaw Angle',\n   508→    medicalTerm: 'Left Gonion Inferior',\n   509→    description: 'Inferior aspect of left mandibular angle',\n   510→    x: 0.24,\n   511→    y: 0.7,\n   512→    category: 'Jaw',\n   513→  },\n   514→  {\n   515→    id: 'right_gonion_inferior',\n   516→    label: 'Right Lower Jaw Angle',\n   517→    medicalTerm: 'Right Gonion Inferior',\n   518→    description: 'Inferior aspect of right mandibular angle',\n   519→    x: 0.76,\n   520→    y: 0.7,\n   521→    category: 'Jaw',\n   522→  },\n   523→\n   524→  // Chin\n   525→  {\n   526→    id: 'left_mentum_lateralis',\n   527→    label: 'Left Chin',\n   528→    medicalTerm: 'Left Mentum Lateralis',\n   529→    description: 'Left lateral chin',\n   530→    x: 0.42,\n   531→    y: 0.8,\n   532→    category: 'Chin',\n   533→  },\n   534→  {\n   535→    id: 'right_mentum_lateralis',\n   536→    label: 'Right Chin',\n   537→    medicalTerm: 'Right Mentum Lateralis',\n   538→    description: 'Right lateral chin',\n   539→    x: 0.58,\n   540→    y: 0.8,\n   541→    category: 'Chin',\n   542→  },\n   543→  {\n   544→    id: 'menton',\n   545→    label: 'Chin Bottom',\n   546→    medicalTerm: 'Menton',\n   547→    description: 'Lowest point of chin in midline',\n   548→    x: 0.5,\n   549→    y: 0.88,\n   550→    category: 'Chin',\n   551→  },\n   552→\n   553→  // Face Width\n   554→  {\n   555→    id: 'left_zygion',\n   556→    label: 'Left Cheekbone',\n   557→    medicalTerm: 'Left Zygion',\n   558→    description: 'Most lateral point of left zygomatic arch',\n   559→    x: 0.18,\n   560→    y: 0.42,\n   561→    category: 'Face Width',\n   562→  },\n   563→  {\n   564→    id: 'right_zygion',\n   565→    label: 'Right Cheekbone',\n   566→    medicalTerm: 'Right Zygion',\n   567→    description: 'Most lateral point of right zygomatic arch',\n   568→    x: 0.82,\n   569→    y: 0.42,\n   570→    category: 'Face Width',\n   571→  },\n   572→  {\n   573→    id: 'left_temporal',\n   574→    label: 'Left Temple',\n   575→    medicalTerm: 'Left Temporal Point',\n   576→    description: 'Left temporal region',\n   577→    x: 0.2,\n   578→    y: 0.3,\n   579→    category: 'Face Width',\n   580→  },\n   581→  {\n   582→    id: 'right_temporal',\n   583→    label: 'Right Temple',\n   584→    medicalTerm: 'Right Temporal Point',\n   585→    description: 'Right temporal region',\n   586→    x: 0.8,\n   587→    y: 0.3,\n   588→    category: 'Face Width',\n   589→  },\n   590→  {\n   591→    id: 'left_auricular_lateral',\n   592→    label: 'Left Outer Ear',\n   593→    medicalTerm: 'Left Auricular Lateral Point',\n   594→    description: 'Lateral-most point of left ear',\n   595→    x: 0.12,\n   596→    y: 0.4,\n   597→    category: 'Face Width',\n   598→  },\n   599→  {\n   600→    id: 'right_auricular_lateral',\n   601→    label: 'Right Outer Ear',\n   602→    medicalTerm: 'Right Auricular Lateral Point',\n   603→    description: 'Lateral-most point of right ear',\n   604→    x: 0.88,\n   605→    y: 0.4,\n   606→    category: 'Face Width',\n   607→  },\n   608→\n   609→  // Neck\n   610→  {\n   611→    id: 'left_cervical_lateralis',\n   612→    label: 'Left Neck Point',\n   613→    medicalTerm: 'Left Cervical Lateralis',\n   614→    description: 'Left cervical point',\n   615→    x: 0.35,\n   616→    y: 0.95,\n   617→    category: 'Neck',\n   618→  },\n   619→  {\n   620→    id: 'right_cervical_lateralis',\n   621→    label: 'Right Neck Point',\n   622→    medicalTerm: 'Right Cervical Lateralis',\n   623→    description: 'Right cervical point',\n   624→    x: 0.65,\n   625→    y: 0.95,\n   626→    category: 'Neck',\n   627→  },\n   628→];\n   629→\n   630→// ============================================\n   631→// SIDE PROFILE LANDMARKS (28 Points)\n   632→// Matches FaceIQ Labs exact naming and order\n   633→// ============================================\n   634→\n   635→export const SIDE_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n   636→  {\n   637→    name: 'Cranium',\n   638→    color: '#FF6B6B',\n   639→    landmarks: ['vertex', 'occiput', 'trichion'],\n   640→  },\n   641→  {\n   642→    name: 'Forehead',\n   643→    color: '#4ECDC4',\n   644→    landmarks: ['glabella'],\n   645→  },\n   646→  {\n   647→    name: 'Eye Region',\n   648→    color: '#45B7D1',\n   649→    landmarks: ['cornealApex', 'orbitale'],\n   650→  },\n   651→  {\n   652→    name: 'Nose',\n   653→    color: '#FFEAA7',\n   654→    landmarks: [\n   655→      'nasion',\n   656→      'rhinion',\n   657→      'supratip',\n   658→      'pronasale',\n   659→      'infratip',\n   660→      'columella',\n   661→      'subnasale',\n   662→      'subalare',\n   663→    ],\n   664→  },\n   665→  {\n   666→    name: 'Lips',\n   667→    color: '#DDA0DD',\n   668→    landmarks: ['labraleSuperius', 'cheilion', 'labraleInferius', 'sublabiale'],\n   669→  },\n   670→  {\n   671→    name: 'Chin',\n   672→    color: '#E74C3C',\n   673→    landmarks: ['pogonion', 'menton'],\n   674→  },\n   675→  {\n   676→    name: 'Jaw',\n   677→    color: '#F39C12',\n   678→    landmarks: ['gonionTop', 'gonionBottom'],\n   679→  },\n   680→  {\n   681→    name: 'Cheek',\n   682→    color: '#9B59B6',\n   683→    landmarks: ['cheekbone'],\n   684→  },\n   685→  {\n   686→    name: 'Ear',\n   687→    color: '#3498DB',\n   688→    landmarks: ['porion', 'tragus', 'intertragicNotch'],\n   689→  },\n   690→  {\n   691→    name: 'Neck',\n   692→    color: '#1ABC9C',\n   693→    landmarks: ['cervicalPoint', 'neckPoint'],\n   694→  },\n   695→];\n   696→\n   697→// FaceIQ order: vertex, occiput, pronasale, neckPoint, porion, orbitale, tragus,\n   698→// intertragicNotch, cornealApex, cheekbone, trichion, glabella, nasion, rhinion,\n   699→// supratip, infratip, columella, subnasale, subalare, labraleSuperius, cheilion,\n   700→// labraleInferius, sublabiale, pogonion, menton, cervicalPoint, gonionTop, gonionBottom\n   701→export const SIDE_PROFILE_LANDMARKS: LandmarkPoint[] = [\n   702→  // 1. vertex\n   703→  {\n   704→    id: 'vertex',\n   705→    label: 'Top of Head',\n   706→    medicalTerm: 'Vertex',\n   707→    description: 'Highest point on the head in profile',\n   708→    x: 0.45,\n   709→    y: 0.02,\n   710→    category: 'Cranium',\n   711→  },\n   712→  // 2. occiput\n   713→  {\n   714→    id: 'occiput',\n   715→    label: 'Occiput',\n   716→    medicalTerm: 'External Occipital Region',\n   717→    description: 'Back-of-head prominence',\n   718→    x: 0.85,\n   719→    y: 0.15,\n   720→    category: 'Cranium',\n   721→  },\n   722→  // 3. pronasale\n   723→  {\n   724→    id: 'pronasale',\n   725→    label: 'Nose Tip',\n   726→    medicalTerm: 'Pronasale',\n   727→    description: 'Most forward point of the nose tip',\n   728→    x: 0.18,\n   729→    y: 0.48,\n   730→    category: 'Nose',\n   731→  },\n   732→  // 4. neckPoint\n   733→  {\n   734→    id: 'neckPoint',\n   735→    label: 'Neck Point',\n   736→    medicalTerm: 'Anterior Cervical Landmark',\n   737→    description: 'Lower neck inflection on the front border',\n   738→    x: 0.4,\n   739→    y: 0.88,\n   740→    category: 'Neck',\n   741→  },\n   742→  // 5. porion\n   743→  {\n   744→    id: 'porion',\n   745→    label: 'Porion',\n   746→    medicalTerm: 'Porion (soft tissue)',\n   747→    description: 'Upper margin of ear canal opening, used for Frankfort horizontal plane',\n   748→    x: 0.75,\n   749→    y: 0.35,\n   750→    category: 'Ear',\n   751→  },\n   752→  // 6. orbitale\n   753→  {\n   754→    id: 'orbitale',\n   755→    label: 'Orbitale',\n   756→    medicalTerm: 'Orbitale',\n   757→    description: 'Lowest point on the orbital rim',\n   758→    x: 0.35,\n   759→    y: 0.38,\n   760→    category: 'Eye Region',\n   761→  },\n   762→  // 7. tragus\n   763→  {\n   764→    id: 'tragus',\n   765→    label: 'Tragus',\n   766→    medicalTerm: 'Tragion (soft tissue)',\n   767→    description: 'Cartilage nub in front of the ear canal',\n   768→    x: 0.72,\n   769→    y: 0.42,\n   770→    category: 'Ear',\n   771→  },\n   772→  // 8. intertragicNotch\n   773→  {\n   774→    id: 'intertragicNotch',\n   775→    label: 'Intertragic Notch',\n   776→    medicalTerm: 'Incisura Intertragica',\n   777→    description: 'Notch between tragus and antitragus cartilages',\n   778→    x: 0.73,\n   779→    y: 0.45,\n   780→    category: 'Ear',\n   781→  },\n   782→  // 9. cornealApex\n   783→  {\n   784→    id: 'cornealApex',\n   785→    label: 'Corneal Apex',\n   786→    medicalTerm: 'Corneal Apex',\n   787→    description: 'Most forward point of the eye (cornea)',\n   788→    x: 0.28,\n   789→    y: 0.34,\n   790→    category: 'Eye Region',\n   791→  },\n   792→  // 10. cheekbone\n   793→  {\n   794→    id: 'cheekbone',\n   795→    label: 'Cheekbone',\n   796→    medicalTerm: 'Zygion (soft-tissue over zygoma)',\n   797→    description: 'Zygomatic prominence',\n   798→    x: 0.45,\n   799→    y: 0.42,\n   800→    category: 'Cheek',\n   801→  },\n   802→  // 11. trichion\n   803→  {\n   804→    id: 'trichion',\n   805→    label: 'Hairline (Profile)',\n   806→    medicalTerm: 'Trichion',\n   807→    description: 'Forehead hairline point',\n   808→    x: 0.35,\n   809→    y: 0.1,\n   810→    category: 'Cranium',\n   811→  },\n   812→  // 12. glabella\n   813→  {\n   814→    id: 'glabella',\n   815→    label: 'Glabella',\n   816→    medicalTerm: 'Glabella',\n   817→    description: 'Mid-forehead point between brows',\n   818→    x: 0.32,\n   819→    y: 0.28,\n   820→    category: 'Forehead',\n   821→  },\n   822→  // 13. nasion\n   823→  {\n   824→    id: 'nasion',\n   825→    label: 'Nasal Bridge Root',\n   826→    medicalTerm: 'Nasion',\n   827→    description: 'Nasal root depression',\n   828→    x: 0.35,\n   829→    y: 0.32,\n   830→    category: 'Nose',\n   831→  },\n   832→  // 14. rhinion\n   833→  {\n   834→    id: 'rhinion',\n   835→    label: 'Rhinion',\n   836→    medicalTerm: 'Rhinion',\n   837→    description: 'Dorsal point of the nose',\n   838→    x: 0.28,\n   839→    y: 0.4,\n   840→    category: 'Nose',\n   841→  },\n   842→  // 15. supratip\n   843→  {\n   844→    id: 'supratip',\n   845→    label: 'Supratip',\n   846→    medicalTerm: 'Supratip Break',\n   847→    description: 'Dorsal point just above the tip',\n   848→    x: 0.22,\n   849→    y: 0.46,\n   850→    category: 'Nose',\n   851→  },\n   852→  // 16. infratip\n   853→  {\n   854→    id: 'infratip',\n   855→    label: 'Infratip',\n   856→    medicalTerm: 'Infratip Lobule',\n   857→    description: 'Point between nose tip and columella',\n   858→    x: 0.2,\n   859→    y: 0.5,\n   860→    category: 'Nose',\n   861→  },\n   862→  // 17. columella\n   863→  {\n   864→    id: 'columella',\n   865→    label: 'Columella',\n   866→    medicalTerm: 'Columella Nasi',\n   867→    description: 'Inferior border of the nasal septum between nostrils',\n   868→    x: 0.24,\n   869→    y: 0.52,\n   870→    category: 'Nose',\n   871→  },\n   872→  // 18. subnasale\n   873→  {\n   874→    id: 'subnasale',\n   875→    label: 'Subnasale',\n   876→    medicalTerm: 'Subnasale',\n   877→    description: 'Where nose base meets upper lip',\n   878→    x: 0.3,\n   879→    y: 0.54,\n   880→    category: 'Nose',\n   881→  },\n   882→  // 19. subalare\n   883→  {\n   884→    id: 'subalare',\n   885→    label: 'Subalare',\n   886→    medicalTerm: 'Subalare',\n   887→    description: 'Lowest point of the nostril wing on the visible side',\n   888→    x: 0.28,\n   889→    y: 0.53,\n   890→    category: 'Nose',\n   891→  },\n   892→  // 20. labraleSuperius\n   893→  {\n   894→    id: 'labraleSuperius',\n   895→    label: 'Upper Lip',\n   896→    medicalTerm: 'Labrale Superius',\n   897→    description: 'Most forward point of the upper lip vermilion',\n   898→    x: 0.28,\n   899→    y: 0.58,\n   900→    category: 'Lips',\n   901→  },\n   902→  // 21. cheilion\n   903→  {\n   904→    id: 'cheilion',\n   905→    label: 'Mouth Corner',\n   906→    medicalTerm: 'Cheilion',\n   907→    description: 'Mouth corner where the lips meet',\n   908→    x: 0.35,\n   909→    y: 0.62,\n   910→    category: 'Lips',\n   911→  },\n   912→  // 22. labraleInferius\n   913→  {\n   914→    id: 'labraleInferius',\n   915→    label: 'Lower Lip',\n   916→    medicalTerm: 'Labrale Inferius',\n   917→    description: 'Most forward point of the lower lip vermilion',\n   918→    x: 0.3,\n   919→    y: 0.66,\n   920→    category: 'Lips',\n   921→  },\n   922→  // 23. sublabiale\n   923→  {\n   924→    id: 'sublabiale',\n   925→    label: 'Labiomental Fold',\n   926→    medicalTerm: 'Sublabiale',\n   927→    description: 'Deepest point of the crease between lower lip and chin',\n   928→    x: 0.32,\n   929→    y: 0.7,\n   930→    category: 'Lips',\n   931→  },\n   932→  // 24. pogonion\n   933→  {\n   934→    id: 'pogonion',\n   935→    label: 'Chin Point',\n   936→    medicalTerm: 'Pogonion (soft tissue)',\n   937→    description: 'Most forward point on the soft-tissue chin',\n   938→    x: 0.3,\n   939→    y: 0.76,\n   940→    category: 'Chin',\n   941→  },\n   942→  // 25. menton\n   943→  {\n   944→    id: 'menton',\n   945→    label: 'Chin Bottom',\n   946→    medicalTerm: 'Menton (soft tissue)',\n   947→    description: 'Lowest point on the soft-tissue chin',\n   948→    x: 0.35,\n   949→    y: 0.82,\n   950→    category: 'Chin',\n   951→  },\n   952→  // 26. cervicalPoint\n   953→  {\n   954→    id: 'cervicalPoint',\n   955→    label: 'Cervical Point',\n   956→    medicalTerm: 'Cervicale (soft-tissue reference)',\n   957→    description: 'High neck point just under the jaw',\n   958→    x: 0.5,\n   959→    y: 0.9,\n   960→    category: 'Neck',\n   961→  },\n   962→  // 27. gonionTop\n   963→  {\n   964→    id: 'gonionTop',\n   965→    label: 'Upper Jaw Angle',\n   966→    medicalTerm: 'Gonion Superior',\n   967→    description: 'Upper angle point of the jaw from side profile',\n   968→    x: 0.7,\n   969→    y: 0.6,\n   970→    category: 'Jaw',\n   971→  },\n   972→  // 28. gonionBottom\n   973→  {\n   974→    id: 'gonionBottom',\n   975→    label: 'Lower Jaw Angle',\n   976→    medicalTerm: 'Gonion Inferior',\n   977→    description: 'Lower angle point of the jaw from side profile',\n   978→    x: 0.65,\n   979→    y: 0.72,\n   980→    category: 'Jaw',\n   981→  },\n   982→];\n   983→\n   984→// ============================================\n   985→// MediaPipe Face Mesh Index Mapping\n   986→// ============================================\n   987→// NOTE: MEDIAPIPE_FRONT_MAPPING is defined in mediapipeDetection.ts (single source of truth)\n   988→// Import from there if needed: import { MEDIAPIPE_FRONT_MAPPING } from './mediapipeDetection';\n   989→\n   990→// Helper to get category color for a landmark\n   991→export function getLandmarkColor(\n   992→  landmarkId: string,\n   993→  categories: LandmarkCategory[]\n   994→): string {\n   995→  for (const category of categories) {\n   996→    if (category.landmarks.includes(landmarkId)) {\n   997→      return category.color;\n   998→    }\n   999→  }\n  1000→  return '#00f3ff'; // Default cyan\n  1001→}\n  1002→\n  1003→// ============================================\n  1004→// FaceIQ Side Profile Landmark Indices (106 points)\n  1005→// Reverse-engineered from FaceIQ Labs API\n  1006→// ============================================\n  1007→\n  1008→export const FACEIQ_SIDE_LANDMARKS = {\n  1009→  // Face Contour (0-16) - Jaw/Chin outline\n  1010→  MENTON: 0, // Chin bottom (lowest point)\n  1011→  POGONION: 2, // Chin prominence\n  1012→  GNATHION: 3, // Chin point\n  1013→  MANDIBLE_CONTOUR: [2, 3, 4, 5, 6, 7, 8], // Jaw line\n  1014→\n  1015→  // Posterior Points (1, 9-16) - Ear/Back of head\n  1016→  TRAGION: 1, // Ear point\n  1017→  EAR_CONTOUR: [9, 10, 11, 12, 13, 14, 15, 16],\n  1018→\n  1019→  // Forehead/Hairline (17)\n  1020→  TRICHION: 17, // Hairline\n  1021→\n  1022→  // Nose Profile (18-32)\n  1023→  NASION: 25, // Bridge of nose (deepest point)\n  1024→  PRONASALE: 32, // Nose tip\n  1025→  SUBNASALE: 52, // Base of nose\n  1026→  COLUMELLA: 53, // Nose columella\n  1027→  NOSE_BRIDGE: [25, 26, 27, 28, 29, 30, 31, 32],\n  1028→  NOSE_TIP_CONTOUR: [52, 53, 54, 55, 56, 57, 58, 59, 60],\n  1029→\n  1030→  // Eye Region (33-51)\n  1031→  EYE_LATERAL_CANTHUS: 33, // Outer eye corner\n  1032→  EYE_MEDIAL_CANTHUS: 35, // Inner eye corner\n  1033→  UPPER_EYELID: [37, 38, 39],\n  1034→  LOWER_EYELID: [40, 41, 42],\n  1035→  PUPIL: 34,\n  1036→  BROW_HEAD: 44, // Inner brow\n  1037→  BROW_ARCH: 45, // Brow peak\n  1038→  BROW_TAIL: 46, // Outer brow\n  1039→\n  1040→  // Lip Region (52-75)\n  1041→  LABRALE_SUPERIUS: 63, // Upper lip top\n  1042→  LABRALE_INFERIUS: 66, // Lower lip bottom\n  1043→  STOMION: 65, // Lip meeting point\n  1044→  UPPER_LIP_CONTOUR: [63, 64, 65],\n  1045→  LOWER_LIP_CONTOUR: [66, 67, 68],\n  1046→\n  1047→  // Additional Profile Points (76-105)\n  1048→  GLABELLA: 76, // Between eyebrows\n  1049→  SELLION: 77, // Deepest point of nasal bridge\n  1050→  SOFT_TISSUE_NASION: 78,\n  1051→  ORBITALE: 79, // Lowest point of eye socket\n  1052→  GONION: 85, // Jaw angle\n  1053→  CONDYLION: 86, // Top of jaw joint\n  1054→};\n  1055→\n  1056→// ============================================\n  1057→// FaceIQ Front Face Landmark Indices (MediaPipe 478 points)\n  1058→// ============================================\n  1059→\n  1060→export const FACEIQ_FRONT_LANDMARKS = {\n  1061→  // Key points from MediaPipe Face Mesh\n  1062→  NOSE_TIP: 1,\n  1063→  LEFT_EYE_INNER: 133,\n  1064→  LEFT_EYE_OUTER: 33,\n  1065→  RIGHT_EYE_INNER: 362,\n  1066→  RIGHT_EYE_OUTER: 263,\n  1067→  LEFT_CHEEK: 234,\n  1068→  RIGHT_CHEEK: 454,\n  1069→  UPPER_LIP: 13,\n  1070→  LOWER_LIP: 14,\n  1071→  CHIN: 152,\n  1072→  FOREHEAD: 10,\n  1073→  LEFT_EAR: 234,\n  1074→  RIGHT_EAR: 454,\n  1075→  LEFT_BROW_INNER: 107,\n  1076→  LEFT_BROW_OUTER: 70,\n  1077→  RIGHT_BROW_INNER: 336,\n  1078→  RIGHT_BROW_OUTER: 300,\n  1079→  NOSE_BRIDGE: 6,\n  1080→  LEFT_NOSTRIL: 129,\n  1081→  RIGHT_NOSTRIL: 358,\n  1082→};\n  1083→\n  1084→// ============================================\n  1085→// Scoring Configuration Types\n  1086→// ============================================\n  1087→\n  1088→export interface ScoringConfig {\n  1089→  idealValue: number;\n  1090→  standardDeviation: number;\n  1091→  minScore: number;\n  1092→  maxScore: number;\n  1093→  weight: number;\n  1094→}\n  1095→\n  1096→export interface GenderSpecificValues {\n  1097→  male: { ideal: number; range: [number, number] };\n  1098→  female: { ideal: number; range: [number, number] };\n  1099→}\n  1100→\n  1101→// ============================================\n  1102→// FaceIQ Ideal Values (Gender-Specific)\n  1103→// ============================================\n  1104→\n  1105→export const FACEIQ_IDEAL_VALUES: Record<string, GenderSpecificValues> = {\n  1106→  fwhr: {\n  1107→    male: { ideal: 1.9, range: [1.8, 2.1] },\n  1108→    female: { ideal: 1.75, range: [1.6, 1.9] },\n  1109→  },\n  1110→  canthalTilt: {\n  1111→    male: { ideal: 4, range: [2, 7] },\n  1112→    female: { ideal: 6, range: [4, 10] },\n  1113→  },\n  1114→  nasolabialAngle: {\n  1115→    male: { ideal: 95, range: [90, 100] },\n  1116→    female: { ideal: 105, range: [100, 115] },\n  1117→  },\n  1118→  gonialAngle: {\n  1119→    male: { ideal: 125, range: [120, 130] },\n  1120→    female: { ideal: 128, range: [125, 135] },\n  1121→  },\n  1122→  nasalIndex: {\n  1123→    male: { ideal: 0.7, range: [0.65, 0.75] },\n  1124→    female: { ideal: 0.65, range: [0.6, 0.7] },\n  1125→  },\n  1126→  lipRatio: {\n  1127→    male: { ideal: 0.5, range: [0.4, 0.6] },\n  1128→    female: { ideal: 0.5, range: [0.45, 0.55] },\n  1129→  },\n  1130→  facialConvexity: {\n  1131→    male: { ideal: 170, range: [165, 175] },\n  1132→    female: { ideal: 168, range: [163, 173] },\n  1133→  },\n  1134→  chinProjection: {\n  1135→    male: { ideal: 0, range: [-3, 3] },\n  1136→    female: { ideal: -2, range: [-5, 1] },\n  1137→  },\n  1138→};\n  1139→\n  1140→// ============================================\n  1141→// FaceIQ Scoring Configurations\n  1142→// ============================================\n  1143→\n  1144→export const FACEIQ_SCORING_CONFIGS: Record<string, ScoringConfig> = {\n  1145→  fwhr: {\n  1146→    idealValue: 1.9,\n  1147→    standardDeviation: 0.15,\n  1148→    minScore: 0,\n  1149→    maxScore: 100,\n  1150→    weight: 0.15,\n  1151→  },\n  1152→  canthalTilt: {\n  1153→    idealValue: 6,\n  1154→    standardDeviation: 3,\n  1155→    minScore: 0,\n  1156→    maxScore: 100,\n  1157→    weight: 0.1,\n  1158→  },\n  1159→  facialThirds: {\n  1160→    idealValue: 33.33,\n  1161→    standardDeviation: 3,\n  1162→    minScore: 0,\n  1163→    maxScore: 100,\n  1164→    weight: 0.1,\n  1165→  },\n  1166→  nasolabialAngle: {\n  1167→    idealValue: 102,\n  1168→    standardDeviation: 8,\n  1169→    minScore: 0,\n  1170→    maxScore: 100,\n  1171→    weight: 0.08,\n  1172→  },\n  1173→  gonialAngle: {\n  1174→    idealValue: 125,\n  1175→    standardDeviation: 5,\n  1176→    minScore: 0,\n  1177→    maxScore: 100,\n  1178→    weight: 0.08,\n  1179→  },\n  1180→  overallSymmetry: {\n  1181→    idealValue: 100,\n  1182→    standardDeviation: 5,\n  1183→    minScore: 0,\n  1184→    maxScore: 100,\n  1185→    weight: 0.15,\n  1186→  },\n  1187→  goldenRatio: {\n  1188→    idealValue: 1.618,\n  1189→    standardDeviation: 0.1,\n  1190→    minScore: 0,\n  1191→    maxScore: 100,\n  1192→    weight: 0.12,\n  1193→  },\n  1194→  nasalIndex: {\n  1195→    idealValue: 0.7,\n  1196→    standardDeviation: 0.08,\n  1197→    minScore: 0,\n  1198→    maxScore: 100,\n  1199→    weight: 0.06,\n  1200→  },\n  1201→  lipRatio: {\n  1202→    idealValue: 0.5,\n  1203→    standardDeviation: 0.1,\n  1204→    minScore: 0,\n  1205→    maxScore: 100,\n  1206→    weight: 0.06,\n  1207→  },\n  1208→  chinProjection: {\n  1209→    idealValue: 0,\n  1210→    standardDeviation: 3,\n  1211→    minScore: 0,\n  1212→    maxScore: 100,\n  1213→    weight: 0.05,\n  1214→  },\n  1215→  noseProjection: {\n  1216→    idealValue: 0.67,\n  1217→    standardDeviation: 0.05,\n  1218→    minScore: 0,\n  1219→    maxScore: 100,\n  1220→    weight: 0.05,\n  1221→  },\n  1222→};\n  1223→\n  1224→// ============================================\n  1225→// Population Statistics for Percentile Ranking\n  1226→// ============================================\n  1227→\n  1228→export interface PopulationStats {\n  1229→  mean: number;\n  1230→  standardDeviation: number;\n  1231→  sampleSize: number;\n  1232→}\n  1233→\n  1234→export const POPULATION_STATS: Record<string, PopulationStats> = {\n  1235→  harmonyScore: { mean: 65, standardDeviation: 12, sampleSize: 10000 },\n  1236→  fwhr: { mean: 1.85, standardDeviation: 0.2, sampleSize: 10000 },\n  1237→  canthalTilt: { mean: 4, standardDeviation: 4, sampleSize: 10000 },\n  1238→  symmetry: { mean: 85, standardDeviation: 8, sampleSize: 10000 },\n  1239→  goldenRatioMatch: { mean: 70, standardDeviation: 15, sampleSize: 10000 },\n  1240→};\n  1241→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"42ac726f-a831-482c-b61d-7a19fa46794f","timestamp":"2025-12-20T20:51:43.943Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts","content":"/**\n * Facial Landmark Types and Default Data\n * Based on TECHNICAL_SPECS.md medical terminology\n */\n\nexport interface LandmarkPoint {\n  id: string;\n  label: string;\n  medicalTerm: string;\n  description: string;\n  x: number;\n  y: number;\n  category: string;\n}\n\nexport interface LandmarkCategory {\n  name: string;\n  color: string;\n  landmarks: string[];\n}\n\n// ============================================\n// FRONT PROFILE LANDMARKS (52 Points)\n// ============================================\n\nexport const FRONT_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n  {\n    name: 'Head',\n    color: '#FF6B6B',\n    landmarks: ['trichion'],\n  },\n  {\n    name: 'Eyes - Left',\n    color: '#4ECDC4',\n    landmarks: [\n      'left_pupila',\n      'left_canthus_medialis',\n      'left_canthus_lateralis',\n      'left_palpebra_superior',\n      'left_palpebra_inferior',\n      'left_sulcus_palpebralis_lateralis',\n      'left_pretarsal_skin_crease',\n    ],\n  },\n  {\n    name: 'Eyes - Right',\n    color: '#45B7D1',\n    landmarks: [\n      'right_pupila',\n      'right_canthus_medialis',\n      'right_canthus_lateralis',\n      'right_palpebra_superior',\n      'right_palpebra_inferior',\n      'right_sulcus_palpebralis_lateralis',\n      'right_pretarsal_skin_crease',\n    ],\n  },\n  {\n    name: 'Eyebrows - Left',\n    color: '#96CEB4',\n    landmarks: [\n      'left_supercilium_medialis',\n      'left_supercilium_medial_corner',\n      'left_supercilium_superior',\n      'left_supercilium_apex',\n      'left_supercilium_lateralis',\n    ],\n  },\n  {\n    name: 'Eyebrows - Right',\n    color: '#88D8B0',\n    landmarks: [\n      'right_supercilium_medialis',\n      'right_supercilium_medial_corner',\n      'right_supercilium_superior',\n      'right_supercilium_apex',\n      'right_supercilium_lateralis',\n    ],\n  },\n  {\n    name: 'Nose',\n    color: '#FFEAA7',\n    landmarks: [\n      'nasal_base',\n      'left_dorsum_nasi',\n      'right_dorsum_nasi',\n      'left_ala_nasi',\n      'right_ala_nasi',\n      'subnasale',\n    ],\n  },\n  {\n    name: 'Mouth',\n    color: '#DDA0DD',\n    landmarks: [\n      'labrale_superius',\n      'cupids_bow',\n      'mouth_middle',\n      'labrale_inferius',\n      'left_cheilion',\n      'right_cheilion',\n    ],\n  },\n  {\n    name: 'Jaw',\n    color: '#F39C12',\n    landmarks: [\n      'left_gonion_superior',\n      'right_gonion_superior',\n      'left_gonion_inferior',\n      'right_gonion_inferior',\n    ],\n  },\n  {\n    name: 'Chin',\n    color: '#E74C3C',\n    landmarks: ['left_mentum_lateralis', 'right_mentum_lateralis', 'menton'],\n  },\n  {\n    name: 'Face Width',\n    color: '#9B59B6',\n    landmarks: [\n      'left_zygion',\n      'right_zygion',\n      'left_temporal',\n      'right_temporal',\n      'left_auricular_lateral',\n      'right_auricular_lateral',\n    ],\n  },\n  {\n    name: 'Neck',\n    color: '#1ABC9C',\n    landmarks: ['left_cervical_lateralis', 'right_cervical_lateralis'],\n  },\n];\n\nexport const FRONT_PROFILE_LANDMARKS: LandmarkPoint[] = [\n  // Head/Hair\n  {\n    id: 'trichion',\n    label: 'Hairline',\n    medicalTerm: 'Trichion (frontal view)',\n    description: 'Anterior hairline at midline',\n    x: 0.5,\n    y: 0.08,\n    category: 'Head',\n  },\n\n  // Eyes - Left\n  {\n    id: 'left_pupila',\n    label: 'Left Pupil',\n    medicalTerm: 'Left Pupila',\n    description: 'Center of left pupil',\n    x: 0.38,\n    y: 0.35,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_canthus_medialis',\n    label: 'Left Medial Canthus',\n    medicalTerm: 'Left Canthus Medialis',\n    description: 'Inner corner of left eye',\n    x: 0.42,\n    y: 0.35,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_canthus_lateralis',\n    label: 'Left Lateral Canthus',\n    medicalTerm: 'Left Canthus Lateralis',\n    description: 'Outer corner of left eye',\n    x: 0.32,\n    y: 0.34,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_palpebra_superior',\n    label: 'Left Upper Eyelid',\n    medicalTerm: 'Left Palpebra Superior',\n    description: 'Upper eyelid of left eye',\n    x: 0.37,\n    y: 0.33,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_palpebra_inferior',\n    label: 'Left Lower Eyelid',\n    medicalTerm: 'Left Palpebra Inferior',\n    description: 'Lower eyelid of left eye',\n    x: 0.37,\n    y: 0.37,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_sulcus_palpebralis_lateralis',\n    label: 'Left Eyelid Hood End',\n    medicalTerm: 'Left Sulcus Palpebralis Lateralis',\n    description: 'Lateral end of left upper eyelid crease',\n    x: 0.31,\n    y: 0.33,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_pretarsal_skin_crease',\n    label: 'Left Upper Eyelid Crease',\n    medicalTerm: 'Left Pretarsal Skin Crease',\n    description: 'Left upper eyelid crease',\n    x: 0.37,\n    y: 0.32,\n    category: 'Eyes - Left',\n  },\n\n  // Eyes - Right\n  {\n    id: 'right_pupila',\n    label: 'Right Pupil',\n    medicalTerm: 'Right Pupila',\n    description: 'Center of right pupil',\n    x: 0.62,\n    y: 0.35,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_canthus_medialis',\n    label: 'Right Medial Canthus',\n    medicalTerm: 'Right Canthus Medialis',\n    description: 'Inner corner of right eye',\n    x: 0.58,\n    y: 0.35,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_canthus_lateralis',\n    label: 'Right Lateral Canthus',\n    medicalTerm: 'Right Canthus Lateralis',\n    description: 'Outer corner of right eye',\n    x: 0.68,\n    y: 0.34,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_palpebra_superior',\n    label: 'Right Upper Eyelid',\n    medicalTerm: 'Right Palpebra Superior',\n    description: 'Upper eyelid of right eye',\n    x: 0.63,\n    y: 0.33,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_palpebra_inferior',\n    label: 'Right Lower Eyelid',\n    medicalTerm: 'Right Palpebra Inferior',\n    description: 'Lower eyelid of right eye',\n    x: 0.63,\n    y: 0.37,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_sulcus_palpebralis_lateralis',\n    label: 'Right Eyelid Hood End',\n    medicalTerm: 'Right Sulcus Palpebralis Lateralis',\n    description: 'Lateral end of right upper eyelid crease',\n    x: 0.69,\n    y: 0.33,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_pretarsal_skin_crease',\n    label: 'Right Upper Eyelid Crease',\n    medicalTerm: 'Right Pretarsal Skin Crease',\n    description: 'Right upper eyelid crease',\n    x: 0.63,\n    y: 0.32,\n    category: 'Eyes - Right',\n  },\n\n  // Eyebrows - Left\n  {\n    id: 'left_supercilium_medialis',\n    label: 'Left Brow Head',\n    medicalTerm: 'Left Supercilium Medialis',\n    description: 'Medial start of left eyebrow',\n    x: 0.43,\n    y: 0.28,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_medial_corner',\n    label: 'Left Brow Inner Corner',\n    medicalTerm: 'Left Supercilium Medial Corner',\n    description: 'Inner corner of left eyebrow',\n    x: 0.41,\n    y: 0.27,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_superior',\n    label: 'Left Brow Arch',\n    medicalTerm: 'Left Supercilium Superior',\n    description: 'Superior arc of left eyebrow',\n    x: 0.36,\n    y: 0.26,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_apex',\n    label: 'Left Brow Peak',\n    medicalTerm: 'Left Supercilium Apex',\n    description: 'Highest point of left eyebrow',\n    x: 0.34,\n    y: 0.26,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_lateralis',\n    label: 'Left Brow Tail',\n    medicalTerm: 'Left Supercilium Lateralis',\n    description: 'Lateral end of left eyebrow',\n    x: 0.29,\n    y: 0.28,\n    category: 'Eyebrows - Left',\n  },\n\n  // Eyebrows - Right\n  {\n    id: 'right_supercilium_medialis',\n    label: 'Right Brow Head',\n    medicalTerm: 'Right Supercilium Medialis',\n    description: 'Medial start of right eyebrow',\n    x: 0.57,\n    y: 0.28,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_medial_corner',\n    label: 'Right Brow Inner Corner',\n    medicalTerm: 'Right Supercilium Medial Corner',\n    description: 'Inner corner of right eyebrow',\n    x: 0.59,\n    y: 0.27,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_superior',\n    label: 'Right Brow Arch',\n    medicalTerm: 'Right Supercilium Superior',\n    description: 'Superior arc of right eyebrow',\n    x: 0.64,\n    y: 0.26,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_apex',\n    label: 'Right Brow Peak',\n    medicalTerm: 'Right Supercilium Apex',\n    description: 'Highest point of right eyebrow',\n    x: 0.66,\n    y: 0.26,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_lateralis',\n    label: 'Right Brow Tail',\n    medicalTerm: 'Right Supercilium Lateralis',\n    description: 'Lateral end of right eyebrow',\n    x: 0.71,\n    y: 0.28,\n    category: 'Eyebrows - Right',\n  },\n\n  // Nose\n  {\n    id: 'nasal_base',\n    label: 'Nasal Base',\n    medicalTerm: 'Nasal Base',\n    description: 'Base of nasal dorsum',\n    x: 0.5,\n    y: 0.38,\n    category: 'Nose',\n  },\n  {\n    id: 'left_dorsum_nasi',\n    label: 'Left Nose Bridge',\n    medicalTerm: 'Left Dorsum Nasi',\n    description: 'Left side of nasal bridge',\n    x: 0.47,\n    y: 0.42,\n    category: 'Nose',\n  },\n  {\n    id: 'right_dorsum_nasi',\n    label: 'Right Nose Bridge',\n    medicalTerm: 'Right Dorsum Nasi',\n    description: 'Right side of nasal bridge',\n    x: 0.53,\n    y: 0.42,\n    category: 'Nose',\n  },\n  {\n    id: 'left_ala_nasi',\n    label: 'Left Nose Side',\n    medicalTerm: 'Left Ala Nasi',\n    description: 'Lateral aspect of left nasal ala',\n    x: 0.44,\n    y: 0.5,\n    category: 'Nose',\n  },\n  {\n    id: 'right_ala_nasi',\n    label: 'Right Nose Side',\n    medicalTerm: 'Right Ala Nasi',\n    description: 'Lateral aspect of right nasal ala',\n    x: 0.56,\n    y: 0.5,\n    category: 'Nose',\n  },\n  {\n    id: 'subnasale',\n    label: 'Nose Bottom',\n    medicalTerm: 'Subnasale',\n    description: 'Junction of columella and upper lip',\n    x: 0.5,\n    y: 0.52,\n    category: 'Nose',\n  },\n\n  // Mouth\n  {\n    id: 'labrale_superius',\n    label: \"Cupid's Bow\",\n    medicalTerm: 'Labrale Superius',\n    description: 'Midpoint of upper lip vermilion',\n    x: 0.5,\n    y: 0.58,\n    category: 'Mouth',\n  },\n  {\n    id: 'cupids_bow',\n    label: \"Inner Cupid's Bow\",\n    medicalTerm: \"Cupid's Bow\",\n    description: 'Central peak of upper lip',\n    x: 0.5,\n    y: 0.57,\n    category: 'Mouth',\n  },\n  {\n    id: 'mouth_middle',\n    label: 'Mouth Middle',\n    medicalTerm: 'Mouth Middle',\n    description: 'Center of mouth opening',\n    x: 0.5,\n    y: 0.62,\n    category: 'Mouth',\n  },\n  {\n    id: 'labrale_inferius',\n    label: 'Lower Lip Center',\n    medicalTerm: 'Labrale Inferius',\n    description: 'Midpoint of lower lip vermilion border',\n    x: 0.5,\n    y: 0.66,\n    category: 'Mouth',\n  },\n  {\n    id: 'left_cheilion',\n    label: 'Left Mouth Corner',\n    medicalTerm: 'Left Cheilion',\n    description: 'Left oral commissure',\n    x: 0.42,\n    y: 0.62,\n    category: 'Mouth',\n  },\n  {\n    id: 'right_cheilion',\n    label: 'Right Mouth Corner',\n    medicalTerm: 'Right Cheilion',\n    description: 'Right oral commissure',\n    x: 0.58,\n    y: 0.62,\n    category: 'Mouth',\n  },\n\n  // Jaw\n  {\n    id: 'left_gonion_superior',\n    label: 'Left Upper Jaw Angle',\n    medicalTerm: 'Left Gonion Superior',\n    description: 'Superior aspect of left mandibular angle',\n    x: 0.22,\n    y: 0.55,\n    category: 'Jaw',\n  },\n  {\n    id: 'right_gonion_superior',\n    label: 'Right Upper Jaw Angle',\n    medicalTerm: 'Right Gonion Superior',\n    description: 'Superior aspect of right mandibular angle',\n    x: 0.78,\n    y: 0.55,\n    category: 'Jaw',\n  },\n  {\n    id: 'left_gonion_inferior',\n    label: 'Left Lower Jaw Angle',\n    medicalTerm: 'Left Gonion Inferior',\n    description: 'Inferior aspect of left mandibular angle',\n    x: 0.24,\n    y: 0.7,\n    category: 'Jaw',\n  },\n  {\n    id: 'right_gonion_inferior',\n    label: 'Right Lower Jaw Angle',\n    medicalTerm: 'Right Gonion Inferior',\n    description: 'Inferior aspect of right mandibular angle',\n    x: 0.76,\n    y: 0.7,\n    category: 'Jaw',\n  },\n\n  // Chin\n  {\n    id: 'left_mentum_lateralis',\n    label: 'Left Chin',\n    medicalTerm: 'Left Mentum Lateralis',\n    description: 'Left lateral chin',\n    x: 0.42,\n    y: 0.8,\n    category: 'Chin',\n  },\n  {\n    id: 'right_mentum_lateralis',\n    label: 'Right Chin',\n    medicalTerm: 'Right Mentum Lateralis',\n    description: 'Right lateral chin',\n    x: 0.58,\n    y: 0.8,\n    category: 'Chin',\n  },\n  {\n    id: 'menton',\n    label: 'Chin Bottom',\n    medicalTerm: 'Menton',\n    description: 'Lowest point of chin in midline',\n    x: 0.5,\n    y: 0.88,\n    category: 'Chin',\n  },\n\n  // Face Width\n  {\n    id: 'left_zygion',\n    label: 'Left Cheekbone',\n    medicalTerm: 'Left Zygion',\n    description: 'Most lateral point of left zygomatic arch',\n    x: 0.18,\n    y: 0.42,\n    category: 'Face Width',\n  },\n  {\n    id: 'right_zygion',\n    label: 'Right Cheekbone',\n    medicalTerm: 'Right Zygion',\n    description: 'Most lateral point of right zygomatic arch',\n    x: 0.82,\n    y: 0.42,\n    category: 'Face Width',\n  },\n  {\n    id: 'left_temporal',\n    label: 'Left Temple',\n    medicalTerm: 'Left Temporal Point',\n    description: 'Left temporal region',\n    x: 0.2,\n    y: 0.3,\n    category: 'Face Width',\n  },\n  {\n    id: 'right_temporal',\n    label: 'Right Temple',\n    medicalTerm: 'Right Temporal Point',\n    description: 'Right temporal region',\n    x: 0.8,\n    y: 0.3,\n    category: 'Face Width',\n  },\n  {\n    id: 'left_auricular_lateral',\n    label: 'Left Outer Ear',\n    medicalTerm: 'Left Auricular Lateral Point',\n    description: 'Lateral-most point of left ear',\n    x: 0.12,\n    y: 0.4,\n    category: 'Face Width',\n  },\n  {\n    id: 'right_auricular_lateral',\n    label: 'Right Outer Ear',\n    medicalTerm: 'Right Auricular Lateral Point',\n    description: 'Lateral-most point of right ear',\n    x: 0.88,\n    y: 0.4,\n    category: 'Face Width',\n  },\n\n  // Neck\n  {\n    id: 'left_cervical_lateralis',\n    label: 'Left Neck Point',\n    medicalTerm: 'Left Cervical Lateralis',\n    description: 'Left cervical point',\n    x: 0.35,\n    y: 0.95,\n    category: 'Neck',\n  },\n  {\n    id: 'right_cervical_lateralis',\n    label: 'Right Neck Point',\n    medicalTerm: 'Right Cervical Lateralis',\n    description: 'Right cervical point',\n    x: 0.65,\n    y: 0.95,\n    category: 'Neck',\n  },\n];\n\n// ============================================\n// SIDE PROFILE LANDMARKS (28 Points)\n// Matches FaceIQ Labs exact naming and order\n// ============================================\n\nexport const SIDE_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n  {\n    name: 'Cranium',\n    color: '#FF6B6B',\n    landmarks: ['vertex', 'occiput', 'trichion'],\n  },\n  {\n    name: 'Forehead',\n    color: '#4ECDC4',\n    landmarks: ['glabella'],\n  },\n  {\n    name: 'Eye Region',\n    color: '#45B7D1',\n    landmarks: ['cornealApex', 'orbitale'],\n  },\n  {\n    name: 'Nose',\n    color: '#FFEAA7',\n    landmarks: [\n      'nasion',\n      'rhinion',\n      'supratip',\n      'pronasale',\n      'infratip',\n      'columella',\n      'subnasale',\n      'subalare',\n    ],\n  },\n  {\n    name: 'Lips',\n    color: '#DDA0DD',\n    landmarks: ['labraleSuperius', 'cheilion', 'labraleInferius', 'sublabiale'],\n  },\n  {\n    name: 'Chin',\n    color: '#E74C3C',\n    landmarks: ['pogonion', 'menton'],\n  },\n  {\n    name: 'Jaw',\n    color: '#F39C12',\n    landmarks: ['gonionTop', 'gonionBottom'],\n  },\n  {\n    name: 'Cheek',\n    color: '#9B59B6',\n    landmarks: ['cheekbone'],\n  },\n  {\n    name: 'Ear',\n    color: '#3498DB',\n    landmarks: ['porion', 'tragus', 'intertragicNotch'],\n  },\n  {\n    name: 'Neck',\n    color: '#1ABC9C',\n    landmarks: ['cervicalPoint', 'neckPoint'],\n  },\n];\n\n// FaceIQ order: vertex, occiput, pronasale, neckPoint, porion, orbitale, tragus,\n// intertragicNotch, cornealApex, cheekbone, trichion, glabella, nasion, rhinion,\n// supratip, infratip, columella, subnasale, subalare, labraleSuperius, cheilion,\n// labraleInferius, sublabiale, pogonion, menton, cervicalPoint, gonionTop, gonionBottom\nexport const SIDE_PROFILE_LANDMARKS: LandmarkPoint[] = [\n  // 1. vertex\n  {\n    id: 'vertex',\n    label: 'Top of Head',\n    medicalTerm: 'Vertex',\n    description: 'Highest point on the head in profile',\n    x: 0.45,\n    y: 0.02,\n    category: 'Cranium',\n  },\n  // 2. occiput\n  {\n    id: 'occiput',\n    label: 'Occiput',\n    medicalTerm: 'External Occipital Region',\n    description: 'Back-of-head prominence',\n    x: 0.85,\n    y: 0.15,\n    category: 'Cranium',\n  },\n  // 3. pronasale\n  {\n    id: 'pronasale',\n    label: 'Nose Tip',\n    medicalTerm: 'Pronasale',\n    description: 'Most forward point of the nose tip',\n    x: 0.18,\n    y: 0.48,\n    category: 'Nose',\n  },\n  // 4. neckPoint\n  {\n    id: 'neckPoint',\n    label: 'Neck Point',\n    medicalTerm: 'Anterior Cervical Landmark',\n    description: 'Lower neck inflection on the front border',\n    x: 0.4,\n    y: 0.88,\n    category: 'Neck',\n  },\n  // 5. porion\n  {\n    id: 'porion',\n    label: 'Porion',\n    medicalTerm: 'Porion (soft tissue)',\n    description: 'Upper margin of ear canal opening, used for Frankfort horizontal plane',\n    x: 0.75,\n    y: 0.35,\n    category: 'Ear',\n  },\n  // 6. orbitale\n  {\n    id: 'orbitale',\n    label: 'Orbitale',\n    medicalTerm: 'Orbitale',\n    description: 'Lowest point on the orbital rim',\n    x: 0.35,\n    y: 0.38,\n    category: 'Eye Region',\n  },\n  // 7. tragus\n  {\n    id: 'tragus',\n    label: 'Tragus',\n    medicalTerm: 'Tragion (soft tissue)',\n    description: 'Cartilage nub in front of the ear canal',\n    x: 0.72,\n    y: 0.42,\n    category: 'Ear',\n  },\n  // 8. intertragicNotch\n  {\n    id: 'intertragicNotch',\n    label: 'Intertragic Notch',\n    medicalTerm: 'Incisura Intertragica',\n    description: 'Notch between tragus and antitragus cartilages',\n    x: 0.73,\n    y: 0.45,\n    category: 'Ear',\n  },\n  // 9. cornealApex\n  {\n    id: 'cornealApex',\n    label: 'Corneal Apex',\n    medicalTerm: 'Corneal Apex',\n    description: 'Most forward point of the eye (cornea)',\n    x: 0.28,\n    y: 0.34,\n    category: 'Eye Region',\n  },\n  // 10. cheekbone\n  {\n    id: 'cheekbone',\n    label: 'Cheekbone',\n    medicalTerm: 'Zygion (soft-tissue over zygoma)',\n    description: 'Zygomatic prominence',\n    x: 0.45,\n    y: 0.42,\n    category: 'Cheek',\n  },\n  // 11. trichion\n  {\n    id: 'trichion',\n    label: 'Hairline (Profile)',\n    medicalTerm: 'Trichion',\n    description: 'Forehead hairline point',\n    x: 0.35,\n    y: 0.1,\n    category: 'Cranium',\n  },\n  // 12. glabella\n  {\n    id: 'glabella',\n    label: 'Glabella',\n    medicalTerm: 'Glabella',\n    description: 'Mid-forehead point between brows',\n    x: 0.32,\n    y: 0.28,\n    category: 'Forehead',\n  },\n  // 13. nasion\n  {\n    id: 'nasion',\n    label: 'Nasal Bridge Root',\n    medicalTerm: 'Nasion',\n    description: 'Nasal root depression',\n    x: 0.35,\n    y: 0.32,\n    category: 'Nose',\n  },\n  // 14. rhinion\n  {\n    id: 'rhinion',\n    label: 'Rhinion',\n    medicalTerm: 'Rhinion',\n    description: 'Dorsal point of the nose',\n    x: 0.28,\n    y: 0.4,\n    category: 'Nose',\n  },\n  // 15. supratip\n  {\n    id: 'supratip',\n    label: 'Supratip',\n    medicalTerm: 'Supratip Break',\n    description: 'Dorsal point just above the tip',\n    x: 0.22,\n    y: 0.46,\n    category: 'Nose',\n  },\n  // 16. infratip\n  {\n    id: 'infratip',\n    label: 'Infratip',\n    medicalTerm: 'Infratip Lobule',\n    description: 'Point between nose tip and columella',\n    x: 0.2,\n    y: 0.5,\n    category: 'Nose',\n  },\n  // 17. columella\n  {\n    id: 'columella',\n    label: 'Columella',\n    medicalTerm: 'Columella Nasi',\n    description: 'Inferior border of the nasal septum between nostrils',\n    x: 0.24,\n    y: 0.52,\n    category: 'Nose',\n  },\n  // 18. subnasale\n  {\n    id: 'subnasale',\n    label: 'Subnasale',\n    medicalTerm: 'Subnasale',\n    description: 'Where nose base meets upper lip',\n    x: 0.3,\n    y: 0.54,\n    category: 'Nose',\n  },\n  // 19. subalare\n  {\n    id: 'subalare',\n    label: 'Subalare',\n    medicalTerm: 'Subalare',\n    description: 'Lowest point of the nostril wing on the visible side',\n    x: 0.28,\n    y: 0.53,\n    category: 'Nose',\n  },\n  // 20. labraleSuperius\n  {\n    id: 'labraleSuperius',\n    label: 'Upper Lip',\n    medicalTerm: 'Labrale Superius',\n    description: 'Most forward point of the upper lip vermilion',\n    x: 0.28,\n    y: 0.58,\n    category: 'Lips',\n  },\n  // 21. cheilion\n  {\n    id: 'cheilion',\n    label: 'Mouth Corner',\n    medicalTerm: 'Cheilion',\n    description: 'Mouth corner where the lips meet',\n    x: 0.35,\n    y: 0.62,\n    category: 'Lips',\n  },\n  // 22. labraleInferius\n  {\n    id: 'labraleInferius',\n    label: 'Lower Lip',\n    medicalTerm: 'Labrale Inferius',\n    description: 'Most forward point of the lower lip vermilion',\n    x: 0.3,\n    y: 0.66,\n    category: 'Lips',\n  },\n  // 23. sublabiale\n  {\n    id: 'sublabiale',\n    label: 'Labiomental Fold',\n    medicalTerm: 'Sublabiale',\n    description: 'Deepest point of the crease between lower lip and chin',\n    x: 0.32,\n    y: 0.7,\n    category: 'Lips',\n  },\n  // 24. pogonion\n  {\n    id: 'pogonion',\n    label: 'Chin Point',\n    medicalTerm: 'Pogonion (soft tissue)',\n    description: 'Most forward point on the soft-tissue chin',\n    x: 0.3,\n    y: 0.76,\n    category: 'Chin',\n  },\n  // 25. menton\n  {\n    id: 'menton',\n    label: 'Chin Bottom',\n    medicalTerm: 'Menton (soft tissue)',\n    description: 'Lowest point on the soft-tissue chin',\n    x: 0.35,\n    y: 0.82,\n    category: 'Chin',\n  },\n  // 26. cervicalPoint\n  {\n    id: 'cervicalPoint',\n    label: 'Cervical Point',\n    medicalTerm: 'Cervicale (soft-tissue reference)',\n    description: 'High neck point just under the jaw',\n    x: 0.5,\n    y: 0.9,\n    category: 'Neck',\n  },\n  // 27. gonionTop\n  {\n    id: 'gonionTop',\n    label: 'Upper Jaw Angle',\n    medicalTerm: 'Gonion Superior',\n    description: 'Upper angle point of the jaw from side profile',\n    x: 0.7,\n    y: 0.6,\n    category: 'Jaw',\n  },\n  // 28. gonionBottom\n  {\n    id: 'gonionBottom',\n    label: 'Lower Jaw Angle',\n    medicalTerm: 'Gonion Inferior',\n    description: 'Lower angle point of the jaw from side profile',\n    x: 0.65,\n    y: 0.72,\n    category: 'Jaw',\n  },\n];\n\n// ============================================\n// MediaPipe Face Mesh Index Mapping\n// ============================================\n// NOTE: MEDIAPIPE_FRONT_MAPPING is defined in mediapipeDetection.ts (single source of truth)\n// Import from there if needed: import { MEDIAPIPE_FRONT_MAPPING } from './mediapipeDetection';\n\n// Helper to get category color for a landmark\nexport function getLandmarkColor(\n  landmarkId: string,\n  categories: LandmarkCategory[]\n): string {\n  for (const category of categories) {\n    if (category.landmarks.includes(landmarkId)) {\n      return category.color;\n    }\n  }\n  return '#00f3ff'; // Default cyan\n}\n\n// ============================================\n// FaceIQ Side Profile Landmark Indices (106 points)\n// Reverse-engineered from FaceIQ Labs API\n// ============================================\n\nexport const FACEIQ_SIDE_LANDMARKS = {\n  // Face Contour (0-16) - Jaw/Chin outline\n  MENTON: 0, // Chin bottom (lowest point)\n  POGONION: 2, // Chin prominence\n  GNATHION: 3, // Chin point\n  MANDIBLE_CONTOUR: [2, 3, 4, 5, 6, 7, 8], // Jaw line\n\n  // Posterior Points (1, 9-16) - Ear/Back of head\n  TRAGION: 1, // Ear point\n  EAR_CONTOUR: [9, 10, 11, 12, 13, 14, 15, 16],\n\n  // Forehead/Hairline (17)\n  TRICHION: 17, // Hairline\n\n  // Nose Profile (18-32)\n  NASION: 25, // Bridge of nose (deepest point)\n  PRONASALE: 32, // Nose tip\n  SUBNASALE: 52, // Base of nose\n  COLUMELLA: 53, // Nose columella\n  NOSE_BRIDGE: [25, 26, 27, 28, 29, 30, 31, 32],\n  NOSE_TIP_CONTOUR: [52, 53, 54, 55, 56, 57, 58, 59, 60],\n\n  // Eye Region (33-51)\n  EYE_LATERAL_CANTHUS: 33, // Outer eye corner\n  EYE_MEDIAL_CANTHUS: 35, // Inner eye corner\n  UPPER_EYELID: [37, 38, 39],\n  LOWER_EYELID: [40, 41, 42],\n  PUPIL: 34,\n  BROW_HEAD: 44, // Inner brow\n  BROW_ARCH: 45, // Brow peak\n  BROW_TAIL: 46, // Outer brow\n\n  // Lip Region (52-75)\n  LABRALE_SUPERIUS: 63, // Upper lip top\n  LABRALE_INFERIUS: 66, // Lower lip bottom\n  STOMION: 65, // Lip meeting point\n  UPPER_LIP_CONTOUR: [63, 64, 65],\n  LOWER_LIP_CONTOUR: [66, 67, 68],\n\n  // Additional Profile Points (76-105)\n  GLABELLA: 76, // Between eyebrows\n  SELLION: 77, // Deepest point of nasal bridge\n  SOFT_TISSUE_NASION: 78,\n  ORBITALE: 79, // Lowest point of eye socket\n  GONION: 85, // Jaw angle\n  CONDYLION: 86, // Top of jaw joint\n};\n\n// ============================================\n// FaceIQ Front Face Landmark Indices (MediaPipe 478 points)\n// ============================================\n\nexport const FACEIQ_FRONT_LANDMARKS = {\n  // Key points from MediaPipe Face Mesh\n  NOSE_TIP: 1,\n  LEFT_EYE_INNER: 133,\n  LEFT_EYE_OUTER: 33,\n  RIGHT_EYE_INNER: 362,\n  RIGHT_EYE_OUTER: 263,\n  LEFT_CHEEK: 234,\n  RIGHT_CHEEK: 454,\n  UPPER_LIP: 13,\n  LOWER_LIP: 14,\n  CHIN: 152,\n  FOREHEAD: 10,\n  LEFT_EAR: 234,\n  RIGHT_EAR: 454,\n  LEFT_BROW_INNER: 107,\n  LEFT_BROW_OUTER: 70,\n  RIGHT_BROW_INNER: 336,\n  RIGHT_BROW_OUTER: 300,\n  NOSE_BRIDGE: 6,\n  LEFT_NOSTRIL: 129,\n  RIGHT_NOSTRIL: 358,\n};\n\n// ============================================\n// Scoring Configuration Types\n// ============================================\n\nexport interface ScoringConfig {\n  idealValue: number;\n  standardDeviation: number;\n  minScore: number;\n  maxScore: number;\n  weight: number;\n}\n\nexport interface GenderSpecificValues {\n  male: { ideal: number; range: [number, number] };\n  female: { ideal: number; range: [number, number] };\n}\n\n// ============================================\n// FaceIQ Ideal Values (Gender-Specific)\n// ============================================\n\nexport const FACEIQ_IDEAL_VALUES: Record<string, GenderSpecificValues> = {\n  fwhr: {\n    male: { ideal: 1.9, range: [1.8, 2.1] },\n    female: { ideal: 1.75, range: [1.6, 1.9] },\n  },\n  canthalTilt: {\n    male: { ideal: 4, range: [2, 7] },\n    female: { ideal: 6, range: [4, 10] },\n  },\n  nasolabialAngle: {\n    male: { ideal: 95, range: [90, 100] },\n    female: { ideal: 105, range: [100, 115] },\n  },\n  gonialAngle: {\n    male: { ideal: 125, range: [120, 130] },\n    female: { ideal: 128, range: [125, 135] },\n  },\n  nasalIndex: {\n    male: { ideal: 0.7, range: [0.65, 0.75] },\n    female: { ideal: 0.65, range: [0.6, 0.7] },\n  },\n  lipRatio: {\n    male: { ideal: 0.5, range: [0.4, 0.6] },\n    female: { ideal: 0.5, range: [0.45, 0.55] },\n  },\n  facialConvexity: {\n    male: { ideal: 170, range: [165, 175] },\n    female: { ideal: 168, range: [163, 173] },\n  },\n  chinProjection: {\n    male: { ideal: 0, range: [-3, 3] },\n    female: { ideal: -2, range: [-5, 1] },\n  },\n};\n\n// ============================================\n// FaceIQ Scoring Configurations\n// ============================================\n\nexport const FACEIQ_SCORING_CONFIGS: Record<string, ScoringConfig> = {\n  fwhr: {\n    idealValue: 1.9,\n    standardDeviation: 0.15,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.15,\n  },\n  canthalTilt: {\n    idealValue: 6,\n    standardDeviation: 3,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.1,\n  },\n  facialThirds: {\n    idealValue: 33.33,\n    standardDeviation: 3,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.1,\n  },\n  nasolabialAngle: {\n    idealValue: 102,\n    standardDeviation: 8,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.08,\n  },\n  gonialAngle: {\n    idealValue: 125,\n    standardDeviation: 5,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.08,\n  },\n  overallSymmetry: {\n    idealValue: 100,\n    standardDeviation: 5,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.15,\n  },\n  goldenRatio: {\n    idealValue: 1.618,\n    standardDeviation: 0.1,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.12,\n  },\n  nasalIndex: {\n    idealValue: 0.7,\n    standardDeviation: 0.08,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.06,\n  },\n  lipRatio: {\n    idealValue: 0.5,\n    standardDeviation: 0.1,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.06,\n  },\n  chinProjection: {\n    idealValue: 0,\n    standardDeviation: 3,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.05,\n  },\n  noseProjection: {\n    idealValue: 0.67,\n    standardDeviation: 0.05,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.05,\n  },\n};\n\n// ============================================\n// Population Statistics for Percentile Ranking\n// ============================================\n\nexport interface PopulationStats {\n  mean: number;\n  standardDeviation: number;\n  sampleSize: number;\n}\n\nexport const POPULATION_STATS: Record<string, PopulationStats> = {\n  harmonyScore: { mean: 65, standardDeviation: 12, sampleSize: 10000 },\n  fwhr: { mean: 1.85, standardDeviation: 0.2, sampleSize: 10000 },\n  canthalTilt: { mean: 4, standardDeviation: 4, sampleSize: 10000 },\n  symmetry: { mean: 85, standardDeviation: 8, sampleSize: 10000 },\n  goldenRatioMatch: { mean: 70, standardDeviation: 15, sampleSize: 10000 },\n};\n","numLines":1241,"startLine":1,"totalLines":1241}}}
{"parentUuid":"42ac726f-a831-482c-b61d-7a19fa46794f","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01XwbtqnYXAAyw7xVKD8owdv","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I have all the information I need. Let me now implement the three medium priority items:\n\n1. **Enhanced Illustration Configs** - I'll expand the `generateIllustration()` function in ResultsContext.tsx with comprehensive configs for all metrics. Each illustration config needs to specify:\n   - Points: landmarks to highlight\n   - Lines: connections between points (with labels, colors, positions)\n\n2. **Improved Flaw-to-Treatment Matching** - I'll enhance the recommendation generation to:\n   - Use metric scores to prioritize treatments\n   - Match specific flaws to specific procedures using the existing METRIC_FLAW_MAPPINGS\n   - Calculate expected improvement percentages\n\n3. **Severity Display Enhancement** - I'll add severity badges to the StrengthFlawCards.tsx with the FaceIQ-style colors.\n\nLet me start implementing these changes. First, I'll update the ResultsContext.tsx with comprehensive illustration configs.","signature":"Er8ICkYIChgCKkAT1aNIi7Cem5+V7nuUYfVXZ+OVQuwSaf0snT8PV3mHrlWBKenCK7vn/el3E4dVeLlEzDNK4/g+sE5S1ZP+EH3BEgwpOiAG9OU3JwCeaVsaDAakypu0xedFokyS5SIwbbuR03Uujih4Vmn+CyioM+IZWj/zwCQxCjP2HWyfaSuvFGu5b6T57Y61jqtMCDKiKqYHr3u8z1mUi9T4UgoobnHPWU+cb6wbHHw0Bpvt68PbRuWnpoeKGHTpMXHIfiqG5vLxy0TdUYKPRswf9g2ohJZlGFI0KWl/n58BMRR2wOLc+gAxFSsmIKndNNsYZES/Fjyy+x7xXr4eCLOPlynjOGHZVkVm66dHGgykImiMVklXAjPp/5WrtTH3JB45x+npuIibxYvVXB4vcfnf3l1elH6lMa2AoLr5giQS6dxGAZBYYC4Ubw+fgIV6sBPVvptfMmENnP25NK7ETSsV9BL7zhqRpP9wh4c/76JMtmqJROw9nwuOt3u+NwaP2Y+Ff1yg1j7u1jNgnDa6LRmih+T5E90r/7OBzTIxN7aqnBxA2SSH24cNxunh8X0i9Jv80nIh2pyfc6wQoNvrKkKIOYEQ7K67+JA71uWGID9DbpiP5+LwIVqLu6MiHhXh/PwPsQyA++KGNMd7mL64W64Ia1H98KifQTgDPtlLnkBbttxdVy6RgqshNpYlvkK/FXbhMYtk1YoZbu/OwX/y8NB3IFSL1MwT+GHO7cp4rLgBCgWniYO9HteZIpSCRi1uE0VJkyq/VM7GW902HyrnjwihCjc4zRZ4qnOT0JsjsCLstLoygUite1n3Ydg0vms4ecpOAS/RmiUpNkpFxgnJ/Qpa65i3fcGoh64pOwArMVi79GRUiXQMKG/xmZ8L6vu6oats3EmhWan2JrsM7WnBs2mAa3Fqbl4gcBnr9A6/Nu2aZIDGmJxciWr+269/ItlMTkuNy9PrT9naAOO3PDsn2pfDZkyfgSGKSEsYn+pCq5gOMEqIrkj7LzJQD1WSHuSJu+9KP+6ZpcJF1ftqx51izDlIPa2sfgEikxdlL4WleqND3autFtl5KBd4qmx1E8MrkbPDV2PxmLYw6R+ZLkb4EcOafPAqEfAme+/nkwKPlKK0SileA/6rmhWNahgw3FOExEE2avrNdWNqqm5U/fU9epzhBae5y/uFS3LP1ddbzLYx0o4nbJn/gnpKGDbR7+6K4A+DQUrCpKCNX66rLNGlqRbtppmNVlTH9VFsdGwVTNBi4t9uPUtaSyGfZ8leimeSfDsljD59jAAQ8BOXeAIFROQD/dXetDoi84RosX8FfRDp4f1WV4UeXN1oUJf75G6nt2CGVcpCI5ngYwYnOqJnvdxj613ppAf8y//G7vl02UAmq8+d8dK2x8FP8f2LG27LGuwlAZBh2v+Fx3FXjHMAMDphizKr2nRXiCJthGtdGBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":16097,"cache_read_input_tokens":70623,"cache_creation":{"ephemeral_5m_input_tokens":16097,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWJboQDCrB3GH1TwKXvTX","type":"assistant","uuid":"c64b016e-69b2-4268-9eb4-be33a2daa86e","timestamp":"2025-12-20T20:51:51.731Z"}
{"parentUuid":"c64b016e-69b2-4268-9eb4-be33a2daa86e","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01XwbtqnYXAAyw7xVKD8owdv","type":"message","role":"assistant","content":[{"type":"text","text":"Now I have a good understanding of the codebase. Let me implement the three medium priority fixes. I'll start with the enhanced illustration configs."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":16097,"cache_read_input_tokens":70623,"cache_creation":{"ephemeral_5m_input_tokens":16097,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWJboQDCrB3GH1TwKXvTX","type":"assistant","uuid":"bf02da5b-4b17-474b-ad0a-f369a3e03b01","timestamp":"2025-12-20T20:51:52.309Z"}
{"parentUuid":"bf02da5b-4b17-474b-ad0a-f369a3e03b01","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01XwbtqnYXAAyw7xVKD8owdv","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HZeYwJohUZuxU8bK2K7xix","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","old_string":"function generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  // Default illustration - will be enhanced with metric-specific data\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  // Metric-specific illustration configurations\n  const illustrationConfigs: Record<string, { points: string[]; lines: Array<{ from: string; to: string }> }> = {\n    faceWidthToHeight: {\n      points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n      lines: [\n        { from: 'left_zygion', to: 'right_zygion' },\n        { from: 'trichion', to: 'menton' },\n      ],\n    },\n    lateralCanthalTilt: {\n      points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n      lines: [\n        { from: 'left_canthus_medialis', to: 'left_canthus_lateralis' },\n        { from: 'right_canthus_medialis', to: 'right_canthus_lateralis' },\n      ],\n    },\n    nasalIndex: {\n      points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n      lines: [\n        { from: 'left_ala_nasi', to: 'right_ala_nasi' },\n        { from: 'nasal_base', to: 'subnasale' },\n      ],\n    },\n    mouthWidth: {\n      points: ['left_cheilion', 'right_cheilion'],\n      lines: [{ from: 'left_cheilion', to: 'right_cheilion' }],\n    },\n    jawWidth: {\n      points: ['left_gonion_inferior', 'right_gonion_inferior'],\n      lines: [{ from: 'left_gonion_inferior', to: 'right_gonion_inferior' }],\n    },\n    chinHeight: {\n      points: ['labrale_inferius', 'menton'],\n      lines: [{ from: 'labrale_inferius', to: 'menton' }],\n    },\n  };\n\n  const config = illustrationConfigs[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = { from: line.from, to: line.to, color: '#67e8f9' };\n    });\n  }\n\n  return { points, lines };\n}","new_string":"// Enhanced illustration configuration type\ninterface IllustrationConfig {\n  points: string[];\n  lines: Array<{\n    from: string;\n    to: string;\n    label?: string;\n    color?: string;\n    labelPosition?: 'left' | 'right' | 'top' | 'bottom';\n  }>;\n}\n\n// Comprehensive illustration configurations for all metrics\nconst ILLUSTRATION_CONFIGS: Record<string, IllustrationConfig> = {\n  // ==========================================\n  // FACE SHAPE / PROPORTIONS\n  // ==========================================\n  faceWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'top' },\n      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'right' },\n    ],\n  },\n  totalFacialWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n      { from: 'trichion', to: 'menton', label: 'Total Height', color: '#a78bfa' },\n    ],\n  },\n  lowerThirdProportion: {\n    points: ['subnasale', 'menton', 'trichion'],\n    lines: [\n      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  middleThirdProportion: {\n    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n    lines: [\n      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  upperThirdProportion: {\n    points: ['trichion', 'nasal_base', 'menton'],\n    lines: [\n      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  bitemporalWidth: {\n    points: ['left_temporal', 'right_temporal', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_temporal', to: 'right_temporal', label: 'Temple', color: '#fbbf24' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek', color: '#67e8f9' },\n    ],\n  },\n  cheekboneHeight: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_lateralis', 'right_canthus_lateralis', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheekbone', color: '#ec4899' },\n      { from: 'left_canthus_lateralis', to: 'left_zygion', color: '#67e8f9' },\n    ],\n  },\n  midfaceRatio: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_medialis', 'right_canthus_medialis', 'subnasale'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Midface Width', color: '#67e8f9' },\n      { from: 'left_canthus_medialis', to: 'subnasale', label: 'Midface Height', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // JAW MEASUREMENTS\n  // ==========================================\n  jawSlope: {\n    points: ['left_gonion_inferior', 'left_mentum_lateralis', 'menton', 'right_mentum_lateralis', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'left_mentum_lateralis', label: 'Jaw Slope', color: '#f97316' },\n      { from: 'right_gonion_inferior', to: 'right_mentum_lateralis', color: '#f97316' },\n    ],\n  },\n  jawFrontalAngle: {\n    points: ['left_gonion_inferior', 'menton', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'menton', label: 'Jaw Angle', color: '#f97316' },\n      { from: 'menton', to: 'right_gonion_inferior', color: '#f97316' },\n    ],\n  },\n  bigonialWidth: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw Width', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n    ],\n  },\n  jawWidthRatio: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face', color: '#67e8f9' },\n    ],\n  },\n\n  // ==========================================\n  // EYE MEASUREMENTS\n  // ==========================================\n  lateralCanthalTilt: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'bottom' },\n      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n    ],\n  },\n  eyeAspectRatio: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'left_palpebra_superior', 'left_palpebra_inferior'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Width', color: '#06b6d4' },\n      { from: 'left_palpebra_superior', to: 'left_palpebra_inferior', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  eyeSeparationRatio: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryMouthWidthRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_cheilion', 'right_cheilion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n    ],\n  },\n  oneEyeApartTest: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Between Eyes', color: '#06b6d4' },\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Eye Width', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // EYEBROW MEASUREMENTS\n  // ==========================================\n  browLengthRatio: {\n    points: ['left_supercilium_medialis', 'left_supercilium_lateralis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_lateralis', label: 'Brow', color: '#84cc16' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  eyebrowTilt: {\n    points: ['left_supercilium_medialis', 'left_supercilium_apex', 'left_supercilium_lateralis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_apex', label: 'Tilt', color: '#84cc16' },\n      { from: 'left_supercilium_apex', to: 'left_supercilium_lateralis', color: '#84cc16' },\n    ],\n  },\n  eyebrowLowSetedness: {\n    points: ['left_supercilium_medialis', 'left_palpebra_superior', 'left_canthus_medialis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_palpebra_superior', label: 'Brow-Eye Gap', color: '#84cc16' },\n    ],\n  },\n\n  // ==========================================\n  // NOSE MEASUREMENTS (FRONT)\n  // ==========================================\n  nasalIndex: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Width', color: '#fbbf24' },\n      { from: 'nasal_base', to: 'subnasale', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  intercanthalNasalRatio: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'left_canthus_medialis', 'right_canthus_medialis'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose Width', color: '#fbbf24' },\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n    ],\n  },\n  noseBridgeWidth: {\n    points: ['left_dorsum_nasi', 'right_dorsum_nasi', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_dorsum_nasi', to: 'right_dorsum_nasi', label: 'Bridge', color: '#fbbf24' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Base', color: '#f97316' },\n    ],\n  },\n  noseTipPosition: {\n    points: ['subnasale', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Tip Position', color: '#fbbf24' },\n    ],\n  },\n\n  // ==========================================\n  // MOUTH/LIP MEASUREMENTS\n  // ==========================================\n  mouthNoseWidthRatio: {\n    points: ['left_cheilion', 'right_cheilion', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  lowerUpperLipRatio: {\n    points: ['labrale_superius', 'mouth_middle', 'labrale_inferius'],\n    lines: [\n      { from: 'labrale_superius', to: 'mouth_middle', label: 'Upper', color: '#ec4899' },\n      { from: 'mouth_middle', to: 'labrale_inferius', label: 'Lower', color: '#f97316' },\n    ],\n  },\n  chinPhiltrumRatio: {\n    points: ['subnasale', 'labrale_superius', 'labrale_inferius', 'menton'],\n    lines: [\n      { from: 'subnasale', to: 'labrale_superius', label: 'Philtrum', color: '#ec4899' },\n      { from: 'labrale_inferius', to: 'menton', label: 'Chin', color: '#ef4444' },\n    ],\n  },\n  mouthWidth: {\n    points: ['left_cheilion', 'right_cheilion'],\n    lines: [{ from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth Width', color: '#ec4899' }],\n  },\n\n  // ==========================================\n  // CHIN MEASUREMENTS\n  // ==========================================\n  chinHeight: {\n    points: ['labrale_inferius', 'menton'],\n    lines: [{ from: 'labrale_inferius', to: 'menton', label: 'Chin Height', color: '#ef4444' }],\n  },\n\n  // ==========================================\n  // NECK MEASUREMENTS\n  // ==========================================\n  neckWidthRatio: {\n    points: ['left_cervical_lateralis', 'right_cervical_lateralis', 'left_gonion_inferior', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_cervical_lateralis', to: 'right_cervical_lateralis', label: 'Neck', color: '#14b8a6' },\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n    ],\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS\n  // ==========================================\n  gonialAngle: {\n    points: ['tragus', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'tragus', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  nasofrontalAngle: {\n    points: ['glabella', 'nasion', 'pronasale'],\n    lines: [\n      { from: 'glabella', to: 'nasion', label: 'Forehead', color: '#84cc16' },\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  nasofacialAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', color: '#67e8f9' },\n    ],\n  },\n  nasomentaAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', label: 'To Chin', color: '#ef4444' },\n    ],\n  },\n  submentalCervicalAngle: {\n    points: ['menton', 'cervicalPoint', 'neckPoint'],\n    lines: [\n      { from: 'menton', to: 'cervicalPoint', label: 'Submental', color: '#14b8a6' },\n      { from: 'cervicalPoint', to: 'neckPoint', label: 'Cervical', color: '#06b6d4' },\n    ],\n  },\n  facialDepthToHeight: {\n    points: ['pronasale', 'tragus', 'nasion', 'menton'],\n    lines: [\n      { from: 'pronasale', to: 'tragus', label: 'Depth', color: '#67e8f9' },\n      { from: 'nasion', to: 'menton', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  anteriorFacialDepth: {\n    points: ['glabella', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'glabella', to: 'pronasale', color: '#67e8f9' },\n      { from: 'pronasale', to: 'pogonion', color: '#a78bfa' },\n    ],\n  },\n  mandibularPlaneAngle: {\n    points: ['gonionBottom', 'menton', 'orbitale', 'porion'],\n    lines: [\n      { from: 'gonionBottom', to: 'menton', label: 'Mandibular', color: '#f97316' },\n      { from: 'orbitale', to: 'porion', label: 'Frankfort', color: '#67e8f9' },\n    ],\n  },\n  ramusToMandibleRatio: {\n    points: ['gonionTop', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'gonionTop', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  orbitalVector: {\n    points: ['cornealApex', 'orbitale', 'cheekbone'],\n    lines: [\n      { from: 'cornealApex', to: 'cheekbone', label: 'Orbital Vector', color: '#06b6d4' },\n    ],\n  },\n  eLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'E-Line', color: '#67e8f9' },\n    ],\n  },\n  sLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'S-Line', color: '#a78bfa' },\n    ],\n  },\n  holdawayHLine: {\n    points: ['pronasale', 'pogonion', 'labraleSuperius', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'H-Line', color: '#ec4899' },\n    ],\n  },\n  burstoneLowerLip: {\n    points: ['subnasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'subnasale', to: 'pogonion', label: 'Burstone', color: '#fbbf24' },\n    ],\n  },\n};\n\nfunction generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  const config = ILLUSTRATION_CONFIGS[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = {\n        from: line.from,\n        to: line.to,\n        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":16097,"cache_read_input_tokens":70623,"cache_creation":{"ephemeral_5m_input_tokens":16097,"ephemeral_1h_input_tokens":0},"output_tokens":7275,"service_tier":"standard"}},"requestId":"req_011CWJboQDCrB3GH1TwKXvTX","type":"assistant","uuid":"61d83556-9c65-4625-a613-303c1c8b5c62","timestamp":"2025-12-20T20:53:25.154Z"}
{"type":"file-history-snapshot","messageId":"61d83556-9c65-4625-a613-303c1c8b5c62","snapshot":{"messageId":"2e08c307-8b28-49bb-9983-28482f596229","trackedFileBackups":{"src/contexts/ResultsContext.tsx":{"backupFileName":"a89136ca100d1202@v1","version":1,"backupTime":"2025-12-20T20:53:25.192Z"}},"timestamp":"2025-12-20T20:50:19.769Z"},"isSnapshotUpdate":true}
{"parentUuid":"61d83556-9c65-4625-a613-303c1c8b5c62","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HZeYwJohUZuxU8bK2K7xix","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   120→    } : undefined,\n   121→  };\n   122→}\n   123→\n   124→// Enhanced illustration configuration type\n   125→interface IllustrationConfig {\n   126→  points: string[];\n   127→  lines: Array<{\n   128→    from: string;\n   129→    to: string;\n   130→    label?: string;\n   131→    color?: string;\n   132→    labelPosition?: 'left' | 'right' | 'top' | 'bottom';\n   133→  }>;\n   134→}\n   135→\n   136→// Comprehensive illustration configurations for all metrics\n   137→const ILLUSTRATION_CONFIGS: Record<string, IllustrationConfig> = {\n   138→  // ==========================================\n   139→  // FACE SHAPE / PROPORTIONS\n   140→  // ==========================================\n   141→  faceWidthToHeight: {\n   142→    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n   143→    lines: [\n   144→      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'top' },\n   145→      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'right' },\n   146→    ],\n   147→  },\n   148→  totalFacialWidthToHeight: {\n   149→    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n   150→    lines: [\n   151→      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n   152→      { from: 'trichion', to: 'menton', label: 'Total Height', color: '#a78bfa' },\n   153→    ],\n   154→  },\n   155→  lowerThirdProportion: {\n   156→    points: ['subnasale', 'menton', 'trichion'],\n   157→    lines: [\n   158→      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'right' },\n   159→      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n   160→    ],\n   161→  },\n   162→  middleThirdProportion: {\n   163→    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n   164→    lines: [\n   165→      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'right' },\n   166→      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n   167→    ],\n   168→  },\n   169→  upperThirdProportion: {\n   170→    points: ['trichion', 'nasal_base', 'menton'],\n   171→    lines: [\n   172→      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'right' },\n   173→      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n   174→    ],\n   175→  },\n   176→  bitemporalWidth: {\n   177→    points: ['left_temporal', 'right_temporal', 'left_zygion', 'right_zygion'],\n   178→    lines: [\n   179→      { from: 'left_temporal', to: 'right_temporal', label: 'Temple', color: '#fbbf24' },\n   180→      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek', color: '#67e8f9' },\n   181→    ],\n   182→  },\n   183→  cheekboneHeight: {\n   184→    points: ['left_zygion', 'right_zygion', 'left_canthus_lateralis', 'right_canthus_lateralis', 'menton'],\n   185→    lines: [\n   186→      { from: 'left_zygion', to: 'right_zygion', label: 'Cheekbone', color: '#ec4899' },\n   187→      { from: 'left_canthus_lateralis', to: 'left_zygion', color: '#67e8f9' },\n   188→    ],\n   189→  },\n   190→  midfaceRatio: {\n   191→    points: ['left_zygion', 'right_zygion', 'left_canthus_medialis', 'right_canthus_medialis', 'subnasale'],\n   192→    lines: [\n   193→      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Midface Width', color: '#67e8f9' },\n   194→      { from: 'left_canthus_medialis', to: 'subnasale', label: 'Midface Height', color: '#a78bfa' },\n   195→    ],\n   196→  },\n   197→\n   198→  // ==========================================\n   199→  // JAW MEASUREMENTS\n   200→  // ==========================================\n   201→  jawSlope: {\n   202→    points: ['left_gonion_inferior', 'left_mentum_lateralis', 'menton', 'right_mentum_lateralis', 'right_gonion_inferior'],\n   203→    lines: [\n   204→      { from: 'left_gonion_inferior', to: 'left_mentum_lateralis', label: 'Jaw Slope', color: '#f97316' },\n   205→      { from: 'right_gonion_inferior', to: 'right_mentum_lateralis', color: '#f97316' },\n   206→    ],\n   207→  },\n   208→  jawFrontalAngle: {\n   209→    points: ['left_gonion_inferior', 'menton', 'right_gonion_inferior'],\n   210→    lines: [\n   211→      { from: 'left_gonion_inferior', to: 'menton', label: 'Jaw Angle', color: '#f97316' },\n   212→      { from: 'menton', to: 'right_gonion_inferior', color: '#f97316' },\n   213→    ],\n   214→  },\n   215→  bigonialWidth: {\n   216→    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n   217→    lines: [\n   218→      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw Width', color: '#f97316' },\n   219→      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n   220→    ],\n   221→  },\n   222→  jawWidthRatio: {\n   223→    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n   224→    lines: [\n   225→      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n   226→      { from: 'left_zygion', to: 'right_zygion', label: 'Face', color: '#67e8f9' },\n   227→    ],\n   228→  },\n   229→\n   230→  // ==========================================\n   231→  // EYE MEASUREMENTS\n   232→  // ==========================================\n   233→  lateralCanthalTilt: {\n   234→    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n   235→    lines: [\n   236→      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'bottom' },\n   237→      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n   238→    ],\n   239→  },\n   240→  eyeAspectRatio: {\n   241→    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'left_palpebra_superior', 'left_palpebra_inferior'],\n   242→    lines: [\n   243→      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Width', color: '#06b6d4' },\n   244→      { from: 'left_palpebra_superior', to: 'left_palpebra_inferior', label: 'Height', color: '#a78bfa' },\n   245→    ],\n   246→  },\n   247→  eyeSeparationRatio: {\n   248→    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_zygion', 'right_zygion'],\n   249→    lines: [\n   250→      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n   251→      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n   252→    ],\n   253→  },\n   254→  interpupillaryRatio: {\n   255→    points: ['left_pupila', 'right_pupila', 'left_zygion', 'right_zygion'],\n   256→    lines: [\n   257→      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n   258→      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n   259→    ],\n   260→  },\n   261→  interpupillaryMouthWidthRatio: {\n   262→    points: ['left_pupila', 'right_pupila', 'left_cheilion', 'right_cheilion'],\n   263→    lines: [\n   264→      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n   265→      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n   266→    ],\n   267→  },\n   268→  oneEyeApartTest: {\n   269→    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_canthus_lateralis'],\n   270→    lines: [\n   271→      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Between Eyes', color: '#06b6d4' },\n   272→      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Eye Width', color: '#a78bfa' },\n   273→    ],\n   274→  },\n   275→\n   276→  // ==========================================\n   277→  // EYEBROW MEASUREMENTS\n   278→  // ==========================================\n   279→  browLengthRatio: {\n   280→    points: ['left_supercilium_medialis', 'left_supercilium_lateralis', 'left_zygion', 'right_zygion'],\n   281→    lines: [\n   282→      { from: 'left_supercilium_medialis', to: 'left_supercilium_lateralis', label: 'Brow', color: '#84cc16' },\n   283→      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n   284→    ],\n   285→  },\n   286→  eyebrowTilt: {\n   287→    points: ['left_supercilium_medialis', 'left_supercilium_apex', 'left_supercilium_lateralis'],\n   288→    lines: [\n   289→      { from: 'left_supercilium_medialis', to: 'left_supercilium_apex', label: 'Tilt', color: '#84cc16' },\n   290→      { from: 'left_supercilium_apex', to: 'left_supercilium_lateralis', color: '#84cc16' },\n   291→    ],\n   292→  },\n   293→  eyebrowLowSetedness: {\n   294→    points: ['left_supercilium_medialis', 'left_palpebra_superior', 'left_canthus_medialis'],\n   295→    lines: [\n   296→      { from: 'left_supercilium_medialis', to: 'left_palpebra_superior', label: 'Brow-Eye Gap', color: '#84cc16' },\n   297→    ],\n   298→  },\n   299→\n   300→  // ==========================================\n   301→  // NOSE MEASUREMENTS (FRONT)\n   302→  // ==========================================\n   303→  nasalIndex: {\n   304→    points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n   305→    lines: [\n   306→      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Width', color: '#fbbf24' },\n   307→      { from: 'nasal_base', to: 'subnasale', label: 'Height', color: '#a78bfa' },\n   308→    ],\n   309→  },\n   310→  intercanthalNasalRatio: {\n   311→    points: ['left_ala_nasi', 'right_ala_nasi', 'left_canthus_medialis', 'right_canthus_medialis'],\n   312→    lines: [\n   313→      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose Width', color: '#fbbf24' },\n   314→      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n   315→    ],\n   316→  },\n   317→  noseBridgeWidth: {\n   318→    points: ['left_dorsum_nasi', 'right_dorsum_nasi', 'left_ala_nasi', 'right_ala_nasi'],\n   319→    lines: [\n   320→      { from: 'left_dorsum_nasi', to: 'right_dorsum_nasi', label: 'Bridge', color: '#fbbf24' },\n   321→      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Base', color: '#f97316' },\n   322→    ],\n   323→  },\n   324→  noseTipPosition: {\n   325→    points: ['subnasale', 'left_ala_nasi', 'right_ala_nasi'],\n   326→    lines: [\n   327→      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Tip Position', color: '#fbbf24' },\n   328→    ],\n   329→  },\n   330→\n   331→  // ==========================================\n   332→  // MOUTH/LIP MEASUREMENTS\n   333→  // ==========================================\n   334→  mouthNoseWidthRatio: {\n   335→    points: ['left_cheilion', 'right_cheilion', 'left_ala_nasi', 'right_ala_nasi'],\n   336→    lines: [\n   337→      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n   338→      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose', color: '#fbbf24' },\n   339→    ],\n   340→  },\n   341→  lowerUpperLipRatio: {\n   342→    points: ['labrale_superius', 'mouth_middle', 'labrale_inferius'],\n   343→    lines: [\n   344→      { from: 'labrale_superius', to: 'mouth_middle', label: 'Upper', color: '#ec4899' },\n   345→      { from: 'mouth_middle', to: 'labrale_inferius', label: 'Lower', color: '#f97316' },\n   346→    ],\n   347→  },\n   348→  chinPhiltrumRatio: {\n   349→    points: ['subnasale', 'labrale_superius', 'labrale_inferius', 'menton'],\n   350→    lines: [\n   351→      { from: 'subnasale', to: 'labrale_superius', label: 'Philtrum', color: '#ec4899' },\n   352→      { from: 'labrale_inferius', to: 'menton', label: 'Chin', color: '#ef4444' },\n   353→    ],\n   354→  },\n   355→  mouthWidth: {\n   356→    points: ['left_cheilion', 'right_cheilion'],\n   357→    lines: [{ from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth Width', color: '#ec4899' }],\n   358→  },\n   359→\n   360→  // ==========================================\n   361→  // CHIN MEASUREMENTS\n   362→  // ==========================================\n   363→  chinHeight: {\n   364→    points: ['labrale_inferius', 'menton'],\n   365→    lines: [{ from: 'labrale_inferius', to: 'menton', label: 'Chin Height', color: '#ef4444' }],\n   366→  },\n   367→\n   368→  // ==========================================\n   369→  // NECK MEASUREMENTS\n   370→  // ==========================================\n   371→  neckWidthRatio: {\n   372→    points: ['left_cervical_lateralis', 'right_cervical_lateralis', 'left_gonion_inferior', 'right_gonion_inferior'],\n   373→    lines: [\n   374→      { from: 'left_cervical_lateralis', to: 'right_cervical_lateralis', label: 'Neck', color: '#14b8a6' },\n   375→      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n   376→    ],\n   377→  },\n   378→\n   379→  // ==========================================\n   380→  // SIDE PROFILE MEASUREMENTS\n   381→  // ==========================================\n   382→  gonialAngle: {\n   383→    points: ['tragus', 'gonionBottom', 'menton'],\n   384→    lines: [\n   385→      { from: 'tragus', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n   386→      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n   387→    ],\n   388→  },\n   389→  nasofrontalAngle: {\n   390→    points: ['glabella', 'nasion', 'pronasale'],\n   391→    lines: [\n   392→      { from: 'glabella', to: 'nasion', label: 'Forehead', color: '#84cc16' },\n   393→      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n   394→    ],\n   395→  },\n   396→  nasofacialAngle: {\n   397→    points: ['nasion', 'pronasale', 'pogonion'],\n   398→    lines: [\n   399→      { from: 'nasion', to: 'pronasale', color: '#fbbf24' },\n   400→      { from: 'pronasale', to: 'pogonion', color: '#67e8f9' },\n   401→    ],\n   402→  },\n   403→  nasomentaAngle: {\n   404→    points: ['nasion', 'pronasale', 'pogonion'],\n   405→    lines: [\n   406→      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n   407→      { from: 'pronasale', to: 'pogonion', label: 'To Chin', color: '#ef4444' },\n   408→    ],\n   409→  },\n   410→  submentalCervicalAngle: {\n   411→    points: ['menton', 'cervicalPoint', 'neckPoint'],\n   412→    lines: [\n   413→      { from: 'menton', to: 'cervicalPoint', label: 'Submental', color: '#14b8a6' },\n   414→      { from: 'cervicalPoint', to: 'neckPoint', label: 'Cervical', color: '#06b6d4' },\n   415→    ],\n   416→  },\n   417→  facialDepthToHeight: {\n   418→    points: ['pronasale', 'tragus', 'nasion', 'menton'],\n   419→    lines: [\n   420→      { from: 'pronasale', to: 'tragus', label: 'Depth', color: '#67e8f9' },\n   421→      { from: 'nasion', to: 'menton', label: 'Height', color: '#a78bfa' },\n   422→    ],\n   423→  },\n   424→  anteriorFacialDepth: {\n   425→    points: ['glabella', 'pronasale', 'pogonion'],\n   426→    lines: [\n   427→      { from: 'glabella', to: 'pronasale', color: '#67e8f9' },\n   428→      { from: 'pronasale', to: 'pogonion', color: '#a78bfa' },\n   429→    ],\n   430→  },\n   431→  mandibularPlaneAngle: {\n   432→    points: ['gonionBottom', 'menton', 'orbitale', 'porion'],\n   433→    lines: [\n   434→      { from: 'gonionBottom', to: 'menton', label: 'Mandibular', color: '#f97316' },\n   435→      { from: 'orbitale', to: 'porion', label: 'Frankfort', color: '#67e8f9' },\n   436→    ],\n   437→  },\n   438→  ramusToMandibleRatio: {\n   439→    points: ['gonionTop', 'gonionBottom', 'menton'],\n   440→    lines: [\n   441→      { from: 'gonionTop', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n   442→      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n   443→    ],\n   444→  },\n   445→  orbitalVector: {\n   446→    points: ['cornealApex', 'orbitale', 'cheekbone'],\n   447→    lines: [\n   448→      { from: 'cornealApex', to: 'cheekbone', label: 'Orbital Vector', color: '#06b6d4' },\n   449→    ],\n   450→  },\n   451→  eLineLowerLip: {\n   452→    points: ['pronasale', 'pogonion', 'labraleInferius'],\n   453→    lines: [\n   454→      { from: 'pronasale', to: 'pogonion', label: 'E-Line', color: '#67e8f9' },\n   455→    ],\n   456→  },\n   457→  sLineLowerLip: {\n   458→    points: ['pronasale', 'pogonion', 'labraleInferius'],\n   459→    lines: [\n   460→      { from: 'pronasale', to: 'pogonion', label: 'S-Line', color: '#a78bfa' },\n   461→    ],\n   462→  },\n   463→  holdawayHLine: {\n   464→    points: ['pronasale', 'pogonion', 'labraleSuperius', 'labraleInferius'],\n   465→    lines: [\n   466→      { from: 'pronasale', to: 'pogonion', label: 'H-Line', color: '#ec4899' },\n   467→    ],\n   468→  },\n   469→  burstoneLowerLip: {\n   470→    points: ['subnasale', 'pogonion', 'labraleInferius'],\n   471→    lines: [\n   472→      { from: 'subnasale', to: 'pogonion', label: 'Burstone', color: '#fbbf24' },\n   473→    ],\n   474→  },\n   475→};\n   476→\n   477→function generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n   478→  const landmarkMap: Record<string, LandmarkPoint> = {};\n   479→  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n   480→\n   481→  const config = ILLUSTRATION_CONFIGS[metricId];\n   482→  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n   483→  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};\n   484→\n   485→  if (config) {\n   486→    config.points.forEach((pointId, i) => {\n   487→      if (landmarkMap[pointId]) {\n   488→        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n   489→      }\n   490→    });\n   491→    config.lines.forEach((line, i) => {\n   492→      lines[`line_${i}`] = {\n   493→        from: line.from,\n   494→        to: line.to,\n   495→        color: line.color || '#67e8f9',\n   496→        label: line.label,\n   497→        labelPosition: line.labelPosition,\n   498→      };\n   499→    });\n   500→  }\n   501→\n   502→  return { points, lines };\n   503→}\n   504→\n   505→function getUsedLandmarks(metricId: string): string[] {\n   506→  const landmarkMappings: Record<string, string[]> = {\n   507→    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],"}]},"uuid":"ab3fb9ce-6d0a-4b26-9a32-f95a9712cde6","timestamp":"2025-12-20T20:53:25.190Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","oldString":"function generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  // Default illustration - will be enhanced with metric-specific data\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  // Metric-specific illustration configurations\n  const illustrationConfigs: Record<string, { points: string[]; lines: Array<{ from: string; to: string }> }> = {\n    faceWidthToHeight: {\n      points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n      lines: [\n        { from: 'left_zygion', to: 'right_zygion' },\n        { from: 'trichion', to: 'menton' },\n      ],\n    },\n    lateralCanthalTilt: {\n      points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n      lines: [\n        { from: 'left_canthus_medialis', to: 'left_canthus_lateralis' },\n        { from: 'right_canthus_medialis', to: 'right_canthus_lateralis' },\n      ],\n    },\n    nasalIndex: {\n      points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n      lines: [\n        { from: 'left_ala_nasi', to: 'right_ala_nasi' },\n        { from: 'nasal_base', to: 'subnasale' },\n      ],\n    },\n    mouthWidth: {\n      points: ['left_cheilion', 'right_cheilion'],\n      lines: [{ from: 'left_cheilion', to: 'right_cheilion' }],\n    },\n    jawWidth: {\n      points: ['left_gonion_inferior', 'right_gonion_inferior'],\n      lines: [{ from: 'left_gonion_inferior', to: 'right_gonion_inferior' }],\n    },\n    chinHeight: {\n      points: ['labrale_inferius', 'menton'],\n      lines: [{ from: 'labrale_inferius', to: 'menton' }],\n    },\n  };\n\n  const config = illustrationConfigs[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = { from: line.from, to: line.to, color: '#67e8f9' };\n    });\n  }\n\n  return { points, lines };\n}","newString":"// Enhanced illustration configuration type\ninterface IllustrationConfig {\n  points: string[];\n  lines: Array<{\n    from: string;\n    to: string;\n    label?: string;\n    color?: string;\n    labelPosition?: 'left' | 'right' | 'top' | 'bottom';\n  }>;\n}\n\n// Comprehensive illustration configurations for all metrics\nconst ILLUSTRATION_CONFIGS: Record<string, IllustrationConfig> = {\n  // ==========================================\n  // FACE SHAPE / PROPORTIONS\n  // ==========================================\n  faceWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'top' },\n      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'right' },\n    ],\n  },\n  totalFacialWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n      { from: 'trichion', to: 'menton', label: 'Total Height', color: '#a78bfa' },\n    ],\n  },\n  lowerThirdProportion: {\n    points: ['subnasale', 'menton', 'trichion'],\n    lines: [\n      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  middleThirdProportion: {\n    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n    lines: [\n      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  upperThirdProportion: {\n    points: ['trichion', 'nasal_base', 'menton'],\n    lines: [\n      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  bitemporalWidth: {\n    points: ['left_temporal', 'right_temporal', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_temporal', to: 'right_temporal', label: 'Temple', color: '#fbbf24' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek', color: '#67e8f9' },\n    ],\n  },\n  cheekboneHeight: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_lateralis', 'right_canthus_lateralis', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheekbone', color: '#ec4899' },\n      { from: 'left_canthus_lateralis', to: 'left_zygion', color: '#67e8f9' },\n    ],\n  },\n  midfaceRatio: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_medialis', 'right_canthus_medialis', 'subnasale'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Midface Width', color: '#67e8f9' },\n      { from: 'left_canthus_medialis', to: 'subnasale', label: 'Midface Height', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // JAW MEASUREMENTS\n  // ==========================================\n  jawSlope: {\n    points: ['left_gonion_inferior', 'left_mentum_lateralis', 'menton', 'right_mentum_lateralis', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'left_mentum_lateralis', label: 'Jaw Slope', color: '#f97316' },\n      { from: 'right_gonion_inferior', to: 'right_mentum_lateralis', color: '#f97316' },\n    ],\n  },\n  jawFrontalAngle: {\n    points: ['left_gonion_inferior', 'menton', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'menton', label: 'Jaw Angle', color: '#f97316' },\n      { from: 'menton', to: 'right_gonion_inferior', color: '#f97316' },\n    ],\n  },\n  bigonialWidth: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw Width', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n    ],\n  },\n  jawWidthRatio: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face', color: '#67e8f9' },\n    ],\n  },\n\n  // ==========================================\n  // EYE MEASUREMENTS\n  // ==========================================\n  lateralCanthalTilt: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'bottom' },\n      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n    ],\n  },\n  eyeAspectRatio: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'left_palpebra_superior', 'left_palpebra_inferior'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Width', color: '#06b6d4' },\n      { from: 'left_palpebra_superior', to: 'left_palpebra_inferior', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  eyeSeparationRatio: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryMouthWidthRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_cheilion', 'right_cheilion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n    ],\n  },\n  oneEyeApartTest: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Between Eyes', color: '#06b6d4' },\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Eye Width', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // EYEBROW MEASUREMENTS\n  // ==========================================\n  browLengthRatio: {\n    points: ['left_supercilium_medialis', 'left_supercilium_lateralis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_lateralis', label: 'Brow', color: '#84cc16' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  eyebrowTilt: {\n    points: ['left_supercilium_medialis', 'left_supercilium_apex', 'left_supercilium_lateralis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_apex', label: 'Tilt', color: '#84cc16' },\n      { from: 'left_supercilium_apex', to: 'left_supercilium_lateralis', color: '#84cc16' },\n    ],\n  },\n  eyebrowLowSetedness: {\n    points: ['left_supercilium_medialis', 'left_palpebra_superior', 'left_canthus_medialis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_palpebra_superior', label: 'Brow-Eye Gap', color: '#84cc16' },\n    ],\n  },\n\n  // ==========================================\n  // NOSE MEASUREMENTS (FRONT)\n  // ==========================================\n  nasalIndex: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Width', color: '#fbbf24' },\n      { from: 'nasal_base', to: 'subnasale', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  intercanthalNasalRatio: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'left_canthus_medialis', 'right_canthus_medialis'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose Width', color: '#fbbf24' },\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n    ],\n  },\n  noseBridgeWidth: {\n    points: ['left_dorsum_nasi', 'right_dorsum_nasi', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_dorsum_nasi', to: 'right_dorsum_nasi', label: 'Bridge', color: '#fbbf24' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Base', color: '#f97316' },\n    ],\n  },\n  noseTipPosition: {\n    points: ['subnasale', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Tip Position', color: '#fbbf24' },\n    ],\n  },\n\n  // ==========================================\n  // MOUTH/LIP MEASUREMENTS\n  // ==========================================\n  mouthNoseWidthRatio: {\n    points: ['left_cheilion', 'right_cheilion', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  lowerUpperLipRatio: {\n    points: ['labrale_superius', 'mouth_middle', 'labrale_inferius'],\n    lines: [\n      { from: 'labrale_superius', to: 'mouth_middle', label: 'Upper', color: '#ec4899' },\n      { from: 'mouth_middle', to: 'labrale_inferius', label: 'Lower', color: '#f97316' },\n    ],\n  },\n  chinPhiltrumRatio: {\n    points: ['subnasale', 'labrale_superius', 'labrale_inferius', 'menton'],\n    lines: [\n      { from: 'subnasale', to: 'labrale_superius', label: 'Philtrum', color: '#ec4899' },\n      { from: 'labrale_inferius', to: 'menton', label: 'Chin', color: '#ef4444' },\n    ],\n  },\n  mouthWidth: {\n    points: ['left_cheilion', 'right_cheilion'],\n    lines: [{ from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth Width', color: '#ec4899' }],\n  },\n\n  // ==========================================\n  // CHIN MEASUREMENTS\n  // ==========================================\n  chinHeight: {\n    points: ['labrale_inferius', 'menton'],\n    lines: [{ from: 'labrale_inferius', to: 'menton', label: 'Chin Height', color: '#ef4444' }],\n  },\n\n  // ==========================================\n  // NECK MEASUREMENTS\n  // ==========================================\n  neckWidthRatio: {\n    points: ['left_cervical_lateralis', 'right_cervical_lateralis', 'left_gonion_inferior', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_cervical_lateralis', to: 'right_cervical_lateralis', label: 'Neck', color: '#14b8a6' },\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n    ],\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS\n  // ==========================================\n  gonialAngle: {\n    points: ['tragus', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'tragus', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  nasofrontalAngle: {\n    points: ['glabella', 'nasion', 'pronasale'],\n    lines: [\n      { from: 'glabella', to: 'nasion', label: 'Forehead', color: '#84cc16' },\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  nasofacialAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', color: '#67e8f9' },\n    ],\n  },\n  nasomentaAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', label: 'To Chin', color: '#ef4444' },\n    ],\n  },\n  submentalCervicalAngle: {\n    points: ['menton', 'cervicalPoint', 'neckPoint'],\n    lines: [\n      { from: 'menton', to: 'cervicalPoint', label: 'Submental', color: '#14b8a6' },\n      { from: 'cervicalPoint', to: 'neckPoint', label: 'Cervical', color: '#06b6d4' },\n    ],\n  },\n  facialDepthToHeight: {\n    points: ['pronasale', 'tragus', 'nasion', 'menton'],\n    lines: [\n      { from: 'pronasale', to: 'tragus', label: 'Depth', color: '#67e8f9' },\n      { from: 'nasion', to: 'menton', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  anteriorFacialDepth: {\n    points: ['glabella', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'glabella', to: 'pronasale', color: '#67e8f9' },\n      { from: 'pronasale', to: 'pogonion', color: '#a78bfa' },\n    ],\n  },\n  mandibularPlaneAngle: {\n    points: ['gonionBottom', 'menton', 'orbitale', 'porion'],\n    lines: [\n      { from: 'gonionBottom', to: 'menton', label: 'Mandibular', color: '#f97316' },\n      { from: 'orbitale', to: 'porion', label: 'Frankfort', color: '#67e8f9' },\n    ],\n  },\n  ramusToMandibleRatio: {\n    points: ['gonionTop', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'gonionTop', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  orbitalVector: {\n    points: ['cornealApex', 'orbitale', 'cheekbone'],\n    lines: [\n      { from: 'cornealApex', to: 'cheekbone', label: 'Orbital Vector', color: '#06b6d4' },\n    ],\n  },\n  eLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'E-Line', color: '#67e8f9' },\n    ],\n  },\n  sLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'S-Line', color: '#a78bfa' },\n    ],\n  },\n  holdawayHLine: {\n    points: ['pronasale', 'pogonion', 'labraleSuperius', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'H-Line', color: '#ec4899' },\n    ],\n  },\n  burstoneLowerLip: {\n    points: ['subnasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'subnasale', to: 'pogonion', label: 'Burstone', color: '#fbbf24' },\n    ],\n  },\n};\n\nfunction generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  const config = ILLUSTRATION_CONFIGS[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = {\n        from: line.from,\n        to: line.to,\n        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}","originalFile":"'use client';\n\nimport React, { createContext, useContext, useState, useMemo, useCallback, ReactNode } from 'react';\nimport { LandmarkPoint } from '@/lib/landmarks';\nimport {\n  analyzeFrontProfile,\n  analyzeSideProfile,\n  analyzeHarmony,\n  HarmonyAnalysis,\n  FaceIQScoreResult,\n  FACEIQ_METRICS,\n  Ethnicity,\n  Gender,\n} from '@/lib/faceiq-scoring';\nimport {\n  Ratio,\n  Strength,\n  Flaw,\n  Recommendation,\n  ResultsTab,\n  FullHarmonyAnalysis,\n} from '@/types/results';\n\n// ============================================\n// CONTEXT TYPES\n// ============================================\n\ninterface ResultsContextType {\n  // Raw data\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  gender: Gender;\n  ethnicity: Ethnicity;\n  frontPhoto: string;\n  sidePhoto: string | null;\n\n  // Computed results\n  harmonyAnalysis: FullHarmonyAnalysis | null;\n  frontRatios: Ratio[];\n  sideRatios: Ratio[];\n  strengths: Strength[];\n  flaws: Flaw[];\n  recommendations: Recommendation[];\n\n  // Scores\n  overallScore: number;\n  frontScore: number;\n  sideScore: number;\n\n  // UI state\n  activeTab: ResultsTab;\n  setActiveTab: (tab: ResultsTab) => void;\n  expandedMeasurementId: string | null;\n  setExpandedMeasurementId: (id: string | null) => void;\n  selectedVisualizationMetric: string | null;\n  setSelectedVisualizationMetric: (id: string | null) => void;\n  categoryFilter: string | null;\n  setCategoryFilter: (category: string | null) => void;\n  showLandmarkOverlay: boolean;\n  setShowLandmarkOverlay: (show: boolean) => void;\n\n  // Actions\n  setResultsData: (data: ResultsInputData) => void;\n}\n\ninterface ResultsInputData {\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  frontPhoto: string;\n  sidePhoto?: string;\n  gender: Gender;\n  ethnicity?: Ethnicity;\n}\n\n// ============================================\n// HELPER FUNCTIONS\n// ============================================\n\nfunction convertUnitToRatioUnit(unit: string): 'x' | 'mm' | '%' | '°' {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return '°';\n    case 'mm': return 'mm';\n    default: return 'x';\n  }\n}\n\nfunction transformToRatio(result: FaceIQScoreResult, landmarks: LandmarkPoint[]): Ratio {\n  const metricConfig = FACEIQ_METRICS[result.metricId];\n\n  // Generate illustration based on metric\n  const illustration = generateIllustration(result.metricId, landmarks);\n\n  // Get flaw/strength mappings\n  const { mayIndicateFlaws, mayIndicateStrengths } = getFlawStrengthMappings(result);\n\n  return {\n    id: result.metricId,\n    name: result.name,\n    value: result.value,\n    score: result.score,\n    standardizedScore: result.standardizedScore,\n    unit: convertUnitToRatioUnit(result.unit),\n    idealMin: result.idealMin,\n    idealMax: result.idealMax,\n    rangeMin: metricConfig?.rangeMin || result.idealMin - 0.5,\n    rangeMax: metricConfig?.rangeMax || result.idealMax + 0.5,\n    description: metricConfig?.description || '',\n    category: result.category,\n    qualityLevel: result.qualityTier,\n    severity: result.severity,\n    illustration,\n    mayIndicateFlaws,\n    mayIndicateStrengths,\n    usedLandmarks: getUsedLandmarks(result.metricId),\n    scoringCurveConfig: metricConfig ? {\n      decayRate: metricConfig.decayRate,\n      maxScore: metricConfig.maxScore,\n    } : undefined,\n  };\n}\n\nfunction generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  // Default illustration - will be enhanced with metric-specific data\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  // Metric-specific illustration configurations\n  const illustrationConfigs: Record<string, { points: string[]; lines: Array<{ from: string; to: string }> }> = {\n    faceWidthToHeight: {\n      points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n      lines: [\n        { from: 'left_zygion', to: 'right_zygion' },\n        { from: 'trichion', to: 'menton' },\n      ],\n    },\n    lateralCanthalTilt: {\n      points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n      lines: [\n        { from: 'left_canthus_medialis', to: 'left_canthus_lateralis' },\n        { from: 'right_canthus_medialis', to: 'right_canthus_lateralis' },\n      ],\n    },\n    nasalIndex: {\n      points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n      lines: [\n        { from: 'left_ala_nasi', to: 'right_ala_nasi' },\n        { from: 'nasal_base', to: 'subnasale' },\n      ],\n    },\n    mouthWidth: {\n      points: ['left_cheilion', 'right_cheilion'],\n      lines: [{ from: 'left_cheilion', to: 'right_cheilion' }],\n    },\n    jawWidth: {\n      points: ['left_gonion_inferior', 'right_gonion_inferior'],\n      lines: [{ from: 'left_gonion_inferior', to: 'right_gonion_inferior' }],\n    },\n    chinHeight: {\n      points: ['labrale_inferius', 'menton'],\n      lines: [{ from: 'labrale_inferius', to: 'menton' }],\n    },\n  };\n\n  const config = illustrationConfigs[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = { from: line.from, to: line.to, color: '#67e8f9' };\n    });\n  }\n\n  return { points, lines };\n}\n\nfunction getUsedLandmarks(metricId: string): string[] {\n  const landmarkMappings: Record<string, string[]> = {\n    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lateralCanthalTilt: ['left_canthus_medialis', 'left_canthus_lateralis'],\n    nasalIndex: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    ipd: ['left_pupila', 'right_pupila'],\n    mouthWidth: ['left_cheilion', 'right_cheilion'],\n    jawWidth: ['left_gonion_inferior', 'right_gonion_inferior'],\n    chinHeight: ['labrale_inferius', 'menton'],\n    gonialAngle: ['tragus', 'gonionBottom', 'menton'],\n  };\n  return landmarkMappings[metricId] || [];\n}\n\nfunction getFlawStrengthMappings(result: FaceIQScoreResult): { mayIndicateFlaws: string[]; mayIndicateStrengths: string[] } {\n  const flawMappings: Record<string, { low: string[]; high: string[] }> = {\n    faceWidthToHeight: {\n      low: ['Narrow face', 'Vertically elongated face'],\n      high: ['Wide face', 'Horizontally expanded face'],\n    },\n    lowerThirdProportion: {\n      low: ['Short lower third', 'Deficient mandible'],\n      high: ['Long lower third', 'Mandibular excess'],\n    },\n    lateralCanthalTilt: {\n      low: ['Negative canthal tilt', 'Drooping eyes'],\n      high: ['Excessive positive canthal tilt'],\n    },\n    nasalIndex: {\n      low: ['Narrow nose', 'Leptorrhine nose'],\n      high: ['Wide nose', 'Platyrrhine nose'],\n    },\n    gonialAngle: {\n      low: ['Steep mandibular plane'],\n      high: ['Flat mandibular plane', 'Weak jaw definition'],\n    },\n  };\n\n  const strengthMappings: Record<string, { ideal: string[] }> = {\n    faceWidthToHeight: { ideal: ['Balanced facial proportions', 'Harmonious face shape'] },\n    lateralCanthalTilt: { ideal: ['Attractive eye shape', 'Positive canthal tilt'] },\n    nasalIndex: { ideal: ['Well-proportioned nose', 'Balanced nasal width'] },\n    gonialAngle: { ideal: ['Well-defined jawline', 'Strong jaw structure'] },\n  };\n\n  const mapping = flawMappings[result.metricId];\n  const strengthMapping = strengthMappings[result.metricId];\n\n  let mayIndicateFlaws: string[] = [];\n  let mayIndicateStrengths: string[] = [];\n\n  if (result.qualityTier === 'ideal' || result.qualityTier === 'excellent') {\n    mayIndicateStrengths = strengthMapping?.ideal || [];\n  } else if (mapping) {\n    mayIndicateFlaws = result.deviationDirection === 'below' ? mapping.low : mapping.high;\n  }\n\n  return { mayIndicateFlaws, mayIndicateStrengths };\n}\n\nfunction generateStrengthsFromAnalysis(analysis: HarmonyAnalysis): Strength[] {\n  const strengths: Strength[] = [];\n\n  analysis.strengths.forEach((s, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === s.metricId);\n\n    strengths.push({\n      id: `strength_${i}`,\n      strengthName: s.metricName,\n      summary: s.reasoning,\n      avgScore: matchingMeasurement?.score || 8,\n      qualityLevel: s.qualityTier,\n      categoryName: s.category,\n      responsibleRatios: [{\n        ratioName: s.metricName,\n        ratioId: s.metricId,\n        score: matchingMeasurement?.score || 8,\n        value: s.value,\n      }],\n    });\n  });\n\n  return strengths;\n}\n\nfunction generateFlawsFromAnalysis(analysis: HarmonyAnalysis): Flaw[] {\n  const flaws: Flaw[] = [];\n  let rollingLost = 0;\n\n  analysis.flaws.forEach((f, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === f.metricId);\n    const impact = matchingMeasurement ? (10 - matchingMeasurement.score) * 0.5 : 2;\n    rollingLost += impact;\n\n    flaws.push({\n      id: `flaw_${i}`,\n      flawName: f.metricName,\n      summary: f.reasoning,\n      harmonyPercentageLost: impact,\n      standardizedImpact: impact / 10,\n      categoryName: f.category,\n      responsibleRatios: [{\n        ratioName: f.metricName,\n        ratioId: f.metricId,\n        score: matchingMeasurement?.score || 3,\n        value: matchingMeasurement?.value || 0,\n      }],\n      rollingPointsDeducted: rollingLost,\n      rollingHarmonyPercentageLost: rollingLost,\n      rollingStandardizedImpact: rollingLost / 10,\n    });\n  });\n\n  return flaws.sort((a, b) => b.harmonyPercentageLost - a.harmonyPercentageLost);\n}\n\nfunction generateRecommendations(flaws: Flaw[]): Recommendation[] {\n  // Generate recommendations based on detected flaws\n  const recommendations: Recommendation[] = [];\n\n  const procedureDatabase: Array<Omit<Recommendation, 'matchedFlaws' | 'matchedRatios' | 'ratios_impacted'> & { targetFlaws: string[] }> = [\n    {\n      ref_id: 'SUR-01',\n      name: 'Genioplasty',\n      description: 'Surgical chin repositioning to improve chin projection and facial harmony. Can move the chin forward, backward, up, or down.',\n      phase: 'Surgical',\n      impact: 0.85,\n      coverage: 8,\n      percentage: '15-25%',\n      expectedImprovementRange: { min: 0.5, max: 1.5 },\n      targetFlaws: ['Weak chin', 'Recessed chin', 'Short chin', 'chin'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n      cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n      risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'SUR-02',\n      name: 'Rhinoplasty',\n      description: 'Nose reshaping surgery to improve nasal proportions, reduce or increase size, change angle, or correct breathing issues.',\n      phase: 'Surgical',\n      impact: 0.8,\n      coverage: 6,\n      percentage: '10-20%',\n      targetFlaws: ['Wide nose', 'Long nose', 'Crooked nose', 'nose', 'nasal'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n      cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n      risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'SUR-03',\n      name: 'Jaw Implants',\n      description: 'Custom or standard implants to enhance jaw width and definition. Creates a more angular, masculine jawline.',\n      phase: 'Surgical',\n      impact: 0.75,\n      coverage: 5,\n      percentage: '10-15%',\n      targetFlaws: ['Narrow jaw', 'Weak jaw', 'jaw'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n      cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n      risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'MIN-01',\n      name: 'Dermal Fillers',\n      description: 'Hyaluronic acid injections to add volume to chin, jawline, or cheeks. Non-permanent and reversible.',\n      phase: 'Minimally Invasive',\n      impact: 0.4,\n      coverage: 4,\n      percentage: '5-10%',\n      targetFlaws: ['Weak chin', 'Flat cheeks', 'chin', 'midface'],\n      timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n      cost: { type: 'per_session', min: 600, max: 2000, currency: 'USD' },\n      risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n      warnings: ['Results temporary (6-18 months)'],\n      gender: 'both',\n    },\n    {\n      ref_id: 'MIN-02',\n      name: 'Orthodontic Treatment',\n      description: 'Braces or clear aligners to correct bite alignment and tooth positioning. Can impact facial profile over time.',\n      phase: 'Minimally Invasive',\n      impact: 0.5,\n      coverage: 3,\n      percentage: '5-15%',\n      targetFlaws: ['Bite issues', 'Midface recession', 'jaw'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 52, full_results_weeks_max: 104 },\n      cost: { type: 'flat', min: 3000, max: 10000, currency: 'USD' },\n      risks_side_effects: 'Temporary discomfort, requires compliance.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'FND-01',\n      name: 'Mewing / Proper Tongue Posture',\n      description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n      phase: 'Foundational',\n      impact: 0.2,\n      coverage: 4,\n      percentage: '2-5%',\n      targetFlaws: ['Midface recession', 'Narrow palate', 'jaw', 'midface'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n      cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n      risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n      warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n      gender: 'both',\n    },\n    {\n      ref_id: 'FND-02',\n      name: 'Body Recomposition',\n      description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n      phase: 'Foundational',\n      impact: 0.3,\n      coverage: 6,\n      percentage: '5-10%',\n      targetFlaws: ['Undefined jawline', 'Soft features', 'jaw', 'face'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n      cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n      risks_side_effects: 'None if done healthily.',\n      warnings: [],\n      gender: 'both',\n    },\n  ];\n\n  flaws.forEach(flaw => {\n    procedureDatabase.forEach(proc => {\n      const flawLower = flaw.flawName.toLowerCase();\n      const matches = proc.targetFlaws.some(target =>\n        flawLower.includes(target.toLowerCase()) || target.toLowerCase().includes(flawLower)\n      );\n\n      if (matches && !recommendations.find(r => r.ref_id === proc.ref_id)) {\n        recommendations.push({\n          ...proc,\n          matchedFlaws: [flaw.flawName],\n          matchedRatios: flaw.responsibleRatios.map(r => r.ratioName),\n          ratios_impacted: flaw.responsibleRatios.map(r => ({\n            ratioId: r.ratioId,\n            ratioName: r.ratioName,\n            direction: 'both' as const,\n            percentageEffect: 1.0,\n          })),\n        });\n      }\n    });\n  });\n\n  return recommendations.sort((a, b) => b.impact - a.impact);\n}\n\n// ============================================\n// CONTEXT CREATION\n// ============================================\n\nconst ResultsContext = createContext<ResultsContextType | null>(null);\n\nexport function useResults(): ResultsContextType {\n  const context = useContext(ResultsContext);\n  if (!context) {\n    throw new Error('useResults must be used within a ResultsProvider');\n  }\n  return context;\n}\n\ninterface ResultsProviderProps {\n  children: ReactNode;\n  initialData?: ResultsInputData;\n}\n\nexport function ResultsProvider({ children, initialData }: ResultsProviderProps) {\n  // Raw data state\n  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>(initialData?.frontLandmarks || []);\n  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>(initialData?.sideLandmarks || []);\n  const [gender, setGender] = useState<Gender>(initialData?.gender || 'male');\n  const [ethnicity, setEthnicity] = useState<Ethnicity>(initialData?.ethnicity || 'other');\n  const [frontPhoto, setFrontPhoto] = useState<string>(initialData?.frontPhoto || '');\n  const [sidePhoto, setSidePhoto] = useState<string | null>(initialData?.sidePhoto || null);\n\n  // UI state\n  const [activeTab, setActiveTab] = useState<ResultsTab>('overview');\n  const [expandedMeasurementId, setExpandedMeasurementId] = useState<string | null>(null);\n  const [selectedVisualizationMetric, setSelectedVisualizationMetric] = useState<string | null>(null);\n  const [categoryFilter, setCategoryFilter] = useState<string | null>(null);\n  const [showLandmarkOverlay, setShowLandmarkOverlay] = useState(true);\n\n  // Compute analysis results (now with demographic-specific scoring)\n  const analysisResults = useMemo(() => {\n    if (frontLandmarks.length === 0) {\n      return null;\n    }\n\n    try {\n      const frontAnalysis = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n      const sideAnalysis = sideLandmarks.length > 0\n        ? analyzeSideProfile(sideLandmarks, gender, ethnicity)\n        : null;\n      // analyzeHarmony expects landmarks directly, not analysis results\n      const harmony = analyzeHarmony(frontLandmarks, sideLandmarks, gender, ethnicity);\n\n      return { frontAnalysis, sideAnalysis, harmony };\n    } catch (error) {\n      console.error('Analysis error:', error);\n      return null;\n    }\n  }, [frontLandmarks, sideLandmarks, gender, ethnicity]);\n\n  // Transform to Ratio format\n  const frontRatios = useMemo(() => {\n    if (!analysisResults?.frontAnalysis) return [];\n    return analysisResults.frontAnalysis.measurements.map(m => transformToRatio(m, frontLandmarks));\n  }, [analysisResults, frontLandmarks]);\n\n  const sideRatios = useMemo(() => {\n    if (!analysisResults?.sideAnalysis) return [];\n    return analysisResults.sideAnalysis.measurements.map(m => transformToRatio(m, sideLandmarks));\n  }, [analysisResults, sideLandmarks]);\n\n  // Generate strengths and flaws\n  const strengths = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateStrengthsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  const flaws = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateFlawsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  // Generate recommendations\n  const recommendations = useMemo(() => {\n    return generateRecommendations(flaws);\n  }, [flaws]);\n\n  // Build full harmony analysis\n  const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {\n    if (!analysisResults?.harmony) return null;\n\n    return {\n      standardizedScore: analysisResults.harmony.overallScore,\n      front: {\n        standardizedScore: analysisResults.harmony.frontScore,\n        ratios: frontRatios,\n      },\n      side: {\n        standardizedScore: analysisResults.harmony.sideScore,\n        ratios: sideRatios,\n      },\n      strengths,\n      flaws,\n    };\n  }, [analysisResults, frontRatios, sideRatios, strengths, flaws]);\n\n  // Scores\n  const overallScore = analysisResults?.harmony?.overallScore || 0;\n  const frontScore = analysisResults?.harmony?.frontScore || 0;\n  const sideScore = analysisResults?.harmony?.sideScore || 0;\n\n  // Action to set all results data\n  const setResultsData = useCallback((data: ResultsInputData) => {\n    setFrontLandmarks(data.frontLandmarks);\n    setSideLandmarks(data.sideLandmarks);\n    setFrontPhoto(data.frontPhoto);\n    setSidePhoto(data.sidePhoto || null);\n    setGender(data.gender);\n    setEthnicity(data.ethnicity || 'other');\n  }, []);\n\n  const value: ResultsContextType = {\n    frontLandmarks,\n    sideLandmarks,\n    gender,\n    ethnicity,\n    frontPhoto,\n    sidePhoto,\n    harmonyAnalysis,\n    frontRatios,\n    sideRatios,\n    strengths,\n    flaws,\n    recommendations,\n    overallScore,\n    frontScore,\n    sideScore,\n    activeTab,\n    setActiveTab,\n    expandedMeasurementId,\n    setExpandedMeasurementId,\n    selectedVisualizationMetric,\n    setSelectedVisualizationMetric,\n    categoryFilter,\n    setCategoryFilter,\n    showLandmarkOverlay,\n    setShowLandmarkOverlay,\n    setResultsData,\n  };\n\n  return (\n    <ResultsContext.Provider value={value}>\n      {children}\n    </ResultsContext.Provider>\n  );\n}\n","structuredPatch":[{"oldStart":121,"oldLines":51,"newStart":121,"newLines":366,"lines":["   };"," }"," ","+// Enhanced illustration configuration type","+interface IllustrationConfig {","+  points: string[];","+  lines: Array<{","+    from: string;","+    to: string;","+    label?: string;","+    color?: string;","+    labelPosition?: 'left' | 'right' | 'top' | 'bottom';","+  }>;","+}","+","+// Comprehensive illustration configurations for all metrics","+const ILLUSTRATION_CONFIGS: Record<string, IllustrationConfig> = {","+  // ==========================================","+  // FACE SHAPE / PROPORTIONS","+  // ==========================================","+  faceWidthToHeight: {","+    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],","+    lines: [","+      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'top' },","+      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'right' },","+    ],","+  },","+  totalFacialWidthToHeight: {","+    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],","+    lines: [","+      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },","+      { from: 'trichion', to: 'menton', label: 'Total Height', color: '#a78bfa' },","+    ],","+  },","+  lowerThirdProportion: {","+    points: ['subnasale', 'menton', 'trichion'],","+    lines: [","+      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'right' },","+      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },","+    ],","+  },","+  middleThirdProportion: {","+    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],","+    lines: [","+      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'right' },","+      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },","+    ],","+  },","+  upperThirdProportion: {","+    points: ['trichion', 'nasal_base', 'menton'],","+    lines: [","+      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'right' },","+      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },","+    ],","+  },","+  bitemporalWidth: {","+    points: ['left_temporal', 'right_temporal', 'left_zygion', 'right_zygion'],","+    lines: [","+      { from: 'left_temporal', to: 'right_temporal', label: 'Temple', color: '#fbbf24' },","+      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek', color: '#67e8f9' },","+    ],","+  },","+  cheekboneHeight: {","+    points: ['left_zygion', 'right_zygion', 'left_canthus_lateralis', 'right_canthus_lateralis', 'menton'],","+    lines: [","+      { from: 'left_zygion', to: 'right_zygion', label: 'Cheekbone', color: '#ec4899' },","+      { from: 'left_canthus_lateralis', to: 'left_zygion', color: '#67e8f9' },","+    ],","+  },","+  midfaceRatio: {","+    points: ['left_zygion', 'right_zygion', 'left_canthus_medialis', 'right_canthus_medialis', 'subnasale'],","+    lines: [","+      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Midface Width', color: '#67e8f9' },","+      { from: 'left_canthus_medialis', to: 'subnasale', label: 'Midface Height', color: '#a78bfa' },","+    ],","+  },","+","+  // ==========================================","+  // JAW MEASUREMENTS","+  // ==========================================","+  jawSlope: {","+    points: ['left_gonion_inferior', 'left_mentum_lateralis', 'menton', 'right_mentum_lateralis', 'right_gonion_inferior'],","+    lines: [","+      { from: 'left_gonion_inferior', to: 'left_mentum_lateralis', label: 'Jaw Slope', color: '#f97316' },","+      { from: 'right_gonion_inferior', to: 'right_mentum_lateralis', color: '#f97316' },","+    ],","+  },","+  jawFrontalAngle: {","+    points: ['left_gonion_inferior', 'menton', 'right_gonion_inferior'],","+    lines: [","+      { from: 'left_gonion_inferior', to: 'menton', label: 'Jaw Angle', color: '#f97316' },","+      { from: 'menton', to: 'right_gonion_inferior', color: '#f97316' },","+    ],","+  },","+  bigonialWidth: {","+    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],","+    lines: [","+      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw Width', color: '#f97316' },","+      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },","+    ],","+  },","+  jawWidthRatio: {","+    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],","+    lines: [","+      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },","+      { from: 'left_zygion', to: 'right_zygion', label: 'Face', color: '#67e8f9' },","+    ],","+  },","+","+  // ==========================================","+  // EYE MEASUREMENTS","+  // ==========================================","+  lateralCanthalTilt: {","+    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],","+    lines: [","+      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'bottom' },","+      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },","+    ],","+  },","+  eyeAspectRatio: {","+    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'left_palpebra_superior', 'left_palpebra_inferior'],","+    lines: [","+      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Width', color: '#06b6d4' },","+      { from: 'left_palpebra_superior', to: 'left_palpebra_inferior', label: 'Height', color: '#a78bfa' },","+    ],","+  },","+  eyeSeparationRatio: {","+    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_zygion', 'right_zygion'],","+    lines: [","+      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },","+      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },","+    ],","+  },","+  interpupillaryRatio: {","+    points: ['left_pupila', 'right_pupila', 'left_zygion', 'right_zygion'],","+    lines: [","+      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },","+      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },","+    ],","+  },","+  interpupillaryMouthWidthRatio: {","+    points: ['left_pupila', 'right_pupila', 'left_cheilion', 'right_cheilion'],","+    lines: [","+      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },","+      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },","+    ],","+  },","+  oneEyeApartTest: {","+    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_canthus_lateralis'],","+    lines: [","+      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Between Eyes', color: '#06b6d4' },","+      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Eye Width', color: '#a78bfa' },","+    ],","+  },","+","+  // ==========================================","+  // EYEBROW MEASUREMENTS","+  // ==========================================","+  browLengthRatio: {","+    points: ['left_supercilium_medialis', 'left_supercilium_lateralis', 'left_zygion', 'right_zygion'],","+    lines: [","+      { from: 'left_supercilium_medialis', to: 'left_supercilium_lateralis', label: 'Brow', color: '#84cc16' },","+      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },","+    ],","+  },","+  eyebrowTilt: {","+    points: ['left_supercilium_medialis', 'left_supercilium_apex', 'left_supercilium_lateralis'],","+    lines: [","+      { from: 'left_supercilium_medialis', to: 'left_supercilium_apex', label: 'Tilt', color: '#84cc16' },","+      { from: 'left_supercilium_apex', to: 'left_supercilium_lateralis', color: '#84cc16' },","+    ],","+  },","+  eyebrowLowSetedness: {","+    points: ['left_supercilium_medialis', 'left_palpebra_superior', 'left_canthus_medialis'],","+    lines: [","+      { from: 'left_supercilium_medialis', to: 'left_palpebra_superior', label: 'Brow-Eye Gap', color: '#84cc16' },","+    ],","+  },","+","+  // ==========================================","+  // NOSE MEASUREMENTS (FRONT)","+  // ==========================================","+  nasalIndex: {","+    points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],","+    lines: [","+      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Width', color: '#fbbf24' },","+      { from: 'nasal_base', to: 'subnasale', label: 'Height', color: '#a78bfa' },","+    ],","+  },","+  intercanthalNasalRatio: {","+    points: ['left_ala_nasi', 'right_ala_nasi', 'left_canthus_medialis', 'right_canthus_medialis'],","+    lines: [","+      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose Width', color: '#fbbf24' },","+      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },","+    ],","+  },","+  noseBridgeWidth: {","+    points: ['left_dorsum_nasi', 'right_dorsum_nasi', 'left_ala_nasi', 'right_ala_nasi'],","+    lines: [","+      { from: 'left_dorsum_nasi', to: 'right_dorsum_nasi', label: 'Bridge', color: '#fbbf24' },","+      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Base', color: '#f97316' },","+    ],","+  },","+  noseTipPosition: {","+    points: ['subnasale', 'left_ala_nasi', 'right_ala_nasi'],","+    lines: [","+      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Tip Position', color: '#fbbf24' },","+    ],","+  },","+","+  // ==========================================","+  // MOUTH/LIP MEASUREMENTS","+  // ==========================================","+  mouthNoseWidthRatio: {","+    points: ['left_cheilion', 'right_cheilion', 'left_ala_nasi', 'right_ala_nasi'],","+    lines: [","+      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },","+      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose', color: '#fbbf24' },","+    ],","+  },","+  lowerUpperLipRatio: {","+    points: ['labrale_superius', 'mouth_middle', 'labrale_inferius'],","+    lines: [","+      { from: 'labrale_superius', to: 'mouth_middle', label: 'Upper', color: '#ec4899' },","+      { from: 'mouth_middle', to: 'labrale_inferius', label: 'Lower', color: '#f97316' },","+    ],","+  },","+  chinPhiltrumRatio: {","+    points: ['subnasale', 'labrale_superius', 'labrale_inferius', 'menton'],","+    lines: [","+      { from: 'subnasale', to: 'labrale_superius', label: 'Philtrum', color: '#ec4899' },","+      { from: 'labrale_inferius', to: 'menton', label: 'Chin', color: '#ef4444' },","+    ],","+  },","+  mouthWidth: {","+    points: ['left_cheilion', 'right_cheilion'],","+    lines: [{ from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth Width', color: '#ec4899' }],","+  },","+","+  // ==========================================","+  // CHIN MEASUREMENTS","+  // ==========================================","+  chinHeight: {","+    points: ['labrale_inferius', 'menton'],","+    lines: [{ from: 'labrale_inferius', to: 'menton', label: 'Chin Height', color: '#ef4444' }],","+  },","+","+  // ==========================================","+  // NECK MEASUREMENTS","+  // ==========================================","+  neckWidthRatio: {","+    points: ['left_cervical_lateralis', 'right_cervical_lateralis', 'left_gonion_inferior', 'right_gonion_inferior'],","+    lines: [","+      { from: 'left_cervical_lateralis', to: 'right_cervical_lateralis', label: 'Neck', color: '#14b8a6' },","+      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },","+    ],","+  },","+","+  // ==========================================","+  // SIDE PROFILE MEASUREMENTS","+  // ==========================================","+  gonialAngle: {","+    points: ['tragus', 'gonionBottom', 'menton'],","+    lines: [","+      { from: 'tragus', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },","+      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },","+    ],","+  },","+  nasofrontalAngle: {","+    points: ['glabella', 'nasion', 'pronasale'],","+    lines: [","+      { from: 'glabella', to: 'nasion', label: 'Forehead', color: '#84cc16' },","+      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },","+    ],","+  },","+  nasofacialAngle: {","+    points: ['nasion', 'pronasale', 'pogonion'],","+    lines: [","+      { from: 'nasion', to: 'pronasale', color: '#fbbf24' },","+      { from: 'pronasale', to: 'pogonion', color: '#67e8f9' },","+    ],","+  },","+  nasomentaAngle: {","+    points: ['nasion', 'pronasale', 'pogonion'],","+    lines: [","+      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },","+      { from: 'pronasale', to: 'pogonion', label: 'To Chin', color: '#ef4444' },","+    ],","+  },","+  submentalCervicalAngle: {","+    points: ['menton', 'cervicalPoint', 'neckPoint'],","+    lines: [","+      { from: 'menton', to: 'cervicalPoint', label: 'Submental', color: '#14b8a6' },","+      { from: 'cervicalPoint', to: 'neckPoint', label: 'Cervical', color: '#06b6d4' },","+    ],","+  },","+  facialDepthToHeight: {","+    points: ['pronasale', 'tragus', 'nasion', 'menton'],","+    lines: [","+      { from: 'pronasale', to: 'tragus', label: 'Depth', color: '#67e8f9' },","+      { from: 'nasion', to: 'menton', label: 'Height', color: '#a78bfa' },","+    ],","+  },","+  anteriorFacialDepth: {","+    points: ['glabella', 'pronasale', 'pogonion'],","+    lines: [","+      { from: 'glabella', to: 'pronasale', color: '#67e8f9' },","+      { from: 'pronasale', to: 'pogonion', color: '#a78bfa' },","+    ],","+  },","+  mandibularPlaneAngle: {","+    points: ['gonionBottom', 'menton', 'orbitale', 'porion'],","+    lines: [","+      { from: 'gonionBottom', to: 'menton', label: 'Mandibular', color: '#f97316' },","+      { from: 'orbitale', to: 'porion', label: 'Frankfort', color: '#67e8f9' },","+    ],","+  },","+  ramusToMandibleRatio: {","+    points: ['gonionTop', 'gonionBottom', 'menton'],","+    lines: [","+      { from: 'gonionTop', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },","+      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },","+    ],","+  },","+  orbitalVector: {","+    points: ['cornealApex', 'orbitale', 'cheekbone'],","+    lines: [","+      { from: 'cornealApex', to: 'cheekbone', label: 'Orbital Vector', color: '#06b6d4' },","+    ],","+  },","+  eLineLowerLip: {","+    points: ['pronasale', 'pogonion', 'labraleInferius'],","+    lines: [","+      { from: 'pronasale', to: 'pogonion', label: 'E-Line', color: '#67e8f9' },","+    ],","+  },","+  sLineLowerLip: {","+    points: ['pronasale', 'pogonion', 'labraleInferius'],","+    lines: [","+      { from: 'pronasale', to: 'pogonion', label: 'S-Line', color: '#a78bfa' },","+    ],","+  },","+  holdawayHLine: {","+    points: ['pronasale', 'pogonion', 'labraleSuperius', 'labraleInferius'],","+    lines: [","+      { from: 'pronasale', to: 'pogonion', label: 'H-Line', color: '#ec4899' },","+    ],","+  },","+  burstoneLowerLip: {","+    points: ['subnasale', 'pogonion', 'labraleInferius'],","+    lines: [","+      { from: 'subnasale', to: 'pogonion', label: 'Burstone', color: '#fbbf24' },","+    ],","+  },","+};","+"," function generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {","-  // Default illustration - will be enhanced with metric-specific data","   const landmarkMap: Record<string, LandmarkPoint> = {};","   landmarks.forEach(l => { landmarkMap[l.id] = l; });"," ","-  // Metric-specific illustration configurations","-  const illustrationConfigs: Record<string, { points: string[]; lines: Array<{ from: string; to: string }> }> = {","-    faceWidthToHeight: {","-      points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],","-      lines: [","-        { from: 'left_zygion', to: 'right_zygion' },","-        { from: 'trichion', to: 'menton' },","-      ],","-    },","-    lateralCanthalTilt: {","-      points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],","-      lines: [","-        { from: 'left_canthus_medialis', to: 'left_canthus_lateralis' },","-        { from: 'right_canthus_medialis', to: 'right_canthus_lateralis' },","-      ],","-    },","-    nasalIndex: {","-      points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],","-      lines: [","-        { from: 'left_ala_nasi', to: 'right_ala_nasi' },","-        { from: 'nasal_base', to: 'subnasale' },","-      ],","-    },","-    mouthWidth: {","-      points: ['left_cheilion', 'right_cheilion'],","-      lines: [{ from: 'left_cheilion', to: 'right_cheilion' }],","-    },","-    jawWidth: {","-      points: ['left_gonion_inferior', 'right_gonion_inferior'],","-      lines: [{ from: 'left_gonion_inferior', to: 'right_gonion_inferior' }],","-    },","-    chinHeight: {","-      points: ['labrale_inferius', 'menton'],","-      lines: [{ from: 'labrale_inferius', to: 'menton' }],","-    },","-  };","-","-  const config = illustrationConfigs[metricId];","+  const config = ILLUSTRATION_CONFIGS[metricId];","   const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};","-  const lines: Record<string, { from: string; to: string; color: string }> = {};","+  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};"," ","   if (config) {","     config.points.forEach((pointId, i) => {"]},{"oldStart":174,"oldLines":7,"newStart":489,"newLines":13,"lines":["       }","     });","     config.lines.forEach((line, i) => {","-      lines[`line_${i}`] = { from: line.from, to: line.to, color: '#67e8f9' };","+      lines[`line_${i}`] = {","+        from: line.from,","+        to: line.to,","+        color: line.color || '#67e8f9',","+        label: line.label,","+        labelPosition: line.labelPosition,","+      };","     });","   }"," "]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"ab3fb9ce-6d0a-4b26-9a32-f95a9712cde6","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01DGG1W2Wxwf8yjNRGnyhh2M","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The first task is done. Now let me update the todo list and move on to the second task - improving flaw-to-treatment matching. I need to enhance the `generateRecommendations()` function.","signature":"EuMCCkYIChgCKkBqrD9vslwfIxjcYkMRHUGxFLYjcvD06Fb4sm+H1ff8D0SLSlqnQB69E3lF9ZQsop14Hp2Q+Uw0+3MFKnSy3j/DEgyOrxbc39u/NgQEsrgaDDQLM0Ik+9DPKj6WJyIwagCSXfSXbXHuAR9jyULf2NuJIc83JtpXIKDwRkv72PdGlTGlTwjfLIZb21VsP/nyKsoBAe9m+U97GILHA9cV54dhPjXIubUDyBxG1kNVWULefODkosVwPHyIULUE9sDY2/YcgSbkbmmCrT5maQ8YRU9xMago7wqg95Ga6Jj/icz8V+yO/1deBrxV41aAgffwgvBQYnZxeUDIvsP0u6oLW40IcZdde+vdLHceAB9o6GGRqPd93/MNSjT/0ZVjaayMX7XDhDXIUuEKPJu97nreVDoV1z8y9WLgnjqA262/SYRZD+w4kzFp1n9Mb+9shgNJzOipA33uyaNn5mPpVRgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":14877,"cache_read_input_tokens":86720,"cache_creation":{"ephemeral_5m_input_tokens":14877,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbvsr4T9q9RCQYyS3A8","type":"assistant","uuid":"4b1c6fe6-9112-4af0-952f-5fcb7c15802d","timestamp":"2025-12-20T20:53:29.042Z"}
{"parentUuid":"4b1c6fe6-9112-4af0-952f-5fcb7c15802d","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01DGG1W2Wxwf8yjNRGnyhh2M","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GFxzqPwztdFCaXDSA3BPXW","name":"TodoWrite","input":{"todos":[{"content":"Enhanced Illustration Configs - Expand generateIllustration() function","status":"completed","activeForm":"Expanding generateIllustration() function"},{"content":"Improved Flaw-to-Treatment Matching - Use metric scores and match flaws to procedures","status":"in_progress","activeForm":"Improving flaw-to-treatment matching"},{"content":"Severity Display Enhancement - Add severity badges with colors","status":"pending","activeForm":"Enhancing severity display with badges"}]}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":14877,"cache_read_input_tokens":86720,"cache_creation":{"ephemeral_5m_input_tokens":14877,"ephemeral_1h_input_tokens":0},"output_tokens":232,"service_tier":"standard"}},"requestId":"req_011CWJbvsr4T9q9RCQYyS3A8","type":"assistant","uuid":"d262cead-343b-4daa-a84a-c16c663c26cf","timestamp":"2025-12-20T20:53:31.511Z"}
{"parentUuid":"d262cead-343b-4daa-a84a-c16c663c26cf","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GFxzqPwztdFCaXDSA3BPXW","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"806c5580-6e0b-45c7-a253-f94d4a376547","timestamp":"2025-12-20T20:53:31.538Z","toolUseResult":{"oldTodos":[{"content":"Enhanced Illustration Configs - Expand generateIllustration() function","status":"in_progress","activeForm":"Expanding generateIllustration() function"},{"content":"Improved Flaw-to-Treatment Matching - Use metric scores and match flaws to procedures","status":"pending","activeForm":"Improving flaw-to-treatment matching"},{"content":"Severity Display Enhancement - Add severity badges with colors","status":"pending","activeForm":"Enhancing severity display with badges"}],"newTodos":[{"content":"Enhanced Illustration Configs - Expand generateIllustration() function","status":"completed","activeForm":"Expanding generateIllustration() function"},{"content":"Improved Flaw-to-Treatment Matching - Use metric scores and match flaws to procedures","status":"in_progress","activeForm":"Improving flaw-to-treatment matching"},{"content":"Severity Display Enhancement - Add severity badges with colors","status":"pending","activeForm":"Enhancing severity display with badges"}]}}
{"parentUuid":"806c5580-6e0b-45c7-a253-f94d4a376547","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01CmrUgaMGdXSZpetjWtdqdN","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me read the recommendations databases to understand what treatments are available, then enhance the generateRecommendations function.","signature":"ErYCCkYIChgCKkAJhtUxm22F2F0bsgAaQu8BsYdHp9+dPRM7Im5J8jvpGgiRZg2U647akDgT34sm4T4NwNhY/VYhnZREml9SMom3EgwRMU//vcAhbHI6NsIaDM0GGbFcWj296FPInSIwBpp/f/GqGnsLlDAzDsD2MRQFpwmhZoYh6x70QPWYOG7HMIHgl0IQpNl8ULFcR08GKp0B/UjXlsfbXsTWJNNaK6wTm5/amFUuuqujxjeRjHK+lezyaICzvGEgzN3MVJKQf6IkAFQA7JPZ6RUH4BNsbc77SQijHebwUqPWtHs116YdxEnznDzmStClj6Y8K5LXqbJ/lvRr58UFg3W2QDWgaLxk/VqkMaYe81i2oHv08I7gWDkQNNKdwiVaFvHRz+xHMIBdV6S/vOZRFTemwsdcohgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":281,"cache_read_input_tokens":101597,"cache_creation":{"ephemeral_5m_input_tokens":281,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJbwLEobXnYE7xwwm74f","type":"assistant","uuid":"0192fb66-6b3e-4d84-95b0-efe42debe070","timestamp":"2025-12-20T20:53:33.615Z"}
{"parentUuid":"0192fb66-6b3e-4d84-95b0-efe42debe070","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01CmrUgaMGdXSZpetjWtdqdN","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me enhance the flaw-to-treatment matching. First, let me check what treatments are available."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":281,"cache_read_input_tokens":101597,"cache_creation":{"ephemeral_5m_input_tokens":281,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJbwLEobXnYE7xwwm74f","type":"assistant","uuid":"66bd0eb5-9093-4c5b-bbd4-20a01b2eeafa","timestamp":"2025-12-20T20:53:34.284Z"}
{"parentUuid":"66bd0eb5-9093-4c5b-bbd4-20a01b2eeafa","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01CmrUgaMGdXSZpetjWtdqdN","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Xx88QyUgp7acxzDrrSWtc9","name":"Glob","input":{"pattern":"**/hardmaxxing*.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":281,"cache_read_input_tokens":101597,"cache_creation":{"ephemeral_5m_input_tokens":281,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJbwLEobXnYE7xwwm74f","type":"assistant","uuid":"d4148495-4a46-4e0e-9bbb-aa1715558eed","timestamp":"2025-12-20T20:53:34.922Z"}
{"parentUuid":"d4148495-4a46-4e0e-9bbb-aa1715558eed","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01CmrUgaMGdXSZpetjWtdqdN","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CWSUUg2pb5zWXv8wgr3UQH","name":"Glob","input":{"pattern":"**/softmaxxing*.ts"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":281,"cache_read_input_tokens":101597,"cache_creation":{"ephemeral_5m_input_tokens":281,"ephemeral_1h_input_tokens":0},"output_tokens":157,"service_tier":"standard"}},"requestId":"req_011CWJbwLEobXnYE7xwwm74f","type":"assistant","uuid":"b8e378cc-f77f-4720-bbab-31cb00e90274","timestamp":"2025-12-20T20:53:35.415Z"}
{"parentUuid":"b8e378cc-f77f-4720-bbab-31cb00e90274","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Xx88QyUgp7acxzDrrSWtc9","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/hardmaxxing.ts"}]},"uuid":"c88d49c3-2f2f-4037-9dc9-763b7ed4962d","timestamp":"2025-12-20T20:53:35.934Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/hardmaxxing.ts"],"durationMs":485,"numFiles":1,"truncated":false}}
{"parentUuid":"c88d49c3-2f2f-4037-9dc9-763b7ed4962d","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CWSUUg2pb5zWXv8wgr3UQH","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/softmaxxing.ts"}]},"uuid":"51b8b80b-082c-4307-aa41-a998d76e8e0a","timestamp":"2025-12-20T20:53:36.044Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/softmaxxing.ts"],"durationMs":595,"numFiles":1,"truncated":false}}
{"parentUuid":"51b8b80b-082c-4307-aa41-a998d76e8e0a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_016FFVNt7fdK5J5yRUEBkTVq","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Let me read the treatment databases to understand their structure.","signature":"EuoBCkYIChgCKkAT2K3xHxVY9cRnJE6U5sPeIs8Km6duoeVGh6lbUpwEH3ncwV5qf0cC1ZDxpHoCi8pUoW3IFBNJr5+2E/aIr/OPEgwnM4EXpgUxPYAMKc0aDHnsKYUUdqIeNYnblyIw6xgpH7/pJ3ZSew/DSr0D4llUJyI+EgpIbFn14Xls2hbqImYsywT8gTbBvXiFM13DKlLUggYp8wG/N7VZW8s+fGbXWIV4HDDPNyA0J8VCRuu7TNCJLIjsveI2DGrqm7g/GDsx6OFb9qh8uRouxTugCvJzBdr9ZryZ2SpWO3h5YngTmZzeGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":287,"cache_read_input_tokens":101878,"cache_creation":{"ephemeral_5m_input_tokens":287,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbwfWBewGpPCE1iJ1La","type":"assistant","uuid":"4304b29a-a9b9-4871-a928-d38a7f20f177","timestamp":"2025-12-20T20:53:39.305Z"}
{"parentUuid":"4304b29a-a9b9-4871-a928-d38a7f20f177","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_016FFVNt7fdK5J5yRUEBkTVq","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011XMCzzBFLz3WPfRe5Tt9JB","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/hardmaxxing.ts","offset":1,"limit":200}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":287,"cache_read_input_tokens":101878,"cache_creation":{"ephemeral_5m_input_tokens":287,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbwfWBewGpPCE1iJ1La","type":"assistant","uuid":"7cbabf29-c4ed-404b-8204-d06a3b4076e2","timestamp":"2025-12-20T20:53:40.416Z"}
{"parentUuid":"7cbabf29-c4ed-404b-8204-d06a3b4076e2","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011XMCzzBFLz3WPfRe5Tt9JB","type":"tool_result","content":"     1→/**\n     2→ * Hardmaxxing Surgery Database\n     3→ * Comprehensive database of facial aesthetic surgeries\n     4→ */\n     5→\n     6→import { Surgery, RegionalCost } from './types';\n     7→\n     8→export const SURGICAL_TREATMENTS: Surgery[] = [\n     9→  // ============================================\n    10→  // RHINOPLASTY (NOSE SURGERIES)\n    11→  // ============================================\n    12→  {\n    13→    id: 'rhinoplasty_reduction',\n    14→    name: 'Reduction Rhinoplasty',\n    15→    category: 'surgical',\n    16→    description: 'Surgical reduction of nose size, hump removal, and tip refinement',\n    17→    howItWorks: 'Surgeon removes bone and cartilage to reduce overall nose size, refine the tip, and straighten the bridge',\n    18→    effectiveness: 9,\n    19→    evidenceLevel: 'strong',\n    20→    pslImprovement: { min: 0.5, max: 1.0 },\n    21→    costLevel: 'very_high',\n    22→    costRange: { min: 5000, max: 15000, currency: 'USD' },\n    23→    costFrequency: 'one-time',\n    24→    timelineToResults: 'Initial results at 2-4 weeks, final results at 12-18 months',\n    25→    resultsDuration: 'Permanent',\n    26→    maintenanceRequired: false,\n    27→    recoveryTime: '1-2 weeks for major swelling, full recovery 12-18 months',\n    28→    downtime: '1-2 weeks off work',\n    29→    painLevel: 'moderate',\n    30→    riskLevel: 'medium',\n    31→    sideEffects: ['Swelling', 'Bruising', 'Numbness', 'Breathing changes', 'Asymmetry'],\n    32→    contraindications: ['Unrealistic expectations', 'Active skin infections', 'Bleeding disorders'],\n    33→    targetMetrics: ['nasal_index', 'nasolabial_angle', 'nasofrontal_angle', 'overall_harmony'],\n    34→    targetIssues: ['large_nose', 'dorsal_hump', 'bulbous_tip', 'wide_nose', 'crooked_nose'],\n    35→    permanence: 'permanent',\n    36→    anesthesiaType: 'general',\n    37→    revisionRate: 0.15,\n    38→    regionalCosts: [\n    39→      { region: 'USA', min: 7000, max: 15000, currency: 'USD' },\n    40→      { region: 'Turkey', min: 2500, max: 5000, currency: 'USD', notes: 'Popular medical tourism destination' },\n    41→      { region: 'South Korea', min: 4000, max: 10000, currency: 'USD', notes: 'K-beauty rhinoplasty style' },\n    42→      { region: 'Mexico', min: 3000, max: 6000, currency: 'USD' },\n    43→      { region: 'UK', min: 5000, max: 12000, currency: 'GBP' },\n    44→    ],\n    45→    surgeonRecommendations: [\n    46→      { name: 'Dr. Sam Rizk', location: 'New York, USA', specialty: 'Preservation rhinoplasty', costRange: '$15,000-25,000' },\n    47→      { name: 'Dr. Paul Nassif', location: 'Beverly Hills, USA', specialty: 'Revision rhinoplasty', costRange: '$12,000-30,000' },\n    48→      { name: 'Dr. Amir Keshavarz', location: 'Istanbul, Turkey', specialty: 'Ethnic rhinoplasty', costRange: '$3,000-6,000' },\n    49→    ],\n    50→    notes: [\n    51→      '85% satisfaction rate on RealSelf',\n    52→      'Most requested cosmetic surgery worldwide',\n    53→      'Preservation rhinoplasty has faster recovery but limited to certain nose types',\n    54→      'Ethnic rhinoplasty maintains cultural features while enhancing proportions',\n    55→    ],\n    56→    sources: ['ASPS', 'RealSelf', 'JAMA Facial Plastic Surgery'],\n    57→  },\n    58→  {\n    59→    id: 'rhinoplasty_tip',\n    60→    name: 'Tip Rhinoplasty (Tipplasty)',\n    61→    category: 'surgical',\n    62→    description: 'Focused nasal tip refinement without bridge modification',\n    63→    howItWorks: 'Reshapes tip cartilages through closed or open approach, refining tip projection and rotation',\n    64→    effectiveness: 8,\n    65→    evidenceLevel: 'strong',\n    66→    pslImprovement: { min: 0.3, max: 0.7 },\n    67→    costLevel: 'high',\n    68→    costRange: { min: 3500, max: 8000, currency: 'USD' },\n    69→    costFrequency: 'one-time',\n    70→    timelineToResults: '2-4 weeks initial, 6-12 months final',\n    71→    resultsDuration: 'Permanent',\n    72→    maintenanceRequired: false,\n    73→    recoveryTime: '1 week for major swelling',\n    74→    downtime: '5-7 days off work',\n    75→    painLevel: 'low',\n    76→    riskLevel: 'low',\n    77→    sideEffects: ['Tip swelling', 'Minor bruising', 'Temporary numbness'],\n    78→    contraindications: ['Bridge concerns', 'Severe tip deformities'],\n    79→    targetMetrics: ['nasolabial_angle', 'tip_projection', 'overall_harmony'],\n    80→    targetIssues: ['bulbous_tip', 'droopy_tip', 'upturned_tip', 'tip_asymmetry'],\n    81→    permanence: 'permanent',\n    82→    anesthesiaType: 'local',\n    83→    revisionRate: 0.10,\n    84→    regionalCosts: [\n    85→      { region: 'USA', min: 4000, max: 8000, currency: 'USD' },\n    86→      { region: 'Turkey', min: 1500, max: 3000, currency: 'USD' },\n    87→      { region: 'South Korea', min: 2500, max: 5000, currency: 'USD' },\n    88→    ],\n    89→    notes: [\n    90→      'Less invasive than full rhinoplasty',\n    91→      'Shorter recovery time',\n    92→      'Can be done under local anesthesia',\n    93→      'Ideal for patients with good bridge but tip concerns',\n    94→    ],\n    95→    sources: ['ASPS', 'RealSelf'],\n    96→  },\n    97→  {\n    98→    id: 'septorhinoplasty',\n    99→    name: 'Septorhinoplasty',\n   100→    category: 'surgical',\n   101→    description: 'Combination of septum repair and cosmetic rhinoplasty',\n   102→    howItWorks: 'Corrects deviated septum while reshaping external nose appearance',\n   103→    effectiveness: 9,\n   104→    evidenceLevel: 'strong',\n   105→    pslImprovement: { min: 0.4, max: 0.9 },\n   106→    costLevel: 'very_high',\n   107→    costRange: { min: 6000, max: 18000, currency: 'USD' },\n   108→    costFrequency: 'one-time',\n   109→    timelineToResults: '2-4 weeks initial, 12-18 months final',\n   110→    resultsDuration: 'Permanent',\n   111→    maintenanceRequired: false,\n   112→    recoveryTime: '2 weeks for major swelling, full recovery 12-18 months',\n   113→    downtime: '1-2 weeks off work',\n   114→    painLevel: 'moderate',\n   115→    riskLevel: 'medium',\n   116→    sideEffects: ['Swelling', 'Bruising', 'Numbness', 'Septal perforation (rare)'],\n   117→    contraindications: ['Bleeding disorders', 'Active infections'],\n   118→    targetMetrics: ['nasal_index', 'nasolabial_angle', 'overall_harmony'],\n   119→    targetIssues: ['deviated_septum', 'breathing_issues', 'crooked_nose', 'asymmetry'],\n   120→    permanence: 'permanent',\n   121→    anesthesiaType: 'general',\n   122→    revisionRate: 0.12,\n   123→    regionalCosts: [\n   124→      { region: 'USA', min: 7000, max: 18000, currency: 'USD' },\n   125→      { region: 'Turkey', min: 3000, max: 6000, currency: 'USD' },\n   126→    ],\n   127→    notes: [\n   128→      'May be partially covered by insurance if septum is functionally deviated',\n   129→      'Combines functional and aesthetic improvement',\n   130→      'Two-for-one recovery period',\n   131→    ],\n   132→    sources: ['ASPS', 'AAO-HNS'],\n   133→  },\n   134→\n   135→  // ============================================\n   136→  // JAW & CHIN SURGERIES\n   137→  // ============================================\n   138→  {\n   139→    id: 'genioplasty',\n   140→    name: 'Sliding Genioplasty',\n   141→    category: 'surgical',\n   142→    description: 'Chin advancement or setback by cutting and repositioning the chin bone',\n   143→    howItWorks: 'Horizontal osteotomy of the mandible allows the chin segment to be moved forward, backward, up, or down',\n   144→    effectiveness: 9,\n   145→    evidenceLevel: 'strong',\n   146→    pslImprovement: { min: 0.5, max: 1.2 },\n   147→    costLevel: 'very_high',\n   148→    costRange: { min: 5000, max: 15000, currency: 'USD' },\n   149→    costFrequency: 'one-time',\n   150→    timelineToResults: '3-6 months for swelling resolution, 12 months final',\n   151→    resultsDuration: 'Permanent',\n   152→    maintenanceRequired: false,\n   153→    recoveryTime: '4-6 weeks',\n   154→    downtime: '1-2 weeks off work',\n   155→    painLevel: 'moderate',\n   156→    riskLevel: 'medium',\n   157→    sideEffects: ['Swelling', 'Numbness (temporary to permanent)', 'Asymmetry', 'Bone resorption'],\n   158→    contraindications: ['Active infections', 'Poor bone health', 'Unrealistic expectations'],\n   159→    targetMetrics: ['chin_projection', 'pogonion', 'facial_convexity', 'profile_harmony'],\n   160→    targetIssues: ['recessed_chin', 'weak_chin', 'chin_excess', 'facial_imbalance'],\n   161→    permanence: 'permanent',\n   162→    anesthesiaType: 'general',\n   163→    revisionRate: 0.08,\n   164→    regionalCosts: [\n   165→      { region: 'USA', min: 6000, max: 15000, currency: 'USD' },\n   166→      { region: 'South Korea', min: 4000, max: 8000, currency: 'USD' },\n   167→      { region: 'Turkey', min: 3000, max: 6000, currency: 'USD' },\n   168→    ],\n   169→    surgeonRecommendations: [\n   170→      { name: 'Dr. Barry Eppley', location: 'Indianapolis, USA', specialty: 'Custom facial implants & genioplasty', costRange: '$8,000-15,000' },\n   171→      { name: 'Dr. Yaremchuk', location: 'Boston, USA', specialty: 'Facial skeletal surgery', costRange: '$10,000-20,000' },\n   172→    ],\n   173→    notes: [\n   174→      'More versatile than chin implants (can move in all directions)',\n   175→      'Uses your own bone - no implant rejection risk',\n   176→      '5-10% permanent numbness of lower lip',\n   177→      'Can be combined with jaw surgery for comprehensive lower third correction',\n   178→    ],\n   179→    sources: ['ASPS', 'AAOMS', 'PubMed'],\n   180→  },\n   181→  {\n   182→    id: 'chin_implant',\n   183→    name: 'Chin Implant (Mentoplasty)',\n   184→    category: 'surgical',\n   185→    description: 'Silicone or PEEK implant to augment chin projection',\n   186→    howItWorks: 'Implant placed through intraoral or submental incision, sits on the bone to increase projection',\n   187→    effectiveness: 8,\n   188→    evidenceLevel: 'strong',\n   189→    pslImprovement: { min: 0.4, max: 0.9 },\n   190→    costLevel: 'high',\n   191→    costRange: { min: 3000, max: 8000, currency: 'USD' },\n   192→    costFrequency: 'one-time',\n   193→    timelineToResults: '2-4 weeks for swelling, 3 months final',\n   194→    resultsDuration: 'Permanent (may need replacement in 15-20 years)',\n   195→    maintenanceRequired: false,\n   196→    recoveryTime: '1-2 weeks',\n   197→    downtime: '3-7 days off work',\n   198→    painLevel: 'low',\n   199→    riskLevel: 'low',\n   200→    sideEffects: ['Swelling', 'Numbness', 'Implant shifting', 'Bone erosion', 'Infection'],\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"d3ac3d71-b7bd-436b-8af8-f0068d621a5b","timestamp":"2025-12-20T20:53:40.528Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/hardmaxxing.ts","content":"/**\n * Hardmaxxing Surgery Database\n * Comprehensive database of facial aesthetic surgeries\n */\n\nimport { Surgery, RegionalCost } from './types';\n\nexport const SURGICAL_TREATMENTS: Surgery[] = [\n  // ============================================\n  // RHINOPLASTY (NOSE SURGERIES)\n  // ============================================\n  {\n    id: 'rhinoplasty_reduction',\n    name: 'Reduction Rhinoplasty',\n    category: 'surgical',\n    description: 'Surgical reduction of nose size, hump removal, and tip refinement',\n    howItWorks: 'Surgeon removes bone and cartilage to reduce overall nose size, refine the tip, and straighten the bridge',\n    effectiveness: 9,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.5, max: 1.0 },\n    costLevel: 'very_high',\n    costRange: { min: 5000, max: 15000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: 'Initial results at 2-4 weeks, final results at 12-18 months',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '1-2 weeks for major swelling, full recovery 12-18 months',\n    downtime: '1-2 weeks off work',\n    painLevel: 'moderate',\n    riskLevel: 'medium',\n    sideEffects: ['Swelling', 'Bruising', 'Numbness', 'Breathing changes', 'Asymmetry'],\n    contraindications: ['Unrealistic expectations', 'Active skin infections', 'Bleeding disorders'],\n    targetMetrics: ['nasal_index', 'nasolabial_angle', 'nasofrontal_angle', 'overall_harmony'],\n    targetIssues: ['large_nose', 'dorsal_hump', 'bulbous_tip', 'wide_nose', 'crooked_nose'],\n    permanence: 'permanent',\n    anesthesiaType: 'general',\n    revisionRate: 0.15,\n    regionalCosts: [\n      { region: 'USA', min: 7000, max: 15000, currency: 'USD' },\n      { region: 'Turkey', min: 2500, max: 5000, currency: 'USD', notes: 'Popular medical tourism destination' },\n      { region: 'South Korea', min: 4000, max: 10000, currency: 'USD', notes: 'K-beauty rhinoplasty style' },\n      { region: 'Mexico', min: 3000, max: 6000, currency: 'USD' },\n      { region: 'UK', min: 5000, max: 12000, currency: 'GBP' },\n    ],\n    surgeonRecommendations: [\n      { name: 'Dr. Sam Rizk', location: 'New York, USA', specialty: 'Preservation rhinoplasty', costRange: '$15,000-25,000' },\n      { name: 'Dr. Paul Nassif', location: 'Beverly Hills, USA', specialty: 'Revision rhinoplasty', costRange: '$12,000-30,000' },\n      { name: 'Dr. Amir Keshavarz', location: 'Istanbul, Turkey', specialty: 'Ethnic rhinoplasty', costRange: '$3,000-6,000' },\n    ],\n    notes: [\n      '85% satisfaction rate on RealSelf',\n      'Most requested cosmetic surgery worldwide',\n      'Preservation rhinoplasty has faster recovery but limited to certain nose types',\n      'Ethnic rhinoplasty maintains cultural features while enhancing proportions',\n    ],\n    sources: ['ASPS', 'RealSelf', 'JAMA Facial Plastic Surgery'],\n  },\n  {\n    id: 'rhinoplasty_tip',\n    name: 'Tip Rhinoplasty (Tipplasty)',\n    category: 'surgical',\n    description: 'Focused nasal tip refinement without bridge modification',\n    howItWorks: 'Reshapes tip cartilages through closed or open approach, refining tip projection and rotation',\n    effectiveness: 8,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.3, max: 0.7 },\n    costLevel: 'high',\n    costRange: { min: 3500, max: 8000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '2-4 weeks initial, 6-12 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '1 week for major swelling',\n    downtime: '5-7 days off work',\n    painLevel: 'low',\n    riskLevel: 'low',\n    sideEffects: ['Tip swelling', 'Minor bruising', 'Temporary numbness'],\n    contraindications: ['Bridge concerns', 'Severe tip deformities'],\n    targetMetrics: ['nasolabial_angle', 'tip_projection', 'overall_harmony'],\n    targetIssues: ['bulbous_tip', 'droopy_tip', 'upturned_tip', 'tip_asymmetry'],\n    permanence: 'permanent',\n    anesthesiaType: 'local',\n    revisionRate: 0.10,\n    regionalCosts: [\n      { region: 'USA', min: 4000, max: 8000, currency: 'USD' },\n      { region: 'Turkey', min: 1500, max: 3000, currency: 'USD' },\n      { region: 'South Korea', min: 2500, max: 5000, currency: 'USD' },\n    ],\n    notes: [\n      'Less invasive than full rhinoplasty',\n      'Shorter recovery time',\n      'Can be done under local anesthesia',\n      'Ideal for patients with good bridge but tip concerns',\n    ],\n    sources: ['ASPS', 'RealSelf'],\n  },\n  {\n    id: 'septorhinoplasty',\n    name: 'Septorhinoplasty',\n    category: 'surgical',\n    description: 'Combination of septum repair and cosmetic rhinoplasty',\n    howItWorks: 'Corrects deviated septum while reshaping external nose appearance',\n    effectiveness: 9,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.4, max: 0.9 },\n    costLevel: 'very_high',\n    costRange: { min: 6000, max: 18000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '2-4 weeks initial, 12-18 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '2 weeks for major swelling, full recovery 12-18 months',\n    downtime: '1-2 weeks off work',\n    painLevel: 'moderate',\n    riskLevel: 'medium',\n    sideEffects: ['Swelling', 'Bruising', 'Numbness', 'Septal perforation (rare)'],\n    contraindications: ['Bleeding disorders', 'Active infections'],\n    targetMetrics: ['nasal_index', 'nasolabial_angle', 'overall_harmony'],\n    targetIssues: ['deviated_septum', 'breathing_issues', 'crooked_nose', 'asymmetry'],\n    permanence: 'permanent',\n    anesthesiaType: 'general',\n    revisionRate: 0.12,\n    regionalCosts: [\n      { region: 'USA', min: 7000, max: 18000, currency: 'USD' },\n      { region: 'Turkey', min: 3000, max: 6000, currency: 'USD' },\n    ],\n    notes: [\n      'May be partially covered by insurance if septum is functionally deviated',\n      'Combines functional and aesthetic improvement',\n      'Two-for-one recovery period',\n    ],\n    sources: ['ASPS', 'AAO-HNS'],\n  },\n\n  // ============================================\n  // JAW & CHIN SURGERIES\n  // ============================================\n  {\n    id: 'genioplasty',\n    name: 'Sliding Genioplasty',\n    category: 'surgical',\n    description: 'Chin advancement or setback by cutting and repositioning the chin bone',\n    howItWorks: 'Horizontal osteotomy of the mandible allows the chin segment to be moved forward, backward, up, or down',\n    effectiveness: 9,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.5, max: 1.2 },\n    costLevel: 'very_high',\n    costRange: { min: 5000, max: 15000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '3-6 months for swelling resolution, 12 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '4-6 weeks',\n    downtime: '1-2 weeks off work',\n    painLevel: 'moderate',\n    riskLevel: 'medium',\n    sideEffects: ['Swelling', 'Numbness (temporary to permanent)', 'Asymmetry', 'Bone resorption'],\n    contraindications: ['Active infections', 'Poor bone health', 'Unrealistic expectations'],\n    targetMetrics: ['chin_projection', 'pogonion', 'facial_convexity', 'profile_harmony'],\n    targetIssues: ['recessed_chin', 'weak_chin', 'chin_excess', 'facial_imbalance'],\n    permanence: 'permanent',\n    anesthesiaType: 'general',\n    revisionRate: 0.08,\n    regionalCosts: [\n      { region: 'USA', min: 6000, max: 15000, currency: 'USD' },\n      { region: 'South Korea', min: 4000, max: 8000, currency: 'USD' },\n      { region: 'Turkey', min: 3000, max: 6000, currency: 'USD' },\n    ],\n    surgeonRecommendations: [\n      { name: 'Dr. Barry Eppley', location: 'Indianapolis, USA', specialty: 'Custom facial implants & genioplasty', costRange: '$8,000-15,000' },\n      { name: 'Dr. Yaremchuk', location: 'Boston, USA', specialty: 'Facial skeletal surgery', costRange: '$10,000-20,000' },\n    ],\n    notes: [\n      'More versatile than chin implants (can move in all directions)',\n      'Uses your own bone - no implant rejection risk',\n      '5-10% permanent numbness of lower lip',\n      'Can be combined with jaw surgery for comprehensive lower third correction',\n    ],\n    sources: ['ASPS', 'AAOMS', 'PubMed'],\n  },\n  {\n    id: 'chin_implant',\n    name: 'Chin Implant (Mentoplasty)',\n    category: 'surgical',\n    description: 'Silicone or PEEK implant to augment chin projection',\n    howItWorks: 'Implant placed through intraoral or submental incision, sits on the bone to increase projection',\n    effectiveness: 8,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.4, max: 0.9 },\n    costLevel: 'high',\n    costRange: { min: 3000, max: 8000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '2-4 weeks for swelling, 3 months final',\n    resultsDuration: 'Permanent (may need replacement in 15-20 years)',\n    maintenanceRequired: false,\n    recoveryTime: '1-2 weeks',\n    downtime: '3-7 days off work',\n    painLevel: 'low',\n    riskLevel: 'low',\n    sideEffects: ['Swelling', 'Numbness', 'Implant shifting', 'Bone erosion', 'Infection'],","numLines":200,"startLine":1,"totalLines":1085}}}
{"parentUuid":"d3ac3d71-b7bd-436b-8af8-f0068d621a5b","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_0156yCqBJuscjMcYvsfVtKJf","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"I can see the treatments have `targetMetrics` and `targetIssues` fields. Let me now read the types file to understand the full structure, and then update the generateRecommendations function to be more sophisticated - using metric scores and mapping flaws to treatments more precisely.","signature":"EsYDCkYIChgCKkAyLbDD07bQkaELLkgezhW/VZDT41mXPtDat5LnEru9uz8viEHldP7L8Pei2UylnhPaxvTCdL1ukMgDsb7ARk7HEgx+Ih3V9vGeNZZXktUaDAyqqIynq+YOm/lWHyIw+AwNl9R0Bh60aY2o9vgapaJ2zXEhVxyY5qxGU3qVEOfUhiGylNRXNKFEs8jqiVtrKq0CQKPauPkLpmPdHJaQp0bYxm8Be9JdTeSc/t/ixECYJdaVW9PatpJJwwmqjcc31uhJccvyJyyG9rr3o07YtK6CtGjor7VR1zxiaYI6vrGrm5fW3afid3tFT/2I4cuafynhPUURqD2IcU3L9XJgIJK3rqcpuuxysbawCOQlQF+TRTPfFX/my8mqBXbqAiuu2+it4mSBm6VsTgGkMhsASpJ3VZb8wlEwHswFBc00tJxZ1mbRrk0+C6LaQkveMxLQcu3T2NVCANR4UXNb2OPFK+8zQEcoNfZlWinj76cWpJBzcYi4OOvMjeZovAipq60071JsJklvSvCkl7gyVzu+BlroI2BKszg6qNLPnemdVwhsvb9ig7gTv2H1RCDEuW8iMI3VmD6e58SddhocUeQXwRgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":4005,"cache_read_input_tokens":102165,"cache_creation":{"ephemeral_5m_input_tokens":4005,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbwzh6NZkR2e9MezKf3","type":"assistant","uuid":"45a06ff6-6e0f-43de-8346-1ecfe4278ee7","timestamp":"2025-12-20T20:53:44.159Z"}
{"parentUuid":"45a06ff6-6e0f-43de-8346-1ecfe4278ee7","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_0156yCqBJuscjMcYvsfVtKJf","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WisR3JJj5cNHyTPRtpdS81","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/types.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":4005,"cache_read_input_tokens":102165,"cache_creation":{"ephemeral_5m_input_tokens":4005,"ephemeral_1h_input_tokens":0},"output_tokens":149,"service_tier":"standard"}},"requestId":"req_011CWJbwzh6NZkR2e9MezKf3","type":"assistant","uuid":"4a561205-f0ad-4b90-af22-adbc0afaeaab","timestamp":"2025-12-20T20:53:45.364Z"}
{"parentUuid":"4a561205-f0ad-4b90-af22-adbc0afaeaab","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01WisR3JJj5cNHyTPRtpdS81","type":"tool_result","content":"     1→/**\n     2→ * Recommendation System Types\n     3→ * Comprehensive type definitions for looksmaxxing recommendations\n     4→ */\n     5→\n     6→// ============================================\n     7→// ENUMS & BASIC TYPES\n     8→// ============================================\n     9→\n    10→export type Severity = 'optimal' | 'mild' | 'moderate' | 'severe';\n    11→\n    12→export type TreatmentCategory =\n    13→  | 'lifestyle'\n    14→  | 'softmaxxing'\n    15→  | 'non_surgical'\n    16→  | 'minimally_invasive'\n    17→  | 'surgical';\n    18→\n    19→export type CostLevel = 'free' | 'low' | 'medium' | 'high' | 'very_high';\n    20→\n    21→export type EvidenceLevel = 'strong' | 'moderate' | 'weak' | 'anecdotal';\n    22→\n    23→export type RiskLevel = 'none' | 'very_low' | 'low' | 'medium' | 'high' | 'very_high';\n    24→\n    25→export type Gender = 'male' | 'female';\n    26→\n    27→export type ProfileType = 'front' | 'side';\n    28→\n    29→// ============================================\n    30→// TREATMENT TYPES\n    31→// ============================================\n    32→\n    33→export interface Treatment {\n    34→  id: string;\n    35→  name: string;\n    36→  category: TreatmentCategory;\n    37→  description: string;\n    38→  howItWorks: string;\n    39→\n    40→  // Effectiveness\n    41→  effectiveness: number; // 1-10\n    42→  evidenceLevel: EvidenceLevel;\n    43→  pslImprovement: { min: number; max: number };\n    44→\n    45→  // Costs\n    46→  costLevel: CostLevel;\n    47→  costRange: { min: number; max: number; currency: string };\n    48→  costFrequency: 'one-time' | 'monthly' | 'per-session' | 'annual';\n    49→\n    50→  // Timeline\n    51→  timelineToResults: string;\n    52→  resultsDuration: string;\n    53→  maintenanceRequired: boolean;\n    54→  maintenanceFrequency?: string;\n    55→\n    56→  // Recovery\n    57→  recoveryTime: string;\n    58→  downtime: string;\n    59→  painLevel: 'none' | 'low' | 'moderate' | 'high';\n    60→\n    61→  // Risk\n    62→  riskLevel: RiskLevel;\n    63→  sideEffects: string[];\n    64→  contraindications: string[];\n    65→\n    66→  // Applicability\n    67→  targetMetrics: string[];\n    68→  targetIssues: string[];\n    69→  genderSpecific?: Gender;\n    70→  ageRestrictions?: { min?: number; max?: number };\n    71→\n    72→  // Additional info\n    73→  notes?: string[];\n    74→  sources?: string[];\n    75→}\n    76→\n    77→export interface Surgery extends Treatment {\n    78→  category: 'surgical';\n    79→  surgeonRecommendations?: SurgeonInfo[];\n    80→  regionalCosts: RegionalCost[];\n    81→  revisionRate?: number;\n    82→  permanence: 'permanent' | 'semi-permanent' | 'temporary';\n    83→  hospitalStay?: string;\n    84→  anesthesiaType: 'local' | 'sedation' | 'general';\n    85→}\n    86→\n    87→export interface SurgeonInfo {\n    88→  name: string;\n    89→  location: string;\n    90→  specialty: string;\n    91→  costRange: string;\n    92→  notes?: string;\n    93→}\n    94→\n    95→export interface RegionalCost {\n    96→  region: string;\n    97→  min: number;\n    98→  max: number;\n    99→  currency: string;\n   100→  notes?: string;\n   101→}\n   102→\n   103→export interface Supplement {\n   104→  id: string;\n   105→  name: string;\n   106→  category: 'skin' | 'hair' | 'bone' | 'hormonal' | 'anti-aging' | 'general';\n   107→  description: string;\n   108→\n   109→  // Dosage\n   110→  dosage: string;\n   111→  frequency: string;\n   112→  timing?: string; // e.g., \"with meals\", \"before bed\"\n   113→\n   114→  // Effectiveness\n   115→  effectiveness: number; // 1-10\n   116→  evidenceLevel: EvidenceLevel;\n   117→\n   118→  // Cost\n   119→  costPerMonth: { min: number; max: number };\n   120→\n   121→  // Timeline\n   122→  timelineToResults: string;\n   123→\n   124→  // Safety\n   125→  riskLevel: RiskLevel;\n   126→  sideEffects: string[];\n   127→  interactions: string[];\n   128→  contraindications: string[];\n   129→\n   130→  // Applicability\n   131→  targetBenefits: string[];\n   132→  requiresPrescription: boolean;\n   133→\n   134→  notes?: string[];\n   135→  sources?: string[];\n   136→}\n   137→\n   138→// ============================================\n   139→// SEVERITY & SCORING\n   140→// ============================================\n   141→\n   142→export interface SeverityThreshold {\n   143→  metric: string;\n   144→  optimal: { min: number; max: number };\n   145→  mild: { min: number; max: number };\n   146→  moderate: { min: number; max: number };\n   147→  severe: { min: number; max: number };\n   148→  unit: string;\n   149→  higherIsBetter?: boolean;\n   150→}\n   151→\n   152→export interface SeverityResult {\n   153→  severity: Severity;\n   154→  label: string;\n   155→  color: string;\n   156→  icon: string;\n   157→  description: string;\n   158→}\n   159→\n   160→// ============================================\n   161→// RECOMMENDATION ENGINE TYPES\n   162→// ============================================\n   163→\n   164→export interface MetricAnalysis {\n   165→  metricId: string;\n   166→  metricName: string;\n   167→  currentValue: number;\n   168→  idealValue: number;\n   169→  idealRange: { min: number; max: number };\n   170→  deviation: number;\n   171→  deviationPercent: number;\n   172→  score: number;\n   173→  severity: SeverityResult;\n   174→  issue?: string;\n   175→  profileType: ProfileType;\n   176→}\n   177→\n   178→export interface TreatmentRecommendation {\n   179→  treatment: Treatment | Surgery | Supplement;\n   180→  priority: 'high' | 'medium' | 'low';\n   181→  relevanceScore: number; // 0-100\n   182→  targetMetrics: string[];\n   183→  estimatedImprovement: number;\n   184→  reasoning: string;\n   185→}\n   186→\n   187→export interface RecommendationPlan {\n   188→  // Summary\n   189→  overallScore: number;\n   190→  overallSeverity: SeverityResult;\n   191→  harmonyScore: number;\n   192→  percentile: number;\n   193→\n   194→  // Analysis\n   195→  metricAnalyses: MetricAnalysis[];\n   196→  strengths: MetricAnalysis[];\n   197→  weaknesses: MetricAnalysis[];\n   198→\n   199→  // Recommendations by category\n   200→  lifestyle: TreatmentRecommendation[];\n   201→  softmaxxing: TreatmentRecommendation[];\n   202→  nonSurgical: TreatmentRecommendation[];\n   203→  minimallyInvasive: TreatmentRecommendation[];\n   204→  surgical: TreatmentRecommendation[];\n   205→  supplements: TreatmentRecommendation[];\n   206→\n   207→  // Potential\n   208→  currentPSL: number;\n   209→  potentialPSL: number;\n   210→  potentialImprovement: number;\n   211→\n   212→  // Order of operations\n   213→  orderOfOperations: OrderOfOperation[];\n   214→}\n   215→\n   216→export interface OrderOfOperation {\n   217→  step: number;\n   218→  category: TreatmentCategory;\n   219→  treatment: Treatment | Surgery;\n   220→  reasoning: string;\n   221→  prerequisites?: string[];\n   222→  waitTime?: string;\n   223→}\n   224→\n   225→// ============================================\n   226→// METRIC TO ISSUE MAPPING\n   227→// ============================================\n   228→\n   229→export interface MetricIssueMapping {\n   230→  metric: string;\n   231→  lowIssue: string;\n   232→  highIssue: string;\n   233→  lowTreatments: string[];\n   234→  highTreatments: string[];\n   235→}\n   236→\n   237→// ============================================\n   238→// PSL RATING SYSTEM\n   239→// ============================================\n   240→\n   241→export interface PSLRating {\n   242→  score: number;\n   243→  tier: string;\n   244→  percentile: number;\n   245→  description: string;\n   246→}\n   247→\n   248→export const PSL_TIERS: PSLRating[] = [\n   249→  { score: 7.5, tier: 'Top Model', percentile: 99.99, description: 'Near perfection - world-class genetics' },\n   250→  { score: 7.0, tier: 'Chad', percentile: 99.87, description: 'Exceptional - top 0.1%' },\n   251→  { score: 6.5, tier: 'Chadlite', percentile: 99.0, description: 'Very attractive - top 1%' },\n   252→  { score: 6.0, tier: 'High Tier Normie+', percentile: 97.25, description: 'Notably attractive - top 3%' },\n   253→  { score: 5.5, tier: 'High Tier Normie', percentile: 90.0, description: 'Above average - top 10%' },\n   254→  { score: 5.0, tier: 'Mid Tier Normie+', percentile: 84.15, description: 'Slightly above average' },\n   255→  { score: 4.5, tier: 'Mid Tier Normie', percentile: 65.0, description: 'Average' },\n   256→  { score: 4.0, tier: 'Low Tier Normie', percentile: 50.0, description: 'Median' },\n   257→  { score: 3.5, tier: 'Below Average', percentile: 30.0, description: 'Below average' },\n   258→  { score: 3.0, tier: 'Subpar', percentile: 15.0, description: 'Noticeably below average' },\n   259→];\n   260→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"d04f90a3-54eb-4aaa-9bf6-825e51074a85","timestamp":"2025-12-20T20:53:45.411Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/types.ts","content":"/**\n * Recommendation System Types\n * Comprehensive type definitions for looksmaxxing recommendations\n */\n\n// ============================================\n// ENUMS & BASIC TYPES\n// ============================================\n\nexport type Severity = 'optimal' | 'mild' | 'moderate' | 'severe';\n\nexport type TreatmentCategory =\n  | 'lifestyle'\n  | 'softmaxxing'\n  | 'non_surgical'\n  | 'minimally_invasive'\n  | 'surgical';\n\nexport type CostLevel = 'free' | 'low' | 'medium' | 'high' | 'very_high';\n\nexport type EvidenceLevel = 'strong' | 'moderate' | 'weak' | 'anecdotal';\n\nexport type RiskLevel = 'none' | 'very_low' | 'low' | 'medium' | 'high' | 'very_high';\n\nexport type Gender = 'male' | 'female';\n\nexport type ProfileType = 'front' | 'side';\n\n// ============================================\n// TREATMENT TYPES\n// ============================================\n\nexport interface Treatment {\n  id: string;\n  name: string;\n  category: TreatmentCategory;\n  description: string;\n  howItWorks: string;\n\n  // Effectiveness\n  effectiveness: number; // 1-10\n  evidenceLevel: EvidenceLevel;\n  pslImprovement: { min: number; max: number };\n\n  // Costs\n  costLevel: CostLevel;\n  costRange: { min: number; max: number; currency: string };\n  costFrequency: 'one-time' | 'monthly' | 'per-session' | 'annual';\n\n  // Timeline\n  timelineToResults: string;\n  resultsDuration: string;\n  maintenanceRequired: boolean;\n  maintenanceFrequency?: string;\n\n  // Recovery\n  recoveryTime: string;\n  downtime: string;\n  painLevel: 'none' | 'low' | 'moderate' | 'high';\n\n  // Risk\n  riskLevel: RiskLevel;\n  sideEffects: string[];\n  contraindications: string[];\n\n  // Applicability\n  targetMetrics: string[];\n  targetIssues: string[];\n  genderSpecific?: Gender;\n  ageRestrictions?: { min?: number; max?: number };\n\n  // Additional info\n  notes?: string[];\n  sources?: string[];\n}\n\nexport interface Surgery extends Treatment {\n  category: 'surgical';\n  surgeonRecommendations?: SurgeonInfo[];\n  regionalCosts: RegionalCost[];\n  revisionRate?: number;\n  permanence: 'permanent' | 'semi-permanent' | 'temporary';\n  hospitalStay?: string;\n  anesthesiaType: 'local' | 'sedation' | 'general';\n}\n\nexport interface SurgeonInfo {\n  name: string;\n  location: string;\n  specialty: string;\n  costRange: string;\n  notes?: string;\n}\n\nexport interface RegionalCost {\n  region: string;\n  min: number;\n  max: number;\n  currency: string;\n  notes?: string;\n}\n\nexport interface Supplement {\n  id: string;\n  name: string;\n  category: 'skin' | 'hair' | 'bone' | 'hormonal' | 'anti-aging' | 'general';\n  description: string;\n\n  // Dosage\n  dosage: string;\n  frequency: string;\n  timing?: string; // e.g., \"with meals\", \"before bed\"\n\n  // Effectiveness\n  effectiveness: number; // 1-10\n  evidenceLevel: EvidenceLevel;\n\n  // Cost\n  costPerMonth: { min: number; max: number };\n\n  // Timeline\n  timelineToResults: string;\n\n  // Safety\n  riskLevel: RiskLevel;\n  sideEffects: string[];\n  interactions: string[];\n  contraindications: string[];\n\n  // Applicability\n  targetBenefits: string[];\n  requiresPrescription: boolean;\n\n  notes?: string[];\n  sources?: string[];\n}\n\n// ============================================\n// SEVERITY & SCORING\n// ============================================\n\nexport interface SeverityThreshold {\n  metric: string;\n  optimal: { min: number; max: number };\n  mild: { min: number; max: number };\n  moderate: { min: number; max: number };\n  severe: { min: number; max: number };\n  unit: string;\n  higherIsBetter?: boolean;\n}\n\nexport interface SeverityResult {\n  severity: Severity;\n  label: string;\n  color: string;\n  icon: string;\n  description: string;\n}\n\n// ============================================\n// RECOMMENDATION ENGINE TYPES\n// ============================================\n\nexport interface MetricAnalysis {\n  metricId: string;\n  metricName: string;\n  currentValue: number;\n  idealValue: number;\n  idealRange: { min: number; max: number };\n  deviation: number;\n  deviationPercent: number;\n  score: number;\n  severity: SeverityResult;\n  issue?: string;\n  profileType: ProfileType;\n}\n\nexport interface TreatmentRecommendation {\n  treatment: Treatment | Surgery | Supplement;\n  priority: 'high' | 'medium' | 'low';\n  relevanceScore: number; // 0-100\n  targetMetrics: string[];\n  estimatedImprovement: number;\n  reasoning: string;\n}\n\nexport interface RecommendationPlan {\n  // Summary\n  overallScore: number;\n  overallSeverity: SeverityResult;\n  harmonyScore: number;\n  percentile: number;\n\n  // Analysis\n  metricAnalyses: MetricAnalysis[];\n  strengths: MetricAnalysis[];\n  weaknesses: MetricAnalysis[];\n\n  // Recommendations by category\n  lifestyle: TreatmentRecommendation[];\n  softmaxxing: TreatmentRecommendation[];\n  nonSurgical: TreatmentRecommendation[];\n  minimallyInvasive: TreatmentRecommendation[];\n  surgical: TreatmentRecommendation[];\n  supplements: TreatmentRecommendation[];\n\n  // Potential\n  currentPSL: number;\n  potentialPSL: number;\n  potentialImprovement: number;\n\n  // Order of operations\n  orderOfOperations: OrderOfOperation[];\n}\n\nexport interface OrderOfOperation {\n  step: number;\n  category: TreatmentCategory;\n  treatment: Treatment | Surgery;\n  reasoning: string;\n  prerequisites?: string[];\n  waitTime?: string;\n}\n\n// ============================================\n// METRIC TO ISSUE MAPPING\n// ============================================\n\nexport interface MetricIssueMapping {\n  metric: string;\n  lowIssue: string;\n  highIssue: string;\n  lowTreatments: string[];\n  highTreatments: string[];\n}\n\n// ============================================\n// PSL RATING SYSTEM\n// ============================================\n\nexport interface PSLRating {\n  score: number;\n  tier: string;\n  percentile: number;\n  description: string;\n}\n\nexport const PSL_TIERS: PSLRating[] = [\n  { score: 7.5, tier: 'Top Model', percentile: 99.99, description: 'Near perfection - world-class genetics' },\n  { score: 7.0, tier: 'Chad', percentile: 99.87, description: 'Exceptional - top 0.1%' },\n  { score: 6.5, tier: 'Chadlite', percentile: 99.0, description: 'Very attractive - top 1%' },\n  { score: 6.0, tier: 'High Tier Normie+', percentile: 97.25, description: 'Notably attractive - top 3%' },\n  { score: 5.5, tier: 'High Tier Normie', percentile: 90.0, description: 'Above average - top 10%' },\n  { score: 5.0, tier: 'Mid Tier Normie+', percentile: 84.15, description: 'Slightly above average' },\n  { score: 4.5, tier: 'Mid Tier Normie', percentile: 65.0, description: 'Average' },\n  { score: 4.0, tier: 'Low Tier Normie', percentile: 50.0, description: 'Median' },\n  { score: 3.5, tier: 'Below Average', percentile: 30.0, description: 'Below average' },\n  { score: 3.0, tier: 'Subpar', percentile: 15.0, description: 'Noticeably below average' },\n];\n","numLines":260,"startLine":1,"totalLines":260}}}
{"parentUuid":"d04f90a3-54eb-4aaa-9bf6-825e51074a85","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Se1wNVXWDAYnUJCjWJxD1c","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I understand the structure. The treatments have `targetMetrics` and `targetIssues` fields. I need to enhance the `generateRecommendations` function to:\n\n1. Use metric scores to prioritize treatments\n2. Match specific flaws/issues to specific procedures using existing mappings\n3. Calculate expected improvement percentages\n\nLet me update the generateRecommendations function in ResultsContext.tsx. First, let me see the current implementation again.","signature":"EusECkYIChgCKkCGF+8FSTODxSCJ40dLivAYRXjAEAI2Sa5Fwm/xKrAmcy99Ew2vCjmBRX6hcRXJWlyUVzPlu6RUTzd4pAc9pgEVEgyIzto2NV/dfwNAqMUaDKxY7TPPNe3YRkufiCIwAurZY/4FUSwD5/90iiXQwTVjSw67sUilvISf+iEbHze7zWRPB1PB/buo5+cS/6YWKtIDb1oAiUPqfPThC4GyMGrZHRhpExkN7t6AfmvytgZh4d5z3GLx65mLG+r19ORgWt1zf6EmdCxlE5K3wCu/sTTfFECc6P3pOKAx9g0USPkO4/PBW6mYRK4pRJQefgiOKFNOiPBXYct7SuE1QDPVnzqe+gKCBEC7xXMyb62AuPB0r/2DV5y4TKbPa+PzQ4dNp3wy0rZfczz3u+AJDaFZAIQDN3MSzccUrGFPfY5teqA1emcRr/rnygfNRF1zi+wq0PDhWIlISzw9kPNbwbNuKdC4jG3Al+gQE1yt479cMyMYoXS4IgKRf7LaeCUQzurbR9HZay4qqyJFF0voIXa/lkfPrqzbPYG4EzlS4gz7CIM0uOiZ73uCJ9sOvkOUWPgy5sKchtvpPjmXlC/TIrJxEe7KAcRvLgajvitn6hO0rZG89kONE1IWx8pkEKm4mzpE/Rj+3Hb4svvrys1CpMQrWisOZr1lCQe091tXDtbtNVD/QmzyOryi2Wy38eRTm48IJtFKamo6atql1Wt0uwH+Zu9OeoTcWLj+7lgFafwyp1aKHC59igWjZKCPQfeQyHTzO+oq6AbEUzm2WVb9iyDoY7Zr50zUfEgmpY6wkD0F+xhnKrV2BxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":3254,"cache_read_input_tokens":106170,"cache_creation":{"ephemeral_5m_input_tokens":3254,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWJbxMaCgXg8kiymc8WFJ","type":"assistant","uuid":"e34ea320-f092-48fa-8ff1-ebec96430ac3","timestamp":"2025-12-20T20:53:49.613Z"}
{"parentUuid":"e34ea320-f092-48fa-8ff1-ebec96430ac3","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Se1wNVXWDAYnUJCjWJxD1c","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me update the `generateRecommendations` function to use metric scores and match flaws to specific procedures."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":3254,"cache_read_input_tokens":106170,"cache_creation":{"ephemeral_5m_input_tokens":3254,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWJbxMaCgXg8kiymc8WFJ","type":"assistant","uuid":"5915d831-6e26-473e-96ba-3e55913b9066","timestamp":"2025-12-20T20:53:50.258Z"}
{"parentUuid":"5915d831-6e26-473e-96ba-3e55913b9066","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Se1wNVXWDAYnUJCjWJxD1c","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KVPWgu1uwCGP1JWARAsRgY","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","offset":595,"limit":180}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":3254,"cache_read_input_tokens":106170,"cache_creation":{"ephemeral_5m_input_tokens":3254,"ephemeral_1h_input_tokens":0},"output_tokens":249,"service_tier":"standard"}},"requestId":"req_011CWJbxMaCgXg8kiymc8WFJ","type":"assistant","uuid":"d869dd21-cb11-4ad2-a9df-6ad2e2cfd082","timestamp":"2025-12-20T20:53:51.590Z"}
{"parentUuid":"d869dd21-cb11-4ad2-a9df-6ad2e2cfd082","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KVPWgu1uwCGP1JWARAsRgY","type":"tool_result","content":"   595→    const matchingMeasurement = analysis.measurements.find(m => m.metricId === f.metricId);\n   596→    const impact = matchingMeasurement ? (10 - matchingMeasurement.score) * 0.5 : 2;\n   597→    rollingLost += impact;\n   598→\n   599→    flaws.push({\n   600→      id: `flaw_${i}`,\n   601→      flawName: f.metricName,\n   602→      summary: f.reasoning,\n   603→      harmonyPercentageLost: impact,\n   604→      standardizedImpact: impact / 10,\n   605→      categoryName: f.category,\n   606→      responsibleRatios: [{\n   607→        ratioName: f.metricName,\n   608→        ratioId: f.metricId,\n   609→        score: matchingMeasurement?.score || 3,\n   610→        value: matchingMeasurement?.value || 0,\n   611→      }],\n   612→      rollingPointsDeducted: rollingLost,\n   613→      rollingHarmonyPercentageLost: rollingLost,\n   614→      rollingStandardizedImpact: rollingLost / 10,\n   615→    });\n   616→  });\n   617→\n   618→  return flaws.sort((a, b) => b.harmonyPercentageLost - a.harmonyPercentageLost);\n   619→}\n   620→\n   621→function generateRecommendations(flaws: Flaw[]): Recommendation[] {\n   622→  // Generate recommendations based on detected flaws\n   623→  const recommendations: Recommendation[] = [];\n   624→\n   625→  const procedureDatabase: Array<Omit<Recommendation, 'matchedFlaws' | 'matchedRatios' | 'ratios_impacted'> & { targetFlaws: string[] }> = [\n   626→    {\n   627→      ref_id: 'SUR-01',\n   628→      name: 'Genioplasty',\n   629→      description: 'Surgical chin repositioning to improve chin projection and facial harmony. Can move the chin forward, backward, up, or down.',\n   630→      phase: 'Surgical',\n   631→      impact: 0.85,\n   632→      coverage: 8,\n   633→      percentage: '15-25%',\n   634→      expectedImprovementRange: { min: 0.5, max: 1.5 },\n   635→      targetFlaws: ['Weak chin', 'Recessed chin', 'Short chin', 'chin'],\n   636→      timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n   637→      cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n   638→      risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage.',\n   639→      warnings: [],\n   640→      gender: 'both',\n   641→    },\n   642→    {\n   643→      ref_id: 'SUR-02',\n   644→      name: 'Rhinoplasty',\n   645→      description: 'Nose reshaping surgery to improve nasal proportions, reduce or increase size, change angle, or correct breathing issues.',\n   646→      phase: 'Surgical',\n   647→      impact: 0.8,\n   648→      coverage: 6,\n   649→      percentage: '10-20%',\n   650→      targetFlaws: ['Wide nose', 'Long nose', 'Crooked nose', 'nose', 'nasal'],\n   651→      timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n   652→      cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n   653→      risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n   654→      warnings: [],\n   655→      gender: 'both',\n   656→    },\n   657→    {\n   658→      ref_id: 'SUR-03',\n   659→      name: 'Jaw Implants',\n   660→      description: 'Custom or standard implants to enhance jaw width and definition. Creates a more angular, masculine jawline.',\n   661→      phase: 'Surgical',\n   662→      impact: 0.75,\n   663→      coverage: 5,\n   664→      percentage: '10-15%',\n   665→      targetFlaws: ['Narrow jaw', 'Weak jaw', 'jaw'],\n   666→      timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n   667→      cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n   668→      risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection.',\n   669→      warnings: [],\n   670→      gender: 'both',\n   671→    },\n   672→    {\n   673→      ref_id: 'MIN-01',\n   674→      name: 'Dermal Fillers',\n   675→      description: 'Hyaluronic acid injections to add volume to chin, jawline, or cheeks. Non-permanent and reversible.',\n   676→      phase: 'Minimally Invasive',\n   677→      impact: 0.4,\n   678→      coverage: 4,\n   679→      percentage: '5-10%',\n   680→      targetFlaws: ['Weak chin', 'Flat cheeks', 'chin', 'midface'],\n   681→      timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n   682→      cost: { type: 'per_session', min: 600, max: 2000, currency: 'USD' },\n   683→      risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n   684→      warnings: ['Results temporary (6-18 months)'],\n   685→      gender: 'both',\n   686→    },\n   687→    {\n   688→      ref_id: 'MIN-02',\n   689→      name: 'Orthodontic Treatment',\n   690→      description: 'Braces or clear aligners to correct bite alignment and tooth positioning. Can impact facial profile over time.',\n   691→      phase: 'Minimally Invasive',\n   692→      impact: 0.5,\n   693→      coverage: 3,\n   694→      percentage: '5-15%',\n   695→      targetFlaws: ['Bite issues', 'Midface recession', 'jaw'],\n   696→      timeline: { effect_start: 'gradual', full_results_weeks: 52, full_results_weeks_max: 104 },\n   697→      cost: { type: 'flat', min: 3000, max: 10000, currency: 'USD' },\n   698→      risks_side_effects: 'Temporary discomfort, requires compliance.',\n   699→      warnings: [],\n   700→      gender: 'both',\n   701→    },\n   702→    {\n   703→      ref_id: 'FND-01',\n   704→      name: 'Mewing / Proper Tongue Posture',\n   705→      description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n   706→      phase: 'Foundational',\n   707→      impact: 0.2,\n   708→      coverage: 4,\n   709→      percentage: '2-5%',\n   710→      targetFlaws: ['Midface recession', 'Narrow palate', 'jaw', 'midface'],\n   711→      timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n   712→      cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n   713→      risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n   714→      warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n   715→      gender: 'both',\n   716→    },\n   717→    {\n   718→      ref_id: 'FND-02',\n   719→      name: 'Body Recomposition',\n   720→      description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n   721→      phase: 'Foundational',\n   722→      impact: 0.3,\n   723→      coverage: 6,\n   724→      percentage: '5-10%',\n   725→      targetFlaws: ['Undefined jawline', 'Soft features', 'jaw', 'face'],\n   726→      timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n   727→      cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n   728→      risks_side_effects: 'None if done healthily.',\n   729→      warnings: [],\n   730→      gender: 'both',\n   731→    },\n   732→  ];\n   733→\n   734→  flaws.forEach(flaw => {\n   735→    procedureDatabase.forEach(proc => {\n   736→      const flawLower = flaw.flawName.toLowerCase();\n   737→      const matches = proc.targetFlaws.some(target =>\n   738→        flawLower.includes(target.toLowerCase()) || target.toLowerCase().includes(flawLower)\n   739→      );\n   740→\n   741→      if (matches && !recommendations.find(r => r.ref_id === proc.ref_id)) {\n   742→        recommendations.push({\n   743→          ...proc,\n   744→          matchedFlaws: [flaw.flawName],\n   745→          matchedRatios: flaw.responsibleRatios.map(r => r.ratioName),\n   746→          ratios_impacted: flaw.responsibleRatios.map(r => ({\n   747→            ratioId: r.ratioId,\n   748→            ratioName: r.ratioName,\n   749→            direction: 'both' as const,\n   750→            percentageEffect: 1.0,\n   751→          })),\n   752→        });\n   753→      }\n   754→    });\n   755→  });\n   756→\n   757→  return recommendations.sort((a, b) => b.impact - a.impact);\n   758→}\n   759→\n   760→// ============================================\n   761→// CONTEXT CREATION\n   762→// ============================================\n   763→\n   764→const ResultsContext = createContext<ResultsContextType | null>(null);\n   765→\n   766→export function useResults(): ResultsContextType {\n   767→  const context = useContext(ResultsContext);\n   768→  if (!context) {\n   769→    throw new Error('useResults must be used within a ResultsProvider');\n   770→  }\n   771→  return context;\n   772→}\n   773→\n   774→interface ResultsProviderProps {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"006790a3-5760-4c12-9fbc-af8a44f42266","timestamp":"2025-12-20T20:53:51.624Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","content":"    const matchingMeasurement = analysis.measurements.find(m => m.metricId === f.metricId);\n    const impact = matchingMeasurement ? (10 - matchingMeasurement.score) * 0.5 : 2;\n    rollingLost += impact;\n\n    flaws.push({\n      id: `flaw_${i}`,\n      flawName: f.metricName,\n      summary: f.reasoning,\n      harmonyPercentageLost: impact,\n      standardizedImpact: impact / 10,\n      categoryName: f.category,\n      responsibleRatios: [{\n        ratioName: f.metricName,\n        ratioId: f.metricId,\n        score: matchingMeasurement?.score || 3,\n        value: matchingMeasurement?.value || 0,\n      }],\n      rollingPointsDeducted: rollingLost,\n      rollingHarmonyPercentageLost: rollingLost,\n      rollingStandardizedImpact: rollingLost / 10,\n    });\n  });\n\n  return flaws.sort((a, b) => b.harmonyPercentageLost - a.harmonyPercentageLost);\n}\n\nfunction generateRecommendations(flaws: Flaw[]): Recommendation[] {\n  // Generate recommendations based on detected flaws\n  const recommendations: Recommendation[] = [];\n\n  const procedureDatabase: Array<Omit<Recommendation, 'matchedFlaws' | 'matchedRatios' | 'ratios_impacted'> & { targetFlaws: string[] }> = [\n    {\n      ref_id: 'SUR-01',\n      name: 'Genioplasty',\n      description: 'Surgical chin repositioning to improve chin projection and facial harmony. Can move the chin forward, backward, up, or down.',\n      phase: 'Surgical',\n      impact: 0.85,\n      coverage: 8,\n      percentage: '15-25%',\n      expectedImprovementRange: { min: 0.5, max: 1.5 },\n      targetFlaws: ['Weak chin', 'Recessed chin', 'Short chin', 'chin'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n      cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n      risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'SUR-02',\n      name: 'Rhinoplasty',\n      description: 'Nose reshaping surgery to improve nasal proportions, reduce or increase size, change angle, or correct breathing issues.',\n      phase: 'Surgical',\n      impact: 0.8,\n      coverage: 6,\n      percentage: '10-20%',\n      targetFlaws: ['Wide nose', 'Long nose', 'Crooked nose', 'nose', 'nasal'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n      cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n      risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'SUR-03',\n      name: 'Jaw Implants',\n      description: 'Custom or standard implants to enhance jaw width and definition. Creates a more angular, masculine jawline.',\n      phase: 'Surgical',\n      impact: 0.75,\n      coverage: 5,\n      percentage: '10-15%',\n      targetFlaws: ['Narrow jaw', 'Weak jaw', 'jaw'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n      cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n      risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'MIN-01',\n      name: 'Dermal Fillers',\n      description: 'Hyaluronic acid injections to add volume to chin, jawline, or cheeks. Non-permanent and reversible.',\n      phase: 'Minimally Invasive',\n      impact: 0.4,\n      coverage: 4,\n      percentage: '5-10%',\n      targetFlaws: ['Weak chin', 'Flat cheeks', 'chin', 'midface'],\n      timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n      cost: { type: 'per_session', min: 600, max: 2000, currency: 'USD' },\n      risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n      warnings: ['Results temporary (6-18 months)'],\n      gender: 'both',\n    },\n    {\n      ref_id: 'MIN-02',\n      name: 'Orthodontic Treatment',\n      description: 'Braces or clear aligners to correct bite alignment and tooth positioning. Can impact facial profile over time.',\n      phase: 'Minimally Invasive',\n      impact: 0.5,\n      coverage: 3,\n      percentage: '5-15%',\n      targetFlaws: ['Bite issues', 'Midface recession', 'jaw'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 52, full_results_weeks_max: 104 },\n      cost: { type: 'flat', min: 3000, max: 10000, currency: 'USD' },\n      risks_side_effects: 'Temporary discomfort, requires compliance.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'FND-01',\n      name: 'Mewing / Proper Tongue Posture',\n      description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n      phase: 'Foundational',\n      impact: 0.2,\n      coverage: 4,\n      percentage: '2-5%',\n      targetFlaws: ['Midface recession', 'Narrow palate', 'jaw', 'midface'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n      cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n      risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n      warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n      gender: 'both',\n    },\n    {\n      ref_id: 'FND-02',\n      name: 'Body Recomposition',\n      description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n      phase: 'Foundational',\n      impact: 0.3,\n      coverage: 6,\n      percentage: '5-10%',\n      targetFlaws: ['Undefined jawline', 'Soft features', 'jaw', 'face'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n      cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n      risks_side_effects: 'None if done healthily.',\n      warnings: [],\n      gender: 'both',\n    },\n  ];\n\n  flaws.forEach(flaw => {\n    procedureDatabase.forEach(proc => {\n      const flawLower = flaw.flawName.toLowerCase();\n      const matches = proc.targetFlaws.some(target =>\n        flawLower.includes(target.toLowerCase()) || target.toLowerCase().includes(flawLower)\n      );\n\n      if (matches && !recommendations.find(r => r.ref_id === proc.ref_id)) {\n        recommendations.push({\n          ...proc,\n          matchedFlaws: [flaw.flawName],\n          matchedRatios: flaw.responsibleRatios.map(r => r.ratioName),\n          ratios_impacted: flaw.responsibleRatios.map(r => ({\n            ratioId: r.ratioId,\n            ratioName: r.ratioName,\n            direction: 'both' as const,\n            percentageEffect: 1.0,\n          })),\n        });\n      }\n    });\n  });\n\n  return recommendations.sort((a, b) => b.impact - a.impact);\n}\n\n// ============================================\n// CONTEXT CREATION\n// ============================================\n\nconst ResultsContext = createContext<ResultsContextType | null>(null);\n\nexport function useResults(): ResultsContextType {\n  const context = useContext(ResultsContext);\n  if (!context) {\n    throw new Error('useResults must be used within a ResultsProvider');\n  }\n  return context;\n}\n\ninterface ResultsProviderProps {","numLines":180,"startLine":595,"totalLines":912}}}
{"parentUuid":"006790a3-5760-4c12-9fbc-af8a44f42266","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UjB8GPV3jVt2FSEhudPSu5","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I need to update the `generateRecommendations` function to be more sophisticated. I'll:\n\n1. Add more comprehensive procedure database with metric-specific targeting\n2. Use flaw severity to calculate expected improvements\n3. Match based on specific flaw categories and metric IDs\n4. Calculate priority based on flaw impact and treatment effectiveness\n\nLet me create a much better recommendation system.","signature":"ErgECkYIChgCKkD8Ye2DWOs/OazrSttdeJ4q/h+srTanOxVxaocIBxgO1NmpgIZucZHIL6EvSw/HCpBU3O1AFEmSkQeu36DYenp9EgxXHEhkW9/09YGXLj8aDDZSkG9Z/DAXlvzTeSIwp/a6D9hI5Tj+lJQRDmRSMr4m4rkUf8xBgBv49yy75Pu9iL6XtnA9C29fa2mMjOMmKp8DEYjt+S9UWvMiQ779VYAtpCs+etT5FKYl1ruEBufN625D0wYGLPgF97EWErkpQAd0H7wGpALHxQchZo59e6Nai168Hvv0IEQeDYa9hi4QZRjmT50HlMQC45bzUOo0yRIShwSKioehBzcj/+m4Fx5yJLjILFtIwoI7KtsmX7LO8ReP6GBg4PypIR3SNOSsOo0LrPIKIY6WRSncR5+dla3frKYfXv6YmB5JaSlhdz6sJy9y+Sa/1RFRb3n0fMrYznz4qVSR7hJCrYpWaTlTTrpVtvYyWqe7BjDidXWootaOgappvyCQ6j4sMMQ7r0ihUf0y0zm1kq3ClenT0vlhbGAh1zIQbwTkfxgQQQKlW4WcV18V/inO6aLzQbza4zHbf2qZ+iUywrInBdqCQ6IW3zeU8DIJ4h/P2Bdc3SjKiu4W3s+PPhyLd4sc3P4G+uJIyUTYl4u4epMKPAvLXonVeVxpxGE5JQQDbNUfjiJFHqxLBCm/m5+dzeb63di45PVPb4QcY4memIftITNitFijlFXyVQnxT9PtBWYsDDywlrjJPhgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":3440,"cache_read_input_tokens":109424,"cache_creation":{"ephemeral_5m_input_tokens":3440,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJbxpLmezVQhKHuvh7mk","type":"assistant","uuid":"0d9dd67b-a2e2-4b86-9702-355f04fcbda1","timestamp":"2025-12-20T20:53:56.169Z"}
{"parentUuid":"0d9dd67b-a2e2-4b86-9702-355f04fcbda1","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UjB8GPV3jVt2FSEhudPSu5","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011FwEgxQ83ksP9LJJrubh7y","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","old_string":"function generateRecommendations(flaws: Flaw[]): Recommendation[] {\n  // Generate recommendations based on detected flaws\n  const recommendations: Recommendation[] = [];\n\n  const procedureDatabase: Array<Omit<Recommendation, 'matchedFlaws' | 'matchedRatios' | 'ratios_impacted'> & { targetFlaws: string[] }> = [\n    {\n      ref_id: 'SUR-01',\n      name: 'Genioplasty',\n      description: 'Surgical chin repositioning to improve chin projection and facial harmony. Can move the chin forward, backward, up, or down.',\n      phase: 'Surgical',\n      impact: 0.85,\n      coverage: 8,\n      percentage: '15-25%',\n      expectedImprovementRange: { min: 0.5, max: 1.5 },\n      targetFlaws: ['Weak chin', 'Recessed chin', 'Short chin', 'chin'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n      cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n      risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'SUR-02',\n      name: 'Rhinoplasty',\n      description: 'Nose reshaping surgery to improve nasal proportions, reduce or increase size, change angle, or correct breathing issues.',\n      phase: 'Surgical',\n      impact: 0.8,\n      coverage: 6,\n      percentage: '10-20%',\n      targetFlaws: ['Wide nose', 'Long nose', 'Crooked nose', 'nose', 'nasal'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n      cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n      risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'SUR-03',\n      name: 'Jaw Implants',\n      description: 'Custom or standard implants to enhance jaw width and definition. Creates a more angular, masculine jawline.',\n      phase: 'Surgical',\n      impact: 0.75,\n      coverage: 5,\n      percentage: '10-15%',\n      targetFlaws: ['Narrow jaw', 'Weak jaw', 'jaw'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n      cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n      risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'MIN-01',\n      name: 'Dermal Fillers',\n      description: 'Hyaluronic acid injections to add volume to chin, jawline, or cheeks. Non-permanent and reversible.',\n      phase: 'Minimally Invasive',\n      impact: 0.4,\n      coverage: 4,\n      percentage: '5-10%',\n      targetFlaws: ['Weak chin', 'Flat cheeks', 'chin', 'midface'],\n      timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n      cost: { type: 'per_session', min: 600, max: 2000, currency: 'USD' },\n      risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n      warnings: ['Results temporary (6-18 months)'],\n      gender: 'both',\n    },\n    {\n      ref_id: 'MIN-02',\n      name: 'Orthodontic Treatment',\n      description: 'Braces or clear aligners to correct bite alignment and tooth positioning. Can impact facial profile over time.',\n      phase: 'Minimally Invasive',\n      impact: 0.5,\n      coverage: 3,\n      percentage: '5-15%',\n      targetFlaws: ['Bite issues', 'Midface recession', 'jaw'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 52, full_results_weeks_max: 104 },\n      cost: { type: 'flat', min: 3000, max: 10000, currency: 'USD' },\n      risks_side_effects: 'Temporary discomfort, requires compliance.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'FND-01',\n      name: 'Mewing / Proper Tongue Posture',\n      description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n      phase: 'Foundational',\n      impact: 0.2,\n      coverage: 4,\n      percentage: '2-5%',\n      targetFlaws: ['Midface recession', 'Narrow palate', 'jaw', 'midface'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n      cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n      risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n      warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n      gender: 'both',\n    },\n    {\n      ref_id: 'FND-02',\n      name: 'Body Recomposition',\n      description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n      phase: 'Foundational',\n      impact: 0.3,\n      coverage: 6,\n      percentage: '5-10%',\n      targetFlaws: ['Undefined jawline', 'Soft features', 'jaw', 'face'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n      cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n      risks_side_effects: 'None if done healthily.',\n      warnings: [],\n      gender: 'both',\n    },\n  ];\n\n  flaws.forEach(flaw => {\n    procedureDatabase.forEach(proc => {\n      const flawLower = flaw.flawName.toLowerCase();\n      const matches = proc.targetFlaws.some(target =>\n        flawLower.includes(target.toLowerCase()) || target.toLowerCase().includes(flawLower)\n      );\n\n      if (matches && !recommendations.find(r => r.ref_id === proc.ref_id)) {\n        recommendations.push({\n          ...proc,\n          matchedFlaws: [flaw.flawName],\n          matchedRatios: flaw.responsibleRatios.map(r => r.ratioName),\n          ratios_impacted: flaw.responsibleRatios.map(r => ({\n            ratioId: r.ratioId,\n            ratioName: r.ratioName,\n            direction: 'both' as const,\n            percentageEffect: 1.0,\n          })),\n        });\n      }\n    });\n  });\n\n  return recommendations.sort((a, b) => b.impact - a.impact);\n}","new_string":"// Comprehensive procedure database with metric-specific targeting\ninterface ProcedureConfig {\n  ref_id: string;\n  name: string;\n  description: string;\n  phase: 'Surgical' | 'Minimally Invasive' | 'Foundational';\n  baseImpact: number;\n  coverage: number;\n  percentage: string;\n  expectedImprovementRange: { min: number; max: number };\n  targetMetrics: string[];  // Specific metric IDs this treatment addresses\n  targetCategories: string[];  // Category names this treatment addresses\n  targetKeywords: string[];  // Flaw name keywords to match\n  timeline: { effect_start: 'immediate' | 'delayed' | 'gradual'; full_results_weeks: number; full_results_weeks_max?: number };\n  cost: { type: 'flat' | 'per_session' | 'per_month'; min: number; max: number; currency: string };\n  risks_side_effects: string;\n  warnings: string[];\n  gender: 'male' | 'female' | 'both';\n}\n\nconst PROCEDURE_DATABASE: ProcedureConfig[] = [\n  // ==========================================\n  // SURGICAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'SUR-01',\n    name: 'Sliding Genioplasty',\n    description: 'Chin bone repositioning surgery that can move the chin forward, backward, up, or down for optimal projection and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.90,\n    coverage: 8,\n    percentage: '15-25%',\n    expectedImprovementRange: { min: 0.5, max: 1.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'facialDepthToHeight', 'anteriorFacialDepth', 'nasomentaAngle'],\n    targetCategories: ['Chin', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['chin', 'recessed', 'weak', 'short chin', 'long chin', 'pogonion'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage, bone resorption.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-02',\n    name: 'Reduction Rhinoplasty',\n    description: 'Surgical reduction of nose size, hump removal, and tip refinement to improve nasal proportions.',\n    phase: 'Surgical',\n    baseImpact: 0.85,\n    coverage: 6,\n    percentage: '10-20%',\n    expectedImprovementRange: { min: 0.5, max: 1.0 },\n    targetMetrics: ['nasalIndex', 'nasofrontalAngle', 'nasofacialAngle', 'nasomentaAngle', 'intercanthalNasalRatio', 'noseBridgeWidth'],\n    targetCategories: ['Nose'],\n    targetKeywords: ['wide nose', 'large nose', 'dorsal hump', 'bulbous', 'nasal', 'nose bridge'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 7000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-03',\n    name: 'Jaw Angle Implants',\n    description: 'Custom or standard silicone/PEEK implants to enhance jaw width, definition, and angularity.',\n    phase: 'Surgical',\n    baseImpact: 0.80,\n    coverage: 5,\n    percentage: '10-15%',\n    expectedImprovementRange: { min: 0.4, max: 1.0 },\n    targetMetrics: ['bigonialWidth', 'jawFrontalAngle', 'jawWidthRatio', 'jawSlope', 'gonialAngle'],\n    targetCategories: ['Jaw Shape'],\n    targetKeywords: ['narrow jaw', 'weak jaw', 'soft jaw', 'jaw angle', 'gonial', 'mandible'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection, bone erosion.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-04',\n    name: 'Bimaxillary Osteotomy (Bimax)',\n    description: 'Double jaw surgery to reposition both upper and lower jaws for optimal occlusion and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.95,\n    coverage: 12,\n    percentage: '20-35%',\n    expectedImprovementRange: { min: 1.0, max: 2.0 },\n    targetMetrics: ['midfaceRatio', 'facialDepthToHeight', 'mandibularPlaneAngle', 'lowerThirdProportion', 'nasofacialAngle'],\n    targetCategories: ['Occlusion/Jaw Growth', 'Midface/Face Shape'],\n    targetKeywords: ['maxillary recession', 'mandibular', 'hyper-divergent', 'bite', 'occlusion', 'midface recession'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 20000, max: 60000, currency: 'USD' },\n    risks_side_effects: 'Extended recovery, numbness (temporary to permanent), dietary restrictions.',\n    warnings: ['Major surgery - requires orthodontic preparation'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-05',\n    name: 'Canthoplasty',\n    description: 'Surgical eye corner modification to improve canthal tilt and eye shape.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.8 },\n    targetMetrics: ['lateralCanthalTilt', 'eyeAspectRatio'],\n    targetCategories: ['Eyes'],\n    targetKeywords: ['canthal tilt', 'negative tilt', 'drooping eyes', 'eye shape', 'eye angle'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 4000, max: 12000, currency: 'USD' },\n    risks_side_effects: 'Scarring, asymmetry, dry eyes, ectropion.',\n    warnings: ['Difficult to reverse'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-06',\n    name: 'Cheek/Malar Implants',\n    description: 'Solid implants placed over the cheekbones to enhance midface projection and width.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 4,\n    percentage: '10-18%',\n    expectedImprovementRange: { min: 0.4, max: 0.9 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio', 'totalFacialWidthToHeight'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface', 'zygomatic', 'malar'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 6, full_results_weeks_max: 12 },\n    cost: { type: 'flat', min: 6000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry, implant shifting, nerve damage.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-07',\n    name: 'Neck Liposuction / Submentoplasty',\n    description: 'Fat removal and skin tightening under the chin and neck area.',\n    phase: 'Surgical',\n    baseImpact: 0.65,\n    coverage: 3,\n    percentage: '8-12%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['round neck', 'double chin', 'submental', 'cervical', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 3000, max: 8000, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, skin irregularity, numbness.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-08',\n    name: 'Brow Bone Reduction/Augmentation',\n    description: 'Surgical reshaping of the brow ridge for improved upper third harmony.',\n    phase: 'Surgical',\n    baseImpact: 0.70,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['nasofrontalAngle', 'bitemporalWidth', 'upperThirdProportion'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['brow ridge', 'forehead', 'nasofrontal', 'upper third', 'glabella'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling, numbness, scarring (if coronal incision).',\n    warnings: [],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // MINIMALLY INVASIVE TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'MIN-01',\n    name: 'Chin/Jawline Filler',\n    description: 'Hyaluronic acid injections to enhance chin projection and jawline definition. Reversible and temporary.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 4,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'jawFrontalAngle', 'bigonialWidth'],\n    targetCategories: ['Chin', 'Jaw Shape'],\n    targetKeywords: ['weak chin', 'recessed chin', 'soft jaw', 'jawline'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 800, max: 2500, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n    warnings: ['Results temporary (12-18 months)', 'Requires maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-02',\n    name: 'Cheek Filler',\n    description: 'HA filler to enhance cheekbone projection and midface volume.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 3,\n    percentage: '5-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface volume'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 600, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, asymmetry.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-03',\n    name: 'Lip Filler',\n    description: 'Hyaluronic acid to enhance lip volume and proportions.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['lowerUpperLipRatio', 'mouthNoseWidthRatio'],\n    targetCategories: ['Lips'],\n    targetKeywords: ['thin lip', 'lip ratio', 'lip volume', 'upper lip', 'lower lip'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 400, max: 1200, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, lumps.',\n    warnings: ['Results temporary (6-12 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-04',\n    name: 'PDO Thread Lift',\n    description: 'Dissolvable threads to lift and tighten skin, particularly for canthal tilt improvement.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 3,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.1, max: 0.4 },\n    targetMetrics: ['lateralCanthalTilt', 'eyebrowLowSetedness'],\n    targetCategories: ['Eyes', 'Upper Third'],\n    targetKeywords: ['canthal tilt', 'drooping', 'sagging', 'eyebrow position'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 1500, max: 4000, currency: 'USD' },\n    risks_side_effects: 'Bruising, asymmetry, thread visibility, infection.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-05',\n    name: 'Masseter Botox',\n    description: 'Botulinum toxin to slim the lower face by relaxing masseter muscles.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 2,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['bigonialWidth', 'jawWidthRatio', 'faceWidthToHeight'],\n    targetCategories: ['Jaw Shape', 'Midface/Face Shape'],\n    targetKeywords: ['wide jaw', 'square jaw', 'masseter', 'bruxism'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 400, max: 1000, currency: 'USD' },\n    risks_side_effects: 'Temporary weakness, asymmetry, difficulty chewing.',\n    warnings: ['Results temporary (4-6 months)', 'Requires regular maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-06',\n    name: 'Kybella (Submental Fat Dissolving)',\n    description: 'Injectable deoxycholic acid to permanently destroy fat cells under the chin.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 2,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['double chin', 'submental fat', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'per_session', min: 1200, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, numbness, difficulty swallowing (temporary).',\n    warnings: ['Requires 2-4 sessions'],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // FOUNDATIONAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'FND-01',\n    name: 'Mewing / Proper Tongue Posture',\n    description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 5,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['midfaceRatio', 'bigonialWidth', 'facialDepthToHeight'],\n    targetCategories: ['Midface/Face Shape', 'Jaw Shape', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['midface', 'palate', 'recession', 'jaw development'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n    cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n    risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n    warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-02',\n    name: 'Body Recomposition (Leanmaxxing)',\n    description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n    phase: 'Foundational',\n    baseImpact: 0.35,\n    coverage: 6,\n    percentage: '5-12%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['bigonialWidth', 'submentalCervicalAngle', 'cheekboneHeight'],\n    targetCategories: ['Jaw Shape', 'Neck', 'Midface/Face Shape'],\n    targetKeywords: ['soft jaw', 'undefined', 'round', 'facial definition'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n    risks_side_effects: 'None if done healthily.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-03',\n    name: 'Posture Correction',\n    description: 'Improving head and neck posture to optimize facial appearance and reduce forward head posture effects.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 3,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.2 },\n    targetMetrics: ['submentalCervicalAngle', 'anteriorFacialDepth'],\n    targetCategories: ['Neck', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['neck', 'posture', 'forward head'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 0, max: 100, currency: 'USD' },\n    risks_side_effects: 'None.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-04',\n    name: 'Skincare Routine (Retinoid + SPF)',\n    description: 'Medical-grade skincare to improve skin quality, texture, and reduce aging signs.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 2,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: [],\n    targetCategories: [],\n    targetKeywords: ['skin', 'texture', 'aging'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 26 },\n    cost: { type: 'per_month', min: 30, max: 150, currency: 'USD' },\n    risks_side_effects: 'Initial irritation, sun sensitivity.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-05',\n    name: 'Eyebrow Grooming / Microblading',\n    description: 'Professional shaping or semi-permanent tattooing to optimize eyebrow shape and position.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['eyebrowTilt', 'eyebrowLowSetedness', 'browLengthRatio'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['eyebrow', 'brow', 'upper third'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'flat', min: 20, max: 600, currency: 'USD' },\n    risks_side_effects: 'Minimal for grooming. Microblading: infection risk, color fading.',\n    warnings: [],\n    gender: 'both',\n  },\n];\n\n// Calculate relevance score based on multiple factors\nfunction calculateRelevanceScore(\n  proc: ProcedureConfig,\n  flaw: Flaw,\n  allFlaws: Flaw[]\n): number {\n  let score = 0;\n\n  // Check metric ID match (highest priority)\n  const metricId = flaw.responsibleRatios[0]?.ratioId || '';\n  if (proc.targetMetrics.includes(metricId)) {\n    score += 40;\n  }\n\n  // Check category match\n  if (proc.targetCategories.some(cat =>\n    flaw.categoryName.toLowerCase().includes(cat.toLowerCase()) ||\n    cat.toLowerCase().includes(flaw.categoryName.toLowerCase())\n  )) {\n    score += 25;\n  }\n\n  // Check keyword match\n  const flawLower = flaw.flawName.toLowerCase();\n  const summaryLower = flaw.summary.toLowerCase();\n  const matchedKeywords = proc.targetKeywords.filter(kw =>\n    flawLower.includes(kw.toLowerCase()) || summaryLower.includes(kw.toLowerCase())\n  );\n  score += matchedKeywords.length * 10;\n\n  // Adjust by flaw severity/impact\n  score += Math.min(flaw.harmonyPercentageLost * 3, 15);\n\n  // Bonus if this procedure addresses multiple flaws\n  const otherFlawsAddressed = allFlaws.filter(f =>\n    f.id !== flaw.id && (\n      proc.targetMetrics.includes(f.responsibleRatios[0]?.ratioId || '') ||\n      proc.targetCategories.some(cat => f.categoryName.toLowerCase().includes(cat.toLowerCase()))\n    )\n  );\n  score += otherFlawsAddressed.length * 5;\n\n  return Math.min(score, 100);\n}\n\nfunction generateRecommendations(flaws: Flaw[], frontRatios: Ratio[] = [], sideRatios: Ratio[] = []): Recommendation[] {\n  const recommendations: Recommendation[] = [];\n  const allRatios = [...frontRatios, ...sideRatios];\n\n  // Track which procedures have been added and their matched flaws\n  const procMatches: Map<string, { flaws: string[]; ratios: string[]; maxScore: number }> = new Map();\n\n  flaws.forEach(flaw => {\n    PROCEDURE_DATABASE.forEach(proc => {\n      const relevanceScore = calculateRelevanceScore(proc, flaw, flaws);\n\n      if (relevanceScore >= 25) {  // Minimum threshold\n        const existing = procMatches.get(proc.ref_id);\n        if (existing) {\n          existing.flaws.push(flaw.flawName);\n          existing.ratios.push(...flaw.responsibleRatios.map(r => r.ratioName));\n          existing.maxScore = Math.max(existing.maxScore, relevanceScore);\n        } else {\n          procMatches.set(proc.ref_id, {\n            flaws: [flaw.flawName],\n            ratios: flaw.responsibleRatios.map(r => r.ratioName),\n            maxScore: relevanceScore,\n          });\n        }\n      }\n    });\n  });\n\n  // Build recommendations from matched procedures\n  procMatches.forEach((match, procId) => {\n    const proc = PROCEDURE_DATABASE.find(p => p.ref_id === procId);\n    if (!proc) return;\n\n    // Calculate expected improvement based on severity of matched flaws\n    const matchedFlawDetails = flaws.filter(f => match.flaws.includes(f.flawName));\n    const avgImpact = matchedFlawDetails.reduce((sum, f) => sum + f.harmonyPercentageLost, 0) / matchedFlawDetails.length;\n    const severityMultiplier = Math.min(avgImpact / 3, 1.5);  // More severe = more potential improvement\n\n    // Get affected ratios from the actual data\n    const affectedRatios = allRatios.filter(r =>\n      proc.targetMetrics.includes(r.id) ||\n      match.flaws.some(f => f.toLowerCase().includes(r.category.toLowerCase()))\n    );\n\n    const adjustedImpact = proc.baseImpact * (0.8 + (match.maxScore / 500));  // Slight boost for high relevance\n\n    recommendations.push({\n      ref_id: proc.ref_id,\n      name: proc.name,\n      description: proc.description,\n      phase: proc.phase,\n      impact: adjustedImpact,\n      coverage: match.flaws.length + match.ratios.length,\n      percentage: proc.percentage,\n      expectedImprovementRange: {\n        min: proc.expectedImprovementRange.min * severityMultiplier,\n        max: proc.expectedImprovementRange.max * severityMultiplier,\n      },\n      matchedFlaws: [...new Set(match.flaws)],\n      matchedRatios: [...new Set(match.ratios)],\n      ratios_impacted: affectedRatios.map(r => ({\n        ratioId: r.id,\n        ratioName: r.name,\n        direction: 'both' as const,\n        percentageEffect: proc.baseImpact,\n      })),\n      timeline: proc.timeline,\n      cost: proc.cost,\n      risks_side_effects: proc.risks_side_effects,\n      warnings: proc.warnings,\n      gender: proc.gender,\n    });\n  });\n\n  // Sort by: phase priority (foundational first for accessibility), then impact\n  const phaseOrder: Record<string, number> = { 'Foundational': 1, 'Minimally Invasive': 2, 'Surgical': 3 };\n  return recommendations.sort((a, b) => {\n    // First sort by impact (higher = better)\n    const impactDiff = b.impact - a.impact;\n    if (Math.abs(impactDiff) > 0.1) return impactDiff;\n\n    // Then by coverage (more flaws addressed = better)\n    return b.coverage - a.coverage;\n  });\n}"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":3440,"cache_read_input_tokens":109424,"cache_creation":{"ephemeral_5m_input_tokens":3440,"ephemeral_1h_input_tokens":0},"output_tokens":9793,"service_tier":"standard"}},"requestId":"req_011CWJbxpLmezVQhKHuvh7mk","type":"assistant","uuid":"71ac5921-8f80-4fb3-a005-19d1939c074a","timestamp":"2025-12-20T20:56:15.139Z"}
{"parentUuid":"71ac5921-8f80-4fb3-a005-19d1939c074a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011FwEgxQ83ksP9LJJrubh7y","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   617→\n   618→  return flaws.sort((a, b) => b.harmonyPercentageLost - a.harmonyPercentageLost);\n   619→}\n   620→\n   621→// Comprehensive procedure database with metric-specific targeting\n   622→interface ProcedureConfig {\n   623→  ref_id: string;\n   624→  name: string;\n   625→  description: string;\n   626→  phase: 'Surgical' | 'Minimally Invasive' | 'Foundational';\n   627→  baseImpact: number;\n   628→  coverage: number;\n   629→  percentage: string;\n   630→  expectedImprovementRange: { min: number; max: number };\n   631→  targetMetrics: string[];  // Specific metric IDs this treatment addresses\n   632→  targetCategories: string[];  // Category names this treatment addresses\n   633→  targetKeywords: string[];  // Flaw name keywords to match\n   634→  timeline: { effect_start: 'immediate' | 'delayed' | 'gradual'; full_results_weeks: number; full_results_weeks_max?: number };\n   635→  cost: { type: 'flat' | 'per_session' | 'per_month'; min: number; max: number; currency: string };\n   636→  risks_side_effects: string;\n   637→  warnings: string[];\n   638→  gender: 'male' | 'female' | 'both';\n   639→}\n   640→\n   641→const PROCEDURE_DATABASE: ProcedureConfig[] = [\n   642→  // ==========================================\n   643→  // SURGICAL TREATMENTS\n   644→  // ==========================================\n   645→  {\n   646→    ref_id: 'SUR-01',\n   647→    name: 'Sliding Genioplasty',\n   648→    description: 'Chin bone repositioning surgery that can move the chin forward, backward, up, or down for optimal projection and facial balance.',\n   649→    phase: 'Surgical',\n   650→    baseImpact: 0.90,\n   651→    coverage: 8,\n   652→    percentage: '15-25%',\n   653→    expectedImprovementRange: { min: 0.5, max: 1.5 },\n   654→    targetMetrics: ['chinPhiltrumRatio', 'facialDepthToHeight', 'anteriorFacialDepth', 'nasomentaAngle'],\n   655→    targetCategories: ['Chin', 'Occlusion/Jaw Growth'],\n   656→    targetKeywords: ['chin', 'recessed', 'weak', 'short chin', 'long chin', 'pogonion'],\n   657→    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n   658→    cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n   659→    risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage, bone resorption.',\n   660→    warnings: [],\n   661→    gender: 'both',\n   662→  },\n   663→  {\n   664→    ref_id: 'SUR-02',\n   665→    name: 'Reduction Rhinoplasty',\n   666→    description: 'Surgical reduction of nose size, hump removal, and tip refinement to improve nasal proportions.',\n   667→    phase: 'Surgical',\n   668→    baseImpact: 0.85,\n   669→    coverage: 6,\n   670→    percentage: '10-20%',\n   671→    expectedImprovementRange: { min: 0.5, max: 1.0 },\n   672→    targetMetrics: ['nasalIndex', 'nasofrontalAngle', 'nasofacialAngle', 'nasomentaAngle', 'intercanthalNasalRatio', 'noseBridgeWidth'],\n   673→    targetCategories: ['Nose'],\n   674→    targetKeywords: ['wide nose', 'large nose', 'dorsal hump', 'bulbous', 'nasal', 'nose bridge'],\n   675→    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n   676→    cost: { type: 'flat', min: 7000, max: 20000, currency: 'USD' },\n   677→    risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n   678→    warnings: [],\n   679→    gender: 'both',\n   680→  },\n   681→  {\n   682→    ref_id: 'SUR-03',\n   683→    name: 'Jaw Angle Implants',\n   684→    description: 'Custom or standard silicone/PEEK implants to enhance jaw width, definition, and angularity.',\n   685→    phase: 'Surgical',\n   686→    baseImpact: 0.80,\n   687→    coverage: 5,\n   688→    percentage: '10-15%',\n   689→    expectedImprovementRange: { min: 0.4, max: 1.0 },\n   690→    targetMetrics: ['bigonialWidth', 'jawFrontalAngle', 'jawWidthRatio', 'jawSlope', 'gonialAngle'],\n   691→    targetCategories: ['Jaw Shape'],\n   692→    targetKeywords: ['narrow jaw', 'weak jaw', 'soft jaw', 'jaw angle', 'gonial', 'mandible'],\n   693→    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n   694→    cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n   695→    risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection, bone erosion.',\n   696→    warnings: [],\n   697→    gender: 'both',\n   698→  },\n   699→  {\n   700→    ref_id: 'SUR-04',\n   701→    name: 'Bimaxillary Osteotomy (Bimax)',\n   702→    description: 'Double jaw surgery to reposition both upper and lower jaws for optimal occlusion and facial balance.',\n   703→    phase: 'Surgical',\n   704→    baseImpact: 0.95,\n   705→    coverage: 12,\n   706→    percentage: '20-35%',\n   707→    expectedImprovementRange: { min: 1.0, max: 2.0 },\n   708→    targetMetrics: ['midfaceRatio', 'facialDepthToHeight', 'mandibularPlaneAngle', 'lowerThirdProportion', 'nasofacialAngle'],\n   709→    targetCategories: ['Occlusion/Jaw Growth', 'Midface/Face Shape'],\n   710→    targetKeywords: ['maxillary recession', 'mandibular', 'hyper-divergent', 'bite', 'occlusion', 'midface recession'],\n   711→    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n   712→    cost: { type: 'flat', min: 20000, max: 60000, currency: 'USD' },\n   713→    risks_side_effects: 'Extended recovery, numbness (temporary to permanent), dietary restrictions.',\n   714→    warnings: ['Major surgery - requires orthodontic preparation'],\n   715→    gender: 'both',\n   716→  },\n   717→  {\n   718→    ref_id: 'SUR-05',\n   719→    name: 'Canthoplasty',\n   720→    description: 'Surgical eye corner modification to improve canthal tilt and eye shape.',\n   721→    phase: 'Surgical',\n   722→    baseImpact: 0.75,\n   723→    coverage: 3,\n   724→    percentage: '8-15%',\n   725→    expectedImprovementRange: { min: 0.3, max: 0.8 },\n   726→    targetMetrics: ['lateralCanthalTilt', 'eyeAspectRatio'],\n   727→    targetCategories: ['Eyes'],\n   728→    targetKeywords: ['canthal tilt', 'negative tilt', 'drooping eyes', 'eye shape', 'eye angle'],\n   729→    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n   730→    cost: { type: 'flat', min: 4000, max: 12000, currency: 'USD' },\n   731→    risks_side_effects: 'Scarring, asymmetry, dry eyes, ectropion.',\n   732→    warnings: ['Difficult to reverse'],\n   733→    gender: 'both',\n   734→  },\n   735→  {\n   736→    ref_id: 'SUR-06',\n   737→    name: 'Cheek/Malar Implants',\n   738→    description: 'Solid implants placed over the cheekbones to enhance midface projection and width.',\n   739→    phase: 'Surgical',\n   740→    baseImpact: 0.75,\n   741→    coverage: 4,\n   742→    percentage: '10-18%',\n   743→    expectedImprovementRange: { min: 0.4, max: 0.9 },\n   744→    targetMetrics: ['cheekboneHeight', 'midfaceRatio', 'totalFacialWidthToHeight'],\n   745→    targetCategories: ['Midface/Face Shape'],\n   746→    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface', 'zygomatic', 'malar'],\n   747→    timeline: { effect_start: 'delayed', full_results_weeks: 6, full_results_weeks_max: 12 },\n   748→    cost: { type: 'flat', min: 6000, max: 15000, currency: 'USD' },\n   749→    risks_side_effects: 'Swelling, asymmetry, implant shifting, nerve damage.',\n   750→    warnings: [],\n   751→    gender: 'both',\n   752→  },\n   753→  {\n   754→    ref_id: 'SUR-07',\n   755→    name: 'Neck Liposuction / Submentoplasty',\n   756→    description: 'Fat removal and skin tightening under the chin and neck area.',\n   757→    phase: 'Surgical',\n   758→    baseImpact: 0.65,\n   759→    coverage: 3,\n   760→    percentage: '8-12%',\n   761→    expectedImprovementRange: { min: 0.3, max: 0.7 },\n   762→    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n   763→    targetCategories: ['Neck'],\n   764→    targetKeywords: ['round neck', 'double chin', 'submental', 'cervical', 'neck definition'],\n   765→    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n   766→    cost: { type: 'flat', min: 3000, max: 8000, currency: 'USD' },\n   767→    risks_side_effects: 'Swelling, bruising, skin irregularity, numbness.',\n   768→    warnings: [],\n   769→    gender: 'both',\n   770→  },\n   771→  {\n   772→    ref_id: 'SUR-08',\n   773→    name: 'Brow Bone Reduction/Augmentation',\n   774→    description: 'Surgical reshaping of the brow ridge for improved upper third harmony.',\n   775→    phase: 'Surgical',\n   776→    baseImpact: 0.70,\n   777→    coverage: 3,\n   778→    percentage: '8-15%',\n   779→    expectedImprovementRange: { min: 0.3, max: 0.7 },\n   780→    targetMetrics: ['nasofrontalAngle', 'bitemporalWidth', 'upperThirdProportion'],\n   781→    targetCategories: ['Upper Third'],\n   782→    targetKeywords: ['brow ridge', 'forehead', 'nasofrontal', 'upper third', 'glabella'],\n   783→    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n   784→    cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n   785→    risks_side_effects: 'Swelling, numbness, scarring (if coronal incision).',\n   786→    warnings: [],\n   787→    gender: 'both',\n   788→  },\n   789→\n   790→  // ==========================================\n   791→  // MINIMALLY INVASIVE TREATMENTS\n   792→  // ==========================================\n   793→  {\n   794→    ref_id: 'MIN-01',\n   795→    name: 'Chin/Jawline Filler',\n   796→    description: 'Hyaluronic acid injections to enhance chin projection and jawline definition. Reversible and temporary.',\n   797→    phase: 'Minimally Invasive',\n   798→    baseImpact: 0.45,\n   799→    coverage: 4,\n   800→    percentage: '5-10%',\n   801→    expectedImprovementRange: { min: 0.2, max: 0.5 },\n   802→    targetMetrics: ['chinPhiltrumRatio', 'jawFrontalAngle', 'bigonialWidth'],\n   803→    targetCategories: ['Chin', 'Jaw Shape'],\n   804→    targetKeywords: ['weak chin', 'recessed chin', 'soft jaw', 'jawline'],\n   805→    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n   806→    cost: { type: 'per_session', min: 800, max: 2500, currency: 'USD' },\n   807→    risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n   808→    warnings: ['Results temporary (12-18 months)', 'Requires maintenance'],\n   809→    gender: 'both',\n   810→  },\n   811→  {\n   812→    ref_id: 'MIN-02',\n   813→    name: 'Cheek Filler',\n   814→    description: 'HA filler to enhance cheekbone projection and midface volume.',\n   815→    phase: 'Minimally Invasive',\n   816→    baseImpact: 0.40,\n   817→    coverage: 3,\n   818→    percentage: '5-8%',\n   819→    expectedImprovementRange: { min: 0.2, max: 0.4 },\n   820→    targetMetrics: ['cheekboneHeight', 'midfaceRatio'],\n   821→    targetCategories: ['Midface/Face Shape'],\n   822→    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface volume'],\n   823→    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n   824→    cost: { type: 'per_session', min: 600, max: 1800, currency: 'USD' },\n   825→    risks_side_effects: 'Bruising, swelling, asymmetry.',\n   826→    warnings: ['Results temporary (12-18 months)'],\n   827→    gender: 'both',\n   828→  },\n   829→  {\n   830→    ref_id: 'MIN-03',\n   831→    name: 'Lip Filler',\n   832→    description: 'Hyaluronic acid to enhance lip volume and proportions.',\n   833→    phase: 'Minimally Invasive',\n   834→    baseImpact: 0.35,\n   835→    coverage: 2,\n   836→    percentage: '3-6%',\n   837→    expectedImprovementRange: { min: 0.1, max: 0.3 },\n   838→    targetMetrics: ['lowerUpperLipRatio', 'mouthNoseWidthRatio'],\n   839→    targetCategories: ['Lips'],\n   840→    targetKeywords: ['thin lip', 'lip ratio', 'lip volume', 'upper lip', 'lower lip'],\n   841→    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n   842→    cost: { type: 'per_session', min: 400, max: 1200, currency: 'USD' },\n   843→    risks_side_effects: 'Bruising, swelling, lumps.',\n   844→    warnings: ['Results temporary (6-12 months)'],\n   845→    gender: 'both',\n   846→  },\n   847→  {\n   848→    ref_id: 'MIN-04',\n   849→    name: 'PDO Thread Lift',\n   850→    description: 'Dissolvable threads to lift and tighten skin, particularly for canthal tilt improvement.',\n   851→    phase: 'Minimally Invasive',\n   852→    baseImpact: 0.35,\n   853→    coverage: 3,\n   854→    percentage: '4-8%',\n   855→    expectedImprovementRange: { min: 0.1, max: 0.4 },\n   856→    targetMetrics: ['lateralCanthalTilt', 'eyebrowLowSetedness'],\n   857→    targetCategories: ['Eyes', 'Upper Third'],\n   858→    targetKeywords: ['canthal tilt', 'drooping', 'sagging', 'eyebrow position'],\n   859→    timeline: { effect_start: 'immediate', full_results_weeks: 4, full_results_weeks_max: 12 },\n   860→    cost: { type: 'per_session', min: 1500, max: 4000, currency: 'USD' },\n   861→    risks_side_effects: 'Bruising, asymmetry, thread visibility, infection.',\n   862→    warnings: ['Results temporary (12-18 months)'],\n   863→    gender: 'both',\n   864→  },\n   865→  {\n   866→    ref_id: 'MIN-05',\n   867→    name: 'Masseter Botox',\n   868→    description: 'Botulinum toxin to slim the lower face by relaxing masseter muscles.',\n   869→    phase: 'Minimally Invasive',\n   870→    baseImpact: 0.40,\n   871→    coverage: 2,\n   872→    percentage: '4-8%',\n   873→    expectedImprovementRange: { min: 0.2, max: 0.4 },\n   874→    targetMetrics: ['bigonialWidth', 'jawWidthRatio', 'faceWidthToHeight'],\n   875→    targetCategories: ['Jaw Shape', 'Midface/Face Shape'],\n   876→    targetKeywords: ['wide jaw', 'square jaw', 'masseter', 'bruxism'],\n   877→    timeline: { effect_start: 'delayed', full_results_weeks: 4, full_results_weeks_max: 12 },\n   878→    cost: { type: 'per_session', min: 400, max: 1000, currency: 'USD' },\n   879→    risks_side_effects: 'Temporary weakness, asymmetry, difficulty chewing.',\n   880→    warnings: ['Results temporary (4-6 months)', 'Requires regular maintenance'],\n   881→    gender: 'both',\n   882→  },\n   883→  {\n   884→    ref_id: 'MIN-06',\n   885→    name: 'Kybella (Submental Fat Dissolving)',\n   886→    description: 'Injectable deoxycholic acid to permanently destroy fat cells under the chin.',\n   887→    phase: 'Minimally Invasive',\n   888→    baseImpact: 0.45,\n   889→    coverage: 2,\n   890→    percentage: '5-10%',\n   891→    expectedImprovementRange: { min: 0.2, max: 0.5 },\n   892→    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n   893→    targetCategories: ['Neck'],\n   894→    targetKeywords: ['double chin', 'submental fat', 'neck definition'],\n   895→    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n   896→    cost: { type: 'per_session', min: 1200, max: 1800, currency: 'USD' },\n   897→    risks_side_effects: 'Swelling, bruising, numbness, difficulty swallowing (temporary).',\n   898→    warnings: ['Requires 2-4 sessions'],\n   899→    gender: 'both',\n   900→  },\n   901→\n   902→  // ==========================================\n   903→  // FOUNDATIONAL TREATMENTS\n   904→  // ==========================================\n   905→  {\n   906→    ref_id: 'FND-01',\n   907→    name: 'Mewing / Proper Tongue Posture',\n   908→    description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n   909→    phase: 'Foundational',\n   910→    baseImpact: 0.25,\n   911→    coverage: 5,\n   912→    percentage: '2-5%',\n   913→    expectedImprovementRange: { min: 0.1, max: 0.3 },\n   914→    targetMetrics: ['midfaceRatio', 'bigonialWidth', 'facialDepthToHeight'],\n   915→    targetCategories: ['Midface/Face Shape', 'Jaw Shape', 'Occlusion/Jaw Growth'],\n   916→    targetKeywords: ['midface', 'palate', 'recession', 'jaw development'],\n   917→    timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n   918→    cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n   919→    risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n   920→    warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n   921→    gender: 'both',\n   922→  },\n   923→  {\n   924→    ref_id: 'FND-02',\n   925→    name: 'Body Recomposition (Leanmaxxing)',\n   926→    description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n   927→    phase: 'Foundational',\n   928→    baseImpact: 0.35,\n   929→    coverage: 6,\n   930→    percentage: '5-12%',\n   931→    expectedImprovementRange: { min: 0.2, max: 0.5 },\n   932→    targetMetrics: ['bigonialWidth', 'submentalCervicalAngle', 'cheekboneHeight'],\n   933→    targetCategories: ['Jaw Shape', 'Neck', 'Midface/Face Shape'],\n   934→    targetKeywords: ['soft jaw', 'undefined', 'round', 'facial definition'],\n   935→    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n   936→    cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n   937→    risks_side_effects: 'None if done healthily.',\n   938→    warnings: [],\n   939→    gender: 'both',\n   940→  },\n   941→  {\n   942→    ref_id: 'FND-03',\n   943→    name: 'Posture Correction',\n   944→    description: 'Improving head and neck posture to optimize facial appearance and reduce forward head posture effects.',\n   945→    phase: 'Foundational',\n   946→    baseImpact: 0.20,\n   947→    coverage: 3,\n   948→    percentage: '2-5%',\n   949→    expectedImprovementRange: { min: 0.1, max: 0.2 },\n   950→    targetMetrics: ['submentalCervicalAngle', 'anteriorFacialDepth'],\n   951→    targetCategories: ['Neck', 'Occlusion/Jaw Growth'],\n   952→    targetKeywords: ['neck', 'posture', 'forward head'],\n   953→    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n   954→    cost: { type: 'flat', min: 0, max: 100, currency: 'USD' },\n   955→    risks_side_effects: 'None.',\n   956→    warnings: [],\n   957→    gender: 'both',\n   958→  },\n   959→  {\n   960→    ref_id: 'FND-04',\n   961→    name: 'Skincare Routine (Retinoid + SPF)',\n   962→    description: 'Medical-grade skincare to improve skin quality, texture, and reduce aging signs.',\n   963→    phase: 'Foundational',\n   964→    baseImpact: 0.20,\n   965→    coverage: 2,\n   966→    percentage: '2-5%',\n   967→    expectedImprovementRange: { min: 0.1, max: 0.3 },\n   968→    targetMetrics: [],\n   969→    targetCategories: [],\n   970→    targetKeywords: ['skin', 'texture', 'aging'],\n   971→    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 26 },\n   972→    cost: { type: 'per_month', min: 30, max: 150, currency: 'USD' },\n   973→    risks_side_effects: 'Initial irritation, sun sensitivity.',\n   974→    warnings: [],\n   975→    gender: 'both',\n   976→  },\n   977→  {\n   978→    ref_id: 'FND-05',\n   979→    name: 'Eyebrow Grooming / Microblading',\n   980→    description: 'Professional shaping or semi-permanent tattooing to optimize eyebrow shape and position.',\n   981→    phase: 'Foundational',\n   982→    baseImpact: 0.25,\n   983→    coverage: 2,\n   984→    percentage: '3-6%',\n   985→    expectedImprovementRange: { min: 0.1, max: 0.3 },\n   986→    targetMetrics: ['eyebrowTilt', 'eyebrowLowSetedness', 'browLengthRatio'],\n   987→    targetCategories: ['Upper Third'],\n   988→    targetKeywords: ['eyebrow', 'brow', 'upper third'],\n   989→    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n   990→    cost: { type: 'flat', min: 20, max: 600, currency: 'USD' },\n   991→    risks_side_effects: 'Minimal for grooming. Microblading: infection risk, color fading.',\n   992→    warnings: [],\n   993→    gender: 'both',\n   994→  },\n   995→];\n   996→\n   997→// Calculate relevance score based on multiple factors\n   998→function calculateRelevanceScore(\n   999→  proc: ProcedureConfig,\n  1000→  flaw: Flaw,\n  1001→  allFlaws: Flaw[]\n  1002→): number {\n  1003→  let score = 0;\n  1004→\n  1005→  // Check metric ID match (highest priority)\n  1006→  const metricId = flaw.responsibleRatios[0]?.ratioId || '';\n  1007→  if (proc.targetMetrics.includes(metricId)) {\n  1008→    score += 40;\n  1009→  }\n  1010→\n  1011→  // Check category match\n  1012→  if (proc.targetCategories.some(cat =>\n  1013→    flaw.categoryName.toLowerCase().includes(cat.toLowerCase()) ||\n  1014→    cat.toLowerCase().includes(flaw.categoryName.toLowerCase())\n  1015→  )) {\n  1016→    score += 25;\n  1017→  }\n  1018→\n  1019→  // Check keyword match\n  1020→  const flawLower = flaw.flawName.toLowerCase();\n  1021→  const summaryLower = flaw.summary.toLowerCase();\n  1022→  const matchedKeywords = proc.targetKeywords.filter(kw =>\n  1023→    flawLower.includes(kw.toLowerCase()) || summaryLower.includes(kw.toLowerCase())\n  1024→  );\n  1025→  score += matchedKeywords.length * 10;\n  1026→\n  1027→  // Adjust by flaw severity/impact\n  1028→  score += Math.min(flaw.harmonyPercentageLost * 3, 15);\n  1029→\n  1030→  // Bonus if this procedure addresses multiple flaws\n  1031→  const otherFlawsAddressed = allFlaws.filter(f =>\n  1032→    f.id !== flaw.id && (\n  1033→      proc.targetMetrics.includes(f.responsibleRatios[0]?.ratioId || '') ||\n  1034→      proc.targetCategories.some(cat => f.categoryName.toLowerCase().includes(cat.toLowerCase()))\n  1035→    )\n  1036→  );\n  1037→  score += otherFlawsAddressed.length * 5;\n  1038→\n  1039→  return Math.min(score, 100);\n  1040→}\n  1041→\n  1042→function generateRecommendations(flaws: Flaw[], frontRatios: Ratio[] = [], sideRatios: Ratio[] = []): Recommendation[] {\n  1043→  const recommendations: Recommendation[] = [];\n  1044→  const allRatios = [...frontRatios, ...sideRatios];\n  1045→\n  1046→  // Track which procedures have been added and their matched flaws\n  1047→  const procMatches: Map<string, { flaws: string[]; ratios: string[]; maxScore: number }> = new Map();\n  1048→\n  1049→  flaws.forEach(flaw => {\n  1050→    PROCEDURE_DATABASE.forEach(proc => {\n  1051→      const relevanceScore = calculateRelevanceScore(proc, flaw, flaws);\n  1052→\n  1053→      if (relevanceScore >= 25) {  // Minimum threshold\n  1054→        const existing = procMatches.get(proc.ref_id);\n  1055→        if (existing) {\n  1056→          existing.flaws.push(flaw.flawName);\n  1057→          existing.ratios.push(...flaw.responsibleRatios.map(r => r.ratioName));\n  1058→          existing.maxScore = Math.max(existing.maxScore, relevanceScore);\n  1059→        } else {\n  1060→          procMatches.set(proc.ref_id, {\n  1061→            flaws: [flaw.flawName],\n  1062→            ratios: flaw.responsibleRatios.map(r => r.ratioName),\n  1063→            maxScore: relevanceScore,\n  1064→          });\n  1065→        }\n  1066→      }\n  1067→    });\n  1068→  });\n  1069→\n  1070→  // Build recommendations from matched procedures\n  1071→  procMatches.forEach((match, procId) => {\n  1072→    const proc = PROCEDURE_DATABASE.find(p => p.ref_id === procId);\n  1073→    if (!proc) return;\n  1074→\n  1075→    // Calculate expected improvement based on severity of matched flaws\n  1076→    const matchedFlawDetails = flaws.filter(f => match.flaws.includes(f.flawName));\n  1077→    const avgImpact = matchedFlawDetails.reduce((sum, f) => sum + f.harmonyPercentageLost, 0) / matchedFlawDetails.length;\n  1078→    const severityMultiplier = Math.min(avgImpact / 3, 1.5);  // More severe = more potential improvement\n  1079→\n  1080→    // Get affected ratios from the actual data\n  1081→    const affectedRatios = allRatios.filter(r =>\n  1082→      proc.targetMetrics.includes(r.id) ||\n  1083→      match.flaws.some(f => f.toLowerCase().includes(r.category.toLowerCase()))\n  1084→    );\n  1085→\n  1086→    const adjustedImpact = proc.baseImpact * (0.8 + (match.maxScore / 500));  // Slight boost for high relevance\n  1087→\n  1088→    recommendations.push({\n  1089→      ref_id: proc.ref_id,\n  1090→      name: proc.name,\n  1091→      description: proc.description,\n  1092→      phase: proc.phase,\n  1093→      impact: adjustedImpact,\n  1094→      coverage: match.flaws.length + match.ratios.length,\n  1095→      percentage: proc.percentage,\n  1096→      expectedImprovementRange: {\n  1097→        min: proc.expectedImprovementRange.min * severityMultiplier,\n  1098→        max: proc.expectedImprovementRange.max * severityMultiplier,\n  1099→      },\n  1100→      matchedFlaws: [...new Set(match.flaws)],\n  1101→      matchedRatios: [...new Set(match.ratios)],\n  1102→      ratios_impacted: affectedRatios.map(r => ({\n  1103→        ratioId: r.id,\n  1104→        ratioName: r.name,\n  1105→        direction: 'both' as const,\n  1106→        percentageEffect: proc.baseImpact,\n  1107→      })),\n  1108→      timeline: proc.timeline,\n  1109→      cost: proc.cost,\n  1110→      risks_side_effects: proc.risks_side_effects,\n  1111→      warnings: proc.warnings,\n  1112→      gender: proc.gender,\n  1113→    });\n  1114→  });\n  1115→\n  1116→  // Sort by: phase priority (foundational first for accessibility), then impact\n  1117→  const phaseOrder: Record<string, number> = { 'Foundational': 1, 'Minimally Invasive': 2, 'Surgical': 3 };\n  1118→  return recommendations.sort((a, b) => {\n  1119→    // First sort by impact (higher = better)\n  1120→    const impactDiff = b.impact - a.impact;\n  1121→    if (Math.abs(impactDiff) > 0.1) return impactDiff;\n  1122→\n  1123→    // Then by coverage (more flaws addressed = better)\n  1124→    return b.coverage - a.coverage;\n  1125→  });\n  1126→}\n  1127→\n  1128→// ============================================\n  1129→// CONTEXT CREATION\n  1130→// ============================================"}]},"uuid":"786b3a2d-92d8-4b40-b176-59d0f93231c8","timestamp":"2025-12-20T20:56:15.187Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","oldString":"function generateRecommendations(flaws: Flaw[]): Recommendation[] {\n  // Generate recommendations based on detected flaws\n  const recommendations: Recommendation[] = [];\n\n  const procedureDatabase: Array<Omit<Recommendation, 'matchedFlaws' | 'matchedRatios' | 'ratios_impacted'> & { targetFlaws: string[] }> = [\n    {\n      ref_id: 'SUR-01',\n      name: 'Genioplasty',\n      description: 'Surgical chin repositioning to improve chin projection and facial harmony. Can move the chin forward, backward, up, or down.',\n      phase: 'Surgical',\n      impact: 0.85,\n      coverage: 8,\n      percentage: '15-25%',\n      expectedImprovementRange: { min: 0.5, max: 1.5 },\n      targetFlaws: ['Weak chin', 'Recessed chin', 'Short chin', 'chin'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n      cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n      risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'SUR-02',\n      name: 'Rhinoplasty',\n      description: 'Nose reshaping surgery to improve nasal proportions, reduce or increase size, change angle, or correct breathing issues.',\n      phase: 'Surgical',\n      impact: 0.8,\n      coverage: 6,\n      percentage: '10-20%',\n      targetFlaws: ['Wide nose', 'Long nose', 'Crooked nose', 'nose', 'nasal'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n      cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n      risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'SUR-03',\n      name: 'Jaw Implants',\n      description: 'Custom or standard implants to enhance jaw width and definition. Creates a more angular, masculine jawline.',\n      phase: 'Surgical',\n      impact: 0.75,\n      coverage: 5,\n      percentage: '10-15%',\n      targetFlaws: ['Narrow jaw', 'Weak jaw', 'jaw'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n      cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n      risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'MIN-01',\n      name: 'Dermal Fillers',\n      description: 'Hyaluronic acid injections to add volume to chin, jawline, or cheeks. Non-permanent and reversible.',\n      phase: 'Minimally Invasive',\n      impact: 0.4,\n      coverage: 4,\n      percentage: '5-10%',\n      targetFlaws: ['Weak chin', 'Flat cheeks', 'chin', 'midface'],\n      timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n      cost: { type: 'per_session', min: 600, max: 2000, currency: 'USD' },\n      risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n      warnings: ['Results temporary (6-18 months)'],\n      gender: 'both',\n    },\n    {\n      ref_id: 'MIN-02',\n      name: 'Orthodontic Treatment',\n      description: 'Braces or clear aligners to correct bite alignment and tooth positioning. Can impact facial profile over time.',\n      phase: 'Minimally Invasive',\n      impact: 0.5,\n      coverage: 3,\n      percentage: '5-15%',\n      targetFlaws: ['Bite issues', 'Midface recession', 'jaw'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 52, full_results_weeks_max: 104 },\n      cost: { type: 'flat', min: 3000, max: 10000, currency: 'USD' },\n      risks_side_effects: 'Temporary discomfort, requires compliance.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'FND-01',\n      name: 'Mewing / Proper Tongue Posture',\n      description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n      phase: 'Foundational',\n      impact: 0.2,\n      coverage: 4,\n      percentage: '2-5%',\n      targetFlaws: ['Midface recession', 'Narrow palate', 'jaw', 'midface'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n      cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n      risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n      warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n      gender: 'both',\n    },\n    {\n      ref_id: 'FND-02',\n      name: 'Body Recomposition',\n      description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n      phase: 'Foundational',\n      impact: 0.3,\n      coverage: 6,\n      percentage: '5-10%',\n      targetFlaws: ['Undefined jawline', 'Soft features', 'jaw', 'face'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n      cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n      risks_side_effects: 'None if done healthily.',\n      warnings: [],\n      gender: 'both',\n    },\n  ];\n\n  flaws.forEach(flaw => {\n    procedureDatabase.forEach(proc => {\n      const flawLower = flaw.flawName.toLowerCase();\n      const matches = proc.targetFlaws.some(target =>\n        flawLower.includes(target.toLowerCase()) || target.toLowerCase().includes(flawLower)\n      );\n\n      if (matches && !recommendations.find(r => r.ref_id === proc.ref_id)) {\n        recommendations.push({\n          ...proc,\n          matchedFlaws: [flaw.flawName],\n          matchedRatios: flaw.responsibleRatios.map(r => r.ratioName),\n          ratios_impacted: flaw.responsibleRatios.map(r => ({\n            ratioId: r.ratioId,\n            ratioName: r.ratioName,\n            direction: 'both' as const,\n            percentageEffect: 1.0,\n          })),\n        });\n      }\n    });\n  });\n\n  return recommendations.sort((a, b) => b.impact - a.impact);\n}","newString":"// Comprehensive procedure database with metric-specific targeting\ninterface ProcedureConfig {\n  ref_id: string;\n  name: string;\n  description: string;\n  phase: 'Surgical' | 'Minimally Invasive' | 'Foundational';\n  baseImpact: number;\n  coverage: number;\n  percentage: string;\n  expectedImprovementRange: { min: number; max: number };\n  targetMetrics: string[];  // Specific metric IDs this treatment addresses\n  targetCategories: string[];  // Category names this treatment addresses\n  targetKeywords: string[];  // Flaw name keywords to match\n  timeline: { effect_start: 'immediate' | 'delayed' | 'gradual'; full_results_weeks: number; full_results_weeks_max?: number };\n  cost: { type: 'flat' | 'per_session' | 'per_month'; min: number; max: number; currency: string };\n  risks_side_effects: string;\n  warnings: string[];\n  gender: 'male' | 'female' | 'both';\n}\n\nconst PROCEDURE_DATABASE: ProcedureConfig[] = [\n  // ==========================================\n  // SURGICAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'SUR-01',\n    name: 'Sliding Genioplasty',\n    description: 'Chin bone repositioning surgery that can move the chin forward, backward, up, or down for optimal projection and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.90,\n    coverage: 8,\n    percentage: '15-25%',\n    expectedImprovementRange: { min: 0.5, max: 1.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'facialDepthToHeight', 'anteriorFacialDepth', 'nasomentaAngle'],\n    targetCategories: ['Chin', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['chin', 'recessed', 'weak', 'short chin', 'long chin', 'pogonion'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage, bone resorption.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-02',\n    name: 'Reduction Rhinoplasty',\n    description: 'Surgical reduction of nose size, hump removal, and tip refinement to improve nasal proportions.',\n    phase: 'Surgical',\n    baseImpact: 0.85,\n    coverage: 6,\n    percentage: '10-20%',\n    expectedImprovementRange: { min: 0.5, max: 1.0 },\n    targetMetrics: ['nasalIndex', 'nasofrontalAngle', 'nasofacialAngle', 'nasomentaAngle', 'intercanthalNasalRatio', 'noseBridgeWidth'],\n    targetCategories: ['Nose'],\n    targetKeywords: ['wide nose', 'large nose', 'dorsal hump', 'bulbous', 'nasal', 'nose bridge'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 7000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-03',\n    name: 'Jaw Angle Implants',\n    description: 'Custom or standard silicone/PEEK implants to enhance jaw width, definition, and angularity.',\n    phase: 'Surgical',\n    baseImpact: 0.80,\n    coverage: 5,\n    percentage: '10-15%',\n    expectedImprovementRange: { min: 0.4, max: 1.0 },\n    targetMetrics: ['bigonialWidth', 'jawFrontalAngle', 'jawWidthRatio', 'jawSlope', 'gonialAngle'],\n    targetCategories: ['Jaw Shape'],\n    targetKeywords: ['narrow jaw', 'weak jaw', 'soft jaw', 'jaw angle', 'gonial', 'mandible'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection, bone erosion.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-04',\n    name: 'Bimaxillary Osteotomy (Bimax)',\n    description: 'Double jaw surgery to reposition both upper and lower jaws for optimal occlusion and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.95,\n    coverage: 12,\n    percentage: '20-35%',\n    expectedImprovementRange: { min: 1.0, max: 2.0 },\n    targetMetrics: ['midfaceRatio', 'facialDepthToHeight', 'mandibularPlaneAngle', 'lowerThirdProportion', 'nasofacialAngle'],\n    targetCategories: ['Occlusion/Jaw Growth', 'Midface/Face Shape'],\n    targetKeywords: ['maxillary recession', 'mandibular', 'hyper-divergent', 'bite', 'occlusion', 'midface recession'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 20000, max: 60000, currency: 'USD' },\n    risks_side_effects: 'Extended recovery, numbness (temporary to permanent), dietary restrictions.',\n    warnings: ['Major surgery - requires orthodontic preparation'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-05',\n    name: 'Canthoplasty',\n    description: 'Surgical eye corner modification to improve canthal tilt and eye shape.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.8 },\n    targetMetrics: ['lateralCanthalTilt', 'eyeAspectRatio'],\n    targetCategories: ['Eyes'],\n    targetKeywords: ['canthal tilt', 'negative tilt', 'drooping eyes', 'eye shape', 'eye angle'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 4000, max: 12000, currency: 'USD' },\n    risks_side_effects: 'Scarring, asymmetry, dry eyes, ectropion.',\n    warnings: ['Difficult to reverse'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-06',\n    name: 'Cheek/Malar Implants',\n    description: 'Solid implants placed over the cheekbones to enhance midface projection and width.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 4,\n    percentage: '10-18%',\n    expectedImprovementRange: { min: 0.4, max: 0.9 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio', 'totalFacialWidthToHeight'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface', 'zygomatic', 'malar'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 6, full_results_weeks_max: 12 },\n    cost: { type: 'flat', min: 6000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry, implant shifting, nerve damage.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-07',\n    name: 'Neck Liposuction / Submentoplasty',\n    description: 'Fat removal and skin tightening under the chin and neck area.',\n    phase: 'Surgical',\n    baseImpact: 0.65,\n    coverage: 3,\n    percentage: '8-12%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['round neck', 'double chin', 'submental', 'cervical', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 3000, max: 8000, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, skin irregularity, numbness.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-08',\n    name: 'Brow Bone Reduction/Augmentation',\n    description: 'Surgical reshaping of the brow ridge for improved upper third harmony.',\n    phase: 'Surgical',\n    baseImpact: 0.70,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['nasofrontalAngle', 'bitemporalWidth', 'upperThirdProportion'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['brow ridge', 'forehead', 'nasofrontal', 'upper third', 'glabella'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling, numbness, scarring (if coronal incision).',\n    warnings: [],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // MINIMALLY INVASIVE TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'MIN-01',\n    name: 'Chin/Jawline Filler',\n    description: 'Hyaluronic acid injections to enhance chin projection and jawline definition. Reversible and temporary.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 4,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'jawFrontalAngle', 'bigonialWidth'],\n    targetCategories: ['Chin', 'Jaw Shape'],\n    targetKeywords: ['weak chin', 'recessed chin', 'soft jaw', 'jawline'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 800, max: 2500, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n    warnings: ['Results temporary (12-18 months)', 'Requires maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-02',\n    name: 'Cheek Filler',\n    description: 'HA filler to enhance cheekbone projection and midface volume.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 3,\n    percentage: '5-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface volume'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 600, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, asymmetry.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-03',\n    name: 'Lip Filler',\n    description: 'Hyaluronic acid to enhance lip volume and proportions.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['lowerUpperLipRatio', 'mouthNoseWidthRatio'],\n    targetCategories: ['Lips'],\n    targetKeywords: ['thin lip', 'lip ratio', 'lip volume', 'upper lip', 'lower lip'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 400, max: 1200, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, lumps.',\n    warnings: ['Results temporary (6-12 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-04',\n    name: 'PDO Thread Lift',\n    description: 'Dissolvable threads to lift and tighten skin, particularly for canthal tilt improvement.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 3,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.1, max: 0.4 },\n    targetMetrics: ['lateralCanthalTilt', 'eyebrowLowSetedness'],\n    targetCategories: ['Eyes', 'Upper Third'],\n    targetKeywords: ['canthal tilt', 'drooping', 'sagging', 'eyebrow position'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 1500, max: 4000, currency: 'USD' },\n    risks_side_effects: 'Bruising, asymmetry, thread visibility, infection.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-05',\n    name: 'Masseter Botox',\n    description: 'Botulinum toxin to slim the lower face by relaxing masseter muscles.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 2,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['bigonialWidth', 'jawWidthRatio', 'faceWidthToHeight'],\n    targetCategories: ['Jaw Shape', 'Midface/Face Shape'],\n    targetKeywords: ['wide jaw', 'square jaw', 'masseter', 'bruxism'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 400, max: 1000, currency: 'USD' },\n    risks_side_effects: 'Temporary weakness, asymmetry, difficulty chewing.',\n    warnings: ['Results temporary (4-6 months)', 'Requires regular maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-06',\n    name: 'Kybella (Submental Fat Dissolving)',\n    description: 'Injectable deoxycholic acid to permanently destroy fat cells under the chin.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 2,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['double chin', 'submental fat', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'per_session', min: 1200, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, numbness, difficulty swallowing (temporary).',\n    warnings: ['Requires 2-4 sessions'],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // FOUNDATIONAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'FND-01',\n    name: 'Mewing / Proper Tongue Posture',\n    description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 5,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['midfaceRatio', 'bigonialWidth', 'facialDepthToHeight'],\n    targetCategories: ['Midface/Face Shape', 'Jaw Shape', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['midface', 'palate', 'recession', 'jaw development'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n    cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n    risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n    warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-02',\n    name: 'Body Recomposition (Leanmaxxing)',\n    description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n    phase: 'Foundational',\n    baseImpact: 0.35,\n    coverage: 6,\n    percentage: '5-12%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['bigonialWidth', 'submentalCervicalAngle', 'cheekboneHeight'],\n    targetCategories: ['Jaw Shape', 'Neck', 'Midface/Face Shape'],\n    targetKeywords: ['soft jaw', 'undefined', 'round', 'facial definition'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n    risks_side_effects: 'None if done healthily.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-03',\n    name: 'Posture Correction',\n    description: 'Improving head and neck posture to optimize facial appearance and reduce forward head posture effects.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 3,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.2 },\n    targetMetrics: ['submentalCervicalAngle', 'anteriorFacialDepth'],\n    targetCategories: ['Neck', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['neck', 'posture', 'forward head'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 0, max: 100, currency: 'USD' },\n    risks_side_effects: 'None.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-04',\n    name: 'Skincare Routine (Retinoid + SPF)',\n    description: 'Medical-grade skincare to improve skin quality, texture, and reduce aging signs.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 2,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: [],\n    targetCategories: [],\n    targetKeywords: ['skin', 'texture', 'aging'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 26 },\n    cost: { type: 'per_month', min: 30, max: 150, currency: 'USD' },\n    risks_side_effects: 'Initial irritation, sun sensitivity.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-05',\n    name: 'Eyebrow Grooming / Microblading',\n    description: 'Professional shaping or semi-permanent tattooing to optimize eyebrow shape and position.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['eyebrowTilt', 'eyebrowLowSetedness', 'browLengthRatio'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['eyebrow', 'brow', 'upper third'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'flat', min: 20, max: 600, currency: 'USD' },\n    risks_side_effects: 'Minimal for grooming. Microblading: infection risk, color fading.',\n    warnings: [],\n    gender: 'both',\n  },\n];\n\n// Calculate relevance score based on multiple factors\nfunction calculateRelevanceScore(\n  proc: ProcedureConfig,\n  flaw: Flaw,\n  allFlaws: Flaw[]\n): number {\n  let score = 0;\n\n  // Check metric ID match (highest priority)\n  const metricId = flaw.responsibleRatios[0]?.ratioId || '';\n  if (proc.targetMetrics.includes(metricId)) {\n    score += 40;\n  }\n\n  // Check category match\n  if (proc.targetCategories.some(cat =>\n    flaw.categoryName.toLowerCase().includes(cat.toLowerCase()) ||\n    cat.toLowerCase().includes(flaw.categoryName.toLowerCase())\n  )) {\n    score += 25;\n  }\n\n  // Check keyword match\n  const flawLower = flaw.flawName.toLowerCase();\n  const summaryLower = flaw.summary.toLowerCase();\n  const matchedKeywords = proc.targetKeywords.filter(kw =>\n    flawLower.includes(kw.toLowerCase()) || summaryLower.includes(kw.toLowerCase())\n  );\n  score += matchedKeywords.length * 10;\n\n  // Adjust by flaw severity/impact\n  score += Math.min(flaw.harmonyPercentageLost * 3, 15);\n\n  // Bonus if this procedure addresses multiple flaws\n  const otherFlawsAddressed = allFlaws.filter(f =>\n    f.id !== flaw.id && (\n      proc.targetMetrics.includes(f.responsibleRatios[0]?.ratioId || '') ||\n      proc.targetCategories.some(cat => f.categoryName.toLowerCase().includes(cat.toLowerCase()))\n    )\n  );\n  score += otherFlawsAddressed.length * 5;\n\n  return Math.min(score, 100);\n}\n\nfunction generateRecommendations(flaws: Flaw[], frontRatios: Ratio[] = [], sideRatios: Ratio[] = []): Recommendation[] {\n  const recommendations: Recommendation[] = [];\n  const allRatios = [...frontRatios, ...sideRatios];\n\n  // Track which procedures have been added and their matched flaws\n  const procMatches: Map<string, { flaws: string[]; ratios: string[]; maxScore: number }> = new Map();\n\n  flaws.forEach(flaw => {\n    PROCEDURE_DATABASE.forEach(proc => {\n      const relevanceScore = calculateRelevanceScore(proc, flaw, flaws);\n\n      if (relevanceScore >= 25) {  // Minimum threshold\n        const existing = procMatches.get(proc.ref_id);\n        if (existing) {\n          existing.flaws.push(flaw.flawName);\n          existing.ratios.push(...flaw.responsibleRatios.map(r => r.ratioName));\n          existing.maxScore = Math.max(existing.maxScore, relevanceScore);\n        } else {\n          procMatches.set(proc.ref_id, {\n            flaws: [flaw.flawName],\n            ratios: flaw.responsibleRatios.map(r => r.ratioName),\n            maxScore: relevanceScore,\n          });\n        }\n      }\n    });\n  });\n\n  // Build recommendations from matched procedures\n  procMatches.forEach((match, procId) => {\n    const proc = PROCEDURE_DATABASE.find(p => p.ref_id === procId);\n    if (!proc) return;\n\n    // Calculate expected improvement based on severity of matched flaws\n    const matchedFlawDetails = flaws.filter(f => match.flaws.includes(f.flawName));\n    const avgImpact = matchedFlawDetails.reduce((sum, f) => sum + f.harmonyPercentageLost, 0) / matchedFlawDetails.length;\n    const severityMultiplier = Math.min(avgImpact / 3, 1.5);  // More severe = more potential improvement\n\n    // Get affected ratios from the actual data\n    const affectedRatios = allRatios.filter(r =>\n      proc.targetMetrics.includes(r.id) ||\n      match.flaws.some(f => f.toLowerCase().includes(r.category.toLowerCase()))\n    );\n\n    const adjustedImpact = proc.baseImpact * (0.8 + (match.maxScore / 500));  // Slight boost for high relevance\n\n    recommendations.push({\n      ref_id: proc.ref_id,\n      name: proc.name,\n      description: proc.description,\n      phase: proc.phase,\n      impact: adjustedImpact,\n      coverage: match.flaws.length + match.ratios.length,\n      percentage: proc.percentage,\n      expectedImprovementRange: {\n        min: proc.expectedImprovementRange.min * severityMultiplier,\n        max: proc.expectedImprovementRange.max * severityMultiplier,\n      },\n      matchedFlaws: [...new Set(match.flaws)],\n      matchedRatios: [...new Set(match.ratios)],\n      ratios_impacted: affectedRatios.map(r => ({\n        ratioId: r.id,\n        ratioName: r.name,\n        direction: 'both' as const,\n        percentageEffect: proc.baseImpact,\n      })),\n      timeline: proc.timeline,\n      cost: proc.cost,\n      risks_side_effects: proc.risks_side_effects,\n      warnings: proc.warnings,\n      gender: proc.gender,\n    });\n  });\n\n  // Sort by: phase priority (foundational first for accessibility), then impact\n  const phaseOrder: Record<string, number> = { 'Foundational': 1, 'Minimally Invasive': 2, 'Surgical': 3 };\n  return recommendations.sort((a, b) => {\n    // First sort by impact (higher = better)\n    const impactDiff = b.impact - a.impact;\n    if (Math.abs(impactDiff) > 0.1) return impactDiff;\n\n    // Then by coverage (more flaws addressed = better)\n    return b.coverage - a.coverage;\n  });\n}","originalFile":"'use client';\n\nimport React, { createContext, useContext, useState, useMemo, useCallback, ReactNode } from 'react';\nimport { LandmarkPoint } from '@/lib/landmarks';\nimport {\n  analyzeFrontProfile,\n  analyzeSideProfile,\n  analyzeHarmony,\n  HarmonyAnalysis,\n  FaceIQScoreResult,\n  FACEIQ_METRICS,\n  Ethnicity,\n  Gender,\n} from '@/lib/faceiq-scoring';\nimport {\n  Ratio,\n  Strength,\n  Flaw,\n  Recommendation,\n  ResultsTab,\n  FullHarmonyAnalysis,\n} from '@/types/results';\n\n// ============================================\n// CONTEXT TYPES\n// ============================================\n\ninterface ResultsContextType {\n  // Raw data\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  gender: Gender;\n  ethnicity: Ethnicity;\n  frontPhoto: string;\n  sidePhoto: string | null;\n\n  // Computed results\n  harmonyAnalysis: FullHarmonyAnalysis | null;\n  frontRatios: Ratio[];\n  sideRatios: Ratio[];\n  strengths: Strength[];\n  flaws: Flaw[];\n  recommendations: Recommendation[];\n\n  // Scores\n  overallScore: number;\n  frontScore: number;\n  sideScore: number;\n\n  // UI state\n  activeTab: ResultsTab;\n  setActiveTab: (tab: ResultsTab) => void;\n  expandedMeasurementId: string | null;\n  setExpandedMeasurementId: (id: string | null) => void;\n  selectedVisualizationMetric: string | null;\n  setSelectedVisualizationMetric: (id: string | null) => void;\n  categoryFilter: string | null;\n  setCategoryFilter: (category: string | null) => void;\n  showLandmarkOverlay: boolean;\n  setShowLandmarkOverlay: (show: boolean) => void;\n\n  // Actions\n  setResultsData: (data: ResultsInputData) => void;\n}\n\ninterface ResultsInputData {\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  frontPhoto: string;\n  sidePhoto?: string;\n  gender: Gender;\n  ethnicity?: Ethnicity;\n}\n\n// ============================================\n// HELPER FUNCTIONS\n// ============================================\n\nfunction convertUnitToRatioUnit(unit: string): 'x' | 'mm' | '%' | '°' {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return '°';\n    case 'mm': return 'mm';\n    default: return 'x';\n  }\n}\n\nfunction transformToRatio(result: FaceIQScoreResult, landmarks: LandmarkPoint[]): Ratio {\n  const metricConfig = FACEIQ_METRICS[result.metricId];\n\n  // Generate illustration based on metric\n  const illustration = generateIllustration(result.metricId, landmarks);\n\n  // Get flaw/strength mappings\n  const { mayIndicateFlaws, mayIndicateStrengths } = getFlawStrengthMappings(result);\n\n  return {\n    id: result.metricId,\n    name: result.name,\n    value: result.value,\n    score: result.score,\n    standardizedScore: result.standardizedScore,\n    unit: convertUnitToRatioUnit(result.unit),\n    idealMin: result.idealMin,\n    idealMax: result.idealMax,\n    rangeMin: metricConfig?.rangeMin || result.idealMin - 0.5,\n    rangeMax: metricConfig?.rangeMax || result.idealMax + 0.5,\n    description: metricConfig?.description || '',\n    category: result.category,\n    qualityLevel: result.qualityTier,\n    severity: result.severity,\n    illustration,\n    mayIndicateFlaws,\n    mayIndicateStrengths,\n    usedLandmarks: getUsedLandmarks(result.metricId),\n    scoringCurveConfig: metricConfig ? {\n      decayRate: metricConfig.decayRate,\n      maxScore: metricConfig.maxScore,\n    } : undefined,\n  };\n}\n\n// Enhanced illustration configuration type\ninterface IllustrationConfig {\n  points: string[];\n  lines: Array<{\n    from: string;\n    to: string;\n    label?: string;\n    color?: string;\n    labelPosition?: 'left' | 'right' | 'top' | 'bottom';\n  }>;\n}\n\n// Comprehensive illustration configurations for all metrics\nconst ILLUSTRATION_CONFIGS: Record<string, IllustrationConfig> = {\n  // ==========================================\n  // FACE SHAPE / PROPORTIONS\n  // ==========================================\n  faceWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'top' },\n      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'right' },\n    ],\n  },\n  totalFacialWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n      { from: 'trichion', to: 'menton', label: 'Total Height', color: '#a78bfa' },\n    ],\n  },\n  lowerThirdProportion: {\n    points: ['subnasale', 'menton', 'trichion'],\n    lines: [\n      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  middleThirdProportion: {\n    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n    lines: [\n      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  upperThirdProportion: {\n    points: ['trichion', 'nasal_base', 'menton'],\n    lines: [\n      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  bitemporalWidth: {\n    points: ['left_temporal', 'right_temporal', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_temporal', to: 'right_temporal', label: 'Temple', color: '#fbbf24' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek', color: '#67e8f9' },\n    ],\n  },\n  cheekboneHeight: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_lateralis', 'right_canthus_lateralis', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheekbone', color: '#ec4899' },\n      { from: 'left_canthus_lateralis', to: 'left_zygion', color: '#67e8f9' },\n    ],\n  },\n  midfaceRatio: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_medialis', 'right_canthus_medialis', 'subnasale'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Midface Width', color: '#67e8f9' },\n      { from: 'left_canthus_medialis', to: 'subnasale', label: 'Midface Height', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // JAW MEASUREMENTS\n  // ==========================================\n  jawSlope: {\n    points: ['left_gonion_inferior', 'left_mentum_lateralis', 'menton', 'right_mentum_lateralis', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'left_mentum_lateralis', label: 'Jaw Slope', color: '#f97316' },\n      { from: 'right_gonion_inferior', to: 'right_mentum_lateralis', color: '#f97316' },\n    ],\n  },\n  jawFrontalAngle: {\n    points: ['left_gonion_inferior', 'menton', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'menton', label: 'Jaw Angle', color: '#f97316' },\n      { from: 'menton', to: 'right_gonion_inferior', color: '#f97316' },\n    ],\n  },\n  bigonialWidth: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw Width', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n    ],\n  },\n  jawWidthRatio: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face', color: '#67e8f9' },\n    ],\n  },\n\n  // ==========================================\n  // EYE MEASUREMENTS\n  // ==========================================\n  lateralCanthalTilt: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'bottom' },\n      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n    ],\n  },\n  eyeAspectRatio: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'left_palpebra_superior', 'left_palpebra_inferior'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Width', color: '#06b6d4' },\n      { from: 'left_palpebra_superior', to: 'left_palpebra_inferior', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  eyeSeparationRatio: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryMouthWidthRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_cheilion', 'right_cheilion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n    ],\n  },\n  oneEyeApartTest: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Between Eyes', color: '#06b6d4' },\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Eye Width', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // EYEBROW MEASUREMENTS\n  // ==========================================\n  browLengthRatio: {\n    points: ['left_supercilium_medialis', 'left_supercilium_lateralis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_lateralis', label: 'Brow', color: '#84cc16' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  eyebrowTilt: {\n    points: ['left_supercilium_medialis', 'left_supercilium_apex', 'left_supercilium_lateralis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_apex', label: 'Tilt', color: '#84cc16' },\n      { from: 'left_supercilium_apex', to: 'left_supercilium_lateralis', color: '#84cc16' },\n    ],\n  },\n  eyebrowLowSetedness: {\n    points: ['left_supercilium_medialis', 'left_palpebra_superior', 'left_canthus_medialis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_palpebra_superior', label: 'Brow-Eye Gap', color: '#84cc16' },\n    ],\n  },\n\n  // ==========================================\n  // NOSE MEASUREMENTS (FRONT)\n  // ==========================================\n  nasalIndex: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Width', color: '#fbbf24' },\n      { from: 'nasal_base', to: 'subnasale', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  intercanthalNasalRatio: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'left_canthus_medialis', 'right_canthus_medialis'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose Width', color: '#fbbf24' },\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n    ],\n  },\n  noseBridgeWidth: {\n    points: ['left_dorsum_nasi', 'right_dorsum_nasi', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_dorsum_nasi', to: 'right_dorsum_nasi', label: 'Bridge', color: '#fbbf24' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Base', color: '#f97316' },\n    ],\n  },\n  noseTipPosition: {\n    points: ['subnasale', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Tip Position', color: '#fbbf24' },\n    ],\n  },\n\n  // ==========================================\n  // MOUTH/LIP MEASUREMENTS\n  // ==========================================\n  mouthNoseWidthRatio: {\n    points: ['left_cheilion', 'right_cheilion', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  lowerUpperLipRatio: {\n    points: ['labrale_superius', 'mouth_middle', 'labrale_inferius'],\n    lines: [\n      { from: 'labrale_superius', to: 'mouth_middle', label: 'Upper', color: '#ec4899' },\n      { from: 'mouth_middle', to: 'labrale_inferius', label: 'Lower', color: '#f97316' },\n    ],\n  },\n  chinPhiltrumRatio: {\n    points: ['subnasale', 'labrale_superius', 'labrale_inferius', 'menton'],\n    lines: [\n      { from: 'subnasale', to: 'labrale_superius', label: 'Philtrum', color: '#ec4899' },\n      { from: 'labrale_inferius', to: 'menton', label: 'Chin', color: '#ef4444' },\n    ],\n  },\n  mouthWidth: {\n    points: ['left_cheilion', 'right_cheilion'],\n    lines: [{ from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth Width', color: '#ec4899' }],\n  },\n\n  // ==========================================\n  // CHIN MEASUREMENTS\n  // ==========================================\n  chinHeight: {\n    points: ['labrale_inferius', 'menton'],\n    lines: [{ from: 'labrale_inferius', to: 'menton', label: 'Chin Height', color: '#ef4444' }],\n  },\n\n  // ==========================================\n  // NECK MEASUREMENTS\n  // ==========================================\n  neckWidthRatio: {\n    points: ['left_cervical_lateralis', 'right_cervical_lateralis', 'left_gonion_inferior', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_cervical_lateralis', to: 'right_cervical_lateralis', label: 'Neck', color: '#14b8a6' },\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n    ],\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS\n  // ==========================================\n  gonialAngle: {\n    points: ['tragus', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'tragus', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  nasofrontalAngle: {\n    points: ['glabella', 'nasion', 'pronasale'],\n    lines: [\n      { from: 'glabella', to: 'nasion', label: 'Forehead', color: '#84cc16' },\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  nasofacialAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', color: '#67e8f9' },\n    ],\n  },\n  nasomentaAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', label: 'To Chin', color: '#ef4444' },\n    ],\n  },\n  submentalCervicalAngle: {\n    points: ['menton', 'cervicalPoint', 'neckPoint'],\n    lines: [\n      { from: 'menton', to: 'cervicalPoint', label: 'Submental', color: '#14b8a6' },\n      { from: 'cervicalPoint', to: 'neckPoint', label: 'Cervical', color: '#06b6d4' },\n    ],\n  },\n  facialDepthToHeight: {\n    points: ['pronasale', 'tragus', 'nasion', 'menton'],\n    lines: [\n      { from: 'pronasale', to: 'tragus', label: 'Depth', color: '#67e8f9' },\n      { from: 'nasion', to: 'menton', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  anteriorFacialDepth: {\n    points: ['glabella', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'glabella', to: 'pronasale', color: '#67e8f9' },\n      { from: 'pronasale', to: 'pogonion', color: '#a78bfa' },\n    ],\n  },\n  mandibularPlaneAngle: {\n    points: ['gonionBottom', 'menton', 'orbitale', 'porion'],\n    lines: [\n      { from: 'gonionBottom', to: 'menton', label: 'Mandibular', color: '#f97316' },\n      { from: 'orbitale', to: 'porion', label: 'Frankfort', color: '#67e8f9' },\n    ],\n  },\n  ramusToMandibleRatio: {\n    points: ['gonionTop', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'gonionTop', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  orbitalVector: {\n    points: ['cornealApex', 'orbitale', 'cheekbone'],\n    lines: [\n      { from: 'cornealApex', to: 'cheekbone', label: 'Orbital Vector', color: '#06b6d4' },\n    ],\n  },\n  eLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'E-Line', color: '#67e8f9' },\n    ],\n  },\n  sLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'S-Line', color: '#a78bfa' },\n    ],\n  },\n  holdawayHLine: {\n    points: ['pronasale', 'pogonion', 'labraleSuperius', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'H-Line', color: '#ec4899' },\n    ],\n  },\n  burstoneLowerLip: {\n    points: ['subnasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'subnasale', to: 'pogonion', label: 'Burstone', color: '#fbbf24' },\n    ],\n  },\n};\n\nfunction generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  const config = ILLUSTRATION_CONFIGS[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = {\n        from: line.from,\n        to: line.to,\n        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}\n\nfunction getUsedLandmarks(metricId: string): string[] {\n  const landmarkMappings: Record<string, string[]> = {\n    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lateralCanthalTilt: ['left_canthus_medialis', 'left_canthus_lateralis'],\n    nasalIndex: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    ipd: ['left_pupila', 'right_pupila'],\n    mouthWidth: ['left_cheilion', 'right_cheilion'],\n    jawWidth: ['left_gonion_inferior', 'right_gonion_inferior'],\n    chinHeight: ['labrale_inferius', 'menton'],\n    gonialAngle: ['tragus', 'gonionBottom', 'menton'],\n  };\n  return landmarkMappings[metricId] || [];\n}\n\nfunction getFlawStrengthMappings(result: FaceIQScoreResult): { mayIndicateFlaws: string[]; mayIndicateStrengths: string[] } {\n  const flawMappings: Record<string, { low: string[]; high: string[] }> = {\n    faceWidthToHeight: {\n      low: ['Narrow face', 'Vertically elongated face'],\n      high: ['Wide face', 'Horizontally expanded face'],\n    },\n    lowerThirdProportion: {\n      low: ['Short lower third', 'Deficient mandible'],\n      high: ['Long lower third', 'Mandibular excess'],\n    },\n    lateralCanthalTilt: {\n      low: ['Negative canthal tilt', 'Drooping eyes'],\n      high: ['Excessive positive canthal tilt'],\n    },\n    nasalIndex: {\n      low: ['Narrow nose', 'Leptorrhine nose'],\n      high: ['Wide nose', 'Platyrrhine nose'],\n    },\n    gonialAngle: {\n      low: ['Steep mandibular plane'],\n      high: ['Flat mandibular plane', 'Weak jaw definition'],\n    },\n  };\n\n  const strengthMappings: Record<string, { ideal: string[] }> = {\n    faceWidthToHeight: { ideal: ['Balanced facial proportions', 'Harmonious face shape'] },\n    lateralCanthalTilt: { ideal: ['Attractive eye shape', 'Positive canthal tilt'] },\n    nasalIndex: { ideal: ['Well-proportioned nose', 'Balanced nasal width'] },\n    gonialAngle: { ideal: ['Well-defined jawline', 'Strong jaw structure'] },\n  };\n\n  const mapping = flawMappings[result.metricId];\n  const strengthMapping = strengthMappings[result.metricId];\n\n  let mayIndicateFlaws: string[] = [];\n  let mayIndicateStrengths: string[] = [];\n\n  if (result.qualityTier === 'ideal' || result.qualityTier === 'excellent') {\n    mayIndicateStrengths = strengthMapping?.ideal || [];\n  } else if (mapping) {\n    mayIndicateFlaws = result.deviationDirection === 'below' ? mapping.low : mapping.high;\n  }\n\n  return { mayIndicateFlaws, mayIndicateStrengths };\n}\n\nfunction generateStrengthsFromAnalysis(analysis: HarmonyAnalysis): Strength[] {\n  const strengths: Strength[] = [];\n\n  analysis.strengths.forEach((s, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === s.metricId);\n\n    strengths.push({\n      id: `strength_${i}`,\n      strengthName: s.metricName,\n      summary: s.reasoning,\n      avgScore: matchingMeasurement?.score || 8,\n      qualityLevel: s.qualityTier,\n      categoryName: s.category,\n      responsibleRatios: [{\n        ratioName: s.metricName,\n        ratioId: s.metricId,\n        score: matchingMeasurement?.score || 8,\n        value: s.value,\n      }],\n    });\n  });\n\n  return strengths;\n}\n\nfunction generateFlawsFromAnalysis(analysis: HarmonyAnalysis): Flaw[] {\n  const flaws: Flaw[] = [];\n  let rollingLost = 0;\n\n  analysis.flaws.forEach((f, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === f.metricId);\n    const impact = matchingMeasurement ? (10 - matchingMeasurement.score) * 0.5 : 2;\n    rollingLost += impact;\n\n    flaws.push({\n      id: `flaw_${i}`,\n      flawName: f.metricName,\n      summary: f.reasoning,\n      harmonyPercentageLost: impact,\n      standardizedImpact: impact / 10,\n      categoryName: f.category,\n      responsibleRatios: [{\n        ratioName: f.metricName,\n        ratioId: f.metricId,\n        score: matchingMeasurement?.score || 3,\n        value: matchingMeasurement?.value || 0,\n      }],\n      rollingPointsDeducted: rollingLost,\n      rollingHarmonyPercentageLost: rollingLost,\n      rollingStandardizedImpact: rollingLost / 10,\n    });\n  });\n\n  return flaws.sort((a, b) => b.harmonyPercentageLost - a.harmonyPercentageLost);\n}\n\nfunction generateRecommendations(flaws: Flaw[]): Recommendation[] {\n  // Generate recommendations based on detected flaws\n  const recommendations: Recommendation[] = [];\n\n  const procedureDatabase: Array<Omit<Recommendation, 'matchedFlaws' | 'matchedRatios' | 'ratios_impacted'> & { targetFlaws: string[] }> = [\n    {\n      ref_id: 'SUR-01',\n      name: 'Genioplasty',\n      description: 'Surgical chin repositioning to improve chin projection and facial harmony. Can move the chin forward, backward, up, or down.',\n      phase: 'Surgical',\n      impact: 0.85,\n      coverage: 8,\n      percentage: '15-25%',\n      expectedImprovementRange: { min: 0.5, max: 1.5 },\n      targetFlaws: ['Weak chin', 'Recessed chin', 'Short chin', 'chin'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n      cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n      risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'SUR-02',\n      name: 'Rhinoplasty',\n      description: 'Nose reshaping surgery to improve nasal proportions, reduce or increase size, change angle, or correct breathing issues.',\n      phase: 'Surgical',\n      impact: 0.8,\n      coverage: 6,\n      percentage: '10-20%',\n      targetFlaws: ['Wide nose', 'Long nose', 'Crooked nose', 'nose', 'nasal'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n      cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n      risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'SUR-03',\n      name: 'Jaw Implants',\n      description: 'Custom or standard implants to enhance jaw width and definition. Creates a more angular, masculine jawline.',\n      phase: 'Surgical',\n      impact: 0.75,\n      coverage: 5,\n      percentage: '10-15%',\n      targetFlaws: ['Narrow jaw', 'Weak jaw', 'jaw'],\n      timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n      cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n      risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'MIN-01',\n      name: 'Dermal Fillers',\n      description: 'Hyaluronic acid injections to add volume to chin, jawline, or cheeks. Non-permanent and reversible.',\n      phase: 'Minimally Invasive',\n      impact: 0.4,\n      coverage: 4,\n      percentage: '5-10%',\n      targetFlaws: ['Weak chin', 'Flat cheeks', 'chin', 'midface'],\n      timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n      cost: { type: 'per_session', min: 600, max: 2000, currency: 'USD' },\n      risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n      warnings: ['Results temporary (6-18 months)'],\n      gender: 'both',\n    },\n    {\n      ref_id: 'MIN-02',\n      name: 'Orthodontic Treatment',\n      description: 'Braces or clear aligners to correct bite alignment and tooth positioning. Can impact facial profile over time.',\n      phase: 'Minimally Invasive',\n      impact: 0.5,\n      coverage: 3,\n      percentage: '5-15%',\n      targetFlaws: ['Bite issues', 'Midface recession', 'jaw'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 52, full_results_weeks_max: 104 },\n      cost: { type: 'flat', min: 3000, max: 10000, currency: 'USD' },\n      risks_side_effects: 'Temporary discomfort, requires compliance.',\n      warnings: [],\n      gender: 'both',\n    },\n    {\n      ref_id: 'FND-01',\n      name: 'Mewing / Proper Tongue Posture',\n      description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n      phase: 'Foundational',\n      impact: 0.2,\n      coverage: 4,\n      percentage: '2-5%',\n      targetFlaws: ['Midface recession', 'Narrow palate', 'jaw', 'midface'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n      cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n      risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n      warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n      gender: 'both',\n    },\n    {\n      ref_id: 'FND-02',\n      name: 'Body Recomposition',\n      description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n      phase: 'Foundational',\n      impact: 0.3,\n      coverage: 6,\n      percentage: '5-10%',\n      targetFlaws: ['Undefined jawline', 'Soft features', 'jaw', 'face'],\n      timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n      cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n      risks_side_effects: 'None if done healthily.',\n      warnings: [],\n      gender: 'both',\n    },\n  ];\n\n  flaws.forEach(flaw => {\n    procedureDatabase.forEach(proc => {\n      const flawLower = flaw.flawName.toLowerCase();\n      const matches = proc.targetFlaws.some(target =>\n        flawLower.includes(target.toLowerCase()) || target.toLowerCase().includes(flawLower)\n      );\n\n      if (matches && !recommendations.find(r => r.ref_id === proc.ref_id)) {\n        recommendations.push({\n          ...proc,\n          matchedFlaws: [flaw.flawName],\n          matchedRatios: flaw.responsibleRatios.map(r => r.ratioName),\n          ratios_impacted: flaw.responsibleRatios.map(r => ({\n            ratioId: r.ratioId,\n            ratioName: r.ratioName,\n            direction: 'both' as const,\n            percentageEffect: 1.0,\n          })),\n        });\n      }\n    });\n  });\n\n  return recommendations.sort((a, b) => b.impact - a.impact);\n}\n\n// ============================================\n// CONTEXT CREATION\n// ============================================\n\nconst ResultsContext = createContext<ResultsContextType | null>(null);\n\nexport function useResults(): ResultsContextType {\n  const context = useContext(ResultsContext);\n  if (!context) {\n    throw new Error('useResults must be used within a ResultsProvider');\n  }\n  return context;\n}\n\ninterface ResultsProviderProps {\n  children: ReactNode;\n  initialData?: ResultsInputData;\n}\n\nexport function ResultsProvider({ children, initialData }: ResultsProviderProps) {\n  // Raw data state\n  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>(initialData?.frontLandmarks || []);\n  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>(initialData?.sideLandmarks || []);\n  const [gender, setGender] = useState<Gender>(initialData?.gender || 'male');\n  const [ethnicity, setEthnicity] = useState<Ethnicity>(initialData?.ethnicity || 'other');\n  const [frontPhoto, setFrontPhoto] = useState<string>(initialData?.frontPhoto || '');\n  const [sidePhoto, setSidePhoto] = useState<string | null>(initialData?.sidePhoto || null);\n\n  // UI state\n  const [activeTab, setActiveTab] = useState<ResultsTab>('overview');\n  const [expandedMeasurementId, setExpandedMeasurementId] = useState<string | null>(null);\n  const [selectedVisualizationMetric, setSelectedVisualizationMetric] = useState<string | null>(null);\n  const [categoryFilter, setCategoryFilter] = useState<string | null>(null);\n  const [showLandmarkOverlay, setShowLandmarkOverlay] = useState(true);\n\n  // Compute analysis results (now with demographic-specific scoring)\n  const analysisResults = useMemo(() => {\n    if (frontLandmarks.length === 0) {\n      return null;\n    }\n\n    try {\n      const frontAnalysis = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n      const sideAnalysis = sideLandmarks.length > 0\n        ? analyzeSideProfile(sideLandmarks, gender, ethnicity)\n        : null;\n      // analyzeHarmony expects landmarks directly, not analysis results\n      const harmony = analyzeHarmony(frontLandmarks, sideLandmarks, gender, ethnicity);\n\n      return { frontAnalysis, sideAnalysis, harmony };\n    } catch (error) {\n      console.error('Analysis error:', error);\n      return null;\n    }\n  }, [frontLandmarks, sideLandmarks, gender, ethnicity]);\n\n  // Transform to Ratio format\n  const frontRatios = useMemo(() => {\n    if (!analysisResults?.frontAnalysis) return [];\n    return analysisResults.frontAnalysis.measurements.map(m => transformToRatio(m, frontLandmarks));\n  }, [analysisResults, frontLandmarks]);\n\n  const sideRatios = useMemo(() => {\n    if (!analysisResults?.sideAnalysis) return [];\n    return analysisResults.sideAnalysis.measurements.map(m => transformToRatio(m, sideLandmarks));\n  }, [analysisResults, sideLandmarks]);\n\n  // Generate strengths and flaws\n  const strengths = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateStrengthsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  const flaws = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateFlawsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  // Generate recommendations\n  const recommendations = useMemo(() => {\n    return generateRecommendations(flaws);\n  }, [flaws]);\n\n  // Build full harmony analysis\n  const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {\n    if (!analysisResults?.harmony) return null;\n\n    return {\n      standardizedScore: analysisResults.harmony.overallScore,\n      front: {\n        standardizedScore: analysisResults.harmony.frontScore,\n        ratios: frontRatios,\n      },\n      side: {\n        standardizedScore: analysisResults.harmony.sideScore,\n        ratios: sideRatios,\n      },\n      strengths,\n      flaws,\n    };\n  }, [analysisResults, frontRatios, sideRatios, strengths, flaws]);\n\n  // Scores\n  const overallScore = analysisResults?.harmony?.overallScore || 0;\n  const frontScore = analysisResults?.harmony?.frontScore || 0;\n  const sideScore = analysisResults?.harmony?.sideScore || 0;\n\n  // Action to set all results data\n  const setResultsData = useCallback((data: ResultsInputData) => {\n    setFrontLandmarks(data.frontLandmarks);\n    setSideLandmarks(data.sideLandmarks);\n    setFrontPhoto(data.frontPhoto);\n    setSidePhoto(data.sidePhoto || null);\n    setGender(data.gender);\n    setEthnicity(data.ethnicity || 'other');\n  }, []);\n\n  const value: ResultsContextType = {\n    frontLandmarks,\n    sideLandmarks,\n    gender,\n    ethnicity,\n    frontPhoto,\n    sidePhoto,\n    harmonyAnalysis,\n    frontRatios,\n    sideRatios,\n    strengths,\n    flaws,\n    recommendations,\n    overallScore,\n    frontScore,\n    sideScore,\n    activeTab,\n    setActiveTab,\n    expandedMeasurementId,\n    setExpandedMeasurementId,\n    selectedVisualizationMetric,\n    setSelectedVisualizationMetric,\n    categoryFilter,\n    setCategoryFilter,\n    showLandmarkOverlay,\n    setShowLandmarkOverlay,\n    setResultsData,\n  };\n\n  return (\n    <ResultsContext.Provider value={value}>\n      {children}\n    </ResultsContext.Provider>\n  );\n}\n","structuredPatch":[{"oldStart":618,"oldLines":143,"newStart":618,"newLines":511,"lines":["   return flaws.sort((a, b) => b.harmonyPercentageLost - a.harmonyPercentageLost);"," }"," ","-function generateRecommendations(flaws: Flaw[]): Recommendation[] {","-  // Generate recommendations based on detected flaws","+// Comprehensive procedure database with metric-specific targeting","+interface ProcedureConfig {","+  ref_id: string;","+  name: string;","+  description: string;","+  phase: 'Surgical' | 'Minimally Invasive' | 'Foundational';","+  baseImpact: number;","+  coverage: number;","+  percentage: string;","+  expectedImprovementRange: { min: number; max: number };","+  targetMetrics: string[];  // Specific metric IDs this treatment addresses","+  targetCategories: string[];  // Category names this treatment addresses","+  targetKeywords: string[];  // Flaw name keywords to match","+  timeline: { effect_start: 'immediate' | 'delayed' | 'gradual'; full_results_weeks: number; full_results_weeks_max?: number };","+  cost: { type: 'flat' | 'per_session' | 'per_month'; min: number; max: number; currency: string };","+  risks_side_effects: string;","+  warnings: string[];","+  gender: 'male' | 'female' | 'both';","+}","+","+const PROCEDURE_DATABASE: ProcedureConfig[] = [","+  // ==========================================","+  // SURGICAL TREATMENTS","+  // ==========================================","+  {","+    ref_id: 'SUR-01',","+    name: 'Sliding Genioplasty',","+    description: 'Chin bone repositioning surgery that can move the chin forward, backward, up, or down for optimal projection and facial balance.',","+    phase: 'Surgical',","+    baseImpact: 0.90,","+    coverage: 8,","+    percentage: '15-25%',","+    expectedImprovementRange: { min: 0.5, max: 1.5 },","+    targetMetrics: ['chinPhiltrumRatio', 'facialDepthToHeight', 'anteriorFacialDepth', 'nasomentaAngle'],","+    targetCategories: ['Chin', 'Occlusion/Jaw Growth'],","+    targetKeywords: ['chin', 'recessed', 'weak', 'short chin', 'long chin', 'pogonion'],","+    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },","+    cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },","+    risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage, bone resorption.',","+    warnings: [],","+    gender: 'both',","+  },","+  {","+    ref_id: 'SUR-02',","+    name: 'Reduction Rhinoplasty',","+    description: 'Surgical reduction of nose size, hump removal, and tip refinement to improve nasal proportions.',","+    phase: 'Surgical',","+    baseImpact: 0.85,","+    coverage: 6,","+    percentage: '10-20%',","+    expectedImprovementRange: { min: 0.5, max: 1.0 },","+    targetMetrics: ['nasalIndex', 'nasofrontalAngle', 'nasofacialAngle', 'nasomentaAngle', 'intercanthalNasalRatio', 'noseBridgeWidth'],","+    targetCategories: ['Nose'],","+    targetKeywords: ['wide nose', 'large nose', 'dorsal hump', 'bulbous', 'nasal', 'nose bridge'],","+    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },","+    cost: { type: 'flat', min: 7000, max: 20000, currency: 'USD' },","+    risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',","+    warnings: [],","+    gender: 'both',","+  },","+  {","+    ref_id: 'SUR-03',","+    name: 'Jaw Angle Implants',","+    description: 'Custom or standard silicone/PEEK implants to enhance jaw width, definition, and angularity.',","+    phase: 'Surgical',","+    baseImpact: 0.80,","+    coverage: 5,","+    percentage: '10-15%',","+    expectedImprovementRange: { min: 0.4, max: 1.0 },","+    targetMetrics: ['bigonialWidth', 'jawFrontalAngle', 'jawWidthRatio', 'jawSlope', 'gonialAngle'],","+    targetCategories: ['Jaw Shape'],","+    targetKeywords: ['narrow jaw', 'weak jaw', 'soft jaw', 'jaw angle', 'gonial', 'mandible'],","+    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },","+    cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },","+    risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection, bone erosion.',","+    warnings: [],","+    gender: 'both',","+  },","+  {","+    ref_id: 'SUR-04',","+    name: 'Bimaxillary Osteotomy (Bimax)',","+    description: 'Double jaw surgery to reposition both upper and lower jaws for optimal occlusion and facial balance.',","+    phase: 'Surgical',","+    baseImpact: 0.95,","+    coverage: 12,","+    percentage: '20-35%',","+    expectedImprovementRange: { min: 1.0, max: 2.0 },","+    targetMetrics: ['midfaceRatio', 'facialDepthToHeight', 'mandibularPlaneAngle', 'lowerThirdProportion', 'nasofacialAngle'],","+    targetCategories: ['Occlusion/Jaw Growth', 'Midface/Face Shape'],","+    targetKeywords: ['maxillary recession', 'mandibular', 'hyper-divergent', 'bite', 'occlusion', 'midface recession'],","+    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },","+    cost: { type: 'flat', min: 20000, max: 60000, currency: 'USD' },","+    risks_side_effects: 'Extended recovery, numbness (temporary to permanent), dietary restrictions.',","+    warnings: ['Major surgery - requires orthodontic preparation'],","+    gender: 'both',","+  },","+  {","+    ref_id: 'SUR-05',","+    name: 'Canthoplasty',","+    description: 'Surgical eye corner modification to improve canthal tilt and eye shape.',","+    phase: 'Surgical',","+    baseImpact: 0.75,","+    coverage: 3,","+    percentage: '8-15%',","+    expectedImprovementRange: { min: 0.3, max: 0.8 },","+    targetMetrics: ['lateralCanthalTilt', 'eyeAspectRatio'],","+    targetCategories: ['Eyes'],","+    targetKeywords: ['canthal tilt', 'negative tilt', 'drooping eyes', 'eye shape', 'eye angle'],","+    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },","+    cost: { type: 'flat', min: 4000, max: 12000, currency: 'USD' },","+    risks_side_effects: 'Scarring, asymmetry, dry eyes, ectropion.',","+    warnings: ['Difficult to reverse'],","+    gender: 'both',","+  },","+  {","+    ref_id: 'SUR-06',","+    name: 'Cheek/Malar Implants',","+    description: 'Solid implants placed over the cheekbones to enhance midface projection and width.',","+    phase: 'Surgical',","+    baseImpact: 0.75,","+    coverage: 4,","+    percentage: '10-18%',","+    expectedImprovementRange: { min: 0.4, max: 0.9 },","+    targetMetrics: ['cheekboneHeight', 'midfaceRatio', 'totalFacialWidthToHeight'],","+    targetCategories: ['Midface/Face Shape'],","+    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface', 'zygomatic', 'malar'],","+    timeline: { effect_start: 'delayed', full_results_weeks: 6, full_results_weeks_max: 12 },","+    cost: { type: 'flat', min: 6000, max: 15000, currency: 'USD' },","+    risks_side_effects: 'Swelling, asymmetry, implant shifting, nerve damage.',","+    warnings: [],","+    gender: 'both',","+  },","+  {","+    ref_id: 'SUR-07',","+    name: 'Neck Liposuction / Submentoplasty',","+    description: 'Fat removal and skin tightening under the chin and neck area.',","+    phase: 'Surgical',","+    baseImpact: 0.65,","+    coverage: 3,","+    percentage: '8-12%',","+    expectedImprovementRange: { min: 0.3, max: 0.7 },","+    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],","+    targetCategories: ['Neck'],","+    targetKeywords: ['round neck', 'double chin', 'submental', 'cervical', 'neck definition'],","+    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },","+    cost: { type: 'flat', min: 3000, max: 8000, currency: 'USD' },","+    risks_side_effects: 'Swelling, bruising, skin irregularity, numbness.',","+    warnings: [],","+    gender: 'both',","+  },","+  {","+    ref_id: 'SUR-08',","+    name: 'Brow Bone Reduction/Augmentation',","+    description: 'Surgical reshaping of the brow ridge for improved upper third harmony.',","+    phase: 'Surgical',","+    baseImpact: 0.70,","+    coverage: 3,","+    percentage: '8-15%',","+    expectedImprovementRange: { min: 0.3, max: 0.7 },","+    targetMetrics: ['nasofrontalAngle', 'bitemporalWidth', 'upperThirdProportion'],","+    targetCategories: ['Upper Third'],","+    targetKeywords: ['brow ridge', 'forehead', 'nasofrontal', 'upper third', 'glabella'],","+    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },","+    cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },","+    risks_side_effects: 'Swelling, numbness, scarring (if coronal incision).',","+    warnings: [],","+    gender: 'both',","+  },","+","+  // ==========================================","+  // MINIMALLY INVASIVE TREATMENTS","+  // ==========================================","+  {","+    ref_id: 'MIN-01',","+    name: 'Chin/Jawline Filler',","+    description: 'Hyaluronic acid injections to enhance chin projection and jawline definition. Reversible and temporary.',","+    phase: 'Minimally Invasive',","+    baseImpact: 0.45,","+    coverage: 4,","+    percentage: '5-10%',","+    expectedImprovementRange: { min: 0.2, max: 0.5 },","+    targetMetrics: ['chinPhiltrumRatio', 'jawFrontalAngle', 'bigonialWidth'],","+    targetCategories: ['Chin', 'Jaw Shape'],","+    targetKeywords: ['weak chin', 'recessed chin', 'soft jaw', 'jawline'],","+    timeline: { effect_start: 'immediate', full_results_weeks: 1 },","+    cost: { type: 'per_session', min: 800, max: 2500, currency: 'USD' },","+    risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',","+    warnings: ['Results temporary (12-18 months)', 'Requires maintenance'],","+    gender: 'both',","+  },","+  {","+    ref_id: 'MIN-02',","+    name: 'Cheek Filler',","+    description: 'HA filler to enhance cheekbone projection and midface volume.',","+    phase: 'Minimally Invasive',","+    baseImpact: 0.40,","+    coverage: 3,","+    percentage: '5-8%',","+    expectedImprovementRange: { min: 0.2, max: 0.4 },","+    targetMetrics: ['cheekboneHeight', 'midfaceRatio'],","+    targetCategories: ['Midface/Face Shape'],","+    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface volume'],","+    timeline: { effect_start: 'immediate', full_results_weeks: 1 },","+    cost: { type: 'per_session', min: 600, max: 1800, currency: 'USD' },","+    risks_side_effects: 'Bruising, swelling, asymmetry.',","+    warnings: ['Results temporary (12-18 months)'],","+    gender: 'both',","+  },","+  {","+    ref_id: 'MIN-03',","+    name: 'Lip Filler',","+    description: 'Hyaluronic acid to enhance lip volume and proportions.',","+    phase: 'Minimally Invasive',","+    baseImpact: 0.35,","+    coverage: 2,","+    percentage: '3-6%',","+    expectedImprovementRange: { min: 0.1, max: 0.3 },","+    targetMetrics: ['lowerUpperLipRatio', 'mouthNoseWidthRatio'],","+    targetCategories: ['Lips'],","+    targetKeywords: ['thin lip', 'lip ratio', 'lip volume', 'upper lip', 'lower lip'],","+    timeline: { effect_start: 'immediate', full_results_weeks: 1 },","+    cost: { type: 'per_session', min: 400, max: 1200, currency: 'USD' },","+    risks_side_effects: 'Bruising, swelling, lumps.',","+    warnings: ['Results temporary (6-12 months)'],","+    gender: 'both',","+  },","+  {","+    ref_id: 'MIN-04',","+    name: 'PDO Thread Lift',","+    description: 'Dissolvable threads to lift and tighten skin, particularly for canthal tilt improvement.',","+    phase: 'Minimally Invasive',","+    baseImpact: 0.35,","+    coverage: 3,","+    percentage: '4-8%',","+    expectedImprovementRange: { min: 0.1, max: 0.4 },","+    targetMetrics: ['lateralCanthalTilt', 'eyebrowLowSetedness'],","+    targetCategories: ['Eyes', 'Upper Third'],","+    targetKeywords: ['canthal tilt', 'drooping', 'sagging', 'eyebrow position'],","+    timeline: { effect_start: 'immediate', full_results_weeks: 4, full_results_weeks_max: 12 },","+    cost: { type: 'per_session', min: 1500, max: 4000, currency: 'USD' },","+    risks_side_effects: 'Bruising, asymmetry, thread visibility, infection.',","+    warnings: ['Results temporary (12-18 months)'],","+    gender: 'both',","+  },","+  {","+    ref_id: 'MIN-05',","+    name: 'Masseter Botox',","+    description: 'Botulinum toxin to slim the lower face by relaxing masseter muscles.',","+    phase: 'Minimally Invasive',","+    baseImpact: 0.40,","+    coverage: 2,","+    percentage: '4-8%',","+    expectedImprovementRange: { min: 0.2, max: 0.4 },","+    targetMetrics: ['bigonialWidth', 'jawWidthRatio', 'faceWidthToHeight'],","+    targetCategories: ['Jaw Shape', 'Midface/Face Shape'],","+    targetKeywords: ['wide jaw', 'square jaw', 'masseter', 'bruxism'],","+    timeline: { effect_start: 'delayed', full_results_weeks: 4, full_results_weeks_max: 12 },","+    cost: { type: 'per_session', min: 400, max: 1000, currency: 'USD' },","+    risks_side_effects: 'Temporary weakness, asymmetry, difficulty chewing.',","+    warnings: ['Results temporary (4-6 months)', 'Requires regular maintenance'],","+    gender: 'both',","+  },","+  {","+    ref_id: 'MIN-06',","+    name: 'Kybella (Submental Fat Dissolving)',","+    description: 'Injectable deoxycholic acid to permanently destroy fat cells under the chin.',","+    phase: 'Minimally Invasive',","+    baseImpact: 0.45,","+    coverage: 2,","+    percentage: '5-10%',","+    expectedImprovementRange: { min: 0.2, max: 0.5 },","+    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],","+    targetCategories: ['Neck'],","+    targetKeywords: ['double chin', 'submental fat', 'neck definition'],","+    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },","+    cost: { type: 'per_session', min: 1200, max: 1800, currency: 'USD' },","+    risks_side_effects: 'Swelling, bruising, numbness, difficulty swallowing (temporary).',","+    warnings: ['Requires 2-4 sessions'],","+    gender: 'both',","+  },","+","+  // ==========================================","+  // FOUNDATIONAL TREATMENTS","+  // ==========================================","+  {","+    ref_id: 'FND-01',","+    name: 'Mewing / Proper Tongue Posture',","+    description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',","+    phase: 'Foundational',","+    baseImpact: 0.25,","+    coverage: 5,","+    percentage: '2-5%',","+    expectedImprovementRange: { min: 0.1, max: 0.3 },","+    targetMetrics: ['midfaceRatio', 'bigonialWidth', 'facialDepthToHeight'],","+    targetCategories: ['Midface/Face Shape', 'Jaw Shape', 'Occlusion/Jaw Growth'],","+    targetKeywords: ['midface', 'palate', 'recession', 'jaw development'],","+    timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },","+    cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },","+    risks_side_effects: 'None if done correctly. Jaw pain if excessive.',","+    warnings: ['Results vary significantly', 'Most effective in younger individuals'],","+    gender: 'both',","+  },","+  {","+    ref_id: 'FND-02',","+    name: 'Body Recomposition (Leanmaxxing)',","+    description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',","+    phase: 'Foundational',","+    baseImpact: 0.35,","+    coverage: 6,","+    percentage: '5-12%',","+    expectedImprovementRange: { min: 0.2, max: 0.5 },","+    targetMetrics: ['bigonialWidth', 'submentalCervicalAngle', 'cheekboneHeight'],","+    targetCategories: ['Jaw Shape', 'Neck', 'Midface/Face Shape'],","+    targetKeywords: ['soft jaw', 'undefined', 'round', 'facial definition'],","+    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },","+    cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },","+    risks_side_effects: 'None if done healthily.',","+    warnings: [],","+    gender: 'both',","+  },","+  {","+    ref_id: 'FND-03',","+    name: 'Posture Correction',","+    description: 'Improving head and neck posture to optimize facial appearance and reduce forward head posture effects.',","+    phase: 'Foundational',","+    baseImpact: 0.20,","+    coverage: 3,","+    percentage: '2-5%',","+    expectedImprovementRange: { min: 0.1, max: 0.2 },","+    targetMetrics: ['submentalCervicalAngle', 'anteriorFacialDepth'],","+    targetCategories: ['Neck', 'Occlusion/Jaw Growth'],","+    targetKeywords: ['neck', 'posture', 'forward head'],","+    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },","+    cost: { type: 'flat', min: 0, max: 100, currency: 'USD' },","+    risks_side_effects: 'None.',","+    warnings: [],","+    gender: 'both',","+  },","+  {","+    ref_id: 'FND-04',","+    name: 'Skincare Routine (Retinoid + SPF)',","+    description: 'Medical-grade skincare to improve skin quality, texture, and reduce aging signs.',","+    phase: 'Foundational',","+    baseImpact: 0.20,","+    coverage: 2,","+    percentage: '2-5%',","+    expectedImprovementRange: { min: 0.1, max: 0.3 },","+    targetMetrics: [],","+    targetCategories: [],","+    targetKeywords: ['skin', 'texture', 'aging'],","+    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 26 },","+    cost: { type: 'per_month', min: 30, max: 150, currency: 'USD' },","+    risks_side_effects: 'Initial irritation, sun sensitivity.',","+    warnings: [],","+    gender: 'both',","+  },","+  {","+    ref_id: 'FND-05',","+    name: 'Eyebrow Grooming / Microblading',","+    description: 'Professional shaping or semi-permanent tattooing to optimize eyebrow shape and position.',","+    phase: 'Foundational',","+    baseImpact: 0.25,","+    coverage: 2,","+    percentage: '3-6%',","+    expectedImprovementRange: { min: 0.1, max: 0.3 },","+    targetMetrics: ['eyebrowTilt', 'eyebrowLowSetedness', 'browLengthRatio'],","+    targetCategories: ['Upper Third'],","+    targetKeywords: ['eyebrow', 'brow', 'upper third'],","+    timeline: { effect_start: 'immediate', full_results_weeks: 1 },","+    cost: { type: 'flat', min: 20, max: 600, currency: 'USD' },","+    risks_side_effects: 'Minimal for grooming. Microblading: infection risk, color fading.',","+    warnings: [],","+    gender: 'both',","+  },","+];","+","+// Calculate relevance score based on multiple factors","+function calculateRelevanceScore(","+  proc: ProcedureConfig,","+  flaw: Flaw,","+  allFlaws: Flaw[]","+): number {","+  let score = 0;","+","+  // Check metric ID match (highest priority)","+  const metricId = flaw.responsibleRatios[0]?.ratioId || '';","+  if (proc.targetMetrics.includes(metricId)) {","+    score += 40;","+  }","+","+  // Check category match","+  if (proc.targetCategories.some(cat =>","+    flaw.categoryName.toLowerCase().includes(cat.toLowerCase()) ||","+    cat.toLowerCase().includes(flaw.categoryName.toLowerCase())","+  )) {","+    score += 25;","+  }","+","+  // Check keyword match","+  const flawLower = flaw.flawName.toLowerCase();","+  const summaryLower = flaw.summary.toLowerCase();","+  const matchedKeywords = proc.targetKeywords.filter(kw =>","+    flawLower.includes(kw.toLowerCase()) || summaryLower.includes(kw.toLowerCase())","+  );","+  score += matchedKeywords.length * 10;","+","+  // Adjust by flaw severity/impact","+  score += Math.min(flaw.harmonyPercentageLost * 3, 15);","+","+  // Bonus if this procedure addresses multiple flaws","+  const otherFlawsAddressed = allFlaws.filter(f =>","+    f.id !== flaw.id && (","+      proc.targetMetrics.includes(f.responsibleRatios[0]?.ratioId || '') ||","+      proc.targetCategories.some(cat => f.categoryName.toLowerCase().includes(cat.toLowerCase()))","+    )","+  );","+  score += otherFlawsAddressed.length * 5;","+","+  return Math.min(score, 100);","+}","+","+function generateRecommendations(flaws: Flaw[], frontRatios: Ratio[] = [], sideRatios: Ratio[] = []): Recommendation[] {","   const recommendations: Recommendation[] = [];","+  const allRatios = [...frontRatios, ...sideRatios];"," ","-  const procedureDatabase: Array<Omit<Recommendation, 'matchedFlaws' | 'matchedRatios' | 'ratios_impacted'> & { targetFlaws: string[] }> = [","-    {","-      ref_id: 'SUR-01',","-      name: 'Genioplasty',","-      description: 'Surgical chin repositioning to improve chin projection and facial harmony. Can move the chin forward, backward, up, or down.',","-      phase: 'Surgical',","-      impact: 0.85,","-      coverage: 8,","-      percentage: '15-25%',","-      expectedImprovementRange: { min: 0.5, max: 1.5 },","-      targetFlaws: ['Weak chin', 'Recessed chin', 'Short chin', 'chin'],","-      timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },","-      cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },","-      risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage.',","-      warnings: [],","-      gender: 'both',","-    },","-    {","-      ref_id: 'SUR-02',","-      name: 'Rhinoplasty',","-      description: 'Nose reshaping surgery to improve nasal proportions, reduce or increase size, change angle, or correct breathing issues.',","-      phase: 'Surgical',","-      impact: 0.8,","-      coverage: 6,","-      percentage: '10-20%',","-      targetFlaws: ['Wide nose', 'Long nose', 'Crooked nose', 'nose', 'nasal'],","-      timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },","-      cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },","-      risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',","-      warnings: [],","-      gender: 'both',","-    },","-    {","-      ref_id: 'SUR-03',","-      name: 'Jaw Implants',","-      description: 'Custom or standard implants to enhance jaw width and definition. Creates a more angular, masculine jawline.',","-      phase: 'Surgical',","-      impact: 0.75,","-      coverage: 5,","-      percentage: '10-15%',","-      targetFlaws: ['Narrow jaw', 'Weak jaw', 'jaw'],","-      timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },","-      cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },","-      risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection.',","-      warnings: [],","-      gender: 'both',","-    },","-    {","-      ref_id: 'MIN-01',","-      name: 'Dermal Fillers',","-      description: 'Hyaluronic acid injections to add volume to chin, jawline, or cheeks. Non-permanent and reversible.',","-      phase: 'Minimally Invasive',","-      impact: 0.4,","-      coverage: 4,","-      percentage: '5-10%',","-      targetFlaws: ['Weak chin', 'Flat cheeks', 'chin', 'midface'],","-      timeline: { effect_start: 'immediate', full_results_weeks: 1 },","-      cost: { type: 'per_session', min: 600, max: 2000, currency: 'USD' },","-      risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',","-      warnings: ['Results temporary (6-18 months)'],","-      gender: 'both',","-    },","-    {","-      ref_id: 'MIN-02',","-      name: 'Orthodontic Treatment',","-      description: 'Braces or clear aligners to correct bite alignment and tooth positioning. Can impact facial profile over time.',","-      phase: 'Minimally Invasive',","-      impact: 0.5,","-      coverage: 3,","-      percentage: '5-15%',","-      targetFlaws: ['Bite issues', 'Midface recession', 'jaw'],","-      timeline: { effect_start: 'gradual', full_results_weeks: 52, full_results_weeks_max: 104 },","-      cost: { type: 'flat', min: 3000, max: 10000, currency: 'USD' },","-      risks_side_effects: 'Temporary discomfort, requires compliance.',","-      warnings: [],","-      gender: 'both',","-    },","-    {","-      ref_id: 'FND-01',","-      name: 'Mewing / Proper Tongue Posture',","-      description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',","-      phase: 'Foundational',","-      impact: 0.2,","-      coverage: 4,","-      percentage: '2-5%',","-      targetFlaws: ['Midface recession', 'Narrow palate', 'jaw', 'midface'],","-      timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },","-      cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },","-      risks_side_effects: 'None if done correctly. Jaw pain if excessive.',","-      warnings: ['Results vary significantly', 'Most effective in younger individuals'],","-      gender: 'both',","-    },","-    {","-      ref_id: 'FND-02',","-      name: 'Body Recomposition',","-      description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',","-      phase: 'Foundational',","-      impact: 0.3,","-      coverage: 6,","-      percentage: '5-10%',","-      targetFlaws: ['Undefined jawline', 'Soft features', 'jaw', 'face'],","-      timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },","-      cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },","-      risks_side_effects: 'None if done healthily.',","-      warnings: [],","-      gender: 'both',","-    },","-  ];","+  // Track which procedures have been added and their matched flaws","+  const procMatches: Map<string, { flaws: string[]; ratios: string[]; maxScore: number }> = new Map();"," ","   flaws.forEach(flaw => {","-    procedureDatabase.forEach(proc => {","-      const flawLower = flaw.flawName.toLowerCase();","-      const matches = proc.targetFlaws.some(target =>","-        flawLower.includes(target.toLowerCase()) || target.toLowerCase().includes(flawLower)","-      );","+    PROCEDURE_DATABASE.forEach(proc => {","+      const relevanceScore = calculateRelevanceScore(proc, flaw, flaws);"," ","-      if (matches && !recommendations.find(r => r.ref_id === proc.ref_id)) {","-        recommendations.push({","-          ...proc,","-          matchedFlaws: [flaw.flawName],","-          matchedRatios: flaw.responsibleRatios.map(r => r.ratioName),","-          ratios_impacted: flaw.responsibleRatios.map(r => ({","-            ratioId: r.ratioId,","-            ratioName: r.ratioName,","-            direction: 'both' as const,","-            percentageEffect: 1.0,","-          })),","-        });","+      if (relevanceScore >= 25) {  // Minimum threshold","+        const existing = procMatches.get(proc.ref_id);","+        if (existing) {","+          existing.flaws.push(flaw.flawName);","+          existing.ratios.push(...flaw.responsibleRatios.map(r => r.ratioName));","+          existing.maxScore = Math.max(existing.maxScore, relevanceScore);","+        } else {","+          procMatches.set(proc.ref_id, {","+            flaws: [flaw.flawName],","+            ratios: flaw.responsibleRatios.map(r => r.ratioName),","+            maxScore: relevanceScore,","+          });","+        }","       }","     });","   });"," ","-  return recommendations.sort((a, b) => b.impact - a.impact);","+  // Build recommendations from matched procedures","+  procMatches.forEach((match, procId) => {","+    const proc = PROCEDURE_DATABASE.find(p => p.ref_id === procId);","+    if (!proc) return;","+","+    // Calculate expected improvement based on severity of matched flaws","+    const matchedFlawDetails = flaws.filter(f => match.flaws.includes(f.flawName));","+    const avgImpact = matchedFlawDetails.reduce((sum, f) => sum + f.harmonyPercentageLost, 0) / matchedFlawDetails.length;","+    const severityMultiplier = Math.min(avgImpact / 3, 1.5);  // More severe = more potential improvement","+","+    // Get affected ratios from the actual data","+    const affectedRatios = allRatios.filter(r =>","+      proc.targetMetrics.includes(r.id) ||","+      match.flaws.some(f => f.toLowerCase().includes(r.category.toLowerCase()))","+    );","+","+    const adjustedImpact = proc.baseImpact * (0.8 + (match.maxScore / 500));  // Slight boost for high relevance","+","+    recommendations.push({","+      ref_id: proc.ref_id,","+      name: proc.name,","+      description: proc.description,","+      phase: proc.phase,","+      impact: adjustedImpact,","+      coverage: match.flaws.length + match.ratios.length,","+      percentage: proc.percentage,","+      expectedImprovementRange: {","+        min: proc.expectedImprovementRange.min * severityMultiplier,","+        max: proc.expectedImprovementRange.max * severityMultiplier,","+      },","+      matchedFlaws: [...new Set(match.flaws)],","+      matchedRatios: [...new Set(match.ratios)],","+      ratios_impacted: affectedRatios.map(r => ({","+        ratioId: r.id,","+        ratioName: r.name,","+        direction: 'both' as const,","+        percentageEffect: proc.baseImpact,","+      })),","+      timeline: proc.timeline,","+      cost: proc.cost,","+      risks_side_effects: proc.risks_side_effects,","+      warnings: proc.warnings,","+      gender: proc.gender,","+    });","+  });","+","+  // Sort by: phase priority (foundational first for accessibility), then impact","+  const phaseOrder: Record<string, number> = { 'Foundational': 1, 'Minimally Invasive': 2, 'Surgical': 3 };","+  return recommendations.sort((a, b) => {","+    // First sort by impact (higher = better)","+    const impactDiff = b.impact - a.impact;","+    if (Math.abs(impactDiff) > 0.1) return impactDiff;","+","+    // Then by coverage (more flaws addressed = better)","+    return b.coverage - a.coverage;","+  });"," }"," "," // ============================================"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"786b3a2d-92d8-4b40-b176-59d0f93231c8","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01C1fa7LzDhi3DgmyVifG5M1","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I need to update the call to `generateRecommendations` to pass the ratios. Let me find where that's called.","signature":"EpcCCkYIChgCKkCNFXKGQqgBNRZbVjxTc4tYHPH+38ex0utvzsT8zfBAC4iSZt8e4Gv69lXMLwyadm1UVyW07nrUCalg9MXk2VtREgyj2HV1or2T282O8wAaDJcaZuNCabl23JLBWCIwYBwe9jsYC86gfrwI11eA6Y7hK4Wsmi3nC3hmksWe+77v9oez4O3wNBMvStzUVgV+Kn+ovTXbTHWY2GY9SR4cpwjRus0ReTpamiLM/iNdXhO2x2FJ298Il1FGqrkiXlYTB1eAUDRPiEc7rbGMwvwZ6RNhbj/wepzld/eURvlTcZBhevt7HGnHokmyqKo6vewkMJhC1p3YwRRk/AgNSHSWeuysD+841snkHve4xTElJM6oGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":19243,"cache_read_input_tokens":112864,"cache_creation":{"ephemeral_5m_input_tokens":19243,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWJc9QxQeL6p8MW58QkXS","type":"assistant","uuid":"2f277029-e38b-4d6c-a495-4762f9535153","timestamp":"2025-12-20T20:56:18.615Z"}
{"parentUuid":"2f277029-e38b-4d6c-a495-4762f9535153","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01C1fa7LzDhi3DgmyVifG5M1","type":"message","role":"assistant","content":[{"type":"text","text":"Now I need to update the call to `generateRecommendations` to pass the ratios. Let me find and update that."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":19243,"cache_read_input_tokens":112864,"cache_creation":{"ephemeral_5m_input_tokens":19243,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWJc9QxQeL6p8MW58QkXS","type":"assistant","uuid":"57dffc96-60cf-417a-be19-aded42d072cd","timestamp":"2025-12-20T20:56:19.355Z"}
{"parentUuid":"57dffc96-60cf-417a-be19-aded42d072cd","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01C1fa7LzDhi3DgmyVifG5M1","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01P7vs7GFrdfjUCeQ71YY5US","name":"Grep","input":{"pattern":"generateRecommendations\\(flaws\\)","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","output_mode":"content","-n":true}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":19243,"cache_read_input_tokens":112864,"cache_creation":{"ephemeral_5m_input_tokens":19243,"ephemeral_1h_input_tokens":0},"output_tokens":209,"service_tier":"standard"}},"requestId":"req_011CWJc9QxQeL6p8MW58QkXS","type":"assistant","uuid":"21700f6f-0f72-4919-b82b-5e19817e2e3d","timestamp":"2025-12-20T20:56:21.507Z"}
{"parentUuid":"21700f6f-0f72-4919-b82b-5e19817e2e3d","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01P7vs7GFrdfjUCeQ71YY5US","type":"tool_result","content":"1208:    return generateRecommendations(flaws);"}]},"uuid":"ccf8f980-bafc-4e6b-9898-f7a713810692","timestamp":"2025-12-20T20:56:21.944Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"1208:    return generateRecommendations(flaws);","numLines":1}}
{"parentUuid":"ccf8f980-bafc-4e6b-9898-f7a713810692","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Bstsqfg2m8UEomUVZdjrnS","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"I need to update the call to pass the ratios.","signature":"EtUBCkYIChgCKkB+3rQEQg3cQPjldqaEQiPJzWqFx+Ou5IUDPw1pvB5yPEsQnF3C8u9JbLWJ1/knpeNT6ZI8D0UOwkJkG3G7WSM8EgzbqMJ8C3Z5QdB6/oIaDGWRzUWgXHO2lIFi0iIwB864NNisEh96iGbMIQC5804qZJWi9nVUJi9vytbQIdSp0FwuxDrj9N5o1lLoUIqZKj08WZQWZyTrXrScAsXr2+KrxFOMgGhrGUlD2CKhYsxT7CjL2ZtaUlwlA1mEcuo0VVFlAGZvjnOrsYeQZTzYGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":424,"cache_read_input_tokens":132107,"cache_creation":{"ephemeral_5m_input_tokens":424,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWJc9txPche9uu5ommqzQ","type":"assistant","uuid":"6841c84c-59b5-4af8-8fbc-e2b7779ea6e6","timestamp":"2025-12-20T20:56:24.305Z"}
{"parentUuid":"6841c84c-59b5-4af8-8fbc-e2b7779ea6e6","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Bstsqfg2m8UEomUVZdjrnS","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01U44NMkQyjCFpWFwq4woE8R","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","offset":1200,"limit":30}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":424,"cache_read_input_tokens":132107,"cache_creation":{"ephemeral_5m_input_tokens":424,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWJc9txPche9uu5ommqzQ","type":"assistant","uuid":"b569d92d-874b-477d-b820-a6074aaeea68","timestamp":"2025-12-20T20:56:25.385Z"}
{"parentUuid":"b569d92d-874b-477d-b820-a6074aaeea68","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01U44NMkQyjCFpWFwq4woE8R","type":"tool_result","content":"  1200→\n  1201→  const flaws = useMemo(() => {\n  1202→    if (!analysisResults?.harmony) return [];\n  1203→    return generateFlawsFromAnalysis(analysisResults.harmony);\n  1204→  }, [analysisResults]);\n  1205→\n  1206→  // Generate recommendations\n  1207→  const recommendations = useMemo(() => {\n  1208→    return generateRecommendations(flaws);\n  1209→  }, [flaws]);\n  1210→\n  1211→  // Build full harmony analysis\n  1212→  const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {\n  1213→    if (!analysisResults?.harmony) return null;\n  1214→\n  1215→    return {\n  1216→      standardizedScore: analysisResults.harmony.overallScore,\n  1217→      front: {\n  1218→        standardizedScore: analysisResults.harmony.frontScore,\n  1219→        ratios: frontRatios,\n  1220→      },\n  1221→      side: {\n  1222→        standardizedScore: analysisResults.harmony.sideScore,\n  1223→        ratios: sideRatios,\n  1224→      },\n  1225→      strengths,\n  1226→      flaws,\n  1227→    };\n  1228→  }, [analysisResults, frontRatios, sideRatios, strengths, flaws]);\n  1229→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"231dbea5-56b0-46ee-bc9b-af5725a7a513","timestamp":"2025-12-20T20:56:25.432Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","content":"\n  const flaws = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateFlawsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  // Generate recommendations\n  const recommendations = useMemo(() => {\n    return generateRecommendations(flaws);\n  }, [flaws]);\n\n  // Build full harmony analysis\n  const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {\n    if (!analysisResults?.harmony) return null;\n\n    return {\n      standardizedScore: analysisResults.harmony.overallScore,\n      front: {\n        standardizedScore: analysisResults.harmony.frontScore,\n        ratios: frontRatios,\n      },\n      side: {\n        standardizedScore: analysisResults.harmony.sideScore,\n        ratios: sideRatios,\n      },\n      strengths,\n      flaws,\n    };\n  }, [analysisResults, frontRatios, sideRatios, strengths, flaws]);\n","numLines":30,"startLine":1200,"totalLines":1280}}}
{"parentUuid":"231dbea5-56b0-46ee-bc9b-af5725a7a513","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01EU5rSBxqLEFtTKPTk5WAMb","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"I need to update the useMemo for recommendations to pass frontRatios and sideRatios.","signature":"EvwBCkYIChgCKkACKBJL2F/62AyFXMQdnZLceMcPL/5bPdoTvf5qNR+i5eLwftRucTAK3qFHZ5v2uEEfqZUxg5CuyOZoG9M0zd5hEgyw82zPjBRnU9dlTf0aDITxzipH2OBAx8L6niIwVZnp2XWCNzsK4zdaLXVBr6GMCWibi1385ahuJQnWqp6ZyfCj29rZ+1B5YXPiW9AEKmQcVnSsYAzDEs1AmDQLrKsiI9hfu2q4nbYTHEGOL9vWUwHb25c00/51QBx0+8m3fP+bnojt6o2C4QnW3usZh6HdB58EtZx46A2kqH26ILKjEbqOFim/+E0z3hjpJgFtcfqczKRbGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":613,"cache_read_input_tokens":132531,"cache_creation":{"ephemeral_5m_input_tokens":613,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWJcA9r6FCZnPb17AdMxt","type":"assistant","uuid":"f2a67c78-f94b-4b91-a2c0-8a759dfe659d","timestamp":"2025-12-20T20:56:27.641Z"}
{"parentUuid":"f2a67c78-f94b-4b91-a2c0-8a759dfe659d","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01EU5rSBxqLEFtTKPTk5WAMb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CEQpRXQfCQsnoJEWkD3P3M","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","old_string":"  // Generate recommendations\n  const recommendations = useMemo(() => {\n    return generateRecommendations(flaws);\n  }, [flaws]);","new_string":"  // Generate recommendations with metric-aware matching\n  const recommendations = useMemo(() => {\n    return generateRecommendations(flaws, frontRatios, sideRatios);\n  }, [flaws, frontRatios, sideRatios]);"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":613,"cache_read_input_tokens":132531,"cache_creation":{"ephemeral_5m_input_tokens":613,"ephemeral_1h_input_tokens":0},"output_tokens":243,"service_tier":"standard"}},"requestId":"req_011CWJcA9r6FCZnPb17AdMxt","type":"assistant","uuid":"e51e127a-78e7-48e5-9236-cfb355ec2046","timestamp":"2025-12-20T20:56:29.949Z"}
{"parentUuid":"e51e127a-78e7-48e5-9236-cfb355ec2046","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CEQpRXQfCQsnoJEWkD3P3M","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  1202→    if (!analysisResults?.harmony) return [];\n  1203→    return generateFlawsFromAnalysis(analysisResults.harmony);\n  1204→  }, [analysisResults]);\n  1205→\n  1206→  // Generate recommendations with metric-aware matching\n  1207→  const recommendations = useMemo(() => {\n  1208→    return generateRecommendations(flaws, frontRatios, sideRatios);\n  1209→  }, [flaws, frontRatios, sideRatios]);\n  1210→\n  1211→  // Build full harmony analysis\n  1212→  const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {\n  1213→    if (!analysisResults?.harmony) return null;"}]},"uuid":"012e9b1d-0fae-404d-8f39-aabf8f4fa514","timestamp":"2025-12-20T20:56:29.982Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","oldString":"  // Generate recommendations\n  const recommendations = useMemo(() => {\n    return generateRecommendations(flaws);\n  }, [flaws]);","newString":"  // Generate recommendations with metric-aware matching\n  const recommendations = useMemo(() => {\n    return generateRecommendations(flaws, frontRatios, sideRatios);\n  }, [flaws, frontRatios, sideRatios]);","originalFile":"'use client';\n\nimport React, { createContext, useContext, useState, useMemo, useCallback, ReactNode } from 'react';\nimport { LandmarkPoint } from '@/lib/landmarks';\nimport {\n  analyzeFrontProfile,\n  analyzeSideProfile,\n  analyzeHarmony,\n  HarmonyAnalysis,\n  FaceIQScoreResult,\n  FACEIQ_METRICS,\n  Ethnicity,\n  Gender,\n} from '@/lib/faceiq-scoring';\nimport {\n  Ratio,\n  Strength,\n  Flaw,\n  Recommendation,\n  ResultsTab,\n  FullHarmonyAnalysis,\n} from '@/types/results';\n\n// ============================================\n// CONTEXT TYPES\n// ============================================\n\ninterface ResultsContextType {\n  // Raw data\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  gender: Gender;\n  ethnicity: Ethnicity;\n  frontPhoto: string;\n  sidePhoto: string | null;\n\n  // Computed results\n  harmonyAnalysis: FullHarmonyAnalysis | null;\n  frontRatios: Ratio[];\n  sideRatios: Ratio[];\n  strengths: Strength[];\n  flaws: Flaw[];\n  recommendations: Recommendation[];\n\n  // Scores\n  overallScore: number;\n  frontScore: number;\n  sideScore: number;\n\n  // UI state\n  activeTab: ResultsTab;\n  setActiveTab: (tab: ResultsTab) => void;\n  expandedMeasurementId: string | null;\n  setExpandedMeasurementId: (id: string | null) => void;\n  selectedVisualizationMetric: string | null;\n  setSelectedVisualizationMetric: (id: string | null) => void;\n  categoryFilter: string | null;\n  setCategoryFilter: (category: string | null) => void;\n  showLandmarkOverlay: boolean;\n  setShowLandmarkOverlay: (show: boolean) => void;\n\n  // Actions\n  setResultsData: (data: ResultsInputData) => void;\n}\n\ninterface ResultsInputData {\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  frontPhoto: string;\n  sidePhoto?: string;\n  gender: Gender;\n  ethnicity?: Ethnicity;\n}\n\n// ============================================\n// HELPER FUNCTIONS\n// ============================================\n\nfunction convertUnitToRatioUnit(unit: string): 'x' | 'mm' | '%' | '°' {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return '°';\n    case 'mm': return 'mm';\n    default: return 'x';\n  }\n}\n\nfunction transformToRatio(result: FaceIQScoreResult, landmarks: LandmarkPoint[]): Ratio {\n  const metricConfig = FACEIQ_METRICS[result.metricId];\n\n  // Generate illustration based on metric\n  const illustration = generateIllustration(result.metricId, landmarks);\n\n  // Get flaw/strength mappings\n  const { mayIndicateFlaws, mayIndicateStrengths } = getFlawStrengthMappings(result);\n\n  return {\n    id: result.metricId,\n    name: result.name,\n    value: result.value,\n    score: result.score,\n    standardizedScore: result.standardizedScore,\n    unit: convertUnitToRatioUnit(result.unit),\n    idealMin: result.idealMin,\n    idealMax: result.idealMax,\n    rangeMin: metricConfig?.rangeMin || result.idealMin - 0.5,\n    rangeMax: metricConfig?.rangeMax || result.idealMax + 0.5,\n    description: metricConfig?.description || '',\n    category: result.category,\n    qualityLevel: result.qualityTier,\n    severity: result.severity,\n    illustration,\n    mayIndicateFlaws,\n    mayIndicateStrengths,\n    usedLandmarks: getUsedLandmarks(result.metricId),\n    scoringCurveConfig: metricConfig ? {\n      decayRate: metricConfig.decayRate,\n      maxScore: metricConfig.maxScore,\n    } : undefined,\n  };\n}\n\n// Enhanced illustration configuration type\ninterface IllustrationConfig {\n  points: string[];\n  lines: Array<{\n    from: string;\n    to: string;\n    label?: string;\n    color?: string;\n    labelPosition?: 'left' | 'right' | 'top' | 'bottom';\n  }>;\n}\n\n// Comprehensive illustration configurations for all metrics\nconst ILLUSTRATION_CONFIGS: Record<string, IllustrationConfig> = {\n  // ==========================================\n  // FACE SHAPE / PROPORTIONS\n  // ==========================================\n  faceWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'top' },\n      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'right' },\n    ],\n  },\n  totalFacialWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n      { from: 'trichion', to: 'menton', label: 'Total Height', color: '#a78bfa' },\n    ],\n  },\n  lowerThirdProportion: {\n    points: ['subnasale', 'menton', 'trichion'],\n    lines: [\n      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  middleThirdProportion: {\n    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n    lines: [\n      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  upperThirdProportion: {\n    points: ['trichion', 'nasal_base', 'menton'],\n    lines: [\n      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  bitemporalWidth: {\n    points: ['left_temporal', 'right_temporal', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_temporal', to: 'right_temporal', label: 'Temple', color: '#fbbf24' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek', color: '#67e8f9' },\n    ],\n  },\n  cheekboneHeight: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_lateralis', 'right_canthus_lateralis', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheekbone', color: '#ec4899' },\n      { from: 'left_canthus_lateralis', to: 'left_zygion', color: '#67e8f9' },\n    ],\n  },\n  midfaceRatio: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_medialis', 'right_canthus_medialis', 'subnasale'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Midface Width', color: '#67e8f9' },\n      { from: 'left_canthus_medialis', to: 'subnasale', label: 'Midface Height', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // JAW MEASUREMENTS\n  // ==========================================\n  jawSlope: {\n    points: ['left_gonion_inferior', 'left_mentum_lateralis', 'menton', 'right_mentum_lateralis', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'left_mentum_lateralis', label: 'Jaw Slope', color: '#f97316' },\n      { from: 'right_gonion_inferior', to: 'right_mentum_lateralis', color: '#f97316' },\n    ],\n  },\n  jawFrontalAngle: {\n    points: ['left_gonion_inferior', 'menton', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'menton', label: 'Jaw Angle', color: '#f97316' },\n      { from: 'menton', to: 'right_gonion_inferior', color: '#f97316' },\n    ],\n  },\n  bigonialWidth: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw Width', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n    ],\n  },\n  jawWidthRatio: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face', color: '#67e8f9' },\n    ],\n  },\n\n  // ==========================================\n  // EYE MEASUREMENTS\n  // ==========================================\n  lateralCanthalTilt: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'bottom' },\n      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n    ],\n  },\n  eyeAspectRatio: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'left_palpebra_superior', 'left_palpebra_inferior'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Width', color: '#06b6d4' },\n      { from: 'left_palpebra_superior', to: 'left_palpebra_inferior', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  eyeSeparationRatio: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryMouthWidthRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_cheilion', 'right_cheilion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n    ],\n  },\n  oneEyeApartTest: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Between Eyes', color: '#06b6d4' },\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Eye Width', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // EYEBROW MEASUREMENTS\n  // ==========================================\n  browLengthRatio: {\n    points: ['left_supercilium_medialis', 'left_supercilium_lateralis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_lateralis', label: 'Brow', color: '#84cc16' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  eyebrowTilt: {\n    points: ['left_supercilium_medialis', 'left_supercilium_apex', 'left_supercilium_lateralis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_apex', label: 'Tilt', color: '#84cc16' },\n      { from: 'left_supercilium_apex', to: 'left_supercilium_lateralis', color: '#84cc16' },\n    ],\n  },\n  eyebrowLowSetedness: {\n    points: ['left_supercilium_medialis', 'left_palpebra_superior', 'left_canthus_medialis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_palpebra_superior', label: 'Brow-Eye Gap', color: '#84cc16' },\n    ],\n  },\n\n  // ==========================================\n  // NOSE MEASUREMENTS (FRONT)\n  // ==========================================\n  nasalIndex: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Width', color: '#fbbf24' },\n      { from: 'nasal_base', to: 'subnasale', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  intercanthalNasalRatio: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'left_canthus_medialis', 'right_canthus_medialis'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose Width', color: '#fbbf24' },\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n    ],\n  },\n  noseBridgeWidth: {\n    points: ['left_dorsum_nasi', 'right_dorsum_nasi', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_dorsum_nasi', to: 'right_dorsum_nasi', label: 'Bridge', color: '#fbbf24' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Base', color: '#f97316' },\n    ],\n  },\n  noseTipPosition: {\n    points: ['subnasale', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Tip Position', color: '#fbbf24' },\n    ],\n  },\n\n  // ==========================================\n  // MOUTH/LIP MEASUREMENTS\n  // ==========================================\n  mouthNoseWidthRatio: {\n    points: ['left_cheilion', 'right_cheilion', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  lowerUpperLipRatio: {\n    points: ['labrale_superius', 'mouth_middle', 'labrale_inferius'],\n    lines: [\n      { from: 'labrale_superius', to: 'mouth_middle', label: 'Upper', color: '#ec4899' },\n      { from: 'mouth_middle', to: 'labrale_inferius', label: 'Lower', color: '#f97316' },\n    ],\n  },\n  chinPhiltrumRatio: {\n    points: ['subnasale', 'labrale_superius', 'labrale_inferius', 'menton'],\n    lines: [\n      { from: 'subnasale', to: 'labrale_superius', label: 'Philtrum', color: '#ec4899' },\n      { from: 'labrale_inferius', to: 'menton', label: 'Chin', color: '#ef4444' },\n    ],\n  },\n  mouthWidth: {\n    points: ['left_cheilion', 'right_cheilion'],\n    lines: [{ from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth Width', color: '#ec4899' }],\n  },\n\n  // ==========================================\n  // CHIN MEASUREMENTS\n  // ==========================================\n  chinHeight: {\n    points: ['labrale_inferius', 'menton'],\n    lines: [{ from: 'labrale_inferius', to: 'menton', label: 'Chin Height', color: '#ef4444' }],\n  },\n\n  // ==========================================\n  // NECK MEASUREMENTS\n  // ==========================================\n  neckWidthRatio: {\n    points: ['left_cervical_lateralis', 'right_cervical_lateralis', 'left_gonion_inferior', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_cervical_lateralis', to: 'right_cervical_lateralis', label: 'Neck', color: '#14b8a6' },\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n    ],\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS\n  // ==========================================\n  gonialAngle: {\n    points: ['tragus', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'tragus', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  nasofrontalAngle: {\n    points: ['glabella', 'nasion', 'pronasale'],\n    lines: [\n      { from: 'glabella', to: 'nasion', label: 'Forehead', color: '#84cc16' },\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  nasofacialAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', color: '#67e8f9' },\n    ],\n  },\n  nasomentaAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', label: 'To Chin', color: '#ef4444' },\n    ],\n  },\n  submentalCervicalAngle: {\n    points: ['menton', 'cervicalPoint', 'neckPoint'],\n    lines: [\n      { from: 'menton', to: 'cervicalPoint', label: 'Submental', color: '#14b8a6' },\n      { from: 'cervicalPoint', to: 'neckPoint', label: 'Cervical', color: '#06b6d4' },\n    ],\n  },\n  facialDepthToHeight: {\n    points: ['pronasale', 'tragus', 'nasion', 'menton'],\n    lines: [\n      { from: 'pronasale', to: 'tragus', label: 'Depth', color: '#67e8f9' },\n      { from: 'nasion', to: 'menton', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  anteriorFacialDepth: {\n    points: ['glabella', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'glabella', to: 'pronasale', color: '#67e8f9' },\n      { from: 'pronasale', to: 'pogonion', color: '#a78bfa' },\n    ],\n  },\n  mandibularPlaneAngle: {\n    points: ['gonionBottom', 'menton', 'orbitale', 'porion'],\n    lines: [\n      { from: 'gonionBottom', to: 'menton', label: 'Mandibular', color: '#f97316' },\n      { from: 'orbitale', to: 'porion', label: 'Frankfort', color: '#67e8f9' },\n    ],\n  },\n  ramusToMandibleRatio: {\n    points: ['gonionTop', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'gonionTop', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  orbitalVector: {\n    points: ['cornealApex', 'orbitale', 'cheekbone'],\n    lines: [\n      { from: 'cornealApex', to: 'cheekbone', label: 'Orbital Vector', color: '#06b6d4' },\n    ],\n  },\n  eLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'E-Line', color: '#67e8f9' },\n    ],\n  },\n  sLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'S-Line', color: '#a78bfa' },\n    ],\n  },\n  holdawayHLine: {\n    points: ['pronasale', 'pogonion', 'labraleSuperius', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'H-Line', color: '#ec4899' },\n    ],\n  },\n  burstoneLowerLip: {\n    points: ['subnasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'subnasale', to: 'pogonion', label: 'Burstone', color: '#fbbf24' },\n    ],\n  },\n};\n\nfunction generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  const config = ILLUSTRATION_CONFIGS[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = {\n        from: line.from,\n        to: line.to,\n        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}\n\nfunction getUsedLandmarks(metricId: string): string[] {\n  const landmarkMappings: Record<string, string[]> = {\n    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lateralCanthalTilt: ['left_canthus_medialis', 'left_canthus_lateralis'],\n    nasalIndex: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    ipd: ['left_pupila', 'right_pupila'],\n    mouthWidth: ['left_cheilion', 'right_cheilion'],\n    jawWidth: ['left_gonion_inferior', 'right_gonion_inferior'],\n    chinHeight: ['labrale_inferius', 'menton'],\n    gonialAngle: ['tragus', 'gonionBottom', 'menton'],\n  };\n  return landmarkMappings[metricId] || [];\n}\n\nfunction getFlawStrengthMappings(result: FaceIQScoreResult): { mayIndicateFlaws: string[]; mayIndicateStrengths: string[] } {\n  const flawMappings: Record<string, { low: string[]; high: string[] }> = {\n    faceWidthToHeight: {\n      low: ['Narrow face', 'Vertically elongated face'],\n      high: ['Wide face', 'Horizontally expanded face'],\n    },\n    lowerThirdProportion: {\n      low: ['Short lower third', 'Deficient mandible'],\n      high: ['Long lower third', 'Mandibular excess'],\n    },\n    lateralCanthalTilt: {\n      low: ['Negative canthal tilt', 'Drooping eyes'],\n      high: ['Excessive positive canthal tilt'],\n    },\n    nasalIndex: {\n      low: ['Narrow nose', 'Leptorrhine nose'],\n      high: ['Wide nose', 'Platyrrhine nose'],\n    },\n    gonialAngle: {\n      low: ['Steep mandibular plane'],\n      high: ['Flat mandibular plane', 'Weak jaw definition'],\n    },\n  };\n\n  const strengthMappings: Record<string, { ideal: string[] }> = {\n    faceWidthToHeight: { ideal: ['Balanced facial proportions', 'Harmonious face shape'] },\n    lateralCanthalTilt: { ideal: ['Attractive eye shape', 'Positive canthal tilt'] },\n    nasalIndex: { ideal: ['Well-proportioned nose', 'Balanced nasal width'] },\n    gonialAngle: { ideal: ['Well-defined jawline', 'Strong jaw structure'] },\n  };\n\n  const mapping = flawMappings[result.metricId];\n  const strengthMapping = strengthMappings[result.metricId];\n\n  let mayIndicateFlaws: string[] = [];\n  let mayIndicateStrengths: string[] = [];\n\n  if (result.qualityTier === 'ideal' || result.qualityTier === 'excellent') {\n    mayIndicateStrengths = strengthMapping?.ideal || [];\n  } else if (mapping) {\n    mayIndicateFlaws = result.deviationDirection === 'below' ? mapping.low : mapping.high;\n  }\n\n  return { mayIndicateFlaws, mayIndicateStrengths };\n}\n\nfunction generateStrengthsFromAnalysis(analysis: HarmonyAnalysis): Strength[] {\n  const strengths: Strength[] = [];\n\n  analysis.strengths.forEach((s, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === s.metricId);\n\n    strengths.push({\n      id: `strength_${i}`,\n      strengthName: s.metricName,\n      summary: s.reasoning,\n      avgScore: matchingMeasurement?.score || 8,\n      qualityLevel: s.qualityTier,\n      categoryName: s.category,\n      responsibleRatios: [{\n        ratioName: s.metricName,\n        ratioId: s.metricId,\n        score: matchingMeasurement?.score || 8,\n        value: s.value,\n      }],\n    });\n  });\n\n  return strengths;\n}\n\nfunction generateFlawsFromAnalysis(analysis: HarmonyAnalysis): Flaw[] {\n  const flaws: Flaw[] = [];\n  let rollingLost = 0;\n\n  analysis.flaws.forEach((f, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === f.metricId);\n    const impact = matchingMeasurement ? (10 - matchingMeasurement.score) * 0.5 : 2;\n    rollingLost += impact;\n\n    flaws.push({\n      id: `flaw_${i}`,\n      flawName: f.metricName,\n      summary: f.reasoning,\n      harmonyPercentageLost: impact,\n      standardizedImpact: impact / 10,\n      categoryName: f.category,\n      responsibleRatios: [{\n        ratioName: f.metricName,\n        ratioId: f.metricId,\n        score: matchingMeasurement?.score || 3,\n        value: matchingMeasurement?.value || 0,\n      }],\n      rollingPointsDeducted: rollingLost,\n      rollingHarmonyPercentageLost: rollingLost,\n      rollingStandardizedImpact: rollingLost / 10,\n    });\n  });\n\n  return flaws.sort((a, b) => b.harmonyPercentageLost - a.harmonyPercentageLost);\n}\n\n// Comprehensive procedure database with metric-specific targeting\ninterface ProcedureConfig {\n  ref_id: string;\n  name: string;\n  description: string;\n  phase: 'Surgical' | 'Minimally Invasive' | 'Foundational';\n  baseImpact: number;\n  coverage: number;\n  percentage: string;\n  expectedImprovementRange: { min: number; max: number };\n  targetMetrics: string[];  // Specific metric IDs this treatment addresses\n  targetCategories: string[];  // Category names this treatment addresses\n  targetKeywords: string[];  // Flaw name keywords to match\n  timeline: { effect_start: 'immediate' | 'delayed' | 'gradual'; full_results_weeks: number; full_results_weeks_max?: number };\n  cost: { type: 'flat' | 'per_session' | 'per_month'; min: number; max: number; currency: string };\n  risks_side_effects: string;\n  warnings: string[];\n  gender: 'male' | 'female' | 'both';\n}\n\nconst PROCEDURE_DATABASE: ProcedureConfig[] = [\n  // ==========================================\n  // SURGICAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'SUR-01',\n    name: 'Sliding Genioplasty',\n    description: 'Chin bone repositioning surgery that can move the chin forward, backward, up, or down for optimal projection and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.90,\n    coverage: 8,\n    percentage: '15-25%',\n    expectedImprovementRange: { min: 0.5, max: 1.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'facialDepthToHeight', 'anteriorFacialDepth', 'nasomentaAngle'],\n    targetCategories: ['Chin', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['chin', 'recessed', 'weak', 'short chin', 'long chin', 'pogonion'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage, bone resorption.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-02',\n    name: 'Reduction Rhinoplasty',\n    description: 'Surgical reduction of nose size, hump removal, and tip refinement to improve nasal proportions.',\n    phase: 'Surgical',\n    baseImpact: 0.85,\n    coverage: 6,\n    percentage: '10-20%',\n    expectedImprovementRange: { min: 0.5, max: 1.0 },\n    targetMetrics: ['nasalIndex', 'nasofrontalAngle', 'nasofacialAngle', 'nasomentaAngle', 'intercanthalNasalRatio', 'noseBridgeWidth'],\n    targetCategories: ['Nose'],\n    targetKeywords: ['wide nose', 'large nose', 'dorsal hump', 'bulbous', 'nasal', 'nose bridge'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 7000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-03',\n    name: 'Jaw Angle Implants',\n    description: 'Custom or standard silicone/PEEK implants to enhance jaw width, definition, and angularity.',\n    phase: 'Surgical',\n    baseImpact: 0.80,\n    coverage: 5,\n    percentage: '10-15%',\n    expectedImprovementRange: { min: 0.4, max: 1.0 },\n    targetMetrics: ['bigonialWidth', 'jawFrontalAngle', 'jawWidthRatio', 'jawSlope', 'gonialAngle'],\n    targetCategories: ['Jaw Shape'],\n    targetKeywords: ['narrow jaw', 'weak jaw', 'soft jaw', 'jaw angle', 'gonial', 'mandible'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection, bone erosion.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-04',\n    name: 'Bimaxillary Osteotomy (Bimax)',\n    description: 'Double jaw surgery to reposition both upper and lower jaws for optimal occlusion and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.95,\n    coverage: 12,\n    percentage: '20-35%',\n    expectedImprovementRange: { min: 1.0, max: 2.0 },\n    targetMetrics: ['midfaceRatio', 'facialDepthToHeight', 'mandibularPlaneAngle', 'lowerThirdProportion', 'nasofacialAngle'],\n    targetCategories: ['Occlusion/Jaw Growth', 'Midface/Face Shape'],\n    targetKeywords: ['maxillary recession', 'mandibular', 'hyper-divergent', 'bite', 'occlusion', 'midface recession'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 20000, max: 60000, currency: 'USD' },\n    risks_side_effects: 'Extended recovery, numbness (temporary to permanent), dietary restrictions.',\n    warnings: ['Major surgery - requires orthodontic preparation'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-05',\n    name: 'Canthoplasty',\n    description: 'Surgical eye corner modification to improve canthal tilt and eye shape.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.8 },\n    targetMetrics: ['lateralCanthalTilt', 'eyeAspectRatio'],\n    targetCategories: ['Eyes'],\n    targetKeywords: ['canthal tilt', 'negative tilt', 'drooping eyes', 'eye shape', 'eye angle'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 4000, max: 12000, currency: 'USD' },\n    risks_side_effects: 'Scarring, asymmetry, dry eyes, ectropion.',\n    warnings: ['Difficult to reverse'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-06',\n    name: 'Cheek/Malar Implants',\n    description: 'Solid implants placed over the cheekbones to enhance midface projection and width.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 4,\n    percentage: '10-18%',\n    expectedImprovementRange: { min: 0.4, max: 0.9 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio', 'totalFacialWidthToHeight'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface', 'zygomatic', 'malar'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 6, full_results_weeks_max: 12 },\n    cost: { type: 'flat', min: 6000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry, implant shifting, nerve damage.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-07',\n    name: 'Neck Liposuction / Submentoplasty',\n    description: 'Fat removal and skin tightening under the chin and neck area.',\n    phase: 'Surgical',\n    baseImpact: 0.65,\n    coverage: 3,\n    percentage: '8-12%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['round neck', 'double chin', 'submental', 'cervical', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 3000, max: 8000, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, skin irregularity, numbness.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-08',\n    name: 'Brow Bone Reduction/Augmentation',\n    description: 'Surgical reshaping of the brow ridge for improved upper third harmony.',\n    phase: 'Surgical',\n    baseImpact: 0.70,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['nasofrontalAngle', 'bitemporalWidth', 'upperThirdProportion'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['brow ridge', 'forehead', 'nasofrontal', 'upper third', 'glabella'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling, numbness, scarring (if coronal incision).',\n    warnings: [],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // MINIMALLY INVASIVE TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'MIN-01',\n    name: 'Chin/Jawline Filler',\n    description: 'Hyaluronic acid injections to enhance chin projection and jawline definition. Reversible and temporary.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 4,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'jawFrontalAngle', 'bigonialWidth'],\n    targetCategories: ['Chin', 'Jaw Shape'],\n    targetKeywords: ['weak chin', 'recessed chin', 'soft jaw', 'jawline'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 800, max: 2500, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n    warnings: ['Results temporary (12-18 months)', 'Requires maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-02',\n    name: 'Cheek Filler',\n    description: 'HA filler to enhance cheekbone projection and midface volume.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 3,\n    percentage: '5-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface volume'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 600, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, asymmetry.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-03',\n    name: 'Lip Filler',\n    description: 'Hyaluronic acid to enhance lip volume and proportions.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['lowerUpperLipRatio', 'mouthNoseWidthRatio'],\n    targetCategories: ['Lips'],\n    targetKeywords: ['thin lip', 'lip ratio', 'lip volume', 'upper lip', 'lower lip'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 400, max: 1200, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, lumps.',\n    warnings: ['Results temporary (6-12 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-04',\n    name: 'PDO Thread Lift',\n    description: 'Dissolvable threads to lift and tighten skin, particularly for canthal tilt improvement.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 3,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.1, max: 0.4 },\n    targetMetrics: ['lateralCanthalTilt', 'eyebrowLowSetedness'],\n    targetCategories: ['Eyes', 'Upper Third'],\n    targetKeywords: ['canthal tilt', 'drooping', 'sagging', 'eyebrow position'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 1500, max: 4000, currency: 'USD' },\n    risks_side_effects: 'Bruising, asymmetry, thread visibility, infection.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-05',\n    name: 'Masseter Botox',\n    description: 'Botulinum toxin to slim the lower face by relaxing masseter muscles.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 2,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['bigonialWidth', 'jawWidthRatio', 'faceWidthToHeight'],\n    targetCategories: ['Jaw Shape', 'Midface/Face Shape'],\n    targetKeywords: ['wide jaw', 'square jaw', 'masseter', 'bruxism'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 400, max: 1000, currency: 'USD' },\n    risks_side_effects: 'Temporary weakness, asymmetry, difficulty chewing.',\n    warnings: ['Results temporary (4-6 months)', 'Requires regular maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-06',\n    name: 'Kybella (Submental Fat Dissolving)',\n    description: 'Injectable deoxycholic acid to permanently destroy fat cells under the chin.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 2,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['double chin', 'submental fat', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'per_session', min: 1200, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, numbness, difficulty swallowing (temporary).',\n    warnings: ['Requires 2-4 sessions'],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // FOUNDATIONAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'FND-01',\n    name: 'Mewing / Proper Tongue Posture',\n    description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 5,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['midfaceRatio', 'bigonialWidth', 'facialDepthToHeight'],\n    targetCategories: ['Midface/Face Shape', 'Jaw Shape', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['midface', 'palate', 'recession', 'jaw development'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n    cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n    risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n    warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-02',\n    name: 'Body Recomposition (Leanmaxxing)',\n    description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n    phase: 'Foundational',\n    baseImpact: 0.35,\n    coverage: 6,\n    percentage: '5-12%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['bigonialWidth', 'submentalCervicalAngle', 'cheekboneHeight'],\n    targetCategories: ['Jaw Shape', 'Neck', 'Midface/Face Shape'],\n    targetKeywords: ['soft jaw', 'undefined', 'round', 'facial definition'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n    risks_side_effects: 'None if done healthily.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-03',\n    name: 'Posture Correction',\n    description: 'Improving head and neck posture to optimize facial appearance and reduce forward head posture effects.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 3,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.2 },\n    targetMetrics: ['submentalCervicalAngle', 'anteriorFacialDepth'],\n    targetCategories: ['Neck', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['neck', 'posture', 'forward head'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 0, max: 100, currency: 'USD' },\n    risks_side_effects: 'None.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-04',\n    name: 'Skincare Routine (Retinoid + SPF)',\n    description: 'Medical-grade skincare to improve skin quality, texture, and reduce aging signs.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 2,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: [],\n    targetCategories: [],\n    targetKeywords: ['skin', 'texture', 'aging'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 26 },\n    cost: { type: 'per_month', min: 30, max: 150, currency: 'USD' },\n    risks_side_effects: 'Initial irritation, sun sensitivity.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-05',\n    name: 'Eyebrow Grooming / Microblading',\n    description: 'Professional shaping or semi-permanent tattooing to optimize eyebrow shape and position.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['eyebrowTilt', 'eyebrowLowSetedness', 'browLengthRatio'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['eyebrow', 'brow', 'upper third'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'flat', min: 20, max: 600, currency: 'USD' },\n    risks_side_effects: 'Minimal for grooming. Microblading: infection risk, color fading.',\n    warnings: [],\n    gender: 'both',\n  },\n];\n\n// Calculate relevance score based on multiple factors\nfunction calculateRelevanceScore(\n  proc: ProcedureConfig,\n  flaw: Flaw,\n  allFlaws: Flaw[]\n): number {\n  let score = 0;\n\n  // Check metric ID match (highest priority)\n  const metricId = flaw.responsibleRatios[0]?.ratioId || '';\n  if (proc.targetMetrics.includes(metricId)) {\n    score += 40;\n  }\n\n  // Check category match\n  if (proc.targetCategories.some(cat =>\n    flaw.categoryName.toLowerCase().includes(cat.toLowerCase()) ||\n    cat.toLowerCase().includes(flaw.categoryName.toLowerCase())\n  )) {\n    score += 25;\n  }\n\n  // Check keyword match\n  const flawLower = flaw.flawName.toLowerCase();\n  const summaryLower = flaw.summary.toLowerCase();\n  const matchedKeywords = proc.targetKeywords.filter(kw =>\n    flawLower.includes(kw.toLowerCase()) || summaryLower.includes(kw.toLowerCase())\n  );\n  score += matchedKeywords.length * 10;\n\n  // Adjust by flaw severity/impact\n  score += Math.min(flaw.harmonyPercentageLost * 3, 15);\n\n  // Bonus if this procedure addresses multiple flaws\n  const otherFlawsAddressed = allFlaws.filter(f =>\n    f.id !== flaw.id && (\n      proc.targetMetrics.includes(f.responsibleRatios[0]?.ratioId || '') ||\n      proc.targetCategories.some(cat => f.categoryName.toLowerCase().includes(cat.toLowerCase()))\n    )\n  );\n  score += otherFlawsAddressed.length * 5;\n\n  return Math.min(score, 100);\n}\n\nfunction generateRecommendations(flaws: Flaw[], frontRatios: Ratio[] = [], sideRatios: Ratio[] = []): Recommendation[] {\n  const recommendations: Recommendation[] = [];\n  const allRatios = [...frontRatios, ...sideRatios];\n\n  // Track which procedures have been added and their matched flaws\n  const procMatches: Map<string, { flaws: string[]; ratios: string[]; maxScore: number }> = new Map();\n\n  flaws.forEach(flaw => {\n    PROCEDURE_DATABASE.forEach(proc => {\n      const relevanceScore = calculateRelevanceScore(proc, flaw, flaws);\n\n      if (relevanceScore >= 25) {  // Minimum threshold\n        const existing = procMatches.get(proc.ref_id);\n        if (existing) {\n          existing.flaws.push(flaw.flawName);\n          existing.ratios.push(...flaw.responsibleRatios.map(r => r.ratioName));\n          existing.maxScore = Math.max(existing.maxScore, relevanceScore);\n        } else {\n          procMatches.set(proc.ref_id, {\n            flaws: [flaw.flawName],\n            ratios: flaw.responsibleRatios.map(r => r.ratioName),\n            maxScore: relevanceScore,\n          });\n        }\n      }\n    });\n  });\n\n  // Build recommendations from matched procedures\n  procMatches.forEach((match, procId) => {\n    const proc = PROCEDURE_DATABASE.find(p => p.ref_id === procId);\n    if (!proc) return;\n\n    // Calculate expected improvement based on severity of matched flaws\n    const matchedFlawDetails = flaws.filter(f => match.flaws.includes(f.flawName));\n    const avgImpact = matchedFlawDetails.reduce((sum, f) => sum + f.harmonyPercentageLost, 0) / matchedFlawDetails.length;\n    const severityMultiplier = Math.min(avgImpact / 3, 1.5);  // More severe = more potential improvement\n\n    // Get affected ratios from the actual data\n    const affectedRatios = allRatios.filter(r =>\n      proc.targetMetrics.includes(r.id) ||\n      match.flaws.some(f => f.toLowerCase().includes(r.category.toLowerCase()))\n    );\n\n    const adjustedImpact = proc.baseImpact * (0.8 + (match.maxScore / 500));  // Slight boost for high relevance\n\n    recommendations.push({\n      ref_id: proc.ref_id,\n      name: proc.name,\n      description: proc.description,\n      phase: proc.phase,\n      impact: adjustedImpact,\n      coverage: match.flaws.length + match.ratios.length,\n      percentage: proc.percentage,\n      expectedImprovementRange: {\n        min: proc.expectedImprovementRange.min * severityMultiplier,\n        max: proc.expectedImprovementRange.max * severityMultiplier,\n      },\n      matchedFlaws: [...new Set(match.flaws)],\n      matchedRatios: [...new Set(match.ratios)],\n      ratios_impacted: affectedRatios.map(r => ({\n        ratioId: r.id,\n        ratioName: r.name,\n        direction: 'both' as const,\n        percentageEffect: proc.baseImpact,\n      })),\n      timeline: proc.timeline,\n      cost: proc.cost,\n      risks_side_effects: proc.risks_side_effects,\n      warnings: proc.warnings,\n      gender: proc.gender,\n    });\n  });\n\n  // Sort by: phase priority (foundational first for accessibility), then impact\n  const phaseOrder: Record<string, number> = { 'Foundational': 1, 'Minimally Invasive': 2, 'Surgical': 3 };\n  return recommendations.sort((a, b) => {\n    // First sort by impact (higher = better)\n    const impactDiff = b.impact - a.impact;\n    if (Math.abs(impactDiff) > 0.1) return impactDiff;\n\n    // Then by coverage (more flaws addressed = better)\n    return b.coverage - a.coverage;\n  });\n}\n\n// ============================================\n// CONTEXT CREATION\n// ============================================\n\nconst ResultsContext = createContext<ResultsContextType | null>(null);\n\nexport function useResults(): ResultsContextType {\n  const context = useContext(ResultsContext);\n  if (!context) {\n    throw new Error('useResults must be used within a ResultsProvider');\n  }\n  return context;\n}\n\ninterface ResultsProviderProps {\n  children: ReactNode;\n  initialData?: ResultsInputData;\n}\n\nexport function ResultsProvider({ children, initialData }: ResultsProviderProps) {\n  // Raw data state\n  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>(initialData?.frontLandmarks || []);\n  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>(initialData?.sideLandmarks || []);\n  const [gender, setGender] = useState<Gender>(initialData?.gender || 'male');\n  const [ethnicity, setEthnicity] = useState<Ethnicity>(initialData?.ethnicity || 'other');\n  const [frontPhoto, setFrontPhoto] = useState<string>(initialData?.frontPhoto || '');\n  const [sidePhoto, setSidePhoto] = useState<string | null>(initialData?.sidePhoto || null);\n\n  // UI state\n  const [activeTab, setActiveTab] = useState<ResultsTab>('overview');\n  const [expandedMeasurementId, setExpandedMeasurementId] = useState<string | null>(null);\n  const [selectedVisualizationMetric, setSelectedVisualizationMetric] = useState<string | null>(null);\n  const [categoryFilter, setCategoryFilter] = useState<string | null>(null);\n  const [showLandmarkOverlay, setShowLandmarkOverlay] = useState(true);\n\n  // Compute analysis results (now with demographic-specific scoring)\n  const analysisResults = useMemo(() => {\n    if (frontLandmarks.length === 0) {\n      return null;\n    }\n\n    try {\n      const frontAnalysis = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n      const sideAnalysis = sideLandmarks.length > 0\n        ? analyzeSideProfile(sideLandmarks, gender, ethnicity)\n        : null;\n      // analyzeHarmony expects landmarks directly, not analysis results\n      const harmony = analyzeHarmony(frontLandmarks, sideLandmarks, gender, ethnicity);\n\n      return { frontAnalysis, sideAnalysis, harmony };\n    } catch (error) {\n      console.error('Analysis error:', error);\n      return null;\n    }\n  }, [frontLandmarks, sideLandmarks, gender, ethnicity]);\n\n  // Transform to Ratio format\n  const frontRatios = useMemo(() => {\n    if (!analysisResults?.frontAnalysis) return [];\n    return analysisResults.frontAnalysis.measurements.map(m => transformToRatio(m, frontLandmarks));\n  }, [analysisResults, frontLandmarks]);\n\n  const sideRatios = useMemo(() => {\n    if (!analysisResults?.sideAnalysis) return [];\n    return analysisResults.sideAnalysis.measurements.map(m => transformToRatio(m, sideLandmarks));\n  }, [analysisResults, sideLandmarks]);\n\n  // Generate strengths and flaws\n  const strengths = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateStrengthsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  const flaws = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateFlawsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  // Generate recommendations\n  const recommendations = useMemo(() => {\n    return generateRecommendations(flaws);\n  }, [flaws]);\n\n  // Build full harmony analysis\n  const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {\n    if (!analysisResults?.harmony) return null;\n\n    return {\n      standardizedScore: analysisResults.harmony.overallScore,\n      front: {\n        standardizedScore: analysisResults.harmony.frontScore,\n        ratios: frontRatios,\n      },\n      side: {\n        standardizedScore: analysisResults.harmony.sideScore,\n        ratios: sideRatios,\n      },\n      strengths,\n      flaws,\n    };\n  }, [analysisResults, frontRatios, sideRatios, strengths, flaws]);\n\n  // Scores\n  const overallScore = analysisResults?.harmony?.overallScore || 0;\n  const frontScore = analysisResults?.harmony?.frontScore || 0;\n  const sideScore = analysisResults?.harmony?.sideScore || 0;\n\n  // Action to set all results data\n  const setResultsData = useCallback((data: ResultsInputData) => {\n    setFrontLandmarks(data.frontLandmarks);\n    setSideLandmarks(data.sideLandmarks);\n    setFrontPhoto(data.frontPhoto);\n    setSidePhoto(data.sidePhoto || null);\n    setGender(data.gender);\n    setEthnicity(data.ethnicity || 'other');\n  }, []);\n\n  const value: ResultsContextType = {\n    frontLandmarks,\n    sideLandmarks,\n    gender,\n    ethnicity,\n    frontPhoto,\n    sidePhoto,\n    harmonyAnalysis,\n    frontRatios,\n    sideRatios,\n    strengths,\n    flaws,\n    recommendations,\n    overallScore,\n    frontScore,\n    sideScore,\n    activeTab,\n    setActiveTab,\n    expandedMeasurementId,\n    setExpandedMeasurementId,\n    selectedVisualizationMetric,\n    setSelectedVisualizationMetric,\n    categoryFilter,\n    setCategoryFilter,\n    showLandmarkOverlay,\n    setShowLandmarkOverlay,\n    setResultsData,\n  };\n\n  return (\n    <ResultsContext.Provider value={value}>\n      {children}\n    </ResultsContext.Provider>\n  );\n}\n","structuredPatch":[{"oldStart":1203,"oldLines":10,"newStart":1203,"newLines":10,"lines":["     return generateFlawsFromAnalysis(analysisResults.harmony);","   }, [analysisResults]);"," ","-  // Generate recommendations","+  // Generate recommendations with metric-aware matching","   const recommendations = useMemo(() => {","-    return generateRecommendations(flaws);","-  }, [flaws]);","+    return generateRecommendations(flaws, frontRatios, sideRatios);","+  }, [flaws, frontRatios, sideRatios]);"," ","   // Build full harmony analysis","   const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"012e9b1d-0fae-404d-8f39-aabf8f4fa514","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_013nzbNH1whTFjGyGHRA8i1S","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I've completed task 2. Let me update the todo list and move on to task 3 - severity display enhancement.","signature":"EpQCCkYIChgCKkD+TjLvZVzY1DzozqYv9CVP7wWXbQ7/nT3+KCB4+xkZI0ilmjBjwxF4KAjnVRersLHR34r3qlWfG5XzwViPdJTlEgwwZqH0KJdvd4IhNPkaDCmnUWczdCFIEZW/UiIwMCoFCFC1Y5cVN+eWYG0VGO9so1lGHJL+EDKsFF9sySxPeUe00NVLxvwvciL64J/dKnwA4xKUSUxjpMtCsJRa8wj/DIRzc0EBl1FmOSgmrGdcHQhiQNF01e8BwuLUg20lLJ4IG2FKte8Cff2FSVT8M5wur8qYscY19UnADzzLxRqU84RF6A64Et6iQ57dnNwObR5sf1aGSyft5UBDycCKh11scDUhaxY7d2UCpWXfGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":508,"cache_read_input_tokens":133144,"cache_creation":{"ephemeral_5m_input_tokens":508,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcAVGPbymkXZP6h5KrX","type":"assistant","uuid":"0171d1cf-5678-4653-8016-bf1fc9666a0e","timestamp":"2025-12-20T20:56:33.180Z"}
{"parentUuid":"0171d1cf-5678-4653-8016-bf1fc9666a0e","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_013nzbNH1whTFjGyGHRA8i1S","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JTDGVZ1srztb3SiL3xX5F3","name":"TodoWrite","input":{"todos":[{"content":"Enhanced Illustration Configs - Expand generateIllustration() function","status":"completed","activeForm":"Expanding generateIllustration() function"},{"content":"Improved Flaw-to-Treatment Matching - Use metric scores and match flaws to procedures","status":"completed","activeForm":"Improving flaw-to-treatment matching"},{"content":"Severity Display Enhancement - Add severity badges with colors","status":"in_progress","activeForm":"Enhancing severity display with badges"}]}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":508,"cache_read_input_tokens":133144,"cache_creation":{"ephemeral_5m_input_tokens":508,"ephemeral_1h_input_tokens":0},"output_tokens":214,"service_tier":"standard"}},"requestId":"req_011CWJcAVGPbymkXZP6h5KrX","type":"assistant","uuid":"f88c15eb-f212-4791-9881-343ffe8c4865","timestamp":"2025-12-20T20:56:36.573Z"}
{"parentUuid":"f88c15eb-f212-4791-9881-343ffe8c4865","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JTDGVZ1srztb3SiL3xX5F3","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"dae14220-cddb-48bf-83cb-c0248ece735c","timestamp":"2025-12-20T20:56:36.599Z","toolUseResult":{"oldTodos":[{"content":"Enhanced Illustration Configs - Expand generateIllustration() function","status":"completed","activeForm":"Expanding generateIllustration() function"},{"content":"Improved Flaw-to-Treatment Matching - Use metric scores and match flaws to procedures","status":"in_progress","activeForm":"Improving flaw-to-treatment matching"},{"content":"Severity Display Enhancement - Add severity badges with colors","status":"pending","activeForm":"Enhancing severity display with badges"}],"newTodos":[{"content":"Enhanced Illustration Configs - Expand generateIllustration() function","status":"completed","activeForm":"Expanding generateIllustration() function"},{"content":"Improved Flaw-to-Treatment Matching - Use metric scores and match flaws to procedures","status":"completed","activeForm":"Improving flaw-to-treatment matching"},{"content":"Severity Display Enhancement - Add severity badges with colors","status":"in_progress","activeForm":"Enhancing severity display with badges"}]}}
{"parentUuid":"dae14220-cddb-48bf-83cb-c0248ece735c","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01WJZFJFgYfjSn2yzZPA4GPe","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me work on the severity display enhancement. I need to add severity badges like FaceIQ:\n- \"Extremely Severe\" (red)\n- \"Severe\" (orange)  \n- \"Major\" (yellow)\n- \"Moderate\" (light yellow)\n- \"Minor\" (gray)\n\nLet me update the StrengthFlawCards.tsx to include severity badges.","signature":"ErwDCkYIChgCKkBVg+VmKPZcogRW4zT/ez9DbqvsgORuY4hpkCSLjh8Gj2mV/q6KdLSQvTHJOR9YkQAWMyaJ3PlI4F25U3eb0hiREgyYBA3qpEGPiZKsTKIaDLTIG+WDU+3oW30sQiIwWPjq/k3651TYL0dw39xqvomdkMSmj2MhKSi6Ev/B/3gtlcDgzDV9Dwgjs99DLq4sKqMC9jR14GQhGCk+1TSwLuyU9I4Nm4u4Zw+m9kEXeUWKxjZ5npnJfHjRRmMfzkCHym6CtoMDtQvtyivWpejBc6JNa2csswBSym3cj01Oj0Iy2id60TXnIEsoXM1qJOP6xJWoz6J3rNcKqDG3RG9kUKpXf+L5mfuUBMfW0I0p/TILQp8/Bk20IOZk/zrw7uq5BnkYQYYrxyysBkdX+UBlxgCnen7ZCv2MqyHFscWVGvAUCsOzc9qhN9gsBNnOXMoCe/JUcZmmM9Hc5J+gUgdjxpsL7j99MZLmhhSiYAXN6rdciZE3vjdosHkxQ5FP9MYecSt0m1Vu4Nswq1IJuyQX3gu2Ph4DFkYcs1EWSOJHiXZCZd27+8jwBLhXqR/RjgksoFLKqIqPGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":263,"cache_read_input_tokens":133652,"cache_creation":{"ephemeral_5m_input_tokens":263,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJcAyWGNHscq6kBS6sfo","type":"assistant","uuid":"fae4e2b8-1c5e-4144-adbc-f5a8d11b45cb","timestamp":"2025-12-20T20:56:41.098Z"}
{"parentUuid":"fae4e2b8-1c5e-4144-adbc-f5a8d11b45cb","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01WJZFJFgYfjSn2yzZPA4GPe","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me add the severity badges to the FlawCard component."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":263,"cache_read_input_tokens":133652,"cache_creation":{"ephemeral_5m_input_tokens":263,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJcAyWGNHscq6kBS6sfo","type":"assistant","uuid":"c3a3f485-266f-4129-9ea1-5d37fe184b50","timestamp":"2025-12-20T20:56:41.330Z"}
{"parentUuid":"c3a3f485-266f-4129-9ea1-5d37fe184b50","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01WJZFJFgYfjSn2yzZPA4GPe","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019L8DERoSkSqeoDEjuXnv65","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":263,"cache_read_input_tokens":133652,"cache_creation":{"ephemeral_5m_input_tokens":263,"ephemeral_1h_input_tokens":0},"output_tokens":200,"service_tier":"standard"}},"requestId":"req_011CWJcAyWGNHscq6kBS6sfo","type":"assistant","uuid":"758e1bc5-6301-4d37-8686-47b78f3de0b4","timestamp":"2025-12-20T20:56:42.412Z"}
{"parentUuid":"758e1bc5-6301-4d37-8686-47b78f3de0b4","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019L8DERoSkSqeoDEjuXnv65","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { motion } from 'framer-motion';\n     4→import { ChevronDown, TrendingDown, AlertTriangle, CheckCircle } from 'lucide-react';\n     5→import { Strength, Flaw, getScoreColor, getQualityColor } from '@/types/results';\n     6→import { QualityBadge, CategoryTag, ExpandableSection } from '../shared';\n     7→\n     8→// ============================================\n     9→// STRENGTH CARD\n    10→// ============================================\n    11→\n    12→interface StrengthCardProps {\n    13→  strength: Strength;\n    14→  isExpanded?: boolean;\n    15→  onToggle?: () => void;\n    16→}\n    17→\n    18→export function StrengthCard({ strength, isExpanded = false, onToggle }: StrengthCardProps) {\n    19→  const color = getQualityColor(strength.qualityLevel);\n    20→\n    21→  return (\n    22→    <motion.div\n    23→      layout\n    24→      className={`bg-gradient-to-br from-green-500/10 to-cyan-500/5 border rounded-xl overflow-hidden transition-all ${\n    25→        isExpanded ? 'border-green-500/50' : 'border-green-500/20 hover:border-green-500/40'\n    26→      }`}\n    27→    >\n    28→      {/* Header */}\n    29→      <button\n    30→        onClick={onToggle}\n    31→        className=\"w-full p-4 flex items-start gap-3 text-left\"\n    32→      >\n    33→        {/* Icon */}\n    34→        <div className=\"w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center flex-shrink-0\">\n    35→          <CheckCircle size={20} className=\"text-green-400\" />\n    36→        </div>\n    37→\n    38→        {/* Content */}\n    39→        <div className=\"flex-1 min-w-0\">\n    40→          <div className=\"flex items-center gap-2 mb-1\">\n    41→            <h3 className=\"font-semibold text-white\">{strength.strengthName}</h3>\n    42→            <QualityBadge quality={strength.qualityLevel} size=\"sm\" />\n    43→          </div>\n    44→          <p className=\"text-sm text-neutral-400 line-clamp-2\">{strength.summary}</p>\n    45→          <div className=\"flex items-center gap-3 mt-2\">\n    46→            <CategoryTag category={strength.categoryName} />\n    47→            <span className=\"text-sm font-medium\" style={{ color }}>\n    48→              Score: {strength.avgScore.toFixed(1)}/10\n    49→            </span>\n    50→          </div>\n    51→        </div>\n    52→\n    53→        {/* Expand indicator */}\n    54→        <motion.div\n    55→          animate={{ rotate: isExpanded ? 180 : 0 }}\n    56→          transition={{ duration: 0.2 }}\n    57→          className=\"flex-shrink-0 mt-1\"\n    58→        >\n    59→          <ChevronDown size={18} className=\"text-neutral-500\" />\n    60→        </motion.div>\n    61→      </button>\n    62→\n    63→      {/* Expanded Content */}\n    64→      <ExpandableSection isExpanded={isExpanded}>\n    65→        <div className=\"px-4 pb-4 space-y-3 border-t border-green-500/20 pt-3\">\n    66→          <h4 className=\"text-sm font-medium text-neutral-300\">Responsible Ratios</h4>\n    67→          <div className=\"space-y-2\">\n    68→            {strength.responsibleRatios.map((ratio, i) => (\n    69→              <div\n    70→                key={i}\n    71→                className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n    72→              >\n    73→                <span className=\"text-sm text-neutral-300\">{ratio.ratioName}</span>\n    74→                <div className=\"flex items-center gap-2\">\n    75→                  <span className=\"text-sm text-neutral-500\">\n    76→                    {ratio.value.toFixed(2)}\n    77→                  </span>\n    78→                  <span\n    79→                    className=\"text-sm font-medium\"\n    80→                    style={{ color: getScoreColor(ratio.score) }}\n    81→                  >\n    82→                    {ratio.score.toFixed(1)}\n    83→                  </span>\n    84→                </div>\n    85→              </div>\n    86→            ))}\n    87→          </div>\n    88→        </div>\n    89→      </ExpandableSection>\n    90→    </motion.div>\n    91→  );\n    92→}\n    93→\n    94→// ============================================\n    95→// FLAW CARD\n    96→// ============================================\n    97→\n    98→interface FlawCardProps {\n    99→  flaw: Flaw;\n   100→  isExpanded?: boolean;\n   101→  onToggle?: () => void;\n   102→  rank?: number;\n   103→}\n   104→\n   105→export function FlawCard({ flaw, isExpanded = false, onToggle, rank }: FlawCardProps) {\n   106→  const impactColor = flaw.harmonyPercentageLost > 5 ? '#ef4444' :\n   107→    flaw.harmonyPercentageLost > 2 ? '#f97316' : '#fbbf24';\n   108→\n   109→  return (\n   110→    <motion.div\n   111→      layout\n   112→      className={`bg-gradient-to-br from-red-500/10 to-orange-500/5 border rounded-xl overflow-hidden transition-all ${\n   113→        isExpanded ? 'border-red-500/50' : 'border-red-500/20 hover:border-red-500/40'\n   114→      }`}\n   115→    >\n   116→      {/* Header */}\n   117→      <button\n   118→        onClick={onToggle}\n   119→        className=\"w-full p-4 flex items-start gap-3 text-left\"\n   120→      >\n   121→        {/* Icon / Rank */}\n   122→        <div className=\"w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0\">\n   123→          {rank !== undefined ? (\n   124→            <span className=\"text-red-400 font-bold\">#{rank}</span>\n   125→          ) : (\n   126→            <AlertTriangle size={20} className=\"text-red-400\" />\n   127→          )}\n   128→        </div>\n   129→\n   130→        {/* Content */}\n   131→        <div className=\"flex-1 min-w-0\">\n   132→          <div className=\"flex items-center gap-2 mb-1\">\n   133→            <h3 className=\"font-semibold text-white\">{flaw.flawName}</h3>\n   134→          </div>\n   135→          <p className=\"text-sm text-neutral-400 line-clamp-2\">{flaw.summary}</p>\n   136→          <div className=\"flex items-center gap-3 mt-2\">\n   137→            <CategoryTag category={flaw.categoryName} />\n   138→            <div className=\"flex items-center gap-1\">\n   139→              <TrendingDown size={14} style={{ color: impactColor }} />\n   140→              <span className=\"text-sm font-medium\" style={{ color: impactColor }}>\n   141→                -{flaw.harmonyPercentageLost.toFixed(1)}%\n   142→              </span>\n   143→            </div>\n   144→          </div>\n   145→        </div>\n   146→\n   147→        {/* Expand indicator */}\n   148→        <motion.div\n   149→          animate={{ rotate: isExpanded ? 180 : 0 }}\n   150→          transition={{ duration: 0.2 }}\n   151→          className=\"flex-shrink-0 mt-1\"\n   152→        >\n   153→          <ChevronDown size={18} className=\"text-neutral-500\" />\n   154→        </motion.div>\n   155→      </button>\n   156→\n   157→      {/* Expanded Content */}\n   158→      <ExpandableSection isExpanded={isExpanded}>\n   159→        <div className=\"px-4 pb-4 space-y-3 border-t border-red-500/20 pt-3\">\n   160→          {/* Impact metrics */}\n   161→          <div className=\"grid grid-cols-2 gap-3\">\n   162→            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n   163→              <p className=\"text-xs text-neutral-500 mb-1\">Harmony Lost</p>\n   164→              <p className=\"text-lg font-bold\" style={{ color: impactColor }}>\n   165→                -{flaw.harmonyPercentageLost.toFixed(2)}%\n   166→              </p>\n   167→            </div>\n   168→            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n   169→              <p className=\"text-xs text-neutral-500 mb-1\">Impact Score</p>\n   170→              <p className=\"text-lg font-bold text-white\">\n   171→                {flaw.standardizedImpact.toFixed(2)}\n   172→              </p>\n   173→            </div>\n   174→          </div>\n   175→\n   176→          {/* Rolling impact if available */}\n   177→          {flaw.rollingHarmonyPercentageLost !== undefined && (\n   178→            <div className=\"bg-neutral-800/30 rounded-lg p-3\">\n   179→              <p className=\"text-xs text-neutral-500 mb-1\">Cumulative Impact</p>\n   180→              <div className=\"flex items-center gap-2\">\n   181→                <div className=\"flex-1 h-2 bg-neutral-700 rounded-full overflow-hidden\">\n   182→                  <div\n   183→                    className=\"h-full bg-red-500\"\n   184→                    style={{ width: `${Math.min(flaw.rollingHarmonyPercentageLost, 100)}%` }}\n   185→                  />\n   186→                </div>\n   187→                <span className=\"text-sm text-red-400\">\n   188→                  -{flaw.rollingHarmonyPercentageLost.toFixed(1)}%\n   189→                </span>\n   190→              </div>\n   191→            </div>\n   192→          )}\n   193→\n   194→          {/* Responsible ratios */}\n   195→          <div>\n   196→            <h4 className=\"text-sm font-medium text-neutral-300 mb-2\">Responsible Ratios</h4>\n   197→            <div className=\"space-y-2\">\n   198→              {flaw.responsibleRatios.map((ratio, i) => (\n   199→                <div\n   200→                  key={i}\n   201→                  className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n   202→                >\n   203→                  <span className=\"text-sm text-neutral-300\">{ratio.ratioName}</span>\n   204→                  <div className=\"flex items-center gap-2\">\n   205→                    <span className=\"text-sm text-neutral-500\">\n   206→                      {ratio.value.toFixed(2)}\n   207→                    </span>\n   208→                    <span\n   209→                      className=\"text-sm font-medium\"\n   210→                      style={{ color: getScoreColor(ratio.score) }}\n   211→                    >\n   212→                      {ratio.score.toFixed(1)}\n   213→                    </span>\n   214→                  </div>\n   215→                </div>\n   216→              ))}\n   217→            </div>\n   218→          </div>\n   219→        </div>\n   220→      </ExpandableSection>\n   221→    </motion.div>\n   222→  );\n   223→}\n   224→\n   225→// ============================================\n   226→// COMPACT STRENGTH/FLAW BADGES\n   227→// ============================================\n   228→\n   229→interface CompactStrengthBadgeProps {\n   230→  strength: Strength;\n   231→  onClick?: () => void;\n   232→}\n   233→\n   234→export function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {\n   235→  return (\n   236→    <button\n   237→      onClick={onClick}\n   238→      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-green-500/10 border border-green-500/20 rounded-lg hover:bg-green-500/20 transition-colors\"\n   239→    >\n   240→      <CheckCircle size={12} className=\"text-green-400\" />\n   241→      <span className=\"text-xs text-green-300\">{strength.strengthName}</span>\n   242→    </button>\n   243→  );\n   244→}\n   245→\n   246→interface CompactFlawBadgeProps {\n   247→  flaw: Flaw;\n   248→  onClick?: () => void;\n   249→}\n   250→\n   251→export function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n   252→  return (\n   253→    <button\n   254→      onClick={onClick}\n   255→      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-red-500/10 border border-red-500/20 rounded-lg hover:bg-red-500/20 transition-colors\"\n   256→    >\n   257→      <AlertTriangle size={12} className=\"text-red-400\" />\n   258→      <span className=\"text-xs text-red-300\">{flaw.flawName}</span>\n   259→      <span className=\"text-[10px] text-red-400\">-{flaw.harmonyPercentageLost.toFixed(1)}%</span>\n   260→    </button>\n   261→  );\n   262→}\n   263→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"b1d84a46-b865-4078-87dc-a42cd8612dff","timestamp":"2025-12-20T20:56:42.465Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","content":"'use client';\n\nimport { motion } from 'framer-motion';\nimport { ChevronDown, TrendingDown, AlertTriangle, CheckCircle } from 'lucide-react';\nimport { Strength, Flaw, getScoreColor, getQualityColor } from '@/types/results';\nimport { QualityBadge, CategoryTag, ExpandableSection } from '../shared';\n\n// ============================================\n// STRENGTH CARD\n// ============================================\n\ninterface StrengthCardProps {\n  strength: Strength;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n}\n\nexport function StrengthCard({ strength, isExpanded = false, onToggle }: StrengthCardProps) {\n  const color = getQualityColor(strength.qualityLevel);\n\n  return (\n    <motion.div\n      layout\n      className={`bg-gradient-to-br from-green-500/10 to-cyan-500/5 border rounded-xl overflow-hidden transition-all ${\n        isExpanded ? 'border-green-500/50' : 'border-green-500/20 hover:border-green-500/40'\n      }`}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 flex items-start gap-3 text-left\"\n      >\n        {/* Icon */}\n        <div className=\"w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center flex-shrink-0\">\n          <CheckCircle size={20} className=\"text-green-400\" />\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h3 className=\"font-semibold text-white\">{strength.strengthName}</h3>\n            <QualityBadge quality={strength.qualityLevel} size=\"sm\" />\n          </div>\n          <p className=\"text-sm text-neutral-400 line-clamp-2\">{strength.summary}</p>\n          <div className=\"flex items-center gap-3 mt-2\">\n            <CategoryTag category={strength.categoryName} />\n            <span className=\"text-sm font-medium\" style={{ color }}>\n              Score: {strength.avgScore.toFixed(1)}/10\n            </span>\n          </div>\n        </div>\n\n        {/* Expand indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0 mt-1\"\n        >\n          <ChevronDown size={18} className=\"text-neutral-500\" />\n        </motion.div>\n      </button>\n\n      {/* Expanded Content */}\n      <ExpandableSection isExpanded={isExpanded}>\n        <div className=\"px-4 pb-4 space-y-3 border-t border-green-500/20 pt-3\">\n          <h4 className=\"text-sm font-medium text-neutral-300\">Responsible Ratios</h4>\n          <div className=\"space-y-2\">\n            {strength.responsibleRatios.map((ratio, i) => (\n              <div\n                key={i}\n                className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n              >\n                <span className=\"text-sm text-neutral-300\">{ratio.ratioName}</span>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm text-neutral-500\">\n                    {ratio.value.toFixed(2)}\n                  </span>\n                  <span\n                    className=\"text-sm font-medium\"\n                    style={{ color: getScoreColor(ratio.score) }}\n                  >\n                    {ratio.score.toFixed(1)}\n                  </span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </ExpandableSection>\n    </motion.div>\n  );\n}\n\n// ============================================\n// FLAW CARD\n// ============================================\n\ninterface FlawCardProps {\n  flaw: Flaw;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  rank?: number;\n}\n\nexport function FlawCard({ flaw, isExpanded = false, onToggle, rank }: FlawCardProps) {\n  const impactColor = flaw.harmonyPercentageLost > 5 ? '#ef4444' :\n    flaw.harmonyPercentageLost > 2 ? '#f97316' : '#fbbf24';\n\n  return (\n    <motion.div\n      layout\n      className={`bg-gradient-to-br from-red-500/10 to-orange-500/5 border rounded-xl overflow-hidden transition-all ${\n        isExpanded ? 'border-red-500/50' : 'border-red-500/20 hover:border-red-500/40'\n      }`}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 flex items-start gap-3 text-left\"\n      >\n        {/* Icon / Rank */}\n        <div className=\"w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0\">\n          {rank !== undefined ? (\n            <span className=\"text-red-400 font-bold\">#{rank}</span>\n          ) : (\n            <AlertTriangle size={20} className=\"text-red-400\" />\n          )}\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h3 className=\"font-semibold text-white\">{flaw.flawName}</h3>\n          </div>\n          <p className=\"text-sm text-neutral-400 line-clamp-2\">{flaw.summary}</p>\n          <div className=\"flex items-center gap-3 mt-2\">\n            <CategoryTag category={flaw.categoryName} />\n            <div className=\"flex items-center gap-1\">\n              <TrendingDown size={14} style={{ color: impactColor }} />\n              <span className=\"text-sm font-medium\" style={{ color: impactColor }}>\n                -{flaw.harmonyPercentageLost.toFixed(1)}%\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Expand indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0 mt-1\"\n        >\n          <ChevronDown size={18} className=\"text-neutral-500\" />\n        </motion.div>\n      </button>\n\n      {/* Expanded Content */}\n      <ExpandableSection isExpanded={isExpanded}>\n        <div className=\"px-4 pb-4 space-y-3 border-t border-red-500/20 pt-3\">\n          {/* Impact metrics */}\n          <div className=\"grid grid-cols-2 gap-3\">\n            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Harmony Lost</p>\n              <p className=\"text-lg font-bold\" style={{ color: impactColor }}>\n                -{flaw.harmonyPercentageLost.toFixed(2)}%\n              </p>\n            </div>\n            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Impact Score</p>\n              <p className=\"text-lg font-bold text-white\">\n                {flaw.standardizedImpact.toFixed(2)}\n              </p>\n            </div>\n          </div>\n\n          {/* Rolling impact if available */}\n          {flaw.rollingHarmonyPercentageLost !== undefined && (\n            <div className=\"bg-neutral-800/30 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Cumulative Impact</p>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"flex-1 h-2 bg-neutral-700 rounded-full overflow-hidden\">\n                  <div\n                    className=\"h-full bg-red-500\"\n                    style={{ width: `${Math.min(flaw.rollingHarmonyPercentageLost, 100)}%` }}\n                  />\n                </div>\n                <span className=\"text-sm text-red-400\">\n                  -{flaw.rollingHarmonyPercentageLost.toFixed(1)}%\n                </span>\n              </div>\n            </div>\n          )}\n\n          {/* Responsible ratios */}\n          <div>\n            <h4 className=\"text-sm font-medium text-neutral-300 mb-2\">Responsible Ratios</h4>\n            <div className=\"space-y-2\">\n              {flaw.responsibleRatios.map((ratio, i) => (\n                <div\n                  key={i}\n                  className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n                >\n                  <span className=\"text-sm text-neutral-300\">{ratio.ratioName}</span>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm text-neutral-500\">\n                      {ratio.value.toFixed(2)}\n                    </span>\n                    <span\n                      className=\"text-sm font-medium\"\n                      style={{ color: getScoreColor(ratio.score) }}\n                    >\n                      {ratio.score.toFixed(1)}\n                    </span>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </ExpandableSection>\n    </motion.div>\n  );\n}\n\n// ============================================\n// COMPACT STRENGTH/FLAW BADGES\n// ============================================\n\ninterface CompactStrengthBadgeProps {\n  strength: Strength;\n  onClick?: () => void;\n}\n\nexport function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-green-500/10 border border-green-500/20 rounded-lg hover:bg-green-500/20 transition-colors\"\n    >\n      <CheckCircle size={12} className=\"text-green-400\" />\n      <span className=\"text-xs text-green-300\">{strength.strengthName}</span>\n    </button>\n  );\n}\n\ninterface CompactFlawBadgeProps {\n  flaw: Flaw;\n  onClick?: () => void;\n}\n\nexport function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-red-500/10 border border-red-500/20 rounded-lg hover:bg-red-500/20 transition-colors\"\n    >\n      <AlertTriangle size={12} className=\"text-red-400\" />\n      <span className=\"text-xs text-red-300\">{flaw.flawName}</span>\n      <span className=\"text-[10px] text-red-400\">-{flaw.harmonyPercentageLost.toFixed(1)}%</span>\n    </button>\n  );\n}\n","numLines":263,"startLine":1,"totalLines":263}}}
{"parentUuid":"b1d84a46-b865-4078-87dc-a42cd8612dff","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01GHJ6opkpAmsDGAdepFXHcn","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me add severity badges to the FlawCard. I'll add:1. A SeverityBadge component\n2. Add severity calculation based on harmonyPercentageLost\n3. Display the badge in both the FlawCard and CompactFlawBadge","signature":"EvgCCkYIChgCKkCWFldQZgvir5yvejOWLO2vw3IbwF2T0vr/oWQPVHcB9K3dNclW6bUax7vdzBh28hbaV/Wo7grlgCQ7AsutacSLEgwFHKzZicxakzpfxSUaDJ5uW6Wy49CuK5XWfSIwXxkgKZ1tDm1g1ePFu3t4IwE0N/iCScSvufu0qA5Lh0TdLRp1tzm6L9f3tgVxGnpjKt8BbN5pGGtrEAij2/yjg7wuZ4vjnvK8m+rcOMmEzdqffPGWtrxbg4TWtKxvpstdKVe2myegHm+2GTUIIIoKdvnhd71+SshBHfnV1bfFrxjzKxkmHeiZimyho438iO9ekTdkivFDkVOPtJZhpACZix370Rco7FlG9c6baA+KSOiVdsYt6oDykDrUCDO1ykiG+N+JWCn0yRk/ZZlo6ILvT3uJ7WVyXYLD4QIaQGPijeJ1Eipc2HU+2J5V7v61UxgiX18i7ulZgzgkhZeh/vs94U5JSXKufGRkrk/mssQ9PQmEexgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":4119,"cache_read_input_tokens":133915,"cache_creation":{"ephemeral_5m_input_tokens":4119,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcBQc8b5A8qasNM6b4R","type":"assistant","uuid":"f59bfbd3-c3a5-4cef-8bf9-0922f295a829","timestamp":"2025-12-20T20:56:46.188Z"}
{"parentUuid":"f59bfbd3-c3a5-4cef-8bf9-0922f295a829","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01GHJ6opkpAmsDGAdepFXHcn","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015MdNxUrQYfrmwisqse8f5F","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","old_string":"'use client';\n\nimport { motion } from 'framer-motion';\nimport { ChevronDown, TrendingDown, AlertTriangle, CheckCircle } from 'lucide-react';\nimport { Strength, Flaw, getScoreColor, getQualityColor } from '@/types/results';\nimport { QualityBadge, CategoryTag, ExpandableSection } from '../shared';","new_string":"'use client';\n\nimport { motion } from 'framer-motion';\nimport { ChevronDown, TrendingDown, AlertTriangle, CheckCircle } from 'lucide-react';\nimport { Strength, Flaw, getScoreColor, getQualityColor } from '@/types/results';\nimport { QualityBadge, CategoryTag, ExpandableSection } from '../shared';\n\n// ============================================\n// SEVERITY BADGE - FaceIQ Style\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor';\n\ninterface SeverityConfig {\n  label: string;\n  color: string;\n  bgColor: string;\n  borderColor: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {\n  extremely_severe: {\n    label: 'Extremely Severe',\n    color: '#dc2626',\n    bgColor: 'rgba(220, 38, 38, 0.15)',\n    borderColor: 'rgba(220, 38, 38, 0.4)',\n  },\n  severe: {\n    label: 'Severe',\n    color: '#ef4444',\n    bgColor: 'rgba(239, 68, 68, 0.15)',\n    borderColor: 'rgba(239, 68, 68, 0.4)',\n  },\n  major: {\n    label: 'Major',\n    color: '#f97316',\n    bgColor: 'rgba(249, 115, 22, 0.15)',\n    borderColor: 'rgba(249, 115, 22, 0.4)',\n  },\n  moderate: {\n    label: 'Moderate',\n    color: '#fbbf24',\n    bgColor: 'rgba(251, 191, 36, 0.15)',\n    borderColor: 'rgba(251, 191, 36, 0.4)',\n  },\n  minor: {\n    label: 'Minor',\n    color: '#6b7280',\n    bgColor: 'rgba(107, 114, 128, 0.15)',\n    borderColor: 'rgba(107, 114, 128, 0.4)',\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  if (harmonyLost >= 5) return 'extremely_severe';\n  if (harmonyLost >= 3.5) return 'severe';\n  if (harmonyLost >= 2.5) return 'major';\n  if (harmonyLost >= 1.5) return 'moderate';\n  return 'minor';\n}\n\nfunction getSeverityFromScore(score: number): SeverityLevel {\n  if (score <= 2) return 'extremely_severe';\n  if (score <= 4) return 'severe';\n  if (score <= 5.5) return 'major';\n  if (score <= 7) return 'moderate';\n  return 'minor';\n}\n\ninterface SeverityBadgeProps {\n  severity: SeverityLevel;\n  size?: 'sm' | 'md';\n}\n\nexport function SeverityBadge({ severity, size = 'md' }: SeverityBadgeProps) {\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <span\n      className={`inline-flex items-center font-medium rounded-full ${\n        size === 'sm' ? 'px-2 py-0.5 text-[10px]' : 'px-2.5 py-1 text-xs'\n      }`}\n      style={{\n        color: config.color,\n        backgroundColor: config.bgColor,\n        border: `1px solid ${config.borderColor}`,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":4119,"cache_read_input_tokens":133915,"cache_creation":{"ephemeral_5m_input_tokens":4119,"ephemeral_1h_input_tokens":0},"output_tokens":1259,"service_tier":"standard"}},"requestId":"req_011CWJcBQc8b5A8qasNM6b4R","type":"assistant","uuid":"97e6115e-9810-4156-87a4-054f97c174fe","timestamp":"2025-12-20T20:57:02.643Z"}
{"type":"file-history-snapshot","messageId":"97e6115e-9810-4156-87a4-054f97c174fe","snapshot":{"messageId":"2e08c307-8b28-49bb-9983-28482f596229","trackedFileBackups":{"src/contexts/ResultsContext.tsx":{"backupFileName":"a89136ca100d1202@v1","version":1,"backupTime":"2025-12-20T20:53:25.192Z"},"src/components/results/cards/StrengthFlawCards.tsx":{"backupFileName":"d8a39652c1a8653c@v1","version":1,"backupTime":"2025-12-20T20:57:02.673Z"}},"timestamp":"2025-12-20T20:50:19.769Z"},"isSnapshotUpdate":true}
{"parentUuid":"97e6115e-9810-4156-87a4-054f97c174fe","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015MdNxUrQYfrmwisqse8f5F","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n     1→'use client';\n     2→\n     3→import { motion } from 'framer-motion';\n     4→import { ChevronDown, TrendingDown, AlertTriangle, CheckCircle } from 'lucide-react';\n     5→import { Strength, Flaw, getScoreColor, getQualityColor } from '@/types/results';\n     6→import { QualityBadge, CategoryTag, ExpandableSection } from '../shared';\n     7→\n     8→// ============================================\n     9→// SEVERITY BADGE - FaceIQ Style\n    10→// ============================================\n    11→\n    12→type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor';\n    13→\n    14→interface SeverityConfig {\n    15→  label: string;\n    16→  color: string;\n    17→  bgColor: string;\n    18→  borderColor: string;\n    19→}\n    20→\n    21→const SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {\n    22→  extremely_severe: {\n    23→    label: 'Extremely Severe',\n    24→    color: '#dc2626',\n    25→    bgColor: 'rgba(220, 38, 38, 0.15)',\n    26→    borderColor: 'rgba(220, 38, 38, 0.4)',\n    27→  },\n    28→  severe: {\n    29→    label: 'Severe',\n    30→    color: '#ef4444',\n    31→    bgColor: 'rgba(239, 68, 68, 0.15)',\n    32→    borderColor: 'rgba(239, 68, 68, 0.4)',\n    33→  },\n    34→  major: {\n    35→    label: 'Major',\n    36→    color: '#f97316',\n    37→    bgColor: 'rgba(249, 115, 22, 0.15)',\n    38→    borderColor: 'rgba(249, 115, 22, 0.4)',\n    39→  },\n    40→  moderate: {\n    41→    label: 'Moderate',\n    42→    color: '#fbbf24',\n    43→    bgColor: 'rgba(251, 191, 36, 0.15)',\n    44→    borderColor: 'rgba(251, 191, 36, 0.4)',\n    45→  },\n    46→  minor: {\n    47→    label: 'Minor',\n    48→    color: '#6b7280',\n    49→    bgColor: 'rgba(107, 114, 128, 0.15)',\n    50→    borderColor: 'rgba(107, 114, 128, 0.4)',\n    51→  },\n    52→};\n    53→\n    54→function getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n    55→  if (harmonyLost >= 5) return 'extremely_severe';\n    56→  if (harmonyLost >= 3.5) return 'severe';\n    57→  if (harmonyLost >= 2.5) return 'major';\n    58→  if (harmonyLost >= 1.5) return 'moderate';\n    59→  return 'minor';\n    60→}\n    61→\n    62→function getSeverityFromScore(score: number): SeverityLevel {\n    63→  if (score <= 2) return 'extremely_severe';\n    64→  if (score <= 4) return 'severe';\n    65→  if (score <= 5.5) return 'major';\n    66→  if (score <= 7) return 'moderate';\n    67→  return 'minor';\n    68→}\n    69→\n    70→interface SeverityBadgeProps {\n    71→  severity: SeverityLevel;\n    72→  size?: 'sm' | 'md';\n    73→}\n    74→\n    75→export function SeverityBadge({ severity, size = 'md' }: SeverityBadgeProps) {\n    76→  const config = SEVERITY_CONFIGS[severity];\n    77→\n    78→  return (\n    79→    <span\n    80→      className={`inline-flex items-center font-medium rounded-full ${\n    81→        size === 'sm' ? 'px-2 py-0.5 text-[10px]' : 'px-2.5 py-1 text-xs'\n    82→      }`}\n    83→      style={{\n    84→        color: config.color,\n    85→        backgroundColor: config.bgColor,\n    86→        border: `1px solid ${config.borderColor}`,\n    87→      }}\n    88→    >\n    89→      {config.label}\n    90→    </span>\n    91→  );\n    92→}\n    93→\n    94→// ============================================\n    95→// STRENGTH CARD\n    96→// ============================================"}]},"uuid":"ccb89ea8-58e6-4b4f-beb2-34daea94cf6f","timestamp":"2025-12-20T20:57:02.671Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","oldString":"'use client';\n\nimport { motion } from 'framer-motion';\nimport { ChevronDown, TrendingDown, AlertTriangle, CheckCircle } from 'lucide-react';\nimport { Strength, Flaw, getScoreColor, getQualityColor } from '@/types/results';\nimport { QualityBadge, CategoryTag, ExpandableSection } from '../shared';","newString":"'use client';\n\nimport { motion } from 'framer-motion';\nimport { ChevronDown, TrendingDown, AlertTriangle, CheckCircle } from 'lucide-react';\nimport { Strength, Flaw, getScoreColor, getQualityColor } from '@/types/results';\nimport { QualityBadge, CategoryTag, ExpandableSection } from '../shared';\n\n// ============================================\n// SEVERITY BADGE - FaceIQ Style\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor';\n\ninterface SeverityConfig {\n  label: string;\n  color: string;\n  bgColor: string;\n  borderColor: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {\n  extremely_severe: {\n    label: 'Extremely Severe',\n    color: '#dc2626',\n    bgColor: 'rgba(220, 38, 38, 0.15)',\n    borderColor: 'rgba(220, 38, 38, 0.4)',\n  },\n  severe: {\n    label: 'Severe',\n    color: '#ef4444',\n    bgColor: 'rgba(239, 68, 68, 0.15)',\n    borderColor: 'rgba(239, 68, 68, 0.4)',\n  },\n  major: {\n    label: 'Major',\n    color: '#f97316',\n    bgColor: 'rgba(249, 115, 22, 0.15)',\n    borderColor: 'rgba(249, 115, 22, 0.4)',\n  },\n  moderate: {\n    label: 'Moderate',\n    color: '#fbbf24',\n    bgColor: 'rgba(251, 191, 36, 0.15)',\n    borderColor: 'rgba(251, 191, 36, 0.4)',\n  },\n  minor: {\n    label: 'Minor',\n    color: '#6b7280',\n    bgColor: 'rgba(107, 114, 128, 0.15)',\n    borderColor: 'rgba(107, 114, 128, 0.4)',\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  if (harmonyLost >= 5) return 'extremely_severe';\n  if (harmonyLost >= 3.5) return 'severe';\n  if (harmonyLost >= 2.5) return 'major';\n  if (harmonyLost >= 1.5) return 'moderate';\n  return 'minor';\n}\n\nfunction getSeverityFromScore(score: number): SeverityLevel {\n  if (score <= 2) return 'extremely_severe';\n  if (score <= 4) return 'severe';\n  if (score <= 5.5) return 'major';\n  if (score <= 7) return 'moderate';\n  return 'minor';\n}\n\ninterface SeverityBadgeProps {\n  severity: SeverityLevel;\n  size?: 'sm' | 'md';\n}\n\nexport function SeverityBadge({ severity, size = 'md' }: SeverityBadgeProps) {\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <span\n      className={`inline-flex items-center font-medium rounded-full ${\n        size === 'sm' ? 'px-2 py-0.5 text-[10px]' : 'px-2.5 py-1 text-xs'\n      }`}\n      style={{\n        color: config.color,\n        backgroundColor: config.bgColor,\n        border: `1px solid ${config.borderColor}`,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}","originalFile":"'use client';\n\nimport { motion } from 'framer-motion';\nimport { ChevronDown, TrendingDown, AlertTriangle, CheckCircle } from 'lucide-react';\nimport { Strength, Flaw, getScoreColor, getQualityColor } from '@/types/results';\nimport { QualityBadge, CategoryTag, ExpandableSection } from '../shared';\n\n// ============================================\n// STRENGTH CARD\n// ============================================\n\ninterface StrengthCardProps {\n  strength: Strength;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n}\n\nexport function StrengthCard({ strength, isExpanded = false, onToggle }: StrengthCardProps) {\n  const color = getQualityColor(strength.qualityLevel);\n\n  return (\n    <motion.div\n      layout\n      className={`bg-gradient-to-br from-green-500/10 to-cyan-500/5 border rounded-xl overflow-hidden transition-all ${\n        isExpanded ? 'border-green-500/50' : 'border-green-500/20 hover:border-green-500/40'\n      }`}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 flex items-start gap-3 text-left\"\n      >\n        {/* Icon */}\n        <div className=\"w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center flex-shrink-0\">\n          <CheckCircle size={20} className=\"text-green-400\" />\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h3 className=\"font-semibold text-white\">{strength.strengthName}</h3>\n            <QualityBadge quality={strength.qualityLevel} size=\"sm\" />\n          </div>\n          <p className=\"text-sm text-neutral-400 line-clamp-2\">{strength.summary}</p>\n          <div className=\"flex items-center gap-3 mt-2\">\n            <CategoryTag category={strength.categoryName} />\n            <span className=\"text-sm font-medium\" style={{ color }}>\n              Score: {strength.avgScore.toFixed(1)}/10\n            </span>\n          </div>\n        </div>\n\n        {/* Expand indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0 mt-1\"\n        >\n          <ChevronDown size={18} className=\"text-neutral-500\" />\n        </motion.div>\n      </button>\n\n      {/* Expanded Content */}\n      <ExpandableSection isExpanded={isExpanded}>\n        <div className=\"px-4 pb-4 space-y-3 border-t border-green-500/20 pt-3\">\n          <h4 className=\"text-sm font-medium text-neutral-300\">Responsible Ratios</h4>\n          <div className=\"space-y-2\">\n            {strength.responsibleRatios.map((ratio, i) => (\n              <div\n                key={i}\n                className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n              >\n                <span className=\"text-sm text-neutral-300\">{ratio.ratioName}</span>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm text-neutral-500\">\n                    {ratio.value.toFixed(2)}\n                  </span>\n                  <span\n                    className=\"text-sm font-medium\"\n                    style={{ color: getScoreColor(ratio.score) }}\n                  >\n                    {ratio.score.toFixed(1)}\n                  </span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </ExpandableSection>\n    </motion.div>\n  );\n}\n\n// ============================================\n// FLAW CARD\n// ============================================\n\ninterface FlawCardProps {\n  flaw: Flaw;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  rank?: number;\n}\n\nexport function FlawCard({ flaw, isExpanded = false, onToggle, rank }: FlawCardProps) {\n  const impactColor = flaw.harmonyPercentageLost > 5 ? '#ef4444' :\n    flaw.harmonyPercentageLost > 2 ? '#f97316' : '#fbbf24';\n\n  return (\n    <motion.div\n      layout\n      className={`bg-gradient-to-br from-red-500/10 to-orange-500/5 border rounded-xl overflow-hidden transition-all ${\n        isExpanded ? 'border-red-500/50' : 'border-red-500/20 hover:border-red-500/40'\n      }`}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 flex items-start gap-3 text-left\"\n      >\n        {/* Icon / Rank */}\n        <div className=\"w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0\">\n          {rank !== undefined ? (\n            <span className=\"text-red-400 font-bold\">#{rank}</span>\n          ) : (\n            <AlertTriangle size={20} className=\"text-red-400\" />\n          )}\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h3 className=\"font-semibold text-white\">{flaw.flawName}</h3>\n          </div>\n          <p className=\"text-sm text-neutral-400 line-clamp-2\">{flaw.summary}</p>\n          <div className=\"flex items-center gap-3 mt-2\">\n            <CategoryTag category={flaw.categoryName} />\n            <div className=\"flex items-center gap-1\">\n              <TrendingDown size={14} style={{ color: impactColor }} />\n              <span className=\"text-sm font-medium\" style={{ color: impactColor }}>\n                -{flaw.harmonyPercentageLost.toFixed(1)}%\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Expand indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0 mt-1\"\n        >\n          <ChevronDown size={18} className=\"text-neutral-500\" />\n        </motion.div>\n      </button>\n\n      {/* Expanded Content */}\n      <ExpandableSection isExpanded={isExpanded}>\n        <div className=\"px-4 pb-4 space-y-3 border-t border-red-500/20 pt-3\">\n          {/* Impact metrics */}\n          <div className=\"grid grid-cols-2 gap-3\">\n            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Harmony Lost</p>\n              <p className=\"text-lg font-bold\" style={{ color: impactColor }}>\n                -{flaw.harmonyPercentageLost.toFixed(2)}%\n              </p>\n            </div>\n            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Impact Score</p>\n              <p className=\"text-lg font-bold text-white\">\n                {flaw.standardizedImpact.toFixed(2)}\n              </p>\n            </div>\n          </div>\n\n          {/* Rolling impact if available */}\n          {flaw.rollingHarmonyPercentageLost !== undefined && (\n            <div className=\"bg-neutral-800/30 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Cumulative Impact</p>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"flex-1 h-2 bg-neutral-700 rounded-full overflow-hidden\">\n                  <div\n                    className=\"h-full bg-red-500\"\n                    style={{ width: `${Math.min(flaw.rollingHarmonyPercentageLost, 100)}%` }}\n                  />\n                </div>\n                <span className=\"text-sm text-red-400\">\n                  -{flaw.rollingHarmonyPercentageLost.toFixed(1)}%\n                </span>\n              </div>\n            </div>\n          )}\n\n          {/* Responsible ratios */}\n          <div>\n            <h4 className=\"text-sm font-medium text-neutral-300 mb-2\">Responsible Ratios</h4>\n            <div className=\"space-y-2\">\n              {flaw.responsibleRatios.map((ratio, i) => (\n                <div\n                  key={i}\n                  className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n                >\n                  <span className=\"text-sm text-neutral-300\">{ratio.ratioName}</span>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm text-neutral-500\">\n                      {ratio.value.toFixed(2)}\n                    </span>\n                    <span\n                      className=\"text-sm font-medium\"\n                      style={{ color: getScoreColor(ratio.score) }}\n                    >\n                      {ratio.score.toFixed(1)}\n                    </span>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </ExpandableSection>\n    </motion.div>\n  );\n}\n\n// ============================================\n// COMPACT STRENGTH/FLAW BADGES\n// ============================================\n\ninterface CompactStrengthBadgeProps {\n  strength: Strength;\n  onClick?: () => void;\n}\n\nexport function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-green-500/10 border border-green-500/20 rounded-lg hover:bg-green-500/20 transition-colors\"\n    >\n      <CheckCircle size={12} className=\"text-green-400\" />\n      <span className=\"text-xs text-green-300\">{strength.strengthName}</span>\n    </button>\n  );\n}\n\ninterface CompactFlawBadgeProps {\n  flaw: Flaw;\n  onClick?: () => void;\n}\n\nexport function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-red-500/10 border border-red-500/20 rounded-lg hover:bg-red-500/20 transition-colors\"\n    >\n      <AlertTriangle size={12} className=\"text-red-400\" />\n      <span className=\"text-xs text-red-300\">{flaw.flawName}</span>\n      <span className=\"text-[10px] text-red-400\">-{flaw.harmonyPercentageLost.toFixed(1)}%</span>\n    </button>\n  );\n}\n","structuredPatch":[{"oldStart":6,"oldLines":6,"newStart":6,"newLines":92,"lines":[" import { QualityBadge, CategoryTag, ExpandableSection } from '../shared';"," "," // ============================================","+// SEVERITY BADGE - FaceIQ Style","+// ============================================","+","+type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor';","+","+interface SeverityConfig {","+  label: string;","+  color: string;","+  bgColor: string;","+  borderColor: string;","+}","+","+const SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {","+  extremely_severe: {","+    label: 'Extremely Severe',","+    color: '#dc2626',","+    bgColor: 'rgba(220, 38, 38, 0.15)',","+    borderColor: 'rgba(220, 38, 38, 0.4)',","+  },","+  severe: {","+    label: 'Severe',","+    color: '#ef4444',","+    bgColor: 'rgba(239, 68, 68, 0.15)',","+    borderColor: 'rgba(239, 68, 68, 0.4)',","+  },","+  major: {","+    label: 'Major',","+    color: '#f97316',","+    bgColor: 'rgba(249, 115, 22, 0.15)',","+    borderColor: 'rgba(249, 115, 22, 0.4)',","+  },","+  moderate: {","+    label: 'Moderate',","+    color: '#fbbf24',","+    bgColor: 'rgba(251, 191, 36, 0.15)',","+    borderColor: 'rgba(251, 191, 36, 0.4)',","+  },","+  minor: {","+    label: 'Minor',","+    color: '#6b7280',","+    bgColor: 'rgba(107, 114, 128, 0.15)',","+    borderColor: 'rgba(107, 114, 128, 0.4)',","+  },","+};","+","+function getSeverityFromImpact(harmonyLost: number): SeverityLevel {","+  if (harmonyLost >= 5) return 'extremely_severe';","+  if (harmonyLost >= 3.5) return 'severe';","+  if (harmonyLost >= 2.5) return 'major';","+  if (harmonyLost >= 1.5) return 'moderate';","+  return 'minor';","+}","+","+function getSeverityFromScore(score: number): SeverityLevel {","+  if (score <= 2) return 'extremely_severe';","+  if (score <= 4) return 'severe';","+  if (score <= 5.5) return 'major';","+  if (score <= 7) return 'moderate';","+  return 'minor';","+}","+","+interface SeverityBadgeProps {","+  severity: SeverityLevel;","+  size?: 'sm' | 'md';","+}","+","+export function SeverityBadge({ severity, size = 'md' }: SeverityBadgeProps) {","+  const config = SEVERITY_CONFIGS[severity];","+","+  return (","+    <span","+      className={`inline-flex items-center font-medium rounded-full ${","+        size === 'sm' ? 'px-2 py-0.5 text-[10px]' : 'px-2.5 py-1 text-xs'","+      }`}","+      style={{","+        color: config.color,","+        backgroundColor: config.bgColor,","+        border: `1px solid ${config.borderColor}`,","+      }}","+    >","+      {config.label}","+    </span>","+  );","+}","+","+// ============================================"," // STRENGTH CARD"," // ============================================"," "]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"ccb89ea8-58e6-4b4f-beb2-34daea94cf6f","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_012JnCNjTMMdPsra2sVLSBGi","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I need to update the FlawCard component to display the severity badge. Let me find and update that.","signature":"Eo8CCkYIChgCKkBfc+jnSsNQ17EPfZJJOlD471sngVH/cjEWBGxGT9krf3RRwJlBDUEo0mHR+oMQRE1SJa2Z74XXbIDCpFYdR8C6EgyNI+V7TnvLCDm2tFwaDIaGkoesoqb9m+MiaCIww3uNRt/KKM/HQ6tgCoKNlfayKGZBakf68eJeJWnfMTFpMNfKmJ4tbyibBTM2ujWdKnfqRgwtYaVNjZm86UMtcUYEs6EwNmifkdnp89vUXXYOUCi31pWe8ZbW/SGuOVY3dPAH7+K4I3rSHxS6DSsnrRytAd028dQZ+KjPgP8uWpjMd68l0SIB8/dqxIelBGaaO2aKzuxwCJZ3XwV3KMvuSK7nHjL3TY/DUxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":87637,"cache_read_input_tokens":19403,"cache_creation":{"ephemeral_5m_input_tokens":87637,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWJcCu98tPS5xKx1uLthP","type":"assistant","uuid":"c16ad42e-ee92-4b48-bd4e-d3300113c562","timestamp":"2025-12-20T20:57:09.020Z"}
{"parentUuid":"c16ad42e-ee92-4b48-bd4e-d3300113c562","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_012JnCNjTMMdPsra2sVLSBGi","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me update the FlawCard to display the severity badge."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":87637,"cache_read_input_tokens":19403,"cache_creation":{"ephemeral_5m_input_tokens":87637,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWJcCu98tPS5xKx1uLthP","type":"assistant","uuid":"75539145-60be-4181-ba32-ad5e83d3e8e1","timestamp":"2025-12-20T20:57:09.531Z"}
{"parentUuid":"75539145-60be-4181-ba32-ad5e83d3e8e1","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_012JnCNjTMMdPsra2sVLSBGi","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XAotgT4v8pwwFnaASqaiDQ","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","old_string":"export function FlawCard({ flaw, isExpanded = false, onToggle, rank }: FlawCardProps) {\n  const impactColor = flaw.harmonyPercentageLost > 5 ? '#ef4444' :\n    flaw.harmonyPercentageLost > 2 ? '#f97316' : '#fbbf24';\n\n  return (\n    <motion.div\n      layout\n      className={`bg-gradient-to-br from-red-500/10 to-orange-500/5 border rounded-xl overflow-hidden transition-all ${\n        isExpanded ? 'border-red-500/50' : 'border-red-500/20 hover:border-red-500/40'\n      }`}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 flex items-start gap-3 text-left\"\n      >\n        {/* Icon / Rank */}\n        <div className=\"w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0\">\n          {rank !== undefined ? (\n            <span className=\"text-red-400 font-bold\">#{rank}</span>\n          ) : (\n            <AlertTriangle size={20} className=\"text-red-400\" />\n          )}\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h3 className=\"font-semibold text-white\">{flaw.flawName}</h3>\n          </div>\n          <p className=\"text-sm text-neutral-400 line-clamp-2\">{flaw.summary}</p>\n          <div className=\"flex items-center gap-3 mt-2\">\n            <CategoryTag category={flaw.categoryName} />\n            <div className=\"flex items-center gap-1\">\n              <TrendingDown size={14} style={{ color: impactColor }} />\n              <span className=\"text-sm font-medium\" style={{ color: impactColor }}>\n                -{flaw.harmonyPercentageLost.toFixed(1)}%\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Expand indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0 mt-1\"\n        >\n          <ChevronDown size={18} className=\"text-neutral-500\" />\n        </motion.div>\n      </button>","new_string":"export function FlawCard({ flaw, isExpanded = false, onToggle, rank }: FlawCardProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n  const severityConfig = SEVERITY_CONFIGS[severity];\n\n  return (\n    <motion.div\n      layout\n      className={`bg-gradient-to-br from-red-500/10 to-orange-500/5 border rounded-xl overflow-hidden transition-all ${\n        isExpanded ? 'border-red-500/50' : 'border-red-500/20 hover:border-red-500/40'\n      }`}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 flex items-start gap-3 text-left\"\n      >\n        {/* Icon / Rank */}\n        <div className=\"w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0\">\n          {rank !== undefined ? (\n            <span className=\"text-red-400 font-bold\">#{rank}</span>\n          ) : (\n            <AlertTriangle size={20} className=\"text-red-400\" />\n          )}\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n            <h3 className=\"font-semibold text-white\">{flaw.flawName}</h3>\n            <SeverityBadge severity={severity} size=\"sm\" />\n          </div>\n          <p className=\"text-sm text-neutral-400 line-clamp-2\">{flaw.summary}</p>\n          <div className=\"flex items-center gap-3 mt-2 flex-wrap\">\n            <CategoryTag category={flaw.categoryName} />\n            <div className=\"flex items-center gap-1\">\n              <TrendingDown size={14} style={{ color: severityConfig.color }} />\n              <span className=\"text-sm font-medium\" style={{ color: severityConfig.color }}>\n                -{flaw.harmonyPercentageLost.toFixed(1)}%\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Expand indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0 mt-1\"\n        >\n          <ChevronDown size={18} className=\"text-neutral-500\" />\n        </motion.div>\n      </button>"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":87637,"cache_read_input_tokens":19403,"cache_creation":{"ephemeral_5m_input_tokens":87637,"ephemeral_1h_input_tokens":0},"output_tokens":1509,"service_tier":"standard"}},"requestId":"req_011CWJcCu98tPS5xKx1uLthP","type":"assistant","uuid":"d8c1f9d0-4d86-459f-946b-f04a21b6c432","timestamp":"2025-12-20T20:57:22.455Z"}
{"parentUuid":"d8c1f9d0-4d86-459f-946b-f04a21b6c432","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XAotgT4v8pwwFnaASqaiDQ","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   187→  onToggle?: () => void;\n   188→  rank?: number;\n   189→}\n   190→\n   191→export function FlawCard({ flaw, isExpanded = false, onToggle, rank }: FlawCardProps) {\n   192→  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n   193→  const severityConfig = SEVERITY_CONFIGS[severity];\n   194→\n   195→  return (\n   196→    <motion.div\n   197→      layout\n   198→      className={`bg-gradient-to-br from-red-500/10 to-orange-500/5 border rounded-xl overflow-hidden transition-all ${\n   199→        isExpanded ? 'border-red-500/50' : 'border-red-500/20 hover:border-red-500/40'\n   200→      }`}\n   201→    >\n   202→      {/* Header */}\n   203→      <button\n   204→        onClick={onToggle}\n   205→        className=\"w-full p-4 flex items-start gap-3 text-left\"\n   206→      >\n   207→        {/* Icon / Rank */}\n   208→        <div className=\"w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0\">\n   209→          {rank !== undefined ? (\n   210→            <span className=\"text-red-400 font-bold\">#{rank}</span>\n   211→          ) : (\n   212→            <AlertTriangle size={20} className=\"text-red-400\" />\n   213→          )}\n   214→        </div>\n   215→\n   216→        {/* Content */}\n   217→        <div className=\"flex-1 min-w-0\">\n   218→          <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n   219→            <h3 className=\"font-semibold text-white\">{flaw.flawName}</h3>\n   220→            <SeverityBadge severity={severity} size=\"sm\" />\n   221→          </div>\n   222→          <p className=\"text-sm text-neutral-400 line-clamp-2\">{flaw.summary}</p>\n   223→          <div className=\"flex items-center gap-3 mt-2 flex-wrap\">\n   224→            <CategoryTag category={flaw.categoryName} />\n   225→            <div className=\"flex items-center gap-1\">\n   226→              <TrendingDown size={14} style={{ color: severityConfig.color }} />\n   227→              <span className=\"text-sm font-medium\" style={{ color: severityConfig.color }}>\n   228→                -{flaw.harmonyPercentageLost.toFixed(1)}%\n   229→              </span>\n   230→            </div>\n   231→          </div>\n   232→        </div>\n   233→\n   234→        {/* Expand indicator */}\n   235→        <motion.div\n   236→          animate={{ rotate: isExpanded ? 180 : 0 }}\n   237→          transition={{ duration: 0.2 }}\n   238→          className=\"flex-shrink-0 mt-1\"\n   239→        >\n   240→          <ChevronDown size={18} className=\"text-neutral-500\" />\n   241→        </motion.div>\n   242→      </button>\n   243→\n   244→      {/* Expanded Content */}\n   245→      <ExpandableSection isExpanded={isExpanded}>\n   246→        <div className=\"px-4 pb-4 space-y-3 border-t border-red-500/20 pt-3\">"}]},"uuid":"b11c0760-dfda-40a3-af7d-d02599b90a05","timestamp":"2025-12-20T20:57:22.486Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","oldString":"export function FlawCard({ flaw, isExpanded = false, onToggle, rank }: FlawCardProps) {\n  const impactColor = flaw.harmonyPercentageLost > 5 ? '#ef4444' :\n    flaw.harmonyPercentageLost > 2 ? '#f97316' : '#fbbf24';\n\n  return (\n    <motion.div\n      layout\n      className={`bg-gradient-to-br from-red-500/10 to-orange-500/5 border rounded-xl overflow-hidden transition-all ${\n        isExpanded ? 'border-red-500/50' : 'border-red-500/20 hover:border-red-500/40'\n      }`}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 flex items-start gap-3 text-left\"\n      >\n        {/* Icon / Rank */}\n        <div className=\"w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0\">\n          {rank !== undefined ? (\n            <span className=\"text-red-400 font-bold\">#{rank}</span>\n          ) : (\n            <AlertTriangle size={20} className=\"text-red-400\" />\n          )}\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h3 className=\"font-semibold text-white\">{flaw.flawName}</h3>\n          </div>\n          <p className=\"text-sm text-neutral-400 line-clamp-2\">{flaw.summary}</p>\n          <div className=\"flex items-center gap-3 mt-2\">\n            <CategoryTag category={flaw.categoryName} />\n            <div className=\"flex items-center gap-1\">\n              <TrendingDown size={14} style={{ color: impactColor }} />\n              <span className=\"text-sm font-medium\" style={{ color: impactColor }}>\n                -{flaw.harmonyPercentageLost.toFixed(1)}%\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Expand indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0 mt-1\"\n        >\n          <ChevronDown size={18} className=\"text-neutral-500\" />\n        </motion.div>\n      </button>","newString":"export function FlawCard({ flaw, isExpanded = false, onToggle, rank }: FlawCardProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n  const severityConfig = SEVERITY_CONFIGS[severity];\n\n  return (\n    <motion.div\n      layout\n      className={`bg-gradient-to-br from-red-500/10 to-orange-500/5 border rounded-xl overflow-hidden transition-all ${\n        isExpanded ? 'border-red-500/50' : 'border-red-500/20 hover:border-red-500/40'\n      }`}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 flex items-start gap-3 text-left\"\n      >\n        {/* Icon / Rank */}\n        <div className=\"w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0\">\n          {rank !== undefined ? (\n            <span className=\"text-red-400 font-bold\">#{rank}</span>\n          ) : (\n            <AlertTriangle size={20} className=\"text-red-400\" />\n          )}\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n            <h3 className=\"font-semibold text-white\">{flaw.flawName}</h3>\n            <SeverityBadge severity={severity} size=\"sm\" />\n          </div>\n          <p className=\"text-sm text-neutral-400 line-clamp-2\">{flaw.summary}</p>\n          <div className=\"flex items-center gap-3 mt-2 flex-wrap\">\n            <CategoryTag category={flaw.categoryName} />\n            <div className=\"flex items-center gap-1\">\n              <TrendingDown size={14} style={{ color: severityConfig.color }} />\n              <span className=\"text-sm font-medium\" style={{ color: severityConfig.color }}>\n                -{flaw.harmonyPercentageLost.toFixed(1)}%\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Expand indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0 mt-1\"\n        >\n          <ChevronDown size={18} className=\"text-neutral-500\" />\n        </motion.div>\n      </button>","originalFile":"'use client';\n\nimport { motion } from 'framer-motion';\nimport { ChevronDown, TrendingDown, AlertTriangle, CheckCircle } from 'lucide-react';\nimport { Strength, Flaw, getScoreColor, getQualityColor } from '@/types/results';\nimport { QualityBadge, CategoryTag, ExpandableSection } from '../shared';\n\n// ============================================\n// SEVERITY BADGE - FaceIQ Style\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor';\n\ninterface SeverityConfig {\n  label: string;\n  color: string;\n  bgColor: string;\n  borderColor: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {\n  extremely_severe: {\n    label: 'Extremely Severe',\n    color: '#dc2626',\n    bgColor: 'rgba(220, 38, 38, 0.15)',\n    borderColor: 'rgba(220, 38, 38, 0.4)',\n  },\n  severe: {\n    label: 'Severe',\n    color: '#ef4444',\n    bgColor: 'rgba(239, 68, 68, 0.15)',\n    borderColor: 'rgba(239, 68, 68, 0.4)',\n  },\n  major: {\n    label: 'Major',\n    color: '#f97316',\n    bgColor: 'rgba(249, 115, 22, 0.15)',\n    borderColor: 'rgba(249, 115, 22, 0.4)',\n  },\n  moderate: {\n    label: 'Moderate',\n    color: '#fbbf24',\n    bgColor: 'rgba(251, 191, 36, 0.15)',\n    borderColor: 'rgba(251, 191, 36, 0.4)',\n  },\n  minor: {\n    label: 'Minor',\n    color: '#6b7280',\n    bgColor: 'rgba(107, 114, 128, 0.15)',\n    borderColor: 'rgba(107, 114, 128, 0.4)',\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  if (harmonyLost >= 5) return 'extremely_severe';\n  if (harmonyLost >= 3.5) return 'severe';\n  if (harmonyLost >= 2.5) return 'major';\n  if (harmonyLost >= 1.5) return 'moderate';\n  return 'minor';\n}\n\nfunction getSeverityFromScore(score: number): SeverityLevel {\n  if (score <= 2) return 'extremely_severe';\n  if (score <= 4) return 'severe';\n  if (score <= 5.5) return 'major';\n  if (score <= 7) return 'moderate';\n  return 'minor';\n}\n\ninterface SeverityBadgeProps {\n  severity: SeverityLevel;\n  size?: 'sm' | 'md';\n}\n\nexport function SeverityBadge({ severity, size = 'md' }: SeverityBadgeProps) {\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <span\n      className={`inline-flex items-center font-medium rounded-full ${\n        size === 'sm' ? 'px-2 py-0.5 text-[10px]' : 'px-2.5 py-1 text-xs'\n      }`}\n      style={{\n        color: config.color,\n        backgroundColor: config.bgColor,\n        border: `1px solid ${config.borderColor}`,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// STRENGTH CARD\n// ============================================\n\ninterface StrengthCardProps {\n  strength: Strength;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n}\n\nexport function StrengthCard({ strength, isExpanded = false, onToggle }: StrengthCardProps) {\n  const color = getQualityColor(strength.qualityLevel);\n\n  return (\n    <motion.div\n      layout\n      className={`bg-gradient-to-br from-green-500/10 to-cyan-500/5 border rounded-xl overflow-hidden transition-all ${\n        isExpanded ? 'border-green-500/50' : 'border-green-500/20 hover:border-green-500/40'\n      }`}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 flex items-start gap-3 text-left\"\n      >\n        {/* Icon */}\n        <div className=\"w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center flex-shrink-0\">\n          <CheckCircle size={20} className=\"text-green-400\" />\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h3 className=\"font-semibold text-white\">{strength.strengthName}</h3>\n            <QualityBadge quality={strength.qualityLevel} size=\"sm\" />\n          </div>\n          <p className=\"text-sm text-neutral-400 line-clamp-2\">{strength.summary}</p>\n          <div className=\"flex items-center gap-3 mt-2\">\n            <CategoryTag category={strength.categoryName} />\n            <span className=\"text-sm font-medium\" style={{ color }}>\n              Score: {strength.avgScore.toFixed(1)}/10\n            </span>\n          </div>\n        </div>\n\n        {/* Expand indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0 mt-1\"\n        >\n          <ChevronDown size={18} className=\"text-neutral-500\" />\n        </motion.div>\n      </button>\n\n      {/* Expanded Content */}\n      <ExpandableSection isExpanded={isExpanded}>\n        <div className=\"px-4 pb-4 space-y-3 border-t border-green-500/20 pt-3\">\n          <h4 className=\"text-sm font-medium text-neutral-300\">Responsible Ratios</h4>\n          <div className=\"space-y-2\">\n            {strength.responsibleRatios.map((ratio, i) => (\n              <div\n                key={i}\n                className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n              >\n                <span className=\"text-sm text-neutral-300\">{ratio.ratioName}</span>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm text-neutral-500\">\n                    {ratio.value.toFixed(2)}\n                  </span>\n                  <span\n                    className=\"text-sm font-medium\"\n                    style={{ color: getScoreColor(ratio.score) }}\n                  >\n                    {ratio.score.toFixed(1)}\n                  </span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </ExpandableSection>\n    </motion.div>\n  );\n}\n\n// ============================================\n// FLAW CARD\n// ============================================\n\ninterface FlawCardProps {\n  flaw: Flaw;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  rank?: number;\n}\n\nexport function FlawCard({ flaw, isExpanded = false, onToggle, rank }: FlawCardProps) {\n  const impactColor = flaw.harmonyPercentageLost > 5 ? '#ef4444' :\n    flaw.harmonyPercentageLost > 2 ? '#f97316' : '#fbbf24';\n\n  return (\n    <motion.div\n      layout\n      className={`bg-gradient-to-br from-red-500/10 to-orange-500/5 border rounded-xl overflow-hidden transition-all ${\n        isExpanded ? 'border-red-500/50' : 'border-red-500/20 hover:border-red-500/40'\n      }`}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 flex items-start gap-3 text-left\"\n      >\n        {/* Icon / Rank */}\n        <div className=\"w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0\">\n          {rank !== undefined ? (\n            <span className=\"text-red-400 font-bold\">#{rank}</span>\n          ) : (\n            <AlertTriangle size={20} className=\"text-red-400\" />\n          )}\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h3 className=\"font-semibold text-white\">{flaw.flawName}</h3>\n          </div>\n          <p className=\"text-sm text-neutral-400 line-clamp-2\">{flaw.summary}</p>\n          <div className=\"flex items-center gap-3 mt-2\">\n            <CategoryTag category={flaw.categoryName} />\n            <div className=\"flex items-center gap-1\">\n              <TrendingDown size={14} style={{ color: impactColor }} />\n              <span className=\"text-sm font-medium\" style={{ color: impactColor }}>\n                -{flaw.harmonyPercentageLost.toFixed(1)}%\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Expand indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0 mt-1\"\n        >\n          <ChevronDown size={18} className=\"text-neutral-500\" />\n        </motion.div>\n      </button>\n\n      {/* Expanded Content */}\n      <ExpandableSection isExpanded={isExpanded}>\n        <div className=\"px-4 pb-4 space-y-3 border-t border-red-500/20 pt-3\">\n          {/* Impact metrics */}\n          <div className=\"grid grid-cols-2 gap-3\">\n            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Harmony Lost</p>\n              <p className=\"text-lg font-bold\" style={{ color: impactColor }}>\n                -{flaw.harmonyPercentageLost.toFixed(2)}%\n              </p>\n            </div>\n            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Impact Score</p>\n              <p className=\"text-lg font-bold text-white\">\n                {flaw.standardizedImpact.toFixed(2)}\n              </p>\n            </div>\n          </div>\n\n          {/* Rolling impact if available */}\n          {flaw.rollingHarmonyPercentageLost !== undefined && (\n            <div className=\"bg-neutral-800/30 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Cumulative Impact</p>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"flex-1 h-2 bg-neutral-700 rounded-full overflow-hidden\">\n                  <div\n                    className=\"h-full bg-red-500\"\n                    style={{ width: `${Math.min(flaw.rollingHarmonyPercentageLost, 100)}%` }}\n                  />\n                </div>\n                <span className=\"text-sm text-red-400\">\n                  -{flaw.rollingHarmonyPercentageLost.toFixed(1)}%\n                </span>\n              </div>\n            </div>\n          )}\n\n          {/* Responsible ratios */}\n          <div>\n            <h4 className=\"text-sm font-medium text-neutral-300 mb-2\">Responsible Ratios</h4>\n            <div className=\"space-y-2\">\n              {flaw.responsibleRatios.map((ratio, i) => (\n                <div\n                  key={i}\n                  className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n                >\n                  <span className=\"text-sm text-neutral-300\">{ratio.ratioName}</span>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm text-neutral-500\">\n                      {ratio.value.toFixed(2)}\n                    </span>\n                    <span\n                      className=\"text-sm font-medium\"\n                      style={{ color: getScoreColor(ratio.score) }}\n                    >\n                      {ratio.score.toFixed(1)}\n                    </span>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </ExpandableSection>\n    </motion.div>\n  );\n}\n\n// ============================================\n// COMPACT STRENGTH/FLAW BADGES\n// ============================================\n\ninterface CompactStrengthBadgeProps {\n  strength: Strength;\n  onClick?: () => void;\n}\n\nexport function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-green-500/10 border border-green-500/20 rounded-lg hover:bg-green-500/20 transition-colors\"\n    >\n      <CheckCircle size={12} className=\"text-green-400\" />\n      <span className=\"text-xs text-green-300\">{strength.strengthName}</span>\n    </button>\n  );\n}\n\ninterface CompactFlawBadgeProps {\n  flaw: Flaw;\n  onClick?: () => void;\n}\n\nexport function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-red-500/10 border border-red-500/20 rounded-lg hover:bg-red-500/20 transition-colors\"\n    >\n      <AlertTriangle size={12} className=\"text-red-400\" />\n      <span className=\"text-xs text-red-300\">{flaw.flawName}</span>\n      <span className=\"text-[10px] text-red-400\">-{flaw.harmonyPercentageLost.toFixed(1)}%</span>\n    </button>\n  );\n}\n","structuredPatch":[{"oldStart":189,"oldLines":8,"newStart":189,"newLines":8,"lines":[" }"," "," export function FlawCard({ flaw, isExpanded = false, onToggle, rank }: FlawCardProps) {","-  const impactColor = flaw.harmonyPercentageLost > 5 ? '#ef4444' :","-    flaw.harmonyPercentageLost > 2 ? '#f97316' : '#fbbf24';","+  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);","+  const severityConfig = SEVERITY_CONFIGS[severity];"," ","   return (","     <motion.div"]},{"oldStart":215,"oldLines":15,"newStart":215,"newLines":16,"lines":[" ","         {/* Content */}","         <div className=\"flex-1 min-w-0\">","-          <div className=\"flex items-center gap-2 mb-1\">","+          <div className=\"flex items-center gap-2 mb-1 flex-wrap\">","             <h3 className=\"font-semibold text-white\">{flaw.flawName}</h3>","+            <SeverityBadge severity={severity} size=\"sm\" />","           </div>","           <p className=\"text-sm text-neutral-400 line-clamp-2\">{flaw.summary}</p>","-          <div className=\"flex items-center gap-3 mt-2\">","+          <div className=\"flex items-center gap-3 mt-2 flex-wrap\">","             <CategoryTag category={flaw.categoryName} />","             <div className=\"flex items-center gap-1\">","-              <TrendingDown size={14} style={{ color: impactColor }} />","-              <span className=\"text-sm font-medium\" style={{ color: impactColor }}>","+              <TrendingDown size={14} style={{ color: severityConfig.color }} />","+              <span className=\"text-sm font-medium\" style={{ color: severityConfig.color }}>","                 -{flaw.harmonyPercentageLost.toFixed(1)}%","               </span>","             </div>"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"b11c0760-dfda-40a3-af7d-d02599b90a05","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01FtqWVP9nhvgoKoM3hmNUfc","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me also update the CompactFlawBadge to include a severity indicator.","signature":"EvQBCkYIChgCKkAW741Xtpj7b18kLmTlmESP99dqcjwZKm9Pa/Y6/VIF3HhK8WxeYmC4d9efFdRmGD05uxDSzTEeNHlNVe5knHUiEgw+NMShvqx82DRfQLsaDNpadOtZvw2zXZjriSIwqyWeSOudoAtjMiFJcXFZpVDSxyuEAa9PGIOFat/EE9itU++dKAPk4F32O/uJCD4cKlyCn4qwdSeCNwewESP9oyLuFBuppNS1vAaTOP55s4fYY543t3qHye/CYhqvAan1IdM56b4wq+JbUFOLmlE/3r8sNozwAKGcAkyrwGIOoFl3wmLOipqZezmiXwwNRRgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2528,"cache_read_input_tokens":107040,"cache_creation":{"ephemeral_5m_input_tokens":2528,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJcEMo3SMYLbvY6BQSqJ","type":"assistant","uuid":"44283ac5-17e4-48b4-b297-27999834428f","timestamp":"2025-12-20T20:57:29.239Z"}
{"parentUuid":"44283ac5-17e4-48b4-b297-27999834428f","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01FtqWVP9nhvgoKoM3hmNUfc","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me update the CompactFlawBadge to also show the severity."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2528,"cache_read_input_tokens":107040,"cache_creation":{"ephemeral_5m_input_tokens":2528,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJcEMo3SMYLbvY6BQSqJ","type":"assistant","uuid":"2124a480-7b95-4649-9ae2-640fda5aa302","timestamp":"2025-12-20T20:57:29.910Z"}
{"parentUuid":"2124a480-7b95-4649-9ae2-640fda5aa302","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01FtqWVP9nhvgoKoM3hmNUfc","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01DygNp1fcVmhvvvqkTVhiGe","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","old_string":"interface CompactFlawBadgeProps {\n  flaw: Flaw;\n  onClick?: () => void;\n}\n\nexport function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-red-500/10 border border-red-500/20 rounded-lg hover:bg-red-500/20 transition-colors\"\n    >\n      <AlertTriangle size={12} className=\"text-red-400\" />\n      <span className=\"text-xs text-red-300\">{flaw.flawName}</span>\n      <span className=\"text-[10px] text-red-400\">-{flaw.harmonyPercentageLost.toFixed(1)}%</span>\n    </button>\n  );\n}","new_string":"interface CompactFlawBadgeProps {\n  flaw: Flaw;\n  onClick?: () => void;\n  showSeverity?: boolean;\n}\n\nexport function CompactFlawBadge({ flaw, onClick, showSeverity = true }: CompactFlawBadgeProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-lg hover:opacity-80 transition-all\"\n      style={{\n        backgroundColor: config.bgColor,\n        border: `1px solid ${config.borderColor}`,\n      }}\n    >\n      <AlertTriangle size={12} style={{ color: config.color }} />\n      <span className=\"text-xs\" style={{ color: config.color }}>{flaw.flawName}</span>\n      {showSeverity && (\n        <span\n          className=\"text-[10px] px-1.5 py-0.5 rounded-full\"\n          style={{\n            backgroundColor: config.borderColor,\n            color: config.color,\n          }}\n        >\n          {config.label}\n        </span>\n      )}\n    </button>\n  );\n}\n\n// Export severity utilities for use in other components\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\nexport type { SeverityLevel };"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":2528,"cache_read_input_tokens":107040,"cache_creation":{"ephemeral_5m_input_tokens":2528,"ephemeral_1h_input_tokens":0},"output_tokens":769,"service_tier":"standard"}},"requestId":"req_011CWJcEMo3SMYLbvY6BQSqJ","type":"assistant","uuid":"16f8ef9c-0cf6-48a4-b85c-a3256053e241","timestamp":"2025-12-20T20:57:40.974Z"}
{"parentUuid":"16f8ef9c-0cf6-48a4-b85c-a3256053e241","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01DygNp1fcVmhvvvqkTVhiGe","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   329→    </button>\n   330→  );\n   331→}\n   332→\n   333→interface CompactFlawBadgeProps {\n   334→  flaw: Flaw;\n   335→  onClick?: () => void;\n   336→  showSeverity?: boolean;\n   337→}\n   338→\n   339→export function CompactFlawBadge({ flaw, onClick, showSeverity = true }: CompactFlawBadgeProps) {\n   340→  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n   341→  const config = SEVERITY_CONFIGS[severity];\n   342→\n   343→  return (\n   344→    <button\n   345→      onClick={onClick}\n   346→      className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-lg hover:opacity-80 transition-all\"\n   347→      style={{\n   348→        backgroundColor: config.bgColor,\n   349→        border: `1px solid ${config.borderColor}`,\n   350→      }}\n   351→    >\n   352→      <AlertTriangle size={12} style={{ color: config.color }} />\n   353→      <span className=\"text-xs\" style={{ color: config.color }}>{flaw.flawName}</span>\n   354→      {showSeverity && (\n   355→        <span\n   356→          className=\"text-[10px] px-1.5 py-0.5 rounded-full\"\n   357→          style={{\n   358→            backgroundColor: config.borderColor,\n   359→            color: config.color,\n   360→          }}\n   361→        >\n   362→          {config.label}\n   363→        </span>\n   364→      )}\n   365→    </button>\n   366→  );\n   367→}\n   368→\n   369→// Export severity utilities for use in other components\n   370→export { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\n   371→export type { SeverityLevel };\n   372→"}]},"uuid":"9298afb3-01ef-4001-939d-292865b7b665","timestamp":"2025-12-20T20:57:41.004Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","oldString":"interface CompactFlawBadgeProps {\n  flaw: Flaw;\n  onClick?: () => void;\n}\n\nexport function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-red-500/10 border border-red-500/20 rounded-lg hover:bg-red-500/20 transition-colors\"\n    >\n      <AlertTriangle size={12} className=\"text-red-400\" />\n      <span className=\"text-xs text-red-300\">{flaw.flawName}</span>\n      <span className=\"text-[10px] text-red-400\">-{flaw.harmonyPercentageLost.toFixed(1)}%</span>\n    </button>\n  );\n}","newString":"interface CompactFlawBadgeProps {\n  flaw: Flaw;\n  onClick?: () => void;\n  showSeverity?: boolean;\n}\n\nexport function CompactFlawBadge({ flaw, onClick, showSeverity = true }: CompactFlawBadgeProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-lg hover:opacity-80 transition-all\"\n      style={{\n        backgroundColor: config.bgColor,\n        border: `1px solid ${config.borderColor}`,\n      }}\n    >\n      <AlertTriangle size={12} style={{ color: config.color }} />\n      <span className=\"text-xs\" style={{ color: config.color }}>{flaw.flawName}</span>\n      {showSeverity && (\n        <span\n          className=\"text-[10px] px-1.5 py-0.5 rounded-full\"\n          style={{\n            backgroundColor: config.borderColor,\n            color: config.color,\n          }}\n        >\n          {config.label}\n        </span>\n      )}\n    </button>\n  );\n}\n\n// Export severity utilities for use in other components\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\nexport type { SeverityLevel };","originalFile":"'use client';\n\nimport { motion } from 'framer-motion';\nimport { ChevronDown, TrendingDown, AlertTriangle, CheckCircle } from 'lucide-react';\nimport { Strength, Flaw, getScoreColor, getQualityColor } from '@/types/results';\nimport { QualityBadge, CategoryTag, ExpandableSection } from '../shared';\n\n// ============================================\n// SEVERITY BADGE - FaceIQ Style\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor';\n\ninterface SeverityConfig {\n  label: string;\n  color: string;\n  bgColor: string;\n  borderColor: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {\n  extremely_severe: {\n    label: 'Extremely Severe',\n    color: '#dc2626',\n    bgColor: 'rgba(220, 38, 38, 0.15)',\n    borderColor: 'rgba(220, 38, 38, 0.4)',\n  },\n  severe: {\n    label: 'Severe',\n    color: '#ef4444',\n    bgColor: 'rgba(239, 68, 68, 0.15)',\n    borderColor: 'rgba(239, 68, 68, 0.4)',\n  },\n  major: {\n    label: 'Major',\n    color: '#f97316',\n    bgColor: 'rgba(249, 115, 22, 0.15)',\n    borderColor: 'rgba(249, 115, 22, 0.4)',\n  },\n  moderate: {\n    label: 'Moderate',\n    color: '#fbbf24',\n    bgColor: 'rgba(251, 191, 36, 0.15)',\n    borderColor: 'rgba(251, 191, 36, 0.4)',\n  },\n  minor: {\n    label: 'Minor',\n    color: '#6b7280',\n    bgColor: 'rgba(107, 114, 128, 0.15)',\n    borderColor: 'rgba(107, 114, 128, 0.4)',\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  if (harmonyLost >= 5) return 'extremely_severe';\n  if (harmonyLost >= 3.5) return 'severe';\n  if (harmonyLost >= 2.5) return 'major';\n  if (harmonyLost >= 1.5) return 'moderate';\n  return 'minor';\n}\n\nfunction getSeverityFromScore(score: number): SeverityLevel {\n  if (score <= 2) return 'extremely_severe';\n  if (score <= 4) return 'severe';\n  if (score <= 5.5) return 'major';\n  if (score <= 7) return 'moderate';\n  return 'minor';\n}\n\ninterface SeverityBadgeProps {\n  severity: SeverityLevel;\n  size?: 'sm' | 'md';\n}\n\nexport function SeverityBadge({ severity, size = 'md' }: SeverityBadgeProps) {\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <span\n      className={`inline-flex items-center font-medium rounded-full ${\n        size === 'sm' ? 'px-2 py-0.5 text-[10px]' : 'px-2.5 py-1 text-xs'\n      }`}\n      style={{\n        color: config.color,\n        backgroundColor: config.bgColor,\n        border: `1px solid ${config.borderColor}`,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// STRENGTH CARD\n// ============================================\n\ninterface StrengthCardProps {\n  strength: Strength;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n}\n\nexport function StrengthCard({ strength, isExpanded = false, onToggle }: StrengthCardProps) {\n  const color = getQualityColor(strength.qualityLevel);\n\n  return (\n    <motion.div\n      layout\n      className={`bg-gradient-to-br from-green-500/10 to-cyan-500/5 border rounded-xl overflow-hidden transition-all ${\n        isExpanded ? 'border-green-500/50' : 'border-green-500/20 hover:border-green-500/40'\n      }`}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 flex items-start gap-3 text-left\"\n      >\n        {/* Icon */}\n        <div className=\"w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center flex-shrink-0\">\n          <CheckCircle size={20} className=\"text-green-400\" />\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h3 className=\"font-semibold text-white\">{strength.strengthName}</h3>\n            <QualityBadge quality={strength.qualityLevel} size=\"sm\" />\n          </div>\n          <p className=\"text-sm text-neutral-400 line-clamp-2\">{strength.summary}</p>\n          <div className=\"flex items-center gap-3 mt-2\">\n            <CategoryTag category={strength.categoryName} />\n            <span className=\"text-sm font-medium\" style={{ color }}>\n              Score: {strength.avgScore.toFixed(1)}/10\n            </span>\n          </div>\n        </div>\n\n        {/* Expand indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0 mt-1\"\n        >\n          <ChevronDown size={18} className=\"text-neutral-500\" />\n        </motion.div>\n      </button>\n\n      {/* Expanded Content */}\n      <ExpandableSection isExpanded={isExpanded}>\n        <div className=\"px-4 pb-4 space-y-3 border-t border-green-500/20 pt-3\">\n          <h4 className=\"text-sm font-medium text-neutral-300\">Responsible Ratios</h4>\n          <div className=\"space-y-2\">\n            {strength.responsibleRatios.map((ratio, i) => (\n              <div\n                key={i}\n                className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n              >\n                <span className=\"text-sm text-neutral-300\">{ratio.ratioName}</span>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm text-neutral-500\">\n                    {ratio.value.toFixed(2)}\n                  </span>\n                  <span\n                    className=\"text-sm font-medium\"\n                    style={{ color: getScoreColor(ratio.score) }}\n                  >\n                    {ratio.score.toFixed(1)}\n                  </span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </ExpandableSection>\n    </motion.div>\n  );\n}\n\n// ============================================\n// FLAW CARD\n// ============================================\n\ninterface FlawCardProps {\n  flaw: Flaw;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  rank?: number;\n}\n\nexport function FlawCard({ flaw, isExpanded = false, onToggle, rank }: FlawCardProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n  const severityConfig = SEVERITY_CONFIGS[severity];\n\n  return (\n    <motion.div\n      layout\n      className={`bg-gradient-to-br from-red-500/10 to-orange-500/5 border rounded-xl overflow-hidden transition-all ${\n        isExpanded ? 'border-red-500/50' : 'border-red-500/20 hover:border-red-500/40'\n      }`}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 flex items-start gap-3 text-left\"\n      >\n        {/* Icon / Rank */}\n        <div className=\"w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0\">\n          {rank !== undefined ? (\n            <span className=\"text-red-400 font-bold\">#{rank}</span>\n          ) : (\n            <AlertTriangle size={20} className=\"text-red-400\" />\n          )}\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n            <h3 className=\"font-semibold text-white\">{flaw.flawName}</h3>\n            <SeverityBadge severity={severity} size=\"sm\" />\n          </div>\n          <p className=\"text-sm text-neutral-400 line-clamp-2\">{flaw.summary}</p>\n          <div className=\"flex items-center gap-3 mt-2 flex-wrap\">\n            <CategoryTag category={flaw.categoryName} />\n            <div className=\"flex items-center gap-1\">\n              <TrendingDown size={14} style={{ color: severityConfig.color }} />\n              <span className=\"text-sm font-medium\" style={{ color: severityConfig.color }}>\n                -{flaw.harmonyPercentageLost.toFixed(1)}%\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Expand indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0 mt-1\"\n        >\n          <ChevronDown size={18} className=\"text-neutral-500\" />\n        </motion.div>\n      </button>\n\n      {/* Expanded Content */}\n      <ExpandableSection isExpanded={isExpanded}>\n        <div className=\"px-4 pb-4 space-y-3 border-t border-red-500/20 pt-3\">\n          {/* Impact metrics */}\n          <div className=\"grid grid-cols-2 gap-3\">\n            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Harmony Lost</p>\n              <p className=\"text-lg font-bold\" style={{ color: impactColor }}>\n                -{flaw.harmonyPercentageLost.toFixed(2)}%\n              </p>\n            </div>\n            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Impact Score</p>\n              <p className=\"text-lg font-bold text-white\">\n                {flaw.standardizedImpact.toFixed(2)}\n              </p>\n            </div>\n          </div>\n\n          {/* Rolling impact if available */}\n          {flaw.rollingHarmonyPercentageLost !== undefined && (\n            <div className=\"bg-neutral-800/30 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Cumulative Impact</p>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"flex-1 h-2 bg-neutral-700 rounded-full overflow-hidden\">\n                  <div\n                    className=\"h-full bg-red-500\"\n                    style={{ width: `${Math.min(flaw.rollingHarmonyPercentageLost, 100)}%` }}\n                  />\n                </div>\n                <span className=\"text-sm text-red-400\">\n                  -{flaw.rollingHarmonyPercentageLost.toFixed(1)}%\n                </span>\n              </div>\n            </div>\n          )}\n\n          {/* Responsible ratios */}\n          <div>\n            <h4 className=\"text-sm font-medium text-neutral-300 mb-2\">Responsible Ratios</h4>\n            <div className=\"space-y-2\">\n              {flaw.responsibleRatios.map((ratio, i) => (\n                <div\n                  key={i}\n                  className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n                >\n                  <span className=\"text-sm text-neutral-300\">{ratio.ratioName}</span>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm text-neutral-500\">\n                      {ratio.value.toFixed(2)}\n                    </span>\n                    <span\n                      className=\"text-sm font-medium\"\n                      style={{ color: getScoreColor(ratio.score) }}\n                    >\n                      {ratio.score.toFixed(1)}\n                    </span>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </ExpandableSection>\n    </motion.div>\n  );\n}\n\n// ============================================\n// COMPACT STRENGTH/FLAW BADGES\n// ============================================\n\ninterface CompactStrengthBadgeProps {\n  strength: Strength;\n  onClick?: () => void;\n}\n\nexport function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-green-500/10 border border-green-500/20 rounded-lg hover:bg-green-500/20 transition-colors\"\n    >\n      <CheckCircle size={12} className=\"text-green-400\" />\n      <span className=\"text-xs text-green-300\">{strength.strengthName}</span>\n    </button>\n  );\n}\n\ninterface CompactFlawBadgeProps {\n  flaw: Flaw;\n  onClick?: () => void;\n}\n\nexport function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-red-500/10 border border-red-500/20 rounded-lg hover:bg-red-500/20 transition-colors\"\n    >\n      <AlertTriangle size={12} className=\"text-red-400\" />\n      <span className=\"text-xs text-red-300\">{flaw.flawName}</span>\n      <span className=\"text-[10px] text-red-400\">-{flaw.harmonyPercentageLost.toFixed(1)}%</span>\n    </button>\n  );\n}\n","structuredPatch":[{"oldStart":333,"oldLines":17,"newStart":333,"newLines":39,"lines":[" interface CompactFlawBadgeProps {","   flaw: Flaw;","   onClick?: () => void;","+  showSeverity?: boolean;"," }"," ","-export function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {","+export function CompactFlawBadge({ flaw, onClick, showSeverity = true }: CompactFlawBadgeProps) {","+  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);","+  const config = SEVERITY_CONFIGS[severity];","+","   return (","     <button","       onClick={onClick}","-      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-red-500/10 border border-red-500/20 rounded-lg hover:bg-red-500/20 transition-colors\"","+      className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-lg hover:opacity-80 transition-all\"","+      style={{","+        backgroundColor: config.bgColor,","+        border: `1px solid ${config.borderColor}`,","+      }}","     >","-      <AlertTriangle size={12} className=\"text-red-400\" />","-      <span className=\"text-xs text-red-300\">{flaw.flawName}</span>","-      <span className=\"text-[10px] text-red-400\">-{flaw.harmonyPercentageLost.toFixed(1)}%</span>","+      <AlertTriangle size={12} style={{ color: config.color }} />","+      <span className=\"text-xs\" style={{ color: config.color }}>{flaw.flawName}</span>","+      {showSeverity && (","+        <span","+          className=\"text-[10px] px-1.5 py-0.5 rounded-full\"","+          style={{","+            backgroundColor: config.borderColor,","+            color: config.color,","+          }}","+        >","+          {config.label}","+        </span>","+      )}","     </button>","   );"," }","+","+// Export severity utilities for use in other components","+export { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };","+export type { SeverityLevel };"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"9298afb3-01ef-4001-939d-292865b7b665","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_017BqrFQUNAgJhjEPtmDzxGV","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me run the build to make sure there are no errors.","signature":"EuIBCkYIChgCKkAhjtPWF2EDtoiD/1UmFbW8zwbxw30hHykbLFzVElJsi5YbnOG7b4fzYiSQ640GwCoBYOE/FNIURTAQ7soZJ8jKEgwlmTMEA1Tguz3J1L4aDK+pt5zG89exrYFP2SIwlLU0nkCNjPIa4y3VzusuYyDO9y2rkY7VX/VVRgThgB+mQq3GFBkgo2USZapbZ7MeKkqb4dlMFKNaS/zMRhymYOS9VXga0Af269tlMx9S124xFvAczJAShwG4oxRa+iXDUHoYp3PL3rQR9K0y5FhgMuU04HxIjcp8s3yPfhgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1554,"cache_read_input_tokens":109568,"cache_creation":{"ephemeral_5m_input_tokens":1554,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcFj1GkzDd8PMTBPXht","type":"assistant","uuid":"3019fccd-7ba2-4475-89fe-24697e3e2b95","timestamp":"2025-12-20T20:57:43.805Z"}
{"parentUuid":"3019fccd-7ba2-4475-89fe-24697e3e2b95","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_017BqrFQUNAgJhjEPtmDzxGV","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me run the build to verify everything compiles correctly."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1554,"cache_read_input_tokens":109568,"cache_creation":{"ephemeral_5m_input_tokens":1554,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcFj1GkzDd8PMTBPXht","type":"assistant","uuid":"102ae6da-95a8-4ffd-aff7-396bf8b492c5","timestamp":"2025-12-20T20:57:44.350Z"}
{"parentUuid":"102ae6da-95a8-4ffd-aff7-396bf8b492c5","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_017BqrFQUNAgJhjEPtmDzxGV","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012hprFvViMV9M2S5kyjfvZR","name":"Bash","input":{"command":"npm run lint 2>&1 | head -50","description":"Run lint to check for errors"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1554,"cache_read_input_tokens":109568,"cache_creation":{"ephemeral_5m_input_tokens":1554,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcFj1GkzDd8PMTBPXht","type":"assistant","uuid":"76d26731-2393-4f45-87e8-9979f12de1b0","timestamp":"2025-12-20T20:57:45.459Z"}
{"parentUuid":"76d26731-2393-4f45-87e8-9979f12de1b0","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012hprFvViMV9M2S5kyjfvZR","type":"tool_result","content":"> looksmaxx-app@0.1.0 lint\n> next lint\n\n\n./src/components/results/ResultsLayout.tsx\n74:13  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/tabs/OverviewTab.tsx\n39:13  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/visualization/FaceOverlay.tsx\n101:9  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/contexts/ResultsContext.tsx\n1117:9  Error: 'phaseOrder' is assigned a value but never used.  @typescript-eslint/no-unused-vars\n\ninfo  - Need to disable some ESLint rules? Learn more here: https://nextjs.org/docs/basic-features/eslint#disabling-rules","is_error":false}]},"uuid":"1fc9c0a8-2b55-4329-901f-d3b1783e642f","timestamp":"2025-12-20T20:57:46.815Z","toolUseResult":{"stdout":"> looksmaxx-app@0.1.0 lint\n> next lint\n\n\n./src/components/results/ResultsLayout.tsx\n74:13  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/tabs/OverviewTab.tsx\n39:13  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/visualization/FaceOverlay.tsx\n101:9  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/contexts/ResultsContext.tsx\n1117:9  Error: 'phaseOrder' is assigned a value but never used.  @typescript-eslint/no-unused-vars\n\ninfo  - Need to disable some ESLint rules? Learn more here: https://nextjs.org/docs/basic-features/eslint#disabling-rules","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"1fc9c0a8-2b55-4329-901f-d3b1783e642f","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01ThvFEbfDu4Ho7gPjDS7tzx","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"There's one error - an unused variable. Let me fix that.","signature":"EuABCkYIChgCKkC9w3l1dvO49h1b16W6NGFRCiDFu3ObtUbtfGwtEnO3t07zkCIQcdyN6lIVZZXNZWFjVR0+e0QQVd2gXSF9i2btEgzsKCuW8hzcLUQBxuIaDO4UbNQLlWxUO6W8ByIwAtzxTh+jDQkO39ElTJoOYgoHa3ycO7zesGFEOf7rkvUdv7RTPnNopTFsRHXBrnVOKkge1xnrpFXyO008l3XSSX+ySt7MeQp+NcrH5Rdlv0lG7eYM6J0g6uyDi1pHepkvbTLgl+9ee69dNa16YkbEaUyTHTIcK3xtpBgYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":531,"cache_read_input_tokens":111122,"cache_creation":{"ephemeral_5m_input_tokens":531,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcG9szePPRYYD6YsjKE","type":"assistant","uuid":"43d98ae8-0c02-452f-a0a8-93f3d0a1160d","timestamp":"2025-12-20T20:57:50.187Z"}
{"parentUuid":"43d98ae8-0c02-452f-a0a8-93f3d0a1160d","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01ThvFEbfDu4Ho7gPjDS7tzx","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01ENjUCpd2VkJse6F7HFqb3U","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","old_string":"  // Sort by: phase priority (foundational first for accessibility), then impact\n  const phaseOrder: Record<string, number> = { 'Foundational': 1, 'Minimally Invasive': 2, 'Surgical': 3 };\n  return recommendations.sort((a, b) => {\n    // First sort by impact (higher = better)\n    const impactDiff = b.impact - a.impact;\n    if (Math.abs(impactDiff) > 0.1) return impactDiff;\n\n    // Then by coverage (more flaws addressed = better)\n    return b.coverage - a.coverage;\n  });","new_string":"  // Sort by impact (higher = better), then by coverage (more flaws addressed = better)\n  return recommendations.sort((a, b) => {\n    const impactDiff = b.impact - a.impact;\n    if (Math.abs(impactDiff) > 0.1) return impactDiff;\n    return b.coverage - a.coverage;\n  });"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":531,"cache_read_input_tokens":111122,"cache_creation":{"ephemeral_5m_input_tokens":531,"ephemeral_1h_input_tokens":0},"output_tokens":383,"service_tier":"standard"}},"requestId":"req_011CWJcG9szePPRYYD6YsjKE","type":"assistant","uuid":"f50efaf5-6e29-4bd6-8024-87da372d926f","timestamp":"2025-12-20T20:57:55.616Z"}
{"parentUuid":"f50efaf5-6e29-4bd6-8024-87da372d926f","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01ENjUCpd2VkJse6F7HFqb3U","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  1112→      gender: proc.gender,\n  1113→    });\n  1114→  });\n  1115→\n  1116→  // Sort by impact (higher = better), then by coverage (more flaws addressed = better)\n  1117→  return recommendations.sort((a, b) => {\n  1118→    const impactDiff = b.impact - a.impact;\n  1119→    if (Math.abs(impactDiff) > 0.1) return impactDiff;\n  1120→    return b.coverage - a.coverage;\n  1121→  });\n  1122→}\n  1123→\n  1124→// ============================================\n  1125→// CONTEXT CREATION"}]},"uuid":"6255de73-a46f-4d89-8312-3c823ca765b5","timestamp":"2025-12-20T20:57:55.652Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","oldString":"  // Sort by: phase priority (foundational first for accessibility), then impact\n  const phaseOrder: Record<string, number> = { 'Foundational': 1, 'Minimally Invasive': 2, 'Surgical': 3 };\n  return recommendations.sort((a, b) => {\n    // First sort by impact (higher = better)\n    const impactDiff = b.impact - a.impact;\n    if (Math.abs(impactDiff) > 0.1) return impactDiff;\n\n    // Then by coverage (more flaws addressed = better)\n    return b.coverage - a.coverage;\n  });","newString":"  // Sort by impact (higher = better), then by coverage (more flaws addressed = better)\n  return recommendations.sort((a, b) => {\n    const impactDiff = b.impact - a.impact;\n    if (Math.abs(impactDiff) > 0.1) return impactDiff;\n    return b.coverage - a.coverage;\n  });","originalFile":"'use client';\n\nimport React, { createContext, useContext, useState, useMemo, useCallback, ReactNode } from 'react';\nimport { LandmarkPoint } from '@/lib/landmarks';\nimport {\n  analyzeFrontProfile,\n  analyzeSideProfile,\n  analyzeHarmony,\n  HarmonyAnalysis,\n  FaceIQScoreResult,\n  FACEIQ_METRICS,\n  Ethnicity,\n  Gender,\n} from '@/lib/faceiq-scoring';\nimport {\n  Ratio,\n  Strength,\n  Flaw,\n  Recommendation,\n  ResultsTab,\n  FullHarmonyAnalysis,\n} from '@/types/results';\n\n// ============================================\n// CONTEXT TYPES\n// ============================================\n\ninterface ResultsContextType {\n  // Raw data\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  gender: Gender;\n  ethnicity: Ethnicity;\n  frontPhoto: string;\n  sidePhoto: string | null;\n\n  // Computed results\n  harmonyAnalysis: FullHarmonyAnalysis | null;\n  frontRatios: Ratio[];\n  sideRatios: Ratio[];\n  strengths: Strength[];\n  flaws: Flaw[];\n  recommendations: Recommendation[];\n\n  // Scores\n  overallScore: number;\n  frontScore: number;\n  sideScore: number;\n\n  // UI state\n  activeTab: ResultsTab;\n  setActiveTab: (tab: ResultsTab) => void;\n  expandedMeasurementId: string | null;\n  setExpandedMeasurementId: (id: string | null) => void;\n  selectedVisualizationMetric: string | null;\n  setSelectedVisualizationMetric: (id: string | null) => void;\n  categoryFilter: string | null;\n  setCategoryFilter: (category: string | null) => void;\n  showLandmarkOverlay: boolean;\n  setShowLandmarkOverlay: (show: boolean) => void;\n\n  // Actions\n  setResultsData: (data: ResultsInputData) => void;\n}\n\ninterface ResultsInputData {\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  frontPhoto: string;\n  sidePhoto?: string;\n  gender: Gender;\n  ethnicity?: Ethnicity;\n}\n\n// ============================================\n// HELPER FUNCTIONS\n// ============================================\n\nfunction convertUnitToRatioUnit(unit: string): 'x' | 'mm' | '%' | '°' {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return '°';\n    case 'mm': return 'mm';\n    default: return 'x';\n  }\n}\n\nfunction transformToRatio(result: FaceIQScoreResult, landmarks: LandmarkPoint[]): Ratio {\n  const metricConfig = FACEIQ_METRICS[result.metricId];\n\n  // Generate illustration based on metric\n  const illustration = generateIllustration(result.metricId, landmarks);\n\n  // Get flaw/strength mappings\n  const { mayIndicateFlaws, mayIndicateStrengths } = getFlawStrengthMappings(result);\n\n  return {\n    id: result.metricId,\n    name: result.name,\n    value: result.value,\n    score: result.score,\n    standardizedScore: result.standardizedScore,\n    unit: convertUnitToRatioUnit(result.unit),\n    idealMin: result.idealMin,\n    idealMax: result.idealMax,\n    rangeMin: metricConfig?.rangeMin || result.idealMin - 0.5,\n    rangeMax: metricConfig?.rangeMax || result.idealMax + 0.5,\n    description: metricConfig?.description || '',\n    category: result.category,\n    qualityLevel: result.qualityTier,\n    severity: result.severity,\n    illustration,\n    mayIndicateFlaws,\n    mayIndicateStrengths,\n    usedLandmarks: getUsedLandmarks(result.metricId),\n    scoringCurveConfig: metricConfig ? {\n      decayRate: metricConfig.decayRate,\n      maxScore: metricConfig.maxScore,\n    } : undefined,\n  };\n}\n\n// Enhanced illustration configuration type\ninterface IllustrationConfig {\n  points: string[];\n  lines: Array<{\n    from: string;\n    to: string;\n    label?: string;\n    color?: string;\n    labelPosition?: 'left' | 'right' | 'top' | 'bottom';\n  }>;\n}\n\n// Comprehensive illustration configurations for all metrics\nconst ILLUSTRATION_CONFIGS: Record<string, IllustrationConfig> = {\n  // ==========================================\n  // FACE SHAPE / PROPORTIONS\n  // ==========================================\n  faceWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'top' },\n      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'right' },\n    ],\n  },\n  totalFacialWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n      { from: 'trichion', to: 'menton', label: 'Total Height', color: '#a78bfa' },\n    ],\n  },\n  lowerThirdProportion: {\n    points: ['subnasale', 'menton', 'trichion'],\n    lines: [\n      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  middleThirdProportion: {\n    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n    lines: [\n      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  upperThirdProportion: {\n    points: ['trichion', 'nasal_base', 'menton'],\n    lines: [\n      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  bitemporalWidth: {\n    points: ['left_temporal', 'right_temporal', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_temporal', to: 'right_temporal', label: 'Temple', color: '#fbbf24' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek', color: '#67e8f9' },\n    ],\n  },\n  cheekboneHeight: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_lateralis', 'right_canthus_lateralis', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheekbone', color: '#ec4899' },\n      { from: 'left_canthus_lateralis', to: 'left_zygion', color: '#67e8f9' },\n    ],\n  },\n  midfaceRatio: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_medialis', 'right_canthus_medialis', 'subnasale'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Midface Width', color: '#67e8f9' },\n      { from: 'left_canthus_medialis', to: 'subnasale', label: 'Midface Height', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // JAW MEASUREMENTS\n  // ==========================================\n  jawSlope: {\n    points: ['left_gonion_inferior', 'left_mentum_lateralis', 'menton', 'right_mentum_lateralis', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'left_mentum_lateralis', label: 'Jaw Slope', color: '#f97316' },\n      { from: 'right_gonion_inferior', to: 'right_mentum_lateralis', color: '#f97316' },\n    ],\n  },\n  jawFrontalAngle: {\n    points: ['left_gonion_inferior', 'menton', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'menton', label: 'Jaw Angle', color: '#f97316' },\n      { from: 'menton', to: 'right_gonion_inferior', color: '#f97316' },\n    ],\n  },\n  bigonialWidth: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw Width', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n    ],\n  },\n  jawWidthRatio: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face', color: '#67e8f9' },\n    ],\n  },\n\n  // ==========================================\n  // EYE MEASUREMENTS\n  // ==========================================\n  lateralCanthalTilt: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'bottom' },\n      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n    ],\n  },\n  eyeAspectRatio: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'left_palpebra_superior', 'left_palpebra_inferior'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Width', color: '#06b6d4' },\n      { from: 'left_palpebra_superior', to: 'left_palpebra_inferior', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  eyeSeparationRatio: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryMouthWidthRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_cheilion', 'right_cheilion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n    ],\n  },\n  oneEyeApartTest: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Between Eyes', color: '#06b6d4' },\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Eye Width', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // EYEBROW MEASUREMENTS\n  // ==========================================\n  browLengthRatio: {\n    points: ['left_supercilium_medialis', 'left_supercilium_lateralis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_lateralis', label: 'Brow', color: '#84cc16' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  eyebrowTilt: {\n    points: ['left_supercilium_medialis', 'left_supercilium_apex', 'left_supercilium_lateralis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_apex', label: 'Tilt', color: '#84cc16' },\n      { from: 'left_supercilium_apex', to: 'left_supercilium_lateralis', color: '#84cc16' },\n    ],\n  },\n  eyebrowLowSetedness: {\n    points: ['left_supercilium_medialis', 'left_palpebra_superior', 'left_canthus_medialis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_palpebra_superior', label: 'Brow-Eye Gap', color: '#84cc16' },\n    ],\n  },\n\n  // ==========================================\n  // NOSE MEASUREMENTS (FRONT)\n  // ==========================================\n  nasalIndex: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Width', color: '#fbbf24' },\n      { from: 'nasal_base', to: 'subnasale', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  intercanthalNasalRatio: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'left_canthus_medialis', 'right_canthus_medialis'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose Width', color: '#fbbf24' },\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n    ],\n  },\n  noseBridgeWidth: {\n    points: ['left_dorsum_nasi', 'right_dorsum_nasi', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_dorsum_nasi', to: 'right_dorsum_nasi', label: 'Bridge', color: '#fbbf24' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Base', color: '#f97316' },\n    ],\n  },\n  noseTipPosition: {\n    points: ['subnasale', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Tip Position', color: '#fbbf24' },\n    ],\n  },\n\n  // ==========================================\n  // MOUTH/LIP MEASUREMENTS\n  // ==========================================\n  mouthNoseWidthRatio: {\n    points: ['left_cheilion', 'right_cheilion', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  lowerUpperLipRatio: {\n    points: ['labrale_superius', 'mouth_middle', 'labrale_inferius'],\n    lines: [\n      { from: 'labrale_superius', to: 'mouth_middle', label: 'Upper', color: '#ec4899' },\n      { from: 'mouth_middle', to: 'labrale_inferius', label: 'Lower', color: '#f97316' },\n    ],\n  },\n  chinPhiltrumRatio: {\n    points: ['subnasale', 'labrale_superius', 'labrale_inferius', 'menton'],\n    lines: [\n      { from: 'subnasale', to: 'labrale_superius', label: 'Philtrum', color: '#ec4899' },\n      { from: 'labrale_inferius', to: 'menton', label: 'Chin', color: '#ef4444' },\n    ],\n  },\n  mouthWidth: {\n    points: ['left_cheilion', 'right_cheilion'],\n    lines: [{ from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth Width', color: '#ec4899' }],\n  },\n\n  // ==========================================\n  // CHIN MEASUREMENTS\n  // ==========================================\n  chinHeight: {\n    points: ['labrale_inferius', 'menton'],\n    lines: [{ from: 'labrale_inferius', to: 'menton', label: 'Chin Height', color: '#ef4444' }],\n  },\n\n  // ==========================================\n  // NECK MEASUREMENTS\n  // ==========================================\n  neckWidthRatio: {\n    points: ['left_cervical_lateralis', 'right_cervical_lateralis', 'left_gonion_inferior', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_cervical_lateralis', to: 'right_cervical_lateralis', label: 'Neck', color: '#14b8a6' },\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n    ],\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS\n  // ==========================================\n  gonialAngle: {\n    points: ['tragus', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'tragus', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  nasofrontalAngle: {\n    points: ['glabella', 'nasion', 'pronasale'],\n    lines: [\n      { from: 'glabella', to: 'nasion', label: 'Forehead', color: '#84cc16' },\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  nasofacialAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', color: '#67e8f9' },\n    ],\n  },\n  nasomentaAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', label: 'To Chin', color: '#ef4444' },\n    ],\n  },\n  submentalCervicalAngle: {\n    points: ['menton', 'cervicalPoint', 'neckPoint'],\n    lines: [\n      { from: 'menton', to: 'cervicalPoint', label: 'Submental', color: '#14b8a6' },\n      { from: 'cervicalPoint', to: 'neckPoint', label: 'Cervical', color: '#06b6d4' },\n    ],\n  },\n  facialDepthToHeight: {\n    points: ['pronasale', 'tragus', 'nasion', 'menton'],\n    lines: [\n      { from: 'pronasale', to: 'tragus', label: 'Depth', color: '#67e8f9' },\n      { from: 'nasion', to: 'menton', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  anteriorFacialDepth: {\n    points: ['glabella', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'glabella', to: 'pronasale', color: '#67e8f9' },\n      { from: 'pronasale', to: 'pogonion', color: '#a78bfa' },\n    ],\n  },\n  mandibularPlaneAngle: {\n    points: ['gonionBottom', 'menton', 'orbitale', 'porion'],\n    lines: [\n      { from: 'gonionBottom', to: 'menton', label: 'Mandibular', color: '#f97316' },\n      { from: 'orbitale', to: 'porion', label: 'Frankfort', color: '#67e8f9' },\n    ],\n  },\n  ramusToMandibleRatio: {\n    points: ['gonionTop', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'gonionTop', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  orbitalVector: {\n    points: ['cornealApex', 'orbitale', 'cheekbone'],\n    lines: [\n      { from: 'cornealApex', to: 'cheekbone', label: 'Orbital Vector', color: '#06b6d4' },\n    ],\n  },\n  eLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'E-Line', color: '#67e8f9' },\n    ],\n  },\n  sLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'S-Line', color: '#a78bfa' },\n    ],\n  },\n  holdawayHLine: {\n    points: ['pronasale', 'pogonion', 'labraleSuperius', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'H-Line', color: '#ec4899' },\n    ],\n  },\n  burstoneLowerLip: {\n    points: ['subnasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'subnasale', to: 'pogonion', label: 'Burstone', color: '#fbbf24' },\n    ],\n  },\n};\n\nfunction generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  const config = ILLUSTRATION_CONFIGS[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = {\n        from: line.from,\n        to: line.to,\n        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}\n\nfunction getUsedLandmarks(metricId: string): string[] {\n  const landmarkMappings: Record<string, string[]> = {\n    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lateralCanthalTilt: ['left_canthus_medialis', 'left_canthus_lateralis'],\n    nasalIndex: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    ipd: ['left_pupila', 'right_pupila'],\n    mouthWidth: ['left_cheilion', 'right_cheilion'],\n    jawWidth: ['left_gonion_inferior', 'right_gonion_inferior'],\n    chinHeight: ['labrale_inferius', 'menton'],\n    gonialAngle: ['tragus', 'gonionBottom', 'menton'],\n  };\n  return landmarkMappings[metricId] || [];\n}\n\nfunction getFlawStrengthMappings(result: FaceIQScoreResult): { mayIndicateFlaws: string[]; mayIndicateStrengths: string[] } {\n  const flawMappings: Record<string, { low: string[]; high: string[] }> = {\n    faceWidthToHeight: {\n      low: ['Narrow face', 'Vertically elongated face'],\n      high: ['Wide face', 'Horizontally expanded face'],\n    },\n    lowerThirdProportion: {\n      low: ['Short lower third', 'Deficient mandible'],\n      high: ['Long lower third', 'Mandibular excess'],\n    },\n    lateralCanthalTilt: {\n      low: ['Negative canthal tilt', 'Drooping eyes'],\n      high: ['Excessive positive canthal tilt'],\n    },\n    nasalIndex: {\n      low: ['Narrow nose', 'Leptorrhine nose'],\n      high: ['Wide nose', 'Platyrrhine nose'],\n    },\n    gonialAngle: {\n      low: ['Steep mandibular plane'],\n      high: ['Flat mandibular plane', 'Weak jaw definition'],\n    },\n  };\n\n  const strengthMappings: Record<string, { ideal: string[] }> = {\n    faceWidthToHeight: { ideal: ['Balanced facial proportions', 'Harmonious face shape'] },\n    lateralCanthalTilt: { ideal: ['Attractive eye shape', 'Positive canthal tilt'] },\n    nasalIndex: { ideal: ['Well-proportioned nose', 'Balanced nasal width'] },\n    gonialAngle: { ideal: ['Well-defined jawline', 'Strong jaw structure'] },\n  };\n\n  const mapping = flawMappings[result.metricId];\n  const strengthMapping = strengthMappings[result.metricId];\n\n  let mayIndicateFlaws: string[] = [];\n  let mayIndicateStrengths: string[] = [];\n\n  if (result.qualityTier === 'ideal' || result.qualityTier === 'excellent') {\n    mayIndicateStrengths = strengthMapping?.ideal || [];\n  } else if (mapping) {\n    mayIndicateFlaws = result.deviationDirection === 'below' ? mapping.low : mapping.high;\n  }\n\n  return { mayIndicateFlaws, mayIndicateStrengths };\n}\n\nfunction generateStrengthsFromAnalysis(analysis: HarmonyAnalysis): Strength[] {\n  const strengths: Strength[] = [];\n\n  analysis.strengths.forEach((s, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === s.metricId);\n\n    strengths.push({\n      id: `strength_${i}`,\n      strengthName: s.metricName,\n      summary: s.reasoning,\n      avgScore: matchingMeasurement?.score || 8,\n      qualityLevel: s.qualityTier,\n      categoryName: s.category,\n      responsibleRatios: [{\n        ratioName: s.metricName,\n        ratioId: s.metricId,\n        score: matchingMeasurement?.score || 8,\n        value: s.value,\n      }],\n    });\n  });\n\n  return strengths;\n}\n\nfunction generateFlawsFromAnalysis(analysis: HarmonyAnalysis): Flaw[] {\n  const flaws: Flaw[] = [];\n  let rollingLost = 0;\n\n  analysis.flaws.forEach((f, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === f.metricId);\n    const impact = matchingMeasurement ? (10 - matchingMeasurement.score) * 0.5 : 2;\n    rollingLost += impact;\n\n    flaws.push({\n      id: `flaw_${i}`,\n      flawName: f.metricName,\n      summary: f.reasoning,\n      harmonyPercentageLost: impact,\n      standardizedImpact: impact / 10,\n      categoryName: f.category,\n      responsibleRatios: [{\n        ratioName: f.metricName,\n        ratioId: f.metricId,\n        score: matchingMeasurement?.score || 3,\n        value: matchingMeasurement?.value || 0,\n      }],\n      rollingPointsDeducted: rollingLost,\n      rollingHarmonyPercentageLost: rollingLost,\n      rollingStandardizedImpact: rollingLost / 10,\n    });\n  });\n\n  return flaws.sort((a, b) => b.harmonyPercentageLost - a.harmonyPercentageLost);\n}\n\n// Comprehensive procedure database with metric-specific targeting\ninterface ProcedureConfig {\n  ref_id: string;\n  name: string;\n  description: string;\n  phase: 'Surgical' | 'Minimally Invasive' | 'Foundational';\n  baseImpact: number;\n  coverage: number;\n  percentage: string;\n  expectedImprovementRange: { min: number; max: number };\n  targetMetrics: string[];  // Specific metric IDs this treatment addresses\n  targetCategories: string[];  // Category names this treatment addresses\n  targetKeywords: string[];  // Flaw name keywords to match\n  timeline: { effect_start: 'immediate' | 'delayed' | 'gradual'; full_results_weeks: number; full_results_weeks_max?: number };\n  cost: { type: 'flat' | 'per_session' | 'per_month'; min: number; max: number; currency: string };\n  risks_side_effects: string;\n  warnings: string[];\n  gender: 'male' | 'female' | 'both';\n}\n\nconst PROCEDURE_DATABASE: ProcedureConfig[] = [\n  // ==========================================\n  // SURGICAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'SUR-01',\n    name: 'Sliding Genioplasty',\n    description: 'Chin bone repositioning surgery that can move the chin forward, backward, up, or down for optimal projection and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.90,\n    coverage: 8,\n    percentage: '15-25%',\n    expectedImprovementRange: { min: 0.5, max: 1.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'facialDepthToHeight', 'anteriorFacialDepth', 'nasomentaAngle'],\n    targetCategories: ['Chin', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['chin', 'recessed', 'weak', 'short chin', 'long chin', 'pogonion'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage, bone resorption.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-02',\n    name: 'Reduction Rhinoplasty',\n    description: 'Surgical reduction of nose size, hump removal, and tip refinement to improve nasal proportions.',\n    phase: 'Surgical',\n    baseImpact: 0.85,\n    coverage: 6,\n    percentage: '10-20%',\n    expectedImprovementRange: { min: 0.5, max: 1.0 },\n    targetMetrics: ['nasalIndex', 'nasofrontalAngle', 'nasofacialAngle', 'nasomentaAngle', 'intercanthalNasalRatio', 'noseBridgeWidth'],\n    targetCategories: ['Nose'],\n    targetKeywords: ['wide nose', 'large nose', 'dorsal hump', 'bulbous', 'nasal', 'nose bridge'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 7000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-03',\n    name: 'Jaw Angle Implants',\n    description: 'Custom or standard silicone/PEEK implants to enhance jaw width, definition, and angularity.',\n    phase: 'Surgical',\n    baseImpact: 0.80,\n    coverage: 5,\n    percentage: '10-15%',\n    expectedImprovementRange: { min: 0.4, max: 1.0 },\n    targetMetrics: ['bigonialWidth', 'jawFrontalAngle', 'jawWidthRatio', 'jawSlope', 'gonialAngle'],\n    targetCategories: ['Jaw Shape'],\n    targetKeywords: ['narrow jaw', 'weak jaw', 'soft jaw', 'jaw angle', 'gonial', 'mandible'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection, bone erosion.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-04',\n    name: 'Bimaxillary Osteotomy (Bimax)',\n    description: 'Double jaw surgery to reposition both upper and lower jaws for optimal occlusion and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.95,\n    coverage: 12,\n    percentage: '20-35%',\n    expectedImprovementRange: { min: 1.0, max: 2.0 },\n    targetMetrics: ['midfaceRatio', 'facialDepthToHeight', 'mandibularPlaneAngle', 'lowerThirdProportion', 'nasofacialAngle'],\n    targetCategories: ['Occlusion/Jaw Growth', 'Midface/Face Shape'],\n    targetKeywords: ['maxillary recession', 'mandibular', 'hyper-divergent', 'bite', 'occlusion', 'midface recession'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 20000, max: 60000, currency: 'USD' },\n    risks_side_effects: 'Extended recovery, numbness (temporary to permanent), dietary restrictions.',\n    warnings: ['Major surgery - requires orthodontic preparation'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-05',\n    name: 'Canthoplasty',\n    description: 'Surgical eye corner modification to improve canthal tilt and eye shape.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.8 },\n    targetMetrics: ['lateralCanthalTilt', 'eyeAspectRatio'],\n    targetCategories: ['Eyes'],\n    targetKeywords: ['canthal tilt', 'negative tilt', 'drooping eyes', 'eye shape', 'eye angle'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 4000, max: 12000, currency: 'USD' },\n    risks_side_effects: 'Scarring, asymmetry, dry eyes, ectropion.',\n    warnings: ['Difficult to reverse'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-06',\n    name: 'Cheek/Malar Implants',\n    description: 'Solid implants placed over the cheekbones to enhance midface projection and width.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 4,\n    percentage: '10-18%',\n    expectedImprovementRange: { min: 0.4, max: 0.9 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio', 'totalFacialWidthToHeight'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface', 'zygomatic', 'malar'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 6, full_results_weeks_max: 12 },\n    cost: { type: 'flat', min: 6000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry, implant shifting, nerve damage.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-07',\n    name: 'Neck Liposuction / Submentoplasty',\n    description: 'Fat removal and skin tightening under the chin and neck area.',\n    phase: 'Surgical',\n    baseImpact: 0.65,\n    coverage: 3,\n    percentage: '8-12%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['round neck', 'double chin', 'submental', 'cervical', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 3000, max: 8000, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, skin irregularity, numbness.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-08',\n    name: 'Brow Bone Reduction/Augmentation',\n    description: 'Surgical reshaping of the brow ridge for improved upper third harmony.',\n    phase: 'Surgical',\n    baseImpact: 0.70,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['nasofrontalAngle', 'bitemporalWidth', 'upperThirdProportion'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['brow ridge', 'forehead', 'nasofrontal', 'upper third', 'glabella'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling, numbness, scarring (if coronal incision).',\n    warnings: [],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // MINIMALLY INVASIVE TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'MIN-01',\n    name: 'Chin/Jawline Filler',\n    description: 'Hyaluronic acid injections to enhance chin projection and jawline definition. Reversible and temporary.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 4,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'jawFrontalAngle', 'bigonialWidth'],\n    targetCategories: ['Chin', 'Jaw Shape'],\n    targetKeywords: ['weak chin', 'recessed chin', 'soft jaw', 'jawline'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 800, max: 2500, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n    warnings: ['Results temporary (12-18 months)', 'Requires maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-02',\n    name: 'Cheek Filler',\n    description: 'HA filler to enhance cheekbone projection and midface volume.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 3,\n    percentage: '5-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface volume'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 600, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, asymmetry.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-03',\n    name: 'Lip Filler',\n    description: 'Hyaluronic acid to enhance lip volume and proportions.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['lowerUpperLipRatio', 'mouthNoseWidthRatio'],\n    targetCategories: ['Lips'],\n    targetKeywords: ['thin lip', 'lip ratio', 'lip volume', 'upper lip', 'lower lip'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 400, max: 1200, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, lumps.',\n    warnings: ['Results temporary (6-12 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-04',\n    name: 'PDO Thread Lift',\n    description: 'Dissolvable threads to lift and tighten skin, particularly for canthal tilt improvement.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 3,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.1, max: 0.4 },\n    targetMetrics: ['lateralCanthalTilt', 'eyebrowLowSetedness'],\n    targetCategories: ['Eyes', 'Upper Third'],\n    targetKeywords: ['canthal tilt', 'drooping', 'sagging', 'eyebrow position'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 1500, max: 4000, currency: 'USD' },\n    risks_side_effects: 'Bruising, asymmetry, thread visibility, infection.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-05',\n    name: 'Masseter Botox',\n    description: 'Botulinum toxin to slim the lower face by relaxing masseter muscles.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 2,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['bigonialWidth', 'jawWidthRatio', 'faceWidthToHeight'],\n    targetCategories: ['Jaw Shape', 'Midface/Face Shape'],\n    targetKeywords: ['wide jaw', 'square jaw', 'masseter', 'bruxism'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 400, max: 1000, currency: 'USD' },\n    risks_side_effects: 'Temporary weakness, asymmetry, difficulty chewing.',\n    warnings: ['Results temporary (4-6 months)', 'Requires regular maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-06',\n    name: 'Kybella (Submental Fat Dissolving)',\n    description: 'Injectable deoxycholic acid to permanently destroy fat cells under the chin.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 2,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['double chin', 'submental fat', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'per_session', min: 1200, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, numbness, difficulty swallowing (temporary).',\n    warnings: ['Requires 2-4 sessions'],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // FOUNDATIONAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'FND-01',\n    name: 'Mewing / Proper Tongue Posture',\n    description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 5,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['midfaceRatio', 'bigonialWidth', 'facialDepthToHeight'],\n    targetCategories: ['Midface/Face Shape', 'Jaw Shape', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['midface', 'palate', 'recession', 'jaw development'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n    cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n    risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n    warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-02',\n    name: 'Body Recomposition (Leanmaxxing)',\n    description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n    phase: 'Foundational',\n    baseImpact: 0.35,\n    coverage: 6,\n    percentage: '5-12%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['bigonialWidth', 'submentalCervicalAngle', 'cheekboneHeight'],\n    targetCategories: ['Jaw Shape', 'Neck', 'Midface/Face Shape'],\n    targetKeywords: ['soft jaw', 'undefined', 'round', 'facial definition'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n    risks_side_effects: 'None if done healthily.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-03',\n    name: 'Posture Correction',\n    description: 'Improving head and neck posture to optimize facial appearance and reduce forward head posture effects.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 3,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.2 },\n    targetMetrics: ['submentalCervicalAngle', 'anteriorFacialDepth'],\n    targetCategories: ['Neck', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['neck', 'posture', 'forward head'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 0, max: 100, currency: 'USD' },\n    risks_side_effects: 'None.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-04',\n    name: 'Skincare Routine (Retinoid + SPF)',\n    description: 'Medical-grade skincare to improve skin quality, texture, and reduce aging signs.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 2,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: [],\n    targetCategories: [],\n    targetKeywords: ['skin', 'texture', 'aging'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 26 },\n    cost: { type: 'per_month', min: 30, max: 150, currency: 'USD' },\n    risks_side_effects: 'Initial irritation, sun sensitivity.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-05',\n    name: 'Eyebrow Grooming / Microblading',\n    description: 'Professional shaping or semi-permanent tattooing to optimize eyebrow shape and position.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['eyebrowTilt', 'eyebrowLowSetedness', 'browLengthRatio'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['eyebrow', 'brow', 'upper third'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'flat', min: 20, max: 600, currency: 'USD' },\n    risks_side_effects: 'Minimal for grooming. Microblading: infection risk, color fading.',\n    warnings: [],\n    gender: 'both',\n  },\n];\n\n// Calculate relevance score based on multiple factors\nfunction calculateRelevanceScore(\n  proc: ProcedureConfig,\n  flaw: Flaw,\n  allFlaws: Flaw[]\n): number {\n  let score = 0;\n\n  // Check metric ID match (highest priority)\n  const metricId = flaw.responsibleRatios[0]?.ratioId || '';\n  if (proc.targetMetrics.includes(metricId)) {\n    score += 40;\n  }\n\n  // Check category match\n  if (proc.targetCategories.some(cat =>\n    flaw.categoryName.toLowerCase().includes(cat.toLowerCase()) ||\n    cat.toLowerCase().includes(flaw.categoryName.toLowerCase())\n  )) {\n    score += 25;\n  }\n\n  // Check keyword match\n  const flawLower = flaw.flawName.toLowerCase();\n  const summaryLower = flaw.summary.toLowerCase();\n  const matchedKeywords = proc.targetKeywords.filter(kw =>\n    flawLower.includes(kw.toLowerCase()) || summaryLower.includes(kw.toLowerCase())\n  );\n  score += matchedKeywords.length * 10;\n\n  // Adjust by flaw severity/impact\n  score += Math.min(flaw.harmonyPercentageLost * 3, 15);\n\n  // Bonus if this procedure addresses multiple flaws\n  const otherFlawsAddressed = allFlaws.filter(f =>\n    f.id !== flaw.id && (\n      proc.targetMetrics.includes(f.responsibleRatios[0]?.ratioId || '') ||\n      proc.targetCategories.some(cat => f.categoryName.toLowerCase().includes(cat.toLowerCase()))\n    )\n  );\n  score += otherFlawsAddressed.length * 5;\n\n  return Math.min(score, 100);\n}\n\nfunction generateRecommendations(flaws: Flaw[], frontRatios: Ratio[] = [], sideRatios: Ratio[] = []): Recommendation[] {\n  const recommendations: Recommendation[] = [];\n  const allRatios = [...frontRatios, ...sideRatios];\n\n  // Track which procedures have been added and their matched flaws\n  const procMatches: Map<string, { flaws: string[]; ratios: string[]; maxScore: number }> = new Map();\n\n  flaws.forEach(flaw => {\n    PROCEDURE_DATABASE.forEach(proc => {\n      const relevanceScore = calculateRelevanceScore(proc, flaw, flaws);\n\n      if (relevanceScore >= 25) {  // Minimum threshold\n        const existing = procMatches.get(proc.ref_id);\n        if (existing) {\n          existing.flaws.push(flaw.flawName);\n          existing.ratios.push(...flaw.responsibleRatios.map(r => r.ratioName));\n          existing.maxScore = Math.max(existing.maxScore, relevanceScore);\n        } else {\n          procMatches.set(proc.ref_id, {\n            flaws: [flaw.flawName],\n            ratios: flaw.responsibleRatios.map(r => r.ratioName),\n            maxScore: relevanceScore,\n          });\n        }\n      }\n    });\n  });\n\n  // Build recommendations from matched procedures\n  procMatches.forEach((match, procId) => {\n    const proc = PROCEDURE_DATABASE.find(p => p.ref_id === procId);\n    if (!proc) return;\n\n    // Calculate expected improvement based on severity of matched flaws\n    const matchedFlawDetails = flaws.filter(f => match.flaws.includes(f.flawName));\n    const avgImpact = matchedFlawDetails.reduce((sum, f) => sum + f.harmonyPercentageLost, 0) / matchedFlawDetails.length;\n    const severityMultiplier = Math.min(avgImpact / 3, 1.5);  // More severe = more potential improvement\n\n    // Get affected ratios from the actual data\n    const affectedRatios = allRatios.filter(r =>\n      proc.targetMetrics.includes(r.id) ||\n      match.flaws.some(f => f.toLowerCase().includes(r.category.toLowerCase()))\n    );\n\n    const adjustedImpact = proc.baseImpact * (0.8 + (match.maxScore / 500));  // Slight boost for high relevance\n\n    recommendations.push({\n      ref_id: proc.ref_id,\n      name: proc.name,\n      description: proc.description,\n      phase: proc.phase,\n      impact: adjustedImpact,\n      coverage: match.flaws.length + match.ratios.length,\n      percentage: proc.percentage,\n      expectedImprovementRange: {\n        min: proc.expectedImprovementRange.min * severityMultiplier,\n        max: proc.expectedImprovementRange.max * severityMultiplier,\n      },\n      matchedFlaws: [...new Set(match.flaws)],\n      matchedRatios: [...new Set(match.ratios)],\n      ratios_impacted: affectedRatios.map(r => ({\n        ratioId: r.id,\n        ratioName: r.name,\n        direction: 'both' as const,\n        percentageEffect: proc.baseImpact,\n      })),\n      timeline: proc.timeline,\n      cost: proc.cost,\n      risks_side_effects: proc.risks_side_effects,\n      warnings: proc.warnings,\n      gender: proc.gender,\n    });\n  });\n\n  // Sort by: phase priority (foundational first for accessibility), then impact\n  const phaseOrder: Record<string, number> = { 'Foundational': 1, 'Minimally Invasive': 2, 'Surgical': 3 };\n  return recommendations.sort((a, b) => {\n    // First sort by impact (higher = better)\n    const impactDiff = b.impact - a.impact;\n    if (Math.abs(impactDiff) > 0.1) return impactDiff;\n\n    // Then by coverage (more flaws addressed = better)\n    return b.coverage - a.coverage;\n  });\n}\n\n// ============================================\n// CONTEXT CREATION\n// ============================================\n\nconst ResultsContext = createContext<ResultsContextType | null>(null);\n\nexport function useResults(): ResultsContextType {\n  const context = useContext(ResultsContext);\n  if (!context) {\n    throw new Error('useResults must be used within a ResultsProvider');\n  }\n  return context;\n}\n\ninterface ResultsProviderProps {\n  children: ReactNode;\n  initialData?: ResultsInputData;\n}\n\nexport function ResultsProvider({ children, initialData }: ResultsProviderProps) {\n  // Raw data state\n  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>(initialData?.frontLandmarks || []);\n  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>(initialData?.sideLandmarks || []);\n  const [gender, setGender] = useState<Gender>(initialData?.gender || 'male');\n  const [ethnicity, setEthnicity] = useState<Ethnicity>(initialData?.ethnicity || 'other');\n  const [frontPhoto, setFrontPhoto] = useState<string>(initialData?.frontPhoto || '');\n  const [sidePhoto, setSidePhoto] = useState<string | null>(initialData?.sidePhoto || null);\n\n  // UI state\n  const [activeTab, setActiveTab] = useState<ResultsTab>('overview');\n  const [expandedMeasurementId, setExpandedMeasurementId] = useState<string | null>(null);\n  const [selectedVisualizationMetric, setSelectedVisualizationMetric] = useState<string | null>(null);\n  const [categoryFilter, setCategoryFilter] = useState<string | null>(null);\n  const [showLandmarkOverlay, setShowLandmarkOverlay] = useState(true);\n\n  // Compute analysis results (now with demographic-specific scoring)\n  const analysisResults = useMemo(() => {\n    if (frontLandmarks.length === 0) {\n      return null;\n    }\n\n    try {\n      const frontAnalysis = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n      const sideAnalysis = sideLandmarks.length > 0\n        ? analyzeSideProfile(sideLandmarks, gender, ethnicity)\n        : null;\n      // analyzeHarmony expects landmarks directly, not analysis results\n      const harmony = analyzeHarmony(frontLandmarks, sideLandmarks, gender, ethnicity);\n\n      return { frontAnalysis, sideAnalysis, harmony };\n    } catch (error) {\n      console.error('Analysis error:', error);\n      return null;\n    }\n  }, [frontLandmarks, sideLandmarks, gender, ethnicity]);\n\n  // Transform to Ratio format\n  const frontRatios = useMemo(() => {\n    if (!analysisResults?.frontAnalysis) return [];\n    return analysisResults.frontAnalysis.measurements.map(m => transformToRatio(m, frontLandmarks));\n  }, [analysisResults, frontLandmarks]);\n\n  const sideRatios = useMemo(() => {\n    if (!analysisResults?.sideAnalysis) return [];\n    return analysisResults.sideAnalysis.measurements.map(m => transformToRatio(m, sideLandmarks));\n  }, [analysisResults, sideLandmarks]);\n\n  // Generate strengths and flaws\n  const strengths = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateStrengthsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  const flaws = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateFlawsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  // Generate recommendations with metric-aware matching\n  const recommendations = useMemo(() => {\n    return generateRecommendations(flaws, frontRatios, sideRatios);\n  }, [flaws, frontRatios, sideRatios]);\n\n  // Build full harmony analysis\n  const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {\n    if (!analysisResults?.harmony) return null;\n\n    return {\n      standardizedScore: analysisResults.harmony.overallScore,\n      front: {\n        standardizedScore: analysisResults.harmony.frontScore,\n        ratios: frontRatios,\n      },\n      side: {\n        standardizedScore: analysisResults.harmony.sideScore,\n        ratios: sideRatios,\n      },\n      strengths,\n      flaws,\n    };\n  }, [analysisResults, frontRatios, sideRatios, strengths, flaws]);\n\n  // Scores\n  const overallScore = analysisResults?.harmony?.overallScore || 0;\n  const frontScore = analysisResults?.harmony?.frontScore || 0;\n  const sideScore = analysisResults?.harmony?.sideScore || 0;\n\n  // Action to set all results data\n  const setResultsData = useCallback((data: ResultsInputData) => {\n    setFrontLandmarks(data.frontLandmarks);\n    setSideLandmarks(data.sideLandmarks);\n    setFrontPhoto(data.frontPhoto);\n    setSidePhoto(data.sidePhoto || null);\n    setGender(data.gender);\n    setEthnicity(data.ethnicity || 'other');\n  }, []);\n\n  const value: ResultsContextType = {\n    frontLandmarks,\n    sideLandmarks,\n    gender,\n    ethnicity,\n    frontPhoto,\n    sidePhoto,\n    harmonyAnalysis,\n    frontRatios,\n    sideRatios,\n    strengths,\n    flaws,\n    recommendations,\n    overallScore,\n    frontScore,\n    sideScore,\n    activeTab,\n    setActiveTab,\n    expandedMeasurementId,\n    setExpandedMeasurementId,\n    selectedVisualizationMetric,\n    setSelectedVisualizationMetric,\n    categoryFilter,\n    setCategoryFilter,\n    showLandmarkOverlay,\n    setShowLandmarkOverlay,\n    setResultsData,\n  };\n\n  return (\n    <ResultsContext.Provider value={value}>\n      {children}\n    </ResultsContext.Provider>\n  );\n}\n","structuredPatch":[{"oldStart":1113,"oldLines":14,"newStart":1113,"newLines":10,"lines":["     });","   });"," ","-  // Sort by: phase priority (foundational first for accessibility), then impact","-  const phaseOrder: Record<string, number> = { 'Foundational': 1, 'Minimally Invasive': 2, 'Surgical': 3 };","+  // Sort by impact (higher = better), then by coverage (more flaws addressed = better)","   return recommendations.sort((a, b) => {","-    // First sort by impact (higher = better)","     const impactDiff = b.impact - a.impact;","     if (Math.abs(impactDiff) > 0.1) return impactDiff;","-","-    // Then by coverage (more flaws addressed = better)","     return b.coverage - a.coverage;","   });"," }"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"6255de73-a46f-4d89-8312-3c823ca765b5","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01591Zzk8amESrWuyKDivCAb","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me run lint again to verify there are no more errors.","signature":"EuUBCkYIChgCKkBmmwfpyBKE4mvE9MvRYOfIAAL5IIddIu+jntZvHA3EonsKSIdQL9xRzmNrzXwF5drKXRAILtlK78/+oKmzWi6cEgy04EU1BuHt+zU90Q8aDC8f/laUoHoiDnZSJSIwdeTsXlMUEGokhqxgkq9fWPqQfkU5FZ3vjIMPwzPZWK+KHsZHSPUoMaPW9DIXjsfkKk0K4IiAWmebd2+SmsxUhYPRWQfWV6VjFItjG1ku6zG4Fre/koKKiEuqIMPbMgEe2PL1kkhYT1wkW72x3Vh7zlBGWT/9ISz0etIe0kLUixgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":813,"cache_read_input_tokens":111653,"cache_creation":{"ephemeral_5m_input_tokens":813,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWJcGoYet16u4PuB9BEe3","type":"assistant","uuid":"c14459f1-215d-4754-8ae1-180b7147db67","timestamp":"2025-12-20T20:57:58.284Z"}
{"parentUuid":"c14459f1-215d-4754-8ae1-180b7147db67","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01591Zzk8amESrWuyKDivCAb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KbzcCM9UrYoKeB2LBcPyKC","name":"Bash","input":{"command":"npm run lint 2>&1","description":"Run lint to verify no errors"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":813,"cache_read_input_tokens":111653,"cache_creation":{"ephemeral_5m_input_tokens":813,"ephemeral_1h_input_tokens":0},"output_tokens":123,"service_tier":"standard"}},"requestId":"req_011CWJcGoYet16u4PuB9BEe3","type":"assistant","uuid":"41260a0c-c423-4647-b1af-168215fda46c","timestamp":"2025-12-20T20:57:59.481Z"}
{"parentUuid":"41260a0c-c423-4647-b1af-168215fda46c","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KbzcCM9UrYoKeB2LBcPyKC","type":"tool_result","content":"> looksmaxx-app@0.1.0 lint\n> next lint\n\n\n./src/components/results/ResultsLayout.tsx\n74:13  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/tabs/OverviewTab.tsx\n39:13  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/visualization/FaceOverlay.tsx\n101:9  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\ninfo  - Need to disable some ESLint rules? Learn more here: https://nextjs.org/docs/basic-features/eslint#disabling-rules","is_error":false}]},"uuid":"76a03d2e-db20-4253-92d0-249d2e72e3fb","timestamp":"2025-12-20T20:58:00.771Z","toolUseResult":{"stdout":"> looksmaxx-app@0.1.0 lint\n> next lint\n\n\n./src/components/results/ResultsLayout.tsx\n74:13  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/tabs/OverviewTab.tsx\n39:13  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/visualization/FaceOverlay.tsx\n101:9  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\ninfo  - Need to disable some ESLint rules? Learn more here: https://nextjs.org/docs/basic-features/eslint#disabling-rules","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"76a03d2e-db20-4253-92d0-249d2e72e3fb","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01WQAaNwe1Htjczwa43TDUeF","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Only warnings remain, no errors. Let me also run the TypeScript check.","signature":"Eu4BCkYIChgCKkDlRUhAQUP25quG9tK2IKl7GDRVdo9VZWuY1zypo5l56gHntB5XaIMgqTnSVoDhNg+n1EFZp/C/hI7MIcT7mMV0EgyTPGZFoDRXixEGpo8aDB9nwQ3pVbQixALipCIwPWRdHcYWo6ItTKRa9ygFjb4g7nuNZWNTbYSOuTnzVPlwZ6IxCtIdfkn56xWDnybnKlYtPw0ZrYIObYYJkq3qJKbYtKC1ZjAZWgCZ8as5iXwapRnofst0p2cnkIghnu0TnBFHdj+2yjvfSr75oGUgKmYOc0iMcrSGIhR97bQ3HcMv+ybXMmtjuBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":467,"cache_read_input_tokens":112466,"cache_creation":{"ephemeral_5m_input_tokens":467,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcHBPoTEwuSZB4kBEmF","type":"assistant","uuid":"f9ff5efd-a203-433e-8dfb-815b98146621","timestamp":"2025-12-20T20:58:03.731Z"}
{"parentUuid":"f9ff5efd-a203-433e-8dfb-815b98146621","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01WQAaNwe1Htjczwa43TDUeF","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017fsPjTknsz46hSKvpPiBof","name":"Bash","input":{"command":"npx tsc --noEmit 2>&1 | head -30","description":"Run TypeScript check"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":467,"cache_read_input_tokens":112466,"cache_creation":{"ephemeral_5m_input_tokens":467,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcHBPoTEwuSZB4kBEmF","type":"assistant","uuid":"27c1cf1a-5793-401a-8bbe-66a56a44a5b8","timestamp":"2025-12-20T20:58:04.675Z"}
{"parentUuid":"27c1cf1a-5793-401a-8bbe-66a56a44a5b8","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017fsPjTknsz46hSKvpPiBof","type":"tool_result","content":"src/components/results/cards/StrengthFlawCards.tsx(251,64): error TS2304: Cannot find name 'impactColor'.\nsrc/contexts/ResultsContext.tsx(502,20): error TS2322: Type 'Record<string, { from: string; to: string; color: string; label?: string | undefined; labelPosition?: string | undefined; }>' is not assignable to type 'Record<string, IllustrationLine>'.\n  'string' index signatures are incompatible.\n    Type '{ from: string; to: string; color: string; label?: string | undefined; labelPosition?: string | undefined; }' is not assignable to type 'IllustrationLine'.\n      Types of property 'labelPosition' are incompatible.\n        Type 'string | undefined' is not assignable to type '\"start\" | \"middle\" | \"end\" | undefined'.\n          Type 'string' is not assignable to type '\"start\" | \"middle\" | \"end\" | undefined'.\nsrc/contexts/ResultsContext.tsx(1100,25): error TS2802: Type 'Set<string>' can only be iterated through when using the '--downlevelIteration' flag or with a '--target' of 'es2015' or higher.\nsrc/contexts/ResultsContext.tsx(1101,26): error TS2802: Type 'Set<string>' can only be iterated through when using the '--downlevelIteration' flag or with a '--target' of 'es2015' or higher.","is_error":false}]},"uuid":"c71292c3-3b45-4258-b5a3-9879e2a0ba24","timestamp":"2025-12-20T20:58:05.815Z","toolUseResult":{"stdout":"src/components/results/cards/StrengthFlawCards.tsx(251,64): error TS2304: Cannot find name 'impactColor'.\nsrc/contexts/ResultsContext.tsx(502,20): error TS2322: Type 'Record<string, { from: string; to: string; color: string; label?: string | undefined; labelPosition?: string | undefined; }>' is not assignable to type 'Record<string, IllustrationLine>'.\n  'string' index signatures are incompatible.\n    Type '{ from: string; to: string; color: string; label?: string | undefined; labelPosition?: string | undefined; }' is not assignable to type 'IllustrationLine'.\n      Types of property 'labelPosition' are incompatible.\n        Type 'string | undefined' is not assignable to type '\"start\" | \"middle\" | \"end\" | undefined'.\n          Type 'string' is not assignable to type '\"start\" | \"middle\" | \"end\" | undefined'.\nsrc/contexts/ResultsContext.tsx(1100,25): error TS2802: Type 'Set<string>' can only be iterated through when using the '--downlevelIteration' flag or with a '--target' of 'es2015' or higher.\nsrc/contexts/ResultsContext.tsx(1101,26): error TS2802: Type 'Set<string>' can only be iterated through when using the '--downlevelIteration' flag or with a '--target' of 'es2015' or higher.","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"c71292c3-3b45-4258-b5a3-9879e2a0ba24","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01AVowFuEgvkrQXEPNKKL4zQ","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"I have a few TypeScript errors to fix:\n\n1. Line 251 in StrengthFlawCards.tsx - I need to use `severityConfig.color` instead of `impactColor`\n2. Line 502 in ResultsContext.tsx - The labelPosition type doesn't match\n3. Lines 1100-1101 - Set iteration issue - I need to use Array.from()Let me fix these.","signature":"EtIDCkYIChgCKkB84eA19EgYilu3ZrMcNoZnaeZlzbzfvHt7+GqWSADJxtg/gdnLSQO+5aoTZ52sFqGa/4+ksP1JHwIl1p/fdO+AEgy4vtJyEPevpN/6ZSEaDL87SWqyT0gcVJwNtSIwPIHSErF/69BUSHgAjlnhhxL1+OckRYfaot7dypSBsS6ac5N0yW4IrGj6bcLyN/bQKrkCSk5omk52l4NCYc2ScjRJcar+SbjKWpijhnYeP15pxqrYrl+xae3HnSAe5DszxcN86gWI4fa1Gm3YL04AqUFLjTTWusTFpb8uq+3RXrwhqyRJ1hS56V32PrWUNcF73UoS9pyz4qL1hWUoxK8uHfNOVaB55sY/XZaUPn+yMmOd7gdNmBHRA6eF3sJBJPTGqoqunovAxjQgzs7Q3sOb/OeE4BtGqXoPsE7WicML2+xwVUoEOTPLie8J/L+y2flCUpfxj39wVZtXFSDUoZD3JX+gNkrVdZdrh6EH+YZ3FjaayB2xjDxoAY/LvIPnvxPoXblbOu5I9UftiLMCr4QxuQdjDczBQzhUBKkSMn4o9yjubCyEusAjsfF+IM+ig1/qxX+vZeF6ZuCOM0KofziCcrY4xAHnWroOWz39fRgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":493,"cache_read_input_tokens":112933,"cache_creation":{"ephemeral_5m_input_tokens":493,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJcHZ43XjeToWG5ucGo7","type":"assistant","uuid":"132fcfa5-34e3-46f2-9bd4-58c3f0b60045","timestamp":"2025-12-20T20:58:19.347Z"}
{"parentUuid":"132fcfa5-34e3-46f2-9bd4-58c3f0b60045","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01AVowFuEgvkrQXEPNKKL4zQ","type":"message","role":"assistant","content":[{"type":"text","text":"Let me fix the TypeScript errors."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":493,"cache_read_input_tokens":112933,"cache_creation":{"ephemeral_5m_input_tokens":493,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJcHZ43XjeToWG5ucGo7","type":"assistant","uuid":"c57788c9-0ba0-4eeb-b7f9-549ad3a21275","timestamp":"2025-12-20T20:58:19.709Z"}
{"parentUuid":"c57788c9-0ba0-4eeb-b7f9-549ad3a21275","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01AVowFuEgvkrQXEPNKKL4zQ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017hMsDPAq7qMLVS625vmuL8","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","offset":245,"limit":20}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":493,"cache_read_input_tokens":112933,"cache_creation":{"ephemeral_5m_input_tokens":493,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJcHZ43XjeToWG5ucGo7","type":"assistant","uuid":"ac994295-9059-4c12-8820-e593fb490fa5","timestamp":"2025-12-20T20:58:21.204Z"}
{"parentUuid":"ac994295-9059-4c12-8820-e593fb490fa5","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017hMsDPAq7qMLVS625vmuL8","type":"tool_result","content":"   245→      <ExpandableSection isExpanded={isExpanded}>\n   246→        <div className=\"px-4 pb-4 space-y-3 border-t border-red-500/20 pt-3\">\n   247→          {/* Impact metrics */}\n   248→          <div className=\"grid grid-cols-2 gap-3\">\n   249→            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n   250→              <p className=\"text-xs text-neutral-500 mb-1\">Harmony Lost</p>\n   251→              <p className=\"text-lg font-bold\" style={{ color: impactColor }}>\n   252→                -{flaw.harmonyPercentageLost.toFixed(2)}%\n   253→              </p>\n   254→            </div>\n   255→            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n   256→              <p className=\"text-xs text-neutral-500 mb-1\">Impact Score</p>\n   257→              <p className=\"text-lg font-bold text-white\">\n   258→                {flaw.standardizedImpact.toFixed(2)}\n   259→              </p>\n   260→            </div>\n   261→          </div>\n   262→\n   263→          {/* Rolling impact if available */}\n   264→          {flaw.rollingHarmonyPercentageLost !== undefined && (\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"b45407a6-55ec-4c07-9f01-3523e5994804","timestamp":"2025-12-20T20:58:21.258Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","content":"      <ExpandableSection isExpanded={isExpanded}>\n        <div className=\"px-4 pb-4 space-y-3 border-t border-red-500/20 pt-3\">\n          {/* Impact metrics */}\n          <div className=\"grid grid-cols-2 gap-3\">\n            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Harmony Lost</p>\n              <p className=\"text-lg font-bold\" style={{ color: impactColor }}>\n                -{flaw.harmonyPercentageLost.toFixed(2)}%\n              </p>\n            </div>\n            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Impact Score</p>\n              <p className=\"text-lg font-bold text-white\">\n                {flaw.standardizedImpact.toFixed(2)}\n              </p>\n            </div>\n          </div>\n\n          {/* Rolling impact if available */}\n          {flaw.rollingHarmonyPercentageLost !== undefined && (","numLines":20,"startLine":245,"totalLines":372}}}
{"parentUuid":"b45407a6-55ec-4c07-9f01-3523e5994804","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01DPkt33Lp7whcdjzAebAan2","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"I need to fix `impactColor` to use `severityConfig.color`.","signature":"EuIBCkYIChgCKkApSPdB0GfGu2nCQgn9Q14Q9pnKXbOgv6N4xJ7wm2seAEy5QRq0DZOV64i334DSkSY6W8hwC9ijqrHfsAM9EGdHEgxp3A8AQfCWiT+nfrEaDMraItKAOV6FSL+wjyIwgqkUOcETdmVgvh2PDfDJL4cOunZkvNj4e2Vyu+odpYxSGQp9Lz5KpTkyqmnhvNm/Kkr7/JSMFMwho4WHnH6P+I4s//4G5hPaR4uDNFMVsEQexpNXxFsWq1E8ykT8F/b24IVQqBkTuHhLMp6W80v89ZqJJm8fWG5odigjVBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":869,"cache_read_input_tokens":113426,"cache_creation":{"ephemeral_5m_input_tokens":869,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWJcJgwLP1GmBfrAp8V3h","type":"assistant","uuid":"a7cbc559-320b-4a19-94fa-9bef792cb11e","timestamp":"2025-12-20T20:58:24.080Z"}
{"parentUuid":"a7cbc559-320b-4a19-94fa-9bef792cb11e","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01DPkt33Lp7whcdjzAebAan2","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01R9hU6RXKWWKtkof83Yfw2Y","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","old_string":"              <p className=\"text-lg font-bold\" style={{ color: impactColor }}>\n                -{flaw.harmonyPercentageLost.toFixed(2)}%","new_string":"              <p className=\"text-lg font-bold\" style={{ color: severityConfig.color }}>\n                -{flaw.harmonyPercentageLost.toFixed(2)}%"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":869,"cache_read_input_tokens":113426,"cache_creation":{"ephemeral_5m_input_tokens":869,"ephemeral_1h_input_tokens":0},"output_tokens":235,"service_tier":"standard"}},"requestId":"req_011CWJcJgwLP1GmBfrAp8V3h","type":"assistant","uuid":"747c2675-7d5f-4086-a5de-a3f46c8c0033","timestamp":"2025-12-20T20:58:26.130Z"}
{"parentUuid":"747c2675-7d5f-4086-a5de-a3f46c8c0033","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01R9hU6RXKWWKtkof83Yfw2Y","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   247→          {/* Impact metrics */}\n   248→          <div className=\"grid grid-cols-2 gap-3\">\n   249→            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n   250→              <p className=\"text-xs text-neutral-500 mb-1\">Harmony Lost</p>\n   251→              <p className=\"text-lg font-bold\" style={{ color: severityConfig.color }}>\n   252→                -{flaw.harmonyPercentageLost.toFixed(2)}%\n   253→              </p>\n   254→            </div>\n   255→            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n   256→              <p className=\"text-xs text-neutral-500 mb-1\">Impact Score</p>"}]},"uuid":"31ac4bff-3c4d-464b-b445-5207b021f0fb","timestamp":"2025-12-20T20:58:26.165Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","oldString":"              <p className=\"text-lg font-bold\" style={{ color: impactColor }}>\n                -{flaw.harmonyPercentageLost.toFixed(2)}%","newString":"              <p className=\"text-lg font-bold\" style={{ color: severityConfig.color }}>\n                -{flaw.harmonyPercentageLost.toFixed(2)}%","originalFile":"'use client';\n\nimport { motion } from 'framer-motion';\nimport { ChevronDown, TrendingDown, AlertTriangle, CheckCircle } from 'lucide-react';\nimport { Strength, Flaw, getScoreColor, getQualityColor } from '@/types/results';\nimport { QualityBadge, CategoryTag, ExpandableSection } from '../shared';\n\n// ============================================\n// SEVERITY BADGE - FaceIQ Style\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor';\n\ninterface SeverityConfig {\n  label: string;\n  color: string;\n  bgColor: string;\n  borderColor: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {\n  extremely_severe: {\n    label: 'Extremely Severe',\n    color: '#dc2626',\n    bgColor: 'rgba(220, 38, 38, 0.15)',\n    borderColor: 'rgba(220, 38, 38, 0.4)',\n  },\n  severe: {\n    label: 'Severe',\n    color: '#ef4444',\n    bgColor: 'rgba(239, 68, 68, 0.15)',\n    borderColor: 'rgba(239, 68, 68, 0.4)',\n  },\n  major: {\n    label: 'Major',\n    color: '#f97316',\n    bgColor: 'rgba(249, 115, 22, 0.15)',\n    borderColor: 'rgba(249, 115, 22, 0.4)',\n  },\n  moderate: {\n    label: 'Moderate',\n    color: '#fbbf24',\n    bgColor: 'rgba(251, 191, 36, 0.15)',\n    borderColor: 'rgba(251, 191, 36, 0.4)',\n  },\n  minor: {\n    label: 'Minor',\n    color: '#6b7280',\n    bgColor: 'rgba(107, 114, 128, 0.15)',\n    borderColor: 'rgba(107, 114, 128, 0.4)',\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  if (harmonyLost >= 5) return 'extremely_severe';\n  if (harmonyLost >= 3.5) return 'severe';\n  if (harmonyLost >= 2.5) return 'major';\n  if (harmonyLost >= 1.5) return 'moderate';\n  return 'minor';\n}\n\nfunction getSeverityFromScore(score: number): SeverityLevel {\n  if (score <= 2) return 'extremely_severe';\n  if (score <= 4) return 'severe';\n  if (score <= 5.5) return 'major';\n  if (score <= 7) return 'moderate';\n  return 'minor';\n}\n\ninterface SeverityBadgeProps {\n  severity: SeverityLevel;\n  size?: 'sm' | 'md';\n}\n\nexport function SeverityBadge({ severity, size = 'md' }: SeverityBadgeProps) {\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <span\n      className={`inline-flex items-center font-medium rounded-full ${\n        size === 'sm' ? 'px-2 py-0.5 text-[10px]' : 'px-2.5 py-1 text-xs'\n      }`}\n      style={{\n        color: config.color,\n        backgroundColor: config.bgColor,\n        border: `1px solid ${config.borderColor}`,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// STRENGTH CARD\n// ============================================\n\ninterface StrengthCardProps {\n  strength: Strength;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n}\n\nexport function StrengthCard({ strength, isExpanded = false, onToggle }: StrengthCardProps) {\n  const color = getQualityColor(strength.qualityLevel);\n\n  return (\n    <motion.div\n      layout\n      className={`bg-gradient-to-br from-green-500/10 to-cyan-500/5 border rounded-xl overflow-hidden transition-all ${\n        isExpanded ? 'border-green-500/50' : 'border-green-500/20 hover:border-green-500/40'\n      }`}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 flex items-start gap-3 text-left\"\n      >\n        {/* Icon */}\n        <div className=\"w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center flex-shrink-0\">\n          <CheckCircle size={20} className=\"text-green-400\" />\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h3 className=\"font-semibold text-white\">{strength.strengthName}</h3>\n            <QualityBadge quality={strength.qualityLevel} size=\"sm\" />\n          </div>\n          <p className=\"text-sm text-neutral-400 line-clamp-2\">{strength.summary}</p>\n          <div className=\"flex items-center gap-3 mt-2\">\n            <CategoryTag category={strength.categoryName} />\n            <span className=\"text-sm font-medium\" style={{ color }}>\n              Score: {strength.avgScore.toFixed(1)}/10\n            </span>\n          </div>\n        </div>\n\n        {/* Expand indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0 mt-1\"\n        >\n          <ChevronDown size={18} className=\"text-neutral-500\" />\n        </motion.div>\n      </button>\n\n      {/* Expanded Content */}\n      <ExpandableSection isExpanded={isExpanded}>\n        <div className=\"px-4 pb-4 space-y-3 border-t border-green-500/20 pt-3\">\n          <h4 className=\"text-sm font-medium text-neutral-300\">Responsible Ratios</h4>\n          <div className=\"space-y-2\">\n            {strength.responsibleRatios.map((ratio, i) => (\n              <div\n                key={i}\n                className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n              >\n                <span className=\"text-sm text-neutral-300\">{ratio.ratioName}</span>\n                <div className=\"flex items-center gap-2\">\n                  <span className=\"text-sm text-neutral-500\">\n                    {ratio.value.toFixed(2)}\n                  </span>\n                  <span\n                    className=\"text-sm font-medium\"\n                    style={{ color: getScoreColor(ratio.score) }}\n                  >\n                    {ratio.score.toFixed(1)}\n                  </span>\n                </div>\n              </div>\n            ))}\n          </div>\n        </div>\n      </ExpandableSection>\n    </motion.div>\n  );\n}\n\n// ============================================\n// FLAW CARD\n// ============================================\n\ninterface FlawCardProps {\n  flaw: Flaw;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  rank?: number;\n}\n\nexport function FlawCard({ flaw, isExpanded = false, onToggle, rank }: FlawCardProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n  const severityConfig = SEVERITY_CONFIGS[severity];\n\n  return (\n    <motion.div\n      layout\n      className={`bg-gradient-to-br from-red-500/10 to-orange-500/5 border rounded-xl overflow-hidden transition-all ${\n        isExpanded ? 'border-red-500/50' : 'border-red-500/20 hover:border-red-500/40'\n      }`}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 flex items-start gap-3 text-left\"\n      >\n        {/* Icon / Rank */}\n        <div className=\"w-10 h-10 rounded-lg bg-red-500/20 flex items-center justify-center flex-shrink-0\">\n          {rank !== undefined ? (\n            <span className=\"text-red-400 font-bold\">#{rank}</span>\n          ) : (\n            <AlertTriangle size={20} className=\"text-red-400\" />\n          )}\n        </div>\n\n        {/* Content */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n            <h3 className=\"font-semibold text-white\">{flaw.flawName}</h3>\n            <SeverityBadge severity={severity} size=\"sm\" />\n          </div>\n          <p className=\"text-sm text-neutral-400 line-clamp-2\">{flaw.summary}</p>\n          <div className=\"flex items-center gap-3 mt-2 flex-wrap\">\n            <CategoryTag category={flaw.categoryName} />\n            <div className=\"flex items-center gap-1\">\n              <TrendingDown size={14} style={{ color: severityConfig.color }} />\n              <span className=\"text-sm font-medium\" style={{ color: severityConfig.color }}>\n                -{flaw.harmonyPercentageLost.toFixed(1)}%\n              </span>\n            </div>\n          </div>\n        </div>\n\n        {/* Expand indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0 mt-1\"\n        >\n          <ChevronDown size={18} className=\"text-neutral-500\" />\n        </motion.div>\n      </button>\n\n      {/* Expanded Content */}\n      <ExpandableSection isExpanded={isExpanded}>\n        <div className=\"px-4 pb-4 space-y-3 border-t border-red-500/20 pt-3\">\n          {/* Impact metrics */}\n          <div className=\"grid grid-cols-2 gap-3\">\n            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Harmony Lost</p>\n              <p className=\"text-lg font-bold\" style={{ color: impactColor }}>\n                -{flaw.harmonyPercentageLost.toFixed(2)}%\n              </p>\n            </div>\n            <div className=\"bg-neutral-800/50 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Impact Score</p>\n              <p className=\"text-lg font-bold text-white\">\n                {flaw.standardizedImpact.toFixed(2)}\n              </p>\n            </div>\n          </div>\n\n          {/* Rolling impact if available */}\n          {flaw.rollingHarmonyPercentageLost !== undefined && (\n            <div className=\"bg-neutral-800/30 rounded-lg p-3\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Cumulative Impact</p>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"flex-1 h-2 bg-neutral-700 rounded-full overflow-hidden\">\n                  <div\n                    className=\"h-full bg-red-500\"\n                    style={{ width: `${Math.min(flaw.rollingHarmonyPercentageLost, 100)}%` }}\n                  />\n                </div>\n                <span className=\"text-sm text-red-400\">\n                  -{flaw.rollingHarmonyPercentageLost.toFixed(1)}%\n                </span>\n              </div>\n            </div>\n          )}\n\n          {/* Responsible ratios */}\n          <div>\n            <h4 className=\"text-sm font-medium text-neutral-300 mb-2\">Responsible Ratios</h4>\n            <div className=\"space-y-2\">\n              {flaw.responsibleRatios.map((ratio, i) => (\n                <div\n                  key={i}\n                  className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n                >\n                  <span className=\"text-sm text-neutral-300\">{ratio.ratioName}</span>\n                  <div className=\"flex items-center gap-2\">\n                    <span className=\"text-sm text-neutral-500\">\n                      {ratio.value.toFixed(2)}\n                    </span>\n                    <span\n                      className=\"text-sm font-medium\"\n                      style={{ color: getScoreColor(ratio.score) }}\n                    >\n                      {ratio.score.toFixed(1)}\n                    </span>\n                  </div>\n                </div>\n              ))}\n            </div>\n          </div>\n        </div>\n      </ExpandableSection>\n    </motion.div>\n  );\n}\n\n// ============================================\n// COMPACT STRENGTH/FLAW BADGES\n// ============================================\n\ninterface CompactStrengthBadgeProps {\n  strength: Strength;\n  onClick?: () => void;\n}\n\nexport function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-green-500/10 border border-green-500/20 rounded-lg hover:bg-green-500/20 transition-colors\"\n    >\n      <CheckCircle size={12} className=\"text-green-400\" />\n      <span className=\"text-xs text-green-300\">{strength.strengthName}</span>\n    </button>\n  );\n}\n\ninterface CompactFlawBadgeProps {\n  flaw: Flaw;\n  onClick?: () => void;\n  showSeverity?: boolean;\n}\n\nexport function CompactFlawBadge({ flaw, onClick, showSeverity = true }: CompactFlawBadgeProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-lg hover:opacity-80 transition-all\"\n      style={{\n        backgroundColor: config.bgColor,\n        border: `1px solid ${config.borderColor}`,\n      }}\n    >\n      <AlertTriangle size={12} style={{ color: config.color }} />\n      <span className=\"text-xs\" style={{ color: config.color }}>{flaw.flawName}</span>\n      {showSeverity && (\n        <span\n          className=\"text-[10px] px-1.5 py-0.5 rounded-full\"\n          style={{\n            backgroundColor: config.borderColor,\n            color: config.color,\n          }}\n        >\n          {config.label}\n        </span>\n      )}\n    </button>\n  );\n}\n\n// Export severity utilities for use in other components\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\nexport type { SeverityLevel };\n","structuredPatch":[{"oldStart":248,"oldLines":7,"newStart":248,"newLines":7,"lines":["           <div className=\"grid grid-cols-2 gap-3\">","             <div className=\"bg-neutral-800/50 rounded-lg p-3\">","               <p className=\"text-xs text-neutral-500 mb-1\">Harmony Lost</p>","-              <p className=\"text-lg font-bold\" style={{ color: impactColor }}>","+              <p className=\"text-lg font-bold\" style={{ color: severityConfig.color }}>","                 -{flaw.harmonyPercentageLost.toFixed(2)}%","               </p>","             </div>"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"31ac4bff-3c4d-464b-b445-5207b021f0fb","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01EBNeBXj3e8rtd8DdrDn3FV","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me fix the labelPosition type issue and the Set iteration issue.","signature":"EvABCkYIChgCKkDuOXAHv71FK6PCq3mMv1ia7qjNzVqxR0TIOE6qhaEHlX2uJkJQS5gjxqNQcBkMBh5XTs5tddtm7bZ6op91xLzIEgw3mvq3yyiUEHnXHc4aDLQfIlVg3NtnMDn2RCIwts+LP/FwmimOFZ8FR7LHGfCPYFyhIB5e2RXEzJrsabGr2r81avwmTXygQ1TJTxiwKli62zlvploj96dZS8pG+zlPZs2ZPbt2GeU+0CYsiSSADuflfJU7V72EHnSXYf0tJH0ysGFkZvqr2XhmKHQitQ9CrU6jDHqCmRRrMaAGv6YHFReJkYd22i1dGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":515,"cache_read_input_tokens":114295,"cache_creation":{"ephemeral_5m_input_tokens":515,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcK436MxYwdtYUhTa32","type":"assistant","uuid":"0671d6c3-3363-4102-840a-47f2b8862b24","timestamp":"2025-12-20T20:58:28.745Z"}
{"parentUuid":"0671d6c3-3363-4102-840a-47f2b8862b24","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01EBNeBXj3e8rtd8DdrDn3FV","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me fix the other TypeScript errors in ResultsContext.tsx."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":515,"cache_read_input_tokens":114295,"cache_creation":{"ephemeral_5m_input_tokens":515,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcK436MxYwdtYUhTa32","type":"assistant","uuid":"164827e4-2924-4890-ae28-6ad9ddca8585","timestamp":"2025-12-20T20:58:29.403Z"}
{"parentUuid":"164827e4-2924-4890-ae28-6ad9ddca8585","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01EBNeBXj3e8rtd8DdrDn3FV","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0116AjVD3Mzm9v23gikY4V25","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","offset":495,"limit":20}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":515,"cache_read_input_tokens":114295,"cache_creation":{"ephemeral_5m_input_tokens":515,"ephemeral_1h_input_tokens":0},"output_tokens":155,"service_tier":"standard"}},"requestId":"req_011CWJcK436MxYwdtYUhTa32","type":"assistant","uuid":"39c0d594-6126-41ac-aa8f-ba23875288d5","timestamp":"2025-12-20T20:58:30.531Z"}
{"parentUuid":"39c0d594-6126-41ac-aa8f-ba23875288d5","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0116AjVD3Mzm9v23gikY4V25","type":"tool_result","content":"   495→        color: line.color || '#67e8f9',\n   496→        label: line.label,\n   497→        labelPosition: line.labelPosition,\n   498→      };\n   499→    });\n   500→  }\n   501→\n   502→  return { points, lines };\n   503→}\n   504→\n   505→function getUsedLandmarks(metricId: string): string[] {\n   506→  const landmarkMappings: Record<string, string[]> = {\n   507→    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n   508→    lateralCanthalTilt: ['left_canthus_medialis', 'left_canthus_lateralis'],\n   509→    nasalIndex: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n   510→    ipd: ['left_pupila', 'right_pupila'],\n   511→    mouthWidth: ['left_cheilion', 'right_cheilion'],\n   512→    jawWidth: ['left_gonion_inferior', 'right_gonion_inferior'],\n   513→    chinHeight: ['labrale_inferius', 'menton'],\n   514→    gonialAngle: ['tragus', 'gonionBottom', 'menton'],\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"8bc29bf1-83b2-48a7-b65e-46384654dc89","timestamp":"2025-12-20T20:58:30.562Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","content":"        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}\n\nfunction getUsedLandmarks(metricId: string): string[] {\n  const landmarkMappings: Record<string, string[]> = {\n    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lateralCanthalTilt: ['left_canthus_medialis', 'left_canthus_lateralis'],\n    nasalIndex: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    ipd: ['left_pupila', 'right_pupila'],\n    mouthWidth: ['left_cheilion', 'right_cheilion'],\n    jawWidth: ['left_gonion_inferior', 'right_gonion_inferior'],\n    chinHeight: ['labrale_inferius', 'menton'],\n    gonialAngle: ['tragus', 'gonionBottom', 'menton'],","numLines":20,"startLine":495,"totalLines":1276}}}
{"parentUuid":"8bc29bf1-83b2-48a7-b65e-46384654dc89","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MR4zJjBsCM2LANMtrKUTAs","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Let me check the Ratio type to understand what labelPosition options are allowed.","signature":"EvkBCkYIChgCKkDxPFCu9gZSr/8i5uBfp1oXEedgfMNEBGSEl53xZr5FOVJ7u0okO0ZDdnzy4OmYRgRmIqfk6/ZCueIW8/lBhremEgwCes5PcItoNcxCHbMaDBQpw//PAOh0xJaekyIwJ0UBipGXjDA1psO8ygFolY2RPg+0CEQm+H4qRfkwW8YwZrMkUvW3gKetSIfh8q7SKmEW87HSN6zK4gu0/dtDj2MAKt3RlSDL4kPStAaeFYqYo7T+FbeBZ0fDXNbsRZyle5w56J7yMHCPshVmZgWpPhz5glWwCRNlGIrHZtWFadeJl3NOS+L+6D/IRnGIsJi0o77kGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":788,"cache_read_input_tokens":114810,"cache_creation":{"ephemeral_5m_input_tokens":788,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWJcKNkykMfRJywoYMbay","type":"assistant","uuid":"fd5c0fd7-4c0b-4965-b87c-0dc85a2b600a","timestamp":"2025-12-20T20:58:33.603Z"}
{"parentUuid":"fd5c0fd7-4c0b-4965-b87c-0dc85a2b600a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01MR4zJjBsCM2LANMtrKUTAs","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PC5HaPi5EbkWKG2kLAQroz","name":"Grep","input":{"pattern":"IllustrationLine|labelPosition","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/types/results.ts","output_mode":"content","-n":true,"-C":3}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":788,"cache_read_input_tokens":114810,"cache_creation":{"ephemeral_5m_input_tokens":788,"ephemeral_1h_input_tokens":0},"output_tokens":180,"service_tier":"standard"}},"requestId":"req_011CWJcKNkykMfRJywoYMbay","type":"assistant","uuid":"204603f7-5636-4cff-affa-14016ad9d4c0","timestamp":"2025-12-20T20:58:35.447Z"}
{"parentUuid":"204603f7-5636-4cff-affa-14016ad9d4c0","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PC5HaPi5EbkWKG2kLAQroz","type":"tool_result","content":"17-  label?: string;\n18-}\n19-\n20:export interface IllustrationLine {\n21-  from: string;\n22-  to: string;\n23-  color: string;\n24-  style?: 'solid' | 'dashed';\n25-  label?: string;\n26-  labelColor?: string;\n27:  labelPosition?: 'start' | 'middle' | 'end';\n28-}\n29-\n30-export interface RatioIllustration {\n31-  points: Record<string, IllustrationPoint>;\n32:  lines: Record<string, IllustrationLine>;\n33-}\n34-\n35-// ============================================"}]},"uuid":"5cb836b9-8761-4635-b59d-d2959350c8dc","timestamp":"2025-12-20T20:58:35.853Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"17-  label?: string;\n18-}\n19-\n20:export interface IllustrationLine {\n21-  from: string;\n22-  to: string;\n23-  color: string;\n24-  style?: 'solid' | 'dashed';\n25-  label?: string;\n26-  labelColor?: string;\n27:  labelPosition?: 'start' | 'middle' | 'end';\n28-}\n29-\n30-export interface RatioIllustration {\n31-  points: Record<string, IllustrationPoint>;\n32:  lines: Record<string, IllustrationLine>;\n33-}\n34-\n35-// ============================================","numLines":19}}
{"parentUuid":"5cb836b9-8761-4635-b59d-d2959350c8dc","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_013UhkPjdGXt6J7eQUjgr2sn","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The labelPosition in the IllustrationLine type is `'start' | 'middle' | 'end'`, but my config uses `'left' | 'right' | 'top' | 'bottom'`. I need to either update the type or map the positions. Let me update my config to use the valid values.","signature":"EpoDCkYIChgCKkCa/OgysI7pf57xpfuhiqjfHDbO4wyverWCXP/iJS6WrMOAG5MKZsBrbI6LNchobQZ0wEiB/qrOSc80bF+xQ51KEgyV9ZgnNX96H0fZHVsaDKOD8Hb2Bv+zsY62wCIwWv3Ap0IL+1a4YW5EmtRwwo/sJKOhkO0hqNTxJ8M7mIjAp5gTezmkuknojS+Yh8YLKoECLVjipALM8UqbUkF/w9ujX4/JGd39WVrW96Y1lHz1fflnEYKixF0eqXL/0LMhvwQf0kCV16Y9tIjfcRfTli/opm1bvsWaKp5sr0SSc3eBpoublgdDyCLvKRTiZ7JdMp9ARpXGth0HWCDYQ4h4251W+5X9omoH3pmJlfA4nKhxpsuLwk/p8pekgrXF8iQj9xkdhJvo94G45HkBAlxIBvUqyGxEp292EQRpbCz4Eh/qRBdNjYJaY8qM1suRkraWXaQ4590Ag43SX7Tjmv06FuYyqc+zd/m2/ZwCAAwh9tJPRFo006bF4H2KKGWtM8BdY0CrxiTRF7bhB9HEsl76BxYMC7wYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":365,"cache_read_input_tokens":115598,"cache_creation":{"ephemeral_5m_input_tokens":365,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcKmMGtPRttSeAZjH1D","type":"assistant","uuid":"8cfac7d8-d59c-498e-8ccc-78526a51b8db","timestamp":"2025-12-20T20:58:39.507Z"}
{"parentUuid":"8cfac7d8-d59c-498e-8ccc-78526a51b8db","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_013UhkPjdGXt6J7eQUjgr2sn","type":"message","role":"assistant","content":[{"type":"text","text":"I need to fix the labelPosition type mismatch. Let me update the IllustrationConfig to use valid values."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":365,"cache_read_input_tokens":115598,"cache_creation":{"ephemeral_5m_input_tokens":365,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcKmMGtPRttSeAZjH1D","type":"assistant","uuid":"c1e4bef7-e0fd-4fa6-9552-456a2b955eb8","timestamp":"2025-12-20T20:58:40.112Z"}
{"parentUuid":"c1e4bef7-e0fd-4fa6-9552-456a2b955eb8","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_013UhkPjdGXt6J7eQUjgr2sn","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Hbti3TmsNZDGwcuu3GGJMZ","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","old_string":"// Enhanced illustration configuration type\ninterface IllustrationConfig {\n  points: string[];\n  lines: Array<{\n    from: string;\n    to: string;\n    label?: string;\n    color?: string;\n    labelPosition?: 'left' | 'right' | 'top' | 'bottom';\n  }>;\n}","new_string":"// Enhanced illustration configuration type\ninterface IllustrationConfig {\n  points: string[];\n  lines: Array<{\n    from: string;\n    to: string;\n    label?: string;\n    color?: string;\n    labelPosition?: 'start' | 'middle' | 'end';  // Matches IllustrationLine type\n  }>;\n}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":365,"cache_read_input_tokens":115598,"cache_creation":{"ephemeral_5m_input_tokens":365,"ephemeral_1h_input_tokens":0},"output_tokens":384,"service_tier":"standard"}},"requestId":"req_011CWJcKmMGtPRttSeAZjH1D","type":"assistant","uuid":"5099e869-c956-4fee-9de4-34e8aadccd4c","timestamp":"2025-12-20T20:58:43.788Z"}
{"parentUuid":"5099e869-c956-4fee-9de4-34e8aadccd4c","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Hbti3TmsNZDGwcuu3GGJMZ","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   120→    } : undefined,\n   121→  };\n   122→}\n   123→\n   124→// Enhanced illustration configuration type\n   125→interface IllustrationConfig {\n   126→  points: string[];\n   127→  lines: Array<{\n   128→    from: string;\n   129→    to: string;\n   130→    label?: string;\n   131→    color?: string;\n   132→    labelPosition?: 'start' | 'middle' | 'end';  // Matches IllustrationLine type\n   133→  }>;\n   134→}\n   135→\n   136→// Comprehensive illustration configurations for all metrics\n   137→const ILLUSTRATION_CONFIGS: Record<string, IllustrationConfig> = {\n   138→  // =========================================="}]},"uuid":"073828a2-e69b-44d8-b906-8ce58734acb9","timestamp":"2025-12-20T20:58:43.830Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","oldString":"// Enhanced illustration configuration type\ninterface IllustrationConfig {\n  points: string[];\n  lines: Array<{\n    from: string;\n    to: string;\n    label?: string;\n    color?: string;\n    labelPosition?: 'left' | 'right' | 'top' | 'bottom';\n  }>;\n}","newString":"// Enhanced illustration configuration type\ninterface IllustrationConfig {\n  points: string[];\n  lines: Array<{\n    from: string;\n    to: string;\n    label?: string;\n    color?: string;\n    labelPosition?: 'start' | 'middle' | 'end';  // Matches IllustrationLine type\n  }>;\n}","originalFile":"'use client';\n\nimport React, { createContext, useContext, useState, useMemo, useCallback, ReactNode } from 'react';\nimport { LandmarkPoint } from '@/lib/landmarks';\nimport {\n  analyzeFrontProfile,\n  analyzeSideProfile,\n  analyzeHarmony,\n  HarmonyAnalysis,\n  FaceIQScoreResult,\n  FACEIQ_METRICS,\n  Ethnicity,\n  Gender,\n} from '@/lib/faceiq-scoring';\nimport {\n  Ratio,\n  Strength,\n  Flaw,\n  Recommendation,\n  ResultsTab,\n  FullHarmonyAnalysis,\n} from '@/types/results';\n\n// ============================================\n// CONTEXT TYPES\n// ============================================\n\ninterface ResultsContextType {\n  // Raw data\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  gender: Gender;\n  ethnicity: Ethnicity;\n  frontPhoto: string;\n  sidePhoto: string | null;\n\n  // Computed results\n  harmonyAnalysis: FullHarmonyAnalysis | null;\n  frontRatios: Ratio[];\n  sideRatios: Ratio[];\n  strengths: Strength[];\n  flaws: Flaw[];\n  recommendations: Recommendation[];\n\n  // Scores\n  overallScore: number;\n  frontScore: number;\n  sideScore: number;\n\n  // UI state\n  activeTab: ResultsTab;\n  setActiveTab: (tab: ResultsTab) => void;\n  expandedMeasurementId: string | null;\n  setExpandedMeasurementId: (id: string | null) => void;\n  selectedVisualizationMetric: string | null;\n  setSelectedVisualizationMetric: (id: string | null) => void;\n  categoryFilter: string | null;\n  setCategoryFilter: (category: string | null) => void;\n  showLandmarkOverlay: boolean;\n  setShowLandmarkOverlay: (show: boolean) => void;\n\n  // Actions\n  setResultsData: (data: ResultsInputData) => void;\n}\n\ninterface ResultsInputData {\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  frontPhoto: string;\n  sidePhoto?: string;\n  gender: Gender;\n  ethnicity?: Ethnicity;\n}\n\n// ============================================\n// HELPER FUNCTIONS\n// ============================================\n\nfunction convertUnitToRatioUnit(unit: string): 'x' | 'mm' | '%' | '°' {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return '°';\n    case 'mm': return 'mm';\n    default: return 'x';\n  }\n}\n\nfunction transformToRatio(result: FaceIQScoreResult, landmarks: LandmarkPoint[]): Ratio {\n  const metricConfig = FACEIQ_METRICS[result.metricId];\n\n  // Generate illustration based on metric\n  const illustration = generateIllustration(result.metricId, landmarks);\n\n  // Get flaw/strength mappings\n  const { mayIndicateFlaws, mayIndicateStrengths } = getFlawStrengthMappings(result);\n\n  return {\n    id: result.metricId,\n    name: result.name,\n    value: result.value,\n    score: result.score,\n    standardizedScore: result.standardizedScore,\n    unit: convertUnitToRatioUnit(result.unit),\n    idealMin: result.idealMin,\n    idealMax: result.idealMax,\n    rangeMin: metricConfig?.rangeMin || result.idealMin - 0.5,\n    rangeMax: metricConfig?.rangeMax || result.idealMax + 0.5,\n    description: metricConfig?.description || '',\n    category: result.category,\n    qualityLevel: result.qualityTier,\n    severity: result.severity,\n    illustration,\n    mayIndicateFlaws,\n    mayIndicateStrengths,\n    usedLandmarks: getUsedLandmarks(result.metricId),\n    scoringCurveConfig: metricConfig ? {\n      decayRate: metricConfig.decayRate,\n      maxScore: metricConfig.maxScore,\n    } : undefined,\n  };\n}\n\n// Enhanced illustration configuration type\ninterface IllustrationConfig {\n  points: string[];\n  lines: Array<{\n    from: string;\n    to: string;\n    label?: string;\n    color?: string;\n    labelPosition?: 'left' | 'right' | 'top' | 'bottom';\n  }>;\n}\n\n// Comprehensive illustration configurations for all metrics\nconst ILLUSTRATION_CONFIGS: Record<string, IllustrationConfig> = {\n  // ==========================================\n  // FACE SHAPE / PROPORTIONS\n  // ==========================================\n  faceWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'top' },\n      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'right' },\n    ],\n  },\n  totalFacialWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n      { from: 'trichion', to: 'menton', label: 'Total Height', color: '#a78bfa' },\n    ],\n  },\n  lowerThirdProportion: {\n    points: ['subnasale', 'menton', 'trichion'],\n    lines: [\n      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  middleThirdProportion: {\n    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n    lines: [\n      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  upperThirdProportion: {\n    points: ['trichion', 'nasal_base', 'menton'],\n    lines: [\n      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  bitemporalWidth: {\n    points: ['left_temporal', 'right_temporal', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_temporal', to: 'right_temporal', label: 'Temple', color: '#fbbf24' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek', color: '#67e8f9' },\n    ],\n  },\n  cheekboneHeight: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_lateralis', 'right_canthus_lateralis', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheekbone', color: '#ec4899' },\n      { from: 'left_canthus_lateralis', to: 'left_zygion', color: '#67e8f9' },\n    ],\n  },\n  midfaceRatio: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_medialis', 'right_canthus_medialis', 'subnasale'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Midface Width', color: '#67e8f9' },\n      { from: 'left_canthus_medialis', to: 'subnasale', label: 'Midface Height', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // JAW MEASUREMENTS\n  // ==========================================\n  jawSlope: {\n    points: ['left_gonion_inferior', 'left_mentum_lateralis', 'menton', 'right_mentum_lateralis', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'left_mentum_lateralis', label: 'Jaw Slope', color: '#f97316' },\n      { from: 'right_gonion_inferior', to: 'right_mentum_lateralis', color: '#f97316' },\n    ],\n  },\n  jawFrontalAngle: {\n    points: ['left_gonion_inferior', 'menton', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'menton', label: 'Jaw Angle', color: '#f97316' },\n      { from: 'menton', to: 'right_gonion_inferior', color: '#f97316' },\n    ],\n  },\n  bigonialWidth: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw Width', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n    ],\n  },\n  jawWidthRatio: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face', color: '#67e8f9' },\n    ],\n  },\n\n  // ==========================================\n  // EYE MEASUREMENTS\n  // ==========================================\n  lateralCanthalTilt: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'bottom' },\n      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n    ],\n  },\n  eyeAspectRatio: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'left_palpebra_superior', 'left_palpebra_inferior'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Width', color: '#06b6d4' },\n      { from: 'left_palpebra_superior', to: 'left_palpebra_inferior', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  eyeSeparationRatio: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryMouthWidthRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_cheilion', 'right_cheilion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n    ],\n  },\n  oneEyeApartTest: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Between Eyes', color: '#06b6d4' },\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Eye Width', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // EYEBROW MEASUREMENTS\n  // ==========================================\n  browLengthRatio: {\n    points: ['left_supercilium_medialis', 'left_supercilium_lateralis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_lateralis', label: 'Brow', color: '#84cc16' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  eyebrowTilt: {\n    points: ['left_supercilium_medialis', 'left_supercilium_apex', 'left_supercilium_lateralis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_apex', label: 'Tilt', color: '#84cc16' },\n      { from: 'left_supercilium_apex', to: 'left_supercilium_lateralis', color: '#84cc16' },\n    ],\n  },\n  eyebrowLowSetedness: {\n    points: ['left_supercilium_medialis', 'left_palpebra_superior', 'left_canthus_medialis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_palpebra_superior', label: 'Brow-Eye Gap', color: '#84cc16' },\n    ],\n  },\n\n  // ==========================================\n  // NOSE MEASUREMENTS (FRONT)\n  // ==========================================\n  nasalIndex: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Width', color: '#fbbf24' },\n      { from: 'nasal_base', to: 'subnasale', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  intercanthalNasalRatio: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'left_canthus_medialis', 'right_canthus_medialis'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose Width', color: '#fbbf24' },\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n    ],\n  },\n  noseBridgeWidth: {\n    points: ['left_dorsum_nasi', 'right_dorsum_nasi', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_dorsum_nasi', to: 'right_dorsum_nasi', label: 'Bridge', color: '#fbbf24' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Base', color: '#f97316' },\n    ],\n  },\n  noseTipPosition: {\n    points: ['subnasale', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Tip Position', color: '#fbbf24' },\n    ],\n  },\n\n  // ==========================================\n  // MOUTH/LIP MEASUREMENTS\n  // ==========================================\n  mouthNoseWidthRatio: {\n    points: ['left_cheilion', 'right_cheilion', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  lowerUpperLipRatio: {\n    points: ['labrale_superius', 'mouth_middle', 'labrale_inferius'],\n    lines: [\n      { from: 'labrale_superius', to: 'mouth_middle', label: 'Upper', color: '#ec4899' },\n      { from: 'mouth_middle', to: 'labrale_inferius', label: 'Lower', color: '#f97316' },\n    ],\n  },\n  chinPhiltrumRatio: {\n    points: ['subnasale', 'labrale_superius', 'labrale_inferius', 'menton'],\n    lines: [\n      { from: 'subnasale', to: 'labrale_superius', label: 'Philtrum', color: '#ec4899' },\n      { from: 'labrale_inferius', to: 'menton', label: 'Chin', color: '#ef4444' },\n    ],\n  },\n  mouthWidth: {\n    points: ['left_cheilion', 'right_cheilion'],\n    lines: [{ from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth Width', color: '#ec4899' }],\n  },\n\n  // ==========================================\n  // CHIN MEASUREMENTS\n  // ==========================================\n  chinHeight: {\n    points: ['labrale_inferius', 'menton'],\n    lines: [{ from: 'labrale_inferius', to: 'menton', label: 'Chin Height', color: '#ef4444' }],\n  },\n\n  // ==========================================\n  // NECK MEASUREMENTS\n  // ==========================================\n  neckWidthRatio: {\n    points: ['left_cervical_lateralis', 'right_cervical_lateralis', 'left_gonion_inferior', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_cervical_lateralis', to: 'right_cervical_lateralis', label: 'Neck', color: '#14b8a6' },\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n    ],\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS\n  // ==========================================\n  gonialAngle: {\n    points: ['tragus', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'tragus', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  nasofrontalAngle: {\n    points: ['glabella', 'nasion', 'pronasale'],\n    lines: [\n      { from: 'glabella', to: 'nasion', label: 'Forehead', color: '#84cc16' },\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  nasofacialAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', color: '#67e8f9' },\n    ],\n  },\n  nasomentaAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', label: 'To Chin', color: '#ef4444' },\n    ],\n  },\n  submentalCervicalAngle: {\n    points: ['menton', 'cervicalPoint', 'neckPoint'],\n    lines: [\n      { from: 'menton', to: 'cervicalPoint', label: 'Submental', color: '#14b8a6' },\n      { from: 'cervicalPoint', to: 'neckPoint', label: 'Cervical', color: '#06b6d4' },\n    ],\n  },\n  facialDepthToHeight: {\n    points: ['pronasale', 'tragus', 'nasion', 'menton'],\n    lines: [\n      { from: 'pronasale', to: 'tragus', label: 'Depth', color: '#67e8f9' },\n      { from: 'nasion', to: 'menton', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  anteriorFacialDepth: {\n    points: ['glabella', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'glabella', to: 'pronasale', color: '#67e8f9' },\n      { from: 'pronasale', to: 'pogonion', color: '#a78bfa' },\n    ],\n  },\n  mandibularPlaneAngle: {\n    points: ['gonionBottom', 'menton', 'orbitale', 'porion'],\n    lines: [\n      { from: 'gonionBottom', to: 'menton', label: 'Mandibular', color: '#f97316' },\n      { from: 'orbitale', to: 'porion', label: 'Frankfort', color: '#67e8f9' },\n    ],\n  },\n  ramusToMandibleRatio: {\n    points: ['gonionTop', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'gonionTop', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  orbitalVector: {\n    points: ['cornealApex', 'orbitale', 'cheekbone'],\n    lines: [\n      { from: 'cornealApex', to: 'cheekbone', label: 'Orbital Vector', color: '#06b6d4' },\n    ],\n  },\n  eLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'E-Line', color: '#67e8f9' },\n    ],\n  },\n  sLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'S-Line', color: '#a78bfa' },\n    ],\n  },\n  holdawayHLine: {\n    points: ['pronasale', 'pogonion', 'labraleSuperius', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'H-Line', color: '#ec4899' },\n    ],\n  },\n  burstoneLowerLip: {\n    points: ['subnasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'subnasale', to: 'pogonion', label: 'Burstone', color: '#fbbf24' },\n    ],\n  },\n};\n\nfunction generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  const config = ILLUSTRATION_CONFIGS[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = {\n        from: line.from,\n        to: line.to,\n        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}\n\nfunction getUsedLandmarks(metricId: string): string[] {\n  const landmarkMappings: Record<string, string[]> = {\n    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lateralCanthalTilt: ['left_canthus_medialis', 'left_canthus_lateralis'],\n    nasalIndex: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    ipd: ['left_pupila', 'right_pupila'],\n    mouthWidth: ['left_cheilion', 'right_cheilion'],\n    jawWidth: ['left_gonion_inferior', 'right_gonion_inferior'],\n    chinHeight: ['labrale_inferius', 'menton'],\n    gonialAngle: ['tragus', 'gonionBottom', 'menton'],\n  };\n  return landmarkMappings[metricId] || [];\n}\n\nfunction getFlawStrengthMappings(result: FaceIQScoreResult): { mayIndicateFlaws: string[]; mayIndicateStrengths: string[] } {\n  const flawMappings: Record<string, { low: string[]; high: string[] }> = {\n    faceWidthToHeight: {\n      low: ['Narrow face', 'Vertically elongated face'],\n      high: ['Wide face', 'Horizontally expanded face'],\n    },\n    lowerThirdProportion: {\n      low: ['Short lower third', 'Deficient mandible'],\n      high: ['Long lower third', 'Mandibular excess'],\n    },\n    lateralCanthalTilt: {\n      low: ['Negative canthal tilt', 'Drooping eyes'],\n      high: ['Excessive positive canthal tilt'],\n    },\n    nasalIndex: {\n      low: ['Narrow nose', 'Leptorrhine nose'],\n      high: ['Wide nose', 'Platyrrhine nose'],\n    },\n    gonialAngle: {\n      low: ['Steep mandibular plane'],\n      high: ['Flat mandibular plane', 'Weak jaw definition'],\n    },\n  };\n\n  const strengthMappings: Record<string, { ideal: string[] }> = {\n    faceWidthToHeight: { ideal: ['Balanced facial proportions', 'Harmonious face shape'] },\n    lateralCanthalTilt: { ideal: ['Attractive eye shape', 'Positive canthal tilt'] },\n    nasalIndex: { ideal: ['Well-proportioned nose', 'Balanced nasal width'] },\n    gonialAngle: { ideal: ['Well-defined jawline', 'Strong jaw structure'] },\n  };\n\n  const mapping = flawMappings[result.metricId];\n  const strengthMapping = strengthMappings[result.metricId];\n\n  let mayIndicateFlaws: string[] = [];\n  let mayIndicateStrengths: string[] = [];\n\n  if (result.qualityTier === 'ideal' || result.qualityTier === 'excellent') {\n    mayIndicateStrengths = strengthMapping?.ideal || [];\n  } else if (mapping) {\n    mayIndicateFlaws = result.deviationDirection === 'below' ? mapping.low : mapping.high;\n  }\n\n  return { mayIndicateFlaws, mayIndicateStrengths };\n}\n\nfunction generateStrengthsFromAnalysis(analysis: HarmonyAnalysis): Strength[] {\n  const strengths: Strength[] = [];\n\n  analysis.strengths.forEach((s, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === s.metricId);\n\n    strengths.push({\n      id: `strength_${i}`,\n      strengthName: s.metricName,\n      summary: s.reasoning,\n      avgScore: matchingMeasurement?.score || 8,\n      qualityLevel: s.qualityTier,\n      categoryName: s.category,\n      responsibleRatios: [{\n        ratioName: s.metricName,\n        ratioId: s.metricId,\n        score: matchingMeasurement?.score || 8,\n        value: s.value,\n      }],\n    });\n  });\n\n  return strengths;\n}\n\nfunction generateFlawsFromAnalysis(analysis: HarmonyAnalysis): Flaw[] {\n  const flaws: Flaw[] = [];\n  let rollingLost = 0;\n\n  analysis.flaws.forEach((f, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === f.metricId);\n    const impact = matchingMeasurement ? (10 - matchingMeasurement.score) * 0.5 : 2;\n    rollingLost += impact;\n\n    flaws.push({\n      id: `flaw_${i}`,\n      flawName: f.metricName,\n      summary: f.reasoning,\n      harmonyPercentageLost: impact,\n      standardizedImpact: impact / 10,\n      categoryName: f.category,\n      responsibleRatios: [{\n        ratioName: f.metricName,\n        ratioId: f.metricId,\n        score: matchingMeasurement?.score || 3,\n        value: matchingMeasurement?.value || 0,\n      }],\n      rollingPointsDeducted: rollingLost,\n      rollingHarmonyPercentageLost: rollingLost,\n      rollingStandardizedImpact: rollingLost / 10,\n    });\n  });\n\n  return flaws.sort((a, b) => b.harmonyPercentageLost - a.harmonyPercentageLost);\n}\n\n// Comprehensive procedure database with metric-specific targeting\ninterface ProcedureConfig {\n  ref_id: string;\n  name: string;\n  description: string;\n  phase: 'Surgical' | 'Minimally Invasive' | 'Foundational';\n  baseImpact: number;\n  coverage: number;\n  percentage: string;\n  expectedImprovementRange: { min: number; max: number };\n  targetMetrics: string[];  // Specific metric IDs this treatment addresses\n  targetCategories: string[];  // Category names this treatment addresses\n  targetKeywords: string[];  // Flaw name keywords to match\n  timeline: { effect_start: 'immediate' | 'delayed' | 'gradual'; full_results_weeks: number; full_results_weeks_max?: number };\n  cost: { type: 'flat' | 'per_session' | 'per_month'; min: number; max: number; currency: string };\n  risks_side_effects: string;\n  warnings: string[];\n  gender: 'male' | 'female' | 'both';\n}\n\nconst PROCEDURE_DATABASE: ProcedureConfig[] = [\n  // ==========================================\n  // SURGICAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'SUR-01',\n    name: 'Sliding Genioplasty',\n    description: 'Chin bone repositioning surgery that can move the chin forward, backward, up, or down for optimal projection and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.90,\n    coverage: 8,\n    percentage: '15-25%',\n    expectedImprovementRange: { min: 0.5, max: 1.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'facialDepthToHeight', 'anteriorFacialDepth', 'nasomentaAngle'],\n    targetCategories: ['Chin', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['chin', 'recessed', 'weak', 'short chin', 'long chin', 'pogonion'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage, bone resorption.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-02',\n    name: 'Reduction Rhinoplasty',\n    description: 'Surgical reduction of nose size, hump removal, and tip refinement to improve nasal proportions.',\n    phase: 'Surgical',\n    baseImpact: 0.85,\n    coverage: 6,\n    percentage: '10-20%',\n    expectedImprovementRange: { min: 0.5, max: 1.0 },\n    targetMetrics: ['nasalIndex', 'nasofrontalAngle', 'nasofacialAngle', 'nasomentaAngle', 'intercanthalNasalRatio', 'noseBridgeWidth'],\n    targetCategories: ['Nose'],\n    targetKeywords: ['wide nose', 'large nose', 'dorsal hump', 'bulbous', 'nasal', 'nose bridge'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 7000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-03',\n    name: 'Jaw Angle Implants',\n    description: 'Custom or standard silicone/PEEK implants to enhance jaw width, definition, and angularity.',\n    phase: 'Surgical',\n    baseImpact: 0.80,\n    coverage: 5,\n    percentage: '10-15%',\n    expectedImprovementRange: { min: 0.4, max: 1.0 },\n    targetMetrics: ['bigonialWidth', 'jawFrontalAngle', 'jawWidthRatio', 'jawSlope', 'gonialAngle'],\n    targetCategories: ['Jaw Shape'],\n    targetKeywords: ['narrow jaw', 'weak jaw', 'soft jaw', 'jaw angle', 'gonial', 'mandible'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection, bone erosion.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-04',\n    name: 'Bimaxillary Osteotomy (Bimax)',\n    description: 'Double jaw surgery to reposition both upper and lower jaws for optimal occlusion and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.95,\n    coverage: 12,\n    percentage: '20-35%',\n    expectedImprovementRange: { min: 1.0, max: 2.0 },\n    targetMetrics: ['midfaceRatio', 'facialDepthToHeight', 'mandibularPlaneAngle', 'lowerThirdProportion', 'nasofacialAngle'],\n    targetCategories: ['Occlusion/Jaw Growth', 'Midface/Face Shape'],\n    targetKeywords: ['maxillary recession', 'mandibular', 'hyper-divergent', 'bite', 'occlusion', 'midface recession'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 20000, max: 60000, currency: 'USD' },\n    risks_side_effects: 'Extended recovery, numbness (temporary to permanent), dietary restrictions.',\n    warnings: ['Major surgery - requires orthodontic preparation'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-05',\n    name: 'Canthoplasty',\n    description: 'Surgical eye corner modification to improve canthal tilt and eye shape.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.8 },\n    targetMetrics: ['lateralCanthalTilt', 'eyeAspectRatio'],\n    targetCategories: ['Eyes'],\n    targetKeywords: ['canthal tilt', 'negative tilt', 'drooping eyes', 'eye shape', 'eye angle'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 4000, max: 12000, currency: 'USD' },\n    risks_side_effects: 'Scarring, asymmetry, dry eyes, ectropion.',\n    warnings: ['Difficult to reverse'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-06',\n    name: 'Cheek/Malar Implants',\n    description: 'Solid implants placed over the cheekbones to enhance midface projection and width.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 4,\n    percentage: '10-18%',\n    expectedImprovementRange: { min: 0.4, max: 0.9 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio', 'totalFacialWidthToHeight'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface', 'zygomatic', 'malar'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 6, full_results_weeks_max: 12 },\n    cost: { type: 'flat', min: 6000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry, implant shifting, nerve damage.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-07',\n    name: 'Neck Liposuction / Submentoplasty',\n    description: 'Fat removal and skin tightening under the chin and neck area.',\n    phase: 'Surgical',\n    baseImpact: 0.65,\n    coverage: 3,\n    percentage: '8-12%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['round neck', 'double chin', 'submental', 'cervical', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 3000, max: 8000, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, skin irregularity, numbness.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-08',\n    name: 'Brow Bone Reduction/Augmentation',\n    description: 'Surgical reshaping of the brow ridge for improved upper third harmony.',\n    phase: 'Surgical',\n    baseImpact: 0.70,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['nasofrontalAngle', 'bitemporalWidth', 'upperThirdProportion'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['brow ridge', 'forehead', 'nasofrontal', 'upper third', 'glabella'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling, numbness, scarring (if coronal incision).',\n    warnings: [],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // MINIMALLY INVASIVE TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'MIN-01',\n    name: 'Chin/Jawline Filler',\n    description: 'Hyaluronic acid injections to enhance chin projection and jawline definition. Reversible and temporary.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 4,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'jawFrontalAngle', 'bigonialWidth'],\n    targetCategories: ['Chin', 'Jaw Shape'],\n    targetKeywords: ['weak chin', 'recessed chin', 'soft jaw', 'jawline'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 800, max: 2500, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n    warnings: ['Results temporary (12-18 months)', 'Requires maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-02',\n    name: 'Cheek Filler',\n    description: 'HA filler to enhance cheekbone projection and midface volume.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 3,\n    percentage: '5-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface volume'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 600, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, asymmetry.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-03',\n    name: 'Lip Filler',\n    description: 'Hyaluronic acid to enhance lip volume and proportions.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['lowerUpperLipRatio', 'mouthNoseWidthRatio'],\n    targetCategories: ['Lips'],\n    targetKeywords: ['thin lip', 'lip ratio', 'lip volume', 'upper lip', 'lower lip'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 400, max: 1200, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, lumps.',\n    warnings: ['Results temporary (6-12 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-04',\n    name: 'PDO Thread Lift',\n    description: 'Dissolvable threads to lift and tighten skin, particularly for canthal tilt improvement.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 3,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.1, max: 0.4 },\n    targetMetrics: ['lateralCanthalTilt', 'eyebrowLowSetedness'],\n    targetCategories: ['Eyes', 'Upper Third'],\n    targetKeywords: ['canthal tilt', 'drooping', 'sagging', 'eyebrow position'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 1500, max: 4000, currency: 'USD' },\n    risks_side_effects: 'Bruising, asymmetry, thread visibility, infection.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-05',\n    name: 'Masseter Botox',\n    description: 'Botulinum toxin to slim the lower face by relaxing masseter muscles.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 2,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['bigonialWidth', 'jawWidthRatio', 'faceWidthToHeight'],\n    targetCategories: ['Jaw Shape', 'Midface/Face Shape'],\n    targetKeywords: ['wide jaw', 'square jaw', 'masseter', 'bruxism'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 400, max: 1000, currency: 'USD' },\n    risks_side_effects: 'Temporary weakness, asymmetry, difficulty chewing.',\n    warnings: ['Results temporary (4-6 months)', 'Requires regular maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-06',\n    name: 'Kybella (Submental Fat Dissolving)',\n    description: 'Injectable deoxycholic acid to permanently destroy fat cells under the chin.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 2,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['double chin', 'submental fat', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'per_session', min: 1200, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, numbness, difficulty swallowing (temporary).',\n    warnings: ['Requires 2-4 sessions'],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // FOUNDATIONAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'FND-01',\n    name: 'Mewing / Proper Tongue Posture',\n    description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 5,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['midfaceRatio', 'bigonialWidth', 'facialDepthToHeight'],\n    targetCategories: ['Midface/Face Shape', 'Jaw Shape', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['midface', 'palate', 'recession', 'jaw development'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n    cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n    risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n    warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-02',\n    name: 'Body Recomposition (Leanmaxxing)',\n    description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n    phase: 'Foundational',\n    baseImpact: 0.35,\n    coverage: 6,\n    percentage: '5-12%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['bigonialWidth', 'submentalCervicalAngle', 'cheekboneHeight'],\n    targetCategories: ['Jaw Shape', 'Neck', 'Midface/Face Shape'],\n    targetKeywords: ['soft jaw', 'undefined', 'round', 'facial definition'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n    risks_side_effects: 'None if done healthily.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-03',\n    name: 'Posture Correction',\n    description: 'Improving head and neck posture to optimize facial appearance and reduce forward head posture effects.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 3,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.2 },\n    targetMetrics: ['submentalCervicalAngle', 'anteriorFacialDepth'],\n    targetCategories: ['Neck', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['neck', 'posture', 'forward head'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 0, max: 100, currency: 'USD' },\n    risks_side_effects: 'None.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-04',\n    name: 'Skincare Routine (Retinoid + SPF)',\n    description: 'Medical-grade skincare to improve skin quality, texture, and reduce aging signs.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 2,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: [],\n    targetCategories: [],\n    targetKeywords: ['skin', 'texture', 'aging'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 26 },\n    cost: { type: 'per_month', min: 30, max: 150, currency: 'USD' },\n    risks_side_effects: 'Initial irritation, sun sensitivity.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-05',\n    name: 'Eyebrow Grooming / Microblading',\n    description: 'Professional shaping or semi-permanent tattooing to optimize eyebrow shape and position.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['eyebrowTilt', 'eyebrowLowSetedness', 'browLengthRatio'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['eyebrow', 'brow', 'upper third'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'flat', min: 20, max: 600, currency: 'USD' },\n    risks_side_effects: 'Minimal for grooming. Microblading: infection risk, color fading.',\n    warnings: [],\n    gender: 'both',\n  },\n];\n\n// Calculate relevance score based on multiple factors\nfunction calculateRelevanceScore(\n  proc: ProcedureConfig,\n  flaw: Flaw,\n  allFlaws: Flaw[]\n): number {\n  let score = 0;\n\n  // Check metric ID match (highest priority)\n  const metricId = flaw.responsibleRatios[0]?.ratioId || '';\n  if (proc.targetMetrics.includes(metricId)) {\n    score += 40;\n  }\n\n  // Check category match\n  if (proc.targetCategories.some(cat =>\n    flaw.categoryName.toLowerCase().includes(cat.toLowerCase()) ||\n    cat.toLowerCase().includes(flaw.categoryName.toLowerCase())\n  )) {\n    score += 25;\n  }\n\n  // Check keyword match\n  const flawLower = flaw.flawName.toLowerCase();\n  const summaryLower = flaw.summary.toLowerCase();\n  const matchedKeywords = proc.targetKeywords.filter(kw =>\n    flawLower.includes(kw.toLowerCase()) || summaryLower.includes(kw.toLowerCase())\n  );\n  score += matchedKeywords.length * 10;\n\n  // Adjust by flaw severity/impact\n  score += Math.min(flaw.harmonyPercentageLost * 3, 15);\n\n  // Bonus if this procedure addresses multiple flaws\n  const otherFlawsAddressed = allFlaws.filter(f =>\n    f.id !== flaw.id && (\n      proc.targetMetrics.includes(f.responsibleRatios[0]?.ratioId || '') ||\n      proc.targetCategories.some(cat => f.categoryName.toLowerCase().includes(cat.toLowerCase()))\n    )\n  );\n  score += otherFlawsAddressed.length * 5;\n\n  return Math.min(score, 100);\n}\n\nfunction generateRecommendations(flaws: Flaw[], frontRatios: Ratio[] = [], sideRatios: Ratio[] = []): Recommendation[] {\n  const recommendations: Recommendation[] = [];\n  const allRatios = [...frontRatios, ...sideRatios];\n\n  // Track which procedures have been added and their matched flaws\n  const procMatches: Map<string, { flaws: string[]; ratios: string[]; maxScore: number }> = new Map();\n\n  flaws.forEach(flaw => {\n    PROCEDURE_DATABASE.forEach(proc => {\n      const relevanceScore = calculateRelevanceScore(proc, flaw, flaws);\n\n      if (relevanceScore >= 25) {  // Minimum threshold\n        const existing = procMatches.get(proc.ref_id);\n        if (existing) {\n          existing.flaws.push(flaw.flawName);\n          existing.ratios.push(...flaw.responsibleRatios.map(r => r.ratioName));\n          existing.maxScore = Math.max(existing.maxScore, relevanceScore);\n        } else {\n          procMatches.set(proc.ref_id, {\n            flaws: [flaw.flawName],\n            ratios: flaw.responsibleRatios.map(r => r.ratioName),\n            maxScore: relevanceScore,\n          });\n        }\n      }\n    });\n  });\n\n  // Build recommendations from matched procedures\n  procMatches.forEach((match, procId) => {\n    const proc = PROCEDURE_DATABASE.find(p => p.ref_id === procId);\n    if (!proc) return;\n\n    // Calculate expected improvement based on severity of matched flaws\n    const matchedFlawDetails = flaws.filter(f => match.flaws.includes(f.flawName));\n    const avgImpact = matchedFlawDetails.reduce((sum, f) => sum + f.harmonyPercentageLost, 0) / matchedFlawDetails.length;\n    const severityMultiplier = Math.min(avgImpact / 3, 1.5);  // More severe = more potential improvement\n\n    // Get affected ratios from the actual data\n    const affectedRatios = allRatios.filter(r =>\n      proc.targetMetrics.includes(r.id) ||\n      match.flaws.some(f => f.toLowerCase().includes(r.category.toLowerCase()))\n    );\n\n    const adjustedImpact = proc.baseImpact * (0.8 + (match.maxScore / 500));  // Slight boost for high relevance\n\n    recommendations.push({\n      ref_id: proc.ref_id,\n      name: proc.name,\n      description: proc.description,\n      phase: proc.phase,\n      impact: adjustedImpact,\n      coverage: match.flaws.length + match.ratios.length,\n      percentage: proc.percentage,\n      expectedImprovementRange: {\n        min: proc.expectedImprovementRange.min * severityMultiplier,\n        max: proc.expectedImprovementRange.max * severityMultiplier,\n      },\n      matchedFlaws: [...new Set(match.flaws)],\n      matchedRatios: [...new Set(match.ratios)],\n      ratios_impacted: affectedRatios.map(r => ({\n        ratioId: r.id,\n        ratioName: r.name,\n        direction: 'both' as const,\n        percentageEffect: proc.baseImpact,\n      })),\n      timeline: proc.timeline,\n      cost: proc.cost,\n      risks_side_effects: proc.risks_side_effects,\n      warnings: proc.warnings,\n      gender: proc.gender,\n    });\n  });\n\n  // Sort by impact (higher = better), then by coverage (more flaws addressed = better)\n  return recommendations.sort((a, b) => {\n    const impactDiff = b.impact - a.impact;\n    if (Math.abs(impactDiff) > 0.1) return impactDiff;\n    return b.coverage - a.coverage;\n  });\n}\n\n// ============================================\n// CONTEXT CREATION\n// ============================================\n\nconst ResultsContext = createContext<ResultsContextType | null>(null);\n\nexport function useResults(): ResultsContextType {\n  const context = useContext(ResultsContext);\n  if (!context) {\n    throw new Error('useResults must be used within a ResultsProvider');\n  }\n  return context;\n}\n\ninterface ResultsProviderProps {\n  children: ReactNode;\n  initialData?: ResultsInputData;\n}\n\nexport function ResultsProvider({ children, initialData }: ResultsProviderProps) {\n  // Raw data state\n  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>(initialData?.frontLandmarks || []);\n  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>(initialData?.sideLandmarks || []);\n  const [gender, setGender] = useState<Gender>(initialData?.gender || 'male');\n  const [ethnicity, setEthnicity] = useState<Ethnicity>(initialData?.ethnicity || 'other');\n  const [frontPhoto, setFrontPhoto] = useState<string>(initialData?.frontPhoto || '');\n  const [sidePhoto, setSidePhoto] = useState<string | null>(initialData?.sidePhoto || null);\n\n  // UI state\n  const [activeTab, setActiveTab] = useState<ResultsTab>('overview');\n  const [expandedMeasurementId, setExpandedMeasurementId] = useState<string | null>(null);\n  const [selectedVisualizationMetric, setSelectedVisualizationMetric] = useState<string | null>(null);\n  const [categoryFilter, setCategoryFilter] = useState<string | null>(null);\n  const [showLandmarkOverlay, setShowLandmarkOverlay] = useState(true);\n\n  // Compute analysis results (now with demographic-specific scoring)\n  const analysisResults = useMemo(() => {\n    if (frontLandmarks.length === 0) {\n      return null;\n    }\n\n    try {\n      const frontAnalysis = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n      const sideAnalysis = sideLandmarks.length > 0\n        ? analyzeSideProfile(sideLandmarks, gender, ethnicity)\n        : null;\n      // analyzeHarmony expects landmarks directly, not analysis results\n      const harmony = analyzeHarmony(frontLandmarks, sideLandmarks, gender, ethnicity);\n\n      return { frontAnalysis, sideAnalysis, harmony };\n    } catch (error) {\n      console.error('Analysis error:', error);\n      return null;\n    }\n  }, [frontLandmarks, sideLandmarks, gender, ethnicity]);\n\n  // Transform to Ratio format\n  const frontRatios = useMemo(() => {\n    if (!analysisResults?.frontAnalysis) return [];\n    return analysisResults.frontAnalysis.measurements.map(m => transformToRatio(m, frontLandmarks));\n  }, [analysisResults, frontLandmarks]);\n\n  const sideRatios = useMemo(() => {\n    if (!analysisResults?.sideAnalysis) return [];\n    return analysisResults.sideAnalysis.measurements.map(m => transformToRatio(m, sideLandmarks));\n  }, [analysisResults, sideLandmarks]);\n\n  // Generate strengths and flaws\n  const strengths = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateStrengthsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  const flaws = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateFlawsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  // Generate recommendations with metric-aware matching\n  const recommendations = useMemo(() => {\n    return generateRecommendations(flaws, frontRatios, sideRatios);\n  }, [flaws, frontRatios, sideRatios]);\n\n  // Build full harmony analysis\n  const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {\n    if (!analysisResults?.harmony) return null;\n\n    return {\n      standardizedScore: analysisResults.harmony.overallScore,\n      front: {\n        standardizedScore: analysisResults.harmony.frontScore,\n        ratios: frontRatios,\n      },\n      side: {\n        standardizedScore: analysisResults.harmony.sideScore,\n        ratios: sideRatios,\n      },\n      strengths,\n      flaws,\n    };\n  }, [analysisResults, frontRatios, sideRatios, strengths, flaws]);\n\n  // Scores\n  const overallScore = analysisResults?.harmony?.overallScore || 0;\n  const frontScore = analysisResults?.harmony?.frontScore || 0;\n  const sideScore = analysisResults?.harmony?.sideScore || 0;\n\n  // Action to set all results data\n  const setResultsData = useCallback((data: ResultsInputData) => {\n    setFrontLandmarks(data.frontLandmarks);\n    setSideLandmarks(data.sideLandmarks);\n    setFrontPhoto(data.frontPhoto);\n    setSidePhoto(data.sidePhoto || null);\n    setGender(data.gender);\n    setEthnicity(data.ethnicity || 'other');\n  }, []);\n\n  const value: ResultsContextType = {\n    frontLandmarks,\n    sideLandmarks,\n    gender,\n    ethnicity,\n    frontPhoto,\n    sidePhoto,\n    harmonyAnalysis,\n    frontRatios,\n    sideRatios,\n    strengths,\n    flaws,\n    recommendations,\n    overallScore,\n    frontScore,\n    sideScore,\n    activeTab,\n    setActiveTab,\n    expandedMeasurementId,\n    setExpandedMeasurementId,\n    selectedVisualizationMetric,\n    setSelectedVisualizationMetric,\n    categoryFilter,\n    setCategoryFilter,\n    showLandmarkOverlay,\n    setShowLandmarkOverlay,\n    setResultsData,\n  };\n\n  return (\n    <ResultsContext.Provider value={value}>\n      {children}\n    </ResultsContext.Provider>\n  );\n}\n","structuredPatch":[{"oldStart":129,"oldLines":7,"newStart":129,"newLines":7,"lines":["     to: string;","     label?: string;","     color?: string;","-    labelPosition?: 'left' | 'right' | 'top' | 'bottom';","+    labelPosition?: 'start' | 'middle' | 'end';  // Matches IllustrationLine type","   }>;"," }"," "]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"073828a2-e69b-44d8-b906-8ce58734acb9","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Ui4wx7v8Mvni9WKLGk62qT","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I need to update all the labelPosition values in the config to use the valid enum values. Let me replace 'top', 'bottom', 'left', 'right' with 'start', 'middle', 'end'.","signature":"EtUCCkYIChgCKkDEDqlZeIr2fMFvqTaYYrBd1yEsrnujDA3rHuCv3GgH1FlfrxvS7McDFs51XU3PUG7ZepbMyRVUx+pDzQgmlq//EgzkW0jGm8sG14r7KWkaDMAD91zLzazJLUje2yIwkE8L9EUn95Y4Zgh5TLbtPJebkbAsb66N1FfKVO99O0NCxToiJiKY9jqSC0hcWAYUKrwBXmdcxIgrffJdZfbeiZxI6i7njtcYjzKL2cvj+LKWngvnvnJ3ol57FjCBZPCtNHNMx/RPsXje/KpAUv8wUZd2TT1Mb7QzuZItWjpP4L8JWDK1Zxqh0OPvjxQHF1GSdAN8jq3Rm5Hn8fAfMnttBKy3v9duipRVbfKhDxdHKTD4fgdnsVtPdeQdG4gGONtgdmVzXnkCEZ6qofLSWA0QTK22D/yQAG+6e3VvkXuzdmd6iCvsQb1/kciPsqi9/EUYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":827,"cache_read_input_tokens":115963,"cache_creation":{"ephemeral_5m_input_tokens":827,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcLMXLQ55Kfn2beThHA","type":"assistant","uuid":"282debe0-f557-4d8d-a3cc-1d08657edf8b","timestamp":"2025-12-20T20:58:47.016Z"}
{"parentUuid":"282debe0-f557-4d8d-a3cc-1d08657edf8b","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Ui4wx7v8Mvni9WKLGk62qT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XaksWPU1Z1zTeoZgY5XbkH","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","old_string":"  faceWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'top' },\n      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'right' },\n    ],\n  },","new_string":"  faceWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'middle' },\n      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'end' },\n    ],\n  },"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":827,"cache_read_input_tokens":115963,"cache_creation":{"ephemeral_5m_input_tokens":827,"ephemeral_1h_input_tokens":0},"output_tokens":449,"service_tier":"standard"}},"requestId":"req_011CWJcLMXLQ55Kfn2beThHA","type":"assistant","uuid":"8e4d8806-7058-4988-b92e-004558955877","timestamp":"2025-12-20T20:58:52.050Z"}
{"parentUuid":"8e4d8806-7058-4988-b92e-004558955877","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XaksWPU1Z1zTeoZgY5XbkH","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   137→const ILLUSTRATION_CONFIGS: Record<string, IllustrationConfig> = {\n   138→  // ==========================================\n   139→  // FACE SHAPE / PROPORTIONS\n   140→  // ==========================================\n   141→  faceWidthToHeight: {\n   142→    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n   143→    lines: [\n   144→      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'middle' },\n   145→      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'end' },\n   146→    ],\n   147→  },\n   148→  totalFacialWidthToHeight: {\n   149→    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n   150→    lines: [\n   151→      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },"}]},"uuid":"e9bf66dc-17ff-42ec-b09c-ae2255650a7a","timestamp":"2025-12-20T20:58:52.088Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","oldString":"  faceWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'top' },\n      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'right' },\n    ],\n  },","newString":"  faceWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'middle' },\n      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'end' },\n    ],\n  },","originalFile":"'use client';\n\nimport React, { createContext, useContext, useState, useMemo, useCallback, ReactNode } from 'react';\nimport { LandmarkPoint } from '@/lib/landmarks';\nimport {\n  analyzeFrontProfile,\n  analyzeSideProfile,\n  analyzeHarmony,\n  HarmonyAnalysis,\n  FaceIQScoreResult,\n  FACEIQ_METRICS,\n  Ethnicity,\n  Gender,\n} from '@/lib/faceiq-scoring';\nimport {\n  Ratio,\n  Strength,\n  Flaw,\n  Recommendation,\n  ResultsTab,\n  FullHarmonyAnalysis,\n} from '@/types/results';\n\n// ============================================\n// CONTEXT TYPES\n// ============================================\n\ninterface ResultsContextType {\n  // Raw data\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  gender: Gender;\n  ethnicity: Ethnicity;\n  frontPhoto: string;\n  sidePhoto: string | null;\n\n  // Computed results\n  harmonyAnalysis: FullHarmonyAnalysis | null;\n  frontRatios: Ratio[];\n  sideRatios: Ratio[];\n  strengths: Strength[];\n  flaws: Flaw[];\n  recommendations: Recommendation[];\n\n  // Scores\n  overallScore: number;\n  frontScore: number;\n  sideScore: number;\n\n  // UI state\n  activeTab: ResultsTab;\n  setActiveTab: (tab: ResultsTab) => void;\n  expandedMeasurementId: string | null;\n  setExpandedMeasurementId: (id: string | null) => void;\n  selectedVisualizationMetric: string | null;\n  setSelectedVisualizationMetric: (id: string | null) => void;\n  categoryFilter: string | null;\n  setCategoryFilter: (category: string | null) => void;\n  showLandmarkOverlay: boolean;\n  setShowLandmarkOverlay: (show: boolean) => void;\n\n  // Actions\n  setResultsData: (data: ResultsInputData) => void;\n}\n\ninterface ResultsInputData {\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  frontPhoto: string;\n  sidePhoto?: string;\n  gender: Gender;\n  ethnicity?: Ethnicity;\n}\n\n// ============================================\n// HELPER FUNCTIONS\n// ============================================\n\nfunction convertUnitToRatioUnit(unit: string): 'x' | 'mm' | '%' | '°' {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return '°';\n    case 'mm': return 'mm';\n    default: return 'x';\n  }\n}\n\nfunction transformToRatio(result: FaceIQScoreResult, landmarks: LandmarkPoint[]): Ratio {\n  const metricConfig = FACEIQ_METRICS[result.metricId];\n\n  // Generate illustration based on metric\n  const illustration = generateIllustration(result.metricId, landmarks);\n\n  // Get flaw/strength mappings\n  const { mayIndicateFlaws, mayIndicateStrengths } = getFlawStrengthMappings(result);\n\n  return {\n    id: result.metricId,\n    name: result.name,\n    value: result.value,\n    score: result.score,\n    standardizedScore: result.standardizedScore,\n    unit: convertUnitToRatioUnit(result.unit),\n    idealMin: result.idealMin,\n    idealMax: result.idealMax,\n    rangeMin: metricConfig?.rangeMin || result.idealMin - 0.5,\n    rangeMax: metricConfig?.rangeMax || result.idealMax + 0.5,\n    description: metricConfig?.description || '',\n    category: result.category,\n    qualityLevel: result.qualityTier,\n    severity: result.severity,\n    illustration,\n    mayIndicateFlaws,\n    mayIndicateStrengths,\n    usedLandmarks: getUsedLandmarks(result.metricId),\n    scoringCurveConfig: metricConfig ? {\n      decayRate: metricConfig.decayRate,\n      maxScore: metricConfig.maxScore,\n    } : undefined,\n  };\n}\n\n// Enhanced illustration configuration type\ninterface IllustrationConfig {\n  points: string[];\n  lines: Array<{\n    from: string;\n    to: string;\n    label?: string;\n    color?: string;\n    labelPosition?: 'start' | 'middle' | 'end';  // Matches IllustrationLine type\n  }>;\n}\n\n// Comprehensive illustration configurations for all metrics\nconst ILLUSTRATION_CONFIGS: Record<string, IllustrationConfig> = {\n  // ==========================================\n  // FACE SHAPE / PROPORTIONS\n  // ==========================================\n  faceWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'top' },\n      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'right' },\n    ],\n  },\n  totalFacialWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n      { from: 'trichion', to: 'menton', label: 'Total Height', color: '#a78bfa' },\n    ],\n  },\n  lowerThirdProportion: {\n    points: ['subnasale', 'menton', 'trichion'],\n    lines: [\n      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  middleThirdProportion: {\n    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n    lines: [\n      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  upperThirdProportion: {\n    points: ['trichion', 'nasal_base', 'menton'],\n    lines: [\n      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  bitemporalWidth: {\n    points: ['left_temporal', 'right_temporal', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_temporal', to: 'right_temporal', label: 'Temple', color: '#fbbf24' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek', color: '#67e8f9' },\n    ],\n  },\n  cheekboneHeight: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_lateralis', 'right_canthus_lateralis', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheekbone', color: '#ec4899' },\n      { from: 'left_canthus_lateralis', to: 'left_zygion', color: '#67e8f9' },\n    ],\n  },\n  midfaceRatio: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_medialis', 'right_canthus_medialis', 'subnasale'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Midface Width', color: '#67e8f9' },\n      { from: 'left_canthus_medialis', to: 'subnasale', label: 'Midface Height', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // JAW MEASUREMENTS\n  // ==========================================\n  jawSlope: {\n    points: ['left_gonion_inferior', 'left_mentum_lateralis', 'menton', 'right_mentum_lateralis', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'left_mentum_lateralis', label: 'Jaw Slope', color: '#f97316' },\n      { from: 'right_gonion_inferior', to: 'right_mentum_lateralis', color: '#f97316' },\n    ],\n  },\n  jawFrontalAngle: {\n    points: ['left_gonion_inferior', 'menton', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'menton', label: 'Jaw Angle', color: '#f97316' },\n      { from: 'menton', to: 'right_gonion_inferior', color: '#f97316' },\n    ],\n  },\n  bigonialWidth: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw Width', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n    ],\n  },\n  jawWidthRatio: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face', color: '#67e8f9' },\n    ],\n  },\n\n  // ==========================================\n  // EYE MEASUREMENTS\n  // ==========================================\n  lateralCanthalTilt: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'bottom' },\n      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n    ],\n  },\n  eyeAspectRatio: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'left_palpebra_superior', 'left_palpebra_inferior'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Width', color: '#06b6d4' },\n      { from: 'left_palpebra_superior', to: 'left_palpebra_inferior', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  eyeSeparationRatio: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryMouthWidthRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_cheilion', 'right_cheilion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n    ],\n  },\n  oneEyeApartTest: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Between Eyes', color: '#06b6d4' },\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Eye Width', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // EYEBROW MEASUREMENTS\n  // ==========================================\n  browLengthRatio: {\n    points: ['left_supercilium_medialis', 'left_supercilium_lateralis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_lateralis', label: 'Brow', color: '#84cc16' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  eyebrowTilt: {\n    points: ['left_supercilium_medialis', 'left_supercilium_apex', 'left_supercilium_lateralis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_apex', label: 'Tilt', color: '#84cc16' },\n      { from: 'left_supercilium_apex', to: 'left_supercilium_lateralis', color: '#84cc16' },\n    ],\n  },\n  eyebrowLowSetedness: {\n    points: ['left_supercilium_medialis', 'left_palpebra_superior', 'left_canthus_medialis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_palpebra_superior', label: 'Brow-Eye Gap', color: '#84cc16' },\n    ],\n  },\n\n  // ==========================================\n  // NOSE MEASUREMENTS (FRONT)\n  // ==========================================\n  nasalIndex: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Width', color: '#fbbf24' },\n      { from: 'nasal_base', to: 'subnasale', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  intercanthalNasalRatio: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'left_canthus_medialis', 'right_canthus_medialis'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose Width', color: '#fbbf24' },\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n    ],\n  },\n  noseBridgeWidth: {\n    points: ['left_dorsum_nasi', 'right_dorsum_nasi', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_dorsum_nasi', to: 'right_dorsum_nasi', label: 'Bridge', color: '#fbbf24' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Base', color: '#f97316' },\n    ],\n  },\n  noseTipPosition: {\n    points: ['subnasale', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Tip Position', color: '#fbbf24' },\n    ],\n  },\n\n  // ==========================================\n  // MOUTH/LIP MEASUREMENTS\n  // ==========================================\n  mouthNoseWidthRatio: {\n    points: ['left_cheilion', 'right_cheilion', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  lowerUpperLipRatio: {\n    points: ['labrale_superius', 'mouth_middle', 'labrale_inferius'],\n    lines: [\n      { from: 'labrale_superius', to: 'mouth_middle', label: 'Upper', color: '#ec4899' },\n      { from: 'mouth_middle', to: 'labrale_inferius', label: 'Lower', color: '#f97316' },\n    ],\n  },\n  chinPhiltrumRatio: {\n    points: ['subnasale', 'labrale_superius', 'labrale_inferius', 'menton'],\n    lines: [\n      { from: 'subnasale', to: 'labrale_superius', label: 'Philtrum', color: '#ec4899' },\n      { from: 'labrale_inferius', to: 'menton', label: 'Chin', color: '#ef4444' },\n    ],\n  },\n  mouthWidth: {\n    points: ['left_cheilion', 'right_cheilion'],\n    lines: [{ from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth Width', color: '#ec4899' }],\n  },\n\n  // ==========================================\n  // CHIN MEASUREMENTS\n  // ==========================================\n  chinHeight: {\n    points: ['labrale_inferius', 'menton'],\n    lines: [{ from: 'labrale_inferius', to: 'menton', label: 'Chin Height', color: '#ef4444' }],\n  },\n\n  // ==========================================\n  // NECK MEASUREMENTS\n  // ==========================================\n  neckWidthRatio: {\n    points: ['left_cervical_lateralis', 'right_cervical_lateralis', 'left_gonion_inferior', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_cervical_lateralis', to: 'right_cervical_lateralis', label: 'Neck', color: '#14b8a6' },\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n    ],\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS\n  // ==========================================\n  gonialAngle: {\n    points: ['tragus', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'tragus', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  nasofrontalAngle: {\n    points: ['glabella', 'nasion', 'pronasale'],\n    lines: [\n      { from: 'glabella', to: 'nasion', label: 'Forehead', color: '#84cc16' },\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  nasofacialAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', color: '#67e8f9' },\n    ],\n  },\n  nasomentaAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', label: 'To Chin', color: '#ef4444' },\n    ],\n  },\n  submentalCervicalAngle: {\n    points: ['menton', 'cervicalPoint', 'neckPoint'],\n    lines: [\n      { from: 'menton', to: 'cervicalPoint', label: 'Submental', color: '#14b8a6' },\n      { from: 'cervicalPoint', to: 'neckPoint', label: 'Cervical', color: '#06b6d4' },\n    ],\n  },\n  facialDepthToHeight: {\n    points: ['pronasale', 'tragus', 'nasion', 'menton'],\n    lines: [\n      { from: 'pronasale', to: 'tragus', label: 'Depth', color: '#67e8f9' },\n      { from: 'nasion', to: 'menton', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  anteriorFacialDepth: {\n    points: ['glabella', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'glabella', to: 'pronasale', color: '#67e8f9' },\n      { from: 'pronasale', to: 'pogonion', color: '#a78bfa' },\n    ],\n  },\n  mandibularPlaneAngle: {\n    points: ['gonionBottom', 'menton', 'orbitale', 'porion'],\n    lines: [\n      { from: 'gonionBottom', to: 'menton', label: 'Mandibular', color: '#f97316' },\n      { from: 'orbitale', to: 'porion', label: 'Frankfort', color: '#67e8f9' },\n    ],\n  },\n  ramusToMandibleRatio: {\n    points: ['gonionTop', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'gonionTop', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  orbitalVector: {\n    points: ['cornealApex', 'orbitale', 'cheekbone'],\n    lines: [\n      { from: 'cornealApex', to: 'cheekbone', label: 'Orbital Vector', color: '#06b6d4' },\n    ],\n  },\n  eLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'E-Line', color: '#67e8f9' },\n    ],\n  },\n  sLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'S-Line', color: '#a78bfa' },\n    ],\n  },\n  holdawayHLine: {\n    points: ['pronasale', 'pogonion', 'labraleSuperius', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'H-Line', color: '#ec4899' },\n    ],\n  },\n  burstoneLowerLip: {\n    points: ['subnasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'subnasale', to: 'pogonion', label: 'Burstone', color: '#fbbf24' },\n    ],\n  },\n};\n\nfunction generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  const config = ILLUSTRATION_CONFIGS[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = {\n        from: line.from,\n        to: line.to,\n        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}\n\nfunction getUsedLandmarks(metricId: string): string[] {\n  const landmarkMappings: Record<string, string[]> = {\n    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lateralCanthalTilt: ['left_canthus_medialis', 'left_canthus_lateralis'],\n    nasalIndex: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    ipd: ['left_pupila', 'right_pupila'],\n    mouthWidth: ['left_cheilion', 'right_cheilion'],\n    jawWidth: ['left_gonion_inferior', 'right_gonion_inferior'],\n    chinHeight: ['labrale_inferius', 'menton'],\n    gonialAngle: ['tragus', 'gonionBottom', 'menton'],\n  };\n  return landmarkMappings[metricId] || [];\n}\n\nfunction getFlawStrengthMappings(result: FaceIQScoreResult): { mayIndicateFlaws: string[]; mayIndicateStrengths: string[] } {\n  const flawMappings: Record<string, { low: string[]; high: string[] }> = {\n    faceWidthToHeight: {\n      low: ['Narrow face', 'Vertically elongated face'],\n      high: ['Wide face', 'Horizontally expanded face'],\n    },\n    lowerThirdProportion: {\n      low: ['Short lower third', 'Deficient mandible'],\n      high: ['Long lower third', 'Mandibular excess'],\n    },\n    lateralCanthalTilt: {\n      low: ['Negative canthal tilt', 'Drooping eyes'],\n      high: ['Excessive positive canthal tilt'],\n    },\n    nasalIndex: {\n      low: ['Narrow nose', 'Leptorrhine nose'],\n      high: ['Wide nose', 'Platyrrhine nose'],\n    },\n    gonialAngle: {\n      low: ['Steep mandibular plane'],\n      high: ['Flat mandibular plane', 'Weak jaw definition'],\n    },\n  };\n\n  const strengthMappings: Record<string, { ideal: string[] }> = {\n    faceWidthToHeight: { ideal: ['Balanced facial proportions', 'Harmonious face shape'] },\n    lateralCanthalTilt: { ideal: ['Attractive eye shape', 'Positive canthal tilt'] },\n    nasalIndex: { ideal: ['Well-proportioned nose', 'Balanced nasal width'] },\n    gonialAngle: { ideal: ['Well-defined jawline', 'Strong jaw structure'] },\n  };\n\n  const mapping = flawMappings[result.metricId];\n  const strengthMapping = strengthMappings[result.metricId];\n\n  let mayIndicateFlaws: string[] = [];\n  let mayIndicateStrengths: string[] = [];\n\n  if (result.qualityTier === 'ideal' || result.qualityTier === 'excellent') {\n    mayIndicateStrengths = strengthMapping?.ideal || [];\n  } else if (mapping) {\n    mayIndicateFlaws = result.deviationDirection === 'below' ? mapping.low : mapping.high;\n  }\n\n  return { mayIndicateFlaws, mayIndicateStrengths };\n}\n\nfunction generateStrengthsFromAnalysis(analysis: HarmonyAnalysis): Strength[] {\n  const strengths: Strength[] = [];\n\n  analysis.strengths.forEach((s, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === s.metricId);\n\n    strengths.push({\n      id: `strength_${i}`,\n      strengthName: s.metricName,\n      summary: s.reasoning,\n      avgScore: matchingMeasurement?.score || 8,\n      qualityLevel: s.qualityTier,\n      categoryName: s.category,\n      responsibleRatios: [{\n        ratioName: s.metricName,\n        ratioId: s.metricId,\n        score: matchingMeasurement?.score || 8,\n        value: s.value,\n      }],\n    });\n  });\n\n  return strengths;\n}\n\nfunction generateFlawsFromAnalysis(analysis: HarmonyAnalysis): Flaw[] {\n  const flaws: Flaw[] = [];\n  let rollingLost = 0;\n\n  analysis.flaws.forEach((f, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === f.metricId);\n    const impact = matchingMeasurement ? (10 - matchingMeasurement.score) * 0.5 : 2;\n    rollingLost += impact;\n\n    flaws.push({\n      id: `flaw_${i}`,\n      flawName: f.metricName,\n      summary: f.reasoning,\n      harmonyPercentageLost: impact,\n      standardizedImpact: impact / 10,\n      categoryName: f.category,\n      responsibleRatios: [{\n        ratioName: f.metricName,\n        ratioId: f.metricId,\n        score: matchingMeasurement?.score || 3,\n        value: matchingMeasurement?.value || 0,\n      }],\n      rollingPointsDeducted: rollingLost,\n      rollingHarmonyPercentageLost: rollingLost,\n      rollingStandardizedImpact: rollingLost / 10,\n    });\n  });\n\n  return flaws.sort((a, b) => b.harmonyPercentageLost - a.harmonyPercentageLost);\n}\n\n// Comprehensive procedure database with metric-specific targeting\ninterface ProcedureConfig {\n  ref_id: string;\n  name: string;\n  description: string;\n  phase: 'Surgical' | 'Minimally Invasive' | 'Foundational';\n  baseImpact: number;\n  coverage: number;\n  percentage: string;\n  expectedImprovementRange: { min: number; max: number };\n  targetMetrics: string[];  // Specific metric IDs this treatment addresses\n  targetCategories: string[];  // Category names this treatment addresses\n  targetKeywords: string[];  // Flaw name keywords to match\n  timeline: { effect_start: 'immediate' | 'delayed' | 'gradual'; full_results_weeks: number; full_results_weeks_max?: number };\n  cost: { type: 'flat' | 'per_session' | 'per_month'; min: number; max: number; currency: string };\n  risks_side_effects: string;\n  warnings: string[];\n  gender: 'male' | 'female' | 'both';\n}\n\nconst PROCEDURE_DATABASE: ProcedureConfig[] = [\n  // ==========================================\n  // SURGICAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'SUR-01',\n    name: 'Sliding Genioplasty',\n    description: 'Chin bone repositioning surgery that can move the chin forward, backward, up, or down for optimal projection and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.90,\n    coverage: 8,\n    percentage: '15-25%',\n    expectedImprovementRange: { min: 0.5, max: 1.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'facialDepthToHeight', 'anteriorFacialDepth', 'nasomentaAngle'],\n    targetCategories: ['Chin', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['chin', 'recessed', 'weak', 'short chin', 'long chin', 'pogonion'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage, bone resorption.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-02',\n    name: 'Reduction Rhinoplasty',\n    description: 'Surgical reduction of nose size, hump removal, and tip refinement to improve nasal proportions.',\n    phase: 'Surgical',\n    baseImpact: 0.85,\n    coverage: 6,\n    percentage: '10-20%',\n    expectedImprovementRange: { min: 0.5, max: 1.0 },\n    targetMetrics: ['nasalIndex', 'nasofrontalAngle', 'nasofacialAngle', 'nasomentaAngle', 'intercanthalNasalRatio', 'noseBridgeWidth'],\n    targetCategories: ['Nose'],\n    targetKeywords: ['wide nose', 'large nose', 'dorsal hump', 'bulbous', 'nasal', 'nose bridge'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 7000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-03',\n    name: 'Jaw Angle Implants',\n    description: 'Custom or standard silicone/PEEK implants to enhance jaw width, definition, and angularity.',\n    phase: 'Surgical',\n    baseImpact: 0.80,\n    coverage: 5,\n    percentage: '10-15%',\n    expectedImprovementRange: { min: 0.4, max: 1.0 },\n    targetMetrics: ['bigonialWidth', 'jawFrontalAngle', 'jawWidthRatio', 'jawSlope', 'gonialAngle'],\n    targetCategories: ['Jaw Shape'],\n    targetKeywords: ['narrow jaw', 'weak jaw', 'soft jaw', 'jaw angle', 'gonial', 'mandible'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection, bone erosion.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-04',\n    name: 'Bimaxillary Osteotomy (Bimax)',\n    description: 'Double jaw surgery to reposition both upper and lower jaws for optimal occlusion and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.95,\n    coverage: 12,\n    percentage: '20-35%',\n    expectedImprovementRange: { min: 1.0, max: 2.0 },\n    targetMetrics: ['midfaceRatio', 'facialDepthToHeight', 'mandibularPlaneAngle', 'lowerThirdProportion', 'nasofacialAngle'],\n    targetCategories: ['Occlusion/Jaw Growth', 'Midface/Face Shape'],\n    targetKeywords: ['maxillary recession', 'mandibular', 'hyper-divergent', 'bite', 'occlusion', 'midface recession'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 20000, max: 60000, currency: 'USD' },\n    risks_side_effects: 'Extended recovery, numbness (temporary to permanent), dietary restrictions.',\n    warnings: ['Major surgery - requires orthodontic preparation'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-05',\n    name: 'Canthoplasty',\n    description: 'Surgical eye corner modification to improve canthal tilt and eye shape.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.8 },\n    targetMetrics: ['lateralCanthalTilt', 'eyeAspectRatio'],\n    targetCategories: ['Eyes'],\n    targetKeywords: ['canthal tilt', 'negative tilt', 'drooping eyes', 'eye shape', 'eye angle'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 4000, max: 12000, currency: 'USD' },\n    risks_side_effects: 'Scarring, asymmetry, dry eyes, ectropion.',\n    warnings: ['Difficult to reverse'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-06',\n    name: 'Cheek/Malar Implants',\n    description: 'Solid implants placed over the cheekbones to enhance midface projection and width.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 4,\n    percentage: '10-18%',\n    expectedImprovementRange: { min: 0.4, max: 0.9 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio', 'totalFacialWidthToHeight'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface', 'zygomatic', 'malar'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 6, full_results_weeks_max: 12 },\n    cost: { type: 'flat', min: 6000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry, implant shifting, nerve damage.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-07',\n    name: 'Neck Liposuction / Submentoplasty',\n    description: 'Fat removal and skin tightening under the chin and neck area.',\n    phase: 'Surgical',\n    baseImpact: 0.65,\n    coverage: 3,\n    percentage: '8-12%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['round neck', 'double chin', 'submental', 'cervical', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 3000, max: 8000, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, skin irregularity, numbness.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-08',\n    name: 'Brow Bone Reduction/Augmentation',\n    description: 'Surgical reshaping of the brow ridge for improved upper third harmony.',\n    phase: 'Surgical',\n    baseImpact: 0.70,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['nasofrontalAngle', 'bitemporalWidth', 'upperThirdProportion'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['brow ridge', 'forehead', 'nasofrontal', 'upper third', 'glabella'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling, numbness, scarring (if coronal incision).',\n    warnings: [],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // MINIMALLY INVASIVE TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'MIN-01',\n    name: 'Chin/Jawline Filler',\n    description: 'Hyaluronic acid injections to enhance chin projection and jawline definition. Reversible and temporary.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 4,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'jawFrontalAngle', 'bigonialWidth'],\n    targetCategories: ['Chin', 'Jaw Shape'],\n    targetKeywords: ['weak chin', 'recessed chin', 'soft jaw', 'jawline'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 800, max: 2500, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n    warnings: ['Results temporary (12-18 months)', 'Requires maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-02',\n    name: 'Cheek Filler',\n    description: 'HA filler to enhance cheekbone projection and midface volume.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 3,\n    percentage: '5-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface volume'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 600, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, asymmetry.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-03',\n    name: 'Lip Filler',\n    description: 'Hyaluronic acid to enhance lip volume and proportions.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['lowerUpperLipRatio', 'mouthNoseWidthRatio'],\n    targetCategories: ['Lips'],\n    targetKeywords: ['thin lip', 'lip ratio', 'lip volume', 'upper lip', 'lower lip'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 400, max: 1200, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, lumps.',\n    warnings: ['Results temporary (6-12 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-04',\n    name: 'PDO Thread Lift',\n    description: 'Dissolvable threads to lift and tighten skin, particularly for canthal tilt improvement.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 3,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.1, max: 0.4 },\n    targetMetrics: ['lateralCanthalTilt', 'eyebrowLowSetedness'],\n    targetCategories: ['Eyes', 'Upper Third'],\n    targetKeywords: ['canthal tilt', 'drooping', 'sagging', 'eyebrow position'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 1500, max: 4000, currency: 'USD' },\n    risks_side_effects: 'Bruising, asymmetry, thread visibility, infection.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-05',\n    name: 'Masseter Botox',\n    description: 'Botulinum toxin to slim the lower face by relaxing masseter muscles.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 2,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['bigonialWidth', 'jawWidthRatio', 'faceWidthToHeight'],\n    targetCategories: ['Jaw Shape', 'Midface/Face Shape'],\n    targetKeywords: ['wide jaw', 'square jaw', 'masseter', 'bruxism'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 400, max: 1000, currency: 'USD' },\n    risks_side_effects: 'Temporary weakness, asymmetry, difficulty chewing.',\n    warnings: ['Results temporary (4-6 months)', 'Requires regular maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-06',\n    name: 'Kybella (Submental Fat Dissolving)',\n    description: 'Injectable deoxycholic acid to permanently destroy fat cells under the chin.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 2,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['double chin', 'submental fat', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'per_session', min: 1200, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, numbness, difficulty swallowing (temporary).',\n    warnings: ['Requires 2-4 sessions'],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // FOUNDATIONAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'FND-01',\n    name: 'Mewing / Proper Tongue Posture',\n    description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 5,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['midfaceRatio', 'bigonialWidth', 'facialDepthToHeight'],\n    targetCategories: ['Midface/Face Shape', 'Jaw Shape', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['midface', 'palate', 'recession', 'jaw development'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n    cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n    risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n    warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-02',\n    name: 'Body Recomposition (Leanmaxxing)',\n    description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n    phase: 'Foundational',\n    baseImpact: 0.35,\n    coverage: 6,\n    percentage: '5-12%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['bigonialWidth', 'submentalCervicalAngle', 'cheekboneHeight'],\n    targetCategories: ['Jaw Shape', 'Neck', 'Midface/Face Shape'],\n    targetKeywords: ['soft jaw', 'undefined', 'round', 'facial definition'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n    risks_side_effects: 'None if done healthily.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-03',\n    name: 'Posture Correction',\n    description: 'Improving head and neck posture to optimize facial appearance and reduce forward head posture effects.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 3,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.2 },\n    targetMetrics: ['submentalCervicalAngle', 'anteriorFacialDepth'],\n    targetCategories: ['Neck', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['neck', 'posture', 'forward head'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 0, max: 100, currency: 'USD' },\n    risks_side_effects: 'None.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-04',\n    name: 'Skincare Routine (Retinoid + SPF)',\n    description: 'Medical-grade skincare to improve skin quality, texture, and reduce aging signs.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 2,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: [],\n    targetCategories: [],\n    targetKeywords: ['skin', 'texture', 'aging'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 26 },\n    cost: { type: 'per_month', min: 30, max: 150, currency: 'USD' },\n    risks_side_effects: 'Initial irritation, sun sensitivity.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-05',\n    name: 'Eyebrow Grooming / Microblading',\n    description: 'Professional shaping or semi-permanent tattooing to optimize eyebrow shape and position.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['eyebrowTilt', 'eyebrowLowSetedness', 'browLengthRatio'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['eyebrow', 'brow', 'upper third'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'flat', min: 20, max: 600, currency: 'USD' },\n    risks_side_effects: 'Minimal for grooming. Microblading: infection risk, color fading.',\n    warnings: [],\n    gender: 'both',\n  },\n];\n\n// Calculate relevance score based on multiple factors\nfunction calculateRelevanceScore(\n  proc: ProcedureConfig,\n  flaw: Flaw,\n  allFlaws: Flaw[]\n): number {\n  let score = 0;\n\n  // Check metric ID match (highest priority)\n  const metricId = flaw.responsibleRatios[0]?.ratioId || '';\n  if (proc.targetMetrics.includes(metricId)) {\n    score += 40;\n  }\n\n  // Check category match\n  if (proc.targetCategories.some(cat =>\n    flaw.categoryName.toLowerCase().includes(cat.toLowerCase()) ||\n    cat.toLowerCase().includes(flaw.categoryName.toLowerCase())\n  )) {\n    score += 25;\n  }\n\n  // Check keyword match\n  const flawLower = flaw.flawName.toLowerCase();\n  const summaryLower = flaw.summary.toLowerCase();\n  const matchedKeywords = proc.targetKeywords.filter(kw =>\n    flawLower.includes(kw.toLowerCase()) || summaryLower.includes(kw.toLowerCase())\n  );\n  score += matchedKeywords.length * 10;\n\n  // Adjust by flaw severity/impact\n  score += Math.min(flaw.harmonyPercentageLost * 3, 15);\n\n  // Bonus if this procedure addresses multiple flaws\n  const otherFlawsAddressed = allFlaws.filter(f =>\n    f.id !== flaw.id && (\n      proc.targetMetrics.includes(f.responsibleRatios[0]?.ratioId || '') ||\n      proc.targetCategories.some(cat => f.categoryName.toLowerCase().includes(cat.toLowerCase()))\n    )\n  );\n  score += otherFlawsAddressed.length * 5;\n\n  return Math.min(score, 100);\n}\n\nfunction generateRecommendations(flaws: Flaw[], frontRatios: Ratio[] = [], sideRatios: Ratio[] = []): Recommendation[] {\n  const recommendations: Recommendation[] = [];\n  const allRatios = [...frontRatios, ...sideRatios];\n\n  // Track which procedures have been added and their matched flaws\n  const procMatches: Map<string, { flaws: string[]; ratios: string[]; maxScore: number }> = new Map();\n\n  flaws.forEach(flaw => {\n    PROCEDURE_DATABASE.forEach(proc => {\n      const relevanceScore = calculateRelevanceScore(proc, flaw, flaws);\n\n      if (relevanceScore >= 25) {  // Minimum threshold\n        const existing = procMatches.get(proc.ref_id);\n        if (existing) {\n          existing.flaws.push(flaw.flawName);\n          existing.ratios.push(...flaw.responsibleRatios.map(r => r.ratioName));\n          existing.maxScore = Math.max(existing.maxScore, relevanceScore);\n        } else {\n          procMatches.set(proc.ref_id, {\n            flaws: [flaw.flawName],\n            ratios: flaw.responsibleRatios.map(r => r.ratioName),\n            maxScore: relevanceScore,\n          });\n        }\n      }\n    });\n  });\n\n  // Build recommendations from matched procedures\n  procMatches.forEach((match, procId) => {\n    const proc = PROCEDURE_DATABASE.find(p => p.ref_id === procId);\n    if (!proc) return;\n\n    // Calculate expected improvement based on severity of matched flaws\n    const matchedFlawDetails = flaws.filter(f => match.flaws.includes(f.flawName));\n    const avgImpact = matchedFlawDetails.reduce((sum, f) => sum + f.harmonyPercentageLost, 0) / matchedFlawDetails.length;\n    const severityMultiplier = Math.min(avgImpact / 3, 1.5);  // More severe = more potential improvement\n\n    // Get affected ratios from the actual data\n    const affectedRatios = allRatios.filter(r =>\n      proc.targetMetrics.includes(r.id) ||\n      match.flaws.some(f => f.toLowerCase().includes(r.category.toLowerCase()))\n    );\n\n    const adjustedImpact = proc.baseImpact * (0.8 + (match.maxScore / 500));  // Slight boost for high relevance\n\n    recommendations.push({\n      ref_id: proc.ref_id,\n      name: proc.name,\n      description: proc.description,\n      phase: proc.phase,\n      impact: adjustedImpact,\n      coverage: match.flaws.length + match.ratios.length,\n      percentage: proc.percentage,\n      expectedImprovementRange: {\n        min: proc.expectedImprovementRange.min * severityMultiplier,\n        max: proc.expectedImprovementRange.max * severityMultiplier,\n      },\n      matchedFlaws: [...new Set(match.flaws)],\n      matchedRatios: [...new Set(match.ratios)],\n      ratios_impacted: affectedRatios.map(r => ({\n        ratioId: r.id,\n        ratioName: r.name,\n        direction: 'both' as const,\n        percentageEffect: proc.baseImpact,\n      })),\n      timeline: proc.timeline,\n      cost: proc.cost,\n      risks_side_effects: proc.risks_side_effects,\n      warnings: proc.warnings,\n      gender: proc.gender,\n    });\n  });\n\n  // Sort by impact (higher = better), then by coverage (more flaws addressed = better)\n  return recommendations.sort((a, b) => {\n    const impactDiff = b.impact - a.impact;\n    if (Math.abs(impactDiff) > 0.1) return impactDiff;\n    return b.coverage - a.coverage;\n  });\n}\n\n// ============================================\n// CONTEXT CREATION\n// ============================================\n\nconst ResultsContext = createContext<ResultsContextType | null>(null);\n\nexport function useResults(): ResultsContextType {\n  const context = useContext(ResultsContext);\n  if (!context) {\n    throw new Error('useResults must be used within a ResultsProvider');\n  }\n  return context;\n}\n\ninterface ResultsProviderProps {\n  children: ReactNode;\n  initialData?: ResultsInputData;\n}\n\nexport function ResultsProvider({ children, initialData }: ResultsProviderProps) {\n  // Raw data state\n  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>(initialData?.frontLandmarks || []);\n  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>(initialData?.sideLandmarks || []);\n  const [gender, setGender] = useState<Gender>(initialData?.gender || 'male');\n  const [ethnicity, setEthnicity] = useState<Ethnicity>(initialData?.ethnicity || 'other');\n  const [frontPhoto, setFrontPhoto] = useState<string>(initialData?.frontPhoto || '');\n  const [sidePhoto, setSidePhoto] = useState<string | null>(initialData?.sidePhoto || null);\n\n  // UI state\n  const [activeTab, setActiveTab] = useState<ResultsTab>('overview');\n  const [expandedMeasurementId, setExpandedMeasurementId] = useState<string | null>(null);\n  const [selectedVisualizationMetric, setSelectedVisualizationMetric] = useState<string | null>(null);\n  const [categoryFilter, setCategoryFilter] = useState<string | null>(null);\n  const [showLandmarkOverlay, setShowLandmarkOverlay] = useState(true);\n\n  // Compute analysis results (now with demographic-specific scoring)\n  const analysisResults = useMemo(() => {\n    if (frontLandmarks.length === 0) {\n      return null;\n    }\n\n    try {\n      const frontAnalysis = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n      const sideAnalysis = sideLandmarks.length > 0\n        ? analyzeSideProfile(sideLandmarks, gender, ethnicity)\n        : null;\n      // analyzeHarmony expects landmarks directly, not analysis results\n      const harmony = analyzeHarmony(frontLandmarks, sideLandmarks, gender, ethnicity);\n\n      return { frontAnalysis, sideAnalysis, harmony };\n    } catch (error) {\n      console.error('Analysis error:', error);\n      return null;\n    }\n  }, [frontLandmarks, sideLandmarks, gender, ethnicity]);\n\n  // Transform to Ratio format\n  const frontRatios = useMemo(() => {\n    if (!analysisResults?.frontAnalysis) return [];\n    return analysisResults.frontAnalysis.measurements.map(m => transformToRatio(m, frontLandmarks));\n  }, [analysisResults, frontLandmarks]);\n\n  const sideRatios = useMemo(() => {\n    if (!analysisResults?.sideAnalysis) return [];\n    return analysisResults.sideAnalysis.measurements.map(m => transformToRatio(m, sideLandmarks));\n  }, [analysisResults, sideLandmarks]);\n\n  // Generate strengths and flaws\n  const strengths = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateStrengthsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  const flaws = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateFlawsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  // Generate recommendations with metric-aware matching\n  const recommendations = useMemo(() => {\n    return generateRecommendations(flaws, frontRatios, sideRatios);\n  }, [flaws, frontRatios, sideRatios]);\n\n  // Build full harmony analysis\n  const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {\n    if (!analysisResults?.harmony) return null;\n\n    return {\n      standardizedScore: analysisResults.harmony.overallScore,\n      front: {\n        standardizedScore: analysisResults.harmony.frontScore,\n        ratios: frontRatios,\n      },\n      side: {\n        standardizedScore: analysisResults.harmony.sideScore,\n        ratios: sideRatios,\n      },\n      strengths,\n      flaws,\n    };\n  }, [analysisResults, frontRatios, sideRatios, strengths, flaws]);\n\n  // Scores\n  const overallScore = analysisResults?.harmony?.overallScore || 0;\n  const frontScore = analysisResults?.harmony?.frontScore || 0;\n  const sideScore = analysisResults?.harmony?.sideScore || 0;\n\n  // Action to set all results data\n  const setResultsData = useCallback((data: ResultsInputData) => {\n    setFrontLandmarks(data.frontLandmarks);\n    setSideLandmarks(data.sideLandmarks);\n    setFrontPhoto(data.frontPhoto);\n    setSidePhoto(data.sidePhoto || null);\n    setGender(data.gender);\n    setEthnicity(data.ethnicity || 'other');\n  }, []);\n\n  const value: ResultsContextType = {\n    frontLandmarks,\n    sideLandmarks,\n    gender,\n    ethnicity,\n    frontPhoto,\n    sidePhoto,\n    harmonyAnalysis,\n    frontRatios,\n    sideRatios,\n    strengths,\n    flaws,\n    recommendations,\n    overallScore,\n    frontScore,\n    sideScore,\n    activeTab,\n    setActiveTab,\n    expandedMeasurementId,\n    setExpandedMeasurementId,\n    selectedVisualizationMetric,\n    setSelectedVisualizationMetric,\n    categoryFilter,\n    setCategoryFilter,\n    showLandmarkOverlay,\n    setShowLandmarkOverlay,\n    setResultsData,\n  };\n\n  return (\n    <ResultsContext.Provider value={value}>\n      {children}\n    </ResultsContext.Provider>\n  );\n}\n","structuredPatch":[{"oldStart":141,"oldLines":8,"newStart":141,"newLines":8,"lines":["   faceWidthToHeight: {","     points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],","     lines: [","-      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'top' },","-      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'right' },","+      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'middle' },","+      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'end' },","     ],","   },","   totalFacialWidthToHeight: {"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"e9bf66dc-17ff-42ec-b09c-ae2255650a7a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01HDTPXDVZp6A7WBkA7SS4YM","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me update all other instances using replace_all. But actually, let me just remove the labelPosition from the configs where they have 'left', 'right', 'top', 'bottom' since those are invalid. The labelPosition in the config is optional anyway.","signature":"EqMDCkYIChgCKkCGwnUUKbOgqRCl8d3erhB1lFP1lvlHRpw3xl7ThL+WIQ4SRYpixKphYGt4V1Rlbq4g6yieMtNR1kzPXJMFz0CKEgz/jvYPTf57Mf9qOOUaDHCUOi7qfZAWPVbRkyIwNQjuOX1pcWCZfhQ/8Scw8H30UK7AjgpbEV/bQUbHfw6hR4k+OC+8xzSM8dGaKwaJKooCPZ61xLh5xLH8eW4Ztrp/HsfQRoXJDcpBa7XdQlAHQB/lt0MLn9blcqwD2/K24Ka8eh1c9HoxE45G1g56/zDO37Jb9zFlWHodHRh5XoeE+CPZpkXE+v/Diaru16vrjo+/EBgKaLehssymuKH5DI4/9rJQzzjZ8KJWFal7PRNfFXsfkI64Eo8+dMK6swtZbghdpUZ8LonT67apF8CCrD7BjoFrB07re6y8f3l4ZkcHnStxJxzZIulMwgj7sWLFClHHXL+LuBGl2zXN+K9q/bTMmKy/l+hupsa0y9EnxvDYF6L7nGjNkcHrx90tWJcoQjV3YZN0souN3Wcc0GY7wAtAQG66PHc+OPvEzkIYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":835,"cache_read_input_tokens":116790,"cache_creation":{"ephemeral_5m_input_tokens":835,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWJcLxtb4tKWmP8wfXnpM","type":"assistant","uuid":"8c9ded4e-5b07-4a00-a9b5-91dbcedcaa34","timestamp":"2025-12-20T20:58:56.336Z"}
{"parentUuid":"8c9ded4e-5b07-4a00-a9b5-91dbcedcaa34","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01HDTPXDVZp6A7WBkA7SS4YM","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WcowmQGhW4Z8s8BDUD5sZh","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","old_string":"  lowerThirdProportion: {\n    points: ['subnasale', 'menton', 'trichion'],\n    lines: [\n      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  middleThirdProportion: {\n    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n    lines: [\n      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  upperThirdProportion: {\n    points: ['trichion', 'nasal_base', 'menton'],\n    lines: [\n      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },","new_string":"  lowerThirdProportion: {\n    points: ['subnasale', 'menton', 'trichion'],\n    lines: [\n      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },\n  middleThirdProportion: {\n    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n    lines: [\n      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },\n  upperThirdProportion: {\n    points: ['trichion', 'nasal_base', 'menton'],\n    lines: [\n      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":835,"cache_read_input_tokens":116790,"cache_creation":{"ephemeral_5m_input_tokens":835,"ephemeral_1h_input_tokens":0},"output_tokens":960,"service_tier":"standard"}},"requestId":"req_011CWJcLxtb4tKWmP8wfXnpM","type":"assistant","uuid":"1b193ce9-bd73-44d8-8309-ed3e93749882","timestamp":"2025-12-20T20:59:08.020Z"}
{"parentUuid":"1b193ce9-bd73-44d8-8309-ed3e93749882","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01WcowmQGhW4Z8s8BDUD5sZh","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   151→      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n   152→      { from: 'trichion', to: 'menton', label: 'Total Height', color: '#a78bfa' },\n   153→    ],\n   154→  },\n   155→  lowerThirdProportion: {\n   156→    points: ['subnasale', 'menton', 'trichion'],\n   157→    lines: [\n   158→      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'end' },\n   159→      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n   160→    ],\n   161→  },\n   162→  middleThirdProportion: {\n   163→    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n   164→    lines: [\n   165→      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'end' },\n   166→      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n   167→    ],\n   168→  },\n   169→  upperThirdProportion: {\n   170→    points: ['trichion', 'nasal_base', 'menton'],\n   171→    lines: [\n   172→      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'end' },\n   173→      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n   174→    ],\n   175→  },\n   176→  bitemporalWidth: {\n   177→    points: ['left_temporal', 'right_temporal', 'left_zygion', 'right_zygion'],\n   178→    lines: [\n   179→      { from: 'left_temporal', to: 'right_temporal', label: 'Temple', color: '#fbbf24' },"}]},"uuid":"e2ba67d6-646a-47d9-87d2-96970f55de87","timestamp":"2025-12-20T20:59:08.066Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","oldString":"  lowerThirdProportion: {\n    points: ['subnasale', 'menton', 'trichion'],\n    lines: [\n      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  middleThirdProportion: {\n    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n    lines: [\n      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  upperThirdProportion: {\n    points: ['trichion', 'nasal_base', 'menton'],\n    lines: [\n      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },","newString":"  lowerThirdProportion: {\n    points: ['subnasale', 'menton', 'trichion'],\n    lines: [\n      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },\n  middleThirdProportion: {\n    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n    lines: [\n      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },\n  upperThirdProportion: {\n    points: ['trichion', 'nasal_base', 'menton'],\n    lines: [\n      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },","originalFile":"'use client';\n\nimport React, { createContext, useContext, useState, useMemo, useCallback, ReactNode } from 'react';\nimport { LandmarkPoint } from '@/lib/landmarks';\nimport {\n  analyzeFrontProfile,\n  analyzeSideProfile,\n  analyzeHarmony,\n  HarmonyAnalysis,\n  FaceIQScoreResult,\n  FACEIQ_METRICS,\n  Ethnicity,\n  Gender,\n} from '@/lib/faceiq-scoring';\nimport {\n  Ratio,\n  Strength,\n  Flaw,\n  Recommendation,\n  ResultsTab,\n  FullHarmonyAnalysis,\n} from '@/types/results';\n\n// ============================================\n// CONTEXT TYPES\n// ============================================\n\ninterface ResultsContextType {\n  // Raw data\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  gender: Gender;\n  ethnicity: Ethnicity;\n  frontPhoto: string;\n  sidePhoto: string | null;\n\n  // Computed results\n  harmonyAnalysis: FullHarmonyAnalysis | null;\n  frontRatios: Ratio[];\n  sideRatios: Ratio[];\n  strengths: Strength[];\n  flaws: Flaw[];\n  recommendations: Recommendation[];\n\n  // Scores\n  overallScore: number;\n  frontScore: number;\n  sideScore: number;\n\n  // UI state\n  activeTab: ResultsTab;\n  setActiveTab: (tab: ResultsTab) => void;\n  expandedMeasurementId: string | null;\n  setExpandedMeasurementId: (id: string | null) => void;\n  selectedVisualizationMetric: string | null;\n  setSelectedVisualizationMetric: (id: string | null) => void;\n  categoryFilter: string | null;\n  setCategoryFilter: (category: string | null) => void;\n  showLandmarkOverlay: boolean;\n  setShowLandmarkOverlay: (show: boolean) => void;\n\n  // Actions\n  setResultsData: (data: ResultsInputData) => void;\n}\n\ninterface ResultsInputData {\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  frontPhoto: string;\n  sidePhoto?: string;\n  gender: Gender;\n  ethnicity?: Ethnicity;\n}\n\n// ============================================\n// HELPER FUNCTIONS\n// ============================================\n\nfunction convertUnitToRatioUnit(unit: string): 'x' | 'mm' | '%' | '°' {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return '°';\n    case 'mm': return 'mm';\n    default: return 'x';\n  }\n}\n\nfunction transformToRatio(result: FaceIQScoreResult, landmarks: LandmarkPoint[]): Ratio {\n  const metricConfig = FACEIQ_METRICS[result.metricId];\n\n  // Generate illustration based on metric\n  const illustration = generateIllustration(result.metricId, landmarks);\n\n  // Get flaw/strength mappings\n  const { mayIndicateFlaws, mayIndicateStrengths } = getFlawStrengthMappings(result);\n\n  return {\n    id: result.metricId,\n    name: result.name,\n    value: result.value,\n    score: result.score,\n    standardizedScore: result.standardizedScore,\n    unit: convertUnitToRatioUnit(result.unit),\n    idealMin: result.idealMin,\n    idealMax: result.idealMax,\n    rangeMin: metricConfig?.rangeMin || result.idealMin - 0.5,\n    rangeMax: metricConfig?.rangeMax || result.idealMax + 0.5,\n    description: metricConfig?.description || '',\n    category: result.category,\n    qualityLevel: result.qualityTier,\n    severity: result.severity,\n    illustration,\n    mayIndicateFlaws,\n    mayIndicateStrengths,\n    usedLandmarks: getUsedLandmarks(result.metricId),\n    scoringCurveConfig: metricConfig ? {\n      decayRate: metricConfig.decayRate,\n      maxScore: metricConfig.maxScore,\n    } : undefined,\n  };\n}\n\n// Enhanced illustration configuration type\ninterface IllustrationConfig {\n  points: string[];\n  lines: Array<{\n    from: string;\n    to: string;\n    label?: string;\n    color?: string;\n    labelPosition?: 'start' | 'middle' | 'end';  // Matches IllustrationLine type\n  }>;\n}\n\n// Comprehensive illustration configurations for all metrics\nconst ILLUSTRATION_CONFIGS: Record<string, IllustrationConfig> = {\n  // ==========================================\n  // FACE SHAPE / PROPORTIONS\n  // ==========================================\n  faceWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'middle' },\n      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'end' },\n    ],\n  },\n  totalFacialWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n      { from: 'trichion', to: 'menton', label: 'Total Height', color: '#a78bfa' },\n    ],\n  },\n  lowerThirdProportion: {\n    points: ['subnasale', 'menton', 'trichion'],\n    lines: [\n      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  middleThirdProportion: {\n    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n    lines: [\n      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  upperThirdProportion: {\n    points: ['trichion', 'nasal_base', 'menton'],\n    lines: [\n      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'right' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },\n    ],\n  },\n  bitemporalWidth: {\n    points: ['left_temporal', 'right_temporal', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_temporal', to: 'right_temporal', label: 'Temple', color: '#fbbf24' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek', color: '#67e8f9' },\n    ],\n  },\n  cheekboneHeight: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_lateralis', 'right_canthus_lateralis', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheekbone', color: '#ec4899' },\n      { from: 'left_canthus_lateralis', to: 'left_zygion', color: '#67e8f9' },\n    ],\n  },\n  midfaceRatio: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_medialis', 'right_canthus_medialis', 'subnasale'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Midface Width', color: '#67e8f9' },\n      { from: 'left_canthus_medialis', to: 'subnasale', label: 'Midface Height', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // JAW MEASUREMENTS\n  // ==========================================\n  jawSlope: {\n    points: ['left_gonion_inferior', 'left_mentum_lateralis', 'menton', 'right_mentum_lateralis', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'left_mentum_lateralis', label: 'Jaw Slope', color: '#f97316' },\n      { from: 'right_gonion_inferior', to: 'right_mentum_lateralis', color: '#f97316' },\n    ],\n  },\n  jawFrontalAngle: {\n    points: ['left_gonion_inferior', 'menton', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'menton', label: 'Jaw Angle', color: '#f97316' },\n      { from: 'menton', to: 'right_gonion_inferior', color: '#f97316' },\n    ],\n  },\n  bigonialWidth: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw Width', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n    ],\n  },\n  jawWidthRatio: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face', color: '#67e8f9' },\n    ],\n  },\n\n  // ==========================================\n  // EYE MEASUREMENTS\n  // ==========================================\n  lateralCanthalTilt: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'bottom' },\n      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n    ],\n  },\n  eyeAspectRatio: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'left_palpebra_superior', 'left_palpebra_inferior'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Width', color: '#06b6d4' },\n      { from: 'left_palpebra_superior', to: 'left_palpebra_inferior', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  eyeSeparationRatio: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryMouthWidthRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_cheilion', 'right_cheilion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n    ],\n  },\n  oneEyeApartTest: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Between Eyes', color: '#06b6d4' },\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Eye Width', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // EYEBROW MEASUREMENTS\n  // ==========================================\n  browLengthRatio: {\n    points: ['left_supercilium_medialis', 'left_supercilium_lateralis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_lateralis', label: 'Brow', color: '#84cc16' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  eyebrowTilt: {\n    points: ['left_supercilium_medialis', 'left_supercilium_apex', 'left_supercilium_lateralis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_apex', label: 'Tilt', color: '#84cc16' },\n      { from: 'left_supercilium_apex', to: 'left_supercilium_lateralis', color: '#84cc16' },\n    ],\n  },\n  eyebrowLowSetedness: {\n    points: ['left_supercilium_medialis', 'left_palpebra_superior', 'left_canthus_medialis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_palpebra_superior', label: 'Brow-Eye Gap', color: '#84cc16' },\n    ],\n  },\n\n  // ==========================================\n  // NOSE MEASUREMENTS (FRONT)\n  // ==========================================\n  nasalIndex: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Width', color: '#fbbf24' },\n      { from: 'nasal_base', to: 'subnasale', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  intercanthalNasalRatio: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'left_canthus_medialis', 'right_canthus_medialis'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose Width', color: '#fbbf24' },\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n    ],\n  },\n  noseBridgeWidth: {\n    points: ['left_dorsum_nasi', 'right_dorsum_nasi', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_dorsum_nasi', to: 'right_dorsum_nasi', label: 'Bridge', color: '#fbbf24' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Base', color: '#f97316' },\n    ],\n  },\n  noseTipPosition: {\n    points: ['subnasale', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Tip Position', color: '#fbbf24' },\n    ],\n  },\n\n  // ==========================================\n  // MOUTH/LIP MEASUREMENTS\n  // ==========================================\n  mouthNoseWidthRatio: {\n    points: ['left_cheilion', 'right_cheilion', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  lowerUpperLipRatio: {\n    points: ['labrale_superius', 'mouth_middle', 'labrale_inferius'],\n    lines: [\n      { from: 'labrale_superius', to: 'mouth_middle', label: 'Upper', color: '#ec4899' },\n      { from: 'mouth_middle', to: 'labrale_inferius', label: 'Lower', color: '#f97316' },\n    ],\n  },\n  chinPhiltrumRatio: {\n    points: ['subnasale', 'labrale_superius', 'labrale_inferius', 'menton'],\n    lines: [\n      { from: 'subnasale', to: 'labrale_superius', label: 'Philtrum', color: '#ec4899' },\n      { from: 'labrale_inferius', to: 'menton', label: 'Chin', color: '#ef4444' },\n    ],\n  },\n  mouthWidth: {\n    points: ['left_cheilion', 'right_cheilion'],\n    lines: [{ from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth Width', color: '#ec4899' }],\n  },\n\n  // ==========================================\n  // CHIN MEASUREMENTS\n  // ==========================================\n  chinHeight: {\n    points: ['labrale_inferius', 'menton'],\n    lines: [{ from: 'labrale_inferius', to: 'menton', label: 'Chin Height', color: '#ef4444' }],\n  },\n\n  // ==========================================\n  // NECK MEASUREMENTS\n  // ==========================================\n  neckWidthRatio: {\n    points: ['left_cervical_lateralis', 'right_cervical_lateralis', 'left_gonion_inferior', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_cervical_lateralis', to: 'right_cervical_lateralis', label: 'Neck', color: '#14b8a6' },\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n    ],\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS\n  // ==========================================\n  gonialAngle: {\n    points: ['tragus', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'tragus', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  nasofrontalAngle: {\n    points: ['glabella', 'nasion', 'pronasale'],\n    lines: [\n      { from: 'glabella', to: 'nasion', label: 'Forehead', color: '#84cc16' },\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  nasofacialAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', color: '#67e8f9' },\n    ],\n  },\n  nasomentaAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', label: 'To Chin', color: '#ef4444' },\n    ],\n  },\n  submentalCervicalAngle: {\n    points: ['menton', 'cervicalPoint', 'neckPoint'],\n    lines: [\n      { from: 'menton', to: 'cervicalPoint', label: 'Submental', color: '#14b8a6' },\n      { from: 'cervicalPoint', to: 'neckPoint', label: 'Cervical', color: '#06b6d4' },\n    ],\n  },\n  facialDepthToHeight: {\n    points: ['pronasale', 'tragus', 'nasion', 'menton'],\n    lines: [\n      { from: 'pronasale', to: 'tragus', label: 'Depth', color: '#67e8f9' },\n      { from: 'nasion', to: 'menton', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  anteriorFacialDepth: {\n    points: ['glabella', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'glabella', to: 'pronasale', color: '#67e8f9' },\n      { from: 'pronasale', to: 'pogonion', color: '#a78bfa' },\n    ],\n  },\n  mandibularPlaneAngle: {\n    points: ['gonionBottom', 'menton', 'orbitale', 'porion'],\n    lines: [\n      { from: 'gonionBottom', to: 'menton', label: 'Mandibular', color: '#f97316' },\n      { from: 'orbitale', to: 'porion', label: 'Frankfort', color: '#67e8f9' },\n    ],\n  },\n  ramusToMandibleRatio: {\n    points: ['gonionTop', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'gonionTop', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  orbitalVector: {\n    points: ['cornealApex', 'orbitale', 'cheekbone'],\n    lines: [\n      { from: 'cornealApex', to: 'cheekbone', label: 'Orbital Vector', color: '#06b6d4' },\n    ],\n  },\n  eLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'E-Line', color: '#67e8f9' },\n    ],\n  },\n  sLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'S-Line', color: '#a78bfa' },\n    ],\n  },\n  holdawayHLine: {\n    points: ['pronasale', 'pogonion', 'labraleSuperius', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'H-Line', color: '#ec4899' },\n    ],\n  },\n  burstoneLowerLip: {\n    points: ['subnasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'subnasale', to: 'pogonion', label: 'Burstone', color: '#fbbf24' },\n    ],\n  },\n};\n\nfunction generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  const config = ILLUSTRATION_CONFIGS[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = {\n        from: line.from,\n        to: line.to,\n        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}\n\nfunction getUsedLandmarks(metricId: string): string[] {\n  const landmarkMappings: Record<string, string[]> = {\n    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lateralCanthalTilt: ['left_canthus_medialis', 'left_canthus_lateralis'],\n    nasalIndex: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    ipd: ['left_pupila', 'right_pupila'],\n    mouthWidth: ['left_cheilion', 'right_cheilion'],\n    jawWidth: ['left_gonion_inferior', 'right_gonion_inferior'],\n    chinHeight: ['labrale_inferius', 'menton'],\n    gonialAngle: ['tragus', 'gonionBottom', 'menton'],\n  };\n  return landmarkMappings[metricId] || [];\n}\n\nfunction getFlawStrengthMappings(result: FaceIQScoreResult): { mayIndicateFlaws: string[]; mayIndicateStrengths: string[] } {\n  const flawMappings: Record<string, { low: string[]; high: string[] }> = {\n    faceWidthToHeight: {\n      low: ['Narrow face', 'Vertically elongated face'],\n      high: ['Wide face', 'Horizontally expanded face'],\n    },\n    lowerThirdProportion: {\n      low: ['Short lower third', 'Deficient mandible'],\n      high: ['Long lower third', 'Mandibular excess'],\n    },\n    lateralCanthalTilt: {\n      low: ['Negative canthal tilt', 'Drooping eyes'],\n      high: ['Excessive positive canthal tilt'],\n    },\n    nasalIndex: {\n      low: ['Narrow nose', 'Leptorrhine nose'],\n      high: ['Wide nose', 'Platyrrhine nose'],\n    },\n    gonialAngle: {\n      low: ['Steep mandibular plane'],\n      high: ['Flat mandibular plane', 'Weak jaw definition'],\n    },\n  };\n\n  const strengthMappings: Record<string, { ideal: string[] }> = {\n    faceWidthToHeight: { ideal: ['Balanced facial proportions', 'Harmonious face shape'] },\n    lateralCanthalTilt: { ideal: ['Attractive eye shape', 'Positive canthal tilt'] },\n    nasalIndex: { ideal: ['Well-proportioned nose', 'Balanced nasal width'] },\n    gonialAngle: { ideal: ['Well-defined jawline', 'Strong jaw structure'] },\n  };\n\n  const mapping = flawMappings[result.metricId];\n  const strengthMapping = strengthMappings[result.metricId];\n\n  let mayIndicateFlaws: string[] = [];\n  let mayIndicateStrengths: string[] = [];\n\n  if (result.qualityTier === 'ideal' || result.qualityTier === 'excellent') {\n    mayIndicateStrengths = strengthMapping?.ideal || [];\n  } else if (mapping) {\n    mayIndicateFlaws = result.deviationDirection === 'below' ? mapping.low : mapping.high;\n  }\n\n  return { mayIndicateFlaws, mayIndicateStrengths };\n}\n\nfunction generateStrengthsFromAnalysis(analysis: HarmonyAnalysis): Strength[] {\n  const strengths: Strength[] = [];\n\n  analysis.strengths.forEach((s, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === s.metricId);\n\n    strengths.push({\n      id: `strength_${i}`,\n      strengthName: s.metricName,\n      summary: s.reasoning,\n      avgScore: matchingMeasurement?.score || 8,\n      qualityLevel: s.qualityTier,\n      categoryName: s.category,\n      responsibleRatios: [{\n        ratioName: s.metricName,\n        ratioId: s.metricId,\n        score: matchingMeasurement?.score || 8,\n        value: s.value,\n      }],\n    });\n  });\n\n  return strengths;\n}\n\nfunction generateFlawsFromAnalysis(analysis: HarmonyAnalysis): Flaw[] {\n  const flaws: Flaw[] = [];\n  let rollingLost = 0;\n\n  analysis.flaws.forEach((f, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === f.metricId);\n    const impact = matchingMeasurement ? (10 - matchingMeasurement.score) * 0.5 : 2;\n    rollingLost += impact;\n\n    flaws.push({\n      id: `flaw_${i}`,\n      flawName: f.metricName,\n      summary: f.reasoning,\n      harmonyPercentageLost: impact,\n      standardizedImpact: impact / 10,\n      categoryName: f.category,\n      responsibleRatios: [{\n        ratioName: f.metricName,\n        ratioId: f.metricId,\n        score: matchingMeasurement?.score || 3,\n        value: matchingMeasurement?.value || 0,\n      }],\n      rollingPointsDeducted: rollingLost,\n      rollingHarmonyPercentageLost: rollingLost,\n      rollingStandardizedImpact: rollingLost / 10,\n    });\n  });\n\n  return flaws.sort((a, b) => b.harmonyPercentageLost - a.harmonyPercentageLost);\n}\n\n// Comprehensive procedure database with metric-specific targeting\ninterface ProcedureConfig {\n  ref_id: string;\n  name: string;\n  description: string;\n  phase: 'Surgical' | 'Minimally Invasive' | 'Foundational';\n  baseImpact: number;\n  coverage: number;\n  percentage: string;\n  expectedImprovementRange: { min: number; max: number };\n  targetMetrics: string[];  // Specific metric IDs this treatment addresses\n  targetCategories: string[];  // Category names this treatment addresses\n  targetKeywords: string[];  // Flaw name keywords to match\n  timeline: { effect_start: 'immediate' | 'delayed' | 'gradual'; full_results_weeks: number; full_results_weeks_max?: number };\n  cost: { type: 'flat' | 'per_session' | 'per_month'; min: number; max: number; currency: string };\n  risks_side_effects: string;\n  warnings: string[];\n  gender: 'male' | 'female' | 'both';\n}\n\nconst PROCEDURE_DATABASE: ProcedureConfig[] = [\n  // ==========================================\n  // SURGICAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'SUR-01',\n    name: 'Sliding Genioplasty',\n    description: 'Chin bone repositioning surgery that can move the chin forward, backward, up, or down for optimal projection and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.90,\n    coverage: 8,\n    percentage: '15-25%',\n    expectedImprovementRange: { min: 0.5, max: 1.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'facialDepthToHeight', 'anteriorFacialDepth', 'nasomentaAngle'],\n    targetCategories: ['Chin', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['chin', 'recessed', 'weak', 'short chin', 'long chin', 'pogonion'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage, bone resorption.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-02',\n    name: 'Reduction Rhinoplasty',\n    description: 'Surgical reduction of nose size, hump removal, and tip refinement to improve nasal proportions.',\n    phase: 'Surgical',\n    baseImpact: 0.85,\n    coverage: 6,\n    percentage: '10-20%',\n    expectedImprovementRange: { min: 0.5, max: 1.0 },\n    targetMetrics: ['nasalIndex', 'nasofrontalAngle', 'nasofacialAngle', 'nasomentaAngle', 'intercanthalNasalRatio', 'noseBridgeWidth'],\n    targetCategories: ['Nose'],\n    targetKeywords: ['wide nose', 'large nose', 'dorsal hump', 'bulbous', 'nasal', 'nose bridge'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 7000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-03',\n    name: 'Jaw Angle Implants',\n    description: 'Custom or standard silicone/PEEK implants to enhance jaw width, definition, and angularity.',\n    phase: 'Surgical',\n    baseImpact: 0.80,\n    coverage: 5,\n    percentage: '10-15%',\n    expectedImprovementRange: { min: 0.4, max: 1.0 },\n    targetMetrics: ['bigonialWidth', 'jawFrontalAngle', 'jawWidthRatio', 'jawSlope', 'gonialAngle'],\n    targetCategories: ['Jaw Shape'],\n    targetKeywords: ['narrow jaw', 'weak jaw', 'soft jaw', 'jaw angle', 'gonial', 'mandible'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection, bone erosion.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-04',\n    name: 'Bimaxillary Osteotomy (Bimax)',\n    description: 'Double jaw surgery to reposition both upper and lower jaws for optimal occlusion and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.95,\n    coverage: 12,\n    percentage: '20-35%',\n    expectedImprovementRange: { min: 1.0, max: 2.0 },\n    targetMetrics: ['midfaceRatio', 'facialDepthToHeight', 'mandibularPlaneAngle', 'lowerThirdProportion', 'nasofacialAngle'],\n    targetCategories: ['Occlusion/Jaw Growth', 'Midface/Face Shape'],\n    targetKeywords: ['maxillary recession', 'mandibular', 'hyper-divergent', 'bite', 'occlusion', 'midface recession'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 20000, max: 60000, currency: 'USD' },\n    risks_side_effects: 'Extended recovery, numbness (temporary to permanent), dietary restrictions.',\n    warnings: ['Major surgery - requires orthodontic preparation'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-05',\n    name: 'Canthoplasty',\n    description: 'Surgical eye corner modification to improve canthal tilt and eye shape.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.8 },\n    targetMetrics: ['lateralCanthalTilt', 'eyeAspectRatio'],\n    targetCategories: ['Eyes'],\n    targetKeywords: ['canthal tilt', 'negative tilt', 'drooping eyes', 'eye shape', 'eye angle'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 4000, max: 12000, currency: 'USD' },\n    risks_side_effects: 'Scarring, asymmetry, dry eyes, ectropion.',\n    warnings: ['Difficult to reverse'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-06',\n    name: 'Cheek/Malar Implants',\n    description: 'Solid implants placed over the cheekbones to enhance midface projection and width.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 4,\n    percentage: '10-18%',\n    expectedImprovementRange: { min: 0.4, max: 0.9 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio', 'totalFacialWidthToHeight'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface', 'zygomatic', 'malar'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 6, full_results_weeks_max: 12 },\n    cost: { type: 'flat', min: 6000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry, implant shifting, nerve damage.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-07',\n    name: 'Neck Liposuction / Submentoplasty',\n    description: 'Fat removal and skin tightening under the chin and neck area.',\n    phase: 'Surgical',\n    baseImpact: 0.65,\n    coverage: 3,\n    percentage: '8-12%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['round neck', 'double chin', 'submental', 'cervical', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 3000, max: 8000, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, skin irregularity, numbness.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-08',\n    name: 'Brow Bone Reduction/Augmentation',\n    description: 'Surgical reshaping of the brow ridge for improved upper third harmony.',\n    phase: 'Surgical',\n    baseImpact: 0.70,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['nasofrontalAngle', 'bitemporalWidth', 'upperThirdProportion'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['brow ridge', 'forehead', 'nasofrontal', 'upper third', 'glabella'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling, numbness, scarring (if coronal incision).',\n    warnings: [],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // MINIMALLY INVASIVE TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'MIN-01',\n    name: 'Chin/Jawline Filler',\n    description: 'Hyaluronic acid injections to enhance chin projection and jawline definition. Reversible and temporary.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 4,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'jawFrontalAngle', 'bigonialWidth'],\n    targetCategories: ['Chin', 'Jaw Shape'],\n    targetKeywords: ['weak chin', 'recessed chin', 'soft jaw', 'jawline'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 800, max: 2500, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n    warnings: ['Results temporary (12-18 months)', 'Requires maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-02',\n    name: 'Cheek Filler',\n    description: 'HA filler to enhance cheekbone projection and midface volume.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 3,\n    percentage: '5-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface volume'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 600, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, asymmetry.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-03',\n    name: 'Lip Filler',\n    description: 'Hyaluronic acid to enhance lip volume and proportions.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['lowerUpperLipRatio', 'mouthNoseWidthRatio'],\n    targetCategories: ['Lips'],\n    targetKeywords: ['thin lip', 'lip ratio', 'lip volume', 'upper lip', 'lower lip'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 400, max: 1200, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, lumps.',\n    warnings: ['Results temporary (6-12 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-04',\n    name: 'PDO Thread Lift',\n    description: 'Dissolvable threads to lift and tighten skin, particularly for canthal tilt improvement.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 3,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.1, max: 0.4 },\n    targetMetrics: ['lateralCanthalTilt', 'eyebrowLowSetedness'],\n    targetCategories: ['Eyes', 'Upper Third'],\n    targetKeywords: ['canthal tilt', 'drooping', 'sagging', 'eyebrow position'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 1500, max: 4000, currency: 'USD' },\n    risks_side_effects: 'Bruising, asymmetry, thread visibility, infection.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-05',\n    name: 'Masseter Botox',\n    description: 'Botulinum toxin to slim the lower face by relaxing masseter muscles.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 2,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['bigonialWidth', 'jawWidthRatio', 'faceWidthToHeight'],\n    targetCategories: ['Jaw Shape', 'Midface/Face Shape'],\n    targetKeywords: ['wide jaw', 'square jaw', 'masseter', 'bruxism'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 400, max: 1000, currency: 'USD' },\n    risks_side_effects: 'Temporary weakness, asymmetry, difficulty chewing.',\n    warnings: ['Results temporary (4-6 months)', 'Requires regular maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-06',\n    name: 'Kybella (Submental Fat Dissolving)',\n    description: 'Injectable deoxycholic acid to permanently destroy fat cells under the chin.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 2,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['double chin', 'submental fat', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'per_session', min: 1200, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, numbness, difficulty swallowing (temporary).',\n    warnings: ['Requires 2-4 sessions'],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // FOUNDATIONAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'FND-01',\n    name: 'Mewing / Proper Tongue Posture',\n    description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 5,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['midfaceRatio', 'bigonialWidth', 'facialDepthToHeight'],\n    targetCategories: ['Midface/Face Shape', 'Jaw Shape', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['midface', 'palate', 'recession', 'jaw development'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n    cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n    risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n    warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-02',\n    name: 'Body Recomposition (Leanmaxxing)',\n    description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n    phase: 'Foundational',\n    baseImpact: 0.35,\n    coverage: 6,\n    percentage: '5-12%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['bigonialWidth', 'submentalCervicalAngle', 'cheekboneHeight'],\n    targetCategories: ['Jaw Shape', 'Neck', 'Midface/Face Shape'],\n    targetKeywords: ['soft jaw', 'undefined', 'round', 'facial definition'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n    risks_side_effects: 'None if done healthily.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-03',\n    name: 'Posture Correction',\n    description: 'Improving head and neck posture to optimize facial appearance and reduce forward head posture effects.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 3,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.2 },\n    targetMetrics: ['submentalCervicalAngle', 'anteriorFacialDepth'],\n    targetCategories: ['Neck', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['neck', 'posture', 'forward head'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 0, max: 100, currency: 'USD' },\n    risks_side_effects: 'None.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-04',\n    name: 'Skincare Routine (Retinoid + SPF)',\n    description: 'Medical-grade skincare to improve skin quality, texture, and reduce aging signs.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 2,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: [],\n    targetCategories: [],\n    targetKeywords: ['skin', 'texture', 'aging'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 26 },\n    cost: { type: 'per_month', min: 30, max: 150, currency: 'USD' },\n    risks_side_effects: 'Initial irritation, sun sensitivity.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-05',\n    name: 'Eyebrow Grooming / Microblading',\n    description: 'Professional shaping or semi-permanent tattooing to optimize eyebrow shape and position.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['eyebrowTilt', 'eyebrowLowSetedness', 'browLengthRatio'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['eyebrow', 'brow', 'upper third'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'flat', min: 20, max: 600, currency: 'USD' },\n    risks_side_effects: 'Minimal for grooming. Microblading: infection risk, color fading.',\n    warnings: [],\n    gender: 'both',\n  },\n];\n\n// Calculate relevance score based on multiple factors\nfunction calculateRelevanceScore(\n  proc: ProcedureConfig,\n  flaw: Flaw,\n  allFlaws: Flaw[]\n): number {\n  let score = 0;\n\n  // Check metric ID match (highest priority)\n  const metricId = flaw.responsibleRatios[0]?.ratioId || '';\n  if (proc.targetMetrics.includes(metricId)) {\n    score += 40;\n  }\n\n  // Check category match\n  if (proc.targetCategories.some(cat =>\n    flaw.categoryName.toLowerCase().includes(cat.toLowerCase()) ||\n    cat.toLowerCase().includes(flaw.categoryName.toLowerCase())\n  )) {\n    score += 25;\n  }\n\n  // Check keyword match\n  const flawLower = flaw.flawName.toLowerCase();\n  const summaryLower = flaw.summary.toLowerCase();\n  const matchedKeywords = proc.targetKeywords.filter(kw =>\n    flawLower.includes(kw.toLowerCase()) || summaryLower.includes(kw.toLowerCase())\n  );\n  score += matchedKeywords.length * 10;\n\n  // Adjust by flaw severity/impact\n  score += Math.min(flaw.harmonyPercentageLost * 3, 15);\n\n  // Bonus if this procedure addresses multiple flaws\n  const otherFlawsAddressed = allFlaws.filter(f =>\n    f.id !== flaw.id && (\n      proc.targetMetrics.includes(f.responsibleRatios[0]?.ratioId || '') ||\n      proc.targetCategories.some(cat => f.categoryName.toLowerCase().includes(cat.toLowerCase()))\n    )\n  );\n  score += otherFlawsAddressed.length * 5;\n\n  return Math.min(score, 100);\n}\n\nfunction generateRecommendations(flaws: Flaw[], frontRatios: Ratio[] = [], sideRatios: Ratio[] = []): Recommendation[] {\n  const recommendations: Recommendation[] = [];\n  const allRatios = [...frontRatios, ...sideRatios];\n\n  // Track which procedures have been added and their matched flaws\n  const procMatches: Map<string, { flaws: string[]; ratios: string[]; maxScore: number }> = new Map();\n\n  flaws.forEach(flaw => {\n    PROCEDURE_DATABASE.forEach(proc => {\n      const relevanceScore = calculateRelevanceScore(proc, flaw, flaws);\n\n      if (relevanceScore >= 25) {  // Minimum threshold\n        const existing = procMatches.get(proc.ref_id);\n        if (existing) {\n          existing.flaws.push(flaw.flawName);\n          existing.ratios.push(...flaw.responsibleRatios.map(r => r.ratioName));\n          existing.maxScore = Math.max(existing.maxScore, relevanceScore);\n        } else {\n          procMatches.set(proc.ref_id, {\n            flaws: [flaw.flawName],\n            ratios: flaw.responsibleRatios.map(r => r.ratioName),\n            maxScore: relevanceScore,\n          });\n        }\n      }\n    });\n  });\n\n  // Build recommendations from matched procedures\n  procMatches.forEach((match, procId) => {\n    const proc = PROCEDURE_DATABASE.find(p => p.ref_id === procId);\n    if (!proc) return;\n\n    // Calculate expected improvement based on severity of matched flaws\n    const matchedFlawDetails = flaws.filter(f => match.flaws.includes(f.flawName));\n    const avgImpact = matchedFlawDetails.reduce((sum, f) => sum + f.harmonyPercentageLost, 0) / matchedFlawDetails.length;\n    const severityMultiplier = Math.min(avgImpact / 3, 1.5);  // More severe = more potential improvement\n\n    // Get affected ratios from the actual data\n    const affectedRatios = allRatios.filter(r =>\n      proc.targetMetrics.includes(r.id) ||\n      match.flaws.some(f => f.toLowerCase().includes(r.category.toLowerCase()))\n    );\n\n    const adjustedImpact = proc.baseImpact * (0.8 + (match.maxScore / 500));  // Slight boost for high relevance\n\n    recommendations.push({\n      ref_id: proc.ref_id,\n      name: proc.name,\n      description: proc.description,\n      phase: proc.phase,\n      impact: adjustedImpact,\n      coverage: match.flaws.length + match.ratios.length,\n      percentage: proc.percentage,\n      expectedImprovementRange: {\n        min: proc.expectedImprovementRange.min * severityMultiplier,\n        max: proc.expectedImprovementRange.max * severityMultiplier,\n      },\n      matchedFlaws: [...new Set(match.flaws)],\n      matchedRatios: [...new Set(match.ratios)],\n      ratios_impacted: affectedRatios.map(r => ({\n        ratioId: r.id,\n        ratioName: r.name,\n        direction: 'both' as const,\n        percentageEffect: proc.baseImpact,\n      })),\n      timeline: proc.timeline,\n      cost: proc.cost,\n      risks_side_effects: proc.risks_side_effects,\n      warnings: proc.warnings,\n      gender: proc.gender,\n    });\n  });\n\n  // Sort by impact (higher = better), then by coverage (more flaws addressed = better)\n  return recommendations.sort((a, b) => {\n    const impactDiff = b.impact - a.impact;\n    if (Math.abs(impactDiff) > 0.1) return impactDiff;\n    return b.coverage - a.coverage;\n  });\n}\n\n// ============================================\n// CONTEXT CREATION\n// ============================================\n\nconst ResultsContext = createContext<ResultsContextType | null>(null);\n\nexport function useResults(): ResultsContextType {\n  const context = useContext(ResultsContext);\n  if (!context) {\n    throw new Error('useResults must be used within a ResultsProvider');\n  }\n  return context;\n}\n\ninterface ResultsProviderProps {\n  children: ReactNode;\n  initialData?: ResultsInputData;\n}\n\nexport function ResultsProvider({ children, initialData }: ResultsProviderProps) {\n  // Raw data state\n  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>(initialData?.frontLandmarks || []);\n  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>(initialData?.sideLandmarks || []);\n  const [gender, setGender] = useState<Gender>(initialData?.gender || 'male');\n  const [ethnicity, setEthnicity] = useState<Ethnicity>(initialData?.ethnicity || 'other');\n  const [frontPhoto, setFrontPhoto] = useState<string>(initialData?.frontPhoto || '');\n  const [sidePhoto, setSidePhoto] = useState<string | null>(initialData?.sidePhoto || null);\n\n  // UI state\n  const [activeTab, setActiveTab] = useState<ResultsTab>('overview');\n  const [expandedMeasurementId, setExpandedMeasurementId] = useState<string | null>(null);\n  const [selectedVisualizationMetric, setSelectedVisualizationMetric] = useState<string | null>(null);\n  const [categoryFilter, setCategoryFilter] = useState<string | null>(null);\n  const [showLandmarkOverlay, setShowLandmarkOverlay] = useState(true);\n\n  // Compute analysis results (now with demographic-specific scoring)\n  const analysisResults = useMemo(() => {\n    if (frontLandmarks.length === 0) {\n      return null;\n    }\n\n    try {\n      const frontAnalysis = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n      const sideAnalysis = sideLandmarks.length > 0\n        ? analyzeSideProfile(sideLandmarks, gender, ethnicity)\n        : null;\n      // analyzeHarmony expects landmarks directly, not analysis results\n      const harmony = analyzeHarmony(frontLandmarks, sideLandmarks, gender, ethnicity);\n\n      return { frontAnalysis, sideAnalysis, harmony };\n    } catch (error) {\n      console.error('Analysis error:', error);\n      return null;\n    }\n  }, [frontLandmarks, sideLandmarks, gender, ethnicity]);\n\n  // Transform to Ratio format\n  const frontRatios = useMemo(() => {\n    if (!analysisResults?.frontAnalysis) return [];\n    return analysisResults.frontAnalysis.measurements.map(m => transformToRatio(m, frontLandmarks));\n  }, [analysisResults, frontLandmarks]);\n\n  const sideRatios = useMemo(() => {\n    if (!analysisResults?.sideAnalysis) return [];\n    return analysisResults.sideAnalysis.measurements.map(m => transformToRatio(m, sideLandmarks));\n  }, [analysisResults, sideLandmarks]);\n\n  // Generate strengths and flaws\n  const strengths = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateStrengthsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  const flaws = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateFlawsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  // Generate recommendations with metric-aware matching\n  const recommendations = useMemo(() => {\n    return generateRecommendations(flaws, frontRatios, sideRatios);\n  }, [flaws, frontRatios, sideRatios]);\n\n  // Build full harmony analysis\n  const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {\n    if (!analysisResults?.harmony) return null;\n\n    return {\n      standardizedScore: analysisResults.harmony.overallScore,\n      front: {\n        standardizedScore: analysisResults.harmony.frontScore,\n        ratios: frontRatios,\n      },\n      side: {\n        standardizedScore: analysisResults.harmony.sideScore,\n        ratios: sideRatios,\n      },\n      strengths,\n      flaws,\n    };\n  }, [analysisResults, frontRatios, sideRatios, strengths, flaws]);\n\n  // Scores\n  const overallScore = analysisResults?.harmony?.overallScore || 0;\n  const frontScore = analysisResults?.harmony?.frontScore || 0;\n  const sideScore = analysisResults?.harmony?.sideScore || 0;\n\n  // Action to set all results data\n  const setResultsData = useCallback((data: ResultsInputData) => {\n    setFrontLandmarks(data.frontLandmarks);\n    setSideLandmarks(data.sideLandmarks);\n    setFrontPhoto(data.frontPhoto);\n    setSidePhoto(data.sidePhoto || null);\n    setGender(data.gender);\n    setEthnicity(data.ethnicity || 'other');\n  }, []);\n\n  const value: ResultsContextType = {\n    frontLandmarks,\n    sideLandmarks,\n    gender,\n    ethnicity,\n    frontPhoto,\n    sidePhoto,\n    harmonyAnalysis,\n    frontRatios,\n    sideRatios,\n    strengths,\n    flaws,\n    recommendations,\n    overallScore,\n    frontScore,\n    sideScore,\n    activeTab,\n    setActiveTab,\n    expandedMeasurementId,\n    setExpandedMeasurementId,\n    selectedVisualizationMetric,\n    setSelectedVisualizationMetric,\n    categoryFilter,\n    setCategoryFilter,\n    showLandmarkOverlay,\n    setShowLandmarkOverlay,\n    setResultsData,\n  };\n\n  return (\n    <ResultsContext.Provider value={value}>\n      {children}\n    </ResultsContext.Provider>\n  );\n}\n","structuredPatch":[{"oldStart":155,"oldLines":22,"newStart":155,"newLines":22,"lines":["   lowerThirdProportion: {","     points: ['subnasale', 'menton', 'trichion'],","     lines: [","-      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'right' },","-      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },","+      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'end' },","+      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },","     ],","   },","   middleThirdProportion: {","     points: ['nasal_base', 'subnasale', 'trichion', 'menton'],","     lines: [","-      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'right' },","-      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },","+      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'end' },","+      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },","     ],","   },","   upperThirdProportion: {","     points: ['trichion', 'nasal_base', 'menton'],","     lines: [","-      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'right' },","-      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'left' },","+      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'end' },","+      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },","     ],","   },","   bitemporalWidth: {"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"e2ba67d6-646a-47d9-87d2-96970f55de87","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01BYYBfG8BhWKxWw4fHtLLfh","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now I need to update the lateralCanthalTilt labelPosition too, and fix the Set iteration issue. Let me find and fix the remaining labelPosition values.","signature":"EsACCkYIChgCKkA1/vtNZaMGxKJLbYkrgr135kz8MmEoFtdn7mTL59IIc2fYQQEvTo0BturmQuP45bZ0WyGAXjWdYJhOrwNgOONoEgzQEw7sgo21kqhayLcaDFFm2/gdwsG221uJRSIwp0Sim+nJMLUttj8lX0u7tzvlX9TPR4KXRxfo/EMrI/Ljawqo7YBMg3Lj2fVuayvuKqcB4E1TPXXvrxWFfSct41HZMkxfBqy3XsLVAUKUXwblSwy3fngL17rX6Oplm0iUaoMdHzzrnphUE0yhm04D6vvT9o48szA9iP6l9JLLRD/6rAxgMGiAj1hQwLLnCoyXYrA3lIauS83BXqYI8VGl/EQhlLFfYVLSVphS1dN0jqWkmnd1SFxwwxdbkT63cUnz3HidUPwru4+Phwt1Jt02o+FwRR23qt0JcvEYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1670,"cache_read_input_tokens":117625,"cache_creation":{"ephemeral_5m_input_tokens":1670,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcN9A14E3fuTFnC86wK","type":"assistant","uuid":"73a3f833-d7ab-4a50-a5ca-c685824ca79c","timestamp":"2025-12-20T20:59:11.672Z"}
{"parentUuid":"73a3f833-d7ab-4a50-a5ca-c685824ca79c","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01BYYBfG8BhWKxWw4fHtLLfh","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01ChWfUHCQZ4J2oL9vwdu9p1","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","old_string":"  lateralCanthalTilt: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'bottom' },\n      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n    ],\n  },","new_string":"  lateralCanthalTilt: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'end' },\n      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n    ],\n  },"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1670,"cache_read_input_tokens":117625,"cache_creation":{"ephemeral_5m_input_tokens":1670,"ephemeral_1h_input_tokens":0},"output_tokens":482,"service_tier":"standard"}},"requestId":"req_011CWJcN9A14E3fuTFnC86wK","type":"assistant","uuid":"d916b58f-06a2-4291-9190-cdd11b209efc","timestamp":"2025-12-20T20:59:17.015Z"}
{"parentUuid":"d916b58f-06a2-4291-9190-cdd11b209efc","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01ChWfUHCQZ4J2oL9vwdu9p1","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   229→\n   230→  // ==========================================\n   231→  // EYE MEASUREMENTS\n   232→  // ==========================================\n   233→  lateralCanthalTilt: {\n   234→    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n   235→    lines: [\n   236→      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'end' },\n   237→      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n   238→    ],\n   239→  },\n   240→  eyeAspectRatio: {\n   241→    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'left_palpebra_superior', 'left_palpebra_inferior'],\n   242→    lines: [\n   243→      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Width', color: '#06b6d4' },"}]},"uuid":"5f02159e-2f22-4fa4-a9fc-ddd71ce90a31","timestamp":"2025-12-20T20:59:17.050Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","oldString":"  lateralCanthalTilt: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'bottom' },\n      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n    ],\n  },","newString":"  lateralCanthalTilt: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'end' },\n      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n    ],\n  },","originalFile":"'use client';\n\nimport React, { createContext, useContext, useState, useMemo, useCallback, ReactNode } from 'react';\nimport { LandmarkPoint } from '@/lib/landmarks';\nimport {\n  analyzeFrontProfile,\n  analyzeSideProfile,\n  analyzeHarmony,\n  HarmonyAnalysis,\n  FaceIQScoreResult,\n  FACEIQ_METRICS,\n  Ethnicity,\n  Gender,\n} from '@/lib/faceiq-scoring';\nimport {\n  Ratio,\n  Strength,\n  Flaw,\n  Recommendation,\n  ResultsTab,\n  FullHarmonyAnalysis,\n} from '@/types/results';\n\n// ============================================\n// CONTEXT TYPES\n// ============================================\n\ninterface ResultsContextType {\n  // Raw data\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  gender: Gender;\n  ethnicity: Ethnicity;\n  frontPhoto: string;\n  sidePhoto: string | null;\n\n  // Computed results\n  harmonyAnalysis: FullHarmonyAnalysis | null;\n  frontRatios: Ratio[];\n  sideRatios: Ratio[];\n  strengths: Strength[];\n  flaws: Flaw[];\n  recommendations: Recommendation[];\n\n  // Scores\n  overallScore: number;\n  frontScore: number;\n  sideScore: number;\n\n  // UI state\n  activeTab: ResultsTab;\n  setActiveTab: (tab: ResultsTab) => void;\n  expandedMeasurementId: string | null;\n  setExpandedMeasurementId: (id: string | null) => void;\n  selectedVisualizationMetric: string | null;\n  setSelectedVisualizationMetric: (id: string | null) => void;\n  categoryFilter: string | null;\n  setCategoryFilter: (category: string | null) => void;\n  showLandmarkOverlay: boolean;\n  setShowLandmarkOverlay: (show: boolean) => void;\n\n  // Actions\n  setResultsData: (data: ResultsInputData) => void;\n}\n\ninterface ResultsInputData {\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  frontPhoto: string;\n  sidePhoto?: string;\n  gender: Gender;\n  ethnicity?: Ethnicity;\n}\n\n// ============================================\n// HELPER FUNCTIONS\n// ============================================\n\nfunction convertUnitToRatioUnit(unit: string): 'x' | 'mm' | '%' | '°' {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return '°';\n    case 'mm': return 'mm';\n    default: return 'x';\n  }\n}\n\nfunction transformToRatio(result: FaceIQScoreResult, landmarks: LandmarkPoint[]): Ratio {\n  const metricConfig = FACEIQ_METRICS[result.metricId];\n\n  // Generate illustration based on metric\n  const illustration = generateIllustration(result.metricId, landmarks);\n\n  // Get flaw/strength mappings\n  const { mayIndicateFlaws, mayIndicateStrengths } = getFlawStrengthMappings(result);\n\n  return {\n    id: result.metricId,\n    name: result.name,\n    value: result.value,\n    score: result.score,\n    standardizedScore: result.standardizedScore,\n    unit: convertUnitToRatioUnit(result.unit),\n    idealMin: result.idealMin,\n    idealMax: result.idealMax,\n    rangeMin: metricConfig?.rangeMin || result.idealMin - 0.5,\n    rangeMax: metricConfig?.rangeMax || result.idealMax + 0.5,\n    description: metricConfig?.description || '',\n    category: result.category,\n    qualityLevel: result.qualityTier,\n    severity: result.severity,\n    illustration,\n    mayIndicateFlaws,\n    mayIndicateStrengths,\n    usedLandmarks: getUsedLandmarks(result.metricId),\n    scoringCurveConfig: metricConfig ? {\n      decayRate: metricConfig.decayRate,\n      maxScore: metricConfig.maxScore,\n    } : undefined,\n  };\n}\n\n// Enhanced illustration configuration type\ninterface IllustrationConfig {\n  points: string[];\n  lines: Array<{\n    from: string;\n    to: string;\n    label?: string;\n    color?: string;\n    labelPosition?: 'start' | 'middle' | 'end';  // Matches IllustrationLine type\n  }>;\n}\n\n// Comprehensive illustration configurations for all metrics\nconst ILLUSTRATION_CONFIGS: Record<string, IllustrationConfig> = {\n  // ==========================================\n  // FACE SHAPE / PROPORTIONS\n  // ==========================================\n  faceWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'middle' },\n      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'end' },\n    ],\n  },\n  totalFacialWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n      { from: 'trichion', to: 'menton', label: 'Total Height', color: '#a78bfa' },\n    ],\n  },\n  lowerThirdProportion: {\n    points: ['subnasale', 'menton', 'trichion'],\n    lines: [\n      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },\n  middleThirdProportion: {\n    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n    lines: [\n      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },\n  upperThirdProportion: {\n    points: ['trichion', 'nasal_base', 'menton'],\n    lines: [\n      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },\n  bitemporalWidth: {\n    points: ['left_temporal', 'right_temporal', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_temporal', to: 'right_temporal', label: 'Temple', color: '#fbbf24' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek', color: '#67e8f9' },\n    ],\n  },\n  cheekboneHeight: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_lateralis', 'right_canthus_lateralis', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheekbone', color: '#ec4899' },\n      { from: 'left_canthus_lateralis', to: 'left_zygion', color: '#67e8f9' },\n    ],\n  },\n  midfaceRatio: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_medialis', 'right_canthus_medialis', 'subnasale'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Midface Width', color: '#67e8f9' },\n      { from: 'left_canthus_medialis', to: 'subnasale', label: 'Midface Height', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // JAW MEASUREMENTS\n  // ==========================================\n  jawSlope: {\n    points: ['left_gonion_inferior', 'left_mentum_lateralis', 'menton', 'right_mentum_lateralis', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'left_mentum_lateralis', label: 'Jaw Slope', color: '#f97316' },\n      { from: 'right_gonion_inferior', to: 'right_mentum_lateralis', color: '#f97316' },\n    ],\n  },\n  jawFrontalAngle: {\n    points: ['left_gonion_inferior', 'menton', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'menton', label: 'Jaw Angle', color: '#f97316' },\n      { from: 'menton', to: 'right_gonion_inferior', color: '#f97316' },\n    ],\n  },\n  bigonialWidth: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw Width', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n    ],\n  },\n  jawWidthRatio: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face', color: '#67e8f9' },\n    ],\n  },\n\n  // ==========================================\n  // EYE MEASUREMENTS\n  // ==========================================\n  lateralCanthalTilt: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'bottom' },\n      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n    ],\n  },\n  eyeAspectRatio: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'left_palpebra_superior', 'left_palpebra_inferior'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Width', color: '#06b6d4' },\n      { from: 'left_palpebra_superior', to: 'left_palpebra_inferior', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  eyeSeparationRatio: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryMouthWidthRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_cheilion', 'right_cheilion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n    ],\n  },\n  oneEyeApartTest: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Between Eyes', color: '#06b6d4' },\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Eye Width', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // EYEBROW MEASUREMENTS\n  // ==========================================\n  browLengthRatio: {\n    points: ['left_supercilium_medialis', 'left_supercilium_lateralis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_lateralis', label: 'Brow', color: '#84cc16' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  eyebrowTilt: {\n    points: ['left_supercilium_medialis', 'left_supercilium_apex', 'left_supercilium_lateralis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_apex', label: 'Tilt', color: '#84cc16' },\n      { from: 'left_supercilium_apex', to: 'left_supercilium_lateralis', color: '#84cc16' },\n    ],\n  },\n  eyebrowLowSetedness: {\n    points: ['left_supercilium_medialis', 'left_palpebra_superior', 'left_canthus_medialis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_palpebra_superior', label: 'Brow-Eye Gap', color: '#84cc16' },\n    ],\n  },\n\n  // ==========================================\n  // NOSE MEASUREMENTS (FRONT)\n  // ==========================================\n  nasalIndex: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Width', color: '#fbbf24' },\n      { from: 'nasal_base', to: 'subnasale', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  intercanthalNasalRatio: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'left_canthus_medialis', 'right_canthus_medialis'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose Width', color: '#fbbf24' },\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n    ],\n  },\n  noseBridgeWidth: {\n    points: ['left_dorsum_nasi', 'right_dorsum_nasi', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_dorsum_nasi', to: 'right_dorsum_nasi', label: 'Bridge', color: '#fbbf24' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Base', color: '#f97316' },\n    ],\n  },\n  noseTipPosition: {\n    points: ['subnasale', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Tip Position', color: '#fbbf24' },\n    ],\n  },\n\n  // ==========================================\n  // MOUTH/LIP MEASUREMENTS\n  // ==========================================\n  mouthNoseWidthRatio: {\n    points: ['left_cheilion', 'right_cheilion', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  lowerUpperLipRatio: {\n    points: ['labrale_superius', 'mouth_middle', 'labrale_inferius'],\n    lines: [\n      { from: 'labrale_superius', to: 'mouth_middle', label: 'Upper', color: '#ec4899' },\n      { from: 'mouth_middle', to: 'labrale_inferius', label: 'Lower', color: '#f97316' },\n    ],\n  },\n  chinPhiltrumRatio: {\n    points: ['subnasale', 'labrale_superius', 'labrale_inferius', 'menton'],\n    lines: [\n      { from: 'subnasale', to: 'labrale_superius', label: 'Philtrum', color: '#ec4899' },\n      { from: 'labrale_inferius', to: 'menton', label: 'Chin', color: '#ef4444' },\n    ],\n  },\n  mouthWidth: {\n    points: ['left_cheilion', 'right_cheilion'],\n    lines: [{ from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth Width', color: '#ec4899' }],\n  },\n\n  // ==========================================\n  // CHIN MEASUREMENTS\n  // ==========================================\n  chinHeight: {\n    points: ['labrale_inferius', 'menton'],\n    lines: [{ from: 'labrale_inferius', to: 'menton', label: 'Chin Height', color: '#ef4444' }],\n  },\n\n  // ==========================================\n  // NECK MEASUREMENTS\n  // ==========================================\n  neckWidthRatio: {\n    points: ['left_cervical_lateralis', 'right_cervical_lateralis', 'left_gonion_inferior', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_cervical_lateralis', to: 'right_cervical_lateralis', label: 'Neck', color: '#14b8a6' },\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n    ],\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS\n  // ==========================================\n  gonialAngle: {\n    points: ['tragus', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'tragus', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  nasofrontalAngle: {\n    points: ['glabella', 'nasion', 'pronasale'],\n    lines: [\n      { from: 'glabella', to: 'nasion', label: 'Forehead', color: '#84cc16' },\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  nasofacialAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', color: '#67e8f9' },\n    ],\n  },\n  nasomentaAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', label: 'To Chin', color: '#ef4444' },\n    ],\n  },\n  submentalCervicalAngle: {\n    points: ['menton', 'cervicalPoint', 'neckPoint'],\n    lines: [\n      { from: 'menton', to: 'cervicalPoint', label: 'Submental', color: '#14b8a6' },\n      { from: 'cervicalPoint', to: 'neckPoint', label: 'Cervical', color: '#06b6d4' },\n    ],\n  },\n  facialDepthToHeight: {\n    points: ['pronasale', 'tragus', 'nasion', 'menton'],\n    lines: [\n      { from: 'pronasale', to: 'tragus', label: 'Depth', color: '#67e8f9' },\n      { from: 'nasion', to: 'menton', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  anteriorFacialDepth: {\n    points: ['glabella', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'glabella', to: 'pronasale', color: '#67e8f9' },\n      { from: 'pronasale', to: 'pogonion', color: '#a78bfa' },\n    ],\n  },\n  mandibularPlaneAngle: {\n    points: ['gonionBottom', 'menton', 'orbitale', 'porion'],\n    lines: [\n      { from: 'gonionBottom', to: 'menton', label: 'Mandibular', color: '#f97316' },\n      { from: 'orbitale', to: 'porion', label: 'Frankfort', color: '#67e8f9' },\n    ],\n  },\n  ramusToMandibleRatio: {\n    points: ['gonionTop', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'gonionTop', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  orbitalVector: {\n    points: ['cornealApex', 'orbitale', 'cheekbone'],\n    lines: [\n      { from: 'cornealApex', to: 'cheekbone', label: 'Orbital Vector', color: '#06b6d4' },\n    ],\n  },\n  eLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'E-Line', color: '#67e8f9' },\n    ],\n  },\n  sLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'S-Line', color: '#a78bfa' },\n    ],\n  },\n  holdawayHLine: {\n    points: ['pronasale', 'pogonion', 'labraleSuperius', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'H-Line', color: '#ec4899' },\n    ],\n  },\n  burstoneLowerLip: {\n    points: ['subnasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'subnasale', to: 'pogonion', label: 'Burstone', color: '#fbbf24' },\n    ],\n  },\n};\n\nfunction generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  const config = ILLUSTRATION_CONFIGS[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = {\n        from: line.from,\n        to: line.to,\n        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}\n\nfunction getUsedLandmarks(metricId: string): string[] {\n  const landmarkMappings: Record<string, string[]> = {\n    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lateralCanthalTilt: ['left_canthus_medialis', 'left_canthus_lateralis'],\n    nasalIndex: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    ipd: ['left_pupila', 'right_pupila'],\n    mouthWidth: ['left_cheilion', 'right_cheilion'],\n    jawWidth: ['left_gonion_inferior', 'right_gonion_inferior'],\n    chinHeight: ['labrale_inferius', 'menton'],\n    gonialAngle: ['tragus', 'gonionBottom', 'menton'],\n  };\n  return landmarkMappings[metricId] || [];\n}\n\nfunction getFlawStrengthMappings(result: FaceIQScoreResult): { mayIndicateFlaws: string[]; mayIndicateStrengths: string[] } {\n  const flawMappings: Record<string, { low: string[]; high: string[] }> = {\n    faceWidthToHeight: {\n      low: ['Narrow face', 'Vertically elongated face'],\n      high: ['Wide face', 'Horizontally expanded face'],\n    },\n    lowerThirdProportion: {\n      low: ['Short lower third', 'Deficient mandible'],\n      high: ['Long lower third', 'Mandibular excess'],\n    },\n    lateralCanthalTilt: {\n      low: ['Negative canthal tilt', 'Drooping eyes'],\n      high: ['Excessive positive canthal tilt'],\n    },\n    nasalIndex: {\n      low: ['Narrow nose', 'Leptorrhine nose'],\n      high: ['Wide nose', 'Platyrrhine nose'],\n    },\n    gonialAngle: {\n      low: ['Steep mandibular plane'],\n      high: ['Flat mandibular plane', 'Weak jaw definition'],\n    },\n  };\n\n  const strengthMappings: Record<string, { ideal: string[] }> = {\n    faceWidthToHeight: { ideal: ['Balanced facial proportions', 'Harmonious face shape'] },\n    lateralCanthalTilt: { ideal: ['Attractive eye shape', 'Positive canthal tilt'] },\n    nasalIndex: { ideal: ['Well-proportioned nose', 'Balanced nasal width'] },\n    gonialAngle: { ideal: ['Well-defined jawline', 'Strong jaw structure'] },\n  };\n\n  const mapping = flawMappings[result.metricId];\n  const strengthMapping = strengthMappings[result.metricId];\n\n  let mayIndicateFlaws: string[] = [];\n  let mayIndicateStrengths: string[] = [];\n\n  if (result.qualityTier === 'ideal' || result.qualityTier === 'excellent') {\n    mayIndicateStrengths = strengthMapping?.ideal || [];\n  } else if (mapping) {\n    mayIndicateFlaws = result.deviationDirection === 'below' ? mapping.low : mapping.high;\n  }\n\n  return { mayIndicateFlaws, mayIndicateStrengths };\n}\n\nfunction generateStrengthsFromAnalysis(analysis: HarmonyAnalysis): Strength[] {\n  const strengths: Strength[] = [];\n\n  analysis.strengths.forEach((s, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === s.metricId);\n\n    strengths.push({\n      id: `strength_${i}`,\n      strengthName: s.metricName,\n      summary: s.reasoning,\n      avgScore: matchingMeasurement?.score || 8,\n      qualityLevel: s.qualityTier,\n      categoryName: s.category,\n      responsibleRatios: [{\n        ratioName: s.metricName,\n        ratioId: s.metricId,\n        score: matchingMeasurement?.score || 8,\n        value: s.value,\n      }],\n    });\n  });\n\n  return strengths;\n}\n\nfunction generateFlawsFromAnalysis(analysis: HarmonyAnalysis): Flaw[] {\n  const flaws: Flaw[] = [];\n  let rollingLost = 0;\n\n  analysis.flaws.forEach((f, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === f.metricId);\n    const impact = matchingMeasurement ? (10 - matchingMeasurement.score) * 0.5 : 2;\n    rollingLost += impact;\n\n    flaws.push({\n      id: `flaw_${i}`,\n      flawName: f.metricName,\n      summary: f.reasoning,\n      harmonyPercentageLost: impact,\n      standardizedImpact: impact / 10,\n      categoryName: f.category,\n      responsibleRatios: [{\n        ratioName: f.metricName,\n        ratioId: f.metricId,\n        score: matchingMeasurement?.score || 3,\n        value: matchingMeasurement?.value || 0,\n      }],\n      rollingPointsDeducted: rollingLost,\n      rollingHarmonyPercentageLost: rollingLost,\n      rollingStandardizedImpact: rollingLost / 10,\n    });\n  });\n\n  return flaws.sort((a, b) => b.harmonyPercentageLost - a.harmonyPercentageLost);\n}\n\n// Comprehensive procedure database with metric-specific targeting\ninterface ProcedureConfig {\n  ref_id: string;\n  name: string;\n  description: string;\n  phase: 'Surgical' | 'Minimally Invasive' | 'Foundational';\n  baseImpact: number;\n  coverage: number;\n  percentage: string;\n  expectedImprovementRange: { min: number; max: number };\n  targetMetrics: string[];  // Specific metric IDs this treatment addresses\n  targetCategories: string[];  // Category names this treatment addresses\n  targetKeywords: string[];  // Flaw name keywords to match\n  timeline: { effect_start: 'immediate' | 'delayed' | 'gradual'; full_results_weeks: number; full_results_weeks_max?: number };\n  cost: { type: 'flat' | 'per_session' | 'per_month'; min: number; max: number; currency: string };\n  risks_side_effects: string;\n  warnings: string[];\n  gender: 'male' | 'female' | 'both';\n}\n\nconst PROCEDURE_DATABASE: ProcedureConfig[] = [\n  // ==========================================\n  // SURGICAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'SUR-01',\n    name: 'Sliding Genioplasty',\n    description: 'Chin bone repositioning surgery that can move the chin forward, backward, up, or down for optimal projection and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.90,\n    coverage: 8,\n    percentage: '15-25%',\n    expectedImprovementRange: { min: 0.5, max: 1.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'facialDepthToHeight', 'anteriorFacialDepth', 'nasomentaAngle'],\n    targetCategories: ['Chin', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['chin', 'recessed', 'weak', 'short chin', 'long chin', 'pogonion'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage, bone resorption.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-02',\n    name: 'Reduction Rhinoplasty',\n    description: 'Surgical reduction of nose size, hump removal, and tip refinement to improve nasal proportions.',\n    phase: 'Surgical',\n    baseImpact: 0.85,\n    coverage: 6,\n    percentage: '10-20%',\n    expectedImprovementRange: { min: 0.5, max: 1.0 },\n    targetMetrics: ['nasalIndex', 'nasofrontalAngle', 'nasofacialAngle', 'nasomentaAngle', 'intercanthalNasalRatio', 'noseBridgeWidth'],\n    targetCategories: ['Nose'],\n    targetKeywords: ['wide nose', 'large nose', 'dorsal hump', 'bulbous', 'nasal', 'nose bridge'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 7000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-03',\n    name: 'Jaw Angle Implants',\n    description: 'Custom or standard silicone/PEEK implants to enhance jaw width, definition, and angularity.',\n    phase: 'Surgical',\n    baseImpact: 0.80,\n    coverage: 5,\n    percentage: '10-15%',\n    expectedImprovementRange: { min: 0.4, max: 1.0 },\n    targetMetrics: ['bigonialWidth', 'jawFrontalAngle', 'jawWidthRatio', 'jawSlope', 'gonialAngle'],\n    targetCategories: ['Jaw Shape'],\n    targetKeywords: ['narrow jaw', 'weak jaw', 'soft jaw', 'jaw angle', 'gonial', 'mandible'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection, bone erosion.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-04',\n    name: 'Bimaxillary Osteotomy (Bimax)',\n    description: 'Double jaw surgery to reposition both upper and lower jaws for optimal occlusion and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.95,\n    coverage: 12,\n    percentage: '20-35%',\n    expectedImprovementRange: { min: 1.0, max: 2.0 },\n    targetMetrics: ['midfaceRatio', 'facialDepthToHeight', 'mandibularPlaneAngle', 'lowerThirdProportion', 'nasofacialAngle'],\n    targetCategories: ['Occlusion/Jaw Growth', 'Midface/Face Shape'],\n    targetKeywords: ['maxillary recession', 'mandibular', 'hyper-divergent', 'bite', 'occlusion', 'midface recession'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 20000, max: 60000, currency: 'USD' },\n    risks_side_effects: 'Extended recovery, numbness (temporary to permanent), dietary restrictions.',\n    warnings: ['Major surgery - requires orthodontic preparation'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-05',\n    name: 'Canthoplasty',\n    description: 'Surgical eye corner modification to improve canthal tilt and eye shape.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.8 },\n    targetMetrics: ['lateralCanthalTilt', 'eyeAspectRatio'],\n    targetCategories: ['Eyes'],\n    targetKeywords: ['canthal tilt', 'negative tilt', 'drooping eyes', 'eye shape', 'eye angle'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 4000, max: 12000, currency: 'USD' },\n    risks_side_effects: 'Scarring, asymmetry, dry eyes, ectropion.',\n    warnings: ['Difficult to reverse'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-06',\n    name: 'Cheek/Malar Implants',\n    description: 'Solid implants placed over the cheekbones to enhance midface projection and width.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 4,\n    percentage: '10-18%',\n    expectedImprovementRange: { min: 0.4, max: 0.9 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio', 'totalFacialWidthToHeight'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface', 'zygomatic', 'malar'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 6, full_results_weeks_max: 12 },\n    cost: { type: 'flat', min: 6000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry, implant shifting, nerve damage.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-07',\n    name: 'Neck Liposuction / Submentoplasty',\n    description: 'Fat removal and skin tightening under the chin and neck area.',\n    phase: 'Surgical',\n    baseImpact: 0.65,\n    coverage: 3,\n    percentage: '8-12%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['round neck', 'double chin', 'submental', 'cervical', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 3000, max: 8000, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, skin irregularity, numbness.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-08',\n    name: 'Brow Bone Reduction/Augmentation',\n    description: 'Surgical reshaping of the brow ridge for improved upper third harmony.',\n    phase: 'Surgical',\n    baseImpact: 0.70,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['nasofrontalAngle', 'bitemporalWidth', 'upperThirdProportion'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['brow ridge', 'forehead', 'nasofrontal', 'upper third', 'glabella'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling, numbness, scarring (if coronal incision).',\n    warnings: [],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // MINIMALLY INVASIVE TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'MIN-01',\n    name: 'Chin/Jawline Filler',\n    description: 'Hyaluronic acid injections to enhance chin projection and jawline definition. Reversible and temporary.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 4,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'jawFrontalAngle', 'bigonialWidth'],\n    targetCategories: ['Chin', 'Jaw Shape'],\n    targetKeywords: ['weak chin', 'recessed chin', 'soft jaw', 'jawline'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 800, max: 2500, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n    warnings: ['Results temporary (12-18 months)', 'Requires maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-02',\n    name: 'Cheek Filler',\n    description: 'HA filler to enhance cheekbone projection and midface volume.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 3,\n    percentage: '5-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface volume'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 600, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, asymmetry.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-03',\n    name: 'Lip Filler',\n    description: 'Hyaluronic acid to enhance lip volume and proportions.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['lowerUpperLipRatio', 'mouthNoseWidthRatio'],\n    targetCategories: ['Lips'],\n    targetKeywords: ['thin lip', 'lip ratio', 'lip volume', 'upper lip', 'lower lip'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 400, max: 1200, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, lumps.',\n    warnings: ['Results temporary (6-12 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-04',\n    name: 'PDO Thread Lift',\n    description: 'Dissolvable threads to lift and tighten skin, particularly for canthal tilt improvement.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 3,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.1, max: 0.4 },\n    targetMetrics: ['lateralCanthalTilt', 'eyebrowLowSetedness'],\n    targetCategories: ['Eyes', 'Upper Third'],\n    targetKeywords: ['canthal tilt', 'drooping', 'sagging', 'eyebrow position'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 1500, max: 4000, currency: 'USD' },\n    risks_side_effects: 'Bruising, asymmetry, thread visibility, infection.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-05',\n    name: 'Masseter Botox',\n    description: 'Botulinum toxin to slim the lower face by relaxing masseter muscles.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 2,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['bigonialWidth', 'jawWidthRatio', 'faceWidthToHeight'],\n    targetCategories: ['Jaw Shape', 'Midface/Face Shape'],\n    targetKeywords: ['wide jaw', 'square jaw', 'masseter', 'bruxism'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 400, max: 1000, currency: 'USD' },\n    risks_side_effects: 'Temporary weakness, asymmetry, difficulty chewing.',\n    warnings: ['Results temporary (4-6 months)', 'Requires regular maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-06',\n    name: 'Kybella (Submental Fat Dissolving)',\n    description: 'Injectable deoxycholic acid to permanently destroy fat cells under the chin.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 2,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['double chin', 'submental fat', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'per_session', min: 1200, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, numbness, difficulty swallowing (temporary).',\n    warnings: ['Requires 2-4 sessions'],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // FOUNDATIONAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'FND-01',\n    name: 'Mewing / Proper Tongue Posture',\n    description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 5,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['midfaceRatio', 'bigonialWidth', 'facialDepthToHeight'],\n    targetCategories: ['Midface/Face Shape', 'Jaw Shape', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['midface', 'palate', 'recession', 'jaw development'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n    cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n    risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n    warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-02',\n    name: 'Body Recomposition (Leanmaxxing)',\n    description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n    phase: 'Foundational',\n    baseImpact: 0.35,\n    coverage: 6,\n    percentage: '5-12%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['bigonialWidth', 'submentalCervicalAngle', 'cheekboneHeight'],\n    targetCategories: ['Jaw Shape', 'Neck', 'Midface/Face Shape'],\n    targetKeywords: ['soft jaw', 'undefined', 'round', 'facial definition'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n    risks_side_effects: 'None if done healthily.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-03',\n    name: 'Posture Correction',\n    description: 'Improving head and neck posture to optimize facial appearance and reduce forward head posture effects.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 3,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.2 },\n    targetMetrics: ['submentalCervicalAngle', 'anteriorFacialDepth'],\n    targetCategories: ['Neck', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['neck', 'posture', 'forward head'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 0, max: 100, currency: 'USD' },\n    risks_side_effects: 'None.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-04',\n    name: 'Skincare Routine (Retinoid + SPF)',\n    description: 'Medical-grade skincare to improve skin quality, texture, and reduce aging signs.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 2,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: [],\n    targetCategories: [],\n    targetKeywords: ['skin', 'texture', 'aging'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 26 },\n    cost: { type: 'per_month', min: 30, max: 150, currency: 'USD' },\n    risks_side_effects: 'Initial irritation, sun sensitivity.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-05',\n    name: 'Eyebrow Grooming / Microblading',\n    description: 'Professional shaping or semi-permanent tattooing to optimize eyebrow shape and position.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['eyebrowTilt', 'eyebrowLowSetedness', 'browLengthRatio'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['eyebrow', 'brow', 'upper third'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'flat', min: 20, max: 600, currency: 'USD' },\n    risks_side_effects: 'Minimal for grooming. Microblading: infection risk, color fading.',\n    warnings: [],\n    gender: 'both',\n  },\n];\n\n// Calculate relevance score based on multiple factors\nfunction calculateRelevanceScore(\n  proc: ProcedureConfig,\n  flaw: Flaw,\n  allFlaws: Flaw[]\n): number {\n  let score = 0;\n\n  // Check metric ID match (highest priority)\n  const metricId = flaw.responsibleRatios[0]?.ratioId || '';\n  if (proc.targetMetrics.includes(metricId)) {\n    score += 40;\n  }\n\n  // Check category match\n  if (proc.targetCategories.some(cat =>\n    flaw.categoryName.toLowerCase().includes(cat.toLowerCase()) ||\n    cat.toLowerCase().includes(flaw.categoryName.toLowerCase())\n  )) {\n    score += 25;\n  }\n\n  // Check keyword match\n  const flawLower = flaw.flawName.toLowerCase();\n  const summaryLower = flaw.summary.toLowerCase();\n  const matchedKeywords = proc.targetKeywords.filter(kw =>\n    flawLower.includes(kw.toLowerCase()) || summaryLower.includes(kw.toLowerCase())\n  );\n  score += matchedKeywords.length * 10;\n\n  // Adjust by flaw severity/impact\n  score += Math.min(flaw.harmonyPercentageLost * 3, 15);\n\n  // Bonus if this procedure addresses multiple flaws\n  const otherFlawsAddressed = allFlaws.filter(f =>\n    f.id !== flaw.id && (\n      proc.targetMetrics.includes(f.responsibleRatios[0]?.ratioId || '') ||\n      proc.targetCategories.some(cat => f.categoryName.toLowerCase().includes(cat.toLowerCase()))\n    )\n  );\n  score += otherFlawsAddressed.length * 5;\n\n  return Math.min(score, 100);\n}\n\nfunction generateRecommendations(flaws: Flaw[], frontRatios: Ratio[] = [], sideRatios: Ratio[] = []): Recommendation[] {\n  const recommendations: Recommendation[] = [];\n  const allRatios = [...frontRatios, ...sideRatios];\n\n  // Track which procedures have been added and their matched flaws\n  const procMatches: Map<string, { flaws: string[]; ratios: string[]; maxScore: number }> = new Map();\n\n  flaws.forEach(flaw => {\n    PROCEDURE_DATABASE.forEach(proc => {\n      const relevanceScore = calculateRelevanceScore(proc, flaw, flaws);\n\n      if (relevanceScore >= 25) {  // Minimum threshold\n        const existing = procMatches.get(proc.ref_id);\n        if (existing) {\n          existing.flaws.push(flaw.flawName);\n          existing.ratios.push(...flaw.responsibleRatios.map(r => r.ratioName));\n          existing.maxScore = Math.max(existing.maxScore, relevanceScore);\n        } else {\n          procMatches.set(proc.ref_id, {\n            flaws: [flaw.flawName],\n            ratios: flaw.responsibleRatios.map(r => r.ratioName),\n            maxScore: relevanceScore,\n          });\n        }\n      }\n    });\n  });\n\n  // Build recommendations from matched procedures\n  procMatches.forEach((match, procId) => {\n    const proc = PROCEDURE_DATABASE.find(p => p.ref_id === procId);\n    if (!proc) return;\n\n    // Calculate expected improvement based on severity of matched flaws\n    const matchedFlawDetails = flaws.filter(f => match.flaws.includes(f.flawName));\n    const avgImpact = matchedFlawDetails.reduce((sum, f) => sum + f.harmonyPercentageLost, 0) / matchedFlawDetails.length;\n    const severityMultiplier = Math.min(avgImpact / 3, 1.5);  // More severe = more potential improvement\n\n    // Get affected ratios from the actual data\n    const affectedRatios = allRatios.filter(r =>\n      proc.targetMetrics.includes(r.id) ||\n      match.flaws.some(f => f.toLowerCase().includes(r.category.toLowerCase()))\n    );\n\n    const adjustedImpact = proc.baseImpact * (0.8 + (match.maxScore / 500));  // Slight boost for high relevance\n\n    recommendations.push({\n      ref_id: proc.ref_id,\n      name: proc.name,\n      description: proc.description,\n      phase: proc.phase,\n      impact: adjustedImpact,\n      coverage: match.flaws.length + match.ratios.length,\n      percentage: proc.percentage,\n      expectedImprovementRange: {\n        min: proc.expectedImprovementRange.min * severityMultiplier,\n        max: proc.expectedImprovementRange.max * severityMultiplier,\n      },\n      matchedFlaws: [...new Set(match.flaws)],\n      matchedRatios: [...new Set(match.ratios)],\n      ratios_impacted: affectedRatios.map(r => ({\n        ratioId: r.id,\n        ratioName: r.name,\n        direction: 'both' as const,\n        percentageEffect: proc.baseImpact,\n      })),\n      timeline: proc.timeline,\n      cost: proc.cost,\n      risks_side_effects: proc.risks_side_effects,\n      warnings: proc.warnings,\n      gender: proc.gender,\n    });\n  });\n\n  // Sort by impact (higher = better), then by coverage (more flaws addressed = better)\n  return recommendations.sort((a, b) => {\n    const impactDiff = b.impact - a.impact;\n    if (Math.abs(impactDiff) > 0.1) return impactDiff;\n    return b.coverage - a.coverage;\n  });\n}\n\n// ============================================\n// CONTEXT CREATION\n// ============================================\n\nconst ResultsContext = createContext<ResultsContextType | null>(null);\n\nexport function useResults(): ResultsContextType {\n  const context = useContext(ResultsContext);\n  if (!context) {\n    throw new Error('useResults must be used within a ResultsProvider');\n  }\n  return context;\n}\n\ninterface ResultsProviderProps {\n  children: ReactNode;\n  initialData?: ResultsInputData;\n}\n\nexport function ResultsProvider({ children, initialData }: ResultsProviderProps) {\n  // Raw data state\n  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>(initialData?.frontLandmarks || []);\n  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>(initialData?.sideLandmarks || []);\n  const [gender, setGender] = useState<Gender>(initialData?.gender || 'male');\n  const [ethnicity, setEthnicity] = useState<Ethnicity>(initialData?.ethnicity || 'other');\n  const [frontPhoto, setFrontPhoto] = useState<string>(initialData?.frontPhoto || '');\n  const [sidePhoto, setSidePhoto] = useState<string | null>(initialData?.sidePhoto || null);\n\n  // UI state\n  const [activeTab, setActiveTab] = useState<ResultsTab>('overview');\n  const [expandedMeasurementId, setExpandedMeasurementId] = useState<string | null>(null);\n  const [selectedVisualizationMetric, setSelectedVisualizationMetric] = useState<string | null>(null);\n  const [categoryFilter, setCategoryFilter] = useState<string | null>(null);\n  const [showLandmarkOverlay, setShowLandmarkOverlay] = useState(true);\n\n  // Compute analysis results (now with demographic-specific scoring)\n  const analysisResults = useMemo(() => {\n    if (frontLandmarks.length === 0) {\n      return null;\n    }\n\n    try {\n      const frontAnalysis = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n      const sideAnalysis = sideLandmarks.length > 0\n        ? analyzeSideProfile(sideLandmarks, gender, ethnicity)\n        : null;\n      // analyzeHarmony expects landmarks directly, not analysis results\n      const harmony = analyzeHarmony(frontLandmarks, sideLandmarks, gender, ethnicity);\n\n      return { frontAnalysis, sideAnalysis, harmony };\n    } catch (error) {\n      console.error('Analysis error:', error);\n      return null;\n    }\n  }, [frontLandmarks, sideLandmarks, gender, ethnicity]);\n\n  // Transform to Ratio format\n  const frontRatios = useMemo(() => {\n    if (!analysisResults?.frontAnalysis) return [];\n    return analysisResults.frontAnalysis.measurements.map(m => transformToRatio(m, frontLandmarks));\n  }, [analysisResults, frontLandmarks]);\n\n  const sideRatios = useMemo(() => {\n    if (!analysisResults?.sideAnalysis) return [];\n    return analysisResults.sideAnalysis.measurements.map(m => transformToRatio(m, sideLandmarks));\n  }, [analysisResults, sideLandmarks]);\n\n  // Generate strengths and flaws\n  const strengths = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateStrengthsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  const flaws = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateFlawsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  // Generate recommendations with metric-aware matching\n  const recommendations = useMemo(() => {\n    return generateRecommendations(flaws, frontRatios, sideRatios);\n  }, [flaws, frontRatios, sideRatios]);\n\n  // Build full harmony analysis\n  const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {\n    if (!analysisResults?.harmony) return null;\n\n    return {\n      standardizedScore: analysisResults.harmony.overallScore,\n      front: {\n        standardizedScore: analysisResults.harmony.frontScore,\n        ratios: frontRatios,\n      },\n      side: {\n        standardizedScore: analysisResults.harmony.sideScore,\n        ratios: sideRatios,\n      },\n      strengths,\n      flaws,\n    };\n  }, [analysisResults, frontRatios, sideRatios, strengths, flaws]);\n\n  // Scores\n  const overallScore = analysisResults?.harmony?.overallScore || 0;\n  const frontScore = analysisResults?.harmony?.frontScore || 0;\n  const sideScore = analysisResults?.harmony?.sideScore || 0;\n\n  // Action to set all results data\n  const setResultsData = useCallback((data: ResultsInputData) => {\n    setFrontLandmarks(data.frontLandmarks);\n    setSideLandmarks(data.sideLandmarks);\n    setFrontPhoto(data.frontPhoto);\n    setSidePhoto(data.sidePhoto || null);\n    setGender(data.gender);\n    setEthnicity(data.ethnicity || 'other');\n  }, []);\n\n  const value: ResultsContextType = {\n    frontLandmarks,\n    sideLandmarks,\n    gender,\n    ethnicity,\n    frontPhoto,\n    sidePhoto,\n    harmonyAnalysis,\n    frontRatios,\n    sideRatios,\n    strengths,\n    flaws,\n    recommendations,\n    overallScore,\n    frontScore,\n    sideScore,\n    activeTab,\n    setActiveTab,\n    expandedMeasurementId,\n    setExpandedMeasurementId,\n    selectedVisualizationMetric,\n    setSelectedVisualizationMetric,\n    categoryFilter,\n    setCategoryFilter,\n    showLandmarkOverlay,\n    setShowLandmarkOverlay,\n    setResultsData,\n  };\n\n  return (\n    <ResultsContext.Provider value={value}>\n      {children}\n    </ResultsContext.Provider>\n  );\n}\n","structuredPatch":[{"oldStart":233,"oldLines":7,"newStart":233,"newLines":7,"lines":["   lateralCanthalTilt: {","     points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],","     lines: [","-      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'bottom' },","+      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'end' },","       { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },","     ],","   },"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"5f02159e-2f22-4fa4-a9fc-ddd71ce90a31","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_019oKLgLy9CAN722VEYAV6gq","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me fix the Set iteration issue at lines 1100-1101.","signature":"EuIBCkYIChgCKkA7gGSq1bgi/6Z1SYOfBP4JwKfvnD2WcPbfnMolb3lmu0De7E6qWJUiWQ7BYMAVZ4QUZ8IOSH8WFpMIoKvZ5i9nEgyGsqWP8fHCYmBvWL4aDIVWktOujJ53+xw23yIwhAnUesR16FyH84b3d/hubtX9iROE4eiXO54/Oc9U5la73esG/Whq2Lf8EBLya3zuKkq5OF4iBziK4dRSXQVw4Hxt26UjMpZDq9cYHtg6Nf5JxcKimtZ/D910Ln2octfFVbyV1mMmy/cfSgrYEmPceYgkEhBdQ2VRkT+WVhgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1073,"cache_read_input_tokens":119295,"cache_creation":{"ephemeral_5m_input_tokens":1073,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJcNoZZinSKNrKtwirjF","type":"assistant","uuid":"a3c72459-f58f-463c-9ba6-8387e18f24f2","timestamp":"2025-12-20T20:59:20.086Z"}
{"parentUuid":"a3c72459-f58f-463c-9ba6-8387e18f24f2","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_019oKLgLy9CAN722VEYAV6gq","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me fix the Set iteration issue."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1073,"cache_read_input_tokens":119295,"cache_creation":{"ephemeral_5m_input_tokens":1073,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJcNoZZinSKNrKtwirjF","type":"assistant","uuid":"20d91973-1dc7-4a9c-a781-f082490a1189","timestamp":"2025-12-20T20:59:20.462Z"}
{"parentUuid":"20d91973-1dc7-4a9c-a781-f082490a1189","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_019oKLgLy9CAN722VEYAV6gq","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01LWt1kP9xyzhek6h2GmYJYn","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","offset":1095,"limit":15}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1073,"cache_read_input_tokens":119295,"cache_creation":{"ephemeral_5m_input_tokens":1073,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJcNoZZinSKNrKtwirjF","type":"assistant","uuid":"e93c95d5-6e87-483c-a53a-78dbf4ca3a83","timestamp":"2025-12-20T20:59:21.564Z"}
{"parentUuid":"e93c95d5-6e87-483c-a53a-78dbf4ca3a83","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01LWt1kP9xyzhek6h2GmYJYn","type":"tool_result","content":"  1095→      percentage: proc.percentage,\n  1096→      expectedImprovementRange: {\n  1097→        min: proc.expectedImprovementRange.min * severityMultiplier,\n  1098→        max: proc.expectedImprovementRange.max * severityMultiplier,\n  1099→      },\n  1100→      matchedFlaws: [...new Set(match.flaws)],\n  1101→      matchedRatios: [...new Set(match.ratios)],\n  1102→      ratios_impacted: affectedRatios.map(r => ({\n  1103→        ratioId: r.id,\n  1104→        ratioName: r.name,\n  1105→        direction: 'both' as const,\n  1106→        percentageEffect: proc.baseImpact,\n  1107→      })),\n  1108→      timeline: proc.timeline,\n  1109→      cost: proc.cost,\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"22e3a130-57b2-4719-a697-98a74af7e651","timestamp":"2025-12-20T20:59:21.674Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","content":"      percentage: proc.percentage,\n      expectedImprovementRange: {\n        min: proc.expectedImprovementRange.min * severityMultiplier,\n        max: proc.expectedImprovementRange.max * severityMultiplier,\n      },\n      matchedFlaws: [...new Set(match.flaws)],\n      matchedRatios: [...new Set(match.ratios)],\n      ratios_impacted: affectedRatios.map(r => ({\n        ratioId: r.id,\n        ratioName: r.name,\n        direction: 'both' as const,\n        percentageEffect: proc.baseImpact,\n      })),\n      timeline: proc.timeline,\n      cost: proc.cost,","numLines":15,"startLine":1095,"totalLines":1276}}}
{"parentUuid":"22e3a130-57b2-4719-a697-98a74af7e651","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Y9am4h5mVu27cthG6qA2xp","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"I need to use `Array.from()` instead of the spread operator for Set iteration.","signature":"EvYBCkYIChgCKkBCUWcjR7wFfw11uTQIjS8mmoRbY6ao3o1cUp6by/bvos1dRfQWQw2GKsRWaJpFJkT0Vh+fvR71rdoio6hzsnqYEgxJPnMi8rFHNlB4AhIaDLk4rlzH76cXwIDAwCIw2XlMGsfsMBvw5nmLgPYN46KSvVJGi3CHVISQPjDiynQo6uDQybELxyI868jZmROHKl4pO0bItS2bfc0qVTkca9j7Mjpkvu7rZnVkWIDn057vE7tfdqNoPznhPwwJ7Ob9A4NJHqXFnUkKiXkVS7UMa8PYI6XMrTonxZuIbJ+yF7d9kxGJEDYsP0rAZda/1IKoGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":490,"cache_read_input_tokens":120368,"cache_creation":{"ephemeral_5m_input_tokens":490,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJcP9LSjND5hpTQyEokm","type":"assistant","uuid":"f3381097-812b-4a7e-b65b-5c3152e152cb","timestamp":"2025-12-20T20:59:24.811Z"}
{"parentUuid":"f3381097-812b-4a7e-b65b-5c3152e152cb","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Y9am4h5mVu27cthG6qA2xp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012ut1EnwejczPsSPvK2bkDA","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","old_string":"      matchedFlaws: [...new Set(match.flaws)],\n      matchedRatios: [...new Set(match.ratios)],","new_string":"      matchedFlaws: Array.from(new Set(match.flaws)),\n      matchedRatios: Array.from(new Set(match.ratios)),"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":490,"cache_read_input_tokens":120368,"cache_creation":{"ephemeral_5m_input_tokens":490,"ephemeral_1h_input_tokens":0},"output_tokens":216,"service_tier":"standard"}},"requestId":"req_011CWJcP9LSjND5hpTQyEokm","type":"assistant","uuid":"c0fc5cd8-8d5a-4af7-b27f-8261a1c876d2","timestamp":"2025-12-20T20:59:26.751Z"}
{"parentUuid":"c0fc5cd8-8d5a-4af7-b27f-8261a1c876d2","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012ut1EnwejczPsSPvK2bkDA","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n  1096→      expectedImprovementRange: {\n  1097→        min: proc.expectedImprovementRange.min * severityMultiplier,\n  1098→        max: proc.expectedImprovementRange.max * severityMultiplier,\n  1099→      },\n  1100→      matchedFlaws: Array.from(new Set(match.flaws)),\n  1101→      matchedRatios: Array.from(new Set(match.ratios)),\n  1102→      ratios_impacted: affectedRatios.map(r => ({\n  1103→        ratioId: r.id,\n  1104→        ratioName: r.name,\n  1105→        direction: 'both' as const,"}]},"uuid":"adc40d60-f19d-4012-9e84-60c5afb4de17","timestamp":"2025-12-20T20:59:26.785Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","oldString":"      matchedFlaws: [...new Set(match.flaws)],\n      matchedRatios: [...new Set(match.ratios)],","newString":"      matchedFlaws: Array.from(new Set(match.flaws)),\n      matchedRatios: Array.from(new Set(match.ratios)),","originalFile":"'use client';\n\nimport React, { createContext, useContext, useState, useMemo, useCallback, ReactNode } from 'react';\nimport { LandmarkPoint } from '@/lib/landmarks';\nimport {\n  analyzeFrontProfile,\n  analyzeSideProfile,\n  analyzeHarmony,\n  HarmonyAnalysis,\n  FaceIQScoreResult,\n  FACEIQ_METRICS,\n  Ethnicity,\n  Gender,\n} from '@/lib/faceiq-scoring';\nimport {\n  Ratio,\n  Strength,\n  Flaw,\n  Recommendation,\n  ResultsTab,\n  FullHarmonyAnalysis,\n} from '@/types/results';\n\n// ============================================\n// CONTEXT TYPES\n// ============================================\n\ninterface ResultsContextType {\n  // Raw data\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  gender: Gender;\n  ethnicity: Ethnicity;\n  frontPhoto: string;\n  sidePhoto: string | null;\n\n  // Computed results\n  harmonyAnalysis: FullHarmonyAnalysis | null;\n  frontRatios: Ratio[];\n  sideRatios: Ratio[];\n  strengths: Strength[];\n  flaws: Flaw[];\n  recommendations: Recommendation[];\n\n  // Scores\n  overallScore: number;\n  frontScore: number;\n  sideScore: number;\n\n  // UI state\n  activeTab: ResultsTab;\n  setActiveTab: (tab: ResultsTab) => void;\n  expandedMeasurementId: string | null;\n  setExpandedMeasurementId: (id: string | null) => void;\n  selectedVisualizationMetric: string | null;\n  setSelectedVisualizationMetric: (id: string | null) => void;\n  categoryFilter: string | null;\n  setCategoryFilter: (category: string | null) => void;\n  showLandmarkOverlay: boolean;\n  setShowLandmarkOverlay: (show: boolean) => void;\n\n  // Actions\n  setResultsData: (data: ResultsInputData) => void;\n}\n\ninterface ResultsInputData {\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  frontPhoto: string;\n  sidePhoto?: string;\n  gender: Gender;\n  ethnicity?: Ethnicity;\n}\n\n// ============================================\n// HELPER FUNCTIONS\n// ============================================\n\nfunction convertUnitToRatioUnit(unit: string): 'x' | 'mm' | '%' | '°' {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return '°';\n    case 'mm': return 'mm';\n    default: return 'x';\n  }\n}\n\nfunction transformToRatio(result: FaceIQScoreResult, landmarks: LandmarkPoint[]): Ratio {\n  const metricConfig = FACEIQ_METRICS[result.metricId];\n\n  // Generate illustration based on metric\n  const illustration = generateIllustration(result.metricId, landmarks);\n\n  // Get flaw/strength mappings\n  const { mayIndicateFlaws, mayIndicateStrengths } = getFlawStrengthMappings(result);\n\n  return {\n    id: result.metricId,\n    name: result.name,\n    value: result.value,\n    score: result.score,\n    standardizedScore: result.standardizedScore,\n    unit: convertUnitToRatioUnit(result.unit),\n    idealMin: result.idealMin,\n    idealMax: result.idealMax,\n    rangeMin: metricConfig?.rangeMin || result.idealMin - 0.5,\n    rangeMax: metricConfig?.rangeMax || result.idealMax + 0.5,\n    description: metricConfig?.description || '',\n    category: result.category,\n    qualityLevel: result.qualityTier,\n    severity: result.severity,\n    illustration,\n    mayIndicateFlaws,\n    mayIndicateStrengths,\n    usedLandmarks: getUsedLandmarks(result.metricId),\n    scoringCurveConfig: metricConfig ? {\n      decayRate: metricConfig.decayRate,\n      maxScore: metricConfig.maxScore,\n    } : undefined,\n  };\n}\n\n// Enhanced illustration configuration type\ninterface IllustrationConfig {\n  points: string[];\n  lines: Array<{\n    from: string;\n    to: string;\n    label?: string;\n    color?: string;\n    labelPosition?: 'start' | 'middle' | 'end';  // Matches IllustrationLine type\n  }>;\n}\n\n// Comprehensive illustration configurations for all metrics\nconst ILLUSTRATION_CONFIGS: Record<string, IllustrationConfig> = {\n  // ==========================================\n  // FACE SHAPE / PROPORTIONS\n  // ==========================================\n  faceWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'middle' },\n      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'end' },\n    ],\n  },\n  totalFacialWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n      { from: 'trichion', to: 'menton', label: 'Total Height', color: '#a78bfa' },\n    ],\n  },\n  lowerThirdProportion: {\n    points: ['subnasale', 'menton', 'trichion'],\n    lines: [\n      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },\n  middleThirdProportion: {\n    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n    lines: [\n      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },\n  upperThirdProportion: {\n    points: ['trichion', 'nasal_base', 'menton'],\n    lines: [\n      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },\n  bitemporalWidth: {\n    points: ['left_temporal', 'right_temporal', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_temporal', to: 'right_temporal', label: 'Temple', color: '#fbbf24' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek', color: '#67e8f9' },\n    ],\n  },\n  cheekboneHeight: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_lateralis', 'right_canthus_lateralis', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheekbone', color: '#ec4899' },\n      { from: 'left_canthus_lateralis', to: 'left_zygion', color: '#67e8f9' },\n    ],\n  },\n  midfaceRatio: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_medialis', 'right_canthus_medialis', 'subnasale'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Midface Width', color: '#67e8f9' },\n      { from: 'left_canthus_medialis', to: 'subnasale', label: 'Midface Height', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // JAW MEASUREMENTS\n  // ==========================================\n  jawSlope: {\n    points: ['left_gonion_inferior', 'left_mentum_lateralis', 'menton', 'right_mentum_lateralis', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'left_mentum_lateralis', label: 'Jaw Slope', color: '#f97316' },\n      { from: 'right_gonion_inferior', to: 'right_mentum_lateralis', color: '#f97316' },\n    ],\n  },\n  jawFrontalAngle: {\n    points: ['left_gonion_inferior', 'menton', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'menton', label: 'Jaw Angle', color: '#f97316' },\n      { from: 'menton', to: 'right_gonion_inferior', color: '#f97316' },\n    ],\n  },\n  bigonialWidth: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw Width', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n    ],\n  },\n  jawWidthRatio: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face', color: '#67e8f9' },\n    ],\n  },\n\n  // ==========================================\n  // EYE MEASUREMENTS\n  // ==========================================\n  lateralCanthalTilt: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'end' },\n      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n    ],\n  },\n  eyeAspectRatio: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'left_palpebra_superior', 'left_palpebra_inferior'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Width', color: '#06b6d4' },\n      { from: 'left_palpebra_superior', to: 'left_palpebra_inferior', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  eyeSeparationRatio: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryMouthWidthRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_cheilion', 'right_cheilion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n    ],\n  },\n  oneEyeApartTest: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Between Eyes', color: '#06b6d4' },\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Eye Width', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // EYEBROW MEASUREMENTS\n  // ==========================================\n  browLengthRatio: {\n    points: ['left_supercilium_medialis', 'left_supercilium_lateralis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_lateralis', label: 'Brow', color: '#84cc16' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  eyebrowTilt: {\n    points: ['left_supercilium_medialis', 'left_supercilium_apex', 'left_supercilium_lateralis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_apex', label: 'Tilt', color: '#84cc16' },\n      { from: 'left_supercilium_apex', to: 'left_supercilium_lateralis', color: '#84cc16' },\n    ],\n  },\n  eyebrowLowSetedness: {\n    points: ['left_supercilium_medialis', 'left_palpebra_superior', 'left_canthus_medialis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_palpebra_superior', label: 'Brow-Eye Gap', color: '#84cc16' },\n    ],\n  },\n\n  // ==========================================\n  // NOSE MEASUREMENTS (FRONT)\n  // ==========================================\n  nasalIndex: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Width', color: '#fbbf24' },\n      { from: 'nasal_base', to: 'subnasale', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  intercanthalNasalRatio: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'left_canthus_medialis', 'right_canthus_medialis'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose Width', color: '#fbbf24' },\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n    ],\n  },\n  noseBridgeWidth: {\n    points: ['left_dorsum_nasi', 'right_dorsum_nasi', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_dorsum_nasi', to: 'right_dorsum_nasi', label: 'Bridge', color: '#fbbf24' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Base', color: '#f97316' },\n    ],\n  },\n  noseTipPosition: {\n    points: ['subnasale', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Tip Position', color: '#fbbf24' },\n    ],\n  },\n\n  // ==========================================\n  // MOUTH/LIP MEASUREMENTS\n  // ==========================================\n  mouthNoseWidthRatio: {\n    points: ['left_cheilion', 'right_cheilion', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  lowerUpperLipRatio: {\n    points: ['labrale_superius', 'mouth_middle', 'labrale_inferius'],\n    lines: [\n      { from: 'labrale_superius', to: 'mouth_middle', label: 'Upper', color: '#ec4899' },\n      { from: 'mouth_middle', to: 'labrale_inferius', label: 'Lower', color: '#f97316' },\n    ],\n  },\n  chinPhiltrumRatio: {\n    points: ['subnasale', 'labrale_superius', 'labrale_inferius', 'menton'],\n    lines: [\n      { from: 'subnasale', to: 'labrale_superius', label: 'Philtrum', color: '#ec4899' },\n      { from: 'labrale_inferius', to: 'menton', label: 'Chin', color: '#ef4444' },\n    ],\n  },\n  mouthWidth: {\n    points: ['left_cheilion', 'right_cheilion'],\n    lines: [{ from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth Width', color: '#ec4899' }],\n  },\n\n  // ==========================================\n  // CHIN MEASUREMENTS\n  // ==========================================\n  chinHeight: {\n    points: ['labrale_inferius', 'menton'],\n    lines: [{ from: 'labrale_inferius', to: 'menton', label: 'Chin Height', color: '#ef4444' }],\n  },\n\n  // ==========================================\n  // NECK MEASUREMENTS\n  // ==========================================\n  neckWidthRatio: {\n    points: ['left_cervical_lateralis', 'right_cervical_lateralis', 'left_gonion_inferior', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_cervical_lateralis', to: 'right_cervical_lateralis', label: 'Neck', color: '#14b8a6' },\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n    ],\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS\n  // ==========================================\n  gonialAngle: {\n    points: ['tragus', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'tragus', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  nasofrontalAngle: {\n    points: ['glabella', 'nasion', 'pronasale'],\n    lines: [\n      { from: 'glabella', to: 'nasion', label: 'Forehead', color: '#84cc16' },\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  nasofacialAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', color: '#67e8f9' },\n    ],\n  },\n  nasomentaAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', label: 'To Chin', color: '#ef4444' },\n    ],\n  },\n  submentalCervicalAngle: {\n    points: ['menton', 'cervicalPoint', 'neckPoint'],\n    lines: [\n      { from: 'menton', to: 'cervicalPoint', label: 'Submental', color: '#14b8a6' },\n      { from: 'cervicalPoint', to: 'neckPoint', label: 'Cervical', color: '#06b6d4' },\n    ],\n  },\n  facialDepthToHeight: {\n    points: ['pronasale', 'tragus', 'nasion', 'menton'],\n    lines: [\n      { from: 'pronasale', to: 'tragus', label: 'Depth', color: '#67e8f9' },\n      { from: 'nasion', to: 'menton', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  anteriorFacialDepth: {\n    points: ['glabella', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'glabella', to: 'pronasale', color: '#67e8f9' },\n      { from: 'pronasale', to: 'pogonion', color: '#a78bfa' },\n    ],\n  },\n  mandibularPlaneAngle: {\n    points: ['gonionBottom', 'menton', 'orbitale', 'porion'],\n    lines: [\n      { from: 'gonionBottom', to: 'menton', label: 'Mandibular', color: '#f97316' },\n      { from: 'orbitale', to: 'porion', label: 'Frankfort', color: '#67e8f9' },\n    ],\n  },\n  ramusToMandibleRatio: {\n    points: ['gonionTop', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'gonionTop', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  orbitalVector: {\n    points: ['cornealApex', 'orbitale', 'cheekbone'],\n    lines: [\n      { from: 'cornealApex', to: 'cheekbone', label: 'Orbital Vector', color: '#06b6d4' },\n    ],\n  },\n  eLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'E-Line', color: '#67e8f9' },\n    ],\n  },\n  sLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'S-Line', color: '#a78bfa' },\n    ],\n  },\n  holdawayHLine: {\n    points: ['pronasale', 'pogonion', 'labraleSuperius', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'H-Line', color: '#ec4899' },\n    ],\n  },\n  burstoneLowerLip: {\n    points: ['subnasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'subnasale', to: 'pogonion', label: 'Burstone', color: '#fbbf24' },\n    ],\n  },\n};\n\nfunction generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  const config = ILLUSTRATION_CONFIGS[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = {\n        from: line.from,\n        to: line.to,\n        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}\n\nfunction getUsedLandmarks(metricId: string): string[] {\n  const landmarkMappings: Record<string, string[]> = {\n    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lateralCanthalTilt: ['left_canthus_medialis', 'left_canthus_lateralis'],\n    nasalIndex: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    ipd: ['left_pupila', 'right_pupila'],\n    mouthWidth: ['left_cheilion', 'right_cheilion'],\n    jawWidth: ['left_gonion_inferior', 'right_gonion_inferior'],\n    chinHeight: ['labrale_inferius', 'menton'],\n    gonialAngle: ['tragus', 'gonionBottom', 'menton'],\n  };\n  return landmarkMappings[metricId] || [];\n}\n\nfunction getFlawStrengthMappings(result: FaceIQScoreResult): { mayIndicateFlaws: string[]; mayIndicateStrengths: string[] } {\n  const flawMappings: Record<string, { low: string[]; high: string[] }> = {\n    faceWidthToHeight: {\n      low: ['Narrow face', 'Vertically elongated face'],\n      high: ['Wide face', 'Horizontally expanded face'],\n    },\n    lowerThirdProportion: {\n      low: ['Short lower third', 'Deficient mandible'],\n      high: ['Long lower third', 'Mandibular excess'],\n    },\n    lateralCanthalTilt: {\n      low: ['Negative canthal tilt', 'Drooping eyes'],\n      high: ['Excessive positive canthal tilt'],\n    },\n    nasalIndex: {\n      low: ['Narrow nose', 'Leptorrhine nose'],\n      high: ['Wide nose', 'Platyrrhine nose'],\n    },\n    gonialAngle: {\n      low: ['Steep mandibular plane'],\n      high: ['Flat mandibular plane', 'Weak jaw definition'],\n    },\n  };\n\n  const strengthMappings: Record<string, { ideal: string[] }> = {\n    faceWidthToHeight: { ideal: ['Balanced facial proportions', 'Harmonious face shape'] },\n    lateralCanthalTilt: { ideal: ['Attractive eye shape', 'Positive canthal tilt'] },\n    nasalIndex: { ideal: ['Well-proportioned nose', 'Balanced nasal width'] },\n    gonialAngle: { ideal: ['Well-defined jawline', 'Strong jaw structure'] },\n  };\n\n  const mapping = flawMappings[result.metricId];\n  const strengthMapping = strengthMappings[result.metricId];\n\n  let mayIndicateFlaws: string[] = [];\n  let mayIndicateStrengths: string[] = [];\n\n  if (result.qualityTier === 'ideal' || result.qualityTier === 'excellent') {\n    mayIndicateStrengths = strengthMapping?.ideal || [];\n  } else if (mapping) {\n    mayIndicateFlaws = result.deviationDirection === 'below' ? mapping.low : mapping.high;\n  }\n\n  return { mayIndicateFlaws, mayIndicateStrengths };\n}\n\nfunction generateStrengthsFromAnalysis(analysis: HarmonyAnalysis): Strength[] {\n  const strengths: Strength[] = [];\n\n  analysis.strengths.forEach((s, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === s.metricId);\n\n    strengths.push({\n      id: `strength_${i}`,\n      strengthName: s.metricName,\n      summary: s.reasoning,\n      avgScore: matchingMeasurement?.score || 8,\n      qualityLevel: s.qualityTier,\n      categoryName: s.category,\n      responsibleRatios: [{\n        ratioName: s.metricName,\n        ratioId: s.metricId,\n        score: matchingMeasurement?.score || 8,\n        value: s.value,\n      }],\n    });\n  });\n\n  return strengths;\n}\n\nfunction generateFlawsFromAnalysis(analysis: HarmonyAnalysis): Flaw[] {\n  const flaws: Flaw[] = [];\n  let rollingLost = 0;\n\n  analysis.flaws.forEach((f, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === f.metricId);\n    const impact = matchingMeasurement ? (10 - matchingMeasurement.score) * 0.5 : 2;\n    rollingLost += impact;\n\n    flaws.push({\n      id: `flaw_${i}`,\n      flawName: f.metricName,\n      summary: f.reasoning,\n      harmonyPercentageLost: impact,\n      standardizedImpact: impact / 10,\n      categoryName: f.category,\n      responsibleRatios: [{\n        ratioName: f.metricName,\n        ratioId: f.metricId,\n        score: matchingMeasurement?.score || 3,\n        value: matchingMeasurement?.value || 0,\n      }],\n      rollingPointsDeducted: rollingLost,\n      rollingHarmonyPercentageLost: rollingLost,\n      rollingStandardizedImpact: rollingLost / 10,\n    });\n  });\n\n  return flaws.sort((a, b) => b.harmonyPercentageLost - a.harmonyPercentageLost);\n}\n\n// Comprehensive procedure database with metric-specific targeting\ninterface ProcedureConfig {\n  ref_id: string;\n  name: string;\n  description: string;\n  phase: 'Surgical' | 'Minimally Invasive' | 'Foundational';\n  baseImpact: number;\n  coverage: number;\n  percentage: string;\n  expectedImprovementRange: { min: number; max: number };\n  targetMetrics: string[];  // Specific metric IDs this treatment addresses\n  targetCategories: string[];  // Category names this treatment addresses\n  targetKeywords: string[];  // Flaw name keywords to match\n  timeline: { effect_start: 'immediate' | 'delayed' | 'gradual'; full_results_weeks: number; full_results_weeks_max?: number };\n  cost: { type: 'flat' | 'per_session' | 'per_month'; min: number; max: number; currency: string };\n  risks_side_effects: string;\n  warnings: string[];\n  gender: 'male' | 'female' | 'both';\n}\n\nconst PROCEDURE_DATABASE: ProcedureConfig[] = [\n  // ==========================================\n  // SURGICAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'SUR-01',\n    name: 'Sliding Genioplasty',\n    description: 'Chin bone repositioning surgery that can move the chin forward, backward, up, or down for optimal projection and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.90,\n    coverage: 8,\n    percentage: '15-25%',\n    expectedImprovementRange: { min: 0.5, max: 1.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'facialDepthToHeight', 'anteriorFacialDepth', 'nasomentaAngle'],\n    targetCategories: ['Chin', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['chin', 'recessed', 'weak', 'short chin', 'long chin', 'pogonion'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage, bone resorption.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-02',\n    name: 'Reduction Rhinoplasty',\n    description: 'Surgical reduction of nose size, hump removal, and tip refinement to improve nasal proportions.',\n    phase: 'Surgical',\n    baseImpact: 0.85,\n    coverage: 6,\n    percentage: '10-20%',\n    expectedImprovementRange: { min: 0.5, max: 1.0 },\n    targetMetrics: ['nasalIndex', 'nasofrontalAngle', 'nasofacialAngle', 'nasomentaAngle', 'intercanthalNasalRatio', 'noseBridgeWidth'],\n    targetCategories: ['Nose'],\n    targetKeywords: ['wide nose', 'large nose', 'dorsal hump', 'bulbous', 'nasal', 'nose bridge'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 7000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-03',\n    name: 'Jaw Angle Implants',\n    description: 'Custom or standard silicone/PEEK implants to enhance jaw width, definition, and angularity.',\n    phase: 'Surgical',\n    baseImpact: 0.80,\n    coverage: 5,\n    percentage: '10-15%',\n    expectedImprovementRange: { min: 0.4, max: 1.0 },\n    targetMetrics: ['bigonialWidth', 'jawFrontalAngle', 'jawWidthRatio', 'jawSlope', 'gonialAngle'],\n    targetCategories: ['Jaw Shape'],\n    targetKeywords: ['narrow jaw', 'weak jaw', 'soft jaw', 'jaw angle', 'gonial', 'mandible'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection, bone erosion.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-04',\n    name: 'Bimaxillary Osteotomy (Bimax)',\n    description: 'Double jaw surgery to reposition both upper and lower jaws for optimal occlusion and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.95,\n    coverage: 12,\n    percentage: '20-35%',\n    expectedImprovementRange: { min: 1.0, max: 2.0 },\n    targetMetrics: ['midfaceRatio', 'facialDepthToHeight', 'mandibularPlaneAngle', 'lowerThirdProportion', 'nasofacialAngle'],\n    targetCategories: ['Occlusion/Jaw Growth', 'Midface/Face Shape'],\n    targetKeywords: ['maxillary recession', 'mandibular', 'hyper-divergent', 'bite', 'occlusion', 'midface recession'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 20000, max: 60000, currency: 'USD' },\n    risks_side_effects: 'Extended recovery, numbness (temporary to permanent), dietary restrictions.',\n    warnings: ['Major surgery - requires orthodontic preparation'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-05',\n    name: 'Canthoplasty',\n    description: 'Surgical eye corner modification to improve canthal tilt and eye shape.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.8 },\n    targetMetrics: ['lateralCanthalTilt', 'eyeAspectRatio'],\n    targetCategories: ['Eyes'],\n    targetKeywords: ['canthal tilt', 'negative tilt', 'drooping eyes', 'eye shape', 'eye angle'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 4000, max: 12000, currency: 'USD' },\n    risks_side_effects: 'Scarring, asymmetry, dry eyes, ectropion.',\n    warnings: ['Difficult to reverse'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-06',\n    name: 'Cheek/Malar Implants',\n    description: 'Solid implants placed over the cheekbones to enhance midface projection and width.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 4,\n    percentage: '10-18%',\n    expectedImprovementRange: { min: 0.4, max: 0.9 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio', 'totalFacialWidthToHeight'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface', 'zygomatic', 'malar'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 6, full_results_weeks_max: 12 },\n    cost: { type: 'flat', min: 6000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry, implant shifting, nerve damage.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-07',\n    name: 'Neck Liposuction / Submentoplasty',\n    description: 'Fat removal and skin tightening under the chin and neck area.',\n    phase: 'Surgical',\n    baseImpact: 0.65,\n    coverage: 3,\n    percentage: '8-12%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['round neck', 'double chin', 'submental', 'cervical', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 3000, max: 8000, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, skin irregularity, numbness.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-08',\n    name: 'Brow Bone Reduction/Augmentation',\n    description: 'Surgical reshaping of the brow ridge for improved upper third harmony.',\n    phase: 'Surgical',\n    baseImpact: 0.70,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['nasofrontalAngle', 'bitemporalWidth', 'upperThirdProportion'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['brow ridge', 'forehead', 'nasofrontal', 'upper third', 'glabella'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling, numbness, scarring (if coronal incision).',\n    warnings: [],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // MINIMALLY INVASIVE TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'MIN-01',\n    name: 'Chin/Jawline Filler',\n    description: 'Hyaluronic acid injections to enhance chin projection and jawline definition. Reversible and temporary.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 4,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'jawFrontalAngle', 'bigonialWidth'],\n    targetCategories: ['Chin', 'Jaw Shape'],\n    targetKeywords: ['weak chin', 'recessed chin', 'soft jaw', 'jawline'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 800, max: 2500, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n    warnings: ['Results temporary (12-18 months)', 'Requires maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-02',\n    name: 'Cheek Filler',\n    description: 'HA filler to enhance cheekbone projection and midface volume.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 3,\n    percentage: '5-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface volume'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 600, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, asymmetry.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-03',\n    name: 'Lip Filler',\n    description: 'Hyaluronic acid to enhance lip volume and proportions.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['lowerUpperLipRatio', 'mouthNoseWidthRatio'],\n    targetCategories: ['Lips'],\n    targetKeywords: ['thin lip', 'lip ratio', 'lip volume', 'upper lip', 'lower lip'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 400, max: 1200, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, lumps.',\n    warnings: ['Results temporary (6-12 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-04',\n    name: 'PDO Thread Lift',\n    description: 'Dissolvable threads to lift and tighten skin, particularly for canthal tilt improvement.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 3,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.1, max: 0.4 },\n    targetMetrics: ['lateralCanthalTilt', 'eyebrowLowSetedness'],\n    targetCategories: ['Eyes', 'Upper Third'],\n    targetKeywords: ['canthal tilt', 'drooping', 'sagging', 'eyebrow position'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 1500, max: 4000, currency: 'USD' },\n    risks_side_effects: 'Bruising, asymmetry, thread visibility, infection.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-05',\n    name: 'Masseter Botox',\n    description: 'Botulinum toxin to slim the lower face by relaxing masseter muscles.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 2,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['bigonialWidth', 'jawWidthRatio', 'faceWidthToHeight'],\n    targetCategories: ['Jaw Shape', 'Midface/Face Shape'],\n    targetKeywords: ['wide jaw', 'square jaw', 'masseter', 'bruxism'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 400, max: 1000, currency: 'USD' },\n    risks_side_effects: 'Temporary weakness, asymmetry, difficulty chewing.',\n    warnings: ['Results temporary (4-6 months)', 'Requires regular maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-06',\n    name: 'Kybella (Submental Fat Dissolving)',\n    description: 'Injectable deoxycholic acid to permanently destroy fat cells under the chin.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 2,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['double chin', 'submental fat', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'per_session', min: 1200, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, numbness, difficulty swallowing (temporary).',\n    warnings: ['Requires 2-4 sessions'],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // FOUNDATIONAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'FND-01',\n    name: 'Mewing / Proper Tongue Posture',\n    description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 5,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['midfaceRatio', 'bigonialWidth', 'facialDepthToHeight'],\n    targetCategories: ['Midface/Face Shape', 'Jaw Shape', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['midface', 'palate', 'recession', 'jaw development'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n    cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n    risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n    warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-02',\n    name: 'Body Recomposition (Leanmaxxing)',\n    description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n    phase: 'Foundational',\n    baseImpact: 0.35,\n    coverage: 6,\n    percentage: '5-12%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['bigonialWidth', 'submentalCervicalAngle', 'cheekboneHeight'],\n    targetCategories: ['Jaw Shape', 'Neck', 'Midface/Face Shape'],\n    targetKeywords: ['soft jaw', 'undefined', 'round', 'facial definition'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n    risks_side_effects: 'None if done healthily.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-03',\n    name: 'Posture Correction',\n    description: 'Improving head and neck posture to optimize facial appearance and reduce forward head posture effects.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 3,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.2 },\n    targetMetrics: ['submentalCervicalAngle', 'anteriorFacialDepth'],\n    targetCategories: ['Neck', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['neck', 'posture', 'forward head'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 0, max: 100, currency: 'USD' },\n    risks_side_effects: 'None.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-04',\n    name: 'Skincare Routine (Retinoid + SPF)',\n    description: 'Medical-grade skincare to improve skin quality, texture, and reduce aging signs.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 2,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: [],\n    targetCategories: [],\n    targetKeywords: ['skin', 'texture', 'aging'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 26 },\n    cost: { type: 'per_month', min: 30, max: 150, currency: 'USD' },\n    risks_side_effects: 'Initial irritation, sun sensitivity.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-05',\n    name: 'Eyebrow Grooming / Microblading',\n    description: 'Professional shaping or semi-permanent tattooing to optimize eyebrow shape and position.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['eyebrowTilt', 'eyebrowLowSetedness', 'browLengthRatio'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['eyebrow', 'brow', 'upper third'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'flat', min: 20, max: 600, currency: 'USD' },\n    risks_side_effects: 'Minimal for grooming. Microblading: infection risk, color fading.',\n    warnings: [],\n    gender: 'both',\n  },\n];\n\n// Calculate relevance score based on multiple factors\nfunction calculateRelevanceScore(\n  proc: ProcedureConfig,\n  flaw: Flaw,\n  allFlaws: Flaw[]\n): number {\n  let score = 0;\n\n  // Check metric ID match (highest priority)\n  const metricId = flaw.responsibleRatios[0]?.ratioId || '';\n  if (proc.targetMetrics.includes(metricId)) {\n    score += 40;\n  }\n\n  // Check category match\n  if (proc.targetCategories.some(cat =>\n    flaw.categoryName.toLowerCase().includes(cat.toLowerCase()) ||\n    cat.toLowerCase().includes(flaw.categoryName.toLowerCase())\n  )) {\n    score += 25;\n  }\n\n  // Check keyword match\n  const flawLower = flaw.flawName.toLowerCase();\n  const summaryLower = flaw.summary.toLowerCase();\n  const matchedKeywords = proc.targetKeywords.filter(kw =>\n    flawLower.includes(kw.toLowerCase()) || summaryLower.includes(kw.toLowerCase())\n  );\n  score += matchedKeywords.length * 10;\n\n  // Adjust by flaw severity/impact\n  score += Math.min(flaw.harmonyPercentageLost * 3, 15);\n\n  // Bonus if this procedure addresses multiple flaws\n  const otherFlawsAddressed = allFlaws.filter(f =>\n    f.id !== flaw.id && (\n      proc.targetMetrics.includes(f.responsibleRatios[0]?.ratioId || '') ||\n      proc.targetCategories.some(cat => f.categoryName.toLowerCase().includes(cat.toLowerCase()))\n    )\n  );\n  score += otherFlawsAddressed.length * 5;\n\n  return Math.min(score, 100);\n}\n\nfunction generateRecommendations(flaws: Flaw[], frontRatios: Ratio[] = [], sideRatios: Ratio[] = []): Recommendation[] {\n  const recommendations: Recommendation[] = [];\n  const allRatios = [...frontRatios, ...sideRatios];\n\n  // Track which procedures have been added and their matched flaws\n  const procMatches: Map<string, { flaws: string[]; ratios: string[]; maxScore: number }> = new Map();\n\n  flaws.forEach(flaw => {\n    PROCEDURE_DATABASE.forEach(proc => {\n      const relevanceScore = calculateRelevanceScore(proc, flaw, flaws);\n\n      if (relevanceScore >= 25) {  // Minimum threshold\n        const existing = procMatches.get(proc.ref_id);\n        if (existing) {\n          existing.flaws.push(flaw.flawName);\n          existing.ratios.push(...flaw.responsibleRatios.map(r => r.ratioName));\n          existing.maxScore = Math.max(existing.maxScore, relevanceScore);\n        } else {\n          procMatches.set(proc.ref_id, {\n            flaws: [flaw.flawName],\n            ratios: flaw.responsibleRatios.map(r => r.ratioName),\n            maxScore: relevanceScore,\n          });\n        }\n      }\n    });\n  });\n\n  // Build recommendations from matched procedures\n  procMatches.forEach((match, procId) => {\n    const proc = PROCEDURE_DATABASE.find(p => p.ref_id === procId);\n    if (!proc) return;\n\n    // Calculate expected improvement based on severity of matched flaws\n    const matchedFlawDetails = flaws.filter(f => match.flaws.includes(f.flawName));\n    const avgImpact = matchedFlawDetails.reduce((sum, f) => sum + f.harmonyPercentageLost, 0) / matchedFlawDetails.length;\n    const severityMultiplier = Math.min(avgImpact / 3, 1.5);  // More severe = more potential improvement\n\n    // Get affected ratios from the actual data\n    const affectedRatios = allRatios.filter(r =>\n      proc.targetMetrics.includes(r.id) ||\n      match.flaws.some(f => f.toLowerCase().includes(r.category.toLowerCase()))\n    );\n\n    const adjustedImpact = proc.baseImpact * (0.8 + (match.maxScore / 500));  // Slight boost for high relevance\n\n    recommendations.push({\n      ref_id: proc.ref_id,\n      name: proc.name,\n      description: proc.description,\n      phase: proc.phase,\n      impact: adjustedImpact,\n      coverage: match.flaws.length + match.ratios.length,\n      percentage: proc.percentage,\n      expectedImprovementRange: {\n        min: proc.expectedImprovementRange.min * severityMultiplier,\n        max: proc.expectedImprovementRange.max * severityMultiplier,\n      },\n      matchedFlaws: [...new Set(match.flaws)],\n      matchedRatios: [...new Set(match.ratios)],\n      ratios_impacted: affectedRatios.map(r => ({\n        ratioId: r.id,\n        ratioName: r.name,\n        direction: 'both' as const,\n        percentageEffect: proc.baseImpact,\n      })),\n      timeline: proc.timeline,\n      cost: proc.cost,\n      risks_side_effects: proc.risks_side_effects,\n      warnings: proc.warnings,\n      gender: proc.gender,\n    });\n  });\n\n  // Sort by impact (higher = better), then by coverage (more flaws addressed = better)\n  return recommendations.sort((a, b) => {\n    const impactDiff = b.impact - a.impact;\n    if (Math.abs(impactDiff) > 0.1) return impactDiff;\n    return b.coverage - a.coverage;\n  });\n}\n\n// ============================================\n// CONTEXT CREATION\n// ============================================\n\nconst ResultsContext = createContext<ResultsContextType | null>(null);\n\nexport function useResults(): ResultsContextType {\n  const context = useContext(ResultsContext);\n  if (!context) {\n    throw new Error('useResults must be used within a ResultsProvider');\n  }\n  return context;\n}\n\ninterface ResultsProviderProps {\n  children: ReactNode;\n  initialData?: ResultsInputData;\n}\n\nexport function ResultsProvider({ children, initialData }: ResultsProviderProps) {\n  // Raw data state\n  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>(initialData?.frontLandmarks || []);\n  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>(initialData?.sideLandmarks || []);\n  const [gender, setGender] = useState<Gender>(initialData?.gender || 'male');\n  const [ethnicity, setEthnicity] = useState<Ethnicity>(initialData?.ethnicity || 'other');\n  const [frontPhoto, setFrontPhoto] = useState<string>(initialData?.frontPhoto || '');\n  const [sidePhoto, setSidePhoto] = useState<string | null>(initialData?.sidePhoto || null);\n\n  // UI state\n  const [activeTab, setActiveTab] = useState<ResultsTab>('overview');\n  const [expandedMeasurementId, setExpandedMeasurementId] = useState<string | null>(null);\n  const [selectedVisualizationMetric, setSelectedVisualizationMetric] = useState<string | null>(null);\n  const [categoryFilter, setCategoryFilter] = useState<string | null>(null);\n  const [showLandmarkOverlay, setShowLandmarkOverlay] = useState(true);\n\n  // Compute analysis results (now with demographic-specific scoring)\n  const analysisResults = useMemo(() => {\n    if (frontLandmarks.length === 0) {\n      return null;\n    }\n\n    try {\n      const frontAnalysis = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n      const sideAnalysis = sideLandmarks.length > 0\n        ? analyzeSideProfile(sideLandmarks, gender, ethnicity)\n        : null;\n      // analyzeHarmony expects landmarks directly, not analysis results\n      const harmony = analyzeHarmony(frontLandmarks, sideLandmarks, gender, ethnicity);\n\n      return { frontAnalysis, sideAnalysis, harmony };\n    } catch (error) {\n      console.error('Analysis error:', error);\n      return null;\n    }\n  }, [frontLandmarks, sideLandmarks, gender, ethnicity]);\n\n  // Transform to Ratio format\n  const frontRatios = useMemo(() => {\n    if (!analysisResults?.frontAnalysis) return [];\n    return analysisResults.frontAnalysis.measurements.map(m => transformToRatio(m, frontLandmarks));\n  }, [analysisResults, frontLandmarks]);\n\n  const sideRatios = useMemo(() => {\n    if (!analysisResults?.sideAnalysis) return [];\n    return analysisResults.sideAnalysis.measurements.map(m => transformToRatio(m, sideLandmarks));\n  }, [analysisResults, sideLandmarks]);\n\n  // Generate strengths and flaws\n  const strengths = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateStrengthsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  const flaws = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateFlawsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  // Generate recommendations with metric-aware matching\n  const recommendations = useMemo(() => {\n    return generateRecommendations(flaws, frontRatios, sideRatios);\n  }, [flaws, frontRatios, sideRatios]);\n\n  // Build full harmony analysis\n  const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {\n    if (!analysisResults?.harmony) return null;\n\n    return {\n      standardizedScore: analysisResults.harmony.overallScore,\n      front: {\n        standardizedScore: analysisResults.harmony.frontScore,\n        ratios: frontRatios,\n      },\n      side: {\n        standardizedScore: analysisResults.harmony.sideScore,\n        ratios: sideRatios,\n      },\n      strengths,\n      flaws,\n    };\n  }, [analysisResults, frontRatios, sideRatios, strengths, flaws]);\n\n  // Scores\n  const overallScore = analysisResults?.harmony?.overallScore || 0;\n  const frontScore = analysisResults?.harmony?.frontScore || 0;\n  const sideScore = analysisResults?.harmony?.sideScore || 0;\n\n  // Action to set all results data\n  const setResultsData = useCallback((data: ResultsInputData) => {\n    setFrontLandmarks(data.frontLandmarks);\n    setSideLandmarks(data.sideLandmarks);\n    setFrontPhoto(data.frontPhoto);\n    setSidePhoto(data.sidePhoto || null);\n    setGender(data.gender);\n    setEthnicity(data.ethnicity || 'other');\n  }, []);\n\n  const value: ResultsContextType = {\n    frontLandmarks,\n    sideLandmarks,\n    gender,\n    ethnicity,\n    frontPhoto,\n    sidePhoto,\n    harmonyAnalysis,\n    frontRatios,\n    sideRatios,\n    strengths,\n    flaws,\n    recommendations,\n    overallScore,\n    frontScore,\n    sideScore,\n    activeTab,\n    setActiveTab,\n    expandedMeasurementId,\n    setExpandedMeasurementId,\n    selectedVisualizationMetric,\n    setSelectedVisualizationMetric,\n    categoryFilter,\n    setCategoryFilter,\n    showLandmarkOverlay,\n    setShowLandmarkOverlay,\n    setResultsData,\n  };\n\n  return (\n    <ResultsContext.Provider value={value}>\n      {children}\n    </ResultsContext.Provider>\n  );\n}\n","structuredPatch":[{"oldStart":1097,"oldLines":8,"newStart":1097,"newLines":8,"lines":["         min: proc.expectedImprovementRange.min * severityMultiplier,","         max: proc.expectedImprovementRange.max * severityMultiplier,","       },","-      matchedFlaws: [...new Set(match.flaws)],","-      matchedRatios: [...new Set(match.ratios)],","+      matchedFlaws: Array.from(new Set(match.flaws)),","+      matchedRatios: Array.from(new Set(match.ratios)),","       ratios_impacted: affectedRatios.map(r => ({","         ratioId: r.id,","         ratioName: r.name,"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"adc40d60-f19d-4012-9e84-60c5afb4de17","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01GVHrNHKj4qLJYG5yYvdpjm","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me run the TypeScript check again to verify all errors are fixed.","signature":"EvEBCkYIChgCKkD1Q05L7183UGJ4TV81HJIdmtz3vWUFKCpJUKAqPX456NwGv1wR5tAWRvQJQSVMKpqgdasG0lmNd94u9xsmM1YMEgwAfLJAIi7KhG7WeaYaDFPXTiEIriejNdxC0yIwLmnO0T4sRhMfsMc/39hcgaebFYeQzSkitCYnVNkYOSN7uT66tDQcE3rdhALrkz2OKllAI6cZR6uHeqY0iG+rPvK+ojdipNVbnyPxmdAtLgpJiHkl7P+mvpr0l39HUuBkbeApqR3eRdQFqqVp9WKDwwJ6Xnk2mZt2T+KvQZQ+ft2uj9FW+KjhvcHc2xgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":655,"cache_read_input_tokens":120858,"cache_creation":{"ephemeral_5m_input_tokens":655,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWJcPXBqqF7ZUi22nynid","type":"assistant","uuid":"6380f1b9-ea20-472a-9c34-eeee759667e3","timestamp":"2025-12-20T20:59:30.744Z"}
{"parentUuid":"6380f1b9-ea20-472a-9c34-eeee759667e3","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01GVHrNHKj4qLJYG5yYvdpjm","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01RHwcUmX6BX8YddAoj7xpmS","name":"Bash","input":{"command":"npx tsc --noEmit 2>&1","description":"Run TypeScript check"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":655,"cache_read_input_tokens":120858,"cache_creation":{"ephemeral_5m_input_tokens":655,"ephemeral_1h_input_tokens":0},"output_tokens":107,"service_tier":"standard"}},"requestId":"req_011CWJcPXBqqF7ZUi22nynid","type":"assistant","uuid":"36196d65-42c2-4ad2-90fe-59d6f44a54b8","timestamp":"2025-12-20T20:59:31.563Z"}
{"parentUuid":"36196d65-42c2-4ad2-90fe-59d6f44a54b8","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"Exit code 2\nsrc/contexts/ResultsContext.tsx(502,20): error TS2322: Type 'Record<string, { from: string; to: string; color: string; label?: string | undefined; labelPosition?: string | undefined; }>' is not assignable to type 'Record<string, IllustrationLine>'.\n  'string' index signatures are incompatible.\n    Type '{ from: string; to: string; color: string; label?: string | undefined; labelPosition?: string | undefined; }' is not assignable to type 'IllustrationLine'.\n      Types of property 'labelPosition' are incompatible.\n        Type 'string | undefined' is not assignable to type '\"start\" | \"middle\" | \"end\" | undefined'.\n          Type 'string' is not assignable to type '\"start\" | \"middle\" | \"end\" | undefined'.","is_error":true,"tool_use_id":"toolu_01RHwcUmX6BX8YddAoj7xpmS"}]},"uuid":"79518e06-e7c1-4ab7-8609-23d81eb5a1fd","timestamp":"2025-12-20T20:59:32.644Z","toolUseResult":"Error: Exit code 2\nsrc/contexts/ResultsContext.tsx(502,20): error TS2322: Type 'Record<string, { from: string; to: string; color: string; label?: string | undefined; labelPosition?: string | undefined; }>' is not assignable to type 'Record<string, IllustrationLine>'.\n  'string' index signatures are incompatible.\n    Type '{ from: string; to: string; color: string; label?: string | undefined; labelPosition?: string | undefined; }' is not assignable to type 'IllustrationLine'.\n      Types of property 'labelPosition' are incompatible.\n        Type 'string | undefined' is not assignable to type '\"start\" | \"middle\" | \"end\" | undefined'.\n          Type 'string' is not assignable to type '\"start\" | \"middle\" | \"end\" | undefined'."}
{"parentUuid":"79518e06-e7c1-4ab7-8609-23d81eb5a1fd","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_011t7LYiy7f5L2oG3EcWKk2E","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The issue is that the lines object in generateIllustration is inferring the labelPosition as just `string` rather than the specific union type. I need to properly type the return value. Let me look at the generateIllustration function.","signature":"EpQDCkYIChgCKkDuSaL9u+9Hpt/5BUxoApHpSb00VwLAQ1f4B5YYLebDc+TqYxWnQFlY6Hc1aCmgRpXr+s/Vg4k7o/2rZ/5uKz1yEgy2RvrX5kUK4LDeLAwaDIAPa4a9O+8BJPYE2SIwvb5OqevnSNYiZi5MIgeCR63UgmUF+RERWpclxooL5sP0aBf2muKSq6nVR9xIO6RIKvsB9AzwFHkfY53lVDx74a1seIuDeoCnedq07DtUUjAnlJ2k1jjw5HWZkSZ99XMs8iBuw5wzZxx109gX3AanbNL+8ALTJCCYWZyqUcMOYnLlpf9wjA04jIb30/SLO27239OfZmQ/iqief+7aUMGdio+tu6Pca6yBknLqbaUzrqySMvysatQYkwjddnAd+f0zFli11hk53Lp7zd5sRIwu9PnP5vFbCnyTIhj+MUSLLFNXvMll91Gx6BqwW0CmRo2Cj98kqdxvmo4s9RWhyIhmqzp63bGv/IL2SwwfrbwnFwW4Q2I5R29KaXHawbBhzd009f9zyWkBHA/gzOKN4TcYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":340,"cache_read_input_tokens":121513,"cache_creation":{"ephemeral_5m_input_tokens":340,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcPx7nifH9ZSxD36w7h","type":"assistant","uuid":"af1a9509-c3ee-4ccc-8977-d3872667d375","timestamp":"2025-12-20T20:59:37.585Z"}
{"parentUuid":"af1a9509-c3ee-4ccc-8977-d3872667d375","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_011t7LYiy7f5L2oG3EcWKk2E","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JGcUm51iLCs5BcVgiwycec","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","offset":477,"limit":30}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":340,"cache_read_input_tokens":121513,"cache_creation":{"ephemeral_5m_input_tokens":340,"ephemeral_1h_input_tokens":0},"output_tokens":175,"service_tier":"standard"}},"requestId":"req_011CWJcPx7nifH9ZSxD36w7h","type":"assistant","uuid":"328caf22-0f9b-40a4-a96d-09e474876587","timestamp":"2025-12-20T20:59:38.731Z"}
{"parentUuid":"328caf22-0f9b-40a4-a96d-09e474876587","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JGcUm51iLCs5BcVgiwycec","type":"tool_result","content":"   477→function generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n   478→  const landmarkMap: Record<string, LandmarkPoint> = {};\n   479→  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n   480→\n   481→  const config = ILLUSTRATION_CONFIGS[metricId];\n   482→  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n   483→  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};\n   484→\n   485→  if (config) {\n   486→    config.points.forEach((pointId, i) => {\n   487→      if (landmarkMap[pointId]) {\n   488→        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n   489→      }\n   490→    });\n   491→    config.lines.forEach((line, i) => {\n   492→      lines[`line_${i}`] = {\n   493→        from: line.from,\n   494→        to: line.to,\n   495→        color: line.color || '#67e8f9',\n   496→        label: line.label,\n   497→        labelPosition: line.labelPosition,\n   498→      };\n   499→    });\n   500→  }\n   501→\n   502→  return { points, lines };\n   503→}\n   504→\n   505→function getUsedLandmarks(metricId: string): string[] {\n   506→  const landmarkMappings: Record<string, string[]> = {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"45158b7e-2c24-4f9c-b7fb-a544d1e8c500","timestamp":"2025-12-20T20:59:38.772Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","content":"function generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  const config = ILLUSTRATION_CONFIGS[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = {\n        from: line.from,\n        to: line.to,\n        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}\n\nfunction getUsedLandmarks(metricId: string): string[] {\n  const landmarkMappings: Record<string, string[]> = {","numLines":30,"startLine":477,"totalLines":1276}}}
{"parentUuid":"45158b7e-2c24-4f9c-b7fb-a544d1e8c500","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Pe7vpbdA7E21Cjuy5zsZdr","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"I need to update the type of the `lines` record to use the specific labelPosition type. Let me also import the IllustrationLine type.","signature":"Eq4CCkYIChgCKkC+gb3bVW3Dt2/2xTrO6AxGjYa0qSStVom9qv4WUWGjJG3245Xhw7NWhvkgrdkdTJAGUtE9uQ7WNc3rLMxmCMEzEgzwcg4xEMlR65MgYeoaDFnkzv99IgUNN7SzAiIwJCNBywMngkMtQ+KMQ13kaJnxSgIVIUrJ4xGLdB5b7lD5C7xkjVT2aotybqiFGMcdKpUBhKbKbXULsYAVzxRAJqi11MHn8yotUtxZWZPeCX8NkotLADJyHcK0SB5H6hM/vOPEyqQJgB3qGP8Lrca7xApKF4atZV7TXYONDUg9otp9QoigQg2FF977aanJkIQoxu55RYhbt2PLot1IR7U0Jv71c8KMF30iIkMnTDI3SpllSISiz4nIfeidF2HD7cB2C0eGPb5LCTQYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":705,"cache_read_input_tokens":121853,"cache_creation":{"ephemeral_5m_input_tokens":705,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWJcQQMrqjUK4c9LnMdCF","type":"assistant","uuid":"056f1814-0b8d-4c4a-a5bf-e59519ca2f44","timestamp":"2025-12-20T20:59:42.214Z"}
{"parentUuid":"056f1814-0b8d-4c4a-a5bf-e59519ca2f44","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Pe7vpbdA7E21Cjuy5zsZdr","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NeJXgPTDUR3EFJnxyspo9u","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","old_string":"function generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  const config = ILLUSTRATION_CONFIGS[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = {\n        from: line.from,\n        to: line.to,\n        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}","new_string":"function generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  const config = ILLUSTRATION_CONFIGS[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: 'start' | 'middle' | 'end' }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = {\n        from: line.from,\n        to: line.to,\n        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":705,"cache_read_input_tokens":121853,"cache_creation":{"ephemeral_5m_input_tokens":705,"ephemeral_1h_input_tokens":0},"output_tokens":769,"service_tier":"standard"}},"requestId":"req_011CWJcQQMrqjUK4c9LnMdCF","type":"assistant","uuid":"366d6ff3-de9a-481b-99da-a310c86488dd","timestamp":"2025-12-20T20:59:50.131Z"}
{"parentUuid":"366d6ff3-de9a-481b-99da-a310c86488dd","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NeJXgPTDUR3EFJnxyspo9u","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   473→    ],\n   474→  },\n   475→};\n   476→\n   477→function generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n   478→  const landmarkMap: Record<string, LandmarkPoint> = {};\n   479→  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n   480→\n   481→  const config = ILLUSTRATION_CONFIGS[metricId];\n   482→  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n   483→  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: 'start' | 'middle' | 'end' }> = {};\n   484→\n   485→  if (config) {\n   486→    config.points.forEach((pointId, i) => {\n   487→      if (landmarkMap[pointId]) {\n   488→        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n   489→      }\n   490→    });\n   491→    config.lines.forEach((line, i) => {\n   492→      lines[`line_${i}`] = {\n   493→        from: line.from,\n   494→        to: line.to,\n   495→        color: line.color || '#67e8f9',\n   496→        label: line.label,\n   497→        labelPosition: line.labelPosition,\n   498→      };\n   499→    });\n   500→  }\n   501→\n   502→  return { points, lines };\n   503→}\n   504→\n   505→function getUsedLandmarks(metricId: string): string[] {\n   506→  const landmarkMappings: Record<string, string[]> = {\n   507→    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],"}]},"uuid":"22bd22b7-90eb-4d6a-8b8d-19f206d9e627","timestamp":"2025-12-20T20:59:50.166Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","oldString":"function generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  const config = ILLUSTRATION_CONFIGS[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = {\n        from: line.from,\n        to: line.to,\n        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}","newString":"function generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  const config = ILLUSTRATION_CONFIGS[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: 'start' | 'middle' | 'end' }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = {\n        from: line.from,\n        to: line.to,\n        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}","originalFile":"'use client';\n\nimport React, { createContext, useContext, useState, useMemo, useCallback, ReactNode } from 'react';\nimport { LandmarkPoint } from '@/lib/landmarks';\nimport {\n  analyzeFrontProfile,\n  analyzeSideProfile,\n  analyzeHarmony,\n  HarmonyAnalysis,\n  FaceIQScoreResult,\n  FACEIQ_METRICS,\n  Ethnicity,\n  Gender,\n} from '@/lib/faceiq-scoring';\nimport {\n  Ratio,\n  Strength,\n  Flaw,\n  Recommendation,\n  ResultsTab,\n  FullHarmonyAnalysis,\n} from '@/types/results';\n\n// ============================================\n// CONTEXT TYPES\n// ============================================\n\ninterface ResultsContextType {\n  // Raw data\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  gender: Gender;\n  ethnicity: Ethnicity;\n  frontPhoto: string;\n  sidePhoto: string | null;\n\n  // Computed results\n  harmonyAnalysis: FullHarmonyAnalysis | null;\n  frontRatios: Ratio[];\n  sideRatios: Ratio[];\n  strengths: Strength[];\n  flaws: Flaw[];\n  recommendations: Recommendation[];\n\n  // Scores\n  overallScore: number;\n  frontScore: number;\n  sideScore: number;\n\n  // UI state\n  activeTab: ResultsTab;\n  setActiveTab: (tab: ResultsTab) => void;\n  expandedMeasurementId: string | null;\n  setExpandedMeasurementId: (id: string | null) => void;\n  selectedVisualizationMetric: string | null;\n  setSelectedVisualizationMetric: (id: string | null) => void;\n  categoryFilter: string | null;\n  setCategoryFilter: (category: string | null) => void;\n  showLandmarkOverlay: boolean;\n  setShowLandmarkOverlay: (show: boolean) => void;\n\n  // Actions\n  setResultsData: (data: ResultsInputData) => void;\n}\n\ninterface ResultsInputData {\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  frontPhoto: string;\n  sidePhoto?: string;\n  gender: Gender;\n  ethnicity?: Ethnicity;\n}\n\n// ============================================\n// HELPER FUNCTIONS\n// ============================================\n\nfunction convertUnitToRatioUnit(unit: string): 'x' | 'mm' | '%' | '°' {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return '°';\n    case 'mm': return 'mm';\n    default: return 'x';\n  }\n}\n\nfunction transformToRatio(result: FaceIQScoreResult, landmarks: LandmarkPoint[]): Ratio {\n  const metricConfig = FACEIQ_METRICS[result.metricId];\n\n  // Generate illustration based on metric\n  const illustration = generateIllustration(result.metricId, landmarks);\n\n  // Get flaw/strength mappings\n  const { mayIndicateFlaws, mayIndicateStrengths } = getFlawStrengthMappings(result);\n\n  return {\n    id: result.metricId,\n    name: result.name,\n    value: result.value,\n    score: result.score,\n    standardizedScore: result.standardizedScore,\n    unit: convertUnitToRatioUnit(result.unit),\n    idealMin: result.idealMin,\n    idealMax: result.idealMax,\n    rangeMin: metricConfig?.rangeMin || result.idealMin - 0.5,\n    rangeMax: metricConfig?.rangeMax || result.idealMax + 0.5,\n    description: metricConfig?.description || '',\n    category: result.category,\n    qualityLevel: result.qualityTier,\n    severity: result.severity,\n    illustration,\n    mayIndicateFlaws,\n    mayIndicateStrengths,\n    usedLandmarks: getUsedLandmarks(result.metricId),\n    scoringCurveConfig: metricConfig ? {\n      decayRate: metricConfig.decayRate,\n      maxScore: metricConfig.maxScore,\n    } : undefined,\n  };\n}\n\n// Enhanced illustration configuration type\ninterface IllustrationConfig {\n  points: string[];\n  lines: Array<{\n    from: string;\n    to: string;\n    label?: string;\n    color?: string;\n    labelPosition?: 'start' | 'middle' | 'end';  // Matches IllustrationLine type\n  }>;\n}\n\n// Comprehensive illustration configurations for all metrics\nconst ILLUSTRATION_CONFIGS: Record<string, IllustrationConfig> = {\n  // ==========================================\n  // FACE SHAPE / PROPORTIONS\n  // ==========================================\n  faceWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'middle' },\n      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'end' },\n    ],\n  },\n  totalFacialWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n      { from: 'trichion', to: 'menton', label: 'Total Height', color: '#a78bfa' },\n    ],\n  },\n  lowerThirdProportion: {\n    points: ['subnasale', 'menton', 'trichion'],\n    lines: [\n      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },\n  middleThirdProportion: {\n    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n    lines: [\n      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },\n  upperThirdProportion: {\n    points: ['trichion', 'nasal_base', 'menton'],\n    lines: [\n      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },\n  bitemporalWidth: {\n    points: ['left_temporal', 'right_temporal', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_temporal', to: 'right_temporal', label: 'Temple', color: '#fbbf24' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek', color: '#67e8f9' },\n    ],\n  },\n  cheekboneHeight: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_lateralis', 'right_canthus_lateralis', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheekbone', color: '#ec4899' },\n      { from: 'left_canthus_lateralis', to: 'left_zygion', color: '#67e8f9' },\n    ],\n  },\n  midfaceRatio: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_medialis', 'right_canthus_medialis', 'subnasale'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Midface Width', color: '#67e8f9' },\n      { from: 'left_canthus_medialis', to: 'subnasale', label: 'Midface Height', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // JAW MEASUREMENTS\n  // ==========================================\n  jawSlope: {\n    points: ['left_gonion_inferior', 'left_mentum_lateralis', 'menton', 'right_mentum_lateralis', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'left_mentum_lateralis', label: 'Jaw Slope', color: '#f97316' },\n      { from: 'right_gonion_inferior', to: 'right_mentum_lateralis', color: '#f97316' },\n    ],\n  },\n  jawFrontalAngle: {\n    points: ['left_gonion_inferior', 'menton', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'menton', label: 'Jaw Angle', color: '#f97316' },\n      { from: 'menton', to: 'right_gonion_inferior', color: '#f97316' },\n    ],\n  },\n  bigonialWidth: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw Width', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n    ],\n  },\n  jawWidthRatio: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face', color: '#67e8f9' },\n    ],\n  },\n\n  // ==========================================\n  // EYE MEASUREMENTS\n  // ==========================================\n  lateralCanthalTilt: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'end' },\n      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n    ],\n  },\n  eyeAspectRatio: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'left_palpebra_superior', 'left_palpebra_inferior'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Width', color: '#06b6d4' },\n      { from: 'left_palpebra_superior', to: 'left_palpebra_inferior', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  eyeSeparationRatio: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryMouthWidthRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_cheilion', 'right_cheilion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n    ],\n  },\n  oneEyeApartTest: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Between Eyes', color: '#06b6d4' },\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Eye Width', color: '#a78bfa' },\n    ],\n  },\n\n  // ==========================================\n  // EYEBROW MEASUREMENTS\n  // ==========================================\n  browLengthRatio: {\n    points: ['left_supercilium_medialis', 'left_supercilium_lateralis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_lateralis', label: 'Brow', color: '#84cc16' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  eyebrowTilt: {\n    points: ['left_supercilium_medialis', 'left_supercilium_apex', 'left_supercilium_lateralis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_apex', label: 'Tilt', color: '#84cc16' },\n      { from: 'left_supercilium_apex', to: 'left_supercilium_lateralis', color: '#84cc16' },\n    ],\n  },\n  eyebrowLowSetedness: {\n    points: ['left_supercilium_medialis', 'left_palpebra_superior', 'left_canthus_medialis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_palpebra_superior', label: 'Brow-Eye Gap', color: '#84cc16' },\n    ],\n  },\n\n  // ==========================================\n  // NOSE MEASUREMENTS (FRONT)\n  // ==========================================\n  nasalIndex: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Width', color: '#fbbf24' },\n      { from: 'nasal_base', to: 'subnasale', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  intercanthalNasalRatio: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'left_canthus_medialis', 'right_canthus_medialis'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose Width', color: '#fbbf24' },\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n    ],\n  },\n  noseBridgeWidth: {\n    points: ['left_dorsum_nasi', 'right_dorsum_nasi', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_dorsum_nasi', to: 'right_dorsum_nasi', label: 'Bridge', color: '#fbbf24' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Base', color: '#f97316' },\n    ],\n  },\n  noseTipPosition: {\n    points: ['subnasale', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Tip Position', color: '#fbbf24' },\n    ],\n  },\n\n  // ==========================================\n  // MOUTH/LIP MEASUREMENTS\n  // ==========================================\n  mouthNoseWidthRatio: {\n    points: ['left_cheilion', 'right_cheilion', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  lowerUpperLipRatio: {\n    points: ['labrale_superius', 'mouth_middle', 'labrale_inferius'],\n    lines: [\n      { from: 'labrale_superius', to: 'mouth_middle', label: 'Upper', color: '#ec4899' },\n      { from: 'mouth_middle', to: 'labrale_inferius', label: 'Lower', color: '#f97316' },\n    ],\n  },\n  chinPhiltrumRatio: {\n    points: ['subnasale', 'labrale_superius', 'labrale_inferius', 'menton'],\n    lines: [\n      { from: 'subnasale', to: 'labrale_superius', label: 'Philtrum', color: '#ec4899' },\n      { from: 'labrale_inferius', to: 'menton', label: 'Chin', color: '#ef4444' },\n    ],\n  },\n  mouthWidth: {\n    points: ['left_cheilion', 'right_cheilion'],\n    lines: [{ from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth Width', color: '#ec4899' }],\n  },\n\n  // ==========================================\n  // CHIN MEASUREMENTS\n  // ==========================================\n  chinHeight: {\n    points: ['labrale_inferius', 'menton'],\n    lines: [{ from: 'labrale_inferius', to: 'menton', label: 'Chin Height', color: '#ef4444' }],\n  },\n\n  // ==========================================\n  // NECK MEASUREMENTS\n  // ==========================================\n  neckWidthRatio: {\n    points: ['left_cervical_lateralis', 'right_cervical_lateralis', 'left_gonion_inferior', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_cervical_lateralis', to: 'right_cervical_lateralis', label: 'Neck', color: '#14b8a6' },\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n    ],\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS\n  // ==========================================\n  gonialAngle: {\n    points: ['tragus', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'tragus', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  nasofrontalAngle: {\n    points: ['glabella', 'nasion', 'pronasale'],\n    lines: [\n      { from: 'glabella', to: 'nasion', label: 'Forehead', color: '#84cc16' },\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  nasofacialAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', color: '#67e8f9' },\n    ],\n  },\n  nasomentaAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', label: 'To Chin', color: '#ef4444' },\n    ],\n  },\n  submentalCervicalAngle: {\n    points: ['menton', 'cervicalPoint', 'neckPoint'],\n    lines: [\n      { from: 'menton', to: 'cervicalPoint', label: 'Submental', color: '#14b8a6' },\n      { from: 'cervicalPoint', to: 'neckPoint', label: 'Cervical', color: '#06b6d4' },\n    ],\n  },\n  facialDepthToHeight: {\n    points: ['pronasale', 'tragus', 'nasion', 'menton'],\n    lines: [\n      { from: 'pronasale', to: 'tragus', label: 'Depth', color: '#67e8f9' },\n      { from: 'nasion', to: 'menton', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  anteriorFacialDepth: {\n    points: ['glabella', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'glabella', to: 'pronasale', color: '#67e8f9' },\n      { from: 'pronasale', to: 'pogonion', color: '#a78bfa' },\n    ],\n  },\n  mandibularPlaneAngle: {\n    points: ['gonionBottom', 'menton', 'orbitale', 'porion'],\n    lines: [\n      { from: 'gonionBottom', to: 'menton', label: 'Mandibular', color: '#f97316' },\n      { from: 'orbitale', to: 'porion', label: 'Frankfort', color: '#67e8f9' },\n    ],\n  },\n  ramusToMandibleRatio: {\n    points: ['gonionTop', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'gonionTop', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  orbitalVector: {\n    points: ['cornealApex', 'orbitale', 'cheekbone'],\n    lines: [\n      { from: 'cornealApex', to: 'cheekbone', label: 'Orbital Vector', color: '#06b6d4' },\n    ],\n  },\n  eLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'E-Line', color: '#67e8f9' },\n    ],\n  },\n  sLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'S-Line', color: '#a78bfa' },\n    ],\n  },\n  holdawayHLine: {\n    points: ['pronasale', 'pogonion', 'labraleSuperius', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'H-Line', color: '#ec4899' },\n    ],\n  },\n  burstoneLowerLip: {\n    points: ['subnasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'subnasale', to: 'pogonion', label: 'Burstone', color: '#fbbf24' },\n    ],\n  },\n};\n\nfunction generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  const config = ILLUSTRATION_CONFIGS[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = {\n        from: line.from,\n        to: line.to,\n        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}\n\nfunction getUsedLandmarks(metricId: string): string[] {\n  const landmarkMappings: Record<string, string[]> = {\n    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lateralCanthalTilt: ['left_canthus_medialis', 'left_canthus_lateralis'],\n    nasalIndex: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    ipd: ['left_pupila', 'right_pupila'],\n    mouthWidth: ['left_cheilion', 'right_cheilion'],\n    jawWidth: ['left_gonion_inferior', 'right_gonion_inferior'],\n    chinHeight: ['labrale_inferius', 'menton'],\n    gonialAngle: ['tragus', 'gonionBottom', 'menton'],\n  };\n  return landmarkMappings[metricId] || [];\n}\n\nfunction getFlawStrengthMappings(result: FaceIQScoreResult): { mayIndicateFlaws: string[]; mayIndicateStrengths: string[] } {\n  const flawMappings: Record<string, { low: string[]; high: string[] }> = {\n    faceWidthToHeight: {\n      low: ['Narrow face', 'Vertically elongated face'],\n      high: ['Wide face', 'Horizontally expanded face'],\n    },\n    lowerThirdProportion: {\n      low: ['Short lower third', 'Deficient mandible'],\n      high: ['Long lower third', 'Mandibular excess'],\n    },\n    lateralCanthalTilt: {\n      low: ['Negative canthal tilt', 'Drooping eyes'],\n      high: ['Excessive positive canthal tilt'],\n    },\n    nasalIndex: {\n      low: ['Narrow nose', 'Leptorrhine nose'],\n      high: ['Wide nose', 'Platyrrhine nose'],\n    },\n    gonialAngle: {\n      low: ['Steep mandibular plane'],\n      high: ['Flat mandibular plane', 'Weak jaw definition'],\n    },\n  };\n\n  const strengthMappings: Record<string, { ideal: string[] }> = {\n    faceWidthToHeight: { ideal: ['Balanced facial proportions', 'Harmonious face shape'] },\n    lateralCanthalTilt: { ideal: ['Attractive eye shape', 'Positive canthal tilt'] },\n    nasalIndex: { ideal: ['Well-proportioned nose', 'Balanced nasal width'] },\n    gonialAngle: { ideal: ['Well-defined jawline', 'Strong jaw structure'] },\n  };\n\n  const mapping = flawMappings[result.metricId];\n  const strengthMapping = strengthMappings[result.metricId];\n\n  let mayIndicateFlaws: string[] = [];\n  let mayIndicateStrengths: string[] = [];\n\n  if (result.qualityTier === 'ideal' || result.qualityTier === 'excellent') {\n    mayIndicateStrengths = strengthMapping?.ideal || [];\n  } else if (mapping) {\n    mayIndicateFlaws = result.deviationDirection === 'below' ? mapping.low : mapping.high;\n  }\n\n  return { mayIndicateFlaws, mayIndicateStrengths };\n}\n\nfunction generateStrengthsFromAnalysis(analysis: HarmonyAnalysis): Strength[] {\n  const strengths: Strength[] = [];\n\n  analysis.strengths.forEach((s, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === s.metricId);\n\n    strengths.push({\n      id: `strength_${i}`,\n      strengthName: s.metricName,\n      summary: s.reasoning,\n      avgScore: matchingMeasurement?.score || 8,\n      qualityLevel: s.qualityTier,\n      categoryName: s.category,\n      responsibleRatios: [{\n        ratioName: s.metricName,\n        ratioId: s.metricId,\n        score: matchingMeasurement?.score || 8,\n        value: s.value,\n      }],\n    });\n  });\n\n  return strengths;\n}\n\nfunction generateFlawsFromAnalysis(analysis: HarmonyAnalysis): Flaw[] {\n  const flaws: Flaw[] = [];\n  let rollingLost = 0;\n\n  analysis.flaws.forEach((f, i) => {\n    const matchingMeasurement = analysis.measurements.find(m => m.metricId === f.metricId);\n    const impact = matchingMeasurement ? (10 - matchingMeasurement.score) * 0.5 : 2;\n    rollingLost += impact;\n\n    flaws.push({\n      id: `flaw_${i}`,\n      flawName: f.metricName,\n      summary: f.reasoning,\n      harmonyPercentageLost: impact,\n      standardizedImpact: impact / 10,\n      categoryName: f.category,\n      responsibleRatios: [{\n        ratioName: f.metricName,\n        ratioId: f.metricId,\n        score: matchingMeasurement?.score || 3,\n        value: matchingMeasurement?.value || 0,\n      }],\n      rollingPointsDeducted: rollingLost,\n      rollingHarmonyPercentageLost: rollingLost,\n      rollingStandardizedImpact: rollingLost / 10,\n    });\n  });\n\n  return flaws.sort((a, b) => b.harmonyPercentageLost - a.harmonyPercentageLost);\n}\n\n// Comprehensive procedure database with metric-specific targeting\ninterface ProcedureConfig {\n  ref_id: string;\n  name: string;\n  description: string;\n  phase: 'Surgical' | 'Minimally Invasive' | 'Foundational';\n  baseImpact: number;\n  coverage: number;\n  percentage: string;\n  expectedImprovementRange: { min: number; max: number };\n  targetMetrics: string[];  // Specific metric IDs this treatment addresses\n  targetCategories: string[];  // Category names this treatment addresses\n  targetKeywords: string[];  // Flaw name keywords to match\n  timeline: { effect_start: 'immediate' | 'delayed' | 'gradual'; full_results_weeks: number; full_results_weeks_max?: number };\n  cost: { type: 'flat' | 'per_session' | 'per_month'; min: number; max: number; currency: string };\n  risks_side_effects: string;\n  warnings: string[];\n  gender: 'male' | 'female' | 'both';\n}\n\nconst PROCEDURE_DATABASE: ProcedureConfig[] = [\n  // ==========================================\n  // SURGICAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'SUR-01',\n    name: 'Sliding Genioplasty',\n    description: 'Chin bone repositioning surgery that can move the chin forward, backward, up, or down for optimal projection and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.90,\n    coverage: 8,\n    percentage: '15-25%',\n    expectedImprovementRange: { min: 0.5, max: 1.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'facialDepthToHeight', 'anteriorFacialDepth', 'nasomentaAngle'],\n    targetCategories: ['Chin', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['chin', 'recessed', 'weak', 'short chin', 'long chin', 'pogonion'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 5000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Temporary numbness, swelling, bruising. Rare: infection, nerve damage, bone resorption.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-02',\n    name: 'Reduction Rhinoplasty',\n    description: 'Surgical reduction of nose size, hump removal, and tip refinement to improve nasal proportions.',\n    phase: 'Surgical',\n    baseImpact: 0.85,\n    coverage: 6,\n    percentage: '10-20%',\n    expectedImprovementRange: { min: 0.5, max: 1.0 },\n    targetMetrics: ['nasalIndex', 'nasofrontalAngle', 'nasofacialAngle', 'nasomentaAngle', 'intercanthalNasalRatio', 'noseBridgeWidth'],\n    targetCategories: ['Nose'],\n    targetKeywords: ['wide nose', 'large nose', 'dorsal hump', 'bulbous', 'nasal', 'nose bridge'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 7000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling for 6-12 months, numbness, possible revision needed.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-03',\n    name: 'Jaw Angle Implants',\n    description: 'Custom or standard silicone/PEEK implants to enhance jaw width, definition, and angularity.',\n    phase: 'Surgical',\n    baseImpact: 0.80,\n    coverage: 5,\n    percentage: '10-15%',\n    expectedImprovementRange: { min: 0.4, max: 1.0 },\n    targetMetrics: ['bigonialWidth', 'jawFrontalAngle', 'jawWidthRatio', 'jawSlope', 'gonialAngle'],\n    targetCategories: ['Jaw Shape'],\n    targetKeywords: ['narrow jaw', 'weak jaw', 'soft jaw', 'jaw angle', 'gonial', 'mandible'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 8000, max: 25000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry risk, implant migration, infection, bone erosion.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-04',\n    name: 'Bimaxillary Osteotomy (Bimax)',\n    description: 'Double jaw surgery to reposition both upper and lower jaws for optimal occlusion and facial balance.',\n    phase: 'Surgical',\n    baseImpact: 0.95,\n    coverage: 12,\n    percentage: '20-35%',\n    expectedImprovementRange: { min: 1.0, max: 2.0 },\n    targetMetrics: ['midfaceRatio', 'facialDepthToHeight', 'mandibularPlaneAngle', 'lowerThirdProportion', 'nasofacialAngle'],\n    targetCategories: ['Occlusion/Jaw Growth', 'Midface/Face Shape'],\n    targetKeywords: ['maxillary recession', 'mandibular', 'hyper-divergent', 'bite', 'occlusion', 'midface recession'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 24, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 20000, max: 60000, currency: 'USD' },\n    risks_side_effects: 'Extended recovery, numbness (temporary to permanent), dietary restrictions.',\n    warnings: ['Major surgery - requires orthodontic preparation'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-05',\n    name: 'Canthoplasty',\n    description: 'Surgical eye corner modification to improve canthal tilt and eye shape.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.8 },\n    targetMetrics: ['lateralCanthalTilt', 'eyeAspectRatio'],\n    targetCategories: ['Eyes'],\n    targetKeywords: ['canthal tilt', 'negative tilt', 'drooping eyes', 'eye shape', 'eye angle'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 4000, max: 12000, currency: 'USD' },\n    risks_side_effects: 'Scarring, asymmetry, dry eyes, ectropion.',\n    warnings: ['Difficult to reverse'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-06',\n    name: 'Cheek/Malar Implants',\n    description: 'Solid implants placed over the cheekbones to enhance midface projection and width.',\n    phase: 'Surgical',\n    baseImpact: 0.75,\n    coverage: 4,\n    percentage: '10-18%',\n    expectedImprovementRange: { min: 0.4, max: 0.9 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio', 'totalFacialWidthToHeight'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface', 'zygomatic', 'malar'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 6, full_results_weeks_max: 12 },\n    cost: { type: 'flat', min: 6000, max: 15000, currency: 'USD' },\n    risks_side_effects: 'Swelling, asymmetry, implant shifting, nerve damage.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-07',\n    name: 'Neck Liposuction / Submentoplasty',\n    description: 'Fat removal and skin tightening under the chin and neck area.',\n    phase: 'Surgical',\n    baseImpact: 0.65,\n    coverage: 3,\n    percentage: '8-12%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['round neck', 'double chin', 'submental', 'cervical', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 8, full_results_weeks_max: 16 },\n    cost: { type: 'flat', min: 3000, max: 8000, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, skin irregularity, numbness.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'SUR-08',\n    name: 'Brow Bone Reduction/Augmentation',\n    description: 'Surgical reshaping of the brow ridge for improved upper third harmony.',\n    phase: 'Surgical',\n    baseImpact: 0.70,\n    coverage: 3,\n    percentage: '8-15%',\n    expectedImprovementRange: { min: 0.3, max: 0.7 },\n    targetMetrics: ['nasofrontalAngle', 'bitemporalWidth', 'upperThirdProportion'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['brow ridge', 'forehead', 'nasofrontal', 'upper third', 'glabella'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'flat', min: 8000, max: 20000, currency: 'USD' },\n    risks_side_effects: 'Swelling, numbness, scarring (if coronal incision).',\n    warnings: [],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // MINIMALLY INVASIVE TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'MIN-01',\n    name: 'Chin/Jawline Filler',\n    description: 'Hyaluronic acid injections to enhance chin projection and jawline definition. Reversible and temporary.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 4,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['chinPhiltrumRatio', 'jawFrontalAngle', 'bigonialWidth'],\n    targetCategories: ['Chin', 'Jaw Shape'],\n    targetKeywords: ['weak chin', 'recessed chin', 'soft jaw', 'jawline'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 800, max: 2500, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, rare vascular occlusion.',\n    warnings: ['Results temporary (12-18 months)', 'Requires maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-02',\n    name: 'Cheek Filler',\n    description: 'HA filler to enhance cheekbone projection and midface volume.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 3,\n    percentage: '5-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['cheekboneHeight', 'midfaceRatio'],\n    targetCategories: ['Midface/Face Shape'],\n    targetKeywords: ['flat cheeks', 'low cheekbones', 'midface volume'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 600, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, asymmetry.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-03',\n    name: 'Lip Filler',\n    description: 'Hyaluronic acid to enhance lip volume and proportions.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['lowerUpperLipRatio', 'mouthNoseWidthRatio'],\n    targetCategories: ['Lips'],\n    targetKeywords: ['thin lip', 'lip ratio', 'lip volume', 'upper lip', 'lower lip'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'per_session', min: 400, max: 1200, currency: 'USD' },\n    risks_side_effects: 'Bruising, swelling, lumps.',\n    warnings: ['Results temporary (6-12 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-04',\n    name: 'PDO Thread Lift',\n    description: 'Dissolvable threads to lift and tighten skin, particularly for canthal tilt improvement.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.35,\n    coverage: 3,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.1, max: 0.4 },\n    targetMetrics: ['lateralCanthalTilt', 'eyebrowLowSetedness'],\n    targetCategories: ['Eyes', 'Upper Third'],\n    targetKeywords: ['canthal tilt', 'drooping', 'sagging', 'eyebrow position'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 1500, max: 4000, currency: 'USD' },\n    risks_side_effects: 'Bruising, asymmetry, thread visibility, infection.',\n    warnings: ['Results temporary (12-18 months)'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-05',\n    name: 'Masseter Botox',\n    description: 'Botulinum toxin to slim the lower face by relaxing masseter muscles.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.40,\n    coverage: 2,\n    percentage: '4-8%',\n    expectedImprovementRange: { min: 0.2, max: 0.4 },\n    targetMetrics: ['bigonialWidth', 'jawWidthRatio', 'faceWidthToHeight'],\n    targetCategories: ['Jaw Shape', 'Midface/Face Shape'],\n    targetKeywords: ['wide jaw', 'square jaw', 'masseter', 'bruxism'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 4, full_results_weeks_max: 12 },\n    cost: { type: 'per_session', min: 400, max: 1000, currency: 'USD' },\n    risks_side_effects: 'Temporary weakness, asymmetry, difficulty chewing.',\n    warnings: ['Results temporary (4-6 months)', 'Requires regular maintenance'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'MIN-06',\n    name: 'Kybella (Submental Fat Dissolving)',\n    description: 'Injectable deoxycholic acid to permanently destroy fat cells under the chin.',\n    phase: 'Minimally Invasive',\n    baseImpact: 0.45,\n    coverage: 2,\n    percentage: '5-10%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['submentalCervicalAngle', 'neckWidthRatio'],\n    targetCategories: ['Neck'],\n    targetKeywords: ['double chin', 'submental fat', 'neck definition'],\n    timeline: { effect_start: 'delayed', full_results_weeks: 12, full_results_weeks_max: 24 },\n    cost: { type: 'per_session', min: 1200, max: 1800, currency: 'USD' },\n    risks_side_effects: 'Swelling, bruising, numbness, difficulty swallowing (temporary).',\n    warnings: ['Requires 2-4 sessions'],\n    gender: 'both',\n  },\n\n  // ==========================================\n  // FOUNDATIONAL TREATMENTS\n  // ==========================================\n  {\n    ref_id: 'FND-01',\n    name: 'Mewing / Proper Tongue Posture',\n    description: 'Maintaining correct tongue posture on the palate to potentially influence facial development over time.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 5,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['midfaceRatio', 'bigonialWidth', 'facialDepthToHeight'],\n    targetCategories: ['Midface/Face Shape', 'Jaw Shape', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['midface', 'palate', 'recession', 'jaw development'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 104, full_results_weeks_max: 260 },\n    cost: { type: 'flat', min: 0, max: 0, currency: 'USD' },\n    risks_side_effects: 'None if done correctly. Jaw pain if excessive.',\n    warnings: ['Results vary significantly', 'Most effective in younger individuals'],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-02',\n    name: 'Body Recomposition (Leanmaxxing)',\n    description: 'Reducing body fat percentage to enhance facial definition and reveal underlying bone structure.',\n    phase: 'Foundational',\n    baseImpact: 0.35,\n    coverage: 6,\n    percentage: '5-12%',\n    expectedImprovementRange: { min: 0.2, max: 0.5 },\n    targetMetrics: ['bigonialWidth', 'submentalCervicalAngle', 'cheekboneHeight'],\n    targetCategories: ['Jaw Shape', 'Neck', 'Midface/Face Shape'],\n    targetKeywords: ['soft jaw', 'undefined', 'round', 'facial definition'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'per_month', min: 50, max: 200, currency: 'USD' },\n    risks_side_effects: 'None if done healthily.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-03',\n    name: 'Posture Correction',\n    description: 'Improving head and neck posture to optimize facial appearance and reduce forward head posture effects.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 3,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.2 },\n    targetMetrics: ['submentalCervicalAngle', 'anteriorFacialDepth'],\n    targetCategories: ['Neck', 'Occlusion/Jaw Growth'],\n    targetKeywords: ['neck', 'posture', 'forward head'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 52 },\n    cost: { type: 'flat', min: 0, max: 100, currency: 'USD' },\n    risks_side_effects: 'None.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-04',\n    name: 'Skincare Routine (Retinoid + SPF)',\n    description: 'Medical-grade skincare to improve skin quality, texture, and reduce aging signs.',\n    phase: 'Foundational',\n    baseImpact: 0.20,\n    coverage: 2,\n    percentage: '2-5%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: [],\n    targetCategories: [],\n    targetKeywords: ['skin', 'texture', 'aging'],\n    timeline: { effect_start: 'gradual', full_results_weeks: 12, full_results_weeks_max: 26 },\n    cost: { type: 'per_month', min: 30, max: 150, currency: 'USD' },\n    risks_side_effects: 'Initial irritation, sun sensitivity.',\n    warnings: [],\n    gender: 'both',\n  },\n  {\n    ref_id: 'FND-05',\n    name: 'Eyebrow Grooming / Microblading',\n    description: 'Professional shaping or semi-permanent tattooing to optimize eyebrow shape and position.',\n    phase: 'Foundational',\n    baseImpact: 0.25,\n    coverage: 2,\n    percentage: '3-6%',\n    expectedImprovementRange: { min: 0.1, max: 0.3 },\n    targetMetrics: ['eyebrowTilt', 'eyebrowLowSetedness', 'browLengthRatio'],\n    targetCategories: ['Upper Third'],\n    targetKeywords: ['eyebrow', 'brow', 'upper third'],\n    timeline: { effect_start: 'immediate', full_results_weeks: 1 },\n    cost: { type: 'flat', min: 20, max: 600, currency: 'USD' },\n    risks_side_effects: 'Minimal for grooming. Microblading: infection risk, color fading.',\n    warnings: [],\n    gender: 'both',\n  },\n];\n\n// Calculate relevance score based on multiple factors\nfunction calculateRelevanceScore(\n  proc: ProcedureConfig,\n  flaw: Flaw,\n  allFlaws: Flaw[]\n): number {\n  let score = 0;\n\n  // Check metric ID match (highest priority)\n  const metricId = flaw.responsibleRatios[0]?.ratioId || '';\n  if (proc.targetMetrics.includes(metricId)) {\n    score += 40;\n  }\n\n  // Check category match\n  if (proc.targetCategories.some(cat =>\n    flaw.categoryName.toLowerCase().includes(cat.toLowerCase()) ||\n    cat.toLowerCase().includes(flaw.categoryName.toLowerCase())\n  )) {\n    score += 25;\n  }\n\n  // Check keyword match\n  const flawLower = flaw.flawName.toLowerCase();\n  const summaryLower = flaw.summary.toLowerCase();\n  const matchedKeywords = proc.targetKeywords.filter(kw =>\n    flawLower.includes(kw.toLowerCase()) || summaryLower.includes(kw.toLowerCase())\n  );\n  score += matchedKeywords.length * 10;\n\n  // Adjust by flaw severity/impact\n  score += Math.min(flaw.harmonyPercentageLost * 3, 15);\n\n  // Bonus if this procedure addresses multiple flaws\n  const otherFlawsAddressed = allFlaws.filter(f =>\n    f.id !== flaw.id && (\n      proc.targetMetrics.includes(f.responsibleRatios[0]?.ratioId || '') ||\n      proc.targetCategories.some(cat => f.categoryName.toLowerCase().includes(cat.toLowerCase()))\n    )\n  );\n  score += otherFlawsAddressed.length * 5;\n\n  return Math.min(score, 100);\n}\n\nfunction generateRecommendations(flaws: Flaw[], frontRatios: Ratio[] = [], sideRatios: Ratio[] = []): Recommendation[] {\n  const recommendations: Recommendation[] = [];\n  const allRatios = [...frontRatios, ...sideRatios];\n\n  // Track which procedures have been added and their matched flaws\n  const procMatches: Map<string, { flaws: string[]; ratios: string[]; maxScore: number }> = new Map();\n\n  flaws.forEach(flaw => {\n    PROCEDURE_DATABASE.forEach(proc => {\n      const relevanceScore = calculateRelevanceScore(proc, flaw, flaws);\n\n      if (relevanceScore >= 25) {  // Minimum threshold\n        const existing = procMatches.get(proc.ref_id);\n        if (existing) {\n          existing.flaws.push(flaw.flawName);\n          existing.ratios.push(...flaw.responsibleRatios.map(r => r.ratioName));\n          existing.maxScore = Math.max(existing.maxScore, relevanceScore);\n        } else {\n          procMatches.set(proc.ref_id, {\n            flaws: [flaw.flawName],\n            ratios: flaw.responsibleRatios.map(r => r.ratioName),\n            maxScore: relevanceScore,\n          });\n        }\n      }\n    });\n  });\n\n  // Build recommendations from matched procedures\n  procMatches.forEach((match, procId) => {\n    const proc = PROCEDURE_DATABASE.find(p => p.ref_id === procId);\n    if (!proc) return;\n\n    // Calculate expected improvement based on severity of matched flaws\n    const matchedFlawDetails = flaws.filter(f => match.flaws.includes(f.flawName));\n    const avgImpact = matchedFlawDetails.reduce((sum, f) => sum + f.harmonyPercentageLost, 0) / matchedFlawDetails.length;\n    const severityMultiplier = Math.min(avgImpact / 3, 1.5);  // More severe = more potential improvement\n\n    // Get affected ratios from the actual data\n    const affectedRatios = allRatios.filter(r =>\n      proc.targetMetrics.includes(r.id) ||\n      match.flaws.some(f => f.toLowerCase().includes(r.category.toLowerCase()))\n    );\n\n    const adjustedImpact = proc.baseImpact * (0.8 + (match.maxScore / 500));  // Slight boost for high relevance\n\n    recommendations.push({\n      ref_id: proc.ref_id,\n      name: proc.name,\n      description: proc.description,\n      phase: proc.phase,\n      impact: adjustedImpact,\n      coverage: match.flaws.length + match.ratios.length,\n      percentage: proc.percentage,\n      expectedImprovementRange: {\n        min: proc.expectedImprovementRange.min * severityMultiplier,\n        max: proc.expectedImprovementRange.max * severityMultiplier,\n      },\n      matchedFlaws: Array.from(new Set(match.flaws)),\n      matchedRatios: Array.from(new Set(match.ratios)),\n      ratios_impacted: affectedRatios.map(r => ({\n        ratioId: r.id,\n        ratioName: r.name,\n        direction: 'both' as const,\n        percentageEffect: proc.baseImpact,\n      })),\n      timeline: proc.timeline,\n      cost: proc.cost,\n      risks_side_effects: proc.risks_side_effects,\n      warnings: proc.warnings,\n      gender: proc.gender,\n    });\n  });\n\n  // Sort by impact (higher = better), then by coverage (more flaws addressed = better)\n  return recommendations.sort((a, b) => {\n    const impactDiff = b.impact - a.impact;\n    if (Math.abs(impactDiff) > 0.1) return impactDiff;\n    return b.coverage - a.coverage;\n  });\n}\n\n// ============================================\n// CONTEXT CREATION\n// ============================================\n\nconst ResultsContext = createContext<ResultsContextType | null>(null);\n\nexport function useResults(): ResultsContextType {\n  const context = useContext(ResultsContext);\n  if (!context) {\n    throw new Error('useResults must be used within a ResultsProvider');\n  }\n  return context;\n}\n\ninterface ResultsProviderProps {\n  children: ReactNode;\n  initialData?: ResultsInputData;\n}\n\nexport function ResultsProvider({ children, initialData }: ResultsProviderProps) {\n  // Raw data state\n  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>(initialData?.frontLandmarks || []);\n  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>(initialData?.sideLandmarks || []);\n  const [gender, setGender] = useState<Gender>(initialData?.gender || 'male');\n  const [ethnicity, setEthnicity] = useState<Ethnicity>(initialData?.ethnicity || 'other');\n  const [frontPhoto, setFrontPhoto] = useState<string>(initialData?.frontPhoto || '');\n  const [sidePhoto, setSidePhoto] = useState<string | null>(initialData?.sidePhoto || null);\n\n  // UI state\n  const [activeTab, setActiveTab] = useState<ResultsTab>('overview');\n  const [expandedMeasurementId, setExpandedMeasurementId] = useState<string | null>(null);\n  const [selectedVisualizationMetric, setSelectedVisualizationMetric] = useState<string | null>(null);\n  const [categoryFilter, setCategoryFilter] = useState<string | null>(null);\n  const [showLandmarkOverlay, setShowLandmarkOverlay] = useState(true);\n\n  // Compute analysis results (now with demographic-specific scoring)\n  const analysisResults = useMemo(() => {\n    if (frontLandmarks.length === 0) {\n      return null;\n    }\n\n    try {\n      const frontAnalysis = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n      const sideAnalysis = sideLandmarks.length > 0\n        ? analyzeSideProfile(sideLandmarks, gender, ethnicity)\n        : null;\n      // analyzeHarmony expects landmarks directly, not analysis results\n      const harmony = analyzeHarmony(frontLandmarks, sideLandmarks, gender, ethnicity);\n\n      return { frontAnalysis, sideAnalysis, harmony };\n    } catch (error) {\n      console.error('Analysis error:', error);\n      return null;\n    }\n  }, [frontLandmarks, sideLandmarks, gender, ethnicity]);\n\n  // Transform to Ratio format\n  const frontRatios = useMemo(() => {\n    if (!analysisResults?.frontAnalysis) return [];\n    return analysisResults.frontAnalysis.measurements.map(m => transformToRatio(m, frontLandmarks));\n  }, [analysisResults, frontLandmarks]);\n\n  const sideRatios = useMemo(() => {\n    if (!analysisResults?.sideAnalysis) return [];\n    return analysisResults.sideAnalysis.measurements.map(m => transformToRatio(m, sideLandmarks));\n  }, [analysisResults, sideLandmarks]);\n\n  // Generate strengths and flaws\n  const strengths = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateStrengthsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  const flaws = useMemo(() => {\n    if (!analysisResults?.harmony) return [];\n    return generateFlawsFromAnalysis(analysisResults.harmony);\n  }, [analysisResults]);\n\n  // Generate recommendations with metric-aware matching\n  const recommendations = useMemo(() => {\n    return generateRecommendations(flaws, frontRatios, sideRatios);\n  }, [flaws, frontRatios, sideRatios]);\n\n  // Build full harmony analysis\n  const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {\n    if (!analysisResults?.harmony) return null;\n\n    return {\n      standardizedScore: analysisResults.harmony.overallScore,\n      front: {\n        standardizedScore: analysisResults.harmony.frontScore,\n        ratios: frontRatios,\n      },\n      side: {\n        standardizedScore: analysisResults.harmony.sideScore,\n        ratios: sideRatios,\n      },\n      strengths,\n      flaws,\n    };\n  }, [analysisResults, frontRatios, sideRatios, strengths, flaws]);\n\n  // Scores\n  const overallScore = analysisResults?.harmony?.overallScore || 0;\n  const frontScore = analysisResults?.harmony?.frontScore || 0;\n  const sideScore = analysisResults?.harmony?.sideScore || 0;\n\n  // Action to set all results data\n  const setResultsData = useCallback((data: ResultsInputData) => {\n    setFrontLandmarks(data.frontLandmarks);\n    setSideLandmarks(data.sideLandmarks);\n    setFrontPhoto(data.frontPhoto);\n    setSidePhoto(data.sidePhoto || null);\n    setGender(data.gender);\n    setEthnicity(data.ethnicity || 'other');\n  }, []);\n\n  const value: ResultsContextType = {\n    frontLandmarks,\n    sideLandmarks,\n    gender,\n    ethnicity,\n    frontPhoto,\n    sidePhoto,\n    harmonyAnalysis,\n    frontRatios,\n    sideRatios,\n    strengths,\n    flaws,\n    recommendations,\n    overallScore,\n    frontScore,\n    sideScore,\n    activeTab,\n    setActiveTab,\n    expandedMeasurementId,\n    setExpandedMeasurementId,\n    selectedVisualizationMetric,\n    setSelectedVisualizationMetric,\n    categoryFilter,\n    setCategoryFilter,\n    showLandmarkOverlay,\n    setShowLandmarkOverlay,\n    setResultsData,\n  };\n\n  return (\n    <ResultsContext.Provider value={value}>\n      {children}\n    </ResultsContext.Provider>\n  );\n}\n","structuredPatch":[{"oldStart":480,"oldLines":7,"newStart":480,"newLines":7,"lines":[" ","   const config = ILLUSTRATION_CONFIGS[metricId];","   const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};","-  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: string }> = {};","+  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: 'start' | 'middle' | 'end' }> = {};"," ","   if (config) {","     config.points.forEach((pointId, i) => {"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"22bd22b7-90eb-4d6a-8b8d-19f206d9e627","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UPoiyLtt1MnhRLQke4fejw","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Now let me run the TypeScript check again.","signature":"EtIBCkYIChgCKkBknepy04MKZIA8xiBkZIzraVOC9uooLGtc/fe2HAGevxJEE0Y+8cLVd1jhiJ426Ed9KamhG7ny5lP4ole0wZixEgx7NYuGcKfdcGijatgaDOdxwqtKw9haRbbqByIwHDVc0bo16M/EWYwKpjMm/it2LpsIrwg/5IGoTpdP+ti06gCbBPfqLS6LdZqhZGYnKjryiwKeexdgkudTUBr+Mqj5IkalwfOlnlpru69H6sjfUuY7A8tOEv1CxXTFZT3X/RnwVE5awdHrkW2wGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1528,"cache_read_input_tokens":122558,"cache_creation":{"ephemeral_5m_input_tokens":1528,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcRFAEw6kZMHZgdMfE7","type":"assistant","uuid":"84a994fc-4761-4acb-babe-f9c9d31767e0","timestamp":"2025-12-20T20:59:53.078Z"}
{"parentUuid":"84a994fc-4761-4acb-babe-f9c9d31767e0","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UPoiyLtt1MnhRLQke4fejw","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01SAGrc4ZRMeEXcA1czFZNwr","name":"Bash","input":{"command":"npx tsc --noEmit 2>&1","description":"Run TypeScript check"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1528,"cache_read_input_tokens":122558,"cache_creation":{"ephemeral_5m_input_tokens":1528,"ephemeral_1h_input_tokens":0},"output_tokens":101,"service_tier":"standard"}},"requestId":"req_011CWJcRFAEw6kZMHZgdMfE7","type":"assistant","uuid":"4076ae69-6a29-461a-a89b-52df760b47b1","timestamp":"2025-12-20T20:59:53.916Z"}
{"parentUuid":"4076ae69-6a29-461a-a89b-52df760b47b1","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01SAGrc4ZRMeEXcA1czFZNwr","type":"tool_result","content":"","is_error":false}]},"uuid":"de74e95d-3bed-4c9b-bd8c-1bb2c7dce49f","timestamp":"2025-12-20T20:59:54.889Z","toolUseResult":{"stdout":"","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"de74e95d-3bed-4c9b-bd8c-1bb2c7dce49f","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01BqpG6ENBRQX8oMptQRfbTt","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"All TypeScript errors are fixed. Let me also run lint to double check.","signature":"Eu4BCkYIChgCKkAnfCeHtnRi3BhxAr9SwrbMO7qD6c0W2wyt6OHKI0epGssKnDQ/QgkD9fwD24NijoMBqw7Rzd4pttloTUz6Ih6YEgxZkq7aQpL+/73U8+8aDFRATtj4ZHtGyMzo0yIwXppoUA8kixcyZEosd4FkSyqcpcX5siZc/j1UxdK+irIPQPtVqVYxhRW9WFLbo+JFKlaMvJBKSCiCmSx5GEanjq/YwiSTA/IVQY7m54oXzoHFCQDH7OQ0TrbUlBLDTh5UIcRHCPCxRL03KtPQybuhjPZFM+ne5JXIynzx2zPRY/k6p2eJVMdopBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":134,"cache_read_input_tokens":124086,"cache_creation":{"ephemeral_5m_input_tokens":134,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcRbKSceKecZxH7egK7","type":"assistant","uuid":"03f86f4a-3a9f-4a18-8cdc-b862bda66a52","timestamp":"2025-12-20T20:59:57.584Z"}
{"parentUuid":"03f86f4a-3a9f-4a18-8cdc-b862bda66a52","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01BqpG6ENBRQX8oMptQRfbTt","type":"message","role":"assistant","content":[{"type":"text","text":"All TypeScript errors are fixed. Let me run lint once more to confirm."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":134,"cache_read_input_tokens":124086,"cache_creation":{"ephemeral_5m_input_tokens":134,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcRbKSceKecZxH7egK7","type":"assistant","uuid":"f860e8c2-b117-4e36-90a3-f05bf71cbeab","timestamp":"2025-12-20T20:59:58.138Z"}
{"parentUuid":"f860e8c2-b117-4e36-90a3-f05bf71cbeab","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01BqpG6ENBRQX8oMptQRfbTt","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CzbhmAeafwkVWovHP8hS9Y","name":"Bash","input":{"command":"npm run lint 2>&1","description":"Run lint check"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":134,"cache_read_input_tokens":124086,"cache_creation":{"ephemeral_5m_input_tokens":134,"ephemeral_1h_input_tokens":0},"output_tokens":118,"service_tier":"standard"}},"requestId":"req_011CWJcRbKSceKecZxH7egK7","type":"assistant","uuid":"93ad7145-c968-4dcf-b734-18ce28830b4b","timestamp":"2025-12-20T20:59:58.856Z"}
{"parentUuid":"93ad7145-c968-4dcf-b734-18ce28830b4b","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CzbhmAeafwkVWovHP8hS9Y","type":"tool_result","content":"> looksmaxx-app@0.1.0 lint\n> next lint\n\n\n./src/components/results/ResultsLayout.tsx\n74:13  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/tabs/OverviewTab.tsx\n39:13  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/visualization/FaceOverlay.tsx\n101:9  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\ninfo  - Need to disable some ESLint rules? Learn more here: https://nextjs.org/docs/basic-features/eslint#disabling-rules","is_error":false}]},"uuid":"bc4480fd-1486-4ae9-9694-fb82a28f7b5b","timestamp":"2025-12-20T21:00:00.185Z","toolUseResult":{"stdout":"> looksmaxx-app@0.1.0 lint\n> next lint\n\n\n./src/components/results/ResultsLayout.tsx\n74:13  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/tabs/OverviewTab.tsx\n39:13  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\n./src/components/results/visualization/FaceOverlay.tsx\n101:9  Warning: Using `<img>` could result in slower LCP and higher bandwidth. Consider using `<Image />` from `next/image` to automatically optimize images. This may incur additional usage or cost from your provider. See: https://nextjs.org/docs/messages/no-img-element  @next/next/no-img-element\n\ninfo  - Need to disable some ESLint rules? Learn more here: https://nextjs.org/docs/basic-features/eslint#disabling-rules","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"bc4480fd-1486-4ae9-9694-fb82a28f7b5b","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VdE88NypmU4aRis9MW5x1Z","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Only warnings remain (about `<img>` elements), no errors. All three medium priority tasks are now complete. Let me update the todo list to mark everything as completed.","signature":"EtECCkYIChgCKkDkI7t0D1Gn5kTnwghT0+C+m/vjEXRdMhRqIgoZNaSMfi3CLae3LbYdd7L7RBUapHwbvQCLo3luzPkq2VBlfe55Egz5TV80HHSC/p+29ykaDGv+pxpk95hn4tebZCIw7qFf+SwgINp3x+AkCVLFv1pkxVDnZTGwQjQDX7uvFmnHmRVH6D0LY0Rz1h2ZGAxoKrgBgD9g2lviOTv99RoEErmdxfn9bCnWHOnhcM6/r0eQSXf8SMjEV/GXnxJyo1WtC0cgBj1i2Omm2zfAq4TWS7XnorN2FqGed2IRElk5+Oa9AgiY+FtfTQc/nx5Lo5/7fQfc7dcz4JrYCzKQBqt84oBLCyZpmLI+GU+SFWNtb5Z6s19/D861BBY+bQ2ukFK/yJgddi2PA7xqhm4MmbNqPo4FU9/gKIv7ZDm6PIzLZsKeXFvlNVFpldPziBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":665,"cache_read_input_tokens":124220,"cache_creation":{"ephemeral_5m_input_tokens":665,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcRyyi7rmFJqf9TQFM9","type":"assistant","uuid":"97a6c866-bd2f-412a-8378-a420a14e6687","timestamp":"2025-12-20T21:00:04.126Z"}
{"parentUuid":"97a6c866-bd2f-412a-8378-a420a14e6687","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VdE88NypmU4aRis9MW5x1Z","type":"message","role":"assistant","content":[{"type":"text","text":"All three medium priority tasks are complete. Let me mark the todo list as finished."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":665,"cache_read_input_tokens":124220,"cache_creation":{"ephemeral_5m_input_tokens":665,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcRyyi7rmFJqf9TQFM9","type":"assistant","uuid":"623e5d55-369b-48b1-a6e0-7956abe22ef6","timestamp":"2025-12-20T21:00:04.610Z"}
{"parentUuid":"623e5d55-369b-48b1-a6e0-7956abe22ef6","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VdE88NypmU4aRis9MW5x1Z","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UaeGNsMjXMbGq9J3mJ1KS1","name":"TodoWrite","input":{"todos":[{"content":"Enhanced Illustration Configs - Expand generateIllustration() function","status":"completed","activeForm":"Expanding generateIllustration() function"},{"content":"Improved Flaw-to-Treatment Matching - Use metric scores and match flaws to procedures","status":"completed","activeForm":"Improving flaw-to-treatment matching"},{"content":"Severity Display Enhancement - Add severity badges with colors","status":"completed","activeForm":"Enhancing severity display with badges"}]}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":665,"cache_read_input_tokens":124220,"cache_creation":{"ephemeral_5m_input_tokens":665,"ephemeral_1h_input_tokens":0},"output_tokens":239,"service_tier":"standard"}},"requestId":"req_011CWJcRyyi7rmFJqf9TQFM9","type":"assistant","uuid":"6df7fb53-f72b-4bcd-b3b1-bbb60f7a6f75","timestamp":"2025-12-20T21:00:06.839Z"}
{"parentUuid":"6df7fb53-f72b-4bcd-b3b1-bbb60f7a6f75","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UaeGNsMjXMbGq9J3mJ1KS1","type":"tool_result","content":"Todos have been modified successfully. Ensure that you continue to use the todo list to track your progress. Please proceed with the current tasks if applicable"}]},"uuid":"dd5c52de-c08d-4b8b-a29c-02efdc8ef700","timestamp":"2025-12-20T21:00:06.864Z","toolUseResult":{"oldTodos":[{"content":"Enhanced Illustration Configs - Expand generateIllustration() function","status":"completed","activeForm":"Expanding generateIllustration() function"},{"content":"Improved Flaw-to-Treatment Matching - Use metric scores and match flaws to procedures","status":"completed","activeForm":"Improving flaw-to-treatment matching"},{"content":"Severity Display Enhancement - Add severity badges with colors","status":"in_progress","activeForm":"Enhancing severity display with badges"}],"newTodos":[{"content":"Enhanced Illustration Configs - Expand generateIllustration() function","status":"completed","activeForm":"Expanding generateIllustration() function"},{"content":"Improved Flaw-to-Treatment Matching - Use metric scores and match flaws to procedures","status":"completed","activeForm":"Improving flaw-to-treatment matching"},{"content":"Severity Display Enhancement - Add severity badges with colors","status":"completed","activeForm":"Enhancing severity display with badges"}]}}
{"parentUuid":"dd5c52de-c08d-4b8b-a29c-02efdc8ef700","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01YQUTSb3C71krFpwH1XvkQD","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"All tasks are completed. Let me provide a summary of what was done.","signature":"EusBCkYIChgCKkBABuhCA+VhRjEiNI1Gi8FvwU9dyQxaMajnxw0xDRj7dFM3BK/PwAXWDBRSvTdbvj65+qUttGEazTc/3ImnG3MiEgyJQ1X9iwBdauvgg1gaDAkGcnX+4XarPdXaOyIwMxNTBMWNisE0FDbWBOCzwAgbLrZv4Ab/UOkrACR2nE16M8WV6kNm81K1Jyn7AGZNKlMktJ79KELvB1x7m7KYYYAhFLJ+gtTbSP7E37G0fVnlBqRFIMOqsVPlTiyMfosF5MErnRAM5fWeyLxw7bBs11oavA+kvE/tXSNRfg4FvX+4Hcc9uxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":288,"cache_read_input_tokens":124885,"cache_creation":{"ephemeral_5m_input_tokens":288,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcSUUDXReHcUzdFDgE9","type":"assistant","uuid":"b5a3ff89-e166-41ff-8349-6451fb8b18f9","timestamp":"2025-12-20T21:00:10.030Z"}
{"parentUuid":"b5a3ff89-e166-41ff-8349-6451fb8b18f9","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"832a8a68-6423-43b9-9e06-ce6459c8c9dc","version":"2.0.70","gitBranch":"main","slug":"immutable-twirling-goblet","message":{"model":"claude-opus-4-5-20251101","id":"msg_01YQUTSb3C71krFpwH1XvkQD","type":"message","role":"assistant","content":[{"type":"text","text":"All three medium priority issues from `fixit.md` are complete:\n\n**1. Enhanced Illustration Configs** (`src/contexts/ResultsContext.tsx:124-475`)\n- Added comprehensive `ILLUSTRATION_CONFIGS` with 35+ metric-specific configurations\n- Each config specifies relevant landmarks, line connections, labels, and colors\n- Covers face shape, jaw, eyes, eyebrows, nose, mouth, chin, neck, and side profile measurements\n\n**2. Improved Flaw-to-Treatment Matching** (`src/contexts/ResultsContext.tsx:621-1121`)\n- Created `PROCEDURE_DATABASE` with 17 procedures (8 surgical, 6 minimally invasive, 5 foundational)\n- Each procedure has `targetMetrics` (specific metric IDs), `targetCategories`, and `targetKeywords`\n- Added `calculateRelevanceScore()` function that scores matches based on:\n  - Direct metric ID matches (40 points)\n  - Category matches (25 points)\n  - Keyword matches (10 points each)\n  - Flaw severity (up to 15 points)\n  - Multi-flaw coverage bonus (5 points per additional flaw)\n- Expected improvement ranges now scale with flaw severity\n\n**3. Severity Display Enhancement** (`src/components/results/cards/StrengthFlawCards.tsx:8-92`)\n- Added `SeverityBadge` component with FaceIQ-style colors:\n  - Extremely Severe (dark red) - ≥5% harmony lost\n  - Severe (red) - ≥3.5%\n  - Major (orange) - ≥2.5%\n  - Moderate (yellow) - ≥1.5%\n  - Minor (gray) - <1.5%\n- Updated `FlawCard` and `CompactFlawBadge` to display severity badges\n- Exported severity utilities for use in other components"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":288,"cache_read_input_tokens":124885,"cache_creation":{"ephemeral_5m_input_tokens":288,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJcSUUDXReHcUzdFDgE9","type":"assistant","uuid":"ff3bac46-33bf-439d-bd04-6d17f34045d4","timestamp":"2025-12-20T21:00:19.635Z"}
