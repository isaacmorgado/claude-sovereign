{"parentUuid":null,"isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","type":"user","message":{"role":"user","content":"Thoroughly analyze the landmarkers.js or landmark-related JavaScript in this project. Focus specifically on:\n\n1. All MATH FORMULAS and CALCULATIONS used for facial metrics\n2. How distances are calculated between landmarks\n3. How ratios are computed (e.g., facial thirds, eye spacing ratios)\n4. Any normalization or scaling applied to measurements\n\nCompare these calculations with src/lib/mediapipeDetection.ts. List any differences in formulas or mathematical approaches.\n\nBe very thorough - extract every calculation and compare."},"uuid":"8b9711cd-b24f-4a7c-b7dd-c128cd1372ca","timestamp":"2025-12-19T21:04:03.628Z"}
{"parentUuid":"8b9711cd-b24f-4a7c-b7dd-c128cd1372ca","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","message":{"model":"claude-haiku-4-5-20251001","id":"msg_013kW464tXZhiaq2vo2z4QsT","type":"message","role":"assistant","content":[{"type":"text","text":"I'll conduct a thorough analysis of the facial metrics calculations. Let me start by finding and examining the relevant files."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":12183,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":12183,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWGiw1YihgWvjCkpDNpSK","type":"assistant","uuid":"7c4f86bc-5054-42e8-831a-d1b015821dc4","timestamp":"2025-12-19T21:04:05.074Z"}
{"parentUuid":"7c4f86bc-5054-42e8-831a-d1b015821dc4","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_013kW464tXZhiaq2vo2z4QsT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HcPNPjzxNtRXGF8moth9n7","name":"Glob","input":{"pattern":"**/landmarkers.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":12183,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":12183,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWGiw1YihgWvjCkpDNpSK","type":"assistant","uuid":"5f026988-c137-4fac-a60b-7f29e9661d45","timestamp":"2025-12-19T21:04:05.314Z"}
{"parentUuid":"5f026988-c137-4fac-a60b-7f29e9661d45","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_013kW464tXZhiaq2vo2z4QsT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_013YJ2NhdqNmwsxA32xrKSBJ","name":"Glob","input":{"pattern":"**/*landmark*.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":12183,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":12183,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWGiw1YihgWvjCkpDNpSK","type":"assistant","uuid":"4c406d83-87f7-4df1-85a2-0084fab7f6ab","timestamp":"2025-12-19T21:04:05.537Z"}
{"parentUuid":"4c406d83-87f7-4df1-85a2-0084fab7f6ab","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_013kW464tXZhiaq2vo2z4QsT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PQ8XM9XYYfVt2Wpy9osjid","name":"Glob","input":{"pattern":"**/*metric*.js"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":12183,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":12183,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWGiw1YihgWvjCkpDNpSK","type":"assistant","uuid":"9894eac2-c3fd-464c-bbea-00d23371b20c","timestamp":"2025-12-19T21:04:05.651Z"}
{"parentUuid":"9894eac2-c3fd-464c-bbea-00d23371b20c","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_013kW464tXZhiaq2vo2z4QsT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VbDw1msaSnxMU4qaCycrh2","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/mediapipeDetection.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":12183,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":12183,"ephemeral_1h_input_tokens":0},"output_tokens":227,"service_tier":"standard"}},"requestId":"req_011CWGiw1YihgWvjCkpDNpSK","type":"assistant","uuid":"3388db38-5565-41bb-bcb3-d690ac6bbce1","timestamp":"2025-12-19T21:04:05.915Z"}
{"parentUuid":"3388db38-5565-41bb-bcb3-d690ac6bbce1","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VbDw1msaSnxMU4qaCycrh2","type":"tool_result","content":"     1→/**\n     2→ * Face Landmark Detection using MediaPipe Tasks Vision\n     3→ * Maps detected landmarks to our custom facial landmarks\n     4→ *\n     5→ * Uses the shared singleton service for optimal performance\n     6→ */\n     7→\n     8→import { faceDetectionService } from './faceDetectionService';\n     9→\n    10→// MediaPipe Face Mesh landmark indices (478 landmarks total)\n    11→// Reference: https://github.com/google/mediapipe/blob/master/mediapipe/modules/face_geometry/data/canonical_face_model_uv_visualization.png\n    12→\n    13→// Front profile landmark mapping\n    14→// Based on the reference website's exact MediaPipe indices\n    15→// Uses SUBJECT's perspective: \"left\" = subject's left (appears on RIGHT side of image)\n    16→export const MEDIAPIPE_FRONT_MAPPING: Record<string, number> = {\n    17→  // Head\n    18→  trichion: 10,\n    19→\n    20→  // Left Eye (subject's LEFT eye - appears on RIGHT of image)\n    21→  left_pupila: 468,\n    22→  left_canthus_medialis: 133,\n    23→  left_canthus_lateralis: 33,\n    24→  left_palpebra_superior: 470,\n    25→  left_palpebra_inferior: 472,\n    26→  left_sulcus_palpebralis_lateralis: 247,\n    27→  left_pretarsal_skin_crease: 470,\n    28→\n    29→  // Right Eye (subject's RIGHT eye - appears on LEFT of image)\n    30→  right_pupila: 473,\n    31→  right_canthus_medialis: 362,\n    32→  right_canthus_lateralis: 263,\n    33→  right_palpebra_superior: 475,\n    34→  right_palpebra_inferior: 374,\n    35→  right_sulcus_palpebralis_lateralis: 467,\n    36→  right_pretarsal_skin_crease: 475,\n    37→\n    38→  // Left Brow (subject's LEFT brow - appears on RIGHT of image)\n    39→  left_supercilium_medialis: 107,\n    40→  left_supercilium_medial_corner: 55,\n    41→  left_supercilium_superior: 52,\n    42→  left_supercilium_apex: 105,\n    43→  left_supercilium_lateralis: 70,\n    44→\n    45→  // Right Brow (subject's RIGHT brow - appears on LEFT of image)\n    46→  right_supercilium_medialis: 336,\n    47→  right_supercilium_medial_corner: 285,\n    48→  right_supercilium_superior: 282,\n    49→  right_supercilium_apex: 334,\n    50→  right_supercilium_lateralis: 276,\n    51→\n    52→  // Nose\n    53→  nasal_base: 290,\n    54→  left_dorsum_nasi: 174,\n    55→  right_dorsum_nasi: 399,\n    56→  left_ala_nasi: 48,\n    57→  right_ala_nasi: 278,\n    58→  subnasale: 2,\n    59→\n    60→  // Mouth\n    61→  labrale_superius: 0,\n    62→  cupids_bow: 37, // Left peak of cupid's bow (index 0 is center, 267 is right peak)\n    63→  mouth_middle: 14,\n    64→  labrale_inferius: 17,\n    65→  left_cheilion: 61,\n    66→  right_cheilion: 306,\n    67→\n    68→  // Jaw\n    69→  left_gonion_superior: 58,\n    70→  right_gonion_superior: 288,\n    71→  left_gonion_inferior: 172,\n    72→  right_gonion_inferior: 397,\n    73→\n    74→  // Chin\n    75→  left_mentum_lateralis: 176,\n    76→  right_mentum_lateralis: 400,\n    77→  menton: 152,\n    78→\n    79→  // Cheeks\n    80→  left_zygion: 234,\n    81→  right_zygion: 454,\n    82→  left_temporal: 54,\n    83→  right_temporal: 284,\n    84→\n    85→  // Ears\n    86→  left_auricular_lateral: 127,\n    87→  right_auricular_lateral: 356,\n    88→\n    89→  // Neck\n    90→  left_cervical_lateralis: 172,\n    91→  right_cervical_lateralis: 397,\n    92→};\n    93→\n    94→// Side profile landmark mapping (IDs must match SIDE_PROFILE_LANDMARKS in landmarks.ts)\n    95→// For side profile photos, uses MediaPipe LEFT indices (appearing on left side of image)\n    96→export const MEDIAPIPE_SIDE_MAPPING: Record<string, number> = {\n    97→  // Cranium (center/top landmarks)\n    98→  vertex: 10,\n    99→  external_occipital_region: 10,\n   100→  trichion_profile: 10,\n   101→\n   102→  // Forehead (center landmarks)\n   103→  frontalis: 151,\n   104→  glabella: 9,\n   105→\n   106→  // Eye Region - uses LEFT eye indices\n   107→  corneal_apex: 468,\n   108→  lateral_eyelid: 33,\n   109→  palpebra_inferior_side: 145,\n   110→  orbitale: 145,\n   111→\n   112→  // Nose (center/midline landmarks)\n   113→  nasion: 6,\n   114→  rhinion: 4,\n   115→  supratip_break: 4,\n   116→  pronasale: 1,\n   117→  infratip_lobule: 2,\n   118→  columella_nasi: 2,\n   119→  subnasale_side: 2,\n   120→  subalare: 129,\n   121→\n   122→  // Lips (mostly center landmarks)\n   123→  labrale_superius_side: 0,\n   124→  cheilion_side: 61,\n   125→  labrale_inferius_side: 17,\n   126→  sublabiale: 18,\n   127→\n   128→  // Chin (center landmarks)\n   129→  pogonion: 152,\n   130→  menton_side: 152,\n   131→\n   132→  // Jaw - uses LEFT jaw indices\n   133→  gonion_superior_side: 116,\n   134→  gonion_inferior_side: 172,\n   135→\n   136→  // Cheek - uses LEFT cheekbone\n   137→  zygion_soft_tissue: 234,\n   138→\n   139→  // Ear - uses LEFT ear area\n   140→  porion: 127,\n   141→  tragion: 127,\n   142→  incisura_intertragica: 127,\n   143→\n   144→  // Neck\n   145→  cervicale: 152,\n   146→  anterior_cervical_landmark: 152,\n   147→};\n   148→\n   149→export interface DetectedLandmarks {\n   150→  landmarks: Array<{ id: string; x: number; y: number }>;\n   151→  confidence: number;\n   152→  faceBox: { x: number; y: number; width: number; height: number };\n   153→}\n   154→\n   155→/**\n   156→ * Detect facial landmarks from an image URL\n   157→ * Uses the singleton FaceDetectionService for optimal performance\n   158→ */\n   159→export async function detectFromImageUrl(\n   160→  imageUrl: string,\n   161→  mode: 'front' | 'side'\n   162→): Promise<DetectedLandmarks | null> {\n   163→  try {\n   164→    // Load the image\n   165→    const img = await loadImage(imageUrl);\n   166→\n   167→    // Use the singleton service\n   168→    const result = await faceDetectionService.detect(img);\n   169→\n   170→    if (!result.faceLandmarks || result.faceLandmarks.length === 0) {\n   171→      console.log('No faces detected');\n   172→      return null;\n   173→    }\n   174→\n   175→    const faceLandmarks = result.faceLandmarks[0];\n   176→\n   177→    // Select mapping based on mode\n   178→    const mapping = mode === 'front' ? MEDIAPIPE_FRONT_MAPPING : MEDIAPIPE_SIDE_MAPPING;\n   179→\n   180→    // Map keypoints to our landmarks\n   181→    const landmarks = Object.entries(mapping).map(([id, index]) => {\n   182→      // Handle index bounds\n   183→      const safeIndex = Math.min(index, faceLandmarks.length - 1);\n   184→      const landmark = faceLandmarks[safeIndex];\n   185→\n   186→      return {\n   187→        id,\n   188→        // MediaPipe returns normalized coordinates (0-1)\n   189→        x: landmark ? landmark.x : 0.5,\n   190→        y: landmark ? landmark.y : 0.5,\n   191→      };\n   192→    });\n   193→\n   194→    // Calculate face bounding box from all landmarks\n   195→    let minX = 1, minY = 1, maxX = 0, maxY = 0;\n   196→    faceLandmarks.forEach((lm) => {\n   197→      minX = Math.min(minX, lm.x);\n   198→      minY = Math.min(minY, lm.y);\n   199→      maxX = Math.max(maxX, lm.x);\n   200→      maxY = Math.max(maxY, lm.y);\n   201→    });\n   202→\n   203→    return {\n   204→      landmarks,\n   205→      confidence: 0.95, // MediaPipe doesn't return confidence per landmark\n   206→      faceBox: {\n   207→        x: minX,\n   208→        y: minY,\n   209→        width: maxX - minX,\n   210→        height: maxY - minY,\n   211→      },\n   212→    };\n   213→  } catch (error) {\n   214→    console.error('Face detection error:', error);\n   215→    return null;\n   216→  }\n   217→}\n   218→\n   219→/**\n   220→ * Load an image from URL\n   221→ */\n   222→function loadImage(url: string): Promise<HTMLImageElement> {\n   223→  return new Promise((resolve, reject) => {\n   224→    const img = new Image();\n   225→    img.crossOrigin = 'anonymous';\n   226→    img.onload = () => resolve(img);\n   227→    img.onerror = (e) => reject(e);\n   228→    img.src = url;\n   229→  });\n   230→}\n   231→\n   232→/**\n   233→ * Get the region to zoom into for a specific landmark\n   234→ */\n   235→export function getLandmarkZoomRegion(\n   236→  landmarkId: string\n   237→): { centerX: number; centerY: number; zoomLevel: number } {\n   238→  const regions: Record<string, { centerX: number; centerY: number; zoomLevel: number }> = {\n   239→    // Eyes - zoom in close\n   240→    left_pupila: { centerX: 0.35, centerY: 0.35, zoomLevel: 3 },\n   241→    left_canthus_medialis: { centerX: 0.4, centerY: 0.35, zoomLevel: 3 },\n   242→    left_canthus_lateralis: { centerX: 0.3, centerY: 0.35, zoomLevel: 3 },\n   243→    right_pupila: { centerX: 0.65, centerY: 0.35, zoomLevel: 3 },\n   244→    right_canthus_medialis: { centerX: 0.6, centerY: 0.35, zoomLevel: 3 },\n   245→    right_canthus_lateralis: { centerX: 0.7, centerY: 0.35, zoomLevel: 3 },\n   246→\n   247→    // Brows\n   248→    left_supercilium_apex: { centerX: 0.35, centerY: 0.28, zoomLevel: 2.5 },\n   249→    right_supercilium_apex: { centerX: 0.65, centerY: 0.28, zoomLevel: 2.5 },\n   250→\n   251→    // Nose\n   252→    nasal_base: { centerX: 0.5, centerY: 0.4, zoomLevel: 2 },\n   253→    subnasale: { centerX: 0.5, centerY: 0.55, zoomLevel: 2.5 },\n   254→\n   255→    // Mouth\n   256→    labrale_superius: { centerX: 0.5, centerY: 0.6, zoomLevel: 2.5 },\n   257→    mouth_middle: { centerX: 0.5, centerY: 0.65, zoomLevel: 2 },\n   258→\n   259→    // Chin\n   260→    menton: { centerX: 0.5, centerY: 0.85, zoomLevel: 2 },\n   261→\n   262→    // Default for other landmarks\n   263→    default: { centerX: 0.5, centerY: 0.5, zoomLevel: 1.5 },\n   264→  };\n   265→\n   266→  return regions[landmarkId] || regions.default;\n   267→}\n   268→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"1ab60d1f-eb2f-4e22-a4d8-bb83adf293f1","timestamp":"2025-12-19T21:04:05.952Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/mediapipeDetection.ts","content":"/**\n * Face Landmark Detection using MediaPipe Tasks Vision\n * Maps detected landmarks to our custom facial landmarks\n *\n * Uses the shared singleton service for optimal performance\n */\n\nimport { faceDetectionService } from './faceDetectionService';\n\n// MediaPipe Face Mesh landmark indices (478 landmarks total)\n// Reference: https://github.com/google/mediapipe/blob/master/mediapipe/modules/face_geometry/data/canonical_face_model_uv_visualization.png\n\n// Front profile landmark mapping\n// Based on the reference website's exact MediaPipe indices\n// Uses SUBJECT's perspective: \"left\" = subject's left (appears on RIGHT side of image)\nexport const MEDIAPIPE_FRONT_MAPPING: Record<string, number> = {\n  // Head\n  trichion: 10,\n\n  // Left Eye (subject's LEFT eye - appears on RIGHT of image)\n  left_pupila: 468,\n  left_canthus_medialis: 133,\n  left_canthus_lateralis: 33,\n  left_palpebra_superior: 470,\n  left_palpebra_inferior: 472,\n  left_sulcus_palpebralis_lateralis: 247,\n  left_pretarsal_skin_crease: 470,\n\n  // Right Eye (subject's RIGHT eye - appears on LEFT of image)\n  right_pupila: 473,\n  right_canthus_medialis: 362,\n  right_canthus_lateralis: 263,\n  right_palpebra_superior: 475,\n  right_palpebra_inferior: 374,\n  right_sulcus_palpebralis_lateralis: 467,\n  right_pretarsal_skin_crease: 475,\n\n  // Left Brow (subject's LEFT brow - appears on RIGHT of image)\n  left_supercilium_medialis: 107,\n  left_supercilium_medial_corner: 55,\n  left_supercilium_superior: 52,\n  left_supercilium_apex: 105,\n  left_supercilium_lateralis: 70,\n\n  // Right Brow (subject's RIGHT brow - appears on LEFT of image)\n  right_supercilium_medialis: 336,\n  right_supercilium_medial_corner: 285,\n  right_supercilium_superior: 282,\n  right_supercilium_apex: 334,\n  right_supercilium_lateralis: 276,\n\n  // Nose\n  nasal_base: 290,\n  left_dorsum_nasi: 174,\n  right_dorsum_nasi: 399,\n  left_ala_nasi: 48,\n  right_ala_nasi: 278,\n  subnasale: 2,\n\n  // Mouth\n  labrale_superius: 0,\n  cupids_bow: 37, // Left peak of cupid's bow (index 0 is center, 267 is right peak)\n  mouth_middle: 14,\n  labrale_inferius: 17,\n  left_cheilion: 61,\n  right_cheilion: 306,\n\n  // Jaw\n  left_gonion_superior: 58,\n  right_gonion_superior: 288,\n  left_gonion_inferior: 172,\n  right_gonion_inferior: 397,\n\n  // Chin\n  left_mentum_lateralis: 176,\n  right_mentum_lateralis: 400,\n  menton: 152,\n\n  // Cheeks\n  left_zygion: 234,\n  right_zygion: 454,\n  left_temporal: 54,\n  right_temporal: 284,\n\n  // Ears\n  left_auricular_lateral: 127,\n  right_auricular_lateral: 356,\n\n  // Neck\n  left_cervical_lateralis: 172,\n  right_cervical_lateralis: 397,\n};\n\n// Side profile landmark mapping (IDs must match SIDE_PROFILE_LANDMARKS in landmarks.ts)\n// For side profile photos, uses MediaPipe LEFT indices (appearing on left side of image)\nexport const MEDIAPIPE_SIDE_MAPPING: Record<string, number> = {\n  // Cranium (center/top landmarks)\n  vertex: 10,\n  external_occipital_region: 10,\n  trichion_profile: 10,\n\n  // Forehead (center landmarks)\n  frontalis: 151,\n  glabella: 9,\n\n  // Eye Region - uses LEFT eye indices\n  corneal_apex: 468,\n  lateral_eyelid: 33,\n  palpebra_inferior_side: 145,\n  orbitale: 145,\n\n  // Nose (center/midline landmarks)\n  nasion: 6,\n  rhinion: 4,\n  supratip_break: 4,\n  pronasale: 1,\n  infratip_lobule: 2,\n  columella_nasi: 2,\n  subnasale_side: 2,\n  subalare: 129,\n\n  // Lips (mostly center landmarks)\n  labrale_superius_side: 0,\n  cheilion_side: 61,\n  labrale_inferius_side: 17,\n  sublabiale: 18,\n\n  // Chin (center landmarks)\n  pogonion: 152,\n  menton_side: 152,\n\n  // Jaw - uses LEFT jaw indices\n  gonion_superior_side: 116,\n  gonion_inferior_side: 172,\n\n  // Cheek - uses LEFT cheekbone\n  zygion_soft_tissue: 234,\n\n  // Ear - uses LEFT ear area\n  porion: 127,\n  tragion: 127,\n  incisura_intertragica: 127,\n\n  // Neck\n  cervicale: 152,\n  anterior_cervical_landmark: 152,\n};\n\nexport interface DetectedLandmarks {\n  landmarks: Array<{ id: string; x: number; y: number }>;\n  confidence: number;\n  faceBox: { x: number; y: number; width: number; height: number };\n}\n\n/**\n * Detect facial landmarks from an image URL\n * Uses the singleton FaceDetectionService for optimal performance\n */\nexport async function detectFromImageUrl(\n  imageUrl: string,\n  mode: 'front' | 'side'\n): Promise<DetectedLandmarks | null> {\n  try {\n    // Load the image\n    const img = await loadImage(imageUrl);\n\n    // Use the singleton service\n    const result = await faceDetectionService.detect(img);\n\n    if (!result.faceLandmarks || result.faceLandmarks.length === 0) {\n      console.log('No faces detected');\n      return null;\n    }\n\n    const faceLandmarks = result.faceLandmarks[0];\n\n    // Select mapping based on mode\n    const mapping = mode === 'front' ? MEDIAPIPE_FRONT_MAPPING : MEDIAPIPE_SIDE_MAPPING;\n\n    // Map keypoints to our landmarks\n    const landmarks = Object.entries(mapping).map(([id, index]) => {\n      // Handle index bounds\n      const safeIndex = Math.min(index, faceLandmarks.length - 1);\n      const landmark = faceLandmarks[safeIndex];\n\n      return {\n        id,\n        // MediaPipe returns normalized coordinates (0-1)\n        x: landmark ? landmark.x : 0.5,\n        y: landmark ? landmark.y : 0.5,\n      };\n    });\n\n    // Calculate face bounding box from all landmarks\n    let minX = 1, minY = 1, maxX = 0, maxY = 0;\n    faceLandmarks.forEach((lm) => {\n      minX = Math.min(minX, lm.x);\n      minY = Math.min(minY, lm.y);\n      maxX = Math.max(maxX, lm.x);\n      maxY = Math.max(maxY, lm.y);\n    });\n\n    return {\n      landmarks,\n      confidence: 0.95, // MediaPipe doesn't return confidence per landmark\n      faceBox: {\n        x: minX,\n        y: minY,\n        width: maxX - minX,\n        height: maxY - minY,\n      },\n    };\n  } catch (error) {\n    console.error('Face detection error:', error);\n    return null;\n  }\n}\n\n/**\n * Load an image from URL\n */\nfunction loadImage(url: string): Promise<HTMLImageElement> {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.crossOrigin = 'anonymous';\n    img.onload = () => resolve(img);\n    img.onerror = (e) => reject(e);\n    img.src = url;\n  });\n}\n\n/**\n * Get the region to zoom into for a specific landmark\n */\nexport function getLandmarkZoomRegion(\n  landmarkId: string\n): { centerX: number; centerY: number; zoomLevel: number } {\n  const regions: Record<string, { centerX: number; centerY: number; zoomLevel: number }> = {\n    // Eyes - zoom in close\n    left_pupila: { centerX: 0.35, centerY: 0.35, zoomLevel: 3 },\n    left_canthus_medialis: { centerX: 0.4, centerY: 0.35, zoomLevel: 3 },\n    left_canthus_lateralis: { centerX: 0.3, centerY: 0.35, zoomLevel: 3 },\n    right_pupila: { centerX: 0.65, centerY: 0.35, zoomLevel: 3 },\n    right_canthus_medialis: { centerX: 0.6, centerY: 0.35, zoomLevel: 3 },\n    right_canthus_lateralis: { centerX: 0.7, centerY: 0.35, zoomLevel: 3 },\n\n    // Brows\n    left_supercilium_apex: { centerX: 0.35, centerY: 0.28, zoomLevel: 2.5 },\n    right_supercilium_apex: { centerX: 0.65, centerY: 0.28, zoomLevel: 2.5 },\n\n    // Nose\n    nasal_base: { centerX: 0.5, centerY: 0.4, zoomLevel: 2 },\n    subnasale: { centerX: 0.5, centerY: 0.55, zoomLevel: 2.5 },\n\n    // Mouth\n    labrale_superius: { centerX: 0.5, centerY: 0.6, zoomLevel: 2.5 },\n    mouth_middle: { centerX: 0.5, centerY: 0.65, zoomLevel: 2 },\n\n    // Chin\n    menton: { centerX: 0.5, centerY: 0.85, zoomLevel: 2 },\n\n    // Default for other landmarks\n    default: { centerX: 0.5, centerY: 0.5, zoomLevel: 1.5 },\n  };\n\n  return regions[landmarkId] || regions.default;\n}\n","numLines":268,"startLine":1,"totalLines":268}}}
{"parentUuid":"1ab60d1f-eb2f-4e22-a4d8-bb83adf293f1","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PQ8XM9XYYfVt2Wpy9osjid","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/compiled/@next/font/dist/google/get-fallback-font-override-metrics.js\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/compiled/@next/font/dist/local/get-fallback-metrics-from-font-file.js\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/three/examples/jsm/geometries/ParametricFunctions.js\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/three/examples/jsm/geometries/ParametricGeometry.js\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/three/src/nodes/functions/VolumetricLightingModel.js"}]},"uuid":"d116a900-effe-454d-b098-8543262cabc7","timestamp":"2025-12-19T21:04:06.813Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/compiled/@next/font/dist/google/get-fallback-font-override-metrics.js","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/compiled/@next/font/dist/local/get-fallback-metrics-from-font-file.js","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/three/examples/jsm/geometries/ParametricFunctions.js","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/three/examples/jsm/geometries/ParametricGeometry.js","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/three/src/nodes/functions/VolumetricLightingModel.js"],"durationMs":867,"numFiles":5,"truncated":false}}
{"parentUuid":"d116a900-effe-454d-b098-8543262cabc7","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_013YJ2NhdqNmwsxA32xrKSBJ","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/aria-query/lib/etc/roles/abstract/landmarkRole.js\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/lucide-react/dist/esm/icons/landmark.js"}]},"uuid":"ee2d084b-2c9b-4e71-ba57-65998d5cef0f","timestamp":"2025-12-19T21:04:06.945Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/aria-query/lib/etc/roles/abstract/landmarkRole.js","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/lucide-react/dist/esm/icons/landmark.js"],"durationMs":998,"numFiles":2,"truncated":false}}
{"parentUuid":"ee2d084b-2c9b-4e71-ba57-65998d5cef0f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HcPNPjzxNtRXGF8moth9n7","type":"tool_result","content":"No files found"}]},"uuid":"81e0af14-bae9-4db4-bd36-569e9565f52b","timestamp":"2025-12-19T21:04:07.074Z","toolUseResult":{"filenames":[],"durationMs":1128,"numFiles":0,"truncated":false}}
{"parentUuid":"81e0af14-bae9-4db4-bd36-569e9565f52b","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_019MEWB9Cp96DzviEBjMWaXe","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me search for facial metrics calculations and analysis files in the project:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4153,"cache_creation_input_tokens":298,"cache_read_input_tokens":12183,"cache_creation":{"ephemeral_5m_input_tokens":298,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWGiwG5b1W5JFabV8899g","type":"assistant","uuid":"6610dbb3-e7f0-4025-9b95-985abf550841","timestamp":"2025-12-19T21:04:08.858Z"}
{"parentUuid":"6610dbb3-e7f0-4025-9b95-985abf550841","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_019MEWB9Cp96DzviEBjMWaXe","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XraB8VCQyNpNR259Nm5noA","name":"Glob","input":{"pattern":"**/analysis*"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4153,"cache_creation_input_tokens":298,"cache_read_input_tokens":12183,"cache_creation":{"ephemeral_5m_input_tokens":298,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWGiwG5b1W5JFabV8899g","type":"assistant","uuid":"c97cca3f-84f6-4501-b8c3-e38aa0ce8019","timestamp":"2025-12-19T21:04:09.039Z"}
{"parentUuid":"c97cca3f-84f6-4501-b8c3-e38aa0ce8019","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_019MEWB9Cp96DzviEBjMWaXe","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JdfPwqmfQcqX7ExWYByi8W","name":"Glob","input":{"pattern":"**/*metric*.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4153,"cache_creation_input_tokens":298,"cache_read_input_tokens":12183,"cache_creation":{"ephemeral_5m_input_tokens":298,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWGiwG5b1W5JFabV8899g","type":"assistant","uuid":"2de2ca48-dd8b-4f91-b6e1-82f0889b25c7","timestamp":"2025-12-19T21:04:09.255Z"}
{"parentUuid":"2de2ca48-dd8b-4f91-b6e1-82f0889b25c7","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_019MEWB9Cp96DzviEBjMWaXe","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01LYngCWRkpofdP7KiYkPo6p","name":"Glob","input":{"pattern":"**/*ratio*.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4153,"cache_creation_input_tokens":298,"cache_read_input_tokens":12183,"cache_creation":{"ephemeral_5m_input_tokens":298,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWGiwG5b1W5JFabV8899g","type":"assistant","uuid":"f26bb882-66b0-40e8-9100-c043d8cf67a8","timestamp":"2025-12-19T21:04:09.402Z"}
{"parentUuid":"f26bb882-66b0-40e8-9100-c043d8cf67a8","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_019MEWB9Cp96DzviEBjMWaXe","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WDHD9sFuxKRgpSTZqxja1i","name":"Glob","input":{"pattern":"**/*calculation*.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4153,"cache_creation_input_tokens":298,"cache_read_input_tokens":12183,"cache_creation":{"ephemeral_5m_input_tokens":298,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWGiwG5b1W5JFabV8899g","type":"assistant","uuid":"49dc20a8-be1b-4aae-85cc-27c5168f5760","timestamp":"2025-12-19T21:04:09.556Z"}
{"parentUuid":"49dc20a8-be1b-4aae-85cc-27c5168f5760","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_019MEWB9Cp96DzviEBjMWaXe","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NqFHZdaiQtkYt5yEfexZK2","name":"Bash","input":{"command":"find /Users/imorgado/LOOKSMAXX/looksmaxx-app/src -type f -name \"*.ts\" -o -name \"*.tsx\" | grep -E \"(analysis|metric|ratio|calculation)\" | head -20"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4153,"cache_creation_input_tokens":298,"cache_read_input_tokens":12183,"cache_creation":{"ephemeral_5m_input_tokens":298,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWGiwG5b1W5JFabV8899g","type":"assistant","uuid":"a391662b-de91-42c9-bc2d-9f9998ca595a","timestamp":"2025-12-19T21:04:10.215Z"}
{"parentUuid":"a391662b-de91-42c9-bc2d-9f9998ca595a","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NqFHZdaiQtkYt5yEfexZK2","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/analysis/page.tsx","is_error":false}]},"uuid":"89d9da65-6922-4864-b09e-6c8f7928b604","timestamp":"2025-12-19T21:04:10.354Z","toolUseResult":{"stdout":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/analysis/page.tsx","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"89d9da65-6922-4864-b09e-6c8f7928b604","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01WDHD9sFuxKRgpSTZqxja1i","type":"tool_result","content":"No files found"}]},"uuid":"737107a6-3992-496c-9a04-7868f36be8fb","timestamp":"2025-12-19T21:04:10.651Z","toolUseResult":{"filenames":[],"durationMs":404,"numFiles":0,"truncated":false}}
{"parentUuid":"737107a6-3992-496c-9a04-7868f36be8fb","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JdfPwqmfQcqX7ExWYByi8W","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/compiled/@next/font/dist/google/get-fallback-font-override-metrics.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/compiled/@next/font/dist/local/get-fallback-metrics-from-font-file.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@types/three/examples/jsm/geometries/ParametricFunctions.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@types/three/examples/jsm/geometries/ParametricGeometry.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@types/three/src/nodes/functions/VolumetricLightingModel.d.ts"}]},"uuid":"e0be184a-d3a8-4b86-9122-81cc3362e479","timestamp":"2025-12-19T21:04:10.773Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/compiled/@next/font/dist/google/get-fallback-font-override-metrics.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/compiled/@next/font/dist/local/get-fallback-metrics-from-font-file.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@types/three/examples/jsm/geometries/ParametricFunctions.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@types/three/examples/jsm/geometries/ParametricGeometry.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@types/three/src/nodes/functions/VolumetricLightingModel.d.ts"],"durationMs":527,"numFiles":5,"truncated":false}}
{"parentUuid":"e0be184a-d3a8-4b86-9122-81cc3362e479","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01LYngCWRkpofdP7KiYkPo6p","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@typescript-eslint/type-utils/dist/getDeclaration.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/node_modules/postcss/lib/declaration.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/postcss/lib/declaration.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@typescript-eslint/type-utils/dist/typeOrValueSpecifiers/typeDeclaredInPackageDeclarationFile.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/sucrase/dist/types/util/getDeclarationInfo.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/sucrase/dist/types/util/isAsyncOperation.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@typescript-eslint/eslint-plugin/dist/rules/init-declarations.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@typescript-eslint/eslint-plugin/dist/rules/no-unsafe-declaration-merging.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/lib/typescript/getTypeScriptConfiguration.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/lib/eslint/hasEslintConfiguration.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/client/components/react-dev-overlay/internal/helpers/hydration-error-info.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/client/components/is-hydration-error.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/compiled/@next/font/dist/local/pick-font-file-for-fallback-generation.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/compiled/@next/font/dist/local/pick-font-file-for-fallback-generation.test.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/client/setup-hydration-warning.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/client/components/static-generation-async-storage-instance.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/server/async-storage/static-generation-async-storage-wrapper.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/client/components/static-generation-async-storage.external.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/client/components/static-generation-bailout.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/lib/typescript/writeAppTypeDeclarations.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/lib/typescript/writeConfigurationDefaults.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@types/three/examples/jsm/shaders/HueSaturationShader.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@types/three/examples/jsm/tsl/display/ChromaticAberrationNode.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@dimforge/rapier3d-compat/dynamics/integration_parameters.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/recharts/types/state/selectors/combiners/combineTooltipPayloadConfigurations.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/face-api.js/node_modules/@tensorflow/tfjs-core/dist/ops/operation_test.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/face-api.js/node_modules/@tensorflow/tfjs-core/dist/ops/operation.d.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/face-api.js/node_modules/@tensorflow/tfjs-core/src/ops/operation.ts"}]},"uuid":"0d07e25d-2981-4ae0-89c5-fe8a4be9251e","timestamp":"2025-12-19T21:04:10.913Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@typescript-eslint/type-utils/dist/getDeclaration.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/node_modules/postcss/lib/declaration.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/postcss/lib/declaration.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@typescript-eslint/type-utils/dist/typeOrValueSpecifiers/typeDeclaredInPackageDeclarationFile.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/sucrase/dist/types/util/getDeclarationInfo.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/sucrase/dist/types/util/isAsyncOperation.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@typescript-eslint/eslint-plugin/dist/rules/init-declarations.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@typescript-eslint/eslint-plugin/dist/rules/no-unsafe-declaration-merging.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/lib/typescript/getTypeScriptConfiguration.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/lib/eslint/hasEslintConfiguration.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/client/components/react-dev-overlay/internal/helpers/hydration-error-info.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/client/components/is-hydration-error.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/compiled/@next/font/dist/local/pick-font-file-for-fallback-generation.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/compiled/@next/font/dist/local/pick-font-file-for-fallback-generation.test.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/client/setup-hydration-warning.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/client/components/static-generation-async-storage-instance.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/server/async-storage/static-generation-async-storage-wrapper.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/client/components/static-generation-async-storage.external.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/client/components/static-generation-bailout.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/lib/typescript/writeAppTypeDeclarations.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/next/dist/lib/typescript/writeConfigurationDefaults.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@types/three/examples/jsm/shaders/HueSaturationShader.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@types/three/examples/jsm/tsl/display/ChromaticAberrationNode.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/@dimforge/rapier3d-compat/dynamics/integration_parameters.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/recharts/types/state/selectors/combiners/combineTooltipPayloadConfigurations.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/face-api.js/node_modules/@tensorflow/tfjs-core/dist/ops/operation_test.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/face-api.js/node_modules/@tensorflow/tfjs-core/dist/ops/operation.d.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/node_modules/face-api.js/node_modules/@tensorflow/tfjs-core/src/ops/operation.ts"],"durationMs":668,"numFiles":28,"truncated":false}}
{"parentUuid":"0d07e25d-2981-4ae0-89c5-fe8a4be9251e","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XraB8VCQyNpNR259Nm5noA","type":"tool_result","content":"No files found"}]},"uuid":"59822311-7c0d-424c-8479-cf8a6bc3b935","timestamp":"2025-12-19T21:04:11.056Z","toolUseResult":{"filenames":[],"durationMs":811,"numFiles":0,"truncated":false}}
{"parentUuid":"59822311-7c0d-424c-8479-cf8a6bc3b935","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01K89JHkVznLHeMBxqfYhDLQ","type":"message","role":"assistant","content":[{"type":"text","text":"Let me check the analysis page and search for calculation-related files:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1686,"cache_creation_input_tokens":4603,"cache_read_input_tokens":12481,"cache_creation":{"ephemeral_5m_input_tokens":4603,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWGiwZCUXZyY8Hjph4zkK","type":"assistant","uuid":"c43e4ce9-1048-4da4-b191-28b48230f3ed","timestamp":"2025-12-19T21:04:12.886Z"}
{"parentUuid":"c43e4ce9-1048-4da4-b191-28b48230f3ed","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01K89JHkVznLHeMBxqfYhDLQ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015gdMGikWHUb4tix9SibRHA","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/analysis/page.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1686,"cache_creation_input_tokens":4603,"cache_read_input_tokens":12481,"cache_creation":{"ephemeral_5m_input_tokens":4603,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWGiwZCUXZyY8Hjph4zkK","type":"assistant","uuid":"d6129c97-6674-47d7-b635-ace97753a099","timestamp":"2025-12-19T21:04:13.146Z"}
{"parentUuid":"d6129c97-6674-47d7-b635-ace97753a099","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01K89JHkVznLHeMBxqfYhDLQ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01M2KzpTdUCHSrmVY1coaqWj","name":"Bash","input":{"command":"find /Users/imorgado/LOOKSMAXX/looksmaxx-app/src -type f \\( -name \"*.ts\" -o -name \"*.tsx\" \\) | head -30"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1686,"cache_creation_input_tokens":4603,"cache_read_input_tokens":12481,"cache_creation":{"ephemeral_5m_input_tokens":4603,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWGiwZCUXZyY8Hjph4zkK","type":"assistant","uuid":"ff2dbeff-b53c-4537-9584-5e7387478611","timestamp":"2025-12-19T21:04:13.601Z"}
{"parentUuid":"ff2dbeff-b53c-4537-9584-5e7387478611","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01K89JHkVznLHeMBxqfYhDLQ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Ya8WbmijVTMF7BuJfSbS4i","name":"Glob","input":{"pattern":"src/lib/*.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1686,"cache_creation_input_tokens":4603,"cache_read_input_tokens":12481,"cache_creation":{"ephemeral_5m_input_tokens":4603,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWGiwZCUXZyY8Hjph4zkK","type":"assistant","uuid":"46d8572a-d338-45c9-89d9-884d469b4866","timestamp":"2025-12-19T21:04:13.697Z"}
{"parentUuid":"46d8572a-d338-45c9-89d9-884d469b4866","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015gdMGikWHUb4tix9SibRHA","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useState } from 'react';\n     4→import { useRouter } from 'next/navigation';\n     5→import { useUpload } from '@/contexts/UploadContext';\n     6→import { useGender } from '@/contexts/GenderContext';\n     7→import { LandmarkAnalysisTool } from '@/components/LandmarkAnalysisTool';\n     8→import { ResultsDashboard } from '@/components/ResultsDashboard';\n     9→import { LandmarkPoint } from '@/lib/landmarks';\n    10→\n    11→type AnalysisStep = 'front' | 'side' | 'results';\n    12→\n    13→export default function AnalysisPage() {\n    14→  const router = useRouter();\n    15→  const { frontPhoto, sidePhoto } = useUpload();\n    16→  const { gender } = useGender();\n    17→  const [currentStep, setCurrentStep] = useState<AnalysisStep>('front');\n    18→  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>([]);\n    19→  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>([]);\n    20→\n    21→  // Redirect if no photos uploaded\n    22→  if (!frontPhoto && !sidePhoto) {\n    23→    return (\n    24→      <main className=\"min-h-screen bg-black flex flex-col items-center justify-center px-4\">\n    25→        <div className=\"text-center\">\n    26→          <h1 className=\"text-2xl font-semibold text-white mb-4\">No Photos Found</h1>\n    27→          <p className=\"text-neutral-400 mb-8\">\n    28→            Please upload your photos first to begin the analysis.\n    29→          </p>\n    30→          <button\n    31→            onClick={() => router.push('/upload')}\n    32→            className=\"h-12 px-8 rounded-xl bg-[#00f3ff] text-black font-medium hover:shadow-[0_0_20px_rgba(0,243,255,0.3)] transition-all\"\n    33→          >\n    34→            Go to Upload\n    35→          </button>\n    36→        </div>\n    37→      </main>\n    38→    );\n    39→  }\n    40→\n    41→  const handleFrontComplete = (landmarks: LandmarkPoint[]) => {\n    42→    setFrontLandmarks(landmarks);\n    43→    if (sidePhoto) {\n    44→      setCurrentStep('side');\n    45→    } else {\n    46→      setCurrentStep('results');\n    47→    }\n    48→  };\n    49→\n    50→  const handleSideComplete = (landmarks: LandmarkPoint[]) => {\n    51→    setSideLandmarks(landmarks);\n    52→    setCurrentStep('results');\n    53→  };\n    54→\n    55→  const handleBackFromFront = () => {\n    56→    router.push('/upload');\n    57→  };\n    58→\n    59→  const handleBackFromSide = () => {\n    60→    setCurrentStep('front');\n    61→  };\n    62→\n    63→  const handleBackFromResults = () => {\n    64→    setCurrentStep(sidePhoto ? 'side' : 'front');\n    65→  };\n    66→\n    67→  // Front Profile Analysis\n    68→  if (currentStep === 'front' && frontPhoto) {\n    69→    return (\n    70→      <LandmarkAnalysisTool\n    71→        imageUrl={frontPhoto.preview}\n    72→        mode=\"front\"\n    73→        onLandmarksChange={setFrontLandmarks}\n    74→        onComplete={handleFrontComplete}\n    75→        onBack={handleBackFromFront}\n    76→      />\n    77→    );\n    78→  }\n    79→\n    80→  // Side Profile Analysis\n    81→  if (currentStep === 'side' && sidePhoto) {\n    82→    return (\n    83→      <LandmarkAnalysisTool\n    84→        imageUrl={sidePhoto.preview}\n    85→        mode=\"side\"\n    86→        onLandmarksChange={setSideLandmarks}\n    87→        onComplete={handleSideComplete}\n    88→        onBack={handleBackFromSide}\n    89→      />\n    90→    );\n    91→  }\n    92→\n    93→  // Results Dashboard\n    94→  if (currentStep === 'results') {\n    95→    return (\n    96→      <main className=\"min-h-screen bg-black\">\n    97→        <div className=\"max-w-6xl mx-auto px-4 py-8\">\n    98→          <button\n    99→            onClick={handleBackFromResults}\n   100→            className=\"flex items-center gap-2 text-neutral-400 hover:text-white transition-colors text-sm mb-6\"\n   101→          >\n   102→            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n   103→              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n   104→            </svg>\n   105→            Back to Analysis\n   106→          </button>\n   107→          <ResultsDashboard\n   108→            frontLandmarks={frontLandmarks}\n   109→            sideLandmarks={sideLandmarks}\n   110→            gender={gender || 'male'}\n   111→          />\n   112→        </div>\n   113→      </main>\n   114→    );\n   115→  }\n   116→\n   117→  return null;\n   118→}\n   119→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"25aa9d9f-064a-44b4-bf18-65d72e0fc24c","timestamp":"2025-12-19T21:04:13.758Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/analysis/page.tsx","content":"'use client';\n\nimport { useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useUpload } from '@/contexts/UploadContext';\nimport { useGender } from '@/contexts/GenderContext';\nimport { LandmarkAnalysisTool } from '@/components/LandmarkAnalysisTool';\nimport { ResultsDashboard } from '@/components/ResultsDashboard';\nimport { LandmarkPoint } from '@/lib/landmarks';\n\ntype AnalysisStep = 'front' | 'side' | 'results';\n\nexport default function AnalysisPage() {\n  const router = useRouter();\n  const { frontPhoto, sidePhoto } = useUpload();\n  const { gender } = useGender();\n  const [currentStep, setCurrentStep] = useState<AnalysisStep>('front');\n  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>([]);\n  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>([]);\n\n  // Redirect if no photos uploaded\n  if (!frontPhoto && !sidePhoto) {\n    return (\n      <main className=\"min-h-screen bg-black flex flex-col items-center justify-center px-4\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-semibold text-white mb-4\">No Photos Found</h1>\n          <p className=\"text-neutral-400 mb-8\">\n            Please upload your photos first to begin the analysis.\n          </p>\n          <button\n            onClick={() => router.push('/upload')}\n            className=\"h-12 px-8 rounded-xl bg-[#00f3ff] text-black font-medium hover:shadow-[0_0_20px_rgba(0,243,255,0.3)] transition-all\"\n          >\n            Go to Upload\n          </button>\n        </div>\n      </main>\n    );\n  }\n\n  const handleFrontComplete = (landmarks: LandmarkPoint[]) => {\n    setFrontLandmarks(landmarks);\n    if (sidePhoto) {\n      setCurrentStep('side');\n    } else {\n      setCurrentStep('results');\n    }\n  };\n\n  const handleSideComplete = (landmarks: LandmarkPoint[]) => {\n    setSideLandmarks(landmarks);\n    setCurrentStep('results');\n  };\n\n  const handleBackFromFront = () => {\n    router.push('/upload');\n  };\n\n  const handleBackFromSide = () => {\n    setCurrentStep('front');\n  };\n\n  const handleBackFromResults = () => {\n    setCurrentStep(sidePhoto ? 'side' : 'front');\n  };\n\n  // Front Profile Analysis\n  if (currentStep === 'front' && frontPhoto) {\n    return (\n      <LandmarkAnalysisTool\n        imageUrl={frontPhoto.preview}\n        mode=\"front\"\n        onLandmarksChange={setFrontLandmarks}\n        onComplete={handleFrontComplete}\n        onBack={handleBackFromFront}\n      />\n    );\n  }\n\n  // Side Profile Analysis\n  if (currentStep === 'side' && sidePhoto) {\n    return (\n      <LandmarkAnalysisTool\n        imageUrl={sidePhoto.preview}\n        mode=\"side\"\n        onLandmarksChange={setSideLandmarks}\n        onComplete={handleSideComplete}\n        onBack={handleBackFromSide}\n      />\n    );\n  }\n\n  // Results Dashboard\n  if (currentStep === 'results') {\n    return (\n      <main className=\"min-h-screen bg-black\">\n        <div className=\"max-w-6xl mx-auto px-4 py-8\">\n          <button\n            onClick={handleBackFromResults}\n            className=\"flex items-center gap-2 text-neutral-400 hover:text-white transition-colors text-sm mb-6\"\n          >\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n            </svg>\n            Back to Analysis\n          </button>\n          <ResultsDashboard\n            frontLandmarks={frontLandmarks}\n            sideLandmarks={sideLandmarks}\n            gender={gender || 'male'}\n          />\n        </div>\n      </main>\n    );\n  }\n\n  return null;\n}\n","numLines":119,"startLine":1,"totalLines":119}}}
{"parentUuid":"25aa9d9f-064a-44b4-bf18-65d72e0fc24c","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01M2KzpTdUCHSrmVY1coaqWj","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/EthnicityContext.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/UploadContext.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/GenderContext.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/ethnicity/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/analysis/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/gender/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/layout.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/login/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/upload/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/GuidedLandmarkPlacement.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/SideProfileManualTool.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/BellCurveChart.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/LandmarkDot.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/HeroBackground.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/ResultsDashboard.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/HeadScene.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/FrontProfileLandmarks.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/LandmarkAnalysisTool.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/Providers.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useFaceApi.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useZoomPan.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useContainerBounds.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useAutoDetection.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useFaceLandmarker.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarkImages.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/mediapipeDetection.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceDetectionService.ts","is_error":false}]},"uuid":"8b2b9387-dbd0-423b-aa47-976e1fd2ea61","timestamp":"2025-12-19T21:04:13.829Z","toolUseResult":{"stdout":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/EthnicityContext.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/UploadContext.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/GenderContext.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/ethnicity/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/analysis/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/gender/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/layout.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/login/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/upload/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/GuidedLandmarkPlacement.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/SideProfileManualTool.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/BellCurveChart.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/LandmarkDot.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/HeroBackground.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/ResultsDashboard.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/HeadScene.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/FrontProfileLandmarks.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/LandmarkAnalysisTool.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/Providers.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useFaceApi.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useZoomPan.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useContainerBounds.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useAutoDetection.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useFaceLandmarker.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarkImages.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/mediapipeDetection.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceDetectionService.ts","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"8b2b9387-dbd0-423b-aa47-976e1fd2ea61","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Ya8WbmijVTMF7BuJfSbS4i","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarkImages.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceDetectionService.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/mediapipeDetection.ts"}]},"uuid":"6fac3182-8246-48a6-81d4-326feaa9e973","timestamp":"2025-12-19T21:04:14.144Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarkImages.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceDetectionService.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/mediapipeDetection.ts"],"durationMs":391,"numFiles":5,"truncated":false}}
{"parentUuid":"6fac3182-8246-48a6-81d4-326feaa9e973","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_0163B6NwxiEdgcfnKKnDaqvM","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect! Now let me examine the key calculation files:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":4789,"cache_read_input_tokens":17084,"cache_creation":{"ephemeral_5m_input_tokens":4789,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWGiwnLzv4P4PoQFYqe7x","type":"assistant","uuid":"621df381-e510-4d27-8224-972ea4364473","timestamp":"2025-12-19T21:04:15.161Z"}
{"parentUuid":"621df381-e510-4d27-8224-972ea4364473","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_0163B6NwxiEdgcfnKKnDaqvM","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0116yhEvNww6RVBAA1VCHj2m","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":4789,"cache_read_input_tokens":17084,"cache_creation":{"ephemeral_5m_input_tokens":4789,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWGiwnLzv4P4PoQFYqe7x","type":"assistant","uuid":"3cc9a213-775e-4e12-bd99-351f015b809f","timestamp":"2025-12-19T21:04:15.407Z"}
{"parentUuid":"3cc9a213-775e-4e12-bd99-351f015b809f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_0163B6NwxiEdgcfnKKnDaqvM","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MmHSyvTjtRSVKsiSKBN937","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":4789,"cache_read_input_tokens":17084,"cache_creation":{"ephemeral_5m_input_tokens":4789,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWGiwnLzv4P4PoQFYqe7x","type":"assistant","uuid":"92f72570-7220-436d-8209-bbff138eed52","timestamp":"2025-12-19T21:04:15.619Z"}
{"parentUuid":"92f72570-7220-436d-8209-bbff138eed52","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_0163B6NwxiEdgcfnKKnDaqvM","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0125o1u7WrDpG3kvCxR8K5zP","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/ResultsDashboard.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":4789,"cache_read_input_tokens":17084,"cache_creation":{"ephemeral_5m_input_tokens":4789,"ephemeral_1h_input_tokens":0},"output_tokens":218,"service_tier":"standard"}},"requestId":"req_011CWGiwnLzv4P4PoQFYqe7x","type":"assistant","uuid":"14517376-e74e-476a-881e-da1377a842c8","timestamp":"2025-12-19T21:04:15.888Z"}
{"parentUuid":"14517376-e74e-476a-881e-da1377a842c8","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0125o1u7WrDpG3kvCxR8K5zP","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useMemo } from 'react';\n     4→import { motion } from 'framer-motion';\n     5→import {\n     6→  TrendingUp,\n     7→  TrendingDown,\n     8→  Minus,\n     9→  Star,\n    10→  Target,\n    11→  Activity,\n    12→  Sparkles,\n    13→} from 'lucide-react';\n    14→import { LandmarkPoint } from '@/lib/landmarks';\n    15→import {\n    16→  comprehensiveFrontAnalysis,\n    17→  comprehensiveSideAnalysis,\n    18→  generateMeasurementBellCurve,\n    19→  BellCurveData,\n    20→} from '@/lib/scoring';\n    21→import {\n    22→  BellCurveChart,\n    23→  HarmonyScoreDisplay,\n    24→} from './BellCurveChart';\n    25→\n    26→interface ResultsDashboardProps {\n    27→  frontLandmarks: LandmarkPoint[];\n    28→  sideLandmarks: LandmarkPoint[];\n    29→  gender: 'male' | 'female';\n    30→}\n    31→\n    32→interface MeasurementCardProps {\n    33→  title: string;\n    34→  value: number;\n    35→  unit: string;\n    36→  score: number;\n    37→  idealRange: { min: number; max: number };\n    38→  description: string;\n    39→  rating: 'excellent' | 'good' | 'average' | 'below_average';\n    40→}\n    41→\n    42→function MeasurementCard({\n    43→  title,\n    44→  value,\n    45→  unit,\n    46→  score,\n    47→  idealRange,\n    48→  description,\n    49→  rating,\n    50→}: MeasurementCardProps) {\n    51→  const ratingConfig = {\n    52→    excellent: { color: '#10b981', label: 'Excellent', icon: Star },\n    53→    good: { color: '#0891b2', label: 'Good', icon: TrendingUp },\n    54→    average: { color: '#eab308', label: 'Average', icon: Minus },\n    55→    below_average: { color: '#f97316', label: 'Below Avg', icon: TrendingDown },\n    56→  };\n    57→\n    58→  const config = ratingConfig[rating];\n    59→  const Icon = config.icon;\n    60→\n    61→  const isInRange = value >= idealRange.min && value <= idealRange.max;\n    62→\n    63→  return (\n    64→    <motion.div\n    65→      initial={{ opacity: 0, y: 10 }}\n    66→      animate={{ opacity: 1, y: 0 }}\n    67→      className=\"bg-black rounded-xl border border-neutral-800 p-4 hover:border-neutral-700 transition-colors\"\n    68→    >\n    69→      <div className=\"flex items-start justify-between mb-3\">\n    70→        <div>\n    71→          <h4 className=\"text-sm font-semibold text-white\">{title}</h4>\n    72→          <p className=\"text-xs text-neutral-500 mt-0.5\">{description}</p>\n    73→        </div>\n    74→        <div\n    75→          className=\"flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium\"\n    76→          style={{\n    77→            backgroundColor: `${config.color}15`,\n    78→            color: config.color,\n    79→          }}\n    80→        >\n    81→          <Icon className=\"w-3 h-3\" />\n    82→          {config.label}\n    83→        </div>\n    84→      </div>\n    85→\n    86→      <div className=\"flex items-end justify-between\">\n    87→        <div>\n    88→          <span className=\"text-2xl font-bold text-white\">\n    89→            {typeof value === 'number' ? value.toFixed(2) : value}\n    90→          </span>\n    91→          <span className=\"text-sm text-neutral-500 ml-1\">{unit}</span>\n    92→        </div>\n    93→        <div className=\"text-right\">\n    94→          <div className=\"text-xs text-neutral-500 mb-1\">\n    95→            Ideal: {idealRange.min.toFixed(1)} - {idealRange.max.toFixed(1)}\n    96→          </div>\n    97→          <div\n    98→            className=\"text-xs font-medium\"\n    99→            style={{ color: isInRange ? '#10b981' : '#f97316' }}\n   100→          >\n   101→            {isInRange ? 'In Range' : value < idealRange.min ? 'Below Ideal' : 'Above Ideal'}\n   102→          </div>\n   103→        </div>\n   104→      </div>\n   105→\n   106→      {/* Score bar */}\n   107→      <div className=\"mt-3 h-1.5 bg-neutral-800 rounded-full overflow-hidden\">\n   108→        <motion.div\n   109→          className=\"h-full rounded-full\"\n   110→          style={{ backgroundColor: config.color }}\n   111→          initial={{ width: 0 }}\n   112→          animate={{ width: `${Math.min(score, 100)}%` }}\n   113→          transition={{ duration: 0.8 }}\n   114→        />\n   115→      </div>\n   116→      <div className=\"mt-1 text-right\">\n   117→        <span className=\"text-xs font-medium\" style={{ color: config.color }}>\n   118→          Score: {score.toFixed(0)}/100\n   119→        </span>\n   120→      </div>\n   121→    </motion.div>\n   122→  );\n   123→}\n   124→\n   125→interface StrengthWeaknessProps {\n   126→  strengths: Array<{ name: string; score: number; description: string }>;\n   127→  improvements: Array<{ name: string; score: number; suggestion: string }>;\n   128→}\n   129→\n   130→function StrengthsWeaknesses({ strengths, improvements }: StrengthWeaknessProps) {\n   131→  return (\n   132→    <div className=\"grid md:grid-cols-2 gap-6\">\n   133→      {/* Strengths */}\n   134→      <motion.div\n   135→        initial={{ opacity: 0, x: -20 }}\n   136→        animate={{ opacity: 1, x: 0 }}\n   137→        className=\"bg-black rounded-xl border border-neutral-800 p-5\"\n   138→      >\n   139→        <div className=\"flex items-center gap-2 mb-4\">\n   140→          <div className=\"p-2 rounded-lg bg-green-500/20\">\n   141→            <Sparkles className=\"w-5 h-5 text-green-400\" />\n   142→          </div>\n   143→          <h3 className=\"text-lg font-semibold text-white\">Your Strengths</h3>\n   144→        </div>\n   145→        <div className=\"space-y-3\">\n   146→          {strengths.map((strength, index) => (\n   147→            <div\n   148→              key={index}\n   149→              className=\"flex items-start gap-3 p-3 rounded-lg bg-green-500/10 border border-green-500/20\"\n   150→            >\n   151→              <div className=\"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0\">\n   152→                <span className=\"text-sm font-bold text-green-400\">\n   153→                  {strength.score.toFixed(0)}\n   154→                </span>\n   155→              </div>\n   156→              <div>\n   157→                <p className=\"text-sm font-medium text-white\">{strength.name}</p>\n   158→                <p className=\"text-xs text-neutral-400 mt-0.5\">\n   159→                  {strength.description}\n   160→                </p>\n   161→              </div>\n   162→            </div>\n   163→          ))}\n   164→        </div>\n   165→      </motion.div>\n   166→\n   167→      {/* Areas for Improvement */}\n   168→      <motion.div\n   169→        initial={{ opacity: 0, x: 20 }}\n   170→        animate={{ opacity: 1, x: 0 }}\n   171→        className=\"bg-black rounded-xl border border-neutral-800 p-5\"\n   172→      >\n   173→        <div className=\"flex items-center gap-2 mb-4\">\n   174→          <div className=\"p-2 rounded-lg bg-amber-500/20\">\n   175→            <Target className=\"w-5 h-5 text-amber-400\" />\n   176→          </div>\n   177→          <h3 className=\"text-lg font-semibold text-white\">Areas for Improvement</h3>\n   178→        </div>\n   179→        <div className=\"space-y-3\">\n   180→          {improvements.map((item, index) => (\n   181→            <div\n   182→              key={index}\n   183→              className=\"flex items-start gap-3 p-3 rounded-lg bg-amber-500/10 border border-amber-500/20\"\n   184→            >\n   185→              <div className=\"w-8 h-8 rounded-full bg-amber-500/20 flex items-center justify-center flex-shrink-0\">\n   186→                <span className=\"text-sm font-bold text-amber-400\">\n   187→                  {item.score.toFixed(0)}\n   188→                </span>\n   189→              </div>\n   190→              <div>\n   191→                <p className=\"text-sm font-medium text-white\">{item.name}</p>\n   192→                <p className=\"text-xs text-neutral-400 mt-0.5\">{item.suggestion}</p>\n   193→              </div>\n   194→            </div>\n   195→          ))}\n   196→        </div>\n   197→      </motion.div>\n   198→    </div>\n   199→  );\n   200→}\n   201→\n   202→export function ResultsDashboard({\n   203→  frontLandmarks,\n   204→  sideLandmarks,\n   205→  gender,\n   206→}: ResultsDashboardProps) {\n   207→  // Calculate all analyses\n   208→  const frontAnalysis = useMemo(() => {\n   209→    if (frontLandmarks.length === 0) return null;\n   210→    return comprehensiveFrontAnalysis(frontLandmarks, gender);\n   211→  }, [frontLandmarks, gender]);\n   212→\n   213→  const sideAnalysis = useMemo(() => {\n   214→    if (sideLandmarks.length === 0) return null;\n   215→    return comprehensiveSideAnalysis(sideLandmarks, gender);\n   216→  }, [sideLandmarks, gender]);\n   217→\n   218→  // Calculate overall harmony score\n   219→  const harmonyScore = useMemo(() => {\n   220→    const scores: number[] = [];\n   221→    if (frontAnalysis) scores.push(frontAnalysis.harmonyScore);\n   222→    if (sideAnalysis) scores.push(sideAnalysis.harmonyScore);\n   223→    return scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;\n   224→  }, [frontAnalysis, sideAnalysis]);\n   225→\n   226→  // Collect all individual scores\n   227→  const allScores = useMemo(() => {\n   228→    const scores: Record<string, number> = {};\n   229→\n   230→    if (frontAnalysis) {\n   231→      if (frontAnalysis.fwhr) scores.fwhr = frontAnalysis.fwhr.score;\n   232→      if (frontAnalysis.leftCanthalTilt) scores.canthalTilt = frontAnalysis.leftCanthalTilt.score;\n   233→      if (frontAnalysis.facialThirds) scores.facialThirds = frontAnalysis.facialThirds.overall.score;\n   234→      if (frontAnalysis.nasalIndex) scores.nasalIndex = frontAnalysis.nasalIndex.score;\n   235→      if (frontAnalysis.mouthNoseRatio) scores.mouthNoseRatio = frontAnalysis.mouthNoseRatio.score;\n   236→      if (frontAnalysis.jawRatio) scores.jawRatio = frontAnalysis.jawRatio.score;\n   237→    }\n   238→\n   239→    if (sideAnalysis) {\n   240→      if (sideAnalysis.gonialAngle) scores.gonialAngle = sideAnalysis.gonialAngle.score;\n   241→      if (sideAnalysis.nasolabialAngle) scores.nasolabialAngle = sideAnalysis.nasolabialAngle.score;\n   242→      if (sideAnalysis.eLine) scores.eLine = sideAnalysis.eLine.combined.score;\n   243→      if (sideAnalysis.mentolabialAngle) scores.mentolabialAngle = sideAnalysis.mentolabialAngle.score;\n   244→      if (sideAnalysis.nasofrontalAngle) scores.nasofrontalAngle = sideAnalysis.nasofrontalAngle.score;\n   245→    }\n   246→\n   247→    return scores;\n   248→  }, [frontAnalysis, sideAnalysis]);\n   249→\n   250→  // Generate bell curve data for key measurements\n   251→  const bellCurveData = useMemo(() => {\n   252→    const data: Array<{ key: string; title: string; data: BellCurveData; unit?: string }> = [];\n   253→\n   254→    if (frontAnalysis?.fwhr) {\n   255→      const bellData = generateMeasurementBellCurve('fwhr', frontAnalysis.fwhr.value, gender);\n   256→      if (bellData) {\n   257→        data.push({ key: 'fwhr', title: 'Face Width-to-Height Ratio', data: bellData });\n   258→      }\n   259→    }\n   260→\n   261→    if (frontAnalysis?.leftCanthalTilt) {\n   262→      const bellData = generateMeasurementBellCurve('canthalTilt', frontAnalysis.leftCanthalTilt.value, gender);\n   263→      if (bellData) {\n   264→        data.push({ key: 'canthalTilt', title: 'Canthal Tilt', data: bellData, unit: '°' });\n   265→      }\n   266→    }\n   267→\n   268→    return data;\n   269→  }, [frontAnalysis, gender]);\n   270→\n   271→  // Determine strengths and weaknesses\n   272→  const { strengths, improvements } = useMemo(() => {\n   273→    const allResults: Array<{ name: string; score: number; description: string; suggestion: string }> = [];\n   274→\n   275→    const measurementDescriptions: Record<string, { name: string; desc: string; suggestion: string }> = {\n   276→      fwhr: {\n   277→        name: 'Facial Width-to-Height Ratio',\n   278→        desc: 'Your face has good proportional width relative to height',\n   279→        suggestion: 'Consider facial exercises to enhance jaw definition'\n   280→      },\n   281→      canthalTilt: {\n   282→        name: 'Eye Canthal Tilt',\n   283→        desc: 'Your eyes have an attractive upward tilt',\n   284→        suggestion: 'Eye-lifting treatments or makeup techniques can enhance tilt'\n   285→      },\n   286→      facialThirds: {\n   287→        name: 'Facial Thirds Balance',\n   288→        desc: 'Your face has well-balanced vertical proportions',\n   289→        suggestion: 'Hairstyle adjustments can help balance facial thirds'\n   290→      },\n   291→      nasalIndex: {\n   292→        name: 'Nasal Proportions',\n   293→        desc: 'Your nose width-to-height ratio is harmonious',\n   294→        suggestion: 'Contouring can create the illusion of different proportions'\n   295→      },\n   296→      gonialAngle: {\n   297→        name: 'Jaw Angle',\n   298→        desc: 'Your jaw has an attractive angular definition',\n   299→        suggestion: 'Jaw exercises or mewing can help define the gonial angle'\n   300→      },\n   301→      nasolabialAngle: {\n   302→        name: 'Nose-Lip Angle',\n   303→        desc: 'The angle between your nose and lip is well-balanced',\n   304→        suggestion: 'Nose profile can be enhanced with non-surgical treatments'\n   305→      },\n   306→      eLine: {\n   307→        name: 'E-Line Profile',\n   308→        desc: 'Your lip position relative to nose-chin line is ideal',\n   309→        suggestion: 'Lip fillers or chin augmentation can improve E-line balance'\n   310→      },\n   311→      mouthNoseRatio: {\n   312→        name: 'Mouth-to-Nose Ratio',\n   313→        desc: 'Your mouth width is proportional to your nose',\n   314→        suggestion: 'Lip treatments can adjust the perceived ratio'\n   315→      },\n   316→      jawRatio: {\n   317→        name: 'Jaw-to-Face Width',\n   318→        desc: 'Your jaw width is proportional to your face',\n   319→        suggestion: 'Jaw slimming or enhancement can adjust this ratio'\n   320→      },\n   321→    };\n   322→\n   323→    Object.entries(allScores).forEach(([key, score]) => {\n   324→      const info = measurementDescriptions[key];\n   325→      if (info) {\n   326→        allResults.push({\n   327→          name: info.name,\n   328→          score,\n   329→          description: info.desc,\n   330→          suggestion: info.suggestion,\n   331→        });\n   332→      }\n   333→    });\n   334→\n   335→    // Sort by score\n   336→    allResults.sort((a, b) => b.score - a.score);\n   337→\n   338→    // Top 3 are strengths, bottom 3 are improvements\n   339→    const strengths = allResults.slice(0, 3).map(r => ({\n   340→      name: r.name,\n   341→      score: r.score,\n   342→      description: r.description,\n   343→    }));\n   344→\n   345→    const improvements = allResults.slice(-3).reverse().map(r => ({\n   346→      name: r.name,\n   347→      score: r.score,\n   348→      suggestion: r.suggestion,\n   349→    }));\n   350→\n   351→    return { strengths, improvements };\n   352→  }, [allScores]);\n   353→\n   354→  if (!frontAnalysis && !sideAnalysis) {\n   355→    return (\n   356→      <div className=\"text-center py-12\">\n   357→        <Activity className=\"w-12 h-12 text-neutral-600 mx-auto mb-4\" />\n   358→        <p className=\"text-neutral-400\">No analysis data available</p>\n   359→      </div>\n   360→    );\n   361→  }\n   362→\n   363→  return (\n   364→    <div className=\"space-y-8\">\n   365→      {/* Hero Score Section */}\n   366→      <motion.div\n   367→        initial={{ opacity: 0, y: 20 }}\n   368→        animate={{ opacity: 1, y: 0 }}\n   369→        className=\"text-center\"\n   370→      >\n   371→        <h2 className=\"text-2xl font-bold text-white mb-2\">Your Analysis Results</h2>\n   372→        <p className=\"text-neutral-400 mb-8\">\n   373→          Based on {frontLandmarks.length + sideLandmarks.length} facial landmarks\n   374→        </p>\n   375→\n   376→        {/* Main Harmony Score Display */}\n   377→        <HarmonyScoreDisplay\n   378→          harmonyScore={harmonyScore}\n   379→          individualScores={allScores}\n   380→        />\n   381→      </motion.div>\n   382→\n   383→      {/* Strengths & Weaknesses */}\n   384→      {strengths.length > 0 && improvements.length > 0 && (\n   385→        <StrengthsWeaknesses strengths={strengths} improvements={improvements} />\n   386→      )}\n   387→\n   388→      {/* Front Profile Measurements */}\n   389→      {frontAnalysis && (\n   390→        <motion.div\n   391→          initial={{ opacity: 0, y: 20 }}\n   392→          animate={{ opacity: 1, y: 0 }}\n   393→        >\n   394→          <div className=\"flex items-center gap-2 mb-4\">\n   395→            <h3 className=\"text-lg font-semibold text-white\">Front Profile Analysis</h3>\n   396→            <span className=\"px-2 py-0.5 rounded-full bg-neutral-800 text-neutral-300 text-xs\">\n   397→              {frontLandmarks.length} landmarks\n   398→            </span>\n   399→          </div>\n   400→\n   401→          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n   402→            {frontAnalysis.fwhr && (\n   403→              <MeasurementCard\n   404→                title=\"FWHR\"\n   405→                value={frontAnalysis.fwhr.value}\n   406→                unit=\"ratio\"\n   407→                score={frontAnalysis.fwhr.score}\n   408→                idealRange={frontAnalysis.fwhr.idealRange}\n   409→                description=\"Facial Width-to-Height Ratio\"\n   410→                rating={frontAnalysis.fwhr.rating}\n   411→              />\n   412→            )}\n   413→\n   414→            {frontAnalysis.facialThirds && (\n   415→              <MeasurementCard\n   416→                title=\"Facial Thirds\"\n   417→                value={frontAnalysis.facialThirds.overall.value}\n   418→                unit=\"% deviation\"\n   419→                score={frontAnalysis.facialThirds.overall.score}\n   420→                idealRange={frontAnalysis.facialThirds.overall.idealRange}\n   421→                description=\"Vertical face proportion balance\"\n   422→                rating={frontAnalysis.facialThirds.overall.rating}\n   423→              />\n   424→            )}\n   425→\n   426→            {frontAnalysis.leftCanthalTilt && (\n   427→              <MeasurementCard\n   428→                title=\"Canthal Tilt\"\n   429→                value={frontAnalysis.leftCanthalTilt.value}\n   430→                unit=\"°\"\n   431→                score={frontAnalysis.leftCanthalTilt.score}\n   432→                idealRange={frontAnalysis.leftCanthalTilt.idealRange}\n   433→                description=\"Eye angle from inner to outer corner\"\n   434→                rating={frontAnalysis.leftCanthalTilt.rating}\n   435→              />\n   436→            )}\n   437→\n   438→            {frontAnalysis.nasalIndex && (\n   439→              <MeasurementCard\n   440→                title=\"Nasal Index\"\n   441→                value={frontAnalysis.nasalIndex.value}\n   442→                unit=\"%\"\n   443→                score={frontAnalysis.nasalIndex.score}\n   444→                idealRange={frontAnalysis.nasalIndex.idealRange}\n   445→                description=\"Nose width to height ratio\"\n   446→                rating={frontAnalysis.nasalIndex.rating}\n   447→              />\n   448→            )}\n   449→\n   450→            {frontAnalysis.mouthNoseRatio && (\n   451→              <MeasurementCard\n   452→                title=\"Mouth-Nose Ratio\"\n   453→                value={frontAnalysis.mouthNoseRatio.value}\n   454→                unit=\"ratio\"\n   455→                score={frontAnalysis.mouthNoseRatio.score}\n   456→                idealRange={frontAnalysis.mouthNoseRatio.idealRange}\n   457→                description=\"Mouth width relative to nose\"\n   458→                rating={frontAnalysis.mouthNoseRatio.rating}\n   459→              />\n   460→            )}\n   461→\n   462→            {frontAnalysis.jawRatio && (\n   463→              <MeasurementCard\n   464→                title=\"Jaw-Face Ratio\"\n   465→                value={frontAnalysis.jawRatio.value}\n   466→                unit=\"ratio\"\n   467→                score={frontAnalysis.jawRatio.score}\n   468→                idealRange={frontAnalysis.jawRatio.idealRange}\n   469→                description=\"Jaw width to face width\"\n   470→                rating={frontAnalysis.jawRatio.rating}\n   471→              />\n   472→            )}\n   473→          </div>\n   474→        </motion.div>\n   475→      )}\n   476→\n   477→      {/* Side Profile Measurements */}\n   478→      {sideAnalysis && (\n   479→        <motion.div\n   480→          initial={{ opacity: 0, y: 20 }}\n   481→          animate={{ opacity: 1, y: 0 }}\n   482→        >\n   483→          <div className=\"flex items-center gap-2 mb-4\">\n   484→            <h3 className=\"text-lg font-semibold text-white\">Side Profile Analysis</h3>\n   485→            <span className=\"px-2 py-0.5 rounded-full bg-neutral-800 text-neutral-300 text-xs\">\n   486→              {sideLandmarks.length} landmarks\n   487→            </span>\n   488→          </div>\n   489→\n   490→          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n   491→            {sideAnalysis.gonialAngle && (\n   492→              <MeasurementCard\n   493→                title=\"Gonial Angle\"\n   494→                value={sideAnalysis.gonialAngle.value}\n   495→                unit=\"°\"\n   496→                score={sideAnalysis.gonialAngle.score}\n   497→                idealRange={sideAnalysis.gonialAngle.idealRange}\n   498→                description=\"Jaw angle measurement\"\n   499→                rating={sideAnalysis.gonialAngle.rating}\n   500→              />\n   501→            )}\n   502→\n   503→            {sideAnalysis.nasolabialAngle && (\n   504→              <MeasurementCard\n   505→                title=\"Nasolabial Angle\"\n   506→                value={sideAnalysis.nasolabialAngle.value}\n   507→                unit=\"°\"\n   508→                score={sideAnalysis.nasolabialAngle.score}\n   509→                idealRange={sideAnalysis.nasolabialAngle.idealRange}\n   510→                description=\"Nose to upper lip angle\"\n   511→                rating={sideAnalysis.nasolabialAngle.rating}\n   512→              />\n   513→            )}\n   514→\n   515→            {sideAnalysis.eLine && (\n   516→              <MeasurementCard\n   517→                title=\"E-Line (Ricketts)\"\n   518→                value={sideAnalysis.eLine.combined.value}\n   519→                unit=\"mm\"\n   520→                score={sideAnalysis.eLine.combined.score}\n   521→                idealRange={sideAnalysis.eLine.combined.idealRange}\n   522→                description=\"Lip position relative to nose-chin line\"\n   523→                rating={sideAnalysis.eLine.combined.rating}\n   524→              />\n   525→            )}\n   526→\n   527→            {sideAnalysis.mentolabialAngle && (\n   528→              <MeasurementCard\n   529→                title=\"Mentolabial Angle\"\n   530→                value={sideAnalysis.mentolabialAngle.value}\n   531→                unit=\"°\"\n   532→                score={sideAnalysis.mentolabialAngle.score}\n   533→                idealRange={sideAnalysis.mentolabialAngle.idealRange}\n   534→                description=\"Chin-lip fold depth\"\n   535→                rating={sideAnalysis.mentolabialAngle.rating}\n   536→              />\n   537→            )}\n   538→\n   539→            {sideAnalysis.nasofrontalAngle && (\n   540→              <MeasurementCard\n   541→                title=\"Nasofrontal Angle\"\n   542→                value={sideAnalysis.nasofrontalAngle.value}\n   543→                unit=\"°\"\n   544→                score={sideAnalysis.nasofrontalAngle.score}\n   545→                idealRange={sideAnalysis.nasofrontalAngle.idealRange}\n   546→                description=\"Forehead to nose bridge angle\"\n   547→                rating={sideAnalysis.nasofrontalAngle.rating}\n   548→              />\n   549→            )}\n   550→          </div>\n   551→        </motion.div>\n   552→      )}\n   553→\n   554→      {/* Bell Curve Charts */}\n   555→      {bellCurveData.length > 0 && (\n   556→        <motion.div\n   557→          initial={{ opacity: 0, y: 20 }}\n   558→          animate={{ opacity: 1, y: 0 }}\n   559→        >\n   560→          <h3 className=\"text-lg font-semibold text-white mb-4\">\n   561→            Population Comparison\n   562→          </h3>\n   563→          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n   564→            {bellCurveData.map((item) => (\n   565→              <BellCurveChart\n   566→                key={item.key}\n   567→                data={item.data}\n   568→                title={item.title}\n   569→                unit={item.unit}\n   570→                height={180}\n   571→              />\n   572→            ))}\n   573→          </div>\n   574→        </motion.div>\n   575→      )}\n   576→\n   577→      {/* Detailed Facial Thirds Breakdown */}\n   578→      {frontAnalysis?.facialThirds && (\n   579→        <motion.div\n   580→          initial={{ opacity: 0, y: 20 }}\n   581→          animate={{ opacity: 1, y: 0 }}\n   582→          className=\"bg-black rounded-xl border border-neutral-800 p-5\"\n   583→        >\n   584→          <h3 className=\"text-lg font-semibold text-white mb-4\">\n   585→            Facial Thirds Breakdown\n   586→          </h3>\n   587→          <div className=\"grid grid-cols-3 gap-4\">\n   588→            <div className=\"text-center\">\n   589→              <div className=\"h-20 bg-gradient-to-b from-neutral-700 to-transparent rounded-t-lg mb-2 flex items-end justify-center pb-2\">\n   590→                <span className=\"text-2xl font-bold text-white\">\n   591→                  {frontAnalysis.facialThirds.upper.value.toFixed(1)}%\n   592→                </span>\n   593→              </div>\n   594→              <p className=\"text-xs text-neutral-400\">Upper Third</p>\n   595→              <p className=\"text-xs text-neutral-500\">Hairline to Brow</p>\n   596→            </div>\n   597→            <div className=\"text-center\">\n   598→              <div className=\"h-20 bg-gradient-to-b from-[#00f3ff]/30 to-transparent rounded-t-lg mb-2 flex items-end justify-center pb-2\">\n   599→                <span className=\"text-2xl font-bold text-white\">\n   600→                  {frontAnalysis.facialThirds.middle.value.toFixed(1)}%\n   601→                </span>\n   602→              </div>\n   603→              <p className=\"text-xs text-neutral-400\">Middle Third</p>\n   604→              <p className=\"text-xs text-[#00f3ff]\">Brow to Nose Base</p>\n   605→            </div>\n   606→            <div className=\"text-center\">\n   607→              <div className=\"h-20 bg-gradient-to-b from-green-500/30 to-transparent rounded-t-lg mb-2 flex items-end justify-center pb-2\">\n   608→                <span className=\"text-2xl font-bold text-white\">\n   609→                  {frontAnalysis.facialThirds.lower.value.toFixed(1)}%\n   610→                </span>\n   611→              </div>\n   612→              <p className=\"text-xs text-neutral-400\">Lower Third</p>\n   613→              <p className=\"text-xs text-green-400\">Nose Base to Chin</p>\n   614→            </div>\n   615→          </div>\n   616→          <div className=\"mt-4 text-center\">\n   617→            <p className=\"text-sm text-neutral-400\">\n   618→              Ideal distribution: 33.3% each • Your balance score:{' '}\n   619→              <span className=\"text-white font-medium\">\n   620→                {frontAnalysis.facialThirds.overall.score.toFixed(0)}/100\n   621→              </span>\n   622→            </p>\n   623→          </div>\n   624→        </motion.div>\n   625→      )}\n   626→    </div>\n   627→  );\n   628→}\n   629→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"33b8b163-429e-4b66-8c8e-868390d03f7a","timestamp":"2025-12-19T21:04:15.929Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/ResultsDashboard.tsx","content":"'use client';\n\nimport { useMemo } from 'react';\nimport { motion } from 'framer-motion';\nimport {\n  TrendingUp,\n  TrendingDown,\n  Minus,\n  Star,\n  Target,\n  Activity,\n  Sparkles,\n} from 'lucide-react';\nimport { LandmarkPoint } from '@/lib/landmarks';\nimport {\n  comprehensiveFrontAnalysis,\n  comprehensiveSideAnalysis,\n  generateMeasurementBellCurve,\n  BellCurveData,\n} from '@/lib/scoring';\nimport {\n  BellCurveChart,\n  HarmonyScoreDisplay,\n} from './BellCurveChart';\n\ninterface ResultsDashboardProps {\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  gender: 'male' | 'female';\n}\n\ninterface MeasurementCardProps {\n  title: string;\n  value: number;\n  unit: string;\n  score: number;\n  idealRange: { min: number; max: number };\n  description: string;\n  rating: 'excellent' | 'good' | 'average' | 'below_average';\n}\n\nfunction MeasurementCard({\n  title,\n  value,\n  unit,\n  score,\n  idealRange,\n  description,\n  rating,\n}: MeasurementCardProps) {\n  const ratingConfig = {\n    excellent: { color: '#10b981', label: 'Excellent', icon: Star },\n    good: { color: '#0891b2', label: 'Good', icon: TrendingUp },\n    average: { color: '#eab308', label: 'Average', icon: Minus },\n    below_average: { color: '#f97316', label: 'Below Avg', icon: TrendingDown },\n  };\n\n  const config = ratingConfig[rating];\n  const Icon = config.icon;\n\n  const isInRange = value >= idealRange.min && value <= idealRange.max;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"bg-black rounded-xl border border-neutral-800 p-4 hover:border-neutral-700 transition-colors\"\n    >\n      <div className=\"flex items-start justify-between mb-3\">\n        <div>\n          <h4 className=\"text-sm font-semibold text-white\">{title}</h4>\n          <p className=\"text-xs text-neutral-500 mt-0.5\">{description}</p>\n        </div>\n        <div\n          className=\"flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium\"\n          style={{\n            backgroundColor: `${config.color}15`,\n            color: config.color,\n          }}\n        >\n          <Icon className=\"w-3 h-3\" />\n          {config.label}\n        </div>\n      </div>\n\n      <div className=\"flex items-end justify-between\">\n        <div>\n          <span className=\"text-2xl font-bold text-white\">\n            {typeof value === 'number' ? value.toFixed(2) : value}\n          </span>\n          <span className=\"text-sm text-neutral-500 ml-1\">{unit}</span>\n        </div>\n        <div className=\"text-right\">\n          <div className=\"text-xs text-neutral-500 mb-1\">\n            Ideal: {idealRange.min.toFixed(1)} - {idealRange.max.toFixed(1)}\n          </div>\n          <div\n            className=\"text-xs font-medium\"\n            style={{ color: isInRange ? '#10b981' : '#f97316' }}\n          >\n            {isInRange ? 'In Range' : value < idealRange.min ? 'Below Ideal' : 'Above Ideal'}\n          </div>\n        </div>\n      </div>\n\n      {/* Score bar */}\n      <div className=\"mt-3 h-1.5 bg-neutral-800 rounded-full overflow-hidden\">\n        <motion.div\n          className=\"h-full rounded-full\"\n          style={{ backgroundColor: config.color }}\n          initial={{ width: 0 }}\n          animate={{ width: `${Math.min(score, 100)}%` }}\n          transition={{ duration: 0.8 }}\n        />\n      </div>\n      <div className=\"mt-1 text-right\">\n        <span className=\"text-xs font-medium\" style={{ color: config.color }}>\n          Score: {score.toFixed(0)}/100\n        </span>\n      </div>\n    </motion.div>\n  );\n}\n\ninterface StrengthWeaknessProps {\n  strengths: Array<{ name: string; score: number; description: string }>;\n  improvements: Array<{ name: string; score: number; suggestion: string }>;\n}\n\nfunction StrengthsWeaknesses({ strengths, improvements }: StrengthWeaknessProps) {\n  return (\n    <div className=\"grid md:grid-cols-2 gap-6\">\n      {/* Strengths */}\n      <motion.div\n        initial={{ opacity: 0, x: -20 }}\n        animate={{ opacity: 1, x: 0 }}\n        className=\"bg-black rounded-xl border border-neutral-800 p-5\"\n      >\n        <div className=\"flex items-center gap-2 mb-4\">\n          <div className=\"p-2 rounded-lg bg-green-500/20\">\n            <Sparkles className=\"w-5 h-5 text-green-400\" />\n          </div>\n          <h3 className=\"text-lg font-semibold text-white\">Your Strengths</h3>\n        </div>\n        <div className=\"space-y-3\">\n          {strengths.map((strength, index) => (\n            <div\n              key={index}\n              className=\"flex items-start gap-3 p-3 rounded-lg bg-green-500/10 border border-green-500/20\"\n            >\n              <div className=\"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0\">\n                <span className=\"text-sm font-bold text-green-400\">\n                  {strength.score.toFixed(0)}\n                </span>\n              </div>\n              <div>\n                <p className=\"text-sm font-medium text-white\">{strength.name}</p>\n                <p className=\"text-xs text-neutral-400 mt-0.5\">\n                  {strength.description}\n                </p>\n              </div>\n            </div>\n          ))}\n        </div>\n      </motion.div>\n\n      {/* Areas for Improvement */}\n      <motion.div\n        initial={{ opacity: 0, x: 20 }}\n        animate={{ opacity: 1, x: 0 }}\n        className=\"bg-black rounded-xl border border-neutral-800 p-5\"\n      >\n        <div className=\"flex items-center gap-2 mb-4\">\n          <div className=\"p-2 rounded-lg bg-amber-500/20\">\n            <Target className=\"w-5 h-5 text-amber-400\" />\n          </div>\n          <h3 className=\"text-lg font-semibold text-white\">Areas for Improvement</h3>\n        </div>\n        <div className=\"space-y-3\">\n          {improvements.map((item, index) => (\n            <div\n              key={index}\n              className=\"flex items-start gap-3 p-3 rounded-lg bg-amber-500/10 border border-amber-500/20\"\n            >\n              <div className=\"w-8 h-8 rounded-full bg-amber-500/20 flex items-center justify-center flex-shrink-0\">\n                <span className=\"text-sm font-bold text-amber-400\">\n                  {item.score.toFixed(0)}\n                </span>\n              </div>\n              <div>\n                <p className=\"text-sm font-medium text-white\">{item.name}</p>\n                <p className=\"text-xs text-neutral-400 mt-0.5\">{item.suggestion}</p>\n              </div>\n            </div>\n          ))}\n        </div>\n      </motion.div>\n    </div>\n  );\n}\n\nexport function ResultsDashboard({\n  frontLandmarks,\n  sideLandmarks,\n  gender,\n}: ResultsDashboardProps) {\n  // Calculate all analyses\n  const frontAnalysis = useMemo(() => {\n    if (frontLandmarks.length === 0) return null;\n    return comprehensiveFrontAnalysis(frontLandmarks, gender);\n  }, [frontLandmarks, gender]);\n\n  const sideAnalysis = useMemo(() => {\n    if (sideLandmarks.length === 0) return null;\n    return comprehensiveSideAnalysis(sideLandmarks, gender);\n  }, [sideLandmarks, gender]);\n\n  // Calculate overall harmony score\n  const harmonyScore = useMemo(() => {\n    const scores: number[] = [];\n    if (frontAnalysis) scores.push(frontAnalysis.harmonyScore);\n    if (sideAnalysis) scores.push(sideAnalysis.harmonyScore);\n    return scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;\n  }, [frontAnalysis, sideAnalysis]);\n\n  // Collect all individual scores\n  const allScores = useMemo(() => {\n    const scores: Record<string, number> = {};\n\n    if (frontAnalysis) {\n      if (frontAnalysis.fwhr) scores.fwhr = frontAnalysis.fwhr.score;\n      if (frontAnalysis.leftCanthalTilt) scores.canthalTilt = frontAnalysis.leftCanthalTilt.score;\n      if (frontAnalysis.facialThirds) scores.facialThirds = frontAnalysis.facialThirds.overall.score;\n      if (frontAnalysis.nasalIndex) scores.nasalIndex = frontAnalysis.nasalIndex.score;\n      if (frontAnalysis.mouthNoseRatio) scores.mouthNoseRatio = frontAnalysis.mouthNoseRatio.score;\n      if (frontAnalysis.jawRatio) scores.jawRatio = frontAnalysis.jawRatio.score;\n    }\n\n    if (sideAnalysis) {\n      if (sideAnalysis.gonialAngle) scores.gonialAngle = sideAnalysis.gonialAngle.score;\n      if (sideAnalysis.nasolabialAngle) scores.nasolabialAngle = sideAnalysis.nasolabialAngle.score;\n      if (sideAnalysis.eLine) scores.eLine = sideAnalysis.eLine.combined.score;\n      if (sideAnalysis.mentolabialAngle) scores.mentolabialAngle = sideAnalysis.mentolabialAngle.score;\n      if (sideAnalysis.nasofrontalAngle) scores.nasofrontalAngle = sideAnalysis.nasofrontalAngle.score;\n    }\n\n    return scores;\n  }, [frontAnalysis, sideAnalysis]);\n\n  // Generate bell curve data for key measurements\n  const bellCurveData = useMemo(() => {\n    const data: Array<{ key: string; title: string; data: BellCurveData; unit?: string }> = [];\n\n    if (frontAnalysis?.fwhr) {\n      const bellData = generateMeasurementBellCurve('fwhr', frontAnalysis.fwhr.value, gender);\n      if (bellData) {\n        data.push({ key: 'fwhr', title: 'Face Width-to-Height Ratio', data: bellData });\n      }\n    }\n\n    if (frontAnalysis?.leftCanthalTilt) {\n      const bellData = generateMeasurementBellCurve('canthalTilt', frontAnalysis.leftCanthalTilt.value, gender);\n      if (bellData) {\n        data.push({ key: 'canthalTilt', title: 'Canthal Tilt', data: bellData, unit: '°' });\n      }\n    }\n\n    return data;\n  }, [frontAnalysis, gender]);\n\n  // Determine strengths and weaknesses\n  const { strengths, improvements } = useMemo(() => {\n    const allResults: Array<{ name: string; score: number; description: string; suggestion: string }> = [];\n\n    const measurementDescriptions: Record<string, { name: string; desc: string; suggestion: string }> = {\n      fwhr: {\n        name: 'Facial Width-to-Height Ratio',\n        desc: 'Your face has good proportional width relative to height',\n        suggestion: 'Consider facial exercises to enhance jaw definition'\n      },\n      canthalTilt: {\n        name: 'Eye Canthal Tilt',\n        desc: 'Your eyes have an attractive upward tilt',\n        suggestion: 'Eye-lifting treatments or makeup techniques can enhance tilt'\n      },\n      facialThirds: {\n        name: 'Facial Thirds Balance',\n        desc: 'Your face has well-balanced vertical proportions',\n        suggestion: 'Hairstyle adjustments can help balance facial thirds'\n      },\n      nasalIndex: {\n        name: 'Nasal Proportions',\n        desc: 'Your nose width-to-height ratio is harmonious',\n        suggestion: 'Contouring can create the illusion of different proportions'\n      },\n      gonialAngle: {\n        name: 'Jaw Angle',\n        desc: 'Your jaw has an attractive angular definition',\n        suggestion: 'Jaw exercises or mewing can help define the gonial angle'\n      },\n      nasolabialAngle: {\n        name: 'Nose-Lip Angle',\n        desc: 'The angle between your nose and lip is well-balanced',\n        suggestion: 'Nose profile can be enhanced with non-surgical treatments'\n      },\n      eLine: {\n        name: 'E-Line Profile',\n        desc: 'Your lip position relative to nose-chin line is ideal',\n        suggestion: 'Lip fillers or chin augmentation can improve E-line balance'\n      },\n      mouthNoseRatio: {\n        name: 'Mouth-to-Nose Ratio',\n        desc: 'Your mouth width is proportional to your nose',\n        suggestion: 'Lip treatments can adjust the perceived ratio'\n      },\n      jawRatio: {\n        name: 'Jaw-to-Face Width',\n        desc: 'Your jaw width is proportional to your face',\n        suggestion: 'Jaw slimming or enhancement can adjust this ratio'\n      },\n    };\n\n    Object.entries(allScores).forEach(([key, score]) => {\n      const info = measurementDescriptions[key];\n      if (info) {\n        allResults.push({\n          name: info.name,\n          score,\n          description: info.desc,\n          suggestion: info.suggestion,\n        });\n      }\n    });\n\n    // Sort by score\n    allResults.sort((a, b) => b.score - a.score);\n\n    // Top 3 are strengths, bottom 3 are improvements\n    const strengths = allResults.slice(0, 3).map(r => ({\n      name: r.name,\n      score: r.score,\n      description: r.description,\n    }));\n\n    const improvements = allResults.slice(-3).reverse().map(r => ({\n      name: r.name,\n      score: r.score,\n      suggestion: r.suggestion,\n    }));\n\n    return { strengths, improvements };\n  }, [allScores]);\n\n  if (!frontAnalysis && !sideAnalysis) {\n    return (\n      <div className=\"text-center py-12\">\n        <Activity className=\"w-12 h-12 text-neutral-600 mx-auto mb-4\" />\n        <p className=\"text-neutral-400\">No analysis data available</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-8\">\n      {/* Hero Score Section */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"text-center\"\n      >\n        <h2 className=\"text-2xl font-bold text-white mb-2\">Your Analysis Results</h2>\n        <p className=\"text-neutral-400 mb-8\">\n          Based on {frontLandmarks.length + sideLandmarks.length} facial landmarks\n        </p>\n\n        {/* Main Harmony Score Display */}\n        <HarmonyScoreDisplay\n          harmonyScore={harmonyScore}\n          individualScores={allScores}\n        />\n      </motion.div>\n\n      {/* Strengths & Weaknesses */}\n      {strengths.length > 0 && improvements.length > 0 && (\n        <StrengthsWeaknesses strengths={strengths} improvements={improvements} />\n      )}\n\n      {/* Front Profile Measurements */}\n      {frontAnalysis && (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n        >\n          <div className=\"flex items-center gap-2 mb-4\">\n            <h3 className=\"text-lg font-semibold text-white\">Front Profile Analysis</h3>\n            <span className=\"px-2 py-0.5 rounded-full bg-neutral-800 text-neutral-300 text-xs\">\n              {frontLandmarks.length} landmarks\n            </span>\n          </div>\n\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {frontAnalysis.fwhr && (\n              <MeasurementCard\n                title=\"FWHR\"\n                value={frontAnalysis.fwhr.value}\n                unit=\"ratio\"\n                score={frontAnalysis.fwhr.score}\n                idealRange={frontAnalysis.fwhr.idealRange}\n                description=\"Facial Width-to-Height Ratio\"\n                rating={frontAnalysis.fwhr.rating}\n              />\n            )}\n\n            {frontAnalysis.facialThirds && (\n              <MeasurementCard\n                title=\"Facial Thirds\"\n                value={frontAnalysis.facialThirds.overall.value}\n                unit=\"% deviation\"\n                score={frontAnalysis.facialThirds.overall.score}\n                idealRange={frontAnalysis.facialThirds.overall.idealRange}\n                description=\"Vertical face proportion balance\"\n                rating={frontAnalysis.facialThirds.overall.rating}\n              />\n            )}\n\n            {frontAnalysis.leftCanthalTilt && (\n              <MeasurementCard\n                title=\"Canthal Tilt\"\n                value={frontAnalysis.leftCanthalTilt.value}\n                unit=\"°\"\n                score={frontAnalysis.leftCanthalTilt.score}\n                idealRange={frontAnalysis.leftCanthalTilt.idealRange}\n                description=\"Eye angle from inner to outer corner\"\n                rating={frontAnalysis.leftCanthalTilt.rating}\n              />\n            )}\n\n            {frontAnalysis.nasalIndex && (\n              <MeasurementCard\n                title=\"Nasal Index\"\n                value={frontAnalysis.nasalIndex.value}\n                unit=\"%\"\n                score={frontAnalysis.nasalIndex.score}\n                idealRange={frontAnalysis.nasalIndex.idealRange}\n                description=\"Nose width to height ratio\"\n                rating={frontAnalysis.nasalIndex.rating}\n              />\n            )}\n\n            {frontAnalysis.mouthNoseRatio && (\n              <MeasurementCard\n                title=\"Mouth-Nose Ratio\"\n                value={frontAnalysis.mouthNoseRatio.value}\n                unit=\"ratio\"\n                score={frontAnalysis.mouthNoseRatio.score}\n                idealRange={frontAnalysis.mouthNoseRatio.idealRange}\n                description=\"Mouth width relative to nose\"\n                rating={frontAnalysis.mouthNoseRatio.rating}\n              />\n            )}\n\n            {frontAnalysis.jawRatio && (\n              <MeasurementCard\n                title=\"Jaw-Face Ratio\"\n                value={frontAnalysis.jawRatio.value}\n                unit=\"ratio\"\n                score={frontAnalysis.jawRatio.score}\n                idealRange={frontAnalysis.jawRatio.idealRange}\n                description=\"Jaw width to face width\"\n                rating={frontAnalysis.jawRatio.rating}\n              />\n            )}\n          </div>\n        </motion.div>\n      )}\n\n      {/* Side Profile Measurements */}\n      {sideAnalysis && (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n        >\n          <div className=\"flex items-center gap-2 mb-4\">\n            <h3 className=\"text-lg font-semibold text-white\">Side Profile Analysis</h3>\n            <span className=\"px-2 py-0.5 rounded-full bg-neutral-800 text-neutral-300 text-xs\">\n              {sideLandmarks.length} landmarks\n            </span>\n          </div>\n\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {sideAnalysis.gonialAngle && (\n              <MeasurementCard\n                title=\"Gonial Angle\"\n                value={sideAnalysis.gonialAngle.value}\n                unit=\"°\"\n                score={sideAnalysis.gonialAngle.score}\n                idealRange={sideAnalysis.gonialAngle.idealRange}\n                description=\"Jaw angle measurement\"\n                rating={sideAnalysis.gonialAngle.rating}\n              />\n            )}\n\n            {sideAnalysis.nasolabialAngle && (\n              <MeasurementCard\n                title=\"Nasolabial Angle\"\n                value={sideAnalysis.nasolabialAngle.value}\n                unit=\"°\"\n                score={sideAnalysis.nasolabialAngle.score}\n                idealRange={sideAnalysis.nasolabialAngle.idealRange}\n                description=\"Nose to upper lip angle\"\n                rating={sideAnalysis.nasolabialAngle.rating}\n              />\n            )}\n\n            {sideAnalysis.eLine && (\n              <MeasurementCard\n                title=\"E-Line (Ricketts)\"\n                value={sideAnalysis.eLine.combined.value}\n                unit=\"mm\"\n                score={sideAnalysis.eLine.combined.score}\n                idealRange={sideAnalysis.eLine.combined.idealRange}\n                description=\"Lip position relative to nose-chin line\"\n                rating={sideAnalysis.eLine.combined.rating}\n              />\n            )}\n\n            {sideAnalysis.mentolabialAngle && (\n              <MeasurementCard\n                title=\"Mentolabial Angle\"\n                value={sideAnalysis.mentolabialAngle.value}\n                unit=\"°\"\n                score={sideAnalysis.mentolabialAngle.score}\n                idealRange={sideAnalysis.mentolabialAngle.idealRange}\n                description=\"Chin-lip fold depth\"\n                rating={sideAnalysis.mentolabialAngle.rating}\n              />\n            )}\n\n            {sideAnalysis.nasofrontalAngle && (\n              <MeasurementCard\n                title=\"Nasofrontal Angle\"\n                value={sideAnalysis.nasofrontalAngle.value}\n                unit=\"°\"\n                score={sideAnalysis.nasofrontalAngle.score}\n                idealRange={sideAnalysis.nasofrontalAngle.idealRange}\n                description=\"Forehead to nose bridge angle\"\n                rating={sideAnalysis.nasofrontalAngle.rating}\n              />\n            )}\n          </div>\n        </motion.div>\n      )}\n\n      {/* Bell Curve Charts */}\n      {bellCurveData.length > 0 && (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n        >\n          <h3 className=\"text-lg font-semibold text-white mb-4\">\n            Population Comparison\n          </h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            {bellCurveData.map((item) => (\n              <BellCurveChart\n                key={item.key}\n                data={item.data}\n                title={item.title}\n                unit={item.unit}\n                height={180}\n              />\n            ))}\n          </div>\n        </motion.div>\n      )}\n\n      {/* Detailed Facial Thirds Breakdown */}\n      {frontAnalysis?.facialThirds && (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"bg-black rounded-xl border border-neutral-800 p-5\"\n        >\n          <h3 className=\"text-lg font-semibold text-white mb-4\">\n            Facial Thirds Breakdown\n          </h3>\n          <div className=\"grid grid-cols-3 gap-4\">\n            <div className=\"text-center\">\n              <div className=\"h-20 bg-gradient-to-b from-neutral-700 to-transparent rounded-t-lg mb-2 flex items-end justify-center pb-2\">\n                <span className=\"text-2xl font-bold text-white\">\n                  {frontAnalysis.facialThirds.upper.value.toFixed(1)}%\n                </span>\n              </div>\n              <p className=\"text-xs text-neutral-400\">Upper Third</p>\n              <p className=\"text-xs text-neutral-500\">Hairline to Brow</p>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"h-20 bg-gradient-to-b from-[#00f3ff]/30 to-transparent rounded-t-lg mb-2 flex items-end justify-center pb-2\">\n                <span className=\"text-2xl font-bold text-white\">\n                  {frontAnalysis.facialThirds.middle.value.toFixed(1)}%\n                </span>\n              </div>\n              <p className=\"text-xs text-neutral-400\">Middle Third</p>\n              <p className=\"text-xs text-[#00f3ff]\">Brow to Nose Base</p>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"h-20 bg-gradient-to-b from-green-500/30 to-transparent rounded-t-lg mb-2 flex items-end justify-center pb-2\">\n                <span className=\"text-2xl font-bold text-white\">\n                  {frontAnalysis.facialThirds.lower.value.toFixed(1)}%\n                </span>\n              </div>\n              <p className=\"text-xs text-neutral-400\">Lower Third</p>\n              <p className=\"text-xs text-green-400\">Nose Base to Chin</p>\n            </div>\n          </div>\n          <div className=\"mt-4 text-center\">\n            <p className=\"text-sm text-neutral-400\">\n              Ideal distribution: 33.3% each • Your balance score:{' '}\n              <span className=\"text-white font-medium\">\n                {frontAnalysis.facialThirds.overall.score.toFixed(0)}/100\n              </span>\n            </p>\n          </div>\n        </motion.div>\n      )}\n    </div>\n  );\n}\n","numLines":629,"startLine":1,"totalLines":629}}}
{"parentUuid":"33b8b163-429e-4b66-8c8e-868390d03f7a","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0116yhEvNww6RVBAA1VCHj2m","type":"tool_result","content":"     1→/**\n     2→ * Facial Landmark Types and Default Data\n     3→ * Based on TECHNICAL_SPECS.md medical terminology\n     4→ */\n     5→\n     6→export interface LandmarkPoint {\n     7→  id: string;\n     8→  label: string;\n     9→  medicalTerm: string;\n    10→  description: string;\n    11→  x: number;\n    12→  y: number;\n    13→  category: string;\n    14→}\n    15→\n    16→export interface LandmarkCategory {\n    17→  name: string;\n    18→  color: string;\n    19→  landmarks: string[];\n    20→}\n    21→\n    22→// ============================================\n    23→// FRONT PROFILE LANDMARKS (52 Points)\n    24→// ============================================\n    25→\n    26→export const FRONT_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n    27→  {\n    28→    name: 'Head',\n    29→    color: '#FF6B6B',\n    30→    landmarks: ['trichion'],\n    31→  },\n    32→  {\n    33→    name: 'Eyes - Left',\n    34→    color: '#4ECDC4',\n    35→    landmarks: [\n    36→      'left_pupila',\n    37→      'left_canthus_medialis',\n    38→      'left_canthus_lateralis',\n    39→      'left_palpebra_superior',\n    40→      'left_palpebra_inferior',\n    41→      'left_sulcus_palpebralis_lateralis',\n    42→      'left_pretarsal_skin_crease',\n    43→    ],\n    44→  },\n    45→  {\n    46→    name: 'Eyes - Right',\n    47→    color: '#45B7D1',\n    48→    landmarks: [\n    49→      'right_pupila',\n    50→      'right_canthus_medialis',\n    51→      'right_canthus_lateralis',\n    52→      'right_palpebra_superior',\n    53→      'right_palpebra_inferior',\n    54→      'right_sulcus_palpebralis_lateralis',\n    55→      'right_pretarsal_skin_crease',\n    56→    ],\n    57→  },\n    58→  {\n    59→    name: 'Eyebrows - Left',\n    60→    color: '#96CEB4',\n    61→    landmarks: [\n    62→      'left_supercilium_medialis',\n    63→      'left_supercilium_medial_corner',\n    64→      'left_supercilium_superior',\n    65→      'left_supercilium_apex',\n    66→      'left_supercilium_lateralis',\n    67→    ],\n    68→  },\n    69→  {\n    70→    name: 'Eyebrows - Right',\n    71→    color: '#88D8B0',\n    72→    landmarks: [\n    73→      'right_supercilium_medialis',\n    74→      'right_supercilium_medial_corner',\n    75→      'right_supercilium_superior',\n    76→      'right_supercilium_apex',\n    77→      'right_supercilium_lateralis',\n    78→    ],\n    79→  },\n    80→  {\n    81→    name: 'Nose',\n    82→    color: '#FFEAA7',\n    83→    landmarks: [\n    84→      'nasal_base',\n    85→      'left_dorsum_nasi',\n    86→      'right_dorsum_nasi',\n    87→      'left_ala_nasi',\n    88→      'right_ala_nasi',\n    89→      'subnasale',\n    90→    ],\n    91→  },\n    92→  {\n    93→    name: 'Mouth',\n    94→    color: '#DDA0DD',\n    95→    landmarks: [\n    96→      'labrale_superius',\n    97→      'cupids_bow',\n    98→      'mouth_middle',\n    99→      'labrale_inferius',\n   100→      'left_cheilion',\n   101→      'right_cheilion',\n   102→    ],\n   103→  },\n   104→  {\n   105→    name: 'Jaw',\n   106→    color: '#F39C12',\n   107→    landmarks: [\n   108→      'left_gonion_superior',\n   109→      'right_gonion_superior',\n   110→      'left_gonion_inferior',\n   111→      'right_gonion_inferior',\n   112→    ],\n   113→  },\n   114→  {\n   115→    name: 'Chin',\n   116→    color: '#E74C3C',\n   117→    landmarks: ['left_mentum_lateralis', 'right_mentum_lateralis', 'menton'],\n   118→  },\n   119→  {\n   120→    name: 'Face Width',\n   121→    color: '#9B59B6',\n   122→    landmarks: [\n   123→      'left_zygion',\n   124→      'right_zygion',\n   125→      'left_temporal',\n   126→      'right_temporal',\n   127→      'left_auricular_lateral',\n   128→      'right_auricular_lateral',\n   129→    ],\n   130→  },\n   131→  {\n   132→    name: 'Neck',\n   133→    color: '#1ABC9C',\n   134→    landmarks: ['left_cervical_lateralis', 'right_cervical_lateralis'],\n   135→  },\n   136→];\n   137→\n   138→export const FRONT_PROFILE_LANDMARKS: LandmarkPoint[] = [\n   139→  // Head/Hair\n   140→  {\n   141→    id: 'trichion',\n   142→    label: 'Hairline',\n   143→    medicalTerm: 'Trichion (frontal view)',\n   144→    description: 'Anterior hairline at midline',\n   145→    x: 0.5,\n   146→    y: 0.08,\n   147→    category: 'Head',\n   148→  },\n   149→\n   150→  // Eyes - Left\n   151→  {\n   152→    id: 'left_pupila',\n   153→    label: 'Left Pupil',\n   154→    medicalTerm: 'Left Pupila',\n   155→    description: 'Center of left pupil',\n   156→    x: 0.38,\n   157→    y: 0.35,\n   158→    category: 'Eyes - Left',\n   159→  },\n   160→  {\n   161→    id: 'left_canthus_medialis',\n   162→    label: 'Left Medial Canthus',\n   163→    medicalTerm: 'Left Canthus Medialis',\n   164→    description: 'Inner corner of left eye',\n   165→    x: 0.42,\n   166→    y: 0.35,\n   167→    category: 'Eyes - Left',\n   168→  },\n   169→  {\n   170→    id: 'left_canthus_lateralis',\n   171→    label: 'Left Lateral Canthus',\n   172→    medicalTerm: 'Left Canthus Lateralis',\n   173→    description: 'Outer corner of left eye',\n   174→    x: 0.32,\n   175→    y: 0.34,\n   176→    category: 'Eyes - Left',\n   177→  },\n   178→  {\n   179→    id: 'left_palpebra_superior',\n   180→    label: 'Left Upper Eyelid',\n   181→    medicalTerm: 'Left Palpebra Superior',\n   182→    description: 'Upper eyelid of left eye',\n   183→    x: 0.37,\n   184→    y: 0.33,\n   185→    category: 'Eyes - Left',\n   186→  },\n   187→  {\n   188→    id: 'left_palpebra_inferior',\n   189→    label: 'Left Lower Eyelid',\n   190→    medicalTerm: 'Left Palpebra Inferior',\n   191→    description: 'Lower eyelid of left eye',\n   192→    x: 0.37,\n   193→    y: 0.37,\n   194→    category: 'Eyes - Left',\n   195→  },\n   196→  {\n   197→    id: 'left_sulcus_palpebralis_lateralis',\n   198→    label: 'Left Eyelid Hood End',\n   199→    medicalTerm: 'Left Sulcus Palpebralis Lateralis',\n   200→    description: 'Lateral end of left upper eyelid crease',\n   201→    x: 0.31,\n   202→    y: 0.33,\n   203→    category: 'Eyes - Left',\n   204→  },\n   205→  {\n   206→    id: 'left_pretarsal_skin_crease',\n   207→    label: 'Left Upper Eyelid Crease',\n   208→    medicalTerm: 'Left Pretarsal Skin Crease',\n   209→    description: 'Left upper eyelid crease',\n   210→    x: 0.37,\n   211→    y: 0.32,\n   212→    category: 'Eyes - Left',\n   213→  },\n   214→\n   215→  // Eyes - Right\n   216→  {\n   217→    id: 'right_pupila',\n   218→    label: 'Right Pupil',\n   219→    medicalTerm: 'Right Pupila',\n   220→    description: 'Center of right pupil',\n   221→    x: 0.62,\n   222→    y: 0.35,\n   223→    category: 'Eyes - Right',\n   224→  },\n   225→  {\n   226→    id: 'right_canthus_medialis',\n   227→    label: 'Right Medial Canthus',\n   228→    medicalTerm: 'Right Canthus Medialis',\n   229→    description: 'Inner corner of right eye',\n   230→    x: 0.58,\n   231→    y: 0.35,\n   232→    category: 'Eyes - Right',\n   233→  },\n   234→  {\n   235→    id: 'right_canthus_lateralis',\n   236→    label: 'Right Lateral Canthus',\n   237→    medicalTerm: 'Right Canthus Lateralis',\n   238→    description: 'Outer corner of right eye',\n   239→    x: 0.68,\n   240→    y: 0.34,\n   241→    category: 'Eyes - Right',\n   242→  },\n   243→  {\n   244→    id: 'right_palpebra_superior',\n   245→    label: 'Right Upper Eyelid',\n   246→    medicalTerm: 'Right Palpebra Superior',\n   247→    description: 'Upper eyelid of right eye',\n   248→    x: 0.63,\n   249→    y: 0.33,\n   250→    category: 'Eyes - Right',\n   251→  },\n   252→  {\n   253→    id: 'right_palpebra_inferior',\n   254→    label: 'Right Lower Eyelid',\n   255→    medicalTerm: 'Right Palpebra Inferior',\n   256→    description: 'Lower eyelid of right eye',\n   257→    x: 0.63,\n   258→    y: 0.37,\n   259→    category: 'Eyes - Right',\n   260→  },\n   261→  {\n   262→    id: 'right_sulcus_palpebralis_lateralis',\n   263→    label: 'Right Eyelid Hood End',\n   264→    medicalTerm: 'Right Sulcus Palpebralis Lateralis',\n   265→    description: 'Lateral end of right upper eyelid crease',\n   266→    x: 0.69,\n   267→    y: 0.33,\n   268→    category: 'Eyes - Right',\n   269→  },\n   270→  {\n   271→    id: 'right_pretarsal_skin_crease',\n   272→    label: 'Right Upper Eyelid Crease',\n   273→    medicalTerm: 'Right Pretarsal Skin Crease',\n   274→    description: 'Right upper eyelid crease',\n   275→    x: 0.63,\n   276→    y: 0.32,\n   277→    category: 'Eyes - Right',\n   278→  },\n   279→\n   280→  // Eyebrows - Left\n   281→  {\n   282→    id: 'left_supercilium_medialis',\n   283→    label: 'Left Brow Head',\n   284→    medicalTerm: 'Left Supercilium Medialis',\n   285→    description: 'Medial start of left eyebrow',\n   286→    x: 0.43,\n   287→    y: 0.28,\n   288→    category: 'Eyebrows - Left',\n   289→  },\n   290→  {\n   291→    id: 'left_supercilium_medial_corner',\n   292→    label: 'Left Brow Inner Corner',\n   293→    medicalTerm: 'Left Supercilium Medial Corner',\n   294→    description: 'Inner corner of left eyebrow',\n   295→    x: 0.41,\n   296→    y: 0.27,\n   297→    category: 'Eyebrows - Left',\n   298→  },\n   299→  {\n   300→    id: 'left_supercilium_superior',\n   301→    label: 'Left Brow Arch',\n   302→    medicalTerm: 'Left Supercilium Superior',\n   303→    description: 'Superior arc of left eyebrow',\n   304→    x: 0.36,\n   305→    y: 0.26,\n   306→    category: 'Eyebrows - Left',\n   307→  },\n   308→  {\n   309→    id: 'left_supercilium_apex',\n   310→    label: 'Left Brow Peak',\n   311→    medicalTerm: 'Left Supercilium Apex',\n   312→    description: 'Highest point of left eyebrow',\n   313→    x: 0.34,\n   314→    y: 0.26,\n   315→    category: 'Eyebrows - Left',\n   316→  },\n   317→  {\n   318→    id: 'left_supercilium_lateralis',\n   319→    label: 'Left Brow Tail',\n   320→    medicalTerm: 'Left Supercilium Lateralis',\n   321→    description: 'Lateral end of left eyebrow',\n   322→    x: 0.29,\n   323→    y: 0.28,\n   324→    category: 'Eyebrows - Left',\n   325→  },\n   326→\n   327→  // Eyebrows - Right\n   328→  {\n   329→    id: 'right_supercilium_medialis',\n   330→    label: 'Right Brow Head',\n   331→    medicalTerm: 'Right Supercilium Medialis',\n   332→    description: 'Medial start of right eyebrow',\n   333→    x: 0.57,\n   334→    y: 0.28,\n   335→    category: 'Eyebrows - Right',\n   336→  },\n   337→  {\n   338→    id: 'right_supercilium_medial_corner',\n   339→    label: 'Right Brow Inner Corner',\n   340→    medicalTerm: 'Right Supercilium Medial Corner',\n   341→    description: 'Inner corner of right eyebrow',\n   342→    x: 0.59,\n   343→    y: 0.27,\n   344→    category: 'Eyebrows - Right',\n   345→  },\n   346→  {\n   347→    id: 'right_supercilium_superior',\n   348→    label: 'Right Brow Arch',\n   349→    medicalTerm: 'Right Supercilium Superior',\n   350→    description: 'Superior arc of right eyebrow',\n   351→    x: 0.64,\n   352→    y: 0.26,\n   353→    category: 'Eyebrows - Right',\n   354→  },\n   355→  {\n   356→    id: 'right_supercilium_apex',\n   357→    label: 'Right Brow Peak',\n   358→    medicalTerm: 'Right Supercilium Apex',\n   359→    description: 'Highest point of right eyebrow',\n   360→    x: 0.66,\n   361→    y: 0.26,\n   362→    category: 'Eyebrows - Right',\n   363→  },\n   364→  {\n   365→    id: 'right_supercilium_lateralis',\n   366→    label: 'Right Brow Tail',\n   367→    medicalTerm: 'Right Supercilium Lateralis',\n   368→    description: 'Lateral end of right eyebrow',\n   369→    x: 0.71,\n   370→    y: 0.28,\n   371→    category: 'Eyebrows - Right',\n   372→  },\n   373→\n   374→  // Nose\n   375→  {\n   376→    id: 'nasal_base',\n   377→    label: 'Nasal Base',\n   378→    medicalTerm: 'Nasal Base',\n   379→    description: 'Base of nasal dorsum',\n   380→    x: 0.5,\n   381→    y: 0.38,\n   382→    category: 'Nose',\n   383→  },\n   384→  {\n   385→    id: 'left_dorsum_nasi',\n   386→    label: 'Left Nose Bridge',\n   387→    medicalTerm: 'Left Dorsum Nasi',\n   388→    description: 'Left side of nasal bridge',\n   389→    x: 0.47,\n   390→    y: 0.42,\n   391→    category: 'Nose',\n   392→  },\n   393→  {\n   394→    id: 'right_dorsum_nasi',\n   395→    label: 'Right Nose Bridge',\n   396→    medicalTerm: 'Right Dorsum Nasi',\n   397→    description: 'Right side of nasal bridge',\n   398→    x: 0.53,\n   399→    y: 0.42,\n   400→    category: 'Nose',\n   401→  },\n   402→  {\n   403→    id: 'left_ala_nasi',\n   404→    label: 'Left Nose Side',\n   405→    medicalTerm: 'Left Ala Nasi',\n   406→    description: 'Lateral aspect of left nasal ala',\n   407→    x: 0.44,\n   408→    y: 0.5,\n   409→    category: 'Nose',\n   410→  },\n   411→  {\n   412→    id: 'right_ala_nasi',\n   413→    label: 'Right Nose Side',\n   414→    medicalTerm: 'Right Ala Nasi',\n   415→    description: 'Lateral aspect of right nasal ala',\n   416→    x: 0.56,\n   417→    y: 0.5,\n   418→    category: 'Nose',\n   419→  },\n   420→  {\n   421→    id: 'subnasale',\n   422→    label: 'Nose Bottom',\n   423→    medicalTerm: 'Subnasale',\n   424→    description: 'Junction of columella and upper lip',\n   425→    x: 0.5,\n   426→    y: 0.52,\n   427→    category: 'Nose',\n   428→  },\n   429→\n   430→  // Mouth\n   431→  {\n   432→    id: 'labrale_superius',\n   433→    label: \"Cupid's Bow\",\n   434→    medicalTerm: 'Labrale Superius',\n   435→    description: 'Midpoint of upper lip vermilion',\n   436→    x: 0.5,\n   437→    y: 0.58,\n   438→    category: 'Mouth',\n   439→  },\n   440→  {\n   441→    id: 'cupids_bow',\n   442→    label: \"Inner Cupid's Bow\",\n   443→    medicalTerm: \"Cupid's Bow\",\n   444→    description: 'Central peak of upper lip',\n   445→    x: 0.5,\n   446→    y: 0.57,\n   447→    category: 'Mouth',\n   448→  },\n   449→  {\n   450→    id: 'mouth_middle',\n   451→    label: 'Mouth Middle',\n   452→    medicalTerm: 'Mouth Middle',\n   453→    description: 'Center of mouth opening',\n   454→    x: 0.5,\n   455→    y: 0.62,\n   456→    category: 'Mouth',\n   457→  },\n   458→  {\n   459→    id: 'labrale_inferius',\n   460→    label: 'Lower Lip Center',\n   461→    medicalTerm: 'Labrale Inferius',\n   462→    description: 'Midpoint of lower lip vermilion border',\n   463→    x: 0.5,\n   464→    y: 0.66,\n   465→    category: 'Mouth',\n   466→  },\n   467→  {\n   468→    id: 'left_cheilion',\n   469→    label: 'Left Mouth Corner',\n   470→    medicalTerm: 'Left Cheilion',\n   471→    description: 'Left oral commissure',\n   472→    x: 0.42,\n   473→    y: 0.62,\n   474→    category: 'Mouth',\n   475→  },\n   476→  {\n   477→    id: 'right_cheilion',\n   478→    label: 'Right Mouth Corner',\n   479→    medicalTerm: 'Right Cheilion',\n   480→    description: 'Right oral commissure',\n   481→    x: 0.58,\n   482→    y: 0.62,\n   483→    category: 'Mouth',\n   484→  },\n   485→\n   486→  // Jaw\n   487→  {\n   488→    id: 'left_gonion_superior',\n   489→    label: 'Left Upper Jaw Angle',\n   490→    medicalTerm: 'Left Gonion Superior',\n   491→    description: 'Superior aspect of left mandibular angle',\n   492→    x: 0.22,\n   493→    y: 0.55,\n   494→    category: 'Jaw',\n   495→  },\n   496→  {\n   497→    id: 'right_gonion_superior',\n   498→    label: 'Right Upper Jaw Angle',\n   499→    medicalTerm: 'Right Gonion Superior',\n   500→    description: 'Superior aspect of right mandibular angle',\n   501→    x: 0.78,\n   502→    y: 0.55,\n   503→    category: 'Jaw',\n   504→  },\n   505→  {\n   506→    id: 'left_gonion_inferior',\n   507→    label: 'Left Lower Jaw Angle',\n   508→    medicalTerm: 'Left Gonion Inferior',\n   509→    description: 'Inferior aspect of left mandibular angle',\n   510→    x: 0.24,\n   511→    y: 0.7,\n   512→    category: 'Jaw',\n   513→  },\n   514→  {\n   515→    id: 'right_gonion_inferior',\n   516→    label: 'Right Lower Jaw Angle',\n   517→    medicalTerm: 'Right Gonion Inferior',\n   518→    description: 'Inferior aspect of right mandibular angle',\n   519→    x: 0.76,\n   520→    y: 0.7,\n   521→    category: 'Jaw',\n   522→  },\n   523→\n   524→  // Chin\n   525→  {\n   526→    id: 'left_mentum_lateralis',\n   527→    label: 'Left Chin',\n   528→    medicalTerm: 'Left Mentum Lateralis',\n   529→    description: 'Left lateral chin',\n   530→    x: 0.42,\n   531→    y: 0.8,\n   532→    category: 'Chin',\n   533→  },\n   534→  {\n   535→    id: 'right_mentum_lateralis',\n   536→    label: 'Right Chin',\n   537→    medicalTerm: 'Right Mentum Lateralis',\n   538→    description: 'Right lateral chin',\n   539→    x: 0.58,\n   540→    y: 0.8,\n   541→    category: 'Chin',\n   542→  },\n   543→  {\n   544→    id: 'menton',\n   545→    label: 'Chin Bottom',\n   546→    medicalTerm: 'Menton',\n   547→    description: 'Lowest point of chin in midline',\n   548→    x: 0.5,\n   549→    y: 0.88,\n   550→    category: 'Chin',\n   551→  },\n   552→\n   553→  // Face Width\n   554→  {\n   555→    id: 'left_zygion',\n   556→    label: 'Left Cheekbone',\n   557→    medicalTerm: 'Left Zygion',\n   558→    description: 'Most lateral point of left zygomatic arch',\n   559→    x: 0.18,\n   560→    y: 0.42,\n   561→    category: 'Face Width',\n   562→  },\n   563→  {\n   564→    id: 'right_zygion',\n   565→    label: 'Right Cheekbone',\n   566→    medicalTerm: 'Right Zygion',\n   567→    description: 'Most lateral point of right zygomatic arch',\n   568→    x: 0.82,\n   569→    y: 0.42,\n   570→    category: 'Face Width',\n   571→  },\n   572→  {\n   573→    id: 'left_temporal',\n   574→    label: 'Left Temple',\n   575→    medicalTerm: 'Left Temporal Point',\n   576→    description: 'Left temporal region',\n   577→    x: 0.2,\n   578→    y: 0.3,\n   579→    category: 'Face Width',\n   580→  },\n   581→  {\n   582→    id: 'right_temporal',\n   583→    label: 'Right Temple',\n   584→    medicalTerm: 'Right Temporal Point',\n   585→    description: 'Right temporal region',\n   586→    x: 0.8,\n   587→    y: 0.3,\n   588→    category: 'Face Width',\n   589→  },\n   590→  {\n   591→    id: 'left_auricular_lateral',\n   592→    label: 'Left Outer Ear',\n   593→    medicalTerm: 'Left Auricular Lateral Point',\n   594→    description: 'Lateral-most point of left ear',\n   595→    x: 0.12,\n   596→    y: 0.4,\n   597→    category: 'Face Width',\n   598→  },\n   599→  {\n   600→    id: 'right_auricular_lateral',\n   601→    label: 'Right Outer Ear',\n   602→    medicalTerm: 'Right Auricular Lateral Point',\n   603→    description: 'Lateral-most point of right ear',\n   604→    x: 0.88,\n   605→    y: 0.4,\n   606→    category: 'Face Width',\n   607→  },\n   608→\n   609→  // Neck\n   610→  {\n   611→    id: 'left_cervical_lateralis',\n   612→    label: 'Left Neck Point',\n   613→    medicalTerm: 'Left Cervical Lateralis',\n   614→    description: 'Left cervical point',\n   615→    x: 0.35,\n   616→    y: 0.95,\n   617→    category: 'Neck',\n   618→  },\n   619→  {\n   620→    id: 'right_cervical_lateralis',\n   621→    label: 'Right Neck Point',\n   622→    medicalTerm: 'Right Cervical Lateralis',\n   623→    description: 'Right cervical point',\n   624→    x: 0.65,\n   625→    y: 0.95,\n   626→    category: 'Neck',\n   627→  },\n   628→];\n   629→\n   630→// ============================================\n   631→// SIDE PROFILE LANDMARKS (38 Points)\n   632→// ============================================\n   633→\n   634→export const SIDE_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n   635→  {\n   636→    name: 'Cranium',\n   637→    color: '#FF6B6B',\n   638→    landmarks: ['vertex', 'external_occipital_region', 'trichion_profile'],\n   639→  },\n   640→  {\n   641→    name: 'Forehead',\n   642→    color: '#4ECDC4',\n   643→    landmarks: ['frontalis', 'glabella'],\n   644→  },\n   645→  {\n   646→    name: 'Eye Region',\n   647→    color: '#45B7D1',\n   648→    landmarks: [\n   649→      'corneal_apex',\n   650→      'lateral_eyelid',\n   651→      'palpebra_inferior_side',\n   652→      'orbitale',\n   653→    ],\n   654→  },\n   655→  {\n   656→    name: 'Nose',\n   657→    color: '#FFEAA7',\n   658→    landmarks: [\n   659→      'nasion',\n   660→      'rhinion',\n   661→      'supratip_break',\n   662→      'pronasale',\n   663→      'infratip_lobule',\n   664→      'columella_nasi',\n   665→      'subnasale_side',\n   666→      'subalare',\n   667→    ],\n   668→  },\n   669→  {\n   670→    name: 'Lips',\n   671→    color: '#DDA0DD',\n   672→    landmarks: [\n   673→      'labrale_superius_side',\n   674→      'cheilion_side',\n   675→      'labrale_inferius_side',\n   676→      'sublabiale',\n   677→    ],\n   678→  },\n   679→  {\n   680→    name: 'Chin',\n   681→    color: '#E74C3C',\n   682→    landmarks: ['pogonion', 'menton_side'],\n   683→  },\n   684→  {\n   685→    name: 'Jaw',\n   686→    color: '#F39C12',\n   687→    landmarks: ['gonion_superior_side', 'gonion_inferior_side'],\n   688→  },\n   689→  {\n   690→    name: 'Cheek',\n   691→    color: '#9B59B6',\n   692→    landmarks: ['zygion_soft_tissue'],\n   693→  },\n   694→  {\n   695→    name: 'Ear',\n   696→    color: '#3498DB',\n   697→    landmarks: ['porion', 'tragion', 'incisura_intertragica'],\n   698→  },\n   699→  {\n   700→    name: 'Neck',\n   701→    color: '#1ABC9C',\n   702→    landmarks: ['cervicale', 'anterior_cervical_landmark'],\n   703→  },\n   704→];\n   705→\n   706→export const SIDE_PROFILE_LANDMARKS: LandmarkPoint[] = [\n   707→  // Cranium\n   708→  {\n   709→    id: 'vertex',\n   710→    label: 'Top of Head',\n   711→    medicalTerm: 'Vertex',\n   712→    description: 'Highest point of cranium',\n   713→    x: 0.45,\n   714→    y: 0.02,\n   715→    category: 'Cranium',\n   716→  },\n   717→  {\n   718→    id: 'external_occipital_region',\n   719→    label: 'Occiput',\n   720→    medicalTerm: 'External Occipital Region',\n   721→    description: 'Back of skull',\n   722→    x: 0.85,\n   723→    y: 0.15,\n   724→    category: 'Cranium',\n   725→  },\n   726→  {\n   727→    id: 'trichion_profile',\n   728→    label: 'Hairline (profile)',\n   729→    medicalTerm: 'Trichion',\n   730→    description: 'Anterior hairline (profile view)',\n   731→    x: 0.35,\n   732→    y: 0.1,\n   733→    category: 'Cranium',\n   734→  },\n   735→\n   736→  // Forehead\n   737→  {\n   738→    id: 'frontalis',\n   739→    label: 'Forehead',\n   740→    medicalTerm: 'Frontalis',\n   741→    description: 'Forehead region',\n   742→    x: 0.3,\n   743→    y: 0.18,\n   744→    category: 'Forehead',\n   745→  },\n   746→  {\n   747→    id: 'glabella',\n   748→    label: 'Glabella',\n   749→    medicalTerm: 'Glabella',\n   750→    description: 'Most prominent point between eyebrows',\n   751→    x: 0.32,\n   752→    y: 0.28,\n   753→    category: 'Forehead',\n   754→  },\n   755→\n   756→  // Eye Region\n   757→  {\n   758→    id: 'corneal_apex',\n   759→    label: 'Corneal Apex',\n   760→    medicalTerm: 'Corneal Apex',\n   761→    description: 'Most anterior point of cornea',\n   762→    x: 0.28,\n   763→    y: 0.34,\n   764→    category: 'Eye Region',\n   765→  },\n   766→  {\n   767→    id: 'lateral_eyelid',\n   768→    label: 'Eyelid End',\n   769→    medicalTerm: 'Lateral Eyelid',\n   770→    description: 'Lateral extent of palpebral fissure',\n   771→    x: 0.35,\n   772→    y: 0.34,\n   773→    category: 'Eye Region',\n   774→  },\n   775→  {\n   776→    id: 'palpebra_inferior_side',\n   777→    label: 'Lower Eyelid',\n   778→    medicalTerm: 'Left Palpebra Inferior',\n   779→    description: 'Lower eyelid margin (profile view)',\n   780→    x: 0.3,\n   781→    y: 0.36,\n   782→    category: 'Eye Region',\n   783→  },\n   784→  {\n   785→    id: 'orbitale',\n   786→    label: 'Orbitale',\n   787→    medicalTerm: 'Orbitale',\n   788→    description: 'Lowest point of infraorbital margin',\n   789→    x: 0.35,\n   790→    y: 0.38,\n   791→    category: 'Eye Region',\n   792→  },\n   793→\n   794→  // Nose\n   795→  {\n   796→    id: 'nasion',\n   797→    label: 'Nasal Bridge Front',\n   798→    medicalTerm: 'Nasion',\n   799→    description: 'Deepest point of nasal root',\n   800→    x: 0.35,\n   801→    y: 0.32,\n   802→    category: 'Nose',\n   803→  },\n   804→  {\n   805→    id: 'rhinion',\n   806→    label: 'Rhinion',\n   807→    medicalTerm: 'Rhinion',\n   808→    description: 'Junction of bony and cartilaginous nose',\n   809→    x: 0.28,\n   810→    y: 0.4,\n   811→    category: 'Nose',\n   812→  },\n   813→  {\n   814→    id: 'supratip_break',\n   815→    label: 'Supratip',\n   816→    medicalTerm: 'Supratip Break',\n   817→    description: 'Depression above nasal tip',\n   818→    x: 0.22,\n   819→    y: 0.46,\n   820→    category: 'Nose',\n   821→  },\n   822→  {\n   823→    id: 'pronasale',\n   824→    label: 'Nose Tip',\n   825→    medicalTerm: 'Pronasale',\n   826→    description: 'Most anterior point of nasal tip',\n   827→    x: 0.18,\n   828→    y: 0.48,\n   829→    category: 'Nose',\n   830→  },\n   831→  {\n   832→    id: 'infratip_lobule',\n   833→    label: 'Infratip',\n   834→    medicalTerm: 'Infratip Lobule',\n   835→    description: 'Area below nasal tip',\n   836→    x: 0.2,\n   837→    y: 0.5,\n   838→    category: 'Nose',\n   839→  },\n   840→  {\n   841→    id: 'columella_nasi',\n   842→    label: 'Columella',\n   843→    medicalTerm: 'Columella Nasi',\n   844→    description: 'Fleshy external end of nasal septum',\n   845→    x: 0.24,\n   846→    y: 0.52,\n   847→    category: 'Nose',\n   848→  },\n   849→  {\n   850→    id: 'subnasale_side',\n   851→    label: 'Subnasale',\n   852→    medicalTerm: 'Subnasale',\n   853→    description: 'Junction of columella and upper lip',\n   854→    x: 0.3,\n   855→    y: 0.54,\n   856→    category: 'Nose',\n   857→  },\n   858→  {\n   859→    id: 'subalare',\n   860→    label: 'Subalare',\n   861→    medicalTerm: 'Subalare',\n   862→    description: 'Junction of alar base and upper lip',\n   863→    x: 0.28,\n   864→    y: 0.53,\n   865→    category: 'Nose',\n   866→  },\n   867→\n   868→  // Lips\n   869→  {\n   870→    id: 'labrale_superius_side',\n   871→    label: 'Upper Lip',\n   872→    medicalTerm: 'Labrale Superius',\n   873→    description: 'Upper lip vermilion border',\n   874→    x: 0.28,\n   875→    y: 0.58,\n   876→    category: 'Lips',\n   877→  },\n   878→  {\n   879→    id: 'cheilion_side',\n   880→    label: 'Mouth Corner',\n   881→    medicalTerm: 'Cheilion',\n   882→    description: 'Oral commissure (profile view)',\n   883→    x: 0.35,\n   884→    y: 0.62,\n   885→    category: 'Lips',\n   886→  },\n   887→  {\n   888→    id: 'labrale_inferius_side',\n   889→    label: 'Lower Lip',\n   890→    medicalTerm: 'Labrale Inferius',\n   891→    description: 'Lower lip vermilion border',\n   892→    x: 0.3,\n   893→    y: 0.66,\n   894→    category: 'Lips',\n   895→  },\n   896→  {\n   897→    id: 'sublabiale',\n   898→    label: 'Labiomental Fold',\n   899→    medicalTerm: 'Sublabiale',\n   900→    description: 'Deepest point of labiomental sulcus',\n   901→    x: 0.32,\n   902→    y: 0.7,\n   903→    category: 'Lips',\n   904→  },\n   905→\n   906→  // Chin\n   907→  {\n   908→    id: 'pogonion',\n   909→    label: 'Chin Point',\n   910→    medicalTerm: 'Pogonion (soft tissue)',\n   911→    description: 'Most anterior point of chin',\n   912→    x: 0.3,\n   913→    y: 0.76,\n   914→    category: 'Chin',\n   915→  },\n   916→  {\n   917→    id: 'menton_side',\n   918→    label: 'Chin Bottom',\n   919→    medicalTerm: 'Menton (soft tissue)',\n   920→    description: 'Lowest point of chin',\n   921→    x: 0.35,\n   922→    y: 0.82,\n   923→    category: 'Chin',\n   924→  },\n   925→\n   926→  // Jaw\n   927→  {\n   928→    id: 'gonion_superior_side',\n   929→    label: 'Upper Jaw Angle',\n   930→    medicalTerm: 'Gonion Superior',\n   931→    description: 'Superior mandibular angle',\n   932→    x: 0.7,\n   933→    y: 0.6,\n   934→    category: 'Jaw',\n   935→  },\n   936→  {\n   937→    id: 'gonion_inferior_side',\n   938→    label: 'Lower Jaw Angle',\n   939→    medicalTerm: 'Gonion Inferior',\n   940→    description: 'Inferior mandibular angle',\n   941→    x: 0.65,\n   942→    y: 0.72,\n   943→    category: 'Jaw',\n   944→  },\n   945→\n   946→  // Cheek\n   947→  {\n   948→    id: 'zygion_soft_tissue',\n   949→    label: 'Cheekbone',\n   950→    medicalTerm: 'Zygion (soft tissue over zygoma)',\n   951→    description: 'Soft tissue over zygomatic arch',\n   952→    x: 0.45,\n   953→    y: 0.42,\n   954→    category: 'Cheek',\n   955→  },\n   956→\n   957→  // Ear\n   958→  {\n   959→    id: 'porion',\n   960→    label: 'Porion',\n   961→    medicalTerm: 'Porion (soft tissue)',\n   962→    description: 'Superior aspect of external auditory meatus',\n   963→    x: 0.75,\n   964→    y: 0.35,\n   965→    category: 'Ear',\n   966→  },\n   967→  {\n   968→    id: 'tragion',\n   969→    label: 'Tragus',\n   970→    medicalTerm: 'Tragion (soft tissue)',\n   971→    description: 'Superior margin of tragus',\n   972→    x: 0.72,\n   973→    y: 0.42,\n   974→    category: 'Ear',\n   975→  },\n   976→  {\n   977→    id: 'incisura_intertragica',\n   978→    label: 'Intertragic Notch',\n   979→    medicalTerm: 'Incisura Intertragica',\n   980→    description: 'Notch between tragus and antitragus',\n   981→    x: 0.73,\n   982→    y: 0.45,\n   983→    category: 'Ear',\n   984→  },\n   985→\n   986→  // Neck\n   987→  {\n   988→    id: 'cervicale',\n   989→    label: 'Cervical Point',\n   990→    medicalTerm: 'Cervicale (soft tissue reference)',\n   991→    description: 'Cervical point for profile analysis',\n   992→    x: 0.5,\n   993→    y: 0.9,\n   994→    category: 'Neck',\n   995→  },\n   996→  {\n   997→    id: 'anterior_cervical_landmark',\n   998→    label: 'Neck Point',\n   999→    medicalTerm: 'Anterior Cervical Landmark',\n  1000→    description: 'Anterior neck landmark',\n  1001→    x: 0.4,\n  1002→    y: 0.88,\n  1003→    category: 'Neck',\n  1004→  },\n  1005→];\n  1006→\n  1007→// ============================================\n  1008→// MediaPipe Face Mesh Index Mapping\n  1009→// ============================================\n  1010→// NOTE: MEDIAPIPE_FRONT_MAPPING is defined in mediapipeDetection.ts (single source of truth)\n  1011→// Import from there if needed: import { MEDIAPIPE_FRONT_MAPPING } from './mediapipeDetection';\n  1012→\n  1013→// Helper to get category color for a landmark\n  1014→export function getLandmarkColor(\n  1015→  landmarkId: string,\n  1016→  categories: LandmarkCategory[]\n  1017→): string {\n  1018→  for (const category of categories) {\n  1019→    if (category.landmarks.includes(landmarkId)) {\n  1020→      return category.color;\n  1021→    }\n  1022→  }\n  1023→  return '#00f3ff'; // Default cyan\n  1024→}\n  1025→\n  1026→// ============================================\n  1027→// FaceIQ Side Profile Landmark Indices (106 points)\n  1028→// Reverse-engineered from FaceIQ Labs API\n  1029→// ============================================\n  1030→\n  1031→export const FACEIQ_SIDE_LANDMARKS = {\n  1032→  // Face Contour (0-16) - Jaw/Chin outline\n  1033→  MENTON: 0, // Chin bottom (lowest point)\n  1034→  POGONION: 2, // Chin prominence\n  1035→  GNATHION: 3, // Chin point\n  1036→  MANDIBLE_CONTOUR: [2, 3, 4, 5, 6, 7, 8], // Jaw line\n  1037→\n  1038→  // Posterior Points (1, 9-16) - Ear/Back of head\n  1039→  TRAGION: 1, // Ear point\n  1040→  EAR_CONTOUR: [9, 10, 11, 12, 13, 14, 15, 16],\n  1041→\n  1042→  // Forehead/Hairline (17)\n  1043→  TRICHION: 17, // Hairline\n  1044→\n  1045→  // Nose Profile (18-32)\n  1046→  NASION: 25, // Bridge of nose (deepest point)\n  1047→  PRONASALE: 32, // Nose tip\n  1048→  SUBNASALE: 52, // Base of nose\n  1049→  COLUMELLA: 53, // Nose columella\n  1050→  NOSE_BRIDGE: [25, 26, 27, 28, 29, 30, 31, 32],\n  1051→  NOSE_TIP_CONTOUR: [52, 53, 54, 55, 56, 57, 58, 59, 60],\n  1052→\n  1053→  // Eye Region (33-51)\n  1054→  EYE_LATERAL_CANTHUS: 33, // Outer eye corner\n  1055→  EYE_MEDIAL_CANTHUS: 35, // Inner eye corner\n  1056→  UPPER_EYELID: [37, 38, 39],\n  1057→  LOWER_EYELID: [40, 41, 42],\n  1058→  PUPIL: 34,\n  1059→  BROW_HEAD: 44, // Inner brow\n  1060→  BROW_ARCH: 45, // Brow peak\n  1061→  BROW_TAIL: 46, // Outer brow\n  1062→\n  1063→  // Lip Region (52-75)\n  1064→  LABRALE_SUPERIUS: 63, // Upper lip top\n  1065→  LABRALE_INFERIUS: 66, // Lower lip bottom\n  1066→  STOMION: 65, // Lip meeting point\n  1067→  UPPER_LIP_CONTOUR: [63, 64, 65],\n  1068→  LOWER_LIP_CONTOUR: [66, 67, 68],\n  1069→\n  1070→  // Additional Profile Points (76-105)\n  1071→  GLABELLA: 76, // Between eyebrows\n  1072→  SELLION: 77, // Deepest point of nasal bridge\n  1073→  SOFT_TISSUE_NASION: 78,\n  1074→  ORBITALE: 79, // Lowest point of eye socket\n  1075→  GONION: 85, // Jaw angle\n  1076→  CONDYLION: 86, // Top of jaw joint\n  1077→};\n  1078→\n  1079→// ============================================\n  1080→// FaceIQ Front Face Landmark Indices (MediaPipe 478 points)\n  1081→// ============================================\n  1082→\n  1083→export const FACEIQ_FRONT_LANDMARKS = {\n  1084→  // Key points from MediaPipe Face Mesh\n  1085→  NOSE_TIP: 1,\n  1086→  LEFT_EYE_INNER: 133,\n  1087→  LEFT_EYE_OUTER: 33,\n  1088→  RIGHT_EYE_INNER: 362,\n  1089→  RIGHT_EYE_OUTER: 263,\n  1090→  LEFT_CHEEK: 234,\n  1091→  RIGHT_CHEEK: 454,\n  1092→  UPPER_LIP: 13,\n  1093→  LOWER_LIP: 14,\n  1094→  CHIN: 152,\n  1095→  FOREHEAD: 10,\n  1096→  LEFT_EAR: 234,\n  1097→  RIGHT_EAR: 454,\n  1098→  LEFT_BROW_INNER: 107,\n  1099→  LEFT_BROW_OUTER: 70,\n  1100→  RIGHT_BROW_INNER: 336,\n  1101→  RIGHT_BROW_OUTER: 300,\n  1102→  NOSE_BRIDGE: 6,\n  1103→  LEFT_NOSTRIL: 129,\n  1104→  RIGHT_NOSTRIL: 358,\n  1105→};\n  1106→\n  1107→// ============================================\n  1108→// Scoring Configuration Types\n  1109→// ============================================\n  1110→\n  1111→export interface ScoringConfig {\n  1112→  idealValue: number;\n  1113→  standardDeviation: number;\n  1114→  minScore: number;\n  1115→  maxScore: number;\n  1116→  weight: number;\n  1117→}\n  1118→\n  1119→export interface GenderSpecificValues {\n  1120→  male: { ideal: number; range: [number, number] };\n  1121→  female: { ideal: number; range: [number, number] };\n  1122→}\n  1123→\n  1124→// ============================================\n  1125→// FaceIQ Ideal Values (Gender-Specific)\n  1126→// ============================================\n  1127→\n  1128→export const FACEIQ_IDEAL_VALUES: Record<string, GenderSpecificValues> = {\n  1129→  fwhr: {\n  1130→    male: { ideal: 1.9, range: [1.8, 2.1] },\n  1131→    female: { ideal: 1.75, range: [1.6, 1.9] },\n  1132→  },\n  1133→  canthalTilt: {\n  1134→    male: { ideal: 4, range: [2, 7] },\n  1135→    female: { ideal: 6, range: [4, 10] },\n  1136→  },\n  1137→  nasolabialAngle: {\n  1138→    male: { ideal: 95, range: [90, 100] },\n  1139→    female: { ideal: 105, range: [100, 115] },\n  1140→  },\n  1141→  gonialAngle: {\n  1142→    male: { ideal: 125, range: [120, 130] },\n  1143→    female: { ideal: 128, range: [125, 135] },\n  1144→  },\n  1145→  nasalIndex: {\n  1146→    male: { ideal: 0.7, range: [0.65, 0.75] },\n  1147→    female: { ideal: 0.65, range: [0.6, 0.7] },\n  1148→  },\n  1149→  lipRatio: {\n  1150→    male: { ideal: 0.5, range: [0.4, 0.6] },\n  1151→    female: { ideal: 0.5, range: [0.45, 0.55] },\n  1152→  },\n  1153→  facialConvexity: {\n  1154→    male: { ideal: 170, range: [165, 175] },\n  1155→    female: { ideal: 168, range: [163, 173] },\n  1156→  },\n  1157→  chinProjection: {\n  1158→    male: { ideal: 0, range: [-3, 3] },\n  1159→    female: { ideal: -2, range: [-5, 1] },\n  1160→  },\n  1161→};\n  1162→\n  1163→// ============================================\n  1164→// FaceIQ Scoring Configurations\n  1165→// ============================================\n  1166→\n  1167→export const FACEIQ_SCORING_CONFIGS: Record<string, ScoringConfig> = {\n  1168→  fwhr: {\n  1169→    idealValue: 1.9,\n  1170→    standardDeviation: 0.15,\n  1171→    minScore: 0,\n  1172→    maxScore: 100,\n  1173→    weight: 0.15,\n  1174→  },\n  1175→  canthalTilt: {\n  1176→    idealValue: 6,\n  1177→    standardDeviation: 3,\n  1178→    minScore: 0,\n  1179→    maxScore: 100,\n  1180→    weight: 0.1,\n  1181→  },\n  1182→  facialThirds: {\n  1183→    idealValue: 33.33,\n  1184→    standardDeviation: 3,\n  1185→    minScore: 0,\n  1186→    maxScore: 100,\n  1187→    weight: 0.1,\n  1188→  },\n  1189→  nasolabialAngle: {\n  1190→    idealValue: 102,\n  1191→    standardDeviation: 8,\n  1192→    minScore: 0,\n  1193→    maxScore: 100,\n  1194→    weight: 0.08,\n  1195→  },\n  1196→  gonialAngle: {\n  1197→    idealValue: 125,\n  1198→    standardDeviation: 5,\n  1199→    minScore: 0,\n  1200→    maxScore: 100,\n  1201→    weight: 0.08,\n  1202→  },\n  1203→  overallSymmetry: {\n  1204→    idealValue: 100,\n  1205→    standardDeviation: 5,\n  1206→    minScore: 0,\n  1207→    maxScore: 100,\n  1208→    weight: 0.15,\n  1209→  },\n  1210→  goldenRatio: {\n  1211→    idealValue: 1.618,\n  1212→    standardDeviation: 0.1,\n  1213→    minScore: 0,\n  1214→    maxScore: 100,\n  1215→    weight: 0.12,\n  1216→  },\n  1217→  nasalIndex: {\n  1218→    idealValue: 0.7,\n  1219→    standardDeviation: 0.08,\n  1220→    minScore: 0,\n  1221→    maxScore: 100,\n  1222→    weight: 0.06,\n  1223→  },\n  1224→  lipRatio: {\n  1225→    idealValue: 0.5,\n  1226→    standardDeviation: 0.1,\n  1227→    minScore: 0,\n  1228→    maxScore: 100,\n  1229→    weight: 0.06,\n  1230→  },\n  1231→  chinProjection: {\n  1232→    idealValue: 0,\n  1233→    standardDeviation: 3,\n  1234→    minScore: 0,\n  1235→    maxScore: 100,\n  1236→    weight: 0.05,\n  1237→  },\n  1238→  noseProjection: {\n  1239→    idealValue: 0.67,\n  1240→    standardDeviation: 0.05,\n  1241→    minScore: 0,\n  1242→    maxScore: 100,\n  1243→    weight: 0.05,\n  1244→  },\n  1245→};\n  1246→\n  1247→// ============================================\n  1248→// Population Statistics for Percentile Ranking\n  1249→// ============================================\n  1250→\n  1251→export interface PopulationStats {\n  1252→  mean: number;\n  1253→  standardDeviation: number;\n  1254→  sampleSize: number;\n  1255→}\n  1256→\n  1257→export const POPULATION_STATS: Record<string, PopulationStats> = {\n  1258→  harmonyScore: { mean: 65, standardDeviation: 12, sampleSize: 10000 },\n  1259→  fwhr: { mean: 1.85, standardDeviation: 0.2, sampleSize: 10000 },\n  1260→  canthalTilt: { mean: 4, standardDeviation: 4, sampleSize: 10000 },\n  1261→  symmetry: { mean: 85, standardDeviation: 8, sampleSize: 10000 },\n  1262→  goldenRatioMatch: { mean: 70, standardDeviation: 15, sampleSize: 10000 },\n  1263→};\n  1264→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"c00368fd-7971-469c-82e0-9a0bb61c1db9","timestamp":"2025-12-19T21:04:16.054Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts","content":"/**\n * Facial Landmark Types and Default Data\n * Based on TECHNICAL_SPECS.md medical terminology\n */\n\nexport interface LandmarkPoint {\n  id: string;\n  label: string;\n  medicalTerm: string;\n  description: string;\n  x: number;\n  y: number;\n  category: string;\n}\n\nexport interface LandmarkCategory {\n  name: string;\n  color: string;\n  landmarks: string[];\n}\n\n// ============================================\n// FRONT PROFILE LANDMARKS (52 Points)\n// ============================================\n\nexport const FRONT_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n  {\n    name: 'Head',\n    color: '#FF6B6B',\n    landmarks: ['trichion'],\n  },\n  {\n    name: 'Eyes - Left',\n    color: '#4ECDC4',\n    landmarks: [\n      'left_pupila',\n      'left_canthus_medialis',\n      'left_canthus_lateralis',\n      'left_palpebra_superior',\n      'left_palpebra_inferior',\n      'left_sulcus_palpebralis_lateralis',\n      'left_pretarsal_skin_crease',\n    ],\n  },\n  {\n    name: 'Eyes - Right',\n    color: '#45B7D1',\n    landmarks: [\n      'right_pupila',\n      'right_canthus_medialis',\n      'right_canthus_lateralis',\n      'right_palpebra_superior',\n      'right_palpebra_inferior',\n      'right_sulcus_palpebralis_lateralis',\n      'right_pretarsal_skin_crease',\n    ],\n  },\n  {\n    name: 'Eyebrows - Left',\n    color: '#96CEB4',\n    landmarks: [\n      'left_supercilium_medialis',\n      'left_supercilium_medial_corner',\n      'left_supercilium_superior',\n      'left_supercilium_apex',\n      'left_supercilium_lateralis',\n    ],\n  },\n  {\n    name: 'Eyebrows - Right',\n    color: '#88D8B0',\n    landmarks: [\n      'right_supercilium_medialis',\n      'right_supercilium_medial_corner',\n      'right_supercilium_superior',\n      'right_supercilium_apex',\n      'right_supercilium_lateralis',\n    ],\n  },\n  {\n    name: 'Nose',\n    color: '#FFEAA7',\n    landmarks: [\n      'nasal_base',\n      'left_dorsum_nasi',\n      'right_dorsum_nasi',\n      'left_ala_nasi',\n      'right_ala_nasi',\n      'subnasale',\n    ],\n  },\n  {\n    name: 'Mouth',\n    color: '#DDA0DD',\n    landmarks: [\n      'labrale_superius',\n      'cupids_bow',\n      'mouth_middle',\n      'labrale_inferius',\n      'left_cheilion',\n      'right_cheilion',\n    ],\n  },\n  {\n    name: 'Jaw',\n    color: '#F39C12',\n    landmarks: [\n      'left_gonion_superior',\n      'right_gonion_superior',\n      'left_gonion_inferior',\n      'right_gonion_inferior',\n    ],\n  },\n  {\n    name: 'Chin',\n    color: '#E74C3C',\n    landmarks: ['left_mentum_lateralis', 'right_mentum_lateralis', 'menton'],\n  },\n  {\n    name: 'Face Width',\n    color: '#9B59B6',\n    landmarks: [\n      'left_zygion',\n      'right_zygion',\n      'left_temporal',\n      'right_temporal',\n      'left_auricular_lateral',\n      'right_auricular_lateral',\n    ],\n  },\n  {\n    name: 'Neck',\n    color: '#1ABC9C',\n    landmarks: ['left_cervical_lateralis', 'right_cervical_lateralis'],\n  },\n];\n\nexport const FRONT_PROFILE_LANDMARKS: LandmarkPoint[] = [\n  // Head/Hair\n  {\n    id: 'trichion',\n    label: 'Hairline',\n    medicalTerm: 'Trichion (frontal view)',\n    description: 'Anterior hairline at midline',\n    x: 0.5,\n    y: 0.08,\n    category: 'Head',\n  },\n\n  // Eyes - Left\n  {\n    id: 'left_pupila',\n    label: 'Left Pupil',\n    medicalTerm: 'Left Pupila',\n    description: 'Center of left pupil',\n    x: 0.38,\n    y: 0.35,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_canthus_medialis',\n    label: 'Left Medial Canthus',\n    medicalTerm: 'Left Canthus Medialis',\n    description: 'Inner corner of left eye',\n    x: 0.42,\n    y: 0.35,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_canthus_lateralis',\n    label: 'Left Lateral Canthus',\n    medicalTerm: 'Left Canthus Lateralis',\n    description: 'Outer corner of left eye',\n    x: 0.32,\n    y: 0.34,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_palpebra_superior',\n    label: 'Left Upper Eyelid',\n    medicalTerm: 'Left Palpebra Superior',\n    description: 'Upper eyelid of left eye',\n    x: 0.37,\n    y: 0.33,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_palpebra_inferior',\n    label: 'Left Lower Eyelid',\n    medicalTerm: 'Left Palpebra Inferior',\n    description: 'Lower eyelid of left eye',\n    x: 0.37,\n    y: 0.37,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_sulcus_palpebralis_lateralis',\n    label: 'Left Eyelid Hood End',\n    medicalTerm: 'Left Sulcus Palpebralis Lateralis',\n    description: 'Lateral end of left upper eyelid crease',\n    x: 0.31,\n    y: 0.33,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_pretarsal_skin_crease',\n    label: 'Left Upper Eyelid Crease',\n    medicalTerm: 'Left Pretarsal Skin Crease',\n    description: 'Left upper eyelid crease',\n    x: 0.37,\n    y: 0.32,\n    category: 'Eyes - Left',\n  },\n\n  // Eyes - Right\n  {\n    id: 'right_pupila',\n    label: 'Right Pupil',\n    medicalTerm: 'Right Pupila',\n    description: 'Center of right pupil',\n    x: 0.62,\n    y: 0.35,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_canthus_medialis',\n    label: 'Right Medial Canthus',\n    medicalTerm: 'Right Canthus Medialis',\n    description: 'Inner corner of right eye',\n    x: 0.58,\n    y: 0.35,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_canthus_lateralis',\n    label: 'Right Lateral Canthus',\n    medicalTerm: 'Right Canthus Lateralis',\n    description: 'Outer corner of right eye',\n    x: 0.68,\n    y: 0.34,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_palpebra_superior',\n    label: 'Right Upper Eyelid',\n    medicalTerm: 'Right Palpebra Superior',\n    description: 'Upper eyelid of right eye',\n    x: 0.63,\n    y: 0.33,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_palpebra_inferior',\n    label: 'Right Lower Eyelid',\n    medicalTerm: 'Right Palpebra Inferior',\n    description: 'Lower eyelid of right eye',\n    x: 0.63,\n    y: 0.37,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_sulcus_palpebralis_lateralis',\n    label: 'Right Eyelid Hood End',\n    medicalTerm: 'Right Sulcus Palpebralis Lateralis',\n    description: 'Lateral end of right upper eyelid crease',\n    x: 0.69,\n    y: 0.33,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_pretarsal_skin_crease',\n    label: 'Right Upper Eyelid Crease',\n    medicalTerm: 'Right Pretarsal Skin Crease',\n    description: 'Right upper eyelid crease',\n    x: 0.63,\n    y: 0.32,\n    category: 'Eyes - Right',\n  },\n\n  // Eyebrows - Left\n  {\n    id: 'left_supercilium_medialis',\n    label: 'Left Brow Head',\n    medicalTerm: 'Left Supercilium Medialis',\n    description: 'Medial start of left eyebrow',\n    x: 0.43,\n    y: 0.28,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_medial_corner',\n    label: 'Left Brow Inner Corner',\n    medicalTerm: 'Left Supercilium Medial Corner',\n    description: 'Inner corner of left eyebrow',\n    x: 0.41,\n    y: 0.27,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_superior',\n    label: 'Left Brow Arch',\n    medicalTerm: 'Left Supercilium Superior',\n    description: 'Superior arc of left eyebrow',\n    x: 0.36,\n    y: 0.26,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_apex',\n    label: 'Left Brow Peak',\n    medicalTerm: 'Left Supercilium Apex',\n    description: 'Highest point of left eyebrow',\n    x: 0.34,\n    y: 0.26,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_lateralis',\n    label: 'Left Brow Tail',\n    medicalTerm: 'Left Supercilium Lateralis',\n    description: 'Lateral end of left eyebrow',\n    x: 0.29,\n    y: 0.28,\n    category: 'Eyebrows - Left',\n  },\n\n  // Eyebrows - Right\n  {\n    id: 'right_supercilium_medialis',\n    label: 'Right Brow Head',\n    medicalTerm: 'Right Supercilium Medialis',\n    description: 'Medial start of right eyebrow',\n    x: 0.57,\n    y: 0.28,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_medial_corner',\n    label: 'Right Brow Inner Corner',\n    medicalTerm: 'Right Supercilium Medial Corner',\n    description: 'Inner corner of right eyebrow',\n    x: 0.59,\n    y: 0.27,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_superior',\n    label: 'Right Brow Arch',\n    medicalTerm: 'Right Supercilium Superior',\n    description: 'Superior arc of right eyebrow',\n    x: 0.64,\n    y: 0.26,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_apex',\n    label: 'Right Brow Peak',\n    medicalTerm: 'Right Supercilium Apex',\n    description: 'Highest point of right eyebrow',\n    x: 0.66,\n    y: 0.26,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_lateralis',\n    label: 'Right Brow Tail',\n    medicalTerm: 'Right Supercilium Lateralis',\n    description: 'Lateral end of right eyebrow',\n    x: 0.71,\n    y: 0.28,\n    category: 'Eyebrows - Right',\n  },\n\n  // Nose\n  {\n    id: 'nasal_base',\n    label: 'Nasal Base',\n    medicalTerm: 'Nasal Base',\n    description: 'Base of nasal dorsum',\n    x: 0.5,\n    y: 0.38,\n    category: 'Nose',\n  },\n  {\n    id: 'left_dorsum_nasi',\n    label: 'Left Nose Bridge',\n    medicalTerm: 'Left Dorsum Nasi',\n    description: 'Left side of nasal bridge',\n    x: 0.47,\n    y: 0.42,\n    category: 'Nose',\n  },\n  {\n    id: 'right_dorsum_nasi',\n    label: 'Right Nose Bridge',\n    medicalTerm: 'Right Dorsum Nasi',\n    description: 'Right side of nasal bridge',\n    x: 0.53,\n    y: 0.42,\n    category: 'Nose',\n  },\n  {\n    id: 'left_ala_nasi',\n    label: 'Left Nose Side',\n    medicalTerm: 'Left Ala Nasi',\n    description: 'Lateral aspect of left nasal ala',\n    x: 0.44,\n    y: 0.5,\n    category: 'Nose',\n  },\n  {\n    id: 'right_ala_nasi',\n    label: 'Right Nose Side',\n    medicalTerm: 'Right Ala Nasi',\n    description: 'Lateral aspect of right nasal ala',\n    x: 0.56,\n    y: 0.5,\n    category: 'Nose',\n  },\n  {\n    id: 'subnasale',\n    label: 'Nose Bottom',\n    medicalTerm: 'Subnasale',\n    description: 'Junction of columella and upper lip',\n    x: 0.5,\n    y: 0.52,\n    category: 'Nose',\n  },\n\n  // Mouth\n  {\n    id: 'labrale_superius',\n    label: \"Cupid's Bow\",\n    medicalTerm: 'Labrale Superius',\n    description: 'Midpoint of upper lip vermilion',\n    x: 0.5,\n    y: 0.58,\n    category: 'Mouth',\n  },\n  {\n    id: 'cupids_bow',\n    label: \"Inner Cupid's Bow\",\n    medicalTerm: \"Cupid's Bow\",\n    description: 'Central peak of upper lip',\n    x: 0.5,\n    y: 0.57,\n    category: 'Mouth',\n  },\n  {\n    id: 'mouth_middle',\n    label: 'Mouth Middle',\n    medicalTerm: 'Mouth Middle',\n    description: 'Center of mouth opening',\n    x: 0.5,\n    y: 0.62,\n    category: 'Mouth',\n  },\n  {\n    id: 'labrale_inferius',\n    label: 'Lower Lip Center',\n    medicalTerm: 'Labrale Inferius',\n    description: 'Midpoint of lower lip vermilion border',\n    x: 0.5,\n    y: 0.66,\n    category: 'Mouth',\n  },\n  {\n    id: 'left_cheilion',\n    label: 'Left Mouth Corner',\n    medicalTerm: 'Left Cheilion',\n    description: 'Left oral commissure',\n    x: 0.42,\n    y: 0.62,\n    category: 'Mouth',\n  },\n  {\n    id: 'right_cheilion',\n    label: 'Right Mouth Corner',\n    medicalTerm: 'Right Cheilion',\n    description: 'Right oral commissure',\n    x: 0.58,\n    y: 0.62,\n    category: 'Mouth',\n  },\n\n  // Jaw\n  {\n    id: 'left_gonion_superior',\n    label: 'Left Upper Jaw Angle',\n    medicalTerm: 'Left Gonion Superior',\n    description: 'Superior aspect of left mandibular angle',\n    x: 0.22,\n    y: 0.55,\n    category: 'Jaw',\n  },\n  {\n    id: 'right_gonion_superior',\n    label: 'Right Upper Jaw Angle',\n    medicalTerm: 'Right Gonion Superior',\n    description: 'Superior aspect of right mandibular angle',\n    x: 0.78,\n    y: 0.55,\n    category: 'Jaw',\n  },\n  {\n    id: 'left_gonion_inferior',\n    label: 'Left Lower Jaw Angle',\n    medicalTerm: 'Left Gonion Inferior',\n    description: 'Inferior aspect of left mandibular angle',\n    x: 0.24,\n    y: 0.7,\n    category: 'Jaw',\n  },\n  {\n    id: 'right_gonion_inferior',\n    label: 'Right Lower Jaw Angle',\n    medicalTerm: 'Right Gonion Inferior',\n    description: 'Inferior aspect of right mandibular angle',\n    x: 0.76,\n    y: 0.7,\n    category: 'Jaw',\n  },\n\n  // Chin\n  {\n    id: 'left_mentum_lateralis',\n    label: 'Left Chin',\n    medicalTerm: 'Left Mentum Lateralis',\n    description: 'Left lateral chin',\n    x: 0.42,\n    y: 0.8,\n    category: 'Chin',\n  },\n  {\n    id: 'right_mentum_lateralis',\n    label: 'Right Chin',\n    medicalTerm: 'Right Mentum Lateralis',\n    description: 'Right lateral chin',\n    x: 0.58,\n    y: 0.8,\n    category: 'Chin',\n  },\n  {\n    id: 'menton',\n    label: 'Chin Bottom',\n    medicalTerm: 'Menton',\n    description: 'Lowest point of chin in midline',\n    x: 0.5,\n    y: 0.88,\n    category: 'Chin',\n  },\n\n  // Face Width\n  {\n    id: 'left_zygion',\n    label: 'Left Cheekbone',\n    medicalTerm: 'Left Zygion',\n    description: 'Most lateral point of left zygomatic arch',\n    x: 0.18,\n    y: 0.42,\n    category: 'Face Width',\n  },\n  {\n    id: 'right_zygion',\n    label: 'Right Cheekbone',\n    medicalTerm: 'Right Zygion',\n    description: 'Most lateral point of right zygomatic arch',\n    x: 0.82,\n    y: 0.42,\n    category: 'Face Width',\n  },\n  {\n    id: 'left_temporal',\n    label: 'Left Temple',\n    medicalTerm: 'Left Temporal Point',\n    description: 'Left temporal region',\n    x: 0.2,\n    y: 0.3,\n    category: 'Face Width',\n  },\n  {\n    id: 'right_temporal',\n    label: 'Right Temple',\n    medicalTerm: 'Right Temporal Point',\n    description: 'Right temporal region',\n    x: 0.8,\n    y: 0.3,\n    category: 'Face Width',\n  },\n  {\n    id: 'left_auricular_lateral',\n    label: 'Left Outer Ear',\n    medicalTerm: 'Left Auricular Lateral Point',\n    description: 'Lateral-most point of left ear',\n    x: 0.12,\n    y: 0.4,\n    category: 'Face Width',\n  },\n  {\n    id: 'right_auricular_lateral',\n    label: 'Right Outer Ear',\n    medicalTerm: 'Right Auricular Lateral Point',\n    description: 'Lateral-most point of right ear',\n    x: 0.88,\n    y: 0.4,\n    category: 'Face Width',\n  },\n\n  // Neck\n  {\n    id: 'left_cervical_lateralis',\n    label: 'Left Neck Point',\n    medicalTerm: 'Left Cervical Lateralis',\n    description: 'Left cervical point',\n    x: 0.35,\n    y: 0.95,\n    category: 'Neck',\n  },\n  {\n    id: 'right_cervical_lateralis',\n    label: 'Right Neck Point',\n    medicalTerm: 'Right Cervical Lateralis',\n    description: 'Right cervical point',\n    x: 0.65,\n    y: 0.95,\n    category: 'Neck',\n  },\n];\n\n// ============================================\n// SIDE PROFILE LANDMARKS (38 Points)\n// ============================================\n\nexport const SIDE_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n  {\n    name: 'Cranium',\n    color: '#FF6B6B',\n    landmarks: ['vertex', 'external_occipital_region', 'trichion_profile'],\n  },\n  {\n    name: 'Forehead',\n    color: '#4ECDC4',\n    landmarks: ['frontalis', 'glabella'],\n  },\n  {\n    name: 'Eye Region',\n    color: '#45B7D1',\n    landmarks: [\n      'corneal_apex',\n      'lateral_eyelid',\n      'palpebra_inferior_side',\n      'orbitale',\n    ],\n  },\n  {\n    name: 'Nose',\n    color: '#FFEAA7',\n    landmarks: [\n      'nasion',\n      'rhinion',\n      'supratip_break',\n      'pronasale',\n      'infratip_lobule',\n      'columella_nasi',\n      'subnasale_side',\n      'subalare',\n    ],\n  },\n  {\n    name: 'Lips',\n    color: '#DDA0DD',\n    landmarks: [\n      'labrale_superius_side',\n      'cheilion_side',\n      'labrale_inferius_side',\n      'sublabiale',\n    ],\n  },\n  {\n    name: 'Chin',\n    color: '#E74C3C',\n    landmarks: ['pogonion', 'menton_side'],\n  },\n  {\n    name: 'Jaw',\n    color: '#F39C12',\n    landmarks: ['gonion_superior_side', 'gonion_inferior_side'],\n  },\n  {\n    name: 'Cheek',\n    color: '#9B59B6',\n    landmarks: ['zygion_soft_tissue'],\n  },\n  {\n    name: 'Ear',\n    color: '#3498DB',\n    landmarks: ['porion', 'tragion', 'incisura_intertragica'],\n  },\n  {\n    name: 'Neck',\n    color: '#1ABC9C',\n    landmarks: ['cervicale', 'anterior_cervical_landmark'],\n  },\n];\n\nexport const SIDE_PROFILE_LANDMARKS: LandmarkPoint[] = [\n  // Cranium\n  {\n    id: 'vertex',\n    label: 'Top of Head',\n    medicalTerm: 'Vertex',\n    description: 'Highest point of cranium',\n    x: 0.45,\n    y: 0.02,\n    category: 'Cranium',\n  },\n  {\n    id: 'external_occipital_region',\n    label: 'Occiput',\n    medicalTerm: 'External Occipital Region',\n    description: 'Back of skull',\n    x: 0.85,\n    y: 0.15,\n    category: 'Cranium',\n  },\n  {\n    id: 'trichion_profile',\n    label: 'Hairline (profile)',\n    medicalTerm: 'Trichion',\n    description: 'Anterior hairline (profile view)',\n    x: 0.35,\n    y: 0.1,\n    category: 'Cranium',\n  },\n\n  // Forehead\n  {\n    id: 'frontalis',\n    label: 'Forehead',\n    medicalTerm: 'Frontalis',\n    description: 'Forehead region',\n    x: 0.3,\n    y: 0.18,\n    category: 'Forehead',\n  },\n  {\n    id: 'glabella',\n    label: 'Glabella',\n    medicalTerm: 'Glabella',\n    description: 'Most prominent point between eyebrows',\n    x: 0.32,\n    y: 0.28,\n    category: 'Forehead',\n  },\n\n  // Eye Region\n  {\n    id: 'corneal_apex',\n    label: 'Corneal Apex',\n    medicalTerm: 'Corneal Apex',\n    description: 'Most anterior point of cornea',\n    x: 0.28,\n    y: 0.34,\n    category: 'Eye Region',\n  },\n  {\n    id: 'lateral_eyelid',\n    label: 'Eyelid End',\n    medicalTerm: 'Lateral Eyelid',\n    description: 'Lateral extent of palpebral fissure',\n    x: 0.35,\n    y: 0.34,\n    category: 'Eye Region',\n  },\n  {\n    id: 'palpebra_inferior_side',\n    label: 'Lower Eyelid',\n    medicalTerm: 'Left Palpebra Inferior',\n    description: 'Lower eyelid margin (profile view)',\n    x: 0.3,\n    y: 0.36,\n    category: 'Eye Region',\n  },\n  {\n    id: 'orbitale',\n    label: 'Orbitale',\n    medicalTerm: 'Orbitale',\n    description: 'Lowest point of infraorbital margin',\n    x: 0.35,\n    y: 0.38,\n    category: 'Eye Region',\n  },\n\n  // Nose\n  {\n    id: 'nasion',\n    label: 'Nasal Bridge Front',\n    medicalTerm: 'Nasion',\n    description: 'Deepest point of nasal root',\n    x: 0.35,\n    y: 0.32,\n    category: 'Nose',\n  },\n  {\n    id: 'rhinion',\n    label: 'Rhinion',\n    medicalTerm: 'Rhinion',\n    description: 'Junction of bony and cartilaginous nose',\n    x: 0.28,\n    y: 0.4,\n    category: 'Nose',\n  },\n  {\n    id: 'supratip_break',\n    label: 'Supratip',\n    medicalTerm: 'Supratip Break',\n    description: 'Depression above nasal tip',\n    x: 0.22,\n    y: 0.46,\n    category: 'Nose',\n  },\n  {\n    id: 'pronasale',\n    label: 'Nose Tip',\n    medicalTerm: 'Pronasale',\n    description: 'Most anterior point of nasal tip',\n    x: 0.18,\n    y: 0.48,\n    category: 'Nose',\n  },\n  {\n    id: 'infratip_lobule',\n    label: 'Infratip',\n    medicalTerm: 'Infratip Lobule',\n    description: 'Area below nasal tip',\n    x: 0.2,\n    y: 0.5,\n    category: 'Nose',\n  },\n  {\n    id: 'columella_nasi',\n    label: 'Columella',\n    medicalTerm: 'Columella Nasi',\n    description: 'Fleshy external end of nasal septum',\n    x: 0.24,\n    y: 0.52,\n    category: 'Nose',\n  },\n  {\n    id: 'subnasale_side',\n    label: 'Subnasale',\n    medicalTerm: 'Subnasale',\n    description: 'Junction of columella and upper lip',\n    x: 0.3,\n    y: 0.54,\n    category: 'Nose',\n  },\n  {\n    id: 'subalare',\n    label: 'Subalare',\n    medicalTerm: 'Subalare',\n    description: 'Junction of alar base and upper lip',\n    x: 0.28,\n    y: 0.53,\n    category: 'Nose',\n  },\n\n  // Lips\n  {\n    id: 'labrale_superius_side',\n    label: 'Upper Lip',\n    medicalTerm: 'Labrale Superius',\n    description: 'Upper lip vermilion border',\n    x: 0.28,\n    y: 0.58,\n    category: 'Lips',\n  },\n  {\n    id: 'cheilion_side',\n    label: 'Mouth Corner',\n    medicalTerm: 'Cheilion',\n    description: 'Oral commissure (profile view)',\n    x: 0.35,\n    y: 0.62,\n    category: 'Lips',\n  },\n  {\n    id: 'labrale_inferius_side',\n    label: 'Lower Lip',\n    medicalTerm: 'Labrale Inferius',\n    description: 'Lower lip vermilion border',\n    x: 0.3,\n    y: 0.66,\n    category: 'Lips',\n  },\n  {\n    id: 'sublabiale',\n    label: 'Labiomental Fold',\n    medicalTerm: 'Sublabiale',\n    description: 'Deepest point of labiomental sulcus',\n    x: 0.32,\n    y: 0.7,\n    category: 'Lips',\n  },\n\n  // Chin\n  {\n    id: 'pogonion',\n    label: 'Chin Point',\n    medicalTerm: 'Pogonion (soft tissue)',\n    description: 'Most anterior point of chin',\n    x: 0.3,\n    y: 0.76,\n    category: 'Chin',\n  },\n  {\n    id: 'menton_side',\n    label: 'Chin Bottom',\n    medicalTerm: 'Menton (soft tissue)',\n    description: 'Lowest point of chin',\n    x: 0.35,\n    y: 0.82,\n    category: 'Chin',\n  },\n\n  // Jaw\n  {\n    id: 'gonion_superior_side',\n    label: 'Upper Jaw Angle',\n    medicalTerm: 'Gonion Superior',\n    description: 'Superior mandibular angle',\n    x: 0.7,\n    y: 0.6,\n    category: 'Jaw',\n  },\n  {\n    id: 'gonion_inferior_side',\n    label: 'Lower Jaw Angle',\n    medicalTerm: 'Gonion Inferior',\n    description: 'Inferior mandibular angle',\n    x: 0.65,\n    y: 0.72,\n    category: 'Jaw',\n  },\n\n  // Cheek\n  {\n    id: 'zygion_soft_tissue',\n    label: 'Cheekbone',\n    medicalTerm: 'Zygion (soft tissue over zygoma)',\n    description: 'Soft tissue over zygomatic arch',\n    x: 0.45,\n    y: 0.42,\n    category: 'Cheek',\n  },\n\n  // Ear\n  {\n    id: 'porion',\n    label: 'Porion',\n    medicalTerm: 'Porion (soft tissue)',\n    description: 'Superior aspect of external auditory meatus',\n    x: 0.75,\n    y: 0.35,\n    category: 'Ear',\n  },\n  {\n    id: 'tragion',\n    label: 'Tragus',\n    medicalTerm: 'Tragion (soft tissue)',\n    description: 'Superior margin of tragus',\n    x: 0.72,\n    y: 0.42,\n    category: 'Ear',\n  },\n  {\n    id: 'incisura_intertragica',\n    label: 'Intertragic Notch',\n    medicalTerm: 'Incisura Intertragica',\n    description: 'Notch between tragus and antitragus',\n    x: 0.73,\n    y: 0.45,\n    category: 'Ear',\n  },\n\n  // Neck\n  {\n    id: 'cervicale',\n    label: 'Cervical Point',\n    medicalTerm: 'Cervicale (soft tissue reference)',\n    description: 'Cervical point for profile analysis',\n    x: 0.5,\n    y: 0.9,\n    category: 'Neck',\n  },\n  {\n    id: 'anterior_cervical_landmark',\n    label: 'Neck Point',\n    medicalTerm: 'Anterior Cervical Landmark',\n    description: 'Anterior neck landmark',\n    x: 0.4,\n    y: 0.88,\n    category: 'Neck',\n  },\n];\n\n// ============================================\n// MediaPipe Face Mesh Index Mapping\n// ============================================\n// NOTE: MEDIAPIPE_FRONT_MAPPING is defined in mediapipeDetection.ts (single source of truth)\n// Import from there if needed: import { MEDIAPIPE_FRONT_MAPPING } from './mediapipeDetection';\n\n// Helper to get category color for a landmark\nexport function getLandmarkColor(\n  landmarkId: string,\n  categories: LandmarkCategory[]\n): string {\n  for (const category of categories) {\n    if (category.landmarks.includes(landmarkId)) {\n      return category.color;\n    }\n  }\n  return '#00f3ff'; // Default cyan\n}\n\n// ============================================\n// FaceIQ Side Profile Landmark Indices (106 points)\n// Reverse-engineered from FaceIQ Labs API\n// ============================================\n\nexport const FACEIQ_SIDE_LANDMARKS = {\n  // Face Contour (0-16) - Jaw/Chin outline\n  MENTON: 0, // Chin bottom (lowest point)\n  POGONION: 2, // Chin prominence\n  GNATHION: 3, // Chin point\n  MANDIBLE_CONTOUR: [2, 3, 4, 5, 6, 7, 8], // Jaw line\n\n  // Posterior Points (1, 9-16) - Ear/Back of head\n  TRAGION: 1, // Ear point\n  EAR_CONTOUR: [9, 10, 11, 12, 13, 14, 15, 16],\n\n  // Forehead/Hairline (17)\n  TRICHION: 17, // Hairline\n\n  // Nose Profile (18-32)\n  NASION: 25, // Bridge of nose (deepest point)\n  PRONASALE: 32, // Nose tip\n  SUBNASALE: 52, // Base of nose\n  COLUMELLA: 53, // Nose columella\n  NOSE_BRIDGE: [25, 26, 27, 28, 29, 30, 31, 32],\n  NOSE_TIP_CONTOUR: [52, 53, 54, 55, 56, 57, 58, 59, 60],\n\n  // Eye Region (33-51)\n  EYE_LATERAL_CANTHUS: 33, // Outer eye corner\n  EYE_MEDIAL_CANTHUS: 35, // Inner eye corner\n  UPPER_EYELID: [37, 38, 39],\n  LOWER_EYELID: [40, 41, 42],\n  PUPIL: 34,\n  BROW_HEAD: 44, // Inner brow\n  BROW_ARCH: 45, // Brow peak\n  BROW_TAIL: 46, // Outer brow\n\n  // Lip Region (52-75)\n  LABRALE_SUPERIUS: 63, // Upper lip top\n  LABRALE_INFERIUS: 66, // Lower lip bottom\n  STOMION: 65, // Lip meeting point\n  UPPER_LIP_CONTOUR: [63, 64, 65],\n  LOWER_LIP_CONTOUR: [66, 67, 68],\n\n  // Additional Profile Points (76-105)\n  GLABELLA: 76, // Between eyebrows\n  SELLION: 77, // Deepest point of nasal bridge\n  SOFT_TISSUE_NASION: 78,\n  ORBITALE: 79, // Lowest point of eye socket\n  GONION: 85, // Jaw angle\n  CONDYLION: 86, // Top of jaw joint\n};\n\n// ============================================\n// FaceIQ Front Face Landmark Indices (MediaPipe 478 points)\n// ============================================\n\nexport const FACEIQ_FRONT_LANDMARKS = {\n  // Key points from MediaPipe Face Mesh\n  NOSE_TIP: 1,\n  LEFT_EYE_INNER: 133,\n  LEFT_EYE_OUTER: 33,\n  RIGHT_EYE_INNER: 362,\n  RIGHT_EYE_OUTER: 263,\n  LEFT_CHEEK: 234,\n  RIGHT_CHEEK: 454,\n  UPPER_LIP: 13,\n  LOWER_LIP: 14,\n  CHIN: 152,\n  FOREHEAD: 10,\n  LEFT_EAR: 234,\n  RIGHT_EAR: 454,\n  LEFT_BROW_INNER: 107,\n  LEFT_BROW_OUTER: 70,\n  RIGHT_BROW_INNER: 336,\n  RIGHT_BROW_OUTER: 300,\n  NOSE_BRIDGE: 6,\n  LEFT_NOSTRIL: 129,\n  RIGHT_NOSTRIL: 358,\n};\n\n// ============================================\n// Scoring Configuration Types\n// ============================================\n\nexport interface ScoringConfig {\n  idealValue: number;\n  standardDeviation: number;\n  minScore: number;\n  maxScore: number;\n  weight: number;\n}\n\nexport interface GenderSpecificValues {\n  male: { ideal: number; range: [number, number] };\n  female: { ideal: number; range: [number, number] };\n}\n\n// ============================================\n// FaceIQ Ideal Values (Gender-Specific)\n// ============================================\n\nexport const FACEIQ_IDEAL_VALUES: Record<string, GenderSpecificValues> = {\n  fwhr: {\n    male: { ideal: 1.9, range: [1.8, 2.1] },\n    female: { ideal: 1.75, range: [1.6, 1.9] },\n  },\n  canthalTilt: {\n    male: { ideal: 4, range: [2, 7] },\n    female: { ideal: 6, range: [4, 10] },\n  },\n  nasolabialAngle: {\n    male: { ideal: 95, range: [90, 100] },\n    female: { ideal: 105, range: [100, 115] },\n  },\n  gonialAngle: {\n    male: { ideal: 125, range: [120, 130] },\n    female: { ideal: 128, range: [125, 135] },\n  },\n  nasalIndex: {\n    male: { ideal: 0.7, range: [0.65, 0.75] },\n    female: { ideal: 0.65, range: [0.6, 0.7] },\n  },\n  lipRatio: {\n    male: { ideal: 0.5, range: [0.4, 0.6] },\n    female: { ideal: 0.5, range: [0.45, 0.55] },\n  },\n  facialConvexity: {\n    male: { ideal: 170, range: [165, 175] },\n    female: { ideal: 168, range: [163, 173] },\n  },\n  chinProjection: {\n    male: { ideal: 0, range: [-3, 3] },\n    female: { ideal: -2, range: [-5, 1] },\n  },\n};\n\n// ============================================\n// FaceIQ Scoring Configurations\n// ============================================\n\nexport const FACEIQ_SCORING_CONFIGS: Record<string, ScoringConfig> = {\n  fwhr: {\n    idealValue: 1.9,\n    standardDeviation: 0.15,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.15,\n  },\n  canthalTilt: {\n    idealValue: 6,\n    standardDeviation: 3,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.1,\n  },\n  facialThirds: {\n    idealValue: 33.33,\n    standardDeviation: 3,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.1,\n  },\n  nasolabialAngle: {\n    idealValue: 102,\n    standardDeviation: 8,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.08,\n  },\n  gonialAngle: {\n    idealValue: 125,\n    standardDeviation: 5,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.08,\n  },\n  overallSymmetry: {\n    idealValue: 100,\n    standardDeviation: 5,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.15,\n  },\n  goldenRatio: {\n    idealValue: 1.618,\n    standardDeviation: 0.1,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.12,\n  },\n  nasalIndex: {\n    idealValue: 0.7,\n    standardDeviation: 0.08,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.06,\n  },\n  lipRatio: {\n    idealValue: 0.5,\n    standardDeviation: 0.1,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.06,\n  },\n  chinProjection: {\n    idealValue: 0,\n    standardDeviation: 3,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.05,\n  },\n  noseProjection: {\n    idealValue: 0.67,\n    standardDeviation: 0.05,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.05,\n  },\n};\n\n// ============================================\n// Population Statistics for Percentile Ranking\n// ============================================\n\nexport interface PopulationStats {\n  mean: number;\n  standardDeviation: number;\n  sampleSize: number;\n}\n\nexport const POPULATION_STATS: Record<string, PopulationStats> = {\n  harmonyScore: { mean: 65, standardDeviation: 12, sampleSize: 10000 },\n  fwhr: { mean: 1.85, standardDeviation: 0.2, sampleSize: 10000 },\n  canthalTilt: { mean: 4, standardDeviation: 4, sampleSize: 10000 },\n  symmetry: { mean: 85, standardDeviation: 8, sampleSize: 10000 },\n  goldenRatioMatch: { mean: 70, standardDeviation: 15, sampleSize: 10000 },\n};\n","numLines":1264,"startLine":1,"totalLines":1264}}}
{"parentUuid":"c00368fd-7971-469c-82e0-9a0bb61c1db9","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MmHSyvTjtRSVKsiSKBN937","type":"tool_result","content":"     1→/**\n     2→ * Facial Analysis Scoring Functions\n     3→ * Uses correct landmark IDs from landmarks.ts\n     4→ * Includes FaceIQ-style bell curve scoring and percentile ranking\n     5→ */\n     6→\n     7→import {\n     8→  LandmarkPoint,\n     9→  ScoringConfig,\n    10→  FACEIQ_SCORING_CONFIGS,\n    11→  FACEIQ_IDEAL_VALUES,\n    12→  PopulationStats,\n    13→  POPULATION_STATS,\n    14→} from './landmarks';\n    15→\n    16→// ============================================\n    17→// UTILITY TYPES & FUNCTIONS\n    18→// ============================================\n    19→\n    20→export interface Point {\n    21→  x: number;\n    22→  y: number;\n    23→}\n    24→\n    25→export interface ScoreResult {\n    26→  value: number;\n    27→  score: number;\n    28→  idealRange: { min: number; max: number };\n    29→  rating: 'excellent' | 'good' | 'average' | 'below_average';\n    30→}\n    31→\n    32→/**\n    33→ * Calculate distance between two points\n    34→ */\n    35→export function distance(p1: Point, p2: Point): number {\n    36→  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n    37→}\n    38→\n    39→/**\n    40→ * Calculate angle at vertex point (in degrees)\n    41→ * Angle is formed by points: p1 -> vertex -> p2\n    42→ */\n    43→export function calculateAngle(p1: Point, vertex: Point, p2: Point): number {\n    44→  const v1 = { x: p1.x - vertex.x, y: p1.y - vertex.y };\n    45→  const v2 = { x: p2.x - vertex.x, y: p2.y - vertex.y };\n    46→\n    47→  const dot = v1.x * v2.x + v1.y * v2.y;\n    48→  const cross = v1.x * v2.y - v1.y * v2.x;\n    49→\n    50→  const angle = Math.atan2(cross, dot) * (180 / Math.PI);\n    51→  return Math.abs(angle);\n    52→}\n    53→\n    54→/**\n    55→ * Calculate perpendicular distance from point to line\n    56→ * Positive = in front of line, Negative = behind line\n    57→ */\n    58→export function perpendicularDistance(\n    59→  point: Point,\n    60→  lineStart: Point,\n    61→  lineEnd: Point\n    62→): number {\n    63→  const A = point.x - lineStart.x;\n    64→  const B = point.y - lineStart.y;\n    65→  const C = lineEnd.x - lineStart.x;\n    66→  const D = lineEnd.y - lineStart.y;\n    67→\n    68→  const dot = A * C + B * D;\n    69→  const lenSq = C * C + D * D;\n    70→  const param = lenSq !== 0 ? dot / lenSq : -1;\n    71→\n    72→  let xx: number, yy: number;\n    73→\n    74→  if (param < 0) {\n    75→    xx = lineStart.x;\n    76→    yy = lineStart.y;\n    77→  } else if (param > 1) {\n    78→    xx = lineEnd.x;\n    79→    yy = lineEnd.y;\n    80→  } else {\n    81→    xx = lineStart.x + param * C;\n    82→    yy = lineStart.y + param * D;\n    83→  }\n    84→\n    85→  const dx = point.x - xx;\n    86→  const dy = point.y - yy;\n    87→\n    88→  // Determine sign (positive = in front of line, negative = behind)\n    89→  const sign =\n    90→    (lineEnd.y - lineStart.y) * point.x -\n    91→      (lineEnd.x - lineStart.x) * point.y +\n    92→      lineEnd.x * lineStart.y -\n    93→      lineEnd.y * lineStart.x >=\n    94→    0\n    95→      ? 1\n    96→      : -1;\n    97→\n    98→  return sign * Math.sqrt(dx * dx + dy * dy);\n    99→}\n   100→\n   101→/**\n   102→ * Get rating from score\n   103→ */\n   104→function getRating(score: number): ScoreResult['rating'] {\n   105→  if (score >= 90) return 'excellent';\n   106→  if (score >= 75) return 'good';\n   107→  if (score >= 50) return 'average';\n   108→  return 'below_average';\n   109→}\n   110→\n   111→/**\n   112→ * Helper to get landmark by ID from array\n   113→ */\n   114→function getLandmark(landmarks: LandmarkPoint[], id: string): Point | null {\n   115→  const lm = landmarks.find((l) => l.id === id);\n   116→  return lm ? { x: lm.x, y: lm.y } : null;\n   117→}\n   118→\n   119→// ============================================\n   120→// SIDE PROFILE SCORING (uses _side suffix landmarks)\n   121→// ============================================\n   122→\n   123→/**\n   124→ * Gonial Angle - Jaw angle measurement\n   125→ * Uses: tragion, gonion_inferior_side, menton_side\n   126→ * Ideal: 120° - 130° (male), 125° - 135° (female)\n   127→ */\n   128→export function calculateGonialAngle(\n   129→  sideLandmarks: LandmarkPoint[],\n   130→  gender: 'male' | 'female' = 'male'\n   131→): ScoreResult | null {\n   132→  const tragion = getLandmark(sideLandmarks, 'tragion');\n   133→  const gonion_inferior = getLandmark(sideLandmarks, 'gonion_inferior_side');\n   134→  const menton = getLandmark(sideLandmarks, 'menton_side');\n   135→\n   136→  if (!tragion || !gonion_inferior || !menton) return null;\n   137→\n   138→  const angle = calculateAngle(tragion, gonion_inferior, menton);\n   139→\n   140→  const idealMin = gender === 'male' ? 120 : 125;\n   141→  const idealMax = gender === 'male' ? 130 : 135;\n   142→\n   143→  let score: number;\n   144→  if (angle >= idealMin && angle <= idealMax) {\n   145→    score = 100;\n   146→  } else {\n   147→    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n   148→    score = Math.max(0, 100 - deviation * 5);\n   149→  }\n   150→\n   151→  return {\n   152→    value: angle,\n   153→    score,\n   154→    idealRange: { min: idealMin, max: idealMax },\n   155→    rating: getRating(score),\n   156→  };\n   157→}\n   158→\n   159→/**\n   160→ * Nasolabial Angle - Angle between columella and upper lip\n   161→ * Uses: columella_nasi, subnasale_side, labrale_superius_side\n   162→ * Ideal: 90° - 105° (male), 95° - 115° (female)\n   163→ */\n   164→export function calculateNasolabialAngle(\n   165→  sideLandmarks: LandmarkPoint[],\n   166→  gender: 'male' | 'female' = 'male'\n   167→): ScoreResult | null {\n   168→  const columella = getLandmark(sideLandmarks, 'columella_nasi');\n   169→  const subnasale = getLandmark(sideLandmarks, 'subnasale_side');\n   170→  const labrale_superius = getLandmark(sideLandmarks, 'labrale_superius_side');\n   171→\n   172→  if (!columella || !subnasale || !labrale_superius) return null;\n   173→\n   174→  const angle = calculateAngle(columella, subnasale, labrale_superius);\n   175→\n   176→  const idealMin = gender === 'male' ? 90 : 95;\n   177→  const idealMax = gender === 'male' ? 105 : 115;\n   178→\n   179→  let score: number;\n   180→  if (angle >= idealMin && angle <= idealMax) {\n   181→    score = 100;\n   182→  } else {\n   183→    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n   184→    score = Math.max(0, 100 - deviation * 4);\n   185→  }\n   186→\n   187→  return {\n   188→    value: angle,\n   189→    score,\n   190→    idealRange: { min: idealMin, max: idealMax },\n   191→    rating: getRating(score),\n   192→  };\n   193→}\n   194→\n   195→/**\n   196→ * E-Line (Ricketts' Esthetic Line) - Lip protrusion analysis\n   197→ * Uses: pronasale, pogonion, labrale_superius_side, labrale_inferius_side\n   198→ * Ideal: Upper lip 4mm behind (male) / 2mm behind (female)\n   199→ *        Lower lip 2mm behind (male) / 0mm (female)\n   200→ */\n   201→export function calculateELine(\n   202→  sideLandmarks: LandmarkPoint[],\n   203→  gender: 'male' | 'female' = 'male'\n   204→): { upperLip: ScoreResult; lowerLip: ScoreResult; combined: ScoreResult } | null {\n   205→  const pronasale = getLandmark(sideLandmarks, 'pronasale');\n   206→  const pogonion = getLandmark(sideLandmarks, 'pogonion');\n   207→  const labrale_superius = getLandmark(sideLandmarks, 'labrale_superius_side');\n   208→  const labrale_inferius = getLandmark(sideLandmarks, 'labrale_inferius_side');\n   209→\n   210→  if (!pronasale || !pogonion || !labrale_superius || !labrale_inferius) return null;\n   211→\n   212→  const upperLipDistance = perpendicularDistance(labrale_superius, pronasale, pogonion);\n   213→  const lowerLipDistance = perpendicularDistance(labrale_inferius, pronasale, pogonion);\n   214→\n   215→  // Ideal values (negative = behind the line, which is desirable)\n   216→  const idealUpperLip = gender === 'male' ? -4 : -2;\n   217→  const idealLowerLip = gender === 'male' ? -2 : 0;\n   218→  const tolerance = 2;\n   219→\n   220→  // Upper lip scoring\n   221→  const upperDeviation = Math.abs(upperLipDistance - idealUpperLip);\n   222→  const upperScore =\n   223→    upperDeviation <= tolerance\n   224→      ? 100\n   225→      : Math.max(0, 100 - (upperDeviation - tolerance) * 10);\n   226→\n   227→  // Lower lip scoring\n   228→  const lowerDeviation = Math.abs(lowerLipDistance - idealLowerLip);\n   229→  const lowerScore =\n   230→    lowerDeviation <= tolerance\n   231→      ? 100\n   232→      : Math.max(0, 100 - (lowerDeviation - tolerance) * 10);\n   233→\n   234→  const combinedScore = (upperScore + lowerScore) / 2;\n   235→\n   236→  return {\n   237→    upperLip: {\n   238→      value: upperLipDistance,\n   239→      score: upperScore,\n   240→      idealRange: { min: idealUpperLip - tolerance, max: idealUpperLip + tolerance },\n   241→      rating: getRating(upperScore),\n   242→    },\n   243→    lowerLip: {\n   244→      value: lowerLipDistance,\n   245→      score: lowerScore,\n   246→      idealRange: { min: idealLowerLip - tolerance, max: idealLowerLip + tolerance },\n   247→      rating: getRating(lowerScore),\n   248→    },\n   249→    combined: {\n   250→      value: (upperLipDistance + lowerLipDistance) / 2,\n   251→      score: combinedScore,\n   252→      idealRange: { min: -6, max: 2 },\n   253→      rating: getRating(combinedScore),\n   254→    },\n   255→  };\n   256→}\n   257→\n   258→/**\n   259→ * Mentolabial Angle - Angle at the labiomental fold\n   260→ * Uses: labrale_inferius_side, sublabiale, pogonion\n   261→ * Ideal: 120° - 140°\n   262→ */\n   263→export function calculateMentolabialAngle(\n   264→  sideLandmarks: LandmarkPoint[]\n   265→): ScoreResult | null {\n   266→  const labrale_inferius = getLandmark(sideLandmarks, 'labrale_inferius_side');\n   267→  const sublabiale = getLandmark(sideLandmarks, 'sublabiale');\n   268→  const pogonion = getLandmark(sideLandmarks, 'pogonion');\n   269→\n   270→  if (!labrale_inferius || !sublabiale || !pogonion) return null;\n   271→\n   272→  const angle = calculateAngle(labrale_inferius, sublabiale, pogonion);\n   273→\n   274→  const idealMin = 120;\n   275→  const idealMax = 140;\n   276→\n   277→  let score: number;\n   278→  if (angle >= idealMin && angle <= idealMax) {\n   279→    score = 100;\n   280→  } else {\n   281→    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n   282→    score = Math.max(0, 100 - deviation * 3);\n   283→  }\n   284→\n   285→  return {\n   286→    value: angle,\n   287→    score,\n   288→    idealRange: { min: idealMin, max: idealMax },\n   289→    rating: getRating(score),\n   290→  };\n   291→}\n   292→\n   293→/**\n   294→ * Nasofrontal Angle - Angle at the bridge of nose\n   295→ * Uses: glabella, nasion, rhinion\n   296→ * Ideal: 115° - 135°\n   297→ */\n   298→export function calculateNasofrontalAngle(\n   299→  sideLandmarks: LandmarkPoint[]\n   300→): ScoreResult | null {\n   301→  const glabella = getLandmark(sideLandmarks, 'glabella');\n   302→  const nasion = getLandmark(sideLandmarks, 'nasion');\n   303→  const rhinion = getLandmark(sideLandmarks, 'rhinion');\n   304→\n   305→  if (!glabella || !nasion || !rhinion) return null;\n   306→\n   307→  const angle = calculateAngle(glabella, nasion, rhinion);\n   308→\n   309→  const idealMin = 115;\n   310→  const idealMax = 135;\n   311→\n   312→  let score: number;\n   313→  if (angle >= idealMin && angle <= idealMax) {\n   314→    score = 100;\n   315→  } else {\n   316→    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n   317→    score = Math.max(0, 100 - deviation * 3);\n   318→  }\n   319→\n   320→  return {\n   321→    value: angle,\n   322→    score,\n   323→    idealRange: { min: idealMin, max: idealMax },\n   324→    rating: getRating(score),\n   325→  };\n   326→}\n   327→\n   328→// ============================================\n   329→// FRONT PROFILE SCORING (uses front landmarks)\n   330→// ============================================\n   331→\n   332→/**\n   333→ * Facial Thirds - Vertical face proportions\n   334→ * Uses: trichion, glabella (approx from nasion), subnasale, menton\n   335→ * Ideal: Each third ~33%\n   336→ * Note: For front profile, we use nasal_base as proxy for glabella area\n   337→ */\n   338→export function calculateFacialThirds(\n   339→  frontLandmarks: LandmarkPoint[]\n   340→): { upper: ScoreResult; middle: ScoreResult; lower: ScoreResult; overall: ScoreResult } | null {\n   341→  const trichion = getLandmark(frontLandmarks, 'trichion');\n   342→  const nasal_base = getLandmark(frontLandmarks, 'nasal_base'); // Using as glabella proxy\n   343→  const subnasale = getLandmark(frontLandmarks, 'subnasale');\n   344→  const menton = getLandmark(frontLandmarks, 'menton');\n   345→\n   346→  if (!trichion || !nasal_base || !subnasale || !menton) return null;\n   347→\n   348→  const totalHeight = distance(trichion, menton);\n   349→  if (totalHeight === 0) return null;\n   350→\n   351→  const upperThird = (distance(trichion, nasal_base) / totalHeight) * 100;\n   352→  const middleThird = (distance(nasal_base, subnasale) / totalHeight) * 100;\n   353→  const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n   354→\n   355→  const ideal = 33.33;\n   356→  const tolerance = 3;\n   357→\n   358→  const scoreThird = (value: number): number => {\n   359→    const deviation = Math.abs(value - ideal);\n   360→    return deviation <= tolerance ? 100 : Math.max(0, 100 - (deviation - tolerance) * 8);\n   361→  };\n   362→\n   363→  const upperScore = scoreThird(upperThird);\n   364→  const middleScore = scoreThird(middleThird);\n   365→  const lowerScore = scoreThird(lowerThird);\n   366→  const overallScore = (upperScore + middleScore + lowerScore) / 3;\n   367→\n   368→  return {\n   369→    upper: {\n   370→      value: upperThird,\n   371→      score: upperScore,\n   372→      idealRange: { min: 30, max: 36 },\n   373→      rating: getRating(upperScore),\n   374→    },\n   375→    middle: {\n   376→      value: middleThird,\n   377→      score: middleScore,\n   378→      idealRange: { min: 30, max: 36 },\n   379→      rating: getRating(middleScore),\n   380→    },\n   381→    lower: {\n   382→      value: lowerThird,\n   383→      score: lowerScore,\n   384→      idealRange: { min: 30, max: 36 },\n   385→      rating: getRating(lowerScore),\n   386→    },\n   387→    overall: {\n   388→      value: Math.max(Math.abs(upperThird - ideal), Math.abs(middleThird - ideal), Math.abs(lowerThird - ideal)),\n   389→      score: overallScore,\n   390→      idealRange: { min: 0, max: 3 },\n   391→      rating: getRating(overallScore),\n   392→    },\n   393→  };\n   394→}\n   395→\n   396→/**\n   397→ * Facial Width-to-Height Ratio (FWHR)\n   398→ * Uses: left_zygion, right_zygion, nasal_base (as upper bound), labrale_superius\n   399→ * Ideal: 1.8 - 2.0\n   400→ */\n   401→export function calculateFWHR(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n   402→  const left_zygion = getLandmark(frontLandmarks, 'left_zygion');\n   403→  const right_zygion = getLandmark(frontLandmarks, 'right_zygion');\n   404→  const nasal_base = getLandmark(frontLandmarks, 'nasal_base');\n   405→  const labrale_superius = getLandmark(frontLandmarks, 'labrale_superius');\n   406→\n   407→  if (!left_zygion || !right_zygion || !nasal_base || !labrale_superius) return null;\n   408→\n   409→  const bizygomatic_width = distance(left_zygion, right_zygion);\n   410→  const upper_face_height = distance(nasal_base, labrale_superius);\n   411→\n   412→  if (upper_face_height === 0) return null;\n   413→\n   414→  const ratio = bizygomatic_width / upper_face_height;\n   415→\n   416→  const idealMin = 1.8;\n   417→  const idealMax = 2.0;\n   418→\n   419→  let score: number;\n   420→  if (ratio >= idealMin && ratio <= idealMax) {\n   421→    score = 100;\n   422→  } else {\n   423→    const deviation = ratio < idealMin ? idealMin - ratio : ratio - idealMax;\n   424→    score = Math.max(0, 100 - deviation * 50);\n   425→  }\n   426→\n   427→  return {\n   428→    value: ratio,\n   429→    score,\n   430→    idealRange: { min: idealMin, max: idealMax },\n   431→    rating: getRating(score),\n   432→  };\n   433→}\n   434→\n   435→/**\n   436→ * Interpupillary Distance Ratio\n   437→ * Uses: left_pupila, right_pupila, left_zygion, right_zygion\n   438→ * Ideal: IPD ~46% of bizygomatic width\n   439→ */\n   440→export function calculateIPDRatio(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n   441→  const left_pupila = getLandmark(frontLandmarks, 'left_pupila');\n   442→  const right_pupila = getLandmark(frontLandmarks, 'right_pupila');\n   443→  const left_zygion = getLandmark(frontLandmarks, 'left_zygion');\n   444→  const right_zygion = getLandmark(frontLandmarks, 'right_zygion');\n   445→\n   446→  if (!left_pupila || !right_pupila || !left_zygion || !right_zygion) return null;\n   447→\n   448→  const ipd = distance(left_pupila, right_pupila);\n   449→  const bizygomatic_width = distance(left_zygion, right_zygion);\n   450→\n   451→  if (bizygomatic_width === 0) return null;\n   452→\n   453→  const ratio = (ipd / bizygomatic_width) * 100;\n   454→\n   455→  const ideal = 46;\n   456→  const tolerance = 2;\n   457→\n   458→  const deviation = Math.abs(ratio - ideal);\n   459→  const score = deviation <= tolerance ? 100 : Math.max(0, 100 - (deviation - tolerance) * 8);\n   460→\n   461→  return {\n   462→    value: ratio,\n   463→    score,\n   464→    idealRange: { min: 44, max: 48 },\n   465→    rating: getRating(score),\n   466→  };\n   467→}\n   468→\n   469→/**\n   470→ * Nasal Index (Nose Width to Height)\n   471→ * Uses: left_ala_nasi, right_ala_nasi, nasal_base, subnasale\n   472→ * Classification varies by ethnicity\n   473→ */\n   474→export function calculateNasalIndex(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n   475→  const left_ala_nasi = getLandmark(frontLandmarks, 'left_ala_nasi');\n   476→  const right_ala_nasi = getLandmark(frontLandmarks, 'right_ala_nasi');\n   477→  const nasal_base = getLandmark(frontLandmarks, 'nasal_base');\n   478→  const subnasale = getLandmark(frontLandmarks, 'subnasale');\n   479→\n   480→  if (!left_ala_nasi || !right_ala_nasi || !nasal_base || !subnasale) return null;\n   481→\n   482→  const nasal_width = distance(left_ala_nasi, right_ala_nasi);\n   483→  const nasal_height = distance(nasal_base, subnasale);\n   484→\n   485→  if (nasal_height === 0) return null;\n   486→\n   487→  const index = (nasal_width / nasal_height) * 100;\n   488→\n   489→  // Using mesorrhine (medium) as ideal: 70-85\n   490→  const idealMin = 70;\n   491→  const idealMax = 85;\n   492→\n   493→  let score: number;\n   494→  if (index >= idealMin && index <= idealMax) {\n   495→    score = 100;\n   496→  } else {\n   497→    const deviation = index < idealMin ? idealMin - index : index - idealMax;\n   498→    score = Math.max(0, 100 - deviation * 3);\n   499→  }\n   500→\n   501→  return {\n   502→    value: index,\n   503→    score,\n   504→    idealRange: { min: idealMin, max: idealMax },\n   505→    rating: getRating(score),\n   506→  };\n   507→}\n   508→\n   509→/**\n   510→ * Eye Canthal Tilt\n   511→ * Uses: left_canthus_medialis, left_canthus_lateralis (or right)\n   512→ * Ideal: 4° - 8° positive tilt\n   513→ */\n   514→export function calculateCanthalTilt(\n   515→  frontLandmarks: LandmarkPoint[],\n   516→  side: 'left' | 'right' = 'left'\n   517→): ScoreResult | null {\n   518→  const medialId = side === 'left' ? 'left_canthus_medialis' : 'right_canthus_medialis';\n   519→  const lateralId = side === 'left' ? 'left_canthus_lateralis' : 'right_canthus_lateralis';\n   520→\n   521→  const canthus_medialis = getLandmark(frontLandmarks, medialId);\n   522→  const canthus_lateralis = getLandmark(frontLandmarks, lateralId);\n   523→\n   524→  if (!canthus_medialis || !canthus_lateralis) return null;\n   525→\n   526→  // Y is inverted in screen coordinates\n   527→  const deltaY = canthus_medialis.y - canthus_lateralis.y;\n   528→  const deltaX = canthus_lateralis.x - canthus_medialis.x;\n   529→\n   530→  const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);\n   531→\n   532→  const idealMin = 4;\n   533→  const idealMax = 8;\n   534→\n   535→  let score: number;\n   536→  if (angle >= idealMin && angle <= idealMax) {\n   537→    score = 100;\n   538→  } else if (angle < 0) {\n   539→    // Negative tilt is worse\n   540→    score = Math.max(0, 50 + angle * 5);\n   541→  } else {\n   542→    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n   543→    score = Math.max(0, 100 - deviation * 10);\n   544→  }\n   545→\n   546→  return {\n   547→    value: angle,\n   548→    score,\n   549→    idealRange: { min: idealMin, max: idealMax },\n   550→    rating: getRating(score),\n   551→  };\n   552→}\n   553→\n   554→/**\n   555→ * Mouth Width to Nose Width Ratio\n   556→ * Uses: left_cheilion, right_cheilion, left_ala_nasi, right_ala_nasi\n   557→ * Ideal: 1.5 - 1.6\n   558→ */\n   559→export function calculateMouthNoseRatio(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n   560→  const left_cheilion = getLandmark(frontLandmarks, 'left_cheilion');\n   561→  const right_cheilion = getLandmark(frontLandmarks, 'right_cheilion');\n   562→  const left_ala_nasi = getLandmark(frontLandmarks, 'left_ala_nasi');\n   563→  const right_ala_nasi = getLandmark(frontLandmarks, 'right_ala_nasi');\n   564→\n   565→  if (!left_cheilion || !right_cheilion || !left_ala_nasi || !right_ala_nasi) return null;\n   566→\n   567→  const mouth_width = distance(left_cheilion, right_cheilion);\n   568→  const nose_width = distance(left_ala_nasi, right_ala_nasi);\n   569→\n   570→  if (nose_width === 0) return null;\n   571→\n   572→  const ratio = mouth_width / nose_width;\n   573→\n   574→  const idealMin = 1.5;\n   575→  const idealMax = 1.6;\n   576→\n   577→  let score: number;\n   578→  if (ratio >= idealMin && ratio <= idealMax) {\n   579→    score = 100;\n   580→  } else {\n   581→    const deviation = ratio < idealMin ? idealMin - ratio : ratio - idealMax;\n   582→    score = Math.max(0, 100 - deviation * 30);\n   583→  }\n   584→\n   585→  return {\n   586→    value: ratio,\n   587→    score,\n   588→    idealRange: { min: idealMin, max: idealMax },\n   589→    rating: getRating(score),\n   590→  };\n   591→}\n   592→\n   593→/**\n   594→ * Jaw Width to Face Width Ratio (Bigonial to Bizygomatic)\n   595→ * Uses: left_gonion_inferior, right_gonion_inferior, left_zygion, right_zygion\n   596→ * Ideal: 0.75 - 0.80 (male), 0.70 - 0.75 (female)\n   597→ */\n   598→export function calculateJawRatio(\n   599→  frontLandmarks: LandmarkPoint[],\n   600→  gender: 'male' | 'female' = 'male'\n   601→): ScoreResult | null {\n   602→  const left_gonion = getLandmark(frontLandmarks, 'left_gonion_inferior');\n   603→  const right_gonion = getLandmark(frontLandmarks, 'right_gonion_inferior');\n   604→  const left_zygion = getLandmark(frontLandmarks, 'left_zygion');\n   605→  const right_zygion = getLandmark(frontLandmarks, 'right_zygion');\n   606→\n   607→  if (!left_gonion || !right_gonion || !left_zygion || !right_zygion) return null;\n   608→\n   609→  const bigonial_width = distance(left_gonion, right_gonion);\n   610→  const bizygomatic_width = distance(left_zygion, right_zygion);\n   611→\n   612→  if (bizygomatic_width === 0) return null;\n   613→\n   614→  const ratio = bigonial_width / bizygomatic_width;\n   615→\n   616→  const idealMin = gender === 'male' ? 0.75 : 0.7;\n   617→  const idealMax = gender === 'male' ? 0.8 : 0.75;\n   618→\n   619→  let score: number;\n   620→  if (ratio >= idealMin && ratio <= idealMax) {\n   621→    score = 100;\n   622→  } else {\n   623→    const deviation = ratio < idealMin ? idealMin - ratio : ratio - idealMax;\n   624→    score = Math.max(0, 100 - deviation * 100);\n   625→  }\n   626→\n   627→  return {\n   628→    value: ratio,\n   629→    score,\n   630→    idealRange: { min: idealMin, max: idealMax },\n   631→    rating: getRating(score),\n   632→  };\n   633→}\n   634→\n   635→// ============================================\n   636→// COMPREHENSIVE ANALYSIS\n   637→// ============================================\n   638→\n   639→export interface FrontAnalysisResults {\n   640→  facialThirds: ReturnType<typeof calculateFacialThirds>;\n   641→  fwhr: ScoreResult | null;\n   642→  ipdRatio: ScoreResult | null;\n   643→  nasalIndex: ScoreResult | null;\n   644→  leftCanthalTilt: ScoreResult | null;\n   645→  rightCanthalTilt: ScoreResult | null;\n   646→  mouthNoseRatio: ScoreResult | null;\n   647→  jawRatio: ScoreResult | null;\n   648→  overallScore: number;\n   649→}\n   650→\n   651→export interface SideAnalysisResults {\n   652→  gonialAngle: ScoreResult | null;\n   653→  nasolabialAngle: ScoreResult | null;\n   654→  eLine: ReturnType<typeof calculateELine>;\n   655→  mentolabialAngle: ScoreResult | null;\n   656→  nasofrontalAngle: ScoreResult | null;\n   657→  overallScore: number;\n   658→}\n   659→\n   660→/**\n   661→ * Run all front profile analyses\n   662→ */\n   663→export function analyzeFrontProfile(\n   664→  frontLandmarks: LandmarkPoint[],\n   665→  gender: 'male' | 'female' = 'male'\n   666→): FrontAnalysisResults {\n   667→  const facialThirds = calculateFacialThirds(frontLandmarks);\n   668→  const fwhr = calculateFWHR(frontLandmarks);\n   669→  const ipdRatio = calculateIPDRatio(frontLandmarks);\n   670→  const nasalIndex = calculateNasalIndex(frontLandmarks);\n   671→  const leftCanthalTilt = calculateCanthalTilt(frontLandmarks, 'left');\n   672→  const rightCanthalTilt = calculateCanthalTilt(frontLandmarks, 'right');\n   673→  const mouthNoseRatio = calculateMouthNoseRatio(frontLandmarks);\n   674→  const jawRatio = calculateJawRatio(frontLandmarks, gender);\n   675→\n   676→  // Calculate overall score from valid results\n   677→  const scores: number[] = [];\n   678→  if (facialThirds) scores.push(facialThirds.overall.score);\n   679→  if (fwhr) scores.push(fwhr.score);\n   680→  if (ipdRatio) scores.push(ipdRatio.score);\n   681→  if (nasalIndex) scores.push(nasalIndex.score);\n   682→  if (leftCanthalTilt) scores.push(leftCanthalTilt.score);\n   683→  if (rightCanthalTilt) scores.push(rightCanthalTilt.score);\n   684→  if (mouthNoseRatio) scores.push(mouthNoseRatio.score);\n   685→  if (jawRatio) scores.push(jawRatio.score);\n   686→\n   687→  const overallScore = scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;\n   688→\n   689→  return {\n   690→    facialThirds,\n   691→    fwhr,\n   692→    ipdRatio,\n   693→    nasalIndex,\n   694→    leftCanthalTilt,\n   695→    rightCanthalTilt,\n   696→    mouthNoseRatio,\n   697→    jawRatio,\n   698→    overallScore,\n   699→  };\n   700→}\n   701→\n   702→/**\n   703→ * Run all side profile analyses\n   704→ */\n   705→export function analyzeSideProfile(\n   706→  sideLandmarks: LandmarkPoint[],\n   707→  gender: 'male' | 'female' = 'male'\n   708→): SideAnalysisResults {\n   709→  const gonialAngle = calculateGonialAngle(sideLandmarks, gender);\n   710→  const nasolabialAngle = calculateNasolabialAngle(sideLandmarks, gender);\n   711→  const eLine = calculateELine(sideLandmarks, gender);\n   712→  const mentolabialAngle = calculateMentolabialAngle(sideLandmarks);\n   713→  const nasofrontalAngle = calculateNasofrontalAngle(sideLandmarks);\n   714→\n   715→  // Calculate overall score from valid results\n   716→  const scores: number[] = [];\n   717→  if (gonialAngle) scores.push(gonialAngle.score);\n   718→  if (nasolabialAngle) scores.push(nasolabialAngle.score);\n   719→  if (eLine) scores.push(eLine.combined.score);\n   720→  if (mentolabialAngle) scores.push(mentolabialAngle.score);\n   721→  if (nasofrontalAngle) scores.push(nasofrontalAngle.score);\n   722→\n   723→  const overallScore = scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;\n   724→\n   725→  return {\n   726→    gonialAngle,\n   727→    nasolabialAngle,\n   728→    eLine,\n   729→    mentolabialAngle,\n   730→    nasofrontalAngle,\n   731→    overallScore,\n   732→  };\n   733→}\n   734→\n   735→// ============================================\n   736→// FACEIQ-STYLE BELL CURVE SCORING\n   737→// ============================================\n   738→\n   739→/**\n   740→ * Bell curve scoring function\n   741→ * score = e^(-0.5 × ((value-ideal)/stdDev)²) × 100\n   742→ */\n   743→export function calculateBellCurveScore(\n   744→  value: number,\n   745→  config: ScoringConfig\n   746→): number {\n   747→  const z = (value - config.idealValue) / config.standardDeviation;\n   748→  const bellCurve = Math.exp(-0.5 * z * z);\n   749→  return config.minScore + (config.maxScore - config.minScore) * bellCurve;\n   750→}\n   751→\n   752→/**\n   753→ * Get bell curve score with gender-specific ideal values\n   754→ */\n   755→export function calculateGenderAwareBellCurveScore(\n   756→  value: number,\n   757→  measurementKey: string,\n   758→  gender: 'male' | 'female'\n   759→): number {\n   760→  const idealValues = FACEIQ_IDEAL_VALUES[measurementKey];\n   761→  const config = FACEIQ_SCORING_CONFIGS[measurementKey];\n   762→\n   763→  if (!idealValues || !config) {\n   764→    return 0;\n   765→  }\n   766→\n   767→  const genderIdeal = idealValues[gender].ideal;\n   768→  const adjustedConfig = {\n   769→    ...config,\n   770→    idealValue: genderIdeal,\n   771→  };\n   772→\n   773→  return calculateBellCurveScore(value, adjustedConfig);\n   774→}\n   775→\n   776→/**\n   777→ * Calculate overall harmony score (weighted average)\n   778→ */\n   779→export function calculateHarmonyScore(\n   780→  scores: Record<string, number>\n   781→): number {\n   782→  let totalWeight = 0;\n   783→  let weightedSum = 0;\n   784→\n   785→  for (const [key, score] of Object.entries(scores)) {\n   786→    const config = FACEIQ_SCORING_CONFIGS[key];\n   787→    if (config) {\n   788→      weightedSum += score * config.weight;\n   789→      totalWeight += config.weight;\n   790→    }\n   791→  }\n   792→\n   793→  return totalWeight > 0 ? weightedSum / totalWeight : 0;\n   794→}\n   795→\n   796→// ============================================\n   797→// PERCENTILE RANKING (Population Comparison)\n   798→// ============================================\n   799→\n   800→/**\n   801→ * Standard normal CDF approximation (Abramowitz and Stegun formula)\n   802→ */\n   803→export function normalCDF(z: number): number {\n   804→  const a1 = 0.254829592;\n   805→  const a2 = -0.284496736;\n   806→  const a3 = 1.421413741;\n   807→  const a4 = -1.453152027;\n   808→  const a5 = 1.061405429;\n   809→  const p = 0.3275911;\n   810→\n   811→  const sign = z < 0 ? -1 : 1;\n   812→  const absZ = Math.abs(z) / Math.sqrt(2);\n   813→\n   814→  const t = 1.0 / (1.0 + p * absZ);\n   815→  const y =\n   816→    1.0 -\n   817→    ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-absZ * absZ);\n   818→\n   819→  return 0.5 * (1.0 + sign * y);\n   820→}\n   821→\n   822→/**\n   823→ * Calculate percentile (where you fall on the bell curve)\n   824→ */\n   825→export function calculatePercentile(\n   826→  value: number,\n   827→  stats: PopulationStats\n   828→): number {\n   829→  const z = (value - stats.mean) / stats.standardDeviation;\n   830→  return normalCDF(z) * 100;\n   831→}\n   832→\n   833→/**\n   834→ * Calculate percentile for a specific measurement\n   835→ */\n   836→export function calculateMeasurementPercentile(\n   837→  value: number,\n   838→  measurementKey: string\n   839→): number {\n   840→  const stats = POPULATION_STATS[measurementKey];\n   841→  if (!stats) {\n   842→    return 50; // Default to median if no stats available\n   843→  }\n   844→  return calculatePercentile(value, stats);\n   845→}\n   846→\n   847→// ============================================\n   848→// BELL CURVE DATA FOR VISUALIZATION\n   849→// ============================================\n   850→\n   851→export interface BellCurvePoint {\n   852→  x: number;\n   853→  y: number;\n   854→}\n   855→\n   856→export interface BellCurveData {\n   857→  points: BellCurvePoint[];\n   858→  userValue: number;\n   859→  userPercentile: number;\n   860→  mean: number;\n   861→  standardDeviation: number;\n   862→  idealValue?: number;\n   863→}\n   864→\n   865→/**\n   866→ * Generate bell curve data for visualization\n   867→ */\n   868→export function generateBellCurveData(\n   869→  stats: PopulationStats,\n   870→  userValue: number,\n   871→  idealValue?: number\n   872→): BellCurveData {\n   873→  const points: BellCurvePoint[] = [];\n   874→\n   875→  // Generate points from -4 to +4 standard deviations\n   876→  for (let i = -4; i <= 4; i += 0.1) {\n   877→    const x = stats.mean + i * stats.standardDeviation;\n   878→    const y =\n   879→      (1 / (stats.standardDeviation * Math.sqrt(2 * Math.PI))) *\n   880→      Math.exp(\n   881→        -0.5 * Math.pow((x - stats.mean) / stats.standardDeviation, 2)\n   882→      );\n   883→    points.push({ x, y });\n   884→  }\n   885→\n   886→  return {\n   887→    points,\n   888→    userValue,\n   889→    userPercentile: calculatePercentile(userValue, stats),\n   890→    mean: stats.mean,\n   891→    standardDeviation: stats.standardDeviation,\n   892→    idealValue,\n   893→  };\n   894→}\n   895→\n   896→/**\n   897→ * Generate bell curve data for a specific measurement\n   898→ */\n   899→export function generateMeasurementBellCurve(\n   900→  measurementKey: string,\n   901→  userValue: number,\n   902→  gender?: 'male' | 'female'\n   903→): BellCurveData | null {\n   904→  const stats = POPULATION_STATS[measurementKey];\n   905→  if (!stats) {\n   906→    return null;\n   907→  }\n   908→\n   909→  const idealValues = FACEIQ_IDEAL_VALUES[measurementKey];\n   910→  const idealValue = idealValues && gender ? idealValues[gender].ideal : undefined;\n   911→\n   912→  return generateBellCurveData(stats, userValue, idealValue);\n   913→}\n   914→\n   915→// ============================================\n   916→// ENHANCED SCORE RESULTS\n   917→// ============================================\n   918→\n   919→export interface EnhancedScoreResult extends ScoreResult {\n   920→  bellCurveScore: number;\n   921→  percentile: number;\n   922→  idealValue: number;\n   923→  deviation: number;\n   924→}\n   925→\n   926→/**\n   927→ * Create enhanced score result with bell curve and percentile\n   928→ */\n   929→export function createEnhancedScore(\n   930→  value: number,\n   931→  measurementKey: string,\n   932→  gender: 'male' | 'female' = 'male'\n   933→): EnhancedScoreResult | null {\n   934→  const config = FACEIQ_SCORING_CONFIGS[measurementKey];\n   935→  const idealValues = FACEIQ_IDEAL_VALUES[measurementKey];\n   936→  const stats = POPULATION_STATS[measurementKey];\n   937→\n   938→  if (!config) return null;\n   939→\n   940→  const idealValue = idealValues ? idealValues[gender].ideal : config.idealValue;\n   941→  const bellCurveScore = calculateBellCurveScore(value, {\n   942→    ...config,\n   943→    idealValue,\n   944→  });\n   945→  const percentile = stats ? calculatePercentile(value, stats) : 50;\n   946→  const deviation = value - idealValue;\n   947→\n   948→  return {\n   949→    value,\n   950→    score: bellCurveScore,\n   951→    idealRange: idealValues\n   952→      ? { min: idealValues[gender].range[0], max: idealValues[gender].range[1] }\n   953→      : { min: config.idealValue - config.standardDeviation, max: config.idealValue + config.standardDeviation },\n   954→    rating: getRating(bellCurveScore),\n   955→    bellCurveScore,\n   956→    percentile,\n   957→    idealValue,\n   958→    deviation,\n   959→  };\n   960→}\n   961→\n   962→// ============================================\n   963→// COMPREHENSIVE ANALYSIS WITH BELL CURVES\n   964→// ============================================\n   965→\n   966→export interface ComprehensiveFrontAnalysis extends FrontAnalysisResults {\n   967→  bellCurveScores: Record<string, number>;\n   968→  percentiles: Record<string, number>;\n   969→  harmonyScore: number;\n   970→}\n   971→\n   972→export interface ComprehensiveSideAnalysis extends SideAnalysisResults {\n   973→  bellCurveScores: Record<string, number>;\n   974→  percentiles: Record<string, number>;\n   975→  harmonyScore: number;\n   976→}\n   977→\n   978→/**\n   979→ * Run comprehensive front profile analysis with bell curves\n   980→ */\n   981→export function comprehensiveFrontAnalysis(\n   982→  frontLandmarks: LandmarkPoint[],\n   983→  gender: 'male' | 'female' = 'male'\n   984→): ComprehensiveFrontAnalysis {\n   985→  const baseAnalysis = analyzeFrontProfile(frontLandmarks, gender);\n   986→\n   987→  const bellCurveScores: Record<string, number> = {};\n   988→  const percentiles: Record<string, number> = {};\n   989→\n   990→  // Calculate bell curve scores for each measurement\n   991→  if (baseAnalysis.fwhr) {\n   992→    bellCurveScores.fwhr = calculateGenderAwareBellCurveScore(\n   993→      baseAnalysis.fwhr.value,\n   994→      'fwhr',\n   995→      gender\n   996→    );\n   997→    percentiles.fwhr = calculateMeasurementPercentile(\n   998→      baseAnalysis.fwhr.value,\n   999→      'fwhr'\n  1000→    );\n  1001→  }\n  1002→\n  1003→  if (baseAnalysis.leftCanthalTilt) {\n  1004→    bellCurveScores.canthalTilt = calculateGenderAwareBellCurveScore(\n  1005→      baseAnalysis.leftCanthalTilt.value,\n  1006→      'canthalTilt',\n  1007→      gender\n  1008→    );\n  1009→    percentiles.canthalTilt = calculateMeasurementPercentile(\n  1010→      baseAnalysis.leftCanthalTilt.value,\n  1011→      'canthalTilt'\n  1012→    );\n  1013→  }\n  1014→\n  1015→  if (baseAnalysis.nasalIndex) {\n  1016→    bellCurveScores.nasalIndex = calculateGenderAwareBellCurveScore(\n  1017→      baseAnalysis.nasalIndex.value,\n  1018→      'nasalIndex',\n  1019→      gender\n  1020→    );\n  1021→  }\n  1022→\n  1023→  const harmonyScore = calculateHarmonyScore(bellCurveScores);\n  1024→\n  1025→  return {\n  1026→    ...baseAnalysis,\n  1027→    bellCurveScores,\n  1028→    percentiles,\n  1029→    harmonyScore,\n  1030→  };\n  1031→}\n  1032→\n  1033→/**\n  1034→ * Run comprehensive side profile analysis with bell curves\n  1035→ */\n  1036→export function comprehensiveSideAnalysis(\n  1037→  sideLandmarks: LandmarkPoint[],\n  1038→  gender: 'male' | 'female' = 'male'\n  1039→): ComprehensiveSideAnalysis {\n  1040→  const baseAnalysis = analyzeSideProfile(sideLandmarks, gender);\n  1041→\n  1042→  const bellCurveScores: Record<string, number> = {};\n  1043→  const percentiles: Record<string, number> = {};\n  1044→\n  1045→  // Calculate bell curve scores for each measurement\n  1046→  if (baseAnalysis.gonialAngle) {\n  1047→    bellCurveScores.gonialAngle = calculateGenderAwareBellCurveScore(\n  1048→      baseAnalysis.gonialAngle.value,\n  1049→      'gonialAngle',\n  1050→      gender\n  1051→    );\n  1052→  }\n  1053→\n  1054→  if (baseAnalysis.nasolabialAngle) {\n  1055→    bellCurveScores.nasolabialAngle = calculateGenderAwareBellCurveScore(\n  1056→      baseAnalysis.nasolabialAngle.value,\n  1057→      'nasolabialAngle',\n  1058→      gender\n  1059→    );\n  1060→  }\n  1061→\n  1062→  const harmonyScore = calculateHarmonyScore(bellCurveScores);\n  1063→\n  1064→  return {\n  1065→    ...baseAnalysis,\n  1066→    bellCurveScores,\n  1067→    percentiles,\n  1068→    harmonyScore,\n  1069→  };\n  1070→}\n  1071→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"5fe925ff-65b0-4b00-baf1-04b0d922925a","timestamp":"2025-12-19T21:04:16.193Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring.ts","content":"/**\n * Facial Analysis Scoring Functions\n * Uses correct landmark IDs from landmarks.ts\n * Includes FaceIQ-style bell curve scoring and percentile ranking\n */\n\nimport {\n  LandmarkPoint,\n  ScoringConfig,\n  FACEIQ_SCORING_CONFIGS,\n  FACEIQ_IDEAL_VALUES,\n  PopulationStats,\n  POPULATION_STATS,\n} from './landmarks';\n\n// ============================================\n// UTILITY TYPES & FUNCTIONS\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport interface ScoreResult {\n  value: number;\n  score: number;\n  idealRange: { min: number; max: number };\n  rating: 'excellent' | 'good' | 'average' | 'below_average';\n}\n\n/**\n * Calculate distance between two points\n */\nexport function distance(p1: Point, p2: Point): number {\n  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n}\n\n/**\n * Calculate angle at vertex point (in degrees)\n * Angle is formed by points: p1 -> vertex -> p2\n */\nexport function calculateAngle(p1: Point, vertex: Point, p2: Point): number {\n  const v1 = { x: p1.x - vertex.x, y: p1.y - vertex.y };\n  const v2 = { x: p2.x - vertex.x, y: p2.y - vertex.y };\n\n  const dot = v1.x * v2.x + v1.y * v2.y;\n  const cross = v1.x * v2.y - v1.y * v2.x;\n\n  const angle = Math.atan2(cross, dot) * (180 / Math.PI);\n  return Math.abs(angle);\n}\n\n/**\n * Calculate perpendicular distance from point to line\n * Positive = in front of line, Negative = behind line\n */\nexport function perpendicularDistance(\n  point: Point,\n  lineStart: Point,\n  lineEnd: Point\n): number {\n  const A = point.x - lineStart.x;\n  const B = point.y - lineStart.y;\n  const C = lineEnd.x - lineStart.x;\n  const D = lineEnd.y - lineStart.y;\n\n  const dot = A * C + B * D;\n  const lenSq = C * C + D * D;\n  const param = lenSq !== 0 ? dot / lenSq : -1;\n\n  let xx: number, yy: number;\n\n  if (param < 0) {\n    xx = lineStart.x;\n    yy = lineStart.y;\n  } else if (param > 1) {\n    xx = lineEnd.x;\n    yy = lineEnd.y;\n  } else {\n    xx = lineStart.x + param * C;\n    yy = lineStart.y + param * D;\n  }\n\n  const dx = point.x - xx;\n  const dy = point.y - yy;\n\n  // Determine sign (positive = in front of line, negative = behind)\n  const sign =\n    (lineEnd.y - lineStart.y) * point.x -\n      (lineEnd.x - lineStart.x) * point.y +\n      lineEnd.x * lineStart.y -\n      lineEnd.y * lineStart.x >=\n    0\n      ? 1\n      : -1;\n\n  return sign * Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Get rating from score\n */\nfunction getRating(score: number): ScoreResult['rating'] {\n  if (score >= 90) return 'excellent';\n  if (score >= 75) return 'good';\n  if (score >= 50) return 'average';\n  return 'below_average';\n}\n\n/**\n * Helper to get landmark by ID from array\n */\nfunction getLandmark(landmarks: LandmarkPoint[], id: string): Point | null {\n  const lm = landmarks.find((l) => l.id === id);\n  return lm ? { x: lm.x, y: lm.y } : null;\n}\n\n// ============================================\n// SIDE PROFILE SCORING (uses _side suffix landmarks)\n// ============================================\n\n/**\n * Gonial Angle - Jaw angle measurement\n * Uses: tragion, gonion_inferior_side, menton_side\n * Ideal: 120° - 130° (male), 125° - 135° (female)\n */\nexport function calculateGonialAngle(\n  sideLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): ScoreResult | null {\n  const tragion = getLandmark(sideLandmarks, 'tragion');\n  const gonion_inferior = getLandmark(sideLandmarks, 'gonion_inferior_side');\n  const menton = getLandmark(sideLandmarks, 'menton_side');\n\n  if (!tragion || !gonion_inferior || !menton) return null;\n\n  const angle = calculateAngle(tragion, gonion_inferior, menton);\n\n  const idealMin = gender === 'male' ? 120 : 125;\n  const idealMax = gender === 'male' ? 130 : 135;\n\n  let score: number;\n  if (angle >= idealMin && angle <= idealMax) {\n    score = 100;\n  } else {\n    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n    score = Math.max(0, 100 - deviation * 5);\n  }\n\n  return {\n    value: angle,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n/**\n * Nasolabial Angle - Angle between columella and upper lip\n * Uses: columella_nasi, subnasale_side, labrale_superius_side\n * Ideal: 90° - 105° (male), 95° - 115° (female)\n */\nexport function calculateNasolabialAngle(\n  sideLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): ScoreResult | null {\n  const columella = getLandmark(sideLandmarks, 'columella_nasi');\n  const subnasale = getLandmark(sideLandmarks, 'subnasale_side');\n  const labrale_superius = getLandmark(sideLandmarks, 'labrale_superius_side');\n\n  if (!columella || !subnasale || !labrale_superius) return null;\n\n  const angle = calculateAngle(columella, subnasale, labrale_superius);\n\n  const idealMin = gender === 'male' ? 90 : 95;\n  const idealMax = gender === 'male' ? 105 : 115;\n\n  let score: number;\n  if (angle >= idealMin && angle <= idealMax) {\n    score = 100;\n  } else {\n    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n    score = Math.max(0, 100 - deviation * 4);\n  }\n\n  return {\n    value: angle,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n/**\n * E-Line (Ricketts' Esthetic Line) - Lip protrusion analysis\n * Uses: pronasale, pogonion, labrale_superius_side, labrale_inferius_side\n * Ideal: Upper lip 4mm behind (male) / 2mm behind (female)\n *        Lower lip 2mm behind (male) / 0mm (female)\n */\nexport function calculateELine(\n  sideLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): { upperLip: ScoreResult; lowerLip: ScoreResult; combined: ScoreResult } | null {\n  const pronasale = getLandmark(sideLandmarks, 'pronasale');\n  const pogonion = getLandmark(sideLandmarks, 'pogonion');\n  const labrale_superius = getLandmark(sideLandmarks, 'labrale_superius_side');\n  const labrale_inferius = getLandmark(sideLandmarks, 'labrale_inferius_side');\n\n  if (!pronasale || !pogonion || !labrale_superius || !labrale_inferius) return null;\n\n  const upperLipDistance = perpendicularDistance(labrale_superius, pronasale, pogonion);\n  const lowerLipDistance = perpendicularDistance(labrale_inferius, pronasale, pogonion);\n\n  // Ideal values (negative = behind the line, which is desirable)\n  const idealUpperLip = gender === 'male' ? -4 : -2;\n  const idealLowerLip = gender === 'male' ? -2 : 0;\n  const tolerance = 2;\n\n  // Upper lip scoring\n  const upperDeviation = Math.abs(upperLipDistance - idealUpperLip);\n  const upperScore =\n    upperDeviation <= tolerance\n      ? 100\n      : Math.max(0, 100 - (upperDeviation - tolerance) * 10);\n\n  // Lower lip scoring\n  const lowerDeviation = Math.abs(lowerLipDistance - idealLowerLip);\n  const lowerScore =\n    lowerDeviation <= tolerance\n      ? 100\n      : Math.max(0, 100 - (lowerDeviation - tolerance) * 10);\n\n  const combinedScore = (upperScore + lowerScore) / 2;\n\n  return {\n    upperLip: {\n      value: upperLipDistance,\n      score: upperScore,\n      idealRange: { min: idealUpperLip - tolerance, max: idealUpperLip + tolerance },\n      rating: getRating(upperScore),\n    },\n    lowerLip: {\n      value: lowerLipDistance,\n      score: lowerScore,\n      idealRange: { min: idealLowerLip - tolerance, max: idealLowerLip + tolerance },\n      rating: getRating(lowerScore),\n    },\n    combined: {\n      value: (upperLipDistance + lowerLipDistance) / 2,\n      score: combinedScore,\n      idealRange: { min: -6, max: 2 },\n      rating: getRating(combinedScore),\n    },\n  };\n}\n\n/**\n * Mentolabial Angle - Angle at the labiomental fold\n * Uses: labrale_inferius_side, sublabiale, pogonion\n * Ideal: 120° - 140°\n */\nexport function calculateMentolabialAngle(\n  sideLandmarks: LandmarkPoint[]\n): ScoreResult | null {\n  const labrale_inferius = getLandmark(sideLandmarks, 'labrale_inferius_side');\n  const sublabiale = getLandmark(sideLandmarks, 'sublabiale');\n  const pogonion = getLandmark(sideLandmarks, 'pogonion');\n\n  if (!labrale_inferius || !sublabiale || !pogonion) return null;\n\n  const angle = calculateAngle(labrale_inferius, sublabiale, pogonion);\n\n  const idealMin = 120;\n  const idealMax = 140;\n\n  let score: number;\n  if (angle >= idealMin && angle <= idealMax) {\n    score = 100;\n  } else {\n    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n    score = Math.max(0, 100 - deviation * 3);\n  }\n\n  return {\n    value: angle,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n/**\n * Nasofrontal Angle - Angle at the bridge of nose\n * Uses: glabella, nasion, rhinion\n * Ideal: 115° - 135°\n */\nexport function calculateNasofrontalAngle(\n  sideLandmarks: LandmarkPoint[]\n): ScoreResult | null {\n  const glabella = getLandmark(sideLandmarks, 'glabella');\n  const nasion = getLandmark(sideLandmarks, 'nasion');\n  const rhinion = getLandmark(sideLandmarks, 'rhinion');\n\n  if (!glabella || !nasion || !rhinion) return null;\n\n  const angle = calculateAngle(glabella, nasion, rhinion);\n\n  const idealMin = 115;\n  const idealMax = 135;\n\n  let score: number;\n  if (angle >= idealMin && angle <= idealMax) {\n    score = 100;\n  } else {\n    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n    score = Math.max(0, 100 - deviation * 3);\n  }\n\n  return {\n    value: angle,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n// ============================================\n// FRONT PROFILE SCORING (uses front landmarks)\n// ============================================\n\n/**\n * Facial Thirds - Vertical face proportions\n * Uses: trichion, glabella (approx from nasion), subnasale, menton\n * Ideal: Each third ~33%\n * Note: For front profile, we use nasal_base as proxy for glabella area\n */\nexport function calculateFacialThirds(\n  frontLandmarks: LandmarkPoint[]\n): { upper: ScoreResult; middle: ScoreResult; lower: ScoreResult; overall: ScoreResult } | null {\n  const trichion = getLandmark(frontLandmarks, 'trichion');\n  const nasal_base = getLandmark(frontLandmarks, 'nasal_base'); // Using as glabella proxy\n  const subnasale = getLandmark(frontLandmarks, 'subnasale');\n  const menton = getLandmark(frontLandmarks, 'menton');\n\n  if (!trichion || !nasal_base || !subnasale || !menton) return null;\n\n  const totalHeight = distance(trichion, menton);\n  if (totalHeight === 0) return null;\n\n  const upperThird = (distance(trichion, nasal_base) / totalHeight) * 100;\n  const middleThird = (distance(nasal_base, subnasale) / totalHeight) * 100;\n  const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n\n  const ideal = 33.33;\n  const tolerance = 3;\n\n  const scoreThird = (value: number): number => {\n    const deviation = Math.abs(value - ideal);\n    return deviation <= tolerance ? 100 : Math.max(0, 100 - (deviation - tolerance) * 8);\n  };\n\n  const upperScore = scoreThird(upperThird);\n  const middleScore = scoreThird(middleThird);\n  const lowerScore = scoreThird(lowerThird);\n  const overallScore = (upperScore + middleScore + lowerScore) / 3;\n\n  return {\n    upper: {\n      value: upperThird,\n      score: upperScore,\n      idealRange: { min: 30, max: 36 },\n      rating: getRating(upperScore),\n    },\n    middle: {\n      value: middleThird,\n      score: middleScore,\n      idealRange: { min: 30, max: 36 },\n      rating: getRating(middleScore),\n    },\n    lower: {\n      value: lowerThird,\n      score: lowerScore,\n      idealRange: { min: 30, max: 36 },\n      rating: getRating(lowerScore),\n    },\n    overall: {\n      value: Math.max(Math.abs(upperThird - ideal), Math.abs(middleThird - ideal), Math.abs(lowerThird - ideal)),\n      score: overallScore,\n      idealRange: { min: 0, max: 3 },\n      rating: getRating(overallScore),\n    },\n  };\n}\n\n/**\n * Facial Width-to-Height Ratio (FWHR)\n * Uses: left_zygion, right_zygion, nasal_base (as upper bound), labrale_superius\n * Ideal: 1.8 - 2.0\n */\nexport function calculateFWHR(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n  const left_zygion = getLandmark(frontLandmarks, 'left_zygion');\n  const right_zygion = getLandmark(frontLandmarks, 'right_zygion');\n  const nasal_base = getLandmark(frontLandmarks, 'nasal_base');\n  const labrale_superius = getLandmark(frontLandmarks, 'labrale_superius');\n\n  if (!left_zygion || !right_zygion || !nasal_base || !labrale_superius) return null;\n\n  const bizygomatic_width = distance(left_zygion, right_zygion);\n  const upper_face_height = distance(nasal_base, labrale_superius);\n\n  if (upper_face_height === 0) return null;\n\n  const ratio = bizygomatic_width / upper_face_height;\n\n  const idealMin = 1.8;\n  const idealMax = 2.0;\n\n  let score: number;\n  if (ratio >= idealMin && ratio <= idealMax) {\n    score = 100;\n  } else {\n    const deviation = ratio < idealMin ? idealMin - ratio : ratio - idealMax;\n    score = Math.max(0, 100 - deviation * 50);\n  }\n\n  return {\n    value: ratio,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n/**\n * Interpupillary Distance Ratio\n * Uses: left_pupila, right_pupila, left_zygion, right_zygion\n * Ideal: IPD ~46% of bizygomatic width\n */\nexport function calculateIPDRatio(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n  const left_pupila = getLandmark(frontLandmarks, 'left_pupila');\n  const right_pupila = getLandmark(frontLandmarks, 'right_pupila');\n  const left_zygion = getLandmark(frontLandmarks, 'left_zygion');\n  const right_zygion = getLandmark(frontLandmarks, 'right_zygion');\n\n  if (!left_pupila || !right_pupila || !left_zygion || !right_zygion) return null;\n\n  const ipd = distance(left_pupila, right_pupila);\n  const bizygomatic_width = distance(left_zygion, right_zygion);\n\n  if (bizygomatic_width === 0) return null;\n\n  const ratio = (ipd / bizygomatic_width) * 100;\n\n  const ideal = 46;\n  const tolerance = 2;\n\n  const deviation = Math.abs(ratio - ideal);\n  const score = deviation <= tolerance ? 100 : Math.max(0, 100 - (deviation - tolerance) * 8);\n\n  return {\n    value: ratio,\n    score,\n    idealRange: { min: 44, max: 48 },\n    rating: getRating(score),\n  };\n}\n\n/**\n * Nasal Index (Nose Width to Height)\n * Uses: left_ala_nasi, right_ala_nasi, nasal_base, subnasale\n * Classification varies by ethnicity\n */\nexport function calculateNasalIndex(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n  const left_ala_nasi = getLandmark(frontLandmarks, 'left_ala_nasi');\n  const right_ala_nasi = getLandmark(frontLandmarks, 'right_ala_nasi');\n  const nasal_base = getLandmark(frontLandmarks, 'nasal_base');\n  const subnasale = getLandmark(frontLandmarks, 'subnasale');\n\n  if (!left_ala_nasi || !right_ala_nasi || !nasal_base || !subnasale) return null;\n\n  const nasal_width = distance(left_ala_nasi, right_ala_nasi);\n  const nasal_height = distance(nasal_base, subnasale);\n\n  if (nasal_height === 0) return null;\n\n  const index = (nasal_width / nasal_height) * 100;\n\n  // Using mesorrhine (medium) as ideal: 70-85\n  const idealMin = 70;\n  const idealMax = 85;\n\n  let score: number;\n  if (index >= idealMin && index <= idealMax) {\n    score = 100;\n  } else {\n    const deviation = index < idealMin ? idealMin - index : index - idealMax;\n    score = Math.max(0, 100 - deviation * 3);\n  }\n\n  return {\n    value: index,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n/**\n * Eye Canthal Tilt\n * Uses: left_canthus_medialis, left_canthus_lateralis (or right)\n * Ideal: 4° - 8° positive tilt\n */\nexport function calculateCanthalTilt(\n  frontLandmarks: LandmarkPoint[],\n  side: 'left' | 'right' = 'left'\n): ScoreResult | null {\n  const medialId = side === 'left' ? 'left_canthus_medialis' : 'right_canthus_medialis';\n  const lateralId = side === 'left' ? 'left_canthus_lateralis' : 'right_canthus_lateralis';\n\n  const canthus_medialis = getLandmark(frontLandmarks, medialId);\n  const canthus_lateralis = getLandmark(frontLandmarks, lateralId);\n\n  if (!canthus_medialis || !canthus_lateralis) return null;\n\n  // Y is inverted in screen coordinates\n  const deltaY = canthus_medialis.y - canthus_lateralis.y;\n  const deltaX = canthus_lateralis.x - canthus_medialis.x;\n\n  const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);\n\n  const idealMin = 4;\n  const idealMax = 8;\n\n  let score: number;\n  if (angle >= idealMin && angle <= idealMax) {\n    score = 100;\n  } else if (angle < 0) {\n    // Negative tilt is worse\n    score = Math.max(0, 50 + angle * 5);\n  } else {\n    const deviation = angle < idealMin ? idealMin - angle : angle - idealMax;\n    score = Math.max(0, 100 - deviation * 10);\n  }\n\n  return {\n    value: angle,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n/**\n * Mouth Width to Nose Width Ratio\n * Uses: left_cheilion, right_cheilion, left_ala_nasi, right_ala_nasi\n * Ideal: 1.5 - 1.6\n */\nexport function calculateMouthNoseRatio(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n  const left_cheilion = getLandmark(frontLandmarks, 'left_cheilion');\n  const right_cheilion = getLandmark(frontLandmarks, 'right_cheilion');\n  const left_ala_nasi = getLandmark(frontLandmarks, 'left_ala_nasi');\n  const right_ala_nasi = getLandmark(frontLandmarks, 'right_ala_nasi');\n\n  if (!left_cheilion || !right_cheilion || !left_ala_nasi || !right_ala_nasi) return null;\n\n  const mouth_width = distance(left_cheilion, right_cheilion);\n  const nose_width = distance(left_ala_nasi, right_ala_nasi);\n\n  if (nose_width === 0) return null;\n\n  const ratio = mouth_width / nose_width;\n\n  const idealMin = 1.5;\n  const idealMax = 1.6;\n\n  let score: number;\n  if (ratio >= idealMin && ratio <= idealMax) {\n    score = 100;\n  } else {\n    const deviation = ratio < idealMin ? idealMin - ratio : ratio - idealMax;\n    score = Math.max(0, 100 - deviation * 30);\n  }\n\n  return {\n    value: ratio,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n/**\n * Jaw Width to Face Width Ratio (Bigonial to Bizygomatic)\n * Uses: left_gonion_inferior, right_gonion_inferior, left_zygion, right_zygion\n * Ideal: 0.75 - 0.80 (male), 0.70 - 0.75 (female)\n */\nexport function calculateJawRatio(\n  frontLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): ScoreResult | null {\n  const left_gonion = getLandmark(frontLandmarks, 'left_gonion_inferior');\n  const right_gonion = getLandmark(frontLandmarks, 'right_gonion_inferior');\n  const left_zygion = getLandmark(frontLandmarks, 'left_zygion');\n  const right_zygion = getLandmark(frontLandmarks, 'right_zygion');\n\n  if (!left_gonion || !right_gonion || !left_zygion || !right_zygion) return null;\n\n  const bigonial_width = distance(left_gonion, right_gonion);\n  const bizygomatic_width = distance(left_zygion, right_zygion);\n\n  if (bizygomatic_width === 0) return null;\n\n  const ratio = bigonial_width / bizygomatic_width;\n\n  const idealMin = gender === 'male' ? 0.75 : 0.7;\n  const idealMax = gender === 'male' ? 0.8 : 0.75;\n\n  let score: number;\n  if (ratio >= idealMin && ratio <= idealMax) {\n    score = 100;\n  } else {\n    const deviation = ratio < idealMin ? idealMin - ratio : ratio - idealMax;\n    score = Math.max(0, 100 - deviation * 100);\n  }\n\n  return {\n    value: ratio,\n    score,\n    idealRange: { min: idealMin, max: idealMax },\n    rating: getRating(score),\n  };\n}\n\n// ============================================\n// COMPREHENSIVE ANALYSIS\n// ============================================\n\nexport interface FrontAnalysisResults {\n  facialThirds: ReturnType<typeof calculateFacialThirds>;\n  fwhr: ScoreResult | null;\n  ipdRatio: ScoreResult | null;\n  nasalIndex: ScoreResult | null;\n  leftCanthalTilt: ScoreResult | null;\n  rightCanthalTilt: ScoreResult | null;\n  mouthNoseRatio: ScoreResult | null;\n  jawRatio: ScoreResult | null;\n  overallScore: number;\n}\n\nexport interface SideAnalysisResults {\n  gonialAngle: ScoreResult | null;\n  nasolabialAngle: ScoreResult | null;\n  eLine: ReturnType<typeof calculateELine>;\n  mentolabialAngle: ScoreResult | null;\n  nasofrontalAngle: ScoreResult | null;\n  overallScore: number;\n}\n\n/**\n * Run all front profile analyses\n */\nexport function analyzeFrontProfile(\n  frontLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): FrontAnalysisResults {\n  const facialThirds = calculateFacialThirds(frontLandmarks);\n  const fwhr = calculateFWHR(frontLandmarks);\n  const ipdRatio = calculateIPDRatio(frontLandmarks);\n  const nasalIndex = calculateNasalIndex(frontLandmarks);\n  const leftCanthalTilt = calculateCanthalTilt(frontLandmarks, 'left');\n  const rightCanthalTilt = calculateCanthalTilt(frontLandmarks, 'right');\n  const mouthNoseRatio = calculateMouthNoseRatio(frontLandmarks);\n  const jawRatio = calculateJawRatio(frontLandmarks, gender);\n\n  // Calculate overall score from valid results\n  const scores: number[] = [];\n  if (facialThirds) scores.push(facialThirds.overall.score);\n  if (fwhr) scores.push(fwhr.score);\n  if (ipdRatio) scores.push(ipdRatio.score);\n  if (nasalIndex) scores.push(nasalIndex.score);\n  if (leftCanthalTilt) scores.push(leftCanthalTilt.score);\n  if (rightCanthalTilt) scores.push(rightCanthalTilt.score);\n  if (mouthNoseRatio) scores.push(mouthNoseRatio.score);\n  if (jawRatio) scores.push(jawRatio.score);\n\n  const overallScore = scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;\n\n  return {\n    facialThirds,\n    fwhr,\n    ipdRatio,\n    nasalIndex,\n    leftCanthalTilt,\n    rightCanthalTilt,\n    mouthNoseRatio,\n    jawRatio,\n    overallScore,\n  };\n}\n\n/**\n * Run all side profile analyses\n */\nexport function analyzeSideProfile(\n  sideLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): SideAnalysisResults {\n  const gonialAngle = calculateGonialAngle(sideLandmarks, gender);\n  const nasolabialAngle = calculateNasolabialAngle(sideLandmarks, gender);\n  const eLine = calculateELine(sideLandmarks, gender);\n  const mentolabialAngle = calculateMentolabialAngle(sideLandmarks);\n  const nasofrontalAngle = calculateNasofrontalAngle(sideLandmarks);\n\n  // Calculate overall score from valid results\n  const scores: number[] = [];\n  if (gonialAngle) scores.push(gonialAngle.score);\n  if (nasolabialAngle) scores.push(nasolabialAngle.score);\n  if (eLine) scores.push(eLine.combined.score);\n  if (mentolabialAngle) scores.push(mentolabialAngle.score);\n  if (nasofrontalAngle) scores.push(nasofrontalAngle.score);\n\n  const overallScore = scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;\n\n  return {\n    gonialAngle,\n    nasolabialAngle,\n    eLine,\n    mentolabialAngle,\n    nasofrontalAngle,\n    overallScore,\n  };\n}\n\n// ============================================\n// FACEIQ-STYLE BELL CURVE SCORING\n// ============================================\n\n/**\n * Bell curve scoring function\n * score = e^(-0.5 × ((value-ideal)/stdDev)²) × 100\n */\nexport function calculateBellCurveScore(\n  value: number,\n  config: ScoringConfig\n): number {\n  const z = (value - config.idealValue) / config.standardDeviation;\n  const bellCurve = Math.exp(-0.5 * z * z);\n  return config.minScore + (config.maxScore - config.minScore) * bellCurve;\n}\n\n/**\n * Get bell curve score with gender-specific ideal values\n */\nexport function calculateGenderAwareBellCurveScore(\n  value: number,\n  measurementKey: string,\n  gender: 'male' | 'female'\n): number {\n  const idealValues = FACEIQ_IDEAL_VALUES[measurementKey];\n  const config = FACEIQ_SCORING_CONFIGS[measurementKey];\n\n  if (!idealValues || !config) {\n    return 0;\n  }\n\n  const genderIdeal = idealValues[gender].ideal;\n  const adjustedConfig = {\n    ...config,\n    idealValue: genderIdeal,\n  };\n\n  return calculateBellCurveScore(value, adjustedConfig);\n}\n\n/**\n * Calculate overall harmony score (weighted average)\n */\nexport function calculateHarmonyScore(\n  scores: Record<string, number>\n): number {\n  let totalWeight = 0;\n  let weightedSum = 0;\n\n  for (const [key, score] of Object.entries(scores)) {\n    const config = FACEIQ_SCORING_CONFIGS[key];\n    if (config) {\n      weightedSum += score * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  return totalWeight > 0 ? weightedSum / totalWeight : 0;\n}\n\n// ============================================\n// PERCENTILE RANKING (Population Comparison)\n// ============================================\n\n/**\n * Standard normal CDF approximation (Abramowitz and Stegun formula)\n */\nexport function normalCDF(z: number): number {\n  const a1 = 0.254829592;\n  const a2 = -0.284496736;\n  const a3 = 1.421413741;\n  const a4 = -1.453152027;\n  const a5 = 1.061405429;\n  const p = 0.3275911;\n\n  const sign = z < 0 ? -1 : 1;\n  const absZ = Math.abs(z) / Math.sqrt(2);\n\n  const t = 1.0 / (1.0 + p * absZ);\n  const y =\n    1.0 -\n    ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-absZ * absZ);\n\n  return 0.5 * (1.0 + sign * y);\n}\n\n/**\n * Calculate percentile (where you fall on the bell curve)\n */\nexport function calculatePercentile(\n  value: number,\n  stats: PopulationStats\n): number {\n  const z = (value - stats.mean) / stats.standardDeviation;\n  return normalCDF(z) * 100;\n}\n\n/**\n * Calculate percentile for a specific measurement\n */\nexport function calculateMeasurementPercentile(\n  value: number,\n  measurementKey: string\n): number {\n  const stats = POPULATION_STATS[measurementKey];\n  if (!stats) {\n    return 50; // Default to median if no stats available\n  }\n  return calculatePercentile(value, stats);\n}\n\n// ============================================\n// BELL CURVE DATA FOR VISUALIZATION\n// ============================================\n\nexport interface BellCurvePoint {\n  x: number;\n  y: number;\n}\n\nexport interface BellCurveData {\n  points: BellCurvePoint[];\n  userValue: number;\n  userPercentile: number;\n  mean: number;\n  standardDeviation: number;\n  idealValue?: number;\n}\n\n/**\n * Generate bell curve data for visualization\n */\nexport function generateBellCurveData(\n  stats: PopulationStats,\n  userValue: number,\n  idealValue?: number\n): BellCurveData {\n  const points: BellCurvePoint[] = [];\n\n  // Generate points from -4 to +4 standard deviations\n  for (let i = -4; i <= 4; i += 0.1) {\n    const x = stats.mean + i * stats.standardDeviation;\n    const y =\n      (1 / (stats.standardDeviation * Math.sqrt(2 * Math.PI))) *\n      Math.exp(\n        -0.5 * Math.pow((x - stats.mean) / stats.standardDeviation, 2)\n      );\n    points.push({ x, y });\n  }\n\n  return {\n    points,\n    userValue,\n    userPercentile: calculatePercentile(userValue, stats),\n    mean: stats.mean,\n    standardDeviation: stats.standardDeviation,\n    idealValue,\n  };\n}\n\n/**\n * Generate bell curve data for a specific measurement\n */\nexport function generateMeasurementBellCurve(\n  measurementKey: string,\n  userValue: number,\n  gender?: 'male' | 'female'\n): BellCurveData | null {\n  const stats = POPULATION_STATS[measurementKey];\n  if (!stats) {\n    return null;\n  }\n\n  const idealValues = FACEIQ_IDEAL_VALUES[measurementKey];\n  const idealValue = idealValues && gender ? idealValues[gender].ideal : undefined;\n\n  return generateBellCurveData(stats, userValue, idealValue);\n}\n\n// ============================================\n// ENHANCED SCORE RESULTS\n// ============================================\n\nexport interface EnhancedScoreResult extends ScoreResult {\n  bellCurveScore: number;\n  percentile: number;\n  idealValue: number;\n  deviation: number;\n}\n\n/**\n * Create enhanced score result with bell curve and percentile\n */\nexport function createEnhancedScore(\n  value: number,\n  measurementKey: string,\n  gender: 'male' | 'female' = 'male'\n): EnhancedScoreResult | null {\n  const config = FACEIQ_SCORING_CONFIGS[measurementKey];\n  const idealValues = FACEIQ_IDEAL_VALUES[measurementKey];\n  const stats = POPULATION_STATS[measurementKey];\n\n  if (!config) return null;\n\n  const idealValue = idealValues ? idealValues[gender].ideal : config.idealValue;\n  const bellCurveScore = calculateBellCurveScore(value, {\n    ...config,\n    idealValue,\n  });\n  const percentile = stats ? calculatePercentile(value, stats) : 50;\n  const deviation = value - idealValue;\n\n  return {\n    value,\n    score: bellCurveScore,\n    idealRange: idealValues\n      ? { min: idealValues[gender].range[0], max: idealValues[gender].range[1] }\n      : { min: config.idealValue - config.standardDeviation, max: config.idealValue + config.standardDeviation },\n    rating: getRating(bellCurveScore),\n    bellCurveScore,\n    percentile,\n    idealValue,\n    deviation,\n  };\n}\n\n// ============================================\n// COMPREHENSIVE ANALYSIS WITH BELL CURVES\n// ============================================\n\nexport interface ComprehensiveFrontAnalysis extends FrontAnalysisResults {\n  bellCurveScores: Record<string, number>;\n  percentiles: Record<string, number>;\n  harmonyScore: number;\n}\n\nexport interface ComprehensiveSideAnalysis extends SideAnalysisResults {\n  bellCurveScores: Record<string, number>;\n  percentiles: Record<string, number>;\n  harmonyScore: number;\n}\n\n/**\n * Run comprehensive front profile analysis with bell curves\n */\nexport function comprehensiveFrontAnalysis(\n  frontLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): ComprehensiveFrontAnalysis {\n  const baseAnalysis = analyzeFrontProfile(frontLandmarks, gender);\n\n  const bellCurveScores: Record<string, number> = {};\n  const percentiles: Record<string, number> = {};\n\n  // Calculate bell curve scores for each measurement\n  if (baseAnalysis.fwhr) {\n    bellCurveScores.fwhr = calculateGenderAwareBellCurveScore(\n      baseAnalysis.fwhr.value,\n      'fwhr',\n      gender\n    );\n    percentiles.fwhr = calculateMeasurementPercentile(\n      baseAnalysis.fwhr.value,\n      'fwhr'\n    );\n  }\n\n  if (baseAnalysis.leftCanthalTilt) {\n    bellCurveScores.canthalTilt = calculateGenderAwareBellCurveScore(\n      baseAnalysis.leftCanthalTilt.value,\n      'canthalTilt',\n      gender\n    );\n    percentiles.canthalTilt = calculateMeasurementPercentile(\n      baseAnalysis.leftCanthalTilt.value,\n      'canthalTilt'\n    );\n  }\n\n  if (baseAnalysis.nasalIndex) {\n    bellCurveScores.nasalIndex = calculateGenderAwareBellCurveScore(\n      baseAnalysis.nasalIndex.value,\n      'nasalIndex',\n      gender\n    );\n  }\n\n  const harmonyScore = calculateHarmonyScore(bellCurveScores);\n\n  return {\n    ...baseAnalysis,\n    bellCurveScores,\n    percentiles,\n    harmonyScore,\n  };\n}\n\n/**\n * Run comprehensive side profile analysis with bell curves\n */\nexport function comprehensiveSideAnalysis(\n  sideLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): ComprehensiveSideAnalysis {\n  const baseAnalysis = analyzeSideProfile(sideLandmarks, gender);\n\n  const bellCurveScores: Record<string, number> = {};\n  const percentiles: Record<string, number> = {};\n\n  // Calculate bell curve scores for each measurement\n  if (baseAnalysis.gonialAngle) {\n    bellCurveScores.gonialAngle = calculateGenderAwareBellCurveScore(\n      baseAnalysis.gonialAngle.value,\n      'gonialAngle',\n      gender\n    );\n  }\n\n  if (baseAnalysis.nasolabialAngle) {\n    bellCurveScores.nasolabialAngle = calculateGenderAwareBellCurveScore(\n      baseAnalysis.nasolabialAngle.value,\n      'nasolabialAngle',\n      gender\n    );\n  }\n\n  const harmonyScore = calculateHarmonyScore(bellCurveScores);\n\n  return {\n    ...baseAnalysis,\n    bellCurveScores,\n    percentiles,\n    harmonyScore,\n  };\n}\n","numLines":1071,"startLine":1,"totalLines":1071}}}
{"parentUuid":"5fe925ff-65b0-4b00-baf1-04b0d922925a","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_012pW9F9H7MFS8mPK4xEXHrU","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me search for any reference documentation or external resources that might contain the original landmarkers.js:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":9087,"cache_creation_input_tokens":30936,"cache_read_input_tokens":21873,"cache_creation":{"ephemeral_5m_input_tokens":30936,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWGiww95fvT9GGEsNKpRi","type":"assistant","uuid":"5d26d133-c0e5-4645-b270-b29fe0482d6d","timestamp":"2025-12-19T21:04:18.403Z"}
{"parentUuid":"5d26d133-c0e5-4645-b270-b29fe0482d6d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_012pW9F9H7MFS8mPK4xEXHrU","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UGyL1yfwAPuBCYwjAnmhft","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/TECHNICAL_SPECS.md"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":9087,"cache_creation_input_tokens":30936,"cache_read_input_tokens":21873,"cache_creation":{"ephemeral_5m_input_tokens":30936,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWGiww95fvT9GGEsNKpRi","type":"assistant","uuid":"7208ffd3-56ae-457f-a1cf-43407309006c","timestamp":"2025-12-19T21:04:18.920Z"}
{"parentUuid":"7208ffd3-56ae-457f-a1cf-43407309006c","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_012pW9F9H7MFS8mPK4xEXHrU","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Y6bncGhX9BpwLN5fVMErbG","name":"Bash","input":{"command":"find /Users/imorgado/LOOKSMAXX/looksmaxx-app -type f -name \"*.html\" -o -name \"*.md\" | grep -v node_modules | head -20"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":9087,"cache_creation_input_tokens":30936,"cache_read_input_tokens":21873,"cache_creation":{"ephemeral_5m_input_tokens":30936,"ephemeral_1h_input_tokens":0},"output_tokens":177,"service_tier":"standard"}},"requestId":"req_011CWGiww95fvT9GGEsNKpRi","type":"assistant","uuid":"48049da3-ff03-4ff1-8055-c73e193c3214","timestamp":"2025-12-19T21:04:19.306Z"}
{"parentUuid":"48049da3-ff03-4ff1-8055-c73e193c3214","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UGyL1yfwAPuBCYwjAnmhft","type":"tool_result","content":"     1→# FaceIQ Labs - Technical Specification Document\n     2→## Reverse-Engineered Facial Analysis System\n     3→\n     4→**Document Version:** 1.0\n     5→**Date:** December 2024\n     6→**Source:** Reverse-engineered from beta.faceiqlabs.com\n     7→\n     8→---\n     9→\n    10→## Table of Contents\n    11→\n    12→1. [System Architecture](#1-system-architecture)\n    13→2. [Data Flow Pipeline](#2-data-flow-pipeline)\n    14→3. [Core Scoring Engine](#3-core-scoring-engine)\n    15→4. [Landmark Detection System](#4-landmark-detection-system)\n    16→5. [Ratio Calculation Functions](#5-ratio-calculation-functions)\n    17→6. [Decoded Scoring Standards Database](#6-decoded-scoring-standards-database)\n    18→7. [Implementation Strategy](#7-implementation-strategy)\n    19→8. [API Reference](#8-api-reference)\n    20→\n    21→---\n    22→\n    23→## 1. System Architecture\n    24→\n    25→### 1.1 Hybrid Processing Model\n    26→\n    27→The system uses a **hybrid architecture** that splits processing between client and server:\n    28→\n    29→```\n    30→┌─────────────────────────────────────────────────────────────────────────────┐\n    31→│                           FACIAL ANALYSIS SYSTEM                            │\n    32→├─────────────────────────────────────────────────────────────────────────────┤\n    33→│                                                                             │\n    34→│  ┌─────────────────────────────┐    ┌─────────────────────────────────┐   │\n    35→│  │     CLIENT-SIDE (Browser)   │    │      SERVER-SIDE (API)          │   │\n    36→│  ├─────────────────────────────┤    ├─────────────────────────────────┤   │\n    37→│  │                             │    │                                 │   │\n    38→│  │  ┌───────────────────────┐  │    │  ┌───────────────────────────┐ │   │\n    39→│  │  │   MediaPipe WASM      │  │    │  │  Custom Landmark Model    │ │   │\n    40→│  │  │   FaceLandmarker      │  │    │  │  (Side Profile)           │ │   │\n    41→│  │  └───────────────────────┘  │    │  └───────────────────────────┘ │   │\n    42→│  │            │                │    │              │                 │   │\n    43→│  │            ▼                │    │              ▼                 │   │\n    44→│  │  ┌───────────────────────┐  │    │  ┌───────────────────────────┐ │   │\n    45→│  │  │  478 Facial Landmarks │  │    │  │  106 Side Landmarks       │ │   │\n    46→│  │  │  (Front Profile)      │  │    │  │  + Rotation Data          │ │   │\n    47→│  │  └───────────────────────┘  │    │  └───────────────────────────┘ │   │\n    48→│  │            │                │    │              │                 │   │\n    49→│  │            ▼                │    │              ▼                 │   │\n    50→│  │  ┌───────────────────────┐  │    │  ┌───────────────────────────┐ │   │\n    51→│  │  │  Ratio Calculations   │  │    │  │  Scoring Engine           │ │   │\n    52→│  │  │  (JavaScript)         │  │    │  │  (Server-side)            │ │   │\n    53→│  │  └───────────────────────┘  │    │  └───────────────────────────┘ │   │\n    54→│  │                             │    │                                 │   │\n    55→│  └─────────────────────────────┘    └─────────────────────────────────┘   │\n    56→│                                                                             │\n    57→└─────────────────────────────────────────────────────────────────────────────┘\n    58→```\n    59→\n    60→### 1.2 Component Responsibilities\n    61→\n    62→| Component | Location | Responsibility |\n    63→|-----------|----------|----------------|\n    64→| MediaPipe FaceLandmarker | Client (WASM) | Detect 478 landmarks on front-facing images |\n    65→| Side Landmark API | Server | Detect landmarks on side profile images |\n    66→| Landmark Mapper | Client | Convert raw indices to named anatomical points |\n    67→| Ratio Calculator | Client | Compute facial ratios from landmark coordinates |\n    68→| Scoring Engine | Server | Apply exponential decay scoring with ideal ranges |\n    69→| Standards Database | Server | Store ideal min/max values for all ratios |\n    70→\n    71→---\n    72→\n    73→## 2. Data Flow Pipeline\n    74→\n    75→### 2.1 Complete Processing Flow\n    76→\n    77→```\n    78→┌──────────────┐     ┌──────────────┐     ┌──────────────┐     ┌──────────────┐\n    79→│   CAPTURE    │────▶│   DETECT     │────▶│  CALCULATE   │────▶│    SCORE     │\n    80→│   Image      │     │  Landmarks   │     │   Ratios     │     │   Results    │\n    81→└──────────────┘     └──────────────┘     └──────────────┘     └──────────────┘\n    82→       │                    │                    │                    │\n    83→       ▼                    ▼                    ▼                    ▼\n    84→  Front Photo         478 Points            50+ Ratios          0-10 Scores\n    85→  Side Photo          106 Points           (angles, %)         + Deviation\n    86→```\n    87→\n    88→### 2.2 Front Profile Pipeline\n    89→\n    90→```javascript\n    91→// Step 1: Initialize MediaPipe FaceLandmarker\n    92→const faceLandmarker = await FaceLandmarker.createFromModelPath(\n    93→    wasmFileset,\n    94→    \"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task\"\n    95→);\n    96→\n    97→// Step 2: Detect landmarks\n    98→const results = faceLandmarker.detect(imageElement);\n    99→const landmarks = results.faceLandmarks[0]; // Array of 478 {x, y, z} points\n   100→\n   101→// Step 3: Map to named points\n   102→const namedLandmarks = mapLandmarksToNames(landmarks, imageWidth, imageHeight);\n   103→\n   104→// Step 4: Calculate ratios\n   105→const ratios = calculateAllRatios(namedLandmarks, \"front\");\n   106→\n   107→// Step 5: Score each ratio\n   108→const scores = ratios.map(r => ({\n   109→    name: r.name,\n   110→    value: r.value,\n   111→    score: calculateScore(r.value, r.idealMin, r.idealMax, r.decayRate)\n   112→}));\n   113→```\n   114→\n   115→### 2.3 Side Profile Pipeline\n   116→\n   117→```javascript\n   118→// Step 1: Upload image to server\n   119→const formData = new FormData();\n   120→formData.append(\"image\", imageBlob, \"side.jpg\");\n   121→\n   122→// Step 2: Server detects landmarks\n   123→const response = await fetch(\"/api/side-landmarks\", {\n   124→    method: \"POST\",\n   125→    body: formData\n   126→});\n   127→\n   128→// Step 3: Receive landmark data\n   129→const { landmarks, direction, rotationAngle, bbox } = await response.json();\n   130→\n   131→// Step 4: Map to named anatomical points\n   132→const namedLandmarks = mapSideLandmarksToNames(landmarks, imageWidth, imageHeight);\n   133→\n   134→// Step 5: Calculate side-specific ratios\n   135→const ratios = calculateAllRatios(namedLandmarks, \"side\");\n   136→```\n   137→\n   138→---\n   139→\n   140→## 3. Core Scoring Engine\n   141→\n   142→### 3.1 The Exponential Decay Scoring Function\n   143→\n   144→This is the exact scoring algorithm extracted from the application:\n   145→\n   146→```javascript\n   147→/**\n   148→ * Calculate a score (0-10) based on how close a value is to the ideal range.\n   149→ * Uses exponential decay for values outside the ideal range.\n   150→ *\n   151→ * @param {number} value - The measured ratio value\n   152→ * @param {number} idealMin - Minimum of ideal range\n   153→ * @param {number} idealMax - Maximum of ideal range\n   154→ * @param {number} decayRate - Rate of score decay (default 0.2)\n   155→ * @param {number} maxScore - Maximum possible score (default 10)\n   156→ * @returns {number} Score from 0 to 10\n   157→ */\n   158→function calculateScore(value, idealMin, idealMax, decayRate = 0.2, maxScore = 10) {\n   159→    const minScore = -maxScore;\n   160→\n   161→    let rawScore;\n   162→\n   163→    if (value >= idealMin && value <= idealMax) {\n   164→        // Value is within ideal range - perfect score\n   165→        rawScore = maxScore;\n   166→    } else {\n   167→        // Calculate distance from ideal range\n   168→        const distance = value < idealMin\n   169→            ? (idealMin - value)\n   170→            : (value - idealMax);\n   171→\n   172→        // Apply exponential decay\n   173→        // Score decreases exponentially the further from ideal\n   174→        rawScore = minScore + (maxScore - minScore) * Math.exp(-decayRate * distance);\n   175→    }\n   176→\n   177→    // Normalize to 0-10 scale\n   178→    const range = maxScore - minScore;\n   179→    const normalizedScore = (rawScore - minScore) / range * 10;\n   180→\n   181→    return Math.max(0, Math.min(10, normalizedScore));\n   182→}\n   183→```\n   184→\n   185→### 3.2 Mathematical Explanation\n   186→\n   187→The exponential decay formula:\n   188→\n   189→```\n   190→                    ┌─ maxScore                          if idealMin ≤ value ≤ idealMax\n   191→                    │\n   192→score(value) = ─────┤\n   193→                    │\n   194→                    └─ minScore + (maxScore - minScore) × e^(-decay × distance)    otherwise\n   195→```\n   196→\n   197→Where:\n   198→- `distance = |value - nearest_ideal_boundary|`\n   199→- `decay` = 0.2 (default rate)\n   200→- `e` = Euler's number (≈2.718)\n   201→\n   202→**Visualization of Score Curve:**\n   203→\n   204→```\n   205→Score\n   206→  10 │          ┌──────────────┐\n   207→     │         ╱                ╲\n   208→   8 │        ╱                  ╲\n   209→     │       ╱                    ╲\n   210→   6 │      ╱                      ╲\n   211→     │     ╱                        ╲\n   212→   4 │    ╱                          ╲\n   213→     │   ╱                            ╲\n   214→   2 │  ╱                              ╲\n   215→     │ ╱                                ╲\n   216→   0 │╱                                  ╲______________\n   217→     └────────────────────────────────────────────────── Value\n   218→              │        │        │\n   219→           idealMin   ideal   idealMax\n   220→                     range\n   221→```\n   222→\n   223→### 3.3 Custom Curve Support\n   224→\n   225→For ratios with non-standard scoring curves:\n   226→\n   227→```javascript\n   228→/**\n   229→ * Calculate score using custom interpolation points\n   230→ *\n   231→ * @param {number} value - The measured value\n   232→ * @param {Array} customPoints - Array of {x, y} points defining the curve\n   233→ * @returns {number} Interpolated score (0-10)\n   234→ */\n   235→function calculateScoreFromCurve(value, customPoints) {\n   236→    // Sort points by x value\n   237→    const sorted = [...customPoints].sort((a, b) => a.x - b.x);\n   238→\n   239→    // Find surrounding points for interpolation\n   240→    for (let i = 0; i < sorted.length - 1; i++) {\n   241→        if (value >= sorted[i].x && value <= sorted[i + 1].x) {\n   242→            // Linear interpolation between points\n   243→            const t = (value - sorted[i].x) / (sorted[i + 1].x - sorted[i].x);\n   244→            return sorted[i].y + t * (sorted[i + 1].y - sorted[i].y);\n   245→        }\n   246→    }\n   247→\n   248→    // Extrapolate if outside range\n   249→    if (value < sorted[0].x) return sorted[0].y;\n   250→    return sorted[sorted.length - 1].y;\n   251→}\n   252→```\n   253→\n   254→---\n   255→\n   256→## 4. Landmark Detection System\n   257→\n   258→### 4.1 MediaPipe FaceLandmarker Setup\n   259→\n   260→```javascript\n   261→import { FaceLandmarker, FilesetResolver } from \"@mediapipe/tasks-vision\";\n   262→\n   263→async function initializeFaceLandmarker() {\n   264→    const wasmFileset = await FilesetResolver.forVisionTasks(\n   265→        \"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm\"\n   266→    );\n   267→\n   268→    const faceLandmarker = await FaceLandmarker.createFromOptions(wasmFileset, {\n   269→        baseOptions: {\n   270→            modelAssetPath: \"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task\",\n   271→            delegate: \"GPU\"\n   272→        },\n   273→        runningMode: \"IMAGE\",\n   274→        numFaces: 1,\n   275→        outputFacialTransformationMatrixes: true,\n   276→        outputFaceBlendshapes: false\n   277→    });\n   278→\n   279→    return faceLandmarker;\n   280→}\n   281→```\n   282→\n   283→### 4.2 Front Profile Landmark Index Map\n   284→\n   285→```javascript\n   286→/**\n   287→ * MediaPipe FaceLandmarker index to anatomical point mapping\n   288→ * Based on MediaPipe's 478-point face mesh\n   289→ */\n   290→const FRONT_LANDMARK_INDICES = {\n   291→    // Facial outline\n   292→    chinBottom: 152,\n   293→    chinLeft: 172,\n   294→    chinRight: 397,\n   295→\n   296→    // Forehead\n   297→    hairline: 10,        // Top of forehead\n   298→    glabella: 9,         // Between eyebrows\n   299→\n   300→    // Eyes - Left\n   301→    leftEyePupil: 468,   // Iris center (if available) or approximate\n   302→    leftEyeMedialCanthus: 133,\n   303→    leftEyeLateralCanthus: 33,\n   304→    leftEyeUpperEyelid: 159,\n   305→    leftEyeLowerEyelid: 145,\n   306→    leftEyelidHoodEnd: 130,\n   307→\n   308→    // Eyes - Right\n   309→    rightEyePupil: 473,\n   310→    rightEyeMedialCanthus: 362,\n   311→    rightEyeLateralCanthus: 263,\n   312→    rightEyeUpperEyelid: 386,\n   313→    rightEyeLowerEyelid: 374,\n   314→    rightEyelidHoodEnd: 359,\n   315→\n   316→    // Eyebrows - Left\n   317→    leftBrowInnerCorner: 107,\n   318→    leftBrowHead: 66,\n   319→    leftBrowPeak: 105,\n   320→    leftBrowArch: 70,\n   321→\n   322→    // Eyebrows - Right\n   323→    rightBrowInnerCorner: 336,\n   324→    rightBrowHead: 296,\n   325→    rightBrowPeak: 334,\n   326→    rightBrowArch: 300,\n   327→\n   328→    // Nose\n   329→    nasion: 6,           // Bridge of nose\n   330→    noseBottom: 4,       // Tip of nose\n   331→    nasalBase: 2,        // Base of nose\n   332→    noseLeft: 129,       // Left nostril\n   333→    noseRight: 358,      // Right nostril\n   334→\n   335→    // Mouth\n   336→    cupidsBow: 0,        // Center upper lip\n   337→    mouthMiddle: 13,     // Center of mouth\n   338→    lowerLip: 14,        // Center lower lip\n   339→    mouthLeft: 61,       // Left corner\n   340→    mouthRight: 291,     // Right corner\n   341→\n   342→    // Cheeks\n   343→    leftCheek: 234,      // Widest point left\n   344→    rightCheek: 454,     // Widest point right\n   345→\n   346→    // Jaw\n   347→    leftTopGonion: 172,  // Left jaw angle\n   348→    rightTopGonion: 397, // Right jaw angle\n   349→    leftBottomGonion: 140,\n   350→    rightBottomGonion: 369,\n   351→\n   352→    // Temples\n   353→    leftTemple: 127,\n   354→    rightTemple: 356,\n   355→\n   356→    // Ears\n   357→    leftOuterEar: 234,\n   358→    rightOuterEar: 454,\n   359→\n   360→    // Neck\n   361→    neckLeft: 177,\n   362→    neckRight: 401\n   363→};\n   364→```\n   365→\n   366→### 4.3 Side Profile Landmark Index Map\n   367→\n   368→```javascript\n   369→/**\n   370→ * Side profile landmark indices (custom model)\n   371→ * Used after /api/side-landmarks detection\n   372→ */\n   373→const SIDE_LANDMARK_INDICES = {\n   374→    // Cranial\n   375→    vertex: \"calculated\",    // Top of head (calculated)\n   376→    occiput: \"calculated\",   // Back of head (calculated)\n   377→\n   378→    // Forehead\n   379→    trichion: \"calculated\",  // Hairline\n   380→    glabella: 104,           // Between brows\n   381→\n   382→    // Nose\n   383→    nasion: 72,              // Bridge\n   384→    rhinion: \"calculated\",   // Nasal bridge midpoint\n   385→    supratip: \"calculated\",  // Above tip\n   386→    pronasale: 83,           // Tip of nose\n   387→    infratip: \"calculated\",  // Below tip\n   388→    columella: \"calculated\", // Columella base\n   389→    subnasale: \"calculated\", // Below nose\n   390→    subalare: 77,            // Nostril base\n   391→\n   392→    // Lips\n   393→    labraleSuperius: 67,     // Upper lip\n   394→    labraleInferius: 59,     // Lower lip\n   395→    sublabiale: \"calculated\",// Below lower lip\n   396→    cheilion: 52,            // Corner of mouth\n   397→\n   398→    // Chin\n   399→    pogonion: 24,            // Chin point\n   400→    menton: \"calculated\",    // Chin bottom\n   401→\n   402→    // Jaw\n   403→    gonionTop: \"calculated\", // Upper jaw angle\n   404→    gonionBottom: 2,         // Lower jaw angle\n   405→\n   406→    // Ear\n   407→    porion: \"calculated\",    // Ear canal\n   408→    tragus: \"calculated\",    // Ear tragus\n   409→    intertragicNotch: \"calculated\",\n   410→\n   411→    // Eye\n   412→    orbitale: \"calculated\",  // Lower orbit\n   413→    cornealApex: 40,         // Eye center\n   414→\n   415→    // Neck\n   416→    cervicalPoint: \"calculated\",\n   417→    neckPoint: \"calculated\",\n   418→\n   419→    // Cheek\n   420→    cheekbone: \"calculated\"\n   421→};\n   422→```\n   423→\n   424→### 4.4 Calculated Landmark Functions\n   425→\n   426→```javascript\n   427→/**\n   428→ * Calculate derived landmarks from raw detected points\n   429→ */\n   430→const CALCULATED_LANDMARKS = {\n   431→    vertex: (landmarks) => {\n   432→        const glabella = getLandmark(landmarks, 10);\n   433→        const occiput = getLandmark(landmarks, 8);\n   434→        const nasion = getLandmark(landmarks, 1);\n   435→        const hairline = getLandmark(landmarks, 12);\n   436→        const distance = euclidean(glabella, occiput);\n   437→        return translatePoint(glabella, {\n   438→            along: { from: nasion, to: hairline },\n   439→            by: -distance\n   440→        });\n   441→    },\n   442→\n   443→    occiput: (landmarks) => {\n   444→        const vertex = getLandmark(landmarks, 9);\n   445→        const pronasale = getLandmark(landmarks, 83);\n   446→        const distance = euclidean(vertex, pronasale);\n   447→        return translatePoint(vertex, {\n   448→            along: { from: pronasale, to: vertex },\n   449→            by: distance\n   450→        });\n   451→    },\n   452→\n   453→    menton: (landmarks) => {\n   454→        const chinFront = getLandmark(landmarks, 0);\n   455→        const chinBottom = getLandmark(landmarks, 8);\n   456→        return {\n   457→            x: (chinFront.x + chinBottom.x) / 2,\n   458→            y: (chinFront.y + chinBottom.y) / 2\n   459→        };\n   460→    },\n   461→\n   462→    rhinion: (landmarks, namedPoints) => {\n   463→        if (!namedPoints.pronasale || !namedPoints.nasion) return null;\n   464→        const pronasale = toPixels(namedPoints.pronasale, landmarks.imageWidth, landmarks.imageHeight);\n   465→        return translatePoint(pronasale, {\n   466→            along: { from: pronasale, to: toPixels(namedPoints.nasion, landmarks.imageWidth, landmarks.imageHeight) },\n   467→            by: euclidean(getLandmark(landmarks, 74), getLandmark(landmarks, 72))\n   468→        });\n   469→    }\n   470→    // ... additional calculated points\n   471→};\n   472→```\n   473→\n   474→---\n   475→\n   476→## 5. Ratio Calculation Functions\n   477→\n   478→### 5.1 Core Utility Functions\n   479→\n   480→```javascript\n   481→/**\n   482→ * Calculate Euclidean distance between two points\n   483→ */\n   484→function euclidean(point1, point2) {\n   485→    const dx = point2.x - point1.x;\n   486→    const dy = point2.y - point1.y;\n   487→    return Math.sqrt(dx * dx + dy * dy);\n   488→}\n   489→\n   490→/**\n   491→ * Calculate midpoint between two points\n   492→ */\n   493→function midpoint(point1, point2) {\n   494→    return {\n   495→        x: (point1.x + point2.x) / 2,\n   496→        y: (point1.y + point2.y) / 2\n   497→    };\n   498→}\n   499→\n   500→/**\n   501→ * Safe division with fallback\n   502→ */\n   503→function ratio(numerator, denominator, fallback = 0) {\n   504→    if (!isFinite(numerator) || !isFinite(denominator) || Math.abs(denominator) < 1e-10) {\n   505→        return fallback;\n   506→    }\n   507→    const result = numerator / denominator;\n   508→    return isFinite(result) ? result : fallback;\n   509→}\n   510→\n   511→/**\n   512→ * Calculate angle at vertex (in degrees)\n   513→ * Returns angle ABC where B is the vertex\n   514→ */\n   515→function angle(pointA, vertex, pointC) {\n   516→    const vectorBA = { x: pointA.x - vertex.x, y: pointA.y - vertex.y };\n   517→    const vectorBC = { x: pointC.x - vertex.x, y: pointC.y - vertex.y };\n   518→\n   519→    const dotProduct = vectorBA.x * vectorBC.x + vectorBA.y * vectorBC.y;\n   520→    const magnitudeProduct = Math.sqrt(vectorBA.x ** 2 + vectorBA.y ** 2) *\n   521→                             Math.sqrt(vectorBC.x ** 2 + vectorBC.y ** 2);\n   522→\n   523→    if (Math.abs(magnitudeProduct) < 1e-10) return 0;\n   524→\n   525→    const cosAngle = Math.max(-1, Math.min(1, dotProduct / magnitudeProduct));\n   526→    return (180 / Math.PI) * Math.acos(cosAngle);\n   527→}\n   528→```\n   529→\n   530→### 5.2 Front Profile Ratio Calculations\n   531→\n   532→```javascript\n   533→const FRONT_RATIO_CALCULATIONS = {\n   534→    \"Midface Ratio\": (landmarks) => {\n   535→        const leftPupil = landmarks.leftEyePupil;\n   536→        const rightPupil = landmarks.rightEyePupil;\n   537→        const cupidsBow = landmarks.cupidsBow;\n   538→        if (!leftPupil || !rightPupil || !cupidsBow) return null;\n   539→\n   540→        const eyeWidth = Math.abs(rightPupil.x - leftPupil.x);\n   541→        const eyeCenterY = (leftPupil.y + rightPupil.y) / 2;\n   542→        return ratio(eyeWidth, Math.abs(cupidsBow.y - eyeCenterY));\n   543→    },\n   544→\n   545→    \"Eye Separation Ratio\": (landmarks) => {\n   546→        const leftPupil = landmarks.leftEyePupil;\n   547→        const rightPupil = landmarks.rightEyePupil;\n   548→        const leftCheek = landmarks.leftCheek;\n   549→        const rightCheek = landmarks.rightCheek;\n   550→        if (!leftPupil || !rightPupil || !leftCheek || !rightCheek) return null;\n   551→\n   552→        return 100 * ratio(\n   553→            Math.abs(rightPupil.x - leftPupil.x),\n   554→            Math.abs(rightCheek.x - leftCheek.x)\n   555→        );\n   556→    },\n   557→\n   558→    \"Total Facial Width to Height Ratio\": (landmarks) => {\n   559→        const leftCheek = landmarks.leftCheek;\n   560→        const rightCheek = landmarks.rightCheek;\n   561→        const hairline = landmarks.hairline;\n   562→        const chinBottom = landmarks.chinBottom;\n   563→        if (!leftCheek || !rightCheek || !hairline || !chinBottom) return null;\n   564→\n   565→        return ratio(\n   566→            Math.abs(chinBottom.y - hairline.y),\n   567→            Math.abs(rightCheek.x - leftCheek.x)\n   568→        );\n   569→    },\n   570→\n   571→    \"Bigonial Width\": (landmarks) => {\n   572→        const leftGonion = landmarks.leftTopGonion;\n   573→        const rightGonion = landmarks.rightTopGonion;\n   574→        const leftCheek = landmarks.leftCheek;\n   575→        const rightCheek = landmarks.rightCheek;\n   576→        if (!leftGonion || !rightGonion || !leftCheek || !rightCheek) return null;\n   577→\n   578→        return 100 * ratio(\n   579→            Math.abs(rightGonion.x - leftGonion.x),\n   580→            Math.abs(rightCheek.x - leftCheek.x)\n   581→        );\n   582→    },\n   583→\n   584→    \"Lateral Canthal Tilt\": (landmarks) => {\n   585→        const leftMedial = landmarks.leftEyeMedialCanthus;\n   586→        const leftLateral = landmarks.leftEyeLateralCanthus;\n   587→        const rightMedial = landmarks.rightEyeMedialCanthus;\n   588→        const rightLateral = landmarks.rightEyeLateralCanthus;\n   589→        if (!leftMedial || !leftLateral || !rightMedial || !rightLateral) return null;\n   590→\n   591→        const leftTilt = (180 / Math.PI) * Math.atan2(\n   592→            leftMedial.y - leftLateral.y,\n   593→            leftMedial.x - leftLateral.x\n   594→        );\n   595→        const rightTilt = (180 / Math.PI) * Math.atan2(\n   596→            rightMedial.y - rightLateral.y,\n   597→            rightLateral.x - rightMedial.x\n   598→        );\n   599→        return (leftTilt + rightTilt) / 2;\n   600→    },\n   601→\n   602→    \"Lower Third\": (landmarks) => {\n   603→        const hairline = landmarks.hairline;\n   604→        const noseBottom = landmarks.noseBottom;\n   605→        const chinBottom = landmarks.chinBottom;\n   606→        const leftBrowInner = landmarks.leftBrowInnerCorner;\n   607→        const leftBrowHead = landmarks.leftBrowHead;\n   608→        const rightBrowInner = landmarks.rightBrowInnerCorner;\n   609→        const rightBrowHead = landmarks.rightBrowHead;\n   610→        if (!hairline || !noseBottom || !chinBottom || !leftBrowInner ||\n   611→            !leftBrowHead || !rightBrowInner || !rightBrowHead) return null;\n   612→\n   613→        const faceHeight = Math.abs(chinBottom.y - hairline.y);\n   614→        return ((chinBottom.y - noseBottom.y) / faceHeight) * 100;\n   615→    },\n   616→\n   617→    \"Middle Third\": (landmarks) => {\n   618→        const hairline = landmarks.hairline;\n   619→        const noseBottom = landmarks.noseBottom;\n   620→        const chinBottom = landmarks.chinBottom;\n   621→        const leftBrowInner = landmarks.leftBrowInnerCorner;\n   622→        const leftBrowHead = landmarks.leftBrowHead;\n   623→        const rightBrowInner = landmarks.rightBrowInnerCorner;\n   624→        const rightBrowHead = landmarks.rightBrowHead;\n   625→        if (!hairline || !noseBottom || !chinBottom || !leftBrowInner ||\n   626→            !leftBrowHead || !rightBrowInner || !rightBrowHead) return null;\n   627→\n   628→        const faceHeight = Math.abs(chinBottom.y - hairline.y);\n   629→        const browMid = midpoint(midpoint(leftBrowInner, leftBrowHead),\n   630→                                  midpoint(rightBrowInner, rightBrowHead));\n   631→        return ((noseBottom.y - browMid.y) / faceHeight) * 100;\n   632→    },\n   633→\n   634→    \"Top Third\": (landmarks) => {\n   635→        const hairline = landmarks.hairline;\n   636→        const chinBottom = landmarks.chinBottom;\n   637→        const leftBrowInner = landmarks.leftBrowInnerCorner;\n   638→        const leftBrowHead = landmarks.leftBrowHead;\n   639→        const rightBrowInner = landmarks.rightBrowInnerCorner;\n   640→        const rightBrowHead = landmarks.rightBrowHead;\n   641→        if (!hairline || !chinBottom || !leftBrowInner || !leftBrowHead ||\n   642→            !rightBrowInner || !rightBrowHead) return null;\n   643→\n   644→        const faceHeight = Math.abs(chinBottom.y - hairline.y);\n   645→        const browMid = midpoint(midpoint(leftBrowInner, leftBrowHead),\n   646→                                  midpoint(rightBrowInner, rightBrowHead));\n   647→        return ((browMid.y - hairline.y) / faceHeight) * 100;\n   648→    },\n   649→\n   650→    \"Eye Aspect Ratio\": (landmarks) => {\n   651→        const leftMedial = landmarks.leftEyeMedialCanthus;\n   652→        const leftLateral = landmarks.leftEyeLateralCanthus;\n   653→        const leftUpper = landmarks.leftEyeUpperEyelid;\n   654→        const leftLower = landmarks.leftEyeLowerEyelid;\n   655→        const rightMedial = landmarks.rightEyeMedialCanthus;\n   656→        const rightLateral = landmarks.rightEyeLateralCanthus;\n   657→        const rightUpper = landmarks.rightEyeUpperEyelid;\n   658→        const rightLower = landmarks.rightEyeLowerEyelid;\n   659→        if (!leftMedial || !leftLateral || !leftUpper || !leftLower ||\n   660→            !rightMedial || !rightLateral || !rightUpper || !rightLower) return null;\n   661→\n   662→        const leftRatio = ratio(Math.abs(leftLateral.x - leftMedial.x),\n   663→                                Math.abs(leftLower.y - leftUpper.y));\n   664→        const rightRatio = ratio(Math.abs(rightLateral.x - rightMedial.x),\n   665→                                 Math.abs(rightLower.y - rightUpper.y));\n   666→        return (leftRatio + rightRatio) / 2;\n   667→    },\n   668→\n   669→    \"Jaw Frontal Angle\": (landmarks) => {\n   670→        const leftGonion = landmarks.leftBottomGonion;\n   671→        const rightGonion = landmarks.rightBottomGonion;\n   672→        const chinLeft = landmarks.chinLeft;\n   673→        const chinRight = landmarks.chinRight;\n   674→        if (!leftGonion || !rightGonion || !chinLeft || !chinRight) return null;\n   675→\n   676→        // Calculate angle between jaw lines\n   677→        return 180 - angle(leftGonion, chinLeft, chinRight, rightGonion);\n   678→    }\n   679→};\n   680→```\n   681→\n   682→### 5.3 Side Profile Ratio Calculations\n   683→\n   684→```javascript\n   685→const SIDE_RATIO_CALCULATIONS = {\n   686→    \"Gonial Angle\": (landmarks) => {\n   687→        const gonionTop = landmarks.gonionTop;\n   688→        const gonionBottom = landmarks.gonionBottom;\n   689→        const menton = landmarks.menton;\n   690→        const tragus = landmarks.intertragicNotch;\n   691→        if (!gonionTop || !gonionBottom || !menton || !tragus) return null;\n   692→\n   693→        const angle1 = Math.atan2(gonionTop.y - tragus.y, gonionTop.x - tragus.x);\n   694→        const angle2 = Math.atan2(gonionBottom.y - menton.y, gonionBottom.x - menton.x);\n   695→        let angleDiff = (180 / Math.PI) * Math.abs(angle1 - angle2);\n   696→        return angleDiff > 180 ? 360 - angleDiff : angleDiff;\n   697→    },\n   698→\n   699→    \"Nasolabial Angle\": (landmarks) => {\n   700→        const columella = landmarks.columella;\n   701→        const subnasale = landmarks.subnasale;\n   702→        const labraleSuperius = landmarks.labraleSuperius;\n   703→        if (!columella || !subnasale || !labraleSuperius) return null;\n   704→\n   705→        return angle(columella, subnasale, labraleSuperius);\n   706→    },\n   707→\n   708→    \"Nasofrontal Angle\": (landmarks) => {\n   709→        const glabella = landmarks.glabella;\n   710→        const nasion = landmarks.nasion;\n   711→        const supratip = landmarks.supratip;\n   712→        if (!glabella || !nasion || !supratip) return null;\n   713→\n   714→        return angle(glabella, nasion, supratip);\n   715→    },\n   716→\n   717→    \"Mentolabial Angle\": (landmarks) => {\n   718→        const labraleInferius = landmarks.labraleInferius;\n   719→        const sublabiale = landmarks.sublabiale;\n   720→        const pogonion = landmarks.pogonion;\n   721→        if (!labraleInferius || !sublabiale || !pogonion) return null;\n   722→\n   723→        return angle(labraleInferius, sublabiale, pogonion);\n   724→    },\n   725→\n   726→    \"Facial Convexity (Glabella)\": (landmarks) => {\n   727→        const glabella = landmarks.glabella;\n   728→        const subnasale = landmarks.subnasale;\n   729→        const pogonion = landmarks.pogonion;\n   730→        if (!glabella || !subnasale || !pogonion) return null;\n   731→\n   732→        return angle(glabella, subnasale, pogonion);\n   733→    },\n   734→\n   735→    \"Total Facial Convexity\": (landmarks) => {\n   736→        const glabella = landmarks.glabella;\n   737→        const pronasale = landmarks.pronasale;\n   738→        const pogonion = landmarks.pogonion;\n   739→        if (!glabella || !pronasale || !pogonion) return null;\n   740→\n   741→        const baseAngle = angle(glabella, pronasale, pogonion);\n   742→\n   743→        // Determine if convex or concave\n   744→        const v1 = { x: glabella.x - pronasale.x, y: glabella.y - pronasale.y };\n   745→        const v2 = { x: pogonion.x - pronasale.x, y: pogonion.y - pronasale.y };\n   746→        const cross = v1.x * v2.y - v1.y * v2.x;\n   747→\n   748→        return cross < 0 ? baseAngle : 360 - baseAngle;\n   749→    },\n   750→\n   751→    \"Submental Cervical Angle\": (landmarks) => {\n   752→        const menton = landmarks.menton;\n   753→        const cervicalPoint = landmarks.cervicalPoint;\n   754→        const neckPoint = landmarks.neckPoint;\n   755→        if (!menton || !cervicalPoint || !neckPoint) return null;\n   756→\n   757→        return angle(menton, cervicalPoint, neckPoint);\n   758→    },\n   759→\n   760→    \"Nasal Tip Angle\": (landmarks) => {\n   761→        const supratip = landmarks.supratip;\n   762→        const pronasale = landmarks.pronasale;\n   763→        const infratip = landmarks.infratip;\n   764→        if (!supratip || !pronasale || !infratip) return null;\n   765→\n   766→        return angle(supratip, pronasale, infratip);\n   767→    },\n   768→\n   769→    \"Nasofacial Angle\": (landmarks) => {\n   770→        const nasion = landmarks.nasion;\n   771→        const pronasale = landmarks.pronasale;\n   772→        const pogonion = landmarks.pogonion;\n   773→        if (!nasion || !pronasale || !pogonion) return null;\n   774→\n   775→        const baseAngle = angle(pronasale, nasion, pogonion);\n   776→        return baseAngle > 90 ? 180 - baseAngle : baseAngle;\n   777→    },\n   778→\n   779→    \"Mandibular Plane Angle\": (landmarks) => {\n   780→        const gonionTop = landmarks.gonionTop;\n   781→        const gonionBottom = landmarks.gonionBottom;\n   782→        const menton = landmarks.menton;\n   783→        const tragus = landmarks.tragus;\n   784→        if (!gonionTop || !gonionBottom || !menton || !tragus) return null;\n   785→\n   786→        // Calculate intersection of mandibular plane with Frankfort horizontal\n   787→        // Complex geometric calculation...\n   788→        // Returns angle in degrees\n   789→    }\n   790→};\n   791→```\n   792→\n   793→---\n   794→\n   795→## 6. Decoded Scoring Standards Database\n   796→\n   797→### 6.1 Confirmed Ratios (Clear Names)\n   798→\n   799→| Ratio Name | Ideal Min | Ideal Max | Unit | Profile | Decay Rate |\n   800→|------------|-----------|-----------|------|---------|------------|\n   801→| Top Third | 29.00 | 33.00 | % | Front | 0.2 |\n   802→| Middle Third | 31.00 | 34.00 | % | Front | 0.2 |\n   803→| Lower Third | 33.40 | 37.50 | % | Front | 0.2 |\n   804→| Eye Separation Ratio | 45.00 | 47.50 | % | Front | 0.2 |\n   805→| Eyebrow Low Setedness | 0.00 | 0.66 | x | Front | 0.2 |\n   806→| Total Facial Width to Height Ratio | 1.33 | 1.38 | x | Front | 0.2 |\n   807→| Gonial Angle | 113.00 | 123.00 | ° | Side | 0.2 |\n   808→| Facial Convexity (Glabella) | 167.00 | 176.00 | ° | Side | 0.2 |\n   809→| Submental Cervical Angle | 92.00 | 110.00 | ° | Side | 0.2 |\n   810→| Recession relative to Frankfort plane | 0.00 | 15.00 | mm | Side | 0.2 |\n   811→\n   812→### 6.2 Fingerprinted Ratios (Decoded from Obfuscation)\n   813→\n   814→Based on anthropometric analysis matching ideal ranges to scientific literature:\n   815→\n   816→| Predicted Ratio Name | Ideal Min | Ideal Max | Unit | Confidence | Evidence |\n   817→|---------------------|-----------|-----------|------|------------|----------|\n   818→| **Nasolabial Angle** | 60.54 | 105.97 | ° | 95% | Matches Farkas 90-105° standard |\n   819→| **Nasofrontal Angle** | 142.50 | 150.12 | ° | 95% | Matches Powell 130-140° (scaled) |\n   820→| **Mentolabial Angle** | 65.19 | 101.55 | ° | 85% | Matches standard 80-120° |\n   821→| **Eye Aspect Ratio** | 2.44 | 2.89 | x | 85% | Matches Farkas palpebral fissure 2.5-3.0 |\n   822→| **Lower Lip E-Line Position** | -25.61 | -11.04 | DW | 90% | Ricketts E-line standard (scaled) |\n   823→| **Upper Lip E-Line Position** | -18.63 | -8.83 | DW | 90% | Upper lip E-line standard (scaled) |\n   824→| **Upper Lip S-Line Position** | -4.66 | 0.00 | DW | 75% | Steiner S-line standard |\n   825→| **Lower Lip S-Line Position** | -2.33 | 2.21 | DW | 75% | S-line balanced position |\n   826→| **Upper Lip Burstone Line** | -2.33 | 2.21 | DW | 70% | Burstone line standard |\n   827→| **Deviation of IAA & JFA** | 0.00 | 11.04 | DW | 85% | Zero = perfect symmetry |\n   828→| **Ear Protrusion Angle** | 0.00 | 17.66 | ° | 80% | Standard 15-20° from head |\n   829→| **Bigonial Width %** | 37.25 | 57.40 | % | 80% | Jaw-to-face width ratio |\n   830→| **Bitemporal Width %** | 46.57 | 52.98 | % | 80% | Temple-to-cheek ratio |\n   831→| **Chin to Philtrum Ratio** | 4.42 | 4.50 | DW | 80% | Very tight range (critical ratio) |\n   832→| **Total Facial Convexity** | 135.05 | 172.19 | ° | 85% | Standard 140-150° |\n   833→| **Nasal Tip Angle** | 139.70 | 158.95 | ° | 70% | Nasal tip definition |\n   834→| **Mouth Width to Nose Width** | 2.77 | 3.78 | x | 65% | Powell 1.5x (scaled ~3.0) |\n   835→| **Lower Lip to Upper Lip Ratio** | 4.19 | 4.46 | DW | 70% | Standard 1:1.6-2.0 (scaled) |\n   836→| **Ipsilateral Alar Angle** | 26.08 | 36.65 | ° | 60% | Midface width relationship |\n   837→| **Cheekbone Height %** | 23.28 | 57.40 | % | 65% | Position as % of face height |\n   838→| **Mandibular Plane Angle** | 41.91 | 97.13 | DW | 65% | Wide range (scaled 20-30°) |\n   839→\n   840→### 6.3 Understanding the \"DW\" Unit\n   841→\n   842→The \"DW\" (Digital Width) unit appears to be a **normalized measurement system**:\n   843→\n   844→```\n   845→DW = Actual_Measurement × Scale_Factor\n   846→\n   847→Where Scale_Factor ≈ 10 for mm measurements\n   848→      Scale_Factor ≈ 100 for small ratios\n   849→```\n   850→\n   851→**Conversion Guide:**\n   852→- Values 0-50 DW → Likely percentages or small ratios\n   853→- Values 50-200 DW → Likely angles in degrees or scaled mm\n   854→- Values 300-800 DW → Likely mm measurements × 10 or complex scaled ratios\n   855→\n   856→### 6.4 Complete Ratio Configuration Schema\n   857→\n   858→```javascript\n   859→const RATIO_CONFIG = {\n   860→    \"Top Third\": {\n   861→        name: \"Top Third\",\n   862→        profileType: \"front\",\n   863→        idealMin: 29.00,\n   864→        idealMax: 33.00,\n   865→        unit: \"%\",\n   866→        decayRate: 0.2,\n   867→        category: \"Facial Proportions\",\n   868→        description: \"Percentage of face height from hairline to brow line\",\n   869→        landmarks: [\"hairline\", \"leftBrowHead\", \"leftBrowInnerCorner\",\n   870→                   \"rightBrowHead\", \"rightBrowInnerCorner\", \"chinBottom\"]\n   871→    },\n   872→    \"Nasolabial Angle\": {\n   873→        name: \"Nasolabial Angle\",\n   874→        profileType: \"side\",\n   875→        idealMin: 90.00,  // Unscaled standard value\n   876→        idealMax: 105.00,\n   877→        unit: \"°\",\n   878→        decayRate: 0.2,\n   879→        category: \"Nasal Angles\",\n   880→        description: \"Angle between columella and upper lip\",\n   881→        landmarks: [\"columella\", \"subnasale\", \"labraleSuperius\"],\n   882→        scientificReference: \"Farkas LG, 1994\"\n   883→    },\n   884→    // ... additional configurations\n   885→};\n   886→```\n   887→\n   888→---\n   889→\n   890→## 7. Implementation Strategy\n   891→\n   892→### 7.1 Required Libraries\n   893→\n   894→```json\n   895→{\n   896→  \"dependencies\": {\n   897→    \"@mediapipe/tasks-vision\": \"^0.10.0\",\n   898→    \"react\": \"^18.0.0\",\n   899→    \"next\": \"^14.0.0\"\n   900→  },\n   901→  \"devDependencies\": {\n   902→    \"typescript\": \"^5.0.0\"\n   903→  }\n   904→}\n   905→```\n   906→\n   907→**Python Backend (Alternative):**\n   908→```\n   909→mediapipe>=0.10.0\n   910→opencv-python>=4.8.0\n   911→numpy>=1.24.0\n   912→flask>=2.3.0  # or fastapi\n   913→```\n   914→\n   915→### 7.2 Project Structure\n   916→\n   917→```\n   918→facial-analysis/\n   919→├── src/\n   920→│   ├── lib/\n   921→│   │   ├── mediapipe/\n   922→│   │   │   ├── faceLandmarker.ts      # MediaPipe initialization\n   923→│   │   │   └── landmarkMapper.ts       # Index to name mapping\n   924→│   │   ├── calculations/\n   925→│   │   │   ├── ratios.ts              # Ratio calculation functions\n   926→│   │   │   ├── scoring.ts             # Score calculation engine\n   927→│   │   │   └── utilities.ts           # Math helper functions\n   928→│   │   ├── standards/\n   929→│   │   │   ├── idealRanges.ts         # Ideal min/max database\n   930→│   │   │   └── ratioConfig.ts         # Full ratio configurations\n   931→│   │   └── types/\n   932→│   │       └── index.ts               # TypeScript interfaces\n   933→│   ├── components/\n   934→│   │   ├── FaceCapture.tsx            # Camera/upload component\n   935→│   │   ├── AnalysisResults.tsx        # Score display\n   936→│   │   └── RatioVisualization.tsx     # Overlay visualization\n   937→│   └── api/\n   938→│       └── side-landmarks/\n   939→│           └── route.ts               # Side profile API\n   940→├── public/\n   941→│   └── models/                        # MediaPipe model files\n   942→└── package.json\n   943→```\n   944→\n   945→### 7.3 TypeScript Interfaces\n   946→\n   947→```typescript\n   948→interface Point {\n   949→    x: number;\n   950→    y: number;\n   951→    z?: number;\n   952→}\n   953→\n   954→interface NamedLandmarks {\n   955→    [key: string]: Point | null;\n   956→}\n   957→\n   958→interface RatioConfig {\n   959→    name: string;\n   960→    profileType: \"front\" | \"side\";\n   961→    idealMin: number;\n   962→    idealMax: number;\n   963→    unit: string;\n   964→    decayRate: number;\n   965→    category: string;\n   966→    description: string;\n   967→    landmarks: string[];\n   968→    calculationFn?: (landmarks: NamedLandmarks) => number | null;\n   969→}\n   970→\n   971→interface RatioResult {\n   972→    name: string;\n   973→    value: number | null;\n   974→    score: number | null;\n   975→    standardizedScore: number;\n   976→    idealMin: number;\n   977→    idealMax: number;\n   978→    unit: string;\n   979→    deviation: \"below\" | \"ideal\" | \"above\";\n   980→    isIdeal: boolean;\n   981→}\n   982→\n   983→interface AnalysisResult {\n   984→    frontRatios: RatioResult[];\n   985→    sideRatios: RatioResult[];\n   986→    overallScore: number;\n   987→    categoryScores: { [category: string]: number };\n   988→    landmarks: {\n   989→        front: NamedLandmarks;\n   990→        side: NamedLandmarks;\n   991→    };\n   992→}\n   993→```\n   994→\n   995→### 7.4 Quick Start Implementation\n   996→\n   997→```typescript\n   998→// main.ts - Minimal implementation\n   999→\n  1000→import { FaceLandmarker, FilesetResolver } from \"@mediapipe/tasks-vision\";\n  1001→import { FRONT_LANDMARK_INDICES, FRONT_RATIO_CALCULATIONS, RATIO_CONFIG } from \"./config\";\n  1002→\n  1003→class FacialAnalyzer {\n  1004→    private faceLandmarker: FaceLandmarker | null = null;\n  1005→\n  1006→    async initialize() {\n  1007→        const wasmFileset = await FilesetResolver.forVisionTasks(\n  1008→            \"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm\"\n  1009→        );\n  1010→\n  1011→        this.faceLandmarker = await FaceLandmarker.createFromModelPath(\n  1012→            wasmFileset,\n  1013→            \"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task\"\n  1014→        );\n  1015→    }\n  1016→\n  1017→    analyzeFrontProfile(imageElement: HTMLImageElement): AnalysisResult {\n  1018→        if (!this.faceLandmarker) throw new Error(\"Not initialized\");\n  1019→\n  1020→        // Detect landmarks\n  1021→        const results = this.faceLandmarker.detect(imageElement);\n  1022→        if (!results.faceLandmarks.length) throw new Error(\"No face detected\");\n  1023→\n  1024→        const rawLandmarks = results.faceLandmarks[0];\n  1025→\n  1026→        // Map to named points\n  1027→        const namedLandmarks = this.mapLandmarks(rawLandmarks, imageElement);\n  1028→\n  1029→        // Calculate ratios\n  1030→        const ratios = this.calculateRatios(namedLandmarks, \"front\");\n  1031→\n  1032→        // Score ratios\n  1033→        const scoredRatios = this.scoreRatios(ratios);\n  1034→\n  1035→        return {\n  1036→            frontRatios: scoredRatios,\n  1037→            sideRatios: [],\n  1038→            overallScore: this.calculateOverallScore(scoredRatios),\n  1039→            categoryScores: this.calculateCategoryScores(scoredRatios),\n  1040→            landmarks: { front: namedLandmarks, side: {} }\n  1041→        };\n  1042→    }\n  1043→\n  1044→    private mapLandmarks(raw: Point[], image: HTMLImageElement): NamedLandmarks {\n  1045→        const named: NamedLandmarks = {};\n  1046→\n  1047→        for (const [name, index] of Object.entries(FRONT_LANDMARK_INDICES)) {\n  1048→            if (typeof index === \"number\" && raw[index]) {\n  1049→                named[name] = {\n  1050→                    x: raw[index].x * image.width,\n  1051→                    y: raw[index].y * image.height\n  1052→                };\n  1053→            }\n  1054→        }\n  1055→\n  1056→        return named;\n  1057→    }\n  1058→\n  1059→    private calculateRatios(landmarks: NamedLandmarks, profile: \"front\" | \"side\") {\n  1060→        const calculations = profile === \"front\"\n  1061→            ? FRONT_RATIO_CALCULATIONS\n  1062→            : SIDE_RATIO_CALCULATIONS;\n  1063→\n  1064→        return Object.entries(calculations).map(([name, fn]) => ({\n  1065→            name,\n  1066→            value: fn(landmarks),\n  1067→            config: RATIO_CONFIG[name]\n  1068→        }));\n  1069→    }\n  1070→\n  1071→    private scoreRatios(ratios: any[]): RatioResult[] {\n  1072→        return ratios.map(r => {\n  1073→            const score = r.value !== null\n  1074→                ? this.calculateScore(r.value, r.config.idealMin, r.config.idealMax, r.config.decayRate)\n  1075→                : null;\n  1076→\n  1077→            return {\n  1078→                name: r.name,\n  1079→                value: r.value,\n  1080→                score,\n  1081→                standardizedScore: score ?? 0,\n  1082→                idealMin: r.config.idealMin,\n  1083→                idealMax: r.config.idealMax,\n  1084→                unit: r.config.unit,\n  1085→                deviation: this.getDeviation(r.value, r.config.idealMin, r.config.idealMax),\n  1086→                isIdeal: r.value !== null && r.value >= r.config.idealMin && r.value <= r.config.idealMax\n  1087→            };\n  1088→        });\n  1089→    }\n  1090→\n  1091→    private calculateScore(value: number, min: number, max: number, decay: number = 0.2): number {\n  1092→        const maxScore = 10;\n  1093→        const minScore = -maxScore;\n  1094→\n  1095→        let rawScore: number;\n  1096→        if (value >= min && value <= max) {\n  1097→            rawScore = maxScore;\n  1098→        } else {\n  1099→            const distance = value < min ? (min - value) : (value - max);\n  1100→            rawScore = minScore + (maxScore - minScore) * Math.exp(-decay * distance);\n  1101→        }\n  1102→\n  1103→        const range = maxScore - minScore;\n  1104→        return Math.max(0, Math.min(10, ((rawScore - minScore) / range) * 10));\n  1105→    }\n  1106→\n  1107→    private getDeviation(value: number | null, min: number, max: number): \"below\" | \"ideal\" | \"above\" {\n  1108→        if (value === null) return \"ideal\";\n  1109→        if (value < min) return \"below\";\n  1110→        if (value > max) return \"above\";\n  1111→        return \"ideal\";\n  1112→    }\n  1113→\n  1114→    private calculateOverallScore(ratios: RatioResult[]): number {\n  1115→        const validScores = ratios.filter(r => r.score !== null).map(r => r.score!);\n  1116→        return validScores.length ? validScores.reduce((a, b) => a + b, 0) / validScores.length : 0;\n  1117→    }\n  1118→\n  1119→    private calculateCategoryScores(ratios: RatioResult[]): { [key: string]: number } {\n  1120→        const categories: { [key: string]: number[] } = {};\n  1121→\n  1122→        for (const ratio of ratios) {\n  1123→            const category = RATIO_CONFIG[ratio.name]?.category || \"Other\";\n  1124→            if (!categories[category]) categories[category] = [];\n  1125→            if (ratio.score !== null) categories[category].push(ratio.score);\n  1126→        }\n  1127→\n  1128→        const scores: { [key: string]: number } = {};\n  1129→        for (const [cat, values] of Object.entries(categories)) {\n  1130→            scores[cat] = values.length ? values.reduce((a, b) => a + b, 0) / values.length : 0;\n  1131→        }\n  1132→\n  1133→        return scores;\n  1134→    }\n  1135→}\n  1136→\n  1137→export default FacialAnalyzer;\n  1138→```\n  1139→\n  1140→---\n  1141→\n  1142→## 8. API Reference\n  1143→\n  1144→### 8.1 Side Landmarks API\n  1145→\n  1146→**Endpoint:** `POST /api/side-landmarks`\n  1147→\n  1148→**Request:**\n  1149→```\n  1150→Content-Type: multipart/form-data\n  1151→\n  1152→Fields:\n  1153→- image: JPEG/PNG file (side profile photo)\n  1154→```\n  1155→\n  1156→**Response:**\n  1157→```json\n  1158→{\n  1159→    \"success\": true,\n  1160→    \"data\": {\n  1161→        \"landmarks\": [\n  1162→            { \"x\": 0.123, \"y\": 0.456 },\n  1163→            // ... 106 landmark points\n  1164→        ],\n  1165→        \"direction\": \"left\",  // or \"right\"\n  1166→        \"rotationAngle\": 2.5,\n  1167→        \"center\": { \"x\": 0.5, \"y\": 0.5 },\n  1168→        \"crop\": {\n  1169→            \"x\": 100,\n  1170→            \"y\": 50,\n  1171→            \"width\": 400,\n  1172→            \"height\": 500,\n  1173→            \"scale\": 1.2\n  1174→        },\n  1175→        \"bbox\": {\n  1176→            \"minX\": 100,\n  1177→            \"minY\": 50,\n  1178→            \"maxX\": 500,\n  1179→            \"maxY\": 550\n  1180→        }\n  1181→    }\n  1182→}\n  1183→```\n  1184→\n  1185→### 8.2 Analysis API\n  1186→\n  1187→**Endpoint:** `POST /api/faces`\n  1188→\n  1189→**Request:**\n  1190→```json\n  1191→{\n  1192→    \"frontPhotoUrl\": \"data:image/jpeg;base64,...\",\n  1193→    \"sidePhotoUrl\": \"data:image/jpeg;base64,...\",\n  1194→    \"gender\": \"male\",\n  1195→    \"ethnicity\": \"caucasian\"\n  1196→}\n  1197→```\n  1198→\n  1199→**Response:**\n  1200→```json\n  1201→{\n  1202→    \"success\": true,\n  1203→    \"faceId\": \"abc123\",\n  1204→    \"frontRatios\": [\n  1205→        {\n  1206→            \"name\": \"Eye Separation Ratio\",\n  1207→            \"value\": 46.5,\n  1208→            \"score\": 9.2,\n  1209→            \"standardizedScore\": 9.2,\n  1210→            \"unit\": \"%\",\n  1211→            \"idealMin\": 45.0,\n  1212→            \"idealMax\": 47.5\n  1213→        }\n  1214→    ],\n  1215→    \"sideRatios\": [...],\n  1216→    \"overallScore\": 7.8\n  1217→}\n  1218→```\n  1219→\n  1220→---\n  1221→\n  1222→## Appendix A: Scientific References\n  1223→\n  1224→1. **Farkas LG** (1994). \"Anthropometry of the Head and Face\" - Primary source for facial proportions\n  1225→2. **Powell N, Humphreys B** (1984). \"Proportions of the Aesthetic Face\" - Golden ratio applications\n  1226→3. **Ricketts RM** (1968). \"The Esthetic E-Plane\" - E-line lip position standards\n  1227→4. **Steiner CC** (1959). \"Cephalometrics for You and Me\" - S-line standards\n  1228→5. **Burstone CJ** (1967). \"Lip Posture and Its Significance\" - Burstone line\n  1229→\n  1230→---\n  1231→\n  1232→## Appendix B: Changelog\n  1233→\n  1234→| Version | Date | Changes |\n  1235→|---------|------|---------|\n  1236→| 1.0 | Dec 2024 | Initial reverse-engineering documentation |\n  1237→\n  1238→---\n  1239→\n  1240→*This document was created through reverse-engineering of publicly accessible web application code for educational and research purposes.*\n  1241→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"f38a84e6-975d-47fc-8616-92bd02849627","timestamp":"2025-12-19T21:04:19.480Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/TECHNICAL_SPECS.md","content":"# FaceIQ Labs - Technical Specification Document\n## Reverse-Engineered Facial Analysis System\n\n**Document Version:** 1.0\n**Date:** December 2024\n**Source:** Reverse-engineered from beta.faceiqlabs.com\n\n---\n\n## Table of Contents\n\n1. [System Architecture](#1-system-architecture)\n2. [Data Flow Pipeline](#2-data-flow-pipeline)\n3. [Core Scoring Engine](#3-core-scoring-engine)\n4. [Landmark Detection System](#4-landmark-detection-system)\n5. [Ratio Calculation Functions](#5-ratio-calculation-functions)\n6. [Decoded Scoring Standards Database](#6-decoded-scoring-standards-database)\n7. [Implementation Strategy](#7-implementation-strategy)\n8. [API Reference](#8-api-reference)\n\n---\n\n## 1. System Architecture\n\n### 1.1 Hybrid Processing Model\n\nThe system uses a **hybrid architecture** that splits processing between client and server:\n\n```\n┌─────────────────────────────────────────────────────────────────────────────┐\n│                           FACIAL ANALYSIS SYSTEM                            │\n├─────────────────────────────────────────────────────────────────────────────┤\n│                                                                             │\n│  ┌─────────────────────────────┐    ┌─────────────────────────────────┐   │\n│  │     CLIENT-SIDE (Browser)   │    │      SERVER-SIDE (API)          │   │\n│  ├─────────────────────────────┤    ├─────────────────────────────────┤   │\n│  │                             │    │                                 │   │\n│  │  ┌───────────────────────┐  │    │  ┌───────────────────────────┐ │   │\n│  │  │   MediaPipe WASM      │  │    │  │  Custom Landmark Model    │ │   │\n│  │  │   FaceLandmarker      │  │    │  │  (Side Profile)           │ │   │\n│  │  └───────────────────────┘  │    │  └───────────────────────────┘ │   │\n│  │            │                │    │              │                 │   │\n│  │            ▼                │    │              ▼                 │   │\n│  │  ┌───────────────────────┐  │    │  ┌───────────────────────────┐ │   │\n│  │  │  478 Facial Landmarks │  │    │  │  106 Side Landmarks       │ │   │\n│  │  │  (Front Profile)      │  │    │  │  + Rotation Data          │ │   │\n│  │  └───────────────────────┘  │    │  └───────────────────────────┘ │   │\n│  │            │                │    │              │                 │   │\n│  │            ▼                │    │              ▼                 │   │\n│  │  ┌───────────────────────┐  │    │  ┌───────────────────────────┐ │   │\n│  │  │  Ratio Calculations   │  │    │  │  Scoring Engine           │ │   │\n│  │  │  (JavaScript)         │  │    │  │  (Server-side)            │ │   │\n│  │  └───────────────────────┘  │    │  └───────────────────────────┘ │   │\n│  │                             │    │                                 │   │\n│  └─────────────────────────────┘    └─────────────────────────────────┘   │\n│                                                                             │\n└─────────────────────────────────────────────────────────────────────────────┘\n```\n\n### 1.2 Component Responsibilities\n\n| Component | Location | Responsibility |\n|-----------|----------|----------------|\n| MediaPipe FaceLandmarker | Client (WASM) | Detect 478 landmarks on front-facing images |\n| Side Landmark API | Server | Detect landmarks on side profile images |\n| Landmark Mapper | Client | Convert raw indices to named anatomical points |\n| Ratio Calculator | Client | Compute facial ratios from landmark coordinates |\n| Scoring Engine | Server | Apply exponential decay scoring with ideal ranges |\n| Standards Database | Server | Store ideal min/max values for all ratios |\n\n---\n\n## 2. Data Flow Pipeline\n\n### 2.1 Complete Processing Flow\n\n```\n┌──────────────┐     ┌──────────────┐     ┌──────────────┐     ┌──────────────┐\n│   CAPTURE    │────▶│   DETECT     │────▶│  CALCULATE   │────▶│    SCORE     │\n│   Image      │     │  Landmarks   │     │   Ratios     │     │   Results    │\n└──────────────┘     └──────────────┘     └──────────────┘     └──────────────┘\n       │                    │                    │                    │\n       ▼                    ▼                    ▼                    ▼\n  Front Photo         478 Points            50+ Ratios          0-10 Scores\n  Side Photo          106 Points           (angles, %)         + Deviation\n```\n\n### 2.2 Front Profile Pipeline\n\n```javascript\n// Step 1: Initialize MediaPipe FaceLandmarker\nconst faceLandmarker = await FaceLandmarker.createFromModelPath(\n    wasmFileset,\n    \"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task\"\n);\n\n// Step 2: Detect landmarks\nconst results = faceLandmarker.detect(imageElement);\nconst landmarks = results.faceLandmarks[0]; // Array of 478 {x, y, z} points\n\n// Step 3: Map to named points\nconst namedLandmarks = mapLandmarksToNames(landmarks, imageWidth, imageHeight);\n\n// Step 4: Calculate ratios\nconst ratios = calculateAllRatios(namedLandmarks, \"front\");\n\n// Step 5: Score each ratio\nconst scores = ratios.map(r => ({\n    name: r.name,\n    value: r.value,\n    score: calculateScore(r.value, r.idealMin, r.idealMax, r.decayRate)\n}));\n```\n\n### 2.3 Side Profile Pipeline\n\n```javascript\n// Step 1: Upload image to server\nconst formData = new FormData();\nformData.append(\"image\", imageBlob, \"side.jpg\");\n\n// Step 2: Server detects landmarks\nconst response = await fetch(\"/api/side-landmarks\", {\n    method: \"POST\",\n    body: formData\n});\n\n// Step 3: Receive landmark data\nconst { landmarks, direction, rotationAngle, bbox } = await response.json();\n\n// Step 4: Map to named anatomical points\nconst namedLandmarks = mapSideLandmarksToNames(landmarks, imageWidth, imageHeight);\n\n// Step 5: Calculate side-specific ratios\nconst ratios = calculateAllRatios(namedLandmarks, \"side\");\n```\n\n---\n\n## 3. Core Scoring Engine\n\n### 3.1 The Exponential Decay Scoring Function\n\nThis is the exact scoring algorithm extracted from the application:\n\n```javascript\n/**\n * Calculate a score (0-10) based on how close a value is to the ideal range.\n * Uses exponential decay for values outside the ideal range.\n *\n * @param {number} value - The measured ratio value\n * @param {number} idealMin - Minimum of ideal range\n * @param {number} idealMax - Maximum of ideal range\n * @param {number} decayRate - Rate of score decay (default 0.2)\n * @param {number} maxScore - Maximum possible score (default 10)\n * @returns {number} Score from 0 to 10\n */\nfunction calculateScore(value, idealMin, idealMax, decayRate = 0.2, maxScore = 10) {\n    const minScore = -maxScore;\n\n    let rawScore;\n\n    if (value >= idealMin && value <= idealMax) {\n        // Value is within ideal range - perfect score\n        rawScore = maxScore;\n    } else {\n        // Calculate distance from ideal range\n        const distance = value < idealMin\n            ? (idealMin - value)\n            : (value - idealMax);\n\n        // Apply exponential decay\n        // Score decreases exponentially the further from ideal\n        rawScore = minScore + (maxScore - minScore) * Math.exp(-decayRate * distance);\n    }\n\n    // Normalize to 0-10 scale\n    const range = maxScore - minScore;\n    const normalizedScore = (rawScore - minScore) / range * 10;\n\n    return Math.max(0, Math.min(10, normalizedScore));\n}\n```\n\n### 3.2 Mathematical Explanation\n\nThe exponential decay formula:\n\n```\n                    ┌─ maxScore                          if idealMin ≤ value ≤ idealMax\n                    │\nscore(value) = ─────┤\n                    │\n                    └─ minScore + (maxScore - minScore) × e^(-decay × distance)    otherwise\n```\n\nWhere:\n- `distance = |value - nearest_ideal_boundary|`\n- `decay` = 0.2 (default rate)\n- `e` = Euler's number (≈2.718)\n\n**Visualization of Score Curve:**\n\n```\nScore\n  10 │          ┌──────────────┐\n     │         ╱                ╲\n   8 │        ╱                  ╲\n     │       ╱                    ╲\n   6 │      ╱                      ╲\n     │     ╱                        ╲\n   4 │    ╱                          ╲\n     │   ╱                            ╲\n   2 │  ╱                              ╲\n     │ ╱                                ╲\n   0 │╱                                  ╲______________\n     └────────────────────────────────────────────────── Value\n              │        │        │\n           idealMin   ideal   idealMax\n                     range\n```\n\n### 3.3 Custom Curve Support\n\nFor ratios with non-standard scoring curves:\n\n```javascript\n/**\n * Calculate score using custom interpolation points\n *\n * @param {number} value - The measured value\n * @param {Array} customPoints - Array of {x, y} points defining the curve\n * @returns {number} Interpolated score (0-10)\n */\nfunction calculateScoreFromCurve(value, customPoints) {\n    // Sort points by x value\n    const sorted = [...customPoints].sort((a, b) => a.x - b.x);\n\n    // Find surrounding points for interpolation\n    for (let i = 0; i < sorted.length - 1; i++) {\n        if (value >= sorted[i].x && value <= sorted[i + 1].x) {\n            // Linear interpolation between points\n            const t = (value - sorted[i].x) / (sorted[i + 1].x - sorted[i].x);\n            return sorted[i].y + t * (sorted[i + 1].y - sorted[i].y);\n        }\n    }\n\n    // Extrapolate if outside range\n    if (value < sorted[0].x) return sorted[0].y;\n    return sorted[sorted.length - 1].y;\n}\n```\n\n---\n\n## 4. Landmark Detection System\n\n### 4.1 MediaPipe FaceLandmarker Setup\n\n```javascript\nimport { FaceLandmarker, FilesetResolver } from \"@mediapipe/tasks-vision\";\n\nasync function initializeFaceLandmarker() {\n    const wasmFileset = await FilesetResolver.forVisionTasks(\n        \"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm\"\n    );\n\n    const faceLandmarker = await FaceLandmarker.createFromOptions(wasmFileset, {\n        baseOptions: {\n            modelAssetPath: \"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task\",\n            delegate: \"GPU\"\n        },\n        runningMode: \"IMAGE\",\n        numFaces: 1,\n        outputFacialTransformationMatrixes: true,\n        outputFaceBlendshapes: false\n    });\n\n    return faceLandmarker;\n}\n```\n\n### 4.2 Front Profile Landmark Index Map\n\n```javascript\n/**\n * MediaPipe FaceLandmarker index to anatomical point mapping\n * Based on MediaPipe's 478-point face mesh\n */\nconst FRONT_LANDMARK_INDICES = {\n    // Facial outline\n    chinBottom: 152,\n    chinLeft: 172,\n    chinRight: 397,\n\n    // Forehead\n    hairline: 10,        // Top of forehead\n    glabella: 9,         // Between eyebrows\n\n    // Eyes - Left\n    leftEyePupil: 468,   // Iris center (if available) or approximate\n    leftEyeMedialCanthus: 133,\n    leftEyeLateralCanthus: 33,\n    leftEyeUpperEyelid: 159,\n    leftEyeLowerEyelid: 145,\n    leftEyelidHoodEnd: 130,\n\n    // Eyes - Right\n    rightEyePupil: 473,\n    rightEyeMedialCanthus: 362,\n    rightEyeLateralCanthus: 263,\n    rightEyeUpperEyelid: 386,\n    rightEyeLowerEyelid: 374,\n    rightEyelidHoodEnd: 359,\n\n    // Eyebrows - Left\n    leftBrowInnerCorner: 107,\n    leftBrowHead: 66,\n    leftBrowPeak: 105,\n    leftBrowArch: 70,\n\n    // Eyebrows - Right\n    rightBrowInnerCorner: 336,\n    rightBrowHead: 296,\n    rightBrowPeak: 334,\n    rightBrowArch: 300,\n\n    // Nose\n    nasion: 6,           // Bridge of nose\n    noseBottom: 4,       // Tip of nose\n    nasalBase: 2,        // Base of nose\n    noseLeft: 129,       // Left nostril\n    noseRight: 358,      // Right nostril\n\n    // Mouth\n    cupidsBow: 0,        // Center upper lip\n    mouthMiddle: 13,     // Center of mouth\n    lowerLip: 14,        // Center lower lip\n    mouthLeft: 61,       // Left corner\n    mouthRight: 291,     // Right corner\n\n    // Cheeks\n    leftCheek: 234,      // Widest point left\n    rightCheek: 454,     // Widest point right\n\n    // Jaw\n    leftTopGonion: 172,  // Left jaw angle\n    rightTopGonion: 397, // Right jaw angle\n    leftBottomGonion: 140,\n    rightBottomGonion: 369,\n\n    // Temples\n    leftTemple: 127,\n    rightTemple: 356,\n\n    // Ears\n    leftOuterEar: 234,\n    rightOuterEar: 454,\n\n    // Neck\n    neckLeft: 177,\n    neckRight: 401\n};\n```\n\n### 4.3 Side Profile Landmark Index Map\n\n```javascript\n/**\n * Side profile landmark indices (custom model)\n * Used after /api/side-landmarks detection\n */\nconst SIDE_LANDMARK_INDICES = {\n    // Cranial\n    vertex: \"calculated\",    // Top of head (calculated)\n    occiput: \"calculated\",   // Back of head (calculated)\n\n    // Forehead\n    trichion: \"calculated\",  // Hairline\n    glabella: 104,           // Between brows\n\n    // Nose\n    nasion: 72,              // Bridge\n    rhinion: \"calculated\",   // Nasal bridge midpoint\n    supratip: \"calculated\",  // Above tip\n    pronasale: 83,           // Tip of nose\n    infratip: \"calculated\",  // Below tip\n    columella: \"calculated\", // Columella base\n    subnasale: \"calculated\", // Below nose\n    subalare: 77,            // Nostril base\n\n    // Lips\n    labraleSuperius: 67,     // Upper lip\n    labraleInferius: 59,     // Lower lip\n    sublabiale: \"calculated\",// Below lower lip\n    cheilion: 52,            // Corner of mouth\n\n    // Chin\n    pogonion: 24,            // Chin point\n    menton: \"calculated\",    // Chin bottom\n\n    // Jaw\n    gonionTop: \"calculated\", // Upper jaw angle\n    gonionBottom: 2,         // Lower jaw angle\n\n    // Ear\n    porion: \"calculated\",    // Ear canal\n    tragus: \"calculated\",    // Ear tragus\n    intertragicNotch: \"calculated\",\n\n    // Eye\n    orbitale: \"calculated\",  // Lower orbit\n    cornealApex: 40,         // Eye center\n\n    // Neck\n    cervicalPoint: \"calculated\",\n    neckPoint: \"calculated\",\n\n    // Cheek\n    cheekbone: \"calculated\"\n};\n```\n\n### 4.4 Calculated Landmark Functions\n\n```javascript\n/**\n * Calculate derived landmarks from raw detected points\n */\nconst CALCULATED_LANDMARKS = {\n    vertex: (landmarks) => {\n        const glabella = getLandmark(landmarks, 10);\n        const occiput = getLandmark(landmarks, 8);\n        const nasion = getLandmark(landmarks, 1);\n        const hairline = getLandmark(landmarks, 12);\n        const distance = euclidean(glabella, occiput);\n        return translatePoint(glabella, {\n            along: { from: nasion, to: hairline },\n            by: -distance\n        });\n    },\n\n    occiput: (landmarks) => {\n        const vertex = getLandmark(landmarks, 9);\n        const pronasale = getLandmark(landmarks, 83);\n        const distance = euclidean(vertex, pronasale);\n        return translatePoint(vertex, {\n            along: { from: pronasale, to: vertex },\n            by: distance\n        });\n    },\n\n    menton: (landmarks) => {\n        const chinFront = getLandmark(landmarks, 0);\n        const chinBottom = getLandmark(landmarks, 8);\n        return {\n            x: (chinFront.x + chinBottom.x) / 2,\n            y: (chinFront.y + chinBottom.y) / 2\n        };\n    },\n\n    rhinion: (landmarks, namedPoints) => {\n        if (!namedPoints.pronasale || !namedPoints.nasion) return null;\n        const pronasale = toPixels(namedPoints.pronasale, landmarks.imageWidth, landmarks.imageHeight);\n        return translatePoint(pronasale, {\n            along: { from: pronasale, to: toPixels(namedPoints.nasion, landmarks.imageWidth, landmarks.imageHeight) },\n            by: euclidean(getLandmark(landmarks, 74), getLandmark(landmarks, 72))\n        });\n    }\n    // ... additional calculated points\n};\n```\n\n---\n\n## 5. Ratio Calculation Functions\n\n### 5.1 Core Utility Functions\n\n```javascript\n/**\n * Calculate Euclidean distance between two points\n */\nfunction euclidean(point1, point2) {\n    const dx = point2.x - point1.x;\n    const dy = point2.y - point1.y;\n    return Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Calculate midpoint between two points\n */\nfunction midpoint(point1, point2) {\n    return {\n        x: (point1.x + point2.x) / 2,\n        y: (point1.y + point2.y) / 2\n    };\n}\n\n/**\n * Safe division with fallback\n */\nfunction ratio(numerator, denominator, fallback = 0) {\n    if (!isFinite(numerator) || !isFinite(denominator) || Math.abs(denominator) < 1e-10) {\n        return fallback;\n    }\n    const result = numerator / denominator;\n    return isFinite(result) ? result : fallback;\n}\n\n/**\n * Calculate angle at vertex (in degrees)\n * Returns angle ABC where B is the vertex\n */\nfunction angle(pointA, vertex, pointC) {\n    const vectorBA = { x: pointA.x - vertex.x, y: pointA.y - vertex.y };\n    const vectorBC = { x: pointC.x - vertex.x, y: pointC.y - vertex.y };\n\n    const dotProduct = vectorBA.x * vectorBC.x + vectorBA.y * vectorBC.y;\n    const magnitudeProduct = Math.sqrt(vectorBA.x ** 2 + vectorBA.y ** 2) *\n                             Math.sqrt(vectorBC.x ** 2 + vectorBC.y ** 2);\n\n    if (Math.abs(magnitudeProduct) < 1e-10) return 0;\n\n    const cosAngle = Math.max(-1, Math.min(1, dotProduct / magnitudeProduct));\n    return (180 / Math.PI) * Math.acos(cosAngle);\n}\n```\n\n### 5.2 Front Profile Ratio Calculations\n\n```javascript\nconst FRONT_RATIO_CALCULATIONS = {\n    \"Midface Ratio\": (landmarks) => {\n        const leftPupil = landmarks.leftEyePupil;\n        const rightPupil = landmarks.rightEyePupil;\n        const cupidsBow = landmarks.cupidsBow;\n        if (!leftPupil || !rightPupil || !cupidsBow) return null;\n\n        const eyeWidth = Math.abs(rightPupil.x - leftPupil.x);\n        const eyeCenterY = (leftPupil.y + rightPupil.y) / 2;\n        return ratio(eyeWidth, Math.abs(cupidsBow.y - eyeCenterY));\n    },\n\n    \"Eye Separation Ratio\": (landmarks) => {\n        const leftPupil = landmarks.leftEyePupil;\n        const rightPupil = landmarks.rightEyePupil;\n        const leftCheek = landmarks.leftCheek;\n        const rightCheek = landmarks.rightCheek;\n        if (!leftPupil || !rightPupil || !leftCheek || !rightCheek) return null;\n\n        return 100 * ratio(\n            Math.abs(rightPupil.x - leftPupil.x),\n            Math.abs(rightCheek.x - leftCheek.x)\n        );\n    },\n\n    \"Total Facial Width to Height Ratio\": (landmarks) => {\n        const leftCheek = landmarks.leftCheek;\n        const rightCheek = landmarks.rightCheek;\n        const hairline = landmarks.hairline;\n        const chinBottom = landmarks.chinBottom;\n        if (!leftCheek || !rightCheek || !hairline || !chinBottom) return null;\n\n        return ratio(\n            Math.abs(chinBottom.y - hairline.y),\n            Math.abs(rightCheek.x - leftCheek.x)\n        );\n    },\n\n    \"Bigonial Width\": (landmarks) => {\n        const leftGonion = landmarks.leftTopGonion;\n        const rightGonion = landmarks.rightTopGonion;\n        const leftCheek = landmarks.leftCheek;\n        const rightCheek = landmarks.rightCheek;\n        if (!leftGonion || !rightGonion || !leftCheek || !rightCheek) return null;\n\n        return 100 * ratio(\n            Math.abs(rightGonion.x - leftGonion.x),\n            Math.abs(rightCheek.x - leftCheek.x)\n        );\n    },\n\n    \"Lateral Canthal Tilt\": (landmarks) => {\n        const leftMedial = landmarks.leftEyeMedialCanthus;\n        const leftLateral = landmarks.leftEyeLateralCanthus;\n        const rightMedial = landmarks.rightEyeMedialCanthus;\n        const rightLateral = landmarks.rightEyeLateralCanthus;\n        if (!leftMedial || !leftLateral || !rightMedial || !rightLateral) return null;\n\n        const leftTilt = (180 / Math.PI) * Math.atan2(\n            leftMedial.y - leftLateral.y,\n            leftMedial.x - leftLateral.x\n        );\n        const rightTilt = (180 / Math.PI) * Math.atan2(\n            rightMedial.y - rightLateral.y,\n            rightLateral.x - rightMedial.x\n        );\n        return (leftTilt + rightTilt) / 2;\n    },\n\n    \"Lower Third\": (landmarks) => {\n        const hairline = landmarks.hairline;\n        const noseBottom = landmarks.noseBottom;\n        const chinBottom = landmarks.chinBottom;\n        const leftBrowInner = landmarks.leftBrowInnerCorner;\n        const leftBrowHead = landmarks.leftBrowHead;\n        const rightBrowInner = landmarks.rightBrowInnerCorner;\n        const rightBrowHead = landmarks.rightBrowHead;\n        if (!hairline || !noseBottom || !chinBottom || !leftBrowInner ||\n            !leftBrowHead || !rightBrowInner || !rightBrowHead) return null;\n\n        const faceHeight = Math.abs(chinBottom.y - hairline.y);\n        return ((chinBottom.y - noseBottom.y) / faceHeight) * 100;\n    },\n\n    \"Middle Third\": (landmarks) => {\n        const hairline = landmarks.hairline;\n        const noseBottom = landmarks.noseBottom;\n        const chinBottom = landmarks.chinBottom;\n        const leftBrowInner = landmarks.leftBrowInnerCorner;\n        const leftBrowHead = landmarks.leftBrowHead;\n        const rightBrowInner = landmarks.rightBrowInnerCorner;\n        const rightBrowHead = landmarks.rightBrowHead;\n        if (!hairline || !noseBottom || !chinBottom || !leftBrowInner ||\n            !leftBrowHead || !rightBrowInner || !rightBrowHead) return null;\n\n        const faceHeight = Math.abs(chinBottom.y - hairline.y);\n        const browMid = midpoint(midpoint(leftBrowInner, leftBrowHead),\n                                  midpoint(rightBrowInner, rightBrowHead));\n        return ((noseBottom.y - browMid.y) / faceHeight) * 100;\n    },\n\n    \"Top Third\": (landmarks) => {\n        const hairline = landmarks.hairline;\n        const chinBottom = landmarks.chinBottom;\n        const leftBrowInner = landmarks.leftBrowInnerCorner;\n        const leftBrowHead = landmarks.leftBrowHead;\n        const rightBrowInner = landmarks.rightBrowInnerCorner;\n        const rightBrowHead = landmarks.rightBrowHead;\n        if (!hairline || !chinBottom || !leftBrowInner || !leftBrowHead ||\n            !rightBrowInner || !rightBrowHead) return null;\n\n        const faceHeight = Math.abs(chinBottom.y - hairline.y);\n        const browMid = midpoint(midpoint(leftBrowInner, leftBrowHead),\n                                  midpoint(rightBrowInner, rightBrowHead));\n        return ((browMid.y - hairline.y) / faceHeight) * 100;\n    },\n\n    \"Eye Aspect Ratio\": (landmarks) => {\n        const leftMedial = landmarks.leftEyeMedialCanthus;\n        const leftLateral = landmarks.leftEyeLateralCanthus;\n        const leftUpper = landmarks.leftEyeUpperEyelid;\n        const leftLower = landmarks.leftEyeLowerEyelid;\n        const rightMedial = landmarks.rightEyeMedialCanthus;\n        const rightLateral = landmarks.rightEyeLateralCanthus;\n        const rightUpper = landmarks.rightEyeUpperEyelid;\n        const rightLower = landmarks.rightEyeLowerEyelid;\n        if (!leftMedial || !leftLateral || !leftUpper || !leftLower ||\n            !rightMedial || !rightLateral || !rightUpper || !rightLower) return null;\n\n        const leftRatio = ratio(Math.abs(leftLateral.x - leftMedial.x),\n                                Math.abs(leftLower.y - leftUpper.y));\n        const rightRatio = ratio(Math.abs(rightLateral.x - rightMedial.x),\n                                 Math.abs(rightLower.y - rightUpper.y));\n        return (leftRatio + rightRatio) / 2;\n    },\n\n    \"Jaw Frontal Angle\": (landmarks) => {\n        const leftGonion = landmarks.leftBottomGonion;\n        const rightGonion = landmarks.rightBottomGonion;\n        const chinLeft = landmarks.chinLeft;\n        const chinRight = landmarks.chinRight;\n        if (!leftGonion || !rightGonion || !chinLeft || !chinRight) return null;\n\n        // Calculate angle between jaw lines\n        return 180 - angle(leftGonion, chinLeft, chinRight, rightGonion);\n    }\n};\n```\n\n### 5.3 Side Profile Ratio Calculations\n\n```javascript\nconst SIDE_RATIO_CALCULATIONS = {\n    \"Gonial Angle\": (landmarks) => {\n        const gonionTop = landmarks.gonionTop;\n        const gonionBottom = landmarks.gonionBottom;\n        const menton = landmarks.menton;\n        const tragus = landmarks.intertragicNotch;\n        if (!gonionTop || !gonionBottom || !menton || !tragus) return null;\n\n        const angle1 = Math.atan2(gonionTop.y - tragus.y, gonionTop.x - tragus.x);\n        const angle2 = Math.atan2(gonionBottom.y - menton.y, gonionBottom.x - menton.x);\n        let angleDiff = (180 / Math.PI) * Math.abs(angle1 - angle2);\n        return angleDiff > 180 ? 360 - angleDiff : angleDiff;\n    },\n\n    \"Nasolabial Angle\": (landmarks) => {\n        const columella = landmarks.columella;\n        const subnasale = landmarks.subnasale;\n        const labraleSuperius = landmarks.labraleSuperius;\n        if (!columella || !subnasale || !labraleSuperius) return null;\n\n        return angle(columella, subnasale, labraleSuperius);\n    },\n\n    \"Nasofrontal Angle\": (landmarks) => {\n        const glabella = landmarks.glabella;\n        const nasion = landmarks.nasion;\n        const supratip = landmarks.supratip;\n        if (!glabella || !nasion || !supratip) return null;\n\n        return angle(glabella, nasion, supratip);\n    },\n\n    \"Mentolabial Angle\": (landmarks) => {\n        const labraleInferius = landmarks.labraleInferius;\n        const sublabiale = landmarks.sublabiale;\n        const pogonion = landmarks.pogonion;\n        if (!labraleInferius || !sublabiale || !pogonion) return null;\n\n        return angle(labraleInferius, sublabiale, pogonion);\n    },\n\n    \"Facial Convexity (Glabella)\": (landmarks) => {\n        const glabella = landmarks.glabella;\n        const subnasale = landmarks.subnasale;\n        const pogonion = landmarks.pogonion;\n        if (!glabella || !subnasale || !pogonion) return null;\n\n        return angle(glabella, subnasale, pogonion);\n    },\n\n    \"Total Facial Convexity\": (landmarks) => {\n        const glabella = landmarks.glabella;\n        const pronasale = landmarks.pronasale;\n        const pogonion = landmarks.pogonion;\n        if (!glabella || !pronasale || !pogonion) return null;\n\n        const baseAngle = angle(glabella, pronasale, pogonion);\n\n        // Determine if convex or concave\n        const v1 = { x: glabella.x - pronasale.x, y: glabella.y - pronasale.y };\n        const v2 = { x: pogonion.x - pronasale.x, y: pogonion.y - pronasale.y };\n        const cross = v1.x * v2.y - v1.y * v2.x;\n\n        return cross < 0 ? baseAngle : 360 - baseAngle;\n    },\n\n    \"Submental Cervical Angle\": (landmarks) => {\n        const menton = landmarks.menton;\n        const cervicalPoint = landmarks.cervicalPoint;\n        const neckPoint = landmarks.neckPoint;\n        if (!menton || !cervicalPoint || !neckPoint) return null;\n\n        return angle(menton, cervicalPoint, neckPoint);\n    },\n\n    \"Nasal Tip Angle\": (landmarks) => {\n        const supratip = landmarks.supratip;\n        const pronasale = landmarks.pronasale;\n        const infratip = landmarks.infratip;\n        if (!supratip || !pronasale || !infratip) return null;\n\n        return angle(supratip, pronasale, infratip);\n    },\n\n    \"Nasofacial Angle\": (landmarks) => {\n        const nasion = landmarks.nasion;\n        const pronasale = landmarks.pronasale;\n        const pogonion = landmarks.pogonion;\n        if (!nasion || !pronasale || !pogonion) return null;\n\n        const baseAngle = angle(pronasale, nasion, pogonion);\n        return baseAngle > 90 ? 180 - baseAngle : baseAngle;\n    },\n\n    \"Mandibular Plane Angle\": (landmarks) => {\n        const gonionTop = landmarks.gonionTop;\n        const gonionBottom = landmarks.gonionBottom;\n        const menton = landmarks.menton;\n        const tragus = landmarks.tragus;\n        if (!gonionTop || !gonionBottom || !menton || !tragus) return null;\n\n        // Calculate intersection of mandibular plane with Frankfort horizontal\n        // Complex geometric calculation...\n        // Returns angle in degrees\n    }\n};\n```\n\n---\n\n## 6. Decoded Scoring Standards Database\n\n### 6.1 Confirmed Ratios (Clear Names)\n\n| Ratio Name | Ideal Min | Ideal Max | Unit | Profile | Decay Rate |\n|------------|-----------|-----------|------|---------|------------|\n| Top Third | 29.00 | 33.00 | % | Front | 0.2 |\n| Middle Third | 31.00 | 34.00 | % | Front | 0.2 |\n| Lower Third | 33.40 | 37.50 | % | Front | 0.2 |\n| Eye Separation Ratio | 45.00 | 47.50 | % | Front | 0.2 |\n| Eyebrow Low Setedness | 0.00 | 0.66 | x | Front | 0.2 |\n| Total Facial Width to Height Ratio | 1.33 | 1.38 | x | Front | 0.2 |\n| Gonial Angle | 113.00 | 123.00 | ° | Side | 0.2 |\n| Facial Convexity (Glabella) | 167.00 | 176.00 | ° | Side | 0.2 |\n| Submental Cervical Angle | 92.00 | 110.00 | ° | Side | 0.2 |\n| Recession relative to Frankfort plane | 0.00 | 15.00 | mm | Side | 0.2 |\n\n### 6.2 Fingerprinted Ratios (Decoded from Obfuscation)\n\nBased on anthropometric analysis matching ideal ranges to scientific literature:\n\n| Predicted Ratio Name | Ideal Min | Ideal Max | Unit | Confidence | Evidence |\n|---------------------|-----------|-----------|------|------------|----------|\n| **Nasolabial Angle** | 60.54 | 105.97 | ° | 95% | Matches Farkas 90-105° standard |\n| **Nasofrontal Angle** | 142.50 | 150.12 | ° | 95% | Matches Powell 130-140° (scaled) |\n| **Mentolabial Angle** | 65.19 | 101.55 | ° | 85% | Matches standard 80-120° |\n| **Eye Aspect Ratio** | 2.44 | 2.89 | x | 85% | Matches Farkas palpebral fissure 2.5-3.0 |\n| **Lower Lip E-Line Position** | -25.61 | -11.04 | DW | 90% | Ricketts E-line standard (scaled) |\n| **Upper Lip E-Line Position** | -18.63 | -8.83 | DW | 90% | Upper lip E-line standard (scaled) |\n| **Upper Lip S-Line Position** | -4.66 | 0.00 | DW | 75% | Steiner S-line standard |\n| **Lower Lip S-Line Position** | -2.33 | 2.21 | DW | 75% | S-line balanced position |\n| **Upper Lip Burstone Line** | -2.33 | 2.21 | DW | 70% | Burstone line standard |\n| **Deviation of IAA & JFA** | 0.00 | 11.04 | DW | 85% | Zero = perfect symmetry |\n| **Ear Protrusion Angle** | 0.00 | 17.66 | ° | 80% | Standard 15-20° from head |\n| **Bigonial Width %** | 37.25 | 57.40 | % | 80% | Jaw-to-face width ratio |\n| **Bitemporal Width %** | 46.57 | 52.98 | % | 80% | Temple-to-cheek ratio |\n| **Chin to Philtrum Ratio** | 4.42 | 4.50 | DW | 80% | Very tight range (critical ratio) |\n| **Total Facial Convexity** | 135.05 | 172.19 | ° | 85% | Standard 140-150° |\n| **Nasal Tip Angle** | 139.70 | 158.95 | ° | 70% | Nasal tip definition |\n| **Mouth Width to Nose Width** | 2.77 | 3.78 | x | 65% | Powell 1.5x (scaled ~3.0) |\n| **Lower Lip to Upper Lip Ratio** | 4.19 | 4.46 | DW | 70% | Standard 1:1.6-2.0 (scaled) |\n| **Ipsilateral Alar Angle** | 26.08 | 36.65 | ° | 60% | Midface width relationship |\n| **Cheekbone Height %** | 23.28 | 57.40 | % | 65% | Position as % of face height |\n| **Mandibular Plane Angle** | 41.91 | 97.13 | DW | 65% | Wide range (scaled 20-30°) |\n\n### 6.3 Understanding the \"DW\" Unit\n\nThe \"DW\" (Digital Width) unit appears to be a **normalized measurement system**:\n\n```\nDW = Actual_Measurement × Scale_Factor\n\nWhere Scale_Factor ≈ 10 for mm measurements\n      Scale_Factor ≈ 100 for small ratios\n```\n\n**Conversion Guide:**\n- Values 0-50 DW → Likely percentages or small ratios\n- Values 50-200 DW → Likely angles in degrees or scaled mm\n- Values 300-800 DW → Likely mm measurements × 10 or complex scaled ratios\n\n### 6.4 Complete Ratio Configuration Schema\n\n```javascript\nconst RATIO_CONFIG = {\n    \"Top Third\": {\n        name: \"Top Third\",\n        profileType: \"front\",\n        idealMin: 29.00,\n        idealMax: 33.00,\n        unit: \"%\",\n        decayRate: 0.2,\n        category: \"Facial Proportions\",\n        description: \"Percentage of face height from hairline to brow line\",\n        landmarks: [\"hairline\", \"leftBrowHead\", \"leftBrowInnerCorner\",\n                   \"rightBrowHead\", \"rightBrowInnerCorner\", \"chinBottom\"]\n    },\n    \"Nasolabial Angle\": {\n        name: \"Nasolabial Angle\",\n        profileType: \"side\",\n        idealMin: 90.00,  // Unscaled standard value\n        idealMax: 105.00,\n        unit: \"°\",\n        decayRate: 0.2,\n        category: \"Nasal Angles\",\n        description: \"Angle between columella and upper lip\",\n        landmarks: [\"columella\", \"subnasale\", \"labraleSuperius\"],\n        scientificReference: \"Farkas LG, 1994\"\n    },\n    // ... additional configurations\n};\n```\n\n---\n\n## 7. Implementation Strategy\n\n### 7.1 Required Libraries\n\n```json\n{\n  \"dependencies\": {\n    \"@mediapipe/tasks-vision\": \"^0.10.0\",\n    \"react\": \"^18.0.0\",\n    \"next\": \"^14.0.0\"\n  },\n  \"devDependencies\": {\n    \"typescript\": \"^5.0.0\"\n  }\n}\n```\n\n**Python Backend (Alternative):**\n```\nmediapipe>=0.10.0\nopencv-python>=4.8.0\nnumpy>=1.24.0\nflask>=2.3.0  # or fastapi\n```\n\n### 7.2 Project Structure\n\n```\nfacial-analysis/\n├── src/\n│   ├── lib/\n│   │   ├── mediapipe/\n│   │   │   ├── faceLandmarker.ts      # MediaPipe initialization\n│   │   │   └── landmarkMapper.ts       # Index to name mapping\n│   │   ├── calculations/\n│   │   │   ├── ratios.ts              # Ratio calculation functions\n│   │   │   ├── scoring.ts             # Score calculation engine\n│   │   │   └── utilities.ts           # Math helper functions\n│   │   ├── standards/\n│   │   │   ├── idealRanges.ts         # Ideal min/max database\n│   │   │   └── ratioConfig.ts         # Full ratio configurations\n│   │   └── types/\n│   │       └── index.ts               # TypeScript interfaces\n│   ├── components/\n│   │   ├── FaceCapture.tsx            # Camera/upload component\n│   │   ├── AnalysisResults.tsx        # Score display\n│   │   └── RatioVisualization.tsx     # Overlay visualization\n│   └── api/\n│       └── side-landmarks/\n│           └── route.ts               # Side profile API\n├── public/\n│   └── models/                        # MediaPipe model files\n└── package.json\n```\n\n### 7.3 TypeScript Interfaces\n\n```typescript\ninterface Point {\n    x: number;\n    y: number;\n    z?: number;\n}\n\ninterface NamedLandmarks {\n    [key: string]: Point | null;\n}\n\ninterface RatioConfig {\n    name: string;\n    profileType: \"front\" | \"side\";\n    idealMin: number;\n    idealMax: number;\n    unit: string;\n    decayRate: number;\n    category: string;\n    description: string;\n    landmarks: string[];\n    calculationFn?: (landmarks: NamedLandmarks) => number | null;\n}\n\ninterface RatioResult {\n    name: string;\n    value: number | null;\n    score: number | null;\n    standardizedScore: number;\n    idealMin: number;\n    idealMax: number;\n    unit: string;\n    deviation: \"below\" | \"ideal\" | \"above\";\n    isIdeal: boolean;\n}\n\ninterface AnalysisResult {\n    frontRatios: RatioResult[];\n    sideRatios: RatioResult[];\n    overallScore: number;\n    categoryScores: { [category: string]: number };\n    landmarks: {\n        front: NamedLandmarks;\n        side: NamedLandmarks;\n    };\n}\n```\n\n### 7.4 Quick Start Implementation\n\n```typescript\n// main.ts - Minimal implementation\n\nimport { FaceLandmarker, FilesetResolver } from \"@mediapipe/tasks-vision\";\nimport { FRONT_LANDMARK_INDICES, FRONT_RATIO_CALCULATIONS, RATIO_CONFIG } from \"./config\";\n\nclass FacialAnalyzer {\n    private faceLandmarker: FaceLandmarker | null = null;\n\n    async initialize() {\n        const wasmFileset = await FilesetResolver.forVisionTasks(\n            \"https://cdn.jsdelivr.net/npm/@mediapipe/tasks-vision@latest/wasm\"\n        );\n\n        this.faceLandmarker = await FaceLandmarker.createFromModelPath(\n            wasmFileset,\n            \"https://storage.googleapis.com/mediapipe-models/face_landmarker/face_landmarker/float16/1/face_landmarker.task\"\n        );\n    }\n\n    analyzeFrontProfile(imageElement: HTMLImageElement): AnalysisResult {\n        if (!this.faceLandmarker) throw new Error(\"Not initialized\");\n\n        // Detect landmarks\n        const results = this.faceLandmarker.detect(imageElement);\n        if (!results.faceLandmarks.length) throw new Error(\"No face detected\");\n\n        const rawLandmarks = results.faceLandmarks[0];\n\n        // Map to named points\n        const namedLandmarks = this.mapLandmarks(rawLandmarks, imageElement);\n\n        // Calculate ratios\n        const ratios = this.calculateRatios(namedLandmarks, \"front\");\n\n        // Score ratios\n        const scoredRatios = this.scoreRatios(ratios);\n\n        return {\n            frontRatios: scoredRatios,\n            sideRatios: [],\n            overallScore: this.calculateOverallScore(scoredRatios),\n            categoryScores: this.calculateCategoryScores(scoredRatios),\n            landmarks: { front: namedLandmarks, side: {} }\n        };\n    }\n\n    private mapLandmarks(raw: Point[], image: HTMLImageElement): NamedLandmarks {\n        const named: NamedLandmarks = {};\n\n        for (const [name, index] of Object.entries(FRONT_LANDMARK_INDICES)) {\n            if (typeof index === \"number\" && raw[index]) {\n                named[name] = {\n                    x: raw[index].x * image.width,\n                    y: raw[index].y * image.height\n                };\n            }\n        }\n\n        return named;\n    }\n\n    private calculateRatios(landmarks: NamedLandmarks, profile: \"front\" | \"side\") {\n        const calculations = profile === \"front\"\n            ? FRONT_RATIO_CALCULATIONS\n            : SIDE_RATIO_CALCULATIONS;\n\n        return Object.entries(calculations).map(([name, fn]) => ({\n            name,\n            value: fn(landmarks),\n            config: RATIO_CONFIG[name]\n        }));\n    }\n\n    private scoreRatios(ratios: any[]): RatioResult[] {\n        return ratios.map(r => {\n            const score = r.value !== null\n                ? this.calculateScore(r.value, r.config.idealMin, r.config.idealMax, r.config.decayRate)\n                : null;\n\n            return {\n                name: r.name,\n                value: r.value,\n                score,\n                standardizedScore: score ?? 0,\n                idealMin: r.config.idealMin,\n                idealMax: r.config.idealMax,\n                unit: r.config.unit,\n                deviation: this.getDeviation(r.value, r.config.idealMin, r.config.idealMax),\n                isIdeal: r.value !== null && r.value >= r.config.idealMin && r.value <= r.config.idealMax\n            };\n        });\n    }\n\n    private calculateScore(value: number, min: number, max: number, decay: number = 0.2): number {\n        const maxScore = 10;\n        const minScore = -maxScore;\n\n        let rawScore: number;\n        if (value >= min && value <= max) {\n            rawScore = maxScore;\n        } else {\n            const distance = value < min ? (min - value) : (value - max);\n            rawScore = minScore + (maxScore - minScore) * Math.exp(-decay * distance);\n        }\n\n        const range = maxScore - minScore;\n        return Math.max(0, Math.min(10, ((rawScore - minScore) / range) * 10));\n    }\n\n    private getDeviation(value: number | null, min: number, max: number): \"below\" | \"ideal\" | \"above\" {\n        if (value === null) return \"ideal\";\n        if (value < min) return \"below\";\n        if (value > max) return \"above\";\n        return \"ideal\";\n    }\n\n    private calculateOverallScore(ratios: RatioResult[]): number {\n        const validScores = ratios.filter(r => r.score !== null).map(r => r.score!);\n        return validScores.length ? validScores.reduce((a, b) => a + b, 0) / validScores.length : 0;\n    }\n\n    private calculateCategoryScores(ratios: RatioResult[]): { [key: string]: number } {\n        const categories: { [key: string]: number[] } = {};\n\n        for (const ratio of ratios) {\n            const category = RATIO_CONFIG[ratio.name]?.category || \"Other\";\n            if (!categories[category]) categories[category] = [];\n            if (ratio.score !== null) categories[category].push(ratio.score);\n        }\n\n        const scores: { [key: string]: number } = {};\n        for (const [cat, values] of Object.entries(categories)) {\n            scores[cat] = values.length ? values.reduce((a, b) => a + b, 0) / values.length : 0;\n        }\n\n        return scores;\n    }\n}\n\nexport default FacialAnalyzer;\n```\n\n---\n\n## 8. API Reference\n\n### 8.1 Side Landmarks API\n\n**Endpoint:** `POST /api/side-landmarks`\n\n**Request:**\n```\nContent-Type: multipart/form-data\n\nFields:\n- image: JPEG/PNG file (side profile photo)\n```\n\n**Response:**\n```json\n{\n    \"success\": true,\n    \"data\": {\n        \"landmarks\": [\n            { \"x\": 0.123, \"y\": 0.456 },\n            // ... 106 landmark points\n        ],\n        \"direction\": \"left\",  // or \"right\"\n        \"rotationAngle\": 2.5,\n        \"center\": { \"x\": 0.5, \"y\": 0.5 },\n        \"crop\": {\n            \"x\": 100,\n            \"y\": 50,\n            \"width\": 400,\n            \"height\": 500,\n            \"scale\": 1.2\n        },\n        \"bbox\": {\n            \"minX\": 100,\n            \"minY\": 50,\n            \"maxX\": 500,\n            \"maxY\": 550\n        }\n    }\n}\n```\n\n### 8.2 Analysis API\n\n**Endpoint:** `POST /api/faces`\n\n**Request:**\n```json\n{\n    \"frontPhotoUrl\": \"data:image/jpeg;base64,...\",\n    \"sidePhotoUrl\": \"data:image/jpeg;base64,...\",\n    \"gender\": \"male\",\n    \"ethnicity\": \"caucasian\"\n}\n```\n\n**Response:**\n```json\n{\n    \"success\": true,\n    \"faceId\": \"abc123\",\n    \"frontRatios\": [\n        {\n            \"name\": \"Eye Separation Ratio\",\n            \"value\": 46.5,\n            \"score\": 9.2,\n            \"standardizedScore\": 9.2,\n            \"unit\": \"%\",\n            \"idealMin\": 45.0,\n            \"idealMax\": 47.5\n        }\n    ],\n    \"sideRatios\": [...],\n    \"overallScore\": 7.8\n}\n```\n\n---\n\n## Appendix A: Scientific References\n\n1. **Farkas LG** (1994). \"Anthropometry of the Head and Face\" - Primary source for facial proportions\n2. **Powell N, Humphreys B** (1984). \"Proportions of the Aesthetic Face\" - Golden ratio applications\n3. **Ricketts RM** (1968). \"The Esthetic E-Plane\" - E-line lip position standards\n4. **Steiner CC** (1959). \"Cephalometrics for You and Me\" - S-line standards\n5. **Burstone CJ** (1967). \"Lip Posture and Its Significance\" - Burstone line\n\n---\n\n## Appendix B: Changelog\n\n| Version | Date | Changes |\n|---------|------|---------|\n| 1.0 | Dec 2024 | Initial reverse-engineering documentation |\n\n---\n\n*This document was created through reverse-engineering of publicly accessible web application code for educational and research purposes.*\n","numLines":1241,"startLine":1,"totalLines":1241}}}
{"parentUuid":"f38a84e6-975d-47fc-8616-92bd02849627","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Y6bncGhX9BpwLN5fVMErbG","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/TECHNICAL_SPECS.md\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/README.md\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/public/landmark-mapper.html","is_error":false}]},"uuid":"e68cf7e5-77d2-4b5b-933f-8f68611b434f","timestamp":"2025-12-19T21:04:19.585Z","toolUseResult":{"stdout":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/TECHNICAL_SPECS.md\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/README.md\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/public/landmark-mapper.html","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"e68cf7e5-77d2-4b5b-933f-8f68611b434f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"84d64d7a-5678-4336-ba2c-aa2032a0de06","version":"2.0.70","gitBranch":"main","agentId":"a91430c","slug":"zazzy-stargazing-brook","message":{"model":"claude-haiku-4-5-20251001","id":"msg_0169n2dLrw1m44LndiBrNZmG","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect! Now I have all the necessary information. Let me create a comprehensive comparison report.\n\n## COMPREHENSIVE FACIAL METRICS CALCULATION ANALYSIS & COMPARISON\n\nI have conducted a thorough analysis of the facial metrics calculations in your project. Here's the detailed comparison:\n\n---\n\n### PART 1: DISTANCE CALCULATIONS\n\n**In TECHNICAL_SPECS.md (Original landmarkers.js concepts):**\n```javascript\nfunction euclidean(point1, point2) {\n    const dx = point2.x - point1.x;\n    const dy = point2.y - point1.y;\n    return Math.sqrt(dx * dx + dy * dy);\n}\n```\n\n**In src/lib/scoring.ts:**\n```typescript\nexport function distance(p1: Point, p2: Point): number {\n  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n}\n```\n\n**Difference:** Only stylistic - `Math.pow(x, 2)` vs `x * x`. Both compute Euclidean distance identically. ✓ MATCH\n\n---\n\n### PART 2: ANGLE CALCULATIONS\n\n**In TECHNICAL_SPECS.md (Original):**\n```javascript\nfunction angle(pointA, vertex, pointC) {\n    const vectorBA = { x: pointA.x - vertex.x, y: pointA.y - vertex.y };\n    const vectorBC = { x: pointC.x - vertex.x, y: pointC.y - vertex.y };\n    const dotProduct = vectorBA.x * vectorBC.x + vectorBA.y * vectorBC.y;\n    const magnitudeProduct = Math.sqrt(vectorBA.x ** 2 + vectorBA.y ** 2) *\n                             Math.sqrt(vectorBC.x ** 2 + vectorBC.y ** 2);\n    if (Math.abs(magnitudeProduct) < 1e-10) return 0;\n    const cosAngle = Math.max(-1, Math.min(1, dotProduct / magnitudeProduct));\n    return (180 / Math.PI) * Math.acos(cosAngle);\n}\n```\n\n**In src/lib/scoring.ts:**\n```typescript\nexport function calculateAngle(p1: Point, vertex: Point, p2: Point): number {\n  const v1 = { x: p1.x - vertex.x, y: p1.y - vertex.y };\n  const v2 = { x: p2.x - vertex.x, y: p2.y - vertex.y };\n  const dot = v1.x * v2.x + v1.y * v2.y;\n  const cross = v1.x * v2.y - v1.y * v2.x;\n  const angle = Math.atan2(cross, dot) * (180 / Math.PI);\n  return Math.abs(angle);\n}\n```\n\n**CRITICAL DIFFERENCE:**\n- **Original:** Uses dot product + arccos for angle calculation\n  - Formula: `acos(dotProduct / (mag1 × mag2))`\n  - Outputs unsigned angle (always 0-180°)\n  \n- **Current:** Uses atan2 (cross product + dot product)\n  - Formula: `atan2(cross, dot)`\n  - Takes absolute value of result\n  - Also outputs unsigned angle (0-180°)\n\n**Mathematical Equivalence:** ✓ Both produce same unsigned angles. The atan2 approach is more robust for signed angles but takes absolute value, making them equivalent for this use case.\n\n---\n\n### PART 3: RATIO CALCULATIONS\n\n**Core Method - Both identical:**\n```typescript\n// Both use: numerator / denominator\nconst ratio = distance(point1, point2) / distance(point3, point4);\n```\n\n**Example from TECHNICAL_SPECS.md (Eye Separation Ratio):**\n```javascript\n\"Eye Separation Ratio\": (landmarks) => {\n    return 100 * ratio(\n        Math.abs(rightPupil.x - leftPupil.x),\n        Math.abs(rightCheek.x - leftCheek.x)\n    );\n}\n```\n\n**Equivalent in src/lib/scoring.ts (Interpupillary Distance Ratio):**\n```typescript\nexport function calculateIPDRatio(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n  const ipd = distance(left_pupila, right_pupila);\n  const bizygomatic_width = distance(left_zygion, right_zygion);\n  const ratio = (ipd / bizygomatic_width) * 100;\n}\n```\n\n**Difference:** None - both normalize by multiplying by 100. ✓ MATCH\n\n---\n\n### PART 4: FACIAL THIRDS CALCULATION\n\n**In TECHNICAL_SPECS.md (Original):**\n```javascript\n\"Top Third\": (landmarks) => {\n    return ((browMid.y - hairline.y) / faceHeight) * 100;\n}\n\"Middle Third\": (landmarks) => {\n    return ((noseBottom.y - browMid.y) / faceHeight) * 100;\n}\n\"Lower Third\": (landmarks) => {\n    return ((chinBottom.y - noseBottom.y) / faceHeight) * 100;\n}\n```\n\n**In src/lib/scoring.ts:**\n```typescript\nexport function calculateFacialThirds(frontLandmarks: LandmarkPoint[]): ... {\n  const totalHeight = distance(trichion, menton);\n  const upperThird = (distance(trichion, nasal_base) / totalHeight) * 100;\n  const middleThird = (distance(nasal_base, subnasale) / totalHeight) * 100;\n  const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n}\n```\n\n**LANDMARK MAPPING DIFFERENCE:**\n| Proportion | Original Tech Specs | Current Implementation |\n|------------|-------------------|----------------------|\n| Upper | hairline to brow midpoint | trichion to nasal_base |\n| Middle | brow midpoint to nose bottom | nasal_base to subnasale |\n| Lower | nose bottom to chin bottom | subnasale to menton |\n\n**Analysis:** The landmarks differ but the calculation method is identical (distance ratio × 100). However, the PROPORTIONS may differ due to different anatomical reference points.\n\n---\n\n### PART 5: PERPENDICULAR DISTANCE (E-LINE CALCULATION)\n\n**In TECHNICAL_SPECS.md (Original):** No explicit perpendicular distance function\n\n**In src/lib/scoring.ts:**\n```typescript\nexport function perpendicularDistance(\n  point: Point,\n  lineStart: Point,\n  lineEnd: Point\n): number {\n  const A = point.x - lineStart.x;\n  const B = point.y - lineStart.y;\n  const C = lineEnd.x - lineStart.x;\n  const D = lineEnd.y - lineStart.y;\n  \n  const dot = A * C + B * D;\n  const lenSq = C * C + D * D;\n  const param = lenSq !== 0 ? dot / lenSq : -1;\n  \n  // ... clamp param between 0-1 ...\n  \n  // Signed distance with determinant cross product\n  const sign = (lineEnd.y - lineStart.y) * point.x -\n               (lineEnd.x - lineStart.x) * point.y +\n               lineEnd.x * lineStart.y -\n               lineEnd.y * lineStart.x >= 0 ? 1 : -1;\n  \n  return sign * Math.sqrt(dx * dx + dy * dy);\n}\n```\n\n**OBSERVATION:** This is a **point-to-line signed distance** calculation used for E-Line (Ricketts' Esthetic Line). The original TECHNICAL_SPECS doesn't explicitly document this formula, making it a **new implementation** in current code.\n\n---\n\n### PART 6: SCORING FUNCTIONS (EXPONENTIAL DECAY)\n\n**In TECHNICAL_SPECS.md (Original):**\n```javascript\nfunction calculateScore(value, idealMin, idealMax, decayRate = 0.2, maxScore = 10) {\n    const minScore = -maxScore;\n    let rawScore;\n    \n    if (value >= idealMin && value <= idealMax) {\n        rawScore = maxScore;  // Perfect score = 10\n    } else {\n        const distance = value < idealMin ? (idealMin - value) : (value - idealMax);\n        rawScore = minScore + (maxScore - minScore) * Math.exp(-decayRate * distance);\n    }\n    \n    const range = maxScore - minScore;\n    const normalizedScore = (rawScore - minScore) / range * 10;\n    return Math.max(0, Math.min(10, normalizedScore));\n}\n```\n\n**In src/lib/scoring.ts (Bell Curve):**\n```typescript\nexport function calculateBellCurveScore(\n  value: number,\n  config: ScoringConfig\n): number {\n  const z = (value - config.idealValue) / config.standardDeviation;\n  const bellCurve = Math.exp(-0.5 * z * z);\n  return config.minScore + (config.maxScore - config.minScore) * bellCurve;\n}\n```\n\n**MAJOR DIFFERENCE:**\n\n| Aspect | Original | Current |\n|--------|----------|---------|\n| **Formula** | `e^(-decay × distance)` | `e^(-0.5 × z²)` where z = (value - ideal) / stdDev |\n| **Distance Metric** | Linear distance from range | Z-score (standard deviations) |\n| **Decay Rate** | Fixed 0.2 | Variable via `standardDeviation` |\n| **Scale** | 0-10 | Configured via `minScore`/`maxScore` |\n| **Curve Shape** | Exponential decay | Standard normal/Gaussian curve |\n\n**Formula Comparison:**\n- Original: `score = -10 + 20 × e^(-0.2 × |distance|)`\n- Current: `score = 0 + 100 × e^(-0.5 × ((value-ideal)/σ)²)` (for 0-100 scale)\n\nThe current approach is more statistically rigorous (using z-scores) and follows FaceIQ's actual implementation.\n\n---\n\n### PART 7: SPECIFIC METRIC CALCULATIONS\n\n#### **Gonial Angle (Jaw Angle)**\n\n**Original (TECHNICAL_SPECS):**\n```javascript\n\"Gonial Angle\": (landmarks) => {\n    const angle1 = Math.atan2(gonionTop.y - tragus.y, gonionTop.x - tragus.x);\n    const angle2 = Math.atan2(gonionBottom.y - menton.y, gonionBottom.x - menton.x);\n    let angleDiff = (180 / Math.PI) * Math.abs(angle1 - angle2);\n    return angleDiff > 180 ? 360 - angleDiff : angleDiff;\n}\n```\n\n**Current (src/lib/scoring.ts):**\n```typescript\nexport function calculateGonialAngle(\n  sideLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): ScoreResult | null {\n  const angle = calculateAngle(tragion, gonion_inferior, menton);\n  // Uses the generic calculateAngle function\n}\n```\n\n**DIFFERENCE:** \n- Original uses relative angle difference (two bearings)\n- Current uses three-point angle at vertex\n- **Likely produces different values** - requires verification\n\n---\n\n#### **Nasolabial Angle**\n\n**Original:**\n```javascript\n\"Nasolabial Angle\": (landmarks) => {\n    return angle(columella, subnasale, labraleSuperius);\n}\n```\n\n**Current:**\n```typescript\nexport function calculateNasolabialAngle(\n  sideLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): ScoreResult | null {\n  const angle = calculateAngle(columella, subnasale, labrale_superius);\n  // Uses the generic calculateAngle function\n}\n```\n\n**Difference:** Identical - both form angle at subnasale vertex. ✓ MATCH\n\n---\n\n#### **Facial Width-to-Height Ratio (FWHR)**\n\n**Original:**\n```javascript\n\"Total Facial Width to Height Ratio\": (landmarks) => {\n    return ratio(\n        Math.abs(chinBottom.y - hairline.y),\n        Math.abs(rightCheek.x - leftCheek.x)\n    );\n}\n```\n\n**Current:**\n```typescript\nexport function calculateFWHR(frontLandmarks: LandmarkPoint[]): ScoreResult | null {\n  const bizygomatic_width = distance(left_zygion, right_zygion);\n  const upper_face_height = distance(nasal_base, labrale_superius);\n  const ratio = bizygomatic_width / upper_face_height;\n}\n```\n\n**CRITICAL DIFFERENCE:**\n- Original: `(chin.y - hairline.y) / (rightCheek.x - leftCheek.x)` = **total face height / cheek width**\n- Current: `(left_zygion.x - right_zygion.x) / (nasal_base.y - labrale_superius.y)` = **bizygomatic width / upper face height**\n\n**These are INVERSE ratios!** Original measures height/width, current measures width/height. This is a **significant mathematical difference**.\n\n---\n\n### PART 8: NORMALIZATION & SCALING\n\n**Original (TECHNICAL_SPECS):**\n- Most percentages: multiply by 100\n- Ratios: keep as-is (e.g., 1.8-2.0 scale)\n- Angles: convert to degrees via `(180/π) × radians`\n- No standard scaling factor\n\n**Current (src/lib/scoring.ts):**\n- Percentages: multiply by 100 ✓ Match\n- Ratios: keep as-is ✓ Match\n- Angles: convert to degrees ✓ Match\n- Uses `normalCDF()` for z-score calculations (new)\n- Uses `generateBellCurveData()` for visualization (new)\n\n**Similarity:** ✓ Match for basic scaling\n\n---\n\n### PART 9: IDEAL VALUE & SCORING RANGES\n\n**Original (TECHNICAL_SPECS Table 6.1):**\n| Metric | Min | Max | Unit |\n|--------|-----|-----|------|\n| Top Third | 29.00 | 33.00 | % |\n| Gonial Angle | 113.00 | 123.00 | ° |\n| FWHR | 1.33 | 1.38 | x |\n\n**Current (src/lib/landmarks.ts FACEIQ_IDEAL_VALUES):**\n```typescript\nfwhr: {\n  male: { ideal: 1.9, range: [1.8, 2.1] },\n  female: { ideal: 1.75, range: [1.6, 1.9] },\n}\n```\n\n**MAJOR DIFFERENCE:**\n- Original: 1.33-1.38 range\n- Current: 1.75-2.1 range\n\n**This is NOT a scaling difference - these are completely different ideal ranges.** The current values align with modern FaceIQ research, while original may be outdated.\n\n---\n\n### PART 10: GENDER-SPECIFIC SCORING\n\n**Original (TECHNICAL_SPECS):** No gender-specific calculations mentioned\n\n**Current (src/lib/scoring.ts):**\n```typescript\nexport function calculateGenderAwareBellCurveScore(\n  value: number,\n  measurementKey: string,\n  gender: 'male' | 'female'\n): number {\n  const idealValues = FACEIQ_IDEAL_VALUES[measurementKey];\n  const genderIdeal = idealValues[gender].ideal;\n}\n```\n\n**Difference:** **NEW FEATURE** - Current implementation includes gender-specific ideal values that original doesn't document.\n\n---\n\n## SUMMARY TABLE: ALL MATHEMATICAL DIFFERENCES\n\n| Calculation | Original | Current | Match? | Impact |\n|-------------|----------|---------|--------|--------|\n| Euclidean Distance | `√((x₂-x₁)² + (y₂-y₁)²)` | `√((x₂-x₁)² + (y₂-y₁)²)` | ✓ | None |\n| Angle @ Vertex | `acos(dot/(mag₁×mag₂))` | `atan2(cross, dot)` (abs) | ✓ | None (equivalent) |\n| Ratio Calculation | `numerator / denominator` | `numerator / denominator` | ✓ | None |\n| Facial Thirds | Distance ratio × 100 | Distance ratio × 100 | ✓ | Different landmarks used |\n| Perpendicular Distance | Not documented | Point-to-line signed distance | ✗ | NEW in current |\n| Scoring Function | `e^(-0.2×distance)` to 0-10 | `e^(-0.5×z²)` to 0-100 | ✗ | **Different curves** |\n| FWHR Formula | `height/width` | `width/height` | ✗ | **INVERTED** |\n| FWHR Ideal Range | 1.33-1.38 | 1.75-2.1 (male) | ✗ | **Different values** |\n| Gonial Angle | Bearing difference | Three-point angle | ? | Needs verification |\n| Gender Consideration | None | Gender-aware scoring | ✗ | NEW feature |\n| Z-score Normalization | Not used | Used extensively | ✗ | NEW in current |\n\n---\n\n## KEY FINDINGS\n\n### Critical Issues:\n1. **FWHR is INVERTED** - Original height/width vs Current width/height\n2. **Gonial angle calculation differs** in methodology\n3. **Scoring curves are mathematically different** (exponential decay vs Gaussian)\n4. **Ideal ranges don't match** across multiple metrics\n\n### New Implementations (not in original):\n1. `perpendicularDistance()` for E-Line calculations\n2. Gender-specific scoring\n3. Standard normal CDF approximation\n4. Bell curve visualization data generation\n5. Weighted harmony scoring\n\n### File Locations for Reference:\n- Original formulas: `/Users/imorgado/LOOKSMAXX/TECHNICAL_SPECS.md` (lines 478-791)\n- Current implementation: `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring.ts` (entire file)\n- Ideal values: `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts` (lines 1107-1161)"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":27454,"cache_read_input_tokens":52809,"cache_creation":{"ephemeral_5m_input_tokens":27454,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWGixBiReCJjtJzboVZJK","type":"assistant","uuid":"12ba05d1-4500-4d86-82c1-cfed27842db9","timestamp":"2025-12-19T21:04:54.622Z"}
