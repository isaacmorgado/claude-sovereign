     1→/**
     2→ * FaceIQ-Style Facial Analysis Scoring System
     3→ * Complete replication of FaceIQ Labs scoring algorithms
     4→ *
     5→ * Features:
     6→ * - Exponential decay scoring with per-metric decay rates
     7→ * - Bezier curve custom scoring for non-linear measurements
     8→ * - 70+ facial measurements (front + side profiles)
     9→ * - Quality tiers: Ideal, Excellent, Good
    10→ * - 5-tier severity: Extremely Severe, Severe, Major, Moderate, Minor
    11→ */
    12→
    13→import { LandmarkPoint } from './landmarks';
    14→import { FACEIQ_BEZIER_CURVES } from './faceiq-bezier-curves';
    15→
    16→// ============================================
    17→// CORE TYPES
    18→// ============================================
    19→
    20→export interface Point {
    21→  x: number;
    22→  y: number;
    23→}
    24→
    25→export type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';
    26→export type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';
    27→export type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';
    28→
    29→/**
    30→ * Polarity defines how deviation from the ideal range is interpreted:
    31→ * - 'balanced': Default. Deviation in either direction is equally bad.
    32→ * - 'higher_is_better': Values above the ideal are still good. Only values below
    33→ *   the 'safeFloor' are true weaknesses. E.g., Canthal Tilt (positive tilt is good)
    34→ * - 'lower_is_better': Values below the ideal are still good. Only values above
    35→ *   the 'safeCeiling' are true weaknesses. E.g., Philtrum length (shorter is better)
    36→ */
    37→export type MetricPolarity = 'balanced' | 'higher_is_better' | 'lower_is_better';
    38→
    39→export interface MetricConfig {
    40→  id: string;
    41→  name: string;
    42→  category: string;
    43→  unit: MeasurementUnit;
    44→  idealMin: number;
    45→  idealMax: number;
    46→  rangeMin: number;
    47→  rangeMax: number;
    48→  decayRate: number;
    49→  maxScore: number;
    50→  weight: number;
    51→  description: string;
    52→  profileType: 'front' | 'side';
    53→  customCurve?: BezierCurveConfig;
    54→  /**
    55→   * Polarity for directional/dimorphic scoring.
    56→   * Defaults to 'balanced' if not specified.
    57→   */
    58→  polarity?: MetricPolarity;
    59→  /**
    60→   * For 'higher_is_better': minimum value that's still acceptable.
    61→   * Values above this but below idealMin get a passing score (softFloorScore).
    62→   * Values below this are true weaknesses.
    63→   */
    64→  safeFloor?: number;
    65→  /**
    66→   * For 'lower_is_better': maximum value that's still acceptable.
    67→   * Values below this but above idealMax get a passing score (softCeilingScore).
    68→   * Values above this are true weaknesses.
    69→   */
    70→  safeCeiling?: number;
    71→  /**
    72→   * Score given to values in the "acceptable but not ideal" zone.
    73→   * Defaults to 8.0 (Good). Range: 6.0-9.0
    74→   */
    75→  softZoneScore?: number;
    76→}
    77→
    78→export interface BezierCurveConfig {
    79→  mode: 'custom' | 'exponential';
    80→  points: CurvePoint[];
    81→}
    82→
    83→export interface CurvePoint {
    84→  x: number;
    85→  y: number;
    86→  leftHandleX?: number;
    87→  leftHandleY?: number;
    88→  rightHandleX?: number;
    89→  rightHandleY?: number;
    90→  fixed?: boolean;
    91→}
    92→
    93→export interface FaceIQScoreResult {
    94→  metricId: string;
    95→  name: string;
    96→  value: number;
    97→  score: number;  // 0-10 scale
    98→  standardizedScore: number;
    99→  qualityTier: QualityTier;
   100→  severity: SeverityLevel;
   101→  idealMin: number;
   102→  idealMax: number;
   103→  deviation: number;
   104→  deviationDirection: 'above' | 'below' | 'within';
   105→  unit: MeasurementUnit;
   106→  category: string;
   107→  percentile?: number;
   108→}
   109→
   110→export interface HarmonyAnalysis {
   111→  overallScore: number;  // 0-10 scale
   112→  standardizedScore: number;
   113→  qualityTier: QualityTier;
   114→  percentile: number;
   115→  frontScore: number;
   116→  sideScore: number;
   117→  categoryScores: Record<string, number>;
   118→  measurements: FaceIQScoreResult[];
   119→  flaws: FlawAssessment[];
   120→  strengths: StrengthAssessment[];
   121→}
   122→
   123→export interface FlawAssessment {
   124→  category: string;
   125→  metricId: string;
   126→  metricName: string;
   127→  severity: SeverityLevel;
   128→  deviation: string;
   129→  reasoning: string;
   130→  confidence: 'confirmed' | 'likely' | 'possible';
   131→}
   132→
   133→export interface StrengthAssessment {
   134→  category: string;
   135→  metricId: string;
   136→  metricName: string;
   137→  qualityTier: QualityTier;
   138→  value: number;
   139→  reasoning: string;
   140→}
   141→
   142→// ============================================
   143→// DEMOGRAPHIC TYPES & OVERRIDES
   144→// ============================================
   145→
   146→export type Ethnicity =
   147→  | 'east_asian'
   148→  | 'south_asian'
   149→  | 'black'
   150→  | 'hispanic'
   151→  | 'middle_eastern'
   152→  | 'native_american'
   153→  | 'pacific_islander'
   154→  | 'white'
   155→  | 'other';
   156→
   157→export type Gender = 'male' | 'female';
   158→
   159→export type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;
   160→
   161→export interface DemographicOverride {
   162→  idealMin: number;
   163→  idealMax: number;
   164→}
   165→
   166→/**
   167→ * Demographic-specific ideal ranges based on anthropometric research.
   168→ * FaceIQ uses universal scoring, but this gives more accurate assessments
   169→ * by adjusting ideals based on ethnicity and gender.
   170→ */
   171→export const DEMOGRAPHIC_OVERRIDES: Record<string, Partial<Record<DemographicKey, DemographicOverride>>> = {
   172→  // ==========================================
   173→  // NOSE METRICS - Highest ethnicity variation
   174→  // ==========================================
   175→  nasalIndex: {
   176→    // Nasal Index = (Nose Width / Nose Height) × 100
   177→    // Research: African/Pacific Islander tend platyrrhine (85-100), Asian mesorrhine (75-88), European leptorrhine (65-75)
   178→    east_asian_male: { idealMin: 78, idealMax: 88 },
   179→    east_asian_female: { idealMin: 76, idealMax: 86 },
   180→    south_asian_male: { idealMin: 72, idealMax: 82 },
   181→    south_asian_female: { idealMin: 70, idealMax: 80 },
   182→    black_male: { idealMin: 85, idealMax: 100 },
   183→    black_female: { idealMin: 83, idealMax: 98 },
   184→    hispanic_male: { idealMin: 75, idealMax: 87 },
   185→    hispanic_female: { idealMin: 73, idealMax: 85 },
   186→    middle_eastern_male: { idealMin: 68, idealMax: 78 },
   187→    middle_eastern_female: { idealMin: 66, idealMax: 76 },
   188→    white_male: { idealMin: 65, idealMax: 75 },
   189→    white_female: { idealMin: 63, idealMax: 73 },
   190→    native_american_male: { idealMin: 72, idealMax: 82 },
   191→    native_american_female: { idealMin: 70, idealMax: 80 },
   192→    pacific_islander_male: { idealMin: 82, idealMax: 95 },
   193→    pacific_islander_female: { idealMin: 80, idealMax: 93 },
   194→  },
   195→
   196→  nasolabialAngle: {
   197→    // Ideal nasolabial angle varies by ethnicity
   198→    // African: slightly more obtuse, European: slightly more acute
   199→    // Middle Eastern: Penalizes droopy tip (<90°) - common flaw is "Hooked Nose"
   200→    // Extracted from FaceIQ Male:MiddleEastern.htc
   201→    black_male: { idealMin: 95, idealMax: 110 },
   202→    black_female: { idealMin: 100, idealMax: 115 },
   203→    east_asian_male: { idealMin: 90, idealMax: 105 },
   204→    east_asian_female: { idealMin: 95, idealMax: 110 },
   205→    middle_eastern_male: { idealMin: 90, idealMax: 100 },  // Strict on droopy tip
   206→    middle_eastern_female: { idealMin: 95, idealMax: 105 },
   207→    // Gender-only fallbacks
   208→    male: { idealMin: 90, idealMax: 100 },
   209→    female: { idealMin: 100, idealMax: 110 },
   210→  },
   211→
   212→  nasalProjection: {
   213→    // Nose projection relative to face depth
   214→    // East Asian/African: typically less projection is ideal
   215→    // Middle Eastern: Accepts stronger projection (bigger nose) than White model
   216→    // Extracted from FaceIQ Male:MiddleEastern.htc
   217→    east_asian: { idealMin: 0.54, idealMax: 0.60 },
   218→    black: { idealMin: 0.52, idealMax: 0.58 },
   219→    south_asian: { idealMin: 0.56, idealMax: 0.62 },
   220→    middle_eastern: { idealMin: 0.62, idealMax: 0.70 },  // Higher tolerance for larger noses
   221→    white: { idealMin: 0.60, idealMax: 0.67 },
   222→    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },
   223→  },
   224→
   225→  intercanthalNasalRatio: {
   226→    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)
   227→    // White: Neoclassical standard - STRICT 1:1 ratio (nose width = inner eye spacing)
   228→    // Research: Wider nose base is standard in African phenotypes
   229→    // South Asian Female: Accepts slightly wider base (1.00-1.08) but demands higher tip definition
   230→    // Pacific Islander: Similar to Black model, accepts wide nasal base
   231→    // Black Female: Wider than White Female, narrower than Black Male - balance of width and refinement
   232→    // Hispanic Female: Intermediate tolerance - slightly wider base acceptable with bridge definition
   233→    // Extracted from FaceIQ Male:White.htc (Neoclassical), BlackAfrican.htc, Female:African.htc, Female:Hispanic.htc, Female:SouthAsian.htc and Male:Pacific Islander.htc logic
   234→    white_male: { idealMin: 0.98, idealMax: 1.05 },  // Neoclassical - strictest nasal width standard
   235→    white_female: { idealMin: 0.98, idealMax: 1.05 },  // Strict "Rule of Fifths" (1:1 with eye width)
   236→    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },
   237→    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },
   238→    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian
   239→    south_asian_female: { idealMin: 1.00, idealMax: 1.08 },  // Wider tolerance - accepts broader base
   240→    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard
   241→    black_female: { idealMin: 1.05, idealMax: 1.15 },  // Wider than White Female, narrower than Black Male
   242→    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // "Bridge" tolerance - between White and Black
   243→    hispanic_female: { idealMin: 1.00, idealMax: 1.10 },  // Intermediate - between White and Black Female standards
   244→    native_american_female: { idealMin: 1.00, idealMax: 1.10 },  // Simpler/Sharper nose
   245→    pacific_islander_male: { idealMin: 1.10, idealMax: 1.20 },  // Wide tolerance, similar to Black model
   246→    pacific_islander_female: { idealMin: 1.05, idealMax: 1.15 },  // Wider tolerance for nasal base
   247→  },
   248→
   249→  // ==========================================
   250→  // JAW METRICS - Clear gender dimorphism
   251→  // ==========================================
   252→  bigonialWidth: {
   253→    // Jaw width as % of bizygomatic width
   254→    // Males: wider, more angular; Females: narrower, softer
   255→    // Pacific Islander: Extremely wide jaw preferred - "Warrior Skull" robustness
   256→    // Extracted from FaceIQ Male:Pacific Islander.htc
   257→    male: { idealMin: 90, idealMax: 95 },
   258→    female: { idealMin: 85, idealMax: 90 },
   259→    pacific_islander_male: { idealMin: 92, idealMax: 98 },  // Jaw width rivals cheekbone width - extreme robustness
   260→    pacific_islander_female: { idealMin: 88, idealMax: 94 },
   261→  },
   262→
   263→  jawFrontalAngle: {
   264→    // More angular in males, softer in females
   265→    male: { idealMin: 88, idealMax: 95 },
   266→    female: { idealMin: 82, idealMax: 90 },
   267→  },
   268→
   269→  jawWidthRatio: {
   270→    // Males have stronger jaw width preference
   271→    male: { idealMin: 0.78, idealMax: 0.85 },
   272→    female: { idealMin: 0.72, idealMax: 0.80 },
   273→  },
   274→
   275→  gonialAngle: {
   276→    // White: Neoclassical standard - square, vertically robust jaw (115-125°)
   277→    // Males: more acute (sharper jaw); Females: more obtuse (softer)
   278→    // East Asian Female: Prefers softer, V-shaped jawline (120-126°) - "Doll Face" aesthetic
   279→    // Black Female: Soft/feminine jaw standard - similar to general female range
   280→    // Extracted from FaceIQ Male:White.htc, Female:East Asian.htc, and Female:African.htc
   281→    white_male: { idealMin: 115, idealMax: 125 },  // Neoclassical square jaw - less tolerant of soft/V-shaped jaws
   282→    white_female: { idealMin: 122.0, idealMax: 130.0 },  // Soft, tapered jawline (V-shape)
   283→    east_asian_female: { idealMin: 120, idealMax: 126 },  // Narrower tolerance - penalizes square jaws more
   284→    black_female: { idealMin: 120.0, idealMax: 130.0 },  // Soft/feminine jaw preference
   285→    native_american_female: { idealMin: 115.0, idealMax: 125.0 },  // Strong, defined jawline
   286→    pacific_islander_female: { idealMin: 115.0, idealMax: 128.0 },  // Strong but allows slightly softer definition
   287→    male: { idealMin: 115, idealMax: 125 },
   288→    female: { idealMin: 120, idealMax: 135 },
   289→  },
   290→
   291→  // ==========================================
   292→  // EYE METRICS - Ethnic variation
   293→  // ==========================================
   294→  lateralCanthalTilt: {
   295→    // White: Neoclassical standard - neutral to slightly positive tilt (4-8°)
   296→    // East Asian: naturally higher positive tilt
   297→    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly
   298→    // Hispanic Female: STRONGEST "Almond/Cat Eye" preference - rewards positive tilt heavily
   299→    // Middle Eastern: Strong preference for "Hunter Eyes" (Dark Triad look)
   300→    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline), Male:MiddleEastern.htc, and Female:Hispanic.htc
   301→    white_male: { idealMin: 4.0, idealMax: 8.0 },  // Neoclassical - neutral to slightly positive
   302→    white_female: { idealMin: 4.0, idealMax: 9.0 },  // Neutral to slightly positive
   303→    east_asian_male: { idealMin: 8, idealMax: 12 },
   304→    east_asian_female: { idealMin: 9, idealMax: 13 },
   305→    south_asian_male: { idealMin: 6, idealMax: 10 },
   306→    south_asian_female: { idealMin: 7, idealMax: 11 },
   307→    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt
   308→    hispanic_female: { idealMin: 6.0, idealMax: 12.0 },  // "Cat Eye/Almond" ideal - strongest preference among female demographics
   309→    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference
   310→    middle_eastern_female: { idealMin: 5.0, idealMax: 10.0 },  // Preference for "Foxy/Hunter" feminine eyes
   311→    native_american_female: { idealMin: 5.0, idealMax: 11.0 },  // Positive tilt (Hunter/Almond)
   312→    // Default for others is 4-8 (already in FACEIQ_METRICS)
   313→  },
   314→
   315→  eyeAspectRatio: {
   316→    // East Asian eyes often have different aspect ratio due to epicanthal fold
   317→    east_asian_male: { idealMin: 2.6, idealMax: 3.2 },
   318→    east_asian_female: { idealMin: 2.7, idealMax: 3.3 },
   319→    // Larger eyes in females considered more attractive
   320→    male: { idealMin: 2.9, idealMax: 3.4 },
   321→    female: { idealMin: 3.1, idealMax: 3.6 },
   322→  },
   323→
   324→  tearTroughDepth: {
   325→    // Under-eye hollowing and dark circles (infraorbital depression)
   326→    // South Asian: MUCH stricter penalty due to genetic hyperpigmentation
   327→    // Extracted from FaceIQ Male:SouthAsian.htc and Female:SouthAsian.htc - biggest difference vs White model
   328→    white_male: { idealMin: 0.0, idealMax: 1.5 },
   329→    white_female: { idealMin: 0.0, idealMax: 1.3 },
   330→    south_asian_male: { idealMin: 0.0, idealMax: 0.5 },  // VERY strict - 0.5+ triggers "Tired/Aged Eyes" flaw
   331→    south_asian_female: { idealMin: 0.0, idealMax: 0.5 },  // Even minor shadows trigger "Dark Circles" flaw
   332→    east_asian_male: { idealMin: 0.0, idealMax: 1.2 },
   333→    east_asian_female: { idealMin: 0.0, idealMax: 1.0 },
   334→  },
   335→
   336→  upperEyelidExposure: {
   337→    // Visible eyelid platform (space between eyelash and crease)
   338→    // South Asian ideal: prefers visible lid platform, penalizes hooded eyes more than White model
   339→    // Extracted from FaceIQ Male:SouthAsian.htc
   340→    white_male: { idealMin: 0.3, idealMax: 2.5 },
   341→    white_female: { idealMin: 0.5, idealMax: 3.0 },
   342→    south_asian_male: { idealMin: 0.5, idealMax: 2.0 },  // Prefers visible lid, penalizes hooding
   343→    south_asian_female: { idealMin: 0.7, idealMax: 2.2 },
   344→    east_asian_male: { idealMin: 0.0, idealMax: 1.5 },  // More tolerance for less exposure
   345→    east_asian_female: { idealMin: 0.2, idealMax: 1.8 },
   346→    middle_eastern_female: { idealMin: 0.5, idealMax: 1.5 },  // Low exposure (Almond shape)
   347→  },
   348→
   349→  eyeSeparationRatio: {
   350→    // East Asian Female: Wider tolerance for "Doll Eyes" (wide-set eyes) - neotenous preference
   351→    // Wide-set eyes (46.3-47.5%) are ideal in East Asian female beauty standards
   352→    // Extracted from FaceIQ Female:East Asian.htc
   353→    east_asian_female: { idealMin: 46.3, idealMax: 47.5 },  // Wide-set eyes are preferred for youthful look
   354→  },
   355→
   356→  // ==========================================
   357→  // FACE PROPORTIONS - Gender variation
   358→  // ==========================================
   359→  faceWidthToHeight: {
   360→    // White: Neoclassical standard - balanced, moderate width (1.98-2.02)
   361→    // Males: slightly wider face preferred; Females: slightly narrower
   362→    // Hispanic: Allows broader "Mesoprosopic" faces (Mestizo/Indigenous bone structure)
   363→    // Hispanic Female: "Mestiza" face shape tolerance - broader than White (~1.45) but feminine, celebrates facial harmony
   364→    // Pacific Islander: "Warrior Skull" - extremely broad face preferred (highest FWHR of any demographic)
   365→    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline), Male:Pacific Islander.htc, and Female:Hispanic.htc
   366→    white_male: { idealMin: 1.98, idealMax: 2.02 },  // Neoclassical - moderate width baseline
   367→    white_female: { idealMin: 1.45, idealMax: 1.53 },  // Preference for Oval/Narrow shapes
   368→    male: { idealMin: 1.98, idealMax: 2.02 },
   369→    female: { idealMin: 1.94, idealMax: 1.98 },
   370→    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes
   371→    hispanic_female: { idealMin: 1.50, idealMax: 1.62 },  // Broader than White (~1.45) but not masculine - heart/round-square shapes
   372→    native_american_female: { idealMin: 1.52, idealMax: 1.65 },  // Wide/Heart shape (High skeletal width)
   373→    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // "Warrior Skull" - extremely broad, square face
   374→    pacific_islander_female: { idealMin: 1.55, idealMax: 1.70 },  // The widest female ideal (Skeletal + Volume)
   375→  },
   376→
   377→  totalFacialWidthToHeight: {
   378→    male: { idealMin: 1.35, idealMax: 1.40 },
   379→    female: { idealMin: 1.32, idealMax: 1.37 },
   380→  },
   381→
   382→  midfaceRatio: {
   383→    // Females often have more compact midface
   384→    // White: Neoclassical standard - strict compact midface preference
   385→    // Middle Eastern: Similar to White model - compact is better
   386→    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:MiddleEastern.htc
   387→    white_male: { idealMin: 0.95, idealMax: 1.02 },  // Neoclassical - penalizes long midface heavily
   388→    white_female: { idealMin: 0.93, idealMax: 1.00 },
   389→    male: { idealMin: 0.98, idealMax: 1.02 },
   390→    female: { idealMin: 0.95, idealMax: 1.00 },
   391→    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred
   392→    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },
   393→  },
   394→
   395→  lowerThirdProportion: {
   396→    // East Asian Female: Prefers smaller, more compact lower face (Heart/Oval face shape ideal)
   397→    // Smaller lower third contributes to "Cute" or "Doll Face" aesthetic
   398→    // Extracted from FaceIQ Female:East Asian.htc
   399→    east_asian_female: { idealMin: 29.6, idealMax: 32.7 },  // Penalizes long/masculine chin
   400→  },
   401→
   402→  // ==========================================
   403→  // LIP METRICS - Ethnicity variation
   404→  // ==========================================
   405→  lipRatio: {
   406→    // African/Hispanic: fuller lips natural
   407→    // Black Female: Highest fullness requirement in the app - thin lips heavily penalized
   408→    // Extracted from FaceIQ Female:African.htc - combines neoteny with phenotypic lip fullness
   409→    black_male: { idealMin: 1.6, idealMax: 2.2 },
   410→    black_female: { idealMin: 1.3, idealMax: 1.6 },  // HIGHEST fullness standard in the app
   411→    hispanic_male: { idealMin: 1.4, idealMax: 2.0 },
   412→    hispanic_female: { idealMin: 1.1, idealMax: 1.35 },  // Voluptuous but balanced
   413→    // East Asian: less full lips
   414→    east_asian_male: { idealMin: 1.2, idealMax: 1.7 },
   415→    east_asian_female: { idealMin: 1.3, idealMax: 1.8 },
   416→    // Pacific Islander: Explicit preference for full lips
   417→    pacific_islander_female: { idealMin: 1.25, idealMax: 1.50 },
   418→    // Default
   419→    male: { idealMin: 1.3, idealMax: 1.8 },
   420→    female: { idealMin: 1.4, idealMax: 2.0 },
   421→  },
   422→
   423→  upperLipRatio: {
   424→    // Fuller upper lip in African phenotypes
   425→    black: { idealMin: 0.38, idealMax: 0.48 },
   426→    hispanic: { idealMin: 0.36, idealMax: 0.45 },
   427→    east_asian: { idealMin: 0.32, idealMax: 0.40 },
   428→    female: { idealMin: 0.34, idealMax: 0.42 },
   429→  },
   430→
   431→  // ==========================================
   432→  // PROFILE METRICS - Gender & ethnicity
   433→  // ==========================================
   434→  chinProjection: {
   435→    // Males: more projected chin ideal
   436→    // Black/African: Adjusted for bimaxillary prognathism (forward mouth projection)
   437→    // Black Female: Allows forward projection - less likely to trigger "Recessed Chin"
   438→    // Extracted from FaceIQ BlackAfrican.htc and Female:African.htc logic
   439→    male: { idealMin: 0, idealMax: 3 },
   440→    female: { idealMin: -2, idealMax: 2 },
   441→    black_male: { idealMin: 0, idealMax: 4 },  // Accommodates natural forward projection
   442→    black_female: { idealMin: 0.0, idealMax: 5.0 },  // Wide tolerance for forward projection
   443→  },
   444→
   445→  nasofrontalAngle: {
   446→    // Higher brow ridge in males
   447→    male: { idealMin: 128, idealMax: 138 },
   448→    female: { idealMin: 132, idealMax: 142 },
   449→  },
   450→
   451→  chinToPhiltrumRatio: {
   452→    // White: Neoclassical standard - strict balance between chin and philtrum
   453→    // Black/African: Fuller lips naturally shorten visible philtrum
   454→    // Extracted from FaceIQ Male:White.htc (Neoclassical) and BlackAfrican.htc
   455→    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)
   456→    white_male: { idealMin: 2.10, idealMax: 2.30 },  // Neoclassical - strict lower face balance
   457→    white_female: { idealMin: 2.0, idealMax: 2.2 },  // Classical Golden Ratio
   458→    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum
   459→    black_female: { idealMin: 2.10, idealMax: 2.65 },
   460→  },
   461→
   462→  // ==========================================
   463→  // SKIN QUALITY - Ethnicity variation
   464→  // ==========================================
   465→  skinUniformity: {
   466→    // South Asian: Stricter standards due to genetic hyperpigmentation tendency
   467→    // Hispanic: Similar to South Asian - penalizes hyperpigmentation more than White model
   468→    // Extracted from FaceIQ Male:Hispanic.htc - "Bridge Model"
   469→    white_male: { idealMin: 0.88, idealMax: 1.00 },
   470→    white_female: { idealMin: 0.90, idealMax: 1.00 },
   471→    south_asian_male: { idealMin: 0.90, idealMax: 1.00 },  // Stricter - hyperpigmentation common
   472→    south_asian_female: { idealMin: 0.92, idealMax: 1.00 },
   473→    east_asian_male: { idealMin: 0.92, idealMax: 1.00 },  // High skin quality standards
   474→    east_asian_female: { idealMin: 0.94, idealMax: 1.00 },
   475→    black_male: { idealMin: 0.85, idealMax: 1.00 },  // More tolerance for melanin variation
   476→    black_female: { idealMin: 0.87, idealMax: 1.00 },
   477→    hispanic_male: { idealMin: 0.85, idealMax: 1.00 },  // Bridge: more tolerance than South Asian, less than White
   478→    hispanic_female: { idealMin: 0.87, idealMax: 1.00 },
   479→  },
   480→
   481→  // ==========================================
   482→  // EYEBROW METRICS - Ethnicity variation
   483→  // ==========================================
   484→  eyebrowThickness: {
   485→    // Middle Eastern: Heavily favors thick, dense eyebrows ("Dark Triad" look with deep-set eyes)
   486→    // Extracted from FaceIQ Male:MiddleEastern.htc - STRICTEST eyebrow requirements
   487→    middle_eastern_male: { idealMin: 2.5, idealMax: 5.0 },  // Prefers significantly thicker/darker brows
   488→    middle_eastern_female: { idealMin: 1.5, idealMax: 3.0 },  // Thick, high-contrast brows are ideal
   489→    east_asian_male: { idealMin: 1.5, idealMax: 3.0 },  // Typically less thick
   490→    east_asian_female: { idealMin: 1.3, idealMax: 2.5 },
   491→    male: { idealMin: 2.0, idealMax: 4.0 },
   492→    female: { idealMin: 1.8, idealMax: 3.5 },
   493→  },
   494→
   495→  eyebrowDistance: {
   496→    // Middle Eastern: "Kill Switch" for unibrow (synophrys)
   497→    // Extracted from FaceIQ Male:MiddleEastern.htc
   498→    // While thick brows are favored, unibrow is a critical flaw if distance < 15mm
   499→    middle_eastern_male: { idealMin: 15, idealMax: 25 },  // Stricter minimum to avoid unibrow
   500→    middle_eastern_female: { idealMin: 18, idealMax: 28 },

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
