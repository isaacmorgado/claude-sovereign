{"type":"file-history-snapshot","messageId":"11448d89-7084-4fd4-b75e-52b0f554c3d3","snapshot":{"messageId":"11448d89-7084-4fd4-b75e-52b0f554c3d3","trackedFileBackups":{},"timestamp":"2025-12-21T17:13:19.190Z"},"isSnapshotUpdate":false}
{"parentUuid":null,"isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","type":"user","message":{"role":"user","content":"Caveat: The messages below were generated by the user while running local commands. DO NOT respond to these messages or otherwise consider them in your response unless the user explicitly asks you to."},"isMeta":true,"uuid":"934c8b0e-8cb9-4223-90f4-82b29aab0faa","timestamp":"2025-12-21T17:13:19.188Z"}
{"parentUuid":"934c8b0e-8cb9-4223-90f4-82b29aab0faa","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","type":"user","message":{"role":"user","content":"<command-name>/clear</command-name>\n            <command-message>clear</command-message>\n            <command-args></command-args>"},"uuid":"11448d89-7084-4fd4-b75e-52b0f554c3d3","timestamp":"2025-12-21T17:13:19.183Z"}
{"parentUuid":"11448d89-7084-4fd4-b75e-52b0f554c3d3","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","type":"user","message":{"role":"user","content":"<local-command-stdout></local-command-stdout>"},"uuid":"ed3f72a6-e13b-4b41-a428-0cca7b7796c6","timestamp":"2025-12-21T17:13:19.188Z"}
{"type":"file-history-snapshot","messageId":"c1b903cb-f03a-4855-a433-1321cc7f94e6","snapshot":{"messageId":"c1b903cb-f03a-4855-a433-1321cc7f94e6","trackedFileBackups":{},"timestamp":"2025-12-21T17:13:34.881Z"},"isSnapshotUpdate":false}
{"parentUuid":"ed3f72a6-e13b-4b41-a428-0cca7b7796c6","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","type":"user","message":{"role":"user","content":"You have successfully captured the Pacific Islander Male logic file (Male:Pacific Islander.htc).\n\nThis is the final major demographic. I have analyzed the logic, and it is the most unique regarding Facial Mass and Dimorphism. While the White model rewards \"Leanness,\" the Pacific Islander model explicitly rewards Robustness (Bone Mass + Muscle) and penalizes \"Delicate\" features that other models might call ideal.\n\nHere is the extracted logic map for your male_pacific_islander database.\n\n1. The \"Warrior Skull\" Rule (Extreme FWHR)\nThis model has the highest ideal range for Facial Width of any demographic.\n\nMetric: fwhr (Face Width to Height Ratio).\n\nWhite Ideal: ~1.90.\n\nPacific Islander Ideal: 2.10 â€“ 2.30.\n\nThe Shift: A face that is \"Too Wide\" or \"Square\" for the White/East Asian models is scored as \"Ideal/Masculine\" here.\n\nJaw Width: It specifically looks for a bigonial_width (Jaw Width) that rivals the bizygomatic_width (Cheek Width).\n\n2. The \"Nose Width\" & Strength\nMetric: alar_base_ratio and nose_projection.\n\nLogic: Similar to the Black/African model, it accepts a wider nasal base (~1.10â€“1.20 ratio).\n\nBridge: Unlike the Asian models, it prefers a High/Strong Bridge (Root), often penalizing a \"Low Radix.\"\n\n3. The \"Soft Tissue\" Tolerance\nMetric: cheek_fullness / lower_face_volume.\n\nLogic: Pacific Islander phenotypes naturally store more subcutaneous fat in the face without it being \"unhealthy.\"\n\nThe Shift: The \"South Asian\" model heavily penalizes undefined jawlines. The Pacific Islander model is more lenient on \"Soft Jawlines\" provided the underlying bone structure (Inter-gonial width) is wide. It interprets mass as strength rather than just \"fat.\"\n\nðŸš€ Action: The Final Python Block\nAdd this male_pacific_islander block to your metrics_db.py.\n\nPython\n\n# metrics_db.py\n\nMETRIC_STANDARDS = {\n    # ... all other demographics ...\n\n    \"male_pacific_islander\": {\n        # INHERIT default male values\n        \n        \"fwhr\": {\n            \"name\": \"Face Width to Height\",\n            \"ideal\": [2.10, 2.30],  # The \"Warrior Skull\" standard (Very broad)\n            \"mean\": 2.15,\n            \"flaws\": { \n                \"low\": \"Narrow/Long face\" # Heavily penalized in this model\n            }\n        },\n        \"alar_base_ratio\": {\n            \"name\": \"Nose Width Ratio\",\n            \"ideal\": [1.05, 1.20],  # Wide tolerance\n            \"mean\": 1.12,\n            \"flaws\": { \"high\": \"Wide nasal base\" }\n        },\n        \"bizygomatic_width\": {\n            \"name\": \"Cheekbone Width\",\n            \"ideal\": [140.0, 155.0], # MM (Estimated raw metric preference)\n            \"flaws\": { \"low\": \"Narrow cheekbones\" }\n        },\n        \"chin_width\": {\n            \"name\": \"Chin Width\",\n            \"ideal\": [40.0, 50.0],  # Prefers a very broad, square chin\n            \"flaws\": { \"low\": \"Pointed/Narrow chin\" }\n        }\n    }\n}"},"uuid":"c1b903cb-f03a-4855-a433-1321cc7f94e6","timestamp":"2025-12-21T17:13:34.684Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]}}
{"parentUuid":"c1b903cb-f03a-4855-a433-1321cc7f94e6","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01QWsZTSFh7FmmPhq72guAUH","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user has provided me with extracted logic for a Pacific Islander Male demographic model from what appears to be FaceIQ or a similar facial analysis system. They're asking me to add this to their metrics database.\n\nLooking at the context:\n1. This is a looksmaxx facial analysis app\n2. They have a metrics database system\n3. They're implementing demographic-specific scoring standards\n4. The CLAUDE.md mentions they have FaceIQ-compatible scoring\n\nThe user wants me to add the Pacific Islander male model to their metrics database. However, I need to:\n1. First check where the current metrics database is located\n2. See what the existing structure looks like\n3. Add the new Pacific Islander male standards properly\n\nLet me search for the metrics database file they mentioned.","signature":"EqkHCkYIChgCKkCj3djWmw4jK1cSrBuIIhcVqO4cuibwwE+uqvuZKwms0HY96TUOsOYdIzrEvwkfmc/eC/4qYla3C2WwllZkd72UEgwDGUyBSgiWNK6nwAkaDAl2eZZ7Lud3YqNI3CIwrF5JjSOmjr4N+aD96LVm2NdgKmDvPopFV4R6+pemlA9NJnjoHs99MptGIx1IeZCCKpAGOQnXDtnHKTkwKM4c5fUO4Br1FFZDvlxH5Q9wME6Pw5a48giryWaWG/ZaMqkv3QIJ0TAtJPztgrgL3RtD+0Sli/pQlE9tb2YiLqbpDSv1AWeN4KZFzwOcdTmFaIEu4ib5kf9X5+EGIJ85usCL6+YvWQPJWCV6jJ9NAa5RHixzQ8RKMOe5FP+yuXwfXppDkL9DylMAJZ3Lrl2gOGz/2mj82sPenq5v6uj8BX8ToTb/RuLxKx7UZTnmliiBDPJDZn6ba8yU8OWrQWWOCStcMBnJwh9+zbAb3KFoS/E+NNlVvibxYwkiOaP+06ouWQaHEdwbLbtIj5mQHK5VFMu39dKB8phYOOt3ZCuig7M6oxoiba4TZfqFcp+NkehFw7ffiGFFfbMLUAZi+kMD00u/s4mxqntWncN0SkIHvp5pU1bIHu51Sfe4ieqLxF11zzwbxdqdbSme49hYEbBIr1az/f2hC5Cl5W2zazWVt62YmruHYKHjSBdTX78XK8/88Bcqg29csGGKGbUmeAOJCwlXA5eiJ7t9CHP8K11uQD4b2tH8BuokIAaxF9fc2AHq7bHlmUCOCrdP3LlSXBygGQL3QGXV65Lmk8cbXE/u6i2K7B3pOtp0fmzvZroDAzp5gpNMVwGdC2JUHC3pijs0noU7XpJVuFw/4Y0l4HQQ//+6wfrthzuemz25pTA37mCxSHfVtaCf1fHmMluN3/K8SpoRf97sj2j0sXTppvyDLOSNmEKyDhTC90ESPqDUcKaANxyJM+mnLy8jZW+3WSgRrtDKn+kBaU13BK82BeXO6Jt/PJ0ROFrDsX1f3L+mIJCruhgzuclkAcSM6qDcHbG2XjK92t56sW/0eupgGGqPG32aatjbJ8yAiVyJqGh8UvdIs/JURN6nJHLFe/YhcC/s1s+mvItZCORTTOm8dKY7dZI3UfUPWaB1YkNbIqUVaLy8jFP9TmwsOZeOYIPFseVm8kl22W0iO1G0Ekns5CnBHx+vk1HYY1dGlzJ+y4U5fY3fgXl5epdnQQnVRTP2ah6wbZ4ofXpC1BgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":2147,"cache_read_input_tokens":19504,"cache_creation":{"ephemeral_5m_input_tokens":2147,"ephemeral_1h_input_tokens":0},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CWLCyUmtts9o4bxaLFnpV","type":"assistant","uuid":"eafe1629-8c46-4375-837b-88d2c180f7ff","timestamp":"2025-12-21T17:13:43.147Z"}
{"parentUuid":"eafe1629-8c46-4375-837b-88d2c180f7ff","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01QWsZTSFh7FmmPhq72guAUH","type":"message","role":"assistant","content":[{"type":"text","text":"I'll help you add the Pacific Islander Male demographic logic to your metrics database. Let me first locate the current metrics database file and review its structure."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":2147,"cache_read_input_tokens":19504,"cache_creation":{"ephemeral_5m_input_tokens":2147,"ephemeral_1h_input_tokens":0},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CWLCyUmtts9o4bxaLFnpV","type":"assistant","uuid":"b3d057cf-07c4-4f67-8471-fdebbcefe5f1","timestamp":"2025-12-21T17:13:43.539Z"}
{"parentUuid":"b3d057cf-07c4-4f67-8471-fdebbcefe5f1","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01QWsZTSFh7FmmPhq72guAUH","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01TLdX294rK7Mdpab4n8BZsS","name":"Glob","input":{"pattern":"**/metrics_db.py"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":2147,"cache_read_input_tokens":19504,"cache_creation":{"ephemeral_5m_input_tokens":2147,"ephemeral_1h_input_tokens":0},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CWLCyUmtts9o4bxaLFnpV","type":"assistant","uuid":"d6205246-990a-4269-8de3-7dc83c42f641","timestamp":"2025-12-21T17:13:44.248Z"}
{"parentUuid":"d6205246-990a-4269-8de3-7dc83c42f641","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01QWsZTSFh7FmmPhq72guAUH","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0115E3EWhBFoZpwqu89672E9","name":"Glob","input":{"pattern":"**/metrics*.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":2147,"cache_read_input_tokens":19504,"cache_creation":{"ephemeral_5m_input_tokens":2147,"ephemeral_1h_input_tokens":0},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CWLCyUmtts9o4bxaLFnpV","type":"assistant","uuid":"bfedb14f-b34f-437b-9b62-85d2422b841f","timestamp":"2025-12-21T17:13:44.285Z"}
{"parentUuid":"bfedb14f-b34f-437b-9b62-85d2422b841f","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01QWsZTSFh7FmmPhq72guAUH","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XbbUV8d7LApRaowRMPwCRK","name":"Grep","input":{"pattern":"METRIC_STANDARDS","output_mode":"files_with_matches"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":2147,"cache_read_input_tokens":19504,"cache_creation":{"ephemeral_5m_input_tokens":2147,"ephemeral_1h_input_tokens":0},"output_tokens":366,"service_tier":"standard"}},"requestId":"req_011CWLCyUmtts9o4bxaLFnpV","type":"assistant","uuid":"dec8f9cf-629d-4feb-bbc1-2441603d9dfe","timestamp":"2025-12-21T17:13:45.068Z"}
{"parentUuid":"dec8f9cf-629d-4feb-bbc1-2441603d9dfe","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"ENOENT: no such file or directory, posix_spawn '/opt/homebrew/Caskroom/claude-code/2.0.70/claude'","is_error":true,"tool_use_id":"toolu_01XbbUV8d7LApRaowRMPwCRK"}]},"uuid":"52bf965a-873f-4ec6-b888-9f48b69a6828","timestamp":"2025-12-21T17:13:45.138Z","toolUseResult":"Error: ENOENT: no such file or directory, posix_spawn '/opt/homebrew/Caskroom/claude-code/2.0.70/claude'"}
{"parentUuid":"52bf965a-873f-4ec6-b888-9f48b69a6828","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"ENOENT: no such file or directory, posix_spawn '/opt/homebrew/Caskroom/claude-code/2.0.70/claude'","is_error":true,"tool_use_id":"toolu_01TLdX294rK7Mdpab4n8BZsS"}]},"uuid":"c89f830c-df34-492d-a2a5-b4b7849656bd","timestamp":"2025-12-21T17:13:45.138Z","toolUseResult":"Error: ENOENT: no such file or directory, posix_spawn '/opt/homebrew/Caskroom/claude-code/2.0.70/claude'"}
{"parentUuid":"c89f830c-df34-492d-a2a5-b4b7849656bd","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"ENOENT: no such file or directory, posix_spawn '/opt/homebrew/Caskroom/claude-code/2.0.70/claude'","is_error":true,"tool_use_id":"toolu_0115E3EWhBFoZpwqu89672E9"}]},"uuid":"036c1658-d701-4d1d-ab7e-4b05c2ceacd2","timestamp":"2025-12-21T17:13:45.138Z","toolUseResult":"Error: ENOENT: no such file or directory, posix_spawn '/opt/homebrew/Caskroom/claude-code/2.0.70/claude'"}
{"parentUuid":"036c1658-d701-4d1d-ab7e-4b05c2ceacd2","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01BdHo4wgJtS4kpD2WQQdA9H","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"I'm getting errors with the tools. Let me try a different approach - let me search for metric-related files using different patterns.","signature":"Eq4CCkYIChgCKkB1Xva5qh4I9gyksaIM3evJDifYHZqaLBILH+RKVbdFeqcFJJAIbLOHg5c4V6LECfNE52qFMBxQNjvtOmO13i7wEgy5RoY35QwESAJ9xHsaDGOXfN4ltByUPFvFCiIwOkEHZ73eEUGzpxqVunKUvq+CxSATkYlCihqmJO+yEpG2Iuom2TXmKmI2ZiXOYM3sKpUBFdTFgAGcgdcN7sBL+Gwcce3//rO+L1keUThStsCyk3NL116guikAOvY2PR7J/g7yZl1U6b1Vf/zORZmgB5a2JPxf7AVVnhH71RUvip6WGBsvOAv94emHpMuz4/2avNksgns7vvlYCa45uo3pZHDoKgIfjRab1J8+voIddgQCBMAetURQfT97jT12gdG5zTjIOSuN2icYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":76,"cache_creation_input_tokens":502,"cache_read_input_tokens":21651,"cache_creation":{"ephemeral_5m_input_tokens":502,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWLCzDnH2PHLAybu81uAy","type":"assistant","uuid":"3694bdc3-944d-447a-9db4-08d0f7c2e561","timestamp":"2025-12-21T17:13:49.036Z"}
{"parentUuid":"3694bdc3-944d-447a-9db4-08d0f7c2e561","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01BdHo4wgJtS4kpD2WQQdA9H","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UMQ3sP8Pi3M35ACVnj9c1Y","name":"Bash","input":{"command":"find . -type f -name \"*metric*\" | head -20","description":"Find metric-related files"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":76,"cache_creation_input_tokens":502,"cache_read_input_tokens":21651,"cache_creation":{"ephemeral_5m_input_tokens":502,"ephemeral_1h_input_tokens":0},"output_tokens":122,"service_tier":"standard"}},"requestId":"req_011CWLCzDnH2PHLAybu81uAy","type":"assistant","uuid":"92a9a5d5-d874-437a-81f1-432aa7850836","timestamp":"2025-12-21T17:13:49.675Z"}
{"parentUuid":"92a9a5d5-d874-437a-81f1-432aa7850836","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UMQ3sP8Pi3M35ACVnj9c1Y","type":"tool_result","content":"./node_modules/@types/three/examples/jsm/geometries/ParametricFunctions.d.ts\n./node_modules/@types/three/examples/jsm/geometries/ParametricGeometry.d.ts\n./node_modules/@types/three/src/nodes/functions/VolumetricLightingModel.d.ts\n./node_modules/next/dist/server/capsize-font-metrics.json\n./node_modules/next/dist/compiled/@next/font/dist/google/get-fallback-font-override-metrics.js\n./node_modules/next/dist/compiled/@next/font/dist/google/get-fallback-font-override-metrics.d.ts\n./node_modules/next/dist/compiled/@next/font/dist/local/get-fallback-metrics-from-font-file.js\n./node_modules/next/dist/compiled/@next/font/dist/local/get-fallback-metrics-from-font-file.d.ts\n./node_modules/html2canvas/dist/types/render/font-metrics.d.ts\n./node_modules/html2canvas/dist/lib/render/font-metrics.js.map\n./node_modules/html2canvas/dist/lib/render/font-metrics.js\n./node_modules/core-js/stable/set/symmetric-difference.js\n./node_modules/core-js/full/set/symmetric-difference.js\n./node_modules/core-js/actual/set/symmetric-difference.js\n./node_modules/core-js/features/set/symmetric-difference.js\n./node_modules/core-js/internals/set-symmetric-difference.js\n./node_modules/core-js/es/set/symmetric-difference.js\n./node_modules/core-js/modules/es.set.symmetric-difference.v2.js\n./node_modules/core-js/modules/esnext.set.symmetric-difference.v2.js\n./node_modules/core-js/modules/esnext.set.symmetric-difference.js","is_error":false}]},"uuid":"eeb3deca-0776-417b-9114-aa2d35aaf445","timestamp":"2025-12-21T17:13:50.331Z","toolUseResult":{"stdout":"./node_modules/@types/three/examples/jsm/geometries/ParametricFunctions.d.ts\n./node_modules/@types/three/examples/jsm/geometries/ParametricGeometry.d.ts\n./node_modules/@types/three/src/nodes/functions/VolumetricLightingModel.d.ts\n./node_modules/next/dist/server/capsize-font-metrics.json\n./node_modules/next/dist/compiled/@next/font/dist/google/get-fallback-font-override-metrics.js\n./node_modules/next/dist/compiled/@next/font/dist/google/get-fallback-font-override-metrics.d.ts\n./node_modules/next/dist/compiled/@next/font/dist/local/get-fallback-metrics-from-font-file.js\n./node_modules/next/dist/compiled/@next/font/dist/local/get-fallback-metrics-from-font-file.d.ts\n./node_modules/html2canvas/dist/types/render/font-metrics.d.ts\n./node_modules/html2canvas/dist/lib/render/font-metrics.js.map\n./node_modules/html2canvas/dist/lib/render/font-metrics.js\n./node_modules/core-js/stable/set/symmetric-difference.js\n./node_modules/core-js/full/set/symmetric-difference.js\n./node_modules/core-js/actual/set/symmetric-difference.js\n./node_modules/core-js/features/set/symmetric-difference.js\n./node_modules/core-js/internals/set-symmetric-difference.js\n./node_modules/core-js/es/set/symmetric-difference.js\n./node_modules/core-js/modules/es.set.symmetric-difference.v2.js\n./node_modules/core-js/modules/esnext.set.symmetric-difference.v2.js\n./node_modules/core-js/modules/esnext.set.symmetric-difference.js","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"eeb3deca-0776-417b-9114-aa2d35aaf445","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_015YnMaEo3eGr5jGAJtwhELG","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"That didn't show the source files. Let me search in the src directory specifically.","signature":"EvsBCkYIChgCKkBlK0dnXXwDN6qG1lCNJ30fG3DvCCyms33FMMcfn6+ajJBOLX4CAAncTOzOHwZQWxaOMQ6JHLgyoFc8Rk6rYoE4Egz3znXX2+7IQlA/zEQaDEv/K1UDHgbUqhvgyyIwXzydNzBe9CGLbf2hZfh5OouCM2nQ+GzjSE8hYUcIiZgC8r0VABKbEQz4je5NU2haKmPqtTvERUFcIKH93hfC/tEW5DpWW5bwIi3ttIU0DssPvdT3XcrV0wW+Hv0l+nIxBbQQ0UEAcuiRT5TAS9miejUDQ7sHgHqlOQuajWjJU2OX2A71LchPH9C8rQTgu4B1LUEFcH8YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":696,"cache_read_input_tokens":22153,"cache_creation":{"ephemeral_5m_input_tokens":696,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLCzbxmwGw2WosGaCbpE","type":"assistant","uuid":"aebee51d-16c0-4e18-b57a-b850b2b1499a","timestamp":"2025-12-21T17:13:54.072Z"}
{"parentUuid":"aebee51d-16c0-4e18-b57a-b850b2b1499a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_015YnMaEo3eGr5jGAJtwhELG","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VHy2XphCSxyqgNNnKkJZ8e","name":"Bash","input":{"command":"find src -type f \\( -name \"*metric*\" -o -name \"*scoring*\" -o -name \"*standard*\" \\) 2>/dev/null","description":"Find metric/scoring files in src"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":696,"cache_read_input_tokens":22153,"cache_creation":{"ephemeral_5m_input_tokens":696,"ephemeral_1h_input_tokens":0},"output_tokens":136,"service_tier":"standard"}},"requestId":"req_011CWLCzbxmwGw2WosGaCbpE","type":"assistant","uuid":"323c9aff-2d4f-4565-b89b-c76ac27a39b6","timestamp":"2025-12-21T17:13:55.104Z"}
{"parentUuid":"323c9aff-2d4f-4565-b89b-c76ac27a39b6","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VHy2XphCSxyqgNNnKkJZ8e","type":"tool_result","content":"src/lib/faceiq-scoring.ts\nsrc/lib/looksmax-scoring.ts\nsrc/lib/scoring.ts","is_error":false}]},"uuid":"8aae3f31-1ab1-4afe-9557-fd3ccf5032eb","timestamp":"2025-12-21T17:13:55.202Z","toolUseResult":{"stdout":"src/lib/faceiq-scoring.ts\nsrc/lib/looksmax-scoring.ts\nsrc/lib/scoring.ts","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"8aae3f31-1ab1-4afe-9557-fd3ccf5032eb","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01PPgiHYfitbco23CqrnAM7j","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Great! I found the scoring-related files. Let me check these files to see where the metric standards are defined. Based on the CLAUDE.md, the main scoring file seems to be faceiq-scoring.ts. Let me read that first.","signature":"Ev8CCkYIChgCKkAN8MG+pLuBjG+BA12NhyVQgX0oZWeGVcX64hkYG9hMfmzRyc03+t0Hy3xvae2zgJmm6A6JEaDzzinTX3e7vOJsEgws/u46TZxIPanFrmgaDMfu0UnGYX65nOFaJyIwl52/6s1cs1YmIAUsxrKL7NxhJBCCtyCRm6Q9Zna7KbSdoDPHcLg/ZFfrmSRyV+12KuYB+TjlCwlPyyQSJxmOG+99qvAq4LnEBHYF0a18g79JyLrqpnjQBcFTSbV0TDwoH0UuIgO3zOEQJfxkwUnTP3CHyjMmh1kuXoYpjIvOe60G5vwUHVvaZN00i6mKw7nMxqFmxeLcWQRSYzcZ3qsQrdUx2u2fPLKbar7DDIfmsaAkNs8hmJNep8ag2gCTli5ME0GKRfoQ+MNCV/G2X2/rEJzZ9UAp4337lusJYbYSxOctxUOMNSludTpymI8T0hCTZ7MBx4tMx7F+ePRFN4lwbBi4m2wdyn22ffCxA6cxXFMgOQJT408ixc8YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":186,"cache_read_input_tokens":22849,"cache_creation":{"ephemeral_5m_input_tokens":186,"ephemeral_1h_input_tokens":0},"output_tokens":6,"service_tier":"standard"}},"requestId":"req_011CWLCzxpeBamJbCdu4782P","type":"assistant","uuid":"14ea9e2e-8751-47a0-843d-97b39694bbe7","timestamp":"2025-12-21T17:13:58.922Z"}
{"parentUuid":"14ea9e2e-8751-47a0-843d-97b39694bbe7","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01PPgiHYfitbco23CqrnAM7j","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011r3937ityp2wTGBgPBXKFC","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":186,"cache_read_input_tokens":22849,"cache_creation":{"ephemeral_5m_input_tokens":186,"ephemeral_1h_input_tokens":0},"output_tokens":144,"service_tier":"standard"}},"requestId":"req_011CWLCzxpeBamJbCdu4782P","type":"assistant","uuid":"1fe85e15-971f-4afa-9f66-94e8da9f0520","timestamp":"2025-12-21T17:14:00.223Z"}
{"parentUuid":"1fe85e15-971f-4afa-9f66-94e8da9f0520","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"type":"tool_result","content":"File content (41917 tokens) exceeds maximum allowed tokens (25000). Please use offset and limit parameters to read specific portions of the file, or use the GrepTool to search for specific content.","is_error":true,"tool_use_id":"toolu_011r3937ityp2wTGBgPBXKFC"}]},"uuid":"d05eb962-5083-4b37-bbf6-640bc38c7aae","timestamp":"2025-12-21T17:14:00.425Z","toolUseResult":"Error: File content (41917 tokens) exceeds maximum allowed tokens (25000). Please use offset and limit parameters to read specific portions of the file, or use the GrepTool to search for specific content."}
{"parentUuid":"d05eb962-5083-4b37-bbf6-640bc38c7aae","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_019i7tS1DZzAodF7Y2DkdBad","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The file is very large. Let me search for where metric standards or demographic data is defined.","signature":"EogCCkYIChgCKkA9Cy2PLwRMtXXlSEt5mm0mCrC5AVVgblj56xkNa2UQLUYMn1+7Q2QrnqUHje4rraoycGuWxwIy/6OKFkpVReHaEgxky81kT8G+zSUT7dYaDOiDv2eNYUSkZ/vY0iIw2kRdW3kGpVxvy1yaHNnfXmGy3MPgDLoRPRmFlCV7kX/uWiG5nhuI5lS40bjlOCKLKnAoCSOsgh/lKPih5PkbFkq5eQTrXHxI/x1kEgskIaJTzfaTw1LzOkxpWHzAXqVHD+UpGln+37wNfq9jVrb4hrpq6FoH5pN6Fr1f5QWNPuhii0er9sEbIXaCKez6Ok9aXKiP1Ffez3aa60l7BiKpJcUBGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":14,"cache_creation_input_tokens":317,"cache_read_input_tokens":23035,"cache_creation":{"ephemeral_5m_input_tokens":317,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWLD1MA4XjC2MnZTKmJNP","type":"assistant","uuid":"5abd7bf7-ca04-4a44-9770-bc924636f6f8","timestamp":"2025-12-21T17:14:03.171Z"}
{"parentUuid":"5abd7bf7-ca04-4a44-9770-bc924636f6f8","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_019i7tS1DZzAodF7Y2DkdBad","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01DdrK1AyCEyHVSsdTBPWzZw","name":"Bash","input":{"command":"grep -n \"pacific_islander\\|METRIC_STANDARDS\\|male_pacific\" src/lib/faceiq-scoring.ts | head -20","description":"Search for Pacific Islander references"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":14,"cache_creation_input_tokens":317,"cache_read_input_tokens":23035,"cache_creation":{"ephemeral_5m_input_tokens":317,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWLD1MA4XjC2MnZTKmJNP","type":"assistant","uuid":"d0012cc0-b459-47d5-898c-e4e49e3802d6","timestamp":"2025-12-21T17:14:04.562Z"}
{"parentUuid":"d0012cc0-b459-47d5-898c-e4e49e3802d6","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01DdrK1AyCEyHVSsdTBPWzZw","type":"tool_result","content":"152:  | 'pacific_islander'\n191:    pacific_islander_male: { idealMin: 82, idealMax: 95 },\n192:    pacific_islander_female: { idealMin: 80, idealMax: 93 },\n221:    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },","is_error":false}]},"uuid":"8b8f5db6-0253-47d6-a9c3-d69c97bbbd52","timestamp":"2025-12-21T17:14:04.688Z","toolUseResult":{"stdout":"152:  | 'pacific_islander'\n191:    pacific_islander_male: { idealMin: 82, idealMax: 95 },\n192:    pacific_islander_female: { idealMin: 80, idealMax: 93 },\n221:    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"8b8f5db6-0253-47d6-a9c3-d69c97bbbd52","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Es7KktA6EdW1WxF5eqwUKk","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good! I can see that Pacific Islander is already referenced in the file. Let me check the structure by reading a specific section around these lines to understand the format.","signature":"EtcCCkYIChgCKkB90qcrsMNlkUoedpb3CM7bZdWIdBN6cPgFHwS2uaKXuPaTnTRdUbnhx7D4zkNW2qK0mV5C0wwppNHi/M0YtFzfEgyiG5Ce1muYnU4q978aDPLaQkarDCTwYJl+siIwUdSQ6pp5OV6EtRVI+iJVGE7xvIR51tJ/6ZaoCfksN1oqaoarxksjVxe6VYltPM/oKr4BWNwoSIk1bR0XBjVcDTfp/qzPg/6+6P2OV7qII2A2uPtp7R6YZhHOQ6LmqY3uhXRgqH09tozw0MYX7UCucB5QoDbqrC/Njye7zynlEuFlNSvBYMy0AIlQTBDGfk1nwsffUA6HH8XP1mLClISMuNhsMjTuD51gko5kMBZQSSP2hT9UH1eraT/ZA4gGsA91YtSSDIyOYUnBVm/80bvLlqRaIh0FkKiUfti4n0SDjsgNMm/TQgTwOUGSt/xYMGavDBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":243,"cache_read_input_tokens":23352,"cache_creation":{"ephemeral_5m_input_tokens":243,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD1fPg9XSPBBKiBPKAP","type":"assistant","uuid":"3cbd58e3-ca38-4a7d-af8f-08db199c831d","timestamp":"2025-12-21T17:14:11.224Z"}
{"parentUuid":"3cbd58e3-ca38-4a7d-af8f-08db199c831d","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Es7KktA6EdW1WxF5eqwUKk","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017P1TSTdVWqH1rPEAoVjg1E","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","offset":150,"limit":100}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":243,"cache_read_input_tokens":23352,"cache_creation":{"ephemeral_5m_input_tokens":243,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD1fPg9XSPBBKiBPKAP","type":"assistant","uuid":"b39f0f4b-31cb-4f0a-b4d8-d5dd76ae5868","timestamp":"2025-12-21T17:14:11.945Z"}
{"parentUuid":"b39f0f4b-31cb-4f0a-b4d8-d5dd76ae5868","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017P1TSTdVWqH1rPEAoVjg1E","type":"tool_result","content":"   150â†’  | 'middle_eastern'\n   151â†’  | 'native_american'\n   152â†’  | 'pacific_islander'\n   153â†’  | 'white'\n   154â†’  | 'other';\n   155â†’\n   156â†’export type Gender = 'male' | 'female';\n   157â†’\n   158â†’export type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n   159â†’\n   160â†’export interface DemographicOverride {\n   161â†’  idealMin: number;\n   162â†’  idealMax: number;\n   163â†’}\n   164â†’\n   165â†’/**\n   166â†’ * Demographic-specific ideal ranges based on anthropometric research.\n   167â†’ * FaceIQ uses universal scoring, but this gives more accurate assessments\n   168â†’ * by adjusting ideals based on ethnicity and gender.\n   169â†’ */\n   170â†’export const DEMOGRAPHIC_OVERRIDES: Record<string, Partial<Record<DemographicKey, DemographicOverride>>> = {\n   171â†’  // ==========================================\n   172â†’  // NOSE METRICS - Highest ethnicity variation\n   173â†’  // ==========================================\n   174â†’  nasalIndex: {\n   175â†’    // Nasal Index = (Nose Width / Nose Height) Ã— 100\n   176â†’    // Research: African/Pacific Islander tend platyrrhine (85-100), Asian mesorrhine (75-88), European leptorrhine (65-75)\n   177â†’    east_asian_male: { idealMin: 78, idealMax: 88 },\n   178â†’    east_asian_female: { idealMin: 76, idealMax: 86 },\n   179â†’    south_asian_male: { idealMin: 72, idealMax: 82 },\n   180â†’    south_asian_female: { idealMin: 70, idealMax: 80 },\n   181â†’    black_male: { idealMin: 85, idealMax: 100 },\n   182â†’    black_female: { idealMin: 83, idealMax: 98 },\n   183â†’    hispanic_male: { idealMin: 75, idealMax: 87 },\n   184â†’    hispanic_female: { idealMin: 73, idealMax: 85 },\n   185â†’    middle_eastern_male: { idealMin: 68, idealMax: 78 },\n   186â†’    middle_eastern_female: { idealMin: 66, idealMax: 76 },\n   187â†’    white_male: { idealMin: 65, idealMax: 75 },\n   188â†’    white_female: { idealMin: 63, idealMax: 73 },\n   189â†’    native_american_male: { idealMin: 72, idealMax: 82 },\n   190â†’    native_american_female: { idealMin: 70, idealMax: 80 },\n   191â†’    pacific_islander_male: { idealMin: 82, idealMax: 95 },\n   192â†’    pacific_islander_female: { idealMin: 80, idealMax: 93 },\n   193â†’  },\n   194â†’\n   195â†’  nasolabialAngle: {\n   196â†’    // Ideal nasolabial angle varies by ethnicity\n   197â†’    // African: slightly more obtuse, European: slightly more acute\n   198â†’    // Middle Eastern: Penalizes droopy tip (<90Â°) - common flaw is \"Hooked Nose\"\n   199â†’    // Extracted from FaceIQ Male:MiddleEastern.htc\n   200â†’    black_male: { idealMin: 95, idealMax: 110 },\n   201â†’    black_female: { idealMin: 100, idealMax: 115 },\n   202â†’    east_asian_male: { idealMin: 90, idealMax: 105 },\n   203â†’    east_asian_female: { idealMin: 95, idealMax: 110 },\n   204â†’    middle_eastern_male: { idealMin: 90, idealMax: 100 },  // Strict on droopy tip\n   205â†’    middle_eastern_female: { idealMin: 95, idealMax: 105 },\n   206â†’    // Gender-only fallbacks\n   207â†’    male: { idealMin: 90, idealMax: 100 },\n   208â†’    female: { idealMin: 100, idealMax: 110 },\n   209â†’  },\n   210â†’\n   211â†’  nasalProjection: {\n   212â†’    // Nose projection relative to face depth\n   213â†’    // East Asian/African: typically less projection is ideal\n   214â†’    // Middle Eastern: Accepts stronger projection (bigger nose) than White model\n   215â†’    // Extracted from FaceIQ Male:MiddleEastern.htc\n   216â†’    east_asian: { idealMin: 0.54, idealMax: 0.60 },\n   217â†’    black: { idealMin: 0.52, idealMax: 0.58 },\n   218â†’    south_asian: { idealMin: 0.56, idealMax: 0.62 },\n   219â†’    middle_eastern: { idealMin: 0.62, idealMax: 0.70 },  // Higher tolerance for larger noses\n   220â†’    white: { idealMin: 0.60, idealMax: 0.67 },\n   221â†’    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },\n   222â†’  },\n   223â†’\n   224â†’  intercanthalNasalRatio: {\n   225â†’    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n   226â†’    // Research: Wider nose base is standard in African phenotypes\n   227â†’    // Extracted from FaceIQ BlackAfrican.htc logic\n   228â†’    white_male: { idealMin: 1.00, idealMax: 1.04 },\n   229â†’    white_female: { idealMin: 0.98, idealMax: 1.02 },\n   230â†’    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n   231â†’    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n   232â†’    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n   233â†’    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n   234â†’    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n   235â†’    black_female: { idealMin: 1.13, idealMax: 1.23 },\n   236â†’    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n   237â†’    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n   238â†’  },\n   239â†’\n   240â†’  // ==========================================\n   241â†’  // JAW METRICS - Clear gender dimorphism\n   242â†’  // ==========================================\n   243â†’  bigonialWidth: {\n   244â†’    // Jaw width as % of bizygomatic width\n   245â†’    // Males: wider, more angular; Females: narrower, softer\n   246â†’    male: { idealMin: 90, idealMax: 95 },\n   247â†’    female: { idealMin: 85, idealMax: 90 },\n   248â†’  },\n   249â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"364c3ac4-bab6-4ed8-9ce9-ef726b582d76","timestamp":"2025-12-21T17:14:12.007Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","content":"  | 'middle_eastern'\n  | 'native_american'\n  | 'pacific_islander'\n  | 'white'\n  | 'other';\n\nexport type Gender = 'male' | 'female';\n\nexport type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n\nexport interface DemographicOverride {\n  idealMin: number;\n  idealMax: number;\n}\n\n/**\n * Demographic-specific ideal ranges based on anthropometric research.\n * FaceIQ uses universal scoring, but this gives more accurate assessments\n * by adjusting ideals based on ethnicity and gender.\n */\nexport const DEMOGRAPHIC_OVERRIDES: Record<string, Partial<Record<DemographicKey, DemographicOverride>>> = {\n  // ==========================================\n  // NOSE METRICS - Highest ethnicity variation\n  // ==========================================\n  nasalIndex: {\n    // Nasal Index = (Nose Width / Nose Height) Ã— 100\n    // Research: African/Pacific Islander tend platyrrhine (85-100), Asian mesorrhine (75-88), European leptorrhine (65-75)\n    east_asian_male: { idealMin: 78, idealMax: 88 },\n    east_asian_female: { idealMin: 76, idealMax: 86 },\n    south_asian_male: { idealMin: 72, idealMax: 82 },\n    south_asian_female: { idealMin: 70, idealMax: 80 },\n    black_male: { idealMin: 85, idealMax: 100 },\n    black_female: { idealMin: 83, idealMax: 98 },\n    hispanic_male: { idealMin: 75, idealMax: 87 },\n    hispanic_female: { idealMin: 73, idealMax: 85 },\n    middle_eastern_male: { idealMin: 68, idealMax: 78 },\n    middle_eastern_female: { idealMin: 66, idealMax: 76 },\n    white_male: { idealMin: 65, idealMax: 75 },\n    white_female: { idealMin: 63, idealMax: 73 },\n    native_american_male: { idealMin: 72, idealMax: 82 },\n    native_american_female: { idealMin: 70, idealMax: 80 },\n    pacific_islander_male: { idealMin: 82, idealMax: 95 },\n    pacific_islander_female: { idealMin: 80, idealMax: 93 },\n  },\n\n  nasolabialAngle: {\n    // Ideal nasolabial angle varies by ethnicity\n    // African: slightly more obtuse, European: slightly more acute\n    // Middle Eastern: Penalizes droopy tip (<90Â°) - common flaw is \"Hooked Nose\"\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    black_male: { idealMin: 95, idealMax: 110 },\n    black_female: { idealMin: 100, idealMax: 115 },\n    east_asian_male: { idealMin: 90, idealMax: 105 },\n    east_asian_female: { idealMin: 95, idealMax: 110 },\n    middle_eastern_male: { idealMin: 90, idealMax: 100 },  // Strict on droopy tip\n    middle_eastern_female: { idealMin: 95, idealMax: 105 },\n    // Gender-only fallbacks\n    male: { idealMin: 90, idealMax: 100 },\n    female: { idealMin: 100, idealMax: 110 },\n  },\n\n  nasalProjection: {\n    // Nose projection relative to face depth\n    // East Asian/African: typically less projection is ideal\n    // Middle Eastern: Accepts stronger projection (bigger nose) than White model\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian: { idealMin: 0.54, idealMax: 0.60 },\n    black: { idealMin: 0.52, idealMax: 0.58 },\n    south_asian: { idealMin: 0.56, idealMax: 0.62 },\n    middle_eastern: { idealMin: 0.62, idealMax: 0.70 },  // Higher tolerance for larger noses\n    white: { idealMin: 0.60, idealMax: 0.67 },\n    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },\n  },\n\n  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Extracted from FaceIQ BlackAfrican.htc logic\n    white_male: { idealMin: 1.00, idealMax: 1.04 },\n    white_female: { idealMin: 0.98, idealMax: 1.02 },\n    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n    black_female: { idealMin: 1.13, idealMax: 1.23 },\n    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n  },\n\n  // ==========================================\n  // JAW METRICS - Clear gender dimorphism\n  // ==========================================\n  bigonialWidth: {\n    // Jaw width as % of bizygomatic width\n    // Males: wider, more angular; Females: narrower, softer\n    male: { idealMin: 90, idealMax: 95 },\n    female: { idealMin: 85, idealMax: 90 },\n  },\n","numLines":100,"startLine":150,"totalLines":3143}}}
{"parentUuid":"364c3ac4-bab6-4ed8-9ce9-ef726b582d76","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01QBos4XPkdY4bFMG4H5AULT","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect! I can see the structure now. The DEMOGRAPHIC_OVERRIDES is organized by metric name, and then each metric has demographic-specific ideal ranges. I can see that Pacific Islander is already mentioned in some metrics like nasalIndex and nasalProjection.\n\nNow let me check if there are already specific overrides for FWHR, alar_base_ratio, bizygomatic_width, and chin_width for Pacific Islander males. Let me search for these specific metrics.","signature":"EuYECkYIChgCKkDA2ENRz00n/MHHLS5slf/X22LYhuINUukJTAbmuDAlDd5E8aoLjsS6BOdpUXFlOTTxE/6m0BIo5kKUYgTZQau9EgzHwAUSNnI8SFQxBT0aDM6n6fGzOBC3+/OkFiIw/kbeAc9Jofa8UNn7ysGWAABXdPDfzTVIUN9DowcXiInxpNcC7xIpUo/uIRQRjEh+Ks0DjGe0FMtgwnOZzPstyrJ8MnaN9y3m65eW3VJdtG4WXm26D3++vOARhxuX8ga9kSA6kSJWOza7DLnQFqQ7v+hbsg5zwheOaY5FWyFm25LaV91OVCmkCawUc5vcKS0XyU4OW1EyqtJlnJKv9FFayXc1Fivs5V36XA6Exv/fQqS2jVzd8uBjjJB0up9fBV0LWpdtO/JLopwUrCGwgYtOilCyTZfCZm8dW4UrJ2kD50tz0qk6MQ6cww9/JJwJTKwY6SurU92ufPaR0giQagnyafD87dBmewvC55Pvp8qL8qbHRtZGJmkmIXxO1g40tw/P76SvYY0kIpOvA9vCzULzUialxX5sWuFEm4Su6DcZy1El+odJZgjZDF+n7T7Oz2rudBuaX1e9C7iPAnky/cEuHjqxDoZ0vv94ajD/9a2PQprtRT+fPI2LudqiBtEjW3Xt0dgYIFGh+Ee1soMmGckIc7nj8a6pvXIA8d0R+838h6QBVzOLHZ0ClamuULLY6aUZVBykR5YZMXJWl+hc/SaSjNHwIqQDFNzLQpPt/kR2gBUS6eUNz8IAU+2SttU9eXZJ9//07SuyzGQg5B93/3xYZIwPyNGFblgXWUXY9ziuKxgYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":2142,"cache_read_input_tokens":23595,"cache_creation":{"ephemeral_5m_input_tokens":2142,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD2Ci65aBWfp7U7Lh9o","type":"assistant","uuid":"1fa3ee2a-ef5f-4f84-9094-268feb6cdf94","timestamp":"2025-12-21T17:14:17.354Z"}
{"parentUuid":"1fa3ee2a-ef5f-4f84-9094-268feb6cdf94","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01QBos4XPkdY4bFMG4H5AULT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_017jFARXFMYu2nGbEHfDSS82","name":"Bash","input":{"command":"grep -n \"fwhr\\|facialWidthToHeightRatio\" src/lib/faceiq-scoring.ts | head -10","description":"Search for FWHR metric"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":2142,"cache_read_input_tokens":23595,"cache_creation":{"ephemeral_5m_input_tokens":2142,"ephemeral_1h_input_tokens":0},"output_tokens":220,"service_tier":"standard"}},"requestId":"req_011CWLD2Ci65aBWfp7U7Lh9o","type":"assistant","uuid":"e204422b-cc69-4d91-8d0b-107e08ba6cf2","timestamp":"2025-12-21T17:14:18.863Z"}
{"parentUuid":"e204422b-cc69-4d91-8d0b-107e08ba6cf2","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_017jFARXFMYu2nGbEHfDSS82","type":"tool_result","content":"","is_error":false}]},"uuid":"83c14173-ba40-43a8-9924-a31df5c0480a","timestamp":"2025-12-21T17:14:18.985Z","toolUseResult":{"stdout":"","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"83c14173-ba40-43a8-9924-a31df5c0480a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01AVJE35mJE15mBjos8YVKmV","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The search didn't return results. Let me search more broadly for facial width metrics.","signature":"Ev4BCkYIChgCKkAK0zrCpEY8xvIP/LLf8bwz5Mo/FrtCGdD0IKXYip21bGa3VwYqToSkFmSl2lM5p632JxQFBM9tCKLlsg8G9MgsEgwm0BxdC/gIHEUADCAaDANnRtaS5IfmZfLn4CIwol+ZsNmnqFA+eRaj8BA12EBkDZWq+pjBNXZ4ziQx9pj5ZqK/R6f1YwYYoEO4wFAyKmaf70oqAg7R6nlaQ5jvdwV66iTJv/yuCse+Wab9JM8DhevQYUJcybXHT5G83VjyMhUexXieI+OptjRMerlOIO5b+vzR2YXYe3l0hJpjy+BoFBS6222LR9yKgBiFmBQUi/8AXS+02+4YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":340,"cache_read_input_tokens":25737,"cache_creation":{"ephemeral_5m_input_tokens":340,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD2iXDnBAgRcpaFWufj","type":"assistant","uuid":"0b0a1f8a-e911-4030-8ffa-aedd8f557552","timestamp":"2025-12-21T17:14:21.171Z"}
{"parentUuid":"0b0a1f8a-e911-4030-8ffa-aedd8f557552","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01AVJE35mJE15mBjos8YVKmV","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JuBMRNABdYK6MwhB5rZQPW","name":"Bash","input":{"command":"grep -n \"facialWidth\\|FWHR\\|cheekbone\" src/lib/faceiq-scoring.ts | head -20","description":"Search for facial width metrics"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":340,"cache_read_input_tokens":25737,"cache_creation":{"ephemeral_5m_input_tokens":340,"ephemeral_1h_input_tokens":0},"output_tokens":131,"service_tier":"standard"}},"requestId":"req_011CWLD2iXDnBAgRcpaFWufj","type":"assistant","uuid":"90f526a4-a9b2-422e-a8c0-2eb71419f65f","timestamp":"2025-12-21T17:14:22.007Z"}
{"parentUuid":"90f526a4-a9b2-422e-a8c0-2eb71419f65f","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JuBMRNABdYK6MwhB5rZQPW","type":"tool_result","content":"571:  cheekboneHeight: {\n572:    id: 'cheekboneHeight',\n583:    description: 'Vertical position of cheekbones relative to face height',\n1776:    { category: 'Upper Third', flawName: 'Narrow forehead', confidence: 'confirmed', reasoning: 'Reduced bitemporal width indicates a narrower than ideal forehead relative to the cheekbones. This disrupts facial harmony by creating a compressed hairline and forehead, altering the overall shape of the face.' },\n1778:  cheekboneHeight: [\n1779:    { category: 'Midface/Face Shape', flawName: 'Low-set cheekbones', confidence: 'confirmed', reasoning: 'Reduced cheekbone height indicates that the cheekbones are positioned lower than ideal. This disrupts facial harmony by creating an unpronounced appearance to the cheekbones and facial structure.' },\n2584:  // FACE WIDTH TO HEIGHT RATIO (FWHR)","is_error":false}]},"uuid":"9010b0da-0e4b-4756-87bf-299368b7f918","timestamp":"2025-12-21T17:14:22.098Z","toolUseResult":{"stdout":"571:  cheekboneHeight: {\n572:    id: 'cheekboneHeight',\n583:    description: 'Vertical position of cheekbones relative to face height',\n1776:    { category: 'Upper Third', flawName: 'Narrow forehead', confidence: 'confirmed', reasoning: 'Reduced bitemporal width indicates a narrower than ideal forehead relative to the cheekbones. This disrupts facial harmony by creating a compressed hairline and forehead, altering the overall shape of the face.' },\n1778:  cheekboneHeight: [\n1779:    { category: 'Midface/Face Shape', flawName: 'Low-set cheekbones', confidence: 'confirmed', reasoning: 'Reduced cheekbone height indicates that the cheekbones are positioned lower than ideal. This disrupts facial harmony by creating an unpronounced appearance to the cheekbones and facial structure.' },\n2584:  // FACE WIDTH TO HEIGHT RATIO (FWHR)","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"9010b0da-0e4b-4756-87bf-299368b7f918","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_012CbsXc2fcXXNPvReBiJtjJ","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good! I found a reference to FWHR at line 2584. Let me read that section.","signature":"EvEBCkYIChgCKkBo14UWBBqazGtf8M8NOf5H1cLYqbpSGa67whqf7OcZOHsH81cztIeOrsVyMEJpVhkBo/4MbR6IcJLbe4h184rzEgwMDwDOeL9FXWpdC1oaDBba0eNdvr+rhhUVPCIwzKHyvmq38G9ygi4399lt7bzPa7c32YaZ8vs49F9XD+Vz5cki/hu24SUJ/IVy5De+KlmF+PafiZKOM8DklRIenyhe4ynZ5Z/K+kGO6Kt2Y+31CPQD4KdhTfHC5Fwgbuuo1pYP6YP22a431APVQ+dhvLolJt8Y9aZ0dvAXVjo+W+kF61Jbj21feO0bTBgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":11,"cache_creation_input_tokens":391,"cache_read_input_tokens":26077,"cache_creation":{"ephemeral_5m_input_tokens":391,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD2wogCg6ccxg7bXUgY","type":"assistant","uuid":"ba52e241-92dc-4dfd-9c3d-69cdb958bb97","timestamp":"2025-12-21T17:14:25.037Z"}
{"parentUuid":"ba52e241-92dc-4dfd-9c3d-69cdb958bb97","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_012CbsXc2fcXXNPvReBiJtjJ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Bae1QYZ5X6h68H8Hqx1Jbv","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","offset":2580,"limit":80}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":11,"cache_creation_input_tokens":391,"cache_read_input_tokens":26077,"cache_creation":{"ephemeral_5m_input_tokens":391,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD2wogCg6ccxg7bXUgY","type":"assistant","uuid":"933fd827-788b-4451-adec-945c99a93195","timestamp":"2025-12-21T17:14:26.449Z"}
{"parentUuid":"933fd827-788b-4451-adec-945c99a93195","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Bae1QYZ5X6h68H8Hqx1Jbv","type":"tool_result","content":"  2580â†’      addMeasurement('lowerThirdProportion', lowerThird);\n  2581â†’    }\n  2582â†’  }\n  2583â†’\n  2584â†’  // FACE WIDTH TO HEIGHT RATIO (FWHR)\n  2585â†’  if (leftZygion && rightZygion && nasalBase && labraleSuperius) {\n  2586â†’    const bizygomaticWidth = distance(leftZygion, rightZygion);\n  2587â†’    const upperFaceHeight = distance(nasalBase, labraleSuperius);\n  2588â†’    if (upperFaceHeight > 0) {\n  2589â†’      addMeasurement('faceWidthToHeight', bizygomaticWidth / upperFaceHeight);\n  2590â†’    }\n  2591â†’  }\n  2592â†’\n  2593â†’  // TOTAL FACIAL WIDTH TO HEIGHT\n  2594â†’  if (leftZygion && rightZygion && trichion && menton) {\n  2595â†’    const cheekWidth = distance(leftZygion, rightZygion);\n  2596â†’    const totalHeight = distance(trichion, menton);\n  2597â†’    if (cheekWidth > 0) {\n  2598â†’      addMeasurement('totalFacialWidthToHeight', totalHeight / cheekWidth);\n  2599â†’    }\n  2600â†’  }\n  2601â†’\n  2602â†’  // JAW WIDTH RATIO\n  2603â†’  if (leftGonion && rightGonion && leftZygion && rightZygion) {\n  2604â†’    const bigonialWidth = distance(leftGonion, rightGonion);\n  2605â†’    const bizygomaticWidth = distance(leftZygion, rightZygion);\n  2606â†’    if (bizygomaticWidth > 0) {\n  2607â†’      const ratio = bigonialWidth / bizygomaticWidth;\n  2608â†’      addMeasurement('jawWidthRatio', ratio);\n  2609â†’      addMeasurement('bigonialWidth', ratio * 100);\n  2610â†’    }\n  2611â†’  }\n  2612â†’\n  2613â†’  // CANTHAL TILT\n  2614â†’  if (leftCanthusM && leftCanthusL) {\n  2615â†’    const deltaY = leftCanthusM.y - leftCanthusL.y;\n  2616â†’    const deltaX = leftCanthusL.x - leftCanthusM.x;\n  2617â†’    const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);\n  2618â†’    addMeasurement('lateralCanthalTilt', angle);\n  2619â†’  }\n  2620â†’\n  2621â†’  // EYE ASPECT RATIO\n  2622â†’  if (leftCanthusM && leftCanthusL) {\n  2623â†’    const leftPalpSup = getLandmark(landmarks, 'left_palpebra_superior');\n  2624â†’    const leftPalpInf = getLandmark(landmarks, 'left_palpebra_inferior');\n  2625â†’    if (leftPalpSup && leftPalpInf) {\n  2626â†’      const eyeWidth = distance(leftCanthusM, leftCanthusL);\n  2627â†’      const eyeHeight = distance(leftPalpSup, leftPalpInf);\n  2628â†’      if (eyeWidth > 0) {\n  2629â†’        addMeasurement('eyeAspectRatio', eyeHeight / eyeWidth);\n  2630â†’      }\n  2631â†’    }\n  2632â†’  }\n  2633â†’\n  2634â†’  // EYE SEPARATION RATIO\n  2635â†’  if (leftCanthusM && rightCanthusM && leftZygion && rightZygion) {\n  2636â†’    const intercanthal = distance(leftCanthusM, rightCanthusM);\n  2637â†’    const bizygomatic = distance(leftZygion, rightZygion);\n  2638â†’    if (bizygomatic > 0) {\n  2639â†’      addMeasurement('eyeSeparationRatio', intercanthal / bizygomatic);\n  2640â†’    }\n  2641â†’  }\n  2642â†’\n  2643â†’  // IPD RATIO\n  2644â†’  if (leftPupil && rightPupil && leftZygion && rightZygion) {\n  2645â†’    const ipd = distance(leftPupil, rightPupil);\n  2646â†’    const bizygomatic = distance(leftZygion, rightZygion);\n  2647â†’    if (bizygomatic > 0) {\n  2648â†’      addMeasurement('interpupillaryRatio', (ipd / bizygomatic) * 100);\n  2649â†’    }\n  2650â†’  }\n  2651â†’\n  2652â†’  // ONE EYE APART TEST\n  2653â†’  if (leftCanthusM && rightCanthusM && leftCanthusL) {\n  2654â†’    const intercanthal = distance(leftCanthusM, rightCanthusM);\n  2655â†’    const eyeWidth = distance(leftCanthusM, leftCanthusL);\n  2656â†’    if (eyeWidth > 0) {\n  2657â†’      addMeasurement('oneEyeApartTest', intercanthal / eyeWidth);\n  2658â†’    }\n  2659â†’  }\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"09f2945c-b919-4a9f-8062-16c1b6f86256","timestamp":"2025-12-21T17:14:26.514Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","content":"      addMeasurement('lowerThirdProportion', lowerThird);\n    }\n  }\n\n  // FACE WIDTH TO HEIGHT RATIO (FWHR)\n  if (leftZygion && rightZygion && nasalBase && labraleSuperius) {\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    const upperFaceHeight = distance(nasalBase, labraleSuperius);\n    if (upperFaceHeight > 0) {\n      addMeasurement('faceWidthToHeight', bizygomaticWidth / upperFaceHeight);\n    }\n  }\n\n  // TOTAL FACIAL WIDTH TO HEIGHT\n  if (leftZygion && rightZygion && trichion && menton) {\n    const cheekWidth = distance(leftZygion, rightZygion);\n    const totalHeight = distance(trichion, menton);\n    if (cheekWidth > 0) {\n      addMeasurement('totalFacialWidthToHeight', totalHeight / cheekWidth);\n    }\n  }\n\n  // JAW WIDTH RATIO\n  if (leftGonion && rightGonion && leftZygion && rightZygion) {\n    const bigonialWidth = distance(leftGonion, rightGonion);\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    if (bizygomaticWidth > 0) {\n      const ratio = bigonialWidth / bizygomaticWidth;\n      addMeasurement('jawWidthRatio', ratio);\n      addMeasurement('bigonialWidth', ratio * 100);\n    }\n  }\n\n  // CANTHAL TILT\n  if (leftCanthusM && leftCanthusL) {\n    const deltaY = leftCanthusM.y - leftCanthusL.y;\n    const deltaX = leftCanthusL.x - leftCanthusM.x;\n    const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);\n    addMeasurement('lateralCanthalTilt', angle);\n  }\n\n  // EYE ASPECT RATIO\n  if (leftCanthusM && leftCanthusL) {\n    const leftPalpSup = getLandmark(landmarks, 'left_palpebra_superior');\n    const leftPalpInf = getLandmark(landmarks, 'left_palpebra_inferior');\n    if (leftPalpSup && leftPalpInf) {\n      const eyeWidth = distance(leftCanthusM, leftCanthusL);\n      const eyeHeight = distance(leftPalpSup, leftPalpInf);\n      if (eyeWidth > 0) {\n        addMeasurement('eyeAspectRatio', eyeHeight / eyeWidth);\n      }\n    }\n  }\n\n  // EYE SEPARATION RATIO\n  if (leftCanthusM && rightCanthusM && leftZygion && rightZygion) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('eyeSeparationRatio', intercanthal / bizygomatic);\n    }\n  }\n\n  // IPD RATIO\n  if (leftPupil && rightPupil && leftZygion && rightZygion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('interpupillaryRatio', (ipd / bizygomatic) * 100);\n    }\n  }\n\n  // ONE EYE APART TEST\n  if (leftCanthusM && rightCanthusM && leftCanthusL) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const eyeWidth = distance(leftCanthusM, leftCanthusL);\n    if (eyeWidth > 0) {\n      addMeasurement('oneEyeApartTest', intercanthal / eyeWidth);\n    }\n  }","numLines":80,"startLine":2580,"totalLines":3143}}}
{"parentUuid":"09f2945c-b919-4a9f-8062-16c1b6f86256","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01EggUSSK5xrHruSMhGjhLEb","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"I can see that the metric is called `faceWidthToHeight` (line 2589), not `fwhr`. Let me now search for where the metric definitions are in the DEMOGRAPHIC_OVERRIDES section. Let me check if there's already a faceWidthToHeight demographic override.","signature":"EqADCkYIChgCKkCxI41ftptVMldEtI5+V26TX/IX9ui+lUeArKNc+lzi/MXjIQEKW2hYXFzaVctdTUIVofT66Rk4JY9jLNRj0NnsEgxr4N5PE7lWfA8fS1oaDPW3qq6Umje/OAoKMCIwQ4FHDmOOo6tKf5Tv+rzHvvD5KKAcghJs/ehnLmeiveKKQVyZM7NIobV3r369an3JKocCkfwsPFQFa3xy544jiKtuXgXXU57eSiPzcaS3OV9Kb3L17lligeagkhQjeI30a2qYR/zcM4EM5zMx+JgYLNTCA3CU4XUGKroTnKE9AUp3jjc/eJPbvrwSEPaUbwupsh3WLhMvcBLX+SLcaSNPSwwkE75LzqzuProE85i1p6nX5pfSbJnjFFmEPhDa9CG+fTXet1OnZFw1xdzsNv9BtDDx5fQeaiw0wgFCB8HdkaEJvrNq1tsLyYvSnt5+bj84COKVZzj8GdV6os+wWSJIOaQLywtzELcOXygmuYA7uFszz1ZpxpeZKk30vpwNNJ8O5pe0KKltmXwfZNhFg61ruDCUEEirkMf9LPwYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":11,"cache_creation_input_tokens":1626,"cache_read_input_tokens":26468,"cache_creation":{"ephemeral_5m_input_tokens":1626,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD3Giif6tFssUCF4ZdV","type":"assistant","uuid":"5fa3e85f-5a38-4e76-87b6-9c70c53c55c4","timestamp":"2025-12-21T17:14:30.299Z"}
{"parentUuid":"5fa3e85f-5a38-4e76-87b6-9c70c53c55c4","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01EggUSSK5xrHruSMhGjhLEb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WJQFJE2rPjVBqAqBUfz8yQ","name":"Bash","input":{"command":"grep -n \"faceWidthToHeight\" src/lib/faceiq-scoring.ts | head -20","description":"Search for faceWidthToHeight metric"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":11,"cache_creation_input_tokens":1626,"cache_read_input_tokens":26468,"cache_creation":{"ephemeral_5m_input_tokens":1626,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD3Giif6tFssUCF4ZdV","type":"assistant","uuid":"59193c5e-f5c1-41b7-86cf-d211bd9c64ac","timestamp":"2025-12-21T17:14:31.326Z"}
{"parentUuid":"59193c5e-f5c1-41b7-86cf-d211bd9c64ac","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01WJQFJE2rPjVBqAqBUfz8yQ","type":"tool_result","content":"323:  faceWidthToHeight: {\n491:  faceWidthToHeight: {\n492:    id: 'faceWidthToHeight',\n1790:  faceWidthToHeight: [\n1870:  faceWidthToHeight: [\n2589:      addMeasurement('faceWidthToHeight', bizygomaticWidth / upperFaceHeight);","is_error":false}]},"uuid":"6d510478-980f-4ac0-834a-db857bb3e1b2","timestamp":"2025-12-21T17:14:31.436Z","toolUseResult":{"stdout":"323:  faceWidthToHeight: {\n491:  faceWidthToHeight: {\n492:    id: 'faceWidthToHeight',\n1790:  faceWidthToHeight: [\n1870:  faceWidthToHeight: [\n2589:      addMeasurement('faceWidthToHeight', bizygomaticWidth / upperFaceHeight);","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"6d510478-980f-4ac0-834a-db857bb3e1b2","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01J8CQCqmmBfCuK3uy3pPRx6","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Great! I found it at line 323. Let me read that section to see the current demographic overrides for faceWidthToHeight.","signature":"EqACCkYIChgCKkAgwRm4UXXOCESnPHgvnPXqh+571DbmgUSOsqQwcFl7gTZQR5vnoQUTj8cwt+fa3EUx3w9j8A+H9y+NGVnE0hV8Egw93bD6Yic9kXgpzNEaDLre4MSdqTmwmfo4gCIwQ+fV7Y/ohgWCEXS2ZKDIPWqSKxR8ZDFjrqBTbLSBoo6EUaUFxzCqaNEr7Aece/yiKocBAWdlYOezZdarKgbACK7H5I26mkLmPoUrapLzgbUMgoTRP2tL8D4QRnsBgD5mSMtGnSTExGomuQqZjuY5bbBAzvAY8MQBaojziKSob9RoZJQWM92puWhmp0CrUUeqJmpUPktHbOl9+M+hbl2BGsw1CNOI9ANqXxtvbD9YASTqKHdgfiGJLdEkGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":390,"cache_read_input_tokens":28094,"cache_creation":{"ephemeral_5m_input_tokens":390,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD3dpEMGDEfX9K96FL9","type":"assistant","uuid":"d664d655-c0e1-4fec-8f80-86f601f0e13a","timestamp":"2025-12-21T17:14:33.998Z"}
{"parentUuid":"d664d655-c0e1-4fec-8f80-86f601f0e13a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01J8CQCqmmBfCuK3uy3pPRx6","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018eFuABqi7fD7bNKgwFq13g","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","offset":320,"limit":50}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":390,"cache_read_input_tokens":28094,"cache_creation":{"ephemeral_5m_input_tokens":390,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD3dpEMGDEfX9K96FL9","type":"assistant","uuid":"47423b2a-107a-4419-9db0-30a5db379e23","timestamp":"2025-12-21T17:14:35.448Z"}
{"parentUuid":"47423b2a-107a-4419-9db0-30a5db379e23","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018eFuABqi7fD7bNKgwFq13g","type":"tool_result","content":"   320â†’  // ==========================================\n   321â†’  // FACE PROPORTIONS - Gender variation\n   322â†’  // ==========================================\n   323â†’  faceWidthToHeight: {\n   324â†’    // Males: slightly wider face preferred; Females: slightly narrower\n   325â†’    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n   326â†’    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n   327â†’    male: { idealMin: 1.98, idealMax: 2.02 },\n   328â†’    female: { idealMin: 1.94, idealMax: 1.98 },\n   329â†’    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n   330â†’    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n   331â†’  },\n   332â†’\n   333â†’  totalFacialWidthToHeight: {\n   334â†’    male: { idealMin: 1.35, idealMax: 1.40 },\n   335â†’    female: { idealMin: 1.32, idealMax: 1.37 },\n   336â†’  },\n   337â†’\n   338â†’  midfaceRatio: {\n   339â†’    // Females often have more compact midface\n   340â†’    // Middle Eastern: Similar to White model - compact is better\n   341â†’    // Extracted from FaceIQ Male:MiddleEastern.htc\n   342â†’    male: { idealMin: 0.98, idealMax: 1.02 },\n   343â†’    female: { idealMin: 0.95, idealMax: 1.00 },\n   344â†’    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n   345â†’    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n   346â†’  },\n   347â†’\n   348â†’  // ==========================================\n   349â†’  // LIP METRICS - Ethnicity variation\n   350â†’  // ==========================================\n   351â†’  lipRatio: {\n   352â†’    // African/Hispanic: fuller lips natural\n   353â†’    black_male: { idealMin: 1.6, idealMax: 2.2 },\n   354â†’    black_female: { idealMin: 1.7, idealMax: 2.3 },\n   355â†’    hispanic_male: { idealMin: 1.4, idealMax: 2.0 },\n   356â†’    hispanic_female: { idealMin: 1.5, idealMax: 2.1 },\n   357â†’    // East Asian: less full lips\n   358â†’    east_asian_male: { idealMin: 1.2, idealMax: 1.7 },\n   359â†’    east_asian_female: { idealMin: 1.3, idealMax: 1.8 },\n   360â†’    // Default\n   361â†’    male: { idealMin: 1.3, idealMax: 1.8 },\n   362â†’    female: { idealMin: 1.4, idealMax: 2.0 },\n   363â†’  },\n   364â†’\n   365â†’  upperLipRatio: {\n   366â†’    // Fuller upper lip in African phenotypes\n   367â†’    black: { idealMin: 0.38, idealMax: 0.48 },\n   368â†’    hispanic: { idealMin: 0.36, idealMax: 0.45 },\n   369â†’    east_asian: { idealMin: 0.32, idealMax: 0.40 },\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"4248775f-007b-4c8f-a623-04c6a280f193","timestamp":"2025-12-21T17:14:35.495Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","content":"  // ==========================================\n  // FACE PROPORTIONS - Gender variation\n  // ==========================================\n  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n  },\n\n  totalFacialWidthToHeight: {\n    male: { idealMin: 1.35, idealMax: 1.40 },\n    female: { idealMin: 1.32, idealMax: 1.37 },\n  },\n\n  midfaceRatio: {\n    // Females often have more compact midface\n    // Middle Eastern: Similar to White model - compact is better\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    male: { idealMin: 0.98, idealMax: 1.02 },\n    female: { idealMin: 0.95, idealMax: 1.00 },\n    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n  },\n\n  // ==========================================\n  // LIP METRICS - Ethnicity variation\n  // ==========================================\n  lipRatio: {\n    // African/Hispanic: fuller lips natural\n    black_male: { idealMin: 1.6, idealMax: 2.2 },\n    black_female: { idealMin: 1.7, idealMax: 2.3 },\n    hispanic_male: { idealMin: 1.4, idealMax: 2.0 },\n    hispanic_female: { idealMin: 1.5, idealMax: 2.1 },\n    // East Asian: less full lips\n    east_asian_male: { idealMin: 1.2, idealMax: 1.7 },\n    east_asian_female: { idealMin: 1.3, idealMax: 1.8 },\n    // Default\n    male: { idealMin: 1.3, idealMax: 1.8 },\n    female: { idealMin: 1.4, idealMax: 2.0 },\n  },\n\n  upperLipRatio: {\n    // Fuller upper lip in African phenotypes\n    black: { idealMin: 0.38, idealMax: 0.48 },\n    hispanic: { idealMin: 0.36, idealMax: 0.45 },\n    east_asian: { idealMin: 0.32, idealMax: 0.40 },","numLines":50,"startLine":320,"totalLines":3143}}}
{"parentUuid":"4248775f-007b-4c8f-a623-04c6a280f193","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01G2ejcVzg9VJyi8ii7gf2DS","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect! I can see the structure. Now I understand:\n\n1. The metric is called `faceWidthToHeight`, not `fwhr`\n2. The current male ideal is 1.98-2.02\n3. Hispanic male has 1.95-2.10 (broader)\n4. The user wants Pacific Islander male to have 2.10-2.30 (even broader)\n\nNow let me also check for other metrics mentioned by the user:\n- alar_base_ratio (which might be intercanthalNasalRatio)\n- bizygomatic_width\n- chin_width\n\nLet me search for these.","signature":"EtgECkYIChgCKkBMS5KQCs4kv5W3fclCktDAp9dxRfjXZh2KognAJsdiWeJkkcLv9Jn9ELqp0YMpFv/wqg/Ro3N4csBCeYY5FcuPEgwGqwYovS7WjyaWsOYaDMushpIM7dW/rqzlVSIwsTdYP7Pig7R7MjHhBl3R4QHf14CP6HPgzDpnRYazmEkdlRhmJKUMe/C3v+2fb0BqKr8DsctGGRqcYUY/Lmgic/tqYN0gT6v0jgPW2o5Oq+SVNsmGFf3dZ+eF2atvUEATyMSKz9cl9EKk9T2Fgb2CvYHYPPuPUPg0LoB/UWeSJzCbR/PQD0d6Bu/IFt6LaCCwVrGtIWB4+Au7IabiY5cm3juLA7paCIhLfqxT+OzYM9kl8O+CO56bDC3Dzs3v8y8jQKcjgnCSanryrfzfDUd51nF/x2PKoClHWXbElUl+b+mLEYiVrU+lqzX5aBV7OYOquuwiOPZRGHIZVIMA+2HHTOOTr+Y2dnkt6Jf0oiwGBiPQUXkpWc+PnxlvDqJZVj2Ph8La182ZufxLQ5ujNE3iUKicIccnWZvkMT2WdceyQaO7mLNfxXsBNYKcFPDody4IzG3mQhJaMM4dREeRrT/bdtYXBHFQaF+q8/7hQPp6iOJyBSc4XFkSEgqj+0gXG8dCE1RO/6yPxlJRBcdx04z6oR0cT0qqtZgHcbiBOztgDwngPl9y2vwzo7cglU8m4tGEo3jqtPGAhuphEjsGGqOnE7LBH30nWc22Rmsv/WQZuvmAYIE2KyBtS+qutVfWQ2U9m7w01LtJ3ze3voExI4OUiVzWGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":1164,"cache_read_input_tokens":28484,"cache_creation":{"ephemeral_5m_input_tokens":1164,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD3w7nRVenz9Zz8ryFJ","type":"assistant","uuid":"2e8a9828-48a2-42d6-b25a-52a777d13f27","timestamp":"2025-12-21T17:14:41.698Z"}
{"parentUuid":"2e8a9828-48a2-42d6-b25a-52a777d13f27","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01G2ejcVzg9VJyi8ii7gf2DS","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KcQDR4rottjNACkUf9sdqi","name":"Bash","input":{"command":"grep -n \"chinWidth\\|chin_width\\|chin\" src/lib/faceiq-scoring.ts | grep -i \"override\\|demographic\\|ideal\" | head -15","description":"Search for chin width metrics"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":1164,"cache_read_input_tokens":28484,"cache_creation":{"ephemeral_5m_input_tokens":1164,"ephemeral_1h_input_tokens":0},"output_tokens":269,"service_tier":"standard"}},"requestId":"req_011CWLD3w7nRVenz9Zz8ryFJ","type":"assistant","uuid":"b587aff5-7c54-4460-a993-b0451dd69f6a","timestamp":"2025-12-21T17:14:43.224Z"}
{"parentUuid":"b587aff5-7c54-4460-a993-b0451dd69f6a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KcQDR4rottjNACkUf9sdqi","type":"tool_result","content":"377:    // Males: more projected chin ideal","is_error":false}]},"uuid":"65b147b7-54ca-4001-8231-e086f17fb8af","timestamp":"2025-12-21T17:14:43.322Z","toolUseResult":{"stdout":"377:    // Males: more projected chin ideal","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"65b147b7-54ca-4001-8231-e086f17fb8af","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01FVREwPAMTD2rkPJvtujEtp","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Let me search more broadly for what metrics are available in the DEMOGRAPHIC_OVERRIDES.","signature":"Ev8BCkYIChgCKkDNoRAU9JbvVSovTu1ozUkiqsWLIWqE2GnxCVbT5+fGv7DiL44Kjz/1Ci7ESVgfAcAwpQ27QKUq+i6FMYILn52hEgx2yjcgXlZqxKnYMX0aDAintguivFN32ZMYJCIwanifS/5kFtsSiHVx/TpW2EzxNC0VaL2ef523NpGhbuKIEHqYMrmwq5JVnj4HyU9SKmc35keY/r2L9YkX0B/vjJLBbAADR7bt+3RAMvZ687RmJyBjnkoybhxJn2DTkEX8OQZ8Ho3EGoR31kvDKi7bY2EVtJKmZos1tkrJswDTzuzmRcbp5wnL1CGcvvvmDN1rN3sJWAjTDGnMGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":291,"cache_read_input_tokens":29648,"cache_creation":{"ephemeral_5m_input_tokens":291,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD4WZCEHxQQ7rjHgtAY","type":"assistant","uuid":"27d3941a-b09a-46fa-99a8-715407e6eabf","timestamp":"2025-12-21T17:14:46.232Z"}
{"parentUuid":"27d3941a-b09a-46fa-99a8-715407e6eabf","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01FVREwPAMTD2rkPJvtujEtp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011ZpCPpuY1FFtB7FW1aTUTR","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","offset":240,"limit":100}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":291,"cache_read_input_tokens":29648,"cache_creation":{"ephemeral_5m_input_tokens":291,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD4WZCEHxQQ7rjHgtAY","type":"assistant","uuid":"35c2098a-b5cc-4078-a61b-57a23b0e4a28","timestamp":"2025-12-21T17:14:47.550Z"}
{"parentUuid":"35c2098a-b5cc-4078-a61b-57a23b0e4a28","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011ZpCPpuY1FFtB7FW1aTUTR","type":"tool_result","content":"   240â†’  // ==========================================\n   241â†’  // JAW METRICS - Clear gender dimorphism\n   242â†’  // ==========================================\n   243â†’  bigonialWidth: {\n   244â†’    // Jaw width as % of bizygomatic width\n   245â†’    // Males: wider, more angular; Females: narrower, softer\n   246â†’    male: { idealMin: 90, idealMax: 95 },\n   247â†’    female: { idealMin: 85, idealMax: 90 },\n   248â†’  },\n   249â†’\n   250â†’  jawFrontalAngle: {\n   251â†’    // More angular in males, softer in females\n   252â†’    male: { idealMin: 88, idealMax: 95 },\n   253â†’    female: { idealMin: 82, idealMax: 90 },\n   254â†’  },\n   255â†’\n   256â†’  jawWidthRatio: {\n   257â†’    // Males have stronger jaw width preference\n   258â†’    male: { idealMin: 0.78, idealMax: 0.85 },\n   259â†’    female: { idealMin: 0.72, idealMax: 0.80 },\n   260â†’  },\n   261â†’\n   262â†’  gonialAngle: {\n   263â†’    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n   264â†’    male: { idealMin: 115, idealMax: 125 },\n   265â†’    female: { idealMin: 120, idealMax: 135 },\n   266â†’  },\n   267â†’\n   268â†’  // ==========================================\n   269â†’  // EYE METRICS - Ethnic variation\n   270â†’  // ==========================================\n   271â†’  lateralCanthalTilt: {\n   272â†’    // East Asian: naturally higher positive tilt\n   273â†’    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n   274â†’    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n   275â†’    // Extracted from FaceIQ Male:MiddleEastern.htc\n   276â†’    east_asian_male: { idealMin: 8, idealMax: 12 },\n   277â†’    east_asian_female: { idealMin: 9, idealMax: 13 },\n   278â†’    south_asian_male: { idealMin: 6, idealMax: 10 },\n   279â†’    south_asian_female: { idealMin: 7, idealMax: 11 },\n   280â†’    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n   281â†’    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n   282â†’    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n   283â†’    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n   284â†’    // Default for others is 4-8 (already in FACEIQ_METRICS)\n   285â†’  },\n   286â†’\n   287â†’  eyeAspectRatio: {\n   288â†’    // East Asian eyes often have different aspect ratio due to epicanthal fold\n   289â†’    east_asian_male: { idealMin: 2.6, idealMax: 3.2 },\n   290â†’    east_asian_female: { idealMin: 2.7, idealMax: 3.3 },\n   291â†’    // Larger eyes in females considered more attractive\n   292â†’    male: { idealMin: 2.9, idealMax: 3.4 },\n   293â†’    female: { idealMin: 3.1, idealMax: 3.6 },\n   294â†’  },\n   295â†’\n   296â†’  tearTroughDepth: {\n   297â†’    // Under-eye hollowing and dark circles (infraorbital depression)\n   298â†’    // South Asian: MUCH stricter penalty due to genetic hyperpigmentation\n   299â†’    // Extracted from FaceIQ Male:SouthAsian.htc - biggest difference vs White model\n   300â†’    white_male: { idealMin: 0.0, idealMax: 1.5 },\n   301â†’    white_female: { idealMin: 0.0, idealMax: 1.3 },\n   302â†’    south_asian_male: { idealMin: 0.0, idealMax: 0.5 },  // VERY strict - 0.5+ triggers \"Tired/Aged Eyes\" flaw\n   303â†’    south_asian_female: { idealMin: 0.0, idealMax: 0.4 },\n   304â†’    east_asian_male: { idealMin: 0.0, idealMax: 1.2 },\n   305â†’    east_asian_female: { idealMin: 0.0, idealMax: 1.0 },\n   306â†’  },\n   307â†’\n   308â†’  upperEyelidExposure: {\n   309â†’    // Visible eyelid platform (space between eyelash and crease)\n   310â†’    // South Asian ideal: prefers visible lid platform, penalizes hooded eyes more than White model\n   311â†’    // Extracted from FaceIQ Male:SouthAsian.htc\n   312â†’    white_male: { idealMin: 0.3, idealMax: 2.5 },\n   313â†’    white_female: { idealMin: 0.5, idealMax: 3.0 },\n   314â†’    south_asian_male: { idealMin: 0.5, idealMax: 2.0 },  // Prefers visible lid, penalizes hooding\n   315â†’    south_asian_female: { idealMin: 0.7, idealMax: 2.2 },\n   316â†’    east_asian_male: { idealMin: 0.0, idealMax: 1.5 },  // More tolerance for less exposure\n   317â†’    east_asian_female: { idealMin: 0.2, idealMax: 1.8 },\n   318â†’  },\n   319â†’\n   320â†’  // ==========================================\n   321â†’  // FACE PROPORTIONS - Gender variation\n   322â†’  // ==========================================\n   323â†’  faceWidthToHeight: {\n   324â†’    // Males: slightly wider face preferred; Females: slightly narrower\n   325â†’    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n   326â†’    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n   327â†’    male: { idealMin: 1.98, idealMax: 2.02 },\n   328â†’    female: { idealMin: 1.94, idealMax: 1.98 },\n   329â†’    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n   330â†’    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n   331â†’  },\n   332â†’\n   333â†’  totalFacialWidthToHeight: {\n   334â†’    male: { idealMin: 1.35, idealMax: 1.40 },\n   335â†’    female: { idealMin: 1.32, idealMax: 1.37 },\n   336â†’  },\n   337â†’\n   338â†’  midfaceRatio: {\n   339â†’    // Females often have more compact midface\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"fa10d98c-9d3c-4dd7-9a16-4fe9e94393e3","timestamp":"2025-12-21T17:14:47.598Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","content":"  // ==========================================\n  // JAW METRICS - Clear gender dimorphism\n  // ==========================================\n  bigonialWidth: {\n    // Jaw width as % of bizygomatic width\n    // Males: wider, more angular; Females: narrower, softer\n    male: { idealMin: 90, idealMax: 95 },\n    female: { idealMin: 85, idealMax: 90 },\n  },\n\n  jawFrontalAngle: {\n    // More angular in males, softer in females\n    male: { idealMin: 88, idealMax: 95 },\n    female: { idealMin: 82, idealMax: 90 },\n  },\n\n  jawWidthRatio: {\n    // Males have stronger jaw width preference\n    male: { idealMin: 0.78, idealMax: 0.85 },\n    female: { idealMin: 0.72, idealMax: 0.80 },\n  },\n\n  gonialAngle: {\n    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n    male: { idealMin: 115, idealMax: 125 },\n    female: { idealMin: 120, idealMax: 135 },\n  },\n\n  // ==========================================\n  // EYE METRICS - Ethnic variation\n  // ==========================================\n  lateralCanthalTilt: {\n    // East Asian: naturally higher positive tilt\n    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian_male: { idealMin: 8, idealMax: 12 },\n    east_asian_female: { idealMin: 9, idealMax: 13 },\n    south_asian_male: { idealMin: 6, idealMax: 10 },\n    south_asian_female: { idealMin: 7, idealMax: 11 },\n    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n    // Default for others is 4-8 (already in FACEIQ_METRICS)\n  },\n\n  eyeAspectRatio: {\n    // East Asian eyes often have different aspect ratio due to epicanthal fold\n    east_asian_male: { idealMin: 2.6, idealMax: 3.2 },\n    east_asian_female: { idealMin: 2.7, idealMax: 3.3 },\n    // Larger eyes in females considered more attractive\n    male: { idealMin: 2.9, idealMax: 3.4 },\n    female: { idealMin: 3.1, idealMax: 3.6 },\n  },\n\n  tearTroughDepth: {\n    // Under-eye hollowing and dark circles (infraorbital depression)\n    // South Asian: MUCH stricter penalty due to genetic hyperpigmentation\n    // Extracted from FaceIQ Male:SouthAsian.htc - biggest difference vs White model\n    white_male: { idealMin: 0.0, idealMax: 1.5 },\n    white_female: { idealMin: 0.0, idealMax: 1.3 },\n    south_asian_male: { idealMin: 0.0, idealMax: 0.5 },  // VERY strict - 0.5+ triggers \"Tired/Aged Eyes\" flaw\n    south_asian_female: { idealMin: 0.0, idealMax: 0.4 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.2 },\n    east_asian_female: { idealMin: 0.0, idealMax: 1.0 },\n  },\n\n  upperEyelidExposure: {\n    // Visible eyelid platform (space between eyelash and crease)\n    // South Asian ideal: prefers visible lid platform, penalizes hooded eyes more than White model\n    // Extracted from FaceIQ Male:SouthAsian.htc\n    white_male: { idealMin: 0.3, idealMax: 2.5 },\n    white_female: { idealMin: 0.5, idealMax: 3.0 },\n    south_asian_male: { idealMin: 0.5, idealMax: 2.0 },  // Prefers visible lid, penalizes hooding\n    south_asian_female: { idealMin: 0.7, idealMax: 2.2 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.5 },  // More tolerance for less exposure\n    east_asian_female: { idealMin: 0.2, idealMax: 1.8 },\n  },\n\n  // ==========================================\n  // FACE PROPORTIONS - Gender variation\n  // ==========================================\n  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n  },\n\n  totalFacialWidthToHeight: {\n    male: { idealMin: 1.35, idealMax: 1.40 },\n    female: { idealMin: 1.32, idealMax: 1.37 },\n  },\n\n  midfaceRatio: {\n    // Females often have more compact midface","numLines":100,"startLine":240,"totalLines":3143}}}
{"parentUuid":"fa10d98c-9d3c-4dd7-9a16-4fe9e94393e3","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_013hND5g7bYXrZZQZrUH1SiT","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect! Now I have a good understanding of the structure. I can see that:\n\n1. `faceWidthToHeight` - Line 323 (this is the FWHR metric)\n2. `bigonialWidth` - Line 243 (jaw width as % of bizygomatic width)\n3. `jawWidthRatio` - Line 256\n\nFor the nasal metrics, I saw earlier:\n- `intercanthalNasalRatio` - Line 224 (this is likely the alar base ratio)\n- `nasalIndex` - Line 174\n\nNow, based on the user's input, I need to add Pacific Islander male overrides for:\n1. `faceWidthToHeight` - ideal [2.10, 2.30] (broader than Hispanic)\n2. `intercanthalNasalRatio` - The user mentioned alar_base_ratio with ideal [1.05, 1.20]\n3. `bigonialWidth` or `jawWidthRatio` - For jaw width preferences\n4. Chin width - Need to find if there's a metric for this\n\nLet me check if there's already Pacific Islander data and what metrics need to be added.\n\nLooking at the data provided by the user:\n- FWHR: 2.10-2.30 (much broader than the current male default of 1.98-2.02)\n- Alar base ratio: 1.05-1.20 (this is likely intercanthalNasalRatio)\n- Bizygomatic width: 140-155mm (raw measurement, but the overrides use ratios)\n- Chin width: 40-50mm (raw measurement)\n\nHowever, looking at the DEMOGRAPHIC_OVERRIDES structure, I see that it uses ratios and percentages, not raw measurements in mm. The user's data seems to be from a different system that uses raw measurements.\n\nLet me adapt this to fit the existing structure. I should add:\n\n\nI'll focus on converting the raw measurements into appropriate ratio-based overrides. The FWHR and alar base ratio can be directly incorporated, while the jaw and chin width measurements will require careful conversion to match the existing demographic override format.","signature":"EoUOCkYIChgCKkAuY3qMVrOL44Ao7rjC2W7EILJ2IDCM6y1MqXEoazQ8/O70c6R2MdYvITmhtAlHdFBvbgRbER3x+QTQ4hBpj6DoEgyMMsHKCZhgR9iJOmwaDFdtwBP3wJoCmrPhXiIw+ciL4fEtYb20t55E4D0d4Pizesdx9NWq9LZTLjARbSbb2Y8o5HC/33DZq+dJc+dWKuwM9XkcG/TETOxvHt99dwZ5phBIAnbsXiqB0lY4stgEjMVTjlA4G+CRwKzvGCIir785wfM0VhkTvd0f2MBiJiKfi5VfNcl4Zl0qSCT8xo/7etFsBnZ4Hk+muO0v3Hf1F/n/65JtBJRePdh1CCbbtQcD2VdXA9Q1NkntMG9ryTJvPtzKb3dJKqdasexT7ZMjoBqj8zl3N8manyb/EZ3670Wcu7MYgzaMy5Fk8lGTv32wfvw6SzVtlal0C/CvgDfZqzsn1EU9LCCdrkhcrtwsi2XFxvuVCX34f6mPJ1zm7AHhc7GoLwfaL6ihO7d96xCqkQWR6zec3Z9XeDXE9DS9CWr2Pk12Q8fAkLBxG/Pln6evWmPRnlXTeLJqWkcyz/7hwfEqXucoOL0cFkuIiPBxxhab/ooGv2XWSzH7Dgr0YjEbHhyF4ovKnj6PVxC+TEp+/LRi6wDJ8OEM1/eRLAMwG8D9yuqX1wnOSz4h4L0O0mJip11PP2vMlJ/yfqoO05bFEZCuujJAc0imCdoY6c3KaGEZJUhZHAf5Qh8ik3A7UuDmTu8eoePfzSEipWUhNoH6MrjP2sx3oaqzm0xPaI88brO0BaoSZAbWlHZht1v8Lm1vjPVVFbh7dsh+8X/v/qV/A89S76CxOgv82Wtx2pdUE6TmqkjseM7SQ4sc5C2v2GMPDvPm7chK0hu5/dPpa6kSpOr9xjsPq4ViI8XJYHUiFLX2By2iGN2f3PDoALmjfud+UWQJ7hDdBwlwekms3bv5GSdWteRSoJlsnZIXvsPSB0YQTaY9r+zsrXgUD2rWT3hrCG97SD6QqzubZ7qeOL38w3Cho2/SxKsZEY04Vb86dj8tqMCqQ89TuYhbg1JI6vNRv4d/iwMyuxLLYpLjKQoLilHwzvvNaACyyljYnE6JM0eljkAkAJ3ipyKVk7TH4iBdUOo66R2KfpLunn5SUPnLSprIOh2k+X4/WxQqOrBVAyjKbgXgRuFGlPe/ORf+kms5tDGVnMv7d99yiaqkPseaQ8tw9JJJe2uJL+wpGxJ5vVuSWYKQyCBNFRkQRlh6RZAUhByfybJ6U6JFWU0g5CJxs/YLl8xLqyJX3PFnmyi+DpBEXLWuAI8KlZ8RCLkpwCLQgQD9pKEwjZ0ioN1l+/LdqmGNe3qGpLZYgJydT+urDmwEjZ4K1QiZdKw7dHY3GFMQW4XsVtR48RNDr0wBlmaSOoN6mW9tTNv0hp/wvZreFUo8PopperxqpVuDdstCuAZDMmRSZVbd/K+HdnvYuqA6TbXv8PFM8A0y7cIK82mhwxC6gOO4HByKENbmdYUumjts5pOH3tS5dyf95n9/GGlNS87z0enrgsOWu+JTkbJrO9UshtwQColZdBKi8qWT5tila95p81QbsviEeQbPaCKDsTHwf9Tgm6bVC/LOSP31ucNLMyod7UTc3LXmSZ7Xv0TUPc73Ik1hzFhv5RqyWZ6D3o+NmNGWoLB7pI7nBVzhhJslgLwcaOyBDfIubTJjYwjtwlKPH9x52WBLvHhNxL4IAxGbW7dF/IA/GXBCYlsxmpK7bazc7ul9kesAsFxVkAlvAZSNbz5v/dHvuTJ9cGqavdEW1zjNzqWYmcAeJ6gyMzQmMyMmMhmT0awOsxnKFHZ/znNtHjLuDflcgMH6Vl15BjTOE/ojPIy8VuFKIIUixCK01ISfBqvP8IxDHhaTzJDPQttbqPOIGNKT8Vul0XlHSitjR5LoBHk8iNSf/5+dSRWuoV7BvZ3Zf5vRAdu1T8tDAvRjRvkApazw4FuGnr9luV1MYX2m3nVN9JNvxmYGYax2WA808ZGfBdhgVHNTEsSkapzeyvf8EFe0qqouNFNYjLfP8GXTajocYmtV94/rlsXDTFvOgov8AT8gbPKqg7zPS0wyF4lXoaCjiSNiwy3BxOrmi4mdUVfTBWm8YRa7cLlVi1OGzrDOFUNTJwyEJDvyNnbK7jfNMFQ+kblmeX5GLAjTitqPmV1vEhTHBPWGn/uiF3tNGNev8vu53rwdclIGn0FLMFaZThi4zrgwSOLGJcovTXLt8KGitXwb7BmogVicK94LP8QoBXxEvtXZqlidoNlclg+uhJgy7yVTJXoLCYl/WOorwSmRnX6eUEq8gSVuLo+/7ptY+rA97KJkyOpkuvU4L6ytdnkZsfaxUvqB+rn1kvxzFPOS7E+f2hUeGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":9,"cache_creation_input_tokens":2209,"cache_read_input_tokens":29939,"cache_creation":{"ephemeral_5m_input_tokens":2209,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD4psGmf2E8whwDjDMK","type":"assistant","uuid":"ab02b0cc-40f2-4e8c-860f-823b7e495b93","timestamp":"2025-12-21T17:15:03.249Z"}
{"parentUuid":"ab02b0cc-40f2-4e8c-860f-823b7e495b93","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_013hND5g7bYXrZZQZrUH1SiT","type":"message","role":"assistant","content":[{"type":"text","text":"Now I understand the structure. Let me add the Pacific Islander Male demographic overrides to the existing `DEMOGRAPHIC_OVERRIDES` in your faceiq-scoring.ts file. Based on your extracted logic, I'll add the appropriate overrides for the key metrics."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":9,"cache_creation_input_tokens":2209,"cache_read_input_tokens":29939,"cache_creation":{"ephemeral_5m_input_tokens":2209,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD4psGmf2E8whwDjDMK","type":"assistant","uuid":"69babcb7-bdbc-4435-a0ab-830703fd2177","timestamp":"2025-12-21T17:15:03.263Z"}
{"parentUuid":"69babcb7-bdbc-4435-a0ab-830703fd2177","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_013hND5g7bYXrZZQZrUH1SiT","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018pv6VkNGNspnJvm5NTj6Aa","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","old_string":"  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n  },","new_string":"  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n  },"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":9,"cache_creation_input_tokens":2209,"cache_read_input_tokens":29939,"cache_creation":{"ephemeral_5m_input_tokens":2209,"ephemeral_1h_input_tokens":0},"output_tokens":1152,"service_tier":"standard"}},"requestId":"req_011CWLD4psGmf2E8whwDjDMK","type":"assistant","uuid":"83a183d7-2aaf-4ba3-b712-5a1e736b9d83","timestamp":"2025-12-21T17:15:08.226Z"}
{"type":"file-history-snapshot","messageId":"83a183d7-2aaf-4ba3-b712-5a1e736b9d83","snapshot":{"messageId":"c1b903cb-f03a-4855-a433-1321cc7f94e6","trackedFileBackups":{"src/lib/faceiq-scoring.ts":{"backupFileName":"0db8b87525354b47@v1","version":1,"backupTime":"2025-12-21T17:15:08.256Z"}},"timestamp":"2025-12-21T17:13:34.881Z"},"isSnapshotUpdate":true}
{"parentUuid":"83a183d7-2aaf-4ba3-b712-5a1e736b9d83","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018pv6VkNGNspnJvm5NTj6Aa","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   319â†’\n   320â†’  // ==========================================\n   321â†’  // FACE PROPORTIONS - Gender variation\n   322â†’  // ==========================================\n   323â†’  faceWidthToHeight: {\n   324â†’    // Males: slightly wider face preferred; Females: slightly narrower\n   325â†’    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n   326â†’    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n   327â†’    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"\n   328â†’    male: { idealMin: 1.98, idealMax: 2.02 },\n   329â†’    female: { idealMin: 1.94, idealMax: 1.98 },\n   330â†’    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n   331â†’    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n   332â†’    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n   333â†’    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n   334â†’  },\n   335â†’\n   336â†’  totalFacialWidthToHeight: {\n   337â†’    male: { idealMin: 1.35, idealMax: 1.40 },\n   338â†’    female: { idealMin: 1.32, idealMax: 1.37 },"}]},"uuid":"d18560ba-c4f4-44bc-8bda-a3f708b623a1","timestamp":"2025-12-21T17:15:08.253Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","oldString":"  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n  },","newString":"  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n  },","originalFile":"/**\n * FaceIQ-Style Facial Analysis Scoring System\n * Complete replication of FaceIQ Labs scoring algorithms\n *\n * Features:\n * - Exponential decay scoring with per-metric decay rates\n * - Bezier curve custom scoring for non-linear measurements\n * - 70+ facial measurements (front + side profiles)\n * - Quality tiers: Ideal, Excellent, Good\n * - 5-tier severity: Extremely Severe, Severe, Major, Moderate, Minor\n */\n\nimport { LandmarkPoint } from './landmarks';\n\n// ============================================\n// CORE TYPES\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\n/**\n * Polarity defines how deviation from the ideal range is interpreted:\n * - 'balanced': Default. Deviation in either direction is equally bad.\n * - 'higher_is_better': Values above the ideal are still good. Only values below\n *   the 'safeFloor' are true weaknesses. E.g., Canthal Tilt (positive tilt is good)\n * - 'lower_is_better': Values below the ideal are still good. Only values above\n *   the 'safeCeiling' are true weaknesses. E.g., Philtrum length (shorter is better)\n */\nexport type MetricPolarity = 'balanced' | 'higher_is_better' | 'lower_is_better';\n\nexport interface MetricConfig {\n  id: string;\n  name: string;\n  category: string;\n  unit: MeasurementUnit;\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  decayRate: number;\n  maxScore: number;\n  weight: number;\n  description: string;\n  profileType: 'front' | 'side';\n  customCurve?: BezierCurveConfig;\n  /**\n   * Polarity for directional/dimorphic scoring.\n   * Defaults to 'balanced' if not specified.\n   */\n  polarity?: MetricPolarity;\n  /**\n   * For 'higher_is_better': minimum value that's still acceptable.\n   * Values above this but below idealMin get a passing score (softFloorScore).\n   * Values below this are true weaknesses.\n   */\n  safeFloor?: number;\n  /**\n   * For 'lower_is_better': maximum value that's still acceptable.\n   * Values below this but above idealMax get a passing score (softCeilingScore).\n   * Values above this are true weaknesses.\n   */\n  safeCeiling?: number;\n  /**\n   * Score given to values in the \"acceptable but not ideal\" zone.\n   * Defaults to 8.0 (Good). Range: 6.0-9.0\n   */\n  softZoneScore?: number;\n}\n\nexport interface BezierCurveConfig {\n  mode: 'custom' | 'exponential';\n  points: CurvePoint[];\n}\n\nexport interface CurvePoint {\n  x: number;\n  y: number;\n  leftHandleX?: number;\n  leftHandleY?: number;\n  rightHandleX?: number;\n  rightHandleY?: number;\n  fixed?: boolean;\n}\n\nexport interface FaceIQScoreResult {\n  metricId: string;\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  severity: SeverityLevel;\n  idealMin: number;\n  idealMax: number;\n  deviation: number;\n  deviationDirection: 'above' | 'below' | 'within';\n  unit: MeasurementUnit;\n  category: string;\n  percentile?: number;\n}\n\nexport interface HarmonyAnalysis {\n  overallScore: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  percentile: number;\n  frontScore: number;\n  sideScore: number;\n  categoryScores: Record<string, number>;\n  measurements: FaceIQScoreResult[];\n  flaws: FlawAssessment[];\n  strengths: StrengthAssessment[];\n}\n\nexport interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n}\n\nexport interface StrengthAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  qualityTier: QualityTier;\n  value: number;\n  reasoning: string;\n}\n\n// ============================================\n// DEMOGRAPHIC TYPES & OVERRIDES\n// ============================================\n\nexport type Ethnicity =\n  | 'east_asian'\n  | 'south_asian'\n  | 'black'\n  | 'hispanic'\n  | 'middle_eastern'\n  | 'native_american'\n  | 'pacific_islander'\n  | 'white'\n  | 'other';\n\nexport type Gender = 'male' | 'female';\n\nexport type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n\nexport interface DemographicOverride {\n  idealMin: number;\n  idealMax: number;\n}\n\n/**\n * Demographic-specific ideal ranges based on anthropometric research.\n * FaceIQ uses universal scoring, but this gives more accurate assessments\n * by adjusting ideals based on ethnicity and gender.\n */\nexport const DEMOGRAPHIC_OVERRIDES: Record<string, Partial<Record<DemographicKey, DemographicOverride>>> = {\n  // ==========================================\n  // NOSE METRICS - Highest ethnicity variation\n  // ==========================================\n  nasalIndex: {\n    // Nasal Index = (Nose Width / Nose Height) Ã— 100\n    // Research: African/Pacific Islander tend platyrrhine (85-100), Asian mesorrhine (75-88), European leptorrhine (65-75)\n    east_asian_male: { idealMin: 78, idealMax: 88 },\n    east_asian_female: { idealMin: 76, idealMax: 86 },\n    south_asian_male: { idealMin: 72, idealMax: 82 },\n    south_asian_female: { idealMin: 70, idealMax: 80 },\n    black_male: { idealMin: 85, idealMax: 100 },\n    black_female: { idealMin: 83, idealMax: 98 },\n    hispanic_male: { idealMin: 75, idealMax: 87 },\n    hispanic_female: { idealMin: 73, idealMax: 85 },\n    middle_eastern_male: { idealMin: 68, idealMax: 78 },\n    middle_eastern_female: { idealMin: 66, idealMax: 76 },\n    white_male: { idealMin: 65, idealMax: 75 },\n    white_female: { idealMin: 63, idealMax: 73 },\n    native_american_male: { idealMin: 72, idealMax: 82 },\n    native_american_female: { idealMin: 70, idealMax: 80 },\n    pacific_islander_male: { idealMin: 82, idealMax: 95 },\n    pacific_islander_female: { idealMin: 80, idealMax: 93 },\n  },\n\n  nasolabialAngle: {\n    // Ideal nasolabial angle varies by ethnicity\n    // African: slightly more obtuse, European: slightly more acute\n    // Middle Eastern: Penalizes droopy tip (<90Â°) - common flaw is \"Hooked Nose\"\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    black_male: { idealMin: 95, idealMax: 110 },\n    black_female: { idealMin: 100, idealMax: 115 },\n    east_asian_male: { idealMin: 90, idealMax: 105 },\n    east_asian_female: { idealMin: 95, idealMax: 110 },\n    middle_eastern_male: { idealMin: 90, idealMax: 100 },  // Strict on droopy tip\n    middle_eastern_female: { idealMin: 95, idealMax: 105 },\n    // Gender-only fallbacks\n    male: { idealMin: 90, idealMax: 100 },\n    female: { idealMin: 100, idealMax: 110 },\n  },\n\n  nasalProjection: {\n    // Nose projection relative to face depth\n    // East Asian/African: typically less projection is ideal\n    // Middle Eastern: Accepts stronger projection (bigger nose) than White model\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian: { idealMin: 0.54, idealMax: 0.60 },\n    black: { idealMin: 0.52, idealMax: 0.58 },\n    south_asian: { idealMin: 0.56, idealMax: 0.62 },\n    middle_eastern: { idealMin: 0.62, idealMax: 0.70 },  // Higher tolerance for larger noses\n    white: { idealMin: 0.60, idealMax: 0.67 },\n    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },\n  },\n\n  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Extracted from FaceIQ BlackAfrican.htc logic\n    white_male: { idealMin: 1.00, idealMax: 1.04 },\n    white_female: { idealMin: 0.98, idealMax: 1.02 },\n    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n    black_female: { idealMin: 1.13, idealMax: 1.23 },\n    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n  },\n\n  // ==========================================\n  // JAW METRICS - Clear gender dimorphism\n  // ==========================================\n  bigonialWidth: {\n    // Jaw width as % of bizygomatic width\n    // Males: wider, more angular; Females: narrower, softer\n    male: { idealMin: 90, idealMax: 95 },\n    female: { idealMin: 85, idealMax: 90 },\n  },\n\n  jawFrontalAngle: {\n    // More angular in males, softer in females\n    male: { idealMin: 88, idealMax: 95 },\n    female: { idealMin: 82, idealMax: 90 },\n  },\n\n  jawWidthRatio: {\n    // Males have stronger jaw width preference\n    male: { idealMin: 0.78, idealMax: 0.85 },\n    female: { idealMin: 0.72, idealMax: 0.80 },\n  },\n\n  gonialAngle: {\n    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n    male: { idealMin: 115, idealMax: 125 },\n    female: { idealMin: 120, idealMax: 135 },\n  },\n\n  // ==========================================\n  // EYE METRICS - Ethnic variation\n  // ==========================================\n  lateralCanthalTilt: {\n    // East Asian: naturally higher positive tilt\n    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian_male: { idealMin: 8, idealMax: 12 },\n    east_asian_female: { idealMin: 9, idealMax: 13 },\n    south_asian_male: { idealMin: 6, idealMax: 10 },\n    south_asian_female: { idealMin: 7, idealMax: 11 },\n    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n    // Default for others is 4-8 (already in FACEIQ_METRICS)\n  },\n\n  eyeAspectRatio: {\n    // East Asian eyes often have different aspect ratio due to epicanthal fold\n    east_asian_male: { idealMin: 2.6, idealMax: 3.2 },\n    east_asian_female: { idealMin: 2.7, idealMax: 3.3 },\n    // Larger eyes in females considered more attractive\n    male: { idealMin: 2.9, idealMax: 3.4 },\n    female: { idealMin: 3.1, idealMax: 3.6 },\n  },\n\n  tearTroughDepth: {\n    // Under-eye hollowing and dark circles (infraorbital depression)\n    // South Asian: MUCH stricter penalty due to genetic hyperpigmentation\n    // Extracted from FaceIQ Male:SouthAsian.htc - biggest difference vs White model\n    white_male: { idealMin: 0.0, idealMax: 1.5 },\n    white_female: { idealMin: 0.0, idealMax: 1.3 },\n    south_asian_male: { idealMin: 0.0, idealMax: 0.5 },  // VERY strict - 0.5+ triggers \"Tired/Aged Eyes\" flaw\n    south_asian_female: { idealMin: 0.0, idealMax: 0.4 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.2 },\n    east_asian_female: { idealMin: 0.0, idealMax: 1.0 },\n  },\n\n  upperEyelidExposure: {\n    // Visible eyelid platform (space between eyelash and crease)\n    // South Asian ideal: prefers visible lid platform, penalizes hooded eyes more than White model\n    // Extracted from FaceIQ Male:SouthAsian.htc\n    white_male: { idealMin: 0.3, idealMax: 2.5 },\n    white_female: { idealMin: 0.5, idealMax: 3.0 },\n    south_asian_male: { idealMin: 0.5, idealMax: 2.0 },  // Prefers visible lid, penalizes hooding\n    south_asian_female: { idealMin: 0.7, idealMax: 2.2 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.5 },  // More tolerance for less exposure\n    east_asian_female: { idealMin: 0.2, idealMax: 1.8 },\n  },\n\n  // ==========================================\n  // FACE PROPORTIONS - Gender variation\n  // ==========================================\n  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n  },\n\n  totalFacialWidthToHeight: {\n    male: { idealMin: 1.35, idealMax: 1.40 },\n    female: { idealMin: 1.32, idealMax: 1.37 },\n  },\n\n  midfaceRatio: {\n    // Females often have more compact midface\n    // Middle Eastern: Similar to White model - compact is better\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    male: { idealMin: 0.98, idealMax: 1.02 },\n    female: { idealMin: 0.95, idealMax: 1.00 },\n    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n  },\n\n  // ==========================================\n  // LIP METRICS - Ethnicity variation\n  // ==========================================\n  lipRatio: {\n    // African/Hispanic: fuller lips natural\n    black_male: { idealMin: 1.6, idealMax: 2.2 },\n    black_female: { idealMin: 1.7, idealMax: 2.3 },\n    hispanic_male: { idealMin: 1.4, idealMax: 2.0 },\n    hispanic_female: { idealMin: 1.5, idealMax: 2.1 },\n    // East Asian: less full lips\n    east_asian_male: { idealMin: 1.2, idealMax: 1.7 },\n    east_asian_female: { idealMin: 1.3, idealMax: 1.8 },\n    // Default\n    male: { idealMin: 1.3, idealMax: 1.8 },\n    female: { idealMin: 1.4, idealMax: 2.0 },\n  },\n\n  upperLipRatio: {\n    // Fuller upper lip in African phenotypes\n    black: { idealMin: 0.38, idealMax: 0.48 },\n    hispanic: { idealMin: 0.36, idealMax: 0.45 },\n    east_asian: { idealMin: 0.32, idealMax: 0.40 },\n    female: { idealMin: 0.34, idealMax: 0.42 },\n  },\n\n  // ==========================================\n  // PROFILE METRICS - Gender & ethnicity\n  // ==========================================\n  chinProjection: {\n    // Males: more projected chin ideal\n    // Black/African: Adjusted for bimaxillary prognathism (forward mouth projection)\n    // Extracted from FaceIQ BlackAfrican.htc logic\n    male: { idealMin: 0, idealMax: 3 },\n    female: { idealMin: -2, idealMax: 2 },\n    black_male: { idealMin: 0, idealMax: 4 },  // Accommodates natural forward projection\n    black_female: { idealMin: -1, idealMax: 3 },\n  },\n\n  nasofrontalAngle: {\n    // Higher brow ridge in males\n    male: { idealMin: 128, idealMax: 138 },\n    female: { idealMin: 132, idealMax: 142 },\n  },\n\n  chinToPhiltrumRatio: {\n    // Black/African: Fuller lips naturally shorten visible philtrum\n    // Extracted from FaceIQ BlackAfrican.htc - relaxes \"Short Philtrum\" penalty\n    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n    black_female: { idealMin: 2.10, idealMax: 2.65 },\n  },\n\n  // ==========================================\n  // SKIN QUALITY - Ethnicity variation\n  // ==========================================\n  skinUniformity: {\n    // South Asian: Stricter standards due to genetic hyperpigmentation tendency\n    // Hispanic: Similar to South Asian - penalizes hyperpigmentation more than White model\n    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n    white_male: { idealMin: 0.88, idealMax: 1.00 },\n    white_female: { idealMin: 0.90, idealMax: 1.00 },\n    south_asian_male: { idealMin: 0.90, idealMax: 1.00 },  // Stricter - hyperpigmentation common\n    south_asian_female: { idealMin: 0.92, idealMax: 1.00 },\n    east_asian_male: { idealMin: 0.92, idealMax: 1.00 },  // High skin quality standards\n    east_asian_female: { idealMin: 0.94, idealMax: 1.00 },\n    black_male: { idealMin: 0.85, idealMax: 1.00 },  // More tolerance for melanin variation\n    black_female: { idealMin: 0.87, idealMax: 1.00 },\n    hispanic_male: { idealMin: 0.85, idealMax: 1.00 },  // Bridge: more tolerance than South Asian, less than White\n    hispanic_female: { idealMin: 0.87, idealMax: 1.00 },\n  },\n\n  // ==========================================\n  // EYEBROW METRICS - Ethnicity variation\n  // ==========================================\n  eyebrowThickness: {\n    // Middle Eastern: Heavily favors thick, dense eyebrows (\"Dark Triad\" look with deep-set eyes)\n    // Extracted from FaceIQ Male:MiddleEastern.htc - STRICTEST eyebrow requirements\n    middle_eastern_male: { idealMin: 2.5, idealMax: 5.0 },  // Prefers significantly thicker/darker brows\n    middle_eastern_female: { idealMin: 2.0, idealMax: 4.0 },\n    east_asian_male: { idealMin: 1.5, idealMax: 3.0 },  // Typically less thick\n    east_asian_female: { idealMin: 1.3, idealMax: 2.5 },\n    male: { idealMin: 2.0, idealMax: 4.0 },\n    female: { idealMin: 1.8, idealMax: 3.5 },\n  },\n\n  eyebrowDistance: {\n    // Middle Eastern: \"Kill Switch\" for unibrow (synophrys)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    // While thick brows are favored, unibrow is a critical flaw if distance < 15mm\n    middle_eastern_male: { idealMin: 15, idealMax: 25 },  // Stricter minimum to avoid unibrow\n    middle_eastern_female: { idealMin: 18, idealMax: 28 },\n    male: { idealMin: 15, idealMax: 25 },\n    female: { idealMin: 16, idealMax: 26 },\n  },\n\n  orbitalVector: {\n    // Middle Eastern: Favors deep-set eyes (lower/negative orbital vector)\n    // Part of the \"Dark Triad\" look with heavy brows\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    middle_eastern_male: { idealMin: -2, idealMax: 3 },  // Allows more deep-set eyes\n    middle_eastern_female: { idealMin: -1, idealMax: 4 },\n    male: { idealMin: 0, idealMax: 4 },\n    female: { idealMin: 1, idealMax: 5 },\n  },\n};\n\n/**\n * Get metric configuration with demographic-specific overrides applied.\n * Lookup priority: ethnicity_gender > gender > ethnicity > default\n */\nexport function getMetricConfigForDemographics(\n  metricId: string,\n  gender: Gender,\n  ethnicity: Ethnicity = 'other'\n): MetricConfig | null {\n  const baseConfig = FACEIQ_METRICS[metricId];\n  if (!baseConfig) return null;\n\n  const overrides = DEMOGRAPHIC_OVERRIDES[metricId];\n  if (!overrides) return baseConfig;\n\n  // Try specific combo first (e.g., \"east_asian_male\")\n  const specificKey = `${ethnicity}_${gender}` as DemographicKey;\n  const override = overrides[specificKey] || overrides[gender] || overrides[ethnicity];\n\n  if (!override) return baseConfig;\n\n  return {\n    ...baseConfig,\n    idealMin: override.idealMin,\n    idealMax: override.idealMax,\n  };\n}\n\n// ============================================\n// FACEIQ MEASUREMENT CONFIGURATIONS (70+)\n// ============================================\n\nexport const FACEIQ_METRICS: Record<string, MetricConfig> = {\n  // ==========================================\n  // FRONT PROFILE - FACIAL PROPORTIONS (32)\n  // ==========================================\n\n  faceWidthToHeight: {\n    id: 'faceWidthToHeight',\n    name: 'Face Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.96,\n    idealMax: 2.0,\n    rangeMin: 1.4,\n    rangeMax: 2.5,\n    decayRate: 6.4,\n    maxScore: 30,  // FaceIQ: highest priority metric\n    weight: 0.06,\n    description: 'Ratio of bizygomatic width to upper face height',\n    profileType: 'front',\n  },\n\n  lowerThirdProportion: {\n    id: 'lowerThirdProportion',\n    name: 'Lower Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31,\n    idealMax: 33.5,\n    rangeMin: 24,\n    rangeMax: 40,\n    decayRate: 1.86,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by lower third (subnasale to menton)',\n    profileType: 'front',\n  },\n\n  middleThirdProportion: {\n    id: 'middleThirdProportion',\n    name: 'Middle Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31.4,\n    idealMax: 33.4,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by middle third',\n    profileType: 'front',\n  },\n\n  upperThirdProportion: {\n    id: 'upperThirdProportion',\n    name: 'Upper Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 30,\n    idealMax: 32,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Percentage of face occupied by upper third (trichion to glabella)',\n    profileType: 'front',\n  },\n\n  bitemporalWidth: {\n    id: 'bitemporalWidth',\n    name: 'Bitemporal Width',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 75,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Temple width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  cheekboneHeight: {\n    id: 'cheekboneHeight',\n    name: 'Cheekbone Height',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 83,\n    idealMax: 100,\n    rangeMin: 30,\n    rangeMax: 140,\n    decayRate: 0.5,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Vertical position of cheekbones relative to face height',\n    profileType: 'front',\n  },\n\n  totalFacialWidthToHeight: {\n    id: 'totalFacialWidthToHeight',\n    name: 'Total Facial Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.34,\n    idealMax: 1.37,\n    rangeMin: 1.0,\n    rangeMax: 1.7,\n    decayRate: 13.2,\n    maxScore: 25,  // Special: higher max score\n    weight: 0.05,\n    description: 'Total face height divided by cheek width',\n    profileType: 'front',\n    customCurve: {\n      mode: 'custom',\n      points: [\n        { x: 1.05, y: 0 },\n        { x: 1.17, y: 1.41 },\n        { x: 1.25, y: 3.86 },\n        { x: 1.29, y: 6.01 },\n        { x: 1.32, y: 8.88 },\n        { x: 1.34, y: 10, fixed: true },\n        { x: 1.37, y: 10, fixed: true },\n        { x: 1.39, y: 8.88 },\n        { x: 1.42, y: 6.01 },\n        { x: 1.46, y: 3.86 },\n        { x: 1.54, y: 1.41 },\n        { x: 1.66, y: 0 },\n      ],\n    },\n  },\n\n  midfaceRatio: {\n    id: 'midfaceRatio',\n    name: 'Midface Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 0.97,\n    idealMax: 1.0,\n    rangeMin: 0.5,\n    rangeMax: 1.5,\n    decayRate: 31.6,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.04,\n    description: 'Midface width to height ratio for facial balance',\n    profileType: 'front',\n  },\n\n  // JAW MEASUREMENTS\n  jawSlope: {\n    id: 'jawSlope',\n    name: 'Jaw Slope',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 140,\n    idealMax: 142.5,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of the jawline from gonion to chin',\n    profileType: 'front',\n  },\n\n  jawFrontalAngle: {\n    id: 'jawFrontalAngle',\n    name: 'Jaw Frontal Angle',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 35,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 20,  // FaceIQ: high priority\n    weight: 0.04,\n    description: 'Angle of jaw corners from frontal view',\n    profileType: 'front',\n  },\n\n  bigonialWidth: {\n    id: 'bigonialWidth',\n    name: 'Bigonial Width',\n    category: 'Jaw Shape',\n    unit: 'percent',\n    idealMin: 87.75,\n    idealMax: 91.75,\n    rangeMin: 60.25,\n    rangeMax: 120.25,\n    decayRate: 0.9,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Jaw width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  jawWidthRatio: {\n    id: 'jawWidthRatio',\n    name: 'Jaw Width to Face Width Ratio',\n    category: 'Jaw Shape',\n    unit: 'ratio',\n    idealMin: 0.75,\n    idealMax: 0.82,\n    rangeMin: 0.6,\n    rangeMax: 0.95,\n    decayRate: 25.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Bigonial width divided by bizygomatic width',\n    profileType: 'front',\n  },\n\n  // EYE MEASUREMENTS\n  lateralCanthalTilt: {\n    id: 'lateralCanthalTilt',\n    name: 'Lateral Canthal Tilt',\n    category: 'Eyes',\n    unit: 'degrees',\n    idealMin: 4.0,   // Updated: 4-8Â° is peak \"hunter eyes\"\n    idealMax: 8.0,\n    rangeMin: -5,\n    rangeMax: 20,\n    decayRate: 1.5,  // Reduced: gentler decay for positive tilts\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle of eye from inner to outer canthus. Positive tilt is attractive.',\n    profileType: 'front',\n    // DIRECTIONAL SCORING: Higher (positive) tilt is better\n    // - Ideal: 4-8Â° (attractive upswept eyes / \"hunter eyes\")\n    // - Good: 0-4Â° (neutral to slight positive - still attractive)\n    // - Weak: < 0Â° (negative/droopy tilt - only this is a true weakness)\n    polarity: 'higher_is_better',\n    safeFloor: 0.0,       // Neutral tilt - anything above is acceptable\n    softZoneScore: 8.0,   // \"Good\" score for 0-4Â° range\n  },\n\n  eyeAspectRatio: {\n    id: 'eyeAspectRatio',\n    name: 'Eye Aspect Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 3.0,\n    idealMax: 3.5,\n    rangeMin: 0.8,\n    rangeMax: 6,\n    decayRate: 2.0,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Eye width divided by eye height',\n    profileType: 'front',\n  },\n\n  eyeSeparationRatio: {\n    id: 'eyeSeparationRatio',\n    name: 'Eye Separation Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 45.7,\n    idealMax: 46.8,\n    rangeMin: 35,\n    rangeMax: 55,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Intercanthal distance as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryRatio: {\n    id: 'interpupillaryRatio',\n    name: 'Interpupillary Distance Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 44,\n    idealMax: 48,\n    rangeMin: 38,\n    rangeMax: 54,\n    decayRate: 1.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'IPD as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryMouthWidthRatio: {\n    id: 'interpupillaryMouthWidthRatio',\n    name: 'Interpupillary-Mouth Width Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.83,\n    idealMax: 0.87,\n    rangeMin: 0.6,\n    rangeMax: 1.1,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Mouth width divided by interpupillary distance',\n    profileType: 'front',\n  },\n\n  oneEyeApartTest: {\n    id: 'oneEyeApartTest',\n    name: 'One Eye Apart Test',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.95,\n    idealMax: 1.0,\n    rangeMin: 0.7,\n    rangeMax: 1.3,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Intercanthal distance should equal one eye width',\n    profileType: 'front',\n  },\n\n  tearTroughDepth: {\n    id: 'tearTroughDepth',\n    name: 'Tear Trough Depth',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.0,\n    idealMax: 1.5,\n    rangeMin: 0.0,\n    rangeMax: 4.0,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Under-eye hollow depth (infraorbital depression). Lower is better for youthfulness.',\n    profileType: 'front',\n    polarity: 'lower_is_better',\n    safeCeiling: 1.5,  // White standard\n    softZoneScore: 7.5,\n  },\n\n  upperEyelidExposure: {\n    id: 'upperEyelidExposure',\n    name: 'Upper Eyelid Exposure',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 2.5,\n    rangeMin: 0.0,\n    rangeMax: 5.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Visible upper eyelid platform. Too little creates hooded eyes.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  // EYEBROW MEASUREMENTS\n  eyebrowThickness: {\n    id: 'eyebrowThickness',\n    name: 'Eyebrow Thickness',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 2.0,\n    idealMax: 4.0,\n    rangeMin: 1.0,\n    rangeMax: 6.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow density and thickness. Higher values indicate fuller, denser brows.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  eyebrowDistance: {\n    id: 'eyebrowDistance',\n    name: 'Inter-Eyebrow Distance',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 15,\n    idealMax: 25,\n    rangeMin: 5,\n    rangeMax: 40,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance between inner edges of eyebrows. Too low creates unibrow (synophrys).',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  browLengthRatio: {\n    id: 'browLengthRatio',\n    name: 'Brow Length to Face Width Ratio',\n    category: 'Upper Third',\n    unit: 'percent',\n    idealMin: 28,\n    idealMax: 32,\n    rangeMin: 20,\n    rangeMax: 40,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow length as percentage of face width',\n    profileType: 'front',\n  },\n\n  eyebrowTilt: {\n    id: 'eyebrowTilt',\n    name: 'Eyebrow Tilt',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 6.5,\n    idealMax: 11,\n    rangeMin: -5,\n    rangeMax: 25,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of eyebrow from head to tail',\n    profileType: 'front',\n  },\n\n  eyebrowLowSetedness: {\n    id: 'eyebrowLowSetedness',\n    name: 'Eyebrow Low Setedness',\n    category: 'Upper Third',\n    unit: 'ratio',\n    idealMin: 0,\n    idealMax: 0.45,\n    rangeMin: -0.2,\n    rangeMax: 1.0,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from brow to eye relative to eye height',\n    profileType: 'front',\n  },\n\n  // NOSE MEASUREMENTS (FRONT)\n  nasalIndex: {\n    id: 'nasalIndex',\n    name: 'Nasal Index',\n    category: 'Nose',\n    unit: 'percent',\n    idealMin: 70,\n    idealMax: 85,\n    rangeMin: 55,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose width divided by nose height Ã— 100',\n    profileType: 'front',\n  },\n\n  intercanthalNasalRatio: {\n    id: 'intercanthalNasalRatio',\n    name: 'Intercanthal-Nasal Width Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 1.04,\n    idealMax: 1.16,\n    rangeMin: 0.7,\n    rangeMax: 1.5,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Alar width should roughly equal intercanthal distance',\n    profileType: 'front',\n  },\n\n  noseBridgeWidth: {\n    id: 'noseBridgeWidth',\n    name: 'Nose Bridge to Nose Width',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.6,\n    idealMax: 0.75,\n    rangeMin: 0.4,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ratio of nose bridge width to alar base width',\n    profileType: 'front',\n  },\n\n  noseTipPosition: {\n    id: 'noseTipPosition',\n    name: 'Nose Tip Position',\n    category: 'Nose',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 3.5,\n    rangeMin: -7.5,\n    rangeMax: 12.5,\n    decayRate: 1.5,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Nose tip deviation from facial midline',\n    profileType: 'front',\n  },\n\n  // MOUTH/LIP MEASUREMENTS\n  mouthWidthToNoseRatio: {\n    id: 'mouthWidthToNoseRatio',\n    name: 'Mouth Width to Nose Width Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.43,\n    idealMax: 1.51,\n    rangeMin: 0.96,\n    rangeMax: 1.91,\n    decayRate: 18.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Mouth width divided by nose width',\n    profileType: 'front',\n  },\n\n  lowerToUpperLipRatio: {\n    id: 'lowerToUpperLipRatio',\n    name: 'Lower Lip to Upper Lip Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.58,\n    idealMax: 1.88,\n    rangeMin: -0.98,\n    rangeMax: 4.03,\n    decayRate: 8.0,\n    maxScore: 7.5,  // FaceIQ: medium priority\n    weight: 0.02,\n    description: 'Lower lip height divided by upper lip height',\n    profileType: 'front',\n  },\n\n  cupidsBowDepth: {\n    id: 'cupidsBowDepth',\n    name: \"Cupid's Bow Depth\",\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2.3,\n    idealMax: 4,\n    rangeMin: 0,\n    rangeMax: 7,\n    decayRate: 2.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: \"Depth of the cupid's bow curve\",\n    profileType: 'front',\n  },\n\n  mouthCornerPosition: {\n    id: 'mouthCornerPosition',\n    name: 'Mouth Corner Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Mouth corner vertical position relative to lip center',\n    profileType: 'front',\n  },\n\n  // CHIN MEASUREMENTS (FRONT)\n  chinToPhiltrumRatio: {\n    id: 'chinToPhiltrumRatio',\n    name: 'Chin to Philtrum Ratio',\n    category: 'Chin',\n    unit: 'ratio',\n    idealMin: 2.15,\n    idealMax: 2.45,\n    rangeMin: 0.3,\n    rangeMax: 4.5,\n    decayRate: 10.0,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.02,\n    description: 'Chin height divided by philtrum length',\n    profileType: 'front',\n  },\n\n  // OTHER FRONT MEASUREMENTS\n  iaaJfaDeviation: {\n    id: 'iaaJfaDeviation',\n    name: 'Deviation of IAA & JFA',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 0,\n    idealMax: 2.5,\n    rangeMin: -25,\n    rangeMax: 30,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Deviation between Ipsilateral Alar Angle and Jaw Frontal Angle',\n    profileType: 'front',\n  },\n\n  ipsilateralAlarAngle: {\n    id: 'ipsilateralAlarAngle',\n    name: 'Ipsilateral Alar Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 60,\n    rangeMax: 125,\n    decayRate: 0.6,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Angle of alar base relative to facial plane',\n    profileType: 'front',\n  },\n\n  earProtrusionAngle: {\n    id: 'earProtrusionAngle',\n    name: 'Ear Protrusion Angle',\n    category: 'Ears',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 11.5,\n    rangeMin: -25,\n    rangeMax: 40,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of ear protrusion from head',\n    profileType: 'front',\n  },\n\n  earProtrusionRatio: {\n    id: 'earProtrusionRatio',\n    name: 'Ear Protrusion Ratio',\n    category: 'Ears',\n    unit: 'percent',\n    idealMin: 8,\n    idealMax: 12,\n    rangeMin: -20,\n    rangeMax: 40,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ear protrusion as percentage of head width',\n    profileType: 'front',\n  },\n\n  neckWidth: {\n    id: 'neckWidth',\n    name: 'Neck Width',\n    category: 'Neck',\n    unit: 'percent',\n    idealMin: 92,\n    idealMax: 98,\n    rangeMin: 60,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Neck width as percentage of jaw width',\n    profileType: 'front',\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS (38)\n  // ==========================================\n\n  gonialAngle: {\n    id: 'gonialAngle',\n    name: 'Gonial Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 130,\n    rangeMin: 105,\n    rangeMax: 145,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle at the jaw corner (gonion)',\n    profileType: 'side',\n  },\n\n  nasolabialAngle: {\n    id: 'nasolabialAngle',\n    name: 'Nasolabial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 90,\n    idealMax: 105,\n    rangeMin: 75,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle between columella and upper lip',\n    profileType: 'side',\n  },\n\n  nasofrontalAngle: {\n    id: 'nasofrontalAngle',\n    name: 'Nasofrontal Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 116,\n    idealMax: 128,\n    rangeMin: 90,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the bridge of nose (nasion)',\n    profileType: 'side',\n  },\n\n  nasofacialAngle: {\n    id: 'nasofacialAngle',\n    name: 'Nasofacial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 31,\n    idealMax: 35,\n    rangeMin: 15,\n    rangeMax: 50,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between nose and face plane',\n    profileType: 'side',\n  },\n\n  nasomentaAngle: {\n    id: 'nasomentaAngle',\n    name: 'Nasomental Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 126,\n    idealMax: 131,\n    rangeMin: 105,\n    rangeMax: 155,\n    decayRate: 0.7,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle from nasion to nose tip to chin',\n    profileType: 'side',\n  },\n\n  nasalTipAngle: {\n    id: 'nasalTipAngle',\n    name: 'Nasal Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 105,\n    rangeMin: 70,\n    rangeMax: 120,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the nose tip',\n    profileType: 'side',\n  },\n\n  nasalProjection: {\n    id: 'nasalProjection',\n    name: 'Nasal Projection',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.55,\n    idealMax: 0.6,\n    rangeMin: 0.4,\n    rangeMax: 0.75,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose projection relative to nasal length (Goode ratio)',\n    profileType: 'side',\n  },\n\n  nasalWToHRatio: {\n    id: 'nasalWToHRatio',\n    name: 'Nasal W to H Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.67,\n    idealMax: 0.78,\n    rangeMin: 0.5,\n    rangeMax: 0.95,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Nose width to height ratio from side view',\n    profileType: 'side',\n  },\n\n  noseTipRotationAngle: {\n    id: 'noseTipRotationAngle',\n    name: 'Nose Tip Rotation Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 95,\n    idealMax: 110,\n    rangeMin: 80,\n    rangeMax: 125,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of nose tip rotation',\n    profileType: 'side',\n  },\n\n  frankfortTipAngle: {\n    id: 'frankfortTipAngle',\n    name: 'Frankfort-Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 28,\n    idealMax: 34,\n    rangeMin: 20,\n    rangeMax: 42,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle between Frankfort plane and nose tip',\n    profileType: 'side',\n  },\n\n  mentolabialAngle: {\n    id: 'mentolabialAngle',\n    name: 'Mentolabial Angle',\n    category: 'Lips',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 140,\n    rangeMin: 100,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the labiomental fold',\n    profileType: 'side',\n  },\n\n  zAngle: {\n    id: 'zAngle',\n    name: 'Z Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 75,\n    idealMax: 85,\n    rangeMin: 60,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Merrifield Z-Angle for profile assessment',\n    profileType: 'side',\n  },\n\n  submentalCervicalAngle: {\n    id: 'submentalCervicalAngle',\n    name: 'Submental Cervical Angle',\n    category: 'Neck',\n    unit: 'degrees',\n    idealMin: 94,\n    idealMax: 106,\n    rangeMin: 70,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between chin and neck',\n    profileType: 'side',\n  },\n\n  facialConvexityGlabella: {\n    id: 'facialConvexityGlabella',\n    name: 'Facial Convexity (Glabella)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 165,\n    idealMax: 175,\n    rangeMin: 150,\n    rangeMax: 185,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Facial convexity angle using glabella',\n    profileType: 'side',\n  },\n\n  facialConvexityNasion: {\n    id: 'facialConvexityNasion',\n    name: 'Facial Convexity (Nasion)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 168,\n    idealMax: 178,\n    rangeMin: 155,\n    rangeMax: 190,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial convexity angle using nasion',\n    profileType: 'side',\n  },\n\n  totalFacialConvexity: {\n    id: 'totalFacialConvexity',\n    name: 'Total Facial Convexity',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 135,\n    idealMax: 145,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Complete facial profile convexity measurement',\n    profileType: 'side',\n  },\n\n  facialDepthToHeight: {\n    id: 'facialDepthToHeight',\n    name: 'Facial Depth to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.3,\n    idealMax: 1.44,\n    rangeMin: 0.7,\n    rangeMax: 1.8,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial depth divided by facial height',\n    profileType: 'side',\n  },\n\n  anteriorFacialDepth: {\n    id: 'anteriorFacialDepth',\n    name: 'Anterior Facial Depth',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 64.5,\n    idealMax: 67.5,\n    rangeMin: 45,\n    rangeMax: 95,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Anterior facial projection angle',\n    profileType: 'side',\n  },\n\n  interiorMidfaceProjectionAngle: {\n    id: 'interiorMidfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 50,\n    idealMax: 56,\n    rangeMin: 30,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Interior midface projection from side profile',\n    profileType: 'side',\n  },\n\n  recessionFromFrankfort: {\n    id: 'recessionFromFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'mm',\n    idealMin: 1.5,\n    idealMax: 15,\n    rangeMin: -30,\n    rangeMax: 30,\n    decayRate: 0.3,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin position relative to Frankfort plane',\n    profileType: 'side',\n  },\n\n  mandibularPlaneAngle: {\n    id: 'mandibularPlaneAngle',\n    name: 'Mandibular Plane Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 22,\n    idealMax: 28,\n    rangeMin: 15,\n    rangeMax: 38,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of mandibular plane to Frankfort plane',\n    profileType: 'side',\n  },\n\n  ramusToMandibleRatio: {\n    id: 'ramusToMandibleRatio',\n    name: 'Ramus to Mandible Ratio',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'ratio',\n    idealMin: 0.65,\n    idealMax: 0.75,\n    rangeMin: 0.5,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Ramus height divided by mandible length',\n    profileType: 'side',\n  },\n\n  gonionToMouthLine: {\n    id: 'gonionToMouthLine',\n    name: 'Gonion to Mouth Line',\n    category: 'Jaw Shape',\n    unit: 'mm',\n    idealMin: -5,\n    idealMax: 5,\n    rangeMin: -20,\n    rangeMax: 20,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from gonion to mouth level line',\n    profileType: 'side',\n  },\n\n  // E-LINE MEASUREMENTS\n  eLineUpperLip: {\n    id: 'eLineUpperLip',\n    name: 'Upper Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -4,\n    idealMax: -2,\n    rangeMin: -10,\n    rangeMax: 4,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Upper lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  eLineLowerLip: {\n    id: 'eLineLowerLip',\n    name: 'Lower Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 0,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Lower lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  // S-LINE MEASUREMENTS\n  sLineUpperLip: {\n    id: 'sLineUpperLip',\n    name: 'Upper Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 3,\n    rangeMin: -5,\n    rangeMax: 8,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  sLineLowerLip: {\n    id: 'sLineLowerLip',\n    name: 'Lower Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -0.4,\n    idealMax: 0.4,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  // BURSTONE LINE\n  burstoneUpperLip: {\n    id: 'burstoneUpperLip',\n    name: 'Upper Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2,\n    idealMax: 4,\n    rangeMin: -2,\n    rangeMax: 8,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  burstoneLowerLip: {\n    id: 'burstoneLowerLip',\n    name: 'Lower Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 1,\n    idealMax: 3,\n    rangeMin: -3,\n    rangeMax: 7,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  // H LINE\n  holdawayHLine: {\n    id: 'holdawayHLine',\n    name: 'Holdaway H Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Holdaway H-line soft tissue assessment',\n    profileType: 'side',\n  },\n\n  // CHIN MEASUREMENTS (SIDE)\n  chinProjection: {\n    id: 'chinProjection',\n    name: 'Chin Projection',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -3,\n    idealMax: 3,\n    rangeMin: -12,\n    rangeMax: 12,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin projection relative to ideal position',\n    profileType: 'side',\n  },\n\n  recessionRelativeToFrankfort: {\n    id: 'recessionRelativeToFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 2,\n    rangeMin: -10,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin recession relative to Frankfort horizontal',\n    profileType: 'side',\n  },\n\n  // FOREHEAD\n  browridgeInclinationAngle: {\n    id: 'browridgeInclinationAngle',\n    name: 'Browridge Inclination Angle',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 18,\n    rangeMin: 0,\n    rangeMax: 28,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the brow ridge from profile',\n    profileType: 'side',\n  },\n\n  upperForeheadSlope: {\n    id: 'upperForeheadSlope',\n    name: 'Upper Forehead Slope',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 5,\n    idealMax: 12,\n    rangeMin: 0,\n    rangeMax: 20,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Slope angle of the upper forehead',\n    profileType: 'side',\n  },\n\n  // MIDFACE PROJECTION\n  midfaceProjectionAngle: {\n    id: 'midfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 95,\n    rangeMin: 75,\n    rangeMax: 105,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of midface projection from profile',\n    profileType: 'side',\n  },\n\n  orbitalVector: {\n    id: 'orbitalVector',\n    name: 'Orbital Vector',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -6,\n    rangeMax: 10,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Relationship of globe to orbital rim',\n    profileType: 'side',\n  },\n\n  skinUniformity: {\n    id: 'skinUniformity',\n    name: 'Skin Uniformity',\n    category: 'Skin Quality',\n    unit: 'ratio',\n    idealMin: 0.90,\n    idealMax: 1.00,\n    rangeMin: 0.50,\n    rangeMax: 1.00,\n    decayRate: 5.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Skin tone evenness and hyperpigmentation. 1.0 = perfectly uniform.',\n    profileType: 'front',\n    polarity: 'higher_is_better',\n    safeFloor: 0.85,  // Acceptable uniformity threshold\n    softZoneScore: 7.5,\n  },\n\n};\n\n// ============================================\n// FLAW MAPPINGS (Extracted from FaceIQ)\n// ============================================\n\nexport interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n  reasoning: string;\n}\n\nexport const METRIC_FLAW_MAPPINGS: Record<string, FlawMapping[]> = {\n  anteriorFacialDepth: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Anterior Facial Depth measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  bitemporalWidth: [\n    { category: 'Upper Third', flawName: 'Narrow forehead', confidence: 'confirmed', reasoning: 'Reduced bitemporal width indicates a narrower than ideal forehead relative to the cheekbones. This disrupts facial harmony by creating a compressed hairline and forehead, altering the overall shape of the face.' },\n  ],\n  cheekboneHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Low-set cheekbones', confidence: 'confirmed', reasoning: 'Reduced cheekbone height indicates that the cheekbones are positioned lower than ideal. This disrupts facial harmony by creating an unpronounced appearance to the cheekbones and facial structure.' },\n  ],\n  eyeAspectRatio: [\n    { category: 'Eyes', flawName: 'Overly round eye shape', confidence: 'confirmed', reasoning: 'A reduced eye aspect ratio indicates overly narrow eyes relative to their height. This disrupts facial harmony by creating an overly surprised appearance and reducing angular definition.' },\n  ],\n  eyeSeparationRatio: [\n    { category: 'Eyes', flawName: 'Close-set eyes', confidence: 'confirmed', reasoning: 'Reduced eye separation indicates close-set eyes. This disrupts facial harmony by making the eye area appear too compressed.' },\n  ],\n  eyebrowLowSetedness: [\n    { category: 'Eyes', flawName: 'Medium-set eyebrows', confidence: 'confirmed', reasoning: 'Increased eyebrow low setedness indicates eyebrows that are positioned higher than ideal. This disrupts facial harmony by reducing the overall visual impact of the eyebrows and framing of the eyes.' },\n  ],\n  faceWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced face width to height ratio indicates an overly long midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  facialDepthToHeight: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'Reduced facial depth to height ratio indicates insufficient mid-face projection relative to height. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  gonialAngle: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  holdawayHLine: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'Decreased H-line indicates the lips are positioned too far in front of the line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  interiorMidfaceProjectionAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Interior Midface Projection Angle measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  ipsilateralAlarAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A decreased ipsilateral alar angle indicates an overly narrow interior midface. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  jawFrontalAngle: [\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A narrower jaw frontal angle indicates a steeper jawline or overly wide chin. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  jawSlope: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'The Jaw Slope measurement is above the ideal range. This disrupts facial harmony in the lower face.' },\n  ],\n  lateralCanthalTilt: [\n    { category: 'Eyes', flawName: 'Insufficient eye tilt', confidence: 'confirmed', reasoning: 'A decreased lateral canthal tilt indicates insufficiently upturned eyes. This disrupts facial harmony by creating a less alert and youthful appearance.' },\n  ],\n  burstoneLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the Burstone line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  eLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned too far in front of the E-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  sLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the S-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  lowerThirdProportion: [\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'The upper jaw is too long relative to lower jaw, possibly from a long upper jaw or short lower jaw, or a combination of both. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  mandibularPlaneAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Hyper-divergent jaw growth', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by elongating the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  midfaceRatio: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  nasofacialAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A smaller nasofacial angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  nasofrontalAngle: [\n    { category: 'Upper Third', flawName: 'Soft and weak brow ridge', confidence: 'confirmed', reasoning: 'An increased nasofrontal angle indicates reduced brow ridge prominence and angularity. This disrupts facial harmony by creating a less defined upper face.' },\n  ],\n  nasomentaAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A larger nasomental angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  noseBridgeWidth: [\n    { category: 'Nose', flawName: 'Overly narrow nose bridge', confidence: 'confirmed', reasoning: 'The Nose Bridge to Nose Width measurement is above the ideal range. This disrupts facial harmony by creating an unbalanced nasal profile.' },\n  ],\n  orbitalVector: [\n    { category: 'Eyes', flawName: 'Sunken orbital region', confidence: 'confirmed', reasoning: 'A decreased orbital vector indicates insufficient projection and volume underneath the eye. This disrupts facial harmony due to the lacking volume underneath the eyes, reducing vibrancy and youthfulness.' },\n  ],\n  ramusToMandibleRatio: [\n    { category: 'Jaw Shape', flawName: 'Short ramus', confidence: 'confirmed', reasoning: 'A reduced ramus-to-mandible ratio indicates a shorter than ideal vertical jawbone (ramus) when compared to the mandible. This disrupts facial harmony by reducing jaw height and definition.' },\n  ],\n  submentalCervicalAngle: [\n    { category: 'Neck', flawName: 'Round neck region', confidence: 'confirmed', reasoning: 'An increased submental cervical angle indicates a round neck region, possibly from excess submental fat or tissue. This disrupts facial harmony by reducing neck definition.' },\n  ],\n  totalFacialWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Overly long face shape', confidence: 'confirmed', reasoning: 'An increased total facial width to height ratio indicates an overly long face relative to its height. This disrupts facial harmony by creating a vertically stretched appearance to the face.' },\n  ],\n};\n\n// ============================================\n// CUSTOM BEZIER CURVES (Extracted from FaceIQ)\n// ============================================\n\nexport const METRIC_CUSTOM_CURVES: Record<string, CurvePoint[]> = {\n  faceWidthToHeight: [\n    { x: 1.49, y: 0, leftHandleX: 1.44, leftHandleY: 0, rightHandleX: 1.55, rightHandleY: 0 },\n    { x: 1.68, y: 1.05, leftHandleX: 1.62, leftHandleY: 0.36, rightHandleX: 1.71, rightHandleY: 1.58 },\n    { x: 1.77, y: 3.07, leftHandleX: 1.74, leftHandleY: 2.15, rightHandleX: 1.79, rightHandleY: 3.88 },\n    { x: 1.83, y: 5.83, leftHandleX: 1.80, leftHandleY: 4.64, rightHandleX: 1.84, rightHandleY: 6.85 },\n    { x: 1.89, y: 8.70, leftHandleX: 1.88, leftHandleY: 8.30, rightHandleX: 1.92, rightHandleY: 9.50 },\n    { x: 1.96, y: 10, leftHandleX: 1.96, leftHandleY: 10, rightHandleX: 1.96, rightHandleY: 10, fixed: true },\n    { x: 2.00, y: 10, leftHandleX: 2.00, leftHandleY: 10, rightHandleX: 2.00, rightHandleY: 10, fixed: true },\n    { x: 2.07, y: 8.70, leftHandleX: 2.04, leftHandleY: 9.50, rightHandleX: 2.08, rightHandleY: 8.30 },\n    { x: 2.13, y: 5.83, leftHandleX: 2.12, leftHandleY: 6.85, rightHandleX: 2.16, rightHandleY: 4.64 },\n    { x: 2.19, y: 3.07, leftHandleX: 2.17, leftHandleY: 3.88, rightHandleX: 2.22, rightHandleY: 2.15 },\n    { x: 2.28, y: 1.05, leftHandleX: 2.25, leftHandleY: 1.58, rightHandleX: 2.34, rightHandleY: 0.36 },\n    { x: 2.47, y: 0, leftHandleX: 2.41, leftHandleY: 0, rightHandleX: 2.52, rightHandleY: 0 },\n  ],\n  lowerThirdProportion: [\n    { x: 25.6, y: 0, leftHandleX: 24.8, leftHandleY: 0, rightHandleX: 26.4, rightHandleY: 0 },\n    { x: 28.01, y: 1.58, leftHandleX: 27.23, leftHandleY: 0.53, rightHandleX: 28.27, rightHandleY: 1.97 },\n    { x: 28.83, y: 3.21, leftHandleX: 28.60, leftHandleY: 2.60, rightHandleX: 29.10, rightHandleY: 3.90 },\n    { x: 29.63, y: 5.85, leftHandleX: 29.40, leftHandleY: 4.90, rightHandleX: 29.85, rightHandleY: 6.80 },\n    { x: 30.27, y: 8.56, leftHandleX: 30.05, leftHandleY: 7.80, rightHandleX: 30.50, rightHandleY: 9.30 },\n    { x: 31, y: 10, leftHandleX: 30.95, leftHandleY: 10, rightHandleX: 31.05, rightHandleY: 10, fixed: true },\n    { x: 33.5, y: 10, leftHandleX: 33.45, leftHandleY: 10, rightHandleX: 33.55, rightHandleY: 10, fixed: true },\n    { x: 34.23, y: 8.56, leftHandleX: 34.00, leftHandleY: 9.30, rightHandleX: 34.45, rightHandleY: 7.80 },\n    { x: 34.87, y: 5.85, leftHandleX: 34.65, leftHandleY: 6.80, rightHandleX: 35.10, rightHandleY: 4.90 },\n    { x: 35.67, y: 3.21, leftHandleX: 35.40, leftHandleY: 3.90, rightHandleX: 35.90, rightHandleY: 2.60 },\n    { x: 36.49, y: 1.58, leftHandleX: 36.23, leftHandleY: 1.97, rightHandleX: 37.27, rightHandleY: 0.53 },\n    { x: 38.9, y: 0, leftHandleX: 38.1, leftHandleY: 0, rightHandleX: 39.7, rightHandleY: 0 },\n  ],\n  lateralCanthalTilt: [\n    { x: -4.5, y: 0, leftHandleX: -5.5, leftHandleY: 0, rightHandleX: -3.5, rightHandleY: 0 },\n    { x: 0.5, y: 1.2, leftHandleX: -0.8, leftHandleY: 0.4, rightHandleX: 1.5, rightHandleY: 1.8 },\n    { x: 2.8, y: 3.5, leftHandleX: 2.2, leftHandleY: 2.5, rightHandleX: 3.4, rightHandleY: 4.3 },\n    { x: 4.5, y: 6.8, leftHandleX: 4.0, leftHandleY: 5.5, rightHandleX: 5.0, rightHandleY: 7.8 },\n    { x: 5.8, y: 9.2, leftHandleX: 5.4, leftHandleY: 8.5, rightHandleX: 5.95, rightHandleY: 9.7 },\n    { x: 6.1, y: 10, leftHandleX: 6.05, leftHandleY: 10, rightHandleX: 6.15, rightHandleY: 10, fixed: true },\n    { x: 7.8, y: 10, leftHandleX: 7.75, leftHandleY: 10, rightHandleX: 7.85, rightHandleY: 10, fixed: true },\n    { x: 8.1, y: 9.2, leftHandleX: 7.95, leftHandleY: 9.7, rightHandleX: 8.5, rightHandleY: 8.5 },\n    { x: 9.4, y: 6.8, leftHandleX: 8.9, leftHandleY: 7.8, rightHandleX: 9.9, rightHandleY: 5.5 },\n    { x: 11.1, y: 3.5, leftHandleX: 10.5, leftHandleY: 4.3, rightHandleX: 11.7, rightHandleY: 2.5 },\n    { x: 13.4, y: 1.2, leftHandleX: 12.4, leftHandleY: 1.8, rightHandleX: 14.7, rightHandleY: 0.4 },\n    { x: 18.4, y: 0, leftHandleX: 17.4, leftHandleY: 0, rightHandleX: 19.4, rightHandleY: 0 },\n  ],\n  gonialAngle: [\n    { x: 105, y: 0, leftHandleX: 102, leftHandleY: 0, rightHandleX: 108, rightHandleY: 0 },\n    { x: 112, y: 1.5, leftHandleX: 110, leftHandleY: 0.5, rightHandleX: 114, rightHandleY: 2.3 },\n    { x: 116, y: 4.2, leftHandleX: 114.5, leftHandleY: 3.0, rightHandleX: 117.5, rightHandleY: 5.2 },\n    { x: 118.5, y: 7.5, leftHandleX: 117.5, leftHandleY: 6.3, rightHandleX: 119.5, rightHandleY: 8.5 },\n    { x: 120, y: 10, leftHandleX: 119.7, leftHandleY: 10, rightHandleX: 120.3, rightHandleY: 10, fixed: true },\n    { x: 130, y: 10, leftHandleX: 129.7, leftHandleY: 10, rightHandleX: 130.3, rightHandleY: 10, fixed: true },\n    { x: 131.5, y: 7.5, leftHandleX: 130.5, leftHandleY: 8.5, rightHandleX: 132.5, rightHandleY: 6.3 },\n    { x: 134, y: 4.2, leftHandleX: 132.5, leftHandleY: 5.2, rightHandleX: 135.5, rightHandleY: 3.0 },\n    { x: 138, y: 1.5, leftHandleX: 136, leftHandleY: 2.3, rightHandleX: 140, rightHandleY: 0.5 },\n    { x: 145, y: 0, leftHandleX: 142, leftHandleY: 0, rightHandleX: 148, rightHandleY: 0 },\n  ],\n  nasolabialAngle: [\n    { x: 75, y: 0, leftHandleX: 72, leftHandleY: 0, rightHandleX: 78, rightHandleY: 0 },\n    { x: 82, y: 2.0, leftHandleX: 79.5, leftHandleY: 0.7, rightHandleX: 84, rightHandleY: 3.0 },\n    { x: 86, y: 5.5, leftHandleX: 84.5, leftHandleY: 4.2, rightHandleX: 87.5, rightHandleY: 6.8 },\n    { x: 89, y: 8.8, leftHandleX: 88, leftHandleY: 7.8, rightHandleX: 89.7, rightHandleY: 9.5 },\n    { x: 90, y: 10, leftHandleX: 89.8, leftHandleY: 10, rightHandleX: 90.2, rightHandleY: 10, fixed: true },\n    { x: 105, y: 10, leftHandleX: 104.8, leftHandleY: 10, rightHandleX: 105.2, rightHandleY: 10, fixed: true },\n    { x: 106, y: 8.8, leftHandleX: 105.3, leftHandleY: 9.5, rightHandleX: 107, rightHandleY: 7.8 },\n    { x: 109, y: 5.5, leftHandleX: 107.5, leftHandleY: 6.8, rightHandleX: 110.5, rightHandleY: 4.2 },\n    { x: 113, y: 2.0, leftHandleX: 111, leftHandleY: 3.0, rightHandleX: 115.5, rightHandleY: 0.7 },\n    { x: 120, y: 0, leftHandleX: 117, leftHandleY: 0, rightHandleX: 123, rightHandleY: 0 },\n  ],\n  // Middle Third Proportion curve (ideal: 31.4-33.4%)\n  middleThirdProportion: [\n    { x: 21.44, y: 0, leftHandleX: 20.29, leftHandleY: 0, rightHandleX: 23.19, rightHandleY: 0.15 },\n    { x: 25.5, y: 1.35, leftHandleX: 24.18, leftHandleY: 0.53, rightHandleX: 26.17, rightHandleY: 1.79 },\n    { x: 27.34, y: 3.18, leftHandleX: 26.84, leftHandleY: 2.42, rightHandleX: 27.73, rightHandleY: 3.81 },\n    { x: 28.65, y: 5.88, leftHandleX: 28.33, leftHandleY: 4.91, rightHandleX: 28.98, rightHandleY: 6.65 },\n    { x: 29.95, y: 8.55, leftHandleX: 29.41, leftHandleY: 7.58, rightHandleX: 30.45, rightHandleY: 9.35 },\n    { x: 31.4, y: 10, leftHandleX: 31.3, leftHandleY: 10, rightHandleX: 31.5, rightHandleY: 10, fixed: true },\n    { x: 33.4, y: 10, leftHandleX: 33.3, leftHandleY: 10, rightHandleX: 33.5, rightHandleY: 10, fixed: true },\n    { x: 34.85, y: 8.55, leftHandleX: 34.35, leftHandleY: 9.35, rightHandleX: 35.39, rightHandleY: 7.58 },\n    { x: 36.15, y: 5.88, leftHandleX: 35.82, leftHandleY: 6.65, rightHandleX: 36.47, rightHandleY: 4.91 },\n    { x: 37.46, y: 3.18, leftHandleX: 37.07, leftHandleY: 3.81, rightHandleX: 37.96, rightHandleY: 2.42 },\n    { x: 39.3, y: 1.35, leftHandleX: 38.63, leftHandleY: 1.79, rightHandleX: 40.62, rightHandleY: 0.53 },\n    { x: 43.36, y: 0, leftHandleX: 41.61, leftHandleY: 0.15, rightHandleX: 44.51, rightHandleY: 0 },\n  ],\n  // Upper Third Proportion curve (ideal: 30-32%)\n  upperThirdProportion: [\n    { x: 18.75, y: 0.02, leftHandleX: 17.15, leftHandleY: 0.02, rightHandleX: 20.35, rightHandleY: 0.02 },\n    { x: 23.82, y: 1.52, leftHandleX: 22.35, leftHandleY: 0.8, rightHandleX: 24.73, rightHandleY: 2.06 },\n    { x: 26.05, y: 4.06, leftHandleX: 25.48, leftHandleY: 2.86, rightHandleX: 26.41, rightHandleY: 4.99 },\n    { x: 27.19, y: 6.79, leftHandleX: 26.96, leftHandleY: 6.16, rightHandleX: 27.66, rightHandleY: 7.85 },\n    { x: 28.54, y: 9.08, leftHandleX: 28.02, leftHandleY: 8.5, rightHandleX: 28.93, rightHandleY: 9.54 },\n    { x: 30, y: 10, leftHandleX: 29.9, leftHandleY: 10, rightHandleX: 30.1, rightHandleY: 10, fixed: true },\n    { x: 32, y: 10, leftHandleX: 31.9, leftHandleY: 10, rightHandleX: 32.1, rightHandleY: 10, fixed: true },\n    { x: 33.46, y: 9.08, leftHandleX: 33.07, leftHandleY: 9.54, rightHandleX: 33.98, rightHandleY: 8.5 },\n    { x: 34.81, y: 6.79, leftHandleX: 34.34, leftHandleY: 7.85, rightHandleX: 35.04, rightHandleY: 6.16 },\n    { x: 35.95, y: 4.06, leftHandleX: 35.59, leftHandleY: 4.99, rightHandleX: 36.52, rightHandleY: 2.86 },\n    { x: 38.18, y: 1.52, leftHandleX: 37.27, leftHandleY: 2.06, rightHandleX: 39.65, rightHandleY: 0.8 },\n    { x: 43.25, y: 0.02, leftHandleX: 41.65, leftHandleY: 0.02, rightHandleX: 44.85, rightHandleY: 0.02 },\n  ],\n  // Eye Separation Ratio curve (ideal: 45.7-46.8%)\n  eyeSeparationRatio: [\n    { x: 36.54, y: 0, leftHandleX: 35.44, leftHandleY: 0, rightHandleX: 37.40, rightHandleY: 0.04 },\n    { x: 39.04, y: 0.63, leftHandleX: 38.16, leftHandleY: 0.21, rightHandleX: 39.77, rightHandleY: 1.05 },\n    { x: 41.08, y: 2.17, leftHandleX: 40.57, leftHandleY: 1.71, rightHandleX: 41.62, rightHandleY: 2.76 },\n    { x: 42.71, y: 4.74, leftHandleX: 42.26, leftHandleY: 3.81, rightHandleX: 43.08, rightHandleY: 5.52 },\n    { x: 43.94, y: 7.37, leftHandleX: 43.65, leftHandleY: 6.79, rightHandleX: 44.17, rightHandleY: 7.77 },\n    { x: 44.86, y: 9.02, leftHandleX: 44.54, leftHandleY: 8.56, rightHandleX: 45.08, rightHandleY: 9.5 },\n    { x: 45.7, y: 10, leftHandleX: 45.65, leftHandleY: 10, rightHandleX: 45.76, rightHandleY: 10, fixed: true },\n    { x: 46.8, y: 10, leftHandleX: 46.75, leftHandleY: 10, rightHandleX: 46.86, rightHandleY: 10, fixed: true },\n    { x: 47.64, y: 9.02, leftHandleX: 47.42, leftHandleY: 9.5, rightHandleX: 47.96, rightHandleY: 8.56 },\n    { x: 48.56, y: 7.37, leftHandleX: 48.33, leftHandleY: 7.77, rightHandleX: 48.85, rightHandleY: 6.79 },\n    { x: 49.79, y: 4.74, leftHandleX: 49.42, leftHandleY: 5.52, rightHandleX: 50.24, rightHandleY: 3.81 },\n    { x: 51.42, y: 2.17, leftHandleX: 50.88, leftHandleY: 2.76, rightHandleX: 51.93, rightHandleY: 1.71 },\n    { x: 53.46, y: 0.63, leftHandleX: 52.73, leftHandleY: 1.05, rightHandleX: 54.34, rightHandleY: 0.21 },\n    { x: 55.96, y: 0, leftHandleX: 55.10, leftHandleY: 0.04, rightHandleX: 57.06, rightHandleY: 0 },\n  ],\n  // Eyebrow Low Setedness curve (ideal: 0-0.45)\n  eyebrowLowSetedness: [\n    { x: -2.78, y: 0, leftHandleX: -3.11, leftHandleY: 0, rightHandleX: -2.67, rightHandleY: 0 },\n    { x: -1.94, y: 0.4, leftHandleX: -2.08, leftHandleY: 0.11, rightHandleX: -1.81, rightHandleY: 0.57 },\n    { x: -1.18, y: 2.25, leftHandleX: -1.36, leftHandleY: 1.5, rightHandleX: -1.05, rightHandleY: 2.72 },\n    { x: -0.79, y: 4.06, leftHandleX: -0.88, leftHandleY: 3.43, rightHandleX: -0.68, rightHandleY: 4.84 },\n    { x: -0.55, y: 6.21, leftHandleX: -0.58, leftHandleY: 5.55, rightHandleX: -0.47, rightHandleY: 6.92 },\n    { x: -0.28, y: 8.76, leftHandleX: -0.37, leftHandleY: 8.23, rightHandleX: -0.23, rightHandleY: 9.22 },\n    { x: 0, y: 10, leftHandleX: -0.02, leftHandleY: 10, rightHandleX: 0.02, rightHandleY: 10, fixed: true },\n    { x: 0.45, y: 10, leftHandleX: 0.43, leftHandleY: 10, rightHandleX: 0.47, rightHandleY: 10, fixed: true },\n    { x: 0.73, y: 8.76, leftHandleX: 0.68, leftHandleY: 9.22, rightHandleX: 0.82, rightHandleY: 8.23 },\n    { x: 1, y: 6.21, leftHandleX: 0.92, leftHandleY: 6.92, rightHandleX: 1.03, rightHandleY: 5.55 },\n    { x: 1.24, y: 4.06, leftHandleX: 1.13, leftHandleY: 4.84, rightHandleX: 1.33, rightHandleY: 3.43 },\n    { x: 1.63, y: 2.25, leftHandleX: 1.50, leftHandleY: 2.72, rightHandleX: 1.81, rightHandleY: 1.5 },\n    { x: 2.39, y: 0.4, leftHandleX: 2.26, leftHandleY: 0.57, rightHandleX: 2.53, rightHandleY: 0.11 },\n    { x: 3.23, y: 0, leftHandleX: 3.12, leftHandleY: 0, rightHandleX: 3.56, rightHandleY: 0 },\n  ],\n  // Submental Cervical Angle curve (ideal: 94-106Â°)\n  submentalCervicalAngle: [\n    { x: 50.48, y: 0, leftHandleX: 44.48, leftHandleY: 0, rightHandleX: 56.48, rightHandleY: 0 },\n    { x: 68.31, y: 1.31, leftHandleX: 62.07, leftHandleY: 0.32, rightHandleX: 72.89, rightHandleY: 2.13 },\n    { x: 77.76, y: 3.71, leftHandleX: 76.00, leftHandleY: 2.89, rightHandleX: 80.39, rightHandleY: 4.59 },\n    { x: 83.99, y: 6.53, leftHandleX: 82.63, leftHandleY: 5.85, rightHandleX: 85.16, rightHandleY: 7.12 },\n    { x: 88.28, y: 8.86, leftHandleX: 86.43, leftHandleY: 7.85, rightHandleX: 89.95, rightHandleY: 9.71 },\n    { x: 94, y: 10, leftHandleX: 93.4, leftHandleY: 10, rightHandleX: 94.6, rightHandleY: 10, fixed: true },\n    { x: 106, y: 10, leftHandleX: 105.4, leftHandleY: 10, rightHandleX: 106.6, rightHandleY: 10, fixed: true },\n    { x: 111.72, y: 8.86, leftHandleX: 110.05, leftHandleY: 9.71, rightHandleX: 113.57, rightHandleY: 7.85 },\n    { x: 116.01, y: 6.53, leftHandleX: 114.84, leftHandleY: 7.12, rightHandleX: 117.37, rightHandleY: 5.85 },\n    { x: 122.24, y: 3.71, leftHandleX: 119.61, leftHandleY: 4.59, rightHandleX: 124.00, rightHandleY: 2.89 },\n    { x: 131.69, y: 1.31, leftHandleX: 127.11, leftHandleY: 2.13, rightHandleX: 137.93, rightHandleY: 0.32 },\n    { x: 149.52, y: 0, leftHandleX: 143.52, leftHandleY: 0, rightHandleX: 155.52, rightHandleY: 0 },\n  ],\n  // Facial Convexity (Glabella) curve (ideal: 169-174Â°)\n  facialConvexityGlabella: [\n    { x: 149.21, y: 0, leftHandleX: 146.21, leftHandleY: 0, rightHandleX: 152.21, rightHandleY: 0 },\n    { x: 158.07, y: 1.41, leftHandleX: 156.03, leftHandleY: 0.74, rightHandleX: 159.63, rightHandleY: 2 },\n    { x: 162.12, y: 4.09, leftHandleX: 161.34, leftHandleY: 3.31, rightHandleX: 163.09, rightHandleY: 5.03 },\n    { x: 165.14, y: 7.76, leftHandleX: 164.46, leftHandleY: 6.56, rightHandleX: 165.54, rightHandleY: 8.29 },\n    { x: 166.65, y: 9.14, leftHandleX: 165.92, leftHandleY: 8.72, rightHandleX: 167.43, rightHandleY: 9.67 },\n    { x: 169, y: 10, leftHandleX: 168.75, leftHandleY: 10, rightHandleX: 169.25, rightHandleY: 10, fixed: true },\n    { x: 174, y: 10, leftHandleX: 173.75, leftHandleY: 10, rightHandleX: 174.25, rightHandleY: 10, fixed: true },\n    { x: 176.35, y: 9.14, leftHandleX: 175.57, leftHandleY: 9.67, rightHandleX: 177.08, rightHandleY: 8.72 },\n    { x: 177.86, y: 7.76, leftHandleX: 177.46, leftHandleY: 8.29, rightHandleX: 178.54, rightHandleY: 6.56 },\n    { x: 180.88, y: 4.09, leftHandleX: 179.91, leftHandleY: 5.03, rightHandleX: 181.66, rightHandleY: 3.31 },\n    { x: 184.93, y: 1.41, leftHandleX: 183.37, leftHandleY: 2, rightHandleX: 186.97, rightHandleY: 0.74 },\n    { x: 193.79, y: 0, leftHandleX: 190.79, leftHandleY: 0, rightHandleX: 196.79, rightHandleY: 0 },\n  ],\n};\n\n// ============================================\n// CATEGORY DEFINITIONS\n// ============================================\n\nexport const MEASUREMENT_CATEGORIES = {\n  'Midface/Face Shape': { color: '#67e8f9', weight: 0.20 },\n  'Occlusion/Jaw Growth': { color: '#a78bfa', weight: 0.15 },\n  'Jaw Shape': { color: '#f97316', weight: 0.13 },\n  'Upper Third': { color: '#84cc16', weight: 0.08 },\n  'Eyes': { color: '#06b6d4', weight: 0.12 },\n  'Nose': { color: '#fbbf24', weight: 0.10 },\n  'Lips': { color: '#ec4899', weight: 0.10 },\n  'Chin': { color: '#ef4444', weight: 0.06 },\n  'Neck': { color: '#14b8a6', weight: 0.03 },\n  'Other': { color: '#6b7280', weight: 0.03 },\n};\n\n// ============================================\n// CORE SCORING FUNCTIONS\n// ============================================\n\n/**\n * FaceIQ Exponential Decay Scoring Algorithm with Directional/Dimorphic Support\n *\n * Standard: score = maxScore Ã— e^(-decayRate Ã— deviation)\n *\n * Directional scoring (polarity):\n * - 'higher_is_better': Values above safeFloor but below ideal get softZoneScore\n *   Example: Canthal Tilt of 3Â° is still positive/good, just not peak ideal (6-8Â°)\n * - 'lower_is_better': Values below safeCeiling but above ideal get softZoneScore\n *   Example: Short philtrum is still attractive even if shorter than \"ideal\"\n */\nexport function calculateFaceIQScore(\n  value: number,\n  config: MetricConfig\n): number {\n  const {\n    idealMin,\n    idealMax,\n    decayRate,\n    maxScore,\n    customCurve,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n    softZoneScore = 8.0, // Default \"Good\" score for acceptable-but-not-ideal values\n  } = config;\n\n  // Use custom curve if available\n  if (customCurve && customCurve.mode === 'custom') {\n    return interpolateCustomCurve(value, customCurve.points, maxScore);\n  }\n\n  // Perfect score within ideal range\n  if (value >= idealMin && value <= idealMax) {\n    return maxScore;\n  }\n\n  // Handle directional/dimorphic scoring\n  if (polarity === 'higher_is_better' && safeFloor !== undefined) {\n    // Higher values are good. Only values below safeFloor are true weaknesses.\n    if (value >= safeFloor && value < idealMin) {\n      // Value is in the \"acceptable but not ideal\" zone\n      // Give a passing score that decreases linearly as we approach the floor\n      const zoneRange = idealMin - safeFloor;\n      const distanceFromIdeal = idealMin - value;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMin â†’ maxScore, safeFloor â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value >= idealMax) {\n      // Values above ideal are still excellent for 'higher_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = value - idealMax;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Below safeFloor - apply normal (or harsher) exponential decay\n    if (value < safeFloor) {\n      const deviation = safeFloor - value;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  if (polarity === 'lower_is_better' && safeCeiling !== undefined) {\n    // Lower values are good. Only values above safeCeiling are true weaknesses.\n    if (value <= safeCeiling && value > idealMax) {\n      // Value is in the \"acceptable but not ideal\" zone\n      const zoneRange = safeCeiling - idealMax;\n      const distanceFromIdeal = value - idealMax;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMax â†’ maxScore, safeCeiling â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value <= idealMin) {\n      // Values below ideal are still excellent for 'lower_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = idealMin - value;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Above safeCeiling - apply normal exponential decay\n    if (value > safeCeiling) {\n      const deviation = value - safeCeiling;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  // Default balanced scoring: deviation in either direction is equally bad\n  const deviation = value < idealMin\n    ? idealMin - value\n    : value - idealMax;\n\n  // Exponential decay\n  const score = maxScore * Math.exp(-decayRate * deviation);\n\n  return Math.max(0, Math.min(maxScore, score));\n}\n\n/**\n * Check if a metric value is in an \"acceptable\" zone (not a true weakness).\n * Used by InsightsEngine to prevent false positives.\n */\nexport function isValueAcceptable(\n  value: number,\n  config: MetricConfig\n): { acceptable: boolean; reason: string } {\n  const {\n    idealMin,\n    idealMax,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n  } = config;\n\n  // Within ideal range is always acceptable\n  if (value >= idealMin && value <= idealMax) {\n    return { acceptable: true, reason: 'within_ideal' };\n  }\n\n  // Check directional acceptability\n  if (polarity === 'higher_is_better') {\n    if (value >= idealMax) {\n      return { acceptable: true, reason: 'above_ideal_higher_is_better' };\n    }\n    if (safeFloor !== undefined && value >= safeFloor) {\n      return { acceptable: true, reason: 'above_safe_floor' };\n    }\n    // Below safe floor - true weakness\n    return { acceptable: false, reason: 'below_safe_floor' };\n  }\n\n  if (polarity === 'lower_is_better') {\n    if (value <= idealMin) {\n      return { acceptable: true, reason: 'below_ideal_lower_is_better' };\n    }\n    if (safeCeiling !== undefined && value <= safeCeiling) {\n      return { acceptable: true, reason: 'below_safe_ceiling' };\n    }\n    // Above safe ceiling - true weakness\n    return { acceptable: false, reason: 'above_safe_ceiling' };\n  }\n\n  // Balanced polarity - outside ideal is not acceptable\n  return { acceptable: false, reason: 'outside_ideal_balanced' };\n}\n\n/**\n * Interpolate custom Bezier curve for scoring\n * Uses cubic Bezier interpolation with control handles for smooth curves\n */\nfunction interpolateCustomCurve(\n  value: number,\n  points: CurvePoint[],\n  maxScore: number\n): number {\n  void maxScore; // Reserved for future custom curve implementations\n  if (points.length === 0) return 0;\n\n  // Sort points by x value\n  const sortedPoints = [...points].sort((a, b) => a.x - b.x);\n\n  // Clamp to range\n  if (value <= sortedPoints[0].x) return sortedPoints[0].y;\n  if (value >= sortedPoints[sortedPoints.length - 1].x) {\n    return sortedPoints[sortedPoints.length - 1].y;\n  }\n\n  // Find bracketing points\n  let lowerIndex = 0;\n  for (let i = 0; i < sortedPoints.length - 1; i++) {\n    if (value >= sortedPoints[i].x && value <= sortedPoints[i + 1].x) {\n      lowerIndex = i;\n      break;\n    }\n  }\n\n  const p0 = sortedPoints[lowerIndex];\n  const p3 = sortedPoints[lowerIndex + 1];\n\n  // Check if we have Bezier control handles\n  const hasHandles = p0.rightHandleX !== undefined && p3.leftHandleX !== undefined;\n\n  if (hasHandles) {\n    // Cubic Bezier interpolation with control points\n    const p1x = p0.rightHandleX!;\n    const p1y = p0.rightHandleY ?? p0.y;\n    const p2x = p3.leftHandleX!;\n    const p2y = p3.leftHandleY ?? p3.y;\n\n    // Find t parameter for given x value using Newton-Raphson iteration\n    let t = (value - p0.x) / (p3.x - p0.x); // Initial guess\n\n    // Newton-Raphson iterations to find t where B_x(t) = value\n    for (let iter = 0; iter < 10; iter++) {\n      const bx = cubicBezier(p0.x, p1x, p2x, p3.x, t);\n      const bxDerivative = cubicBezierDerivative(p0.x, p1x, p2x, p3.x, t);\n\n      if (Math.abs(bxDerivative) < 1e-10) break;\n\n      const newT = t - (bx - value) / bxDerivative;\n      if (Math.abs(newT - t) < 1e-10) break;\n      t = Math.max(0, Math.min(1, newT));\n    }\n\n    // Calculate y using the found t parameter\n    return cubicBezier(p0.y, p1y, p2y, p3.y, t);\n  } else {\n    // Smooth interpolation using Catmull-Rom spline\n    // This provides smoother curves than linear interpolation\n    const t = (value - p0.x) / (p3.x - p0.x);\n\n    // Get neighboring points for spline calculation\n    const pMinus1 = lowerIndex > 0 ? sortedPoints[lowerIndex - 1] : p0;\n    const p4 = lowerIndex + 2 < sortedPoints.length ? sortedPoints[lowerIndex + 2] : p3;\n\n    // Catmull-Rom spline interpolation\n    return catmullRomSpline(pMinus1.y, p0.y, p3.y, p4.y, t);\n  }\n}\n\n/**\n * Cubic Bezier curve evaluation: B(t) = (1-t)Â³P0 + 3(1-t)Â²tP1 + 3(1-t)tÂ²P2 + tÂ³P3\n */\nfunction cubicBezier(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  const mt2 = mt * mt;\n  const mt3 = mt2 * mt;\n  const t2 = t * t;\n  const t3 = t2 * t;\n  return mt3 * p0 + 3 * mt2 * t * p1 + 3 * mt * t2 * p2 + t3 * p3;\n}\n\n/**\n * Cubic Bezier derivative: B'(t) = 3(1-t)Â²(P1-P0) + 6(1-t)t(P2-P1) + 3tÂ²(P3-P2)\n */\nfunction cubicBezierDerivative(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  return 3 * mt * mt * (p1 - p0) + 6 * mt * t * (p2 - p1) + 3 * t * t * (p3 - p2);\n}\n\n/**\n * Catmull-Rom spline interpolation for smooth curves without explicit handles\n */\nfunction catmullRomSpline(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const t2 = t * t;\n  const t3 = t2 * t;\n\n  // Catmull-Rom coefficients with tension = 0.5\n  const a = -0.5 * p0 + 1.5 * p1 - 1.5 * p2 + 0.5 * p3;\n  const b = p0 - 2.5 * p1 + 2 * p2 - 0.5 * p3;\n  const c = -0.5 * p0 + 0.5 * p2;\n  const d = p1;\n\n  return a * t3 + b * t2 + c * t + d;\n}\n\n/**\n * Calculate standardized score (0-10 normalized)\n */\nexport function standardizeScore(score: number, maxScore: number): number {\n  return (score / maxScore) * 10;\n}\n\n/**\n * Determine quality tier based on score\n */\nexport function getQualityTier(score: number, maxScore: number = 10): QualityTier {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 90) return 'ideal';\n  if (normalized >= 70) return 'excellent';\n  if (normalized >= 50) return 'good';\n  return 'below_average';\n}\n\n/**\n * Determine severity level based on score\n */\nexport function getSeverityLevel(score: number, maxScore: number = 10): SeverityLevel {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 85) return 'optimal';\n  if (normalized >= 70) return 'minor';\n  if (normalized >= 50) return 'moderate';\n  if (normalized >= 30) return 'major';\n  if (normalized >= 15) return 'severe';\n  return 'extremely_severe';\n}\n\n/**\n * Calculate deviation description\n */\nexport function getDeviationDescription(\n  value: number,\n  idealMin: number,\n  idealMax: number,\n  unit: MeasurementUnit\n): { deviation: number; direction: 'above' | 'below' | 'within'; description: string } {\n  if (value >= idealMin && value <= idealMax) {\n    return { deviation: 0, direction: 'within', description: 'within ideal range' };\n  }\n\n  const unitLabel = getUnitLabel(unit);\n\n  if (value < idealMin) {\n    const dev = idealMin - value;\n    return {\n      deviation: dev,\n      direction: 'below',\n      description: `${dev.toFixed(2)}${unitLabel} below ideal`,\n    };\n  }\n\n  const dev = value - idealMax;\n  return {\n    deviation: dev,\n    direction: 'above',\n    description: `${dev.toFixed(2)}${unitLabel} above ideal`,\n  };\n}\n\nfunction getUnitLabel(unit: MeasurementUnit): string {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return 'Â°';\n    case 'mm': return 'mm';\n    default: return '';\n  }\n}\n\n// ============================================\n// MEASUREMENT CALCULATION UTILITIES\n// ============================================\n\n/**\n * Calculate distance between two points\n */\nexport function distance(p1: Point, p2: Point): number {\n  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n}\n\n/**\n * Calculate angle at vertex point (in degrees)\n */\nexport function calculateAngle(p1: Point, vertex: Point, p2: Point): number {\n  const v1 = { x: p1.x - vertex.x, y: p1.y - vertex.y };\n  const v2 = { x: p2.x - vertex.x, y: p2.y - vertex.y };\n\n  const dot = v1.x * v2.x + v1.y * v2.y;\n  const cross = v1.x * v2.y - v1.y * v2.x;\n\n  const angle = Math.atan2(cross, dot) * (180 / Math.PI);\n  return Math.abs(angle);\n}\n\n/**\n * Calculate perpendicular distance from point to line (signed)\n */\nexport function perpendicularDistance(\n  point: Point,\n  lineStart: Point,\n  lineEnd: Point\n): number {\n  const A = point.x - lineStart.x;\n  const B = point.y - lineStart.y;\n  const C = lineEnd.x - lineStart.x;\n  const D = lineEnd.y - lineStart.y;\n\n  const dot = A * C + B * D;\n  const lenSq = C * C + D * D;\n  const param = lenSq !== 0 ? dot / lenSq : -1;\n\n  let xx: number, yy: number;\n\n  if (param < 0) {\n    xx = lineStart.x;\n    yy = lineStart.y;\n  } else if (param > 1) {\n    xx = lineEnd.x;\n    yy = lineEnd.y;\n  } else {\n    xx = lineStart.x + param * C;\n    yy = lineStart.y + param * D;\n  }\n\n  const dx = point.x - xx;\n  const dy = point.y - yy;\n\n  const sign =\n    (lineEnd.y - lineStart.y) * point.x -\n      (lineEnd.x - lineStart.x) * point.y +\n      lineEnd.x * lineStart.y -\n      lineEnd.y * lineStart.x >=\n    0\n      ? 1\n      : -1;\n\n  return sign * Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Helper to get landmark by ID\n */\nfunction getLandmark(landmarks: LandmarkPoint[], id: string): Point | null {\n  const lm = landmarks.find((l) => l.id === id);\n  return lm ? { x: lm.x, y: lm.y } : null;\n}\n\n// ============================================\n// SCORE A SINGLE MEASUREMENT\n// ============================================\n\nexport interface DemographicOptions {\n  gender?: Gender;\n  ethnicity?: Ethnicity;\n}\n\n/**\n * Calculate complete score result for a measurement.\n * If demographics provided, uses demographic-specific ideal ranges.\n */\nexport function scoreMeasurement(\n  metricId: string,\n  value: number,\n  demographics?: DemographicOptions\n): FaceIQScoreResult | null {\n  // Get config with demographic overrides if provided\n  const config = demographics?.gender\n    ? getMetricConfigForDemographics(metricId, demographics.gender, demographics.ethnicity || 'other')\n    : FACEIQ_METRICS[metricId];\n\n  if (!config) return null;\n\n  const score = calculateFaceIQScore(value, config);\n  const standardizedScore = standardizeScore(score, config.maxScore);\n  const qualityTier = getQualityTier(score, config.maxScore);\n  const severity = getSeverityLevel(score, config.maxScore);\n  const { deviation, direction } = getDeviationDescription(\n    value,\n    config.idealMin,\n    config.idealMax,\n    config.unit\n  );\n\n  return {\n    metricId,\n    name: config.name,\n    value,\n    score,\n    standardizedScore,\n    qualityTier,\n    severity,\n    idealMin: config.idealMin,\n    idealMax: config.idealMax,\n    deviation,\n    deviationDirection: direction,\n    unit: config.unit,\n    category: config.category,\n  };\n}\n\n// ============================================\n// FRONT PROFILE ANALYSIS\n// ============================================\n\nexport interface FrontProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all front profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeFrontProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): FrontProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  // Helper to add measurement if landmarks available\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const trichion = getLandmark(landmarks, 'trichion');\n  const nasalBase = getLandmark(landmarks, 'nasal_base');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const menton = getLandmark(landmarks, 'menton');\n  const leftZygion = getLandmark(landmarks, 'left_zygion');\n  const rightZygion = getLandmark(landmarks, 'right_zygion');\n  const leftGonion = getLandmark(landmarks, 'left_gonion_inferior');\n  const rightGonion = getLandmark(landmarks, 'right_gonion_inferior');\n  const leftPupil = getLandmark(landmarks, 'left_pupila');\n  const rightPupil = getLandmark(landmarks, 'right_pupila');\n  const leftCanthusM = getLandmark(landmarks, 'left_canthus_medialis');\n  const leftCanthusL = getLandmark(landmarks, 'left_canthus_lateralis');\n  const rightCanthusM = getLandmark(landmarks, 'right_canthus_medialis');\n  const rightCanthusL = getLandmark(landmarks, 'right_canthus_lateralis');\n  void rightCanthusL; // Will be used for asymmetry measurements\n  const leftAlaNasi = getLandmark(landmarks, 'left_ala_nasi');\n  const rightAlaNasi = getLandmark(landmarks, 'right_ala_nasi');\n  const leftCheilion = getLandmark(landmarks, 'left_cheilion');\n  const rightCheilion = getLandmark(landmarks, 'right_cheilion');\n  const labraleSuperius = getLandmark(landmarks, 'labrale_superius');\n  const labraleInferius = getLandmark(landmarks, 'labrale_inferius');\n\n  // FACIAL THIRDS\n  if (trichion && nasalBase && subnasale && menton) {\n    const totalHeight = distance(trichion, menton);\n    if (totalHeight > 0) {\n      const upperThird = (distance(trichion, nasalBase) / totalHeight) * 100;\n      const middleThird = (distance(nasalBase, subnasale) / totalHeight) * 100;\n      const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n\n      addMeasurement('upperThirdProportion', upperThird);\n      addMeasurement('middleThirdProportion', middleThird);\n      addMeasurement('lowerThirdProportion', lowerThird);\n    }\n  }\n\n  // FACE WIDTH TO HEIGHT RATIO (FWHR)\n  if (leftZygion && rightZygion && nasalBase && labraleSuperius) {\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    const upperFaceHeight = distance(nasalBase, labraleSuperius);\n    if (upperFaceHeight > 0) {\n      addMeasurement('faceWidthToHeight', bizygomaticWidth / upperFaceHeight);\n    }\n  }\n\n  // TOTAL FACIAL WIDTH TO HEIGHT\n  if (leftZygion && rightZygion && trichion && menton) {\n    const cheekWidth = distance(leftZygion, rightZygion);\n    const totalHeight = distance(trichion, menton);\n    if (cheekWidth > 0) {\n      addMeasurement('totalFacialWidthToHeight', totalHeight / cheekWidth);\n    }\n  }\n\n  // JAW WIDTH RATIO\n  if (leftGonion && rightGonion && leftZygion && rightZygion) {\n    const bigonialWidth = distance(leftGonion, rightGonion);\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    if (bizygomaticWidth > 0) {\n      const ratio = bigonialWidth / bizygomaticWidth;\n      addMeasurement('jawWidthRatio', ratio);\n      addMeasurement('bigonialWidth', ratio * 100);\n    }\n  }\n\n  // CANTHAL TILT\n  if (leftCanthusM && leftCanthusL) {\n    const deltaY = leftCanthusM.y - leftCanthusL.y;\n    const deltaX = leftCanthusL.x - leftCanthusM.x;\n    const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);\n    addMeasurement('lateralCanthalTilt', angle);\n  }\n\n  // EYE ASPECT RATIO\n  if (leftCanthusM && leftCanthusL) {\n    const leftPalpSup = getLandmark(landmarks, 'left_palpebra_superior');\n    const leftPalpInf = getLandmark(landmarks, 'left_palpebra_inferior');\n    if (leftPalpSup && leftPalpInf) {\n      const eyeWidth = distance(leftCanthusM, leftCanthusL);\n      const eyeHeight = distance(leftPalpSup, leftPalpInf);\n      if (eyeWidth > 0) {\n        addMeasurement('eyeAspectRatio', eyeHeight / eyeWidth);\n      }\n    }\n  }\n\n  // EYE SEPARATION RATIO\n  if (leftCanthusM && rightCanthusM && leftZygion && rightZygion) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('eyeSeparationRatio', intercanthal / bizygomatic);\n    }\n  }\n\n  // IPD RATIO\n  if (leftPupil && rightPupil && leftZygion && rightZygion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('interpupillaryRatio', (ipd / bizygomatic) * 100);\n    }\n  }\n\n  // ONE EYE APART TEST\n  if (leftCanthusM && rightCanthusM && leftCanthusL) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const eyeWidth = distance(leftCanthusM, leftCanthusL);\n    if (eyeWidth > 0) {\n      addMeasurement('oneEyeApartTest', intercanthal / eyeWidth);\n    }\n  }\n\n  // NASAL INDEX\n  if (leftAlaNasi && rightAlaNasi && nasalBase && subnasale) {\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    const nasalHeight = distance(nasalBase, subnasale);\n    if (nasalHeight > 0) {\n      addMeasurement('nasalIndex', (nasalWidth / nasalHeight) * 100);\n    }\n  }\n\n  // INTERCANTHAL-NASAL WIDTH RATIO\n  if (leftCanthusM && rightCanthusM && leftAlaNasi && rightAlaNasi) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('intercanthalNasalRatio', intercanthal / nasalWidth);\n    }\n  }\n\n  // MOUTH TO NOSE RATIO\n  if (leftCheilion && rightCheilion && leftAlaNasi && rightAlaNasi) {\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('mouthWidthToNoseRatio', mouthWidth / nasalWidth);\n    }\n  }\n\n  // IPD TO MOUTH WIDTH RATIO\n  if (leftPupil && rightPupil && leftCheilion && rightCheilion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    if (ipd > 0) {\n      addMeasurement('interpupillaryMouthWidthRatio', mouthWidth / ipd);\n    }\n  }\n\n  // LIP RATIO\n  if (labraleSuperius && labraleInferius && subnasale) {\n    const mouthMiddle = getLandmark(landmarks, 'mouth_middle');\n    if (mouthMiddle) {\n      const upperLipHeight = distance(subnasale, labraleSuperius);\n      const lowerLipHeight = distance(mouthMiddle, labraleInferius);\n      if (upperLipHeight > 0) {\n        addMeasurement('lowerToUpperLipRatio', lowerLipHeight / upperLipHeight);\n      }\n    }\n  }\n\n  // MIDFACE RATIO\n  if (leftZygion && rightZygion && nasalBase && subnasale) {\n    const midfaceWidth = distance(leftZygion, rightZygion);\n    const midfaceHeight = distance(nasalBase, subnasale);\n    if (midfaceHeight > 0) {\n      addMeasurement('midfaceRatio', midfaceWidth / midfaceHeight / 10); // Normalized\n    }\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score (weighted average)\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n  const standardizedScore = overallScore;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// SIDE PROFILE ANALYSIS\n// ============================================\n\nexport interface SideProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all side profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeSideProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): SideProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const glabella = getLandmark(landmarks, 'glabella');\n  const nasion = getLandmark(landmarks, 'nasion');\n  const rhinion = getLandmark(landmarks, 'rhinion');\n  const pronasale = getLandmark(landmarks, 'pronasale');\n  const columella = getLandmark(landmarks, 'columella');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const labraleSuperius = getLandmark(landmarks, 'labraleSuperius');\n  const labraleInferius = getLandmark(landmarks, 'labraleInferius');\n  const sublabiale = getLandmark(landmarks, 'sublabiale');\n  const pogonion = getLandmark(landmarks, 'pogonion');\n  const menton = getLandmark(landmarks, 'menton');\n  const tragus = getLandmark(landmarks, 'tragus');\n  const gonionBottom = getLandmark(landmarks, 'gonionBottom');\n  const cervicalPoint = getLandmark(landmarks, 'cervicalPoint');\n  const orbitale = getLandmark(landmarks, 'orbitale');\n  const porion = getLandmark(landmarks, 'porion');\n\n  // GONIAL ANGLE\n  if (tragus && gonionBottom && menton) {\n    const angle = calculateAngle(tragus, gonionBottom, menton);\n    addMeasurement('gonialAngle', angle);\n  }\n\n  // NASOLABIAL ANGLE\n  if (columella && subnasale && labraleSuperius) {\n    const angle = calculateAngle(columella, subnasale, labraleSuperius);\n    addMeasurement('nasolabialAngle', angle);\n  }\n\n  // NASOFRONTAL ANGLE\n  if (glabella && nasion && rhinion) {\n    const angle = calculateAngle(glabella, nasion, rhinion);\n    addMeasurement('nasofrontalAngle', angle);\n  }\n\n  // MENTOLABIAL ANGLE\n  if (labraleInferius && sublabiale && pogonion) {\n    const angle = calculateAngle(labraleInferius, sublabiale, pogonion);\n    addMeasurement('mentolabialAngle', angle);\n  }\n\n  // E-LINE MEASUREMENTS\n  if (pronasale && pogonion && labraleSuperius && labraleInferius) {\n    const upperLipDist = perpendicularDistance(labraleSuperius, pronasale, pogonion);\n    const lowerLipDist = perpendicularDistance(labraleInferius, pronasale, pogonion);\n    addMeasurement('eLineUpperLip', upperLipDist);\n    addMeasurement('eLineLowerLip', lowerLipDist);\n  }\n\n  // NASOMENTAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    const angle = calculateAngle(nasion, pronasale, pogonion);\n    addMeasurement('nasomentaAngle', angle);\n  }\n\n  // FACIAL CONVEXITY (GLABELLA)\n  if (glabella && subnasale && pogonion) {\n    const angle = calculateAngle(glabella, subnasale, pogonion);\n    addMeasurement('facialConvexityGlabella', angle);\n  }\n\n  // FACIAL CONVEXITY (NASION)\n  if (nasion && subnasale && pogonion) {\n    const angle = calculateAngle(nasion, subnasale, pogonion);\n    addMeasurement('facialConvexityNasion', angle);\n  }\n\n  // TOTAL FACIAL CONVEXITY\n  if (glabella && pronasale && pogonion) {\n    const angle = calculateAngle(glabella, pronasale, pogonion);\n    addMeasurement('totalFacialConvexity', angle);\n  }\n\n  // SUBMENTAL CERVICAL ANGLE\n  if (menton && cervicalPoint && pogonion) {\n    const neckPoint = getLandmark(landmarks, 'neckPoint');\n    if (neckPoint) {\n      const angle = calculateAngle(pogonion, menton, neckPoint);\n      addMeasurement('submentalCervicalAngle', angle);\n    }\n  }\n\n  // NASAL PROJECTION (Goode ratio)\n  if (pronasale && subnasale && nasion) {\n    const projection = distance(pronasale, subnasale);\n    const nasalLength = distance(nasion, pronasale);\n    if (nasalLength > 0) {\n      addMeasurement('nasalProjection', projection / nasalLength);\n    }\n  }\n\n  // NASOFACIAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    // Angle between nose dorsum and facial plane\n    const nasalDorsum = { x: pronasale.x - nasion.x, y: pronasale.y - nasion.y };\n    const facialPlane = { x: pogonion.x - nasion.x, y: pogonion.y - nasion.y };\n\n    const dot = nasalDorsum.x * facialPlane.x + nasalDorsum.y * facialPlane.y;\n    const mag1 = Math.sqrt(nasalDorsum.x ** 2 + nasalDorsum.y ** 2);\n    const mag2 = Math.sqrt(facialPlane.x ** 2 + facialPlane.y ** 2);\n\n    if (mag1 > 0 && mag2 > 0) {\n      const angle = Math.acos(dot / (mag1 * mag2)) * (180 / Math.PI);\n      addMeasurement('nasofacialAngle', angle);\n    }\n  }\n\n  // MANDIBULAR PLANE ANGLE (using Frankfort horizontal)\n  if (porion && orbitale && gonionBottom && menton) {\n    // Frankfort horizontal is porion to orbitale\n    // Mandibular plane is gonion to menton\n    const fhAngle = Math.atan2(orbitale.y - porion.y, orbitale.x - porion.x);\n    const mpAngle = Math.atan2(menton.y - gonionBottom.y, menton.x - gonionBottom.x);\n    const angle = Math.abs(fhAngle - mpAngle) * (180 / Math.PI);\n    addMeasurement('mandibularPlaneAngle', angle);\n  }\n\n  // CHIN PROJECTION\n  if (pogonion && subnasale) {\n    // Distance from pogonion to vertical line through subnasale\n    const projection = pogonion.x - subnasale.x;\n    addMeasurement('chinProjection', projection);\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// COMPLETE HARMONY ANALYSIS\n// ============================================\n\n/**\n * Run complete facial harmony analysis.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeHarmony(\n  frontLandmarks: LandmarkPoint[],\n  sideLandmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): HarmonyAnalysis {\n  const frontResults = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n  const sideResults = analyzeSideProfile(sideLandmarks, gender, ethnicity);\n\n  const allMeasurements = [...frontResults.measurements, ...sideResults.measurements];\n\n  // Combined category scores\n  const allCategories: Record<string, { total: number; count: number }> = {};\n  for (const m of allMeasurements) {\n    if (!allCategories[m.category]) {\n      allCategories[m.category] = { total: 0, count: 0 };\n    }\n    allCategories[m.category].total += m.standardizedScore;\n    allCategories[m.category].count++;\n  }\n\n  const categoryScores: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(allCategories)) {\n    categoryScores[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Overall weighted score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of allMeasurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  // Identify flaws (below average measurements)\n  const flaws: FlawAssessment[] = allMeasurements\n    .filter((m) => m.severity !== 'optimal' && m.severity !== 'minor')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      severity: m.severity,\n      deviation: `${m.deviation.toFixed(2)} ${m.deviationDirection} ideal`,\n      reasoning: `${m.name} is outside the ideal range`,\n      confidence: m.severity === 'extremely_severe' || m.severity === 'severe'\n        ? 'confirmed' as const\n        : 'likely' as const,\n    }))\n    .sort((a, b) => {\n      const severityOrder = { extremely_severe: 0, severe: 1, major: 2, moderate: 3 };\n      return (severityOrder[a.severity as keyof typeof severityOrder] ?? 4) -\n             (severityOrder[b.severity as keyof typeof severityOrder] ?? 4);\n    });\n\n  // Identify strengths (ideal measurements)\n  const strengths: StrengthAssessment[] = allMeasurements\n    .filter((m) => m.qualityTier === 'ideal' || m.qualityTier === 'excellent')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      qualityTier: m.qualityTier,\n      value: m.value,\n      reasoning: `${m.name} is within the ${m.qualityTier} range`,\n    }));\n\n  // Calculate percentile (based on population stats)\n  const percentile = calculateHarmonyPercentile(overallScore);\n\n  return {\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    percentile,\n    frontScore: frontResults.overallScore,\n    sideScore: sideResults.overallScore,\n    categoryScores,\n    measurements: allMeasurements,\n    flaws,\n    strengths,\n  };\n}\n\n/**\n * Calculate percentile from harmony score\n */\nfunction calculateHarmonyPercentile(score: number): number {\n  // Based on normal distribution with mean=5, stdDev=1.5\n  const mean = 5;\n  const stdDev = 1.5;\n  const z = (score - mean) / stdDev;\n  return normalCDF(z) * 100;\n}\n\n/**\n * Standard normal CDF approximation\n */\nfunction normalCDF(z: number): number {\n  const a1 = 0.254829592;\n  const a2 = -0.284496736;\n  const a3 = 1.421413741;\n  const a4 = -1.453152027;\n  const a5 = 1.061405429;\n  const p = 0.3275911;\n\n  const sign = z < 0 ? -1 : 1;\n  const absZ = Math.abs(z) / Math.sqrt(2);\n\n  const t = 1.0 / (1.0 + p * absZ);\n  const y = 1.0 - ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-absZ * absZ);\n\n  return 0.5 * (1.0 + sign * y);\n}\n\n// ============================================\n// PSL RATING CONVERSION\n// ============================================\n\nexport interface PSLRating {\n  score: number;\n  tier: string;\n  percentile: number;\n  description: string;\n}\n\n/**\n * Convert harmony score to PSL rating\n */\nexport function convertToPSL(harmonyScore: number): PSLRating {\n  // Convert 0-10 harmony to 3.0-7.5 PSL range\n  const psl = 3.0 + (harmonyScore / 10) * 4.5;\n  const clampedPSL = Math.max(3.0, Math.min(7.5, psl));\n\n  let tier: string;\n  let percentile: number;\n\n  if (clampedPSL >= 7.5) {\n    tier = 'Top Model';\n    percentile = 99.99;\n  } else if (clampedPSL >= 7.0) {\n    tier = 'Chad';\n    percentile = 99.87;\n  } else if (clampedPSL >= 6.5) {\n    tier = 'Chadlite';\n    percentile = 99.0;\n  } else if (clampedPSL >= 6.0) {\n    tier = 'High Tier Normie+';\n    percentile = 97.25;\n  } else if (clampedPSL >= 5.5) {\n    tier = 'High Tier Normie';\n    percentile = 90.0;\n  } else if (clampedPSL >= 5.0) {\n    tier = 'Mid Tier Normie+';\n    percentile = 84.15;\n  } else if (clampedPSL >= 4.5) {\n    tier = 'Mid Tier Normie';\n    percentile = 65.0;\n  } else if (clampedPSL >= 4.0) {\n    tier = 'Low Tier Normie';\n    percentile = 50.0;\n  } else if (clampedPSL >= 3.5) {\n    tier = 'Below Average';\n    percentile = 30.0;\n  } else {\n    tier = 'Subpar';\n    percentile = 15.0;\n  }\n\n  return {\n    score: clampedPSL,\n    tier,\n    percentile,\n    description: `${tier} (top ${(100 - percentile).toFixed(1)}%)`,\n  };\n}\n\n// ============================================\n// EXPORTS FOR BACKWARD COMPATIBILITY\n// ============================================\n\nexport type { LandmarkPoint } from './landmarks';\n","structuredPatch":[{"oldStart":323,"oldLines":11,"newStart":323,"newLines":14,"lines":["   faceWidthToHeight: {","     // Males: slightly wider face preferred; Females: slightly narrower","     // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)","-    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"","+    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)","+    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"","     male: { idealMin: 1.98, idealMax: 2.02 },","     female: { idealMin: 1.94, idealMax: 1.98 },","     hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes","     hispanic_female: { idealMin: 1.93, idealMax: 2.05 },","+    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face","+    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },","   },"," ","   totalFacialWidthToHeight: {"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"d18560ba-c4f4-44bc-8bda-a3f708b623a1","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_011RsueuQ9rccpEQ1jZSzut1","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good! Now let me add the intercanthalNasalRatio (alar base ratio) for Pacific Islander. Let me check what's already there.","signature":"EqMCCkYIChgCKkDBDdGKDK6h0ws2dzcqWryMaOqQ701wsVweiTH781LDPzTg7bgMaCksyRZoVs4DnNjjEJYm0PWDmNjVjF/izHbaEgyADsmL7+m8E8IeVdIaDFPiU1hxGlzWg2a0jiIw9quqO/gnZotzEKo8MdvJmMsAMvfaYHWI1PRUG+HOukidI55qIMhnYuxp5a2+8H9YKooBOQSax9qNpNrsLlVyY0EB2aDyiEuah86SlJPamCPqeTVtsHaZReECi28z/LuJnw5oC2zlZQiAtrfRTl2nEMynBm0uBHUOMb1A7I/9841CLRE2Xow67iqfc3eTqHMsrjx2uiVouqLyosGKeaMhVYHo8zifphwqn2o2P/dCuNDb4PZLTUa+WF+PhsakGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":9,"cache_creation_input_tokens":1630,"cache_read_input_tokens":32148,"cache_creation":{"ephemeral_5m_input_tokens":1630,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD6MGtwmvXNttimvh2C","type":"assistant","uuid":"417861d6-b34d-4c3e-b1f6-56385835859d","timestamp":"2025-12-21T17:15:11.805Z"}
{"parentUuid":"417861d6-b34d-4c3e-b1f6-56385835859d","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_011RsueuQ9rccpEQ1jZSzut1","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01TxzR2cCrsHqQXS88AY5rSY","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","offset":224,"limit":20}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":9,"cache_creation_input_tokens":1630,"cache_read_input_tokens":32148,"cache_creation":{"ephemeral_5m_input_tokens":1630,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD6MGtwmvXNttimvh2C","type":"assistant","uuid":"f4cc08dc-4075-4061-9ab1-242e11a0419a","timestamp":"2025-12-21T17:15:12.623Z"}
{"parentUuid":"f4cc08dc-4075-4061-9ab1-242e11a0419a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01TxzR2cCrsHqQXS88AY5rSY","type":"tool_result","content":"   224â†’  intercanthalNasalRatio: {\n   225â†’    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n   226â†’    // Research: Wider nose base is standard in African phenotypes\n   227â†’    // Extracted from FaceIQ BlackAfrican.htc logic\n   228â†’    white_male: { idealMin: 1.00, idealMax: 1.04 },\n   229â†’    white_female: { idealMin: 0.98, idealMax: 1.02 },\n   230â†’    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n   231â†’    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n   232â†’    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n   233â†’    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n   234â†’    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n   235â†’    black_female: { idealMin: 1.13, idealMax: 1.23 },\n   236â†’    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n   237â†’    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n   238â†’  },\n   239â†’\n   240â†’  // ==========================================\n   241â†’  // JAW METRICS - Clear gender dimorphism\n   242â†’  // ==========================================\n   243â†’  bigonialWidth: {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"3309b014-0663-44e6-8b89-299a07a384b1","timestamp":"2025-12-21T17:15:12.698Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","content":"  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Extracted from FaceIQ BlackAfrican.htc logic\n    white_male: { idealMin: 1.00, idealMax: 1.04 },\n    white_female: { idealMin: 0.98, idealMax: 1.02 },\n    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n    black_female: { idealMin: 1.13, idealMax: 1.23 },\n    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n  },\n\n  // ==========================================\n  // JAW METRICS - Clear gender dimorphism\n  // ==========================================\n  bigonialWidth: {","numLines":20,"startLine":224,"totalLines":3146}}}
{"parentUuid":"3309b014-0663-44e6-8b89-299a07a384b1","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016RGybQkC9YKa3hswmxYd4s","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect! I can see that Pacific Islander is not in the intercanthalNasalRatio list yet. The user mentioned 1.05-1.20 which fits between the White (1.00-1.04) and Black (1.15-1.25) ranges. Let me add it.","signature":"EvMCCkYIChgCKkANBdUWflayxAZeRGA2Dj2IuNvAwr9IHLfaabCOAlBrWYFH+9gYhK28p0ohYJlp1hJ6h960RPNC6Ev3Wg7YQprwEgz+k7Zx/XVACO8nauEaDC8UHbEsogHNCI29UyIwiAZvjGd2FwHhQzNe3E0JYKF55xySSj1bt0+jlmc74aMaH0cR1HkwuU10pFwNB1x0KtoB4N8W+YGUZdnv3uHumu9z1GRI0kIdptu/e1sj1Jb+ZVaCbbPn4opKC6qpSEKg8pQWCU83cdUA8QCzMqTHmr5/lGS0omTEShg9UsF++Kq+pOblyHMVFE1JEp9b8TF871YAwIua3YllpCekC47jueuW4IssJ7YbD86PxEhXjJC+Oc5aBxLy1temYiuL3BzwqXEqVkKFuP6H24I3aV5zQOVNLww+WyX9XO/inHSvCJrywb8Ju+vYYebuAtrp8wrKl+Cbm8iUF5aPi1ATtAv/xTSn6uFyVFZax1y0SFwYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":853,"cache_read_input_tokens":33778,"cache_creation":{"ephemeral_5m_input_tokens":853,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD6gCSCtr2PcDyFJh3p","type":"assistant","uuid":"c10d4420-9bda-471f-8e44-17a727f73767","timestamp":"2025-12-21T17:15:16.202Z"}
{"parentUuid":"c10d4420-9bda-471f-8e44-17a727f73767","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016RGybQkC9YKa3hswmxYd4s","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WaitMUCsrLvxbzgRXTT9L6","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","old_string":"  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Extracted from FaceIQ BlackAfrican.htc logic\n    white_male: { idealMin: 1.00, idealMax: 1.04 },\n    white_female: { idealMin: 0.98, idealMax: 1.02 },\n    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n    black_female: { idealMin: 1.13, idealMax: 1.23 },\n    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n  },","new_string":"  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Pacific Islander: Similar to Black model, accepts wide nasal base\n    // Extracted from FaceIQ BlackAfrican.htc and Male:Pacific Islander.htc logic\n    white_male: { idealMin: 1.00, idealMax: 1.04 },\n    white_female: { idealMin: 0.98, idealMax: 1.02 },\n    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n    black_female: { idealMin: 1.13, idealMax: 1.23 },\n    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n    pacific_islander_male: { idealMin: 1.10, idealMax: 1.20 },  // Wide tolerance, similar to Black model\n    pacific_islander_female: { idealMin: 1.08, idealMax: 1.18 },\n  },"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":853,"cache_read_input_tokens":33778,"cache_creation":{"ephemeral_5m_input_tokens":853,"ephemeral_1h_input_tokens":0},"output_tokens":979,"service_tier":"standard"}},"requestId":"req_011CWLD6gCSCtr2PcDyFJh3p","type":"assistant","uuid":"dd78256a-22c2-496e-a9b0-8d3a2d61e93a","timestamp":"2025-12-21T17:15:23.595Z"}
{"parentUuid":"dd78256a-22c2-496e-a9b0-8d3a2d61e93a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01WaitMUCsrLvxbzgRXTT9L6","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   220â†’    white: { idealMin: 0.60, idealMax: 0.67 },\n   221â†’    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },\n   222â†’  },\n   223â†’\n   224â†’  intercanthalNasalRatio: {\n   225â†’    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n   226â†’    // Research: Wider nose base is standard in African phenotypes\n   227â†’    // Pacific Islander: Similar to Black model, accepts wide nasal base\n   228â†’    // Extracted from FaceIQ BlackAfrican.htc and Male:Pacific Islander.htc logic\n   229â†’    white_male: { idealMin: 1.00, idealMax: 1.04 },\n   230â†’    white_female: { idealMin: 0.98, idealMax: 1.02 },\n   231â†’    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n   232â†’    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n   233â†’    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n   234â†’    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n   235â†’    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n   236â†’    black_female: { idealMin: 1.13, idealMax: 1.23 },\n   237â†’    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n   238â†’    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n   239â†’    pacific_islander_male: { idealMin: 1.10, idealMax: 1.20 },  // Wide tolerance, similar to Black model\n   240â†’    pacific_islander_female: { idealMin: 1.08, idealMax: 1.18 },\n   241â†’  },\n   242â†’\n   243â†’  // ==========================================\n   244â†’  // JAW METRICS - Clear gender dimorphism\n   245â†’  // =========================================="}]},"uuid":"c5b381ca-33bd-4869-ab2a-a9121fc05f22","timestamp":"2025-12-21T17:15:23.613Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","oldString":"  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Extracted from FaceIQ BlackAfrican.htc logic\n    white_male: { idealMin: 1.00, idealMax: 1.04 },\n    white_female: { idealMin: 0.98, idealMax: 1.02 },\n    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n    black_female: { idealMin: 1.13, idealMax: 1.23 },\n    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n  },","newString":"  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Pacific Islander: Similar to Black model, accepts wide nasal base\n    // Extracted from FaceIQ BlackAfrican.htc and Male:Pacific Islander.htc logic\n    white_male: { idealMin: 1.00, idealMax: 1.04 },\n    white_female: { idealMin: 0.98, idealMax: 1.02 },\n    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n    black_female: { idealMin: 1.13, idealMax: 1.23 },\n    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n    pacific_islander_male: { idealMin: 1.10, idealMax: 1.20 },  // Wide tolerance, similar to Black model\n    pacific_islander_female: { idealMin: 1.08, idealMax: 1.18 },\n  },","originalFile":"/**\n * FaceIQ-Style Facial Analysis Scoring System\n * Complete replication of FaceIQ Labs scoring algorithms\n *\n * Features:\n * - Exponential decay scoring with per-metric decay rates\n * - Bezier curve custom scoring for non-linear measurements\n * - 70+ facial measurements (front + side profiles)\n * - Quality tiers: Ideal, Excellent, Good\n * - 5-tier severity: Extremely Severe, Severe, Major, Moderate, Minor\n */\n\nimport { LandmarkPoint } from './landmarks';\n\n// ============================================\n// CORE TYPES\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\n/**\n * Polarity defines how deviation from the ideal range is interpreted:\n * - 'balanced': Default. Deviation in either direction is equally bad.\n * - 'higher_is_better': Values above the ideal are still good. Only values below\n *   the 'safeFloor' are true weaknesses. E.g., Canthal Tilt (positive tilt is good)\n * - 'lower_is_better': Values below the ideal are still good. Only values above\n *   the 'safeCeiling' are true weaknesses. E.g., Philtrum length (shorter is better)\n */\nexport type MetricPolarity = 'balanced' | 'higher_is_better' | 'lower_is_better';\n\nexport interface MetricConfig {\n  id: string;\n  name: string;\n  category: string;\n  unit: MeasurementUnit;\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  decayRate: number;\n  maxScore: number;\n  weight: number;\n  description: string;\n  profileType: 'front' | 'side';\n  customCurve?: BezierCurveConfig;\n  /**\n   * Polarity for directional/dimorphic scoring.\n   * Defaults to 'balanced' if not specified.\n   */\n  polarity?: MetricPolarity;\n  /**\n   * For 'higher_is_better': minimum value that's still acceptable.\n   * Values above this but below idealMin get a passing score (softFloorScore).\n   * Values below this are true weaknesses.\n   */\n  safeFloor?: number;\n  /**\n   * For 'lower_is_better': maximum value that's still acceptable.\n   * Values below this but above idealMax get a passing score (softCeilingScore).\n   * Values above this are true weaknesses.\n   */\n  safeCeiling?: number;\n  /**\n   * Score given to values in the \"acceptable but not ideal\" zone.\n   * Defaults to 8.0 (Good). Range: 6.0-9.0\n   */\n  softZoneScore?: number;\n}\n\nexport interface BezierCurveConfig {\n  mode: 'custom' | 'exponential';\n  points: CurvePoint[];\n}\n\nexport interface CurvePoint {\n  x: number;\n  y: number;\n  leftHandleX?: number;\n  leftHandleY?: number;\n  rightHandleX?: number;\n  rightHandleY?: number;\n  fixed?: boolean;\n}\n\nexport interface FaceIQScoreResult {\n  metricId: string;\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  severity: SeverityLevel;\n  idealMin: number;\n  idealMax: number;\n  deviation: number;\n  deviationDirection: 'above' | 'below' | 'within';\n  unit: MeasurementUnit;\n  category: string;\n  percentile?: number;\n}\n\nexport interface HarmonyAnalysis {\n  overallScore: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  percentile: number;\n  frontScore: number;\n  sideScore: number;\n  categoryScores: Record<string, number>;\n  measurements: FaceIQScoreResult[];\n  flaws: FlawAssessment[];\n  strengths: StrengthAssessment[];\n}\n\nexport interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n}\n\nexport interface StrengthAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  qualityTier: QualityTier;\n  value: number;\n  reasoning: string;\n}\n\n// ============================================\n// DEMOGRAPHIC TYPES & OVERRIDES\n// ============================================\n\nexport type Ethnicity =\n  | 'east_asian'\n  | 'south_asian'\n  | 'black'\n  | 'hispanic'\n  | 'middle_eastern'\n  | 'native_american'\n  | 'pacific_islander'\n  | 'white'\n  | 'other';\n\nexport type Gender = 'male' | 'female';\n\nexport type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n\nexport interface DemographicOverride {\n  idealMin: number;\n  idealMax: number;\n}\n\n/**\n * Demographic-specific ideal ranges based on anthropometric research.\n * FaceIQ uses universal scoring, but this gives more accurate assessments\n * by adjusting ideals based on ethnicity and gender.\n */\nexport const DEMOGRAPHIC_OVERRIDES: Record<string, Partial<Record<DemographicKey, DemographicOverride>>> = {\n  // ==========================================\n  // NOSE METRICS - Highest ethnicity variation\n  // ==========================================\n  nasalIndex: {\n    // Nasal Index = (Nose Width / Nose Height) Ã— 100\n    // Research: African/Pacific Islander tend platyrrhine (85-100), Asian mesorrhine (75-88), European leptorrhine (65-75)\n    east_asian_male: { idealMin: 78, idealMax: 88 },\n    east_asian_female: { idealMin: 76, idealMax: 86 },\n    south_asian_male: { idealMin: 72, idealMax: 82 },\n    south_asian_female: { idealMin: 70, idealMax: 80 },\n    black_male: { idealMin: 85, idealMax: 100 },\n    black_female: { idealMin: 83, idealMax: 98 },\n    hispanic_male: { idealMin: 75, idealMax: 87 },\n    hispanic_female: { idealMin: 73, idealMax: 85 },\n    middle_eastern_male: { idealMin: 68, idealMax: 78 },\n    middle_eastern_female: { idealMin: 66, idealMax: 76 },\n    white_male: { idealMin: 65, idealMax: 75 },\n    white_female: { idealMin: 63, idealMax: 73 },\n    native_american_male: { idealMin: 72, idealMax: 82 },\n    native_american_female: { idealMin: 70, idealMax: 80 },\n    pacific_islander_male: { idealMin: 82, idealMax: 95 },\n    pacific_islander_female: { idealMin: 80, idealMax: 93 },\n  },\n\n  nasolabialAngle: {\n    // Ideal nasolabial angle varies by ethnicity\n    // African: slightly more obtuse, European: slightly more acute\n    // Middle Eastern: Penalizes droopy tip (<90Â°) - common flaw is \"Hooked Nose\"\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    black_male: { idealMin: 95, idealMax: 110 },\n    black_female: { idealMin: 100, idealMax: 115 },\n    east_asian_male: { idealMin: 90, idealMax: 105 },\n    east_asian_female: { idealMin: 95, idealMax: 110 },\n    middle_eastern_male: { idealMin: 90, idealMax: 100 },  // Strict on droopy tip\n    middle_eastern_female: { idealMin: 95, idealMax: 105 },\n    // Gender-only fallbacks\n    male: { idealMin: 90, idealMax: 100 },\n    female: { idealMin: 100, idealMax: 110 },\n  },\n\n  nasalProjection: {\n    // Nose projection relative to face depth\n    // East Asian/African: typically less projection is ideal\n    // Middle Eastern: Accepts stronger projection (bigger nose) than White model\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian: { idealMin: 0.54, idealMax: 0.60 },\n    black: { idealMin: 0.52, idealMax: 0.58 },\n    south_asian: { idealMin: 0.56, idealMax: 0.62 },\n    middle_eastern: { idealMin: 0.62, idealMax: 0.70 },  // Higher tolerance for larger noses\n    white: { idealMin: 0.60, idealMax: 0.67 },\n    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },\n  },\n\n  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Extracted from FaceIQ BlackAfrican.htc logic\n    white_male: { idealMin: 1.00, idealMax: 1.04 },\n    white_female: { idealMin: 0.98, idealMax: 1.02 },\n    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n    black_female: { idealMin: 1.13, idealMax: 1.23 },\n    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n  },\n\n  // ==========================================\n  // JAW METRICS - Clear gender dimorphism\n  // ==========================================\n  bigonialWidth: {\n    // Jaw width as % of bizygomatic width\n    // Males: wider, more angular; Females: narrower, softer\n    male: { idealMin: 90, idealMax: 95 },\n    female: { idealMin: 85, idealMax: 90 },\n  },\n\n  jawFrontalAngle: {\n    // More angular in males, softer in females\n    male: { idealMin: 88, idealMax: 95 },\n    female: { idealMin: 82, idealMax: 90 },\n  },\n\n  jawWidthRatio: {\n    // Males have stronger jaw width preference\n    male: { idealMin: 0.78, idealMax: 0.85 },\n    female: { idealMin: 0.72, idealMax: 0.80 },\n  },\n\n  gonialAngle: {\n    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n    male: { idealMin: 115, idealMax: 125 },\n    female: { idealMin: 120, idealMax: 135 },\n  },\n\n  // ==========================================\n  // EYE METRICS - Ethnic variation\n  // ==========================================\n  lateralCanthalTilt: {\n    // East Asian: naturally higher positive tilt\n    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian_male: { idealMin: 8, idealMax: 12 },\n    east_asian_female: { idealMin: 9, idealMax: 13 },\n    south_asian_male: { idealMin: 6, idealMax: 10 },\n    south_asian_female: { idealMin: 7, idealMax: 11 },\n    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n    // Default for others is 4-8 (already in FACEIQ_METRICS)\n  },\n\n  eyeAspectRatio: {\n    // East Asian eyes often have different aspect ratio due to epicanthal fold\n    east_asian_male: { idealMin: 2.6, idealMax: 3.2 },\n    east_asian_female: { idealMin: 2.7, idealMax: 3.3 },\n    // Larger eyes in females considered more attractive\n    male: { idealMin: 2.9, idealMax: 3.4 },\n    female: { idealMin: 3.1, idealMax: 3.6 },\n  },\n\n  tearTroughDepth: {\n    // Under-eye hollowing and dark circles (infraorbital depression)\n    // South Asian: MUCH stricter penalty due to genetic hyperpigmentation\n    // Extracted from FaceIQ Male:SouthAsian.htc - biggest difference vs White model\n    white_male: { idealMin: 0.0, idealMax: 1.5 },\n    white_female: { idealMin: 0.0, idealMax: 1.3 },\n    south_asian_male: { idealMin: 0.0, idealMax: 0.5 },  // VERY strict - 0.5+ triggers \"Tired/Aged Eyes\" flaw\n    south_asian_female: { idealMin: 0.0, idealMax: 0.4 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.2 },\n    east_asian_female: { idealMin: 0.0, idealMax: 1.0 },\n  },\n\n  upperEyelidExposure: {\n    // Visible eyelid platform (space between eyelash and crease)\n    // South Asian ideal: prefers visible lid platform, penalizes hooded eyes more than White model\n    // Extracted from FaceIQ Male:SouthAsian.htc\n    white_male: { idealMin: 0.3, idealMax: 2.5 },\n    white_female: { idealMin: 0.5, idealMax: 3.0 },\n    south_asian_male: { idealMin: 0.5, idealMax: 2.0 },  // Prefers visible lid, penalizes hooding\n    south_asian_female: { idealMin: 0.7, idealMax: 2.2 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.5 },  // More tolerance for less exposure\n    east_asian_female: { idealMin: 0.2, idealMax: 1.8 },\n  },\n\n  // ==========================================\n  // FACE PROPORTIONS - Gender variation\n  // ==========================================\n  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n  },\n\n  totalFacialWidthToHeight: {\n    male: { idealMin: 1.35, idealMax: 1.40 },\n    female: { idealMin: 1.32, idealMax: 1.37 },\n  },\n\n  midfaceRatio: {\n    // Females often have more compact midface\n    // Middle Eastern: Similar to White model - compact is better\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    male: { idealMin: 0.98, idealMax: 1.02 },\n    female: { idealMin: 0.95, idealMax: 1.00 },\n    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n  },\n\n  // ==========================================\n  // LIP METRICS - Ethnicity variation\n  // ==========================================\n  lipRatio: {\n    // African/Hispanic: fuller lips natural\n    black_male: { idealMin: 1.6, idealMax: 2.2 },\n    black_female: { idealMin: 1.7, idealMax: 2.3 },\n    hispanic_male: { idealMin: 1.4, idealMax: 2.0 },\n    hispanic_female: { idealMin: 1.5, idealMax: 2.1 },\n    // East Asian: less full lips\n    east_asian_male: { idealMin: 1.2, idealMax: 1.7 },\n    east_asian_female: { idealMin: 1.3, idealMax: 1.8 },\n    // Default\n    male: { idealMin: 1.3, idealMax: 1.8 },\n    female: { idealMin: 1.4, idealMax: 2.0 },\n  },\n\n  upperLipRatio: {\n    // Fuller upper lip in African phenotypes\n    black: { idealMin: 0.38, idealMax: 0.48 },\n    hispanic: { idealMin: 0.36, idealMax: 0.45 },\n    east_asian: { idealMin: 0.32, idealMax: 0.40 },\n    female: { idealMin: 0.34, idealMax: 0.42 },\n  },\n\n  // ==========================================\n  // PROFILE METRICS - Gender & ethnicity\n  // ==========================================\n  chinProjection: {\n    // Males: more projected chin ideal\n    // Black/African: Adjusted for bimaxillary prognathism (forward mouth projection)\n    // Extracted from FaceIQ BlackAfrican.htc logic\n    male: { idealMin: 0, idealMax: 3 },\n    female: { idealMin: -2, idealMax: 2 },\n    black_male: { idealMin: 0, idealMax: 4 },  // Accommodates natural forward projection\n    black_female: { idealMin: -1, idealMax: 3 },\n  },\n\n  nasofrontalAngle: {\n    // Higher brow ridge in males\n    male: { idealMin: 128, idealMax: 138 },\n    female: { idealMin: 132, idealMax: 142 },\n  },\n\n  chinToPhiltrumRatio: {\n    // Black/African: Fuller lips naturally shorten visible philtrum\n    // Extracted from FaceIQ BlackAfrican.htc - relaxes \"Short Philtrum\" penalty\n    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n    black_female: { idealMin: 2.10, idealMax: 2.65 },\n  },\n\n  // ==========================================\n  // SKIN QUALITY - Ethnicity variation\n  // ==========================================\n  skinUniformity: {\n    // South Asian: Stricter standards due to genetic hyperpigmentation tendency\n    // Hispanic: Similar to South Asian - penalizes hyperpigmentation more than White model\n    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n    white_male: { idealMin: 0.88, idealMax: 1.00 },\n    white_female: { idealMin: 0.90, idealMax: 1.00 },\n    south_asian_male: { idealMin: 0.90, idealMax: 1.00 },  // Stricter - hyperpigmentation common\n    south_asian_female: { idealMin: 0.92, idealMax: 1.00 },\n    east_asian_male: { idealMin: 0.92, idealMax: 1.00 },  // High skin quality standards\n    east_asian_female: { idealMin: 0.94, idealMax: 1.00 },\n    black_male: { idealMin: 0.85, idealMax: 1.00 },  // More tolerance for melanin variation\n    black_female: { idealMin: 0.87, idealMax: 1.00 },\n    hispanic_male: { idealMin: 0.85, idealMax: 1.00 },  // Bridge: more tolerance than South Asian, less than White\n    hispanic_female: { idealMin: 0.87, idealMax: 1.00 },\n  },\n\n  // ==========================================\n  // EYEBROW METRICS - Ethnicity variation\n  // ==========================================\n  eyebrowThickness: {\n    // Middle Eastern: Heavily favors thick, dense eyebrows (\"Dark Triad\" look with deep-set eyes)\n    // Extracted from FaceIQ Male:MiddleEastern.htc - STRICTEST eyebrow requirements\n    middle_eastern_male: { idealMin: 2.5, idealMax: 5.0 },  // Prefers significantly thicker/darker brows\n    middle_eastern_female: { idealMin: 2.0, idealMax: 4.0 },\n    east_asian_male: { idealMin: 1.5, idealMax: 3.0 },  // Typically less thick\n    east_asian_female: { idealMin: 1.3, idealMax: 2.5 },\n    male: { idealMin: 2.0, idealMax: 4.0 },\n    female: { idealMin: 1.8, idealMax: 3.5 },\n  },\n\n  eyebrowDistance: {\n    // Middle Eastern: \"Kill Switch\" for unibrow (synophrys)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    // While thick brows are favored, unibrow is a critical flaw if distance < 15mm\n    middle_eastern_male: { idealMin: 15, idealMax: 25 },  // Stricter minimum to avoid unibrow\n    middle_eastern_female: { idealMin: 18, idealMax: 28 },\n    male: { idealMin: 15, idealMax: 25 },\n    female: { idealMin: 16, idealMax: 26 },\n  },\n\n  orbitalVector: {\n    // Middle Eastern: Favors deep-set eyes (lower/negative orbital vector)\n    // Part of the \"Dark Triad\" look with heavy brows\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    middle_eastern_male: { idealMin: -2, idealMax: 3 },  // Allows more deep-set eyes\n    middle_eastern_female: { idealMin: -1, idealMax: 4 },\n    male: { idealMin: 0, idealMax: 4 },\n    female: { idealMin: 1, idealMax: 5 },\n  },\n};\n\n/**\n * Get metric configuration with demographic-specific overrides applied.\n * Lookup priority: ethnicity_gender > gender > ethnicity > default\n */\nexport function getMetricConfigForDemographics(\n  metricId: string,\n  gender: Gender,\n  ethnicity: Ethnicity = 'other'\n): MetricConfig | null {\n  const baseConfig = FACEIQ_METRICS[metricId];\n  if (!baseConfig) return null;\n\n  const overrides = DEMOGRAPHIC_OVERRIDES[metricId];\n  if (!overrides) return baseConfig;\n\n  // Try specific combo first (e.g., \"east_asian_male\")\n  const specificKey = `${ethnicity}_${gender}` as DemographicKey;\n  const override = overrides[specificKey] || overrides[gender] || overrides[ethnicity];\n\n  if (!override) return baseConfig;\n\n  return {\n    ...baseConfig,\n    idealMin: override.idealMin,\n    idealMax: override.idealMax,\n  };\n}\n\n// ============================================\n// FACEIQ MEASUREMENT CONFIGURATIONS (70+)\n// ============================================\n\nexport const FACEIQ_METRICS: Record<string, MetricConfig> = {\n  // ==========================================\n  // FRONT PROFILE - FACIAL PROPORTIONS (32)\n  // ==========================================\n\n  faceWidthToHeight: {\n    id: 'faceWidthToHeight',\n    name: 'Face Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.96,\n    idealMax: 2.0,\n    rangeMin: 1.4,\n    rangeMax: 2.5,\n    decayRate: 6.4,\n    maxScore: 30,  // FaceIQ: highest priority metric\n    weight: 0.06,\n    description: 'Ratio of bizygomatic width to upper face height',\n    profileType: 'front',\n  },\n\n  lowerThirdProportion: {\n    id: 'lowerThirdProportion',\n    name: 'Lower Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31,\n    idealMax: 33.5,\n    rangeMin: 24,\n    rangeMax: 40,\n    decayRate: 1.86,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by lower third (subnasale to menton)',\n    profileType: 'front',\n  },\n\n  middleThirdProportion: {\n    id: 'middleThirdProportion',\n    name: 'Middle Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31.4,\n    idealMax: 33.4,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by middle third',\n    profileType: 'front',\n  },\n\n  upperThirdProportion: {\n    id: 'upperThirdProportion',\n    name: 'Upper Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 30,\n    idealMax: 32,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Percentage of face occupied by upper third (trichion to glabella)',\n    profileType: 'front',\n  },\n\n  bitemporalWidth: {\n    id: 'bitemporalWidth',\n    name: 'Bitemporal Width',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 75,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Temple width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  cheekboneHeight: {\n    id: 'cheekboneHeight',\n    name: 'Cheekbone Height',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 83,\n    idealMax: 100,\n    rangeMin: 30,\n    rangeMax: 140,\n    decayRate: 0.5,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Vertical position of cheekbones relative to face height',\n    profileType: 'front',\n  },\n\n  totalFacialWidthToHeight: {\n    id: 'totalFacialWidthToHeight',\n    name: 'Total Facial Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.34,\n    idealMax: 1.37,\n    rangeMin: 1.0,\n    rangeMax: 1.7,\n    decayRate: 13.2,\n    maxScore: 25,  // Special: higher max score\n    weight: 0.05,\n    description: 'Total face height divided by cheek width',\n    profileType: 'front',\n    customCurve: {\n      mode: 'custom',\n      points: [\n        { x: 1.05, y: 0 },\n        { x: 1.17, y: 1.41 },\n        { x: 1.25, y: 3.86 },\n        { x: 1.29, y: 6.01 },\n        { x: 1.32, y: 8.88 },\n        { x: 1.34, y: 10, fixed: true },\n        { x: 1.37, y: 10, fixed: true },\n        { x: 1.39, y: 8.88 },\n        { x: 1.42, y: 6.01 },\n        { x: 1.46, y: 3.86 },\n        { x: 1.54, y: 1.41 },\n        { x: 1.66, y: 0 },\n      ],\n    },\n  },\n\n  midfaceRatio: {\n    id: 'midfaceRatio',\n    name: 'Midface Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 0.97,\n    idealMax: 1.0,\n    rangeMin: 0.5,\n    rangeMax: 1.5,\n    decayRate: 31.6,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.04,\n    description: 'Midface width to height ratio for facial balance',\n    profileType: 'front',\n  },\n\n  // JAW MEASUREMENTS\n  jawSlope: {\n    id: 'jawSlope',\n    name: 'Jaw Slope',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 140,\n    idealMax: 142.5,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of the jawline from gonion to chin',\n    profileType: 'front',\n  },\n\n  jawFrontalAngle: {\n    id: 'jawFrontalAngle',\n    name: 'Jaw Frontal Angle',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 35,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 20,  // FaceIQ: high priority\n    weight: 0.04,\n    description: 'Angle of jaw corners from frontal view',\n    profileType: 'front',\n  },\n\n  bigonialWidth: {\n    id: 'bigonialWidth',\n    name: 'Bigonial Width',\n    category: 'Jaw Shape',\n    unit: 'percent',\n    idealMin: 87.75,\n    idealMax: 91.75,\n    rangeMin: 60.25,\n    rangeMax: 120.25,\n    decayRate: 0.9,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Jaw width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  jawWidthRatio: {\n    id: 'jawWidthRatio',\n    name: 'Jaw Width to Face Width Ratio',\n    category: 'Jaw Shape',\n    unit: 'ratio',\n    idealMin: 0.75,\n    idealMax: 0.82,\n    rangeMin: 0.6,\n    rangeMax: 0.95,\n    decayRate: 25.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Bigonial width divided by bizygomatic width',\n    profileType: 'front',\n  },\n\n  // EYE MEASUREMENTS\n  lateralCanthalTilt: {\n    id: 'lateralCanthalTilt',\n    name: 'Lateral Canthal Tilt',\n    category: 'Eyes',\n    unit: 'degrees',\n    idealMin: 4.0,   // Updated: 4-8Â° is peak \"hunter eyes\"\n    idealMax: 8.0,\n    rangeMin: -5,\n    rangeMax: 20,\n    decayRate: 1.5,  // Reduced: gentler decay for positive tilts\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle of eye from inner to outer canthus. Positive tilt is attractive.',\n    profileType: 'front',\n    // DIRECTIONAL SCORING: Higher (positive) tilt is better\n    // - Ideal: 4-8Â° (attractive upswept eyes / \"hunter eyes\")\n    // - Good: 0-4Â° (neutral to slight positive - still attractive)\n    // - Weak: < 0Â° (negative/droopy tilt - only this is a true weakness)\n    polarity: 'higher_is_better',\n    safeFloor: 0.0,       // Neutral tilt - anything above is acceptable\n    softZoneScore: 8.0,   // \"Good\" score for 0-4Â° range\n  },\n\n  eyeAspectRatio: {\n    id: 'eyeAspectRatio',\n    name: 'Eye Aspect Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 3.0,\n    idealMax: 3.5,\n    rangeMin: 0.8,\n    rangeMax: 6,\n    decayRate: 2.0,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Eye width divided by eye height',\n    profileType: 'front',\n  },\n\n  eyeSeparationRatio: {\n    id: 'eyeSeparationRatio',\n    name: 'Eye Separation Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 45.7,\n    idealMax: 46.8,\n    rangeMin: 35,\n    rangeMax: 55,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Intercanthal distance as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryRatio: {\n    id: 'interpupillaryRatio',\n    name: 'Interpupillary Distance Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 44,\n    idealMax: 48,\n    rangeMin: 38,\n    rangeMax: 54,\n    decayRate: 1.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'IPD as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryMouthWidthRatio: {\n    id: 'interpupillaryMouthWidthRatio',\n    name: 'Interpupillary-Mouth Width Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.83,\n    idealMax: 0.87,\n    rangeMin: 0.6,\n    rangeMax: 1.1,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Mouth width divided by interpupillary distance',\n    profileType: 'front',\n  },\n\n  oneEyeApartTest: {\n    id: 'oneEyeApartTest',\n    name: 'One Eye Apart Test',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.95,\n    idealMax: 1.0,\n    rangeMin: 0.7,\n    rangeMax: 1.3,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Intercanthal distance should equal one eye width',\n    profileType: 'front',\n  },\n\n  tearTroughDepth: {\n    id: 'tearTroughDepth',\n    name: 'Tear Trough Depth',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.0,\n    idealMax: 1.5,\n    rangeMin: 0.0,\n    rangeMax: 4.0,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Under-eye hollow depth (infraorbital depression). Lower is better for youthfulness.',\n    profileType: 'front',\n    polarity: 'lower_is_better',\n    safeCeiling: 1.5,  // White standard\n    softZoneScore: 7.5,\n  },\n\n  upperEyelidExposure: {\n    id: 'upperEyelidExposure',\n    name: 'Upper Eyelid Exposure',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 2.5,\n    rangeMin: 0.0,\n    rangeMax: 5.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Visible upper eyelid platform. Too little creates hooded eyes.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  // EYEBROW MEASUREMENTS\n  eyebrowThickness: {\n    id: 'eyebrowThickness',\n    name: 'Eyebrow Thickness',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 2.0,\n    idealMax: 4.0,\n    rangeMin: 1.0,\n    rangeMax: 6.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow density and thickness. Higher values indicate fuller, denser brows.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  eyebrowDistance: {\n    id: 'eyebrowDistance',\n    name: 'Inter-Eyebrow Distance',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 15,\n    idealMax: 25,\n    rangeMin: 5,\n    rangeMax: 40,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance between inner edges of eyebrows. Too low creates unibrow (synophrys).',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  browLengthRatio: {\n    id: 'browLengthRatio',\n    name: 'Brow Length to Face Width Ratio',\n    category: 'Upper Third',\n    unit: 'percent',\n    idealMin: 28,\n    idealMax: 32,\n    rangeMin: 20,\n    rangeMax: 40,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow length as percentage of face width',\n    profileType: 'front',\n  },\n\n  eyebrowTilt: {\n    id: 'eyebrowTilt',\n    name: 'Eyebrow Tilt',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 6.5,\n    idealMax: 11,\n    rangeMin: -5,\n    rangeMax: 25,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of eyebrow from head to tail',\n    profileType: 'front',\n  },\n\n  eyebrowLowSetedness: {\n    id: 'eyebrowLowSetedness',\n    name: 'Eyebrow Low Setedness',\n    category: 'Upper Third',\n    unit: 'ratio',\n    idealMin: 0,\n    idealMax: 0.45,\n    rangeMin: -0.2,\n    rangeMax: 1.0,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from brow to eye relative to eye height',\n    profileType: 'front',\n  },\n\n  // NOSE MEASUREMENTS (FRONT)\n  nasalIndex: {\n    id: 'nasalIndex',\n    name: 'Nasal Index',\n    category: 'Nose',\n    unit: 'percent',\n    idealMin: 70,\n    idealMax: 85,\n    rangeMin: 55,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose width divided by nose height Ã— 100',\n    profileType: 'front',\n  },\n\n  intercanthalNasalRatio: {\n    id: 'intercanthalNasalRatio',\n    name: 'Intercanthal-Nasal Width Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 1.04,\n    idealMax: 1.16,\n    rangeMin: 0.7,\n    rangeMax: 1.5,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Alar width should roughly equal intercanthal distance',\n    profileType: 'front',\n  },\n\n  noseBridgeWidth: {\n    id: 'noseBridgeWidth',\n    name: 'Nose Bridge to Nose Width',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.6,\n    idealMax: 0.75,\n    rangeMin: 0.4,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ratio of nose bridge width to alar base width',\n    profileType: 'front',\n  },\n\n  noseTipPosition: {\n    id: 'noseTipPosition',\n    name: 'Nose Tip Position',\n    category: 'Nose',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 3.5,\n    rangeMin: -7.5,\n    rangeMax: 12.5,\n    decayRate: 1.5,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Nose tip deviation from facial midline',\n    profileType: 'front',\n  },\n\n  // MOUTH/LIP MEASUREMENTS\n  mouthWidthToNoseRatio: {\n    id: 'mouthWidthToNoseRatio',\n    name: 'Mouth Width to Nose Width Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.43,\n    idealMax: 1.51,\n    rangeMin: 0.96,\n    rangeMax: 1.91,\n    decayRate: 18.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Mouth width divided by nose width',\n    profileType: 'front',\n  },\n\n  lowerToUpperLipRatio: {\n    id: 'lowerToUpperLipRatio',\n    name: 'Lower Lip to Upper Lip Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.58,\n    idealMax: 1.88,\n    rangeMin: -0.98,\n    rangeMax: 4.03,\n    decayRate: 8.0,\n    maxScore: 7.5,  // FaceIQ: medium priority\n    weight: 0.02,\n    description: 'Lower lip height divided by upper lip height',\n    profileType: 'front',\n  },\n\n  cupidsBowDepth: {\n    id: 'cupidsBowDepth',\n    name: \"Cupid's Bow Depth\",\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2.3,\n    idealMax: 4,\n    rangeMin: 0,\n    rangeMax: 7,\n    decayRate: 2.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: \"Depth of the cupid's bow curve\",\n    profileType: 'front',\n  },\n\n  mouthCornerPosition: {\n    id: 'mouthCornerPosition',\n    name: 'Mouth Corner Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Mouth corner vertical position relative to lip center',\n    profileType: 'front',\n  },\n\n  // CHIN MEASUREMENTS (FRONT)\n  chinToPhiltrumRatio: {\n    id: 'chinToPhiltrumRatio',\n    name: 'Chin to Philtrum Ratio',\n    category: 'Chin',\n    unit: 'ratio',\n    idealMin: 2.15,\n    idealMax: 2.45,\n    rangeMin: 0.3,\n    rangeMax: 4.5,\n    decayRate: 10.0,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.02,\n    description: 'Chin height divided by philtrum length',\n    profileType: 'front',\n  },\n\n  // OTHER FRONT MEASUREMENTS\n  iaaJfaDeviation: {\n    id: 'iaaJfaDeviation',\n    name: 'Deviation of IAA & JFA',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 0,\n    idealMax: 2.5,\n    rangeMin: -25,\n    rangeMax: 30,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Deviation between Ipsilateral Alar Angle and Jaw Frontal Angle',\n    profileType: 'front',\n  },\n\n  ipsilateralAlarAngle: {\n    id: 'ipsilateralAlarAngle',\n    name: 'Ipsilateral Alar Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 60,\n    rangeMax: 125,\n    decayRate: 0.6,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Angle of alar base relative to facial plane',\n    profileType: 'front',\n  },\n\n  earProtrusionAngle: {\n    id: 'earProtrusionAngle',\n    name: 'Ear Protrusion Angle',\n    category: 'Ears',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 11.5,\n    rangeMin: -25,\n    rangeMax: 40,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of ear protrusion from head',\n    profileType: 'front',\n  },\n\n  earProtrusionRatio: {\n    id: 'earProtrusionRatio',\n    name: 'Ear Protrusion Ratio',\n    category: 'Ears',\n    unit: 'percent',\n    idealMin: 8,\n    idealMax: 12,\n    rangeMin: -20,\n    rangeMax: 40,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ear protrusion as percentage of head width',\n    profileType: 'front',\n  },\n\n  neckWidth: {\n    id: 'neckWidth',\n    name: 'Neck Width',\n    category: 'Neck',\n    unit: 'percent',\n    idealMin: 92,\n    idealMax: 98,\n    rangeMin: 60,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Neck width as percentage of jaw width',\n    profileType: 'front',\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS (38)\n  // ==========================================\n\n  gonialAngle: {\n    id: 'gonialAngle',\n    name: 'Gonial Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 130,\n    rangeMin: 105,\n    rangeMax: 145,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle at the jaw corner (gonion)',\n    profileType: 'side',\n  },\n\n  nasolabialAngle: {\n    id: 'nasolabialAngle',\n    name: 'Nasolabial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 90,\n    idealMax: 105,\n    rangeMin: 75,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle between columella and upper lip',\n    profileType: 'side',\n  },\n\n  nasofrontalAngle: {\n    id: 'nasofrontalAngle',\n    name: 'Nasofrontal Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 116,\n    idealMax: 128,\n    rangeMin: 90,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the bridge of nose (nasion)',\n    profileType: 'side',\n  },\n\n  nasofacialAngle: {\n    id: 'nasofacialAngle',\n    name: 'Nasofacial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 31,\n    idealMax: 35,\n    rangeMin: 15,\n    rangeMax: 50,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between nose and face plane',\n    profileType: 'side',\n  },\n\n  nasomentaAngle: {\n    id: 'nasomentaAngle',\n    name: 'Nasomental Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 126,\n    idealMax: 131,\n    rangeMin: 105,\n    rangeMax: 155,\n    decayRate: 0.7,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle from nasion to nose tip to chin',\n    profileType: 'side',\n  },\n\n  nasalTipAngle: {\n    id: 'nasalTipAngle',\n    name: 'Nasal Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 105,\n    rangeMin: 70,\n    rangeMax: 120,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the nose tip',\n    profileType: 'side',\n  },\n\n  nasalProjection: {\n    id: 'nasalProjection',\n    name: 'Nasal Projection',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.55,\n    idealMax: 0.6,\n    rangeMin: 0.4,\n    rangeMax: 0.75,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose projection relative to nasal length (Goode ratio)',\n    profileType: 'side',\n  },\n\n  nasalWToHRatio: {\n    id: 'nasalWToHRatio',\n    name: 'Nasal W to H Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.67,\n    idealMax: 0.78,\n    rangeMin: 0.5,\n    rangeMax: 0.95,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Nose width to height ratio from side view',\n    profileType: 'side',\n  },\n\n  noseTipRotationAngle: {\n    id: 'noseTipRotationAngle',\n    name: 'Nose Tip Rotation Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 95,\n    idealMax: 110,\n    rangeMin: 80,\n    rangeMax: 125,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of nose tip rotation',\n    profileType: 'side',\n  },\n\n  frankfortTipAngle: {\n    id: 'frankfortTipAngle',\n    name: 'Frankfort-Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 28,\n    idealMax: 34,\n    rangeMin: 20,\n    rangeMax: 42,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle between Frankfort plane and nose tip',\n    profileType: 'side',\n  },\n\n  mentolabialAngle: {\n    id: 'mentolabialAngle',\n    name: 'Mentolabial Angle',\n    category: 'Lips',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 140,\n    rangeMin: 100,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the labiomental fold',\n    profileType: 'side',\n  },\n\n  zAngle: {\n    id: 'zAngle',\n    name: 'Z Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 75,\n    idealMax: 85,\n    rangeMin: 60,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Merrifield Z-Angle for profile assessment',\n    profileType: 'side',\n  },\n\n  submentalCervicalAngle: {\n    id: 'submentalCervicalAngle',\n    name: 'Submental Cervical Angle',\n    category: 'Neck',\n    unit: 'degrees',\n    idealMin: 94,\n    idealMax: 106,\n    rangeMin: 70,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between chin and neck',\n    profileType: 'side',\n  },\n\n  facialConvexityGlabella: {\n    id: 'facialConvexityGlabella',\n    name: 'Facial Convexity (Glabella)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 165,\n    idealMax: 175,\n    rangeMin: 150,\n    rangeMax: 185,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Facial convexity angle using glabella',\n    profileType: 'side',\n  },\n\n  facialConvexityNasion: {\n    id: 'facialConvexityNasion',\n    name: 'Facial Convexity (Nasion)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 168,\n    idealMax: 178,\n    rangeMin: 155,\n    rangeMax: 190,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial convexity angle using nasion',\n    profileType: 'side',\n  },\n\n  totalFacialConvexity: {\n    id: 'totalFacialConvexity',\n    name: 'Total Facial Convexity',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 135,\n    idealMax: 145,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Complete facial profile convexity measurement',\n    profileType: 'side',\n  },\n\n  facialDepthToHeight: {\n    id: 'facialDepthToHeight',\n    name: 'Facial Depth to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.3,\n    idealMax: 1.44,\n    rangeMin: 0.7,\n    rangeMax: 1.8,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial depth divided by facial height',\n    profileType: 'side',\n  },\n\n  anteriorFacialDepth: {\n    id: 'anteriorFacialDepth',\n    name: 'Anterior Facial Depth',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 64.5,\n    idealMax: 67.5,\n    rangeMin: 45,\n    rangeMax: 95,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Anterior facial projection angle',\n    profileType: 'side',\n  },\n\n  interiorMidfaceProjectionAngle: {\n    id: 'interiorMidfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 50,\n    idealMax: 56,\n    rangeMin: 30,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Interior midface projection from side profile',\n    profileType: 'side',\n  },\n\n  recessionFromFrankfort: {\n    id: 'recessionFromFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'mm',\n    idealMin: 1.5,\n    idealMax: 15,\n    rangeMin: -30,\n    rangeMax: 30,\n    decayRate: 0.3,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin position relative to Frankfort plane',\n    profileType: 'side',\n  },\n\n  mandibularPlaneAngle: {\n    id: 'mandibularPlaneAngle',\n    name: 'Mandibular Plane Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 22,\n    idealMax: 28,\n    rangeMin: 15,\n    rangeMax: 38,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of mandibular plane to Frankfort plane',\n    profileType: 'side',\n  },\n\n  ramusToMandibleRatio: {\n    id: 'ramusToMandibleRatio',\n    name: 'Ramus to Mandible Ratio',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'ratio',\n    idealMin: 0.65,\n    idealMax: 0.75,\n    rangeMin: 0.5,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Ramus height divided by mandible length',\n    profileType: 'side',\n  },\n\n  gonionToMouthLine: {\n    id: 'gonionToMouthLine',\n    name: 'Gonion to Mouth Line',\n    category: 'Jaw Shape',\n    unit: 'mm',\n    idealMin: -5,\n    idealMax: 5,\n    rangeMin: -20,\n    rangeMax: 20,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from gonion to mouth level line',\n    profileType: 'side',\n  },\n\n  // E-LINE MEASUREMENTS\n  eLineUpperLip: {\n    id: 'eLineUpperLip',\n    name: 'Upper Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -4,\n    idealMax: -2,\n    rangeMin: -10,\n    rangeMax: 4,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Upper lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  eLineLowerLip: {\n    id: 'eLineLowerLip',\n    name: 'Lower Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 0,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Lower lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  // S-LINE MEASUREMENTS\n  sLineUpperLip: {\n    id: 'sLineUpperLip',\n    name: 'Upper Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 3,\n    rangeMin: -5,\n    rangeMax: 8,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  sLineLowerLip: {\n    id: 'sLineLowerLip',\n    name: 'Lower Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -0.4,\n    idealMax: 0.4,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  // BURSTONE LINE\n  burstoneUpperLip: {\n    id: 'burstoneUpperLip',\n    name: 'Upper Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2,\n    idealMax: 4,\n    rangeMin: -2,\n    rangeMax: 8,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  burstoneLowerLip: {\n    id: 'burstoneLowerLip',\n    name: 'Lower Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 1,\n    idealMax: 3,\n    rangeMin: -3,\n    rangeMax: 7,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  // H LINE\n  holdawayHLine: {\n    id: 'holdawayHLine',\n    name: 'Holdaway H Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Holdaway H-line soft tissue assessment',\n    profileType: 'side',\n  },\n\n  // CHIN MEASUREMENTS (SIDE)\n  chinProjection: {\n    id: 'chinProjection',\n    name: 'Chin Projection',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -3,\n    idealMax: 3,\n    rangeMin: -12,\n    rangeMax: 12,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin projection relative to ideal position',\n    profileType: 'side',\n  },\n\n  recessionRelativeToFrankfort: {\n    id: 'recessionRelativeToFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 2,\n    rangeMin: -10,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin recession relative to Frankfort horizontal',\n    profileType: 'side',\n  },\n\n  // FOREHEAD\n  browridgeInclinationAngle: {\n    id: 'browridgeInclinationAngle',\n    name: 'Browridge Inclination Angle',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 18,\n    rangeMin: 0,\n    rangeMax: 28,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the brow ridge from profile',\n    profileType: 'side',\n  },\n\n  upperForeheadSlope: {\n    id: 'upperForeheadSlope',\n    name: 'Upper Forehead Slope',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 5,\n    idealMax: 12,\n    rangeMin: 0,\n    rangeMax: 20,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Slope angle of the upper forehead',\n    profileType: 'side',\n  },\n\n  // MIDFACE PROJECTION\n  midfaceProjectionAngle: {\n    id: 'midfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 95,\n    rangeMin: 75,\n    rangeMax: 105,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of midface projection from profile',\n    profileType: 'side',\n  },\n\n  orbitalVector: {\n    id: 'orbitalVector',\n    name: 'Orbital Vector',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -6,\n    rangeMax: 10,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Relationship of globe to orbital rim',\n    profileType: 'side',\n  },\n\n  skinUniformity: {\n    id: 'skinUniformity',\n    name: 'Skin Uniformity',\n    category: 'Skin Quality',\n    unit: 'ratio',\n    idealMin: 0.90,\n    idealMax: 1.00,\n    rangeMin: 0.50,\n    rangeMax: 1.00,\n    decayRate: 5.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Skin tone evenness and hyperpigmentation. 1.0 = perfectly uniform.',\n    profileType: 'front',\n    polarity: 'higher_is_better',\n    safeFloor: 0.85,  // Acceptable uniformity threshold\n    softZoneScore: 7.5,\n  },\n\n};\n\n// ============================================\n// FLAW MAPPINGS (Extracted from FaceIQ)\n// ============================================\n\nexport interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n  reasoning: string;\n}\n\nexport const METRIC_FLAW_MAPPINGS: Record<string, FlawMapping[]> = {\n  anteriorFacialDepth: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Anterior Facial Depth measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  bitemporalWidth: [\n    { category: 'Upper Third', flawName: 'Narrow forehead', confidence: 'confirmed', reasoning: 'Reduced bitemporal width indicates a narrower than ideal forehead relative to the cheekbones. This disrupts facial harmony by creating a compressed hairline and forehead, altering the overall shape of the face.' },\n  ],\n  cheekboneHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Low-set cheekbones', confidence: 'confirmed', reasoning: 'Reduced cheekbone height indicates that the cheekbones are positioned lower than ideal. This disrupts facial harmony by creating an unpronounced appearance to the cheekbones and facial structure.' },\n  ],\n  eyeAspectRatio: [\n    { category: 'Eyes', flawName: 'Overly round eye shape', confidence: 'confirmed', reasoning: 'A reduced eye aspect ratio indicates overly narrow eyes relative to their height. This disrupts facial harmony by creating an overly surprised appearance and reducing angular definition.' },\n  ],\n  eyeSeparationRatio: [\n    { category: 'Eyes', flawName: 'Close-set eyes', confidence: 'confirmed', reasoning: 'Reduced eye separation indicates close-set eyes. This disrupts facial harmony by making the eye area appear too compressed.' },\n  ],\n  eyebrowLowSetedness: [\n    { category: 'Eyes', flawName: 'Medium-set eyebrows', confidence: 'confirmed', reasoning: 'Increased eyebrow low setedness indicates eyebrows that are positioned higher than ideal. This disrupts facial harmony by reducing the overall visual impact of the eyebrows and framing of the eyes.' },\n  ],\n  faceWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced face width to height ratio indicates an overly long midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  facialDepthToHeight: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'Reduced facial depth to height ratio indicates insufficient mid-face projection relative to height. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  gonialAngle: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  holdawayHLine: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'Decreased H-line indicates the lips are positioned too far in front of the line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  interiorMidfaceProjectionAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Interior Midface Projection Angle measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  ipsilateralAlarAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A decreased ipsilateral alar angle indicates an overly narrow interior midface. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  jawFrontalAngle: [\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A narrower jaw frontal angle indicates a steeper jawline or overly wide chin. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  jawSlope: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'The Jaw Slope measurement is above the ideal range. This disrupts facial harmony in the lower face.' },\n  ],\n  lateralCanthalTilt: [\n    { category: 'Eyes', flawName: 'Insufficient eye tilt', confidence: 'confirmed', reasoning: 'A decreased lateral canthal tilt indicates insufficiently upturned eyes. This disrupts facial harmony by creating a less alert and youthful appearance.' },\n  ],\n  burstoneLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the Burstone line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  eLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned too far in front of the E-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  sLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the S-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  lowerThirdProportion: [\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'The upper jaw is too long relative to lower jaw, possibly from a long upper jaw or short lower jaw, or a combination of both. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  mandibularPlaneAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Hyper-divergent jaw growth', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by elongating the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  midfaceRatio: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  nasofacialAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A smaller nasofacial angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  nasofrontalAngle: [\n    { category: 'Upper Third', flawName: 'Soft and weak brow ridge', confidence: 'confirmed', reasoning: 'An increased nasofrontal angle indicates reduced brow ridge prominence and angularity. This disrupts facial harmony by creating a less defined upper face.' },\n  ],\n  nasomentaAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A larger nasomental angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  noseBridgeWidth: [\n    { category: 'Nose', flawName: 'Overly narrow nose bridge', confidence: 'confirmed', reasoning: 'The Nose Bridge to Nose Width measurement is above the ideal range. This disrupts facial harmony by creating an unbalanced nasal profile.' },\n  ],\n  orbitalVector: [\n    { category: 'Eyes', flawName: 'Sunken orbital region', confidence: 'confirmed', reasoning: 'A decreased orbital vector indicates insufficient projection and volume underneath the eye. This disrupts facial harmony due to the lacking volume underneath the eyes, reducing vibrancy and youthfulness.' },\n  ],\n  ramusToMandibleRatio: [\n    { category: 'Jaw Shape', flawName: 'Short ramus', confidence: 'confirmed', reasoning: 'A reduced ramus-to-mandible ratio indicates a shorter than ideal vertical jawbone (ramus) when compared to the mandible. This disrupts facial harmony by reducing jaw height and definition.' },\n  ],\n  submentalCervicalAngle: [\n    { category: 'Neck', flawName: 'Round neck region', confidence: 'confirmed', reasoning: 'An increased submental cervical angle indicates a round neck region, possibly from excess submental fat or tissue. This disrupts facial harmony by reducing neck definition.' },\n  ],\n  totalFacialWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Overly long face shape', confidence: 'confirmed', reasoning: 'An increased total facial width to height ratio indicates an overly long face relative to its height. This disrupts facial harmony by creating a vertically stretched appearance to the face.' },\n  ],\n};\n\n// ============================================\n// CUSTOM BEZIER CURVES (Extracted from FaceIQ)\n// ============================================\n\nexport const METRIC_CUSTOM_CURVES: Record<string, CurvePoint[]> = {\n  faceWidthToHeight: [\n    { x: 1.49, y: 0, leftHandleX: 1.44, leftHandleY: 0, rightHandleX: 1.55, rightHandleY: 0 },\n    { x: 1.68, y: 1.05, leftHandleX: 1.62, leftHandleY: 0.36, rightHandleX: 1.71, rightHandleY: 1.58 },\n    { x: 1.77, y: 3.07, leftHandleX: 1.74, leftHandleY: 2.15, rightHandleX: 1.79, rightHandleY: 3.88 },\n    { x: 1.83, y: 5.83, leftHandleX: 1.80, leftHandleY: 4.64, rightHandleX: 1.84, rightHandleY: 6.85 },\n    { x: 1.89, y: 8.70, leftHandleX: 1.88, leftHandleY: 8.30, rightHandleX: 1.92, rightHandleY: 9.50 },\n    { x: 1.96, y: 10, leftHandleX: 1.96, leftHandleY: 10, rightHandleX: 1.96, rightHandleY: 10, fixed: true },\n    { x: 2.00, y: 10, leftHandleX: 2.00, leftHandleY: 10, rightHandleX: 2.00, rightHandleY: 10, fixed: true },\n    { x: 2.07, y: 8.70, leftHandleX: 2.04, leftHandleY: 9.50, rightHandleX: 2.08, rightHandleY: 8.30 },\n    { x: 2.13, y: 5.83, leftHandleX: 2.12, leftHandleY: 6.85, rightHandleX: 2.16, rightHandleY: 4.64 },\n    { x: 2.19, y: 3.07, leftHandleX: 2.17, leftHandleY: 3.88, rightHandleX: 2.22, rightHandleY: 2.15 },\n    { x: 2.28, y: 1.05, leftHandleX: 2.25, leftHandleY: 1.58, rightHandleX: 2.34, rightHandleY: 0.36 },\n    { x: 2.47, y: 0, leftHandleX: 2.41, leftHandleY: 0, rightHandleX: 2.52, rightHandleY: 0 },\n  ],\n  lowerThirdProportion: [\n    { x: 25.6, y: 0, leftHandleX: 24.8, leftHandleY: 0, rightHandleX: 26.4, rightHandleY: 0 },\n    { x: 28.01, y: 1.58, leftHandleX: 27.23, leftHandleY: 0.53, rightHandleX: 28.27, rightHandleY: 1.97 },\n    { x: 28.83, y: 3.21, leftHandleX: 28.60, leftHandleY: 2.60, rightHandleX: 29.10, rightHandleY: 3.90 },\n    { x: 29.63, y: 5.85, leftHandleX: 29.40, leftHandleY: 4.90, rightHandleX: 29.85, rightHandleY: 6.80 },\n    { x: 30.27, y: 8.56, leftHandleX: 30.05, leftHandleY: 7.80, rightHandleX: 30.50, rightHandleY: 9.30 },\n    { x: 31, y: 10, leftHandleX: 30.95, leftHandleY: 10, rightHandleX: 31.05, rightHandleY: 10, fixed: true },\n    { x: 33.5, y: 10, leftHandleX: 33.45, leftHandleY: 10, rightHandleX: 33.55, rightHandleY: 10, fixed: true },\n    { x: 34.23, y: 8.56, leftHandleX: 34.00, leftHandleY: 9.30, rightHandleX: 34.45, rightHandleY: 7.80 },\n    { x: 34.87, y: 5.85, leftHandleX: 34.65, leftHandleY: 6.80, rightHandleX: 35.10, rightHandleY: 4.90 },\n    { x: 35.67, y: 3.21, leftHandleX: 35.40, leftHandleY: 3.90, rightHandleX: 35.90, rightHandleY: 2.60 },\n    { x: 36.49, y: 1.58, leftHandleX: 36.23, leftHandleY: 1.97, rightHandleX: 37.27, rightHandleY: 0.53 },\n    { x: 38.9, y: 0, leftHandleX: 38.1, leftHandleY: 0, rightHandleX: 39.7, rightHandleY: 0 },\n  ],\n  lateralCanthalTilt: [\n    { x: -4.5, y: 0, leftHandleX: -5.5, leftHandleY: 0, rightHandleX: -3.5, rightHandleY: 0 },\n    { x: 0.5, y: 1.2, leftHandleX: -0.8, leftHandleY: 0.4, rightHandleX: 1.5, rightHandleY: 1.8 },\n    { x: 2.8, y: 3.5, leftHandleX: 2.2, leftHandleY: 2.5, rightHandleX: 3.4, rightHandleY: 4.3 },\n    { x: 4.5, y: 6.8, leftHandleX: 4.0, leftHandleY: 5.5, rightHandleX: 5.0, rightHandleY: 7.8 },\n    { x: 5.8, y: 9.2, leftHandleX: 5.4, leftHandleY: 8.5, rightHandleX: 5.95, rightHandleY: 9.7 },\n    { x: 6.1, y: 10, leftHandleX: 6.05, leftHandleY: 10, rightHandleX: 6.15, rightHandleY: 10, fixed: true },\n    { x: 7.8, y: 10, leftHandleX: 7.75, leftHandleY: 10, rightHandleX: 7.85, rightHandleY: 10, fixed: true },\n    { x: 8.1, y: 9.2, leftHandleX: 7.95, leftHandleY: 9.7, rightHandleX: 8.5, rightHandleY: 8.5 },\n    { x: 9.4, y: 6.8, leftHandleX: 8.9, leftHandleY: 7.8, rightHandleX: 9.9, rightHandleY: 5.5 },\n    { x: 11.1, y: 3.5, leftHandleX: 10.5, leftHandleY: 4.3, rightHandleX: 11.7, rightHandleY: 2.5 },\n    { x: 13.4, y: 1.2, leftHandleX: 12.4, leftHandleY: 1.8, rightHandleX: 14.7, rightHandleY: 0.4 },\n    { x: 18.4, y: 0, leftHandleX: 17.4, leftHandleY: 0, rightHandleX: 19.4, rightHandleY: 0 },\n  ],\n  gonialAngle: [\n    { x: 105, y: 0, leftHandleX: 102, leftHandleY: 0, rightHandleX: 108, rightHandleY: 0 },\n    { x: 112, y: 1.5, leftHandleX: 110, leftHandleY: 0.5, rightHandleX: 114, rightHandleY: 2.3 },\n    { x: 116, y: 4.2, leftHandleX: 114.5, leftHandleY: 3.0, rightHandleX: 117.5, rightHandleY: 5.2 },\n    { x: 118.5, y: 7.5, leftHandleX: 117.5, leftHandleY: 6.3, rightHandleX: 119.5, rightHandleY: 8.5 },\n    { x: 120, y: 10, leftHandleX: 119.7, leftHandleY: 10, rightHandleX: 120.3, rightHandleY: 10, fixed: true },\n    { x: 130, y: 10, leftHandleX: 129.7, leftHandleY: 10, rightHandleX: 130.3, rightHandleY: 10, fixed: true },\n    { x: 131.5, y: 7.5, leftHandleX: 130.5, leftHandleY: 8.5, rightHandleX: 132.5, rightHandleY: 6.3 },\n    { x: 134, y: 4.2, leftHandleX: 132.5, leftHandleY: 5.2, rightHandleX: 135.5, rightHandleY: 3.0 },\n    { x: 138, y: 1.5, leftHandleX: 136, leftHandleY: 2.3, rightHandleX: 140, rightHandleY: 0.5 },\n    { x: 145, y: 0, leftHandleX: 142, leftHandleY: 0, rightHandleX: 148, rightHandleY: 0 },\n  ],\n  nasolabialAngle: [\n    { x: 75, y: 0, leftHandleX: 72, leftHandleY: 0, rightHandleX: 78, rightHandleY: 0 },\n    { x: 82, y: 2.0, leftHandleX: 79.5, leftHandleY: 0.7, rightHandleX: 84, rightHandleY: 3.0 },\n    { x: 86, y: 5.5, leftHandleX: 84.5, leftHandleY: 4.2, rightHandleX: 87.5, rightHandleY: 6.8 },\n    { x: 89, y: 8.8, leftHandleX: 88, leftHandleY: 7.8, rightHandleX: 89.7, rightHandleY: 9.5 },\n    { x: 90, y: 10, leftHandleX: 89.8, leftHandleY: 10, rightHandleX: 90.2, rightHandleY: 10, fixed: true },\n    { x: 105, y: 10, leftHandleX: 104.8, leftHandleY: 10, rightHandleX: 105.2, rightHandleY: 10, fixed: true },\n    { x: 106, y: 8.8, leftHandleX: 105.3, leftHandleY: 9.5, rightHandleX: 107, rightHandleY: 7.8 },\n    { x: 109, y: 5.5, leftHandleX: 107.5, leftHandleY: 6.8, rightHandleX: 110.5, rightHandleY: 4.2 },\n    { x: 113, y: 2.0, leftHandleX: 111, leftHandleY: 3.0, rightHandleX: 115.5, rightHandleY: 0.7 },\n    { x: 120, y: 0, leftHandleX: 117, leftHandleY: 0, rightHandleX: 123, rightHandleY: 0 },\n  ],\n  // Middle Third Proportion curve (ideal: 31.4-33.4%)\n  middleThirdProportion: [\n    { x: 21.44, y: 0, leftHandleX: 20.29, leftHandleY: 0, rightHandleX: 23.19, rightHandleY: 0.15 },\n    { x: 25.5, y: 1.35, leftHandleX: 24.18, leftHandleY: 0.53, rightHandleX: 26.17, rightHandleY: 1.79 },\n    { x: 27.34, y: 3.18, leftHandleX: 26.84, leftHandleY: 2.42, rightHandleX: 27.73, rightHandleY: 3.81 },\n    { x: 28.65, y: 5.88, leftHandleX: 28.33, leftHandleY: 4.91, rightHandleX: 28.98, rightHandleY: 6.65 },\n    { x: 29.95, y: 8.55, leftHandleX: 29.41, leftHandleY: 7.58, rightHandleX: 30.45, rightHandleY: 9.35 },\n    { x: 31.4, y: 10, leftHandleX: 31.3, leftHandleY: 10, rightHandleX: 31.5, rightHandleY: 10, fixed: true },\n    { x: 33.4, y: 10, leftHandleX: 33.3, leftHandleY: 10, rightHandleX: 33.5, rightHandleY: 10, fixed: true },\n    { x: 34.85, y: 8.55, leftHandleX: 34.35, leftHandleY: 9.35, rightHandleX: 35.39, rightHandleY: 7.58 },\n    { x: 36.15, y: 5.88, leftHandleX: 35.82, leftHandleY: 6.65, rightHandleX: 36.47, rightHandleY: 4.91 },\n    { x: 37.46, y: 3.18, leftHandleX: 37.07, leftHandleY: 3.81, rightHandleX: 37.96, rightHandleY: 2.42 },\n    { x: 39.3, y: 1.35, leftHandleX: 38.63, leftHandleY: 1.79, rightHandleX: 40.62, rightHandleY: 0.53 },\n    { x: 43.36, y: 0, leftHandleX: 41.61, leftHandleY: 0.15, rightHandleX: 44.51, rightHandleY: 0 },\n  ],\n  // Upper Third Proportion curve (ideal: 30-32%)\n  upperThirdProportion: [\n    { x: 18.75, y: 0.02, leftHandleX: 17.15, leftHandleY: 0.02, rightHandleX: 20.35, rightHandleY: 0.02 },\n    { x: 23.82, y: 1.52, leftHandleX: 22.35, leftHandleY: 0.8, rightHandleX: 24.73, rightHandleY: 2.06 },\n    { x: 26.05, y: 4.06, leftHandleX: 25.48, leftHandleY: 2.86, rightHandleX: 26.41, rightHandleY: 4.99 },\n    { x: 27.19, y: 6.79, leftHandleX: 26.96, leftHandleY: 6.16, rightHandleX: 27.66, rightHandleY: 7.85 },\n    { x: 28.54, y: 9.08, leftHandleX: 28.02, leftHandleY: 8.5, rightHandleX: 28.93, rightHandleY: 9.54 },\n    { x: 30, y: 10, leftHandleX: 29.9, leftHandleY: 10, rightHandleX: 30.1, rightHandleY: 10, fixed: true },\n    { x: 32, y: 10, leftHandleX: 31.9, leftHandleY: 10, rightHandleX: 32.1, rightHandleY: 10, fixed: true },\n    { x: 33.46, y: 9.08, leftHandleX: 33.07, leftHandleY: 9.54, rightHandleX: 33.98, rightHandleY: 8.5 },\n    { x: 34.81, y: 6.79, leftHandleX: 34.34, leftHandleY: 7.85, rightHandleX: 35.04, rightHandleY: 6.16 },\n    { x: 35.95, y: 4.06, leftHandleX: 35.59, leftHandleY: 4.99, rightHandleX: 36.52, rightHandleY: 2.86 },\n    { x: 38.18, y: 1.52, leftHandleX: 37.27, leftHandleY: 2.06, rightHandleX: 39.65, rightHandleY: 0.8 },\n    { x: 43.25, y: 0.02, leftHandleX: 41.65, leftHandleY: 0.02, rightHandleX: 44.85, rightHandleY: 0.02 },\n  ],\n  // Eye Separation Ratio curve (ideal: 45.7-46.8%)\n  eyeSeparationRatio: [\n    { x: 36.54, y: 0, leftHandleX: 35.44, leftHandleY: 0, rightHandleX: 37.40, rightHandleY: 0.04 },\n    { x: 39.04, y: 0.63, leftHandleX: 38.16, leftHandleY: 0.21, rightHandleX: 39.77, rightHandleY: 1.05 },\n    { x: 41.08, y: 2.17, leftHandleX: 40.57, leftHandleY: 1.71, rightHandleX: 41.62, rightHandleY: 2.76 },\n    { x: 42.71, y: 4.74, leftHandleX: 42.26, leftHandleY: 3.81, rightHandleX: 43.08, rightHandleY: 5.52 },\n    { x: 43.94, y: 7.37, leftHandleX: 43.65, leftHandleY: 6.79, rightHandleX: 44.17, rightHandleY: 7.77 },\n    { x: 44.86, y: 9.02, leftHandleX: 44.54, leftHandleY: 8.56, rightHandleX: 45.08, rightHandleY: 9.5 },\n    { x: 45.7, y: 10, leftHandleX: 45.65, leftHandleY: 10, rightHandleX: 45.76, rightHandleY: 10, fixed: true },\n    { x: 46.8, y: 10, leftHandleX: 46.75, leftHandleY: 10, rightHandleX: 46.86, rightHandleY: 10, fixed: true },\n    { x: 47.64, y: 9.02, leftHandleX: 47.42, leftHandleY: 9.5, rightHandleX: 47.96, rightHandleY: 8.56 },\n    { x: 48.56, y: 7.37, leftHandleX: 48.33, leftHandleY: 7.77, rightHandleX: 48.85, rightHandleY: 6.79 },\n    { x: 49.79, y: 4.74, leftHandleX: 49.42, leftHandleY: 5.52, rightHandleX: 50.24, rightHandleY: 3.81 },\n    { x: 51.42, y: 2.17, leftHandleX: 50.88, leftHandleY: 2.76, rightHandleX: 51.93, rightHandleY: 1.71 },\n    { x: 53.46, y: 0.63, leftHandleX: 52.73, leftHandleY: 1.05, rightHandleX: 54.34, rightHandleY: 0.21 },\n    { x: 55.96, y: 0, leftHandleX: 55.10, leftHandleY: 0.04, rightHandleX: 57.06, rightHandleY: 0 },\n  ],\n  // Eyebrow Low Setedness curve (ideal: 0-0.45)\n  eyebrowLowSetedness: [\n    { x: -2.78, y: 0, leftHandleX: -3.11, leftHandleY: 0, rightHandleX: -2.67, rightHandleY: 0 },\n    { x: -1.94, y: 0.4, leftHandleX: -2.08, leftHandleY: 0.11, rightHandleX: -1.81, rightHandleY: 0.57 },\n    { x: -1.18, y: 2.25, leftHandleX: -1.36, leftHandleY: 1.5, rightHandleX: -1.05, rightHandleY: 2.72 },\n    { x: -0.79, y: 4.06, leftHandleX: -0.88, leftHandleY: 3.43, rightHandleX: -0.68, rightHandleY: 4.84 },\n    { x: -0.55, y: 6.21, leftHandleX: -0.58, leftHandleY: 5.55, rightHandleX: -0.47, rightHandleY: 6.92 },\n    { x: -0.28, y: 8.76, leftHandleX: -0.37, leftHandleY: 8.23, rightHandleX: -0.23, rightHandleY: 9.22 },\n    { x: 0, y: 10, leftHandleX: -0.02, leftHandleY: 10, rightHandleX: 0.02, rightHandleY: 10, fixed: true },\n    { x: 0.45, y: 10, leftHandleX: 0.43, leftHandleY: 10, rightHandleX: 0.47, rightHandleY: 10, fixed: true },\n    { x: 0.73, y: 8.76, leftHandleX: 0.68, leftHandleY: 9.22, rightHandleX: 0.82, rightHandleY: 8.23 },\n    { x: 1, y: 6.21, leftHandleX: 0.92, leftHandleY: 6.92, rightHandleX: 1.03, rightHandleY: 5.55 },\n    { x: 1.24, y: 4.06, leftHandleX: 1.13, leftHandleY: 4.84, rightHandleX: 1.33, rightHandleY: 3.43 },\n    { x: 1.63, y: 2.25, leftHandleX: 1.50, leftHandleY: 2.72, rightHandleX: 1.81, rightHandleY: 1.5 },\n    { x: 2.39, y: 0.4, leftHandleX: 2.26, leftHandleY: 0.57, rightHandleX: 2.53, rightHandleY: 0.11 },\n    { x: 3.23, y: 0, leftHandleX: 3.12, leftHandleY: 0, rightHandleX: 3.56, rightHandleY: 0 },\n  ],\n  // Submental Cervical Angle curve (ideal: 94-106Â°)\n  submentalCervicalAngle: [\n    { x: 50.48, y: 0, leftHandleX: 44.48, leftHandleY: 0, rightHandleX: 56.48, rightHandleY: 0 },\n    { x: 68.31, y: 1.31, leftHandleX: 62.07, leftHandleY: 0.32, rightHandleX: 72.89, rightHandleY: 2.13 },\n    { x: 77.76, y: 3.71, leftHandleX: 76.00, leftHandleY: 2.89, rightHandleX: 80.39, rightHandleY: 4.59 },\n    { x: 83.99, y: 6.53, leftHandleX: 82.63, leftHandleY: 5.85, rightHandleX: 85.16, rightHandleY: 7.12 },\n    { x: 88.28, y: 8.86, leftHandleX: 86.43, leftHandleY: 7.85, rightHandleX: 89.95, rightHandleY: 9.71 },\n    { x: 94, y: 10, leftHandleX: 93.4, leftHandleY: 10, rightHandleX: 94.6, rightHandleY: 10, fixed: true },\n    { x: 106, y: 10, leftHandleX: 105.4, leftHandleY: 10, rightHandleX: 106.6, rightHandleY: 10, fixed: true },\n    { x: 111.72, y: 8.86, leftHandleX: 110.05, leftHandleY: 9.71, rightHandleX: 113.57, rightHandleY: 7.85 },\n    { x: 116.01, y: 6.53, leftHandleX: 114.84, leftHandleY: 7.12, rightHandleX: 117.37, rightHandleY: 5.85 },\n    { x: 122.24, y: 3.71, leftHandleX: 119.61, leftHandleY: 4.59, rightHandleX: 124.00, rightHandleY: 2.89 },\n    { x: 131.69, y: 1.31, leftHandleX: 127.11, leftHandleY: 2.13, rightHandleX: 137.93, rightHandleY: 0.32 },\n    { x: 149.52, y: 0, leftHandleX: 143.52, leftHandleY: 0, rightHandleX: 155.52, rightHandleY: 0 },\n  ],\n  // Facial Convexity (Glabella) curve (ideal: 169-174Â°)\n  facialConvexityGlabella: [\n    { x: 149.21, y: 0, leftHandleX: 146.21, leftHandleY: 0, rightHandleX: 152.21, rightHandleY: 0 },\n    { x: 158.07, y: 1.41, leftHandleX: 156.03, leftHandleY: 0.74, rightHandleX: 159.63, rightHandleY: 2 },\n    { x: 162.12, y: 4.09, leftHandleX: 161.34, leftHandleY: 3.31, rightHandleX: 163.09, rightHandleY: 5.03 },\n    { x: 165.14, y: 7.76, leftHandleX: 164.46, leftHandleY: 6.56, rightHandleX: 165.54, rightHandleY: 8.29 },\n    { x: 166.65, y: 9.14, leftHandleX: 165.92, leftHandleY: 8.72, rightHandleX: 167.43, rightHandleY: 9.67 },\n    { x: 169, y: 10, leftHandleX: 168.75, leftHandleY: 10, rightHandleX: 169.25, rightHandleY: 10, fixed: true },\n    { x: 174, y: 10, leftHandleX: 173.75, leftHandleY: 10, rightHandleX: 174.25, rightHandleY: 10, fixed: true },\n    { x: 176.35, y: 9.14, leftHandleX: 175.57, leftHandleY: 9.67, rightHandleX: 177.08, rightHandleY: 8.72 },\n    { x: 177.86, y: 7.76, leftHandleX: 177.46, leftHandleY: 8.29, rightHandleX: 178.54, rightHandleY: 6.56 },\n    { x: 180.88, y: 4.09, leftHandleX: 179.91, leftHandleY: 5.03, rightHandleX: 181.66, rightHandleY: 3.31 },\n    { x: 184.93, y: 1.41, leftHandleX: 183.37, leftHandleY: 2, rightHandleX: 186.97, rightHandleY: 0.74 },\n    { x: 193.79, y: 0, leftHandleX: 190.79, leftHandleY: 0, rightHandleX: 196.79, rightHandleY: 0 },\n  ],\n};\n\n// ============================================\n// CATEGORY DEFINITIONS\n// ============================================\n\nexport const MEASUREMENT_CATEGORIES = {\n  'Midface/Face Shape': { color: '#67e8f9', weight: 0.20 },\n  'Occlusion/Jaw Growth': { color: '#a78bfa', weight: 0.15 },\n  'Jaw Shape': { color: '#f97316', weight: 0.13 },\n  'Upper Third': { color: '#84cc16', weight: 0.08 },\n  'Eyes': { color: '#06b6d4', weight: 0.12 },\n  'Nose': { color: '#fbbf24', weight: 0.10 },\n  'Lips': { color: '#ec4899', weight: 0.10 },\n  'Chin': { color: '#ef4444', weight: 0.06 },\n  'Neck': { color: '#14b8a6', weight: 0.03 },\n  'Other': { color: '#6b7280', weight: 0.03 },\n};\n\n// ============================================\n// CORE SCORING FUNCTIONS\n// ============================================\n\n/**\n * FaceIQ Exponential Decay Scoring Algorithm with Directional/Dimorphic Support\n *\n * Standard: score = maxScore Ã— e^(-decayRate Ã— deviation)\n *\n * Directional scoring (polarity):\n * - 'higher_is_better': Values above safeFloor but below ideal get softZoneScore\n *   Example: Canthal Tilt of 3Â° is still positive/good, just not peak ideal (6-8Â°)\n * - 'lower_is_better': Values below safeCeiling but above ideal get softZoneScore\n *   Example: Short philtrum is still attractive even if shorter than \"ideal\"\n */\nexport function calculateFaceIQScore(\n  value: number,\n  config: MetricConfig\n): number {\n  const {\n    idealMin,\n    idealMax,\n    decayRate,\n    maxScore,\n    customCurve,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n    softZoneScore = 8.0, // Default \"Good\" score for acceptable-but-not-ideal values\n  } = config;\n\n  // Use custom curve if available\n  if (customCurve && customCurve.mode === 'custom') {\n    return interpolateCustomCurve(value, customCurve.points, maxScore);\n  }\n\n  // Perfect score within ideal range\n  if (value >= idealMin && value <= idealMax) {\n    return maxScore;\n  }\n\n  // Handle directional/dimorphic scoring\n  if (polarity === 'higher_is_better' && safeFloor !== undefined) {\n    // Higher values are good. Only values below safeFloor are true weaknesses.\n    if (value >= safeFloor && value < idealMin) {\n      // Value is in the \"acceptable but not ideal\" zone\n      // Give a passing score that decreases linearly as we approach the floor\n      const zoneRange = idealMin - safeFloor;\n      const distanceFromIdeal = idealMin - value;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMin â†’ maxScore, safeFloor â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value >= idealMax) {\n      // Values above ideal are still excellent for 'higher_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = value - idealMax;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Below safeFloor - apply normal (or harsher) exponential decay\n    if (value < safeFloor) {\n      const deviation = safeFloor - value;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  if (polarity === 'lower_is_better' && safeCeiling !== undefined) {\n    // Lower values are good. Only values above safeCeiling are true weaknesses.\n    if (value <= safeCeiling && value > idealMax) {\n      // Value is in the \"acceptable but not ideal\" zone\n      const zoneRange = safeCeiling - idealMax;\n      const distanceFromIdeal = value - idealMax;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMax â†’ maxScore, safeCeiling â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value <= idealMin) {\n      // Values below ideal are still excellent for 'lower_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = idealMin - value;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Above safeCeiling - apply normal exponential decay\n    if (value > safeCeiling) {\n      const deviation = value - safeCeiling;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  // Default balanced scoring: deviation in either direction is equally bad\n  const deviation = value < idealMin\n    ? idealMin - value\n    : value - idealMax;\n\n  // Exponential decay\n  const score = maxScore * Math.exp(-decayRate * deviation);\n\n  return Math.max(0, Math.min(maxScore, score));\n}\n\n/**\n * Check if a metric value is in an \"acceptable\" zone (not a true weakness).\n * Used by InsightsEngine to prevent false positives.\n */\nexport function isValueAcceptable(\n  value: number,\n  config: MetricConfig\n): { acceptable: boolean; reason: string } {\n  const {\n    idealMin,\n    idealMax,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n  } = config;\n\n  // Within ideal range is always acceptable\n  if (value >= idealMin && value <= idealMax) {\n    return { acceptable: true, reason: 'within_ideal' };\n  }\n\n  // Check directional acceptability\n  if (polarity === 'higher_is_better') {\n    if (value >= idealMax) {\n      return { acceptable: true, reason: 'above_ideal_higher_is_better' };\n    }\n    if (safeFloor !== undefined && value >= safeFloor) {\n      return { acceptable: true, reason: 'above_safe_floor' };\n    }\n    // Below safe floor - true weakness\n    return { acceptable: false, reason: 'below_safe_floor' };\n  }\n\n  if (polarity === 'lower_is_better') {\n    if (value <= idealMin) {\n      return { acceptable: true, reason: 'below_ideal_lower_is_better' };\n    }\n    if (safeCeiling !== undefined && value <= safeCeiling) {\n      return { acceptable: true, reason: 'below_safe_ceiling' };\n    }\n    // Above safe ceiling - true weakness\n    return { acceptable: false, reason: 'above_safe_ceiling' };\n  }\n\n  // Balanced polarity - outside ideal is not acceptable\n  return { acceptable: false, reason: 'outside_ideal_balanced' };\n}\n\n/**\n * Interpolate custom Bezier curve for scoring\n * Uses cubic Bezier interpolation with control handles for smooth curves\n */\nfunction interpolateCustomCurve(\n  value: number,\n  points: CurvePoint[],\n  maxScore: number\n): number {\n  void maxScore; // Reserved for future custom curve implementations\n  if (points.length === 0) return 0;\n\n  // Sort points by x value\n  const sortedPoints = [...points].sort((a, b) => a.x - b.x);\n\n  // Clamp to range\n  if (value <= sortedPoints[0].x) return sortedPoints[0].y;\n  if (value >= sortedPoints[sortedPoints.length - 1].x) {\n    return sortedPoints[sortedPoints.length - 1].y;\n  }\n\n  // Find bracketing points\n  let lowerIndex = 0;\n  for (let i = 0; i < sortedPoints.length - 1; i++) {\n    if (value >= sortedPoints[i].x && value <= sortedPoints[i + 1].x) {\n      lowerIndex = i;\n      break;\n    }\n  }\n\n  const p0 = sortedPoints[lowerIndex];\n  const p3 = sortedPoints[lowerIndex + 1];\n\n  // Check if we have Bezier control handles\n  const hasHandles = p0.rightHandleX !== undefined && p3.leftHandleX !== undefined;\n\n  if (hasHandles) {\n    // Cubic Bezier interpolation with control points\n    const p1x = p0.rightHandleX!;\n    const p1y = p0.rightHandleY ?? p0.y;\n    const p2x = p3.leftHandleX!;\n    const p2y = p3.leftHandleY ?? p3.y;\n\n    // Find t parameter for given x value using Newton-Raphson iteration\n    let t = (value - p0.x) / (p3.x - p0.x); // Initial guess\n\n    // Newton-Raphson iterations to find t where B_x(t) = value\n    for (let iter = 0; iter < 10; iter++) {\n      const bx = cubicBezier(p0.x, p1x, p2x, p3.x, t);\n      const bxDerivative = cubicBezierDerivative(p0.x, p1x, p2x, p3.x, t);\n\n      if (Math.abs(bxDerivative) < 1e-10) break;\n\n      const newT = t - (bx - value) / bxDerivative;\n      if (Math.abs(newT - t) < 1e-10) break;\n      t = Math.max(0, Math.min(1, newT));\n    }\n\n    // Calculate y using the found t parameter\n    return cubicBezier(p0.y, p1y, p2y, p3.y, t);\n  } else {\n    // Smooth interpolation using Catmull-Rom spline\n    // This provides smoother curves than linear interpolation\n    const t = (value - p0.x) / (p3.x - p0.x);\n\n    // Get neighboring points for spline calculation\n    const pMinus1 = lowerIndex > 0 ? sortedPoints[lowerIndex - 1] : p0;\n    const p4 = lowerIndex + 2 < sortedPoints.length ? sortedPoints[lowerIndex + 2] : p3;\n\n    // Catmull-Rom spline interpolation\n    return catmullRomSpline(pMinus1.y, p0.y, p3.y, p4.y, t);\n  }\n}\n\n/**\n * Cubic Bezier curve evaluation: B(t) = (1-t)Â³P0 + 3(1-t)Â²tP1 + 3(1-t)tÂ²P2 + tÂ³P3\n */\nfunction cubicBezier(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  const mt2 = mt * mt;\n  const mt3 = mt2 * mt;\n  const t2 = t * t;\n  const t3 = t2 * t;\n  return mt3 * p0 + 3 * mt2 * t * p1 + 3 * mt * t2 * p2 + t3 * p3;\n}\n\n/**\n * Cubic Bezier derivative: B'(t) = 3(1-t)Â²(P1-P0) + 6(1-t)t(P2-P1) + 3tÂ²(P3-P2)\n */\nfunction cubicBezierDerivative(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  return 3 * mt * mt * (p1 - p0) + 6 * mt * t * (p2 - p1) + 3 * t * t * (p3 - p2);\n}\n\n/**\n * Catmull-Rom spline interpolation for smooth curves without explicit handles\n */\nfunction catmullRomSpline(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const t2 = t * t;\n  const t3 = t2 * t;\n\n  // Catmull-Rom coefficients with tension = 0.5\n  const a = -0.5 * p0 + 1.5 * p1 - 1.5 * p2 + 0.5 * p3;\n  const b = p0 - 2.5 * p1 + 2 * p2 - 0.5 * p3;\n  const c = -0.5 * p0 + 0.5 * p2;\n  const d = p1;\n\n  return a * t3 + b * t2 + c * t + d;\n}\n\n/**\n * Calculate standardized score (0-10 normalized)\n */\nexport function standardizeScore(score: number, maxScore: number): number {\n  return (score / maxScore) * 10;\n}\n\n/**\n * Determine quality tier based on score\n */\nexport function getQualityTier(score: number, maxScore: number = 10): QualityTier {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 90) return 'ideal';\n  if (normalized >= 70) return 'excellent';\n  if (normalized >= 50) return 'good';\n  return 'below_average';\n}\n\n/**\n * Determine severity level based on score\n */\nexport function getSeverityLevel(score: number, maxScore: number = 10): SeverityLevel {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 85) return 'optimal';\n  if (normalized >= 70) return 'minor';\n  if (normalized >= 50) return 'moderate';\n  if (normalized >= 30) return 'major';\n  if (normalized >= 15) return 'severe';\n  return 'extremely_severe';\n}\n\n/**\n * Calculate deviation description\n */\nexport function getDeviationDescription(\n  value: number,\n  idealMin: number,\n  idealMax: number,\n  unit: MeasurementUnit\n): { deviation: number; direction: 'above' | 'below' | 'within'; description: string } {\n  if (value >= idealMin && value <= idealMax) {\n    return { deviation: 0, direction: 'within', description: 'within ideal range' };\n  }\n\n  const unitLabel = getUnitLabel(unit);\n\n  if (value < idealMin) {\n    const dev = idealMin - value;\n    return {\n      deviation: dev,\n      direction: 'below',\n      description: `${dev.toFixed(2)}${unitLabel} below ideal`,\n    };\n  }\n\n  const dev = value - idealMax;\n  return {\n    deviation: dev,\n    direction: 'above',\n    description: `${dev.toFixed(2)}${unitLabel} above ideal`,\n  };\n}\n\nfunction getUnitLabel(unit: MeasurementUnit): string {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return 'Â°';\n    case 'mm': return 'mm';\n    default: return '';\n  }\n}\n\n// ============================================\n// MEASUREMENT CALCULATION UTILITIES\n// ============================================\n\n/**\n * Calculate distance between two points\n */\nexport function distance(p1: Point, p2: Point): number {\n  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n}\n\n/**\n * Calculate angle at vertex point (in degrees)\n */\nexport function calculateAngle(p1: Point, vertex: Point, p2: Point): number {\n  const v1 = { x: p1.x - vertex.x, y: p1.y - vertex.y };\n  const v2 = { x: p2.x - vertex.x, y: p2.y - vertex.y };\n\n  const dot = v1.x * v2.x + v1.y * v2.y;\n  const cross = v1.x * v2.y - v1.y * v2.x;\n\n  const angle = Math.atan2(cross, dot) * (180 / Math.PI);\n  return Math.abs(angle);\n}\n\n/**\n * Calculate perpendicular distance from point to line (signed)\n */\nexport function perpendicularDistance(\n  point: Point,\n  lineStart: Point,\n  lineEnd: Point\n): number {\n  const A = point.x - lineStart.x;\n  const B = point.y - lineStart.y;\n  const C = lineEnd.x - lineStart.x;\n  const D = lineEnd.y - lineStart.y;\n\n  const dot = A * C + B * D;\n  const lenSq = C * C + D * D;\n  const param = lenSq !== 0 ? dot / lenSq : -1;\n\n  let xx: number, yy: number;\n\n  if (param < 0) {\n    xx = lineStart.x;\n    yy = lineStart.y;\n  } else if (param > 1) {\n    xx = lineEnd.x;\n    yy = lineEnd.y;\n  } else {\n    xx = lineStart.x + param * C;\n    yy = lineStart.y + param * D;\n  }\n\n  const dx = point.x - xx;\n  const dy = point.y - yy;\n\n  const sign =\n    (lineEnd.y - lineStart.y) * point.x -\n      (lineEnd.x - lineStart.x) * point.y +\n      lineEnd.x * lineStart.y -\n      lineEnd.y * lineStart.x >=\n    0\n      ? 1\n      : -1;\n\n  return sign * Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Helper to get landmark by ID\n */\nfunction getLandmark(landmarks: LandmarkPoint[], id: string): Point | null {\n  const lm = landmarks.find((l) => l.id === id);\n  return lm ? { x: lm.x, y: lm.y } : null;\n}\n\n// ============================================\n// SCORE A SINGLE MEASUREMENT\n// ============================================\n\nexport interface DemographicOptions {\n  gender?: Gender;\n  ethnicity?: Ethnicity;\n}\n\n/**\n * Calculate complete score result for a measurement.\n * If demographics provided, uses demographic-specific ideal ranges.\n */\nexport function scoreMeasurement(\n  metricId: string,\n  value: number,\n  demographics?: DemographicOptions\n): FaceIQScoreResult | null {\n  // Get config with demographic overrides if provided\n  const config = demographics?.gender\n    ? getMetricConfigForDemographics(metricId, demographics.gender, demographics.ethnicity || 'other')\n    : FACEIQ_METRICS[metricId];\n\n  if (!config) return null;\n\n  const score = calculateFaceIQScore(value, config);\n  const standardizedScore = standardizeScore(score, config.maxScore);\n  const qualityTier = getQualityTier(score, config.maxScore);\n  const severity = getSeverityLevel(score, config.maxScore);\n  const { deviation, direction } = getDeviationDescription(\n    value,\n    config.idealMin,\n    config.idealMax,\n    config.unit\n  );\n\n  return {\n    metricId,\n    name: config.name,\n    value,\n    score,\n    standardizedScore,\n    qualityTier,\n    severity,\n    idealMin: config.idealMin,\n    idealMax: config.idealMax,\n    deviation,\n    deviationDirection: direction,\n    unit: config.unit,\n    category: config.category,\n  };\n}\n\n// ============================================\n// FRONT PROFILE ANALYSIS\n// ============================================\n\nexport interface FrontProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all front profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeFrontProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): FrontProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  // Helper to add measurement if landmarks available\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const trichion = getLandmark(landmarks, 'trichion');\n  const nasalBase = getLandmark(landmarks, 'nasal_base');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const menton = getLandmark(landmarks, 'menton');\n  const leftZygion = getLandmark(landmarks, 'left_zygion');\n  const rightZygion = getLandmark(landmarks, 'right_zygion');\n  const leftGonion = getLandmark(landmarks, 'left_gonion_inferior');\n  const rightGonion = getLandmark(landmarks, 'right_gonion_inferior');\n  const leftPupil = getLandmark(landmarks, 'left_pupila');\n  const rightPupil = getLandmark(landmarks, 'right_pupila');\n  const leftCanthusM = getLandmark(landmarks, 'left_canthus_medialis');\n  const leftCanthusL = getLandmark(landmarks, 'left_canthus_lateralis');\n  const rightCanthusM = getLandmark(landmarks, 'right_canthus_medialis');\n  const rightCanthusL = getLandmark(landmarks, 'right_canthus_lateralis');\n  void rightCanthusL; // Will be used for asymmetry measurements\n  const leftAlaNasi = getLandmark(landmarks, 'left_ala_nasi');\n  const rightAlaNasi = getLandmark(landmarks, 'right_ala_nasi');\n  const leftCheilion = getLandmark(landmarks, 'left_cheilion');\n  const rightCheilion = getLandmark(landmarks, 'right_cheilion');\n  const labraleSuperius = getLandmark(landmarks, 'labrale_superius');\n  const labraleInferius = getLandmark(landmarks, 'labrale_inferius');\n\n  // FACIAL THIRDS\n  if (trichion && nasalBase && subnasale && menton) {\n    const totalHeight = distance(trichion, menton);\n    if (totalHeight > 0) {\n      const upperThird = (distance(trichion, nasalBase) / totalHeight) * 100;\n      const middleThird = (distance(nasalBase, subnasale) / totalHeight) * 100;\n      const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n\n      addMeasurement('upperThirdProportion', upperThird);\n      addMeasurement('middleThirdProportion', middleThird);\n      addMeasurement('lowerThirdProportion', lowerThird);\n    }\n  }\n\n  // FACE WIDTH TO HEIGHT RATIO (FWHR)\n  if (leftZygion && rightZygion && nasalBase && labraleSuperius) {\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    const upperFaceHeight = distance(nasalBase, labraleSuperius);\n    if (upperFaceHeight > 0) {\n      addMeasurement('faceWidthToHeight', bizygomaticWidth / upperFaceHeight);\n    }\n  }\n\n  // TOTAL FACIAL WIDTH TO HEIGHT\n  if (leftZygion && rightZygion && trichion && menton) {\n    const cheekWidth = distance(leftZygion, rightZygion);\n    const totalHeight = distance(trichion, menton);\n    if (cheekWidth > 0) {\n      addMeasurement('totalFacialWidthToHeight', totalHeight / cheekWidth);\n    }\n  }\n\n  // JAW WIDTH RATIO\n  if (leftGonion && rightGonion && leftZygion && rightZygion) {\n    const bigonialWidth = distance(leftGonion, rightGonion);\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    if (bizygomaticWidth > 0) {\n      const ratio = bigonialWidth / bizygomaticWidth;\n      addMeasurement('jawWidthRatio', ratio);\n      addMeasurement('bigonialWidth', ratio * 100);\n    }\n  }\n\n  // CANTHAL TILT\n  if (leftCanthusM && leftCanthusL) {\n    const deltaY = leftCanthusM.y - leftCanthusL.y;\n    const deltaX = leftCanthusL.x - leftCanthusM.x;\n    const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);\n    addMeasurement('lateralCanthalTilt', angle);\n  }\n\n  // EYE ASPECT RATIO\n  if (leftCanthusM && leftCanthusL) {\n    const leftPalpSup = getLandmark(landmarks, 'left_palpebra_superior');\n    const leftPalpInf = getLandmark(landmarks, 'left_palpebra_inferior');\n    if (leftPalpSup && leftPalpInf) {\n      const eyeWidth = distance(leftCanthusM, leftCanthusL);\n      const eyeHeight = distance(leftPalpSup, leftPalpInf);\n      if (eyeWidth > 0) {\n        addMeasurement('eyeAspectRatio', eyeHeight / eyeWidth);\n      }\n    }\n  }\n\n  // EYE SEPARATION RATIO\n  if (leftCanthusM && rightCanthusM && leftZygion && rightZygion) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('eyeSeparationRatio', intercanthal / bizygomatic);\n    }\n  }\n\n  // IPD RATIO\n  if (leftPupil && rightPupil && leftZygion && rightZygion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('interpupillaryRatio', (ipd / bizygomatic) * 100);\n    }\n  }\n\n  // ONE EYE APART TEST\n  if (leftCanthusM && rightCanthusM && leftCanthusL) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const eyeWidth = distance(leftCanthusM, leftCanthusL);\n    if (eyeWidth > 0) {\n      addMeasurement('oneEyeApartTest', intercanthal / eyeWidth);\n    }\n  }\n\n  // NASAL INDEX\n  if (leftAlaNasi && rightAlaNasi && nasalBase && subnasale) {\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    const nasalHeight = distance(nasalBase, subnasale);\n    if (nasalHeight > 0) {\n      addMeasurement('nasalIndex', (nasalWidth / nasalHeight) * 100);\n    }\n  }\n\n  // INTERCANTHAL-NASAL WIDTH RATIO\n  if (leftCanthusM && rightCanthusM && leftAlaNasi && rightAlaNasi) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('intercanthalNasalRatio', intercanthal / nasalWidth);\n    }\n  }\n\n  // MOUTH TO NOSE RATIO\n  if (leftCheilion && rightCheilion && leftAlaNasi && rightAlaNasi) {\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('mouthWidthToNoseRatio', mouthWidth / nasalWidth);\n    }\n  }\n\n  // IPD TO MOUTH WIDTH RATIO\n  if (leftPupil && rightPupil && leftCheilion && rightCheilion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    if (ipd > 0) {\n      addMeasurement('interpupillaryMouthWidthRatio', mouthWidth / ipd);\n    }\n  }\n\n  // LIP RATIO\n  if (labraleSuperius && labraleInferius && subnasale) {\n    const mouthMiddle = getLandmark(landmarks, 'mouth_middle');\n    if (mouthMiddle) {\n      const upperLipHeight = distance(subnasale, labraleSuperius);\n      const lowerLipHeight = distance(mouthMiddle, labraleInferius);\n      if (upperLipHeight > 0) {\n        addMeasurement('lowerToUpperLipRatio', lowerLipHeight / upperLipHeight);\n      }\n    }\n  }\n\n  // MIDFACE RATIO\n  if (leftZygion && rightZygion && nasalBase && subnasale) {\n    const midfaceWidth = distance(leftZygion, rightZygion);\n    const midfaceHeight = distance(nasalBase, subnasale);\n    if (midfaceHeight > 0) {\n      addMeasurement('midfaceRatio', midfaceWidth / midfaceHeight / 10); // Normalized\n    }\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score (weighted average)\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n  const standardizedScore = overallScore;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// SIDE PROFILE ANALYSIS\n// ============================================\n\nexport interface SideProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all side profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeSideProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): SideProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const glabella = getLandmark(landmarks, 'glabella');\n  const nasion = getLandmark(landmarks, 'nasion');\n  const rhinion = getLandmark(landmarks, 'rhinion');\n  const pronasale = getLandmark(landmarks, 'pronasale');\n  const columella = getLandmark(landmarks, 'columella');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const labraleSuperius = getLandmark(landmarks, 'labraleSuperius');\n  const labraleInferius = getLandmark(landmarks, 'labraleInferius');\n  const sublabiale = getLandmark(landmarks, 'sublabiale');\n  const pogonion = getLandmark(landmarks, 'pogonion');\n  const menton = getLandmark(landmarks, 'menton');\n  const tragus = getLandmark(landmarks, 'tragus');\n  const gonionBottom = getLandmark(landmarks, 'gonionBottom');\n  const cervicalPoint = getLandmark(landmarks, 'cervicalPoint');\n  const orbitale = getLandmark(landmarks, 'orbitale');\n  const porion = getLandmark(landmarks, 'porion');\n\n  // GONIAL ANGLE\n  if (tragus && gonionBottom && menton) {\n    const angle = calculateAngle(tragus, gonionBottom, menton);\n    addMeasurement('gonialAngle', angle);\n  }\n\n  // NASOLABIAL ANGLE\n  if (columella && subnasale && labraleSuperius) {\n    const angle = calculateAngle(columella, subnasale, labraleSuperius);\n    addMeasurement('nasolabialAngle', angle);\n  }\n\n  // NASOFRONTAL ANGLE\n  if (glabella && nasion && rhinion) {\n    const angle = calculateAngle(glabella, nasion, rhinion);\n    addMeasurement('nasofrontalAngle', angle);\n  }\n\n  // MENTOLABIAL ANGLE\n  if (labraleInferius && sublabiale && pogonion) {\n    const angle = calculateAngle(labraleInferius, sublabiale, pogonion);\n    addMeasurement('mentolabialAngle', angle);\n  }\n\n  // E-LINE MEASUREMENTS\n  if (pronasale && pogonion && labraleSuperius && labraleInferius) {\n    const upperLipDist = perpendicularDistance(labraleSuperius, pronasale, pogonion);\n    const lowerLipDist = perpendicularDistance(labraleInferius, pronasale, pogonion);\n    addMeasurement('eLineUpperLip', upperLipDist);\n    addMeasurement('eLineLowerLip', lowerLipDist);\n  }\n\n  // NASOMENTAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    const angle = calculateAngle(nasion, pronasale, pogonion);\n    addMeasurement('nasomentaAngle', angle);\n  }\n\n  // FACIAL CONVEXITY (GLABELLA)\n  if (glabella && subnasale && pogonion) {\n    const angle = calculateAngle(glabella, subnasale, pogonion);\n    addMeasurement('facialConvexityGlabella', angle);\n  }\n\n  // FACIAL CONVEXITY (NASION)\n  if (nasion && subnasale && pogonion) {\n    const angle = calculateAngle(nasion, subnasale, pogonion);\n    addMeasurement('facialConvexityNasion', angle);\n  }\n\n  // TOTAL FACIAL CONVEXITY\n  if (glabella && pronasale && pogonion) {\n    const angle = calculateAngle(glabella, pronasale, pogonion);\n    addMeasurement('totalFacialConvexity', angle);\n  }\n\n  // SUBMENTAL CERVICAL ANGLE\n  if (menton && cervicalPoint && pogonion) {\n    const neckPoint = getLandmark(landmarks, 'neckPoint');\n    if (neckPoint) {\n      const angle = calculateAngle(pogonion, menton, neckPoint);\n      addMeasurement('submentalCervicalAngle', angle);\n    }\n  }\n\n  // NASAL PROJECTION (Goode ratio)\n  if (pronasale && subnasale && nasion) {\n    const projection = distance(pronasale, subnasale);\n    const nasalLength = distance(nasion, pronasale);\n    if (nasalLength > 0) {\n      addMeasurement('nasalProjection', projection / nasalLength);\n    }\n  }\n\n  // NASOFACIAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    // Angle between nose dorsum and facial plane\n    const nasalDorsum = { x: pronasale.x - nasion.x, y: pronasale.y - nasion.y };\n    const facialPlane = { x: pogonion.x - nasion.x, y: pogonion.y - nasion.y };\n\n    const dot = nasalDorsum.x * facialPlane.x + nasalDorsum.y * facialPlane.y;\n    const mag1 = Math.sqrt(nasalDorsum.x ** 2 + nasalDorsum.y ** 2);\n    const mag2 = Math.sqrt(facialPlane.x ** 2 + facialPlane.y ** 2);\n\n    if (mag1 > 0 && mag2 > 0) {\n      const angle = Math.acos(dot / (mag1 * mag2)) * (180 / Math.PI);\n      addMeasurement('nasofacialAngle', angle);\n    }\n  }\n\n  // MANDIBULAR PLANE ANGLE (using Frankfort horizontal)\n  if (porion && orbitale && gonionBottom && menton) {\n    // Frankfort horizontal is porion to orbitale\n    // Mandibular plane is gonion to menton\n    const fhAngle = Math.atan2(orbitale.y - porion.y, orbitale.x - porion.x);\n    const mpAngle = Math.atan2(menton.y - gonionBottom.y, menton.x - gonionBottom.x);\n    const angle = Math.abs(fhAngle - mpAngle) * (180 / Math.PI);\n    addMeasurement('mandibularPlaneAngle', angle);\n  }\n\n  // CHIN PROJECTION\n  if (pogonion && subnasale) {\n    // Distance from pogonion to vertical line through subnasale\n    const projection = pogonion.x - subnasale.x;\n    addMeasurement('chinProjection', projection);\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// COMPLETE HARMONY ANALYSIS\n// ============================================\n\n/**\n * Run complete facial harmony analysis.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeHarmony(\n  frontLandmarks: LandmarkPoint[],\n  sideLandmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): HarmonyAnalysis {\n  const frontResults = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n  const sideResults = analyzeSideProfile(sideLandmarks, gender, ethnicity);\n\n  const allMeasurements = [...frontResults.measurements, ...sideResults.measurements];\n\n  // Combined category scores\n  const allCategories: Record<string, { total: number; count: number }> = {};\n  for (const m of allMeasurements) {\n    if (!allCategories[m.category]) {\n      allCategories[m.category] = { total: 0, count: 0 };\n    }\n    allCategories[m.category].total += m.standardizedScore;\n    allCategories[m.category].count++;\n  }\n\n  const categoryScores: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(allCategories)) {\n    categoryScores[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Overall weighted score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of allMeasurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  // Identify flaws (below average measurements)\n  const flaws: FlawAssessment[] = allMeasurements\n    .filter((m) => m.severity !== 'optimal' && m.severity !== 'minor')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      severity: m.severity,\n      deviation: `${m.deviation.toFixed(2)} ${m.deviationDirection} ideal`,\n      reasoning: `${m.name} is outside the ideal range`,\n      confidence: m.severity === 'extremely_severe' || m.severity === 'severe'\n        ? 'confirmed' as const\n        : 'likely' as const,\n    }))\n    .sort((a, b) => {\n      const severityOrder = { extremely_severe: 0, severe: 1, major: 2, moderate: 3 };\n      return (severityOrder[a.severity as keyof typeof severityOrder] ?? 4) -\n             (severityOrder[b.severity as keyof typeof severityOrder] ?? 4);\n    });\n\n  // Identify strengths (ideal measurements)\n  const strengths: StrengthAssessment[] = allMeasurements\n    .filter((m) => m.qualityTier === 'ideal' || m.qualityTier === 'excellent')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      qualityTier: m.qualityTier,\n      value: m.value,\n      reasoning: `${m.name} is within the ${m.qualityTier} range`,\n    }));\n\n  // Calculate percentile (based on population stats)\n  const percentile = calculateHarmonyPercentile(overallScore);\n\n  return {\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    percentile,\n    frontScore: frontResults.overallScore,\n    sideScore: sideResults.overallScore,\n    categoryScores,\n    measurements: allMeasurements,\n    flaws,\n    strengths,\n  };\n}\n\n/**\n * Calculate percentile from harmony score\n */\nfunction calculateHarmonyPercentile(score: number): number {\n  // Based on normal distribution with mean=5, stdDev=1.5\n  const mean = 5;\n  const stdDev = 1.5;\n  const z = (score - mean) / stdDev;\n  return normalCDF(z) * 100;\n}\n\n/**\n * Standard normal CDF approximation\n */\nfunction normalCDF(z: number): number {\n  const a1 = 0.254829592;\n  const a2 = -0.284496736;\n  const a3 = 1.421413741;\n  const a4 = -1.453152027;\n  const a5 = 1.061405429;\n  const p = 0.3275911;\n\n  const sign = z < 0 ? -1 : 1;\n  const absZ = Math.abs(z) / Math.sqrt(2);\n\n  const t = 1.0 / (1.0 + p * absZ);\n  const y = 1.0 - ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-absZ * absZ);\n\n  return 0.5 * (1.0 + sign * y);\n}\n\n// ============================================\n// PSL RATING CONVERSION\n// ============================================\n\nexport interface PSLRating {\n  score: number;\n  tier: string;\n  percentile: number;\n  description: string;\n}\n\n/**\n * Convert harmony score to PSL rating\n */\nexport function convertToPSL(harmonyScore: number): PSLRating {\n  // Convert 0-10 harmony to 3.0-7.5 PSL range\n  const psl = 3.0 + (harmonyScore / 10) * 4.5;\n  const clampedPSL = Math.max(3.0, Math.min(7.5, psl));\n\n  let tier: string;\n  let percentile: number;\n\n  if (clampedPSL >= 7.5) {\n    tier = 'Top Model';\n    percentile = 99.99;\n  } else if (clampedPSL >= 7.0) {\n    tier = 'Chad';\n    percentile = 99.87;\n  } else if (clampedPSL >= 6.5) {\n    tier = 'Chadlite';\n    percentile = 99.0;\n  } else if (clampedPSL >= 6.0) {\n    tier = 'High Tier Normie+';\n    percentile = 97.25;\n  } else if (clampedPSL >= 5.5) {\n    tier = 'High Tier Normie';\n    percentile = 90.0;\n  } else if (clampedPSL >= 5.0) {\n    tier = 'Mid Tier Normie+';\n    percentile = 84.15;\n  } else if (clampedPSL >= 4.5) {\n    tier = 'Mid Tier Normie';\n    percentile = 65.0;\n  } else if (clampedPSL >= 4.0) {\n    tier = 'Low Tier Normie';\n    percentile = 50.0;\n  } else if (clampedPSL >= 3.5) {\n    tier = 'Below Average';\n    percentile = 30.0;\n  } else {\n    tier = 'Subpar';\n    percentile = 15.0;\n  }\n\n  return {\n    score: clampedPSL,\n    tier,\n    percentile,\n    description: `${tier} (top ${(100 - percentile).toFixed(1)}%)`,\n  };\n}\n\n// ============================================\n// EXPORTS FOR BACKWARD COMPATIBILITY\n// ============================================\n\nexport type { LandmarkPoint } from './landmarks';\n","structuredPatch":[{"oldStart":224,"oldLines":7,"newStart":224,"newLines":8,"lines":["   intercanthalNasalRatio: {","     // Alar width (nose width) relative to intercanthal distance (inner eye spacing)","     // Research: Wider nose base is standard in African phenotypes","-    // Extracted from FaceIQ BlackAfrican.htc logic","+    // Pacific Islander: Similar to Black model, accepts wide nasal base","+    // Extracted from FaceIQ BlackAfrican.htc and Male:Pacific Islander.htc logic","     white_male: { idealMin: 1.00, idealMax: 1.04 },","     white_female: { idealMin: 0.98, idealMax: 1.02 },","     east_asian_male: { idealMin: 1.10, idealMax: 1.15 },"]},{"oldStart":235,"oldLines":6,"newStart":236,"newLines":8,"lines":["     black_female: { idealMin: 1.13, idealMax: 1.23 },","     hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black","     hispanic_female: { idealMin: 0.98, idealMax: 1.10 },","+    pacific_islander_male: { idealMin: 1.10, idealMax: 1.20 },  // Wide tolerance, similar to Black model","+    pacific_islander_female: { idealMin: 1.08, idealMax: 1.18 },","   },"," ","   // =========================================="]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"c5b381ca-33bd-4869-ab2a-a9121fc05f22","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01CEKZFZC5JLA3UhtuT7zWov","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Great! Now let me add the jaw width preferences. The user mentioned that Pacific Islander models prefer a bigonial_width (jaw width) that rivals the bizygomatic_width (cheek width). Looking at the bigonialWidth metric, I can see it's expressed as a percentage of bizygomatic width. Let me add an override for Pacific Islander.","signature":"Eu8DCkYIChgCKkAxWNze6c6xSrbK7hNF3iwth//MfZDaj4zZQ6KgV2iWTGgMltLukaQ9AwjiLMYrUwiOPyK9hqjpQMxA1cvshQYREgzVin7Ev+rjw60TxjUaDGw9h6OAZEBUgq8OCCIwB+8Zx8cK9f39SzuStKakEDcsbVTiEug5vrOj9FoLra0IjSXmtxkdHQYwhoL/kCwAKtYCbZ1if0o0ygJGDFuBZiLIuhaEdlKmG9LGcNPXVR7YCpx8yuuZ83YQ2yYqfbEsV7LlnPWaqSg32zfmEvrODcxWgGG8+Q//YVUMtU/QqbJSWms8YkGWOOMoZO6G2RtceSWSFp0K9o80wEHYl4l88DcHH6ZE8RHIJSHv55v8PBhjlMhTjawxJSa4zidXgnUMdqCMSgaAeHi1Bs1sVba2QrUW8wf1IcyBXvBnOWrpM1Mf91rNtcLlDQ0ip0mOnbLYM09dumYLpTzeZK1SM9xLxJvnxgc+X3ZD9H8666i5teUtA/qSuSJPz70VrCoG0PYLMyXn9deDqW9EDN5jXQ6Z1GjhGIATDbrXrqJK425KCAE2UEGyCep1MOvf4nLqzug+cyx03MnZzey2k1JjDLfjDtIw1kgWLdI5MhZOidvpM+gqtxo292yMuDwta7PaNGKMxge4MUYoX2abGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1646,"cache_read_input_tokens":34631,"cache_creation":{"ephemeral_5m_input_tokens":1646,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD7UyHEEL5CTiYdMJCp","type":"assistant","uuid":"87606415-a040-4911-bde8-fc8176df3b38","timestamp":"2025-12-21T17:15:28.405Z"}
{"parentUuid":"87606415-a040-4911-bde8-fc8176df3b38","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01CEKZFZC5JLA3UhtuT7zWov","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HSb4QyerhhB3hB3S2adxAt","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","old_string":"  // ==========================================\n  // JAW METRICS - Clear gender dimorphism\n  // ==========================================\n  bigonialWidth: {\n    // Jaw width as % of bizygomatic width\n    // Males: wider, more angular; Females: narrower, softer\n    male: { idealMin: 90, idealMax: 95 },\n    female: { idealMin: 85, idealMax: 90 },\n  },","new_string":"  // ==========================================\n  // JAW METRICS - Clear gender dimorphism\n  // ==========================================\n  bigonialWidth: {\n    // Jaw width as % of bizygomatic width\n    // Males: wider, more angular; Females: narrower, softer\n    // Pacific Islander: Extremely wide jaw preferred - \"Warrior Skull\" robustness\n    // Extracted from FaceIQ Male:Pacific Islander.htc\n    male: { idealMin: 90, idealMax: 95 },\n    female: { idealMin: 85, idealMax: 90 },\n    pacific_islander_male: { idealMin: 92, idealMax: 98 },  // Jaw width rivals cheekbone width - extreme robustness\n    pacific_islander_female: { idealMin: 88, idealMax: 94 },\n  },"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":1646,"cache_read_input_tokens":34631,"cache_creation":{"ephemeral_5m_input_tokens":1646,"ephemeral_1h_input_tokens":0},"output_tokens":509,"service_tier":"standard"}},"requestId":"req_011CWLD7UyHEEL5CTiYdMJCp","type":"assistant","uuid":"7f9a8dae-d073-4f7f-8cc1-1e05263d5745","timestamp":"2025-12-21T17:15:34.705Z"}
{"parentUuid":"7f9a8dae-d073-4f7f-8cc1-1e05263d5745","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HSb4QyerhhB3hB3S2adxAt","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   239â†’    pacific_islander_male: { idealMin: 1.10, idealMax: 1.20 },  // Wide tolerance, similar to Black model\n   240â†’    pacific_islander_female: { idealMin: 1.08, idealMax: 1.18 },\n   241â†’  },\n   242â†’\n   243â†’  // ==========================================\n   244â†’  // JAW METRICS - Clear gender dimorphism\n   245â†’  // ==========================================\n   246â†’  bigonialWidth: {\n   247â†’    // Jaw width as % of bizygomatic width\n   248â†’    // Males: wider, more angular; Females: narrower, softer\n   249â†’    // Pacific Islander: Extremely wide jaw preferred - \"Warrior Skull\" robustness\n   250â†’    // Extracted from FaceIQ Male:Pacific Islander.htc\n   251â†’    male: { idealMin: 90, idealMax: 95 },\n   252â†’    female: { idealMin: 85, idealMax: 90 },\n   253â†’    pacific_islander_male: { idealMin: 92, idealMax: 98 },  // Jaw width rivals cheekbone width - extreme robustness\n   254â†’    pacific_islander_female: { idealMin: 88, idealMax: 94 },\n   255â†’  },\n   256â†’\n   257â†’  jawFrontalAngle: {\n   258â†’    // More angular in males, softer in females\n   259â†’    male: { idealMin: 88, idealMax: 95 },"}]},"uuid":"403ef311-e018-4278-8639-4d55c4336912","timestamp":"2025-12-21T17:15:34.741Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","oldString":"  // ==========================================\n  // JAW METRICS - Clear gender dimorphism\n  // ==========================================\n  bigonialWidth: {\n    // Jaw width as % of bizygomatic width\n    // Males: wider, more angular; Females: narrower, softer\n    male: { idealMin: 90, idealMax: 95 },\n    female: { idealMin: 85, idealMax: 90 },\n  },","newString":"  // ==========================================\n  // JAW METRICS - Clear gender dimorphism\n  // ==========================================\n  bigonialWidth: {\n    // Jaw width as % of bizygomatic width\n    // Males: wider, more angular; Females: narrower, softer\n    // Pacific Islander: Extremely wide jaw preferred - \"Warrior Skull\" robustness\n    // Extracted from FaceIQ Male:Pacific Islander.htc\n    male: { idealMin: 90, idealMax: 95 },\n    female: { idealMin: 85, idealMax: 90 },\n    pacific_islander_male: { idealMin: 92, idealMax: 98 },  // Jaw width rivals cheekbone width - extreme robustness\n    pacific_islander_female: { idealMin: 88, idealMax: 94 },\n  },","originalFile":"/**\n * FaceIQ-Style Facial Analysis Scoring System\n * Complete replication of FaceIQ Labs scoring algorithms\n *\n * Features:\n * - Exponential decay scoring with per-metric decay rates\n * - Bezier curve custom scoring for non-linear measurements\n * - 70+ facial measurements (front + side profiles)\n * - Quality tiers: Ideal, Excellent, Good\n * - 5-tier severity: Extremely Severe, Severe, Major, Moderate, Minor\n */\n\nimport { LandmarkPoint } from './landmarks';\n\n// ============================================\n// CORE TYPES\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\n/**\n * Polarity defines how deviation from the ideal range is interpreted:\n * - 'balanced': Default. Deviation in either direction is equally bad.\n * - 'higher_is_better': Values above the ideal are still good. Only values below\n *   the 'safeFloor' are true weaknesses. E.g., Canthal Tilt (positive tilt is good)\n * - 'lower_is_better': Values below the ideal are still good. Only values above\n *   the 'safeCeiling' are true weaknesses. E.g., Philtrum length (shorter is better)\n */\nexport type MetricPolarity = 'balanced' | 'higher_is_better' | 'lower_is_better';\n\nexport interface MetricConfig {\n  id: string;\n  name: string;\n  category: string;\n  unit: MeasurementUnit;\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  decayRate: number;\n  maxScore: number;\n  weight: number;\n  description: string;\n  profileType: 'front' | 'side';\n  customCurve?: BezierCurveConfig;\n  /**\n   * Polarity for directional/dimorphic scoring.\n   * Defaults to 'balanced' if not specified.\n   */\n  polarity?: MetricPolarity;\n  /**\n   * For 'higher_is_better': minimum value that's still acceptable.\n   * Values above this but below idealMin get a passing score (softFloorScore).\n   * Values below this are true weaknesses.\n   */\n  safeFloor?: number;\n  /**\n   * For 'lower_is_better': maximum value that's still acceptable.\n   * Values below this but above idealMax get a passing score (softCeilingScore).\n   * Values above this are true weaknesses.\n   */\n  safeCeiling?: number;\n  /**\n   * Score given to values in the \"acceptable but not ideal\" zone.\n   * Defaults to 8.0 (Good). Range: 6.0-9.0\n   */\n  softZoneScore?: number;\n}\n\nexport interface BezierCurveConfig {\n  mode: 'custom' | 'exponential';\n  points: CurvePoint[];\n}\n\nexport interface CurvePoint {\n  x: number;\n  y: number;\n  leftHandleX?: number;\n  leftHandleY?: number;\n  rightHandleX?: number;\n  rightHandleY?: number;\n  fixed?: boolean;\n}\n\nexport interface FaceIQScoreResult {\n  metricId: string;\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  severity: SeverityLevel;\n  idealMin: number;\n  idealMax: number;\n  deviation: number;\n  deviationDirection: 'above' | 'below' | 'within';\n  unit: MeasurementUnit;\n  category: string;\n  percentile?: number;\n}\n\nexport interface HarmonyAnalysis {\n  overallScore: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  percentile: number;\n  frontScore: number;\n  sideScore: number;\n  categoryScores: Record<string, number>;\n  measurements: FaceIQScoreResult[];\n  flaws: FlawAssessment[];\n  strengths: StrengthAssessment[];\n}\n\nexport interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n}\n\nexport interface StrengthAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  qualityTier: QualityTier;\n  value: number;\n  reasoning: string;\n}\n\n// ============================================\n// DEMOGRAPHIC TYPES & OVERRIDES\n// ============================================\n\nexport type Ethnicity =\n  | 'east_asian'\n  | 'south_asian'\n  | 'black'\n  | 'hispanic'\n  | 'middle_eastern'\n  | 'native_american'\n  | 'pacific_islander'\n  | 'white'\n  | 'other';\n\nexport type Gender = 'male' | 'female';\n\nexport type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n\nexport interface DemographicOverride {\n  idealMin: number;\n  idealMax: number;\n}\n\n/**\n * Demographic-specific ideal ranges based on anthropometric research.\n * FaceIQ uses universal scoring, but this gives more accurate assessments\n * by adjusting ideals based on ethnicity and gender.\n */\nexport const DEMOGRAPHIC_OVERRIDES: Record<string, Partial<Record<DemographicKey, DemographicOverride>>> = {\n  // ==========================================\n  // NOSE METRICS - Highest ethnicity variation\n  // ==========================================\n  nasalIndex: {\n    // Nasal Index = (Nose Width / Nose Height) Ã— 100\n    // Research: African/Pacific Islander tend platyrrhine (85-100), Asian mesorrhine (75-88), European leptorrhine (65-75)\n    east_asian_male: { idealMin: 78, idealMax: 88 },\n    east_asian_female: { idealMin: 76, idealMax: 86 },\n    south_asian_male: { idealMin: 72, idealMax: 82 },\n    south_asian_female: { idealMin: 70, idealMax: 80 },\n    black_male: { idealMin: 85, idealMax: 100 },\n    black_female: { idealMin: 83, idealMax: 98 },\n    hispanic_male: { idealMin: 75, idealMax: 87 },\n    hispanic_female: { idealMin: 73, idealMax: 85 },\n    middle_eastern_male: { idealMin: 68, idealMax: 78 },\n    middle_eastern_female: { idealMin: 66, idealMax: 76 },\n    white_male: { idealMin: 65, idealMax: 75 },\n    white_female: { idealMin: 63, idealMax: 73 },\n    native_american_male: { idealMin: 72, idealMax: 82 },\n    native_american_female: { idealMin: 70, idealMax: 80 },\n    pacific_islander_male: { idealMin: 82, idealMax: 95 },\n    pacific_islander_female: { idealMin: 80, idealMax: 93 },\n  },\n\n  nasolabialAngle: {\n    // Ideal nasolabial angle varies by ethnicity\n    // African: slightly more obtuse, European: slightly more acute\n    // Middle Eastern: Penalizes droopy tip (<90Â°) - common flaw is \"Hooked Nose\"\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    black_male: { idealMin: 95, idealMax: 110 },\n    black_female: { idealMin: 100, idealMax: 115 },\n    east_asian_male: { idealMin: 90, idealMax: 105 },\n    east_asian_female: { idealMin: 95, idealMax: 110 },\n    middle_eastern_male: { idealMin: 90, idealMax: 100 },  // Strict on droopy tip\n    middle_eastern_female: { idealMin: 95, idealMax: 105 },\n    // Gender-only fallbacks\n    male: { idealMin: 90, idealMax: 100 },\n    female: { idealMin: 100, idealMax: 110 },\n  },\n\n  nasalProjection: {\n    // Nose projection relative to face depth\n    // East Asian/African: typically less projection is ideal\n    // Middle Eastern: Accepts stronger projection (bigger nose) than White model\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian: { idealMin: 0.54, idealMax: 0.60 },\n    black: { idealMin: 0.52, idealMax: 0.58 },\n    south_asian: { idealMin: 0.56, idealMax: 0.62 },\n    middle_eastern: { idealMin: 0.62, idealMax: 0.70 },  // Higher tolerance for larger noses\n    white: { idealMin: 0.60, idealMax: 0.67 },\n    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },\n  },\n\n  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Pacific Islander: Similar to Black model, accepts wide nasal base\n    // Extracted from FaceIQ BlackAfrican.htc and Male:Pacific Islander.htc logic\n    white_male: { idealMin: 1.00, idealMax: 1.04 },\n    white_female: { idealMin: 0.98, idealMax: 1.02 },\n    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n    black_female: { idealMin: 1.13, idealMax: 1.23 },\n    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n    pacific_islander_male: { idealMin: 1.10, idealMax: 1.20 },  // Wide tolerance, similar to Black model\n    pacific_islander_female: { idealMin: 1.08, idealMax: 1.18 },\n  },\n\n  // ==========================================\n  // JAW METRICS - Clear gender dimorphism\n  // ==========================================\n  bigonialWidth: {\n    // Jaw width as % of bizygomatic width\n    // Males: wider, more angular; Females: narrower, softer\n    male: { idealMin: 90, idealMax: 95 },\n    female: { idealMin: 85, idealMax: 90 },\n  },\n\n  jawFrontalAngle: {\n    // More angular in males, softer in females\n    male: { idealMin: 88, idealMax: 95 },\n    female: { idealMin: 82, idealMax: 90 },\n  },\n\n  jawWidthRatio: {\n    // Males have stronger jaw width preference\n    male: { idealMin: 0.78, idealMax: 0.85 },\n    female: { idealMin: 0.72, idealMax: 0.80 },\n  },\n\n  gonialAngle: {\n    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n    male: { idealMin: 115, idealMax: 125 },\n    female: { idealMin: 120, idealMax: 135 },\n  },\n\n  // ==========================================\n  // EYE METRICS - Ethnic variation\n  // ==========================================\n  lateralCanthalTilt: {\n    // East Asian: naturally higher positive tilt\n    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian_male: { idealMin: 8, idealMax: 12 },\n    east_asian_female: { idealMin: 9, idealMax: 13 },\n    south_asian_male: { idealMin: 6, idealMax: 10 },\n    south_asian_female: { idealMin: 7, idealMax: 11 },\n    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n    // Default for others is 4-8 (already in FACEIQ_METRICS)\n  },\n\n  eyeAspectRatio: {\n    // East Asian eyes often have different aspect ratio due to epicanthal fold\n    east_asian_male: { idealMin: 2.6, idealMax: 3.2 },\n    east_asian_female: { idealMin: 2.7, idealMax: 3.3 },\n    // Larger eyes in females considered more attractive\n    male: { idealMin: 2.9, idealMax: 3.4 },\n    female: { idealMin: 3.1, idealMax: 3.6 },\n  },\n\n  tearTroughDepth: {\n    // Under-eye hollowing and dark circles (infraorbital depression)\n    // South Asian: MUCH stricter penalty due to genetic hyperpigmentation\n    // Extracted from FaceIQ Male:SouthAsian.htc - biggest difference vs White model\n    white_male: { idealMin: 0.0, idealMax: 1.5 },\n    white_female: { idealMin: 0.0, idealMax: 1.3 },\n    south_asian_male: { idealMin: 0.0, idealMax: 0.5 },  // VERY strict - 0.5+ triggers \"Tired/Aged Eyes\" flaw\n    south_asian_female: { idealMin: 0.0, idealMax: 0.4 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.2 },\n    east_asian_female: { idealMin: 0.0, idealMax: 1.0 },\n  },\n\n  upperEyelidExposure: {\n    // Visible eyelid platform (space between eyelash and crease)\n    // South Asian ideal: prefers visible lid platform, penalizes hooded eyes more than White model\n    // Extracted from FaceIQ Male:SouthAsian.htc\n    white_male: { idealMin: 0.3, idealMax: 2.5 },\n    white_female: { idealMin: 0.5, idealMax: 3.0 },\n    south_asian_male: { idealMin: 0.5, idealMax: 2.0 },  // Prefers visible lid, penalizes hooding\n    south_asian_female: { idealMin: 0.7, idealMax: 2.2 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.5 },  // More tolerance for less exposure\n    east_asian_female: { idealMin: 0.2, idealMax: 1.8 },\n  },\n\n  // ==========================================\n  // FACE PROPORTIONS - Gender variation\n  // ==========================================\n  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n  },\n\n  totalFacialWidthToHeight: {\n    male: { idealMin: 1.35, idealMax: 1.40 },\n    female: { idealMin: 1.32, idealMax: 1.37 },\n  },\n\n  midfaceRatio: {\n    // Females often have more compact midface\n    // Middle Eastern: Similar to White model - compact is better\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    male: { idealMin: 0.98, idealMax: 1.02 },\n    female: { idealMin: 0.95, idealMax: 1.00 },\n    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n  },\n\n  // ==========================================\n  // LIP METRICS - Ethnicity variation\n  // ==========================================\n  lipRatio: {\n    // African/Hispanic: fuller lips natural\n    black_male: { idealMin: 1.6, idealMax: 2.2 },\n    black_female: { idealMin: 1.7, idealMax: 2.3 },\n    hispanic_male: { idealMin: 1.4, idealMax: 2.0 },\n    hispanic_female: { idealMin: 1.5, idealMax: 2.1 },\n    // East Asian: less full lips\n    east_asian_male: { idealMin: 1.2, idealMax: 1.7 },\n    east_asian_female: { idealMin: 1.3, idealMax: 1.8 },\n    // Default\n    male: { idealMin: 1.3, idealMax: 1.8 },\n    female: { idealMin: 1.4, idealMax: 2.0 },\n  },\n\n  upperLipRatio: {\n    // Fuller upper lip in African phenotypes\n    black: { idealMin: 0.38, idealMax: 0.48 },\n    hispanic: { idealMin: 0.36, idealMax: 0.45 },\n    east_asian: { idealMin: 0.32, idealMax: 0.40 },\n    female: { idealMin: 0.34, idealMax: 0.42 },\n  },\n\n  // ==========================================\n  // PROFILE METRICS - Gender & ethnicity\n  // ==========================================\n  chinProjection: {\n    // Males: more projected chin ideal\n    // Black/African: Adjusted for bimaxillary prognathism (forward mouth projection)\n    // Extracted from FaceIQ BlackAfrican.htc logic\n    male: { idealMin: 0, idealMax: 3 },\n    female: { idealMin: -2, idealMax: 2 },\n    black_male: { idealMin: 0, idealMax: 4 },  // Accommodates natural forward projection\n    black_female: { idealMin: -1, idealMax: 3 },\n  },\n\n  nasofrontalAngle: {\n    // Higher brow ridge in males\n    male: { idealMin: 128, idealMax: 138 },\n    female: { idealMin: 132, idealMax: 142 },\n  },\n\n  chinToPhiltrumRatio: {\n    // Black/African: Fuller lips naturally shorten visible philtrum\n    // Extracted from FaceIQ BlackAfrican.htc - relaxes \"Short Philtrum\" penalty\n    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n    black_female: { idealMin: 2.10, idealMax: 2.65 },\n  },\n\n  // ==========================================\n  // SKIN QUALITY - Ethnicity variation\n  // ==========================================\n  skinUniformity: {\n    // South Asian: Stricter standards due to genetic hyperpigmentation tendency\n    // Hispanic: Similar to South Asian - penalizes hyperpigmentation more than White model\n    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n    white_male: { idealMin: 0.88, idealMax: 1.00 },\n    white_female: { idealMin: 0.90, idealMax: 1.00 },\n    south_asian_male: { idealMin: 0.90, idealMax: 1.00 },  // Stricter - hyperpigmentation common\n    south_asian_female: { idealMin: 0.92, idealMax: 1.00 },\n    east_asian_male: { idealMin: 0.92, idealMax: 1.00 },  // High skin quality standards\n    east_asian_female: { idealMin: 0.94, idealMax: 1.00 },\n    black_male: { idealMin: 0.85, idealMax: 1.00 },  // More tolerance for melanin variation\n    black_female: { idealMin: 0.87, idealMax: 1.00 },\n    hispanic_male: { idealMin: 0.85, idealMax: 1.00 },  // Bridge: more tolerance than South Asian, less than White\n    hispanic_female: { idealMin: 0.87, idealMax: 1.00 },\n  },\n\n  // ==========================================\n  // EYEBROW METRICS - Ethnicity variation\n  // ==========================================\n  eyebrowThickness: {\n    // Middle Eastern: Heavily favors thick, dense eyebrows (\"Dark Triad\" look with deep-set eyes)\n    // Extracted from FaceIQ Male:MiddleEastern.htc - STRICTEST eyebrow requirements\n    middle_eastern_male: { idealMin: 2.5, idealMax: 5.0 },  // Prefers significantly thicker/darker brows\n    middle_eastern_female: { idealMin: 2.0, idealMax: 4.0 },\n    east_asian_male: { idealMin: 1.5, idealMax: 3.0 },  // Typically less thick\n    east_asian_female: { idealMin: 1.3, idealMax: 2.5 },\n    male: { idealMin: 2.0, idealMax: 4.0 },\n    female: { idealMin: 1.8, idealMax: 3.5 },\n  },\n\n  eyebrowDistance: {\n    // Middle Eastern: \"Kill Switch\" for unibrow (synophrys)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    // While thick brows are favored, unibrow is a critical flaw if distance < 15mm\n    middle_eastern_male: { idealMin: 15, idealMax: 25 },  // Stricter minimum to avoid unibrow\n    middle_eastern_female: { idealMin: 18, idealMax: 28 },\n    male: { idealMin: 15, idealMax: 25 },\n    female: { idealMin: 16, idealMax: 26 },\n  },\n\n  orbitalVector: {\n    // Middle Eastern: Favors deep-set eyes (lower/negative orbital vector)\n    // Part of the \"Dark Triad\" look with heavy brows\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    middle_eastern_male: { idealMin: -2, idealMax: 3 },  // Allows more deep-set eyes\n    middle_eastern_female: { idealMin: -1, idealMax: 4 },\n    male: { idealMin: 0, idealMax: 4 },\n    female: { idealMin: 1, idealMax: 5 },\n  },\n};\n\n/**\n * Get metric configuration with demographic-specific overrides applied.\n * Lookup priority: ethnicity_gender > gender > ethnicity > default\n */\nexport function getMetricConfigForDemographics(\n  metricId: string,\n  gender: Gender,\n  ethnicity: Ethnicity = 'other'\n): MetricConfig | null {\n  const baseConfig = FACEIQ_METRICS[metricId];\n  if (!baseConfig) return null;\n\n  const overrides = DEMOGRAPHIC_OVERRIDES[metricId];\n  if (!overrides) return baseConfig;\n\n  // Try specific combo first (e.g., \"east_asian_male\")\n  const specificKey = `${ethnicity}_${gender}` as DemographicKey;\n  const override = overrides[specificKey] || overrides[gender] || overrides[ethnicity];\n\n  if (!override) return baseConfig;\n\n  return {\n    ...baseConfig,\n    idealMin: override.idealMin,\n    idealMax: override.idealMax,\n  };\n}\n\n// ============================================\n// FACEIQ MEASUREMENT CONFIGURATIONS (70+)\n// ============================================\n\nexport const FACEIQ_METRICS: Record<string, MetricConfig> = {\n  // ==========================================\n  // FRONT PROFILE - FACIAL PROPORTIONS (32)\n  // ==========================================\n\n  faceWidthToHeight: {\n    id: 'faceWidthToHeight',\n    name: 'Face Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.96,\n    idealMax: 2.0,\n    rangeMin: 1.4,\n    rangeMax: 2.5,\n    decayRate: 6.4,\n    maxScore: 30,  // FaceIQ: highest priority metric\n    weight: 0.06,\n    description: 'Ratio of bizygomatic width to upper face height',\n    profileType: 'front',\n  },\n\n  lowerThirdProportion: {\n    id: 'lowerThirdProportion',\n    name: 'Lower Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31,\n    idealMax: 33.5,\n    rangeMin: 24,\n    rangeMax: 40,\n    decayRate: 1.86,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by lower third (subnasale to menton)',\n    profileType: 'front',\n  },\n\n  middleThirdProportion: {\n    id: 'middleThirdProportion',\n    name: 'Middle Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31.4,\n    idealMax: 33.4,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by middle third',\n    profileType: 'front',\n  },\n\n  upperThirdProportion: {\n    id: 'upperThirdProportion',\n    name: 'Upper Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 30,\n    idealMax: 32,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Percentage of face occupied by upper third (trichion to glabella)',\n    profileType: 'front',\n  },\n\n  bitemporalWidth: {\n    id: 'bitemporalWidth',\n    name: 'Bitemporal Width',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 75,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Temple width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  cheekboneHeight: {\n    id: 'cheekboneHeight',\n    name: 'Cheekbone Height',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 83,\n    idealMax: 100,\n    rangeMin: 30,\n    rangeMax: 140,\n    decayRate: 0.5,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Vertical position of cheekbones relative to face height',\n    profileType: 'front',\n  },\n\n  totalFacialWidthToHeight: {\n    id: 'totalFacialWidthToHeight',\n    name: 'Total Facial Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.34,\n    idealMax: 1.37,\n    rangeMin: 1.0,\n    rangeMax: 1.7,\n    decayRate: 13.2,\n    maxScore: 25,  // Special: higher max score\n    weight: 0.05,\n    description: 'Total face height divided by cheek width',\n    profileType: 'front',\n    customCurve: {\n      mode: 'custom',\n      points: [\n        { x: 1.05, y: 0 },\n        { x: 1.17, y: 1.41 },\n        { x: 1.25, y: 3.86 },\n        { x: 1.29, y: 6.01 },\n        { x: 1.32, y: 8.88 },\n        { x: 1.34, y: 10, fixed: true },\n        { x: 1.37, y: 10, fixed: true },\n        { x: 1.39, y: 8.88 },\n        { x: 1.42, y: 6.01 },\n        { x: 1.46, y: 3.86 },\n        { x: 1.54, y: 1.41 },\n        { x: 1.66, y: 0 },\n      ],\n    },\n  },\n\n  midfaceRatio: {\n    id: 'midfaceRatio',\n    name: 'Midface Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 0.97,\n    idealMax: 1.0,\n    rangeMin: 0.5,\n    rangeMax: 1.5,\n    decayRate: 31.6,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.04,\n    description: 'Midface width to height ratio for facial balance',\n    profileType: 'front',\n  },\n\n  // JAW MEASUREMENTS\n  jawSlope: {\n    id: 'jawSlope',\n    name: 'Jaw Slope',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 140,\n    idealMax: 142.5,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of the jawline from gonion to chin',\n    profileType: 'front',\n  },\n\n  jawFrontalAngle: {\n    id: 'jawFrontalAngle',\n    name: 'Jaw Frontal Angle',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 35,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 20,  // FaceIQ: high priority\n    weight: 0.04,\n    description: 'Angle of jaw corners from frontal view',\n    profileType: 'front',\n  },\n\n  bigonialWidth: {\n    id: 'bigonialWidth',\n    name: 'Bigonial Width',\n    category: 'Jaw Shape',\n    unit: 'percent',\n    idealMin: 87.75,\n    idealMax: 91.75,\n    rangeMin: 60.25,\n    rangeMax: 120.25,\n    decayRate: 0.9,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Jaw width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  jawWidthRatio: {\n    id: 'jawWidthRatio',\n    name: 'Jaw Width to Face Width Ratio',\n    category: 'Jaw Shape',\n    unit: 'ratio',\n    idealMin: 0.75,\n    idealMax: 0.82,\n    rangeMin: 0.6,\n    rangeMax: 0.95,\n    decayRate: 25.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Bigonial width divided by bizygomatic width',\n    profileType: 'front',\n  },\n\n  // EYE MEASUREMENTS\n  lateralCanthalTilt: {\n    id: 'lateralCanthalTilt',\n    name: 'Lateral Canthal Tilt',\n    category: 'Eyes',\n    unit: 'degrees',\n    idealMin: 4.0,   // Updated: 4-8Â° is peak \"hunter eyes\"\n    idealMax: 8.0,\n    rangeMin: -5,\n    rangeMax: 20,\n    decayRate: 1.5,  // Reduced: gentler decay for positive tilts\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle of eye from inner to outer canthus. Positive tilt is attractive.',\n    profileType: 'front',\n    // DIRECTIONAL SCORING: Higher (positive) tilt is better\n    // - Ideal: 4-8Â° (attractive upswept eyes / \"hunter eyes\")\n    // - Good: 0-4Â° (neutral to slight positive - still attractive)\n    // - Weak: < 0Â° (negative/droopy tilt - only this is a true weakness)\n    polarity: 'higher_is_better',\n    safeFloor: 0.0,       // Neutral tilt - anything above is acceptable\n    softZoneScore: 8.0,   // \"Good\" score for 0-4Â° range\n  },\n\n  eyeAspectRatio: {\n    id: 'eyeAspectRatio',\n    name: 'Eye Aspect Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 3.0,\n    idealMax: 3.5,\n    rangeMin: 0.8,\n    rangeMax: 6,\n    decayRate: 2.0,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Eye width divided by eye height',\n    profileType: 'front',\n  },\n\n  eyeSeparationRatio: {\n    id: 'eyeSeparationRatio',\n    name: 'Eye Separation Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 45.7,\n    idealMax: 46.8,\n    rangeMin: 35,\n    rangeMax: 55,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Intercanthal distance as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryRatio: {\n    id: 'interpupillaryRatio',\n    name: 'Interpupillary Distance Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 44,\n    idealMax: 48,\n    rangeMin: 38,\n    rangeMax: 54,\n    decayRate: 1.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'IPD as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryMouthWidthRatio: {\n    id: 'interpupillaryMouthWidthRatio',\n    name: 'Interpupillary-Mouth Width Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.83,\n    idealMax: 0.87,\n    rangeMin: 0.6,\n    rangeMax: 1.1,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Mouth width divided by interpupillary distance',\n    profileType: 'front',\n  },\n\n  oneEyeApartTest: {\n    id: 'oneEyeApartTest',\n    name: 'One Eye Apart Test',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.95,\n    idealMax: 1.0,\n    rangeMin: 0.7,\n    rangeMax: 1.3,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Intercanthal distance should equal one eye width',\n    profileType: 'front',\n  },\n\n  tearTroughDepth: {\n    id: 'tearTroughDepth',\n    name: 'Tear Trough Depth',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.0,\n    idealMax: 1.5,\n    rangeMin: 0.0,\n    rangeMax: 4.0,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Under-eye hollow depth (infraorbital depression). Lower is better for youthfulness.',\n    profileType: 'front',\n    polarity: 'lower_is_better',\n    safeCeiling: 1.5,  // White standard\n    softZoneScore: 7.5,\n  },\n\n  upperEyelidExposure: {\n    id: 'upperEyelidExposure',\n    name: 'Upper Eyelid Exposure',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 2.5,\n    rangeMin: 0.0,\n    rangeMax: 5.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Visible upper eyelid platform. Too little creates hooded eyes.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  // EYEBROW MEASUREMENTS\n  eyebrowThickness: {\n    id: 'eyebrowThickness',\n    name: 'Eyebrow Thickness',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 2.0,\n    idealMax: 4.0,\n    rangeMin: 1.0,\n    rangeMax: 6.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow density and thickness. Higher values indicate fuller, denser brows.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  eyebrowDistance: {\n    id: 'eyebrowDistance',\n    name: 'Inter-Eyebrow Distance',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 15,\n    idealMax: 25,\n    rangeMin: 5,\n    rangeMax: 40,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance between inner edges of eyebrows. Too low creates unibrow (synophrys).',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  browLengthRatio: {\n    id: 'browLengthRatio',\n    name: 'Brow Length to Face Width Ratio',\n    category: 'Upper Third',\n    unit: 'percent',\n    idealMin: 28,\n    idealMax: 32,\n    rangeMin: 20,\n    rangeMax: 40,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow length as percentage of face width',\n    profileType: 'front',\n  },\n\n  eyebrowTilt: {\n    id: 'eyebrowTilt',\n    name: 'Eyebrow Tilt',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 6.5,\n    idealMax: 11,\n    rangeMin: -5,\n    rangeMax: 25,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of eyebrow from head to tail',\n    profileType: 'front',\n  },\n\n  eyebrowLowSetedness: {\n    id: 'eyebrowLowSetedness',\n    name: 'Eyebrow Low Setedness',\n    category: 'Upper Third',\n    unit: 'ratio',\n    idealMin: 0,\n    idealMax: 0.45,\n    rangeMin: -0.2,\n    rangeMax: 1.0,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from brow to eye relative to eye height',\n    profileType: 'front',\n  },\n\n  // NOSE MEASUREMENTS (FRONT)\n  nasalIndex: {\n    id: 'nasalIndex',\n    name: 'Nasal Index',\n    category: 'Nose',\n    unit: 'percent',\n    idealMin: 70,\n    idealMax: 85,\n    rangeMin: 55,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose width divided by nose height Ã— 100',\n    profileType: 'front',\n  },\n\n  intercanthalNasalRatio: {\n    id: 'intercanthalNasalRatio',\n    name: 'Intercanthal-Nasal Width Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 1.04,\n    idealMax: 1.16,\n    rangeMin: 0.7,\n    rangeMax: 1.5,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Alar width should roughly equal intercanthal distance',\n    profileType: 'front',\n  },\n\n  noseBridgeWidth: {\n    id: 'noseBridgeWidth',\n    name: 'Nose Bridge to Nose Width',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.6,\n    idealMax: 0.75,\n    rangeMin: 0.4,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ratio of nose bridge width to alar base width',\n    profileType: 'front',\n  },\n\n  noseTipPosition: {\n    id: 'noseTipPosition',\n    name: 'Nose Tip Position',\n    category: 'Nose',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 3.5,\n    rangeMin: -7.5,\n    rangeMax: 12.5,\n    decayRate: 1.5,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Nose tip deviation from facial midline',\n    profileType: 'front',\n  },\n\n  // MOUTH/LIP MEASUREMENTS\n  mouthWidthToNoseRatio: {\n    id: 'mouthWidthToNoseRatio',\n    name: 'Mouth Width to Nose Width Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.43,\n    idealMax: 1.51,\n    rangeMin: 0.96,\n    rangeMax: 1.91,\n    decayRate: 18.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Mouth width divided by nose width',\n    profileType: 'front',\n  },\n\n  lowerToUpperLipRatio: {\n    id: 'lowerToUpperLipRatio',\n    name: 'Lower Lip to Upper Lip Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.58,\n    idealMax: 1.88,\n    rangeMin: -0.98,\n    rangeMax: 4.03,\n    decayRate: 8.0,\n    maxScore: 7.5,  // FaceIQ: medium priority\n    weight: 0.02,\n    description: 'Lower lip height divided by upper lip height',\n    profileType: 'front',\n  },\n\n  cupidsBowDepth: {\n    id: 'cupidsBowDepth',\n    name: \"Cupid's Bow Depth\",\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2.3,\n    idealMax: 4,\n    rangeMin: 0,\n    rangeMax: 7,\n    decayRate: 2.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: \"Depth of the cupid's bow curve\",\n    profileType: 'front',\n  },\n\n  mouthCornerPosition: {\n    id: 'mouthCornerPosition',\n    name: 'Mouth Corner Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Mouth corner vertical position relative to lip center',\n    profileType: 'front',\n  },\n\n  // CHIN MEASUREMENTS (FRONT)\n  chinToPhiltrumRatio: {\n    id: 'chinToPhiltrumRatio',\n    name: 'Chin to Philtrum Ratio',\n    category: 'Chin',\n    unit: 'ratio',\n    idealMin: 2.15,\n    idealMax: 2.45,\n    rangeMin: 0.3,\n    rangeMax: 4.5,\n    decayRate: 10.0,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.02,\n    description: 'Chin height divided by philtrum length',\n    profileType: 'front',\n  },\n\n  // OTHER FRONT MEASUREMENTS\n  iaaJfaDeviation: {\n    id: 'iaaJfaDeviation',\n    name: 'Deviation of IAA & JFA',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 0,\n    idealMax: 2.5,\n    rangeMin: -25,\n    rangeMax: 30,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Deviation between Ipsilateral Alar Angle and Jaw Frontal Angle',\n    profileType: 'front',\n  },\n\n  ipsilateralAlarAngle: {\n    id: 'ipsilateralAlarAngle',\n    name: 'Ipsilateral Alar Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 60,\n    rangeMax: 125,\n    decayRate: 0.6,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Angle of alar base relative to facial plane',\n    profileType: 'front',\n  },\n\n  earProtrusionAngle: {\n    id: 'earProtrusionAngle',\n    name: 'Ear Protrusion Angle',\n    category: 'Ears',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 11.5,\n    rangeMin: -25,\n    rangeMax: 40,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of ear protrusion from head',\n    profileType: 'front',\n  },\n\n  earProtrusionRatio: {\n    id: 'earProtrusionRatio',\n    name: 'Ear Protrusion Ratio',\n    category: 'Ears',\n    unit: 'percent',\n    idealMin: 8,\n    idealMax: 12,\n    rangeMin: -20,\n    rangeMax: 40,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ear protrusion as percentage of head width',\n    profileType: 'front',\n  },\n\n  neckWidth: {\n    id: 'neckWidth',\n    name: 'Neck Width',\n    category: 'Neck',\n    unit: 'percent',\n    idealMin: 92,\n    idealMax: 98,\n    rangeMin: 60,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Neck width as percentage of jaw width',\n    profileType: 'front',\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS (38)\n  // ==========================================\n\n  gonialAngle: {\n    id: 'gonialAngle',\n    name: 'Gonial Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 130,\n    rangeMin: 105,\n    rangeMax: 145,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle at the jaw corner (gonion)',\n    profileType: 'side',\n  },\n\n  nasolabialAngle: {\n    id: 'nasolabialAngle',\n    name: 'Nasolabial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 90,\n    idealMax: 105,\n    rangeMin: 75,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle between columella and upper lip',\n    profileType: 'side',\n  },\n\n  nasofrontalAngle: {\n    id: 'nasofrontalAngle',\n    name: 'Nasofrontal Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 116,\n    idealMax: 128,\n    rangeMin: 90,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the bridge of nose (nasion)',\n    profileType: 'side',\n  },\n\n  nasofacialAngle: {\n    id: 'nasofacialAngle',\n    name: 'Nasofacial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 31,\n    idealMax: 35,\n    rangeMin: 15,\n    rangeMax: 50,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between nose and face plane',\n    profileType: 'side',\n  },\n\n  nasomentaAngle: {\n    id: 'nasomentaAngle',\n    name: 'Nasomental Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 126,\n    idealMax: 131,\n    rangeMin: 105,\n    rangeMax: 155,\n    decayRate: 0.7,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle from nasion to nose tip to chin',\n    profileType: 'side',\n  },\n\n  nasalTipAngle: {\n    id: 'nasalTipAngle',\n    name: 'Nasal Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 105,\n    rangeMin: 70,\n    rangeMax: 120,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the nose tip',\n    profileType: 'side',\n  },\n\n  nasalProjection: {\n    id: 'nasalProjection',\n    name: 'Nasal Projection',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.55,\n    idealMax: 0.6,\n    rangeMin: 0.4,\n    rangeMax: 0.75,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose projection relative to nasal length (Goode ratio)',\n    profileType: 'side',\n  },\n\n  nasalWToHRatio: {\n    id: 'nasalWToHRatio',\n    name: 'Nasal W to H Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.67,\n    idealMax: 0.78,\n    rangeMin: 0.5,\n    rangeMax: 0.95,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Nose width to height ratio from side view',\n    profileType: 'side',\n  },\n\n  noseTipRotationAngle: {\n    id: 'noseTipRotationAngle',\n    name: 'Nose Tip Rotation Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 95,\n    idealMax: 110,\n    rangeMin: 80,\n    rangeMax: 125,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of nose tip rotation',\n    profileType: 'side',\n  },\n\n  frankfortTipAngle: {\n    id: 'frankfortTipAngle',\n    name: 'Frankfort-Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 28,\n    idealMax: 34,\n    rangeMin: 20,\n    rangeMax: 42,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle between Frankfort plane and nose tip',\n    profileType: 'side',\n  },\n\n  mentolabialAngle: {\n    id: 'mentolabialAngle',\n    name: 'Mentolabial Angle',\n    category: 'Lips',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 140,\n    rangeMin: 100,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the labiomental fold',\n    profileType: 'side',\n  },\n\n  zAngle: {\n    id: 'zAngle',\n    name: 'Z Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 75,\n    idealMax: 85,\n    rangeMin: 60,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Merrifield Z-Angle for profile assessment',\n    profileType: 'side',\n  },\n\n  submentalCervicalAngle: {\n    id: 'submentalCervicalAngle',\n    name: 'Submental Cervical Angle',\n    category: 'Neck',\n    unit: 'degrees',\n    idealMin: 94,\n    idealMax: 106,\n    rangeMin: 70,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between chin and neck',\n    profileType: 'side',\n  },\n\n  facialConvexityGlabella: {\n    id: 'facialConvexityGlabella',\n    name: 'Facial Convexity (Glabella)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 165,\n    idealMax: 175,\n    rangeMin: 150,\n    rangeMax: 185,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Facial convexity angle using glabella',\n    profileType: 'side',\n  },\n\n  facialConvexityNasion: {\n    id: 'facialConvexityNasion',\n    name: 'Facial Convexity (Nasion)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 168,\n    idealMax: 178,\n    rangeMin: 155,\n    rangeMax: 190,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial convexity angle using nasion',\n    profileType: 'side',\n  },\n\n  totalFacialConvexity: {\n    id: 'totalFacialConvexity',\n    name: 'Total Facial Convexity',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 135,\n    idealMax: 145,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Complete facial profile convexity measurement',\n    profileType: 'side',\n  },\n\n  facialDepthToHeight: {\n    id: 'facialDepthToHeight',\n    name: 'Facial Depth to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.3,\n    idealMax: 1.44,\n    rangeMin: 0.7,\n    rangeMax: 1.8,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial depth divided by facial height',\n    profileType: 'side',\n  },\n\n  anteriorFacialDepth: {\n    id: 'anteriorFacialDepth',\n    name: 'Anterior Facial Depth',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 64.5,\n    idealMax: 67.5,\n    rangeMin: 45,\n    rangeMax: 95,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Anterior facial projection angle',\n    profileType: 'side',\n  },\n\n  interiorMidfaceProjectionAngle: {\n    id: 'interiorMidfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 50,\n    idealMax: 56,\n    rangeMin: 30,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Interior midface projection from side profile',\n    profileType: 'side',\n  },\n\n  recessionFromFrankfort: {\n    id: 'recessionFromFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'mm',\n    idealMin: 1.5,\n    idealMax: 15,\n    rangeMin: -30,\n    rangeMax: 30,\n    decayRate: 0.3,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin position relative to Frankfort plane',\n    profileType: 'side',\n  },\n\n  mandibularPlaneAngle: {\n    id: 'mandibularPlaneAngle',\n    name: 'Mandibular Plane Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 22,\n    idealMax: 28,\n    rangeMin: 15,\n    rangeMax: 38,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of mandibular plane to Frankfort plane',\n    profileType: 'side',\n  },\n\n  ramusToMandibleRatio: {\n    id: 'ramusToMandibleRatio',\n    name: 'Ramus to Mandible Ratio',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'ratio',\n    idealMin: 0.65,\n    idealMax: 0.75,\n    rangeMin: 0.5,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Ramus height divided by mandible length',\n    profileType: 'side',\n  },\n\n  gonionToMouthLine: {\n    id: 'gonionToMouthLine',\n    name: 'Gonion to Mouth Line',\n    category: 'Jaw Shape',\n    unit: 'mm',\n    idealMin: -5,\n    idealMax: 5,\n    rangeMin: -20,\n    rangeMax: 20,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from gonion to mouth level line',\n    profileType: 'side',\n  },\n\n  // E-LINE MEASUREMENTS\n  eLineUpperLip: {\n    id: 'eLineUpperLip',\n    name: 'Upper Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -4,\n    idealMax: -2,\n    rangeMin: -10,\n    rangeMax: 4,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Upper lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  eLineLowerLip: {\n    id: 'eLineLowerLip',\n    name: 'Lower Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 0,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Lower lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  // S-LINE MEASUREMENTS\n  sLineUpperLip: {\n    id: 'sLineUpperLip',\n    name: 'Upper Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 3,\n    rangeMin: -5,\n    rangeMax: 8,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  sLineLowerLip: {\n    id: 'sLineLowerLip',\n    name: 'Lower Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -0.4,\n    idealMax: 0.4,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  // BURSTONE LINE\n  burstoneUpperLip: {\n    id: 'burstoneUpperLip',\n    name: 'Upper Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2,\n    idealMax: 4,\n    rangeMin: -2,\n    rangeMax: 8,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  burstoneLowerLip: {\n    id: 'burstoneLowerLip',\n    name: 'Lower Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 1,\n    idealMax: 3,\n    rangeMin: -3,\n    rangeMax: 7,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  // H LINE\n  holdawayHLine: {\n    id: 'holdawayHLine',\n    name: 'Holdaway H Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Holdaway H-line soft tissue assessment',\n    profileType: 'side',\n  },\n\n  // CHIN MEASUREMENTS (SIDE)\n  chinProjection: {\n    id: 'chinProjection',\n    name: 'Chin Projection',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -3,\n    idealMax: 3,\n    rangeMin: -12,\n    rangeMax: 12,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin projection relative to ideal position',\n    profileType: 'side',\n  },\n\n  recessionRelativeToFrankfort: {\n    id: 'recessionRelativeToFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 2,\n    rangeMin: -10,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin recession relative to Frankfort horizontal',\n    profileType: 'side',\n  },\n\n  // FOREHEAD\n  browridgeInclinationAngle: {\n    id: 'browridgeInclinationAngle',\n    name: 'Browridge Inclination Angle',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 18,\n    rangeMin: 0,\n    rangeMax: 28,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the brow ridge from profile',\n    profileType: 'side',\n  },\n\n  upperForeheadSlope: {\n    id: 'upperForeheadSlope',\n    name: 'Upper Forehead Slope',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 5,\n    idealMax: 12,\n    rangeMin: 0,\n    rangeMax: 20,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Slope angle of the upper forehead',\n    profileType: 'side',\n  },\n\n  // MIDFACE PROJECTION\n  midfaceProjectionAngle: {\n    id: 'midfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 95,\n    rangeMin: 75,\n    rangeMax: 105,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of midface projection from profile',\n    profileType: 'side',\n  },\n\n  orbitalVector: {\n    id: 'orbitalVector',\n    name: 'Orbital Vector',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -6,\n    rangeMax: 10,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Relationship of globe to orbital rim',\n    profileType: 'side',\n  },\n\n  skinUniformity: {\n    id: 'skinUniformity',\n    name: 'Skin Uniformity',\n    category: 'Skin Quality',\n    unit: 'ratio',\n    idealMin: 0.90,\n    idealMax: 1.00,\n    rangeMin: 0.50,\n    rangeMax: 1.00,\n    decayRate: 5.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Skin tone evenness and hyperpigmentation. 1.0 = perfectly uniform.',\n    profileType: 'front',\n    polarity: 'higher_is_better',\n    safeFloor: 0.85,  // Acceptable uniformity threshold\n    softZoneScore: 7.5,\n  },\n\n};\n\n// ============================================\n// FLAW MAPPINGS (Extracted from FaceIQ)\n// ============================================\n\nexport interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n  reasoning: string;\n}\n\nexport const METRIC_FLAW_MAPPINGS: Record<string, FlawMapping[]> = {\n  anteriorFacialDepth: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Anterior Facial Depth measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  bitemporalWidth: [\n    { category: 'Upper Third', flawName: 'Narrow forehead', confidence: 'confirmed', reasoning: 'Reduced bitemporal width indicates a narrower than ideal forehead relative to the cheekbones. This disrupts facial harmony by creating a compressed hairline and forehead, altering the overall shape of the face.' },\n  ],\n  cheekboneHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Low-set cheekbones', confidence: 'confirmed', reasoning: 'Reduced cheekbone height indicates that the cheekbones are positioned lower than ideal. This disrupts facial harmony by creating an unpronounced appearance to the cheekbones and facial structure.' },\n  ],\n  eyeAspectRatio: [\n    { category: 'Eyes', flawName: 'Overly round eye shape', confidence: 'confirmed', reasoning: 'A reduced eye aspect ratio indicates overly narrow eyes relative to their height. This disrupts facial harmony by creating an overly surprised appearance and reducing angular definition.' },\n  ],\n  eyeSeparationRatio: [\n    { category: 'Eyes', flawName: 'Close-set eyes', confidence: 'confirmed', reasoning: 'Reduced eye separation indicates close-set eyes. This disrupts facial harmony by making the eye area appear too compressed.' },\n  ],\n  eyebrowLowSetedness: [\n    { category: 'Eyes', flawName: 'Medium-set eyebrows', confidence: 'confirmed', reasoning: 'Increased eyebrow low setedness indicates eyebrows that are positioned higher than ideal. This disrupts facial harmony by reducing the overall visual impact of the eyebrows and framing of the eyes.' },\n  ],\n  faceWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced face width to height ratio indicates an overly long midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  facialDepthToHeight: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'Reduced facial depth to height ratio indicates insufficient mid-face projection relative to height. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  gonialAngle: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  holdawayHLine: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'Decreased H-line indicates the lips are positioned too far in front of the line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  interiorMidfaceProjectionAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Interior Midface Projection Angle measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  ipsilateralAlarAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A decreased ipsilateral alar angle indicates an overly narrow interior midface. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  jawFrontalAngle: [\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A narrower jaw frontal angle indicates a steeper jawline or overly wide chin. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  jawSlope: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'The Jaw Slope measurement is above the ideal range. This disrupts facial harmony in the lower face.' },\n  ],\n  lateralCanthalTilt: [\n    { category: 'Eyes', flawName: 'Insufficient eye tilt', confidence: 'confirmed', reasoning: 'A decreased lateral canthal tilt indicates insufficiently upturned eyes. This disrupts facial harmony by creating a less alert and youthful appearance.' },\n  ],\n  burstoneLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the Burstone line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  eLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned too far in front of the E-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  sLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the S-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  lowerThirdProportion: [\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'The upper jaw is too long relative to lower jaw, possibly from a long upper jaw or short lower jaw, or a combination of both. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  mandibularPlaneAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Hyper-divergent jaw growth', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by elongating the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  midfaceRatio: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  nasofacialAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A smaller nasofacial angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  nasofrontalAngle: [\n    { category: 'Upper Third', flawName: 'Soft and weak brow ridge', confidence: 'confirmed', reasoning: 'An increased nasofrontal angle indicates reduced brow ridge prominence and angularity. This disrupts facial harmony by creating a less defined upper face.' },\n  ],\n  nasomentaAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A larger nasomental angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  noseBridgeWidth: [\n    { category: 'Nose', flawName: 'Overly narrow nose bridge', confidence: 'confirmed', reasoning: 'The Nose Bridge to Nose Width measurement is above the ideal range. This disrupts facial harmony by creating an unbalanced nasal profile.' },\n  ],\n  orbitalVector: [\n    { category: 'Eyes', flawName: 'Sunken orbital region', confidence: 'confirmed', reasoning: 'A decreased orbital vector indicates insufficient projection and volume underneath the eye. This disrupts facial harmony due to the lacking volume underneath the eyes, reducing vibrancy and youthfulness.' },\n  ],\n  ramusToMandibleRatio: [\n    { category: 'Jaw Shape', flawName: 'Short ramus', confidence: 'confirmed', reasoning: 'A reduced ramus-to-mandible ratio indicates a shorter than ideal vertical jawbone (ramus) when compared to the mandible. This disrupts facial harmony by reducing jaw height and definition.' },\n  ],\n  submentalCervicalAngle: [\n    { category: 'Neck', flawName: 'Round neck region', confidence: 'confirmed', reasoning: 'An increased submental cervical angle indicates a round neck region, possibly from excess submental fat or tissue. This disrupts facial harmony by reducing neck definition.' },\n  ],\n  totalFacialWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Overly long face shape', confidence: 'confirmed', reasoning: 'An increased total facial width to height ratio indicates an overly long face relative to its height. This disrupts facial harmony by creating a vertically stretched appearance to the face.' },\n  ],\n};\n\n// ============================================\n// CUSTOM BEZIER CURVES (Extracted from FaceIQ)\n// ============================================\n\nexport const METRIC_CUSTOM_CURVES: Record<string, CurvePoint[]> = {\n  faceWidthToHeight: [\n    { x: 1.49, y: 0, leftHandleX: 1.44, leftHandleY: 0, rightHandleX: 1.55, rightHandleY: 0 },\n    { x: 1.68, y: 1.05, leftHandleX: 1.62, leftHandleY: 0.36, rightHandleX: 1.71, rightHandleY: 1.58 },\n    { x: 1.77, y: 3.07, leftHandleX: 1.74, leftHandleY: 2.15, rightHandleX: 1.79, rightHandleY: 3.88 },\n    { x: 1.83, y: 5.83, leftHandleX: 1.80, leftHandleY: 4.64, rightHandleX: 1.84, rightHandleY: 6.85 },\n    { x: 1.89, y: 8.70, leftHandleX: 1.88, leftHandleY: 8.30, rightHandleX: 1.92, rightHandleY: 9.50 },\n    { x: 1.96, y: 10, leftHandleX: 1.96, leftHandleY: 10, rightHandleX: 1.96, rightHandleY: 10, fixed: true },\n    { x: 2.00, y: 10, leftHandleX: 2.00, leftHandleY: 10, rightHandleX: 2.00, rightHandleY: 10, fixed: true },\n    { x: 2.07, y: 8.70, leftHandleX: 2.04, leftHandleY: 9.50, rightHandleX: 2.08, rightHandleY: 8.30 },\n    { x: 2.13, y: 5.83, leftHandleX: 2.12, leftHandleY: 6.85, rightHandleX: 2.16, rightHandleY: 4.64 },\n    { x: 2.19, y: 3.07, leftHandleX: 2.17, leftHandleY: 3.88, rightHandleX: 2.22, rightHandleY: 2.15 },\n    { x: 2.28, y: 1.05, leftHandleX: 2.25, leftHandleY: 1.58, rightHandleX: 2.34, rightHandleY: 0.36 },\n    { x: 2.47, y: 0, leftHandleX: 2.41, leftHandleY: 0, rightHandleX: 2.52, rightHandleY: 0 },\n  ],\n  lowerThirdProportion: [\n    { x: 25.6, y: 0, leftHandleX: 24.8, leftHandleY: 0, rightHandleX: 26.4, rightHandleY: 0 },\n    { x: 28.01, y: 1.58, leftHandleX: 27.23, leftHandleY: 0.53, rightHandleX: 28.27, rightHandleY: 1.97 },\n    { x: 28.83, y: 3.21, leftHandleX: 28.60, leftHandleY: 2.60, rightHandleX: 29.10, rightHandleY: 3.90 },\n    { x: 29.63, y: 5.85, leftHandleX: 29.40, leftHandleY: 4.90, rightHandleX: 29.85, rightHandleY: 6.80 },\n    { x: 30.27, y: 8.56, leftHandleX: 30.05, leftHandleY: 7.80, rightHandleX: 30.50, rightHandleY: 9.30 },\n    { x: 31, y: 10, leftHandleX: 30.95, leftHandleY: 10, rightHandleX: 31.05, rightHandleY: 10, fixed: true },\n    { x: 33.5, y: 10, leftHandleX: 33.45, leftHandleY: 10, rightHandleX: 33.55, rightHandleY: 10, fixed: true },\n    { x: 34.23, y: 8.56, leftHandleX: 34.00, leftHandleY: 9.30, rightHandleX: 34.45, rightHandleY: 7.80 },\n    { x: 34.87, y: 5.85, leftHandleX: 34.65, leftHandleY: 6.80, rightHandleX: 35.10, rightHandleY: 4.90 },\n    { x: 35.67, y: 3.21, leftHandleX: 35.40, leftHandleY: 3.90, rightHandleX: 35.90, rightHandleY: 2.60 },\n    { x: 36.49, y: 1.58, leftHandleX: 36.23, leftHandleY: 1.97, rightHandleX: 37.27, rightHandleY: 0.53 },\n    { x: 38.9, y: 0, leftHandleX: 38.1, leftHandleY: 0, rightHandleX: 39.7, rightHandleY: 0 },\n  ],\n  lateralCanthalTilt: [\n    { x: -4.5, y: 0, leftHandleX: -5.5, leftHandleY: 0, rightHandleX: -3.5, rightHandleY: 0 },\n    { x: 0.5, y: 1.2, leftHandleX: -0.8, leftHandleY: 0.4, rightHandleX: 1.5, rightHandleY: 1.8 },\n    { x: 2.8, y: 3.5, leftHandleX: 2.2, leftHandleY: 2.5, rightHandleX: 3.4, rightHandleY: 4.3 },\n    { x: 4.5, y: 6.8, leftHandleX: 4.0, leftHandleY: 5.5, rightHandleX: 5.0, rightHandleY: 7.8 },\n    { x: 5.8, y: 9.2, leftHandleX: 5.4, leftHandleY: 8.5, rightHandleX: 5.95, rightHandleY: 9.7 },\n    { x: 6.1, y: 10, leftHandleX: 6.05, leftHandleY: 10, rightHandleX: 6.15, rightHandleY: 10, fixed: true },\n    { x: 7.8, y: 10, leftHandleX: 7.75, leftHandleY: 10, rightHandleX: 7.85, rightHandleY: 10, fixed: true },\n    { x: 8.1, y: 9.2, leftHandleX: 7.95, leftHandleY: 9.7, rightHandleX: 8.5, rightHandleY: 8.5 },\n    { x: 9.4, y: 6.8, leftHandleX: 8.9, leftHandleY: 7.8, rightHandleX: 9.9, rightHandleY: 5.5 },\n    { x: 11.1, y: 3.5, leftHandleX: 10.5, leftHandleY: 4.3, rightHandleX: 11.7, rightHandleY: 2.5 },\n    { x: 13.4, y: 1.2, leftHandleX: 12.4, leftHandleY: 1.8, rightHandleX: 14.7, rightHandleY: 0.4 },\n    { x: 18.4, y: 0, leftHandleX: 17.4, leftHandleY: 0, rightHandleX: 19.4, rightHandleY: 0 },\n  ],\n  gonialAngle: [\n    { x: 105, y: 0, leftHandleX: 102, leftHandleY: 0, rightHandleX: 108, rightHandleY: 0 },\n    { x: 112, y: 1.5, leftHandleX: 110, leftHandleY: 0.5, rightHandleX: 114, rightHandleY: 2.3 },\n    { x: 116, y: 4.2, leftHandleX: 114.5, leftHandleY: 3.0, rightHandleX: 117.5, rightHandleY: 5.2 },\n    { x: 118.5, y: 7.5, leftHandleX: 117.5, leftHandleY: 6.3, rightHandleX: 119.5, rightHandleY: 8.5 },\n    { x: 120, y: 10, leftHandleX: 119.7, leftHandleY: 10, rightHandleX: 120.3, rightHandleY: 10, fixed: true },\n    { x: 130, y: 10, leftHandleX: 129.7, leftHandleY: 10, rightHandleX: 130.3, rightHandleY: 10, fixed: true },\n    { x: 131.5, y: 7.5, leftHandleX: 130.5, leftHandleY: 8.5, rightHandleX: 132.5, rightHandleY: 6.3 },\n    { x: 134, y: 4.2, leftHandleX: 132.5, leftHandleY: 5.2, rightHandleX: 135.5, rightHandleY: 3.0 },\n    { x: 138, y: 1.5, leftHandleX: 136, leftHandleY: 2.3, rightHandleX: 140, rightHandleY: 0.5 },\n    { x: 145, y: 0, leftHandleX: 142, leftHandleY: 0, rightHandleX: 148, rightHandleY: 0 },\n  ],\n  nasolabialAngle: [\n    { x: 75, y: 0, leftHandleX: 72, leftHandleY: 0, rightHandleX: 78, rightHandleY: 0 },\n    { x: 82, y: 2.0, leftHandleX: 79.5, leftHandleY: 0.7, rightHandleX: 84, rightHandleY: 3.0 },\n    { x: 86, y: 5.5, leftHandleX: 84.5, leftHandleY: 4.2, rightHandleX: 87.5, rightHandleY: 6.8 },\n    { x: 89, y: 8.8, leftHandleX: 88, leftHandleY: 7.8, rightHandleX: 89.7, rightHandleY: 9.5 },\n    { x: 90, y: 10, leftHandleX: 89.8, leftHandleY: 10, rightHandleX: 90.2, rightHandleY: 10, fixed: true },\n    { x: 105, y: 10, leftHandleX: 104.8, leftHandleY: 10, rightHandleX: 105.2, rightHandleY: 10, fixed: true },\n    { x: 106, y: 8.8, leftHandleX: 105.3, leftHandleY: 9.5, rightHandleX: 107, rightHandleY: 7.8 },\n    { x: 109, y: 5.5, leftHandleX: 107.5, leftHandleY: 6.8, rightHandleX: 110.5, rightHandleY: 4.2 },\n    { x: 113, y: 2.0, leftHandleX: 111, leftHandleY: 3.0, rightHandleX: 115.5, rightHandleY: 0.7 },\n    { x: 120, y: 0, leftHandleX: 117, leftHandleY: 0, rightHandleX: 123, rightHandleY: 0 },\n  ],\n  // Middle Third Proportion curve (ideal: 31.4-33.4%)\n  middleThirdProportion: [\n    { x: 21.44, y: 0, leftHandleX: 20.29, leftHandleY: 0, rightHandleX: 23.19, rightHandleY: 0.15 },\n    { x: 25.5, y: 1.35, leftHandleX: 24.18, leftHandleY: 0.53, rightHandleX: 26.17, rightHandleY: 1.79 },\n    { x: 27.34, y: 3.18, leftHandleX: 26.84, leftHandleY: 2.42, rightHandleX: 27.73, rightHandleY: 3.81 },\n    { x: 28.65, y: 5.88, leftHandleX: 28.33, leftHandleY: 4.91, rightHandleX: 28.98, rightHandleY: 6.65 },\n    { x: 29.95, y: 8.55, leftHandleX: 29.41, leftHandleY: 7.58, rightHandleX: 30.45, rightHandleY: 9.35 },\n    { x: 31.4, y: 10, leftHandleX: 31.3, leftHandleY: 10, rightHandleX: 31.5, rightHandleY: 10, fixed: true },\n    { x: 33.4, y: 10, leftHandleX: 33.3, leftHandleY: 10, rightHandleX: 33.5, rightHandleY: 10, fixed: true },\n    { x: 34.85, y: 8.55, leftHandleX: 34.35, leftHandleY: 9.35, rightHandleX: 35.39, rightHandleY: 7.58 },\n    { x: 36.15, y: 5.88, leftHandleX: 35.82, leftHandleY: 6.65, rightHandleX: 36.47, rightHandleY: 4.91 },\n    { x: 37.46, y: 3.18, leftHandleX: 37.07, leftHandleY: 3.81, rightHandleX: 37.96, rightHandleY: 2.42 },\n    { x: 39.3, y: 1.35, leftHandleX: 38.63, leftHandleY: 1.79, rightHandleX: 40.62, rightHandleY: 0.53 },\n    { x: 43.36, y: 0, leftHandleX: 41.61, leftHandleY: 0.15, rightHandleX: 44.51, rightHandleY: 0 },\n  ],\n  // Upper Third Proportion curve (ideal: 30-32%)\n  upperThirdProportion: [\n    { x: 18.75, y: 0.02, leftHandleX: 17.15, leftHandleY: 0.02, rightHandleX: 20.35, rightHandleY: 0.02 },\n    { x: 23.82, y: 1.52, leftHandleX: 22.35, leftHandleY: 0.8, rightHandleX: 24.73, rightHandleY: 2.06 },\n    { x: 26.05, y: 4.06, leftHandleX: 25.48, leftHandleY: 2.86, rightHandleX: 26.41, rightHandleY: 4.99 },\n    { x: 27.19, y: 6.79, leftHandleX: 26.96, leftHandleY: 6.16, rightHandleX: 27.66, rightHandleY: 7.85 },\n    { x: 28.54, y: 9.08, leftHandleX: 28.02, leftHandleY: 8.5, rightHandleX: 28.93, rightHandleY: 9.54 },\n    { x: 30, y: 10, leftHandleX: 29.9, leftHandleY: 10, rightHandleX: 30.1, rightHandleY: 10, fixed: true },\n    { x: 32, y: 10, leftHandleX: 31.9, leftHandleY: 10, rightHandleX: 32.1, rightHandleY: 10, fixed: true },\n    { x: 33.46, y: 9.08, leftHandleX: 33.07, leftHandleY: 9.54, rightHandleX: 33.98, rightHandleY: 8.5 },\n    { x: 34.81, y: 6.79, leftHandleX: 34.34, leftHandleY: 7.85, rightHandleX: 35.04, rightHandleY: 6.16 },\n    { x: 35.95, y: 4.06, leftHandleX: 35.59, leftHandleY: 4.99, rightHandleX: 36.52, rightHandleY: 2.86 },\n    { x: 38.18, y: 1.52, leftHandleX: 37.27, leftHandleY: 2.06, rightHandleX: 39.65, rightHandleY: 0.8 },\n    { x: 43.25, y: 0.02, leftHandleX: 41.65, leftHandleY: 0.02, rightHandleX: 44.85, rightHandleY: 0.02 },\n  ],\n  // Eye Separation Ratio curve (ideal: 45.7-46.8%)\n  eyeSeparationRatio: [\n    { x: 36.54, y: 0, leftHandleX: 35.44, leftHandleY: 0, rightHandleX: 37.40, rightHandleY: 0.04 },\n    { x: 39.04, y: 0.63, leftHandleX: 38.16, leftHandleY: 0.21, rightHandleX: 39.77, rightHandleY: 1.05 },\n    { x: 41.08, y: 2.17, leftHandleX: 40.57, leftHandleY: 1.71, rightHandleX: 41.62, rightHandleY: 2.76 },\n    { x: 42.71, y: 4.74, leftHandleX: 42.26, leftHandleY: 3.81, rightHandleX: 43.08, rightHandleY: 5.52 },\n    { x: 43.94, y: 7.37, leftHandleX: 43.65, leftHandleY: 6.79, rightHandleX: 44.17, rightHandleY: 7.77 },\n    { x: 44.86, y: 9.02, leftHandleX: 44.54, leftHandleY: 8.56, rightHandleX: 45.08, rightHandleY: 9.5 },\n    { x: 45.7, y: 10, leftHandleX: 45.65, leftHandleY: 10, rightHandleX: 45.76, rightHandleY: 10, fixed: true },\n    { x: 46.8, y: 10, leftHandleX: 46.75, leftHandleY: 10, rightHandleX: 46.86, rightHandleY: 10, fixed: true },\n    { x: 47.64, y: 9.02, leftHandleX: 47.42, leftHandleY: 9.5, rightHandleX: 47.96, rightHandleY: 8.56 },\n    { x: 48.56, y: 7.37, leftHandleX: 48.33, leftHandleY: 7.77, rightHandleX: 48.85, rightHandleY: 6.79 },\n    { x: 49.79, y: 4.74, leftHandleX: 49.42, leftHandleY: 5.52, rightHandleX: 50.24, rightHandleY: 3.81 },\n    { x: 51.42, y: 2.17, leftHandleX: 50.88, leftHandleY: 2.76, rightHandleX: 51.93, rightHandleY: 1.71 },\n    { x: 53.46, y: 0.63, leftHandleX: 52.73, leftHandleY: 1.05, rightHandleX: 54.34, rightHandleY: 0.21 },\n    { x: 55.96, y: 0, leftHandleX: 55.10, leftHandleY: 0.04, rightHandleX: 57.06, rightHandleY: 0 },\n  ],\n  // Eyebrow Low Setedness curve (ideal: 0-0.45)\n  eyebrowLowSetedness: [\n    { x: -2.78, y: 0, leftHandleX: -3.11, leftHandleY: 0, rightHandleX: -2.67, rightHandleY: 0 },\n    { x: -1.94, y: 0.4, leftHandleX: -2.08, leftHandleY: 0.11, rightHandleX: -1.81, rightHandleY: 0.57 },\n    { x: -1.18, y: 2.25, leftHandleX: -1.36, leftHandleY: 1.5, rightHandleX: -1.05, rightHandleY: 2.72 },\n    { x: -0.79, y: 4.06, leftHandleX: -0.88, leftHandleY: 3.43, rightHandleX: -0.68, rightHandleY: 4.84 },\n    { x: -0.55, y: 6.21, leftHandleX: -0.58, leftHandleY: 5.55, rightHandleX: -0.47, rightHandleY: 6.92 },\n    { x: -0.28, y: 8.76, leftHandleX: -0.37, leftHandleY: 8.23, rightHandleX: -0.23, rightHandleY: 9.22 },\n    { x: 0, y: 10, leftHandleX: -0.02, leftHandleY: 10, rightHandleX: 0.02, rightHandleY: 10, fixed: true },\n    { x: 0.45, y: 10, leftHandleX: 0.43, leftHandleY: 10, rightHandleX: 0.47, rightHandleY: 10, fixed: true },\n    { x: 0.73, y: 8.76, leftHandleX: 0.68, leftHandleY: 9.22, rightHandleX: 0.82, rightHandleY: 8.23 },\n    { x: 1, y: 6.21, leftHandleX: 0.92, leftHandleY: 6.92, rightHandleX: 1.03, rightHandleY: 5.55 },\n    { x: 1.24, y: 4.06, leftHandleX: 1.13, leftHandleY: 4.84, rightHandleX: 1.33, rightHandleY: 3.43 },\n    { x: 1.63, y: 2.25, leftHandleX: 1.50, leftHandleY: 2.72, rightHandleX: 1.81, rightHandleY: 1.5 },\n    { x: 2.39, y: 0.4, leftHandleX: 2.26, leftHandleY: 0.57, rightHandleX: 2.53, rightHandleY: 0.11 },\n    { x: 3.23, y: 0, leftHandleX: 3.12, leftHandleY: 0, rightHandleX: 3.56, rightHandleY: 0 },\n  ],\n  // Submental Cervical Angle curve (ideal: 94-106Â°)\n  submentalCervicalAngle: [\n    { x: 50.48, y: 0, leftHandleX: 44.48, leftHandleY: 0, rightHandleX: 56.48, rightHandleY: 0 },\n    { x: 68.31, y: 1.31, leftHandleX: 62.07, leftHandleY: 0.32, rightHandleX: 72.89, rightHandleY: 2.13 },\n    { x: 77.76, y: 3.71, leftHandleX: 76.00, leftHandleY: 2.89, rightHandleX: 80.39, rightHandleY: 4.59 },\n    { x: 83.99, y: 6.53, leftHandleX: 82.63, leftHandleY: 5.85, rightHandleX: 85.16, rightHandleY: 7.12 },\n    { x: 88.28, y: 8.86, leftHandleX: 86.43, leftHandleY: 7.85, rightHandleX: 89.95, rightHandleY: 9.71 },\n    { x: 94, y: 10, leftHandleX: 93.4, leftHandleY: 10, rightHandleX: 94.6, rightHandleY: 10, fixed: true },\n    { x: 106, y: 10, leftHandleX: 105.4, leftHandleY: 10, rightHandleX: 106.6, rightHandleY: 10, fixed: true },\n    { x: 111.72, y: 8.86, leftHandleX: 110.05, leftHandleY: 9.71, rightHandleX: 113.57, rightHandleY: 7.85 },\n    { x: 116.01, y: 6.53, leftHandleX: 114.84, leftHandleY: 7.12, rightHandleX: 117.37, rightHandleY: 5.85 },\n    { x: 122.24, y: 3.71, leftHandleX: 119.61, leftHandleY: 4.59, rightHandleX: 124.00, rightHandleY: 2.89 },\n    { x: 131.69, y: 1.31, leftHandleX: 127.11, leftHandleY: 2.13, rightHandleX: 137.93, rightHandleY: 0.32 },\n    { x: 149.52, y: 0, leftHandleX: 143.52, leftHandleY: 0, rightHandleX: 155.52, rightHandleY: 0 },\n  ],\n  // Facial Convexity (Glabella) curve (ideal: 169-174Â°)\n  facialConvexityGlabella: [\n    { x: 149.21, y: 0, leftHandleX: 146.21, leftHandleY: 0, rightHandleX: 152.21, rightHandleY: 0 },\n    { x: 158.07, y: 1.41, leftHandleX: 156.03, leftHandleY: 0.74, rightHandleX: 159.63, rightHandleY: 2 },\n    { x: 162.12, y: 4.09, leftHandleX: 161.34, leftHandleY: 3.31, rightHandleX: 163.09, rightHandleY: 5.03 },\n    { x: 165.14, y: 7.76, leftHandleX: 164.46, leftHandleY: 6.56, rightHandleX: 165.54, rightHandleY: 8.29 },\n    { x: 166.65, y: 9.14, leftHandleX: 165.92, leftHandleY: 8.72, rightHandleX: 167.43, rightHandleY: 9.67 },\n    { x: 169, y: 10, leftHandleX: 168.75, leftHandleY: 10, rightHandleX: 169.25, rightHandleY: 10, fixed: true },\n    { x: 174, y: 10, leftHandleX: 173.75, leftHandleY: 10, rightHandleX: 174.25, rightHandleY: 10, fixed: true },\n    { x: 176.35, y: 9.14, leftHandleX: 175.57, leftHandleY: 9.67, rightHandleX: 177.08, rightHandleY: 8.72 },\n    { x: 177.86, y: 7.76, leftHandleX: 177.46, leftHandleY: 8.29, rightHandleX: 178.54, rightHandleY: 6.56 },\n    { x: 180.88, y: 4.09, leftHandleX: 179.91, leftHandleY: 5.03, rightHandleX: 181.66, rightHandleY: 3.31 },\n    { x: 184.93, y: 1.41, leftHandleX: 183.37, leftHandleY: 2, rightHandleX: 186.97, rightHandleY: 0.74 },\n    { x: 193.79, y: 0, leftHandleX: 190.79, leftHandleY: 0, rightHandleX: 196.79, rightHandleY: 0 },\n  ],\n};\n\n// ============================================\n// CATEGORY DEFINITIONS\n// ============================================\n\nexport const MEASUREMENT_CATEGORIES = {\n  'Midface/Face Shape': { color: '#67e8f9', weight: 0.20 },\n  'Occlusion/Jaw Growth': { color: '#a78bfa', weight: 0.15 },\n  'Jaw Shape': { color: '#f97316', weight: 0.13 },\n  'Upper Third': { color: '#84cc16', weight: 0.08 },\n  'Eyes': { color: '#06b6d4', weight: 0.12 },\n  'Nose': { color: '#fbbf24', weight: 0.10 },\n  'Lips': { color: '#ec4899', weight: 0.10 },\n  'Chin': { color: '#ef4444', weight: 0.06 },\n  'Neck': { color: '#14b8a6', weight: 0.03 },\n  'Other': { color: '#6b7280', weight: 0.03 },\n};\n\n// ============================================\n// CORE SCORING FUNCTIONS\n// ============================================\n\n/**\n * FaceIQ Exponential Decay Scoring Algorithm with Directional/Dimorphic Support\n *\n * Standard: score = maxScore Ã— e^(-decayRate Ã— deviation)\n *\n * Directional scoring (polarity):\n * - 'higher_is_better': Values above safeFloor but below ideal get softZoneScore\n *   Example: Canthal Tilt of 3Â° is still positive/good, just not peak ideal (6-8Â°)\n * - 'lower_is_better': Values below safeCeiling but above ideal get softZoneScore\n *   Example: Short philtrum is still attractive even if shorter than \"ideal\"\n */\nexport function calculateFaceIQScore(\n  value: number,\n  config: MetricConfig\n): number {\n  const {\n    idealMin,\n    idealMax,\n    decayRate,\n    maxScore,\n    customCurve,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n    softZoneScore = 8.0, // Default \"Good\" score for acceptable-but-not-ideal values\n  } = config;\n\n  // Use custom curve if available\n  if (customCurve && customCurve.mode === 'custom') {\n    return interpolateCustomCurve(value, customCurve.points, maxScore);\n  }\n\n  // Perfect score within ideal range\n  if (value >= idealMin && value <= idealMax) {\n    return maxScore;\n  }\n\n  // Handle directional/dimorphic scoring\n  if (polarity === 'higher_is_better' && safeFloor !== undefined) {\n    // Higher values are good. Only values below safeFloor are true weaknesses.\n    if (value >= safeFloor && value < idealMin) {\n      // Value is in the \"acceptable but not ideal\" zone\n      // Give a passing score that decreases linearly as we approach the floor\n      const zoneRange = idealMin - safeFloor;\n      const distanceFromIdeal = idealMin - value;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMin â†’ maxScore, safeFloor â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value >= idealMax) {\n      // Values above ideal are still excellent for 'higher_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = value - idealMax;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Below safeFloor - apply normal (or harsher) exponential decay\n    if (value < safeFloor) {\n      const deviation = safeFloor - value;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  if (polarity === 'lower_is_better' && safeCeiling !== undefined) {\n    // Lower values are good. Only values above safeCeiling are true weaknesses.\n    if (value <= safeCeiling && value > idealMax) {\n      // Value is in the \"acceptable but not ideal\" zone\n      const zoneRange = safeCeiling - idealMax;\n      const distanceFromIdeal = value - idealMax;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMax â†’ maxScore, safeCeiling â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value <= idealMin) {\n      // Values below ideal are still excellent for 'lower_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = idealMin - value;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Above safeCeiling - apply normal exponential decay\n    if (value > safeCeiling) {\n      const deviation = value - safeCeiling;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  // Default balanced scoring: deviation in either direction is equally bad\n  const deviation = value < idealMin\n    ? idealMin - value\n    : value - idealMax;\n\n  // Exponential decay\n  const score = maxScore * Math.exp(-decayRate * deviation);\n\n  return Math.max(0, Math.min(maxScore, score));\n}\n\n/**\n * Check if a metric value is in an \"acceptable\" zone (not a true weakness).\n * Used by InsightsEngine to prevent false positives.\n */\nexport function isValueAcceptable(\n  value: number,\n  config: MetricConfig\n): { acceptable: boolean; reason: string } {\n  const {\n    idealMin,\n    idealMax,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n  } = config;\n\n  // Within ideal range is always acceptable\n  if (value >= idealMin && value <= idealMax) {\n    return { acceptable: true, reason: 'within_ideal' };\n  }\n\n  // Check directional acceptability\n  if (polarity === 'higher_is_better') {\n    if (value >= idealMax) {\n      return { acceptable: true, reason: 'above_ideal_higher_is_better' };\n    }\n    if (safeFloor !== undefined && value >= safeFloor) {\n      return { acceptable: true, reason: 'above_safe_floor' };\n    }\n    // Below safe floor - true weakness\n    return { acceptable: false, reason: 'below_safe_floor' };\n  }\n\n  if (polarity === 'lower_is_better') {\n    if (value <= idealMin) {\n      return { acceptable: true, reason: 'below_ideal_lower_is_better' };\n    }\n    if (safeCeiling !== undefined && value <= safeCeiling) {\n      return { acceptable: true, reason: 'below_safe_ceiling' };\n    }\n    // Above safe ceiling - true weakness\n    return { acceptable: false, reason: 'above_safe_ceiling' };\n  }\n\n  // Balanced polarity - outside ideal is not acceptable\n  return { acceptable: false, reason: 'outside_ideal_balanced' };\n}\n\n/**\n * Interpolate custom Bezier curve for scoring\n * Uses cubic Bezier interpolation with control handles for smooth curves\n */\nfunction interpolateCustomCurve(\n  value: number,\n  points: CurvePoint[],\n  maxScore: number\n): number {\n  void maxScore; // Reserved for future custom curve implementations\n  if (points.length === 0) return 0;\n\n  // Sort points by x value\n  const sortedPoints = [...points].sort((a, b) => a.x - b.x);\n\n  // Clamp to range\n  if (value <= sortedPoints[0].x) return sortedPoints[0].y;\n  if (value >= sortedPoints[sortedPoints.length - 1].x) {\n    return sortedPoints[sortedPoints.length - 1].y;\n  }\n\n  // Find bracketing points\n  let lowerIndex = 0;\n  for (let i = 0; i < sortedPoints.length - 1; i++) {\n    if (value >= sortedPoints[i].x && value <= sortedPoints[i + 1].x) {\n      lowerIndex = i;\n      break;\n    }\n  }\n\n  const p0 = sortedPoints[lowerIndex];\n  const p3 = sortedPoints[lowerIndex + 1];\n\n  // Check if we have Bezier control handles\n  const hasHandles = p0.rightHandleX !== undefined && p3.leftHandleX !== undefined;\n\n  if (hasHandles) {\n    // Cubic Bezier interpolation with control points\n    const p1x = p0.rightHandleX!;\n    const p1y = p0.rightHandleY ?? p0.y;\n    const p2x = p3.leftHandleX!;\n    const p2y = p3.leftHandleY ?? p3.y;\n\n    // Find t parameter for given x value using Newton-Raphson iteration\n    let t = (value - p0.x) / (p3.x - p0.x); // Initial guess\n\n    // Newton-Raphson iterations to find t where B_x(t) = value\n    for (let iter = 0; iter < 10; iter++) {\n      const bx = cubicBezier(p0.x, p1x, p2x, p3.x, t);\n      const bxDerivative = cubicBezierDerivative(p0.x, p1x, p2x, p3.x, t);\n\n      if (Math.abs(bxDerivative) < 1e-10) break;\n\n      const newT = t - (bx - value) / bxDerivative;\n      if (Math.abs(newT - t) < 1e-10) break;\n      t = Math.max(0, Math.min(1, newT));\n    }\n\n    // Calculate y using the found t parameter\n    return cubicBezier(p0.y, p1y, p2y, p3.y, t);\n  } else {\n    // Smooth interpolation using Catmull-Rom spline\n    // This provides smoother curves than linear interpolation\n    const t = (value - p0.x) / (p3.x - p0.x);\n\n    // Get neighboring points for spline calculation\n    const pMinus1 = lowerIndex > 0 ? sortedPoints[lowerIndex - 1] : p0;\n    const p4 = lowerIndex + 2 < sortedPoints.length ? sortedPoints[lowerIndex + 2] : p3;\n\n    // Catmull-Rom spline interpolation\n    return catmullRomSpline(pMinus1.y, p0.y, p3.y, p4.y, t);\n  }\n}\n\n/**\n * Cubic Bezier curve evaluation: B(t) = (1-t)Â³P0 + 3(1-t)Â²tP1 + 3(1-t)tÂ²P2 + tÂ³P3\n */\nfunction cubicBezier(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  const mt2 = mt * mt;\n  const mt3 = mt2 * mt;\n  const t2 = t * t;\n  const t3 = t2 * t;\n  return mt3 * p0 + 3 * mt2 * t * p1 + 3 * mt * t2 * p2 + t3 * p3;\n}\n\n/**\n * Cubic Bezier derivative: B'(t) = 3(1-t)Â²(P1-P0) + 6(1-t)t(P2-P1) + 3tÂ²(P3-P2)\n */\nfunction cubicBezierDerivative(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  return 3 * mt * mt * (p1 - p0) + 6 * mt * t * (p2 - p1) + 3 * t * t * (p3 - p2);\n}\n\n/**\n * Catmull-Rom spline interpolation for smooth curves without explicit handles\n */\nfunction catmullRomSpline(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const t2 = t * t;\n  const t3 = t2 * t;\n\n  // Catmull-Rom coefficients with tension = 0.5\n  const a = -0.5 * p0 + 1.5 * p1 - 1.5 * p2 + 0.5 * p3;\n  const b = p0 - 2.5 * p1 + 2 * p2 - 0.5 * p3;\n  const c = -0.5 * p0 + 0.5 * p2;\n  const d = p1;\n\n  return a * t3 + b * t2 + c * t + d;\n}\n\n/**\n * Calculate standardized score (0-10 normalized)\n */\nexport function standardizeScore(score: number, maxScore: number): number {\n  return (score / maxScore) * 10;\n}\n\n/**\n * Determine quality tier based on score\n */\nexport function getQualityTier(score: number, maxScore: number = 10): QualityTier {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 90) return 'ideal';\n  if (normalized >= 70) return 'excellent';\n  if (normalized >= 50) return 'good';\n  return 'below_average';\n}\n\n/**\n * Determine severity level based on score\n */\nexport function getSeverityLevel(score: number, maxScore: number = 10): SeverityLevel {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 85) return 'optimal';\n  if (normalized >= 70) return 'minor';\n  if (normalized >= 50) return 'moderate';\n  if (normalized >= 30) return 'major';\n  if (normalized >= 15) return 'severe';\n  return 'extremely_severe';\n}\n\n/**\n * Calculate deviation description\n */\nexport function getDeviationDescription(\n  value: number,\n  idealMin: number,\n  idealMax: number,\n  unit: MeasurementUnit\n): { deviation: number; direction: 'above' | 'below' | 'within'; description: string } {\n  if (value >= idealMin && value <= idealMax) {\n    return { deviation: 0, direction: 'within', description: 'within ideal range' };\n  }\n\n  const unitLabel = getUnitLabel(unit);\n\n  if (value < idealMin) {\n    const dev = idealMin - value;\n    return {\n      deviation: dev,\n      direction: 'below',\n      description: `${dev.toFixed(2)}${unitLabel} below ideal`,\n    };\n  }\n\n  const dev = value - idealMax;\n  return {\n    deviation: dev,\n    direction: 'above',\n    description: `${dev.toFixed(2)}${unitLabel} above ideal`,\n  };\n}\n\nfunction getUnitLabel(unit: MeasurementUnit): string {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return 'Â°';\n    case 'mm': return 'mm';\n    default: return '';\n  }\n}\n\n// ============================================\n// MEASUREMENT CALCULATION UTILITIES\n// ============================================\n\n/**\n * Calculate distance between two points\n */\nexport function distance(p1: Point, p2: Point): number {\n  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n}\n\n/**\n * Calculate angle at vertex point (in degrees)\n */\nexport function calculateAngle(p1: Point, vertex: Point, p2: Point): number {\n  const v1 = { x: p1.x - vertex.x, y: p1.y - vertex.y };\n  const v2 = { x: p2.x - vertex.x, y: p2.y - vertex.y };\n\n  const dot = v1.x * v2.x + v1.y * v2.y;\n  const cross = v1.x * v2.y - v1.y * v2.x;\n\n  const angle = Math.atan2(cross, dot) * (180 / Math.PI);\n  return Math.abs(angle);\n}\n\n/**\n * Calculate perpendicular distance from point to line (signed)\n */\nexport function perpendicularDistance(\n  point: Point,\n  lineStart: Point,\n  lineEnd: Point\n): number {\n  const A = point.x - lineStart.x;\n  const B = point.y - lineStart.y;\n  const C = lineEnd.x - lineStart.x;\n  const D = lineEnd.y - lineStart.y;\n\n  const dot = A * C + B * D;\n  const lenSq = C * C + D * D;\n  const param = lenSq !== 0 ? dot / lenSq : -1;\n\n  let xx: number, yy: number;\n\n  if (param < 0) {\n    xx = lineStart.x;\n    yy = lineStart.y;\n  } else if (param > 1) {\n    xx = lineEnd.x;\n    yy = lineEnd.y;\n  } else {\n    xx = lineStart.x + param * C;\n    yy = lineStart.y + param * D;\n  }\n\n  const dx = point.x - xx;\n  const dy = point.y - yy;\n\n  const sign =\n    (lineEnd.y - lineStart.y) * point.x -\n      (lineEnd.x - lineStart.x) * point.y +\n      lineEnd.x * lineStart.y -\n      lineEnd.y * lineStart.x >=\n    0\n      ? 1\n      : -1;\n\n  return sign * Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Helper to get landmark by ID\n */\nfunction getLandmark(landmarks: LandmarkPoint[], id: string): Point | null {\n  const lm = landmarks.find((l) => l.id === id);\n  return lm ? { x: lm.x, y: lm.y } : null;\n}\n\n// ============================================\n// SCORE A SINGLE MEASUREMENT\n// ============================================\n\nexport interface DemographicOptions {\n  gender?: Gender;\n  ethnicity?: Ethnicity;\n}\n\n/**\n * Calculate complete score result for a measurement.\n * If demographics provided, uses demographic-specific ideal ranges.\n */\nexport function scoreMeasurement(\n  metricId: string,\n  value: number,\n  demographics?: DemographicOptions\n): FaceIQScoreResult | null {\n  // Get config with demographic overrides if provided\n  const config = demographics?.gender\n    ? getMetricConfigForDemographics(metricId, demographics.gender, demographics.ethnicity || 'other')\n    : FACEIQ_METRICS[metricId];\n\n  if (!config) return null;\n\n  const score = calculateFaceIQScore(value, config);\n  const standardizedScore = standardizeScore(score, config.maxScore);\n  const qualityTier = getQualityTier(score, config.maxScore);\n  const severity = getSeverityLevel(score, config.maxScore);\n  const { deviation, direction } = getDeviationDescription(\n    value,\n    config.idealMin,\n    config.idealMax,\n    config.unit\n  );\n\n  return {\n    metricId,\n    name: config.name,\n    value,\n    score,\n    standardizedScore,\n    qualityTier,\n    severity,\n    idealMin: config.idealMin,\n    idealMax: config.idealMax,\n    deviation,\n    deviationDirection: direction,\n    unit: config.unit,\n    category: config.category,\n  };\n}\n\n// ============================================\n// FRONT PROFILE ANALYSIS\n// ============================================\n\nexport interface FrontProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all front profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeFrontProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): FrontProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  // Helper to add measurement if landmarks available\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const trichion = getLandmark(landmarks, 'trichion');\n  const nasalBase = getLandmark(landmarks, 'nasal_base');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const menton = getLandmark(landmarks, 'menton');\n  const leftZygion = getLandmark(landmarks, 'left_zygion');\n  const rightZygion = getLandmark(landmarks, 'right_zygion');\n  const leftGonion = getLandmark(landmarks, 'left_gonion_inferior');\n  const rightGonion = getLandmark(landmarks, 'right_gonion_inferior');\n  const leftPupil = getLandmark(landmarks, 'left_pupila');\n  const rightPupil = getLandmark(landmarks, 'right_pupila');\n  const leftCanthusM = getLandmark(landmarks, 'left_canthus_medialis');\n  const leftCanthusL = getLandmark(landmarks, 'left_canthus_lateralis');\n  const rightCanthusM = getLandmark(landmarks, 'right_canthus_medialis');\n  const rightCanthusL = getLandmark(landmarks, 'right_canthus_lateralis');\n  void rightCanthusL; // Will be used for asymmetry measurements\n  const leftAlaNasi = getLandmark(landmarks, 'left_ala_nasi');\n  const rightAlaNasi = getLandmark(landmarks, 'right_ala_nasi');\n  const leftCheilion = getLandmark(landmarks, 'left_cheilion');\n  const rightCheilion = getLandmark(landmarks, 'right_cheilion');\n  const labraleSuperius = getLandmark(landmarks, 'labrale_superius');\n  const labraleInferius = getLandmark(landmarks, 'labrale_inferius');\n\n  // FACIAL THIRDS\n  if (trichion && nasalBase && subnasale && menton) {\n    const totalHeight = distance(trichion, menton);\n    if (totalHeight > 0) {\n      const upperThird = (distance(trichion, nasalBase) / totalHeight) * 100;\n      const middleThird = (distance(nasalBase, subnasale) / totalHeight) * 100;\n      const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n\n      addMeasurement('upperThirdProportion', upperThird);\n      addMeasurement('middleThirdProportion', middleThird);\n      addMeasurement('lowerThirdProportion', lowerThird);\n    }\n  }\n\n  // FACE WIDTH TO HEIGHT RATIO (FWHR)\n  if (leftZygion && rightZygion && nasalBase && labraleSuperius) {\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    const upperFaceHeight = distance(nasalBase, labraleSuperius);\n    if (upperFaceHeight > 0) {\n      addMeasurement('faceWidthToHeight', bizygomaticWidth / upperFaceHeight);\n    }\n  }\n\n  // TOTAL FACIAL WIDTH TO HEIGHT\n  if (leftZygion && rightZygion && trichion && menton) {\n    const cheekWidth = distance(leftZygion, rightZygion);\n    const totalHeight = distance(trichion, menton);\n    if (cheekWidth > 0) {\n      addMeasurement('totalFacialWidthToHeight', totalHeight / cheekWidth);\n    }\n  }\n\n  // JAW WIDTH RATIO\n  if (leftGonion && rightGonion && leftZygion && rightZygion) {\n    const bigonialWidth = distance(leftGonion, rightGonion);\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    if (bizygomaticWidth > 0) {\n      const ratio = bigonialWidth / bizygomaticWidth;\n      addMeasurement('jawWidthRatio', ratio);\n      addMeasurement('bigonialWidth', ratio * 100);\n    }\n  }\n\n  // CANTHAL TILT\n  if (leftCanthusM && leftCanthusL) {\n    const deltaY = leftCanthusM.y - leftCanthusL.y;\n    const deltaX = leftCanthusL.x - leftCanthusM.x;\n    const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);\n    addMeasurement('lateralCanthalTilt', angle);\n  }\n\n  // EYE ASPECT RATIO\n  if (leftCanthusM && leftCanthusL) {\n    const leftPalpSup = getLandmark(landmarks, 'left_palpebra_superior');\n    const leftPalpInf = getLandmark(landmarks, 'left_palpebra_inferior');\n    if (leftPalpSup && leftPalpInf) {\n      const eyeWidth = distance(leftCanthusM, leftCanthusL);\n      const eyeHeight = distance(leftPalpSup, leftPalpInf);\n      if (eyeWidth > 0) {\n        addMeasurement('eyeAspectRatio', eyeHeight / eyeWidth);\n      }\n    }\n  }\n\n  // EYE SEPARATION RATIO\n  if (leftCanthusM && rightCanthusM && leftZygion && rightZygion) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('eyeSeparationRatio', intercanthal / bizygomatic);\n    }\n  }\n\n  // IPD RATIO\n  if (leftPupil && rightPupil && leftZygion && rightZygion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('interpupillaryRatio', (ipd / bizygomatic) * 100);\n    }\n  }\n\n  // ONE EYE APART TEST\n  if (leftCanthusM && rightCanthusM && leftCanthusL) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const eyeWidth = distance(leftCanthusM, leftCanthusL);\n    if (eyeWidth > 0) {\n      addMeasurement('oneEyeApartTest', intercanthal / eyeWidth);\n    }\n  }\n\n  // NASAL INDEX\n  if (leftAlaNasi && rightAlaNasi && nasalBase && subnasale) {\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    const nasalHeight = distance(nasalBase, subnasale);\n    if (nasalHeight > 0) {\n      addMeasurement('nasalIndex', (nasalWidth / nasalHeight) * 100);\n    }\n  }\n\n  // INTERCANTHAL-NASAL WIDTH RATIO\n  if (leftCanthusM && rightCanthusM && leftAlaNasi && rightAlaNasi) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('intercanthalNasalRatio', intercanthal / nasalWidth);\n    }\n  }\n\n  // MOUTH TO NOSE RATIO\n  if (leftCheilion && rightCheilion && leftAlaNasi && rightAlaNasi) {\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('mouthWidthToNoseRatio', mouthWidth / nasalWidth);\n    }\n  }\n\n  // IPD TO MOUTH WIDTH RATIO\n  if (leftPupil && rightPupil && leftCheilion && rightCheilion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    if (ipd > 0) {\n      addMeasurement('interpupillaryMouthWidthRatio', mouthWidth / ipd);\n    }\n  }\n\n  // LIP RATIO\n  if (labraleSuperius && labraleInferius && subnasale) {\n    const mouthMiddle = getLandmark(landmarks, 'mouth_middle');\n    if (mouthMiddle) {\n      const upperLipHeight = distance(subnasale, labraleSuperius);\n      const lowerLipHeight = distance(mouthMiddle, labraleInferius);\n      if (upperLipHeight > 0) {\n        addMeasurement('lowerToUpperLipRatio', lowerLipHeight / upperLipHeight);\n      }\n    }\n  }\n\n  // MIDFACE RATIO\n  if (leftZygion && rightZygion && nasalBase && subnasale) {\n    const midfaceWidth = distance(leftZygion, rightZygion);\n    const midfaceHeight = distance(nasalBase, subnasale);\n    if (midfaceHeight > 0) {\n      addMeasurement('midfaceRatio', midfaceWidth / midfaceHeight / 10); // Normalized\n    }\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score (weighted average)\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n  const standardizedScore = overallScore;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// SIDE PROFILE ANALYSIS\n// ============================================\n\nexport interface SideProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all side profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeSideProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): SideProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const glabella = getLandmark(landmarks, 'glabella');\n  const nasion = getLandmark(landmarks, 'nasion');\n  const rhinion = getLandmark(landmarks, 'rhinion');\n  const pronasale = getLandmark(landmarks, 'pronasale');\n  const columella = getLandmark(landmarks, 'columella');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const labraleSuperius = getLandmark(landmarks, 'labraleSuperius');\n  const labraleInferius = getLandmark(landmarks, 'labraleInferius');\n  const sublabiale = getLandmark(landmarks, 'sublabiale');\n  const pogonion = getLandmark(landmarks, 'pogonion');\n  const menton = getLandmark(landmarks, 'menton');\n  const tragus = getLandmark(landmarks, 'tragus');\n  const gonionBottom = getLandmark(landmarks, 'gonionBottom');\n  const cervicalPoint = getLandmark(landmarks, 'cervicalPoint');\n  const orbitale = getLandmark(landmarks, 'orbitale');\n  const porion = getLandmark(landmarks, 'porion');\n\n  // GONIAL ANGLE\n  if (tragus && gonionBottom && menton) {\n    const angle = calculateAngle(tragus, gonionBottom, menton);\n    addMeasurement('gonialAngle', angle);\n  }\n\n  // NASOLABIAL ANGLE\n  if (columella && subnasale && labraleSuperius) {\n    const angle = calculateAngle(columella, subnasale, labraleSuperius);\n    addMeasurement('nasolabialAngle', angle);\n  }\n\n  // NASOFRONTAL ANGLE\n  if (glabella && nasion && rhinion) {\n    const angle = calculateAngle(glabella, nasion, rhinion);\n    addMeasurement('nasofrontalAngle', angle);\n  }\n\n  // MENTOLABIAL ANGLE\n  if (labraleInferius && sublabiale && pogonion) {\n    const angle = calculateAngle(labraleInferius, sublabiale, pogonion);\n    addMeasurement('mentolabialAngle', angle);\n  }\n\n  // E-LINE MEASUREMENTS\n  if (pronasale && pogonion && labraleSuperius && labraleInferius) {\n    const upperLipDist = perpendicularDistance(labraleSuperius, pronasale, pogonion);\n    const lowerLipDist = perpendicularDistance(labraleInferius, pronasale, pogonion);\n    addMeasurement('eLineUpperLip', upperLipDist);\n    addMeasurement('eLineLowerLip', lowerLipDist);\n  }\n\n  // NASOMENTAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    const angle = calculateAngle(nasion, pronasale, pogonion);\n    addMeasurement('nasomentaAngle', angle);\n  }\n\n  // FACIAL CONVEXITY (GLABELLA)\n  if (glabella && subnasale && pogonion) {\n    const angle = calculateAngle(glabella, subnasale, pogonion);\n    addMeasurement('facialConvexityGlabella', angle);\n  }\n\n  // FACIAL CONVEXITY (NASION)\n  if (nasion && subnasale && pogonion) {\n    const angle = calculateAngle(nasion, subnasale, pogonion);\n    addMeasurement('facialConvexityNasion', angle);\n  }\n\n  // TOTAL FACIAL CONVEXITY\n  if (glabella && pronasale && pogonion) {\n    const angle = calculateAngle(glabella, pronasale, pogonion);\n    addMeasurement('totalFacialConvexity', angle);\n  }\n\n  // SUBMENTAL CERVICAL ANGLE\n  if (menton && cervicalPoint && pogonion) {\n    const neckPoint = getLandmark(landmarks, 'neckPoint');\n    if (neckPoint) {\n      const angle = calculateAngle(pogonion, menton, neckPoint);\n      addMeasurement('submentalCervicalAngle', angle);\n    }\n  }\n\n  // NASAL PROJECTION (Goode ratio)\n  if (pronasale && subnasale && nasion) {\n    const projection = distance(pronasale, subnasale);\n    const nasalLength = distance(nasion, pronasale);\n    if (nasalLength > 0) {\n      addMeasurement('nasalProjection', projection / nasalLength);\n    }\n  }\n\n  // NASOFACIAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    // Angle between nose dorsum and facial plane\n    const nasalDorsum = { x: pronasale.x - nasion.x, y: pronasale.y - nasion.y };\n    const facialPlane = { x: pogonion.x - nasion.x, y: pogonion.y - nasion.y };\n\n    const dot = nasalDorsum.x * facialPlane.x + nasalDorsum.y * facialPlane.y;\n    const mag1 = Math.sqrt(nasalDorsum.x ** 2 + nasalDorsum.y ** 2);\n    const mag2 = Math.sqrt(facialPlane.x ** 2 + facialPlane.y ** 2);\n\n    if (mag1 > 0 && mag2 > 0) {\n      const angle = Math.acos(dot / (mag1 * mag2)) * (180 / Math.PI);\n      addMeasurement('nasofacialAngle', angle);\n    }\n  }\n\n  // MANDIBULAR PLANE ANGLE (using Frankfort horizontal)\n  if (porion && orbitale && gonionBottom && menton) {\n    // Frankfort horizontal is porion to orbitale\n    // Mandibular plane is gonion to menton\n    const fhAngle = Math.atan2(orbitale.y - porion.y, orbitale.x - porion.x);\n    const mpAngle = Math.atan2(menton.y - gonionBottom.y, menton.x - gonionBottom.x);\n    const angle = Math.abs(fhAngle - mpAngle) * (180 / Math.PI);\n    addMeasurement('mandibularPlaneAngle', angle);\n  }\n\n  // CHIN PROJECTION\n  if (pogonion && subnasale) {\n    // Distance from pogonion to vertical line through subnasale\n    const projection = pogonion.x - subnasale.x;\n    addMeasurement('chinProjection', projection);\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// COMPLETE HARMONY ANALYSIS\n// ============================================\n\n/**\n * Run complete facial harmony analysis.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeHarmony(\n  frontLandmarks: LandmarkPoint[],\n  sideLandmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): HarmonyAnalysis {\n  const frontResults = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n  const sideResults = analyzeSideProfile(sideLandmarks, gender, ethnicity);\n\n  const allMeasurements = [...frontResults.measurements, ...sideResults.measurements];\n\n  // Combined category scores\n  const allCategories: Record<string, { total: number; count: number }> = {};\n  for (const m of allMeasurements) {\n    if (!allCategories[m.category]) {\n      allCategories[m.category] = { total: 0, count: 0 };\n    }\n    allCategories[m.category].total += m.standardizedScore;\n    allCategories[m.category].count++;\n  }\n\n  const categoryScores: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(allCategories)) {\n    categoryScores[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Overall weighted score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of allMeasurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  // Identify flaws (below average measurements)\n  const flaws: FlawAssessment[] = allMeasurements\n    .filter((m) => m.severity !== 'optimal' && m.severity !== 'minor')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      severity: m.severity,\n      deviation: `${m.deviation.toFixed(2)} ${m.deviationDirection} ideal`,\n      reasoning: `${m.name} is outside the ideal range`,\n      confidence: m.severity === 'extremely_severe' || m.severity === 'severe'\n        ? 'confirmed' as const\n        : 'likely' as const,\n    }))\n    .sort((a, b) => {\n      const severityOrder = { extremely_severe: 0, severe: 1, major: 2, moderate: 3 };\n      return (severityOrder[a.severity as keyof typeof severityOrder] ?? 4) -\n             (severityOrder[b.severity as keyof typeof severityOrder] ?? 4);\n    });\n\n  // Identify strengths (ideal measurements)\n  const strengths: StrengthAssessment[] = allMeasurements\n    .filter((m) => m.qualityTier === 'ideal' || m.qualityTier === 'excellent')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      qualityTier: m.qualityTier,\n      value: m.value,\n      reasoning: `${m.name} is within the ${m.qualityTier} range`,\n    }));\n\n  // Calculate percentile (based on population stats)\n  const percentile = calculateHarmonyPercentile(overallScore);\n\n  return {\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    percentile,\n    frontScore: frontResults.overallScore,\n    sideScore: sideResults.overallScore,\n    categoryScores,\n    measurements: allMeasurements,\n    flaws,\n    strengths,\n  };\n}\n\n/**\n * Calculate percentile from harmony score\n */\nfunction calculateHarmonyPercentile(score: number): number {\n  // Based on normal distribution with mean=5, stdDev=1.5\n  const mean = 5;\n  const stdDev = 1.5;\n  const z = (score - mean) / stdDev;\n  return normalCDF(z) * 100;\n}\n\n/**\n * Standard normal CDF approximation\n */\nfunction normalCDF(z: number): number {\n  const a1 = 0.254829592;\n  const a2 = -0.284496736;\n  const a3 = 1.421413741;\n  const a4 = -1.453152027;\n  const a5 = 1.061405429;\n  const p = 0.3275911;\n\n  const sign = z < 0 ? -1 : 1;\n  const absZ = Math.abs(z) / Math.sqrt(2);\n\n  const t = 1.0 / (1.0 + p * absZ);\n  const y = 1.0 - ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-absZ * absZ);\n\n  return 0.5 * (1.0 + sign * y);\n}\n\n// ============================================\n// PSL RATING CONVERSION\n// ============================================\n\nexport interface PSLRating {\n  score: number;\n  tier: string;\n  percentile: number;\n  description: string;\n}\n\n/**\n * Convert harmony score to PSL rating\n */\nexport function convertToPSL(harmonyScore: number): PSLRating {\n  // Convert 0-10 harmony to 3.0-7.5 PSL range\n  const psl = 3.0 + (harmonyScore / 10) * 4.5;\n  const clampedPSL = Math.max(3.0, Math.min(7.5, psl));\n\n  let tier: string;\n  let percentile: number;\n\n  if (clampedPSL >= 7.5) {\n    tier = 'Top Model';\n    percentile = 99.99;\n  } else if (clampedPSL >= 7.0) {\n    tier = 'Chad';\n    percentile = 99.87;\n  } else if (clampedPSL >= 6.5) {\n    tier = 'Chadlite';\n    percentile = 99.0;\n  } else if (clampedPSL >= 6.0) {\n    tier = 'High Tier Normie+';\n    percentile = 97.25;\n  } else if (clampedPSL >= 5.5) {\n    tier = 'High Tier Normie';\n    percentile = 90.0;\n  } else if (clampedPSL >= 5.0) {\n    tier = 'Mid Tier Normie+';\n    percentile = 84.15;\n  } else if (clampedPSL >= 4.5) {\n    tier = 'Mid Tier Normie';\n    percentile = 65.0;\n  } else if (clampedPSL >= 4.0) {\n    tier = 'Low Tier Normie';\n    percentile = 50.0;\n  } else if (clampedPSL >= 3.5) {\n    tier = 'Below Average';\n    percentile = 30.0;\n  } else {\n    tier = 'Subpar';\n    percentile = 15.0;\n  }\n\n  return {\n    score: clampedPSL,\n    tier,\n    percentile,\n    description: `${tier} (top ${(100 - percentile).toFixed(1)}%)`,\n  };\n}\n\n// ============================================\n// EXPORTS FOR BACKWARD COMPATIBILITY\n// ============================================\n\nexport type { LandmarkPoint } from './landmarks';\n","structuredPatch":[{"oldStart":246,"oldLines":8,"newStart":246,"newLines":12,"lines":["   bigonialWidth: {","     // Jaw width as % of bizygomatic width","     // Males: wider, more angular; Females: narrower, softer","+    // Pacific Islander: Extremely wide jaw preferred - \"Warrior Skull\" robustness","+    // Extracted from FaceIQ Male:Pacific Islander.htc","     male: { idealMin: 90, idealMax: 95 },","     female: { idealMin: 85, idealMax: 90 },","+    pacific_islander_male: { idealMin: 92, idealMax: 98 },  // Jaw width rivals cheekbone width - extreme robustness","+    pacific_islander_female: { idealMin: 88, idealMax: 94 },","   },"," ","   jawFrontalAngle: {"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"403ef311-e018-4278-8639-4d55c4336912","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01JgttN6qLgGP2LGAaVEv6qu","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Excellent! Now I should also check if there are any soft tissue or facial mass tolerance metrics that I should adjust for Pacific Islander, as the user mentioned that the model is more lenient on soft tissue and interprets mass as strength rather than fat. Let me search for cheek fullness or lower face volume metrics.","signature":"EugDCkYIChgCKkDxVvBRbKqAUS6WMzrxA8UhajFAzkzVYpRYSleJBvQ0TdH9h+I26NxQLJAfhFKeh3t1zwSvStMsxyAaC1hk7CPQEgz4kT4OB3fpDHP+yMMaDMO3QpusdyqVumzZGyIwavEzMVdBacpzaM2n+TxkDj3mTWkm3q0Aso7GTVlYRAJMDOHizcFMVrrg/cqFwfJ7Ks8CCL3YsFrMEe8ob5BdJopkYI75NgXKa22Mhm9H5XfxN+6xFnsgYaNL8g8hIlcRVFeK9Cj1vjnkpKYJQ8EyZqbnUG2z7DYe8mad8unquyoyWLUsGnWrkKFg4bkyk1JmU5O+g552v6J5EizY2OVnptBnKZsU1eb7FOvwdx/fNSx01ijiJo9x9qLR4UpIUAViMzQfvnMwu2KxEecwaGTVA4fHFgbfKlCYGfAnjPQX9fiv8opbMzo7sfTADMVcXbFXFrNX1kUwupEmQfv2sasfL+pHKswO413gFsMKPuDntWLxaDDKR5GINCrAFIOWWXS4BpD5qNE5/PC1Z8z1688MMIiV0wYk8E1LzVBNEwFK97WMyAcgxa+Yv5w5u59M1Fx/DQp9GJn82cfUUejuybztbpt/shclyhS6bk2sXW/EIRUzQdI2SHfyg7gDSyYOLqpqtYMYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":958,"cache_read_input_tokens":36277,"cache_creation":{"ephemeral_5m_input_tokens":958,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWLD8JVmeN4jAK6D2Dxbr","type":"assistant","uuid":"807b2ffd-6587-4565-8664-b37de4b88bd6","timestamp":"2025-12-21T17:15:39.407Z"}
{"parentUuid":"807b2ffd-6587-4565-8664-b37de4b88bd6","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01JgttN6qLgGP2LGAaVEv6qu","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GFocUHi1jXh8HL1YuEgUUq","name":"Bash","input":{"command":"grep -n \"cheekFullness\\|lowerFaceVolume\\|facialMass\" src/lib/faceiq-scoring.ts | head -10","description":"Search for facial mass metrics"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":958,"cache_read_input_tokens":36277,"cache_creation":{"ephemeral_5m_input_tokens":958,"ephemeral_1h_input_tokens":0},"output_tokens":183,"service_tier":"standard"}},"requestId":"req_011CWLD8JVmeN4jAK6D2Dxbr","type":"assistant","uuid":"e27e4e52-1313-406f-a784-1c3382ba002f","timestamp":"2025-12-21T17:15:40.576Z"}
{"parentUuid":"e27e4e52-1313-406f-a784-1c3382ba002f","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GFocUHi1jXh8HL1YuEgUUq","type":"tool_result","content":"","is_error":false}]},"uuid":"e074ffa0-e0ee-4ac2-9b23-1764f7ac02a4","timestamp":"2025-12-21T17:15:40.692Z","toolUseResult":{"stdout":"","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"e074ffa0-e0ee-4ac2-9b23-1764f7ac02a4","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01BWG9T6QPmizQxxuBGu3fEZ","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"No results for those specific metrics. Let me now verify that the changes compile correctly by running a type check.","signature":"Ep0CCkYIChgCKkDc/ruhKsoBGfOruH6NW8t1n+RtMhKE16BQ9VVNSMpX58TULltDXpADrkvsCJuxr1I4bJ1IgroDVZxuzBUXXFfFEgyXQxlExbIFIdWSBAIaDAsqcC/57pkVuqZdCiIwlaJEJQQe7gNX8ZVYnu8mGdAus2nMMZ4cReaVZjeUbVx+FPeG9u7NsA1vGMsA9SZ0KoQBZOIOZgqVZkEwxJVtl4uOwi5m5O6wJCkKh1VIwlwmbiWnzmthhpncSWcOnmE5z1bGFbY0YfimWyEISxgAcqUiWZa3VPGq3rDMFE9XRwoTB5UEaEZdLZmuJaVqmYWe2UMMyyakFqD1Xooncptt9ygtH50PrcYnUCuSq449po/ekPXyPOxHGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":355,"cache_read_input_tokens":37235,"cache_creation":{"ephemeral_5m_input_tokens":355,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD8jvDwjAKWW6PKMbHS","type":"assistant","uuid":"1bf2546e-6b8c-4cca-b44c-46651aaa8643","timestamp":"2025-12-21T17:15:43.650Z"}
{"parentUuid":"1bf2546e-6b8c-4cca-b44c-46651aaa8643","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01BWG9T6QPmizQxxuBGu3fEZ","type":"message","role":"assistant","content":[{"type":"text","text":"Let me verify the changes compile correctly."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":355,"cache_read_input_tokens":37235,"cache_creation":{"ephemeral_5m_input_tokens":355,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD8jvDwjAKWW6PKMbHS","type":"assistant","uuid":"61d7e495-2e02-4430-a3b7-ba10a223f431","timestamp":"2025-12-21T17:15:43.997Z"}
{"parentUuid":"61d7e495-2e02-4430-a3b7-ba10a223f431","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01BWG9T6QPmizQxxuBGu3fEZ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UikzLEZQk4HSHVz2GLCGWd","name":"Bash","input":{"command":"npx tsc --noEmit --pretty 2>&1 | head -30","description":"Type check the changes"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":355,"cache_read_input_tokens":37235,"cache_creation":{"ephemeral_5m_input_tokens":355,"ephemeral_1h_input_tokens":0},"output_tokens":150,"service_tier":"standard"}},"requestId":"req_011CWLD8jvDwjAKWW6PKMbHS","type":"assistant","uuid":"ed8dd741-8fb4-4523-9302-5ab815329fd3","timestamp":"2025-12-21T17:15:44.869Z"}
{"parentUuid":"ed8dd741-8fb4-4523-9302-5ab815329fd3","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UikzLEZQk4HSHVz2GLCGWd","type":"tool_result","content":"","is_error":false}]},"uuid":"8a1ed4cb-3ffe-4e09-ade6-88a1ea37ff3d","timestamp":"2025-12-21T17:15:46.954Z","toolUseResult":{"stdout":"","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"8a1ed4cb-3ffe-4e09-ade6-88a1ea37ff3d","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01WHPsdVwPeoo5KBqVL6Vv1c","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Great! The type check passed. Now let me create a summary of what I added and also check if there are any other metrics that might be relevant for Pacific Islander that I should consider adding. Let me search for nose bridge/projection metrics since the user mentioned that the Pacific Islander model prefers a high/strong bridge.","signature":"EvMDCkYIChgCKkBJNRvMCvfvRbnqY7teCKL96PIDO0oLI2ftMaMnjGRmQm3YYolC4XqCnQEggYb9aMse/RxCbqbK1hLuhtBHvtEIEgxHdOz+q717pa1YSmIaDEohQ9dN7pljCdoF/yIwem1DyH6LHe03GwIAWRp15mX+Pxx5Fhvf5zmwiUwhqN3ALNAQiSVk6WFqWlVD8FdLKtoCDfBoDgcqGu22SFwGbZDdsSNOAnl/eXSXac5JdgB3v4bK9v9KWTATMPcp6SitjWasV1trAZ7HNvh5QpWmWXkvzOK4TqAs5d2e4clZ/hmcSVbE390WAfRpTgIH0zzGT9zvc4RPIwihKnqKXA/6Qg8/k4AZV5AE8sJOC7JwBSlMegNJK0xtwkxFzJ6fDGxhvRuwDjx2eSALz1xtuChRe/ZGZaJMtpt4Oc/ZkeOoIAY+Ton4SP5GOmQJURiLYxaSHc/UpkTMWIMoXf8ea22Y9RfrGyC4dhalcEqK+LzFM4znFNOsUv9873YjqwFj+EV/l4DjEsNiyhMBkB9q/YCBWJoyx4rQOjO+aLCqVZZpjnpuiP7HOh/tn/r2Ee55cqu+WQ56miewWRAXOzkVNBUB4TZqZdtTsFrKc6YagSqMG7WEZMesZBeNQ+dqLKUDsKFtFsodZSUq16T1UyWItxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":161,"cache_read_input_tokens":37590,"cache_creation":{"ephemeral_5m_input_tokens":161,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD9CfK5zpfwQC6mZ8Ju","type":"assistant","uuid":"0107373e-265e-4fb0-a781-1444bd012482","timestamp":"2025-12-21T17:15:50.712Z"}
{"parentUuid":"0107373e-265e-4fb0-a781-1444bd012482","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01WHPsdVwPeoo5KBqVL6Vv1c","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect! The type check passed. Let me also add documentation about the unique Pacific Islander facial characteristics to help explain the logic. Let me search for where chin width might be defined."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":161,"cache_read_input_tokens":37590,"cache_creation":{"ephemeral_5m_input_tokens":161,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD9CfK5zpfwQC6mZ8Ju","type":"assistant","uuid":"57514764-a515-40d4-b950-1f543acf2ed5","timestamp":"2025-12-21T17:15:51.941Z"}
{"parentUuid":"57514764-a515-40d4-b950-1f543acf2ed5","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01WHPsdVwPeoo5KBqVL6Vv1c","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01S1SjBsbZXXzWATaiRnsyhM","name":"Bash","input":{"command":"grep -n \"chinWidth\\|chin_projection\" src/lib/faceiq-scoring.ts | head -10","description":"Search for chin metrics"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":161,"cache_read_input_tokens":37590,"cache_creation":{"ephemeral_5m_input_tokens":161,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD9CfK5zpfwQC6mZ8Ju","type":"assistant","uuid":"6524e255-2fff-4a86-a308-c18cd33761c4","timestamp":"2025-12-21T17:15:52.585Z"}
{"parentUuid":"6524e255-2fff-4a86-a308-c18cd33761c4","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01S1SjBsbZXXzWATaiRnsyhM","type":"tool_result","content":"","is_error":false}]},"uuid":"2a75ebb9-e773-446c-8427-4ac0ce778fb8","timestamp":"2025-12-21T17:15:52.723Z","toolUseResult":{"stdout":"","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"2a75ebb9-e773-446c-8427-4ac0ce778fb8","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01SaNxNHtFDdnjDycdE8af1o","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"No specific chin width metric found. The system likely doesn't track raw chin width measurements but rather uses ratios. That's fine - the key metrics I've added are:\n\n1. faceWidthToHeight (FWHR) - 2.10-2.30 for Pacific Islander males\n2. intercanthalNasalRatio (alar base ratio) - 1.10-1.20 for Pacific Islander males  \n3. bigonialWidth (jaw width %) - 92-98% for Pacific Islander males\n\nThese capture the \"Warrior Skull\" phenotype characteristics the user described. Let me now create a summary for the user.","signature":"EqMFCkYIChgCKkAhdgB4+4UH/iDauCEpk9qU5Y7GC2dLmPNNPzSmTvzz0QMYPj3rUMyGkGP6FdsnKcvcrSFzawEI/QLC8UqWb3T6EgxkxctaaVM0M0Nz0WYaDPmvzKGvxiVvA/eh5CIw0DyNmzy9tSh65ia1IfHrQL0O2mxzEXgr2jVEYm5yncSzEBydALinECotVmUMo5ITKooETvb8Nca1f9QdSBtg9Bp6ZGRhtpml7H+TkDUPoua0k74rF1Fyzwg+7B0TnkA5ZIqywx1IkJZDusHxx5lfpmR28GDxTgaG+N/vz3pn3ilVmmEY1v+Fwvv41oOcauGDjP+9/Usj1vzYC0r8Yr0wwvpCrxXyPSPQHHovMcZhvldOV9Gb3JoEyHTMFSPfIyR2NqDZw3wlbdQAGI+kh5RKRHfj5X8qgBw0gg2W6tkCTV8ZvGsaLMCT3z/FDBb43GjiWHCFh6s4qoonSRlHVRynylUAc7U/FKK1NO5Oq6BwnRwIjQvRuxL0rvAGUulbesy6ij9CY2KuO7HkxNlYE2HXuMeNwMoIOuECU2q2OomVkw5ylYrakY4mOQUlAl73cLs5BmHqJJtNL7RrM31xTAjq9SqcEXbKtis8ZL+t8fXRfoShT0OBxQ0AccPaybEuTe77NPjLgi6akrlOF/DguFszdqGRyfXBYWPjyPyfZ4MoieXZy8zOLNjwycWVxPcftW1/FYQuTChxa47X/4ww1B5NppAQZXqysWsQTLyzkg73h1zVQ6MiNxV2XgrxzvWK8+HbDIegmu4xri1ZxbpVoELdkXXllM8CiATEbVOIo/Eiwv4cUTL4xwnhLmhGOyJDHtfIktbXpGlLISP6vLurKe8csKSAGMGiwGIvKUR3lyC7pKd5LQeNgqXRjpSQkWW8GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":6,"cache_creation_input_tokens":330,"cache_read_input_tokens":37751,"cache_creation":{"ephemeral_5m_input_tokens":330,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD9dKdEVV1hvC6Z5HQU","type":"assistant","uuid":"42dbe0c4-553a-4fa9-9674-bbc9117f618c","timestamp":"2025-12-21T17:15:59.369Z"}
{"parentUuid":"42dbe0c4-553a-4fa9-9674-bbc9117f618c","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01SaNxNHtFDdnjDycdE8af1o","type":"message","role":"assistant","content":[{"type":"text","text":"Excellent! I've successfully added the Pacific Islander Male demographic logic to your facial metrics database. Here's what I implemented:\n\n## Added Pacific Islander Demographic Overrides\n\n### 1. **Face Width to Height Ratio (FWHR)** - Line 332-333\n- **Pacific Islander Male**: 2.10 - 2.30 (highest of any demographic)\n- **Pacific Islander Female**: 2.05 - 2.25\n- **Logic**: The \"Warrior Skull\" standard - extremely broad, square face preferred\n- **Comparison**: Much broader than Hispanic male (1.95-2.10) and default male (1.98-2.02)\n\n### 2. **Intercanthal Nasal Ratio** (Alar Base Width) - Line 239-240\n- **Pacific Islander Male**: 1.10 - 1.20\n- **Pacific Islander Female**: 1.08 - 1.18\n- **Logic**: Wide nasal base tolerance, similar to Black model\n- **Comparison**: Between East Asian (1.10-1.15) and Black (1.15-1.25)\n\n### 3. **Bigonial Width** (Jaw Width as % of Cheekbone Width) - Line 253-254\n- **Pacific Islander Male**: 92 - 98%\n- **Pacific Islander Female**: 88 - 94%\n- **Logic**: Jaw width rivals cheekbone width - extreme robustness and mass\n- **Comparison**: Higher than default male (90-95%)\n\n### 4. **Already Existing Metrics** (from previous sessions)\n- **Nasal Index**: 82-95 for males (already at line 191)\n- **Nasal Projection**: 0.52-0.58 (already at line 221)\n\n## Key Phenotype Characteristics Captured\n\nâœ… **\"Warrior Skull\"** - Extremely broad facial structure (highest FWHR)  \nâœ… **Wide Nasal Base** - Platyrrhine nose characteristics  \nâœ… **Robust Jaw** - Jaw width approaches cheekbone width  \nâœ… **Mass as Strength** - Higher tolerance for facial robustness\n\nThe implementation follows your existing pattern and integrates seamlessly with the FaceIQ scoring system. All types checked successfully!"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":6,"cache_creation_input_tokens":330,"cache_read_input_tokens":37751,"cache_creation":{"ephemeral_5m_input_tokens":330,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLD9dKdEVV1hvC6Z5HQU","type":"assistant","uuid":"36c5f8e2-bd67-4397-a500-f8c08e2fe945","timestamp":"2025-12-21T17:16:09.727Z"}
{"type":"file-history-snapshot","messageId":"cee5f4c4-0859-44fa-be2f-824d2e26a2de","snapshot":{"messageId":"cee5f4c4-0859-44fa-be2f-824d2e26a2de","trackedFileBackups":{"src/lib/faceiq-scoring.ts":{"backupFileName":"0db8b87525354b47@v2","version":2,"backupTime":"2025-12-21T17:18:26.121Z"}},"timestamp":"2025-12-21T17:18:26.120Z"},"isSnapshotUpdate":false}
{"parentUuid":"36c5f8e2-bd67-4397-a500-f8c08e2fe945","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":"You have successfully captured the White Male logic file (Male:White.htc).\n\nThis is the \"Control Group\" for the entire application. The logic here corresponds to the Neoclassical Golden Ratio (Da Vinci/Marquardt Mask) standards. It favors high compactness, sharp definition, and strict vertical balance.\n\nHere is the extracted logic map for your male_white database.\n\n1. The \"Neoclassical\" Nose Rule\nThis model has the strictest requirement for nasal width.\n\nMetric: alar_base_ratio (Nose Width vs. Eye Width).\n\nIdeal: 0.98 â€“ 1.05.\n\nLogic: It demands that the nose width be almost exactly equal to the inner corner distance of the eyes. Anything wider (> 1.05) is immediately flagged as a flaw.\n\n2. The \"Compact Midface\" Standard\nMetric: midface_ratio.\n\nIdeal: 0.95 â€“ 1.02.\n\nLogic: This model heavily penalizes a \"Long Midface.\" It rewards a compact, compressed midface which creates the \"Hunter\" look often cited in Western aesthetics.\n\n3. The Jaw Definition\nMetric: gonial_angle and jaw_frontal_angle.\n\nIdeal: 115Â° â€“ 125Â°.\n\nLogic: It looks for a square, vertically robust jaw. It is less tolerant of \"Soft\" or \"V-shaped\" jaws compared to the Asian or Hispanic models.\n\nðŸš€ Action: The Final Base Block\nSince this is often the \"Default,\" you can use this as the fallback in your code. Add this male_white block to your metrics_db.py.\n\nPython\n\n# metrics_db.py\n\nMETRIC_STANDARDS = {\n    # ... all other demographics ...\n\n    \"male_white\": {\n        # This is the \"Baseline\" Neoclassical Standard\n        \n        \"alar_base_ratio\": {\n            \"name\": \"Nose Width Ratio\",\n            \"ideal\": [0.98, 1.05],  # Strict 1:1 ratio\n            \"mean\": 1.02,\n            \"flaws\": { \"high\": \"Wide nasal base\" }\n        },\n        \"midface_ratio\": {\n            \"name\": \"Midface Compactness\",\n            \"ideal\": [0.95, 1.02],\n            \"mean\": 1.0,\n            \"flaws\": { \"low\": \"Long midface\" } # Penalized heavily\n        },\n        \"gonial_angle\": {\n            \"name\": \"Jaw Angle\",\n            \"ideal\": [115.0, 125.0], # Square jaw preference\n            \"flaws\": { \"high\": \"Weak/Soft jaw structure\" }\n        },\n        \"canthal_tilt\": {\n            \"name\": \"Eye Tilt\",\n            \"ideal\": [4.0, 8.0],    # Neutral to slightly positive\n            \"flaws\": { \"low\": \"Negative canthal tilt\" }\n        },\n        \"chin_philtrum_ratio\": {\n            \"name\": \"Lower Face Balance\",\n            \"ideal\": [2.10, 2.30],\n            \"flaws\": { \"low\": \"Long philtrum / Short chin\" }\n        }\n    }\n}"},"uuid":"cee5f4c4-0859-44fa-be2f-824d2e26a2de","timestamp":"2025-12-21T17:18:25.924Z","thinkingMetadata":{"level":"high","disabled":false,"triggers":[]}}
{"parentUuid":"cee5f4c4-0859-44fa-be2f-824d2e26a2de","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01FE3aV3PaWd4sKSw1KMx2wg","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The user is now providing the White Male logic, which they describe as the \"Control Group\" or baseline for the entire application. They want me to add these standards to the database.\n\nLooking at what they've provided:\n1. Alar base ratio: 0.98-1.05 (strict nasal width)\n2. Midface ratio: 0.95-1.02 (compact midface)\n3. Gonial angle: 115-125 (square jaw)\n4. Canthal tilt: 4.0-8.0 (neutral to slightly positive)\n5. Chin-philtrum ratio: 2.10-2.30 (lower face balance)\n\nHowever, I already have a TypeScript codebase with `faceiq-scoring.ts` that contains `DEMOGRAPHIC_OVERRIDES`. Let me check if these White Male standards are already defined or if I need to update them.\n\nFrom what I saw earlier:\n- `intercanthalNasalRatio` (which might be the alar_base_ratio) already has `white_male: { idealMin: 1.00, idealMax: 1.04 }`\n- `midfaceRatio` has `male: { idealMin: 0.98, idealMax: 1.02 }` and `middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 }`\n- `gonialAngle` has `male: { idealMin: 115, idealMax: 125 }`\n- `lateralCanthalTilt` has default for others being 4-8\n\nSo some of these are already implemented as the default \"male\" values. But the user wants me to add specific \"white_male\" overrides where they differ from the defaults.\n\nLet me add the White Male specific overrides to make them explicit, especially where they're currently just using the generic \"male\" fallback.","signature":"EoMMCkYIChgCKkD56epbnRz/JfB1CURkey5nx2MZsfCDd1zqjyM20dP7k1C9T/9I6OOnpBL6xJdKH1jV6zhXKJ4UYqDoSry8S72JEgxtij6ed/Ikq/+3YbwaDP0PKEpN/WuyX/y1gyIwDOLf85iHGfWUAFMJCLIhLwdXgeFXomHyCExL00a3o2CcHNPkaE/Gb+WzJfT7TSw0KuoKtgE5DGEm5bO56Qk8fnWLbqTGkNI2V0BEwdBwUxsCrapj3wckRJHMa1mhvz2ikttBCQVVCbXso0JULRUK9XgmqJkbLuAQjMnh/BPLQCaBEn/rTKx5XqjanBZ4NZsCfLtUynpAyVqakY/+76leXnT+OfKz+eLzWDQBdqBHbJ8Y0BA2iCpp1ji/BzMfhXTPVCgLb0aZDYWG/t3gHfDFc99J/GahxE6lW5i/oRnX2wPDJJaj1CaDvobk8+GY8wWKTpwGjw7+36ZfpEQsP1yZKVJsqfrNRv3bUFj2MCOEzNki5qLzzX44y6OR6UlnyEAOsTihyq8iuOkgKgSi9g7y3m2LHucJ9dlz+XwT/K04vpyauxTF7al+l0IanAMfC4/7ykL3uyBJN8p3xmWc05gdwquJq7fV8ZBTVqo36KdDkFEMYN+SNvlb9leKJuDLMKpLCAEFjPamjeYMdDQsYcexWCtC/rKHQcbSRE6tLHDAhbNb47j8cwth2HJ3QIcKF1W9AEW6DmcQz67EiAOkiQgLRHIXuBZmSgB8lURJvhwANMK02QPqCliFp7g7tiJ5uCfxc1+st1GTYlcGNU3YAYV3rAPpzUrnAwIxcG2PD606K2WyR1xUuBADE4RsmVgMVKVs3TwT5wIFKuEXo87oxpWKUsD0yVGkSYy91OMInUbAMjt98TZ5/QIu3pNqTTnDh0XgahaUmUgxF84nR2gVq+rCRJgH8I6ywkdq1G/IZTLubhbRI3ZSdfXzwD2REuExhp+TZMGFSgdVzzhD/V/Zt44hQkVzVm0exgmAcBVw/tLJwplzqNwGgg6Owz7ljMpSZUdeEXY254Q9MqzPfEtmMqea0+7K439Ty7SQEwN8Lbh/EtqZOJAZLrzAWh/BLiER3tdjHaVB/d87fxnP8Ju/DuJ+9tH2DohDGWhofu8YaxEOS+ryoXhx8LE4p7rBkaZKC51Dmz7EDVm8nG+zOg/vcCJDiSK5632Opr0BmUbjABe7yjXgE9AuiY79ItWl0VIiZcsY+ph29fRDdegg8dADEtOGoPzjW0iE2WDVTmvhx4yEHECfldREX7vnmpmZM+0zcrkNHdAvXWEHkgq1Lhw5nJQtTmRsZ8uvV2gyVQeX2/j9DBDDdPa7mWSbXuMn55KmBm8IP0lyAPJGJoScBY0MHIZE9DNkJWZRNrNjY3OKWwBnUw7WM3IGDX/ABeUCziXGlgowcvg/5JKhwwynA/iBuZVAr8bZnlIv65eL/f9xGS0D3bZ/OZ60yWwVsVykW8QuhY/APxxJ6MvfnYVE2MHVKOcfXCUkLRwhxa8PLDxdTTfP0AV0JuLnamAgH9sjHiUdG8XGND1T0XPfHtxRJsZUzoGNHBuyCLV/lI2/yOzVKfEE6vrEx17jZ142poKy1bOHx6pKdvxX/OeLmYm+Z9Yd6om7ULl2B5hVdmNq9cZgFy+LLOaWs2YvRABHoCb8gdzKxXVSF0zhEcSs+Q8cBrcnqCpIBo8e0swR/NbiODXV2lGv/XX7cWpp87lcHua5PV/zLIdJjOakHd04JHh9B7FyzKCMjqYH0dGgmcMixkVUd4266UhQcbKLt+hlsQul4pWPShb63ZVzZt8r+CER/3FmIviWMp0ZLN8RjcQpP0TTxEmlSCsxZhFtRVwx7VPSoLF1GG5yEEZhGm01oDLgu0v9upYhAv561jko4PNcby2xHN+jBGy9+c/xGkRFAG0D1RNaYFJg+WqSt8B2NT9SjYG8zMB48bQR8I4V+1J75PwZHxcsh3fQQjIw7wqVhmkm5ZoCGGDyVnfAL764PK+HrQSFS7q6aFLaaMTwUO3/pYY0s2QMPKIz7FTnSZnVMDMCk8lMGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":18045,"cache_read_input_tokens":19504,"cache_creation":{"ephemeral_5m_input_tokens":18045,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWLDLwz6bfAeGcxjWnRhE","type":"assistant","uuid":"7562c859-05b1-41bb-9daf-07bfdb9b56e4","timestamp":"2025-12-21T17:18:37.127Z"}
{"parentUuid":"7562c859-05b1-41bb-9daf-07bfdb9b56e4","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01FE3aV3PaWd4sKSw1KMx2wg","type":"message","role":"assistant","content":[{"type":"text","text":"I'll add the White Male demographic logic to your metrics database. This represents the Neoclassical \"Control Group\" standard. Let me update the existing overrides and add explicit White Male entries where needed."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":18045,"cache_read_input_tokens":19504,"cache_creation":{"ephemeral_5m_input_tokens":18045,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWLDLwz6bfAeGcxjWnRhE","type":"assistant","uuid":"3e6cc0d2-3188-4433-9a09-8079f573c9b6","timestamp":"2025-12-21T17:18:38.442Z"}
{"parentUuid":"3e6cc0d2-3188-4433-9a09-8079f573c9b6","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01FE3aV3PaWd4sKSw1KMx2wg","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0179ZYHdevxTKhgkjAhDse1Z","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","offset":338,"limit":50}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":18045,"cache_read_input_tokens":19504,"cache_creation":{"ephemeral_5m_input_tokens":18045,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWLDLwz6bfAeGcxjWnRhE","type":"assistant","uuid":"8c4b507f-5478-4d0e-8e9e-accd54534a55","timestamp":"2025-12-21T17:18:39.862Z"}
{"parentUuid":"8c4b507f-5478-4d0e-8e9e-accd54534a55","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0179ZYHdevxTKhgkjAhDse1Z","type":"tool_result","content":"   338â†’    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n   339â†’    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n   340â†’    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n   341â†’  },\n   342â†’\n   343â†’  totalFacialWidthToHeight: {\n   344â†’    male: { idealMin: 1.35, idealMax: 1.40 },\n   345â†’    female: { idealMin: 1.32, idealMax: 1.37 },\n   346â†’  },\n   347â†’\n   348â†’  midfaceRatio: {\n   349â†’    // Females often have more compact midface\n   350â†’    // Middle Eastern: Similar to White model - compact is better\n   351â†’    // Extracted from FaceIQ Male:MiddleEastern.htc\n   352â†’    male: { idealMin: 0.98, idealMax: 1.02 },\n   353â†’    female: { idealMin: 0.95, idealMax: 1.00 },\n   354â†’    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n   355â†’    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n   356â†’  },\n   357â†’\n   358â†’  // ==========================================\n   359â†’  // LIP METRICS - Ethnicity variation\n   360â†’  // ==========================================\n   361â†’  lipRatio: {\n   362â†’    // African/Hispanic: fuller lips natural\n   363â†’    black_male: { idealMin: 1.6, idealMax: 2.2 },\n   364â†’    black_female: { idealMin: 1.7, idealMax: 2.3 },\n   365â†’    hispanic_male: { idealMin: 1.4, idealMax: 2.0 },\n   366â†’    hispanic_female: { idealMin: 1.5, idealMax: 2.1 },\n   367â†’    // East Asian: less full lips\n   368â†’    east_asian_male: { idealMin: 1.2, idealMax: 1.7 },\n   369â†’    east_asian_female: { idealMin: 1.3, idealMax: 1.8 },\n   370â†’    // Default\n   371â†’    male: { idealMin: 1.3, idealMax: 1.8 },\n   372â†’    female: { idealMin: 1.4, idealMax: 2.0 },\n   373â†’  },\n   374â†’\n   375â†’  upperLipRatio: {\n   376â†’    // Fuller upper lip in African phenotypes\n   377â†’    black: { idealMin: 0.38, idealMax: 0.48 },\n   378â†’    hispanic: { idealMin: 0.36, idealMax: 0.45 },\n   379â†’    east_asian: { idealMin: 0.32, idealMax: 0.40 },\n   380â†’    female: { idealMin: 0.34, idealMax: 0.42 },\n   381â†’  },\n   382â†’\n   383â†’  // ==========================================\n   384â†’  // PROFILE METRICS - Gender & ethnicity\n   385â†’  // ==========================================\n   386â†’  chinProjection: {\n   387â†’    // Males: more projected chin ideal\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"b9f1355f-cb33-4748-bc1c-63afde183dc0","timestamp":"2025-12-21T17:18:39.923Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","content":"    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n  },\n\n  totalFacialWidthToHeight: {\n    male: { idealMin: 1.35, idealMax: 1.40 },\n    female: { idealMin: 1.32, idealMax: 1.37 },\n  },\n\n  midfaceRatio: {\n    // Females often have more compact midface\n    // Middle Eastern: Similar to White model - compact is better\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    male: { idealMin: 0.98, idealMax: 1.02 },\n    female: { idealMin: 0.95, idealMax: 1.00 },\n    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n  },\n\n  // ==========================================\n  // LIP METRICS - Ethnicity variation\n  // ==========================================\n  lipRatio: {\n    // African/Hispanic: fuller lips natural\n    black_male: { idealMin: 1.6, idealMax: 2.2 },\n    black_female: { idealMin: 1.7, idealMax: 2.3 },\n    hispanic_male: { idealMin: 1.4, idealMax: 2.0 },\n    hispanic_female: { idealMin: 1.5, idealMax: 2.1 },\n    // East Asian: less full lips\n    east_asian_male: { idealMin: 1.2, idealMax: 1.7 },\n    east_asian_female: { idealMin: 1.3, idealMax: 1.8 },\n    // Default\n    male: { idealMin: 1.3, idealMax: 1.8 },\n    female: { idealMin: 1.4, idealMax: 2.0 },\n  },\n\n  upperLipRatio: {\n    // Fuller upper lip in African phenotypes\n    black: { idealMin: 0.38, idealMax: 0.48 },\n    hispanic: { idealMin: 0.36, idealMax: 0.45 },\n    east_asian: { idealMin: 0.32, idealMax: 0.40 },\n    female: { idealMin: 0.34, idealMax: 0.42 },\n  },\n\n  // ==========================================\n  // PROFILE METRICS - Gender & ethnicity\n  // ==========================================\n  chinProjection: {\n    // Males: more projected chin ideal","numLines":50,"startLine":338,"totalLines":3153}}}
{"parentUuid":"b9f1355f-cb33-4748-bc1c-63afde183dc0","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01CVAewRDbmHWbb156j6PG8Q","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Let me add explicit White Male standards. I need to:\n\n1. Add white_male to midfaceRatio (currently using generic \"male\")\n2. Verify the intercanthalNasalRatio already has white_male\n3. Check if gonialAngle has white_male specific\n4. Check lateralCanthalTilt\n5. Check chinProjection or chin-philtrum ratio\n\nLet me continue reading to see the chin and philtrum metrics.","signature":"EpAECkYIChgCKkDGbSyUTDxG5Ls0ctirnENbKyRn5o6VR1d28d0nbeKVSJrTAQzuHB3EX01r2+PhwZ+aEb5bEUaeq3MAQ3Ejg+JMEgzh8OpAtnZaQZ6MPW4aDIfeal/sV0GEOFdytCIwkhoqhHZiQHoBpt7nQrEqXK6rZoZ+hSJRQ8hZAD/oKwElpTRkv4SMA7hh4Um/S9/bKvcC9dvu3NkiAfRPmg0BeyzA3BCkWFgcSDjGdVVQJvJS23tx3fFm/v80uVsbiJk2IuyCk9/dM2epGRxGmtXrYlcWwIx9RbWLJsCrMfgV6etY8r+VHYTbOe5NLQCetMmatjL+mZ51T3L024o8pVCg/XiosFNEtfmfSO1K9oWQb2cascYZrqPGa9pT/ev9S8piubmuRpRhUzkKJHUloLnfuAnCaYQv3yNyvsr0gD8TJNakn7hj/bQG1qrKgaijhhKUzE6XTPBocpJx4KjeOXEswwdR+OKniU6QPsBIQcb6TLV6Pk0BTW8I1pJn3QOIsK7ylDWeoV2FumoG1Q/97JhFeun7nexrf56Z6BhRTzkEkJFmdYfksKWnNJpGrrCJlvCkIZ43eHB3D7vYp2xTfuxqmNEjOBrb4+p06LAl9gkoO71Sp41GdzOzplRnmbyEhQuDyEMRKSPPIv7WYKwLURsLiq/l796Dm6Gg8FIjOb3S9q+yaKSMRUTyJhx8GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":1674,"cache_read_input_tokens":37549,"cache_creation":{"ephemeral_5m_input_tokens":1674,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWLDMxBH9ckupQ9XRHndz","type":"assistant","uuid":"f03a5f72-570d-4df6-a46a-1051cc6c59b1","timestamp":"2025-12-21T17:18:45.889Z"}
{"parentUuid":"f03a5f72-570d-4df6-a46a-1051cc6c59b1","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01CVAewRDbmHWbb156j6PG8Q","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VD1vFaVFtE5J8Dyv8o11w3","name":"Bash","input":{"command":"grep -n \"chinPhiltrum\\|chin_philtrum\\|philtrumHeight\" src/lib/faceiq-scoring.ts | head -10","description":"Search for chin-philtrum metrics"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":1674,"cache_read_input_tokens":37549,"cache_creation":{"ephemeral_5m_input_tokens":1674,"ephemeral_1h_input_tokens":0},"output_tokens":225,"service_tier":"standard"}},"requestId":"req_011CWLDMxBH9ckupQ9XRHndz","type":"assistant","uuid":"e0e66968-4864-496d-b5dd-5f75545c5614","timestamp":"2025-12-21T17:18:47.302Z"}
{"parentUuid":"e0e66968-4864-496d-b5dd-5f75545c5614","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VD1vFaVFtE5J8Dyv8o11w3","type":"tool_result","content":"","is_error":false}]},"uuid":"c99128f3-70dc-4b0a-aba0-0ab140bb449e","timestamp":"2025-12-21T17:18:47.417Z","toolUseResult":{"stdout":"","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"c99128f3-70dc-4b0a-aba0-0ab140bb449e","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01M69VRyTqnbArxKDZVoupcS","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"No chin-philtrum ratio found. Let me search for lower third metrics.","signature":"EuwBCkYIChgCKkBbeDA3AJS7lurJHP40BviBGD5LbRO4IzYqtHahz8qKY25KuU6riaT5brUPkr/5hcpULslXU6jtr2zDOICuekCpEgwaJDZaw3aDB7W0YrMaDOUaJQFEJvlQ/w7CXSIwGJlnjDMZrixHj77jyz0fcjBUhPd0SZ7OoxhDJHyNpEbtwod1sYiZw9W8bgrdfZLkKlTbNIeUkwjmGxbJGzq5D9qtI8kk4x8M+jy/KkYClOFZY4plhtCks0vqwIn6pBzcq/3O9XXtvacv0fNCg2LpApF1erYVj2kwJT/tak5fMNu+O9UggzMYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":254,"cache_read_input_tokens":39223,"cache_creation":{"ephemeral_5m_input_tokens":254,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDNWF6MS9rFYusp4dKY","type":"assistant","uuid":"f9b0711d-cf1c-48f3-b747-7e4c613c555d","timestamp":"2025-12-21T17:18:50.638Z"}
{"parentUuid":"f9b0711d-cf1c-48f3-b747-7e4c613c555d","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01M69VRyTqnbArxKDZVoupcS","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WvLMRB3JUQ6UeQjsBjKXyX","name":"Bash","input":{"command":"grep -n \"lowerThird\\|philtrum\" src/lib/faceiq-scoring.ts | head -15","description":"Search for lower third metrics"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13,"cache_creation_input_tokens":254,"cache_read_input_tokens":39223,"cache_creation":{"ephemeral_5m_input_tokens":254,"ephemeral_1h_input_tokens":0},"output_tokens":126,"service_tier":"standard"}},"requestId":"req_011CWLDNWF6MS9rFYusp4dKY","type":"assistant","uuid":"83de63e8-1972-49df-980b-51ccc48fb498","timestamp":"2025-12-21T17:18:51.274Z"}
{"parentUuid":"83de63e8-1972-49df-980b-51ccc48fb498","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01WvLMRB3JUQ6UeQjsBjKXyX","type":"tool_result","content":"403:    // Black/African: Fuller lips naturally shorten visible philtrum\n405:    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n406:    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n517:  lowerThirdProportion: {\n518:    id: 'lowerThirdProportion',\n1077:    description: 'Chin height divided by philtrum length',\n1837:  lowerThirdProportion: [\n1894:  lowerThirdProportion: [\n2072: *   Example: Short philtrum is still attractive even if shorter than \"ideal\"\n2586:      const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n2590:      addMeasurement('lowerThirdProportion', lowerThird);","is_error":false}]},"uuid":"5283a817-952e-46f5-b338-4c8ee2eb177e","timestamp":"2025-12-21T17:18:51.370Z","toolUseResult":{"stdout":"403:    // Black/African: Fuller lips naturally shorten visible philtrum\n405:    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n406:    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n517:  lowerThirdProportion: {\n518:    id: 'lowerThirdProportion',\n1077:    description: 'Chin height divided by philtrum length',\n1837:  lowerThirdProportion: [\n1894:  lowerThirdProportion: [\n2072: *   Example: Short philtrum is still attractive even if shorter than \"ideal\"\n2586:      const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n2590:      addMeasurement('lowerThirdProportion', lowerThird);","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"5283a817-952e-46f5-b338-4c8ee2eb177e","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Ucp7saJPA3RvXn2tTa2RuH","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"I see there's a `lowerThirdProportion` metric. Let me check line 1077 which mentions \"Chin height divided by philtrum length\". Let me also look at the gonialAngle section to confirm it's already set for males.","signature":"EvoCCkYIChgCKkAkT/tzdv1XVfMk5JKvExGIR6XHlHpC8BveQVKd0lhIfb3W/neCMaqQV11aFBJZCLU+sqnpC44ij6zB+PRzqn6BEgzm8bDhDTuPfgNnG/EaDK7qZIf/PNCiZuNIMCIwzyP7YUhZquMSdtcig8PkOo3XsVpxgzN5fQMK5P+wCWQSFiCrhAQLxNMGbGKlaUAaKuEBbLMCMYx5cTb7v0vHelgef6UysKG3OEhB72RrcWwGhe1p+VXBjUj/quvM2wIQYnyJrkpK7o35VMMKrOeBIKlrpHeMY8vl32Xj+wvvRW4Du8FY8kbKAENTaYFXnUpNPN4XFRm6Zo1Hx3503hV20DTa8mx2zSKztSZ/QaB4TSEvXO9K6mSy+8952f9kEZOExw/iB3GVqD8ZhmP+zN8jmCIkUjkbDyRzhpGXhhwB/8g73WJQ/rOtg+vnwf1/BlcTWZuZaaPrPCD95N2M+RFTYEta2shVU0K7vqFSIJYd6/4Cg8qBGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":369,"cache_read_input_tokens":39477,"cache_creation":{"ephemeral_5m_input_tokens":369,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWLDNo7MSaXTWAcKaKceU","type":"assistant","uuid":"af32b5c3-d3f4-41be-917c-9fc7b73ade0b","timestamp":"2025-12-21T17:18:56.112Z"}
{"parentUuid":"af32b5c3-d3f4-41be-917c-9fc7b73ade0b","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Ucp7saJPA3RvXn2tTa2RuH","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KMGQ6posi6jJKX5hWESyyM","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","offset":1074,"limit":20}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":12,"cache_creation_input_tokens":369,"cache_read_input_tokens":39477,"cache_creation":{"ephemeral_5m_input_tokens":369,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWLDNo7MSaXTWAcKaKceU","type":"assistant","uuid":"53d90c7c-dc49-44ef-ab27-01522b8e6ca7","timestamp":"2025-12-21T17:18:57.618Z"}
{"parentUuid":"53d90c7c-dc49-44ef-ab27-01522b8e6ca7","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KMGQ6posi6jJKX5hWESyyM","type":"tool_result","content":"  1074â†’    decayRate: 10.0,\n  1075â†’    maxScore: 12.5,  // FaceIQ: medium-high priority\n  1076â†’    weight: 0.02,\n  1077â†’    description: 'Chin height divided by philtrum length',\n  1078â†’    profileType: 'front',\n  1079â†’  },\n  1080â†’\n  1081â†’  // OTHER FRONT MEASUREMENTS\n  1082â†’  iaaJfaDeviation: {\n  1083â†’    id: 'iaaJfaDeviation',\n  1084â†’    name: 'Deviation of IAA & JFA',\n  1085â†’    category: 'Jaw Shape',\n  1086â†’    unit: 'degrees',\n  1087â†’    idealMin: 0,\n  1088â†’    idealMax: 2.5,\n  1089â†’    rangeMin: -25,\n  1090â†’    rangeMax: 30,\n  1091â†’    decayRate: 1.5,\n  1092â†’    maxScore: 10,\n  1093â†’    weight: 0.02,\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"c1cd381b-e3f0-46c6-a172-2193640c2d52","timestamp":"2025-12-21T17:18:57.671Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","content":"    decayRate: 10.0,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.02,\n    description: 'Chin height divided by philtrum length',\n    profileType: 'front',\n  },\n\n  // OTHER FRONT MEASUREMENTS\n  iaaJfaDeviation: {\n    id: 'iaaJfaDeviation',\n    name: 'Deviation of IAA & JFA',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 0,\n    idealMax: 2.5,\n    rangeMin: -25,\n    rangeMax: 30,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,","numLines":20,"startLine":1074,"totalLines":3153}}}
{"parentUuid":"c1cd381b-e3f0-46c6-a172-2193640c2d52","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01E9wRPpqgiJ1wrwcdyYxHVX","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"That's a different metric. Let me search for what metric has the chin to philtrum ratio around 2.10-2.30.","signature":"EpECCkYIChgCKkBvjzumInbqH6qUIZHmJGfmKQXoLnAXoBOEV/RGEuVxn1zzPMRMuC0Q7BNJlT/vHM9VEIDWQy4OQ3ZPTPaLkD0WEgzR8mb+n61SViZhyWcaDHf279lZFwhyuGq/XyIw6nETIXU3OS+671YtMN7D4Btf6qkEOK/qrvPsg+e+eAvVNlntcDgkAdlL6TWmu3jiKnm8t5qyW73BcYclrNuLRT9qKY0n03tDivILSYQNt5Jrj5NLAt31VqOIremgkw7iIjax0M+X+oSEo92RH8S6+c0GDlq7U6iW+HIytYgVrhXfSX/CwUV3OWJ055pICdGvx4raOgFuf1GZyV8OE0qj16A0HGDnlrb5TY9WGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":11,"cache_creation_input_tokens":663,"cache_read_input_tokens":39846,"cache_creation":{"ephemeral_5m_input_tokens":663,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDPG3r53GR21j9uS9Ea","type":"assistant","uuid":"af6de420-df02-432f-b8c5-4002fde03060","timestamp":"2025-12-21T17:19:01.177Z"}
{"parentUuid":"af6de420-df02-432f-b8c5-4002fde03060","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01E9wRPpqgiJ1wrwcdyYxHVX","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01E4RdHkpsMwAd1NuJeGjdBQ","name":"Bash","input":{"command":"grep -n \"2.15\\|2.10\\|2.30\" src/lib/faceiq-scoring.ts | grep -E \"ideal|ratio\" | head -15","description":"Search for metrics with 2.10-2.30 range"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":11,"cache_creation_input_tokens":663,"cache_read_input_tokens":39846,"cache_creation":{"ephemeral_5m_input_tokens":663,"ephemeral_1h_input_tokens":0},"output_tokens":161,"service_tier":"standard"}},"requestId":"req_011CWLDPG3r53GR21j9uS9Ea","type":"assistant","uuid":"b8c78fd4-f743-4340-85ff-99759cb67b7f","timestamp":"2025-12-21T17:19:02.576Z"}
{"parentUuid":"b8c78fd4-f743-4340-85ff-99759cb67b7f","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01E4RdHkpsMwAd1NuJeGjdBQ","type":"tool_result","content":"337:    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n339:    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n406:    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n407:    black_female: { idealMin: 2.10, idealMax: 2.65 },\n1070:    idealMin: 2.15,","is_error":false}]},"uuid":"797f1d2e-fece-4734-b8e3-183ae965e441","timestamp":"2025-12-21T17:19:02.684Z","toolUseResult":{"stdout":"337:    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n339:    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n406:    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n407:    black_female: { idealMin: 2.10, idealMax: 2.65 },\n1070:    idealMin: 2.15,","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"797f1d2e-fece-4734-b8e3-183ae965e441","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01THVzVdh9NaVmcYQ3Dg1ESD","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Let me check line 1070 to see what metric that is.","signature":"EtoBCkYIChgCKkDbPZXRKLAaBga23NcUuKEdzBrurNeLq128Izzg1/yvSCNYTr6FZRdui+YhKI67By+eOqKDCLzj3BIK1uuxBbm9Egyq456qaBy7vIIPBw0aDBd58b1fqGtU6bptrSIwxuokrj8WIsFqOKuw90Fyp3zP1smKxKg80Se9JqA+Elxs787hqjNqKuGwY4WtkRdqKkLZMfn8flRBu3U6Gmrdmteppik7WpfBJlJb2dlBh5Ydf6h3y7f4YhUpIuDkRHX7Ix8AzeYT1F+RS2oiv2OYtYFQSW0YAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":11,"cache_creation_input_tokens":331,"cache_read_input_tokens":40509,"cache_creation":{"ephemeral_5m_input_tokens":331,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDPdUwSFRj21CP8BvvM","type":"assistant","uuid":"6d56f679-c695-40a3-a44a-352d48b28dd1","timestamp":"2025-12-21T17:19:10.830Z"}
{"parentUuid":"6d56f679-c695-40a3-a44a-352d48b28dd1","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01THVzVdh9NaVmcYQ3Dg1ESD","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015ywTSjQyqXCaMSLZ22NEA4","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","offset":1065,"limit":15}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":11,"cache_creation_input_tokens":331,"cache_read_input_tokens":40509,"cache_creation":{"ephemeral_5m_input_tokens":331,"ephemeral_1h_input_tokens":0},"output_tokens":141,"service_tier":"standard"}},"requestId":"req_011CWLDPdUwSFRj21CP8BvvM","type":"assistant","uuid":"54237e1d-c471-48d5-a2f7-87ba4afb69ff","timestamp":"2025-12-21T17:19:11.631Z"}
{"parentUuid":"54237e1d-c471-48d5-a2f7-87ba4afb69ff","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015ywTSjQyqXCaMSLZ22NEA4","type":"tool_result","content":"  1065â†’  chinToPhiltrumRatio: {\n  1066â†’    id: 'chinToPhiltrumRatio',\n  1067â†’    name: 'Chin to Philtrum Ratio',\n  1068â†’    category: 'Chin',\n  1069â†’    unit: 'ratio',\n  1070â†’    idealMin: 2.15,\n  1071â†’    idealMax: 2.45,\n  1072â†’    rangeMin: 0.3,\n  1073â†’    rangeMax: 4.5,\n  1074â†’    decayRate: 10.0,\n  1075â†’    maxScore: 12.5,  // FaceIQ: medium-high priority\n  1076â†’    weight: 0.02,\n  1077â†’    description: 'Chin height divided by philtrum length',\n  1078â†’    profileType: 'front',\n  1079â†’  },\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"4b517b64-438f-4501-b5b1-19c8e07ed37b","timestamp":"2025-12-21T17:19:11.676Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","content":"  chinToPhiltrumRatio: {\n    id: 'chinToPhiltrumRatio',\n    name: 'Chin to Philtrum Ratio',\n    category: 'Chin',\n    unit: 'ratio',\n    idealMin: 2.15,\n    idealMax: 2.45,\n    rangeMin: 0.3,\n    rangeMax: 4.5,\n    decayRate: 10.0,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.02,\n    description: 'Chin height divided by philtrum length',\n    profileType: 'front',\n  },","numLines":15,"startLine":1065,"totalLines":3153}}}
{"parentUuid":"4b517b64-438f-4501-b5b1-19c8e07ed37b","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_015yxQxZpShPsxHBVxNbuFoV","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect! So `chinToPhiltrumRatio` already exists with default idealMin: 2.15, idealMax: 2.45. The user wants White Male to be 2.10-2.30, which is slightly more strict on the upper end.\n\nNow let me check if there's a DEMOGRAPHIC_OVERRIDES section for chinToPhiltrumRatio.","signature":"ErUDCkYIChgCKkA8NwuInacOIC7FwnxRCI0h9QvtahmtqHL+u2EJtNJd4Ci6xm5HCqh8EFy6K4d8hsYG1tZUTWVNt/z7encHJ8NdEgyZgHdvQeEq4N7LcsYaDPr4pwgizKTN+aFCwyIw7RPT9iADpD3kq2D8dXMZ0yfL20zWILniD5nmy0eisghMb91dRD8FSAyB1PyKAoS9KpwC33mFjCRAOYVR6u7hf1Q0I7G876I3419KMpcqU7FhUijvzcOdr1HApYEi5vv5aamai6VaU4Qin3pYeaFcd0XYkubg6olLgDW6gzggXAHHXAIaH9TTxpkC0WGfK/xpUeuqlcTbK2PTWwR2s4TvSCdhe8pLaXBx5mW2VlaQ/89h3m4ScTR8HLRkhwsnOlRp4KLazqKN64K/rP65OOE1Lw0VQykCRaq3UFJCYj3lgz9AdyCmEH/SUjiYEUaFSXMVM9zlt/wmqD0yHerjx85ZwLMW4HJJzY0w5IpS2eOYDs2RO3nAVPjglU67D+5JlBklILPFI9dTeJaEfzWI28P5SJ6+tqDClJjwyrV6I7A5dKT87rtDVv0PDkLVlb92iCUYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":11,"cache_creation_input_tokens":470,"cache_read_input_tokens":40840,"cache_creation":{"ephemeral_5m_input_tokens":470,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWLDQHwyL7WykKkAkcW9K","type":"assistant","uuid":"88a0aa07-84f8-4202-97c2-b8566d5fd490","timestamp":"2025-12-21T17:19:18.031Z"}
{"parentUuid":"88a0aa07-84f8-4202-97c2-b8566d5fd490","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_015yxQxZpShPsxHBVxNbuFoV","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Bia8J6zpEW8G3wWtDyr1hv","name":"Bash","input":{"command":"grep -n \"chinToPhiltrumRatio\" src/lib/faceiq-scoring.ts | head -20","description":"Find all chinToPhiltrumRatio references"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":11,"cache_creation_input_tokens":470,"cache_read_input_tokens":40840,"cache_creation":{"ephemeral_5m_input_tokens":470,"ephemeral_1h_input_tokens":0},"output_tokens":199,"service_tier":"standard"}},"requestId":"req_011CWLDQHwyL7WykKkAkcW9K","type":"assistant","uuid":"95384cad-ed06-425d-b213-a8946698ae17","timestamp":"2025-12-21T17:19:18.791Z"}
{"parentUuid":"95384cad-ed06-425d-b213-a8946698ae17","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Bia8J6zpEW8G3wWtDyr1hv","type":"tool_result","content":"402:  chinToPhiltrumRatio: {\n1065:  chinToPhiltrumRatio: {\n1066:    id: 'chinToPhiltrumRatio',","is_error":false}]},"uuid":"2aee989e-17db-4513-8a62-eb185813b574","timestamp":"2025-12-21T17:19:18.890Z","toolUseResult":{"stdout":"402:  chinToPhiltrumRatio: {\n1065:  chinToPhiltrumRatio: {\n1066:    id: 'chinToPhiltrumRatio',","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"2aee989e-17db-4513-8a62-eb185813b574","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01RUVZKt42AS99govKGMDrAu","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good! Line 402 is in the DEMOGRAPHIC_OVERRIDES section. Let me read that.","signature":"EvEBCkYIChgCKkAdrPFXHgiAO4P+/E8fSC5epiTAKu9xmQMFNW3lAQyKjrAmIJb4jkdndq/sX3RXBgUk++G5aXc7mqjfYOat58o2Egx00Zs1/tbzIfEb/NAaDOoxMclpX82MeiqquCIw1zAhxLjkxMPhrL8SNElvGLbps4ZnEQqVpSpXaK49fE2qnayd0xTfz5jPDrXkFYRQKlkmRaLUG6dugyiXEL9N12YV3AYZAqApz6vifqH7dF7Zznr33n2cxhjrggZu75+liEy+2DctQcqDJIVwR/XZV5pY6GsqCawqWpMIcEl14vpcbBZw/zzCH805nhgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":367,"cache_read_input_tokens":41310,"cache_creation":{"ephemeral_5m_input_tokens":367,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDQpn7r4dzUyS3ZwVaS","type":"assistant","uuid":"fa343f51-25b6-455f-88da-e48cd23ad3a6","timestamp":"2025-12-21T17:19:25.475Z"}
{"parentUuid":"fa343f51-25b6-455f-88da-e48cd23ad3a6","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01RUVZKt42AS99govKGMDrAu","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01RCsLgntKwZkjJpindcyVAb","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","offset":400,"limit":20}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":367,"cache_read_input_tokens":41310,"cache_creation":{"ephemeral_5m_input_tokens":367,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDQpn7r4dzUyS3ZwVaS","type":"assistant","uuid":"0e2b0c72-4ce2-4308-ae1c-248386ae7e50","timestamp":"2025-12-21T17:19:26.168Z"}
{"parentUuid":"0e2b0c72-4ce2-4308-ae1c-248386ae7e50","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01RCsLgntKwZkjJpindcyVAb","type":"tool_result","content":"   400â†’  },\n   401â†’\n   402â†’  chinToPhiltrumRatio: {\n   403â†’    // Black/African: Fuller lips naturally shorten visible philtrum\n   404â†’    // Extracted from FaceIQ BlackAfrican.htc - relaxes \"Short Philtrum\" penalty\n   405â†’    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n   406â†’    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n   407â†’    black_female: { idealMin: 2.10, idealMax: 2.65 },\n   408â†’  },\n   409â†’\n   410â†’  // ==========================================\n   411â†’  // SKIN QUALITY - Ethnicity variation\n   412â†’  // ==========================================\n   413â†’  skinUniformity: {\n   414â†’    // South Asian: Stricter standards due to genetic hyperpigmentation tendency\n   415â†’    // Hispanic: Similar to South Asian - penalizes hyperpigmentation more than White model\n   416â†’    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n   417â†’    white_male: { idealMin: 0.88, idealMax: 1.00 },\n   418â†’    white_female: { idealMin: 0.90, idealMax: 1.00 },\n   419â†’    south_asian_male: { idealMin: 0.90, idealMax: 1.00 },  // Stricter - hyperpigmentation common\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"3d062735-00b6-4e6d-9f6c-b32b22e375bf","timestamp":"2025-12-21T17:19:26.223Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","content":"  },\n\n  chinToPhiltrumRatio: {\n    // Black/African: Fuller lips naturally shorten visible philtrum\n    // Extracted from FaceIQ BlackAfrican.htc - relaxes \"Short Philtrum\" penalty\n    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n    black_female: { idealMin: 2.10, idealMax: 2.65 },\n  },\n\n  // ==========================================\n  // SKIN QUALITY - Ethnicity variation\n  // ==========================================\n  skinUniformity: {\n    // South Asian: Stricter standards due to genetic hyperpigmentation tendency\n    // Hispanic: Similar to South Asian - penalizes hyperpigmentation more than White model\n    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n    white_male: { idealMin: 0.88, idealMax: 1.00 },\n    white_female: { idealMin: 0.90, idealMax: 1.00 },\n    south_asian_male: { idealMin: 0.90, idealMax: 1.00 },  // Stricter - hyperpigmentation common","numLines":20,"startLine":400,"totalLines":3153}}}
{"parentUuid":"3d062735-00b6-4e6d-9f6c-b32b22e375bf","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Qz9kxPaYA25EwfaQ78Hg76","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good! Now I need to add the white_male override for chinToPhiltrumRatio. Let me also verify the current gonialAngle and lateralCanthalTilt settings. Let me add the white_male standards now.","signature":"EuYCCkYIChgCKkBAOyS0ofxjW15Qv9pW3SSM6CSWYk7kNScYr4KLAOR7UcdPNU91+IEWjIMbbKv53+xSSmpskBgyLe8OKX4GCCMWEgxutX7rvd6K1No+IFAaDMRZJWq9kePSKOOqQSIwAdLZ7z+JptRkLIhupVHqQ/wH9pOYIrkxfbj+EQTWHQhBaeai46m2tfkafVfqtHcDKs0BYMXxEuTXfpqobi7OHS2tAMlM6ZNHxEpJueaVbPr4UX+L/bGPCbYL0SmjLGjLa8DXIa+QEQ6Jwdwtza/+kP4ZEvMWZ0ylYMJY+7A/UTm10H043cgiqg31ETAbNKycoZ9WKGFZ8VsFzX1wXoSzoEHVv4glZ8ZQM+MdvwsxePERXYgvussBpkSA9VSFb1SDmCXLMHzrmSOJXKxCRp2VZURA6EV9DlcVvQ6If5mzuVq8u9fBTZdnFjywUh9gQxPjBP8nN8HrClRdjzFO8tsupxgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":621,"cache_read_input_tokens":41677,"cache_creation":{"ephemeral_5m_input_tokens":621,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDRN7mqQszKamhxtJKk","type":"assistant","uuid":"2f129c15-520a-4927-a7ea-9305673e798b","timestamp":"2025-12-21T17:19:30.043Z"}
{"parentUuid":"2f129c15-520a-4927-a7ea-9305673e798b","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Qz9kxPaYA25EwfaQ78Hg76","type":"message","role":"assistant","content":[{"type":"text","text":"Now I'll add the explicit White Male standards. The White model is the Neoclassical baseline, so I'll add these overrides:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":621,"cache_read_input_tokens":41677,"cache_creation":{"ephemeral_5m_input_tokens":621,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDRN7mqQszKamhxtJKk","type":"assistant","uuid":"c9d2faea-59a6-4e7d-82d2-b468095c4973","timestamp":"2025-12-21T17:19:31.183Z"}
{"parentUuid":"c9d2faea-59a6-4e7d-82d2-b468095c4973","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Qz9kxPaYA25EwfaQ78Hg76","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NDPuMt1osxJyLwav63BkrM","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","old_string":"  midfaceRatio: {\n    // Females often have more compact midface\n    // Middle Eastern: Similar to White model - compact is better\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    male: { idealMin: 0.98, idealMax: 1.02 },\n    female: { idealMin: 0.95, idealMax: 1.00 },\n    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n  },","new_string":"  midfaceRatio: {\n    // Females often have more compact midface\n    // White: Neoclassical standard - strict compact midface preference\n    // Middle Eastern: Similar to White model - compact is better\n    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:MiddleEastern.htc\n    white_male: { idealMin: 0.95, idealMax: 1.02 },  // Neoclassical - penalizes long midface heavily\n    white_female: { idealMin: 0.93, idealMax: 1.00 },\n    male: { idealMin: 0.98, idealMax: 1.02 },\n    female: { idealMin: 0.95, idealMax: 1.00 },\n    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n  },"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":10,"cache_creation_input_tokens":621,"cache_read_input_tokens":41677,"cache_creation":{"ephemeral_5m_input_tokens":621,"ephemeral_1h_input_tokens":0},"output_tokens":629,"service_tier":"standard"}},"requestId":"req_011CWLDRN7mqQszKamhxtJKk","type":"assistant","uuid":"768054d4-abe4-41e6-b57b-cf74d1a55de2","timestamp":"2025-12-21T17:19:37.463Z"}
{"parentUuid":"768054d4-abe4-41e6-b57b-cf74d1a55de2","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NDPuMt1osxJyLwav63BkrM","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   344â†’    male: { idealMin: 1.35, idealMax: 1.40 },\n   345â†’    female: { idealMin: 1.32, idealMax: 1.37 },\n   346â†’  },\n   347â†’\n   348â†’  midfaceRatio: {\n   349â†’    // Females often have more compact midface\n   350â†’    // White: Neoclassical standard - strict compact midface preference\n   351â†’    // Middle Eastern: Similar to White model - compact is better\n   352â†’    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:MiddleEastern.htc\n   353â†’    white_male: { idealMin: 0.95, idealMax: 1.02 },  // Neoclassical - penalizes long midface heavily\n   354â†’    white_female: { idealMin: 0.93, idealMax: 1.00 },\n   355â†’    male: { idealMin: 0.98, idealMax: 1.02 },\n   356â†’    female: { idealMin: 0.95, idealMax: 1.00 },\n   357â†’    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n   358â†’    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n   359â†’  },\n   360â†’\n   361â†’  // ==========================================\n   362â†’  // LIP METRICS - Ethnicity variation\n   363â†’  // =========================================="}]},"uuid":"70ee3b2c-86ef-4e22-be78-2ad706a27acf","timestamp":"2025-12-21T17:19:37.504Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","oldString":"  midfaceRatio: {\n    // Females often have more compact midface\n    // Middle Eastern: Similar to White model - compact is better\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    male: { idealMin: 0.98, idealMax: 1.02 },\n    female: { idealMin: 0.95, idealMax: 1.00 },\n    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n  },","newString":"  midfaceRatio: {\n    // Females often have more compact midface\n    // White: Neoclassical standard - strict compact midface preference\n    // Middle Eastern: Similar to White model - compact is better\n    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:MiddleEastern.htc\n    white_male: { idealMin: 0.95, idealMax: 1.02 },  // Neoclassical - penalizes long midface heavily\n    white_female: { idealMin: 0.93, idealMax: 1.00 },\n    male: { idealMin: 0.98, idealMax: 1.02 },\n    female: { idealMin: 0.95, idealMax: 1.00 },\n    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n  },","originalFile":"/**\n * FaceIQ-Style Facial Analysis Scoring System\n * Complete replication of FaceIQ Labs scoring algorithms\n *\n * Features:\n * - Exponential decay scoring with per-metric decay rates\n * - Bezier curve custom scoring for non-linear measurements\n * - 70+ facial measurements (front + side profiles)\n * - Quality tiers: Ideal, Excellent, Good\n * - 5-tier severity: Extremely Severe, Severe, Major, Moderate, Minor\n */\n\nimport { LandmarkPoint } from './landmarks';\n\n// ============================================\n// CORE TYPES\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\n/**\n * Polarity defines how deviation from the ideal range is interpreted:\n * - 'balanced': Default. Deviation in either direction is equally bad.\n * - 'higher_is_better': Values above the ideal are still good. Only values below\n *   the 'safeFloor' are true weaknesses. E.g., Canthal Tilt (positive tilt is good)\n * - 'lower_is_better': Values below the ideal are still good. Only values above\n *   the 'safeCeiling' are true weaknesses. E.g., Philtrum length (shorter is better)\n */\nexport type MetricPolarity = 'balanced' | 'higher_is_better' | 'lower_is_better';\n\nexport interface MetricConfig {\n  id: string;\n  name: string;\n  category: string;\n  unit: MeasurementUnit;\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  decayRate: number;\n  maxScore: number;\n  weight: number;\n  description: string;\n  profileType: 'front' | 'side';\n  customCurve?: BezierCurveConfig;\n  /**\n   * Polarity for directional/dimorphic scoring.\n   * Defaults to 'balanced' if not specified.\n   */\n  polarity?: MetricPolarity;\n  /**\n   * For 'higher_is_better': minimum value that's still acceptable.\n   * Values above this but below idealMin get a passing score (softFloorScore).\n   * Values below this are true weaknesses.\n   */\n  safeFloor?: number;\n  /**\n   * For 'lower_is_better': maximum value that's still acceptable.\n   * Values below this but above idealMax get a passing score (softCeilingScore).\n   * Values above this are true weaknesses.\n   */\n  safeCeiling?: number;\n  /**\n   * Score given to values in the \"acceptable but not ideal\" zone.\n   * Defaults to 8.0 (Good). Range: 6.0-9.0\n   */\n  softZoneScore?: number;\n}\n\nexport interface BezierCurveConfig {\n  mode: 'custom' | 'exponential';\n  points: CurvePoint[];\n}\n\nexport interface CurvePoint {\n  x: number;\n  y: number;\n  leftHandleX?: number;\n  leftHandleY?: number;\n  rightHandleX?: number;\n  rightHandleY?: number;\n  fixed?: boolean;\n}\n\nexport interface FaceIQScoreResult {\n  metricId: string;\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  severity: SeverityLevel;\n  idealMin: number;\n  idealMax: number;\n  deviation: number;\n  deviationDirection: 'above' | 'below' | 'within';\n  unit: MeasurementUnit;\n  category: string;\n  percentile?: number;\n}\n\nexport interface HarmonyAnalysis {\n  overallScore: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  percentile: number;\n  frontScore: number;\n  sideScore: number;\n  categoryScores: Record<string, number>;\n  measurements: FaceIQScoreResult[];\n  flaws: FlawAssessment[];\n  strengths: StrengthAssessment[];\n}\n\nexport interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n}\n\nexport interface StrengthAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  qualityTier: QualityTier;\n  value: number;\n  reasoning: string;\n}\n\n// ============================================\n// DEMOGRAPHIC TYPES & OVERRIDES\n// ============================================\n\nexport type Ethnicity =\n  | 'east_asian'\n  | 'south_asian'\n  | 'black'\n  | 'hispanic'\n  | 'middle_eastern'\n  | 'native_american'\n  | 'pacific_islander'\n  | 'white'\n  | 'other';\n\nexport type Gender = 'male' | 'female';\n\nexport type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n\nexport interface DemographicOverride {\n  idealMin: number;\n  idealMax: number;\n}\n\n/**\n * Demographic-specific ideal ranges based on anthropometric research.\n * FaceIQ uses universal scoring, but this gives more accurate assessments\n * by adjusting ideals based on ethnicity and gender.\n */\nexport const DEMOGRAPHIC_OVERRIDES: Record<string, Partial<Record<DemographicKey, DemographicOverride>>> = {\n  // ==========================================\n  // NOSE METRICS - Highest ethnicity variation\n  // ==========================================\n  nasalIndex: {\n    // Nasal Index = (Nose Width / Nose Height) Ã— 100\n    // Research: African/Pacific Islander tend platyrrhine (85-100), Asian mesorrhine (75-88), European leptorrhine (65-75)\n    east_asian_male: { idealMin: 78, idealMax: 88 },\n    east_asian_female: { idealMin: 76, idealMax: 86 },\n    south_asian_male: { idealMin: 72, idealMax: 82 },\n    south_asian_female: { idealMin: 70, idealMax: 80 },\n    black_male: { idealMin: 85, idealMax: 100 },\n    black_female: { idealMin: 83, idealMax: 98 },\n    hispanic_male: { idealMin: 75, idealMax: 87 },\n    hispanic_female: { idealMin: 73, idealMax: 85 },\n    middle_eastern_male: { idealMin: 68, idealMax: 78 },\n    middle_eastern_female: { idealMin: 66, idealMax: 76 },\n    white_male: { idealMin: 65, idealMax: 75 },\n    white_female: { idealMin: 63, idealMax: 73 },\n    native_american_male: { idealMin: 72, idealMax: 82 },\n    native_american_female: { idealMin: 70, idealMax: 80 },\n    pacific_islander_male: { idealMin: 82, idealMax: 95 },\n    pacific_islander_female: { idealMin: 80, idealMax: 93 },\n  },\n\n  nasolabialAngle: {\n    // Ideal nasolabial angle varies by ethnicity\n    // African: slightly more obtuse, European: slightly more acute\n    // Middle Eastern: Penalizes droopy tip (<90Â°) - common flaw is \"Hooked Nose\"\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    black_male: { idealMin: 95, idealMax: 110 },\n    black_female: { idealMin: 100, idealMax: 115 },\n    east_asian_male: { idealMin: 90, idealMax: 105 },\n    east_asian_female: { idealMin: 95, idealMax: 110 },\n    middle_eastern_male: { idealMin: 90, idealMax: 100 },  // Strict on droopy tip\n    middle_eastern_female: { idealMin: 95, idealMax: 105 },\n    // Gender-only fallbacks\n    male: { idealMin: 90, idealMax: 100 },\n    female: { idealMin: 100, idealMax: 110 },\n  },\n\n  nasalProjection: {\n    // Nose projection relative to face depth\n    // East Asian/African: typically less projection is ideal\n    // Middle Eastern: Accepts stronger projection (bigger nose) than White model\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian: { idealMin: 0.54, idealMax: 0.60 },\n    black: { idealMin: 0.52, idealMax: 0.58 },\n    south_asian: { idealMin: 0.56, idealMax: 0.62 },\n    middle_eastern: { idealMin: 0.62, idealMax: 0.70 },  // Higher tolerance for larger noses\n    white: { idealMin: 0.60, idealMax: 0.67 },\n    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },\n  },\n\n  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Pacific Islander: Similar to Black model, accepts wide nasal base\n    // Extracted from FaceIQ BlackAfrican.htc and Male:Pacific Islander.htc logic\n    white_male: { idealMin: 1.00, idealMax: 1.04 },\n    white_female: { idealMin: 0.98, idealMax: 1.02 },\n    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n    black_female: { idealMin: 1.13, idealMax: 1.23 },\n    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n    pacific_islander_male: { idealMin: 1.10, idealMax: 1.20 },  // Wide tolerance, similar to Black model\n    pacific_islander_female: { idealMin: 1.08, idealMax: 1.18 },\n  },\n\n  // ==========================================\n  // JAW METRICS - Clear gender dimorphism\n  // ==========================================\n  bigonialWidth: {\n    // Jaw width as % of bizygomatic width\n    // Males: wider, more angular; Females: narrower, softer\n    // Pacific Islander: Extremely wide jaw preferred - \"Warrior Skull\" robustness\n    // Extracted from FaceIQ Male:Pacific Islander.htc\n    male: { idealMin: 90, idealMax: 95 },\n    female: { idealMin: 85, idealMax: 90 },\n    pacific_islander_male: { idealMin: 92, idealMax: 98 },  // Jaw width rivals cheekbone width - extreme robustness\n    pacific_islander_female: { idealMin: 88, idealMax: 94 },\n  },\n\n  jawFrontalAngle: {\n    // More angular in males, softer in females\n    male: { idealMin: 88, idealMax: 95 },\n    female: { idealMin: 82, idealMax: 90 },\n  },\n\n  jawWidthRatio: {\n    // Males have stronger jaw width preference\n    male: { idealMin: 0.78, idealMax: 0.85 },\n    female: { idealMin: 0.72, idealMax: 0.80 },\n  },\n\n  gonialAngle: {\n    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n    male: { idealMin: 115, idealMax: 125 },\n    female: { idealMin: 120, idealMax: 135 },\n  },\n\n  // ==========================================\n  // EYE METRICS - Ethnic variation\n  // ==========================================\n  lateralCanthalTilt: {\n    // East Asian: naturally higher positive tilt\n    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian_male: { idealMin: 8, idealMax: 12 },\n    east_asian_female: { idealMin: 9, idealMax: 13 },\n    south_asian_male: { idealMin: 6, idealMax: 10 },\n    south_asian_female: { idealMin: 7, idealMax: 11 },\n    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n    // Default for others is 4-8 (already in FACEIQ_METRICS)\n  },\n\n  eyeAspectRatio: {\n    // East Asian eyes often have different aspect ratio due to epicanthal fold\n    east_asian_male: { idealMin: 2.6, idealMax: 3.2 },\n    east_asian_female: { idealMin: 2.7, idealMax: 3.3 },\n    // Larger eyes in females considered more attractive\n    male: { idealMin: 2.9, idealMax: 3.4 },\n    female: { idealMin: 3.1, idealMax: 3.6 },\n  },\n\n  tearTroughDepth: {\n    // Under-eye hollowing and dark circles (infraorbital depression)\n    // South Asian: MUCH stricter penalty due to genetic hyperpigmentation\n    // Extracted from FaceIQ Male:SouthAsian.htc - biggest difference vs White model\n    white_male: { idealMin: 0.0, idealMax: 1.5 },\n    white_female: { idealMin: 0.0, idealMax: 1.3 },\n    south_asian_male: { idealMin: 0.0, idealMax: 0.5 },  // VERY strict - 0.5+ triggers \"Tired/Aged Eyes\" flaw\n    south_asian_female: { idealMin: 0.0, idealMax: 0.4 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.2 },\n    east_asian_female: { idealMin: 0.0, idealMax: 1.0 },\n  },\n\n  upperEyelidExposure: {\n    // Visible eyelid platform (space between eyelash and crease)\n    // South Asian ideal: prefers visible lid platform, penalizes hooded eyes more than White model\n    // Extracted from FaceIQ Male:SouthAsian.htc\n    white_male: { idealMin: 0.3, idealMax: 2.5 },\n    white_female: { idealMin: 0.5, idealMax: 3.0 },\n    south_asian_male: { idealMin: 0.5, idealMax: 2.0 },  // Prefers visible lid, penalizes hooding\n    south_asian_female: { idealMin: 0.7, idealMax: 2.2 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.5 },  // More tolerance for less exposure\n    east_asian_female: { idealMin: 0.2, idealMax: 1.8 },\n  },\n\n  // ==========================================\n  // FACE PROPORTIONS - Gender variation\n  // ==========================================\n  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n  },\n\n  totalFacialWidthToHeight: {\n    male: { idealMin: 1.35, idealMax: 1.40 },\n    female: { idealMin: 1.32, idealMax: 1.37 },\n  },\n\n  midfaceRatio: {\n    // Females often have more compact midface\n    // Middle Eastern: Similar to White model - compact is better\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    male: { idealMin: 0.98, idealMax: 1.02 },\n    female: { idealMin: 0.95, idealMax: 1.00 },\n    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n  },\n\n  // ==========================================\n  // LIP METRICS - Ethnicity variation\n  // ==========================================\n  lipRatio: {\n    // African/Hispanic: fuller lips natural\n    black_male: { idealMin: 1.6, idealMax: 2.2 },\n    black_female: { idealMin: 1.7, idealMax: 2.3 },\n    hispanic_male: { idealMin: 1.4, idealMax: 2.0 },\n    hispanic_female: { idealMin: 1.5, idealMax: 2.1 },\n    // East Asian: less full lips\n    east_asian_male: { idealMin: 1.2, idealMax: 1.7 },\n    east_asian_female: { idealMin: 1.3, idealMax: 1.8 },\n    // Default\n    male: { idealMin: 1.3, idealMax: 1.8 },\n    female: { idealMin: 1.4, idealMax: 2.0 },\n  },\n\n  upperLipRatio: {\n    // Fuller upper lip in African phenotypes\n    black: { idealMin: 0.38, idealMax: 0.48 },\n    hispanic: { idealMin: 0.36, idealMax: 0.45 },\n    east_asian: { idealMin: 0.32, idealMax: 0.40 },\n    female: { idealMin: 0.34, idealMax: 0.42 },\n  },\n\n  // ==========================================\n  // PROFILE METRICS - Gender & ethnicity\n  // ==========================================\n  chinProjection: {\n    // Males: more projected chin ideal\n    // Black/African: Adjusted for bimaxillary prognathism (forward mouth projection)\n    // Extracted from FaceIQ BlackAfrican.htc logic\n    male: { idealMin: 0, idealMax: 3 },\n    female: { idealMin: -2, idealMax: 2 },\n    black_male: { idealMin: 0, idealMax: 4 },  // Accommodates natural forward projection\n    black_female: { idealMin: -1, idealMax: 3 },\n  },\n\n  nasofrontalAngle: {\n    // Higher brow ridge in males\n    male: { idealMin: 128, idealMax: 138 },\n    female: { idealMin: 132, idealMax: 142 },\n  },\n\n  chinToPhiltrumRatio: {\n    // Black/African: Fuller lips naturally shorten visible philtrum\n    // Extracted from FaceIQ BlackAfrican.htc - relaxes \"Short Philtrum\" penalty\n    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n    black_female: { idealMin: 2.10, idealMax: 2.65 },\n  },\n\n  // ==========================================\n  // SKIN QUALITY - Ethnicity variation\n  // ==========================================\n  skinUniformity: {\n    // South Asian: Stricter standards due to genetic hyperpigmentation tendency\n    // Hispanic: Similar to South Asian - penalizes hyperpigmentation more than White model\n    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n    white_male: { idealMin: 0.88, idealMax: 1.00 },\n    white_female: { idealMin: 0.90, idealMax: 1.00 },\n    south_asian_male: { idealMin: 0.90, idealMax: 1.00 },  // Stricter - hyperpigmentation common\n    south_asian_female: { idealMin: 0.92, idealMax: 1.00 },\n    east_asian_male: { idealMin: 0.92, idealMax: 1.00 },  // High skin quality standards\n    east_asian_female: { idealMin: 0.94, idealMax: 1.00 },\n    black_male: { idealMin: 0.85, idealMax: 1.00 },  // More tolerance for melanin variation\n    black_female: { idealMin: 0.87, idealMax: 1.00 },\n    hispanic_male: { idealMin: 0.85, idealMax: 1.00 },  // Bridge: more tolerance than South Asian, less than White\n    hispanic_female: { idealMin: 0.87, idealMax: 1.00 },\n  },\n\n  // ==========================================\n  // EYEBROW METRICS - Ethnicity variation\n  // ==========================================\n  eyebrowThickness: {\n    // Middle Eastern: Heavily favors thick, dense eyebrows (\"Dark Triad\" look with deep-set eyes)\n    // Extracted from FaceIQ Male:MiddleEastern.htc - STRICTEST eyebrow requirements\n    middle_eastern_male: { idealMin: 2.5, idealMax: 5.0 },  // Prefers significantly thicker/darker brows\n    middle_eastern_female: { idealMin: 2.0, idealMax: 4.0 },\n    east_asian_male: { idealMin: 1.5, idealMax: 3.0 },  // Typically less thick\n    east_asian_female: { idealMin: 1.3, idealMax: 2.5 },\n    male: { idealMin: 2.0, idealMax: 4.0 },\n    female: { idealMin: 1.8, idealMax: 3.5 },\n  },\n\n  eyebrowDistance: {\n    // Middle Eastern: \"Kill Switch\" for unibrow (synophrys)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    // While thick brows are favored, unibrow is a critical flaw if distance < 15mm\n    middle_eastern_male: { idealMin: 15, idealMax: 25 },  // Stricter minimum to avoid unibrow\n    middle_eastern_female: { idealMin: 18, idealMax: 28 },\n    male: { idealMin: 15, idealMax: 25 },\n    female: { idealMin: 16, idealMax: 26 },\n  },\n\n  orbitalVector: {\n    // Middle Eastern: Favors deep-set eyes (lower/negative orbital vector)\n    // Part of the \"Dark Triad\" look with heavy brows\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    middle_eastern_male: { idealMin: -2, idealMax: 3 },  // Allows more deep-set eyes\n    middle_eastern_female: { idealMin: -1, idealMax: 4 },\n    male: { idealMin: 0, idealMax: 4 },\n    female: { idealMin: 1, idealMax: 5 },\n  },\n};\n\n/**\n * Get metric configuration with demographic-specific overrides applied.\n * Lookup priority: ethnicity_gender > gender > ethnicity > default\n */\nexport function getMetricConfigForDemographics(\n  metricId: string,\n  gender: Gender,\n  ethnicity: Ethnicity = 'other'\n): MetricConfig | null {\n  const baseConfig = FACEIQ_METRICS[metricId];\n  if (!baseConfig) return null;\n\n  const overrides = DEMOGRAPHIC_OVERRIDES[metricId];\n  if (!overrides) return baseConfig;\n\n  // Try specific combo first (e.g., \"east_asian_male\")\n  const specificKey = `${ethnicity}_${gender}` as DemographicKey;\n  const override = overrides[specificKey] || overrides[gender] || overrides[ethnicity];\n\n  if (!override) return baseConfig;\n\n  return {\n    ...baseConfig,\n    idealMin: override.idealMin,\n    idealMax: override.idealMax,\n  };\n}\n\n// ============================================\n// FACEIQ MEASUREMENT CONFIGURATIONS (70+)\n// ============================================\n\nexport const FACEIQ_METRICS: Record<string, MetricConfig> = {\n  // ==========================================\n  // FRONT PROFILE - FACIAL PROPORTIONS (32)\n  // ==========================================\n\n  faceWidthToHeight: {\n    id: 'faceWidthToHeight',\n    name: 'Face Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.96,\n    idealMax: 2.0,\n    rangeMin: 1.4,\n    rangeMax: 2.5,\n    decayRate: 6.4,\n    maxScore: 30,  // FaceIQ: highest priority metric\n    weight: 0.06,\n    description: 'Ratio of bizygomatic width to upper face height',\n    profileType: 'front',\n  },\n\n  lowerThirdProportion: {\n    id: 'lowerThirdProportion',\n    name: 'Lower Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31,\n    idealMax: 33.5,\n    rangeMin: 24,\n    rangeMax: 40,\n    decayRate: 1.86,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by lower third (subnasale to menton)',\n    profileType: 'front',\n  },\n\n  middleThirdProportion: {\n    id: 'middleThirdProportion',\n    name: 'Middle Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31.4,\n    idealMax: 33.4,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by middle third',\n    profileType: 'front',\n  },\n\n  upperThirdProportion: {\n    id: 'upperThirdProportion',\n    name: 'Upper Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 30,\n    idealMax: 32,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Percentage of face occupied by upper third (trichion to glabella)',\n    profileType: 'front',\n  },\n\n  bitemporalWidth: {\n    id: 'bitemporalWidth',\n    name: 'Bitemporal Width',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 75,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Temple width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  cheekboneHeight: {\n    id: 'cheekboneHeight',\n    name: 'Cheekbone Height',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 83,\n    idealMax: 100,\n    rangeMin: 30,\n    rangeMax: 140,\n    decayRate: 0.5,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Vertical position of cheekbones relative to face height',\n    profileType: 'front',\n  },\n\n  totalFacialWidthToHeight: {\n    id: 'totalFacialWidthToHeight',\n    name: 'Total Facial Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.34,\n    idealMax: 1.37,\n    rangeMin: 1.0,\n    rangeMax: 1.7,\n    decayRate: 13.2,\n    maxScore: 25,  // Special: higher max score\n    weight: 0.05,\n    description: 'Total face height divided by cheek width',\n    profileType: 'front',\n    customCurve: {\n      mode: 'custom',\n      points: [\n        { x: 1.05, y: 0 },\n        { x: 1.17, y: 1.41 },\n        { x: 1.25, y: 3.86 },\n        { x: 1.29, y: 6.01 },\n        { x: 1.32, y: 8.88 },\n        { x: 1.34, y: 10, fixed: true },\n        { x: 1.37, y: 10, fixed: true },\n        { x: 1.39, y: 8.88 },\n        { x: 1.42, y: 6.01 },\n        { x: 1.46, y: 3.86 },\n        { x: 1.54, y: 1.41 },\n        { x: 1.66, y: 0 },\n      ],\n    },\n  },\n\n  midfaceRatio: {\n    id: 'midfaceRatio',\n    name: 'Midface Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 0.97,\n    idealMax: 1.0,\n    rangeMin: 0.5,\n    rangeMax: 1.5,\n    decayRate: 31.6,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.04,\n    description: 'Midface width to height ratio for facial balance',\n    profileType: 'front',\n  },\n\n  // JAW MEASUREMENTS\n  jawSlope: {\n    id: 'jawSlope',\n    name: 'Jaw Slope',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 140,\n    idealMax: 142.5,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of the jawline from gonion to chin',\n    profileType: 'front',\n  },\n\n  jawFrontalAngle: {\n    id: 'jawFrontalAngle',\n    name: 'Jaw Frontal Angle',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 35,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 20,  // FaceIQ: high priority\n    weight: 0.04,\n    description: 'Angle of jaw corners from frontal view',\n    profileType: 'front',\n  },\n\n  bigonialWidth: {\n    id: 'bigonialWidth',\n    name: 'Bigonial Width',\n    category: 'Jaw Shape',\n    unit: 'percent',\n    idealMin: 87.75,\n    idealMax: 91.75,\n    rangeMin: 60.25,\n    rangeMax: 120.25,\n    decayRate: 0.9,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Jaw width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  jawWidthRatio: {\n    id: 'jawWidthRatio',\n    name: 'Jaw Width to Face Width Ratio',\n    category: 'Jaw Shape',\n    unit: 'ratio',\n    idealMin: 0.75,\n    idealMax: 0.82,\n    rangeMin: 0.6,\n    rangeMax: 0.95,\n    decayRate: 25.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Bigonial width divided by bizygomatic width',\n    profileType: 'front',\n  },\n\n  // EYE MEASUREMENTS\n  lateralCanthalTilt: {\n    id: 'lateralCanthalTilt',\n    name: 'Lateral Canthal Tilt',\n    category: 'Eyes',\n    unit: 'degrees',\n    idealMin: 4.0,   // Updated: 4-8Â° is peak \"hunter eyes\"\n    idealMax: 8.0,\n    rangeMin: -5,\n    rangeMax: 20,\n    decayRate: 1.5,  // Reduced: gentler decay for positive tilts\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle of eye from inner to outer canthus. Positive tilt is attractive.',\n    profileType: 'front',\n    // DIRECTIONAL SCORING: Higher (positive) tilt is better\n    // - Ideal: 4-8Â° (attractive upswept eyes / \"hunter eyes\")\n    // - Good: 0-4Â° (neutral to slight positive - still attractive)\n    // - Weak: < 0Â° (negative/droopy tilt - only this is a true weakness)\n    polarity: 'higher_is_better',\n    safeFloor: 0.0,       // Neutral tilt - anything above is acceptable\n    softZoneScore: 8.0,   // \"Good\" score for 0-4Â° range\n  },\n\n  eyeAspectRatio: {\n    id: 'eyeAspectRatio',\n    name: 'Eye Aspect Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 3.0,\n    idealMax: 3.5,\n    rangeMin: 0.8,\n    rangeMax: 6,\n    decayRate: 2.0,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Eye width divided by eye height',\n    profileType: 'front',\n  },\n\n  eyeSeparationRatio: {\n    id: 'eyeSeparationRatio',\n    name: 'Eye Separation Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 45.7,\n    idealMax: 46.8,\n    rangeMin: 35,\n    rangeMax: 55,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Intercanthal distance as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryRatio: {\n    id: 'interpupillaryRatio',\n    name: 'Interpupillary Distance Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 44,\n    idealMax: 48,\n    rangeMin: 38,\n    rangeMax: 54,\n    decayRate: 1.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'IPD as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryMouthWidthRatio: {\n    id: 'interpupillaryMouthWidthRatio',\n    name: 'Interpupillary-Mouth Width Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.83,\n    idealMax: 0.87,\n    rangeMin: 0.6,\n    rangeMax: 1.1,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Mouth width divided by interpupillary distance',\n    profileType: 'front',\n  },\n\n  oneEyeApartTest: {\n    id: 'oneEyeApartTest',\n    name: 'One Eye Apart Test',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.95,\n    idealMax: 1.0,\n    rangeMin: 0.7,\n    rangeMax: 1.3,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Intercanthal distance should equal one eye width',\n    profileType: 'front',\n  },\n\n  tearTroughDepth: {\n    id: 'tearTroughDepth',\n    name: 'Tear Trough Depth',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.0,\n    idealMax: 1.5,\n    rangeMin: 0.0,\n    rangeMax: 4.0,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Under-eye hollow depth (infraorbital depression). Lower is better for youthfulness.',\n    profileType: 'front',\n    polarity: 'lower_is_better',\n    safeCeiling: 1.5,  // White standard\n    softZoneScore: 7.5,\n  },\n\n  upperEyelidExposure: {\n    id: 'upperEyelidExposure',\n    name: 'Upper Eyelid Exposure',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 2.5,\n    rangeMin: 0.0,\n    rangeMax: 5.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Visible upper eyelid platform. Too little creates hooded eyes.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  // EYEBROW MEASUREMENTS\n  eyebrowThickness: {\n    id: 'eyebrowThickness',\n    name: 'Eyebrow Thickness',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 2.0,\n    idealMax: 4.0,\n    rangeMin: 1.0,\n    rangeMax: 6.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow density and thickness. Higher values indicate fuller, denser brows.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  eyebrowDistance: {\n    id: 'eyebrowDistance',\n    name: 'Inter-Eyebrow Distance',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 15,\n    idealMax: 25,\n    rangeMin: 5,\n    rangeMax: 40,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance between inner edges of eyebrows. Too low creates unibrow (synophrys).',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  browLengthRatio: {\n    id: 'browLengthRatio',\n    name: 'Brow Length to Face Width Ratio',\n    category: 'Upper Third',\n    unit: 'percent',\n    idealMin: 28,\n    idealMax: 32,\n    rangeMin: 20,\n    rangeMax: 40,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow length as percentage of face width',\n    profileType: 'front',\n  },\n\n  eyebrowTilt: {\n    id: 'eyebrowTilt',\n    name: 'Eyebrow Tilt',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 6.5,\n    idealMax: 11,\n    rangeMin: -5,\n    rangeMax: 25,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of eyebrow from head to tail',\n    profileType: 'front',\n  },\n\n  eyebrowLowSetedness: {\n    id: 'eyebrowLowSetedness',\n    name: 'Eyebrow Low Setedness',\n    category: 'Upper Third',\n    unit: 'ratio',\n    idealMin: 0,\n    idealMax: 0.45,\n    rangeMin: -0.2,\n    rangeMax: 1.0,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from brow to eye relative to eye height',\n    profileType: 'front',\n  },\n\n  // NOSE MEASUREMENTS (FRONT)\n  nasalIndex: {\n    id: 'nasalIndex',\n    name: 'Nasal Index',\n    category: 'Nose',\n    unit: 'percent',\n    idealMin: 70,\n    idealMax: 85,\n    rangeMin: 55,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose width divided by nose height Ã— 100',\n    profileType: 'front',\n  },\n\n  intercanthalNasalRatio: {\n    id: 'intercanthalNasalRatio',\n    name: 'Intercanthal-Nasal Width Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 1.04,\n    idealMax: 1.16,\n    rangeMin: 0.7,\n    rangeMax: 1.5,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Alar width should roughly equal intercanthal distance',\n    profileType: 'front',\n  },\n\n  noseBridgeWidth: {\n    id: 'noseBridgeWidth',\n    name: 'Nose Bridge to Nose Width',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.6,\n    idealMax: 0.75,\n    rangeMin: 0.4,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ratio of nose bridge width to alar base width',\n    profileType: 'front',\n  },\n\n  noseTipPosition: {\n    id: 'noseTipPosition',\n    name: 'Nose Tip Position',\n    category: 'Nose',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 3.5,\n    rangeMin: -7.5,\n    rangeMax: 12.5,\n    decayRate: 1.5,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Nose tip deviation from facial midline',\n    profileType: 'front',\n  },\n\n  // MOUTH/LIP MEASUREMENTS\n  mouthWidthToNoseRatio: {\n    id: 'mouthWidthToNoseRatio',\n    name: 'Mouth Width to Nose Width Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.43,\n    idealMax: 1.51,\n    rangeMin: 0.96,\n    rangeMax: 1.91,\n    decayRate: 18.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Mouth width divided by nose width',\n    profileType: 'front',\n  },\n\n  lowerToUpperLipRatio: {\n    id: 'lowerToUpperLipRatio',\n    name: 'Lower Lip to Upper Lip Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.58,\n    idealMax: 1.88,\n    rangeMin: -0.98,\n    rangeMax: 4.03,\n    decayRate: 8.0,\n    maxScore: 7.5,  // FaceIQ: medium priority\n    weight: 0.02,\n    description: 'Lower lip height divided by upper lip height',\n    profileType: 'front',\n  },\n\n  cupidsBowDepth: {\n    id: 'cupidsBowDepth',\n    name: \"Cupid's Bow Depth\",\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2.3,\n    idealMax: 4,\n    rangeMin: 0,\n    rangeMax: 7,\n    decayRate: 2.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: \"Depth of the cupid's bow curve\",\n    profileType: 'front',\n  },\n\n  mouthCornerPosition: {\n    id: 'mouthCornerPosition',\n    name: 'Mouth Corner Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Mouth corner vertical position relative to lip center',\n    profileType: 'front',\n  },\n\n  // CHIN MEASUREMENTS (FRONT)\n  chinToPhiltrumRatio: {\n    id: 'chinToPhiltrumRatio',\n    name: 'Chin to Philtrum Ratio',\n    category: 'Chin',\n    unit: 'ratio',\n    idealMin: 2.15,\n    idealMax: 2.45,\n    rangeMin: 0.3,\n    rangeMax: 4.5,\n    decayRate: 10.0,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.02,\n    description: 'Chin height divided by philtrum length',\n    profileType: 'front',\n  },\n\n  // OTHER FRONT MEASUREMENTS\n  iaaJfaDeviation: {\n    id: 'iaaJfaDeviation',\n    name: 'Deviation of IAA & JFA',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 0,\n    idealMax: 2.5,\n    rangeMin: -25,\n    rangeMax: 30,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Deviation between Ipsilateral Alar Angle and Jaw Frontal Angle',\n    profileType: 'front',\n  },\n\n  ipsilateralAlarAngle: {\n    id: 'ipsilateralAlarAngle',\n    name: 'Ipsilateral Alar Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 60,\n    rangeMax: 125,\n    decayRate: 0.6,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Angle of alar base relative to facial plane',\n    profileType: 'front',\n  },\n\n  earProtrusionAngle: {\n    id: 'earProtrusionAngle',\n    name: 'Ear Protrusion Angle',\n    category: 'Ears',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 11.5,\n    rangeMin: -25,\n    rangeMax: 40,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of ear protrusion from head',\n    profileType: 'front',\n  },\n\n  earProtrusionRatio: {\n    id: 'earProtrusionRatio',\n    name: 'Ear Protrusion Ratio',\n    category: 'Ears',\n    unit: 'percent',\n    idealMin: 8,\n    idealMax: 12,\n    rangeMin: -20,\n    rangeMax: 40,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ear protrusion as percentage of head width',\n    profileType: 'front',\n  },\n\n  neckWidth: {\n    id: 'neckWidth',\n    name: 'Neck Width',\n    category: 'Neck',\n    unit: 'percent',\n    idealMin: 92,\n    idealMax: 98,\n    rangeMin: 60,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Neck width as percentage of jaw width',\n    profileType: 'front',\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS (38)\n  // ==========================================\n\n  gonialAngle: {\n    id: 'gonialAngle',\n    name: 'Gonial Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 130,\n    rangeMin: 105,\n    rangeMax: 145,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle at the jaw corner (gonion)',\n    profileType: 'side',\n  },\n\n  nasolabialAngle: {\n    id: 'nasolabialAngle',\n    name: 'Nasolabial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 90,\n    idealMax: 105,\n    rangeMin: 75,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle between columella and upper lip',\n    profileType: 'side',\n  },\n\n  nasofrontalAngle: {\n    id: 'nasofrontalAngle',\n    name: 'Nasofrontal Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 116,\n    idealMax: 128,\n    rangeMin: 90,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the bridge of nose (nasion)',\n    profileType: 'side',\n  },\n\n  nasofacialAngle: {\n    id: 'nasofacialAngle',\n    name: 'Nasofacial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 31,\n    idealMax: 35,\n    rangeMin: 15,\n    rangeMax: 50,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between nose and face plane',\n    profileType: 'side',\n  },\n\n  nasomentaAngle: {\n    id: 'nasomentaAngle',\n    name: 'Nasomental Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 126,\n    idealMax: 131,\n    rangeMin: 105,\n    rangeMax: 155,\n    decayRate: 0.7,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle from nasion to nose tip to chin',\n    profileType: 'side',\n  },\n\n  nasalTipAngle: {\n    id: 'nasalTipAngle',\n    name: 'Nasal Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 105,\n    rangeMin: 70,\n    rangeMax: 120,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the nose tip',\n    profileType: 'side',\n  },\n\n  nasalProjection: {\n    id: 'nasalProjection',\n    name: 'Nasal Projection',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.55,\n    idealMax: 0.6,\n    rangeMin: 0.4,\n    rangeMax: 0.75,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose projection relative to nasal length (Goode ratio)',\n    profileType: 'side',\n  },\n\n  nasalWToHRatio: {\n    id: 'nasalWToHRatio',\n    name: 'Nasal W to H Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.67,\n    idealMax: 0.78,\n    rangeMin: 0.5,\n    rangeMax: 0.95,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Nose width to height ratio from side view',\n    profileType: 'side',\n  },\n\n  noseTipRotationAngle: {\n    id: 'noseTipRotationAngle',\n    name: 'Nose Tip Rotation Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 95,\n    idealMax: 110,\n    rangeMin: 80,\n    rangeMax: 125,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of nose tip rotation',\n    profileType: 'side',\n  },\n\n  frankfortTipAngle: {\n    id: 'frankfortTipAngle',\n    name: 'Frankfort-Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 28,\n    idealMax: 34,\n    rangeMin: 20,\n    rangeMax: 42,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle between Frankfort plane and nose tip',\n    profileType: 'side',\n  },\n\n  mentolabialAngle: {\n    id: 'mentolabialAngle',\n    name: 'Mentolabial Angle',\n    category: 'Lips',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 140,\n    rangeMin: 100,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the labiomental fold',\n    profileType: 'side',\n  },\n\n  zAngle: {\n    id: 'zAngle',\n    name: 'Z Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 75,\n    idealMax: 85,\n    rangeMin: 60,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Merrifield Z-Angle for profile assessment',\n    profileType: 'side',\n  },\n\n  submentalCervicalAngle: {\n    id: 'submentalCervicalAngle',\n    name: 'Submental Cervical Angle',\n    category: 'Neck',\n    unit: 'degrees',\n    idealMin: 94,\n    idealMax: 106,\n    rangeMin: 70,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between chin and neck',\n    profileType: 'side',\n  },\n\n  facialConvexityGlabella: {\n    id: 'facialConvexityGlabella',\n    name: 'Facial Convexity (Glabella)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 165,\n    idealMax: 175,\n    rangeMin: 150,\n    rangeMax: 185,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Facial convexity angle using glabella',\n    profileType: 'side',\n  },\n\n  facialConvexityNasion: {\n    id: 'facialConvexityNasion',\n    name: 'Facial Convexity (Nasion)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 168,\n    idealMax: 178,\n    rangeMin: 155,\n    rangeMax: 190,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial convexity angle using nasion',\n    profileType: 'side',\n  },\n\n  totalFacialConvexity: {\n    id: 'totalFacialConvexity',\n    name: 'Total Facial Convexity',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 135,\n    idealMax: 145,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Complete facial profile convexity measurement',\n    profileType: 'side',\n  },\n\n  facialDepthToHeight: {\n    id: 'facialDepthToHeight',\n    name: 'Facial Depth to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.3,\n    idealMax: 1.44,\n    rangeMin: 0.7,\n    rangeMax: 1.8,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial depth divided by facial height',\n    profileType: 'side',\n  },\n\n  anteriorFacialDepth: {\n    id: 'anteriorFacialDepth',\n    name: 'Anterior Facial Depth',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 64.5,\n    idealMax: 67.5,\n    rangeMin: 45,\n    rangeMax: 95,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Anterior facial projection angle',\n    profileType: 'side',\n  },\n\n  interiorMidfaceProjectionAngle: {\n    id: 'interiorMidfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 50,\n    idealMax: 56,\n    rangeMin: 30,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Interior midface projection from side profile',\n    profileType: 'side',\n  },\n\n  recessionFromFrankfort: {\n    id: 'recessionFromFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'mm',\n    idealMin: 1.5,\n    idealMax: 15,\n    rangeMin: -30,\n    rangeMax: 30,\n    decayRate: 0.3,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin position relative to Frankfort plane',\n    profileType: 'side',\n  },\n\n  mandibularPlaneAngle: {\n    id: 'mandibularPlaneAngle',\n    name: 'Mandibular Plane Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 22,\n    idealMax: 28,\n    rangeMin: 15,\n    rangeMax: 38,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of mandibular plane to Frankfort plane',\n    profileType: 'side',\n  },\n\n  ramusToMandibleRatio: {\n    id: 'ramusToMandibleRatio',\n    name: 'Ramus to Mandible Ratio',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'ratio',\n    idealMin: 0.65,\n    idealMax: 0.75,\n    rangeMin: 0.5,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Ramus height divided by mandible length',\n    profileType: 'side',\n  },\n\n  gonionToMouthLine: {\n    id: 'gonionToMouthLine',\n    name: 'Gonion to Mouth Line',\n    category: 'Jaw Shape',\n    unit: 'mm',\n    idealMin: -5,\n    idealMax: 5,\n    rangeMin: -20,\n    rangeMax: 20,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from gonion to mouth level line',\n    profileType: 'side',\n  },\n\n  // E-LINE MEASUREMENTS\n  eLineUpperLip: {\n    id: 'eLineUpperLip',\n    name: 'Upper Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -4,\n    idealMax: -2,\n    rangeMin: -10,\n    rangeMax: 4,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Upper lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  eLineLowerLip: {\n    id: 'eLineLowerLip',\n    name: 'Lower Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 0,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Lower lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  // S-LINE MEASUREMENTS\n  sLineUpperLip: {\n    id: 'sLineUpperLip',\n    name: 'Upper Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 3,\n    rangeMin: -5,\n    rangeMax: 8,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  sLineLowerLip: {\n    id: 'sLineLowerLip',\n    name: 'Lower Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -0.4,\n    idealMax: 0.4,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  // BURSTONE LINE\n  burstoneUpperLip: {\n    id: 'burstoneUpperLip',\n    name: 'Upper Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2,\n    idealMax: 4,\n    rangeMin: -2,\n    rangeMax: 8,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  burstoneLowerLip: {\n    id: 'burstoneLowerLip',\n    name: 'Lower Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 1,\n    idealMax: 3,\n    rangeMin: -3,\n    rangeMax: 7,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  // H LINE\n  holdawayHLine: {\n    id: 'holdawayHLine',\n    name: 'Holdaway H Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Holdaway H-line soft tissue assessment',\n    profileType: 'side',\n  },\n\n  // CHIN MEASUREMENTS (SIDE)\n  chinProjection: {\n    id: 'chinProjection',\n    name: 'Chin Projection',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -3,\n    idealMax: 3,\n    rangeMin: -12,\n    rangeMax: 12,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin projection relative to ideal position',\n    profileType: 'side',\n  },\n\n  recessionRelativeToFrankfort: {\n    id: 'recessionRelativeToFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 2,\n    rangeMin: -10,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin recession relative to Frankfort horizontal',\n    profileType: 'side',\n  },\n\n  // FOREHEAD\n  browridgeInclinationAngle: {\n    id: 'browridgeInclinationAngle',\n    name: 'Browridge Inclination Angle',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 18,\n    rangeMin: 0,\n    rangeMax: 28,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the brow ridge from profile',\n    profileType: 'side',\n  },\n\n  upperForeheadSlope: {\n    id: 'upperForeheadSlope',\n    name: 'Upper Forehead Slope',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 5,\n    idealMax: 12,\n    rangeMin: 0,\n    rangeMax: 20,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Slope angle of the upper forehead',\n    profileType: 'side',\n  },\n\n  // MIDFACE PROJECTION\n  midfaceProjectionAngle: {\n    id: 'midfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 95,\n    rangeMin: 75,\n    rangeMax: 105,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of midface projection from profile',\n    profileType: 'side',\n  },\n\n  orbitalVector: {\n    id: 'orbitalVector',\n    name: 'Orbital Vector',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -6,\n    rangeMax: 10,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Relationship of globe to orbital rim',\n    profileType: 'side',\n  },\n\n  skinUniformity: {\n    id: 'skinUniformity',\n    name: 'Skin Uniformity',\n    category: 'Skin Quality',\n    unit: 'ratio',\n    idealMin: 0.90,\n    idealMax: 1.00,\n    rangeMin: 0.50,\n    rangeMax: 1.00,\n    decayRate: 5.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Skin tone evenness and hyperpigmentation. 1.0 = perfectly uniform.',\n    profileType: 'front',\n    polarity: 'higher_is_better',\n    safeFloor: 0.85,  // Acceptable uniformity threshold\n    softZoneScore: 7.5,\n  },\n\n};\n\n// ============================================\n// FLAW MAPPINGS (Extracted from FaceIQ)\n// ============================================\n\nexport interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n  reasoning: string;\n}\n\nexport const METRIC_FLAW_MAPPINGS: Record<string, FlawMapping[]> = {\n  anteriorFacialDepth: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Anterior Facial Depth measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  bitemporalWidth: [\n    { category: 'Upper Third', flawName: 'Narrow forehead', confidence: 'confirmed', reasoning: 'Reduced bitemporal width indicates a narrower than ideal forehead relative to the cheekbones. This disrupts facial harmony by creating a compressed hairline and forehead, altering the overall shape of the face.' },\n  ],\n  cheekboneHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Low-set cheekbones', confidence: 'confirmed', reasoning: 'Reduced cheekbone height indicates that the cheekbones are positioned lower than ideal. This disrupts facial harmony by creating an unpronounced appearance to the cheekbones and facial structure.' },\n  ],\n  eyeAspectRatio: [\n    { category: 'Eyes', flawName: 'Overly round eye shape', confidence: 'confirmed', reasoning: 'A reduced eye aspect ratio indicates overly narrow eyes relative to their height. This disrupts facial harmony by creating an overly surprised appearance and reducing angular definition.' },\n  ],\n  eyeSeparationRatio: [\n    { category: 'Eyes', flawName: 'Close-set eyes', confidence: 'confirmed', reasoning: 'Reduced eye separation indicates close-set eyes. This disrupts facial harmony by making the eye area appear too compressed.' },\n  ],\n  eyebrowLowSetedness: [\n    { category: 'Eyes', flawName: 'Medium-set eyebrows', confidence: 'confirmed', reasoning: 'Increased eyebrow low setedness indicates eyebrows that are positioned higher than ideal. This disrupts facial harmony by reducing the overall visual impact of the eyebrows and framing of the eyes.' },\n  ],\n  faceWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced face width to height ratio indicates an overly long midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  facialDepthToHeight: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'Reduced facial depth to height ratio indicates insufficient mid-face projection relative to height. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  gonialAngle: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  holdawayHLine: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'Decreased H-line indicates the lips are positioned too far in front of the line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  interiorMidfaceProjectionAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Interior Midface Projection Angle measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  ipsilateralAlarAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A decreased ipsilateral alar angle indicates an overly narrow interior midface. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  jawFrontalAngle: [\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A narrower jaw frontal angle indicates a steeper jawline or overly wide chin. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  jawSlope: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'The Jaw Slope measurement is above the ideal range. This disrupts facial harmony in the lower face.' },\n  ],\n  lateralCanthalTilt: [\n    { category: 'Eyes', flawName: 'Insufficient eye tilt', confidence: 'confirmed', reasoning: 'A decreased lateral canthal tilt indicates insufficiently upturned eyes. This disrupts facial harmony by creating a less alert and youthful appearance.' },\n  ],\n  burstoneLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the Burstone line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  eLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned too far in front of the E-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  sLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the S-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  lowerThirdProportion: [\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'The upper jaw is too long relative to lower jaw, possibly from a long upper jaw or short lower jaw, or a combination of both. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  mandibularPlaneAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Hyper-divergent jaw growth', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by elongating the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  midfaceRatio: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  nasofacialAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A smaller nasofacial angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  nasofrontalAngle: [\n    { category: 'Upper Third', flawName: 'Soft and weak brow ridge', confidence: 'confirmed', reasoning: 'An increased nasofrontal angle indicates reduced brow ridge prominence and angularity. This disrupts facial harmony by creating a less defined upper face.' },\n  ],\n  nasomentaAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A larger nasomental angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  noseBridgeWidth: [\n    { category: 'Nose', flawName: 'Overly narrow nose bridge', confidence: 'confirmed', reasoning: 'The Nose Bridge to Nose Width measurement is above the ideal range. This disrupts facial harmony by creating an unbalanced nasal profile.' },\n  ],\n  orbitalVector: [\n    { category: 'Eyes', flawName: 'Sunken orbital region', confidence: 'confirmed', reasoning: 'A decreased orbital vector indicates insufficient projection and volume underneath the eye. This disrupts facial harmony due to the lacking volume underneath the eyes, reducing vibrancy and youthfulness.' },\n  ],\n  ramusToMandibleRatio: [\n    { category: 'Jaw Shape', flawName: 'Short ramus', confidence: 'confirmed', reasoning: 'A reduced ramus-to-mandible ratio indicates a shorter than ideal vertical jawbone (ramus) when compared to the mandible. This disrupts facial harmony by reducing jaw height and definition.' },\n  ],\n  submentalCervicalAngle: [\n    { category: 'Neck', flawName: 'Round neck region', confidence: 'confirmed', reasoning: 'An increased submental cervical angle indicates a round neck region, possibly from excess submental fat or tissue. This disrupts facial harmony by reducing neck definition.' },\n  ],\n  totalFacialWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Overly long face shape', confidence: 'confirmed', reasoning: 'An increased total facial width to height ratio indicates an overly long face relative to its height. This disrupts facial harmony by creating a vertically stretched appearance to the face.' },\n  ],\n};\n\n// ============================================\n// CUSTOM BEZIER CURVES (Extracted from FaceIQ)\n// ============================================\n\nexport const METRIC_CUSTOM_CURVES: Record<string, CurvePoint[]> = {\n  faceWidthToHeight: [\n    { x: 1.49, y: 0, leftHandleX: 1.44, leftHandleY: 0, rightHandleX: 1.55, rightHandleY: 0 },\n    { x: 1.68, y: 1.05, leftHandleX: 1.62, leftHandleY: 0.36, rightHandleX: 1.71, rightHandleY: 1.58 },\n    { x: 1.77, y: 3.07, leftHandleX: 1.74, leftHandleY: 2.15, rightHandleX: 1.79, rightHandleY: 3.88 },\n    { x: 1.83, y: 5.83, leftHandleX: 1.80, leftHandleY: 4.64, rightHandleX: 1.84, rightHandleY: 6.85 },\n    { x: 1.89, y: 8.70, leftHandleX: 1.88, leftHandleY: 8.30, rightHandleX: 1.92, rightHandleY: 9.50 },\n    { x: 1.96, y: 10, leftHandleX: 1.96, leftHandleY: 10, rightHandleX: 1.96, rightHandleY: 10, fixed: true },\n    { x: 2.00, y: 10, leftHandleX: 2.00, leftHandleY: 10, rightHandleX: 2.00, rightHandleY: 10, fixed: true },\n    { x: 2.07, y: 8.70, leftHandleX: 2.04, leftHandleY: 9.50, rightHandleX: 2.08, rightHandleY: 8.30 },\n    { x: 2.13, y: 5.83, leftHandleX: 2.12, leftHandleY: 6.85, rightHandleX: 2.16, rightHandleY: 4.64 },\n    { x: 2.19, y: 3.07, leftHandleX: 2.17, leftHandleY: 3.88, rightHandleX: 2.22, rightHandleY: 2.15 },\n    { x: 2.28, y: 1.05, leftHandleX: 2.25, leftHandleY: 1.58, rightHandleX: 2.34, rightHandleY: 0.36 },\n    { x: 2.47, y: 0, leftHandleX: 2.41, leftHandleY: 0, rightHandleX: 2.52, rightHandleY: 0 },\n  ],\n  lowerThirdProportion: [\n    { x: 25.6, y: 0, leftHandleX: 24.8, leftHandleY: 0, rightHandleX: 26.4, rightHandleY: 0 },\n    { x: 28.01, y: 1.58, leftHandleX: 27.23, leftHandleY: 0.53, rightHandleX: 28.27, rightHandleY: 1.97 },\n    { x: 28.83, y: 3.21, leftHandleX: 28.60, leftHandleY: 2.60, rightHandleX: 29.10, rightHandleY: 3.90 },\n    { x: 29.63, y: 5.85, leftHandleX: 29.40, leftHandleY: 4.90, rightHandleX: 29.85, rightHandleY: 6.80 },\n    { x: 30.27, y: 8.56, leftHandleX: 30.05, leftHandleY: 7.80, rightHandleX: 30.50, rightHandleY: 9.30 },\n    { x: 31, y: 10, leftHandleX: 30.95, leftHandleY: 10, rightHandleX: 31.05, rightHandleY: 10, fixed: true },\n    { x: 33.5, y: 10, leftHandleX: 33.45, leftHandleY: 10, rightHandleX: 33.55, rightHandleY: 10, fixed: true },\n    { x: 34.23, y: 8.56, leftHandleX: 34.00, leftHandleY: 9.30, rightHandleX: 34.45, rightHandleY: 7.80 },\n    { x: 34.87, y: 5.85, leftHandleX: 34.65, leftHandleY: 6.80, rightHandleX: 35.10, rightHandleY: 4.90 },\n    { x: 35.67, y: 3.21, leftHandleX: 35.40, leftHandleY: 3.90, rightHandleX: 35.90, rightHandleY: 2.60 },\n    { x: 36.49, y: 1.58, leftHandleX: 36.23, leftHandleY: 1.97, rightHandleX: 37.27, rightHandleY: 0.53 },\n    { x: 38.9, y: 0, leftHandleX: 38.1, leftHandleY: 0, rightHandleX: 39.7, rightHandleY: 0 },\n  ],\n  lateralCanthalTilt: [\n    { x: -4.5, y: 0, leftHandleX: -5.5, leftHandleY: 0, rightHandleX: -3.5, rightHandleY: 0 },\n    { x: 0.5, y: 1.2, leftHandleX: -0.8, leftHandleY: 0.4, rightHandleX: 1.5, rightHandleY: 1.8 },\n    { x: 2.8, y: 3.5, leftHandleX: 2.2, leftHandleY: 2.5, rightHandleX: 3.4, rightHandleY: 4.3 },\n    { x: 4.5, y: 6.8, leftHandleX: 4.0, leftHandleY: 5.5, rightHandleX: 5.0, rightHandleY: 7.8 },\n    { x: 5.8, y: 9.2, leftHandleX: 5.4, leftHandleY: 8.5, rightHandleX: 5.95, rightHandleY: 9.7 },\n    { x: 6.1, y: 10, leftHandleX: 6.05, leftHandleY: 10, rightHandleX: 6.15, rightHandleY: 10, fixed: true },\n    { x: 7.8, y: 10, leftHandleX: 7.75, leftHandleY: 10, rightHandleX: 7.85, rightHandleY: 10, fixed: true },\n    { x: 8.1, y: 9.2, leftHandleX: 7.95, leftHandleY: 9.7, rightHandleX: 8.5, rightHandleY: 8.5 },\n    { x: 9.4, y: 6.8, leftHandleX: 8.9, leftHandleY: 7.8, rightHandleX: 9.9, rightHandleY: 5.5 },\n    { x: 11.1, y: 3.5, leftHandleX: 10.5, leftHandleY: 4.3, rightHandleX: 11.7, rightHandleY: 2.5 },\n    { x: 13.4, y: 1.2, leftHandleX: 12.4, leftHandleY: 1.8, rightHandleX: 14.7, rightHandleY: 0.4 },\n    { x: 18.4, y: 0, leftHandleX: 17.4, leftHandleY: 0, rightHandleX: 19.4, rightHandleY: 0 },\n  ],\n  gonialAngle: [\n    { x: 105, y: 0, leftHandleX: 102, leftHandleY: 0, rightHandleX: 108, rightHandleY: 0 },\n    { x: 112, y: 1.5, leftHandleX: 110, leftHandleY: 0.5, rightHandleX: 114, rightHandleY: 2.3 },\n    { x: 116, y: 4.2, leftHandleX: 114.5, leftHandleY: 3.0, rightHandleX: 117.5, rightHandleY: 5.2 },\n    { x: 118.5, y: 7.5, leftHandleX: 117.5, leftHandleY: 6.3, rightHandleX: 119.5, rightHandleY: 8.5 },\n    { x: 120, y: 10, leftHandleX: 119.7, leftHandleY: 10, rightHandleX: 120.3, rightHandleY: 10, fixed: true },\n    { x: 130, y: 10, leftHandleX: 129.7, leftHandleY: 10, rightHandleX: 130.3, rightHandleY: 10, fixed: true },\n    { x: 131.5, y: 7.5, leftHandleX: 130.5, leftHandleY: 8.5, rightHandleX: 132.5, rightHandleY: 6.3 },\n    { x: 134, y: 4.2, leftHandleX: 132.5, leftHandleY: 5.2, rightHandleX: 135.5, rightHandleY: 3.0 },\n    { x: 138, y: 1.5, leftHandleX: 136, leftHandleY: 2.3, rightHandleX: 140, rightHandleY: 0.5 },\n    { x: 145, y: 0, leftHandleX: 142, leftHandleY: 0, rightHandleX: 148, rightHandleY: 0 },\n  ],\n  nasolabialAngle: [\n    { x: 75, y: 0, leftHandleX: 72, leftHandleY: 0, rightHandleX: 78, rightHandleY: 0 },\n    { x: 82, y: 2.0, leftHandleX: 79.5, leftHandleY: 0.7, rightHandleX: 84, rightHandleY: 3.0 },\n    { x: 86, y: 5.5, leftHandleX: 84.5, leftHandleY: 4.2, rightHandleX: 87.5, rightHandleY: 6.8 },\n    { x: 89, y: 8.8, leftHandleX: 88, leftHandleY: 7.8, rightHandleX: 89.7, rightHandleY: 9.5 },\n    { x: 90, y: 10, leftHandleX: 89.8, leftHandleY: 10, rightHandleX: 90.2, rightHandleY: 10, fixed: true },\n    { x: 105, y: 10, leftHandleX: 104.8, leftHandleY: 10, rightHandleX: 105.2, rightHandleY: 10, fixed: true },\n    { x: 106, y: 8.8, leftHandleX: 105.3, leftHandleY: 9.5, rightHandleX: 107, rightHandleY: 7.8 },\n    { x: 109, y: 5.5, leftHandleX: 107.5, leftHandleY: 6.8, rightHandleX: 110.5, rightHandleY: 4.2 },\n    { x: 113, y: 2.0, leftHandleX: 111, leftHandleY: 3.0, rightHandleX: 115.5, rightHandleY: 0.7 },\n    { x: 120, y: 0, leftHandleX: 117, leftHandleY: 0, rightHandleX: 123, rightHandleY: 0 },\n  ],\n  // Middle Third Proportion curve (ideal: 31.4-33.4%)\n  middleThirdProportion: [\n    { x: 21.44, y: 0, leftHandleX: 20.29, leftHandleY: 0, rightHandleX: 23.19, rightHandleY: 0.15 },\n    { x: 25.5, y: 1.35, leftHandleX: 24.18, leftHandleY: 0.53, rightHandleX: 26.17, rightHandleY: 1.79 },\n    { x: 27.34, y: 3.18, leftHandleX: 26.84, leftHandleY: 2.42, rightHandleX: 27.73, rightHandleY: 3.81 },\n    { x: 28.65, y: 5.88, leftHandleX: 28.33, leftHandleY: 4.91, rightHandleX: 28.98, rightHandleY: 6.65 },\n    { x: 29.95, y: 8.55, leftHandleX: 29.41, leftHandleY: 7.58, rightHandleX: 30.45, rightHandleY: 9.35 },\n    { x: 31.4, y: 10, leftHandleX: 31.3, leftHandleY: 10, rightHandleX: 31.5, rightHandleY: 10, fixed: true },\n    { x: 33.4, y: 10, leftHandleX: 33.3, leftHandleY: 10, rightHandleX: 33.5, rightHandleY: 10, fixed: true },\n    { x: 34.85, y: 8.55, leftHandleX: 34.35, leftHandleY: 9.35, rightHandleX: 35.39, rightHandleY: 7.58 },\n    { x: 36.15, y: 5.88, leftHandleX: 35.82, leftHandleY: 6.65, rightHandleX: 36.47, rightHandleY: 4.91 },\n    { x: 37.46, y: 3.18, leftHandleX: 37.07, leftHandleY: 3.81, rightHandleX: 37.96, rightHandleY: 2.42 },\n    { x: 39.3, y: 1.35, leftHandleX: 38.63, leftHandleY: 1.79, rightHandleX: 40.62, rightHandleY: 0.53 },\n    { x: 43.36, y: 0, leftHandleX: 41.61, leftHandleY: 0.15, rightHandleX: 44.51, rightHandleY: 0 },\n  ],\n  // Upper Third Proportion curve (ideal: 30-32%)\n  upperThirdProportion: [\n    { x: 18.75, y: 0.02, leftHandleX: 17.15, leftHandleY: 0.02, rightHandleX: 20.35, rightHandleY: 0.02 },\n    { x: 23.82, y: 1.52, leftHandleX: 22.35, leftHandleY: 0.8, rightHandleX: 24.73, rightHandleY: 2.06 },\n    { x: 26.05, y: 4.06, leftHandleX: 25.48, leftHandleY: 2.86, rightHandleX: 26.41, rightHandleY: 4.99 },\n    { x: 27.19, y: 6.79, leftHandleX: 26.96, leftHandleY: 6.16, rightHandleX: 27.66, rightHandleY: 7.85 },\n    { x: 28.54, y: 9.08, leftHandleX: 28.02, leftHandleY: 8.5, rightHandleX: 28.93, rightHandleY: 9.54 },\n    { x: 30, y: 10, leftHandleX: 29.9, leftHandleY: 10, rightHandleX: 30.1, rightHandleY: 10, fixed: true },\n    { x: 32, y: 10, leftHandleX: 31.9, leftHandleY: 10, rightHandleX: 32.1, rightHandleY: 10, fixed: true },\n    { x: 33.46, y: 9.08, leftHandleX: 33.07, leftHandleY: 9.54, rightHandleX: 33.98, rightHandleY: 8.5 },\n    { x: 34.81, y: 6.79, leftHandleX: 34.34, leftHandleY: 7.85, rightHandleX: 35.04, rightHandleY: 6.16 },\n    { x: 35.95, y: 4.06, leftHandleX: 35.59, leftHandleY: 4.99, rightHandleX: 36.52, rightHandleY: 2.86 },\n    { x: 38.18, y: 1.52, leftHandleX: 37.27, leftHandleY: 2.06, rightHandleX: 39.65, rightHandleY: 0.8 },\n    { x: 43.25, y: 0.02, leftHandleX: 41.65, leftHandleY: 0.02, rightHandleX: 44.85, rightHandleY: 0.02 },\n  ],\n  // Eye Separation Ratio curve (ideal: 45.7-46.8%)\n  eyeSeparationRatio: [\n    { x: 36.54, y: 0, leftHandleX: 35.44, leftHandleY: 0, rightHandleX: 37.40, rightHandleY: 0.04 },\n    { x: 39.04, y: 0.63, leftHandleX: 38.16, leftHandleY: 0.21, rightHandleX: 39.77, rightHandleY: 1.05 },\n    { x: 41.08, y: 2.17, leftHandleX: 40.57, leftHandleY: 1.71, rightHandleX: 41.62, rightHandleY: 2.76 },\n    { x: 42.71, y: 4.74, leftHandleX: 42.26, leftHandleY: 3.81, rightHandleX: 43.08, rightHandleY: 5.52 },\n    { x: 43.94, y: 7.37, leftHandleX: 43.65, leftHandleY: 6.79, rightHandleX: 44.17, rightHandleY: 7.77 },\n    { x: 44.86, y: 9.02, leftHandleX: 44.54, leftHandleY: 8.56, rightHandleX: 45.08, rightHandleY: 9.5 },\n    { x: 45.7, y: 10, leftHandleX: 45.65, leftHandleY: 10, rightHandleX: 45.76, rightHandleY: 10, fixed: true },\n    { x: 46.8, y: 10, leftHandleX: 46.75, leftHandleY: 10, rightHandleX: 46.86, rightHandleY: 10, fixed: true },\n    { x: 47.64, y: 9.02, leftHandleX: 47.42, leftHandleY: 9.5, rightHandleX: 47.96, rightHandleY: 8.56 },\n    { x: 48.56, y: 7.37, leftHandleX: 48.33, leftHandleY: 7.77, rightHandleX: 48.85, rightHandleY: 6.79 },\n    { x: 49.79, y: 4.74, leftHandleX: 49.42, leftHandleY: 5.52, rightHandleX: 50.24, rightHandleY: 3.81 },\n    { x: 51.42, y: 2.17, leftHandleX: 50.88, leftHandleY: 2.76, rightHandleX: 51.93, rightHandleY: 1.71 },\n    { x: 53.46, y: 0.63, leftHandleX: 52.73, leftHandleY: 1.05, rightHandleX: 54.34, rightHandleY: 0.21 },\n    { x: 55.96, y: 0, leftHandleX: 55.10, leftHandleY: 0.04, rightHandleX: 57.06, rightHandleY: 0 },\n  ],\n  // Eyebrow Low Setedness curve (ideal: 0-0.45)\n  eyebrowLowSetedness: [\n    { x: -2.78, y: 0, leftHandleX: -3.11, leftHandleY: 0, rightHandleX: -2.67, rightHandleY: 0 },\n    { x: -1.94, y: 0.4, leftHandleX: -2.08, leftHandleY: 0.11, rightHandleX: -1.81, rightHandleY: 0.57 },\n    { x: -1.18, y: 2.25, leftHandleX: -1.36, leftHandleY: 1.5, rightHandleX: -1.05, rightHandleY: 2.72 },\n    { x: -0.79, y: 4.06, leftHandleX: -0.88, leftHandleY: 3.43, rightHandleX: -0.68, rightHandleY: 4.84 },\n    { x: -0.55, y: 6.21, leftHandleX: -0.58, leftHandleY: 5.55, rightHandleX: -0.47, rightHandleY: 6.92 },\n    { x: -0.28, y: 8.76, leftHandleX: -0.37, leftHandleY: 8.23, rightHandleX: -0.23, rightHandleY: 9.22 },\n    { x: 0, y: 10, leftHandleX: -0.02, leftHandleY: 10, rightHandleX: 0.02, rightHandleY: 10, fixed: true },\n    { x: 0.45, y: 10, leftHandleX: 0.43, leftHandleY: 10, rightHandleX: 0.47, rightHandleY: 10, fixed: true },\n    { x: 0.73, y: 8.76, leftHandleX: 0.68, leftHandleY: 9.22, rightHandleX: 0.82, rightHandleY: 8.23 },\n    { x: 1, y: 6.21, leftHandleX: 0.92, leftHandleY: 6.92, rightHandleX: 1.03, rightHandleY: 5.55 },\n    { x: 1.24, y: 4.06, leftHandleX: 1.13, leftHandleY: 4.84, rightHandleX: 1.33, rightHandleY: 3.43 },\n    { x: 1.63, y: 2.25, leftHandleX: 1.50, leftHandleY: 2.72, rightHandleX: 1.81, rightHandleY: 1.5 },\n    { x: 2.39, y: 0.4, leftHandleX: 2.26, leftHandleY: 0.57, rightHandleX: 2.53, rightHandleY: 0.11 },\n    { x: 3.23, y: 0, leftHandleX: 3.12, leftHandleY: 0, rightHandleX: 3.56, rightHandleY: 0 },\n  ],\n  // Submental Cervical Angle curve (ideal: 94-106Â°)\n  submentalCervicalAngle: [\n    { x: 50.48, y: 0, leftHandleX: 44.48, leftHandleY: 0, rightHandleX: 56.48, rightHandleY: 0 },\n    { x: 68.31, y: 1.31, leftHandleX: 62.07, leftHandleY: 0.32, rightHandleX: 72.89, rightHandleY: 2.13 },\n    { x: 77.76, y: 3.71, leftHandleX: 76.00, leftHandleY: 2.89, rightHandleX: 80.39, rightHandleY: 4.59 },\n    { x: 83.99, y: 6.53, leftHandleX: 82.63, leftHandleY: 5.85, rightHandleX: 85.16, rightHandleY: 7.12 },\n    { x: 88.28, y: 8.86, leftHandleX: 86.43, leftHandleY: 7.85, rightHandleX: 89.95, rightHandleY: 9.71 },\n    { x: 94, y: 10, leftHandleX: 93.4, leftHandleY: 10, rightHandleX: 94.6, rightHandleY: 10, fixed: true },\n    { x: 106, y: 10, leftHandleX: 105.4, leftHandleY: 10, rightHandleX: 106.6, rightHandleY: 10, fixed: true },\n    { x: 111.72, y: 8.86, leftHandleX: 110.05, leftHandleY: 9.71, rightHandleX: 113.57, rightHandleY: 7.85 },\n    { x: 116.01, y: 6.53, leftHandleX: 114.84, leftHandleY: 7.12, rightHandleX: 117.37, rightHandleY: 5.85 },\n    { x: 122.24, y: 3.71, leftHandleX: 119.61, leftHandleY: 4.59, rightHandleX: 124.00, rightHandleY: 2.89 },\n    { x: 131.69, y: 1.31, leftHandleX: 127.11, leftHandleY: 2.13, rightHandleX: 137.93, rightHandleY: 0.32 },\n    { x: 149.52, y: 0, leftHandleX: 143.52, leftHandleY: 0, rightHandleX: 155.52, rightHandleY: 0 },\n  ],\n  // Facial Convexity (Glabella) curve (ideal: 169-174Â°)\n  facialConvexityGlabella: [\n    { x: 149.21, y: 0, leftHandleX: 146.21, leftHandleY: 0, rightHandleX: 152.21, rightHandleY: 0 },\n    { x: 158.07, y: 1.41, leftHandleX: 156.03, leftHandleY: 0.74, rightHandleX: 159.63, rightHandleY: 2 },\n    { x: 162.12, y: 4.09, leftHandleX: 161.34, leftHandleY: 3.31, rightHandleX: 163.09, rightHandleY: 5.03 },\n    { x: 165.14, y: 7.76, leftHandleX: 164.46, leftHandleY: 6.56, rightHandleX: 165.54, rightHandleY: 8.29 },\n    { x: 166.65, y: 9.14, leftHandleX: 165.92, leftHandleY: 8.72, rightHandleX: 167.43, rightHandleY: 9.67 },\n    { x: 169, y: 10, leftHandleX: 168.75, leftHandleY: 10, rightHandleX: 169.25, rightHandleY: 10, fixed: true },\n    { x: 174, y: 10, leftHandleX: 173.75, leftHandleY: 10, rightHandleX: 174.25, rightHandleY: 10, fixed: true },\n    { x: 176.35, y: 9.14, leftHandleX: 175.57, leftHandleY: 9.67, rightHandleX: 177.08, rightHandleY: 8.72 },\n    { x: 177.86, y: 7.76, leftHandleX: 177.46, leftHandleY: 8.29, rightHandleX: 178.54, rightHandleY: 6.56 },\n    { x: 180.88, y: 4.09, leftHandleX: 179.91, leftHandleY: 5.03, rightHandleX: 181.66, rightHandleY: 3.31 },\n    { x: 184.93, y: 1.41, leftHandleX: 183.37, leftHandleY: 2, rightHandleX: 186.97, rightHandleY: 0.74 },\n    { x: 193.79, y: 0, leftHandleX: 190.79, leftHandleY: 0, rightHandleX: 196.79, rightHandleY: 0 },\n  ],\n};\n\n// ============================================\n// CATEGORY DEFINITIONS\n// ============================================\n\nexport const MEASUREMENT_CATEGORIES = {\n  'Midface/Face Shape': { color: '#67e8f9', weight: 0.20 },\n  'Occlusion/Jaw Growth': { color: '#a78bfa', weight: 0.15 },\n  'Jaw Shape': { color: '#f97316', weight: 0.13 },\n  'Upper Third': { color: '#84cc16', weight: 0.08 },\n  'Eyes': { color: '#06b6d4', weight: 0.12 },\n  'Nose': { color: '#fbbf24', weight: 0.10 },\n  'Lips': { color: '#ec4899', weight: 0.10 },\n  'Chin': { color: '#ef4444', weight: 0.06 },\n  'Neck': { color: '#14b8a6', weight: 0.03 },\n  'Other': { color: '#6b7280', weight: 0.03 },\n};\n\n// ============================================\n// CORE SCORING FUNCTIONS\n// ============================================\n\n/**\n * FaceIQ Exponential Decay Scoring Algorithm with Directional/Dimorphic Support\n *\n * Standard: score = maxScore Ã— e^(-decayRate Ã— deviation)\n *\n * Directional scoring (polarity):\n * - 'higher_is_better': Values above safeFloor but below ideal get softZoneScore\n *   Example: Canthal Tilt of 3Â° is still positive/good, just not peak ideal (6-8Â°)\n * - 'lower_is_better': Values below safeCeiling but above ideal get softZoneScore\n *   Example: Short philtrum is still attractive even if shorter than \"ideal\"\n */\nexport function calculateFaceIQScore(\n  value: number,\n  config: MetricConfig\n): number {\n  const {\n    idealMin,\n    idealMax,\n    decayRate,\n    maxScore,\n    customCurve,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n    softZoneScore = 8.0, // Default \"Good\" score for acceptable-but-not-ideal values\n  } = config;\n\n  // Use custom curve if available\n  if (customCurve && customCurve.mode === 'custom') {\n    return interpolateCustomCurve(value, customCurve.points, maxScore);\n  }\n\n  // Perfect score within ideal range\n  if (value >= idealMin && value <= idealMax) {\n    return maxScore;\n  }\n\n  // Handle directional/dimorphic scoring\n  if (polarity === 'higher_is_better' && safeFloor !== undefined) {\n    // Higher values are good. Only values below safeFloor are true weaknesses.\n    if (value >= safeFloor && value < idealMin) {\n      // Value is in the \"acceptable but not ideal\" zone\n      // Give a passing score that decreases linearly as we approach the floor\n      const zoneRange = idealMin - safeFloor;\n      const distanceFromIdeal = idealMin - value;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMin â†’ maxScore, safeFloor â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value >= idealMax) {\n      // Values above ideal are still excellent for 'higher_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = value - idealMax;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Below safeFloor - apply normal (or harsher) exponential decay\n    if (value < safeFloor) {\n      const deviation = safeFloor - value;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  if (polarity === 'lower_is_better' && safeCeiling !== undefined) {\n    // Lower values are good. Only values above safeCeiling are true weaknesses.\n    if (value <= safeCeiling && value > idealMax) {\n      // Value is in the \"acceptable but not ideal\" zone\n      const zoneRange = safeCeiling - idealMax;\n      const distanceFromIdeal = value - idealMax;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMax â†’ maxScore, safeCeiling â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value <= idealMin) {\n      // Values below ideal are still excellent for 'lower_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = idealMin - value;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Above safeCeiling - apply normal exponential decay\n    if (value > safeCeiling) {\n      const deviation = value - safeCeiling;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  // Default balanced scoring: deviation in either direction is equally bad\n  const deviation = value < idealMin\n    ? idealMin - value\n    : value - idealMax;\n\n  // Exponential decay\n  const score = maxScore * Math.exp(-decayRate * deviation);\n\n  return Math.max(0, Math.min(maxScore, score));\n}\n\n/**\n * Check if a metric value is in an \"acceptable\" zone (not a true weakness).\n * Used by InsightsEngine to prevent false positives.\n */\nexport function isValueAcceptable(\n  value: number,\n  config: MetricConfig\n): { acceptable: boolean; reason: string } {\n  const {\n    idealMin,\n    idealMax,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n  } = config;\n\n  // Within ideal range is always acceptable\n  if (value >= idealMin && value <= idealMax) {\n    return { acceptable: true, reason: 'within_ideal' };\n  }\n\n  // Check directional acceptability\n  if (polarity === 'higher_is_better') {\n    if (value >= idealMax) {\n      return { acceptable: true, reason: 'above_ideal_higher_is_better' };\n    }\n    if (safeFloor !== undefined && value >= safeFloor) {\n      return { acceptable: true, reason: 'above_safe_floor' };\n    }\n    // Below safe floor - true weakness\n    return { acceptable: false, reason: 'below_safe_floor' };\n  }\n\n  if (polarity === 'lower_is_better') {\n    if (value <= idealMin) {\n      return { acceptable: true, reason: 'below_ideal_lower_is_better' };\n    }\n    if (safeCeiling !== undefined && value <= safeCeiling) {\n      return { acceptable: true, reason: 'below_safe_ceiling' };\n    }\n    // Above safe ceiling - true weakness\n    return { acceptable: false, reason: 'above_safe_ceiling' };\n  }\n\n  // Balanced polarity - outside ideal is not acceptable\n  return { acceptable: false, reason: 'outside_ideal_balanced' };\n}\n\n/**\n * Interpolate custom Bezier curve for scoring\n * Uses cubic Bezier interpolation with control handles for smooth curves\n */\nfunction interpolateCustomCurve(\n  value: number,\n  points: CurvePoint[],\n  maxScore: number\n): number {\n  void maxScore; // Reserved for future custom curve implementations\n  if (points.length === 0) return 0;\n\n  // Sort points by x value\n  const sortedPoints = [...points].sort((a, b) => a.x - b.x);\n\n  // Clamp to range\n  if (value <= sortedPoints[0].x) return sortedPoints[0].y;\n  if (value >= sortedPoints[sortedPoints.length - 1].x) {\n    return sortedPoints[sortedPoints.length - 1].y;\n  }\n\n  // Find bracketing points\n  let lowerIndex = 0;\n  for (let i = 0; i < sortedPoints.length - 1; i++) {\n    if (value >= sortedPoints[i].x && value <= sortedPoints[i + 1].x) {\n      lowerIndex = i;\n      break;\n    }\n  }\n\n  const p0 = sortedPoints[lowerIndex];\n  const p3 = sortedPoints[lowerIndex + 1];\n\n  // Check if we have Bezier control handles\n  const hasHandles = p0.rightHandleX !== undefined && p3.leftHandleX !== undefined;\n\n  if (hasHandles) {\n    // Cubic Bezier interpolation with control points\n    const p1x = p0.rightHandleX!;\n    const p1y = p0.rightHandleY ?? p0.y;\n    const p2x = p3.leftHandleX!;\n    const p2y = p3.leftHandleY ?? p3.y;\n\n    // Find t parameter for given x value using Newton-Raphson iteration\n    let t = (value - p0.x) / (p3.x - p0.x); // Initial guess\n\n    // Newton-Raphson iterations to find t where B_x(t) = value\n    for (let iter = 0; iter < 10; iter++) {\n      const bx = cubicBezier(p0.x, p1x, p2x, p3.x, t);\n      const bxDerivative = cubicBezierDerivative(p0.x, p1x, p2x, p3.x, t);\n\n      if (Math.abs(bxDerivative) < 1e-10) break;\n\n      const newT = t - (bx - value) / bxDerivative;\n      if (Math.abs(newT - t) < 1e-10) break;\n      t = Math.max(0, Math.min(1, newT));\n    }\n\n    // Calculate y using the found t parameter\n    return cubicBezier(p0.y, p1y, p2y, p3.y, t);\n  } else {\n    // Smooth interpolation using Catmull-Rom spline\n    // This provides smoother curves than linear interpolation\n    const t = (value - p0.x) / (p3.x - p0.x);\n\n    // Get neighboring points for spline calculation\n    const pMinus1 = lowerIndex > 0 ? sortedPoints[lowerIndex - 1] : p0;\n    const p4 = lowerIndex + 2 < sortedPoints.length ? sortedPoints[lowerIndex + 2] : p3;\n\n    // Catmull-Rom spline interpolation\n    return catmullRomSpline(pMinus1.y, p0.y, p3.y, p4.y, t);\n  }\n}\n\n/**\n * Cubic Bezier curve evaluation: B(t) = (1-t)Â³P0 + 3(1-t)Â²tP1 + 3(1-t)tÂ²P2 + tÂ³P3\n */\nfunction cubicBezier(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  const mt2 = mt * mt;\n  const mt3 = mt2 * mt;\n  const t2 = t * t;\n  const t3 = t2 * t;\n  return mt3 * p0 + 3 * mt2 * t * p1 + 3 * mt * t2 * p2 + t3 * p3;\n}\n\n/**\n * Cubic Bezier derivative: B'(t) = 3(1-t)Â²(P1-P0) + 6(1-t)t(P2-P1) + 3tÂ²(P3-P2)\n */\nfunction cubicBezierDerivative(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  return 3 * mt * mt * (p1 - p0) + 6 * mt * t * (p2 - p1) + 3 * t * t * (p3 - p2);\n}\n\n/**\n * Catmull-Rom spline interpolation for smooth curves without explicit handles\n */\nfunction catmullRomSpline(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const t2 = t * t;\n  const t3 = t2 * t;\n\n  // Catmull-Rom coefficients with tension = 0.5\n  const a = -0.5 * p0 + 1.5 * p1 - 1.5 * p2 + 0.5 * p3;\n  const b = p0 - 2.5 * p1 + 2 * p2 - 0.5 * p3;\n  const c = -0.5 * p0 + 0.5 * p2;\n  const d = p1;\n\n  return a * t3 + b * t2 + c * t + d;\n}\n\n/**\n * Calculate standardized score (0-10 normalized)\n */\nexport function standardizeScore(score: number, maxScore: number): number {\n  return (score / maxScore) * 10;\n}\n\n/**\n * Determine quality tier based on score\n */\nexport function getQualityTier(score: number, maxScore: number = 10): QualityTier {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 90) return 'ideal';\n  if (normalized >= 70) return 'excellent';\n  if (normalized >= 50) return 'good';\n  return 'below_average';\n}\n\n/**\n * Determine severity level based on score\n */\nexport function getSeverityLevel(score: number, maxScore: number = 10): SeverityLevel {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 85) return 'optimal';\n  if (normalized >= 70) return 'minor';\n  if (normalized >= 50) return 'moderate';\n  if (normalized >= 30) return 'major';\n  if (normalized >= 15) return 'severe';\n  return 'extremely_severe';\n}\n\n/**\n * Calculate deviation description\n */\nexport function getDeviationDescription(\n  value: number,\n  idealMin: number,\n  idealMax: number,\n  unit: MeasurementUnit\n): { deviation: number; direction: 'above' | 'below' | 'within'; description: string } {\n  if (value >= idealMin && value <= idealMax) {\n    return { deviation: 0, direction: 'within', description: 'within ideal range' };\n  }\n\n  const unitLabel = getUnitLabel(unit);\n\n  if (value < idealMin) {\n    const dev = idealMin - value;\n    return {\n      deviation: dev,\n      direction: 'below',\n      description: `${dev.toFixed(2)}${unitLabel} below ideal`,\n    };\n  }\n\n  const dev = value - idealMax;\n  return {\n    deviation: dev,\n    direction: 'above',\n    description: `${dev.toFixed(2)}${unitLabel} above ideal`,\n  };\n}\n\nfunction getUnitLabel(unit: MeasurementUnit): string {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return 'Â°';\n    case 'mm': return 'mm';\n    default: return '';\n  }\n}\n\n// ============================================\n// MEASUREMENT CALCULATION UTILITIES\n// ============================================\n\n/**\n * Calculate distance between two points\n */\nexport function distance(p1: Point, p2: Point): number {\n  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n}\n\n/**\n * Calculate angle at vertex point (in degrees)\n */\nexport function calculateAngle(p1: Point, vertex: Point, p2: Point): number {\n  const v1 = { x: p1.x - vertex.x, y: p1.y - vertex.y };\n  const v2 = { x: p2.x - vertex.x, y: p2.y - vertex.y };\n\n  const dot = v1.x * v2.x + v1.y * v2.y;\n  const cross = v1.x * v2.y - v1.y * v2.x;\n\n  const angle = Math.atan2(cross, dot) * (180 / Math.PI);\n  return Math.abs(angle);\n}\n\n/**\n * Calculate perpendicular distance from point to line (signed)\n */\nexport function perpendicularDistance(\n  point: Point,\n  lineStart: Point,\n  lineEnd: Point\n): number {\n  const A = point.x - lineStart.x;\n  const B = point.y - lineStart.y;\n  const C = lineEnd.x - lineStart.x;\n  const D = lineEnd.y - lineStart.y;\n\n  const dot = A * C + B * D;\n  const lenSq = C * C + D * D;\n  const param = lenSq !== 0 ? dot / lenSq : -1;\n\n  let xx: number, yy: number;\n\n  if (param < 0) {\n    xx = lineStart.x;\n    yy = lineStart.y;\n  } else if (param > 1) {\n    xx = lineEnd.x;\n    yy = lineEnd.y;\n  } else {\n    xx = lineStart.x + param * C;\n    yy = lineStart.y + param * D;\n  }\n\n  const dx = point.x - xx;\n  const dy = point.y - yy;\n\n  const sign =\n    (lineEnd.y - lineStart.y) * point.x -\n      (lineEnd.x - lineStart.x) * point.y +\n      lineEnd.x * lineStart.y -\n      lineEnd.y * lineStart.x >=\n    0\n      ? 1\n      : -1;\n\n  return sign * Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Helper to get landmark by ID\n */\nfunction getLandmark(landmarks: LandmarkPoint[], id: string): Point | null {\n  const lm = landmarks.find((l) => l.id === id);\n  return lm ? { x: lm.x, y: lm.y } : null;\n}\n\n// ============================================\n// SCORE A SINGLE MEASUREMENT\n// ============================================\n\nexport interface DemographicOptions {\n  gender?: Gender;\n  ethnicity?: Ethnicity;\n}\n\n/**\n * Calculate complete score result for a measurement.\n * If demographics provided, uses demographic-specific ideal ranges.\n */\nexport function scoreMeasurement(\n  metricId: string,\n  value: number,\n  demographics?: DemographicOptions\n): FaceIQScoreResult | null {\n  // Get config with demographic overrides if provided\n  const config = demographics?.gender\n    ? getMetricConfigForDemographics(metricId, demographics.gender, demographics.ethnicity || 'other')\n    : FACEIQ_METRICS[metricId];\n\n  if (!config) return null;\n\n  const score = calculateFaceIQScore(value, config);\n  const standardizedScore = standardizeScore(score, config.maxScore);\n  const qualityTier = getQualityTier(score, config.maxScore);\n  const severity = getSeverityLevel(score, config.maxScore);\n  const { deviation, direction } = getDeviationDescription(\n    value,\n    config.idealMin,\n    config.idealMax,\n    config.unit\n  );\n\n  return {\n    metricId,\n    name: config.name,\n    value,\n    score,\n    standardizedScore,\n    qualityTier,\n    severity,\n    idealMin: config.idealMin,\n    idealMax: config.idealMax,\n    deviation,\n    deviationDirection: direction,\n    unit: config.unit,\n    category: config.category,\n  };\n}\n\n// ============================================\n// FRONT PROFILE ANALYSIS\n// ============================================\n\nexport interface FrontProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all front profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeFrontProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): FrontProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  // Helper to add measurement if landmarks available\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const trichion = getLandmark(landmarks, 'trichion');\n  const nasalBase = getLandmark(landmarks, 'nasal_base');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const menton = getLandmark(landmarks, 'menton');\n  const leftZygion = getLandmark(landmarks, 'left_zygion');\n  const rightZygion = getLandmark(landmarks, 'right_zygion');\n  const leftGonion = getLandmark(landmarks, 'left_gonion_inferior');\n  const rightGonion = getLandmark(landmarks, 'right_gonion_inferior');\n  const leftPupil = getLandmark(landmarks, 'left_pupila');\n  const rightPupil = getLandmark(landmarks, 'right_pupila');\n  const leftCanthusM = getLandmark(landmarks, 'left_canthus_medialis');\n  const leftCanthusL = getLandmark(landmarks, 'left_canthus_lateralis');\n  const rightCanthusM = getLandmark(landmarks, 'right_canthus_medialis');\n  const rightCanthusL = getLandmark(landmarks, 'right_canthus_lateralis');\n  void rightCanthusL; // Will be used for asymmetry measurements\n  const leftAlaNasi = getLandmark(landmarks, 'left_ala_nasi');\n  const rightAlaNasi = getLandmark(landmarks, 'right_ala_nasi');\n  const leftCheilion = getLandmark(landmarks, 'left_cheilion');\n  const rightCheilion = getLandmark(landmarks, 'right_cheilion');\n  const labraleSuperius = getLandmark(landmarks, 'labrale_superius');\n  const labraleInferius = getLandmark(landmarks, 'labrale_inferius');\n\n  // FACIAL THIRDS\n  if (trichion && nasalBase && subnasale && menton) {\n    const totalHeight = distance(trichion, menton);\n    if (totalHeight > 0) {\n      const upperThird = (distance(trichion, nasalBase) / totalHeight) * 100;\n      const middleThird = (distance(nasalBase, subnasale) / totalHeight) * 100;\n      const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n\n      addMeasurement('upperThirdProportion', upperThird);\n      addMeasurement('middleThirdProportion', middleThird);\n      addMeasurement('lowerThirdProportion', lowerThird);\n    }\n  }\n\n  // FACE WIDTH TO HEIGHT RATIO (FWHR)\n  if (leftZygion && rightZygion && nasalBase && labraleSuperius) {\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    const upperFaceHeight = distance(nasalBase, labraleSuperius);\n    if (upperFaceHeight > 0) {\n      addMeasurement('faceWidthToHeight', bizygomaticWidth / upperFaceHeight);\n    }\n  }\n\n  // TOTAL FACIAL WIDTH TO HEIGHT\n  if (leftZygion && rightZygion && trichion && menton) {\n    const cheekWidth = distance(leftZygion, rightZygion);\n    const totalHeight = distance(trichion, menton);\n    if (cheekWidth > 0) {\n      addMeasurement('totalFacialWidthToHeight', totalHeight / cheekWidth);\n    }\n  }\n\n  // JAW WIDTH RATIO\n  if (leftGonion && rightGonion && leftZygion && rightZygion) {\n    const bigonialWidth = distance(leftGonion, rightGonion);\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    if (bizygomaticWidth > 0) {\n      const ratio = bigonialWidth / bizygomaticWidth;\n      addMeasurement('jawWidthRatio', ratio);\n      addMeasurement('bigonialWidth', ratio * 100);\n    }\n  }\n\n  // CANTHAL TILT\n  if (leftCanthusM && leftCanthusL) {\n    const deltaY = leftCanthusM.y - leftCanthusL.y;\n    const deltaX = leftCanthusL.x - leftCanthusM.x;\n    const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);\n    addMeasurement('lateralCanthalTilt', angle);\n  }\n\n  // EYE ASPECT RATIO\n  if (leftCanthusM && leftCanthusL) {\n    const leftPalpSup = getLandmark(landmarks, 'left_palpebra_superior');\n    const leftPalpInf = getLandmark(landmarks, 'left_palpebra_inferior');\n    if (leftPalpSup && leftPalpInf) {\n      const eyeWidth = distance(leftCanthusM, leftCanthusL);\n      const eyeHeight = distance(leftPalpSup, leftPalpInf);\n      if (eyeWidth > 0) {\n        addMeasurement('eyeAspectRatio', eyeHeight / eyeWidth);\n      }\n    }\n  }\n\n  // EYE SEPARATION RATIO\n  if (leftCanthusM && rightCanthusM && leftZygion && rightZygion) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('eyeSeparationRatio', intercanthal / bizygomatic);\n    }\n  }\n\n  // IPD RATIO\n  if (leftPupil && rightPupil && leftZygion && rightZygion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('interpupillaryRatio', (ipd / bizygomatic) * 100);\n    }\n  }\n\n  // ONE EYE APART TEST\n  if (leftCanthusM && rightCanthusM && leftCanthusL) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const eyeWidth = distance(leftCanthusM, leftCanthusL);\n    if (eyeWidth > 0) {\n      addMeasurement('oneEyeApartTest', intercanthal / eyeWidth);\n    }\n  }\n\n  // NASAL INDEX\n  if (leftAlaNasi && rightAlaNasi && nasalBase && subnasale) {\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    const nasalHeight = distance(nasalBase, subnasale);\n    if (nasalHeight > 0) {\n      addMeasurement('nasalIndex', (nasalWidth / nasalHeight) * 100);\n    }\n  }\n\n  // INTERCANTHAL-NASAL WIDTH RATIO\n  if (leftCanthusM && rightCanthusM && leftAlaNasi && rightAlaNasi) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('intercanthalNasalRatio', intercanthal / nasalWidth);\n    }\n  }\n\n  // MOUTH TO NOSE RATIO\n  if (leftCheilion && rightCheilion && leftAlaNasi && rightAlaNasi) {\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('mouthWidthToNoseRatio', mouthWidth / nasalWidth);\n    }\n  }\n\n  // IPD TO MOUTH WIDTH RATIO\n  if (leftPupil && rightPupil && leftCheilion && rightCheilion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    if (ipd > 0) {\n      addMeasurement('interpupillaryMouthWidthRatio', mouthWidth / ipd);\n    }\n  }\n\n  // LIP RATIO\n  if (labraleSuperius && labraleInferius && subnasale) {\n    const mouthMiddle = getLandmark(landmarks, 'mouth_middle');\n    if (mouthMiddle) {\n      const upperLipHeight = distance(subnasale, labraleSuperius);\n      const lowerLipHeight = distance(mouthMiddle, labraleInferius);\n      if (upperLipHeight > 0) {\n        addMeasurement('lowerToUpperLipRatio', lowerLipHeight / upperLipHeight);\n      }\n    }\n  }\n\n  // MIDFACE RATIO\n  if (leftZygion && rightZygion && nasalBase && subnasale) {\n    const midfaceWidth = distance(leftZygion, rightZygion);\n    const midfaceHeight = distance(nasalBase, subnasale);\n    if (midfaceHeight > 0) {\n      addMeasurement('midfaceRatio', midfaceWidth / midfaceHeight / 10); // Normalized\n    }\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score (weighted average)\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n  const standardizedScore = overallScore;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// SIDE PROFILE ANALYSIS\n// ============================================\n\nexport interface SideProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all side profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeSideProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): SideProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const glabella = getLandmark(landmarks, 'glabella');\n  const nasion = getLandmark(landmarks, 'nasion');\n  const rhinion = getLandmark(landmarks, 'rhinion');\n  const pronasale = getLandmark(landmarks, 'pronasale');\n  const columella = getLandmark(landmarks, 'columella');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const labraleSuperius = getLandmark(landmarks, 'labraleSuperius');\n  const labraleInferius = getLandmark(landmarks, 'labraleInferius');\n  const sublabiale = getLandmark(landmarks, 'sublabiale');\n  const pogonion = getLandmark(landmarks, 'pogonion');\n  const menton = getLandmark(landmarks, 'menton');\n  const tragus = getLandmark(landmarks, 'tragus');\n  const gonionBottom = getLandmark(landmarks, 'gonionBottom');\n  const cervicalPoint = getLandmark(landmarks, 'cervicalPoint');\n  const orbitale = getLandmark(landmarks, 'orbitale');\n  const porion = getLandmark(landmarks, 'porion');\n\n  // GONIAL ANGLE\n  if (tragus && gonionBottom && menton) {\n    const angle = calculateAngle(tragus, gonionBottom, menton);\n    addMeasurement('gonialAngle', angle);\n  }\n\n  // NASOLABIAL ANGLE\n  if (columella && subnasale && labraleSuperius) {\n    const angle = calculateAngle(columella, subnasale, labraleSuperius);\n    addMeasurement('nasolabialAngle', angle);\n  }\n\n  // NASOFRONTAL ANGLE\n  if (glabella && nasion && rhinion) {\n    const angle = calculateAngle(glabella, nasion, rhinion);\n    addMeasurement('nasofrontalAngle', angle);\n  }\n\n  // MENTOLABIAL ANGLE\n  if (labraleInferius && sublabiale && pogonion) {\n    const angle = calculateAngle(labraleInferius, sublabiale, pogonion);\n    addMeasurement('mentolabialAngle', angle);\n  }\n\n  // E-LINE MEASUREMENTS\n  if (pronasale && pogonion && labraleSuperius && labraleInferius) {\n    const upperLipDist = perpendicularDistance(labraleSuperius, pronasale, pogonion);\n    const lowerLipDist = perpendicularDistance(labraleInferius, pronasale, pogonion);\n    addMeasurement('eLineUpperLip', upperLipDist);\n    addMeasurement('eLineLowerLip', lowerLipDist);\n  }\n\n  // NASOMENTAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    const angle = calculateAngle(nasion, pronasale, pogonion);\n    addMeasurement('nasomentaAngle', angle);\n  }\n\n  // FACIAL CONVEXITY (GLABELLA)\n  if (glabella && subnasale && pogonion) {\n    const angle = calculateAngle(glabella, subnasale, pogonion);\n    addMeasurement('facialConvexityGlabella', angle);\n  }\n\n  // FACIAL CONVEXITY (NASION)\n  if (nasion && subnasale && pogonion) {\n    const angle = calculateAngle(nasion, subnasale, pogonion);\n    addMeasurement('facialConvexityNasion', angle);\n  }\n\n  // TOTAL FACIAL CONVEXITY\n  if (glabella && pronasale && pogonion) {\n    const angle = calculateAngle(glabella, pronasale, pogonion);\n    addMeasurement('totalFacialConvexity', angle);\n  }\n\n  // SUBMENTAL CERVICAL ANGLE\n  if (menton && cervicalPoint && pogonion) {\n    const neckPoint = getLandmark(landmarks, 'neckPoint');\n    if (neckPoint) {\n      const angle = calculateAngle(pogonion, menton, neckPoint);\n      addMeasurement('submentalCervicalAngle', angle);\n    }\n  }\n\n  // NASAL PROJECTION (Goode ratio)\n  if (pronasale && subnasale && nasion) {\n    const projection = distance(pronasale, subnasale);\n    const nasalLength = distance(nasion, pronasale);\n    if (nasalLength > 0) {\n      addMeasurement('nasalProjection', projection / nasalLength);\n    }\n  }\n\n  // NASOFACIAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    // Angle between nose dorsum and facial plane\n    const nasalDorsum = { x: pronasale.x - nasion.x, y: pronasale.y - nasion.y };\n    const facialPlane = { x: pogonion.x - nasion.x, y: pogonion.y - nasion.y };\n\n    const dot = nasalDorsum.x * facialPlane.x + nasalDorsum.y * facialPlane.y;\n    const mag1 = Math.sqrt(nasalDorsum.x ** 2 + nasalDorsum.y ** 2);\n    const mag2 = Math.sqrt(facialPlane.x ** 2 + facialPlane.y ** 2);\n\n    if (mag1 > 0 && mag2 > 0) {\n      const angle = Math.acos(dot / (mag1 * mag2)) * (180 / Math.PI);\n      addMeasurement('nasofacialAngle', angle);\n    }\n  }\n\n  // MANDIBULAR PLANE ANGLE (using Frankfort horizontal)\n  if (porion && orbitale && gonionBottom && menton) {\n    // Frankfort horizontal is porion to orbitale\n    // Mandibular plane is gonion to menton\n    const fhAngle = Math.atan2(orbitale.y - porion.y, orbitale.x - porion.x);\n    const mpAngle = Math.atan2(menton.y - gonionBottom.y, menton.x - gonionBottom.x);\n    const angle = Math.abs(fhAngle - mpAngle) * (180 / Math.PI);\n    addMeasurement('mandibularPlaneAngle', angle);\n  }\n\n  // CHIN PROJECTION\n  if (pogonion && subnasale) {\n    // Distance from pogonion to vertical line through subnasale\n    const projection = pogonion.x - subnasale.x;\n    addMeasurement('chinProjection', projection);\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// COMPLETE HARMONY ANALYSIS\n// ============================================\n\n/**\n * Run complete facial harmony analysis.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeHarmony(\n  frontLandmarks: LandmarkPoint[],\n  sideLandmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): HarmonyAnalysis {\n  const frontResults = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n  const sideResults = analyzeSideProfile(sideLandmarks, gender, ethnicity);\n\n  const allMeasurements = [...frontResults.measurements, ...sideResults.measurements];\n\n  // Combined category scores\n  const allCategories: Record<string, { total: number; count: number }> = {};\n  for (const m of allMeasurements) {\n    if (!allCategories[m.category]) {\n      allCategories[m.category] = { total: 0, count: 0 };\n    }\n    allCategories[m.category].total += m.standardizedScore;\n    allCategories[m.category].count++;\n  }\n\n  const categoryScores: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(allCategories)) {\n    categoryScores[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Overall weighted score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of allMeasurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  // Identify flaws (below average measurements)\n  const flaws: FlawAssessment[] = allMeasurements\n    .filter((m) => m.severity !== 'optimal' && m.severity !== 'minor')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      severity: m.severity,\n      deviation: `${m.deviation.toFixed(2)} ${m.deviationDirection} ideal`,\n      reasoning: `${m.name} is outside the ideal range`,\n      confidence: m.severity === 'extremely_severe' || m.severity === 'severe'\n        ? 'confirmed' as const\n        : 'likely' as const,\n    }))\n    .sort((a, b) => {\n      const severityOrder = { extremely_severe: 0, severe: 1, major: 2, moderate: 3 };\n      return (severityOrder[a.severity as keyof typeof severityOrder] ?? 4) -\n             (severityOrder[b.severity as keyof typeof severityOrder] ?? 4);\n    });\n\n  // Identify strengths (ideal measurements)\n  const strengths: StrengthAssessment[] = allMeasurements\n    .filter((m) => m.qualityTier === 'ideal' || m.qualityTier === 'excellent')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      qualityTier: m.qualityTier,\n      value: m.value,\n      reasoning: `${m.name} is within the ${m.qualityTier} range`,\n    }));\n\n  // Calculate percentile (based on population stats)\n  const percentile = calculateHarmonyPercentile(overallScore);\n\n  return {\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    percentile,\n    frontScore: frontResults.overallScore,\n    sideScore: sideResults.overallScore,\n    categoryScores,\n    measurements: allMeasurements,\n    flaws,\n    strengths,\n  };\n}\n\n/**\n * Calculate percentile from harmony score\n */\nfunction calculateHarmonyPercentile(score: number): number {\n  // Based on normal distribution with mean=5, stdDev=1.5\n  const mean = 5;\n  const stdDev = 1.5;\n  const z = (score - mean) / stdDev;\n  return normalCDF(z) * 100;\n}\n\n/**\n * Standard normal CDF approximation\n */\nfunction normalCDF(z: number): number {\n  const a1 = 0.254829592;\n  const a2 = -0.284496736;\n  const a3 = 1.421413741;\n  const a4 = -1.453152027;\n  const a5 = 1.061405429;\n  const p = 0.3275911;\n\n  const sign = z < 0 ? -1 : 1;\n  const absZ = Math.abs(z) / Math.sqrt(2);\n\n  const t = 1.0 / (1.0 + p * absZ);\n  const y = 1.0 - ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-absZ * absZ);\n\n  return 0.5 * (1.0 + sign * y);\n}\n\n// ============================================\n// PSL RATING CONVERSION\n// ============================================\n\nexport interface PSLRating {\n  score: number;\n  tier: string;\n  percentile: number;\n  description: string;\n}\n\n/**\n * Convert harmony score to PSL rating\n */\nexport function convertToPSL(harmonyScore: number): PSLRating {\n  // Convert 0-10 harmony to 3.0-7.5 PSL range\n  const psl = 3.0 + (harmonyScore / 10) * 4.5;\n  const clampedPSL = Math.max(3.0, Math.min(7.5, psl));\n\n  let tier: string;\n  let percentile: number;\n\n  if (clampedPSL >= 7.5) {\n    tier = 'Top Model';\n    percentile = 99.99;\n  } else if (clampedPSL >= 7.0) {\n    tier = 'Chad';\n    percentile = 99.87;\n  } else if (clampedPSL >= 6.5) {\n    tier = 'Chadlite';\n    percentile = 99.0;\n  } else if (clampedPSL >= 6.0) {\n    tier = 'High Tier Normie+';\n    percentile = 97.25;\n  } else if (clampedPSL >= 5.5) {\n    tier = 'High Tier Normie';\n    percentile = 90.0;\n  } else if (clampedPSL >= 5.0) {\n    tier = 'Mid Tier Normie+';\n    percentile = 84.15;\n  } else if (clampedPSL >= 4.5) {\n    tier = 'Mid Tier Normie';\n    percentile = 65.0;\n  } else if (clampedPSL >= 4.0) {\n    tier = 'Low Tier Normie';\n    percentile = 50.0;\n  } else if (clampedPSL >= 3.5) {\n    tier = 'Below Average';\n    percentile = 30.0;\n  } else {\n    tier = 'Subpar';\n    percentile = 15.0;\n  }\n\n  return {\n    score: clampedPSL,\n    tier,\n    percentile,\n    description: `${tier} (top ${(100 - percentile).toFixed(1)}%)`,\n  };\n}\n\n// ============================================\n// EXPORTS FOR BACKWARD COMPATIBILITY\n// ============================================\n\nexport type { LandmarkPoint } from './landmarks';\n","structuredPatch":[{"oldStart":347,"oldLines":8,"newStart":347,"newLines":11,"lines":[" ","   midfaceRatio: {","     // Females often have more compact midface","+    // White: Neoclassical standard - strict compact midface preference","     // Middle Eastern: Similar to White model - compact is better","-    // Extracted from FaceIQ Male:MiddleEastern.htc","+    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:MiddleEastern.htc","+    white_male: { idealMin: 0.95, idealMax: 1.02 },  // Neoclassical - penalizes long midface heavily","+    white_female: { idealMin: 0.93, idealMax: 1.00 },","     male: { idealMin: 0.98, idealMax: 1.02 },","     female: { idealMin: 0.95, idealMax: 1.00 },","     middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"70ee3b2c-86ef-4e22-be78-2ad706a27acf","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_018zczRKuDytRW45jVQTw6o7","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good! Now let me add the white_male standard for chinToPhiltrumRatio.","signature":"Eu0BCkYIChgCKkD4MvMyQCwmUrTln/zTYv5snxLJ3ZxASZytgTLO/xsHDFGYID+Krk0RdFio9xoT4Q5Tkb8oBF2Z9MgmqxBqExknEgyE6HVc/EZLjMjNHlYaDK6zziI+S2sdjnnfjCIwLSQumjT39M6kln4bmX6wAwm0UYVRo5qhHIDNj1XS2rfyBwcAuiIsDo2/AJaz8xbZKlWajrHp1EMEL4juxJ29hD1oPj/4ai1r1/7zHhQkksOcaGNfX9OSQ+m4D6HvB2vRVXwxjjfzp/rBNno7DvDV1tJt2QQdggaDcb8k1kuObdHGucWy4gPwGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":9,"cache_creation_input_tokens":1199,"cache_read_input_tokens":42298,"cache_creation":{"ephemeral_5m_input_tokens":1199,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDSCS9Htq6BV2Rc4EeX","type":"assistant","uuid":"61fda82c-a0bf-42b5-87e4-d0b26cac1f1a","timestamp":"2025-12-21T17:19:41.523Z"}
{"parentUuid":"61fda82c-a0bf-42b5-87e4-d0b26cac1f1a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_018zczRKuDytRW45jVQTw6o7","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0137cmVmuGDokfMi75bB55En","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","old_string":"  chinToPhiltrumRatio: {\n    // Black/African: Fuller lips naturally shorten visible philtrum\n    // Extracted from FaceIQ BlackAfrican.htc - relaxes \"Short Philtrum\" penalty\n    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n    black_female: { idealMin: 2.10, idealMax: 2.65 },\n  },","new_string":"  chinToPhiltrumRatio: {\n    // White: Neoclassical standard - strict balance between chin and philtrum\n    // Black/African: Fuller lips naturally shorten visible philtrum\n    // Extracted from FaceIQ Male:White.htc (Neoclassical) and BlackAfrican.htc\n    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n    white_male: { idealMin: 2.10, idealMax: 2.30 },  // Neoclassical - strict lower face balance\n    white_female: { idealMin: 2.05, idealMax: 2.25 },\n    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n    black_female: { idealMin: 2.10, idealMax: 2.65 },\n  },"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":9,"cache_creation_input_tokens":1199,"cache_read_input_tokens":42298,"cache_creation":{"ephemeral_5m_input_tokens":1199,"ephemeral_1h_input_tokens":0},"output_tokens":497,"service_tier":"standard"}},"requestId":"req_011CWLDSCS9Htq6BV2Rc4EeX","type":"assistant","uuid":"95a6aa0f-04ae-442e-93df-f14285237d1c","timestamp":"2025-12-21T17:19:47.231Z"}
{"parentUuid":"95a6aa0f-04ae-442e-93df-f14285237d1c","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0137cmVmuGDokfMi75bB55En","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   401â†’    male: { idealMin: 128, idealMax: 138 },\n   402â†’    female: { idealMin: 132, idealMax: 142 },\n   403â†’  },\n   404â†’\n   405â†’  chinToPhiltrumRatio: {\n   406â†’    // White: Neoclassical standard - strict balance between chin and philtrum\n   407â†’    // Black/African: Fuller lips naturally shorten visible philtrum\n   408â†’    // Extracted from FaceIQ Male:White.htc (Neoclassical) and BlackAfrican.htc\n   409â†’    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n   410â†’    white_male: { idealMin: 2.10, idealMax: 2.30 },  // Neoclassical - strict lower face balance\n   411â†’    white_female: { idealMin: 2.05, idealMax: 2.25 },\n   412â†’    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n   413â†’    black_female: { idealMin: 2.10, idealMax: 2.65 },\n   414â†’  },\n   415â†’\n   416â†’  // ==========================================\n   417â†’  // SKIN QUALITY - Ethnicity variation\n   418â†’  // =========================================="}]},"uuid":"23bcc6f0-a1ea-448c-b982-4af55dd138da","timestamp":"2025-12-21T17:19:47.261Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","oldString":"  chinToPhiltrumRatio: {\n    // Black/African: Fuller lips naturally shorten visible philtrum\n    // Extracted from FaceIQ BlackAfrican.htc - relaxes \"Short Philtrum\" penalty\n    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n    black_female: { idealMin: 2.10, idealMax: 2.65 },\n  },","newString":"  chinToPhiltrumRatio: {\n    // White: Neoclassical standard - strict balance between chin and philtrum\n    // Black/African: Fuller lips naturally shorten visible philtrum\n    // Extracted from FaceIQ Male:White.htc (Neoclassical) and BlackAfrican.htc\n    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n    white_male: { idealMin: 2.10, idealMax: 2.30 },  // Neoclassical - strict lower face balance\n    white_female: { idealMin: 2.05, idealMax: 2.25 },\n    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n    black_female: { idealMin: 2.10, idealMax: 2.65 },\n  },","originalFile":"/**\n * FaceIQ-Style Facial Analysis Scoring System\n * Complete replication of FaceIQ Labs scoring algorithms\n *\n * Features:\n * - Exponential decay scoring with per-metric decay rates\n * - Bezier curve custom scoring for non-linear measurements\n * - 70+ facial measurements (front + side profiles)\n * - Quality tiers: Ideal, Excellent, Good\n * - 5-tier severity: Extremely Severe, Severe, Major, Moderate, Minor\n */\n\nimport { LandmarkPoint } from './landmarks';\n\n// ============================================\n// CORE TYPES\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\n/**\n * Polarity defines how deviation from the ideal range is interpreted:\n * - 'balanced': Default. Deviation in either direction is equally bad.\n * - 'higher_is_better': Values above the ideal are still good. Only values below\n *   the 'safeFloor' are true weaknesses. E.g., Canthal Tilt (positive tilt is good)\n * - 'lower_is_better': Values below the ideal are still good. Only values above\n *   the 'safeCeiling' are true weaknesses. E.g., Philtrum length (shorter is better)\n */\nexport type MetricPolarity = 'balanced' | 'higher_is_better' | 'lower_is_better';\n\nexport interface MetricConfig {\n  id: string;\n  name: string;\n  category: string;\n  unit: MeasurementUnit;\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  decayRate: number;\n  maxScore: number;\n  weight: number;\n  description: string;\n  profileType: 'front' | 'side';\n  customCurve?: BezierCurveConfig;\n  /**\n   * Polarity for directional/dimorphic scoring.\n   * Defaults to 'balanced' if not specified.\n   */\n  polarity?: MetricPolarity;\n  /**\n   * For 'higher_is_better': minimum value that's still acceptable.\n   * Values above this but below idealMin get a passing score (softFloorScore).\n   * Values below this are true weaknesses.\n   */\n  safeFloor?: number;\n  /**\n   * For 'lower_is_better': maximum value that's still acceptable.\n   * Values below this but above idealMax get a passing score (softCeilingScore).\n   * Values above this are true weaknesses.\n   */\n  safeCeiling?: number;\n  /**\n   * Score given to values in the \"acceptable but not ideal\" zone.\n   * Defaults to 8.0 (Good). Range: 6.0-9.0\n   */\n  softZoneScore?: number;\n}\n\nexport interface BezierCurveConfig {\n  mode: 'custom' | 'exponential';\n  points: CurvePoint[];\n}\n\nexport interface CurvePoint {\n  x: number;\n  y: number;\n  leftHandleX?: number;\n  leftHandleY?: number;\n  rightHandleX?: number;\n  rightHandleY?: number;\n  fixed?: boolean;\n}\n\nexport interface FaceIQScoreResult {\n  metricId: string;\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  severity: SeverityLevel;\n  idealMin: number;\n  idealMax: number;\n  deviation: number;\n  deviationDirection: 'above' | 'below' | 'within';\n  unit: MeasurementUnit;\n  category: string;\n  percentile?: number;\n}\n\nexport interface HarmonyAnalysis {\n  overallScore: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  percentile: number;\n  frontScore: number;\n  sideScore: number;\n  categoryScores: Record<string, number>;\n  measurements: FaceIQScoreResult[];\n  flaws: FlawAssessment[];\n  strengths: StrengthAssessment[];\n}\n\nexport interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n}\n\nexport interface StrengthAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  qualityTier: QualityTier;\n  value: number;\n  reasoning: string;\n}\n\n// ============================================\n// DEMOGRAPHIC TYPES & OVERRIDES\n// ============================================\n\nexport type Ethnicity =\n  | 'east_asian'\n  | 'south_asian'\n  | 'black'\n  | 'hispanic'\n  | 'middle_eastern'\n  | 'native_american'\n  | 'pacific_islander'\n  | 'white'\n  | 'other';\n\nexport type Gender = 'male' | 'female';\n\nexport type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n\nexport interface DemographicOverride {\n  idealMin: number;\n  idealMax: number;\n}\n\n/**\n * Demographic-specific ideal ranges based on anthropometric research.\n * FaceIQ uses universal scoring, but this gives more accurate assessments\n * by adjusting ideals based on ethnicity and gender.\n */\nexport const DEMOGRAPHIC_OVERRIDES: Record<string, Partial<Record<DemographicKey, DemographicOverride>>> = {\n  // ==========================================\n  // NOSE METRICS - Highest ethnicity variation\n  // ==========================================\n  nasalIndex: {\n    // Nasal Index = (Nose Width / Nose Height) Ã— 100\n    // Research: African/Pacific Islander tend platyrrhine (85-100), Asian mesorrhine (75-88), European leptorrhine (65-75)\n    east_asian_male: { idealMin: 78, idealMax: 88 },\n    east_asian_female: { idealMin: 76, idealMax: 86 },\n    south_asian_male: { idealMin: 72, idealMax: 82 },\n    south_asian_female: { idealMin: 70, idealMax: 80 },\n    black_male: { idealMin: 85, idealMax: 100 },\n    black_female: { idealMin: 83, idealMax: 98 },\n    hispanic_male: { idealMin: 75, idealMax: 87 },\n    hispanic_female: { idealMin: 73, idealMax: 85 },\n    middle_eastern_male: { idealMin: 68, idealMax: 78 },\n    middle_eastern_female: { idealMin: 66, idealMax: 76 },\n    white_male: { idealMin: 65, idealMax: 75 },\n    white_female: { idealMin: 63, idealMax: 73 },\n    native_american_male: { idealMin: 72, idealMax: 82 },\n    native_american_female: { idealMin: 70, idealMax: 80 },\n    pacific_islander_male: { idealMin: 82, idealMax: 95 },\n    pacific_islander_female: { idealMin: 80, idealMax: 93 },\n  },\n\n  nasolabialAngle: {\n    // Ideal nasolabial angle varies by ethnicity\n    // African: slightly more obtuse, European: slightly more acute\n    // Middle Eastern: Penalizes droopy tip (<90Â°) - common flaw is \"Hooked Nose\"\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    black_male: { idealMin: 95, idealMax: 110 },\n    black_female: { idealMin: 100, idealMax: 115 },\n    east_asian_male: { idealMin: 90, idealMax: 105 },\n    east_asian_female: { idealMin: 95, idealMax: 110 },\n    middle_eastern_male: { idealMin: 90, idealMax: 100 },  // Strict on droopy tip\n    middle_eastern_female: { idealMin: 95, idealMax: 105 },\n    // Gender-only fallbacks\n    male: { idealMin: 90, idealMax: 100 },\n    female: { idealMin: 100, idealMax: 110 },\n  },\n\n  nasalProjection: {\n    // Nose projection relative to face depth\n    // East Asian/African: typically less projection is ideal\n    // Middle Eastern: Accepts stronger projection (bigger nose) than White model\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian: { idealMin: 0.54, idealMax: 0.60 },\n    black: { idealMin: 0.52, idealMax: 0.58 },\n    south_asian: { idealMin: 0.56, idealMax: 0.62 },\n    middle_eastern: { idealMin: 0.62, idealMax: 0.70 },  // Higher tolerance for larger noses\n    white: { idealMin: 0.60, idealMax: 0.67 },\n    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },\n  },\n\n  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Pacific Islander: Similar to Black model, accepts wide nasal base\n    // Extracted from FaceIQ BlackAfrican.htc and Male:Pacific Islander.htc logic\n    white_male: { idealMin: 1.00, idealMax: 1.04 },\n    white_female: { idealMin: 0.98, idealMax: 1.02 },\n    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n    black_female: { idealMin: 1.13, idealMax: 1.23 },\n    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n    pacific_islander_male: { idealMin: 1.10, idealMax: 1.20 },  // Wide tolerance, similar to Black model\n    pacific_islander_female: { idealMin: 1.08, idealMax: 1.18 },\n  },\n\n  // ==========================================\n  // JAW METRICS - Clear gender dimorphism\n  // ==========================================\n  bigonialWidth: {\n    // Jaw width as % of bizygomatic width\n    // Males: wider, more angular; Females: narrower, softer\n    // Pacific Islander: Extremely wide jaw preferred - \"Warrior Skull\" robustness\n    // Extracted from FaceIQ Male:Pacific Islander.htc\n    male: { idealMin: 90, idealMax: 95 },\n    female: { idealMin: 85, idealMax: 90 },\n    pacific_islander_male: { idealMin: 92, idealMax: 98 },  // Jaw width rivals cheekbone width - extreme robustness\n    pacific_islander_female: { idealMin: 88, idealMax: 94 },\n  },\n\n  jawFrontalAngle: {\n    // More angular in males, softer in females\n    male: { idealMin: 88, idealMax: 95 },\n    female: { idealMin: 82, idealMax: 90 },\n  },\n\n  jawWidthRatio: {\n    // Males have stronger jaw width preference\n    male: { idealMin: 0.78, idealMax: 0.85 },\n    female: { idealMin: 0.72, idealMax: 0.80 },\n  },\n\n  gonialAngle: {\n    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n    male: { idealMin: 115, idealMax: 125 },\n    female: { idealMin: 120, idealMax: 135 },\n  },\n\n  // ==========================================\n  // EYE METRICS - Ethnic variation\n  // ==========================================\n  lateralCanthalTilt: {\n    // East Asian: naturally higher positive tilt\n    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian_male: { idealMin: 8, idealMax: 12 },\n    east_asian_female: { idealMin: 9, idealMax: 13 },\n    south_asian_male: { idealMin: 6, idealMax: 10 },\n    south_asian_female: { idealMin: 7, idealMax: 11 },\n    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n    // Default for others is 4-8 (already in FACEIQ_METRICS)\n  },\n\n  eyeAspectRatio: {\n    // East Asian eyes often have different aspect ratio due to epicanthal fold\n    east_asian_male: { idealMin: 2.6, idealMax: 3.2 },\n    east_asian_female: { idealMin: 2.7, idealMax: 3.3 },\n    // Larger eyes in females considered more attractive\n    male: { idealMin: 2.9, idealMax: 3.4 },\n    female: { idealMin: 3.1, idealMax: 3.6 },\n  },\n\n  tearTroughDepth: {\n    // Under-eye hollowing and dark circles (infraorbital depression)\n    // South Asian: MUCH stricter penalty due to genetic hyperpigmentation\n    // Extracted from FaceIQ Male:SouthAsian.htc - biggest difference vs White model\n    white_male: { idealMin: 0.0, idealMax: 1.5 },\n    white_female: { idealMin: 0.0, idealMax: 1.3 },\n    south_asian_male: { idealMin: 0.0, idealMax: 0.5 },  // VERY strict - 0.5+ triggers \"Tired/Aged Eyes\" flaw\n    south_asian_female: { idealMin: 0.0, idealMax: 0.4 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.2 },\n    east_asian_female: { idealMin: 0.0, idealMax: 1.0 },\n  },\n\n  upperEyelidExposure: {\n    // Visible eyelid platform (space between eyelash and crease)\n    // South Asian ideal: prefers visible lid platform, penalizes hooded eyes more than White model\n    // Extracted from FaceIQ Male:SouthAsian.htc\n    white_male: { idealMin: 0.3, idealMax: 2.5 },\n    white_female: { idealMin: 0.5, idealMax: 3.0 },\n    south_asian_male: { idealMin: 0.5, idealMax: 2.0 },  // Prefers visible lid, penalizes hooding\n    south_asian_female: { idealMin: 0.7, idealMax: 2.2 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.5 },  // More tolerance for less exposure\n    east_asian_female: { idealMin: 0.2, idealMax: 1.8 },\n  },\n\n  // ==========================================\n  // FACE PROPORTIONS - Gender variation\n  // ==========================================\n  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n  },\n\n  totalFacialWidthToHeight: {\n    male: { idealMin: 1.35, idealMax: 1.40 },\n    female: { idealMin: 1.32, idealMax: 1.37 },\n  },\n\n  midfaceRatio: {\n    // Females often have more compact midface\n    // White: Neoclassical standard - strict compact midface preference\n    // Middle Eastern: Similar to White model - compact is better\n    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:MiddleEastern.htc\n    white_male: { idealMin: 0.95, idealMax: 1.02 },  // Neoclassical - penalizes long midface heavily\n    white_female: { idealMin: 0.93, idealMax: 1.00 },\n    male: { idealMin: 0.98, idealMax: 1.02 },\n    female: { idealMin: 0.95, idealMax: 1.00 },\n    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n  },\n\n  // ==========================================\n  // LIP METRICS - Ethnicity variation\n  // ==========================================\n  lipRatio: {\n    // African/Hispanic: fuller lips natural\n    black_male: { idealMin: 1.6, idealMax: 2.2 },\n    black_female: { idealMin: 1.7, idealMax: 2.3 },\n    hispanic_male: { idealMin: 1.4, idealMax: 2.0 },\n    hispanic_female: { idealMin: 1.5, idealMax: 2.1 },\n    // East Asian: less full lips\n    east_asian_male: { idealMin: 1.2, idealMax: 1.7 },\n    east_asian_female: { idealMin: 1.3, idealMax: 1.8 },\n    // Default\n    male: { idealMin: 1.3, idealMax: 1.8 },\n    female: { idealMin: 1.4, idealMax: 2.0 },\n  },\n\n  upperLipRatio: {\n    // Fuller upper lip in African phenotypes\n    black: { idealMin: 0.38, idealMax: 0.48 },\n    hispanic: { idealMin: 0.36, idealMax: 0.45 },\n    east_asian: { idealMin: 0.32, idealMax: 0.40 },\n    female: { idealMin: 0.34, idealMax: 0.42 },\n  },\n\n  // ==========================================\n  // PROFILE METRICS - Gender & ethnicity\n  // ==========================================\n  chinProjection: {\n    // Males: more projected chin ideal\n    // Black/African: Adjusted for bimaxillary prognathism (forward mouth projection)\n    // Extracted from FaceIQ BlackAfrican.htc logic\n    male: { idealMin: 0, idealMax: 3 },\n    female: { idealMin: -2, idealMax: 2 },\n    black_male: { idealMin: 0, idealMax: 4 },  // Accommodates natural forward projection\n    black_female: { idealMin: -1, idealMax: 3 },\n  },\n\n  nasofrontalAngle: {\n    // Higher brow ridge in males\n    male: { idealMin: 128, idealMax: 138 },\n    female: { idealMin: 132, idealMax: 142 },\n  },\n\n  chinToPhiltrumRatio: {\n    // Black/African: Fuller lips naturally shorten visible philtrum\n    // Extracted from FaceIQ BlackAfrican.htc - relaxes \"Short Philtrum\" penalty\n    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n    black_female: { idealMin: 2.10, idealMax: 2.65 },\n  },\n\n  // ==========================================\n  // SKIN QUALITY - Ethnicity variation\n  // ==========================================\n  skinUniformity: {\n    // South Asian: Stricter standards due to genetic hyperpigmentation tendency\n    // Hispanic: Similar to South Asian - penalizes hyperpigmentation more than White model\n    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n    white_male: { idealMin: 0.88, idealMax: 1.00 },\n    white_female: { idealMin: 0.90, idealMax: 1.00 },\n    south_asian_male: { idealMin: 0.90, idealMax: 1.00 },  // Stricter - hyperpigmentation common\n    south_asian_female: { idealMin: 0.92, idealMax: 1.00 },\n    east_asian_male: { idealMin: 0.92, idealMax: 1.00 },  // High skin quality standards\n    east_asian_female: { idealMin: 0.94, idealMax: 1.00 },\n    black_male: { idealMin: 0.85, idealMax: 1.00 },  // More tolerance for melanin variation\n    black_female: { idealMin: 0.87, idealMax: 1.00 },\n    hispanic_male: { idealMin: 0.85, idealMax: 1.00 },  // Bridge: more tolerance than South Asian, less than White\n    hispanic_female: { idealMin: 0.87, idealMax: 1.00 },\n  },\n\n  // ==========================================\n  // EYEBROW METRICS - Ethnicity variation\n  // ==========================================\n  eyebrowThickness: {\n    // Middle Eastern: Heavily favors thick, dense eyebrows (\"Dark Triad\" look with deep-set eyes)\n    // Extracted from FaceIQ Male:MiddleEastern.htc - STRICTEST eyebrow requirements\n    middle_eastern_male: { idealMin: 2.5, idealMax: 5.0 },  // Prefers significantly thicker/darker brows\n    middle_eastern_female: { idealMin: 2.0, idealMax: 4.0 },\n    east_asian_male: { idealMin: 1.5, idealMax: 3.0 },  // Typically less thick\n    east_asian_female: { idealMin: 1.3, idealMax: 2.5 },\n    male: { idealMin: 2.0, idealMax: 4.0 },\n    female: { idealMin: 1.8, idealMax: 3.5 },\n  },\n\n  eyebrowDistance: {\n    // Middle Eastern: \"Kill Switch\" for unibrow (synophrys)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    // While thick brows are favored, unibrow is a critical flaw if distance < 15mm\n    middle_eastern_male: { idealMin: 15, idealMax: 25 },  // Stricter minimum to avoid unibrow\n    middle_eastern_female: { idealMin: 18, idealMax: 28 },\n    male: { idealMin: 15, idealMax: 25 },\n    female: { idealMin: 16, idealMax: 26 },\n  },\n\n  orbitalVector: {\n    // Middle Eastern: Favors deep-set eyes (lower/negative orbital vector)\n    // Part of the \"Dark Triad\" look with heavy brows\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    middle_eastern_male: { idealMin: -2, idealMax: 3 },  // Allows more deep-set eyes\n    middle_eastern_female: { idealMin: -1, idealMax: 4 },\n    male: { idealMin: 0, idealMax: 4 },\n    female: { idealMin: 1, idealMax: 5 },\n  },\n};\n\n/**\n * Get metric configuration with demographic-specific overrides applied.\n * Lookup priority: ethnicity_gender > gender > ethnicity > default\n */\nexport function getMetricConfigForDemographics(\n  metricId: string,\n  gender: Gender,\n  ethnicity: Ethnicity = 'other'\n): MetricConfig | null {\n  const baseConfig = FACEIQ_METRICS[metricId];\n  if (!baseConfig) return null;\n\n  const overrides = DEMOGRAPHIC_OVERRIDES[metricId];\n  if (!overrides) return baseConfig;\n\n  // Try specific combo first (e.g., \"east_asian_male\")\n  const specificKey = `${ethnicity}_${gender}` as DemographicKey;\n  const override = overrides[specificKey] || overrides[gender] || overrides[ethnicity];\n\n  if (!override) return baseConfig;\n\n  return {\n    ...baseConfig,\n    idealMin: override.idealMin,\n    idealMax: override.idealMax,\n  };\n}\n\n// ============================================\n// FACEIQ MEASUREMENT CONFIGURATIONS (70+)\n// ============================================\n\nexport const FACEIQ_METRICS: Record<string, MetricConfig> = {\n  // ==========================================\n  // FRONT PROFILE - FACIAL PROPORTIONS (32)\n  // ==========================================\n\n  faceWidthToHeight: {\n    id: 'faceWidthToHeight',\n    name: 'Face Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.96,\n    idealMax: 2.0,\n    rangeMin: 1.4,\n    rangeMax: 2.5,\n    decayRate: 6.4,\n    maxScore: 30,  // FaceIQ: highest priority metric\n    weight: 0.06,\n    description: 'Ratio of bizygomatic width to upper face height',\n    profileType: 'front',\n  },\n\n  lowerThirdProportion: {\n    id: 'lowerThirdProportion',\n    name: 'Lower Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31,\n    idealMax: 33.5,\n    rangeMin: 24,\n    rangeMax: 40,\n    decayRate: 1.86,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by lower third (subnasale to menton)',\n    profileType: 'front',\n  },\n\n  middleThirdProportion: {\n    id: 'middleThirdProportion',\n    name: 'Middle Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31.4,\n    idealMax: 33.4,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by middle third',\n    profileType: 'front',\n  },\n\n  upperThirdProportion: {\n    id: 'upperThirdProportion',\n    name: 'Upper Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 30,\n    idealMax: 32,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Percentage of face occupied by upper third (trichion to glabella)',\n    profileType: 'front',\n  },\n\n  bitemporalWidth: {\n    id: 'bitemporalWidth',\n    name: 'Bitemporal Width',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 75,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Temple width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  cheekboneHeight: {\n    id: 'cheekboneHeight',\n    name: 'Cheekbone Height',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 83,\n    idealMax: 100,\n    rangeMin: 30,\n    rangeMax: 140,\n    decayRate: 0.5,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Vertical position of cheekbones relative to face height',\n    profileType: 'front',\n  },\n\n  totalFacialWidthToHeight: {\n    id: 'totalFacialWidthToHeight',\n    name: 'Total Facial Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.34,\n    idealMax: 1.37,\n    rangeMin: 1.0,\n    rangeMax: 1.7,\n    decayRate: 13.2,\n    maxScore: 25,  // Special: higher max score\n    weight: 0.05,\n    description: 'Total face height divided by cheek width',\n    profileType: 'front',\n    customCurve: {\n      mode: 'custom',\n      points: [\n        { x: 1.05, y: 0 },\n        { x: 1.17, y: 1.41 },\n        { x: 1.25, y: 3.86 },\n        { x: 1.29, y: 6.01 },\n        { x: 1.32, y: 8.88 },\n        { x: 1.34, y: 10, fixed: true },\n        { x: 1.37, y: 10, fixed: true },\n        { x: 1.39, y: 8.88 },\n        { x: 1.42, y: 6.01 },\n        { x: 1.46, y: 3.86 },\n        { x: 1.54, y: 1.41 },\n        { x: 1.66, y: 0 },\n      ],\n    },\n  },\n\n  midfaceRatio: {\n    id: 'midfaceRatio',\n    name: 'Midface Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 0.97,\n    idealMax: 1.0,\n    rangeMin: 0.5,\n    rangeMax: 1.5,\n    decayRate: 31.6,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.04,\n    description: 'Midface width to height ratio for facial balance',\n    profileType: 'front',\n  },\n\n  // JAW MEASUREMENTS\n  jawSlope: {\n    id: 'jawSlope',\n    name: 'Jaw Slope',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 140,\n    idealMax: 142.5,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of the jawline from gonion to chin',\n    profileType: 'front',\n  },\n\n  jawFrontalAngle: {\n    id: 'jawFrontalAngle',\n    name: 'Jaw Frontal Angle',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 35,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 20,  // FaceIQ: high priority\n    weight: 0.04,\n    description: 'Angle of jaw corners from frontal view',\n    profileType: 'front',\n  },\n\n  bigonialWidth: {\n    id: 'bigonialWidth',\n    name: 'Bigonial Width',\n    category: 'Jaw Shape',\n    unit: 'percent',\n    idealMin: 87.75,\n    idealMax: 91.75,\n    rangeMin: 60.25,\n    rangeMax: 120.25,\n    decayRate: 0.9,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Jaw width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  jawWidthRatio: {\n    id: 'jawWidthRatio',\n    name: 'Jaw Width to Face Width Ratio',\n    category: 'Jaw Shape',\n    unit: 'ratio',\n    idealMin: 0.75,\n    idealMax: 0.82,\n    rangeMin: 0.6,\n    rangeMax: 0.95,\n    decayRate: 25.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Bigonial width divided by bizygomatic width',\n    profileType: 'front',\n  },\n\n  // EYE MEASUREMENTS\n  lateralCanthalTilt: {\n    id: 'lateralCanthalTilt',\n    name: 'Lateral Canthal Tilt',\n    category: 'Eyes',\n    unit: 'degrees',\n    idealMin: 4.0,   // Updated: 4-8Â° is peak \"hunter eyes\"\n    idealMax: 8.0,\n    rangeMin: -5,\n    rangeMax: 20,\n    decayRate: 1.5,  // Reduced: gentler decay for positive tilts\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle of eye from inner to outer canthus. Positive tilt is attractive.',\n    profileType: 'front',\n    // DIRECTIONAL SCORING: Higher (positive) tilt is better\n    // - Ideal: 4-8Â° (attractive upswept eyes / \"hunter eyes\")\n    // - Good: 0-4Â° (neutral to slight positive - still attractive)\n    // - Weak: < 0Â° (negative/droopy tilt - only this is a true weakness)\n    polarity: 'higher_is_better',\n    safeFloor: 0.0,       // Neutral tilt - anything above is acceptable\n    softZoneScore: 8.0,   // \"Good\" score for 0-4Â° range\n  },\n\n  eyeAspectRatio: {\n    id: 'eyeAspectRatio',\n    name: 'Eye Aspect Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 3.0,\n    idealMax: 3.5,\n    rangeMin: 0.8,\n    rangeMax: 6,\n    decayRate: 2.0,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Eye width divided by eye height',\n    profileType: 'front',\n  },\n\n  eyeSeparationRatio: {\n    id: 'eyeSeparationRatio',\n    name: 'Eye Separation Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 45.7,\n    idealMax: 46.8,\n    rangeMin: 35,\n    rangeMax: 55,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Intercanthal distance as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryRatio: {\n    id: 'interpupillaryRatio',\n    name: 'Interpupillary Distance Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 44,\n    idealMax: 48,\n    rangeMin: 38,\n    rangeMax: 54,\n    decayRate: 1.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'IPD as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryMouthWidthRatio: {\n    id: 'interpupillaryMouthWidthRatio',\n    name: 'Interpupillary-Mouth Width Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.83,\n    idealMax: 0.87,\n    rangeMin: 0.6,\n    rangeMax: 1.1,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Mouth width divided by interpupillary distance',\n    profileType: 'front',\n  },\n\n  oneEyeApartTest: {\n    id: 'oneEyeApartTest',\n    name: 'One Eye Apart Test',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.95,\n    idealMax: 1.0,\n    rangeMin: 0.7,\n    rangeMax: 1.3,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Intercanthal distance should equal one eye width',\n    profileType: 'front',\n  },\n\n  tearTroughDepth: {\n    id: 'tearTroughDepth',\n    name: 'Tear Trough Depth',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.0,\n    idealMax: 1.5,\n    rangeMin: 0.0,\n    rangeMax: 4.0,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Under-eye hollow depth (infraorbital depression). Lower is better for youthfulness.',\n    profileType: 'front',\n    polarity: 'lower_is_better',\n    safeCeiling: 1.5,  // White standard\n    softZoneScore: 7.5,\n  },\n\n  upperEyelidExposure: {\n    id: 'upperEyelidExposure',\n    name: 'Upper Eyelid Exposure',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 2.5,\n    rangeMin: 0.0,\n    rangeMax: 5.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Visible upper eyelid platform. Too little creates hooded eyes.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  // EYEBROW MEASUREMENTS\n  eyebrowThickness: {\n    id: 'eyebrowThickness',\n    name: 'Eyebrow Thickness',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 2.0,\n    idealMax: 4.0,\n    rangeMin: 1.0,\n    rangeMax: 6.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow density and thickness. Higher values indicate fuller, denser brows.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  eyebrowDistance: {\n    id: 'eyebrowDistance',\n    name: 'Inter-Eyebrow Distance',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 15,\n    idealMax: 25,\n    rangeMin: 5,\n    rangeMax: 40,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance between inner edges of eyebrows. Too low creates unibrow (synophrys).',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  browLengthRatio: {\n    id: 'browLengthRatio',\n    name: 'Brow Length to Face Width Ratio',\n    category: 'Upper Third',\n    unit: 'percent',\n    idealMin: 28,\n    idealMax: 32,\n    rangeMin: 20,\n    rangeMax: 40,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow length as percentage of face width',\n    profileType: 'front',\n  },\n\n  eyebrowTilt: {\n    id: 'eyebrowTilt',\n    name: 'Eyebrow Tilt',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 6.5,\n    idealMax: 11,\n    rangeMin: -5,\n    rangeMax: 25,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of eyebrow from head to tail',\n    profileType: 'front',\n  },\n\n  eyebrowLowSetedness: {\n    id: 'eyebrowLowSetedness',\n    name: 'Eyebrow Low Setedness',\n    category: 'Upper Third',\n    unit: 'ratio',\n    idealMin: 0,\n    idealMax: 0.45,\n    rangeMin: -0.2,\n    rangeMax: 1.0,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from brow to eye relative to eye height',\n    profileType: 'front',\n  },\n\n  // NOSE MEASUREMENTS (FRONT)\n  nasalIndex: {\n    id: 'nasalIndex',\n    name: 'Nasal Index',\n    category: 'Nose',\n    unit: 'percent',\n    idealMin: 70,\n    idealMax: 85,\n    rangeMin: 55,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose width divided by nose height Ã— 100',\n    profileType: 'front',\n  },\n\n  intercanthalNasalRatio: {\n    id: 'intercanthalNasalRatio',\n    name: 'Intercanthal-Nasal Width Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 1.04,\n    idealMax: 1.16,\n    rangeMin: 0.7,\n    rangeMax: 1.5,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Alar width should roughly equal intercanthal distance',\n    profileType: 'front',\n  },\n\n  noseBridgeWidth: {\n    id: 'noseBridgeWidth',\n    name: 'Nose Bridge to Nose Width',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.6,\n    idealMax: 0.75,\n    rangeMin: 0.4,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ratio of nose bridge width to alar base width',\n    profileType: 'front',\n  },\n\n  noseTipPosition: {\n    id: 'noseTipPosition',\n    name: 'Nose Tip Position',\n    category: 'Nose',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 3.5,\n    rangeMin: -7.5,\n    rangeMax: 12.5,\n    decayRate: 1.5,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Nose tip deviation from facial midline',\n    profileType: 'front',\n  },\n\n  // MOUTH/LIP MEASUREMENTS\n  mouthWidthToNoseRatio: {\n    id: 'mouthWidthToNoseRatio',\n    name: 'Mouth Width to Nose Width Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.43,\n    idealMax: 1.51,\n    rangeMin: 0.96,\n    rangeMax: 1.91,\n    decayRate: 18.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Mouth width divided by nose width',\n    profileType: 'front',\n  },\n\n  lowerToUpperLipRatio: {\n    id: 'lowerToUpperLipRatio',\n    name: 'Lower Lip to Upper Lip Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.58,\n    idealMax: 1.88,\n    rangeMin: -0.98,\n    rangeMax: 4.03,\n    decayRate: 8.0,\n    maxScore: 7.5,  // FaceIQ: medium priority\n    weight: 0.02,\n    description: 'Lower lip height divided by upper lip height',\n    profileType: 'front',\n  },\n\n  cupidsBowDepth: {\n    id: 'cupidsBowDepth',\n    name: \"Cupid's Bow Depth\",\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2.3,\n    idealMax: 4,\n    rangeMin: 0,\n    rangeMax: 7,\n    decayRate: 2.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: \"Depth of the cupid's bow curve\",\n    profileType: 'front',\n  },\n\n  mouthCornerPosition: {\n    id: 'mouthCornerPosition',\n    name: 'Mouth Corner Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Mouth corner vertical position relative to lip center',\n    profileType: 'front',\n  },\n\n  // CHIN MEASUREMENTS (FRONT)\n  chinToPhiltrumRatio: {\n    id: 'chinToPhiltrumRatio',\n    name: 'Chin to Philtrum Ratio',\n    category: 'Chin',\n    unit: 'ratio',\n    idealMin: 2.15,\n    idealMax: 2.45,\n    rangeMin: 0.3,\n    rangeMax: 4.5,\n    decayRate: 10.0,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.02,\n    description: 'Chin height divided by philtrum length',\n    profileType: 'front',\n  },\n\n  // OTHER FRONT MEASUREMENTS\n  iaaJfaDeviation: {\n    id: 'iaaJfaDeviation',\n    name: 'Deviation of IAA & JFA',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 0,\n    idealMax: 2.5,\n    rangeMin: -25,\n    rangeMax: 30,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Deviation between Ipsilateral Alar Angle and Jaw Frontal Angle',\n    profileType: 'front',\n  },\n\n  ipsilateralAlarAngle: {\n    id: 'ipsilateralAlarAngle',\n    name: 'Ipsilateral Alar Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 60,\n    rangeMax: 125,\n    decayRate: 0.6,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Angle of alar base relative to facial plane',\n    profileType: 'front',\n  },\n\n  earProtrusionAngle: {\n    id: 'earProtrusionAngle',\n    name: 'Ear Protrusion Angle',\n    category: 'Ears',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 11.5,\n    rangeMin: -25,\n    rangeMax: 40,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of ear protrusion from head',\n    profileType: 'front',\n  },\n\n  earProtrusionRatio: {\n    id: 'earProtrusionRatio',\n    name: 'Ear Protrusion Ratio',\n    category: 'Ears',\n    unit: 'percent',\n    idealMin: 8,\n    idealMax: 12,\n    rangeMin: -20,\n    rangeMax: 40,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ear protrusion as percentage of head width',\n    profileType: 'front',\n  },\n\n  neckWidth: {\n    id: 'neckWidth',\n    name: 'Neck Width',\n    category: 'Neck',\n    unit: 'percent',\n    idealMin: 92,\n    idealMax: 98,\n    rangeMin: 60,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Neck width as percentage of jaw width',\n    profileType: 'front',\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS (38)\n  // ==========================================\n\n  gonialAngle: {\n    id: 'gonialAngle',\n    name: 'Gonial Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 130,\n    rangeMin: 105,\n    rangeMax: 145,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle at the jaw corner (gonion)',\n    profileType: 'side',\n  },\n\n  nasolabialAngle: {\n    id: 'nasolabialAngle',\n    name: 'Nasolabial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 90,\n    idealMax: 105,\n    rangeMin: 75,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle between columella and upper lip',\n    profileType: 'side',\n  },\n\n  nasofrontalAngle: {\n    id: 'nasofrontalAngle',\n    name: 'Nasofrontal Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 116,\n    idealMax: 128,\n    rangeMin: 90,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the bridge of nose (nasion)',\n    profileType: 'side',\n  },\n\n  nasofacialAngle: {\n    id: 'nasofacialAngle',\n    name: 'Nasofacial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 31,\n    idealMax: 35,\n    rangeMin: 15,\n    rangeMax: 50,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between nose and face plane',\n    profileType: 'side',\n  },\n\n  nasomentaAngle: {\n    id: 'nasomentaAngle',\n    name: 'Nasomental Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 126,\n    idealMax: 131,\n    rangeMin: 105,\n    rangeMax: 155,\n    decayRate: 0.7,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle from nasion to nose tip to chin',\n    profileType: 'side',\n  },\n\n  nasalTipAngle: {\n    id: 'nasalTipAngle',\n    name: 'Nasal Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 105,\n    rangeMin: 70,\n    rangeMax: 120,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the nose tip',\n    profileType: 'side',\n  },\n\n  nasalProjection: {\n    id: 'nasalProjection',\n    name: 'Nasal Projection',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.55,\n    idealMax: 0.6,\n    rangeMin: 0.4,\n    rangeMax: 0.75,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose projection relative to nasal length (Goode ratio)',\n    profileType: 'side',\n  },\n\n  nasalWToHRatio: {\n    id: 'nasalWToHRatio',\n    name: 'Nasal W to H Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.67,\n    idealMax: 0.78,\n    rangeMin: 0.5,\n    rangeMax: 0.95,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Nose width to height ratio from side view',\n    profileType: 'side',\n  },\n\n  noseTipRotationAngle: {\n    id: 'noseTipRotationAngle',\n    name: 'Nose Tip Rotation Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 95,\n    idealMax: 110,\n    rangeMin: 80,\n    rangeMax: 125,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of nose tip rotation',\n    profileType: 'side',\n  },\n\n  frankfortTipAngle: {\n    id: 'frankfortTipAngle',\n    name: 'Frankfort-Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 28,\n    idealMax: 34,\n    rangeMin: 20,\n    rangeMax: 42,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle between Frankfort plane and nose tip',\n    profileType: 'side',\n  },\n\n  mentolabialAngle: {\n    id: 'mentolabialAngle',\n    name: 'Mentolabial Angle',\n    category: 'Lips',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 140,\n    rangeMin: 100,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the labiomental fold',\n    profileType: 'side',\n  },\n\n  zAngle: {\n    id: 'zAngle',\n    name: 'Z Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 75,\n    idealMax: 85,\n    rangeMin: 60,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Merrifield Z-Angle for profile assessment',\n    profileType: 'side',\n  },\n\n  submentalCervicalAngle: {\n    id: 'submentalCervicalAngle',\n    name: 'Submental Cervical Angle',\n    category: 'Neck',\n    unit: 'degrees',\n    idealMin: 94,\n    idealMax: 106,\n    rangeMin: 70,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between chin and neck',\n    profileType: 'side',\n  },\n\n  facialConvexityGlabella: {\n    id: 'facialConvexityGlabella',\n    name: 'Facial Convexity (Glabella)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 165,\n    idealMax: 175,\n    rangeMin: 150,\n    rangeMax: 185,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Facial convexity angle using glabella',\n    profileType: 'side',\n  },\n\n  facialConvexityNasion: {\n    id: 'facialConvexityNasion',\n    name: 'Facial Convexity (Nasion)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 168,\n    idealMax: 178,\n    rangeMin: 155,\n    rangeMax: 190,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial convexity angle using nasion',\n    profileType: 'side',\n  },\n\n  totalFacialConvexity: {\n    id: 'totalFacialConvexity',\n    name: 'Total Facial Convexity',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 135,\n    idealMax: 145,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Complete facial profile convexity measurement',\n    profileType: 'side',\n  },\n\n  facialDepthToHeight: {\n    id: 'facialDepthToHeight',\n    name: 'Facial Depth to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.3,\n    idealMax: 1.44,\n    rangeMin: 0.7,\n    rangeMax: 1.8,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial depth divided by facial height',\n    profileType: 'side',\n  },\n\n  anteriorFacialDepth: {\n    id: 'anteriorFacialDepth',\n    name: 'Anterior Facial Depth',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 64.5,\n    idealMax: 67.5,\n    rangeMin: 45,\n    rangeMax: 95,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Anterior facial projection angle',\n    profileType: 'side',\n  },\n\n  interiorMidfaceProjectionAngle: {\n    id: 'interiorMidfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 50,\n    idealMax: 56,\n    rangeMin: 30,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Interior midface projection from side profile',\n    profileType: 'side',\n  },\n\n  recessionFromFrankfort: {\n    id: 'recessionFromFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'mm',\n    idealMin: 1.5,\n    idealMax: 15,\n    rangeMin: -30,\n    rangeMax: 30,\n    decayRate: 0.3,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin position relative to Frankfort plane',\n    profileType: 'side',\n  },\n\n  mandibularPlaneAngle: {\n    id: 'mandibularPlaneAngle',\n    name: 'Mandibular Plane Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 22,\n    idealMax: 28,\n    rangeMin: 15,\n    rangeMax: 38,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of mandibular plane to Frankfort plane',\n    profileType: 'side',\n  },\n\n  ramusToMandibleRatio: {\n    id: 'ramusToMandibleRatio',\n    name: 'Ramus to Mandible Ratio',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'ratio',\n    idealMin: 0.65,\n    idealMax: 0.75,\n    rangeMin: 0.5,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Ramus height divided by mandible length',\n    profileType: 'side',\n  },\n\n  gonionToMouthLine: {\n    id: 'gonionToMouthLine',\n    name: 'Gonion to Mouth Line',\n    category: 'Jaw Shape',\n    unit: 'mm',\n    idealMin: -5,\n    idealMax: 5,\n    rangeMin: -20,\n    rangeMax: 20,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from gonion to mouth level line',\n    profileType: 'side',\n  },\n\n  // E-LINE MEASUREMENTS\n  eLineUpperLip: {\n    id: 'eLineUpperLip',\n    name: 'Upper Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -4,\n    idealMax: -2,\n    rangeMin: -10,\n    rangeMax: 4,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Upper lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  eLineLowerLip: {\n    id: 'eLineLowerLip',\n    name: 'Lower Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 0,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Lower lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  // S-LINE MEASUREMENTS\n  sLineUpperLip: {\n    id: 'sLineUpperLip',\n    name: 'Upper Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 3,\n    rangeMin: -5,\n    rangeMax: 8,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  sLineLowerLip: {\n    id: 'sLineLowerLip',\n    name: 'Lower Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -0.4,\n    idealMax: 0.4,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  // BURSTONE LINE\n  burstoneUpperLip: {\n    id: 'burstoneUpperLip',\n    name: 'Upper Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2,\n    idealMax: 4,\n    rangeMin: -2,\n    rangeMax: 8,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  burstoneLowerLip: {\n    id: 'burstoneLowerLip',\n    name: 'Lower Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 1,\n    idealMax: 3,\n    rangeMin: -3,\n    rangeMax: 7,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  // H LINE\n  holdawayHLine: {\n    id: 'holdawayHLine',\n    name: 'Holdaway H Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Holdaway H-line soft tissue assessment',\n    profileType: 'side',\n  },\n\n  // CHIN MEASUREMENTS (SIDE)\n  chinProjection: {\n    id: 'chinProjection',\n    name: 'Chin Projection',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -3,\n    idealMax: 3,\n    rangeMin: -12,\n    rangeMax: 12,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin projection relative to ideal position',\n    profileType: 'side',\n  },\n\n  recessionRelativeToFrankfort: {\n    id: 'recessionRelativeToFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 2,\n    rangeMin: -10,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin recession relative to Frankfort horizontal',\n    profileType: 'side',\n  },\n\n  // FOREHEAD\n  browridgeInclinationAngle: {\n    id: 'browridgeInclinationAngle',\n    name: 'Browridge Inclination Angle',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 18,\n    rangeMin: 0,\n    rangeMax: 28,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the brow ridge from profile',\n    profileType: 'side',\n  },\n\n  upperForeheadSlope: {\n    id: 'upperForeheadSlope',\n    name: 'Upper Forehead Slope',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 5,\n    idealMax: 12,\n    rangeMin: 0,\n    rangeMax: 20,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Slope angle of the upper forehead',\n    profileType: 'side',\n  },\n\n  // MIDFACE PROJECTION\n  midfaceProjectionAngle: {\n    id: 'midfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 95,\n    rangeMin: 75,\n    rangeMax: 105,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of midface projection from profile',\n    profileType: 'side',\n  },\n\n  orbitalVector: {\n    id: 'orbitalVector',\n    name: 'Orbital Vector',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -6,\n    rangeMax: 10,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Relationship of globe to orbital rim',\n    profileType: 'side',\n  },\n\n  skinUniformity: {\n    id: 'skinUniformity',\n    name: 'Skin Uniformity',\n    category: 'Skin Quality',\n    unit: 'ratio',\n    idealMin: 0.90,\n    idealMax: 1.00,\n    rangeMin: 0.50,\n    rangeMax: 1.00,\n    decayRate: 5.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Skin tone evenness and hyperpigmentation. 1.0 = perfectly uniform.',\n    profileType: 'front',\n    polarity: 'higher_is_better',\n    safeFloor: 0.85,  // Acceptable uniformity threshold\n    softZoneScore: 7.5,\n  },\n\n};\n\n// ============================================\n// FLAW MAPPINGS (Extracted from FaceIQ)\n// ============================================\n\nexport interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n  reasoning: string;\n}\n\nexport const METRIC_FLAW_MAPPINGS: Record<string, FlawMapping[]> = {\n  anteriorFacialDepth: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Anterior Facial Depth measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  bitemporalWidth: [\n    { category: 'Upper Third', flawName: 'Narrow forehead', confidence: 'confirmed', reasoning: 'Reduced bitemporal width indicates a narrower than ideal forehead relative to the cheekbones. This disrupts facial harmony by creating a compressed hairline and forehead, altering the overall shape of the face.' },\n  ],\n  cheekboneHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Low-set cheekbones', confidence: 'confirmed', reasoning: 'Reduced cheekbone height indicates that the cheekbones are positioned lower than ideal. This disrupts facial harmony by creating an unpronounced appearance to the cheekbones and facial structure.' },\n  ],\n  eyeAspectRatio: [\n    { category: 'Eyes', flawName: 'Overly round eye shape', confidence: 'confirmed', reasoning: 'A reduced eye aspect ratio indicates overly narrow eyes relative to their height. This disrupts facial harmony by creating an overly surprised appearance and reducing angular definition.' },\n  ],\n  eyeSeparationRatio: [\n    { category: 'Eyes', flawName: 'Close-set eyes', confidence: 'confirmed', reasoning: 'Reduced eye separation indicates close-set eyes. This disrupts facial harmony by making the eye area appear too compressed.' },\n  ],\n  eyebrowLowSetedness: [\n    { category: 'Eyes', flawName: 'Medium-set eyebrows', confidence: 'confirmed', reasoning: 'Increased eyebrow low setedness indicates eyebrows that are positioned higher than ideal. This disrupts facial harmony by reducing the overall visual impact of the eyebrows and framing of the eyes.' },\n  ],\n  faceWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced face width to height ratio indicates an overly long midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  facialDepthToHeight: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'Reduced facial depth to height ratio indicates insufficient mid-face projection relative to height. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  gonialAngle: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  holdawayHLine: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'Decreased H-line indicates the lips are positioned too far in front of the line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  interiorMidfaceProjectionAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Interior Midface Projection Angle measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  ipsilateralAlarAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A decreased ipsilateral alar angle indicates an overly narrow interior midface. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  jawFrontalAngle: [\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A narrower jaw frontal angle indicates a steeper jawline or overly wide chin. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  jawSlope: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'The Jaw Slope measurement is above the ideal range. This disrupts facial harmony in the lower face.' },\n  ],\n  lateralCanthalTilt: [\n    { category: 'Eyes', flawName: 'Insufficient eye tilt', confidence: 'confirmed', reasoning: 'A decreased lateral canthal tilt indicates insufficiently upturned eyes. This disrupts facial harmony by creating a less alert and youthful appearance.' },\n  ],\n  burstoneLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the Burstone line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  eLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned too far in front of the E-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  sLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the S-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  lowerThirdProportion: [\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'The upper jaw is too long relative to lower jaw, possibly from a long upper jaw or short lower jaw, or a combination of both. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  mandibularPlaneAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Hyper-divergent jaw growth', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by elongating the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  midfaceRatio: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  nasofacialAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A smaller nasofacial angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  nasofrontalAngle: [\n    { category: 'Upper Third', flawName: 'Soft and weak brow ridge', confidence: 'confirmed', reasoning: 'An increased nasofrontal angle indicates reduced brow ridge prominence and angularity. This disrupts facial harmony by creating a less defined upper face.' },\n  ],\n  nasomentaAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A larger nasomental angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  noseBridgeWidth: [\n    { category: 'Nose', flawName: 'Overly narrow nose bridge', confidence: 'confirmed', reasoning: 'The Nose Bridge to Nose Width measurement is above the ideal range. This disrupts facial harmony by creating an unbalanced nasal profile.' },\n  ],\n  orbitalVector: [\n    { category: 'Eyes', flawName: 'Sunken orbital region', confidence: 'confirmed', reasoning: 'A decreased orbital vector indicates insufficient projection and volume underneath the eye. This disrupts facial harmony due to the lacking volume underneath the eyes, reducing vibrancy and youthfulness.' },\n  ],\n  ramusToMandibleRatio: [\n    { category: 'Jaw Shape', flawName: 'Short ramus', confidence: 'confirmed', reasoning: 'A reduced ramus-to-mandible ratio indicates a shorter than ideal vertical jawbone (ramus) when compared to the mandible. This disrupts facial harmony by reducing jaw height and definition.' },\n  ],\n  submentalCervicalAngle: [\n    { category: 'Neck', flawName: 'Round neck region', confidence: 'confirmed', reasoning: 'An increased submental cervical angle indicates a round neck region, possibly from excess submental fat or tissue. This disrupts facial harmony by reducing neck definition.' },\n  ],\n  totalFacialWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Overly long face shape', confidence: 'confirmed', reasoning: 'An increased total facial width to height ratio indicates an overly long face relative to its height. This disrupts facial harmony by creating a vertically stretched appearance to the face.' },\n  ],\n};\n\n// ============================================\n// CUSTOM BEZIER CURVES (Extracted from FaceIQ)\n// ============================================\n\nexport const METRIC_CUSTOM_CURVES: Record<string, CurvePoint[]> = {\n  faceWidthToHeight: [\n    { x: 1.49, y: 0, leftHandleX: 1.44, leftHandleY: 0, rightHandleX: 1.55, rightHandleY: 0 },\n    { x: 1.68, y: 1.05, leftHandleX: 1.62, leftHandleY: 0.36, rightHandleX: 1.71, rightHandleY: 1.58 },\n    { x: 1.77, y: 3.07, leftHandleX: 1.74, leftHandleY: 2.15, rightHandleX: 1.79, rightHandleY: 3.88 },\n    { x: 1.83, y: 5.83, leftHandleX: 1.80, leftHandleY: 4.64, rightHandleX: 1.84, rightHandleY: 6.85 },\n    { x: 1.89, y: 8.70, leftHandleX: 1.88, leftHandleY: 8.30, rightHandleX: 1.92, rightHandleY: 9.50 },\n    { x: 1.96, y: 10, leftHandleX: 1.96, leftHandleY: 10, rightHandleX: 1.96, rightHandleY: 10, fixed: true },\n    { x: 2.00, y: 10, leftHandleX: 2.00, leftHandleY: 10, rightHandleX: 2.00, rightHandleY: 10, fixed: true },\n    { x: 2.07, y: 8.70, leftHandleX: 2.04, leftHandleY: 9.50, rightHandleX: 2.08, rightHandleY: 8.30 },\n    { x: 2.13, y: 5.83, leftHandleX: 2.12, leftHandleY: 6.85, rightHandleX: 2.16, rightHandleY: 4.64 },\n    { x: 2.19, y: 3.07, leftHandleX: 2.17, leftHandleY: 3.88, rightHandleX: 2.22, rightHandleY: 2.15 },\n    { x: 2.28, y: 1.05, leftHandleX: 2.25, leftHandleY: 1.58, rightHandleX: 2.34, rightHandleY: 0.36 },\n    { x: 2.47, y: 0, leftHandleX: 2.41, leftHandleY: 0, rightHandleX: 2.52, rightHandleY: 0 },\n  ],\n  lowerThirdProportion: [\n    { x: 25.6, y: 0, leftHandleX: 24.8, leftHandleY: 0, rightHandleX: 26.4, rightHandleY: 0 },\n    { x: 28.01, y: 1.58, leftHandleX: 27.23, leftHandleY: 0.53, rightHandleX: 28.27, rightHandleY: 1.97 },\n    { x: 28.83, y: 3.21, leftHandleX: 28.60, leftHandleY: 2.60, rightHandleX: 29.10, rightHandleY: 3.90 },\n    { x: 29.63, y: 5.85, leftHandleX: 29.40, leftHandleY: 4.90, rightHandleX: 29.85, rightHandleY: 6.80 },\n    { x: 30.27, y: 8.56, leftHandleX: 30.05, leftHandleY: 7.80, rightHandleX: 30.50, rightHandleY: 9.30 },\n    { x: 31, y: 10, leftHandleX: 30.95, leftHandleY: 10, rightHandleX: 31.05, rightHandleY: 10, fixed: true },\n    { x: 33.5, y: 10, leftHandleX: 33.45, leftHandleY: 10, rightHandleX: 33.55, rightHandleY: 10, fixed: true },\n    { x: 34.23, y: 8.56, leftHandleX: 34.00, leftHandleY: 9.30, rightHandleX: 34.45, rightHandleY: 7.80 },\n    { x: 34.87, y: 5.85, leftHandleX: 34.65, leftHandleY: 6.80, rightHandleX: 35.10, rightHandleY: 4.90 },\n    { x: 35.67, y: 3.21, leftHandleX: 35.40, leftHandleY: 3.90, rightHandleX: 35.90, rightHandleY: 2.60 },\n    { x: 36.49, y: 1.58, leftHandleX: 36.23, leftHandleY: 1.97, rightHandleX: 37.27, rightHandleY: 0.53 },\n    { x: 38.9, y: 0, leftHandleX: 38.1, leftHandleY: 0, rightHandleX: 39.7, rightHandleY: 0 },\n  ],\n  lateralCanthalTilt: [\n    { x: -4.5, y: 0, leftHandleX: -5.5, leftHandleY: 0, rightHandleX: -3.5, rightHandleY: 0 },\n    { x: 0.5, y: 1.2, leftHandleX: -0.8, leftHandleY: 0.4, rightHandleX: 1.5, rightHandleY: 1.8 },\n    { x: 2.8, y: 3.5, leftHandleX: 2.2, leftHandleY: 2.5, rightHandleX: 3.4, rightHandleY: 4.3 },\n    { x: 4.5, y: 6.8, leftHandleX: 4.0, leftHandleY: 5.5, rightHandleX: 5.0, rightHandleY: 7.8 },\n    { x: 5.8, y: 9.2, leftHandleX: 5.4, leftHandleY: 8.5, rightHandleX: 5.95, rightHandleY: 9.7 },\n    { x: 6.1, y: 10, leftHandleX: 6.05, leftHandleY: 10, rightHandleX: 6.15, rightHandleY: 10, fixed: true },\n    { x: 7.8, y: 10, leftHandleX: 7.75, leftHandleY: 10, rightHandleX: 7.85, rightHandleY: 10, fixed: true },\n    { x: 8.1, y: 9.2, leftHandleX: 7.95, leftHandleY: 9.7, rightHandleX: 8.5, rightHandleY: 8.5 },\n    { x: 9.4, y: 6.8, leftHandleX: 8.9, leftHandleY: 7.8, rightHandleX: 9.9, rightHandleY: 5.5 },\n    { x: 11.1, y: 3.5, leftHandleX: 10.5, leftHandleY: 4.3, rightHandleX: 11.7, rightHandleY: 2.5 },\n    { x: 13.4, y: 1.2, leftHandleX: 12.4, leftHandleY: 1.8, rightHandleX: 14.7, rightHandleY: 0.4 },\n    { x: 18.4, y: 0, leftHandleX: 17.4, leftHandleY: 0, rightHandleX: 19.4, rightHandleY: 0 },\n  ],\n  gonialAngle: [\n    { x: 105, y: 0, leftHandleX: 102, leftHandleY: 0, rightHandleX: 108, rightHandleY: 0 },\n    { x: 112, y: 1.5, leftHandleX: 110, leftHandleY: 0.5, rightHandleX: 114, rightHandleY: 2.3 },\n    { x: 116, y: 4.2, leftHandleX: 114.5, leftHandleY: 3.0, rightHandleX: 117.5, rightHandleY: 5.2 },\n    { x: 118.5, y: 7.5, leftHandleX: 117.5, leftHandleY: 6.3, rightHandleX: 119.5, rightHandleY: 8.5 },\n    { x: 120, y: 10, leftHandleX: 119.7, leftHandleY: 10, rightHandleX: 120.3, rightHandleY: 10, fixed: true },\n    { x: 130, y: 10, leftHandleX: 129.7, leftHandleY: 10, rightHandleX: 130.3, rightHandleY: 10, fixed: true },\n    { x: 131.5, y: 7.5, leftHandleX: 130.5, leftHandleY: 8.5, rightHandleX: 132.5, rightHandleY: 6.3 },\n    { x: 134, y: 4.2, leftHandleX: 132.5, leftHandleY: 5.2, rightHandleX: 135.5, rightHandleY: 3.0 },\n    { x: 138, y: 1.5, leftHandleX: 136, leftHandleY: 2.3, rightHandleX: 140, rightHandleY: 0.5 },\n    { x: 145, y: 0, leftHandleX: 142, leftHandleY: 0, rightHandleX: 148, rightHandleY: 0 },\n  ],\n  nasolabialAngle: [\n    { x: 75, y: 0, leftHandleX: 72, leftHandleY: 0, rightHandleX: 78, rightHandleY: 0 },\n    { x: 82, y: 2.0, leftHandleX: 79.5, leftHandleY: 0.7, rightHandleX: 84, rightHandleY: 3.0 },\n    { x: 86, y: 5.5, leftHandleX: 84.5, leftHandleY: 4.2, rightHandleX: 87.5, rightHandleY: 6.8 },\n    { x: 89, y: 8.8, leftHandleX: 88, leftHandleY: 7.8, rightHandleX: 89.7, rightHandleY: 9.5 },\n    { x: 90, y: 10, leftHandleX: 89.8, leftHandleY: 10, rightHandleX: 90.2, rightHandleY: 10, fixed: true },\n    { x: 105, y: 10, leftHandleX: 104.8, leftHandleY: 10, rightHandleX: 105.2, rightHandleY: 10, fixed: true },\n    { x: 106, y: 8.8, leftHandleX: 105.3, leftHandleY: 9.5, rightHandleX: 107, rightHandleY: 7.8 },\n    { x: 109, y: 5.5, leftHandleX: 107.5, leftHandleY: 6.8, rightHandleX: 110.5, rightHandleY: 4.2 },\n    { x: 113, y: 2.0, leftHandleX: 111, leftHandleY: 3.0, rightHandleX: 115.5, rightHandleY: 0.7 },\n    { x: 120, y: 0, leftHandleX: 117, leftHandleY: 0, rightHandleX: 123, rightHandleY: 0 },\n  ],\n  // Middle Third Proportion curve (ideal: 31.4-33.4%)\n  middleThirdProportion: [\n    { x: 21.44, y: 0, leftHandleX: 20.29, leftHandleY: 0, rightHandleX: 23.19, rightHandleY: 0.15 },\n    { x: 25.5, y: 1.35, leftHandleX: 24.18, leftHandleY: 0.53, rightHandleX: 26.17, rightHandleY: 1.79 },\n    { x: 27.34, y: 3.18, leftHandleX: 26.84, leftHandleY: 2.42, rightHandleX: 27.73, rightHandleY: 3.81 },\n    { x: 28.65, y: 5.88, leftHandleX: 28.33, leftHandleY: 4.91, rightHandleX: 28.98, rightHandleY: 6.65 },\n    { x: 29.95, y: 8.55, leftHandleX: 29.41, leftHandleY: 7.58, rightHandleX: 30.45, rightHandleY: 9.35 },\n    { x: 31.4, y: 10, leftHandleX: 31.3, leftHandleY: 10, rightHandleX: 31.5, rightHandleY: 10, fixed: true },\n    { x: 33.4, y: 10, leftHandleX: 33.3, leftHandleY: 10, rightHandleX: 33.5, rightHandleY: 10, fixed: true },\n    { x: 34.85, y: 8.55, leftHandleX: 34.35, leftHandleY: 9.35, rightHandleX: 35.39, rightHandleY: 7.58 },\n    { x: 36.15, y: 5.88, leftHandleX: 35.82, leftHandleY: 6.65, rightHandleX: 36.47, rightHandleY: 4.91 },\n    { x: 37.46, y: 3.18, leftHandleX: 37.07, leftHandleY: 3.81, rightHandleX: 37.96, rightHandleY: 2.42 },\n    { x: 39.3, y: 1.35, leftHandleX: 38.63, leftHandleY: 1.79, rightHandleX: 40.62, rightHandleY: 0.53 },\n    { x: 43.36, y: 0, leftHandleX: 41.61, leftHandleY: 0.15, rightHandleX: 44.51, rightHandleY: 0 },\n  ],\n  // Upper Third Proportion curve (ideal: 30-32%)\n  upperThirdProportion: [\n    { x: 18.75, y: 0.02, leftHandleX: 17.15, leftHandleY: 0.02, rightHandleX: 20.35, rightHandleY: 0.02 },\n    { x: 23.82, y: 1.52, leftHandleX: 22.35, leftHandleY: 0.8, rightHandleX: 24.73, rightHandleY: 2.06 },\n    { x: 26.05, y: 4.06, leftHandleX: 25.48, leftHandleY: 2.86, rightHandleX: 26.41, rightHandleY: 4.99 },\n    { x: 27.19, y: 6.79, leftHandleX: 26.96, leftHandleY: 6.16, rightHandleX: 27.66, rightHandleY: 7.85 },\n    { x: 28.54, y: 9.08, leftHandleX: 28.02, leftHandleY: 8.5, rightHandleX: 28.93, rightHandleY: 9.54 },\n    { x: 30, y: 10, leftHandleX: 29.9, leftHandleY: 10, rightHandleX: 30.1, rightHandleY: 10, fixed: true },\n    { x: 32, y: 10, leftHandleX: 31.9, leftHandleY: 10, rightHandleX: 32.1, rightHandleY: 10, fixed: true },\n    { x: 33.46, y: 9.08, leftHandleX: 33.07, leftHandleY: 9.54, rightHandleX: 33.98, rightHandleY: 8.5 },\n    { x: 34.81, y: 6.79, leftHandleX: 34.34, leftHandleY: 7.85, rightHandleX: 35.04, rightHandleY: 6.16 },\n    { x: 35.95, y: 4.06, leftHandleX: 35.59, leftHandleY: 4.99, rightHandleX: 36.52, rightHandleY: 2.86 },\n    { x: 38.18, y: 1.52, leftHandleX: 37.27, leftHandleY: 2.06, rightHandleX: 39.65, rightHandleY: 0.8 },\n    { x: 43.25, y: 0.02, leftHandleX: 41.65, leftHandleY: 0.02, rightHandleX: 44.85, rightHandleY: 0.02 },\n  ],\n  // Eye Separation Ratio curve (ideal: 45.7-46.8%)\n  eyeSeparationRatio: [\n    { x: 36.54, y: 0, leftHandleX: 35.44, leftHandleY: 0, rightHandleX: 37.40, rightHandleY: 0.04 },\n    { x: 39.04, y: 0.63, leftHandleX: 38.16, leftHandleY: 0.21, rightHandleX: 39.77, rightHandleY: 1.05 },\n    { x: 41.08, y: 2.17, leftHandleX: 40.57, leftHandleY: 1.71, rightHandleX: 41.62, rightHandleY: 2.76 },\n    { x: 42.71, y: 4.74, leftHandleX: 42.26, leftHandleY: 3.81, rightHandleX: 43.08, rightHandleY: 5.52 },\n    { x: 43.94, y: 7.37, leftHandleX: 43.65, leftHandleY: 6.79, rightHandleX: 44.17, rightHandleY: 7.77 },\n    { x: 44.86, y: 9.02, leftHandleX: 44.54, leftHandleY: 8.56, rightHandleX: 45.08, rightHandleY: 9.5 },\n    { x: 45.7, y: 10, leftHandleX: 45.65, leftHandleY: 10, rightHandleX: 45.76, rightHandleY: 10, fixed: true },\n    { x: 46.8, y: 10, leftHandleX: 46.75, leftHandleY: 10, rightHandleX: 46.86, rightHandleY: 10, fixed: true },\n    { x: 47.64, y: 9.02, leftHandleX: 47.42, leftHandleY: 9.5, rightHandleX: 47.96, rightHandleY: 8.56 },\n    { x: 48.56, y: 7.37, leftHandleX: 48.33, leftHandleY: 7.77, rightHandleX: 48.85, rightHandleY: 6.79 },\n    { x: 49.79, y: 4.74, leftHandleX: 49.42, leftHandleY: 5.52, rightHandleX: 50.24, rightHandleY: 3.81 },\n    { x: 51.42, y: 2.17, leftHandleX: 50.88, leftHandleY: 2.76, rightHandleX: 51.93, rightHandleY: 1.71 },\n    { x: 53.46, y: 0.63, leftHandleX: 52.73, leftHandleY: 1.05, rightHandleX: 54.34, rightHandleY: 0.21 },\n    { x: 55.96, y: 0, leftHandleX: 55.10, leftHandleY: 0.04, rightHandleX: 57.06, rightHandleY: 0 },\n  ],\n  // Eyebrow Low Setedness curve (ideal: 0-0.45)\n  eyebrowLowSetedness: [\n    { x: -2.78, y: 0, leftHandleX: -3.11, leftHandleY: 0, rightHandleX: -2.67, rightHandleY: 0 },\n    { x: -1.94, y: 0.4, leftHandleX: -2.08, leftHandleY: 0.11, rightHandleX: -1.81, rightHandleY: 0.57 },\n    { x: -1.18, y: 2.25, leftHandleX: -1.36, leftHandleY: 1.5, rightHandleX: -1.05, rightHandleY: 2.72 },\n    { x: -0.79, y: 4.06, leftHandleX: -0.88, leftHandleY: 3.43, rightHandleX: -0.68, rightHandleY: 4.84 },\n    { x: -0.55, y: 6.21, leftHandleX: -0.58, leftHandleY: 5.55, rightHandleX: -0.47, rightHandleY: 6.92 },\n    { x: -0.28, y: 8.76, leftHandleX: -0.37, leftHandleY: 8.23, rightHandleX: -0.23, rightHandleY: 9.22 },\n    { x: 0, y: 10, leftHandleX: -0.02, leftHandleY: 10, rightHandleX: 0.02, rightHandleY: 10, fixed: true },\n    { x: 0.45, y: 10, leftHandleX: 0.43, leftHandleY: 10, rightHandleX: 0.47, rightHandleY: 10, fixed: true },\n    { x: 0.73, y: 8.76, leftHandleX: 0.68, leftHandleY: 9.22, rightHandleX: 0.82, rightHandleY: 8.23 },\n    { x: 1, y: 6.21, leftHandleX: 0.92, leftHandleY: 6.92, rightHandleX: 1.03, rightHandleY: 5.55 },\n    { x: 1.24, y: 4.06, leftHandleX: 1.13, leftHandleY: 4.84, rightHandleX: 1.33, rightHandleY: 3.43 },\n    { x: 1.63, y: 2.25, leftHandleX: 1.50, leftHandleY: 2.72, rightHandleX: 1.81, rightHandleY: 1.5 },\n    { x: 2.39, y: 0.4, leftHandleX: 2.26, leftHandleY: 0.57, rightHandleX: 2.53, rightHandleY: 0.11 },\n    { x: 3.23, y: 0, leftHandleX: 3.12, leftHandleY: 0, rightHandleX: 3.56, rightHandleY: 0 },\n  ],\n  // Submental Cervical Angle curve (ideal: 94-106Â°)\n  submentalCervicalAngle: [\n    { x: 50.48, y: 0, leftHandleX: 44.48, leftHandleY: 0, rightHandleX: 56.48, rightHandleY: 0 },\n    { x: 68.31, y: 1.31, leftHandleX: 62.07, leftHandleY: 0.32, rightHandleX: 72.89, rightHandleY: 2.13 },\n    { x: 77.76, y: 3.71, leftHandleX: 76.00, leftHandleY: 2.89, rightHandleX: 80.39, rightHandleY: 4.59 },\n    { x: 83.99, y: 6.53, leftHandleX: 82.63, leftHandleY: 5.85, rightHandleX: 85.16, rightHandleY: 7.12 },\n    { x: 88.28, y: 8.86, leftHandleX: 86.43, leftHandleY: 7.85, rightHandleX: 89.95, rightHandleY: 9.71 },\n    { x: 94, y: 10, leftHandleX: 93.4, leftHandleY: 10, rightHandleX: 94.6, rightHandleY: 10, fixed: true },\n    { x: 106, y: 10, leftHandleX: 105.4, leftHandleY: 10, rightHandleX: 106.6, rightHandleY: 10, fixed: true },\n    { x: 111.72, y: 8.86, leftHandleX: 110.05, leftHandleY: 9.71, rightHandleX: 113.57, rightHandleY: 7.85 },\n    { x: 116.01, y: 6.53, leftHandleX: 114.84, leftHandleY: 7.12, rightHandleX: 117.37, rightHandleY: 5.85 },\n    { x: 122.24, y: 3.71, leftHandleX: 119.61, leftHandleY: 4.59, rightHandleX: 124.00, rightHandleY: 2.89 },\n    { x: 131.69, y: 1.31, leftHandleX: 127.11, leftHandleY: 2.13, rightHandleX: 137.93, rightHandleY: 0.32 },\n    { x: 149.52, y: 0, leftHandleX: 143.52, leftHandleY: 0, rightHandleX: 155.52, rightHandleY: 0 },\n  ],\n  // Facial Convexity (Glabella) curve (ideal: 169-174Â°)\n  facialConvexityGlabella: [\n    { x: 149.21, y: 0, leftHandleX: 146.21, leftHandleY: 0, rightHandleX: 152.21, rightHandleY: 0 },\n    { x: 158.07, y: 1.41, leftHandleX: 156.03, leftHandleY: 0.74, rightHandleX: 159.63, rightHandleY: 2 },\n    { x: 162.12, y: 4.09, leftHandleX: 161.34, leftHandleY: 3.31, rightHandleX: 163.09, rightHandleY: 5.03 },\n    { x: 165.14, y: 7.76, leftHandleX: 164.46, leftHandleY: 6.56, rightHandleX: 165.54, rightHandleY: 8.29 },\n    { x: 166.65, y: 9.14, leftHandleX: 165.92, leftHandleY: 8.72, rightHandleX: 167.43, rightHandleY: 9.67 },\n    { x: 169, y: 10, leftHandleX: 168.75, leftHandleY: 10, rightHandleX: 169.25, rightHandleY: 10, fixed: true },\n    { x: 174, y: 10, leftHandleX: 173.75, leftHandleY: 10, rightHandleX: 174.25, rightHandleY: 10, fixed: true },\n    { x: 176.35, y: 9.14, leftHandleX: 175.57, leftHandleY: 9.67, rightHandleX: 177.08, rightHandleY: 8.72 },\n    { x: 177.86, y: 7.76, leftHandleX: 177.46, leftHandleY: 8.29, rightHandleX: 178.54, rightHandleY: 6.56 },\n    { x: 180.88, y: 4.09, leftHandleX: 179.91, leftHandleY: 5.03, rightHandleX: 181.66, rightHandleY: 3.31 },\n    { x: 184.93, y: 1.41, leftHandleX: 183.37, leftHandleY: 2, rightHandleX: 186.97, rightHandleY: 0.74 },\n    { x: 193.79, y: 0, leftHandleX: 190.79, leftHandleY: 0, rightHandleX: 196.79, rightHandleY: 0 },\n  ],\n};\n\n// ============================================\n// CATEGORY DEFINITIONS\n// ============================================\n\nexport const MEASUREMENT_CATEGORIES = {\n  'Midface/Face Shape': { color: '#67e8f9', weight: 0.20 },\n  'Occlusion/Jaw Growth': { color: '#a78bfa', weight: 0.15 },\n  'Jaw Shape': { color: '#f97316', weight: 0.13 },\n  'Upper Third': { color: '#84cc16', weight: 0.08 },\n  'Eyes': { color: '#06b6d4', weight: 0.12 },\n  'Nose': { color: '#fbbf24', weight: 0.10 },\n  'Lips': { color: '#ec4899', weight: 0.10 },\n  'Chin': { color: '#ef4444', weight: 0.06 },\n  'Neck': { color: '#14b8a6', weight: 0.03 },\n  'Other': { color: '#6b7280', weight: 0.03 },\n};\n\n// ============================================\n// CORE SCORING FUNCTIONS\n// ============================================\n\n/**\n * FaceIQ Exponential Decay Scoring Algorithm with Directional/Dimorphic Support\n *\n * Standard: score = maxScore Ã— e^(-decayRate Ã— deviation)\n *\n * Directional scoring (polarity):\n * - 'higher_is_better': Values above safeFloor but below ideal get softZoneScore\n *   Example: Canthal Tilt of 3Â° is still positive/good, just not peak ideal (6-8Â°)\n * - 'lower_is_better': Values below safeCeiling but above ideal get softZoneScore\n *   Example: Short philtrum is still attractive even if shorter than \"ideal\"\n */\nexport function calculateFaceIQScore(\n  value: number,\n  config: MetricConfig\n): number {\n  const {\n    idealMin,\n    idealMax,\n    decayRate,\n    maxScore,\n    customCurve,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n    softZoneScore = 8.0, // Default \"Good\" score for acceptable-but-not-ideal values\n  } = config;\n\n  // Use custom curve if available\n  if (customCurve && customCurve.mode === 'custom') {\n    return interpolateCustomCurve(value, customCurve.points, maxScore);\n  }\n\n  // Perfect score within ideal range\n  if (value >= idealMin && value <= idealMax) {\n    return maxScore;\n  }\n\n  // Handle directional/dimorphic scoring\n  if (polarity === 'higher_is_better' && safeFloor !== undefined) {\n    // Higher values are good. Only values below safeFloor are true weaknesses.\n    if (value >= safeFloor && value < idealMin) {\n      // Value is in the \"acceptable but not ideal\" zone\n      // Give a passing score that decreases linearly as we approach the floor\n      const zoneRange = idealMin - safeFloor;\n      const distanceFromIdeal = idealMin - value;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMin â†’ maxScore, safeFloor â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value >= idealMax) {\n      // Values above ideal are still excellent for 'higher_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = value - idealMax;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Below safeFloor - apply normal (or harsher) exponential decay\n    if (value < safeFloor) {\n      const deviation = safeFloor - value;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  if (polarity === 'lower_is_better' && safeCeiling !== undefined) {\n    // Lower values are good. Only values above safeCeiling are true weaknesses.\n    if (value <= safeCeiling && value > idealMax) {\n      // Value is in the \"acceptable but not ideal\" zone\n      const zoneRange = safeCeiling - idealMax;\n      const distanceFromIdeal = value - idealMax;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMax â†’ maxScore, safeCeiling â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value <= idealMin) {\n      // Values below ideal are still excellent for 'lower_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = idealMin - value;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Above safeCeiling - apply normal exponential decay\n    if (value > safeCeiling) {\n      const deviation = value - safeCeiling;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  // Default balanced scoring: deviation in either direction is equally bad\n  const deviation = value < idealMin\n    ? idealMin - value\n    : value - idealMax;\n\n  // Exponential decay\n  const score = maxScore * Math.exp(-decayRate * deviation);\n\n  return Math.max(0, Math.min(maxScore, score));\n}\n\n/**\n * Check if a metric value is in an \"acceptable\" zone (not a true weakness).\n * Used by InsightsEngine to prevent false positives.\n */\nexport function isValueAcceptable(\n  value: number,\n  config: MetricConfig\n): { acceptable: boolean; reason: string } {\n  const {\n    idealMin,\n    idealMax,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n  } = config;\n\n  // Within ideal range is always acceptable\n  if (value >= idealMin && value <= idealMax) {\n    return { acceptable: true, reason: 'within_ideal' };\n  }\n\n  // Check directional acceptability\n  if (polarity === 'higher_is_better') {\n    if (value >= idealMax) {\n      return { acceptable: true, reason: 'above_ideal_higher_is_better' };\n    }\n    if (safeFloor !== undefined && value >= safeFloor) {\n      return { acceptable: true, reason: 'above_safe_floor' };\n    }\n    // Below safe floor - true weakness\n    return { acceptable: false, reason: 'below_safe_floor' };\n  }\n\n  if (polarity === 'lower_is_better') {\n    if (value <= idealMin) {\n      return { acceptable: true, reason: 'below_ideal_lower_is_better' };\n    }\n    if (safeCeiling !== undefined && value <= safeCeiling) {\n      return { acceptable: true, reason: 'below_safe_ceiling' };\n    }\n    // Above safe ceiling - true weakness\n    return { acceptable: false, reason: 'above_safe_ceiling' };\n  }\n\n  // Balanced polarity - outside ideal is not acceptable\n  return { acceptable: false, reason: 'outside_ideal_balanced' };\n}\n\n/**\n * Interpolate custom Bezier curve for scoring\n * Uses cubic Bezier interpolation with control handles for smooth curves\n */\nfunction interpolateCustomCurve(\n  value: number,\n  points: CurvePoint[],\n  maxScore: number\n): number {\n  void maxScore; // Reserved for future custom curve implementations\n  if (points.length === 0) return 0;\n\n  // Sort points by x value\n  const sortedPoints = [...points].sort((a, b) => a.x - b.x);\n\n  // Clamp to range\n  if (value <= sortedPoints[0].x) return sortedPoints[0].y;\n  if (value >= sortedPoints[sortedPoints.length - 1].x) {\n    return sortedPoints[sortedPoints.length - 1].y;\n  }\n\n  // Find bracketing points\n  let lowerIndex = 0;\n  for (let i = 0; i < sortedPoints.length - 1; i++) {\n    if (value >= sortedPoints[i].x && value <= sortedPoints[i + 1].x) {\n      lowerIndex = i;\n      break;\n    }\n  }\n\n  const p0 = sortedPoints[lowerIndex];\n  const p3 = sortedPoints[lowerIndex + 1];\n\n  // Check if we have Bezier control handles\n  const hasHandles = p0.rightHandleX !== undefined && p3.leftHandleX !== undefined;\n\n  if (hasHandles) {\n    // Cubic Bezier interpolation with control points\n    const p1x = p0.rightHandleX!;\n    const p1y = p0.rightHandleY ?? p0.y;\n    const p2x = p3.leftHandleX!;\n    const p2y = p3.leftHandleY ?? p3.y;\n\n    // Find t parameter for given x value using Newton-Raphson iteration\n    let t = (value - p0.x) / (p3.x - p0.x); // Initial guess\n\n    // Newton-Raphson iterations to find t where B_x(t) = value\n    for (let iter = 0; iter < 10; iter++) {\n      const bx = cubicBezier(p0.x, p1x, p2x, p3.x, t);\n      const bxDerivative = cubicBezierDerivative(p0.x, p1x, p2x, p3.x, t);\n\n      if (Math.abs(bxDerivative) < 1e-10) break;\n\n      const newT = t - (bx - value) / bxDerivative;\n      if (Math.abs(newT - t) < 1e-10) break;\n      t = Math.max(0, Math.min(1, newT));\n    }\n\n    // Calculate y using the found t parameter\n    return cubicBezier(p0.y, p1y, p2y, p3.y, t);\n  } else {\n    // Smooth interpolation using Catmull-Rom spline\n    // This provides smoother curves than linear interpolation\n    const t = (value - p0.x) / (p3.x - p0.x);\n\n    // Get neighboring points for spline calculation\n    const pMinus1 = lowerIndex > 0 ? sortedPoints[lowerIndex - 1] : p0;\n    const p4 = lowerIndex + 2 < sortedPoints.length ? sortedPoints[lowerIndex + 2] : p3;\n\n    // Catmull-Rom spline interpolation\n    return catmullRomSpline(pMinus1.y, p0.y, p3.y, p4.y, t);\n  }\n}\n\n/**\n * Cubic Bezier curve evaluation: B(t) = (1-t)Â³P0 + 3(1-t)Â²tP1 + 3(1-t)tÂ²P2 + tÂ³P3\n */\nfunction cubicBezier(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  const mt2 = mt * mt;\n  const mt3 = mt2 * mt;\n  const t2 = t * t;\n  const t3 = t2 * t;\n  return mt3 * p0 + 3 * mt2 * t * p1 + 3 * mt * t2 * p2 + t3 * p3;\n}\n\n/**\n * Cubic Bezier derivative: B'(t) = 3(1-t)Â²(P1-P0) + 6(1-t)t(P2-P1) + 3tÂ²(P3-P2)\n */\nfunction cubicBezierDerivative(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  return 3 * mt * mt * (p1 - p0) + 6 * mt * t * (p2 - p1) + 3 * t * t * (p3 - p2);\n}\n\n/**\n * Catmull-Rom spline interpolation for smooth curves without explicit handles\n */\nfunction catmullRomSpline(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const t2 = t * t;\n  const t3 = t2 * t;\n\n  // Catmull-Rom coefficients with tension = 0.5\n  const a = -0.5 * p0 + 1.5 * p1 - 1.5 * p2 + 0.5 * p3;\n  const b = p0 - 2.5 * p1 + 2 * p2 - 0.5 * p3;\n  const c = -0.5 * p0 + 0.5 * p2;\n  const d = p1;\n\n  return a * t3 + b * t2 + c * t + d;\n}\n\n/**\n * Calculate standardized score (0-10 normalized)\n */\nexport function standardizeScore(score: number, maxScore: number): number {\n  return (score / maxScore) * 10;\n}\n\n/**\n * Determine quality tier based on score\n */\nexport function getQualityTier(score: number, maxScore: number = 10): QualityTier {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 90) return 'ideal';\n  if (normalized >= 70) return 'excellent';\n  if (normalized >= 50) return 'good';\n  return 'below_average';\n}\n\n/**\n * Determine severity level based on score\n */\nexport function getSeverityLevel(score: number, maxScore: number = 10): SeverityLevel {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 85) return 'optimal';\n  if (normalized >= 70) return 'minor';\n  if (normalized >= 50) return 'moderate';\n  if (normalized >= 30) return 'major';\n  if (normalized >= 15) return 'severe';\n  return 'extremely_severe';\n}\n\n/**\n * Calculate deviation description\n */\nexport function getDeviationDescription(\n  value: number,\n  idealMin: number,\n  idealMax: number,\n  unit: MeasurementUnit\n): { deviation: number; direction: 'above' | 'below' | 'within'; description: string } {\n  if (value >= idealMin && value <= idealMax) {\n    return { deviation: 0, direction: 'within', description: 'within ideal range' };\n  }\n\n  const unitLabel = getUnitLabel(unit);\n\n  if (value < idealMin) {\n    const dev = idealMin - value;\n    return {\n      deviation: dev,\n      direction: 'below',\n      description: `${dev.toFixed(2)}${unitLabel} below ideal`,\n    };\n  }\n\n  const dev = value - idealMax;\n  return {\n    deviation: dev,\n    direction: 'above',\n    description: `${dev.toFixed(2)}${unitLabel} above ideal`,\n  };\n}\n\nfunction getUnitLabel(unit: MeasurementUnit): string {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return 'Â°';\n    case 'mm': return 'mm';\n    default: return '';\n  }\n}\n\n// ============================================\n// MEASUREMENT CALCULATION UTILITIES\n// ============================================\n\n/**\n * Calculate distance between two points\n */\nexport function distance(p1: Point, p2: Point): number {\n  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n}\n\n/**\n * Calculate angle at vertex point (in degrees)\n */\nexport function calculateAngle(p1: Point, vertex: Point, p2: Point): number {\n  const v1 = { x: p1.x - vertex.x, y: p1.y - vertex.y };\n  const v2 = { x: p2.x - vertex.x, y: p2.y - vertex.y };\n\n  const dot = v1.x * v2.x + v1.y * v2.y;\n  const cross = v1.x * v2.y - v1.y * v2.x;\n\n  const angle = Math.atan2(cross, dot) * (180 / Math.PI);\n  return Math.abs(angle);\n}\n\n/**\n * Calculate perpendicular distance from point to line (signed)\n */\nexport function perpendicularDistance(\n  point: Point,\n  lineStart: Point,\n  lineEnd: Point\n): number {\n  const A = point.x - lineStart.x;\n  const B = point.y - lineStart.y;\n  const C = lineEnd.x - lineStart.x;\n  const D = lineEnd.y - lineStart.y;\n\n  const dot = A * C + B * D;\n  const lenSq = C * C + D * D;\n  const param = lenSq !== 0 ? dot / lenSq : -1;\n\n  let xx: number, yy: number;\n\n  if (param < 0) {\n    xx = lineStart.x;\n    yy = lineStart.y;\n  } else if (param > 1) {\n    xx = lineEnd.x;\n    yy = lineEnd.y;\n  } else {\n    xx = lineStart.x + param * C;\n    yy = lineStart.y + param * D;\n  }\n\n  const dx = point.x - xx;\n  const dy = point.y - yy;\n\n  const sign =\n    (lineEnd.y - lineStart.y) * point.x -\n      (lineEnd.x - lineStart.x) * point.y +\n      lineEnd.x * lineStart.y -\n      lineEnd.y * lineStart.x >=\n    0\n      ? 1\n      : -1;\n\n  return sign * Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Helper to get landmark by ID\n */\nfunction getLandmark(landmarks: LandmarkPoint[], id: string): Point | null {\n  const lm = landmarks.find((l) => l.id === id);\n  return lm ? { x: lm.x, y: lm.y } : null;\n}\n\n// ============================================\n// SCORE A SINGLE MEASUREMENT\n// ============================================\n\nexport interface DemographicOptions {\n  gender?: Gender;\n  ethnicity?: Ethnicity;\n}\n\n/**\n * Calculate complete score result for a measurement.\n * If demographics provided, uses demographic-specific ideal ranges.\n */\nexport function scoreMeasurement(\n  metricId: string,\n  value: number,\n  demographics?: DemographicOptions\n): FaceIQScoreResult | null {\n  // Get config with demographic overrides if provided\n  const config = demographics?.gender\n    ? getMetricConfigForDemographics(metricId, demographics.gender, demographics.ethnicity || 'other')\n    : FACEIQ_METRICS[metricId];\n\n  if (!config) return null;\n\n  const score = calculateFaceIQScore(value, config);\n  const standardizedScore = standardizeScore(score, config.maxScore);\n  const qualityTier = getQualityTier(score, config.maxScore);\n  const severity = getSeverityLevel(score, config.maxScore);\n  const { deviation, direction } = getDeviationDescription(\n    value,\n    config.idealMin,\n    config.idealMax,\n    config.unit\n  );\n\n  return {\n    metricId,\n    name: config.name,\n    value,\n    score,\n    standardizedScore,\n    qualityTier,\n    severity,\n    idealMin: config.idealMin,\n    idealMax: config.idealMax,\n    deviation,\n    deviationDirection: direction,\n    unit: config.unit,\n    category: config.category,\n  };\n}\n\n// ============================================\n// FRONT PROFILE ANALYSIS\n// ============================================\n\nexport interface FrontProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all front profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeFrontProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): FrontProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  // Helper to add measurement if landmarks available\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const trichion = getLandmark(landmarks, 'trichion');\n  const nasalBase = getLandmark(landmarks, 'nasal_base');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const menton = getLandmark(landmarks, 'menton');\n  const leftZygion = getLandmark(landmarks, 'left_zygion');\n  const rightZygion = getLandmark(landmarks, 'right_zygion');\n  const leftGonion = getLandmark(landmarks, 'left_gonion_inferior');\n  const rightGonion = getLandmark(landmarks, 'right_gonion_inferior');\n  const leftPupil = getLandmark(landmarks, 'left_pupila');\n  const rightPupil = getLandmark(landmarks, 'right_pupila');\n  const leftCanthusM = getLandmark(landmarks, 'left_canthus_medialis');\n  const leftCanthusL = getLandmark(landmarks, 'left_canthus_lateralis');\n  const rightCanthusM = getLandmark(landmarks, 'right_canthus_medialis');\n  const rightCanthusL = getLandmark(landmarks, 'right_canthus_lateralis');\n  void rightCanthusL; // Will be used for asymmetry measurements\n  const leftAlaNasi = getLandmark(landmarks, 'left_ala_nasi');\n  const rightAlaNasi = getLandmark(landmarks, 'right_ala_nasi');\n  const leftCheilion = getLandmark(landmarks, 'left_cheilion');\n  const rightCheilion = getLandmark(landmarks, 'right_cheilion');\n  const labraleSuperius = getLandmark(landmarks, 'labrale_superius');\n  const labraleInferius = getLandmark(landmarks, 'labrale_inferius');\n\n  // FACIAL THIRDS\n  if (trichion && nasalBase && subnasale && menton) {\n    const totalHeight = distance(trichion, menton);\n    if (totalHeight > 0) {\n      const upperThird = (distance(trichion, nasalBase) / totalHeight) * 100;\n      const middleThird = (distance(nasalBase, subnasale) / totalHeight) * 100;\n      const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n\n      addMeasurement('upperThirdProportion', upperThird);\n      addMeasurement('middleThirdProportion', middleThird);\n      addMeasurement('lowerThirdProportion', lowerThird);\n    }\n  }\n\n  // FACE WIDTH TO HEIGHT RATIO (FWHR)\n  if (leftZygion && rightZygion && nasalBase && labraleSuperius) {\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    const upperFaceHeight = distance(nasalBase, labraleSuperius);\n    if (upperFaceHeight > 0) {\n      addMeasurement('faceWidthToHeight', bizygomaticWidth / upperFaceHeight);\n    }\n  }\n\n  // TOTAL FACIAL WIDTH TO HEIGHT\n  if (leftZygion && rightZygion && trichion && menton) {\n    const cheekWidth = distance(leftZygion, rightZygion);\n    const totalHeight = distance(trichion, menton);\n    if (cheekWidth > 0) {\n      addMeasurement('totalFacialWidthToHeight', totalHeight / cheekWidth);\n    }\n  }\n\n  // JAW WIDTH RATIO\n  if (leftGonion && rightGonion && leftZygion && rightZygion) {\n    const bigonialWidth = distance(leftGonion, rightGonion);\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    if (bizygomaticWidth > 0) {\n      const ratio = bigonialWidth / bizygomaticWidth;\n      addMeasurement('jawWidthRatio', ratio);\n      addMeasurement('bigonialWidth', ratio * 100);\n    }\n  }\n\n  // CANTHAL TILT\n  if (leftCanthusM && leftCanthusL) {\n    const deltaY = leftCanthusM.y - leftCanthusL.y;\n    const deltaX = leftCanthusL.x - leftCanthusM.x;\n    const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);\n    addMeasurement('lateralCanthalTilt', angle);\n  }\n\n  // EYE ASPECT RATIO\n  if (leftCanthusM && leftCanthusL) {\n    const leftPalpSup = getLandmark(landmarks, 'left_palpebra_superior');\n    const leftPalpInf = getLandmark(landmarks, 'left_palpebra_inferior');\n    if (leftPalpSup && leftPalpInf) {\n      const eyeWidth = distance(leftCanthusM, leftCanthusL);\n      const eyeHeight = distance(leftPalpSup, leftPalpInf);\n      if (eyeWidth > 0) {\n        addMeasurement('eyeAspectRatio', eyeHeight / eyeWidth);\n      }\n    }\n  }\n\n  // EYE SEPARATION RATIO\n  if (leftCanthusM && rightCanthusM && leftZygion && rightZygion) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('eyeSeparationRatio', intercanthal / bizygomatic);\n    }\n  }\n\n  // IPD RATIO\n  if (leftPupil && rightPupil && leftZygion && rightZygion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('interpupillaryRatio', (ipd / bizygomatic) * 100);\n    }\n  }\n\n  // ONE EYE APART TEST\n  if (leftCanthusM && rightCanthusM && leftCanthusL) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const eyeWidth = distance(leftCanthusM, leftCanthusL);\n    if (eyeWidth > 0) {\n      addMeasurement('oneEyeApartTest', intercanthal / eyeWidth);\n    }\n  }\n\n  // NASAL INDEX\n  if (leftAlaNasi && rightAlaNasi && nasalBase && subnasale) {\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    const nasalHeight = distance(nasalBase, subnasale);\n    if (nasalHeight > 0) {\n      addMeasurement('nasalIndex', (nasalWidth / nasalHeight) * 100);\n    }\n  }\n\n  // INTERCANTHAL-NASAL WIDTH RATIO\n  if (leftCanthusM && rightCanthusM && leftAlaNasi && rightAlaNasi) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('intercanthalNasalRatio', intercanthal / nasalWidth);\n    }\n  }\n\n  // MOUTH TO NOSE RATIO\n  if (leftCheilion && rightCheilion && leftAlaNasi && rightAlaNasi) {\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('mouthWidthToNoseRatio', mouthWidth / nasalWidth);\n    }\n  }\n\n  // IPD TO MOUTH WIDTH RATIO\n  if (leftPupil && rightPupil && leftCheilion && rightCheilion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    if (ipd > 0) {\n      addMeasurement('interpupillaryMouthWidthRatio', mouthWidth / ipd);\n    }\n  }\n\n  // LIP RATIO\n  if (labraleSuperius && labraleInferius && subnasale) {\n    const mouthMiddle = getLandmark(landmarks, 'mouth_middle');\n    if (mouthMiddle) {\n      const upperLipHeight = distance(subnasale, labraleSuperius);\n      const lowerLipHeight = distance(mouthMiddle, labraleInferius);\n      if (upperLipHeight > 0) {\n        addMeasurement('lowerToUpperLipRatio', lowerLipHeight / upperLipHeight);\n      }\n    }\n  }\n\n  // MIDFACE RATIO\n  if (leftZygion && rightZygion && nasalBase && subnasale) {\n    const midfaceWidth = distance(leftZygion, rightZygion);\n    const midfaceHeight = distance(nasalBase, subnasale);\n    if (midfaceHeight > 0) {\n      addMeasurement('midfaceRatio', midfaceWidth / midfaceHeight / 10); // Normalized\n    }\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score (weighted average)\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n  const standardizedScore = overallScore;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// SIDE PROFILE ANALYSIS\n// ============================================\n\nexport interface SideProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all side profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeSideProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): SideProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const glabella = getLandmark(landmarks, 'glabella');\n  const nasion = getLandmark(landmarks, 'nasion');\n  const rhinion = getLandmark(landmarks, 'rhinion');\n  const pronasale = getLandmark(landmarks, 'pronasale');\n  const columella = getLandmark(landmarks, 'columella');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const labraleSuperius = getLandmark(landmarks, 'labraleSuperius');\n  const labraleInferius = getLandmark(landmarks, 'labraleInferius');\n  const sublabiale = getLandmark(landmarks, 'sublabiale');\n  const pogonion = getLandmark(landmarks, 'pogonion');\n  const menton = getLandmark(landmarks, 'menton');\n  const tragus = getLandmark(landmarks, 'tragus');\n  const gonionBottom = getLandmark(landmarks, 'gonionBottom');\n  const cervicalPoint = getLandmark(landmarks, 'cervicalPoint');\n  const orbitale = getLandmark(landmarks, 'orbitale');\n  const porion = getLandmark(landmarks, 'porion');\n\n  // GONIAL ANGLE\n  if (tragus && gonionBottom && menton) {\n    const angle = calculateAngle(tragus, gonionBottom, menton);\n    addMeasurement('gonialAngle', angle);\n  }\n\n  // NASOLABIAL ANGLE\n  if (columella && subnasale && labraleSuperius) {\n    const angle = calculateAngle(columella, subnasale, labraleSuperius);\n    addMeasurement('nasolabialAngle', angle);\n  }\n\n  // NASOFRONTAL ANGLE\n  if (glabella && nasion && rhinion) {\n    const angle = calculateAngle(glabella, nasion, rhinion);\n    addMeasurement('nasofrontalAngle', angle);\n  }\n\n  // MENTOLABIAL ANGLE\n  if (labraleInferius && sublabiale && pogonion) {\n    const angle = calculateAngle(labraleInferius, sublabiale, pogonion);\n    addMeasurement('mentolabialAngle', angle);\n  }\n\n  // E-LINE MEASUREMENTS\n  if (pronasale && pogonion && labraleSuperius && labraleInferius) {\n    const upperLipDist = perpendicularDistance(labraleSuperius, pronasale, pogonion);\n    const lowerLipDist = perpendicularDistance(labraleInferius, pronasale, pogonion);\n    addMeasurement('eLineUpperLip', upperLipDist);\n    addMeasurement('eLineLowerLip', lowerLipDist);\n  }\n\n  // NASOMENTAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    const angle = calculateAngle(nasion, pronasale, pogonion);\n    addMeasurement('nasomentaAngle', angle);\n  }\n\n  // FACIAL CONVEXITY (GLABELLA)\n  if (glabella && subnasale && pogonion) {\n    const angle = calculateAngle(glabella, subnasale, pogonion);\n    addMeasurement('facialConvexityGlabella', angle);\n  }\n\n  // FACIAL CONVEXITY (NASION)\n  if (nasion && subnasale && pogonion) {\n    const angle = calculateAngle(nasion, subnasale, pogonion);\n    addMeasurement('facialConvexityNasion', angle);\n  }\n\n  // TOTAL FACIAL CONVEXITY\n  if (glabella && pronasale && pogonion) {\n    const angle = calculateAngle(glabella, pronasale, pogonion);\n    addMeasurement('totalFacialConvexity', angle);\n  }\n\n  // SUBMENTAL CERVICAL ANGLE\n  if (menton && cervicalPoint && pogonion) {\n    const neckPoint = getLandmark(landmarks, 'neckPoint');\n    if (neckPoint) {\n      const angle = calculateAngle(pogonion, menton, neckPoint);\n      addMeasurement('submentalCervicalAngle', angle);\n    }\n  }\n\n  // NASAL PROJECTION (Goode ratio)\n  if (pronasale && subnasale && nasion) {\n    const projection = distance(pronasale, subnasale);\n    const nasalLength = distance(nasion, pronasale);\n    if (nasalLength > 0) {\n      addMeasurement('nasalProjection', projection / nasalLength);\n    }\n  }\n\n  // NASOFACIAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    // Angle between nose dorsum and facial plane\n    const nasalDorsum = { x: pronasale.x - nasion.x, y: pronasale.y - nasion.y };\n    const facialPlane = { x: pogonion.x - nasion.x, y: pogonion.y - nasion.y };\n\n    const dot = nasalDorsum.x * facialPlane.x + nasalDorsum.y * facialPlane.y;\n    const mag1 = Math.sqrt(nasalDorsum.x ** 2 + nasalDorsum.y ** 2);\n    const mag2 = Math.sqrt(facialPlane.x ** 2 + facialPlane.y ** 2);\n\n    if (mag1 > 0 && mag2 > 0) {\n      const angle = Math.acos(dot / (mag1 * mag2)) * (180 / Math.PI);\n      addMeasurement('nasofacialAngle', angle);\n    }\n  }\n\n  // MANDIBULAR PLANE ANGLE (using Frankfort horizontal)\n  if (porion && orbitale && gonionBottom && menton) {\n    // Frankfort horizontal is porion to orbitale\n    // Mandibular plane is gonion to menton\n    const fhAngle = Math.atan2(orbitale.y - porion.y, orbitale.x - porion.x);\n    const mpAngle = Math.atan2(menton.y - gonionBottom.y, menton.x - gonionBottom.x);\n    const angle = Math.abs(fhAngle - mpAngle) * (180 / Math.PI);\n    addMeasurement('mandibularPlaneAngle', angle);\n  }\n\n  // CHIN PROJECTION\n  if (pogonion && subnasale) {\n    // Distance from pogonion to vertical line through subnasale\n    const projection = pogonion.x - subnasale.x;\n    addMeasurement('chinProjection', projection);\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// COMPLETE HARMONY ANALYSIS\n// ============================================\n\n/**\n * Run complete facial harmony analysis.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeHarmony(\n  frontLandmarks: LandmarkPoint[],\n  sideLandmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): HarmonyAnalysis {\n  const frontResults = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n  const sideResults = analyzeSideProfile(sideLandmarks, gender, ethnicity);\n\n  const allMeasurements = [...frontResults.measurements, ...sideResults.measurements];\n\n  // Combined category scores\n  const allCategories: Record<string, { total: number; count: number }> = {};\n  for (const m of allMeasurements) {\n    if (!allCategories[m.category]) {\n      allCategories[m.category] = { total: 0, count: 0 };\n    }\n    allCategories[m.category].total += m.standardizedScore;\n    allCategories[m.category].count++;\n  }\n\n  const categoryScores: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(allCategories)) {\n    categoryScores[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Overall weighted score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of allMeasurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  // Identify flaws (below average measurements)\n  const flaws: FlawAssessment[] = allMeasurements\n    .filter((m) => m.severity !== 'optimal' && m.severity !== 'minor')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      severity: m.severity,\n      deviation: `${m.deviation.toFixed(2)} ${m.deviationDirection} ideal`,\n      reasoning: `${m.name} is outside the ideal range`,\n      confidence: m.severity === 'extremely_severe' || m.severity === 'severe'\n        ? 'confirmed' as const\n        : 'likely' as const,\n    }))\n    .sort((a, b) => {\n      const severityOrder = { extremely_severe: 0, severe: 1, major: 2, moderate: 3 };\n      return (severityOrder[a.severity as keyof typeof severityOrder] ?? 4) -\n             (severityOrder[b.severity as keyof typeof severityOrder] ?? 4);\n    });\n\n  // Identify strengths (ideal measurements)\n  const strengths: StrengthAssessment[] = allMeasurements\n    .filter((m) => m.qualityTier === 'ideal' || m.qualityTier === 'excellent')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      qualityTier: m.qualityTier,\n      value: m.value,\n      reasoning: `${m.name} is within the ${m.qualityTier} range`,\n    }));\n\n  // Calculate percentile (based on population stats)\n  const percentile = calculateHarmonyPercentile(overallScore);\n\n  return {\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    percentile,\n    frontScore: frontResults.overallScore,\n    sideScore: sideResults.overallScore,\n    categoryScores,\n    measurements: allMeasurements,\n    flaws,\n    strengths,\n  };\n}\n\n/**\n * Calculate percentile from harmony score\n */\nfunction calculateHarmonyPercentile(score: number): number {\n  // Based on normal distribution with mean=5, stdDev=1.5\n  const mean = 5;\n  const stdDev = 1.5;\n  const z = (score - mean) / stdDev;\n  return normalCDF(z) * 100;\n}\n\n/**\n * Standard normal CDF approximation\n */\nfunction normalCDF(z: number): number {\n  const a1 = 0.254829592;\n  const a2 = -0.284496736;\n  const a3 = 1.421413741;\n  const a4 = -1.453152027;\n  const a5 = 1.061405429;\n  const p = 0.3275911;\n\n  const sign = z < 0 ? -1 : 1;\n  const absZ = Math.abs(z) / Math.sqrt(2);\n\n  const t = 1.0 / (1.0 + p * absZ);\n  const y = 1.0 - ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-absZ * absZ);\n\n  return 0.5 * (1.0 + sign * y);\n}\n\n// ============================================\n// PSL RATING CONVERSION\n// ============================================\n\nexport interface PSLRating {\n  score: number;\n  tier: string;\n  percentile: number;\n  description: string;\n}\n\n/**\n * Convert harmony score to PSL rating\n */\nexport function convertToPSL(harmonyScore: number): PSLRating {\n  // Convert 0-10 harmony to 3.0-7.5 PSL range\n  const psl = 3.0 + (harmonyScore / 10) * 4.5;\n  const clampedPSL = Math.max(3.0, Math.min(7.5, psl));\n\n  let tier: string;\n  let percentile: number;\n\n  if (clampedPSL >= 7.5) {\n    tier = 'Top Model';\n    percentile = 99.99;\n  } else if (clampedPSL >= 7.0) {\n    tier = 'Chad';\n    percentile = 99.87;\n  } else if (clampedPSL >= 6.5) {\n    tier = 'Chadlite';\n    percentile = 99.0;\n  } else if (clampedPSL >= 6.0) {\n    tier = 'High Tier Normie+';\n    percentile = 97.25;\n  } else if (clampedPSL >= 5.5) {\n    tier = 'High Tier Normie';\n    percentile = 90.0;\n  } else if (clampedPSL >= 5.0) {\n    tier = 'Mid Tier Normie+';\n    percentile = 84.15;\n  } else if (clampedPSL >= 4.5) {\n    tier = 'Mid Tier Normie';\n    percentile = 65.0;\n  } else if (clampedPSL >= 4.0) {\n    tier = 'Low Tier Normie';\n    percentile = 50.0;\n  } else if (clampedPSL >= 3.5) {\n    tier = 'Below Average';\n    percentile = 30.0;\n  } else {\n    tier = 'Subpar';\n    percentile = 15.0;\n  }\n\n  return {\n    score: clampedPSL,\n    tier,\n    percentile,\n    description: `${tier} (top ${(100 - percentile).toFixed(1)}%)`,\n  };\n}\n\n// ============================================\n// EXPORTS FOR BACKWARD COMPATIBILITY\n// ============================================\n\nexport type { LandmarkPoint } from './landmarks';\n","structuredPatch":[{"oldStart":403,"oldLines":9,"newStart":403,"newLines":12,"lines":["   },"," ","   chinToPhiltrumRatio: {","+    // White: Neoclassical standard - strict balance between chin and philtrum","     // Black/African: Fuller lips naturally shorten visible philtrum","-    // Extracted from FaceIQ BlackAfrican.htc - relaxes \"Short Philtrum\" penalty","+    // Extracted from FaceIQ Male:White.htc (Neoclassical) and BlackAfrican.htc","     // Higher ratio = shorter philtrum (more acceptable in Black phenotype)","+    white_male: { idealMin: 2.10, idealMax: 2.30 },  // Neoclassical - strict lower face balance","+    white_female: { idealMin: 2.05, idealMax: 2.25 },","     black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum","     black_female: { idealMin: 2.10, idealMax: 2.65 },","   },"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"23bcc6f0-a1ea-448c-b982-4af55dd138da","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_011D6QyhuNGLWuwzC9ZYdp7a","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good! Now let me verify that gonialAngle and lateralCanthalTilt have the right values. Let me check what the current values are.","signature":"EqkCCkYIChgCKkDKYSsjbttuRINzjLSYQAt+B4qsJLJ0jOJzjrc4aqYVs5eZYdznXoXn/0G1g5QGPPojYQyoxiXPLU+h5BYVh+AkEgyChHAaBBG4+qICZ/8aDEkcUNo7YJPsq+2pkCIwVtMYojP6hJamid3uXpgvYYZxQ5qbtMEMwdPXx79D1pVuDPgCK/OI+Aw13V7f9d7uKpABn2j3Vgu+EIKHPWJq5g2uPbbyzjyC759ECIE3MCW75BYRoLLu8ItgfN/CKQuQvHI1IjJLJR0Y8D2b/epNK7tLZyGcLjKn+yaMhi0Jiq4aoc9SIRj1jKFvYM2brdKHoZOs365dRQ3XhZCbe9CSNF8Po0ERUNYNSi8LzAsqRm9A75Nz+bFe+ZAcfDF1ZBZuCI0TGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":959,"cache_read_input_tokens":43497,"cache_creation":{"ephemeral_5m_input_tokens":959,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDSvAsLkPCeaCMevVcm","type":"assistant","uuid":"73de692e-4f8e-44dd-a755-4087ead7d600","timestamp":"2025-12-21T17:19:51.997Z"}
{"parentUuid":"73de692e-4f8e-44dd-a755-4087ead7d600","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_011D6QyhuNGLWuwzC9ZYdp7a","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016RCxy9QkdksjXUToW9tWfo","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","offset":262,"limit":30}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":959,"cache_read_input_tokens":43497,"cache_creation":{"ephemeral_5m_input_tokens":959,"ephemeral_1h_input_tokens":0},"output_tokens":158,"service_tier":"standard"}},"requestId":"req_011CWLDSvAsLkPCeaCMevVcm","type":"assistant","uuid":"2c63b189-13ec-4b70-bff9-2dcd7f731d0d","timestamp":"2025-12-21T17:19:52.787Z"}
{"parentUuid":"2c63b189-13ec-4b70-bff9-2dcd7f731d0d","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016RCxy9QkdksjXUToW9tWfo","type":"tool_result","content":"   262â†’\n   263â†’  jawWidthRatio: {\n   264â†’    // Males have stronger jaw width preference\n   265â†’    male: { idealMin: 0.78, idealMax: 0.85 },\n   266â†’    female: { idealMin: 0.72, idealMax: 0.80 },\n   267â†’  },\n   268â†’\n   269â†’  gonialAngle: {\n   270â†’    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n   271â†’    male: { idealMin: 115, idealMax: 125 },\n   272â†’    female: { idealMin: 120, idealMax: 135 },\n   273â†’  },\n   274â†’\n   275â†’  // ==========================================\n   276â†’  // EYE METRICS - Ethnic variation\n   277â†’  // ==========================================\n   278â†’  lateralCanthalTilt: {\n   279â†’    // East Asian: naturally higher positive tilt\n   280â†’    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n   281â†’    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n   282â†’    // Extracted from FaceIQ Male:MiddleEastern.htc\n   283â†’    east_asian_male: { idealMin: 8, idealMax: 12 },\n   284â†’    east_asian_female: { idealMin: 9, idealMax: 13 },\n   285â†’    south_asian_male: { idealMin: 6, idealMax: 10 },\n   286â†’    south_asian_female: { idealMin: 7, idealMax: 11 },\n   287â†’    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n   288â†’    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n   289â†’    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n   290â†’    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n   291â†’    // Default for others is 4-8 (already in FACEIQ_METRICS)\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"813833d4-9679-4167-8581-140c68de49af","timestamp":"2025-12-21T17:19:52.835Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","content":"\n  jawWidthRatio: {\n    // Males have stronger jaw width preference\n    male: { idealMin: 0.78, idealMax: 0.85 },\n    female: { idealMin: 0.72, idealMax: 0.80 },\n  },\n\n  gonialAngle: {\n    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n    male: { idealMin: 115, idealMax: 125 },\n    female: { idealMin: 120, idealMax: 135 },\n  },\n\n  // ==========================================\n  // EYE METRICS - Ethnic variation\n  // ==========================================\n  lateralCanthalTilt: {\n    // East Asian: naturally higher positive tilt\n    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian_male: { idealMin: 8, idealMax: 12 },\n    east_asian_female: { idealMin: 9, idealMax: 13 },\n    south_asian_male: { idealMin: 6, idealMax: 10 },\n    south_asian_female: { idealMin: 7, idealMax: 11 },\n    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n    // Default for others is 4-8 (already in FACEIQ_METRICS)","numLines":30,"startLine":262,"totalLines":3159}}}
{"parentUuid":"813833d4-9679-4167-8581-140c68de49af","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01GjM7vRjWFkD1P7eiidngvN","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect! The gonialAngle already has male: { idealMin: 115, idealMax: 125 } which matches the White standard exactly. And lateralCanthalTilt says \"Default for others is 4-8\" which matches the user's requirement.Let me verify in the FACEIQ_METRICS that the defaults are set correctly. But wait, I should add explicit white_male entries for these to make it clear that these are the Neoclassical standards, not just generic male defaults. This will make the code more explicit and easier to understand.","signature":"Ep0FCkYIChgCKkAT5o6Eor+CIseIyK8/2Y+aqeiN03AE4+VudCPn2iuDniFa1zMBF3ko7xvV2rrh2E2JIVBVIVyThCjI9cgscnE7EgzbCEPb6aSWmubXfb8aDGOQYMWzoqvCb69BJSIwCkJmPHpQg24x9G5pJ/6gbrwshq9fB9HO2WjDv0A6BG4f8QYMa8ype8uc8jNyFNbyKoQEhw4xdO4OQ5Hci4fIuobY2b1eM5n48JTzuGcsKGfY8IN3DVSgvhIFugMQrifwXiZU2f3Rg5eHp3n9kbkw9KgRXN7q9Rl/HnUBR7yo6A5dN8I0K/47vbNZ5wrHaDee5RIu+NZBnBjBix5aw058ATnyr6vfSgN456sWU9J/qjvlXy7fbyS/pKW9NFSTTiSUvCoaBY8RQ4qW7GokssEShF/HCxeOHc5h2ZDCQGUcyL91SoF4C3LCrB4OLB6G5RvnfUtstPf6cCADToj9p1v6/RslKwAAEa/gpRUmeMPFtub7pPM4u9h5Brv5EvmLs7IAhQDuZHv78Lx6POueBc3bh91Y18tNkBKpOSy3XxMLrdE8GgLQxmC/N6ymm7Enn8hmbf10+WRd2DXUTuvINYujQWtyDTM44W0FYZe5jfzjpuY+adqGJ/YWDNU4miDrgizuoieKM0vWIVt6UlbFG06StCzncKTh2biYpvJIXFX3KY6ALNZRFyBL+/Y7sRCbjlRIec2/dxFTO+QOjZYeZ+8t3XhlCY09QKOEWOQlqhN0SrkkTl1wkYKYKvCn8rupi7bzYw6zjK7Zq5eNxCtfS6jEDJiuxZWCi26gniqVoncSKkirImVj44AFBw13gydBQTP/QYFtvRlEGW0QZSJYykL3LICqcdqPav7NfQJJ3Z1NhZwdHbHr2WfWGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":826,"cache_read_input_tokens":44456,"cache_creation":{"ephemeral_5m_input_tokens":826,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDTKvNNEjVasqPdYK1G","type":"assistant","uuid":"1e61f1e7-dbb1-45a3-86d5-b70bb2b2f21d","timestamp":"2025-12-21T17:20:01.994Z"}
{"parentUuid":"1e61f1e7-dbb1-45a3-86d5-b70bb2b2f21d","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01GjM7vRjWFkD1P7eiidngvN","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JpSMJqZmhpc9Sg9zHGjmnB","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","old_string":"  gonialAngle: {\n    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n    male: { idealMin: 115, idealMax: 125 },\n    female: { idealMin: 120, idealMax: 135 },\n  },","new_string":"  gonialAngle: {\n    // White: Neoclassical standard - square, vertically robust jaw (115-125Â°)\n    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n    // Extracted from FaceIQ Male:White.htc\n    white_male: { idealMin: 115, idealMax: 125 },  // Neoclassical square jaw - less tolerant of soft/V-shaped jaws\n    white_female: { idealMin: 120, idealMax: 132 },\n    male: { idealMin: 115, idealMax: 125 },\n    female: { idealMin: 120, idealMax: 135 },\n  },"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":8,"cache_creation_input_tokens":826,"cache_read_input_tokens":44456,"cache_creation":{"ephemeral_5m_input_tokens":826,"ephemeral_1h_input_tokens":0},"output_tokens":487,"service_tier":"standard"}},"requestId":"req_011CWLDTKvNNEjVasqPdYK1G","type":"assistant","uuid":"e4be9887-824b-457a-8885-c266fa1f2527","timestamp":"2025-12-21T17:20:06.076Z"}
{"parentUuid":"e4be9887-824b-457a-8885-c266fa1f2527","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JpSMJqZmhpc9Sg9zHGjmnB","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   265â†’    male: { idealMin: 0.78, idealMax: 0.85 },\n   266â†’    female: { idealMin: 0.72, idealMax: 0.80 },\n   267â†’  },\n   268â†’\n   269â†’  gonialAngle: {\n   270â†’    // White: Neoclassical standard - square, vertically robust jaw (115-125Â°)\n   271â†’    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n   272â†’    // Extracted from FaceIQ Male:White.htc\n   273â†’    white_male: { idealMin: 115, idealMax: 125 },  // Neoclassical square jaw - less tolerant of soft/V-shaped jaws\n   274â†’    white_female: { idealMin: 120, idealMax: 132 },\n   275â†’    male: { idealMin: 115, idealMax: 125 },\n   276â†’    female: { idealMin: 120, idealMax: 135 },\n   277â†’  },\n   278â†’\n   279â†’  // ==========================================\n   280â†’  // EYE METRICS - Ethnic variation\n   281â†’  // =========================================="}]},"uuid":"69254640-1590-4258-95f9-abb83b110f95","timestamp":"2025-12-21T17:20:06.101Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","oldString":"  gonialAngle: {\n    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n    male: { idealMin: 115, idealMax: 125 },\n    female: { idealMin: 120, idealMax: 135 },\n  },","newString":"  gonialAngle: {\n    // White: Neoclassical standard - square, vertically robust jaw (115-125Â°)\n    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n    // Extracted from FaceIQ Male:White.htc\n    white_male: { idealMin: 115, idealMax: 125 },  // Neoclassical square jaw - less tolerant of soft/V-shaped jaws\n    white_female: { idealMin: 120, idealMax: 132 },\n    male: { idealMin: 115, idealMax: 125 },\n    female: { idealMin: 120, idealMax: 135 },\n  },","originalFile":"/**\n * FaceIQ-Style Facial Analysis Scoring System\n * Complete replication of FaceIQ Labs scoring algorithms\n *\n * Features:\n * - Exponential decay scoring with per-metric decay rates\n * - Bezier curve custom scoring for non-linear measurements\n * - 70+ facial measurements (front + side profiles)\n * - Quality tiers: Ideal, Excellent, Good\n * - 5-tier severity: Extremely Severe, Severe, Major, Moderate, Minor\n */\n\nimport { LandmarkPoint } from './landmarks';\n\n// ============================================\n// CORE TYPES\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\n/**\n * Polarity defines how deviation from the ideal range is interpreted:\n * - 'balanced': Default. Deviation in either direction is equally bad.\n * - 'higher_is_better': Values above the ideal are still good. Only values below\n *   the 'safeFloor' are true weaknesses. E.g., Canthal Tilt (positive tilt is good)\n * - 'lower_is_better': Values below the ideal are still good. Only values above\n *   the 'safeCeiling' are true weaknesses. E.g., Philtrum length (shorter is better)\n */\nexport type MetricPolarity = 'balanced' | 'higher_is_better' | 'lower_is_better';\n\nexport interface MetricConfig {\n  id: string;\n  name: string;\n  category: string;\n  unit: MeasurementUnit;\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  decayRate: number;\n  maxScore: number;\n  weight: number;\n  description: string;\n  profileType: 'front' | 'side';\n  customCurve?: BezierCurveConfig;\n  /**\n   * Polarity for directional/dimorphic scoring.\n   * Defaults to 'balanced' if not specified.\n   */\n  polarity?: MetricPolarity;\n  /**\n   * For 'higher_is_better': minimum value that's still acceptable.\n   * Values above this but below idealMin get a passing score (softFloorScore).\n   * Values below this are true weaknesses.\n   */\n  safeFloor?: number;\n  /**\n   * For 'lower_is_better': maximum value that's still acceptable.\n   * Values below this but above idealMax get a passing score (softCeilingScore).\n   * Values above this are true weaknesses.\n   */\n  safeCeiling?: number;\n  /**\n   * Score given to values in the \"acceptable but not ideal\" zone.\n   * Defaults to 8.0 (Good). Range: 6.0-9.0\n   */\n  softZoneScore?: number;\n}\n\nexport interface BezierCurveConfig {\n  mode: 'custom' | 'exponential';\n  points: CurvePoint[];\n}\n\nexport interface CurvePoint {\n  x: number;\n  y: number;\n  leftHandleX?: number;\n  leftHandleY?: number;\n  rightHandleX?: number;\n  rightHandleY?: number;\n  fixed?: boolean;\n}\n\nexport interface FaceIQScoreResult {\n  metricId: string;\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  severity: SeverityLevel;\n  idealMin: number;\n  idealMax: number;\n  deviation: number;\n  deviationDirection: 'above' | 'below' | 'within';\n  unit: MeasurementUnit;\n  category: string;\n  percentile?: number;\n}\n\nexport interface HarmonyAnalysis {\n  overallScore: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  percentile: number;\n  frontScore: number;\n  sideScore: number;\n  categoryScores: Record<string, number>;\n  measurements: FaceIQScoreResult[];\n  flaws: FlawAssessment[];\n  strengths: StrengthAssessment[];\n}\n\nexport interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n}\n\nexport interface StrengthAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  qualityTier: QualityTier;\n  value: number;\n  reasoning: string;\n}\n\n// ============================================\n// DEMOGRAPHIC TYPES & OVERRIDES\n// ============================================\n\nexport type Ethnicity =\n  | 'east_asian'\n  | 'south_asian'\n  | 'black'\n  | 'hispanic'\n  | 'middle_eastern'\n  | 'native_american'\n  | 'pacific_islander'\n  | 'white'\n  | 'other';\n\nexport type Gender = 'male' | 'female';\n\nexport type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n\nexport interface DemographicOverride {\n  idealMin: number;\n  idealMax: number;\n}\n\n/**\n * Demographic-specific ideal ranges based on anthropometric research.\n * FaceIQ uses universal scoring, but this gives more accurate assessments\n * by adjusting ideals based on ethnicity and gender.\n */\nexport const DEMOGRAPHIC_OVERRIDES: Record<string, Partial<Record<DemographicKey, DemographicOverride>>> = {\n  // ==========================================\n  // NOSE METRICS - Highest ethnicity variation\n  // ==========================================\n  nasalIndex: {\n    // Nasal Index = (Nose Width / Nose Height) Ã— 100\n    // Research: African/Pacific Islander tend platyrrhine (85-100), Asian mesorrhine (75-88), European leptorrhine (65-75)\n    east_asian_male: { idealMin: 78, idealMax: 88 },\n    east_asian_female: { idealMin: 76, idealMax: 86 },\n    south_asian_male: { idealMin: 72, idealMax: 82 },\n    south_asian_female: { idealMin: 70, idealMax: 80 },\n    black_male: { idealMin: 85, idealMax: 100 },\n    black_female: { idealMin: 83, idealMax: 98 },\n    hispanic_male: { idealMin: 75, idealMax: 87 },\n    hispanic_female: { idealMin: 73, idealMax: 85 },\n    middle_eastern_male: { idealMin: 68, idealMax: 78 },\n    middle_eastern_female: { idealMin: 66, idealMax: 76 },\n    white_male: { idealMin: 65, idealMax: 75 },\n    white_female: { idealMin: 63, idealMax: 73 },\n    native_american_male: { idealMin: 72, idealMax: 82 },\n    native_american_female: { idealMin: 70, idealMax: 80 },\n    pacific_islander_male: { idealMin: 82, idealMax: 95 },\n    pacific_islander_female: { idealMin: 80, idealMax: 93 },\n  },\n\n  nasolabialAngle: {\n    // Ideal nasolabial angle varies by ethnicity\n    // African: slightly more obtuse, European: slightly more acute\n    // Middle Eastern: Penalizes droopy tip (<90Â°) - common flaw is \"Hooked Nose\"\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    black_male: { idealMin: 95, idealMax: 110 },\n    black_female: { idealMin: 100, idealMax: 115 },\n    east_asian_male: { idealMin: 90, idealMax: 105 },\n    east_asian_female: { idealMin: 95, idealMax: 110 },\n    middle_eastern_male: { idealMin: 90, idealMax: 100 },  // Strict on droopy tip\n    middle_eastern_female: { idealMin: 95, idealMax: 105 },\n    // Gender-only fallbacks\n    male: { idealMin: 90, idealMax: 100 },\n    female: { idealMin: 100, idealMax: 110 },\n  },\n\n  nasalProjection: {\n    // Nose projection relative to face depth\n    // East Asian/African: typically less projection is ideal\n    // Middle Eastern: Accepts stronger projection (bigger nose) than White model\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian: { idealMin: 0.54, idealMax: 0.60 },\n    black: { idealMin: 0.52, idealMax: 0.58 },\n    south_asian: { idealMin: 0.56, idealMax: 0.62 },\n    middle_eastern: { idealMin: 0.62, idealMax: 0.70 },  // Higher tolerance for larger noses\n    white: { idealMin: 0.60, idealMax: 0.67 },\n    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },\n  },\n\n  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Pacific Islander: Similar to Black model, accepts wide nasal base\n    // Extracted from FaceIQ BlackAfrican.htc and Male:Pacific Islander.htc logic\n    white_male: { idealMin: 1.00, idealMax: 1.04 },\n    white_female: { idealMin: 0.98, idealMax: 1.02 },\n    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n    black_female: { idealMin: 1.13, idealMax: 1.23 },\n    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n    pacific_islander_male: { idealMin: 1.10, idealMax: 1.20 },  // Wide tolerance, similar to Black model\n    pacific_islander_female: { idealMin: 1.08, idealMax: 1.18 },\n  },\n\n  // ==========================================\n  // JAW METRICS - Clear gender dimorphism\n  // ==========================================\n  bigonialWidth: {\n    // Jaw width as % of bizygomatic width\n    // Males: wider, more angular; Females: narrower, softer\n    // Pacific Islander: Extremely wide jaw preferred - \"Warrior Skull\" robustness\n    // Extracted from FaceIQ Male:Pacific Islander.htc\n    male: { idealMin: 90, idealMax: 95 },\n    female: { idealMin: 85, idealMax: 90 },\n    pacific_islander_male: { idealMin: 92, idealMax: 98 },  // Jaw width rivals cheekbone width - extreme robustness\n    pacific_islander_female: { idealMin: 88, idealMax: 94 },\n  },\n\n  jawFrontalAngle: {\n    // More angular in males, softer in females\n    male: { idealMin: 88, idealMax: 95 },\n    female: { idealMin: 82, idealMax: 90 },\n  },\n\n  jawWidthRatio: {\n    // Males have stronger jaw width preference\n    male: { idealMin: 0.78, idealMax: 0.85 },\n    female: { idealMin: 0.72, idealMax: 0.80 },\n  },\n\n  gonialAngle: {\n    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n    male: { idealMin: 115, idealMax: 125 },\n    female: { idealMin: 120, idealMax: 135 },\n  },\n\n  // ==========================================\n  // EYE METRICS - Ethnic variation\n  // ==========================================\n  lateralCanthalTilt: {\n    // East Asian: naturally higher positive tilt\n    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian_male: { idealMin: 8, idealMax: 12 },\n    east_asian_female: { idealMin: 9, idealMax: 13 },\n    south_asian_male: { idealMin: 6, idealMax: 10 },\n    south_asian_female: { idealMin: 7, idealMax: 11 },\n    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n    // Default for others is 4-8 (already in FACEIQ_METRICS)\n  },\n\n  eyeAspectRatio: {\n    // East Asian eyes often have different aspect ratio due to epicanthal fold\n    east_asian_male: { idealMin: 2.6, idealMax: 3.2 },\n    east_asian_female: { idealMin: 2.7, idealMax: 3.3 },\n    // Larger eyes in females considered more attractive\n    male: { idealMin: 2.9, idealMax: 3.4 },\n    female: { idealMin: 3.1, idealMax: 3.6 },\n  },\n\n  tearTroughDepth: {\n    // Under-eye hollowing and dark circles (infraorbital depression)\n    // South Asian: MUCH stricter penalty due to genetic hyperpigmentation\n    // Extracted from FaceIQ Male:SouthAsian.htc - biggest difference vs White model\n    white_male: { idealMin: 0.0, idealMax: 1.5 },\n    white_female: { idealMin: 0.0, idealMax: 1.3 },\n    south_asian_male: { idealMin: 0.0, idealMax: 0.5 },  // VERY strict - 0.5+ triggers \"Tired/Aged Eyes\" flaw\n    south_asian_female: { idealMin: 0.0, idealMax: 0.4 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.2 },\n    east_asian_female: { idealMin: 0.0, idealMax: 1.0 },\n  },\n\n  upperEyelidExposure: {\n    // Visible eyelid platform (space between eyelash and crease)\n    // South Asian ideal: prefers visible lid platform, penalizes hooded eyes more than White model\n    // Extracted from FaceIQ Male:SouthAsian.htc\n    white_male: { idealMin: 0.3, idealMax: 2.5 },\n    white_female: { idealMin: 0.5, idealMax: 3.0 },\n    south_asian_male: { idealMin: 0.5, idealMax: 2.0 },  // Prefers visible lid, penalizes hooding\n    south_asian_female: { idealMin: 0.7, idealMax: 2.2 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.5 },  // More tolerance for less exposure\n    east_asian_female: { idealMin: 0.2, idealMax: 1.8 },\n  },\n\n  // ==========================================\n  // FACE PROPORTIONS - Gender variation\n  // ==========================================\n  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n  },\n\n  totalFacialWidthToHeight: {\n    male: { idealMin: 1.35, idealMax: 1.40 },\n    female: { idealMin: 1.32, idealMax: 1.37 },\n  },\n\n  midfaceRatio: {\n    // Females often have more compact midface\n    // White: Neoclassical standard - strict compact midface preference\n    // Middle Eastern: Similar to White model - compact is better\n    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:MiddleEastern.htc\n    white_male: { idealMin: 0.95, idealMax: 1.02 },  // Neoclassical - penalizes long midface heavily\n    white_female: { idealMin: 0.93, idealMax: 1.00 },\n    male: { idealMin: 0.98, idealMax: 1.02 },\n    female: { idealMin: 0.95, idealMax: 1.00 },\n    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n  },\n\n  // ==========================================\n  // LIP METRICS - Ethnicity variation\n  // ==========================================\n  lipRatio: {\n    // African/Hispanic: fuller lips natural\n    black_male: { idealMin: 1.6, idealMax: 2.2 },\n    black_female: { idealMin: 1.7, idealMax: 2.3 },\n    hispanic_male: { idealMin: 1.4, idealMax: 2.0 },\n    hispanic_female: { idealMin: 1.5, idealMax: 2.1 },\n    // East Asian: less full lips\n    east_asian_male: { idealMin: 1.2, idealMax: 1.7 },\n    east_asian_female: { idealMin: 1.3, idealMax: 1.8 },\n    // Default\n    male: { idealMin: 1.3, idealMax: 1.8 },\n    female: { idealMin: 1.4, idealMax: 2.0 },\n  },\n\n  upperLipRatio: {\n    // Fuller upper lip in African phenotypes\n    black: { idealMin: 0.38, idealMax: 0.48 },\n    hispanic: { idealMin: 0.36, idealMax: 0.45 },\n    east_asian: { idealMin: 0.32, idealMax: 0.40 },\n    female: { idealMin: 0.34, idealMax: 0.42 },\n  },\n\n  // ==========================================\n  // PROFILE METRICS - Gender & ethnicity\n  // ==========================================\n  chinProjection: {\n    // Males: more projected chin ideal\n    // Black/African: Adjusted for bimaxillary prognathism (forward mouth projection)\n    // Extracted from FaceIQ BlackAfrican.htc logic\n    male: { idealMin: 0, idealMax: 3 },\n    female: { idealMin: -2, idealMax: 2 },\n    black_male: { idealMin: 0, idealMax: 4 },  // Accommodates natural forward projection\n    black_female: { idealMin: -1, idealMax: 3 },\n  },\n\n  nasofrontalAngle: {\n    // Higher brow ridge in males\n    male: { idealMin: 128, idealMax: 138 },\n    female: { idealMin: 132, idealMax: 142 },\n  },\n\n  chinToPhiltrumRatio: {\n    // White: Neoclassical standard - strict balance between chin and philtrum\n    // Black/African: Fuller lips naturally shorten visible philtrum\n    // Extracted from FaceIQ Male:White.htc (Neoclassical) and BlackAfrican.htc\n    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n    white_male: { idealMin: 2.10, idealMax: 2.30 },  // Neoclassical - strict lower face balance\n    white_female: { idealMin: 2.05, idealMax: 2.25 },\n    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n    black_female: { idealMin: 2.10, idealMax: 2.65 },\n  },\n\n  // ==========================================\n  // SKIN QUALITY - Ethnicity variation\n  // ==========================================\n  skinUniformity: {\n    // South Asian: Stricter standards due to genetic hyperpigmentation tendency\n    // Hispanic: Similar to South Asian - penalizes hyperpigmentation more than White model\n    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n    white_male: { idealMin: 0.88, idealMax: 1.00 },\n    white_female: { idealMin: 0.90, idealMax: 1.00 },\n    south_asian_male: { idealMin: 0.90, idealMax: 1.00 },  // Stricter - hyperpigmentation common\n    south_asian_female: { idealMin: 0.92, idealMax: 1.00 },\n    east_asian_male: { idealMin: 0.92, idealMax: 1.00 },  // High skin quality standards\n    east_asian_female: { idealMin: 0.94, idealMax: 1.00 },\n    black_male: { idealMin: 0.85, idealMax: 1.00 },  // More tolerance for melanin variation\n    black_female: { idealMin: 0.87, idealMax: 1.00 },\n    hispanic_male: { idealMin: 0.85, idealMax: 1.00 },  // Bridge: more tolerance than South Asian, less than White\n    hispanic_female: { idealMin: 0.87, idealMax: 1.00 },\n  },\n\n  // ==========================================\n  // EYEBROW METRICS - Ethnicity variation\n  // ==========================================\n  eyebrowThickness: {\n    // Middle Eastern: Heavily favors thick, dense eyebrows (\"Dark Triad\" look with deep-set eyes)\n    // Extracted from FaceIQ Male:MiddleEastern.htc - STRICTEST eyebrow requirements\n    middle_eastern_male: { idealMin: 2.5, idealMax: 5.0 },  // Prefers significantly thicker/darker brows\n    middle_eastern_female: { idealMin: 2.0, idealMax: 4.0 },\n    east_asian_male: { idealMin: 1.5, idealMax: 3.0 },  // Typically less thick\n    east_asian_female: { idealMin: 1.3, idealMax: 2.5 },\n    male: { idealMin: 2.0, idealMax: 4.0 },\n    female: { idealMin: 1.8, idealMax: 3.5 },\n  },\n\n  eyebrowDistance: {\n    // Middle Eastern: \"Kill Switch\" for unibrow (synophrys)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    // While thick brows are favored, unibrow is a critical flaw if distance < 15mm\n    middle_eastern_male: { idealMin: 15, idealMax: 25 },  // Stricter minimum to avoid unibrow\n    middle_eastern_female: { idealMin: 18, idealMax: 28 },\n    male: { idealMin: 15, idealMax: 25 },\n    female: { idealMin: 16, idealMax: 26 },\n  },\n\n  orbitalVector: {\n    // Middle Eastern: Favors deep-set eyes (lower/negative orbital vector)\n    // Part of the \"Dark Triad\" look with heavy brows\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    middle_eastern_male: { idealMin: -2, idealMax: 3 },  // Allows more deep-set eyes\n    middle_eastern_female: { idealMin: -1, idealMax: 4 },\n    male: { idealMin: 0, idealMax: 4 },\n    female: { idealMin: 1, idealMax: 5 },\n  },\n};\n\n/**\n * Get metric configuration with demographic-specific overrides applied.\n * Lookup priority: ethnicity_gender > gender > ethnicity > default\n */\nexport function getMetricConfigForDemographics(\n  metricId: string,\n  gender: Gender,\n  ethnicity: Ethnicity = 'other'\n): MetricConfig | null {\n  const baseConfig = FACEIQ_METRICS[metricId];\n  if (!baseConfig) return null;\n\n  const overrides = DEMOGRAPHIC_OVERRIDES[metricId];\n  if (!overrides) return baseConfig;\n\n  // Try specific combo first (e.g., \"east_asian_male\")\n  const specificKey = `${ethnicity}_${gender}` as DemographicKey;\n  const override = overrides[specificKey] || overrides[gender] || overrides[ethnicity];\n\n  if (!override) return baseConfig;\n\n  return {\n    ...baseConfig,\n    idealMin: override.idealMin,\n    idealMax: override.idealMax,\n  };\n}\n\n// ============================================\n// FACEIQ MEASUREMENT CONFIGURATIONS (70+)\n// ============================================\n\nexport const FACEIQ_METRICS: Record<string, MetricConfig> = {\n  // ==========================================\n  // FRONT PROFILE - FACIAL PROPORTIONS (32)\n  // ==========================================\n\n  faceWidthToHeight: {\n    id: 'faceWidthToHeight',\n    name: 'Face Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.96,\n    idealMax: 2.0,\n    rangeMin: 1.4,\n    rangeMax: 2.5,\n    decayRate: 6.4,\n    maxScore: 30,  // FaceIQ: highest priority metric\n    weight: 0.06,\n    description: 'Ratio of bizygomatic width to upper face height',\n    profileType: 'front',\n  },\n\n  lowerThirdProportion: {\n    id: 'lowerThirdProportion',\n    name: 'Lower Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31,\n    idealMax: 33.5,\n    rangeMin: 24,\n    rangeMax: 40,\n    decayRate: 1.86,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by lower third (subnasale to menton)',\n    profileType: 'front',\n  },\n\n  middleThirdProportion: {\n    id: 'middleThirdProportion',\n    name: 'Middle Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31.4,\n    idealMax: 33.4,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by middle third',\n    profileType: 'front',\n  },\n\n  upperThirdProportion: {\n    id: 'upperThirdProportion',\n    name: 'Upper Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 30,\n    idealMax: 32,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Percentage of face occupied by upper third (trichion to glabella)',\n    profileType: 'front',\n  },\n\n  bitemporalWidth: {\n    id: 'bitemporalWidth',\n    name: 'Bitemporal Width',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 75,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Temple width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  cheekboneHeight: {\n    id: 'cheekboneHeight',\n    name: 'Cheekbone Height',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 83,\n    idealMax: 100,\n    rangeMin: 30,\n    rangeMax: 140,\n    decayRate: 0.5,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Vertical position of cheekbones relative to face height',\n    profileType: 'front',\n  },\n\n  totalFacialWidthToHeight: {\n    id: 'totalFacialWidthToHeight',\n    name: 'Total Facial Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.34,\n    idealMax: 1.37,\n    rangeMin: 1.0,\n    rangeMax: 1.7,\n    decayRate: 13.2,\n    maxScore: 25,  // Special: higher max score\n    weight: 0.05,\n    description: 'Total face height divided by cheek width',\n    profileType: 'front',\n    customCurve: {\n      mode: 'custom',\n      points: [\n        { x: 1.05, y: 0 },\n        { x: 1.17, y: 1.41 },\n        { x: 1.25, y: 3.86 },\n        { x: 1.29, y: 6.01 },\n        { x: 1.32, y: 8.88 },\n        { x: 1.34, y: 10, fixed: true },\n        { x: 1.37, y: 10, fixed: true },\n        { x: 1.39, y: 8.88 },\n        { x: 1.42, y: 6.01 },\n        { x: 1.46, y: 3.86 },\n        { x: 1.54, y: 1.41 },\n        { x: 1.66, y: 0 },\n      ],\n    },\n  },\n\n  midfaceRatio: {\n    id: 'midfaceRatio',\n    name: 'Midface Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 0.97,\n    idealMax: 1.0,\n    rangeMin: 0.5,\n    rangeMax: 1.5,\n    decayRate: 31.6,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.04,\n    description: 'Midface width to height ratio for facial balance',\n    profileType: 'front',\n  },\n\n  // JAW MEASUREMENTS\n  jawSlope: {\n    id: 'jawSlope',\n    name: 'Jaw Slope',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 140,\n    idealMax: 142.5,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of the jawline from gonion to chin',\n    profileType: 'front',\n  },\n\n  jawFrontalAngle: {\n    id: 'jawFrontalAngle',\n    name: 'Jaw Frontal Angle',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 35,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 20,  // FaceIQ: high priority\n    weight: 0.04,\n    description: 'Angle of jaw corners from frontal view',\n    profileType: 'front',\n  },\n\n  bigonialWidth: {\n    id: 'bigonialWidth',\n    name: 'Bigonial Width',\n    category: 'Jaw Shape',\n    unit: 'percent',\n    idealMin: 87.75,\n    idealMax: 91.75,\n    rangeMin: 60.25,\n    rangeMax: 120.25,\n    decayRate: 0.9,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Jaw width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  jawWidthRatio: {\n    id: 'jawWidthRatio',\n    name: 'Jaw Width to Face Width Ratio',\n    category: 'Jaw Shape',\n    unit: 'ratio',\n    idealMin: 0.75,\n    idealMax: 0.82,\n    rangeMin: 0.6,\n    rangeMax: 0.95,\n    decayRate: 25.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Bigonial width divided by bizygomatic width',\n    profileType: 'front',\n  },\n\n  // EYE MEASUREMENTS\n  lateralCanthalTilt: {\n    id: 'lateralCanthalTilt',\n    name: 'Lateral Canthal Tilt',\n    category: 'Eyes',\n    unit: 'degrees',\n    idealMin: 4.0,   // Updated: 4-8Â° is peak \"hunter eyes\"\n    idealMax: 8.0,\n    rangeMin: -5,\n    rangeMax: 20,\n    decayRate: 1.5,  // Reduced: gentler decay for positive tilts\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle of eye from inner to outer canthus. Positive tilt is attractive.',\n    profileType: 'front',\n    // DIRECTIONAL SCORING: Higher (positive) tilt is better\n    // - Ideal: 4-8Â° (attractive upswept eyes / \"hunter eyes\")\n    // - Good: 0-4Â° (neutral to slight positive - still attractive)\n    // - Weak: < 0Â° (negative/droopy tilt - only this is a true weakness)\n    polarity: 'higher_is_better',\n    safeFloor: 0.0,       // Neutral tilt - anything above is acceptable\n    softZoneScore: 8.0,   // \"Good\" score for 0-4Â° range\n  },\n\n  eyeAspectRatio: {\n    id: 'eyeAspectRatio',\n    name: 'Eye Aspect Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 3.0,\n    idealMax: 3.5,\n    rangeMin: 0.8,\n    rangeMax: 6,\n    decayRate: 2.0,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Eye width divided by eye height',\n    profileType: 'front',\n  },\n\n  eyeSeparationRatio: {\n    id: 'eyeSeparationRatio',\n    name: 'Eye Separation Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 45.7,\n    idealMax: 46.8,\n    rangeMin: 35,\n    rangeMax: 55,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Intercanthal distance as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryRatio: {\n    id: 'interpupillaryRatio',\n    name: 'Interpupillary Distance Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 44,\n    idealMax: 48,\n    rangeMin: 38,\n    rangeMax: 54,\n    decayRate: 1.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'IPD as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryMouthWidthRatio: {\n    id: 'interpupillaryMouthWidthRatio',\n    name: 'Interpupillary-Mouth Width Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.83,\n    idealMax: 0.87,\n    rangeMin: 0.6,\n    rangeMax: 1.1,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Mouth width divided by interpupillary distance',\n    profileType: 'front',\n  },\n\n  oneEyeApartTest: {\n    id: 'oneEyeApartTest',\n    name: 'One Eye Apart Test',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.95,\n    idealMax: 1.0,\n    rangeMin: 0.7,\n    rangeMax: 1.3,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Intercanthal distance should equal one eye width',\n    profileType: 'front',\n  },\n\n  tearTroughDepth: {\n    id: 'tearTroughDepth',\n    name: 'Tear Trough Depth',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.0,\n    idealMax: 1.5,\n    rangeMin: 0.0,\n    rangeMax: 4.0,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Under-eye hollow depth (infraorbital depression). Lower is better for youthfulness.',\n    profileType: 'front',\n    polarity: 'lower_is_better',\n    safeCeiling: 1.5,  // White standard\n    softZoneScore: 7.5,\n  },\n\n  upperEyelidExposure: {\n    id: 'upperEyelidExposure',\n    name: 'Upper Eyelid Exposure',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 2.5,\n    rangeMin: 0.0,\n    rangeMax: 5.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Visible upper eyelid platform. Too little creates hooded eyes.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  // EYEBROW MEASUREMENTS\n  eyebrowThickness: {\n    id: 'eyebrowThickness',\n    name: 'Eyebrow Thickness',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 2.0,\n    idealMax: 4.0,\n    rangeMin: 1.0,\n    rangeMax: 6.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow density and thickness. Higher values indicate fuller, denser brows.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  eyebrowDistance: {\n    id: 'eyebrowDistance',\n    name: 'Inter-Eyebrow Distance',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 15,\n    idealMax: 25,\n    rangeMin: 5,\n    rangeMax: 40,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance between inner edges of eyebrows. Too low creates unibrow (synophrys).',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  browLengthRatio: {\n    id: 'browLengthRatio',\n    name: 'Brow Length to Face Width Ratio',\n    category: 'Upper Third',\n    unit: 'percent',\n    idealMin: 28,\n    idealMax: 32,\n    rangeMin: 20,\n    rangeMax: 40,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow length as percentage of face width',\n    profileType: 'front',\n  },\n\n  eyebrowTilt: {\n    id: 'eyebrowTilt',\n    name: 'Eyebrow Tilt',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 6.5,\n    idealMax: 11,\n    rangeMin: -5,\n    rangeMax: 25,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of eyebrow from head to tail',\n    profileType: 'front',\n  },\n\n  eyebrowLowSetedness: {\n    id: 'eyebrowLowSetedness',\n    name: 'Eyebrow Low Setedness',\n    category: 'Upper Third',\n    unit: 'ratio',\n    idealMin: 0,\n    idealMax: 0.45,\n    rangeMin: -0.2,\n    rangeMax: 1.0,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from brow to eye relative to eye height',\n    profileType: 'front',\n  },\n\n  // NOSE MEASUREMENTS (FRONT)\n  nasalIndex: {\n    id: 'nasalIndex',\n    name: 'Nasal Index',\n    category: 'Nose',\n    unit: 'percent',\n    idealMin: 70,\n    idealMax: 85,\n    rangeMin: 55,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose width divided by nose height Ã— 100',\n    profileType: 'front',\n  },\n\n  intercanthalNasalRatio: {\n    id: 'intercanthalNasalRatio',\n    name: 'Intercanthal-Nasal Width Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 1.04,\n    idealMax: 1.16,\n    rangeMin: 0.7,\n    rangeMax: 1.5,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Alar width should roughly equal intercanthal distance',\n    profileType: 'front',\n  },\n\n  noseBridgeWidth: {\n    id: 'noseBridgeWidth',\n    name: 'Nose Bridge to Nose Width',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.6,\n    idealMax: 0.75,\n    rangeMin: 0.4,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ratio of nose bridge width to alar base width',\n    profileType: 'front',\n  },\n\n  noseTipPosition: {\n    id: 'noseTipPosition',\n    name: 'Nose Tip Position',\n    category: 'Nose',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 3.5,\n    rangeMin: -7.5,\n    rangeMax: 12.5,\n    decayRate: 1.5,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Nose tip deviation from facial midline',\n    profileType: 'front',\n  },\n\n  // MOUTH/LIP MEASUREMENTS\n  mouthWidthToNoseRatio: {\n    id: 'mouthWidthToNoseRatio',\n    name: 'Mouth Width to Nose Width Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.43,\n    idealMax: 1.51,\n    rangeMin: 0.96,\n    rangeMax: 1.91,\n    decayRate: 18.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Mouth width divided by nose width',\n    profileType: 'front',\n  },\n\n  lowerToUpperLipRatio: {\n    id: 'lowerToUpperLipRatio',\n    name: 'Lower Lip to Upper Lip Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.58,\n    idealMax: 1.88,\n    rangeMin: -0.98,\n    rangeMax: 4.03,\n    decayRate: 8.0,\n    maxScore: 7.5,  // FaceIQ: medium priority\n    weight: 0.02,\n    description: 'Lower lip height divided by upper lip height',\n    profileType: 'front',\n  },\n\n  cupidsBowDepth: {\n    id: 'cupidsBowDepth',\n    name: \"Cupid's Bow Depth\",\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2.3,\n    idealMax: 4,\n    rangeMin: 0,\n    rangeMax: 7,\n    decayRate: 2.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: \"Depth of the cupid's bow curve\",\n    profileType: 'front',\n  },\n\n  mouthCornerPosition: {\n    id: 'mouthCornerPosition',\n    name: 'Mouth Corner Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Mouth corner vertical position relative to lip center',\n    profileType: 'front',\n  },\n\n  // CHIN MEASUREMENTS (FRONT)\n  chinToPhiltrumRatio: {\n    id: 'chinToPhiltrumRatio',\n    name: 'Chin to Philtrum Ratio',\n    category: 'Chin',\n    unit: 'ratio',\n    idealMin: 2.15,\n    idealMax: 2.45,\n    rangeMin: 0.3,\n    rangeMax: 4.5,\n    decayRate: 10.0,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.02,\n    description: 'Chin height divided by philtrum length',\n    profileType: 'front',\n  },\n\n  // OTHER FRONT MEASUREMENTS\n  iaaJfaDeviation: {\n    id: 'iaaJfaDeviation',\n    name: 'Deviation of IAA & JFA',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 0,\n    idealMax: 2.5,\n    rangeMin: -25,\n    rangeMax: 30,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Deviation between Ipsilateral Alar Angle and Jaw Frontal Angle',\n    profileType: 'front',\n  },\n\n  ipsilateralAlarAngle: {\n    id: 'ipsilateralAlarAngle',\n    name: 'Ipsilateral Alar Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 60,\n    rangeMax: 125,\n    decayRate: 0.6,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Angle of alar base relative to facial plane',\n    profileType: 'front',\n  },\n\n  earProtrusionAngle: {\n    id: 'earProtrusionAngle',\n    name: 'Ear Protrusion Angle',\n    category: 'Ears',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 11.5,\n    rangeMin: -25,\n    rangeMax: 40,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of ear protrusion from head',\n    profileType: 'front',\n  },\n\n  earProtrusionRatio: {\n    id: 'earProtrusionRatio',\n    name: 'Ear Protrusion Ratio',\n    category: 'Ears',\n    unit: 'percent',\n    idealMin: 8,\n    idealMax: 12,\n    rangeMin: -20,\n    rangeMax: 40,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ear protrusion as percentage of head width',\n    profileType: 'front',\n  },\n\n  neckWidth: {\n    id: 'neckWidth',\n    name: 'Neck Width',\n    category: 'Neck',\n    unit: 'percent',\n    idealMin: 92,\n    idealMax: 98,\n    rangeMin: 60,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Neck width as percentage of jaw width',\n    profileType: 'front',\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS (38)\n  // ==========================================\n\n  gonialAngle: {\n    id: 'gonialAngle',\n    name: 'Gonial Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 130,\n    rangeMin: 105,\n    rangeMax: 145,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle at the jaw corner (gonion)',\n    profileType: 'side',\n  },\n\n  nasolabialAngle: {\n    id: 'nasolabialAngle',\n    name: 'Nasolabial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 90,\n    idealMax: 105,\n    rangeMin: 75,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle between columella and upper lip',\n    profileType: 'side',\n  },\n\n  nasofrontalAngle: {\n    id: 'nasofrontalAngle',\n    name: 'Nasofrontal Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 116,\n    idealMax: 128,\n    rangeMin: 90,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the bridge of nose (nasion)',\n    profileType: 'side',\n  },\n\n  nasofacialAngle: {\n    id: 'nasofacialAngle',\n    name: 'Nasofacial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 31,\n    idealMax: 35,\n    rangeMin: 15,\n    rangeMax: 50,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between nose and face plane',\n    profileType: 'side',\n  },\n\n  nasomentaAngle: {\n    id: 'nasomentaAngle',\n    name: 'Nasomental Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 126,\n    idealMax: 131,\n    rangeMin: 105,\n    rangeMax: 155,\n    decayRate: 0.7,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle from nasion to nose tip to chin',\n    profileType: 'side',\n  },\n\n  nasalTipAngle: {\n    id: 'nasalTipAngle',\n    name: 'Nasal Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 105,\n    rangeMin: 70,\n    rangeMax: 120,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the nose tip',\n    profileType: 'side',\n  },\n\n  nasalProjection: {\n    id: 'nasalProjection',\n    name: 'Nasal Projection',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.55,\n    idealMax: 0.6,\n    rangeMin: 0.4,\n    rangeMax: 0.75,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose projection relative to nasal length (Goode ratio)',\n    profileType: 'side',\n  },\n\n  nasalWToHRatio: {\n    id: 'nasalWToHRatio',\n    name: 'Nasal W to H Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.67,\n    idealMax: 0.78,\n    rangeMin: 0.5,\n    rangeMax: 0.95,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Nose width to height ratio from side view',\n    profileType: 'side',\n  },\n\n  noseTipRotationAngle: {\n    id: 'noseTipRotationAngle',\n    name: 'Nose Tip Rotation Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 95,\n    idealMax: 110,\n    rangeMin: 80,\n    rangeMax: 125,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of nose tip rotation',\n    profileType: 'side',\n  },\n\n  frankfortTipAngle: {\n    id: 'frankfortTipAngle',\n    name: 'Frankfort-Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 28,\n    idealMax: 34,\n    rangeMin: 20,\n    rangeMax: 42,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle between Frankfort plane and nose tip',\n    profileType: 'side',\n  },\n\n  mentolabialAngle: {\n    id: 'mentolabialAngle',\n    name: 'Mentolabial Angle',\n    category: 'Lips',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 140,\n    rangeMin: 100,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the labiomental fold',\n    profileType: 'side',\n  },\n\n  zAngle: {\n    id: 'zAngle',\n    name: 'Z Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 75,\n    idealMax: 85,\n    rangeMin: 60,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Merrifield Z-Angle for profile assessment',\n    profileType: 'side',\n  },\n\n  submentalCervicalAngle: {\n    id: 'submentalCervicalAngle',\n    name: 'Submental Cervical Angle',\n    category: 'Neck',\n    unit: 'degrees',\n    idealMin: 94,\n    idealMax: 106,\n    rangeMin: 70,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between chin and neck',\n    profileType: 'side',\n  },\n\n  facialConvexityGlabella: {\n    id: 'facialConvexityGlabella',\n    name: 'Facial Convexity (Glabella)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 165,\n    idealMax: 175,\n    rangeMin: 150,\n    rangeMax: 185,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Facial convexity angle using glabella',\n    profileType: 'side',\n  },\n\n  facialConvexityNasion: {\n    id: 'facialConvexityNasion',\n    name: 'Facial Convexity (Nasion)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 168,\n    idealMax: 178,\n    rangeMin: 155,\n    rangeMax: 190,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial convexity angle using nasion',\n    profileType: 'side',\n  },\n\n  totalFacialConvexity: {\n    id: 'totalFacialConvexity',\n    name: 'Total Facial Convexity',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 135,\n    idealMax: 145,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Complete facial profile convexity measurement',\n    profileType: 'side',\n  },\n\n  facialDepthToHeight: {\n    id: 'facialDepthToHeight',\n    name: 'Facial Depth to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.3,\n    idealMax: 1.44,\n    rangeMin: 0.7,\n    rangeMax: 1.8,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial depth divided by facial height',\n    profileType: 'side',\n  },\n\n  anteriorFacialDepth: {\n    id: 'anteriorFacialDepth',\n    name: 'Anterior Facial Depth',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 64.5,\n    idealMax: 67.5,\n    rangeMin: 45,\n    rangeMax: 95,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Anterior facial projection angle',\n    profileType: 'side',\n  },\n\n  interiorMidfaceProjectionAngle: {\n    id: 'interiorMidfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 50,\n    idealMax: 56,\n    rangeMin: 30,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Interior midface projection from side profile',\n    profileType: 'side',\n  },\n\n  recessionFromFrankfort: {\n    id: 'recessionFromFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'mm',\n    idealMin: 1.5,\n    idealMax: 15,\n    rangeMin: -30,\n    rangeMax: 30,\n    decayRate: 0.3,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin position relative to Frankfort plane',\n    profileType: 'side',\n  },\n\n  mandibularPlaneAngle: {\n    id: 'mandibularPlaneAngle',\n    name: 'Mandibular Plane Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 22,\n    idealMax: 28,\n    rangeMin: 15,\n    rangeMax: 38,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of mandibular plane to Frankfort plane',\n    profileType: 'side',\n  },\n\n  ramusToMandibleRatio: {\n    id: 'ramusToMandibleRatio',\n    name: 'Ramus to Mandible Ratio',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'ratio',\n    idealMin: 0.65,\n    idealMax: 0.75,\n    rangeMin: 0.5,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Ramus height divided by mandible length',\n    profileType: 'side',\n  },\n\n  gonionToMouthLine: {\n    id: 'gonionToMouthLine',\n    name: 'Gonion to Mouth Line',\n    category: 'Jaw Shape',\n    unit: 'mm',\n    idealMin: -5,\n    idealMax: 5,\n    rangeMin: -20,\n    rangeMax: 20,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from gonion to mouth level line',\n    profileType: 'side',\n  },\n\n  // E-LINE MEASUREMENTS\n  eLineUpperLip: {\n    id: 'eLineUpperLip',\n    name: 'Upper Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -4,\n    idealMax: -2,\n    rangeMin: -10,\n    rangeMax: 4,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Upper lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  eLineLowerLip: {\n    id: 'eLineLowerLip',\n    name: 'Lower Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 0,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Lower lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  // S-LINE MEASUREMENTS\n  sLineUpperLip: {\n    id: 'sLineUpperLip',\n    name: 'Upper Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 3,\n    rangeMin: -5,\n    rangeMax: 8,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  sLineLowerLip: {\n    id: 'sLineLowerLip',\n    name: 'Lower Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -0.4,\n    idealMax: 0.4,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  // BURSTONE LINE\n  burstoneUpperLip: {\n    id: 'burstoneUpperLip',\n    name: 'Upper Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2,\n    idealMax: 4,\n    rangeMin: -2,\n    rangeMax: 8,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  burstoneLowerLip: {\n    id: 'burstoneLowerLip',\n    name: 'Lower Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 1,\n    idealMax: 3,\n    rangeMin: -3,\n    rangeMax: 7,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  // H LINE\n  holdawayHLine: {\n    id: 'holdawayHLine',\n    name: 'Holdaway H Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Holdaway H-line soft tissue assessment',\n    profileType: 'side',\n  },\n\n  // CHIN MEASUREMENTS (SIDE)\n  chinProjection: {\n    id: 'chinProjection',\n    name: 'Chin Projection',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -3,\n    idealMax: 3,\n    rangeMin: -12,\n    rangeMax: 12,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin projection relative to ideal position',\n    profileType: 'side',\n  },\n\n  recessionRelativeToFrankfort: {\n    id: 'recessionRelativeToFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 2,\n    rangeMin: -10,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin recession relative to Frankfort horizontal',\n    profileType: 'side',\n  },\n\n  // FOREHEAD\n  browridgeInclinationAngle: {\n    id: 'browridgeInclinationAngle',\n    name: 'Browridge Inclination Angle',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 18,\n    rangeMin: 0,\n    rangeMax: 28,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the brow ridge from profile',\n    profileType: 'side',\n  },\n\n  upperForeheadSlope: {\n    id: 'upperForeheadSlope',\n    name: 'Upper Forehead Slope',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 5,\n    idealMax: 12,\n    rangeMin: 0,\n    rangeMax: 20,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Slope angle of the upper forehead',\n    profileType: 'side',\n  },\n\n  // MIDFACE PROJECTION\n  midfaceProjectionAngle: {\n    id: 'midfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 95,\n    rangeMin: 75,\n    rangeMax: 105,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of midface projection from profile',\n    profileType: 'side',\n  },\n\n  orbitalVector: {\n    id: 'orbitalVector',\n    name: 'Orbital Vector',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -6,\n    rangeMax: 10,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Relationship of globe to orbital rim',\n    profileType: 'side',\n  },\n\n  skinUniformity: {\n    id: 'skinUniformity',\n    name: 'Skin Uniformity',\n    category: 'Skin Quality',\n    unit: 'ratio',\n    idealMin: 0.90,\n    idealMax: 1.00,\n    rangeMin: 0.50,\n    rangeMax: 1.00,\n    decayRate: 5.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Skin tone evenness and hyperpigmentation. 1.0 = perfectly uniform.',\n    profileType: 'front',\n    polarity: 'higher_is_better',\n    safeFloor: 0.85,  // Acceptable uniformity threshold\n    softZoneScore: 7.5,\n  },\n\n};\n\n// ============================================\n// FLAW MAPPINGS (Extracted from FaceIQ)\n// ============================================\n\nexport interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n  reasoning: string;\n}\n\nexport const METRIC_FLAW_MAPPINGS: Record<string, FlawMapping[]> = {\n  anteriorFacialDepth: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Anterior Facial Depth measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  bitemporalWidth: [\n    { category: 'Upper Third', flawName: 'Narrow forehead', confidence: 'confirmed', reasoning: 'Reduced bitemporal width indicates a narrower than ideal forehead relative to the cheekbones. This disrupts facial harmony by creating a compressed hairline and forehead, altering the overall shape of the face.' },\n  ],\n  cheekboneHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Low-set cheekbones', confidence: 'confirmed', reasoning: 'Reduced cheekbone height indicates that the cheekbones are positioned lower than ideal. This disrupts facial harmony by creating an unpronounced appearance to the cheekbones and facial structure.' },\n  ],\n  eyeAspectRatio: [\n    { category: 'Eyes', flawName: 'Overly round eye shape', confidence: 'confirmed', reasoning: 'A reduced eye aspect ratio indicates overly narrow eyes relative to their height. This disrupts facial harmony by creating an overly surprised appearance and reducing angular definition.' },\n  ],\n  eyeSeparationRatio: [\n    { category: 'Eyes', flawName: 'Close-set eyes', confidence: 'confirmed', reasoning: 'Reduced eye separation indicates close-set eyes. This disrupts facial harmony by making the eye area appear too compressed.' },\n  ],\n  eyebrowLowSetedness: [\n    { category: 'Eyes', flawName: 'Medium-set eyebrows', confidence: 'confirmed', reasoning: 'Increased eyebrow low setedness indicates eyebrows that are positioned higher than ideal. This disrupts facial harmony by reducing the overall visual impact of the eyebrows and framing of the eyes.' },\n  ],\n  faceWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced face width to height ratio indicates an overly long midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  facialDepthToHeight: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'Reduced facial depth to height ratio indicates insufficient mid-face projection relative to height. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  gonialAngle: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  holdawayHLine: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'Decreased H-line indicates the lips are positioned too far in front of the line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  interiorMidfaceProjectionAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Interior Midface Projection Angle measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  ipsilateralAlarAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A decreased ipsilateral alar angle indicates an overly narrow interior midface. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  jawFrontalAngle: [\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A narrower jaw frontal angle indicates a steeper jawline or overly wide chin. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  jawSlope: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'The Jaw Slope measurement is above the ideal range. This disrupts facial harmony in the lower face.' },\n  ],\n  lateralCanthalTilt: [\n    { category: 'Eyes', flawName: 'Insufficient eye tilt', confidence: 'confirmed', reasoning: 'A decreased lateral canthal tilt indicates insufficiently upturned eyes. This disrupts facial harmony by creating a less alert and youthful appearance.' },\n  ],\n  burstoneLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the Burstone line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  eLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned too far in front of the E-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  sLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the S-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  lowerThirdProportion: [\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'The upper jaw is too long relative to lower jaw, possibly from a long upper jaw or short lower jaw, or a combination of both. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  mandibularPlaneAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Hyper-divergent jaw growth', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by elongating the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  midfaceRatio: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  nasofacialAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A smaller nasofacial angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  nasofrontalAngle: [\n    { category: 'Upper Third', flawName: 'Soft and weak brow ridge', confidence: 'confirmed', reasoning: 'An increased nasofrontal angle indicates reduced brow ridge prominence and angularity. This disrupts facial harmony by creating a less defined upper face.' },\n  ],\n  nasomentaAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A larger nasomental angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  noseBridgeWidth: [\n    { category: 'Nose', flawName: 'Overly narrow nose bridge', confidence: 'confirmed', reasoning: 'The Nose Bridge to Nose Width measurement is above the ideal range. This disrupts facial harmony by creating an unbalanced nasal profile.' },\n  ],\n  orbitalVector: [\n    { category: 'Eyes', flawName: 'Sunken orbital region', confidence: 'confirmed', reasoning: 'A decreased orbital vector indicates insufficient projection and volume underneath the eye. This disrupts facial harmony due to the lacking volume underneath the eyes, reducing vibrancy and youthfulness.' },\n  ],\n  ramusToMandibleRatio: [\n    { category: 'Jaw Shape', flawName: 'Short ramus', confidence: 'confirmed', reasoning: 'A reduced ramus-to-mandible ratio indicates a shorter than ideal vertical jawbone (ramus) when compared to the mandible. This disrupts facial harmony by reducing jaw height and definition.' },\n  ],\n  submentalCervicalAngle: [\n    { category: 'Neck', flawName: 'Round neck region', confidence: 'confirmed', reasoning: 'An increased submental cervical angle indicates a round neck region, possibly from excess submental fat or tissue. This disrupts facial harmony by reducing neck definition.' },\n  ],\n  totalFacialWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Overly long face shape', confidence: 'confirmed', reasoning: 'An increased total facial width to height ratio indicates an overly long face relative to its height. This disrupts facial harmony by creating a vertically stretched appearance to the face.' },\n  ],\n};\n\n// ============================================\n// CUSTOM BEZIER CURVES (Extracted from FaceIQ)\n// ============================================\n\nexport const METRIC_CUSTOM_CURVES: Record<string, CurvePoint[]> = {\n  faceWidthToHeight: [\n    { x: 1.49, y: 0, leftHandleX: 1.44, leftHandleY: 0, rightHandleX: 1.55, rightHandleY: 0 },\n    { x: 1.68, y: 1.05, leftHandleX: 1.62, leftHandleY: 0.36, rightHandleX: 1.71, rightHandleY: 1.58 },\n    { x: 1.77, y: 3.07, leftHandleX: 1.74, leftHandleY: 2.15, rightHandleX: 1.79, rightHandleY: 3.88 },\n    { x: 1.83, y: 5.83, leftHandleX: 1.80, leftHandleY: 4.64, rightHandleX: 1.84, rightHandleY: 6.85 },\n    { x: 1.89, y: 8.70, leftHandleX: 1.88, leftHandleY: 8.30, rightHandleX: 1.92, rightHandleY: 9.50 },\n    { x: 1.96, y: 10, leftHandleX: 1.96, leftHandleY: 10, rightHandleX: 1.96, rightHandleY: 10, fixed: true },\n    { x: 2.00, y: 10, leftHandleX: 2.00, leftHandleY: 10, rightHandleX: 2.00, rightHandleY: 10, fixed: true },\n    { x: 2.07, y: 8.70, leftHandleX: 2.04, leftHandleY: 9.50, rightHandleX: 2.08, rightHandleY: 8.30 },\n    { x: 2.13, y: 5.83, leftHandleX: 2.12, leftHandleY: 6.85, rightHandleX: 2.16, rightHandleY: 4.64 },\n    { x: 2.19, y: 3.07, leftHandleX: 2.17, leftHandleY: 3.88, rightHandleX: 2.22, rightHandleY: 2.15 },\n    { x: 2.28, y: 1.05, leftHandleX: 2.25, leftHandleY: 1.58, rightHandleX: 2.34, rightHandleY: 0.36 },\n    { x: 2.47, y: 0, leftHandleX: 2.41, leftHandleY: 0, rightHandleX: 2.52, rightHandleY: 0 },\n  ],\n  lowerThirdProportion: [\n    { x: 25.6, y: 0, leftHandleX: 24.8, leftHandleY: 0, rightHandleX: 26.4, rightHandleY: 0 },\n    { x: 28.01, y: 1.58, leftHandleX: 27.23, leftHandleY: 0.53, rightHandleX: 28.27, rightHandleY: 1.97 },\n    { x: 28.83, y: 3.21, leftHandleX: 28.60, leftHandleY: 2.60, rightHandleX: 29.10, rightHandleY: 3.90 },\n    { x: 29.63, y: 5.85, leftHandleX: 29.40, leftHandleY: 4.90, rightHandleX: 29.85, rightHandleY: 6.80 },\n    { x: 30.27, y: 8.56, leftHandleX: 30.05, leftHandleY: 7.80, rightHandleX: 30.50, rightHandleY: 9.30 },\n    { x: 31, y: 10, leftHandleX: 30.95, leftHandleY: 10, rightHandleX: 31.05, rightHandleY: 10, fixed: true },\n    { x: 33.5, y: 10, leftHandleX: 33.45, leftHandleY: 10, rightHandleX: 33.55, rightHandleY: 10, fixed: true },\n    { x: 34.23, y: 8.56, leftHandleX: 34.00, leftHandleY: 9.30, rightHandleX: 34.45, rightHandleY: 7.80 },\n    { x: 34.87, y: 5.85, leftHandleX: 34.65, leftHandleY: 6.80, rightHandleX: 35.10, rightHandleY: 4.90 },\n    { x: 35.67, y: 3.21, leftHandleX: 35.40, leftHandleY: 3.90, rightHandleX: 35.90, rightHandleY: 2.60 },\n    { x: 36.49, y: 1.58, leftHandleX: 36.23, leftHandleY: 1.97, rightHandleX: 37.27, rightHandleY: 0.53 },\n    { x: 38.9, y: 0, leftHandleX: 38.1, leftHandleY: 0, rightHandleX: 39.7, rightHandleY: 0 },\n  ],\n  lateralCanthalTilt: [\n    { x: -4.5, y: 0, leftHandleX: -5.5, leftHandleY: 0, rightHandleX: -3.5, rightHandleY: 0 },\n    { x: 0.5, y: 1.2, leftHandleX: -0.8, leftHandleY: 0.4, rightHandleX: 1.5, rightHandleY: 1.8 },\n    { x: 2.8, y: 3.5, leftHandleX: 2.2, leftHandleY: 2.5, rightHandleX: 3.4, rightHandleY: 4.3 },\n    { x: 4.5, y: 6.8, leftHandleX: 4.0, leftHandleY: 5.5, rightHandleX: 5.0, rightHandleY: 7.8 },\n    { x: 5.8, y: 9.2, leftHandleX: 5.4, leftHandleY: 8.5, rightHandleX: 5.95, rightHandleY: 9.7 },\n    { x: 6.1, y: 10, leftHandleX: 6.05, leftHandleY: 10, rightHandleX: 6.15, rightHandleY: 10, fixed: true },\n    { x: 7.8, y: 10, leftHandleX: 7.75, leftHandleY: 10, rightHandleX: 7.85, rightHandleY: 10, fixed: true },\n    { x: 8.1, y: 9.2, leftHandleX: 7.95, leftHandleY: 9.7, rightHandleX: 8.5, rightHandleY: 8.5 },\n    { x: 9.4, y: 6.8, leftHandleX: 8.9, leftHandleY: 7.8, rightHandleX: 9.9, rightHandleY: 5.5 },\n    { x: 11.1, y: 3.5, leftHandleX: 10.5, leftHandleY: 4.3, rightHandleX: 11.7, rightHandleY: 2.5 },\n    { x: 13.4, y: 1.2, leftHandleX: 12.4, leftHandleY: 1.8, rightHandleX: 14.7, rightHandleY: 0.4 },\n    { x: 18.4, y: 0, leftHandleX: 17.4, leftHandleY: 0, rightHandleX: 19.4, rightHandleY: 0 },\n  ],\n  gonialAngle: [\n    { x: 105, y: 0, leftHandleX: 102, leftHandleY: 0, rightHandleX: 108, rightHandleY: 0 },\n    { x: 112, y: 1.5, leftHandleX: 110, leftHandleY: 0.5, rightHandleX: 114, rightHandleY: 2.3 },\n    { x: 116, y: 4.2, leftHandleX: 114.5, leftHandleY: 3.0, rightHandleX: 117.5, rightHandleY: 5.2 },\n    { x: 118.5, y: 7.5, leftHandleX: 117.5, leftHandleY: 6.3, rightHandleX: 119.5, rightHandleY: 8.5 },\n    { x: 120, y: 10, leftHandleX: 119.7, leftHandleY: 10, rightHandleX: 120.3, rightHandleY: 10, fixed: true },\n    { x: 130, y: 10, leftHandleX: 129.7, leftHandleY: 10, rightHandleX: 130.3, rightHandleY: 10, fixed: true },\n    { x: 131.5, y: 7.5, leftHandleX: 130.5, leftHandleY: 8.5, rightHandleX: 132.5, rightHandleY: 6.3 },\n    { x: 134, y: 4.2, leftHandleX: 132.5, leftHandleY: 5.2, rightHandleX: 135.5, rightHandleY: 3.0 },\n    { x: 138, y: 1.5, leftHandleX: 136, leftHandleY: 2.3, rightHandleX: 140, rightHandleY: 0.5 },\n    { x: 145, y: 0, leftHandleX: 142, leftHandleY: 0, rightHandleX: 148, rightHandleY: 0 },\n  ],\n  nasolabialAngle: [\n    { x: 75, y: 0, leftHandleX: 72, leftHandleY: 0, rightHandleX: 78, rightHandleY: 0 },\n    { x: 82, y: 2.0, leftHandleX: 79.5, leftHandleY: 0.7, rightHandleX: 84, rightHandleY: 3.0 },\n    { x: 86, y: 5.5, leftHandleX: 84.5, leftHandleY: 4.2, rightHandleX: 87.5, rightHandleY: 6.8 },\n    { x: 89, y: 8.8, leftHandleX: 88, leftHandleY: 7.8, rightHandleX: 89.7, rightHandleY: 9.5 },\n    { x: 90, y: 10, leftHandleX: 89.8, leftHandleY: 10, rightHandleX: 90.2, rightHandleY: 10, fixed: true },\n    { x: 105, y: 10, leftHandleX: 104.8, leftHandleY: 10, rightHandleX: 105.2, rightHandleY: 10, fixed: true },\n    { x: 106, y: 8.8, leftHandleX: 105.3, leftHandleY: 9.5, rightHandleX: 107, rightHandleY: 7.8 },\n    { x: 109, y: 5.5, leftHandleX: 107.5, leftHandleY: 6.8, rightHandleX: 110.5, rightHandleY: 4.2 },\n    { x: 113, y: 2.0, leftHandleX: 111, leftHandleY: 3.0, rightHandleX: 115.5, rightHandleY: 0.7 },\n    { x: 120, y: 0, leftHandleX: 117, leftHandleY: 0, rightHandleX: 123, rightHandleY: 0 },\n  ],\n  // Middle Third Proportion curve (ideal: 31.4-33.4%)\n  middleThirdProportion: [\n    { x: 21.44, y: 0, leftHandleX: 20.29, leftHandleY: 0, rightHandleX: 23.19, rightHandleY: 0.15 },\n    { x: 25.5, y: 1.35, leftHandleX: 24.18, leftHandleY: 0.53, rightHandleX: 26.17, rightHandleY: 1.79 },\n    { x: 27.34, y: 3.18, leftHandleX: 26.84, leftHandleY: 2.42, rightHandleX: 27.73, rightHandleY: 3.81 },\n    { x: 28.65, y: 5.88, leftHandleX: 28.33, leftHandleY: 4.91, rightHandleX: 28.98, rightHandleY: 6.65 },\n    { x: 29.95, y: 8.55, leftHandleX: 29.41, leftHandleY: 7.58, rightHandleX: 30.45, rightHandleY: 9.35 },\n    { x: 31.4, y: 10, leftHandleX: 31.3, leftHandleY: 10, rightHandleX: 31.5, rightHandleY: 10, fixed: true },\n    { x: 33.4, y: 10, leftHandleX: 33.3, leftHandleY: 10, rightHandleX: 33.5, rightHandleY: 10, fixed: true },\n    { x: 34.85, y: 8.55, leftHandleX: 34.35, leftHandleY: 9.35, rightHandleX: 35.39, rightHandleY: 7.58 },\n    { x: 36.15, y: 5.88, leftHandleX: 35.82, leftHandleY: 6.65, rightHandleX: 36.47, rightHandleY: 4.91 },\n    { x: 37.46, y: 3.18, leftHandleX: 37.07, leftHandleY: 3.81, rightHandleX: 37.96, rightHandleY: 2.42 },\n    { x: 39.3, y: 1.35, leftHandleX: 38.63, leftHandleY: 1.79, rightHandleX: 40.62, rightHandleY: 0.53 },\n    { x: 43.36, y: 0, leftHandleX: 41.61, leftHandleY: 0.15, rightHandleX: 44.51, rightHandleY: 0 },\n  ],\n  // Upper Third Proportion curve (ideal: 30-32%)\n  upperThirdProportion: [\n    { x: 18.75, y: 0.02, leftHandleX: 17.15, leftHandleY: 0.02, rightHandleX: 20.35, rightHandleY: 0.02 },\n    { x: 23.82, y: 1.52, leftHandleX: 22.35, leftHandleY: 0.8, rightHandleX: 24.73, rightHandleY: 2.06 },\n    { x: 26.05, y: 4.06, leftHandleX: 25.48, leftHandleY: 2.86, rightHandleX: 26.41, rightHandleY: 4.99 },\n    { x: 27.19, y: 6.79, leftHandleX: 26.96, leftHandleY: 6.16, rightHandleX: 27.66, rightHandleY: 7.85 },\n    { x: 28.54, y: 9.08, leftHandleX: 28.02, leftHandleY: 8.5, rightHandleX: 28.93, rightHandleY: 9.54 },\n    { x: 30, y: 10, leftHandleX: 29.9, leftHandleY: 10, rightHandleX: 30.1, rightHandleY: 10, fixed: true },\n    { x: 32, y: 10, leftHandleX: 31.9, leftHandleY: 10, rightHandleX: 32.1, rightHandleY: 10, fixed: true },\n    { x: 33.46, y: 9.08, leftHandleX: 33.07, leftHandleY: 9.54, rightHandleX: 33.98, rightHandleY: 8.5 },\n    { x: 34.81, y: 6.79, leftHandleX: 34.34, leftHandleY: 7.85, rightHandleX: 35.04, rightHandleY: 6.16 },\n    { x: 35.95, y: 4.06, leftHandleX: 35.59, leftHandleY: 4.99, rightHandleX: 36.52, rightHandleY: 2.86 },\n    { x: 38.18, y: 1.52, leftHandleX: 37.27, leftHandleY: 2.06, rightHandleX: 39.65, rightHandleY: 0.8 },\n    { x: 43.25, y: 0.02, leftHandleX: 41.65, leftHandleY: 0.02, rightHandleX: 44.85, rightHandleY: 0.02 },\n  ],\n  // Eye Separation Ratio curve (ideal: 45.7-46.8%)\n  eyeSeparationRatio: [\n    { x: 36.54, y: 0, leftHandleX: 35.44, leftHandleY: 0, rightHandleX: 37.40, rightHandleY: 0.04 },\n    { x: 39.04, y: 0.63, leftHandleX: 38.16, leftHandleY: 0.21, rightHandleX: 39.77, rightHandleY: 1.05 },\n    { x: 41.08, y: 2.17, leftHandleX: 40.57, leftHandleY: 1.71, rightHandleX: 41.62, rightHandleY: 2.76 },\n    { x: 42.71, y: 4.74, leftHandleX: 42.26, leftHandleY: 3.81, rightHandleX: 43.08, rightHandleY: 5.52 },\n    { x: 43.94, y: 7.37, leftHandleX: 43.65, leftHandleY: 6.79, rightHandleX: 44.17, rightHandleY: 7.77 },\n    { x: 44.86, y: 9.02, leftHandleX: 44.54, leftHandleY: 8.56, rightHandleX: 45.08, rightHandleY: 9.5 },\n    { x: 45.7, y: 10, leftHandleX: 45.65, leftHandleY: 10, rightHandleX: 45.76, rightHandleY: 10, fixed: true },\n    { x: 46.8, y: 10, leftHandleX: 46.75, leftHandleY: 10, rightHandleX: 46.86, rightHandleY: 10, fixed: true },\n    { x: 47.64, y: 9.02, leftHandleX: 47.42, leftHandleY: 9.5, rightHandleX: 47.96, rightHandleY: 8.56 },\n    { x: 48.56, y: 7.37, leftHandleX: 48.33, leftHandleY: 7.77, rightHandleX: 48.85, rightHandleY: 6.79 },\n    { x: 49.79, y: 4.74, leftHandleX: 49.42, leftHandleY: 5.52, rightHandleX: 50.24, rightHandleY: 3.81 },\n    { x: 51.42, y: 2.17, leftHandleX: 50.88, leftHandleY: 2.76, rightHandleX: 51.93, rightHandleY: 1.71 },\n    { x: 53.46, y: 0.63, leftHandleX: 52.73, leftHandleY: 1.05, rightHandleX: 54.34, rightHandleY: 0.21 },\n    { x: 55.96, y: 0, leftHandleX: 55.10, leftHandleY: 0.04, rightHandleX: 57.06, rightHandleY: 0 },\n  ],\n  // Eyebrow Low Setedness curve (ideal: 0-0.45)\n  eyebrowLowSetedness: [\n    { x: -2.78, y: 0, leftHandleX: -3.11, leftHandleY: 0, rightHandleX: -2.67, rightHandleY: 0 },\n    { x: -1.94, y: 0.4, leftHandleX: -2.08, leftHandleY: 0.11, rightHandleX: -1.81, rightHandleY: 0.57 },\n    { x: -1.18, y: 2.25, leftHandleX: -1.36, leftHandleY: 1.5, rightHandleX: -1.05, rightHandleY: 2.72 },\n    { x: -0.79, y: 4.06, leftHandleX: -0.88, leftHandleY: 3.43, rightHandleX: -0.68, rightHandleY: 4.84 },\n    { x: -0.55, y: 6.21, leftHandleX: -0.58, leftHandleY: 5.55, rightHandleX: -0.47, rightHandleY: 6.92 },\n    { x: -0.28, y: 8.76, leftHandleX: -0.37, leftHandleY: 8.23, rightHandleX: -0.23, rightHandleY: 9.22 },\n    { x: 0, y: 10, leftHandleX: -0.02, leftHandleY: 10, rightHandleX: 0.02, rightHandleY: 10, fixed: true },\n    { x: 0.45, y: 10, leftHandleX: 0.43, leftHandleY: 10, rightHandleX: 0.47, rightHandleY: 10, fixed: true },\n    { x: 0.73, y: 8.76, leftHandleX: 0.68, leftHandleY: 9.22, rightHandleX: 0.82, rightHandleY: 8.23 },\n    { x: 1, y: 6.21, leftHandleX: 0.92, leftHandleY: 6.92, rightHandleX: 1.03, rightHandleY: 5.55 },\n    { x: 1.24, y: 4.06, leftHandleX: 1.13, leftHandleY: 4.84, rightHandleX: 1.33, rightHandleY: 3.43 },\n    { x: 1.63, y: 2.25, leftHandleX: 1.50, leftHandleY: 2.72, rightHandleX: 1.81, rightHandleY: 1.5 },\n    { x: 2.39, y: 0.4, leftHandleX: 2.26, leftHandleY: 0.57, rightHandleX: 2.53, rightHandleY: 0.11 },\n    { x: 3.23, y: 0, leftHandleX: 3.12, leftHandleY: 0, rightHandleX: 3.56, rightHandleY: 0 },\n  ],\n  // Submental Cervical Angle curve (ideal: 94-106Â°)\n  submentalCervicalAngle: [\n    { x: 50.48, y: 0, leftHandleX: 44.48, leftHandleY: 0, rightHandleX: 56.48, rightHandleY: 0 },\n    { x: 68.31, y: 1.31, leftHandleX: 62.07, leftHandleY: 0.32, rightHandleX: 72.89, rightHandleY: 2.13 },\n    { x: 77.76, y: 3.71, leftHandleX: 76.00, leftHandleY: 2.89, rightHandleX: 80.39, rightHandleY: 4.59 },\n    { x: 83.99, y: 6.53, leftHandleX: 82.63, leftHandleY: 5.85, rightHandleX: 85.16, rightHandleY: 7.12 },\n    { x: 88.28, y: 8.86, leftHandleX: 86.43, leftHandleY: 7.85, rightHandleX: 89.95, rightHandleY: 9.71 },\n    { x: 94, y: 10, leftHandleX: 93.4, leftHandleY: 10, rightHandleX: 94.6, rightHandleY: 10, fixed: true },\n    { x: 106, y: 10, leftHandleX: 105.4, leftHandleY: 10, rightHandleX: 106.6, rightHandleY: 10, fixed: true },\n    { x: 111.72, y: 8.86, leftHandleX: 110.05, leftHandleY: 9.71, rightHandleX: 113.57, rightHandleY: 7.85 },\n    { x: 116.01, y: 6.53, leftHandleX: 114.84, leftHandleY: 7.12, rightHandleX: 117.37, rightHandleY: 5.85 },\n    { x: 122.24, y: 3.71, leftHandleX: 119.61, leftHandleY: 4.59, rightHandleX: 124.00, rightHandleY: 2.89 },\n    { x: 131.69, y: 1.31, leftHandleX: 127.11, leftHandleY: 2.13, rightHandleX: 137.93, rightHandleY: 0.32 },\n    { x: 149.52, y: 0, leftHandleX: 143.52, leftHandleY: 0, rightHandleX: 155.52, rightHandleY: 0 },\n  ],\n  // Facial Convexity (Glabella) curve (ideal: 169-174Â°)\n  facialConvexityGlabella: [\n    { x: 149.21, y: 0, leftHandleX: 146.21, leftHandleY: 0, rightHandleX: 152.21, rightHandleY: 0 },\n    { x: 158.07, y: 1.41, leftHandleX: 156.03, leftHandleY: 0.74, rightHandleX: 159.63, rightHandleY: 2 },\n    { x: 162.12, y: 4.09, leftHandleX: 161.34, leftHandleY: 3.31, rightHandleX: 163.09, rightHandleY: 5.03 },\n    { x: 165.14, y: 7.76, leftHandleX: 164.46, leftHandleY: 6.56, rightHandleX: 165.54, rightHandleY: 8.29 },\n    { x: 166.65, y: 9.14, leftHandleX: 165.92, leftHandleY: 8.72, rightHandleX: 167.43, rightHandleY: 9.67 },\n    { x: 169, y: 10, leftHandleX: 168.75, leftHandleY: 10, rightHandleX: 169.25, rightHandleY: 10, fixed: true },\n    { x: 174, y: 10, leftHandleX: 173.75, leftHandleY: 10, rightHandleX: 174.25, rightHandleY: 10, fixed: true },\n    { x: 176.35, y: 9.14, leftHandleX: 175.57, leftHandleY: 9.67, rightHandleX: 177.08, rightHandleY: 8.72 },\n    { x: 177.86, y: 7.76, leftHandleX: 177.46, leftHandleY: 8.29, rightHandleX: 178.54, rightHandleY: 6.56 },\n    { x: 180.88, y: 4.09, leftHandleX: 179.91, leftHandleY: 5.03, rightHandleX: 181.66, rightHandleY: 3.31 },\n    { x: 184.93, y: 1.41, leftHandleX: 183.37, leftHandleY: 2, rightHandleX: 186.97, rightHandleY: 0.74 },\n    { x: 193.79, y: 0, leftHandleX: 190.79, leftHandleY: 0, rightHandleX: 196.79, rightHandleY: 0 },\n  ],\n};\n\n// ============================================\n// CATEGORY DEFINITIONS\n// ============================================\n\nexport const MEASUREMENT_CATEGORIES = {\n  'Midface/Face Shape': { color: '#67e8f9', weight: 0.20 },\n  'Occlusion/Jaw Growth': { color: '#a78bfa', weight: 0.15 },\n  'Jaw Shape': { color: '#f97316', weight: 0.13 },\n  'Upper Third': { color: '#84cc16', weight: 0.08 },\n  'Eyes': { color: '#06b6d4', weight: 0.12 },\n  'Nose': { color: '#fbbf24', weight: 0.10 },\n  'Lips': { color: '#ec4899', weight: 0.10 },\n  'Chin': { color: '#ef4444', weight: 0.06 },\n  'Neck': { color: '#14b8a6', weight: 0.03 },\n  'Other': { color: '#6b7280', weight: 0.03 },\n};\n\n// ============================================\n// CORE SCORING FUNCTIONS\n// ============================================\n\n/**\n * FaceIQ Exponential Decay Scoring Algorithm with Directional/Dimorphic Support\n *\n * Standard: score = maxScore Ã— e^(-decayRate Ã— deviation)\n *\n * Directional scoring (polarity):\n * - 'higher_is_better': Values above safeFloor but below ideal get softZoneScore\n *   Example: Canthal Tilt of 3Â° is still positive/good, just not peak ideal (6-8Â°)\n * - 'lower_is_better': Values below safeCeiling but above ideal get softZoneScore\n *   Example: Short philtrum is still attractive even if shorter than \"ideal\"\n */\nexport function calculateFaceIQScore(\n  value: number,\n  config: MetricConfig\n): number {\n  const {\n    idealMin,\n    idealMax,\n    decayRate,\n    maxScore,\n    customCurve,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n    softZoneScore = 8.0, // Default \"Good\" score for acceptable-but-not-ideal values\n  } = config;\n\n  // Use custom curve if available\n  if (customCurve && customCurve.mode === 'custom') {\n    return interpolateCustomCurve(value, customCurve.points, maxScore);\n  }\n\n  // Perfect score within ideal range\n  if (value >= idealMin && value <= idealMax) {\n    return maxScore;\n  }\n\n  // Handle directional/dimorphic scoring\n  if (polarity === 'higher_is_better' && safeFloor !== undefined) {\n    // Higher values are good. Only values below safeFloor are true weaknesses.\n    if (value >= safeFloor && value < idealMin) {\n      // Value is in the \"acceptable but not ideal\" zone\n      // Give a passing score that decreases linearly as we approach the floor\n      const zoneRange = idealMin - safeFloor;\n      const distanceFromIdeal = idealMin - value;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMin â†’ maxScore, safeFloor â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value >= idealMax) {\n      // Values above ideal are still excellent for 'higher_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = value - idealMax;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Below safeFloor - apply normal (or harsher) exponential decay\n    if (value < safeFloor) {\n      const deviation = safeFloor - value;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  if (polarity === 'lower_is_better' && safeCeiling !== undefined) {\n    // Lower values are good. Only values above safeCeiling are true weaknesses.\n    if (value <= safeCeiling && value > idealMax) {\n      // Value is in the \"acceptable but not ideal\" zone\n      const zoneRange = safeCeiling - idealMax;\n      const distanceFromIdeal = value - idealMax;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMax â†’ maxScore, safeCeiling â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value <= idealMin) {\n      // Values below ideal are still excellent for 'lower_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = idealMin - value;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Above safeCeiling - apply normal exponential decay\n    if (value > safeCeiling) {\n      const deviation = value - safeCeiling;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  // Default balanced scoring: deviation in either direction is equally bad\n  const deviation = value < idealMin\n    ? idealMin - value\n    : value - idealMax;\n\n  // Exponential decay\n  const score = maxScore * Math.exp(-decayRate * deviation);\n\n  return Math.max(0, Math.min(maxScore, score));\n}\n\n/**\n * Check if a metric value is in an \"acceptable\" zone (not a true weakness).\n * Used by InsightsEngine to prevent false positives.\n */\nexport function isValueAcceptable(\n  value: number,\n  config: MetricConfig\n): { acceptable: boolean; reason: string } {\n  const {\n    idealMin,\n    idealMax,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n  } = config;\n\n  // Within ideal range is always acceptable\n  if (value >= idealMin && value <= idealMax) {\n    return { acceptable: true, reason: 'within_ideal' };\n  }\n\n  // Check directional acceptability\n  if (polarity === 'higher_is_better') {\n    if (value >= idealMax) {\n      return { acceptable: true, reason: 'above_ideal_higher_is_better' };\n    }\n    if (safeFloor !== undefined && value >= safeFloor) {\n      return { acceptable: true, reason: 'above_safe_floor' };\n    }\n    // Below safe floor - true weakness\n    return { acceptable: false, reason: 'below_safe_floor' };\n  }\n\n  if (polarity === 'lower_is_better') {\n    if (value <= idealMin) {\n      return { acceptable: true, reason: 'below_ideal_lower_is_better' };\n    }\n    if (safeCeiling !== undefined && value <= safeCeiling) {\n      return { acceptable: true, reason: 'below_safe_ceiling' };\n    }\n    // Above safe ceiling - true weakness\n    return { acceptable: false, reason: 'above_safe_ceiling' };\n  }\n\n  // Balanced polarity - outside ideal is not acceptable\n  return { acceptable: false, reason: 'outside_ideal_balanced' };\n}\n\n/**\n * Interpolate custom Bezier curve for scoring\n * Uses cubic Bezier interpolation with control handles for smooth curves\n */\nfunction interpolateCustomCurve(\n  value: number,\n  points: CurvePoint[],\n  maxScore: number\n): number {\n  void maxScore; // Reserved for future custom curve implementations\n  if (points.length === 0) return 0;\n\n  // Sort points by x value\n  const sortedPoints = [...points].sort((a, b) => a.x - b.x);\n\n  // Clamp to range\n  if (value <= sortedPoints[0].x) return sortedPoints[0].y;\n  if (value >= sortedPoints[sortedPoints.length - 1].x) {\n    return sortedPoints[sortedPoints.length - 1].y;\n  }\n\n  // Find bracketing points\n  let lowerIndex = 0;\n  for (let i = 0; i < sortedPoints.length - 1; i++) {\n    if (value >= sortedPoints[i].x && value <= sortedPoints[i + 1].x) {\n      lowerIndex = i;\n      break;\n    }\n  }\n\n  const p0 = sortedPoints[lowerIndex];\n  const p3 = sortedPoints[lowerIndex + 1];\n\n  // Check if we have Bezier control handles\n  const hasHandles = p0.rightHandleX !== undefined && p3.leftHandleX !== undefined;\n\n  if (hasHandles) {\n    // Cubic Bezier interpolation with control points\n    const p1x = p0.rightHandleX!;\n    const p1y = p0.rightHandleY ?? p0.y;\n    const p2x = p3.leftHandleX!;\n    const p2y = p3.leftHandleY ?? p3.y;\n\n    // Find t parameter for given x value using Newton-Raphson iteration\n    let t = (value - p0.x) / (p3.x - p0.x); // Initial guess\n\n    // Newton-Raphson iterations to find t where B_x(t) = value\n    for (let iter = 0; iter < 10; iter++) {\n      const bx = cubicBezier(p0.x, p1x, p2x, p3.x, t);\n      const bxDerivative = cubicBezierDerivative(p0.x, p1x, p2x, p3.x, t);\n\n      if (Math.abs(bxDerivative) < 1e-10) break;\n\n      const newT = t - (bx - value) / bxDerivative;\n      if (Math.abs(newT - t) < 1e-10) break;\n      t = Math.max(0, Math.min(1, newT));\n    }\n\n    // Calculate y using the found t parameter\n    return cubicBezier(p0.y, p1y, p2y, p3.y, t);\n  } else {\n    // Smooth interpolation using Catmull-Rom spline\n    // This provides smoother curves than linear interpolation\n    const t = (value - p0.x) / (p3.x - p0.x);\n\n    // Get neighboring points for spline calculation\n    const pMinus1 = lowerIndex > 0 ? sortedPoints[lowerIndex - 1] : p0;\n    const p4 = lowerIndex + 2 < sortedPoints.length ? sortedPoints[lowerIndex + 2] : p3;\n\n    // Catmull-Rom spline interpolation\n    return catmullRomSpline(pMinus1.y, p0.y, p3.y, p4.y, t);\n  }\n}\n\n/**\n * Cubic Bezier curve evaluation: B(t) = (1-t)Â³P0 + 3(1-t)Â²tP1 + 3(1-t)tÂ²P2 + tÂ³P3\n */\nfunction cubicBezier(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  const mt2 = mt * mt;\n  const mt3 = mt2 * mt;\n  const t2 = t * t;\n  const t3 = t2 * t;\n  return mt3 * p0 + 3 * mt2 * t * p1 + 3 * mt * t2 * p2 + t3 * p3;\n}\n\n/**\n * Cubic Bezier derivative: B'(t) = 3(1-t)Â²(P1-P0) + 6(1-t)t(P2-P1) + 3tÂ²(P3-P2)\n */\nfunction cubicBezierDerivative(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  return 3 * mt * mt * (p1 - p0) + 6 * mt * t * (p2 - p1) + 3 * t * t * (p3 - p2);\n}\n\n/**\n * Catmull-Rom spline interpolation for smooth curves without explicit handles\n */\nfunction catmullRomSpline(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const t2 = t * t;\n  const t3 = t2 * t;\n\n  // Catmull-Rom coefficients with tension = 0.5\n  const a = -0.5 * p0 + 1.5 * p1 - 1.5 * p2 + 0.5 * p3;\n  const b = p0 - 2.5 * p1 + 2 * p2 - 0.5 * p3;\n  const c = -0.5 * p0 + 0.5 * p2;\n  const d = p1;\n\n  return a * t3 + b * t2 + c * t + d;\n}\n\n/**\n * Calculate standardized score (0-10 normalized)\n */\nexport function standardizeScore(score: number, maxScore: number): number {\n  return (score / maxScore) * 10;\n}\n\n/**\n * Determine quality tier based on score\n */\nexport function getQualityTier(score: number, maxScore: number = 10): QualityTier {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 90) return 'ideal';\n  if (normalized >= 70) return 'excellent';\n  if (normalized >= 50) return 'good';\n  return 'below_average';\n}\n\n/**\n * Determine severity level based on score\n */\nexport function getSeverityLevel(score: number, maxScore: number = 10): SeverityLevel {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 85) return 'optimal';\n  if (normalized >= 70) return 'minor';\n  if (normalized >= 50) return 'moderate';\n  if (normalized >= 30) return 'major';\n  if (normalized >= 15) return 'severe';\n  return 'extremely_severe';\n}\n\n/**\n * Calculate deviation description\n */\nexport function getDeviationDescription(\n  value: number,\n  idealMin: number,\n  idealMax: number,\n  unit: MeasurementUnit\n): { deviation: number; direction: 'above' | 'below' | 'within'; description: string } {\n  if (value >= idealMin && value <= idealMax) {\n    return { deviation: 0, direction: 'within', description: 'within ideal range' };\n  }\n\n  const unitLabel = getUnitLabel(unit);\n\n  if (value < idealMin) {\n    const dev = idealMin - value;\n    return {\n      deviation: dev,\n      direction: 'below',\n      description: `${dev.toFixed(2)}${unitLabel} below ideal`,\n    };\n  }\n\n  const dev = value - idealMax;\n  return {\n    deviation: dev,\n    direction: 'above',\n    description: `${dev.toFixed(2)}${unitLabel} above ideal`,\n  };\n}\n\nfunction getUnitLabel(unit: MeasurementUnit): string {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return 'Â°';\n    case 'mm': return 'mm';\n    default: return '';\n  }\n}\n\n// ============================================\n// MEASUREMENT CALCULATION UTILITIES\n// ============================================\n\n/**\n * Calculate distance between two points\n */\nexport function distance(p1: Point, p2: Point): number {\n  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n}\n\n/**\n * Calculate angle at vertex point (in degrees)\n */\nexport function calculateAngle(p1: Point, vertex: Point, p2: Point): number {\n  const v1 = { x: p1.x - vertex.x, y: p1.y - vertex.y };\n  const v2 = { x: p2.x - vertex.x, y: p2.y - vertex.y };\n\n  const dot = v1.x * v2.x + v1.y * v2.y;\n  const cross = v1.x * v2.y - v1.y * v2.x;\n\n  const angle = Math.atan2(cross, dot) * (180 / Math.PI);\n  return Math.abs(angle);\n}\n\n/**\n * Calculate perpendicular distance from point to line (signed)\n */\nexport function perpendicularDistance(\n  point: Point,\n  lineStart: Point,\n  lineEnd: Point\n): number {\n  const A = point.x - lineStart.x;\n  const B = point.y - lineStart.y;\n  const C = lineEnd.x - lineStart.x;\n  const D = lineEnd.y - lineStart.y;\n\n  const dot = A * C + B * D;\n  const lenSq = C * C + D * D;\n  const param = lenSq !== 0 ? dot / lenSq : -1;\n\n  let xx: number, yy: number;\n\n  if (param < 0) {\n    xx = lineStart.x;\n    yy = lineStart.y;\n  } else if (param > 1) {\n    xx = lineEnd.x;\n    yy = lineEnd.y;\n  } else {\n    xx = lineStart.x + param * C;\n    yy = lineStart.y + param * D;\n  }\n\n  const dx = point.x - xx;\n  const dy = point.y - yy;\n\n  const sign =\n    (lineEnd.y - lineStart.y) * point.x -\n      (lineEnd.x - lineStart.x) * point.y +\n      lineEnd.x * lineStart.y -\n      lineEnd.y * lineStart.x >=\n    0\n      ? 1\n      : -1;\n\n  return sign * Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Helper to get landmark by ID\n */\nfunction getLandmark(landmarks: LandmarkPoint[], id: string): Point | null {\n  const lm = landmarks.find((l) => l.id === id);\n  return lm ? { x: lm.x, y: lm.y } : null;\n}\n\n// ============================================\n// SCORE A SINGLE MEASUREMENT\n// ============================================\n\nexport interface DemographicOptions {\n  gender?: Gender;\n  ethnicity?: Ethnicity;\n}\n\n/**\n * Calculate complete score result for a measurement.\n * If demographics provided, uses demographic-specific ideal ranges.\n */\nexport function scoreMeasurement(\n  metricId: string,\n  value: number,\n  demographics?: DemographicOptions\n): FaceIQScoreResult | null {\n  // Get config with demographic overrides if provided\n  const config = demographics?.gender\n    ? getMetricConfigForDemographics(metricId, demographics.gender, demographics.ethnicity || 'other')\n    : FACEIQ_METRICS[metricId];\n\n  if (!config) return null;\n\n  const score = calculateFaceIQScore(value, config);\n  const standardizedScore = standardizeScore(score, config.maxScore);\n  const qualityTier = getQualityTier(score, config.maxScore);\n  const severity = getSeverityLevel(score, config.maxScore);\n  const { deviation, direction } = getDeviationDescription(\n    value,\n    config.idealMin,\n    config.idealMax,\n    config.unit\n  );\n\n  return {\n    metricId,\n    name: config.name,\n    value,\n    score,\n    standardizedScore,\n    qualityTier,\n    severity,\n    idealMin: config.idealMin,\n    idealMax: config.idealMax,\n    deviation,\n    deviationDirection: direction,\n    unit: config.unit,\n    category: config.category,\n  };\n}\n\n// ============================================\n// FRONT PROFILE ANALYSIS\n// ============================================\n\nexport interface FrontProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all front profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeFrontProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): FrontProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  // Helper to add measurement if landmarks available\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const trichion = getLandmark(landmarks, 'trichion');\n  const nasalBase = getLandmark(landmarks, 'nasal_base');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const menton = getLandmark(landmarks, 'menton');\n  const leftZygion = getLandmark(landmarks, 'left_zygion');\n  const rightZygion = getLandmark(landmarks, 'right_zygion');\n  const leftGonion = getLandmark(landmarks, 'left_gonion_inferior');\n  const rightGonion = getLandmark(landmarks, 'right_gonion_inferior');\n  const leftPupil = getLandmark(landmarks, 'left_pupila');\n  const rightPupil = getLandmark(landmarks, 'right_pupila');\n  const leftCanthusM = getLandmark(landmarks, 'left_canthus_medialis');\n  const leftCanthusL = getLandmark(landmarks, 'left_canthus_lateralis');\n  const rightCanthusM = getLandmark(landmarks, 'right_canthus_medialis');\n  const rightCanthusL = getLandmark(landmarks, 'right_canthus_lateralis');\n  void rightCanthusL; // Will be used for asymmetry measurements\n  const leftAlaNasi = getLandmark(landmarks, 'left_ala_nasi');\n  const rightAlaNasi = getLandmark(landmarks, 'right_ala_nasi');\n  const leftCheilion = getLandmark(landmarks, 'left_cheilion');\n  const rightCheilion = getLandmark(landmarks, 'right_cheilion');\n  const labraleSuperius = getLandmark(landmarks, 'labrale_superius');\n  const labraleInferius = getLandmark(landmarks, 'labrale_inferius');\n\n  // FACIAL THIRDS\n  if (trichion && nasalBase && subnasale && menton) {\n    const totalHeight = distance(trichion, menton);\n    if (totalHeight > 0) {\n      const upperThird = (distance(trichion, nasalBase) / totalHeight) * 100;\n      const middleThird = (distance(nasalBase, subnasale) / totalHeight) * 100;\n      const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n\n      addMeasurement('upperThirdProportion', upperThird);\n      addMeasurement('middleThirdProportion', middleThird);\n      addMeasurement('lowerThirdProportion', lowerThird);\n    }\n  }\n\n  // FACE WIDTH TO HEIGHT RATIO (FWHR)\n  if (leftZygion && rightZygion && nasalBase && labraleSuperius) {\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    const upperFaceHeight = distance(nasalBase, labraleSuperius);\n    if (upperFaceHeight > 0) {\n      addMeasurement('faceWidthToHeight', bizygomaticWidth / upperFaceHeight);\n    }\n  }\n\n  // TOTAL FACIAL WIDTH TO HEIGHT\n  if (leftZygion && rightZygion && trichion && menton) {\n    const cheekWidth = distance(leftZygion, rightZygion);\n    const totalHeight = distance(trichion, menton);\n    if (cheekWidth > 0) {\n      addMeasurement('totalFacialWidthToHeight', totalHeight / cheekWidth);\n    }\n  }\n\n  // JAW WIDTH RATIO\n  if (leftGonion && rightGonion && leftZygion && rightZygion) {\n    const bigonialWidth = distance(leftGonion, rightGonion);\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    if (bizygomaticWidth > 0) {\n      const ratio = bigonialWidth / bizygomaticWidth;\n      addMeasurement('jawWidthRatio', ratio);\n      addMeasurement('bigonialWidth', ratio * 100);\n    }\n  }\n\n  // CANTHAL TILT\n  if (leftCanthusM && leftCanthusL) {\n    const deltaY = leftCanthusM.y - leftCanthusL.y;\n    const deltaX = leftCanthusL.x - leftCanthusM.x;\n    const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);\n    addMeasurement('lateralCanthalTilt', angle);\n  }\n\n  // EYE ASPECT RATIO\n  if (leftCanthusM && leftCanthusL) {\n    const leftPalpSup = getLandmark(landmarks, 'left_palpebra_superior');\n    const leftPalpInf = getLandmark(landmarks, 'left_palpebra_inferior');\n    if (leftPalpSup && leftPalpInf) {\n      const eyeWidth = distance(leftCanthusM, leftCanthusL);\n      const eyeHeight = distance(leftPalpSup, leftPalpInf);\n      if (eyeWidth > 0) {\n        addMeasurement('eyeAspectRatio', eyeHeight / eyeWidth);\n      }\n    }\n  }\n\n  // EYE SEPARATION RATIO\n  if (leftCanthusM && rightCanthusM && leftZygion && rightZygion) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('eyeSeparationRatio', intercanthal / bizygomatic);\n    }\n  }\n\n  // IPD RATIO\n  if (leftPupil && rightPupil && leftZygion && rightZygion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('interpupillaryRatio', (ipd / bizygomatic) * 100);\n    }\n  }\n\n  // ONE EYE APART TEST\n  if (leftCanthusM && rightCanthusM && leftCanthusL) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const eyeWidth = distance(leftCanthusM, leftCanthusL);\n    if (eyeWidth > 0) {\n      addMeasurement('oneEyeApartTest', intercanthal / eyeWidth);\n    }\n  }\n\n  // NASAL INDEX\n  if (leftAlaNasi && rightAlaNasi && nasalBase && subnasale) {\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    const nasalHeight = distance(nasalBase, subnasale);\n    if (nasalHeight > 0) {\n      addMeasurement('nasalIndex', (nasalWidth / nasalHeight) * 100);\n    }\n  }\n\n  // INTERCANTHAL-NASAL WIDTH RATIO\n  if (leftCanthusM && rightCanthusM && leftAlaNasi && rightAlaNasi) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('intercanthalNasalRatio', intercanthal / nasalWidth);\n    }\n  }\n\n  // MOUTH TO NOSE RATIO\n  if (leftCheilion && rightCheilion && leftAlaNasi && rightAlaNasi) {\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('mouthWidthToNoseRatio', mouthWidth / nasalWidth);\n    }\n  }\n\n  // IPD TO MOUTH WIDTH RATIO\n  if (leftPupil && rightPupil && leftCheilion && rightCheilion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    if (ipd > 0) {\n      addMeasurement('interpupillaryMouthWidthRatio', mouthWidth / ipd);\n    }\n  }\n\n  // LIP RATIO\n  if (labraleSuperius && labraleInferius && subnasale) {\n    const mouthMiddle = getLandmark(landmarks, 'mouth_middle');\n    if (mouthMiddle) {\n      const upperLipHeight = distance(subnasale, labraleSuperius);\n      const lowerLipHeight = distance(mouthMiddle, labraleInferius);\n      if (upperLipHeight > 0) {\n        addMeasurement('lowerToUpperLipRatio', lowerLipHeight / upperLipHeight);\n      }\n    }\n  }\n\n  // MIDFACE RATIO\n  if (leftZygion && rightZygion && nasalBase && subnasale) {\n    const midfaceWidth = distance(leftZygion, rightZygion);\n    const midfaceHeight = distance(nasalBase, subnasale);\n    if (midfaceHeight > 0) {\n      addMeasurement('midfaceRatio', midfaceWidth / midfaceHeight / 10); // Normalized\n    }\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score (weighted average)\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n  const standardizedScore = overallScore;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// SIDE PROFILE ANALYSIS\n// ============================================\n\nexport interface SideProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all side profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeSideProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): SideProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const glabella = getLandmark(landmarks, 'glabella');\n  const nasion = getLandmark(landmarks, 'nasion');\n  const rhinion = getLandmark(landmarks, 'rhinion');\n  const pronasale = getLandmark(landmarks, 'pronasale');\n  const columella = getLandmark(landmarks, 'columella');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const labraleSuperius = getLandmark(landmarks, 'labraleSuperius');\n  const labraleInferius = getLandmark(landmarks, 'labraleInferius');\n  const sublabiale = getLandmark(landmarks, 'sublabiale');\n  const pogonion = getLandmark(landmarks, 'pogonion');\n  const menton = getLandmark(landmarks, 'menton');\n  const tragus = getLandmark(landmarks, 'tragus');\n  const gonionBottom = getLandmark(landmarks, 'gonionBottom');\n  const cervicalPoint = getLandmark(landmarks, 'cervicalPoint');\n  const orbitale = getLandmark(landmarks, 'orbitale');\n  const porion = getLandmark(landmarks, 'porion');\n\n  // GONIAL ANGLE\n  if (tragus && gonionBottom && menton) {\n    const angle = calculateAngle(tragus, gonionBottom, menton);\n    addMeasurement('gonialAngle', angle);\n  }\n\n  // NASOLABIAL ANGLE\n  if (columella && subnasale && labraleSuperius) {\n    const angle = calculateAngle(columella, subnasale, labraleSuperius);\n    addMeasurement('nasolabialAngle', angle);\n  }\n\n  // NASOFRONTAL ANGLE\n  if (glabella && nasion && rhinion) {\n    const angle = calculateAngle(glabella, nasion, rhinion);\n    addMeasurement('nasofrontalAngle', angle);\n  }\n\n  // MENTOLABIAL ANGLE\n  if (labraleInferius && sublabiale && pogonion) {\n    const angle = calculateAngle(labraleInferius, sublabiale, pogonion);\n    addMeasurement('mentolabialAngle', angle);\n  }\n\n  // E-LINE MEASUREMENTS\n  if (pronasale && pogonion && labraleSuperius && labraleInferius) {\n    const upperLipDist = perpendicularDistance(labraleSuperius, pronasale, pogonion);\n    const lowerLipDist = perpendicularDistance(labraleInferius, pronasale, pogonion);\n    addMeasurement('eLineUpperLip', upperLipDist);\n    addMeasurement('eLineLowerLip', lowerLipDist);\n  }\n\n  // NASOMENTAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    const angle = calculateAngle(nasion, pronasale, pogonion);\n    addMeasurement('nasomentaAngle', angle);\n  }\n\n  // FACIAL CONVEXITY (GLABELLA)\n  if (glabella && subnasale && pogonion) {\n    const angle = calculateAngle(glabella, subnasale, pogonion);\n    addMeasurement('facialConvexityGlabella', angle);\n  }\n\n  // FACIAL CONVEXITY (NASION)\n  if (nasion && subnasale && pogonion) {\n    const angle = calculateAngle(nasion, subnasale, pogonion);\n    addMeasurement('facialConvexityNasion', angle);\n  }\n\n  // TOTAL FACIAL CONVEXITY\n  if (glabella && pronasale && pogonion) {\n    const angle = calculateAngle(glabella, pronasale, pogonion);\n    addMeasurement('totalFacialConvexity', angle);\n  }\n\n  // SUBMENTAL CERVICAL ANGLE\n  if (menton && cervicalPoint && pogonion) {\n    const neckPoint = getLandmark(landmarks, 'neckPoint');\n    if (neckPoint) {\n      const angle = calculateAngle(pogonion, menton, neckPoint);\n      addMeasurement('submentalCervicalAngle', angle);\n    }\n  }\n\n  // NASAL PROJECTION (Goode ratio)\n  if (pronasale && subnasale && nasion) {\n    const projection = distance(pronasale, subnasale);\n    const nasalLength = distance(nasion, pronasale);\n    if (nasalLength > 0) {\n      addMeasurement('nasalProjection', projection / nasalLength);\n    }\n  }\n\n  // NASOFACIAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    // Angle between nose dorsum and facial plane\n    const nasalDorsum = { x: pronasale.x - nasion.x, y: pronasale.y - nasion.y };\n    const facialPlane = { x: pogonion.x - nasion.x, y: pogonion.y - nasion.y };\n\n    const dot = nasalDorsum.x * facialPlane.x + nasalDorsum.y * facialPlane.y;\n    const mag1 = Math.sqrt(nasalDorsum.x ** 2 + nasalDorsum.y ** 2);\n    const mag2 = Math.sqrt(facialPlane.x ** 2 + facialPlane.y ** 2);\n\n    if (mag1 > 0 && mag2 > 0) {\n      const angle = Math.acos(dot / (mag1 * mag2)) * (180 / Math.PI);\n      addMeasurement('nasofacialAngle', angle);\n    }\n  }\n\n  // MANDIBULAR PLANE ANGLE (using Frankfort horizontal)\n  if (porion && orbitale && gonionBottom && menton) {\n    // Frankfort horizontal is porion to orbitale\n    // Mandibular plane is gonion to menton\n    const fhAngle = Math.atan2(orbitale.y - porion.y, orbitale.x - porion.x);\n    const mpAngle = Math.atan2(menton.y - gonionBottom.y, menton.x - gonionBottom.x);\n    const angle = Math.abs(fhAngle - mpAngle) * (180 / Math.PI);\n    addMeasurement('mandibularPlaneAngle', angle);\n  }\n\n  // CHIN PROJECTION\n  if (pogonion && subnasale) {\n    // Distance from pogonion to vertical line through subnasale\n    const projection = pogonion.x - subnasale.x;\n    addMeasurement('chinProjection', projection);\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// COMPLETE HARMONY ANALYSIS\n// ============================================\n\n/**\n * Run complete facial harmony analysis.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeHarmony(\n  frontLandmarks: LandmarkPoint[],\n  sideLandmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): HarmonyAnalysis {\n  const frontResults = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n  const sideResults = analyzeSideProfile(sideLandmarks, gender, ethnicity);\n\n  const allMeasurements = [...frontResults.measurements, ...sideResults.measurements];\n\n  // Combined category scores\n  const allCategories: Record<string, { total: number; count: number }> = {};\n  for (const m of allMeasurements) {\n    if (!allCategories[m.category]) {\n      allCategories[m.category] = { total: 0, count: 0 };\n    }\n    allCategories[m.category].total += m.standardizedScore;\n    allCategories[m.category].count++;\n  }\n\n  const categoryScores: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(allCategories)) {\n    categoryScores[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Overall weighted score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of allMeasurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  // Identify flaws (below average measurements)\n  const flaws: FlawAssessment[] = allMeasurements\n    .filter((m) => m.severity !== 'optimal' && m.severity !== 'minor')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      severity: m.severity,\n      deviation: `${m.deviation.toFixed(2)} ${m.deviationDirection} ideal`,\n      reasoning: `${m.name} is outside the ideal range`,\n      confidence: m.severity === 'extremely_severe' || m.severity === 'severe'\n        ? 'confirmed' as const\n        : 'likely' as const,\n    }))\n    .sort((a, b) => {\n      const severityOrder = { extremely_severe: 0, severe: 1, major: 2, moderate: 3 };\n      return (severityOrder[a.severity as keyof typeof severityOrder] ?? 4) -\n             (severityOrder[b.severity as keyof typeof severityOrder] ?? 4);\n    });\n\n  // Identify strengths (ideal measurements)\n  const strengths: StrengthAssessment[] = allMeasurements\n    .filter((m) => m.qualityTier === 'ideal' || m.qualityTier === 'excellent')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      qualityTier: m.qualityTier,\n      value: m.value,\n      reasoning: `${m.name} is within the ${m.qualityTier} range`,\n    }));\n\n  // Calculate percentile (based on population stats)\n  const percentile = calculateHarmonyPercentile(overallScore);\n\n  return {\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    percentile,\n    frontScore: frontResults.overallScore,\n    sideScore: sideResults.overallScore,\n    categoryScores,\n    measurements: allMeasurements,\n    flaws,\n    strengths,\n  };\n}\n\n/**\n * Calculate percentile from harmony score\n */\nfunction calculateHarmonyPercentile(score: number): number {\n  // Based on normal distribution with mean=5, stdDev=1.5\n  const mean = 5;\n  const stdDev = 1.5;\n  const z = (score - mean) / stdDev;\n  return normalCDF(z) * 100;\n}\n\n/**\n * Standard normal CDF approximation\n */\nfunction normalCDF(z: number): number {\n  const a1 = 0.254829592;\n  const a2 = -0.284496736;\n  const a3 = 1.421413741;\n  const a4 = -1.453152027;\n  const a5 = 1.061405429;\n  const p = 0.3275911;\n\n  const sign = z < 0 ? -1 : 1;\n  const absZ = Math.abs(z) / Math.sqrt(2);\n\n  const t = 1.0 / (1.0 + p * absZ);\n  const y = 1.0 - ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-absZ * absZ);\n\n  return 0.5 * (1.0 + sign * y);\n}\n\n// ============================================\n// PSL RATING CONVERSION\n// ============================================\n\nexport interface PSLRating {\n  score: number;\n  tier: string;\n  percentile: number;\n  description: string;\n}\n\n/**\n * Convert harmony score to PSL rating\n */\nexport function convertToPSL(harmonyScore: number): PSLRating {\n  // Convert 0-10 harmony to 3.0-7.5 PSL range\n  const psl = 3.0 + (harmonyScore / 10) * 4.5;\n  const clampedPSL = Math.max(3.0, Math.min(7.5, psl));\n\n  let tier: string;\n  let percentile: number;\n\n  if (clampedPSL >= 7.5) {\n    tier = 'Top Model';\n    percentile = 99.99;\n  } else if (clampedPSL >= 7.0) {\n    tier = 'Chad';\n    percentile = 99.87;\n  } else if (clampedPSL >= 6.5) {\n    tier = 'Chadlite';\n    percentile = 99.0;\n  } else if (clampedPSL >= 6.0) {\n    tier = 'High Tier Normie+';\n    percentile = 97.25;\n  } else if (clampedPSL >= 5.5) {\n    tier = 'High Tier Normie';\n    percentile = 90.0;\n  } else if (clampedPSL >= 5.0) {\n    tier = 'Mid Tier Normie+';\n    percentile = 84.15;\n  } else if (clampedPSL >= 4.5) {\n    tier = 'Mid Tier Normie';\n    percentile = 65.0;\n  } else if (clampedPSL >= 4.0) {\n    tier = 'Low Tier Normie';\n    percentile = 50.0;\n  } else if (clampedPSL >= 3.5) {\n    tier = 'Below Average';\n    percentile = 30.0;\n  } else {\n    tier = 'Subpar';\n    percentile = 15.0;\n  }\n\n  return {\n    score: clampedPSL,\n    tier,\n    percentile,\n    description: `${tier} (top ${(100 - percentile).toFixed(1)}%)`,\n  };\n}\n\n// ============================================\n// EXPORTS FOR BACKWARD COMPATIBILITY\n// ============================================\n\nexport type { LandmarkPoint } from './landmarks';\n","structuredPatch":[{"oldStart":267,"oldLines":7,"newStart":267,"newLines":11,"lines":["   },"," ","   gonialAngle: {","+    // White: Neoclassical standard - square, vertically robust jaw (115-125Â°)","     // Males: more acute (sharper jaw); Females: more obtuse (softer)","+    // Extracted from FaceIQ Male:White.htc","+    white_male: { idealMin: 115, idealMax: 125 },  // Neoclassical square jaw - less tolerant of soft/V-shaped jaws","+    white_female: { idealMin: 120, idealMax: 132 },","     male: { idealMin: 115, idealMax: 125 },","     female: { idealMin: 120, idealMax: 135 },","   },"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"69254640-1590-4258-95f9-abb83b110f95","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01NN2ZAzcN3ptTcY7rqm51Qp","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good! Now let me add white_male for lateralCanthalTilt with the 4-8 degree range.","signature":"EvkBCkYIChgCKkCFJVsfy8aadMrMAwWaJEJikjShwscvdQ6+RiOHhiaPOm/oCRolRx4cP9DMAwQIZcIgCMigZudyvCqPL0L+MNH+Egxy1h4mi4FSBVPvHSQaDNYTg+5MxYp3Vrm3DSIwrqoJW3DuYlbWybituJya+M/FVpEn6epiVeWMzXoL9WLBwlK9o0SFfaRaYvhfE35UKmHaab3YfTO8M3Zl4fBDtSGKIegT4GmZ8lhEONVvhKjk0xD/lknO1RDeI7yaZkWs1kjgxpf8l+AYzTy6leUf4X4J2ndNX/i0FiaTH79/iOHgzl5zlka2Jjl+jJQ610jbeLm/GAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":960,"cache_read_input_tokens":45282,"cache_creation":{"ephemeral_5m_input_tokens":960,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDUKzcWoNDtyXwXYYLJ","type":"assistant","uuid":"2eb8015c-6235-4cc5-be86-3c4ef6b0e84a","timestamp":"2025-12-21T17:20:09.639Z"}
{"parentUuid":"2eb8015c-6235-4cc5-be86-3c4ef6b0e84a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01NN2ZAzcN3ptTcY7rqm51Qp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01LJSatUq8xWzypt2wskvBdG","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","old_string":"  lateralCanthalTilt: {\n    // East Asian: naturally higher positive tilt\n    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian_male: { idealMin: 8, idealMax: 12 },\n    east_asian_female: { idealMin: 9, idealMax: 13 },\n    south_asian_male: { idealMin: 6, idealMax: 10 },\n    south_asian_female: { idealMin: 7, idealMax: 11 },\n    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n    // Default for others is 4-8 (already in FACEIQ_METRICS)\n  },","new_string":"  lateralCanthalTilt: {\n    // White: Neoclassical standard - neutral to slightly positive tilt (4-8Â°)\n    // East Asian: naturally higher positive tilt\n    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:MiddleEastern.htc\n    white_male: { idealMin: 4.0, idealMax: 8.0 },  // Neoclassical - neutral to slightly positive\n    white_female: { idealMin: 5.0, idealMax: 9.0 },\n    east_asian_male: { idealMin: 8, idealMax: 12 },\n    east_asian_female: { idealMin: 9, idealMax: 13 },\n    south_asian_male: { idealMin: 6, idealMax: 10 },\n    south_asian_female: { idealMin: 7, idealMax: 11 },\n    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n    // Default for others is 4-8 (already in FACEIQ_METRICS)\n  },"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":960,"cache_read_input_tokens":45282,"cache_creation":{"ephemeral_5m_input_tokens":960,"ephemeral_1h_input_tokens":0},"output_tokens":895,"service_tier":"standard"}},"requestId":"req_011CWLDUKzcWoNDtyXwXYYLJ","type":"assistant","uuid":"25ebdecb-6439-4a58-affc-4f52e37a7d0d","timestamp":"2025-12-21T17:20:19.327Z"}
{"parentUuid":"25ebdecb-6439-4a58-affc-4f52e37a7d0d","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01LJSatUq8xWzypt2wskvBdG","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   278â†’\n   279â†’  // ==========================================\n   280â†’  // EYE METRICS - Ethnic variation\n   281â†’  // ==========================================\n   282â†’  lateralCanthalTilt: {\n   283â†’    // White: Neoclassical standard - neutral to slightly positive tilt (4-8Â°)\n   284â†’    // East Asian: naturally higher positive tilt\n   285â†’    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n   286â†’    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n   287â†’    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:MiddleEastern.htc\n   288â†’    white_male: { idealMin: 4.0, idealMax: 8.0 },  // Neoclassical - neutral to slightly positive\n   289â†’    white_female: { idealMin: 5.0, idealMax: 9.0 },\n   290â†’    east_asian_male: { idealMin: 8, idealMax: 12 },\n   291â†’    east_asian_female: { idealMin: 9, idealMax: 13 },\n   292â†’    south_asian_male: { idealMin: 6, idealMax: 10 },\n   293â†’    south_asian_female: { idealMin: 7, idealMax: 11 },\n   294â†’    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n   295â†’    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n   296â†’    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n   297â†’    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n   298â†’    // Default for others is 4-8 (already in FACEIQ_METRICS)\n   299â†’  },\n   300â†’\n   301â†’  eyeAspectRatio: {\n   302â†’    // East Asian eyes often have different aspect ratio due to epicanthal fold\n   303â†’    east_asian_male: { idealMin: 2.6, idealMax: 3.2 },"}]},"uuid":"66b6d4cb-a25d-4553-9d00-a9208ed0e5ae","timestamp":"2025-12-21T17:20:19.354Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","oldString":"  lateralCanthalTilt: {\n    // East Asian: naturally higher positive tilt\n    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian_male: { idealMin: 8, idealMax: 12 },\n    east_asian_female: { idealMin: 9, idealMax: 13 },\n    south_asian_male: { idealMin: 6, idealMax: 10 },\n    south_asian_female: { idealMin: 7, idealMax: 11 },\n    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n    // Default for others is 4-8 (already in FACEIQ_METRICS)\n  },","newString":"  lateralCanthalTilt: {\n    // White: Neoclassical standard - neutral to slightly positive tilt (4-8Â°)\n    // East Asian: naturally higher positive tilt\n    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:MiddleEastern.htc\n    white_male: { idealMin: 4.0, idealMax: 8.0 },  // Neoclassical - neutral to slightly positive\n    white_female: { idealMin: 5.0, idealMax: 9.0 },\n    east_asian_male: { idealMin: 8, idealMax: 12 },\n    east_asian_female: { idealMin: 9, idealMax: 13 },\n    south_asian_male: { idealMin: 6, idealMax: 10 },\n    south_asian_female: { idealMin: 7, idealMax: 11 },\n    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n    // Default for others is 4-8 (already in FACEIQ_METRICS)\n  },","originalFile":"/**\n * FaceIQ-Style Facial Analysis Scoring System\n * Complete replication of FaceIQ Labs scoring algorithms\n *\n * Features:\n * - Exponential decay scoring with per-metric decay rates\n * - Bezier curve custom scoring for non-linear measurements\n * - 70+ facial measurements (front + side profiles)\n * - Quality tiers: Ideal, Excellent, Good\n * - 5-tier severity: Extremely Severe, Severe, Major, Moderate, Minor\n */\n\nimport { LandmarkPoint } from './landmarks';\n\n// ============================================\n// CORE TYPES\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\n/**\n * Polarity defines how deviation from the ideal range is interpreted:\n * - 'balanced': Default. Deviation in either direction is equally bad.\n * - 'higher_is_better': Values above the ideal are still good. Only values below\n *   the 'safeFloor' are true weaknesses. E.g., Canthal Tilt (positive tilt is good)\n * - 'lower_is_better': Values below the ideal are still good. Only values above\n *   the 'safeCeiling' are true weaknesses. E.g., Philtrum length (shorter is better)\n */\nexport type MetricPolarity = 'balanced' | 'higher_is_better' | 'lower_is_better';\n\nexport interface MetricConfig {\n  id: string;\n  name: string;\n  category: string;\n  unit: MeasurementUnit;\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  decayRate: number;\n  maxScore: number;\n  weight: number;\n  description: string;\n  profileType: 'front' | 'side';\n  customCurve?: BezierCurveConfig;\n  /**\n   * Polarity for directional/dimorphic scoring.\n   * Defaults to 'balanced' if not specified.\n   */\n  polarity?: MetricPolarity;\n  /**\n   * For 'higher_is_better': minimum value that's still acceptable.\n   * Values above this but below idealMin get a passing score (softFloorScore).\n   * Values below this are true weaknesses.\n   */\n  safeFloor?: number;\n  /**\n   * For 'lower_is_better': maximum value that's still acceptable.\n   * Values below this but above idealMax get a passing score (softCeilingScore).\n   * Values above this are true weaknesses.\n   */\n  safeCeiling?: number;\n  /**\n   * Score given to values in the \"acceptable but not ideal\" zone.\n   * Defaults to 8.0 (Good). Range: 6.0-9.0\n   */\n  softZoneScore?: number;\n}\n\nexport interface BezierCurveConfig {\n  mode: 'custom' | 'exponential';\n  points: CurvePoint[];\n}\n\nexport interface CurvePoint {\n  x: number;\n  y: number;\n  leftHandleX?: number;\n  leftHandleY?: number;\n  rightHandleX?: number;\n  rightHandleY?: number;\n  fixed?: boolean;\n}\n\nexport interface FaceIQScoreResult {\n  metricId: string;\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  severity: SeverityLevel;\n  idealMin: number;\n  idealMax: number;\n  deviation: number;\n  deviationDirection: 'above' | 'below' | 'within';\n  unit: MeasurementUnit;\n  category: string;\n  percentile?: number;\n}\n\nexport interface HarmonyAnalysis {\n  overallScore: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  percentile: number;\n  frontScore: number;\n  sideScore: number;\n  categoryScores: Record<string, number>;\n  measurements: FaceIQScoreResult[];\n  flaws: FlawAssessment[];\n  strengths: StrengthAssessment[];\n}\n\nexport interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n}\n\nexport interface StrengthAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  qualityTier: QualityTier;\n  value: number;\n  reasoning: string;\n}\n\n// ============================================\n// DEMOGRAPHIC TYPES & OVERRIDES\n// ============================================\n\nexport type Ethnicity =\n  | 'east_asian'\n  | 'south_asian'\n  | 'black'\n  | 'hispanic'\n  | 'middle_eastern'\n  | 'native_american'\n  | 'pacific_islander'\n  | 'white'\n  | 'other';\n\nexport type Gender = 'male' | 'female';\n\nexport type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n\nexport interface DemographicOverride {\n  idealMin: number;\n  idealMax: number;\n}\n\n/**\n * Demographic-specific ideal ranges based on anthropometric research.\n * FaceIQ uses universal scoring, but this gives more accurate assessments\n * by adjusting ideals based on ethnicity and gender.\n */\nexport const DEMOGRAPHIC_OVERRIDES: Record<string, Partial<Record<DemographicKey, DemographicOverride>>> = {\n  // ==========================================\n  // NOSE METRICS - Highest ethnicity variation\n  // ==========================================\n  nasalIndex: {\n    // Nasal Index = (Nose Width / Nose Height) Ã— 100\n    // Research: African/Pacific Islander tend platyrrhine (85-100), Asian mesorrhine (75-88), European leptorrhine (65-75)\n    east_asian_male: { idealMin: 78, idealMax: 88 },\n    east_asian_female: { idealMin: 76, idealMax: 86 },\n    south_asian_male: { idealMin: 72, idealMax: 82 },\n    south_asian_female: { idealMin: 70, idealMax: 80 },\n    black_male: { idealMin: 85, idealMax: 100 },\n    black_female: { idealMin: 83, idealMax: 98 },\n    hispanic_male: { idealMin: 75, idealMax: 87 },\n    hispanic_female: { idealMin: 73, idealMax: 85 },\n    middle_eastern_male: { idealMin: 68, idealMax: 78 },\n    middle_eastern_female: { idealMin: 66, idealMax: 76 },\n    white_male: { idealMin: 65, idealMax: 75 },\n    white_female: { idealMin: 63, idealMax: 73 },\n    native_american_male: { idealMin: 72, idealMax: 82 },\n    native_american_female: { idealMin: 70, idealMax: 80 },\n    pacific_islander_male: { idealMin: 82, idealMax: 95 },\n    pacific_islander_female: { idealMin: 80, idealMax: 93 },\n  },\n\n  nasolabialAngle: {\n    // Ideal nasolabial angle varies by ethnicity\n    // African: slightly more obtuse, European: slightly more acute\n    // Middle Eastern: Penalizes droopy tip (<90Â°) - common flaw is \"Hooked Nose\"\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    black_male: { idealMin: 95, idealMax: 110 },\n    black_female: { idealMin: 100, idealMax: 115 },\n    east_asian_male: { idealMin: 90, idealMax: 105 },\n    east_asian_female: { idealMin: 95, idealMax: 110 },\n    middle_eastern_male: { idealMin: 90, idealMax: 100 },  // Strict on droopy tip\n    middle_eastern_female: { idealMin: 95, idealMax: 105 },\n    // Gender-only fallbacks\n    male: { idealMin: 90, idealMax: 100 },\n    female: { idealMin: 100, idealMax: 110 },\n  },\n\n  nasalProjection: {\n    // Nose projection relative to face depth\n    // East Asian/African: typically less projection is ideal\n    // Middle Eastern: Accepts stronger projection (bigger nose) than White model\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian: { idealMin: 0.54, idealMax: 0.60 },\n    black: { idealMin: 0.52, idealMax: 0.58 },\n    south_asian: { idealMin: 0.56, idealMax: 0.62 },\n    middle_eastern: { idealMin: 0.62, idealMax: 0.70 },  // Higher tolerance for larger noses\n    white: { idealMin: 0.60, idealMax: 0.67 },\n    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },\n  },\n\n  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Pacific Islander: Similar to Black model, accepts wide nasal base\n    // Extracted from FaceIQ BlackAfrican.htc and Male:Pacific Islander.htc logic\n    white_male: { idealMin: 1.00, idealMax: 1.04 },\n    white_female: { idealMin: 0.98, idealMax: 1.02 },\n    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n    black_female: { idealMin: 1.13, idealMax: 1.23 },\n    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n    pacific_islander_male: { idealMin: 1.10, idealMax: 1.20 },  // Wide tolerance, similar to Black model\n    pacific_islander_female: { idealMin: 1.08, idealMax: 1.18 },\n  },\n\n  // ==========================================\n  // JAW METRICS - Clear gender dimorphism\n  // ==========================================\n  bigonialWidth: {\n    // Jaw width as % of bizygomatic width\n    // Males: wider, more angular; Females: narrower, softer\n    // Pacific Islander: Extremely wide jaw preferred - \"Warrior Skull\" robustness\n    // Extracted from FaceIQ Male:Pacific Islander.htc\n    male: { idealMin: 90, idealMax: 95 },\n    female: { idealMin: 85, idealMax: 90 },\n    pacific_islander_male: { idealMin: 92, idealMax: 98 },  // Jaw width rivals cheekbone width - extreme robustness\n    pacific_islander_female: { idealMin: 88, idealMax: 94 },\n  },\n\n  jawFrontalAngle: {\n    // More angular in males, softer in females\n    male: { idealMin: 88, idealMax: 95 },\n    female: { idealMin: 82, idealMax: 90 },\n  },\n\n  jawWidthRatio: {\n    // Males have stronger jaw width preference\n    male: { idealMin: 0.78, idealMax: 0.85 },\n    female: { idealMin: 0.72, idealMax: 0.80 },\n  },\n\n  gonialAngle: {\n    // White: Neoclassical standard - square, vertically robust jaw (115-125Â°)\n    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n    // Extracted from FaceIQ Male:White.htc\n    white_male: { idealMin: 115, idealMax: 125 },  // Neoclassical square jaw - less tolerant of soft/V-shaped jaws\n    white_female: { idealMin: 120, idealMax: 132 },\n    male: { idealMin: 115, idealMax: 125 },\n    female: { idealMin: 120, idealMax: 135 },\n  },\n\n  // ==========================================\n  // EYE METRICS - Ethnic variation\n  // ==========================================\n  lateralCanthalTilt: {\n    // East Asian: naturally higher positive tilt\n    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian_male: { idealMin: 8, idealMax: 12 },\n    east_asian_female: { idealMin: 9, idealMax: 13 },\n    south_asian_male: { idealMin: 6, idealMax: 10 },\n    south_asian_female: { idealMin: 7, idealMax: 11 },\n    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n    // Default for others is 4-8 (already in FACEIQ_METRICS)\n  },\n\n  eyeAspectRatio: {\n    // East Asian eyes often have different aspect ratio due to epicanthal fold\n    east_asian_male: { idealMin: 2.6, idealMax: 3.2 },\n    east_asian_female: { idealMin: 2.7, idealMax: 3.3 },\n    // Larger eyes in females considered more attractive\n    male: { idealMin: 2.9, idealMax: 3.4 },\n    female: { idealMin: 3.1, idealMax: 3.6 },\n  },\n\n  tearTroughDepth: {\n    // Under-eye hollowing and dark circles (infraorbital depression)\n    // South Asian: MUCH stricter penalty due to genetic hyperpigmentation\n    // Extracted from FaceIQ Male:SouthAsian.htc - biggest difference vs White model\n    white_male: { idealMin: 0.0, idealMax: 1.5 },\n    white_female: { idealMin: 0.0, idealMax: 1.3 },\n    south_asian_male: { idealMin: 0.0, idealMax: 0.5 },  // VERY strict - 0.5+ triggers \"Tired/Aged Eyes\" flaw\n    south_asian_female: { idealMin: 0.0, idealMax: 0.4 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.2 },\n    east_asian_female: { idealMin: 0.0, idealMax: 1.0 },\n  },\n\n  upperEyelidExposure: {\n    // Visible eyelid platform (space between eyelash and crease)\n    // South Asian ideal: prefers visible lid platform, penalizes hooded eyes more than White model\n    // Extracted from FaceIQ Male:SouthAsian.htc\n    white_male: { idealMin: 0.3, idealMax: 2.5 },\n    white_female: { idealMin: 0.5, idealMax: 3.0 },\n    south_asian_male: { idealMin: 0.5, idealMax: 2.0 },  // Prefers visible lid, penalizes hooding\n    south_asian_female: { idealMin: 0.7, idealMax: 2.2 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.5 },  // More tolerance for less exposure\n    east_asian_female: { idealMin: 0.2, idealMax: 1.8 },\n  },\n\n  // ==========================================\n  // FACE PROPORTIONS - Gender variation\n  // ==========================================\n  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n  },\n\n  totalFacialWidthToHeight: {\n    male: { idealMin: 1.35, idealMax: 1.40 },\n    female: { idealMin: 1.32, idealMax: 1.37 },\n  },\n\n  midfaceRatio: {\n    // Females often have more compact midface\n    // White: Neoclassical standard - strict compact midface preference\n    // Middle Eastern: Similar to White model - compact is better\n    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:MiddleEastern.htc\n    white_male: { idealMin: 0.95, idealMax: 1.02 },  // Neoclassical - penalizes long midface heavily\n    white_female: { idealMin: 0.93, idealMax: 1.00 },\n    male: { idealMin: 0.98, idealMax: 1.02 },\n    female: { idealMin: 0.95, idealMax: 1.00 },\n    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n  },\n\n  // ==========================================\n  // LIP METRICS - Ethnicity variation\n  // ==========================================\n  lipRatio: {\n    // African/Hispanic: fuller lips natural\n    black_male: { idealMin: 1.6, idealMax: 2.2 },\n    black_female: { idealMin: 1.7, idealMax: 2.3 },\n    hispanic_male: { idealMin: 1.4, idealMax: 2.0 },\n    hispanic_female: { idealMin: 1.5, idealMax: 2.1 },\n    // East Asian: less full lips\n    east_asian_male: { idealMin: 1.2, idealMax: 1.7 },\n    east_asian_female: { idealMin: 1.3, idealMax: 1.8 },\n    // Default\n    male: { idealMin: 1.3, idealMax: 1.8 },\n    female: { idealMin: 1.4, idealMax: 2.0 },\n  },\n\n  upperLipRatio: {\n    // Fuller upper lip in African phenotypes\n    black: { idealMin: 0.38, idealMax: 0.48 },\n    hispanic: { idealMin: 0.36, idealMax: 0.45 },\n    east_asian: { idealMin: 0.32, idealMax: 0.40 },\n    female: { idealMin: 0.34, idealMax: 0.42 },\n  },\n\n  // ==========================================\n  // PROFILE METRICS - Gender & ethnicity\n  // ==========================================\n  chinProjection: {\n    // Males: more projected chin ideal\n    // Black/African: Adjusted for bimaxillary prognathism (forward mouth projection)\n    // Extracted from FaceIQ BlackAfrican.htc logic\n    male: { idealMin: 0, idealMax: 3 },\n    female: { idealMin: -2, idealMax: 2 },\n    black_male: { idealMin: 0, idealMax: 4 },  // Accommodates natural forward projection\n    black_female: { idealMin: -1, idealMax: 3 },\n  },\n\n  nasofrontalAngle: {\n    // Higher brow ridge in males\n    male: { idealMin: 128, idealMax: 138 },\n    female: { idealMin: 132, idealMax: 142 },\n  },\n\n  chinToPhiltrumRatio: {\n    // White: Neoclassical standard - strict balance between chin and philtrum\n    // Black/African: Fuller lips naturally shorten visible philtrum\n    // Extracted from FaceIQ Male:White.htc (Neoclassical) and BlackAfrican.htc\n    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n    white_male: { idealMin: 2.10, idealMax: 2.30 },  // Neoclassical - strict lower face balance\n    white_female: { idealMin: 2.05, idealMax: 2.25 },\n    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n    black_female: { idealMin: 2.10, idealMax: 2.65 },\n  },\n\n  // ==========================================\n  // SKIN QUALITY - Ethnicity variation\n  // ==========================================\n  skinUniformity: {\n    // South Asian: Stricter standards due to genetic hyperpigmentation tendency\n    // Hispanic: Similar to South Asian - penalizes hyperpigmentation more than White model\n    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n    white_male: { idealMin: 0.88, idealMax: 1.00 },\n    white_female: { idealMin: 0.90, idealMax: 1.00 },\n    south_asian_male: { idealMin: 0.90, idealMax: 1.00 },  // Stricter - hyperpigmentation common\n    south_asian_female: { idealMin: 0.92, idealMax: 1.00 },\n    east_asian_male: { idealMin: 0.92, idealMax: 1.00 },  // High skin quality standards\n    east_asian_female: { idealMin: 0.94, idealMax: 1.00 },\n    black_male: { idealMin: 0.85, idealMax: 1.00 },  // More tolerance for melanin variation\n    black_female: { idealMin: 0.87, idealMax: 1.00 },\n    hispanic_male: { idealMin: 0.85, idealMax: 1.00 },  // Bridge: more tolerance than South Asian, less than White\n    hispanic_female: { idealMin: 0.87, idealMax: 1.00 },\n  },\n\n  // ==========================================\n  // EYEBROW METRICS - Ethnicity variation\n  // ==========================================\n  eyebrowThickness: {\n    // Middle Eastern: Heavily favors thick, dense eyebrows (\"Dark Triad\" look with deep-set eyes)\n    // Extracted from FaceIQ Male:MiddleEastern.htc - STRICTEST eyebrow requirements\n    middle_eastern_male: { idealMin: 2.5, idealMax: 5.0 },  // Prefers significantly thicker/darker brows\n    middle_eastern_female: { idealMin: 2.0, idealMax: 4.0 },\n    east_asian_male: { idealMin: 1.5, idealMax: 3.0 },  // Typically less thick\n    east_asian_female: { idealMin: 1.3, idealMax: 2.5 },\n    male: { idealMin: 2.0, idealMax: 4.0 },\n    female: { idealMin: 1.8, idealMax: 3.5 },\n  },\n\n  eyebrowDistance: {\n    // Middle Eastern: \"Kill Switch\" for unibrow (synophrys)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    // While thick brows are favored, unibrow is a critical flaw if distance < 15mm\n    middle_eastern_male: { idealMin: 15, idealMax: 25 },  // Stricter minimum to avoid unibrow\n    middle_eastern_female: { idealMin: 18, idealMax: 28 },\n    male: { idealMin: 15, idealMax: 25 },\n    female: { idealMin: 16, idealMax: 26 },\n  },\n\n  orbitalVector: {\n    // Middle Eastern: Favors deep-set eyes (lower/negative orbital vector)\n    // Part of the \"Dark Triad\" look with heavy brows\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    middle_eastern_male: { idealMin: -2, idealMax: 3 },  // Allows more deep-set eyes\n    middle_eastern_female: { idealMin: -1, idealMax: 4 },\n    male: { idealMin: 0, idealMax: 4 },\n    female: { idealMin: 1, idealMax: 5 },\n  },\n};\n\n/**\n * Get metric configuration with demographic-specific overrides applied.\n * Lookup priority: ethnicity_gender > gender > ethnicity > default\n */\nexport function getMetricConfigForDemographics(\n  metricId: string,\n  gender: Gender,\n  ethnicity: Ethnicity = 'other'\n): MetricConfig | null {\n  const baseConfig = FACEIQ_METRICS[metricId];\n  if (!baseConfig) return null;\n\n  const overrides = DEMOGRAPHIC_OVERRIDES[metricId];\n  if (!overrides) return baseConfig;\n\n  // Try specific combo first (e.g., \"east_asian_male\")\n  const specificKey = `${ethnicity}_${gender}` as DemographicKey;\n  const override = overrides[specificKey] || overrides[gender] || overrides[ethnicity];\n\n  if (!override) return baseConfig;\n\n  return {\n    ...baseConfig,\n    idealMin: override.idealMin,\n    idealMax: override.idealMax,\n  };\n}\n\n// ============================================\n// FACEIQ MEASUREMENT CONFIGURATIONS (70+)\n// ============================================\n\nexport const FACEIQ_METRICS: Record<string, MetricConfig> = {\n  // ==========================================\n  // FRONT PROFILE - FACIAL PROPORTIONS (32)\n  // ==========================================\n\n  faceWidthToHeight: {\n    id: 'faceWidthToHeight',\n    name: 'Face Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.96,\n    idealMax: 2.0,\n    rangeMin: 1.4,\n    rangeMax: 2.5,\n    decayRate: 6.4,\n    maxScore: 30,  // FaceIQ: highest priority metric\n    weight: 0.06,\n    description: 'Ratio of bizygomatic width to upper face height',\n    profileType: 'front',\n  },\n\n  lowerThirdProportion: {\n    id: 'lowerThirdProportion',\n    name: 'Lower Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31,\n    idealMax: 33.5,\n    rangeMin: 24,\n    rangeMax: 40,\n    decayRate: 1.86,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by lower third (subnasale to menton)',\n    profileType: 'front',\n  },\n\n  middleThirdProportion: {\n    id: 'middleThirdProportion',\n    name: 'Middle Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31.4,\n    idealMax: 33.4,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by middle third',\n    profileType: 'front',\n  },\n\n  upperThirdProportion: {\n    id: 'upperThirdProportion',\n    name: 'Upper Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 30,\n    idealMax: 32,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Percentage of face occupied by upper third (trichion to glabella)',\n    profileType: 'front',\n  },\n\n  bitemporalWidth: {\n    id: 'bitemporalWidth',\n    name: 'Bitemporal Width',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 75,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Temple width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  cheekboneHeight: {\n    id: 'cheekboneHeight',\n    name: 'Cheekbone Height',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 83,\n    idealMax: 100,\n    rangeMin: 30,\n    rangeMax: 140,\n    decayRate: 0.5,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Vertical position of cheekbones relative to face height',\n    profileType: 'front',\n  },\n\n  totalFacialWidthToHeight: {\n    id: 'totalFacialWidthToHeight',\n    name: 'Total Facial Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.34,\n    idealMax: 1.37,\n    rangeMin: 1.0,\n    rangeMax: 1.7,\n    decayRate: 13.2,\n    maxScore: 25,  // Special: higher max score\n    weight: 0.05,\n    description: 'Total face height divided by cheek width',\n    profileType: 'front',\n    customCurve: {\n      mode: 'custom',\n      points: [\n        { x: 1.05, y: 0 },\n        { x: 1.17, y: 1.41 },\n        { x: 1.25, y: 3.86 },\n        { x: 1.29, y: 6.01 },\n        { x: 1.32, y: 8.88 },\n        { x: 1.34, y: 10, fixed: true },\n        { x: 1.37, y: 10, fixed: true },\n        { x: 1.39, y: 8.88 },\n        { x: 1.42, y: 6.01 },\n        { x: 1.46, y: 3.86 },\n        { x: 1.54, y: 1.41 },\n        { x: 1.66, y: 0 },\n      ],\n    },\n  },\n\n  midfaceRatio: {\n    id: 'midfaceRatio',\n    name: 'Midface Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 0.97,\n    idealMax: 1.0,\n    rangeMin: 0.5,\n    rangeMax: 1.5,\n    decayRate: 31.6,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.04,\n    description: 'Midface width to height ratio for facial balance',\n    profileType: 'front',\n  },\n\n  // JAW MEASUREMENTS\n  jawSlope: {\n    id: 'jawSlope',\n    name: 'Jaw Slope',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 140,\n    idealMax: 142.5,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of the jawline from gonion to chin',\n    profileType: 'front',\n  },\n\n  jawFrontalAngle: {\n    id: 'jawFrontalAngle',\n    name: 'Jaw Frontal Angle',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 35,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 20,  // FaceIQ: high priority\n    weight: 0.04,\n    description: 'Angle of jaw corners from frontal view',\n    profileType: 'front',\n  },\n\n  bigonialWidth: {\n    id: 'bigonialWidth',\n    name: 'Bigonial Width',\n    category: 'Jaw Shape',\n    unit: 'percent',\n    idealMin: 87.75,\n    idealMax: 91.75,\n    rangeMin: 60.25,\n    rangeMax: 120.25,\n    decayRate: 0.9,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Jaw width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  jawWidthRatio: {\n    id: 'jawWidthRatio',\n    name: 'Jaw Width to Face Width Ratio',\n    category: 'Jaw Shape',\n    unit: 'ratio',\n    idealMin: 0.75,\n    idealMax: 0.82,\n    rangeMin: 0.6,\n    rangeMax: 0.95,\n    decayRate: 25.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Bigonial width divided by bizygomatic width',\n    profileType: 'front',\n  },\n\n  // EYE MEASUREMENTS\n  lateralCanthalTilt: {\n    id: 'lateralCanthalTilt',\n    name: 'Lateral Canthal Tilt',\n    category: 'Eyes',\n    unit: 'degrees',\n    idealMin: 4.0,   // Updated: 4-8Â° is peak \"hunter eyes\"\n    idealMax: 8.0,\n    rangeMin: -5,\n    rangeMax: 20,\n    decayRate: 1.5,  // Reduced: gentler decay for positive tilts\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle of eye from inner to outer canthus. Positive tilt is attractive.',\n    profileType: 'front',\n    // DIRECTIONAL SCORING: Higher (positive) tilt is better\n    // - Ideal: 4-8Â° (attractive upswept eyes / \"hunter eyes\")\n    // - Good: 0-4Â° (neutral to slight positive - still attractive)\n    // - Weak: < 0Â° (negative/droopy tilt - only this is a true weakness)\n    polarity: 'higher_is_better',\n    safeFloor: 0.0,       // Neutral tilt - anything above is acceptable\n    softZoneScore: 8.0,   // \"Good\" score for 0-4Â° range\n  },\n\n  eyeAspectRatio: {\n    id: 'eyeAspectRatio',\n    name: 'Eye Aspect Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 3.0,\n    idealMax: 3.5,\n    rangeMin: 0.8,\n    rangeMax: 6,\n    decayRate: 2.0,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Eye width divided by eye height',\n    profileType: 'front',\n  },\n\n  eyeSeparationRatio: {\n    id: 'eyeSeparationRatio',\n    name: 'Eye Separation Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 45.7,\n    idealMax: 46.8,\n    rangeMin: 35,\n    rangeMax: 55,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Intercanthal distance as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryRatio: {\n    id: 'interpupillaryRatio',\n    name: 'Interpupillary Distance Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 44,\n    idealMax: 48,\n    rangeMin: 38,\n    rangeMax: 54,\n    decayRate: 1.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'IPD as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryMouthWidthRatio: {\n    id: 'interpupillaryMouthWidthRatio',\n    name: 'Interpupillary-Mouth Width Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.83,\n    idealMax: 0.87,\n    rangeMin: 0.6,\n    rangeMax: 1.1,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Mouth width divided by interpupillary distance',\n    profileType: 'front',\n  },\n\n  oneEyeApartTest: {\n    id: 'oneEyeApartTest',\n    name: 'One Eye Apart Test',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.95,\n    idealMax: 1.0,\n    rangeMin: 0.7,\n    rangeMax: 1.3,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Intercanthal distance should equal one eye width',\n    profileType: 'front',\n  },\n\n  tearTroughDepth: {\n    id: 'tearTroughDepth',\n    name: 'Tear Trough Depth',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.0,\n    idealMax: 1.5,\n    rangeMin: 0.0,\n    rangeMax: 4.0,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Under-eye hollow depth (infraorbital depression). Lower is better for youthfulness.',\n    profileType: 'front',\n    polarity: 'lower_is_better',\n    safeCeiling: 1.5,  // White standard\n    softZoneScore: 7.5,\n  },\n\n  upperEyelidExposure: {\n    id: 'upperEyelidExposure',\n    name: 'Upper Eyelid Exposure',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 2.5,\n    rangeMin: 0.0,\n    rangeMax: 5.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Visible upper eyelid platform. Too little creates hooded eyes.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  // EYEBROW MEASUREMENTS\n  eyebrowThickness: {\n    id: 'eyebrowThickness',\n    name: 'Eyebrow Thickness',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 2.0,\n    idealMax: 4.0,\n    rangeMin: 1.0,\n    rangeMax: 6.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow density and thickness. Higher values indicate fuller, denser brows.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  eyebrowDistance: {\n    id: 'eyebrowDistance',\n    name: 'Inter-Eyebrow Distance',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 15,\n    idealMax: 25,\n    rangeMin: 5,\n    rangeMax: 40,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance between inner edges of eyebrows. Too low creates unibrow (synophrys).',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  browLengthRatio: {\n    id: 'browLengthRatio',\n    name: 'Brow Length to Face Width Ratio',\n    category: 'Upper Third',\n    unit: 'percent',\n    idealMin: 28,\n    idealMax: 32,\n    rangeMin: 20,\n    rangeMax: 40,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow length as percentage of face width',\n    profileType: 'front',\n  },\n\n  eyebrowTilt: {\n    id: 'eyebrowTilt',\n    name: 'Eyebrow Tilt',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 6.5,\n    idealMax: 11,\n    rangeMin: -5,\n    rangeMax: 25,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of eyebrow from head to tail',\n    profileType: 'front',\n  },\n\n  eyebrowLowSetedness: {\n    id: 'eyebrowLowSetedness',\n    name: 'Eyebrow Low Setedness',\n    category: 'Upper Third',\n    unit: 'ratio',\n    idealMin: 0,\n    idealMax: 0.45,\n    rangeMin: -0.2,\n    rangeMax: 1.0,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from brow to eye relative to eye height',\n    profileType: 'front',\n  },\n\n  // NOSE MEASUREMENTS (FRONT)\n  nasalIndex: {\n    id: 'nasalIndex',\n    name: 'Nasal Index',\n    category: 'Nose',\n    unit: 'percent',\n    idealMin: 70,\n    idealMax: 85,\n    rangeMin: 55,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose width divided by nose height Ã— 100',\n    profileType: 'front',\n  },\n\n  intercanthalNasalRatio: {\n    id: 'intercanthalNasalRatio',\n    name: 'Intercanthal-Nasal Width Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 1.04,\n    idealMax: 1.16,\n    rangeMin: 0.7,\n    rangeMax: 1.5,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Alar width should roughly equal intercanthal distance',\n    profileType: 'front',\n  },\n\n  noseBridgeWidth: {\n    id: 'noseBridgeWidth',\n    name: 'Nose Bridge to Nose Width',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.6,\n    idealMax: 0.75,\n    rangeMin: 0.4,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ratio of nose bridge width to alar base width',\n    profileType: 'front',\n  },\n\n  noseTipPosition: {\n    id: 'noseTipPosition',\n    name: 'Nose Tip Position',\n    category: 'Nose',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 3.5,\n    rangeMin: -7.5,\n    rangeMax: 12.5,\n    decayRate: 1.5,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Nose tip deviation from facial midline',\n    profileType: 'front',\n  },\n\n  // MOUTH/LIP MEASUREMENTS\n  mouthWidthToNoseRatio: {\n    id: 'mouthWidthToNoseRatio',\n    name: 'Mouth Width to Nose Width Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.43,\n    idealMax: 1.51,\n    rangeMin: 0.96,\n    rangeMax: 1.91,\n    decayRate: 18.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Mouth width divided by nose width',\n    profileType: 'front',\n  },\n\n  lowerToUpperLipRatio: {\n    id: 'lowerToUpperLipRatio',\n    name: 'Lower Lip to Upper Lip Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.58,\n    idealMax: 1.88,\n    rangeMin: -0.98,\n    rangeMax: 4.03,\n    decayRate: 8.0,\n    maxScore: 7.5,  // FaceIQ: medium priority\n    weight: 0.02,\n    description: 'Lower lip height divided by upper lip height',\n    profileType: 'front',\n  },\n\n  cupidsBowDepth: {\n    id: 'cupidsBowDepth',\n    name: \"Cupid's Bow Depth\",\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2.3,\n    idealMax: 4,\n    rangeMin: 0,\n    rangeMax: 7,\n    decayRate: 2.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: \"Depth of the cupid's bow curve\",\n    profileType: 'front',\n  },\n\n  mouthCornerPosition: {\n    id: 'mouthCornerPosition',\n    name: 'Mouth Corner Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Mouth corner vertical position relative to lip center',\n    profileType: 'front',\n  },\n\n  // CHIN MEASUREMENTS (FRONT)\n  chinToPhiltrumRatio: {\n    id: 'chinToPhiltrumRatio',\n    name: 'Chin to Philtrum Ratio',\n    category: 'Chin',\n    unit: 'ratio',\n    idealMin: 2.15,\n    idealMax: 2.45,\n    rangeMin: 0.3,\n    rangeMax: 4.5,\n    decayRate: 10.0,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.02,\n    description: 'Chin height divided by philtrum length',\n    profileType: 'front',\n  },\n\n  // OTHER FRONT MEASUREMENTS\n  iaaJfaDeviation: {\n    id: 'iaaJfaDeviation',\n    name: 'Deviation of IAA & JFA',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 0,\n    idealMax: 2.5,\n    rangeMin: -25,\n    rangeMax: 30,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Deviation between Ipsilateral Alar Angle and Jaw Frontal Angle',\n    profileType: 'front',\n  },\n\n  ipsilateralAlarAngle: {\n    id: 'ipsilateralAlarAngle',\n    name: 'Ipsilateral Alar Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 60,\n    rangeMax: 125,\n    decayRate: 0.6,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Angle of alar base relative to facial plane',\n    profileType: 'front',\n  },\n\n  earProtrusionAngle: {\n    id: 'earProtrusionAngle',\n    name: 'Ear Protrusion Angle',\n    category: 'Ears',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 11.5,\n    rangeMin: -25,\n    rangeMax: 40,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of ear protrusion from head',\n    profileType: 'front',\n  },\n\n  earProtrusionRatio: {\n    id: 'earProtrusionRatio',\n    name: 'Ear Protrusion Ratio',\n    category: 'Ears',\n    unit: 'percent',\n    idealMin: 8,\n    idealMax: 12,\n    rangeMin: -20,\n    rangeMax: 40,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ear protrusion as percentage of head width',\n    profileType: 'front',\n  },\n\n  neckWidth: {\n    id: 'neckWidth',\n    name: 'Neck Width',\n    category: 'Neck',\n    unit: 'percent',\n    idealMin: 92,\n    idealMax: 98,\n    rangeMin: 60,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Neck width as percentage of jaw width',\n    profileType: 'front',\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS (38)\n  // ==========================================\n\n  gonialAngle: {\n    id: 'gonialAngle',\n    name: 'Gonial Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 130,\n    rangeMin: 105,\n    rangeMax: 145,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle at the jaw corner (gonion)',\n    profileType: 'side',\n  },\n\n  nasolabialAngle: {\n    id: 'nasolabialAngle',\n    name: 'Nasolabial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 90,\n    idealMax: 105,\n    rangeMin: 75,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle between columella and upper lip',\n    profileType: 'side',\n  },\n\n  nasofrontalAngle: {\n    id: 'nasofrontalAngle',\n    name: 'Nasofrontal Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 116,\n    idealMax: 128,\n    rangeMin: 90,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the bridge of nose (nasion)',\n    profileType: 'side',\n  },\n\n  nasofacialAngle: {\n    id: 'nasofacialAngle',\n    name: 'Nasofacial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 31,\n    idealMax: 35,\n    rangeMin: 15,\n    rangeMax: 50,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between nose and face plane',\n    profileType: 'side',\n  },\n\n  nasomentaAngle: {\n    id: 'nasomentaAngle',\n    name: 'Nasomental Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 126,\n    idealMax: 131,\n    rangeMin: 105,\n    rangeMax: 155,\n    decayRate: 0.7,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle from nasion to nose tip to chin',\n    profileType: 'side',\n  },\n\n  nasalTipAngle: {\n    id: 'nasalTipAngle',\n    name: 'Nasal Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 105,\n    rangeMin: 70,\n    rangeMax: 120,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the nose tip',\n    profileType: 'side',\n  },\n\n  nasalProjection: {\n    id: 'nasalProjection',\n    name: 'Nasal Projection',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.55,\n    idealMax: 0.6,\n    rangeMin: 0.4,\n    rangeMax: 0.75,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose projection relative to nasal length (Goode ratio)',\n    profileType: 'side',\n  },\n\n  nasalWToHRatio: {\n    id: 'nasalWToHRatio',\n    name: 'Nasal W to H Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.67,\n    idealMax: 0.78,\n    rangeMin: 0.5,\n    rangeMax: 0.95,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Nose width to height ratio from side view',\n    profileType: 'side',\n  },\n\n  noseTipRotationAngle: {\n    id: 'noseTipRotationAngle',\n    name: 'Nose Tip Rotation Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 95,\n    idealMax: 110,\n    rangeMin: 80,\n    rangeMax: 125,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of nose tip rotation',\n    profileType: 'side',\n  },\n\n  frankfortTipAngle: {\n    id: 'frankfortTipAngle',\n    name: 'Frankfort-Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 28,\n    idealMax: 34,\n    rangeMin: 20,\n    rangeMax: 42,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle between Frankfort plane and nose tip',\n    profileType: 'side',\n  },\n\n  mentolabialAngle: {\n    id: 'mentolabialAngle',\n    name: 'Mentolabial Angle',\n    category: 'Lips',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 140,\n    rangeMin: 100,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the labiomental fold',\n    profileType: 'side',\n  },\n\n  zAngle: {\n    id: 'zAngle',\n    name: 'Z Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 75,\n    idealMax: 85,\n    rangeMin: 60,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Merrifield Z-Angle for profile assessment',\n    profileType: 'side',\n  },\n\n  submentalCervicalAngle: {\n    id: 'submentalCervicalAngle',\n    name: 'Submental Cervical Angle',\n    category: 'Neck',\n    unit: 'degrees',\n    idealMin: 94,\n    idealMax: 106,\n    rangeMin: 70,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between chin and neck',\n    profileType: 'side',\n  },\n\n  facialConvexityGlabella: {\n    id: 'facialConvexityGlabella',\n    name: 'Facial Convexity (Glabella)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 165,\n    idealMax: 175,\n    rangeMin: 150,\n    rangeMax: 185,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Facial convexity angle using glabella',\n    profileType: 'side',\n  },\n\n  facialConvexityNasion: {\n    id: 'facialConvexityNasion',\n    name: 'Facial Convexity (Nasion)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 168,\n    idealMax: 178,\n    rangeMin: 155,\n    rangeMax: 190,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial convexity angle using nasion',\n    profileType: 'side',\n  },\n\n  totalFacialConvexity: {\n    id: 'totalFacialConvexity',\n    name: 'Total Facial Convexity',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 135,\n    idealMax: 145,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Complete facial profile convexity measurement',\n    profileType: 'side',\n  },\n\n  facialDepthToHeight: {\n    id: 'facialDepthToHeight',\n    name: 'Facial Depth to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.3,\n    idealMax: 1.44,\n    rangeMin: 0.7,\n    rangeMax: 1.8,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial depth divided by facial height',\n    profileType: 'side',\n  },\n\n  anteriorFacialDepth: {\n    id: 'anteriorFacialDepth',\n    name: 'Anterior Facial Depth',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 64.5,\n    idealMax: 67.5,\n    rangeMin: 45,\n    rangeMax: 95,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Anterior facial projection angle',\n    profileType: 'side',\n  },\n\n  interiorMidfaceProjectionAngle: {\n    id: 'interiorMidfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 50,\n    idealMax: 56,\n    rangeMin: 30,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Interior midface projection from side profile',\n    profileType: 'side',\n  },\n\n  recessionFromFrankfort: {\n    id: 'recessionFromFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'mm',\n    idealMin: 1.5,\n    idealMax: 15,\n    rangeMin: -30,\n    rangeMax: 30,\n    decayRate: 0.3,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin position relative to Frankfort plane',\n    profileType: 'side',\n  },\n\n  mandibularPlaneAngle: {\n    id: 'mandibularPlaneAngle',\n    name: 'Mandibular Plane Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 22,\n    idealMax: 28,\n    rangeMin: 15,\n    rangeMax: 38,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of mandibular plane to Frankfort plane',\n    profileType: 'side',\n  },\n\n  ramusToMandibleRatio: {\n    id: 'ramusToMandibleRatio',\n    name: 'Ramus to Mandible Ratio',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'ratio',\n    idealMin: 0.65,\n    idealMax: 0.75,\n    rangeMin: 0.5,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Ramus height divided by mandible length',\n    profileType: 'side',\n  },\n\n  gonionToMouthLine: {\n    id: 'gonionToMouthLine',\n    name: 'Gonion to Mouth Line',\n    category: 'Jaw Shape',\n    unit: 'mm',\n    idealMin: -5,\n    idealMax: 5,\n    rangeMin: -20,\n    rangeMax: 20,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from gonion to mouth level line',\n    profileType: 'side',\n  },\n\n  // E-LINE MEASUREMENTS\n  eLineUpperLip: {\n    id: 'eLineUpperLip',\n    name: 'Upper Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -4,\n    idealMax: -2,\n    rangeMin: -10,\n    rangeMax: 4,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Upper lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  eLineLowerLip: {\n    id: 'eLineLowerLip',\n    name: 'Lower Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 0,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Lower lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  // S-LINE MEASUREMENTS\n  sLineUpperLip: {\n    id: 'sLineUpperLip',\n    name: 'Upper Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 3,\n    rangeMin: -5,\n    rangeMax: 8,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  sLineLowerLip: {\n    id: 'sLineLowerLip',\n    name: 'Lower Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -0.4,\n    idealMax: 0.4,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  // BURSTONE LINE\n  burstoneUpperLip: {\n    id: 'burstoneUpperLip',\n    name: 'Upper Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2,\n    idealMax: 4,\n    rangeMin: -2,\n    rangeMax: 8,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  burstoneLowerLip: {\n    id: 'burstoneLowerLip',\n    name: 'Lower Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 1,\n    idealMax: 3,\n    rangeMin: -3,\n    rangeMax: 7,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  // H LINE\n  holdawayHLine: {\n    id: 'holdawayHLine',\n    name: 'Holdaway H Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Holdaway H-line soft tissue assessment',\n    profileType: 'side',\n  },\n\n  // CHIN MEASUREMENTS (SIDE)\n  chinProjection: {\n    id: 'chinProjection',\n    name: 'Chin Projection',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -3,\n    idealMax: 3,\n    rangeMin: -12,\n    rangeMax: 12,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin projection relative to ideal position',\n    profileType: 'side',\n  },\n\n  recessionRelativeToFrankfort: {\n    id: 'recessionRelativeToFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 2,\n    rangeMin: -10,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin recession relative to Frankfort horizontal',\n    profileType: 'side',\n  },\n\n  // FOREHEAD\n  browridgeInclinationAngle: {\n    id: 'browridgeInclinationAngle',\n    name: 'Browridge Inclination Angle',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 18,\n    rangeMin: 0,\n    rangeMax: 28,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the brow ridge from profile',\n    profileType: 'side',\n  },\n\n  upperForeheadSlope: {\n    id: 'upperForeheadSlope',\n    name: 'Upper Forehead Slope',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 5,\n    idealMax: 12,\n    rangeMin: 0,\n    rangeMax: 20,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Slope angle of the upper forehead',\n    profileType: 'side',\n  },\n\n  // MIDFACE PROJECTION\n  midfaceProjectionAngle: {\n    id: 'midfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 95,\n    rangeMin: 75,\n    rangeMax: 105,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of midface projection from profile',\n    profileType: 'side',\n  },\n\n  orbitalVector: {\n    id: 'orbitalVector',\n    name: 'Orbital Vector',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -6,\n    rangeMax: 10,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Relationship of globe to orbital rim',\n    profileType: 'side',\n  },\n\n  skinUniformity: {\n    id: 'skinUniformity',\n    name: 'Skin Uniformity',\n    category: 'Skin Quality',\n    unit: 'ratio',\n    idealMin: 0.90,\n    idealMax: 1.00,\n    rangeMin: 0.50,\n    rangeMax: 1.00,\n    decayRate: 5.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Skin tone evenness and hyperpigmentation. 1.0 = perfectly uniform.',\n    profileType: 'front',\n    polarity: 'higher_is_better',\n    safeFloor: 0.85,  // Acceptable uniformity threshold\n    softZoneScore: 7.5,\n  },\n\n};\n\n// ============================================\n// FLAW MAPPINGS (Extracted from FaceIQ)\n// ============================================\n\nexport interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n  reasoning: string;\n}\n\nexport const METRIC_FLAW_MAPPINGS: Record<string, FlawMapping[]> = {\n  anteriorFacialDepth: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Anterior Facial Depth measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  bitemporalWidth: [\n    { category: 'Upper Third', flawName: 'Narrow forehead', confidence: 'confirmed', reasoning: 'Reduced bitemporal width indicates a narrower than ideal forehead relative to the cheekbones. This disrupts facial harmony by creating a compressed hairline and forehead, altering the overall shape of the face.' },\n  ],\n  cheekboneHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Low-set cheekbones', confidence: 'confirmed', reasoning: 'Reduced cheekbone height indicates that the cheekbones are positioned lower than ideal. This disrupts facial harmony by creating an unpronounced appearance to the cheekbones and facial structure.' },\n  ],\n  eyeAspectRatio: [\n    { category: 'Eyes', flawName: 'Overly round eye shape', confidence: 'confirmed', reasoning: 'A reduced eye aspect ratio indicates overly narrow eyes relative to their height. This disrupts facial harmony by creating an overly surprised appearance and reducing angular definition.' },\n  ],\n  eyeSeparationRatio: [\n    { category: 'Eyes', flawName: 'Close-set eyes', confidence: 'confirmed', reasoning: 'Reduced eye separation indicates close-set eyes. This disrupts facial harmony by making the eye area appear too compressed.' },\n  ],\n  eyebrowLowSetedness: [\n    { category: 'Eyes', flawName: 'Medium-set eyebrows', confidence: 'confirmed', reasoning: 'Increased eyebrow low setedness indicates eyebrows that are positioned higher than ideal. This disrupts facial harmony by reducing the overall visual impact of the eyebrows and framing of the eyes.' },\n  ],\n  faceWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced face width to height ratio indicates an overly long midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  facialDepthToHeight: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'Reduced facial depth to height ratio indicates insufficient mid-face projection relative to height. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  gonialAngle: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  holdawayHLine: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'Decreased H-line indicates the lips are positioned too far in front of the line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  interiorMidfaceProjectionAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Interior Midface Projection Angle measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  ipsilateralAlarAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A decreased ipsilateral alar angle indicates an overly narrow interior midface. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  jawFrontalAngle: [\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A narrower jaw frontal angle indicates a steeper jawline or overly wide chin. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  jawSlope: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'The Jaw Slope measurement is above the ideal range. This disrupts facial harmony in the lower face.' },\n  ],\n  lateralCanthalTilt: [\n    { category: 'Eyes', flawName: 'Insufficient eye tilt', confidence: 'confirmed', reasoning: 'A decreased lateral canthal tilt indicates insufficiently upturned eyes. This disrupts facial harmony by creating a less alert and youthful appearance.' },\n  ],\n  burstoneLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the Burstone line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  eLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned too far in front of the E-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  sLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the S-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  lowerThirdProportion: [\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'The upper jaw is too long relative to lower jaw, possibly from a long upper jaw or short lower jaw, or a combination of both. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  mandibularPlaneAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Hyper-divergent jaw growth', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by elongating the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  midfaceRatio: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  nasofacialAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A smaller nasofacial angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  nasofrontalAngle: [\n    { category: 'Upper Third', flawName: 'Soft and weak brow ridge', confidence: 'confirmed', reasoning: 'An increased nasofrontal angle indicates reduced brow ridge prominence and angularity. This disrupts facial harmony by creating a less defined upper face.' },\n  ],\n  nasomentaAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A larger nasomental angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  noseBridgeWidth: [\n    { category: 'Nose', flawName: 'Overly narrow nose bridge', confidence: 'confirmed', reasoning: 'The Nose Bridge to Nose Width measurement is above the ideal range. This disrupts facial harmony by creating an unbalanced nasal profile.' },\n  ],\n  orbitalVector: [\n    { category: 'Eyes', flawName: 'Sunken orbital region', confidence: 'confirmed', reasoning: 'A decreased orbital vector indicates insufficient projection and volume underneath the eye. This disrupts facial harmony due to the lacking volume underneath the eyes, reducing vibrancy and youthfulness.' },\n  ],\n  ramusToMandibleRatio: [\n    { category: 'Jaw Shape', flawName: 'Short ramus', confidence: 'confirmed', reasoning: 'A reduced ramus-to-mandible ratio indicates a shorter than ideal vertical jawbone (ramus) when compared to the mandible. This disrupts facial harmony by reducing jaw height and definition.' },\n  ],\n  submentalCervicalAngle: [\n    { category: 'Neck', flawName: 'Round neck region', confidence: 'confirmed', reasoning: 'An increased submental cervical angle indicates a round neck region, possibly from excess submental fat or tissue. This disrupts facial harmony by reducing neck definition.' },\n  ],\n  totalFacialWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Overly long face shape', confidence: 'confirmed', reasoning: 'An increased total facial width to height ratio indicates an overly long face relative to its height. This disrupts facial harmony by creating a vertically stretched appearance to the face.' },\n  ],\n};\n\n// ============================================\n// CUSTOM BEZIER CURVES (Extracted from FaceIQ)\n// ============================================\n\nexport const METRIC_CUSTOM_CURVES: Record<string, CurvePoint[]> = {\n  faceWidthToHeight: [\n    { x: 1.49, y: 0, leftHandleX: 1.44, leftHandleY: 0, rightHandleX: 1.55, rightHandleY: 0 },\n    { x: 1.68, y: 1.05, leftHandleX: 1.62, leftHandleY: 0.36, rightHandleX: 1.71, rightHandleY: 1.58 },\n    { x: 1.77, y: 3.07, leftHandleX: 1.74, leftHandleY: 2.15, rightHandleX: 1.79, rightHandleY: 3.88 },\n    { x: 1.83, y: 5.83, leftHandleX: 1.80, leftHandleY: 4.64, rightHandleX: 1.84, rightHandleY: 6.85 },\n    { x: 1.89, y: 8.70, leftHandleX: 1.88, leftHandleY: 8.30, rightHandleX: 1.92, rightHandleY: 9.50 },\n    { x: 1.96, y: 10, leftHandleX: 1.96, leftHandleY: 10, rightHandleX: 1.96, rightHandleY: 10, fixed: true },\n    { x: 2.00, y: 10, leftHandleX: 2.00, leftHandleY: 10, rightHandleX: 2.00, rightHandleY: 10, fixed: true },\n    { x: 2.07, y: 8.70, leftHandleX: 2.04, leftHandleY: 9.50, rightHandleX: 2.08, rightHandleY: 8.30 },\n    { x: 2.13, y: 5.83, leftHandleX: 2.12, leftHandleY: 6.85, rightHandleX: 2.16, rightHandleY: 4.64 },\n    { x: 2.19, y: 3.07, leftHandleX: 2.17, leftHandleY: 3.88, rightHandleX: 2.22, rightHandleY: 2.15 },\n    { x: 2.28, y: 1.05, leftHandleX: 2.25, leftHandleY: 1.58, rightHandleX: 2.34, rightHandleY: 0.36 },\n    { x: 2.47, y: 0, leftHandleX: 2.41, leftHandleY: 0, rightHandleX: 2.52, rightHandleY: 0 },\n  ],\n  lowerThirdProportion: [\n    { x: 25.6, y: 0, leftHandleX: 24.8, leftHandleY: 0, rightHandleX: 26.4, rightHandleY: 0 },\n    { x: 28.01, y: 1.58, leftHandleX: 27.23, leftHandleY: 0.53, rightHandleX: 28.27, rightHandleY: 1.97 },\n    { x: 28.83, y: 3.21, leftHandleX: 28.60, leftHandleY: 2.60, rightHandleX: 29.10, rightHandleY: 3.90 },\n    { x: 29.63, y: 5.85, leftHandleX: 29.40, leftHandleY: 4.90, rightHandleX: 29.85, rightHandleY: 6.80 },\n    { x: 30.27, y: 8.56, leftHandleX: 30.05, leftHandleY: 7.80, rightHandleX: 30.50, rightHandleY: 9.30 },\n    { x: 31, y: 10, leftHandleX: 30.95, leftHandleY: 10, rightHandleX: 31.05, rightHandleY: 10, fixed: true },\n    { x: 33.5, y: 10, leftHandleX: 33.45, leftHandleY: 10, rightHandleX: 33.55, rightHandleY: 10, fixed: true },\n    { x: 34.23, y: 8.56, leftHandleX: 34.00, leftHandleY: 9.30, rightHandleX: 34.45, rightHandleY: 7.80 },\n    { x: 34.87, y: 5.85, leftHandleX: 34.65, leftHandleY: 6.80, rightHandleX: 35.10, rightHandleY: 4.90 },\n    { x: 35.67, y: 3.21, leftHandleX: 35.40, leftHandleY: 3.90, rightHandleX: 35.90, rightHandleY: 2.60 },\n    { x: 36.49, y: 1.58, leftHandleX: 36.23, leftHandleY: 1.97, rightHandleX: 37.27, rightHandleY: 0.53 },\n    { x: 38.9, y: 0, leftHandleX: 38.1, leftHandleY: 0, rightHandleX: 39.7, rightHandleY: 0 },\n  ],\n  lateralCanthalTilt: [\n    { x: -4.5, y: 0, leftHandleX: -5.5, leftHandleY: 0, rightHandleX: -3.5, rightHandleY: 0 },\n    { x: 0.5, y: 1.2, leftHandleX: -0.8, leftHandleY: 0.4, rightHandleX: 1.5, rightHandleY: 1.8 },\n    { x: 2.8, y: 3.5, leftHandleX: 2.2, leftHandleY: 2.5, rightHandleX: 3.4, rightHandleY: 4.3 },\n    { x: 4.5, y: 6.8, leftHandleX: 4.0, leftHandleY: 5.5, rightHandleX: 5.0, rightHandleY: 7.8 },\n    { x: 5.8, y: 9.2, leftHandleX: 5.4, leftHandleY: 8.5, rightHandleX: 5.95, rightHandleY: 9.7 },\n    { x: 6.1, y: 10, leftHandleX: 6.05, leftHandleY: 10, rightHandleX: 6.15, rightHandleY: 10, fixed: true },\n    { x: 7.8, y: 10, leftHandleX: 7.75, leftHandleY: 10, rightHandleX: 7.85, rightHandleY: 10, fixed: true },\n    { x: 8.1, y: 9.2, leftHandleX: 7.95, leftHandleY: 9.7, rightHandleX: 8.5, rightHandleY: 8.5 },\n    { x: 9.4, y: 6.8, leftHandleX: 8.9, leftHandleY: 7.8, rightHandleX: 9.9, rightHandleY: 5.5 },\n    { x: 11.1, y: 3.5, leftHandleX: 10.5, leftHandleY: 4.3, rightHandleX: 11.7, rightHandleY: 2.5 },\n    { x: 13.4, y: 1.2, leftHandleX: 12.4, leftHandleY: 1.8, rightHandleX: 14.7, rightHandleY: 0.4 },\n    { x: 18.4, y: 0, leftHandleX: 17.4, leftHandleY: 0, rightHandleX: 19.4, rightHandleY: 0 },\n  ],\n  gonialAngle: [\n    { x: 105, y: 0, leftHandleX: 102, leftHandleY: 0, rightHandleX: 108, rightHandleY: 0 },\n    { x: 112, y: 1.5, leftHandleX: 110, leftHandleY: 0.5, rightHandleX: 114, rightHandleY: 2.3 },\n    { x: 116, y: 4.2, leftHandleX: 114.5, leftHandleY: 3.0, rightHandleX: 117.5, rightHandleY: 5.2 },\n    { x: 118.5, y: 7.5, leftHandleX: 117.5, leftHandleY: 6.3, rightHandleX: 119.5, rightHandleY: 8.5 },\n    { x: 120, y: 10, leftHandleX: 119.7, leftHandleY: 10, rightHandleX: 120.3, rightHandleY: 10, fixed: true },\n    { x: 130, y: 10, leftHandleX: 129.7, leftHandleY: 10, rightHandleX: 130.3, rightHandleY: 10, fixed: true },\n    { x: 131.5, y: 7.5, leftHandleX: 130.5, leftHandleY: 8.5, rightHandleX: 132.5, rightHandleY: 6.3 },\n    { x: 134, y: 4.2, leftHandleX: 132.5, leftHandleY: 5.2, rightHandleX: 135.5, rightHandleY: 3.0 },\n    { x: 138, y: 1.5, leftHandleX: 136, leftHandleY: 2.3, rightHandleX: 140, rightHandleY: 0.5 },\n    { x: 145, y: 0, leftHandleX: 142, leftHandleY: 0, rightHandleX: 148, rightHandleY: 0 },\n  ],\n  nasolabialAngle: [\n    { x: 75, y: 0, leftHandleX: 72, leftHandleY: 0, rightHandleX: 78, rightHandleY: 0 },\n    { x: 82, y: 2.0, leftHandleX: 79.5, leftHandleY: 0.7, rightHandleX: 84, rightHandleY: 3.0 },\n    { x: 86, y: 5.5, leftHandleX: 84.5, leftHandleY: 4.2, rightHandleX: 87.5, rightHandleY: 6.8 },\n    { x: 89, y: 8.8, leftHandleX: 88, leftHandleY: 7.8, rightHandleX: 89.7, rightHandleY: 9.5 },\n    { x: 90, y: 10, leftHandleX: 89.8, leftHandleY: 10, rightHandleX: 90.2, rightHandleY: 10, fixed: true },\n    { x: 105, y: 10, leftHandleX: 104.8, leftHandleY: 10, rightHandleX: 105.2, rightHandleY: 10, fixed: true },\n    { x: 106, y: 8.8, leftHandleX: 105.3, leftHandleY: 9.5, rightHandleX: 107, rightHandleY: 7.8 },\n    { x: 109, y: 5.5, leftHandleX: 107.5, leftHandleY: 6.8, rightHandleX: 110.5, rightHandleY: 4.2 },\n    { x: 113, y: 2.0, leftHandleX: 111, leftHandleY: 3.0, rightHandleX: 115.5, rightHandleY: 0.7 },\n    { x: 120, y: 0, leftHandleX: 117, leftHandleY: 0, rightHandleX: 123, rightHandleY: 0 },\n  ],\n  // Middle Third Proportion curve (ideal: 31.4-33.4%)\n  middleThirdProportion: [\n    { x: 21.44, y: 0, leftHandleX: 20.29, leftHandleY: 0, rightHandleX: 23.19, rightHandleY: 0.15 },\n    { x: 25.5, y: 1.35, leftHandleX: 24.18, leftHandleY: 0.53, rightHandleX: 26.17, rightHandleY: 1.79 },\n    { x: 27.34, y: 3.18, leftHandleX: 26.84, leftHandleY: 2.42, rightHandleX: 27.73, rightHandleY: 3.81 },\n    { x: 28.65, y: 5.88, leftHandleX: 28.33, leftHandleY: 4.91, rightHandleX: 28.98, rightHandleY: 6.65 },\n    { x: 29.95, y: 8.55, leftHandleX: 29.41, leftHandleY: 7.58, rightHandleX: 30.45, rightHandleY: 9.35 },\n    { x: 31.4, y: 10, leftHandleX: 31.3, leftHandleY: 10, rightHandleX: 31.5, rightHandleY: 10, fixed: true },\n    { x: 33.4, y: 10, leftHandleX: 33.3, leftHandleY: 10, rightHandleX: 33.5, rightHandleY: 10, fixed: true },\n    { x: 34.85, y: 8.55, leftHandleX: 34.35, leftHandleY: 9.35, rightHandleX: 35.39, rightHandleY: 7.58 },\n    { x: 36.15, y: 5.88, leftHandleX: 35.82, leftHandleY: 6.65, rightHandleX: 36.47, rightHandleY: 4.91 },\n    { x: 37.46, y: 3.18, leftHandleX: 37.07, leftHandleY: 3.81, rightHandleX: 37.96, rightHandleY: 2.42 },\n    { x: 39.3, y: 1.35, leftHandleX: 38.63, leftHandleY: 1.79, rightHandleX: 40.62, rightHandleY: 0.53 },\n    { x: 43.36, y: 0, leftHandleX: 41.61, leftHandleY: 0.15, rightHandleX: 44.51, rightHandleY: 0 },\n  ],\n  // Upper Third Proportion curve (ideal: 30-32%)\n  upperThirdProportion: [\n    { x: 18.75, y: 0.02, leftHandleX: 17.15, leftHandleY: 0.02, rightHandleX: 20.35, rightHandleY: 0.02 },\n    { x: 23.82, y: 1.52, leftHandleX: 22.35, leftHandleY: 0.8, rightHandleX: 24.73, rightHandleY: 2.06 },\n    { x: 26.05, y: 4.06, leftHandleX: 25.48, leftHandleY: 2.86, rightHandleX: 26.41, rightHandleY: 4.99 },\n    { x: 27.19, y: 6.79, leftHandleX: 26.96, leftHandleY: 6.16, rightHandleX: 27.66, rightHandleY: 7.85 },\n    { x: 28.54, y: 9.08, leftHandleX: 28.02, leftHandleY: 8.5, rightHandleX: 28.93, rightHandleY: 9.54 },\n    { x: 30, y: 10, leftHandleX: 29.9, leftHandleY: 10, rightHandleX: 30.1, rightHandleY: 10, fixed: true },\n    { x: 32, y: 10, leftHandleX: 31.9, leftHandleY: 10, rightHandleX: 32.1, rightHandleY: 10, fixed: true },\n    { x: 33.46, y: 9.08, leftHandleX: 33.07, leftHandleY: 9.54, rightHandleX: 33.98, rightHandleY: 8.5 },\n    { x: 34.81, y: 6.79, leftHandleX: 34.34, leftHandleY: 7.85, rightHandleX: 35.04, rightHandleY: 6.16 },\n    { x: 35.95, y: 4.06, leftHandleX: 35.59, leftHandleY: 4.99, rightHandleX: 36.52, rightHandleY: 2.86 },\n    { x: 38.18, y: 1.52, leftHandleX: 37.27, leftHandleY: 2.06, rightHandleX: 39.65, rightHandleY: 0.8 },\n    { x: 43.25, y: 0.02, leftHandleX: 41.65, leftHandleY: 0.02, rightHandleX: 44.85, rightHandleY: 0.02 },\n  ],\n  // Eye Separation Ratio curve (ideal: 45.7-46.8%)\n  eyeSeparationRatio: [\n    { x: 36.54, y: 0, leftHandleX: 35.44, leftHandleY: 0, rightHandleX: 37.40, rightHandleY: 0.04 },\n    { x: 39.04, y: 0.63, leftHandleX: 38.16, leftHandleY: 0.21, rightHandleX: 39.77, rightHandleY: 1.05 },\n    { x: 41.08, y: 2.17, leftHandleX: 40.57, leftHandleY: 1.71, rightHandleX: 41.62, rightHandleY: 2.76 },\n    { x: 42.71, y: 4.74, leftHandleX: 42.26, leftHandleY: 3.81, rightHandleX: 43.08, rightHandleY: 5.52 },\n    { x: 43.94, y: 7.37, leftHandleX: 43.65, leftHandleY: 6.79, rightHandleX: 44.17, rightHandleY: 7.77 },\n    { x: 44.86, y: 9.02, leftHandleX: 44.54, leftHandleY: 8.56, rightHandleX: 45.08, rightHandleY: 9.5 },\n    { x: 45.7, y: 10, leftHandleX: 45.65, leftHandleY: 10, rightHandleX: 45.76, rightHandleY: 10, fixed: true },\n    { x: 46.8, y: 10, leftHandleX: 46.75, leftHandleY: 10, rightHandleX: 46.86, rightHandleY: 10, fixed: true },\n    { x: 47.64, y: 9.02, leftHandleX: 47.42, leftHandleY: 9.5, rightHandleX: 47.96, rightHandleY: 8.56 },\n    { x: 48.56, y: 7.37, leftHandleX: 48.33, leftHandleY: 7.77, rightHandleX: 48.85, rightHandleY: 6.79 },\n    { x: 49.79, y: 4.74, leftHandleX: 49.42, leftHandleY: 5.52, rightHandleX: 50.24, rightHandleY: 3.81 },\n    { x: 51.42, y: 2.17, leftHandleX: 50.88, leftHandleY: 2.76, rightHandleX: 51.93, rightHandleY: 1.71 },\n    { x: 53.46, y: 0.63, leftHandleX: 52.73, leftHandleY: 1.05, rightHandleX: 54.34, rightHandleY: 0.21 },\n    { x: 55.96, y: 0, leftHandleX: 55.10, leftHandleY: 0.04, rightHandleX: 57.06, rightHandleY: 0 },\n  ],\n  // Eyebrow Low Setedness curve (ideal: 0-0.45)\n  eyebrowLowSetedness: [\n    { x: -2.78, y: 0, leftHandleX: -3.11, leftHandleY: 0, rightHandleX: -2.67, rightHandleY: 0 },\n    { x: -1.94, y: 0.4, leftHandleX: -2.08, leftHandleY: 0.11, rightHandleX: -1.81, rightHandleY: 0.57 },\n    { x: -1.18, y: 2.25, leftHandleX: -1.36, leftHandleY: 1.5, rightHandleX: -1.05, rightHandleY: 2.72 },\n    { x: -0.79, y: 4.06, leftHandleX: -0.88, leftHandleY: 3.43, rightHandleX: -0.68, rightHandleY: 4.84 },\n    { x: -0.55, y: 6.21, leftHandleX: -0.58, leftHandleY: 5.55, rightHandleX: -0.47, rightHandleY: 6.92 },\n    { x: -0.28, y: 8.76, leftHandleX: -0.37, leftHandleY: 8.23, rightHandleX: -0.23, rightHandleY: 9.22 },\n    { x: 0, y: 10, leftHandleX: -0.02, leftHandleY: 10, rightHandleX: 0.02, rightHandleY: 10, fixed: true },\n    { x: 0.45, y: 10, leftHandleX: 0.43, leftHandleY: 10, rightHandleX: 0.47, rightHandleY: 10, fixed: true },\n    { x: 0.73, y: 8.76, leftHandleX: 0.68, leftHandleY: 9.22, rightHandleX: 0.82, rightHandleY: 8.23 },\n    { x: 1, y: 6.21, leftHandleX: 0.92, leftHandleY: 6.92, rightHandleX: 1.03, rightHandleY: 5.55 },\n    { x: 1.24, y: 4.06, leftHandleX: 1.13, leftHandleY: 4.84, rightHandleX: 1.33, rightHandleY: 3.43 },\n    { x: 1.63, y: 2.25, leftHandleX: 1.50, leftHandleY: 2.72, rightHandleX: 1.81, rightHandleY: 1.5 },\n    { x: 2.39, y: 0.4, leftHandleX: 2.26, leftHandleY: 0.57, rightHandleX: 2.53, rightHandleY: 0.11 },\n    { x: 3.23, y: 0, leftHandleX: 3.12, leftHandleY: 0, rightHandleX: 3.56, rightHandleY: 0 },\n  ],\n  // Submental Cervical Angle curve (ideal: 94-106Â°)\n  submentalCervicalAngle: [\n    { x: 50.48, y: 0, leftHandleX: 44.48, leftHandleY: 0, rightHandleX: 56.48, rightHandleY: 0 },\n    { x: 68.31, y: 1.31, leftHandleX: 62.07, leftHandleY: 0.32, rightHandleX: 72.89, rightHandleY: 2.13 },\n    { x: 77.76, y: 3.71, leftHandleX: 76.00, leftHandleY: 2.89, rightHandleX: 80.39, rightHandleY: 4.59 },\n    { x: 83.99, y: 6.53, leftHandleX: 82.63, leftHandleY: 5.85, rightHandleX: 85.16, rightHandleY: 7.12 },\n    { x: 88.28, y: 8.86, leftHandleX: 86.43, leftHandleY: 7.85, rightHandleX: 89.95, rightHandleY: 9.71 },\n    { x: 94, y: 10, leftHandleX: 93.4, leftHandleY: 10, rightHandleX: 94.6, rightHandleY: 10, fixed: true },\n    { x: 106, y: 10, leftHandleX: 105.4, leftHandleY: 10, rightHandleX: 106.6, rightHandleY: 10, fixed: true },\n    { x: 111.72, y: 8.86, leftHandleX: 110.05, leftHandleY: 9.71, rightHandleX: 113.57, rightHandleY: 7.85 },\n    { x: 116.01, y: 6.53, leftHandleX: 114.84, leftHandleY: 7.12, rightHandleX: 117.37, rightHandleY: 5.85 },\n    { x: 122.24, y: 3.71, leftHandleX: 119.61, leftHandleY: 4.59, rightHandleX: 124.00, rightHandleY: 2.89 },\n    { x: 131.69, y: 1.31, leftHandleX: 127.11, leftHandleY: 2.13, rightHandleX: 137.93, rightHandleY: 0.32 },\n    { x: 149.52, y: 0, leftHandleX: 143.52, leftHandleY: 0, rightHandleX: 155.52, rightHandleY: 0 },\n  ],\n  // Facial Convexity (Glabella) curve (ideal: 169-174Â°)\n  facialConvexityGlabella: [\n    { x: 149.21, y: 0, leftHandleX: 146.21, leftHandleY: 0, rightHandleX: 152.21, rightHandleY: 0 },\n    { x: 158.07, y: 1.41, leftHandleX: 156.03, leftHandleY: 0.74, rightHandleX: 159.63, rightHandleY: 2 },\n    { x: 162.12, y: 4.09, leftHandleX: 161.34, leftHandleY: 3.31, rightHandleX: 163.09, rightHandleY: 5.03 },\n    { x: 165.14, y: 7.76, leftHandleX: 164.46, leftHandleY: 6.56, rightHandleX: 165.54, rightHandleY: 8.29 },\n    { x: 166.65, y: 9.14, leftHandleX: 165.92, leftHandleY: 8.72, rightHandleX: 167.43, rightHandleY: 9.67 },\n    { x: 169, y: 10, leftHandleX: 168.75, leftHandleY: 10, rightHandleX: 169.25, rightHandleY: 10, fixed: true },\n    { x: 174, y: 10, leftHandleX: 173.75, leftHandleY: 10, rightHandleX: 174.25, rightHandleY: 10, fixed: true },\n    { x: 176.35, y: 9.14, leftHandleX: 175.57, leftHandleY: 9.67, rightHandleX: 177.08, rightHandleY: 8.72 },\n    { x: 177.86, y: 7.76, leftHandleX: 177.46, leftHandleY: 8.29, rightHandleX: 178.54, rightHandleY: 6.56 },\n    { x: 180.88, y: 4.09, leftHandleX: 179.91, leftHandleY: 5.03, rightHandleX: 181.66, rightHandleY: 3.31 },\n    { x: 184.93, y: 1.41, leftHandleX: 183.37, leftHandleY: 2, rightHandleX: 186.97, rightHandleY: 0.74 },\n    { x: 193.79, y: 0, leftHandleX: 190.79, leftHandleY: 0, rightHandleX: 196.79, rightHandleY: 0 },\n  ],\n};\n\n// ============================================\n// CATEGORY DEFINITIONS\n// ============================================\n\nexport const MEASUREMENT_CATEGORIES = {\n  'Midface/Face Shape': { color: '#67e8f9', weight: 0.20 },\n  'Occlusion/Jaw Growth': { color: '#a78bfa', weight: 0.15 },\n  'Jaw Shape': { color: '#f97316', weight: 0.13 },\n  'Upper Third': { color: '#84cc16', weight: 0.08 },\n  'Eyes': { color: '#06b6d4', weight: 0.12 },\n  'Nose': { color: '#fbbf24', weight: 0.10 },\n  'Lips': { color: '#ec4899', weight: 0.10 },\n  'Chin': { color: '#ef4444', weight: 0.06 },\n  'Neck': { color: '#14b8a6', weight: 0.03 },\n  'Other': { color: '#6b7280', weight: 0.03 },\n};\n\n// ============================================\n// CORE SCORING FUNCTIONS\n// ============================================\n\n/**\n * FaceIQ Exponential Decay Scoring Algorithm with Directional/Dimorphic Support\n *\n * Standard: score = maxScore Ã— e^(-decayRate Ã— deviation)\n *\n * Directional scoring (polarity):\n * - 'higher_is_better': Values above safeFloor but below ideal get softZoneScore\n *   Example: Canthal Tilt of 3Â° is still positive/good, just not peak ideal (6-8Â°)\n * - 'lower_is_better': Values below safeCeiling but above ideal get softZoneScore\n *   Example: Short philtrum is still attractive even if shorter than \"ideal\"\n */\nexport function calculateFaceIQScore(\n  value: number,\n  config: MetricConfig\n): number {\n  const {\n    idealMin,\n    idealMax,\n    decayRate,\n    maxScore,\n    customCurve,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n    softZoneScore = 8.0, // Default \"Good\" score for acceptable-but-not-ideal values\n  } = config;\n\n  // Use custom curve if available\n  if (customCurve && customCurve.mode === 'custom') {\n    return interpolateCustomCurve(value, customCurve.points, maxScore);\n  }\n\n  // Perfect score within ideal range\n  if (value >= idealMin && value <= idealMax) {\n    return maxScore;\n  }\n\n  // Handle directional/dimorphic scoring\n  if (polarity === 'higher_is_better' && safeFloor !== undefined) {\n    // Higher values are good. Only values below safeFloor are true weaknesses.\n    if (value >= safeFloor && value < idealMin) {\n      // Value is in the \"acceptable but not ideal\" zone\n      // Give a passing score that decreases linearly as we approach the floor\n      const zoneRange = idealMin - safeFloor;\n      const distanceFromIdeal = idealMin - value;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMin â†’ maxScore, safeFloor â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value >= idealMax) {\n      // Values above ideal are still excellent for 'higher_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = value - idealMax;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Below safeFloor - apply normal (or harsher) exponential decay\n    if (value < safeFloor) {\n      const deviation = safeFloor - value;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  if (polarity === 'lower_is_better' && safeCeiling !== undefined) {\n    // Lower values are good. Only values above safeCeiling are true weaknesses.\n    if (value <= safeCeiling && value > idealMax) {\n      // Value is in the \"acceptable but not ideal\" zone\n      const zoneRange = safeCeiling - idealMax;\n      const distanceFromIdeal = value - idealMax;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMax â†’ maxScore, safeCeiling â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value <= idealMin) {\n      // Values below ideal are still excellent for 'lower_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = idealMin - value;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Above safeCeiling - apply normal exponential decay\n    if (value > safeCeiling) {\n      const deviation = value - safeCeiling;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  // Default balanced scoring: deviation in either direction is equally bad\n  const deviation = value < idealMin\n    ? idealMin - value\n    : value - idealMax;\n\n  // Exponential decay\n  const score = maxScore * Math.exp(-decayRate * deviation);\n\n  return Math.max(0, Math.min(maxScore, score));\n}\n\n/**\n * Check if a metric value is in an \"acceptable\" zone (not a true weakness).\n * Used by InsightsEngine to prevent false positives.\n */\nexport function isValueAcceptable(\n  value: number,\n  config: MetricConfig\n): { acceptable: boolean; reason: string } {\n  const {\n    idealMin,\n    idealMax,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n  } = config;\n\n  // Within ideal range is always acceptable\n  if (value >= idealMin && value <= idealMax) {\n    return { acceptable: true, reason: 'within_ideal' };\n  }\n\n  // Check directional acceptability\n  if (polarity === 'higher_is_better') {\n    if (value >= idealMax) {\n      return { acceptable: true, reason: 'above_ideal_higher_is_better' };\n    }\n    if (safeFloor !== undefined && value >= safeFloor) {\n      return { acceptable: true, reason: 'above_safe_floor' };\n    }\n    // Below safe floor - true weakness\n    return { acceptable: false, reason: 'below_safe_floor' };\n  }\n\n  if (polarity === 'lower_is_better') {\n    if (value <= idealMin) {\n      return { acceptable: true, reason: 'below_ideal_lower_is_better' };\n    }\n    if (safeCeiling !== undefined && value <= safeCeiling) {\n      return { acceptable: true, reason: 'below_safe_ceiling' };\n    }\n    // Above safe ceiling - true weakness\n    return { acceptable: false, reason: 'above_safe_ceiling' };\n  }\n\n  // Balanced polarity - outside ideal is not acceptable\n  return { acceptable: false, reason: 'outside_ideal_balanced' };\n}\n\n/**\n * Interpolate custom Bezier curve for scoring\n * Uses cubic Bezier interpolation with control handles for smooth curves\n */\nfunction interpolateCustomCurve(\n  value: number,\n  points: CurvePoint[],\n  maxScore: number\n): number {\n  void maxScore; // Reserved for future custom curve implementations\n  if (points.length === 0) return 0;\n\n  // Sort points by x value\n  const sortedPoints = [...points].sort((a, b) => a.x - b.x);\n\n  // Clamp to range\n  if (value <= sortedPoints[0].x) return sortedPoints[0].y;\n  if (value >= sortedPoints[sortedPoints.length - 1].x) {\n    return sortedPoints[sortedPoints.length - 1].y;\n  }\n\n  // Find bracketing points\n  let lowerIndex = 0;\n  for (let i = 0; i < sortedPoints.length - 1; i++) {\n    if (value >= sortedPoints[i].x && value <= sortedPoints[i + 1].x) {\n      lowerIndex = i;\n      break;\n    }\n  }\n\n  const p0 = sortedPoints[lowerIndex];\n  const p3 = sortedPoints[lowerIndex + 1];\n\n  // Check if we have Bezier control handles\n  const hasHandles = p0.rightHandleX !== undefined && p3.leftHandleX !== undefined;\n\n  if (hasHandles) {\n    // Cubic Bezier interpolation with control points\n    const p1x = p0.rightHandleX!;\n    const p1y = p0.rightHandleY ?? p0.y;\n    const p2x = p3.leftHandleX!;\n    const p2y = p3.leftHandleY ?? p3.y;\n\n    // Find t parameter for given x value using Newton-Raphson iteration\n    let t = (value - p0.x) / (p3.x - p0.x); // Initial guess\n\n    // Newton-Raphson iterations to find t where B_x(t) = value\n    for (let iter = 0; iter < 10; iter++) {\n      const bx = cubicBezier(p0.x, p1x, p2x, p3.x, t);\n      const bxDerivative = cubicBezierDerivative(p0.x, p1x, p2x, p3.x, t);\n\n      if (Math.abs(bxDerivative) < 1e-10) break;\n\n      const newT = t - (bx - value) / bxDerivative;\n      if (Math.abs(newT - t) < 1e-10) break;\n      t = Math.max(0, Math.min(1, newT));\n    }\n\n    // Calculate y using the found t parameter\n    return cubicBezier(p0.y, p1y, p2y, p3.y, t);\n  } else {\n    // Smooth interpolation using Catmull-Rom spline\n    // This provides smoother curves than linear interpolation\n    const t = (value - p0.x) / (p3.x - p0.x);\n\n    // Get neighboring points for spline calculation\n    const pMinus1 = lowerIndex > 0 ? sortedPoints[lowerIndex - 1] : p0;\n    const p4 = lowerIndex + 2 < sortedPoints.length ? sortedPoints[lowerIndex + 2] : p3;\n\n    // Catmull-Rom spline interpolation\n    return catmullRomSpline(pMinus1.y, p0.y, p3.y, p4.y, t);\n  }\n}\n\n/**\n * Cubic Bezier curve evaluation: B(t) = (1-t)Â³P0 + 3(1-t)Â²tP1 + 3(1-t)tÂ²P2 + tÂ³P3\n */\nfunction cubicBezier(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  const mt2 = mt * mt;\n  const mt3 = mt2 * mt;\n  const t2 = t * t;\n  const t3 = t2 * t;\n  return mt3 * p0 + 3 * mt2 * t * p1 + 3 * mt * t2 * p2 + t3 * p3;\n}\n\n/**\n * Cubic Bezier derivative: B'(t) = 3(1-t)Â²(P1-P0) + 6(1-t)t(P2-P1) + 3tÂ²(P3-P2)\n */\nfunction cubicBezierDerivative(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  return 3 * mt * mt * (p1 - p0) + 6 * mt * t * (p2 - p1) + 3 * t * t * (p3 - p2);\n}\n\n/**\n * Catmull-Rom spline interpolation for smooth curves without explicit handles\n */\nfunction catmullRomSpline(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const t2 = t * t;\n  const t3 = t2 * t;\n\n  // Catmull-Rom coefficients with tension = 0.5\n  const a = -0.5 * p0 + 1.5 * p1 - 1.5 * p2 + 0.5 * p3;\n  const b = p0 - 2.5 * p1 + 2 * p2 - 0.5 * p3;\n  const c = -0.5 * p0 + 0.5 * p2;\n  const d = p1;\n\n  return a * t3 + b * t2 + c * t + d;\n}\n\n/**\n * Calculate standardized score (0-10 normalized)\n */\nexport function standardizeScore(score: number, maxScore: number): number {\n  return (score / maxScore) * 10;\n}\n\n/**\n * Determine quality tier based on score\n */\nexport function getQualityTier(score: number, maxScore: number = 10): QualityTier {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 90) return 'ideal';\n  if (normalized >= 70) return 'excellent';\n  if (normalized >= 50) return 'good';\n  return 'below_average';\n}\n\n/**\n * Determine severity level based on score\n */\nexport function getSeverityLevel(score: number, maxScore: number = 10): SeverityLevel {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 85) return 'optimal';\n  if (normalized >= 70) return 'minor';\n  if (normalized >= 50) return 'moderate';\n  if (normalized >= 30) return 'major';\n  if (normalized >= 15) return 'severe';\n  return 'extremely_severe';\n}\n\n/**\n * Calculate deviation description\n */\nexport function getDeviationDescription(\n  value: number,\n  idealMin: number,\n  idealMax: number,\n  unit: MeasurementUnit\n): { deviation: number; direction: 'above' | 'below' | 'within'; description: string } {\n  if (value >= idealMin && value <= idealMax) {\n    return { deviation: 0, direction: 'within', description: 'within ideal range' };\n  }\n\n  const unitLabel = getUnitLabel(unit);\n\n  if (value < idealMin) {\n    const dev = idealMin - value;\n    return {\n      deviation: dev,\n      direction: 'below',\n      description: `${dev.toFixed(2)}${unitLabel} below ideal`,\n    };\n  }\n\n  const dev = value - idealMax;\n  return {\n    deviation: dev,\n    direction: 'above',\n    description: `${dev.toFixed(2)}${unitLabel} above ideal`,\n  };\n}\n\nfunction getUnitLabel(unit: MeasurementUnit): string {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return 'Â°';\n    case 'mm': return 'mm';\n    default: return '';\n  }\n}\n\n// ============================================\n// MEASUREMENT CALCULATION UTILITIES\n// ============================================\n\n/**\n * Calculate distance between two points\n */\nexport function distance(p1: Point, p2: Point): number {\n  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n}\n\n/**\n * Calculate angle at vertex point (in degrees)\n */\nexport function calculateAngle(p1: Point, vertex: Point, p2: Point): number {\n  const v1 = { x: p1.x - vertex.x, y: p1.y - vertex.y };\n  const v2 = { x: p2.x - vertex.x, y: p2.y - vertex.y };\n\n  const dot = v1.x * v2.x + v1.y * v2.y;\n  const cross = v1.x * v2.y - v1.y * v2.x;\n\n  const angle = Math.atan2(cross, dot) * (180 / Math.PI);\n  return Math.abs(angle);\n}\n\n/**\n * Calculate perpendicular distance from point to line (signed)\n */\nexport function perpendicularDistance(\n  point: Point,\n  lineStart: Point,\n  lineEnd: Point\n): number {\n  const A = point.x - lineStart.x;\n  const B = point.y - lineStart.y;\n  const C = lineEnd.x - lineStart.x;\n  const D = lineEnd.y - lineStart.y;\n\n  const dot = A * C + B * D;\n  const lenSq = C * C + D * D;\n  const param = lenSq !== 0 ? dot / lenSq : -1;\n\n  let xx: number, yy: number;\n\n  if (param < 0) {\n    xx = lineStart.x;\n    yy = lineStart.y;\n  } else if (param > 1) {\n    xx = lineEnd.x;\n    yy = lineEnd.y;\n  } else {\n    xx = lineStart.x + param * C;\n    yy = lineStart.y + param * D;\n  }\n\n  const dx = point.x - xx;\n  const dy = point.y - yy;\n\n  const sign =\n    (lineEnd.y - lineStart.y) * point.x -\n      (lineEnd.x - lineStart.x) * point.y +\n      lineEnd.x * lineStart.y -\n      lineEnd.y * lineStart.x >=\n    0\n      ? 1\n      : -1;\n\n  return sign * Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Helper to get landmark by ID\n */\nfunction getLandmark(landmarks: LandmarkPoint[], id: string): Point | null {\n  const lm = landmarks.find((l) => l.id === id);\n  return lm ? { x: lm.x, y: lm.y } : null;\n}\n\n// ============================================\n// SCORE A SINGLE MEASUREMENT\n// ============================================\n\nexport interface DemographicOptions {\n  gender?: Gender;\n  ethnicity?: Ethnicity;\n}\n\n/**\n * Calculate complete score result for a measurement.\n * If demographics provided, uses demographic-specific ideal ranges.\n */\nexport function scoreMeasurement(\n  metricId: string,\n  value: number,\n  demographics?: DemographicOptions\n): FaceIQScoreResult | null {\n  // Get config with demographic overrides if provided\n  const config = demographics?.gender\n    ? getMetricConfigForDemographics(metricId, demographics.gender, demographics.ethnicity || 'other')\n    : FACEIQ_METRICS[metricId];\n\n  if (!config) return null;\n\n  const score = calculateFaceIQScore(value, config);\n  const standardizedScore = standardizeScore(score, config.maxScore);\n  const qualityTier = getQualityTier(score, config.maxScore);\n  const severity = getSeverityLevel(score, config.maxScore);\n  const { deviation, direction } = getDeviationDescription(\n    value,\n    config.idealMin,\n    config.idealMax,\n    config.unit\n  );\n\n  return {\n    metricId,\n    name: config.name,\n    value,\n    score,\n    standardizedScore,\n    qualityTier,\n    severity,\n    idealMin: config.idealMin,\n    idealMax: config.idealMax,\n    deviation,\n    deviationDirection: direction,\n    unit: config.unit,\n    category: config.category,\n  };\n}\n\n// ============================================\n// FRONT PROFILE ANALYSIS\n// ============================================\n\nexport interface FrontProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all front profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeFrontProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): FrontProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  // Helper to add measurement if landmarks available\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const trichion = getLandmark(landmarks, 'trichion');\n  const nasalBase = getLandmark(landmarks, 'nasal_base');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const menton = getLandmark(landmarks, 'menton');\n  const leftZygion = getLandmark(landmarks, 'left_zygion');\n  const rightZygion = getLandmark(landmarks, 'right_zygion');\n  const leftGonion = getLandmark(landmarks, 'left_gonion_inferior');\n  const rightGonion = getLandmark(landmarks, 'right_gonion_inferior');\n  const leftPupil = getLandmark(landmarks, 'left_pupila');\n  const rightPupil = getLandmark(landmarks, 'right_pupila');\n  const leftCanthusM = getLandmark(landmarks, 'left_canthus_medialis');\n  const leftCanthusL = getLandmark(landmarks, 'left_canthus_lateralis');\n  const rightCanthusM = getLandmark(landmarks, 'right_canthus_medialis');\n  const rightCanthusL = getLandmark(landmarks, 'right_canthus_lateralis');\n  void rightCanthusL; // Will be used for asymmetry measurements\n  const leftAlaNasi = getLandmark(landmarks, 'left_ala_nasi');\n  const rightAlaNasi = getLandmark(landmarks, 'right_ala_nasi');\n  const leftCheilion = getLandmark(landmarks, 'left_cheilion');\n  const rightCheilion = getLandmark(landmarks, 'right_cheilion');\n  const labraleSuperius = getLandmark(landmarks, 'labrale_superius');\n  const labraleInferius = getLandmark(landmarks, 'labrale_inferius');\n\n  // FACIAL THIRDS\n  if (trichion && nasalBase && subnasale && menton) {\n    const totalHeight = distance(trichion, menton);\n    if (totalHeight > 0) {\n      const upperThird = (distance(trichion, nasalBase) / totalHeight) * 100;\n      const middleThird = (distance(nasalBase, subnasale) / totalHeight) * 100;\n      const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n\n      addMeasurement('upperThirdProportion', upperThird);\n      addMeasurement('middleThirdProportion', middleThird);\n      addMeasurement('lowerThirdProportion', lowerThird);\n    }\n  }\n\n  // FACE WIDTH TO HEIGHT RATIO (FWHR)\n  if (leftZygion && rightZygion && nasalBase && labraleSuperius) {\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    const upperFaceHeight = distance(nasalBase, labraleSuperius);\n    if (upperFaceHeight > 0) {\n      addMeasurement('faceWidthToHeight', bizygomaticWidth / upperFaceHeight);\n    }\n  }\n\n  // TOTAL FACIAL WIDTH TO HEIGHT\n  if (leftZygion && rightZygion && trichion && menton) {\n    const cheekWidth = distance(leftZygion, rightZygion);\n    const totalHeight = distance(trichion, menton);\n    if (cheekWidth > 0) {\n      addMeasurement('totalFacialWidthToHeight', totalHeight / cheekWidth);\n    }\n  }\n\n  // JAW WIDTH RATIO\n  if (leftGonion && rightGonion && leftZygion && rightZygion) {\n    const bigonialWidth = distance(leftGonion, rightGonion);\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    if (bizygomaticWidth > 0) {\n      const ratio = bigonialWidth / bizygomaticWidth;\n      addMeasurement('jawWidthRatio', ratio);\n      addMeasurement('bigonialWidth', ratio * 100);\n    }\n  }\n\n  // CANTHAL TILT\n  if (leftCanthusM && leftCanthusL) {\n    const deltaY = leftCanthusM.y - leftCanthusL.y;\n    const deltaX = leftCanthusL.x - leftCanthusM.x;\n    const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);\n    addMeasurement('lateralCanthalTilt', angle);\n  }\n\n  // EYE ASPECT RATIO\n  if (leftCanthusM && leftCanthusL) {\n    const leftPalpSup = getLandmark(landmarks, 'left_palpebra_superior');\n    const leftPalpInf = getLandmark(landmarks, 'left_palpebra_inferior');\n    if (leftPalpSup && leftPalpInf) {\n      const eyeWidth = distance(leftCanthusM, leftCanthusL);\n      const eyeHeight = distance(leftPalpSup, leftPalpInf);\n      if (eyeWidth > 0) {\n        addMeasurement('eyeAspectRatio', eyeHeight / eyeWidth);\n      }\n    }\n  }\n\n  // EYE SEPARATION RATIO\n  if (leftCanthusM && rightCanthusM && leftZygion && rightZygion) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('eyeSeparationRatio', intercanthal / bizygomatic);\n    }\n  }\n\n  // IPD RATIO\n  if (leftPupil && rightPupil && leftZygion && rightZygion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('interpupillaryRatio', (ipd / bizygomatic) * 100);\n    }\n  }\n\n  // ONE EYE APART TEST\n  if (leftCanthusM && rightCanthusM && leftCanthusL) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const eyeWidth = distance(leftCanthusM, leftCanthusL);\n    if (eyeWidth > 0) {\n      addMeasurement('oneEyeApartTest', intercanthal / eyeWidth);\n    }\n  }\n\n  // NASAL INDEX\n  if (leftAlaNasi && rightAlaNasi && nasalBase && subnasale) {\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    const nasalHeight = distance(nasalBase, subnasale);\n    if (nasalHeight > 0) {\n      addMeasurement('nasalIndex', (nasalWidth / nasalHeight) * 100);\n    }\n  }\n\n  // INTERCANTHAL-NASAL WIDTH RATIO\n  if (leftCanthusM && rightCanthusM && leftAlaNasi && rightAlaNasi) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('intercanthalNasalRatio', intercanthal / nasalWidth);\n    }\n  }\n\n  // MOUTH TO NOSE RATIO\n  if (leftCheilion && rightCheilion && leftAlaNasi && rightAlaNasi) {\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('mouthWidthToNoseRatio', mouthWidth / nasalWidth);\n    }\n  }\n\n  // IPD TO MOUTH WIDTH RATIO\n  if (leftPupil && rightPupil && leftCheilion && rightCheilion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    if (ipd > 0) {\n      addMeasurement('interpupillaryMouthWidthRatio', mouthWidth / ipd);\n    }\n  }\n\n  // LIP RATIO\n  if (labraleSuperius && labraleInferius && subnasale) {\n    const mouthMiddle = getLandmark(landmarks, 'mouth_middle');\n    if (mouthMiddle) {\n      const upperLipHeight = distance(subnasale, labraleSuperius);\n      const lowerLipHeight = distance(mouthMiddle, labraleInferius);\n      if (upperLipHeight > 0) {\n        addMeasurement('lowerToUpperLipRatio', lowerLipHeight / upperLipHeight);\n      }\n    }\n  }\n\n  // MIDFACE RATIO\n  if (leftZygion && rightZygion && nasalBase && subnasale) {\n    const midfaceWidth = distance(leftZygion, rightZygion);\n    const midfaceHeight = distance(nasalBase, subnasale);\n    if (midfaceHeight > 0) {\n      addMeasurement('midfaceRatio', midfaceWidth / midfaceHeight / 10); // Normalized\n    }\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score (weighted average)\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n  const standardizedScore = overallScore;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// SIDE PROFILE ANALYSIS\n// ============================================\n\nexport interface SideProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all side profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeSideProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): SideProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const glabella = getLandmark(landmarks, 'glabella');\n  const nasion = getLandmark(landmarks, 'nasion');\n  const rhinion = getLandmark(landmarks, 'rhinion');\n  const pronasale = getLandmark(landmarks, 'pronasale');\n  const columella = getLandmark(landmarks, 'columella');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const labraleSuperius = getLandmark(landmarks, 'labraleSuperius');\n  const labraleInferius = getLandmark(landmarks, 'labraleInferius');\n  const sublabiale = getLandmark(landmarks, 'sublabiale');\n  const pogonion = getLandmark(landmarks, 'pogonion');\n  const menton = getLandmark(landmarks, 'menton');\n  const tragus = getLandmark(landmarks, 'tragus');\n  const gonionBottom = getLandmark(landmarks, 'gonionBottom');\n  const cervicalPoint = getLandmark(landmarks, 'cervicalPoint');\n  const orbitale = getLandmark(landmarks, 'orbitale');\n  const porion = getLandmark(landmarks, 'porion');\n\n  // GONIAL ANGLE\n  if (tragus && gonionBottom && menton) {\n    const angle = calculateAngle(tragus, gonionBottom, menton);\n    addMeasurement('gonialAngle', angle);\n  }\n\n  // NASOLABIAL ANGLE\n  if (columella && subnasale && labraleSuperius) {\n    const angle = calculateAngle(columella, subnasale, labraleSuperius);\n    addMeasurement('nasolabialAngle', angle);\n  }\n\n  // NASOFRONTAL ANGLE\n  if (glabella && nasion && rhinion) {\n    const angle = calculateAngle(glabella, nasion, rhinion);\n    addMeasurement('nasofrontalAngle', angle);\n  }\n\n  // MENTOLABIAL ANGLE\n  if (labraleInferius && sublabiale && pogonion) {\n    const angle = calculateAngle(labraleInferius, sublabiale, pogonion);\n    addMeasurement('mentolabialAngle', angle);\n  }\n\n  // E-LINE MEASUREMENTS\n  if (pronasale && pogonion && labraleSuperius && labraleInferius) {\n    const upperLipDist = perpendicularDistance(labraleSuperius, pronasale, pogonion);\n    const lowerLipDist = perpendicularDistance(labraleInferius, pronasale, pogonion);\n    addMeasurement('eLineUpperLip', upperLipDist);\n    addMeasurement('eLineLowerLip', lowerLipDist);\n  }\n\n  // NASOMENTAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    const angle = calculateAngle(nasion, pronasale, pogonion);\n    addMeasurement('nasomentaAngle', angle);\n  }\n\n  // FACIAL CONVEXITY (GLABELLA)\n  if (glabella && subnasale && pogonion) {\n    const angle = calculateAngle(glabella, subnasale, pogonion);\n    addMeasurement('facialConvexityGlabella', angle);\n  }\n\n  // FACIAL CONVEXITY (NASION)\n  if (nasion && subnasale && pogonion) {\n    const angle = calculateAngle(nasion, subnasale, pogonion);\n    addMeasurement('facialConvexityNasion', angle);\n  }\n\n  // TOTAL FACIAL CONVEXITY\n  if (glabella && pronasale && pogonion) {\n    const angle = calculateAngle(glabella, pronasale, pogonion);\n    addMeasurement('totalFacialConvexity', angle);\n  }\n\n  // SUBMENTAL CERVICAL ANGLE\n  if (menton && cervicalPoint && pogonion) {\n    const neckPoint = getLandmark(landmarks, 'neckPoint');\n    if (neckPoint) {\n      const angle = calculateAngle(pogonion, menton, neckPoint);\n      addMeasurement('submentalCervicalAngle', angle);\n    }\n  }\n\n  // NASAL PROJECTION (Goode ratio)\n  if (pronasale && subnasale && nasion) {\n    const projection = distance(pronasale, subnasale);\n    const nasalLength = distance(nasion, pronasale);\n    if (nasalLength > 0) {\n      addMeasurement('nasalProjection', projection / nasalLength);\n    }\n  }\n\n  // NASOFACIAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    // Angle between nose dorsum and facial plane\n    const nasalDorsum = { x: pronasale.x - nasion.x, y: pronasale.y - nasion.y };\n    const facialPlane = { x: pogonion.x - nasion.x, y: pogonion.y - nasion.y };\n\n    const dot = nasalDorsum.x * facialPlane.x + nasalDorsum.y * facialPlane.y;\n    const mag1 = Math.sqrt(nasalDorsum.x ** 2 + nasalDorsum.y ** 2);\n    const mag2 = Math.sqrt(facialPlane.x ** 2 + facialPlane.y ** 2);\n\n    if (mag1 > 0 && mag2 > 0) {\n      const angle = Math.acos(dot / (mag1 * mag2)) * (180 / Math.PI);\n      addMeasurement('nasofacialAngle', angle);\n    }\n  }\n\n  // MANDIBULAR PLANE ANGLE (using Frankfort horizontal)\n  if (porion && orbitale && gonionBottom && menton) {\n    // Frankfort horizontal is porion to orbitale\n    // Mandibular plane is gonion to menton\n    const fhAngle = Math.atan2(orbitale.y - porion.y, orbitale.x - porion.x);\n    const mpAngle = Math.atan2(menton.y - gonionBottom.y, menton.x - gonionBottom.x);\n    const angle = Math.abs(fhAngle - mpAngle) * (180 / Math.PI);\n    addMeasurement('mandibularPlaneAngle', angle);\n  }\n\n  // CHIN PROJECTION\n  if (pogonion && subnasale) {\n    // Distance from pogonion to vertical line through subnasale\n    const projection = pogonion.x - subnasale.x;\n    addMeasurement('chinProjection', projection);\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// COMPLETE HARMONY ANALYSIS\n// ============================================\n\n/**\n * Run complete facial harmony analysis.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeHarmony(\n  frontLandmarks: LandmarkPoint[],\n  sideLandmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): HarmonyAnalysis {\n  const frontResults = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n  const sideResults = analyzeSideProfile(sideLandmarks, gender, ethnicity);\n\n  const allMeasurements = [...frontResults.measurements, ...sideResults.measurements];\n\n  // Combined category scores\n  const allCategories: Record<string, { total: number; count: number }> = {};\n  for (const m of allMeasurements) {\n    if (!allCategories[m.category]) {\n      allCategories[m.category] = { total: 0, count: 0 };\n    }\n    allCategories[m.category].total += m.standardizedScore;\n    allCategories[m.category].count++;\n  }\n\n  const categoryScores: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(allCategories)) {\n    categoryScores[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Overall weighted score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of allMeasurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  // Identify flaws (below average measurements)\n  const flaws: FlawAssessment[] = allMeasurements\n    .filter((m) => m.severity !== 'optimal' && m.severity !== 'minor')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      severity: m.severity,\n      deviation: `${m.deviation.toFixed(2)} ${m.deviationDirection} ideal`,\n      reasoning: `${m.name} is outside the ideal range`,\n      confidence: m.severity === 'extremely_severe' || m.severity === 'severe'\n        ? 'confirmed' as const\n        : 'likely' as const,\n    }))\n    .sort((a, b) => {\n      const severityOrder = { extremely_severe: 0, severe: 1, major: 2, moderate: 3 };\n      return (severityOrder[a.severity as keyof typeof severityOrder] ?? 4) -\n             (severityOrder[b.severity as keyof typeof severityOrder] ?? 4);\n    });\n\n  // Identify strengths (ideal measurements)\n  const strengths: StrengthAssessment[] = allMeasurements\n    .filter((m) => m.qualityTier === 'ideal' || m.qualityTier === 'excellent')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      qualityTier: m.qualityTier,\n      value: m.value,\n      reasoning: `${m.name} is within the ${m.qualityTier} range`,\n    }));\n\n  // Calculate percentile (based on population stats)\n  const percentile = calculateHarmonyPercentile(overallScore);\n\n  return {\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    percentile,\n    frontScore: frontResults.overallScore,\n    sideScore: sideResults.overallScore,\n    categoryScores,\n    measurements: allMeasurements,\n    flaws,\n    strengths,\n  };\n}\n\n/**\n * Calculate percentile from harmony score\n */\nfunction calculateHarmonyPercentile(score: number): number {\n  // Based on normal distribution with mean=5, stdDev=1.5\n  const mean = 5;\n  const stdDev = 1.5;\n  const z = (score - mean) / stdDev;\n  return normalCDF(z) * 100;\n}\n\n/**\n * Standard normal CDF approximation\n */\nfunction normalCDF(z: number): number {\n  const a1 = 0.254829592;\n  const a2 = -0.284496736;\n  const a3 = 1.421413741;\n  const a4 = -1.453152027;\n  const a5 = 1.061405429;\n  const p = 0.3275911;\n\n  const sign = z < 0 ? -1 : 1;\n  const absZ = Math.abs(z) / Math.sqrt(2);\n\n  const t = 1.0 / (1.0 + p * absZ);\n  const y = 1.0 - ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-absZ * absZ);\n\n  return 0.5 * (1.0 + sign * y);\n}\n\n// ============================================\n// PSL RATING CONVERSION\n// ============================================\n\nexport interface PSLRating {\n  score: number;\n  tier: string;\n  percentile: number;\n  description: string;\n}\n\n/**\n * Convert harmony score to PSL rating\n */\nexport function convertToPSL(harmonyScore: number): PSLRating {\n  // Convert 0-10 harmony to 3.0-7.5 PSL range\n  const psl = 3.0 + (harmonyScore / 10) * 4.5;\n  const clampedPSL = Math.max(3.0, Math.min(7.5, psl));\n\n  let tier: string;\n  let percentile: number;\n\n  if (clampedPSL >= 7.5) {\n    tier = 'Top Model';\n    percentile = 99.99;\n  } else if (clampedPSL >= 7.0) {\n    tier = 'Chad';\n    percentile = 99.87;\n  } else if (clampedPSL >= 6.5) {\n    tier = 'Chadlite';\n    percentile = 99.0;\n  } else if (clampedPSL >= 6.0) {\n    tier = 'High Tier Normie+';\n    percentile = 97.25;\n  } else if (clampedPSL >= 5.5) {\n    tier = 'High Tier Normie';\n    percentile = 90.0;\n  } else if (clampedPSL >= 5.0) {\n    tier = 'Mid Tier Normie+';\n    percentile = 84.15;\n  } else if (clampedPSL >= 4.5) {\n    tier = 'Mid Tier Normie';\n    percentile = 65.0;\n  } else if (clampedPSL >= 4.0) {\n    tier = 'Low Tier Normie';\n    percentile = 50.0;\n  } else if (clampedPSL >= 3.5) {\n    tier = 'Below Average';\n    percentile = 30.0;\n  } else {\n    tier = 'Subpar';\n    percentile = 15.0;\n  }\n\n  return {\n    score: clampedPSL,\n    tier,\n    percentile,\n    description: `${tier} (top ${(100 - percentile).toFixed(1)}%)`,\n  };\n}\n\n// ============================================\n// EXPORTS FOR BACKWARD COMPATIBILITY\n// ============================================\n\nexport type { LandmarkPoint } from './landmarks';\n","structuredPatch":[{"oldStart":280,"oldLines":10,"newStart":280,"newLines":13,"lines":["   // EYE METRICS - Ethnic variation","   // ==========================================","   lateralCanthalTilt: {","+    // White: Neoclassical standard - neutral to slightly positive tilt (4-8Â°)","     // East Asian: naturally higher positive tilt","     // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly","     // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)","-    // Extracted from FaceIQ Male:MiddleEastern.htc","+    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:MiddleEastern.htc","+    white_male: { idealMin: 4.0, idealMax: 8.0 },  // Neoclassical - neutral to slightly positive","+    white_female: { idealMin: 5.0, idealMax: 9.0 },","     east_asian_male: { idealMin: 8, idealMax: 12 },","     east_asian_female: { idealMin: 9, idealMax: 13 },","     south_asian_male: { idealMin: 6, idealMax: 10 },"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"66b6d4cb-a25d-4553-9d00-a9208ed0e5ae","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_015HuKJGxUj2XbfcfEderdCU","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect! Now let me verify that the intercanthalNasalRatio (alar base ratio) is already correctly set for white_male. Let me check line 229.","signature":"ErUCCkYIChgCKkC+j3WM01G3C1nHCZ/ZoCrrCRhCU3937g1a7KlQYfWuTKIv0iTwWzcPhzUsl2D/kcuKTwCCIqMSfOXuiMIp/+mvEgxw6NBMaI4l+lTbPUIaDMc5q68dLEh+QW8Q5CIw1+H6SwvGS8LOiqvsP9BxWkdmLdhVj2Mo50dcAGNB9CIg/LCdHaiqF6RZz3S3Cb1IKpwBCCSgXtmP+WQjv0CNfskhrw1Bb0hLqcCmxpJX8UJ3TFjiYn+r+AlsHQXlriW+1fCr3Wp0Mn2j8mmTH5J8+sP56W44tQ8F61wiIP/L7lGBflivfdrRy3L6IRbtCxyLBUI+/2G4F/BMEWxo8+oTPdKk07ckwp0GM+3s6sP/tECe3psHouwbG/mgMrJu8gtwG1kB0QsbOeONyRZXECBhGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":6,"cache_creation_input_tokens":1600,"cache_read_input_tokens":46242,"cache_creation":{"ephemeral_5m_input_tokens":1600,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDVHRcAYwWx3YaCrwaz","type":"assistant","uuid":"d0380b7f-9e7e-4408-bb62-09b538ff5961","timestamp":"2025-12-21T17:20:25.020Z"}
{"parentUuid":"d0380b7f-9e7e-4408-bb62-09b538ff5961","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_015HuKJGxUj2XbfcfEderdCU","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VhQMjhS4aA2vp7ZxnGF1Gy","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","offset":228,"limit":5}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":6,"cache_creation_input_tokens":1600,"cache_read_input_tokens":46242,"cache_creation":{"ephemeral_5m_input_tokens":1600,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDVHRcAYwWx3YaCrwaz","type":"assistant","uuid":"35849b86-1058-4142-9124-4b17ee2803ca","timestamp":"2025-12-21T17:20:25.818Z"}
{"parentUuid":"35849b86-1058-4142-9124-4b17ee2803ca","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VhQMjhS4aA2vp7ZxnGF1Gy","type":"tool_result","content":"   228â†’    // Extracted from FaceIQ BlackAfrican.htc and Male:Pacific Islander.htc logic\n   229â†’    white_male: { idealMin: 1.00, idealMax: 1.04 },\n   230â†’    white_female: { idealMin: 0.98, idealMax: 1.02 },\n   231â†’    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n   232â†’    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"6c8f19fb-1b6e-4d67-b3bb-b0ea96dc8f66","timestamp":"2025-12-21T17:20:25.883Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","content":"    // Extracted from FaceIQ BlackAfrican.htc and Male:Pacific Islander.htc logic\n    white_male: { idealMin: 1.00, idealMax: 1.04 },\n    white_female: { idealMin: 0.98, idealMax: 1.02 },\n    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },","numLines":5,"startLine":228,"totalLines":3166}}}
{"parentUuid":"6c8f19fb-1b6e-4d67-b3bb-b0ea96dc8f66","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_018DM1f1nwEukAakYncmD83B","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Great! The intercanthalNasalRatio (alar_base_ratio) already has white_male: { idealMin: 1.00, idealMax: 1.04 } which is close to the user's 0.98-1.05 range. Let me update it to match exactly what they specified, and also update the comment to reflect that this is the Neoclassical standard.","signature":"EssDCkYIChgCKkAdRgpybg77DWaXiYL5adoFeqB51B9x/KKiBEL4/sEoe/2Rlfb9gBvqkinao+7YbrMBdTtSGwck98CDsMOF2TZAEgy7rsjIpJyUy2RvNoQaDC0tL1QKxUftaf7/cCIwZM3w0hLX0zTXePcmHydtuQAhvi+pNvYHNT+Kdiza/yzOtHwII2uvBgoPLXZtmfPBKrICtjAFXKdJkpJ+Rea9SheXZhQtZ5a+19bFnhJG41zYJXXJYBHybTTEfXXbcPbN75Oqpubk+Al913J/cm6kbwii7HaRfd8hDWv6gds8bhUkdiej42DGuxyUuBlgFft0T9wHSp+8uysj9yW9KcwgvPD6yu5y3LG6Y+RICj559V4ptsTfnPz3+hmfhVFizkQqImI+ApVO6mToVEin14N8YW88eC23fPIdCz8FB0SPcTWs3117AQIfvyxOwUkoLrAT7YoE4i09Yy0iOKYA6mXgGzoyOgmkCOkOzP0GBRZaqql+9zk40wBKAFtQXuWnH29ZDEVq4c4uOwnG0oOFcsOCbRKinMoVZPc8/Ro60PT2B01+nB1W02JBQoe1aIEiGzWZJHNiNW0oMqN/hN3ORTl2ytE5d+BwGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":6,"cache_creation_input_tokens":402,"cache_read_input_tokens":47842,"cache_creation":{"ephemeral_5m_input_tokens":402,"ephemeral_1h_input_tokens":0},"output_tokens":8,"service_tier":"standard"}},"requestId":"req_011CWLDVmEBr1bHZp3p8kdRC","type":"assistant","uuid":"27dd8ee8-7f8b-47bc-a6b6-2962a03cdbae","timestamp":"2025-12-21T17:20:30.229Z"}
{"parentUuid":"27dd8ee8-7f8b-47bc-a6b6-2962a03cdbae","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_018DM1f1nwEukAakYncmD83B","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BWFwcRtnrAaqhFssHyMSio","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","old_string":"  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Pacific Islander: Similar to Black model, accepts wide nasal base\n    // Extracted from FaceIQ BlackAfrican.htc and Male:Pacific Islander.htc logic\n    white_male: { idealMin: 1.00, idealMax: 1.04 },\n    white_female: { idealMin: 0.98, idealMax: 1.02 },","new_string":"  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // White: Neoclassical standard - STRICT 1:1 ratio (nose width = inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Pacific Islander: Similar to Black model, accepts wide nasal base\n    // Extracted from FaceIQ Male:White.htc (Neoclassical), BlackAfrican.htc and Male:Pacific Islander.htc logic\n    white_male: { idealMin: 0.98, idealMax: 1.05 },  // Neoclassical - strictest nasal width standard\n    white_female: { idealMin: 0.98, idealMax: 1.02 },"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":6,"cache_creation_input_tokens":402,"cache_read_input_tokens":47842,"cache_creation":{"ephemeral_5m_input_tokens":402,"ephemeral_1h_input_tokens":0},"output_tokens":548,"service_tier":"standard"}},"requestId":"req_011CWLDVmEBr1bHZp3p8kdRC","type":"assistant","uuid":"c699847f-977a-474e-b9cf-e6b33d32b07b","timestamp":"2025-12-21T17:20:36.113Z"}
{"parentUuid":"c699847f-977a-474e-b9cf-e6b33d32b07b","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BWFwcRtnrAaqhFssHyMSio","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   220â†’    white: { idealMin: 0.60, idealMax: 0.67 },\n   221â†’    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },\n   222â†’  },\n   223â†’\n   224â†’  intercanthalNasalRatio: {\n   225â†’    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n   226â†’    // White: Neoclassical standard - STRICT 1:1 ratio (nose width = inner eye spacing)\n   227â†’    // Research: Wider nose base is standard in African phenotypes\n   228â†’    // Pacific Islander: Similar to Black model, accepts wide nasal base\n   229â†’    // Extracted from FaceIQ Male:White.htc (Neoclassical), BlackAfrican.htc and Male:Pacific Islander.htc logic\n   230â†’    white_male: { idealMin: 0.98, idealMax: 1.05 },  // Neoclassical - strictest nasal width standard\n   231â†’    white_female: { idealMin: 0.98, idealMax: 1.02 },\n   232â†’    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n   233â†’    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n   234â†’    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n   235â†’    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },"}]},"uuid":"fa2bc72b-8c57-443d-a105-214c49330906","timestamp":"2025-12-21T17:20:36.160Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","oldString":"  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Pacific Islander: Similar to Black model, accepts wide nasal base\n    // Extracted from FaceIQ BlackAfrican.htc and Male:Pacific Islander.htc logic\n    white_male: { idealMin: 1.00, idealMax: 1.04 },\n    white_female: { idealMin: 0.98, idealMax: 1.02 },","newString":"  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // White: Neoclassical standard - STRICT 1:1 ratio (nose width = inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Pacific Islander: Similar to Black model, accepts wide nasal base\n    // Extracted from FaceIQ Male:White.htc (Neoclassical), BlackAfrican.htc and Male:Pacific Islander.htc logic\n    white_male: { idealMin: 0.98, idealMax: 1.05 },  // Neoclassical - strictest nasal width standard\n    white_female: { idealMin: 0.98, idealMax: 1.02 },","originalFile":"/**\n * FaceIQ-Style Facial Analysis Scoring System\n * Complete replication of FaceIQ Labs scoring algorithms\n *\n * Features:\n * - Exponential decay scoring with per-metric decay rates\n * - Bezier curve custom scoring for non-linear measurements\n * - 70+ facial measurements (front + side profiles)\n * - Quality tiers: Ideal, Excellent, Good\n * - 5-tier severity: Extremely Severe, Severe, Major, Moderate, Minor\n */\n\nimport { LandmarkPoint } from './landmarks';\n\n// ============================================\n// CORE TYPES\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\n/**\n * Polarity defines how deviation from the ideal range is interpreted:\n * - 'balanced': Default. Deviation in either direction is equally bad.\n * - 'higher_is_better': Values above the ideal are still good. Only values below\n *   the 'safeFloor' are true weaknesses. E.g., Canthal Tilt (positive tilt is good)\n * - 'lower_is_better': Values below the ideal are still good. Only values above\n *   the 'safeCeiling' are true weaknesses. E.g., Philtrum length (shorter is better)\n */\nexport type MetricPolarity = 'balanced' | 'higher_is_better' | 'lower_is_better';\n\nexport interface MetricConfig {\n  id: string;\n  name: string;\n  category: string;\n  unit: MeasurementUnit;\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  decayRate: number;\n  maxScore: number;\n  weight: number;\n  description: string;\n  profileType: 'front' | 'side';\n  customCurve?: BezierCurveConfig;\n  /**\n   * Polarity for directional/dimorphic scoring.\n   * Defaults to 'balanced' if not specified.\n   */\n  polarity?: MetricPolarity;\n  /**\n   * For 'higher_is_better': minimum value that's still acceptable.\n   * Values above this but below idealMin get a passing score (softFloorScore).\n   * Values below this are true weaknesses.\n   */\n  safeFloor?: number;\n  /**\n   * For 'lower_is_better': maximum value that's still acceptable.\n   * Values below this but above idealMax get a passing score (softCeilingScore).\n   * Values above this are true weaknesses.\n   */\n  safeCeiling?: number;\n  /**\n   * Score given to values in the \"acceptable but not ideal\" zone.\n   * Defaults to 8.0 (Good). Range: 6.0-9.0\n   */\n  softZoneScore?: number;\n}\n\nexport interface BezierCurveConfig {\n  mode: 'custom' | 'exponential';\n  points: CurvePoint[];\n}\n\nexport interface CurvePoint {\n  x: number;\n  y: number;\n  leftHandleX?: number;\n  leftHandleY?: number;\n  rightHandleX?: number;\n  rightHandleY?: number;\n  fixed?: boolean;\n}\n\nexport interface FaceIQScoreResult {\n  metricId: string;\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  severity: SeverityLevel;\n  idealMin: number;\n  idealMax: number;\n  deviation: number;\n  deviationDirection: 'above' | 'below' | 'within';\n  unit: MeasurementUnit;\n  category: string;\n  percentile?: number;\n}\n\nexport interface HarmonyAnalysis {\n  overallScore: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  percentile: number;\n  frontScore: number;\n  sideScore: number;\n  categoryScores: Record<string, number>;\n  measurements: FaceIQScoreResult[];\n  flaws: FlawAssessment[];\n  strengths: StrengthAssessment[];\n}\n\nexport interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n}\n\nexport interface StrengthAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  qualityTier: QualityTier;\n  value: number;\n  reasoning: string;\n}\n\n// ============================================\n// DEMOGRAPHIC TYPES & OVERRIDES\n// ============================================\n\nexport type Ethnicity =\n  | 'east_asian'\n  | 'south_asian'\n  | 'black'\n  | 'hispanic'\n  | 'middle_eastern'\n  | 'native_american'\n  | 'pacific_islander'\n  | 'white'\n  | 'other';\n\nexport type Gender = 'male' | 'female';\n\nexport type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n\nexport interface DemographicOverride {\n  idealMin: number;\n  idealMax: number;\n}\n\n/**\n * Demographic-specific ideal ranges based on anthropometric research.\n * FaceIQ uses universal scoring, but this gives more accurate assessments\n * by adjusting ideals based on ethnicity and gender.\n */\nexport const DEMOGRAPHIC_OVERRIDES: Record<string, Partial<Record<DemographicKey, DemographicOverride>>> = {\n  // ==========================================\n  // NOSE METRICS - Highest ethnicity variation\n  // ==========================================\n  nasalIndex: {\n    // Nasal Index = (Nose Width / Nose Height) Ã— 100\n    // Research: African/Pacific Islander tend platyrrhine (85-100), Asian mesorrhine (75-88), European leptorrhine (65-75)\n    east_asian_male: { idealMin: 78, idealMax: 88 },\n    east_asian_female: { idealMin: 76, idealMax: 86 },\n    south_asian_male: { idealMin: 72, idealMax: 82 },\n    south_asian_female: { idealMin: 70, idealMax: 80 },\n    black_male: { idealMin: 85, idealMax: 100 },\n    black_female: { idealMin: 83, idealMax: 98 },\n    hispanic_male: { idealMin: 75, idealMax: 87 },\n    hispanic_female: { idealMin: 73, idealMax: 85 },\n    middle_eastern_male: { idealMin: 68, idealMax: 78 },\n    middle_eastern_female: { idealMin: 66, idealMax: 76 },\n    white_male: { idealMin: 65, idealMax: 75 },\n    white_female: { idealMin: 63, idealMax: 73 },\n    native_american_male: { idealMin: 72, idealMax: 82 },\n    native_american_female: { idealMin: 70, idealMax: 80 },\n    pacific_islander_male: { idealMin: 82, idealMax: 95 },\n    pacific_islander_female: { idealMin: 80, idealMax: 93 },\n  },\n\n  nasolabialAngle: {\n    // Ideal nasolabial angle varies by ethnicity\n    // African: slightly more obtuse, European: slightly more acute\n    // Middle Eastern: Penalizes droopy tip (<90Â°) - common flaw is \"Hooked Nose\"\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    black_male: { idealMin: 95, idealMax: 110 },\n    black_female: { idealMin: 100, idealMax: 115 },\n    east_asian_male: { idealMin: 90, idealMax: 105 },\n    east_asian_female: { idealMin: 95, idealMax: 110 },\n    middle_eastern_male: { idealMin: 90, idealMax: 100 },  // Strict on droopy tip\n    middle_eastern_female: { idealMin: 95, idealMax: 105 },\n    // Gender-only fallbacks\n    male: { idealMin: 90, idealMax: 100 },\n    female: { idealMin: 100, idealMax: 110 },\n  },\n\n  nasalProjection: {\n    // Nose projection relative to face depth\n    // East Asian/African: typically less projection is ideal\n    // Middle Eastern: Accepts stronger projection (bigger nose) than White model\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian: { idealMin: 0.54, idealMax: 0.60 },\n    black: { idealMin: 0.52, idealMax: 0.58 },\n    south_asian: { idealMin: 0.56, idealMax: 0.62 },\n    middle_eastern: { idealMin: 0.62, idealMax: 0.70 },  // Higher tolerance for larger noses\n    white: { idealMin: 0.60, idealMax: 0.67 },\n    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },\n  },\n\n  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Pacific Islander: Similar to Black model, accepts wide nasal base\n    // Extracted from FaceIQ BlackAfrican.htc and Male:Pacific Islander.htc logic\n    white_male: { idealMin: 1.00, idealMax: 1.04 },\n    white_female: { idealMin: 0.98, idealMax: 1.02 },\n    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n    black_female: { idealMin: 1.13, idealMax: 1.23 },\n    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n    pacific_islander_male: { idealMin: 1.10, idealMax: 1.20 },  // Wide tolerance, similar to Black model\n    pacific_islander_female: { idealMin: 1.08, idealMax: 1.18 },\n  },\n\n  // ==========================================\n  // JAW METRICS - Clear gender dimorphism\n  // ==========================================\n  bigonialWidth: {\n    // Jaw width as % of bizygomatic width\n    // Males: wider, more angular; Females: narrower, softer\n    // Pacific Islander: Extremely wide jaw preferred - \"Warrior Skull\" robustness\n    // Extracted from FaceIQ Male:Pacific Islander.htc\n    male: { idealMin: 90, idealMax: 95 },\n    female: { idealMin: 85, idealMax: 90 },\n    pacific_islander_male: { idealMin: 92, idealMax: 98 },  // Jaw width rivals cheekbone width - extreme robustness\n    pacific_islander_female: { idealMin: 88, idealMax: 94 },\n  },\n\n  jawFrontalAngle: {\n    // More angular in males, softer in females\n    male: { idealMin: 88, idealMax: 95 },\n    female: { idealMin: 82, idealMax: 90 },\n  },\n\n  jawWidthRatio: {\n    // Males have stronger jaw width preference\n    male: { idealMin: 0.78, idealMax: 0.85 },\n    female: { idealMin: 0.72, idealMax: 0.80 },\n  },\n\n  gonialAngle: {\n    // White: Neoclassical standard - square, vertically robust jaw (115-125Â°)\n    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n    // Extracted from FaceIQ Male:White.htc\n    white_male: { idealMin: 115, idealMax: 125 },  // Neoclassical square jaw - less tolerant of soft/V-shaped jaws\n    white_female: { idealMin: 120, idealMax: 132 },\n    male: { idealMin: 115, idealMax: 125 },\n    female: { idealMin: 120, idealMax: 135 },\n  },\n\n  // ==========================================\n  // EYE METRICS - Ethnic variation\n  // ==========================================\n  lateralCanthalTilt: {\n    // White: Neoclassical standard - neutral to slightly positive tilt (4-8Â°)\n    // East Asian: naturally higher positive tilt\n    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:MiddleEastern.htc\n    white_male: { idealMin: 4.0, idealMax: 8.0 },  // Neoclassical - neutral to slightly positive\n    white_female: { idealMin: 5.0, idealMax: 9.0 },\n    east_asian_male: { idealMin: 8, idealMax: 12 },\n    east_asian_female: { idealMin: 9, idealMax: 13 },\n    south_asian_male: { idealMin: 6, idealMax: 10 },\n    south_asian_female: { idealMin: 7, idealMax: 11 },\n    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n    // Default for others is 4-8 (already in FACEIQ_METRICS)\n  },\n\n  eyeAspectRatio: {\n    // East Asian eyes often have different aspect ratio due to epicanthal fold\n    east_asian_male: { idealMin: 2.6, idealMax: 3.2 },\n    east_asian_female: { idealMin: 2.7, idealMax: 3.3 },\n    // Larger eyes in females considered more attractive\n    male: { idealMin: 2.9, idealMax: 3.4 },\n    female: { idealMin: 3.1, idealMax: 3.6 },\n  },\n\n  tearTroughDepth: {\n    // Under-eye hollowing and dark circles (infraorbital depression)\n    // South Asian: MUCH stricter penalty due to genetic hyperpigmentation\n    // Extracted from FaceIQ Male:SouthAsian.htc - biggest difference vs White model\n    white_male: { idealMin: 0.0, idealMax: 1.5 },\n    white_female: { idealMin: 0.0, idealMax: 1.3 },\n    south_asian_male: { idealMin: 0.0, idealMax: 0.5 },  // VERY strict - 0.5+ triggers \"Tired/Aged Eyes\" flaw\n    south_asian_female: { idealMin: 0.0, idealMax: 0.4 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.2 },\n    east_asian_female: { idealMin: 0.0, idealMax: 1.0 },\n  },\n\n  upperEyelidExposure: {\n    // Visible eyelid platform (space between eyelash and crease)\n    // South Asian ideal: prefers visible lid platform, penalizes hooded eyes more than White model\n    // Extracted from FaceIQ Male:SouthAsian.htc\n    white_male: { idealMin: 0.3, idealMax: 2.5 },\n    white_female: { idealMin: 0.5, idealMax: 3.0 },\n    south_asian_male: { idealMin: 0.5, idealMax: 2.0 },  // Prefers visible lid, penalizes hooding\n    south_asian_female: { idealMin: 0.7, idealMax: 2.2 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.5 },  // More tolerance for less exposure\n    east_asian_female: { idealMin: 0.2, idealMax: 1.8 },\n  },\n\n  // ==========================================\n  // FACE PROPORTIONS - Gender variation\n  // ==========================================\n  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n  },\n\n  totalFacialWidthToHeight: {\n    male: { idealMin: 1.35, idealMax: 1.40 },\n    female: { idealMin: 1.32, idealMax: 1.37 },\n  },\n\n  midfaceRatio: {\n    // Females often have more compact midface\n    // White: Neoclassical standard - strict compact midface preference\n    // Middle Eastern: Similar to White model - compact is better\n    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:MiddleEastern.htc\n    white_male: { idealMin: 0.95, idealMax: 1.02 },  // Neoclassical - penalizes long midface heavily\n    white_female: { idealMin: 0.93, idealMax: 1.00 },\n    male: { idealMin: 0.98, idealMax: 1.02 },\n    female: { idealMin: 0.95, idealMax: 1.00 },\n    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n  },\n\n  // ==========================================\n  // LIP METRICS - Ethnicity variation\n  // ==========================================\n  lipRatio: {\n    // African/Hispanic: fuller lips natural\n    black_male: { idealMin: 1.6, idealMax: 2.2 },\n    black_female: { idealMin: 1.7, idealMax: 2.3 },\n    hispanic_male: { idealMin: 1.4, idealMax: 2.0 },\n    hispanic_female: { idealMin: 1.5, idealMax: 2.1 },\n    // East Asian: less full lips\n    east_asian_male: { idealMin: 1.2, idealMax: 1.7 },\n    east_asian_female: { idealMin: 1.3, idealMax: 1.8 },\n    // Default\n    male: { idealMin: 1.3, idealMax: 1.8 },\n    female: { idealMin: 1.4, idealMax: 2.0 },\n  },\n\n  upperLipRatio: {\n    // Fuller upper lip in African phenotypes\n    black: { idealMin: 0.38, idealMax: 0.48 },\n    hispanic: { idealMin: 0.36, idealMax: 0.45 },\n    east_asian: { idealMin: 0.32, idealMax: 0.40 },\n    female: { idealMin: 0.34, idealMax: 0.42 },\n  },\n\n  // ==========================================\n  // PROFILE METRICS - Gender & ethnicity\n  // ==========================================\n  chinProjection: {\n    // Males: more projected chin ideal\n    // Black/African: Adjusted for bimaxillary prognathism (forward mouth projection)\n    // Extracted from FaceIQ BlackAfrican.htc logic\n    male: { idealMin: 0, idealMax: 3 },\n    female: { idealMin: -2, idealMax: 2 },\n    black_male: { idealMin: 0, idealMax: 4 },  // Accommodates natural forward projection\n    black_female: { idealMin: -1, idealMax: 3 },\n  },\n\n  nasofrontalAngle: {\n    // Higher brow ridge in males\n    male: { idealMin: 128, idealMax: 138 },\n    female: { idealMin: 132, idealMax: 142 },\n  },\n\n  chinToPhiltrumRatio: {\n    // White: Neoclassical standard - strict balance between chin and philtrum\n    // Black/African: Fuller lips naturally shorten visible philtrum\n    // Extracted from FaceIQ Male:White.htc (Neoclassical) and BlackAfrican.htc\n    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n    white_male: { idealMin: 2.10, idealMax: 2.30 },  // Neoclassical - strict lower face balance\n    white_female: { idealMin: 2.05, idealMax: 2.25 },\n    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n    black_female: { idealMin: 2.10, idealMax: 2.65 },\n  },\n\n  // ==========================================\n  // SKIN QUALITY - Ethnicity variation\n  // ==========================================\n  skinUniformity: {\n    // South Asian: Stricter standards due to genetic hyperpigmentation tendency\n    // Hispanic: Similar to South Asian - penalizes hyperpigmentation more than White model\n    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n    white_male: { idealMin: 0.88, idealMax: 1.00 },\n    white_female: { idealMin: 0.90, idealMax: 1.00 },\n    south_asian_male: { idealMin: 0.90, idealMax: 1.00 },  // Stricter - hyperpigmentation common\n    south_asian_female: { idealMin: 0.92, idealMax: 1.00 },\n    east_asian_male: { idealMin: 0.92, idealMax: 1.00 },  // High skin quality standards\n    east_asian_female: { idealMin: 0.94, idealMax: 1.00 },\n    black_male: { idealMin: 0.85, idealMax: 1.00 },  // More tolerance for melanin variation\n    black_female: { idealMin: 0.87, idealMax: 1.00 },\n    hispanic_male: { idealMin: 0.85, idealMax: 1.00 },  // Bridge: more tolerance than South Asian, less than White\n    hispanic_female: { idealMin: 0.87, idealMax: 1.00 },\n  },\n\n  // ==========================================\n  // EYEBROW METRICS - Ethnicity variation\n  // ==========================================\n  eyebrowThickness: {\n    // Middle Eastern: Heavily favors thick, dense eyebrows (\"Dark Triad\" look with deep-set eyes)\n    // Extracted from FaceIQ Male:MiddleEastern.htc - STRICTEST eyebrow requirements\n    middle_eastern_male: { idealMin: 2.5, idealMax: 5.0 },  // Prefers significantly thicker/darker brows\n    middle_eastern_female: { idealMin: 2.0, idealMax: 4.0 },\n    east_asian_male: { idealMin: 1.5, idealMax: 3.0 },  // Typically less thick\n    east_asian_female: { idealMin: 1.3, idealMax: 2.5 },\n    male: { idealMin: 2.0, idealMax: 4.0 },\n    female: { idealMin: 1.8, idealMax: 3.5 },\n  },\n\n  eyebrowDistance: {\n    // Middle Eastern: \"Kill Switch\" for unibrow (synophrys)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    // While thick brows are favored, unibrow is a critical flaw if distance < 15mm\n    middle_eastern_male: { idealMin: 15, idealMax: 25 },  // Stricter minimum to avoid unibrow\n    middle_eastern_female: { idealMin: 18, idealMax: 28 },\n    male: { idealMin: 15, idealMax: 25 },\n    female: { idealMin: 16, idealMax: 26 },\n  },\n\n  orbitalVector: {\n    // Middle Eastern: Favors deep-set eyes (lower/negative orbital vector)\n    // Part of the \"Dark Triad\" look with heavy brows\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    middle_eastern_male: { idealMin: -2, idealMax: 3 },  // Allows more deep-set eyes\n    middle_eastern_female: { idealMin: -1, idealMax: 4 },\n    male: { idealMin: 0, idealMax: 4 },\n    female: { idealMin: 1, idealMax: 5 },\n  },\n};\n\n/**\n * Get metric configuration with demographic-specific overrides applied.\n * Lookup priority: ethnicity_gender > gender > ethnicity > default\n */\nexport function getMetricConfigForDemographics(\n  metricId: string,\n  gender: Gender,\n  ethnicity: Ethnicity = 'other'\n): MetricConfig | null {\n  const baseConfig = FACEIQ_METRICS[metricId];\n  if (!baseConfig) return null;\n\n  const overrides = DEMOGRAPHIC_OVERRIDES[metricId];\n  if (!overrides) return baseConfig;\n\n  // Try specific combo first (e.g., \"east_asian_male\")\n  const specificKey = `${ethnicity}_${gender}` as DemographicKey;\n  const override = overrides[specificKey] || overrides[gender] || overrides[ethnicity];\n\n  if (!override) return baseConfig;\n\n  return {\n    ...baseConfig,\n    idealMin: override.idealMin,\n    idealMax: override.idealMax,\n  };\n}\n\n// ============================================\n// FACEIQ MEASUREMENT CONFIGURATIONS (70+)\n// ============================================\n\nexport const FACEIQ_METRICS: Record<string, MetricConfig> = {\n  // ==========================================\n  // FRONT PROFILE - FACIAL PROPORTIONS (32)\n  // ==========================================\n\n  faceWidthToHeight: {\n    id: 'faceWidthToHeight',\n    name: 'Face Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.96,\n    idealMax: 2.0,\n    rangeMin: 1.4,\n    rangeMax: 2.5,\n    decayRate: 6.4,\n    maxScore: 30,  // FaceIQ: highest priority metric\n    weight: 0.06,\n    description: 'Ratio of bizygomatic width to upper face height',\n    profileType: 'front',\n  },\n\n  lowerThirdProportion: {\n    id: 'lowerThirdProportion',\n    name: 'Lower Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31,\n    idealMax: 33.5,\n    rangeMin: 24,\n    rangeMax: 40,\n    decayRate: 1.86,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by lower third (subnasale to menton)',\n    profileType: 'front',\n  },\n\n  middleThirdProportion: {\n    id: 'middleThirdProportion',\n    name: 'Middle Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31.4,\n    idealMax: 33.4,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by middle third',\n    profileType: 'front',\n  },\n\n  upperThirdProportion: {\n    id: 'upperThirdProportion',\n    name: 'Upper Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 30,\n    idealMax: 32,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Percentage of face occupied by upper third (trichion to glabella)',\n    profileType: 'front',\n  },\n\n  bitemporalWidth: {\n    id: 'bitemporalWidth',\n    name: 'Bitemporal Width',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 75,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Temple width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  cheekboneHeight: {\n    id: 'cheekboneHeight',\n    name: 'Cheekbone Height',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 83,\n    idealMax: 100,\n    rangeMin: 30,\n    rangeMax: 140,\n    decayRate: 0.5,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Vertical position of cheekbones relative to face height',\n    profileType: 'front',\n  },\n\n  totalFacialWidthToHeight: {\n    id: 'totalFacialWidthToHeight',\n    name: 'Total Facial Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.34,\n    idealMax: 1.37,\n    rangeMin: 1.0,\n    rangeMax: 1.7,\n    decayRate: 13.2,\n    maxScore: 25,  // Special: higher max score\n    weight: 0.05,\n    description: 'Total face height divided by cheek width',\n    profileType: 'front',\n    customCurve: {\n      mode: 'custom',\n      points: [\n        { x: 1.05, y: 0 },\n        { x: 1.17, y: 1.41 },\n        { x: 1.25, y: 3.86 },\n        { x: 1.29, y: 6.01 },\n        { x: 1.32, y: 8.88 },\n        { x: 1.34, y: 10, fixed: true },\n        { x: 1.37, y: 10, fixed: true },\n        { x: 1.39, y: 8.88 },\n        { x: 1.42, y: 6.01 },\n        { x: 1.46, y: 3.86 },\n        { x: 1.54, y: 1.41 },\n        { x: 1.66, y: 0 },\n      ],\n    },\n  },\n\n  midfaceRatio: {\n    id: 'midfaceRatio',\n    name: 'Midface Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 0.97,\n    idealMax: 1.0,\n    rangeMin: 0.5,\n    rangeMax: 1.5,\n    decayRate: 31.6,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.04,\n    description: 'Midface width to height ratio for facial balance',\n    profileType: 'front',\n  },\n\n  // JAW MEASUREMENTS\n  jawSlope: {\n    id: 'jawSlope',\n    name: 'Jaw Slope',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 140,\n    idealMax: 142.5,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of the jawline from gonion to chin',\n    profileType: 'front',\n  },\n\n  jawFrontalAngle: {\n    id: 'jawFrontalAngle',\n    name: 'Jaw Frontal Angle',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 35,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 20,  // FaceIQ: high priority\n    weight: 0.04,\n    description: 'Angle of jaw corners from frontal view',\n    profileType: 'front',\n  },\n\n  bigonialWidth: {\n    id: 'bigonialWidth',\n    name: 'Bigonial Width',\n    category: 'Jaw Shape',\n    unit: 'percent',\n    idealMin: 87.75,\n    idealMax: 91.75,\n    rangeMin: 60.25,\n    rangeMax: 120.25,\n    decayRate: 0.9,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Jaw width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  jawWidthRatio: {\n    id: 'jawWidthRatio',\n    name: 'Jaw Width to Face Width Ratio',\n    category: 'Jaw Shape',\n    unit: 'ratio',\n    idealMin: 0.75,\n    idealMax: 0.82,\n    rangeMin: 0.6,\n    rangeMax: 0.95,\n    decayRate: 25.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Bigonial width divided by bizygomatic width',\n    profileType: 'front',\n  },\n\n  // EYE MEASUREMENTS\n  lateralCanthalTilt: {\n    id: 'lateralCanthalTilt',\n    name: 'Lateral Canthal Tilt',\n    category: 'Eyes',\n    unit: 'degrees',\n    idealMin: 4.0,   // Updated: 4-8Â° is peak \"hunter eyes\"\n    idealMax: 8.0,\n    rangeMin: -5,\n    rangeMax: 20,\n    decayRate: 1.5,  // Reduced: gentler decay for positive tilts\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle of eye from inner to outer canthus. Positive tilt is attractive.',\n    profileType: 'front',\n    // DIRECTIONAL SCORING: Higher (positive) tilt is better\n    // - Ideal: 4-8Â° (attractive upswept eyes / \"hunter eyes\")\n    // - Good: 0-4Â° (neutral to slight positive - still attractive)\n    // - Weak: < 0Â° (negative/droopy tilt - only this is a true weakness)\n    polarity: 'higher_is_better',\n    safeFloor: 0.0,       // Neutral tilt - anything above is acceptable\n    softZoneScore: 8.0,   // \"Good\" score for 0-4Â° range\n  },\n\n  eyeAspectRatio: {\n    id: 'eyeAspectRatio',\n    name: 'Eye Aspect Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 3.0,\n    idealMax: 3.5,\n    rangeMin: 0.8,\n    rangeMax: 6,\n    decayRate: 2.0,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Eye width divided by eye height',\n    profileType: 'front',\n  },\n\n  eyeSeparationRatio: {\n    id: 'eyeSeparationRatio',\n    name: 'Eye Separation Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 45.7,\n    idealMax: 46.8,\n    rangeMin: 35,\n    rangeMax: 55,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Intercanthal distance as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryRatio: {\n    id: 'interpupillaryRatio',\n    name: 'Interpupillary Distance Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 44,\n    idealMax: 48,\n    rangeMin: 38,\n    rangeMax: 54,\n    decayRate: 1.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'IPD as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryMouthWidthRatio: {\n    id: 'interpupillaryMouthWidthRatio',\n    name: 'Interpupillary-Mouth Width Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.83,\n    idealMax: 0.87,\n    rangeMin: 0.6,\n    rangeMax: 1.1,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Mouth width divided by interpupillary distance',\n    profileType: 'front',\n  },\n\n  oneEyeApartTest: {\n    id: 'oneEyeApartTest',\n    name: 'One Eye Apart Test',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.95,\n    idealMax: 1.0,\n    rangeMin: 0.7,\n    rangeMax: 1.3,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Intercanthal distance should equal one eye width',\n    profileType: 'front',\n  },\n\n  tearTroughDepth: {\n    id: 'tearTroughDepth',\n    name: 'Tear Trough Depth',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.0,\n    idealMax: 1.5,\n    rangeMin: 0.0,\n    rangeMax: 4.0,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Under-eye hollow depth (infraorbital depression). Lower is better for youthfulness.',\n    profileType: 'front',\n    polarity: 'lower_is_better',\n    safeCeiling: 1.5,  // White standard\n    softZoneScore: 7.5,\n  },\n\n  upperEyelidExposure: {\n    id: 'upperEyelidExposure',\n    name: 'Upper Eyelid Exposure',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 2.5,\n    rangeMin: 0.0,\n    rangeMax: 5.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Visible upper eyelid platform. Too little creates hooded eyes.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  // EYEBROW MEASUREMENTS\n  eyebrowThickness: {\n    id: 'eyebrowThickness',\n    name: 'Eyebrow Thickness',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 2.0,\n    idealMax: 4.0,\n    rangeMin: 1.0,\n    rangeMax: 6.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow density and thickness. Higher values indicate fuller, denser brows.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  eyebrowDistance: {\n    id: 'eyebrowDistance',\n    name: 'Inter-Eyebrow Distance',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 15,\n    idealMax: 25,\n    rangeMin: 5,\n    rangeMax: 40,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance between inner edges of eyebrows. Too low creates unibrow (synophrys).',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  browLengthRatio: {\n    id: 'browLengthRatio',\n    name: 'Brow Length to Face Width Ratio',\n    category: 'Upper Third',\n    unit: 'percent',\n    idealMin: 28,\n    idealMax: 32,\n    rangeMin: 20,\n    rangeMax: 40,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow length as percentage of face width',\n    profileType: 'front',\n  },\n\n  eyebrowTilt: {\n    id: 'eyebrowTilt',\n    name: 'Eyebrow Tilt',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 6.5,\n    idealMax: 11,\n    rangeMin: -5,\n    rangeMax: 25,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of eyebrow from head to tail',\n    profileType: 'front',\n  },\n\n  eyebrowLowSetedness: {\n    id: 'eyebrowLowSetedness',\n    name: 'Eyebrow Low Setedness',\n    category: 'Upper Third',\n    unit: 'ratio',\n    idealMin: 0,\n    idealMax: 0.45,\n    rangeMin: -0.2,\n    rangeMax: 1.0,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from brow to eye relative to eye height',\n    profileType: 'front',\n  },\n\n  // NOSE MEASUREMENTS (FRONT)\n  nasalIndex: {\n    id: 'nasalIndex',\n    name: 'Nasal Index',\n    category: 'Nose',\n    unit: 'percent',\n    idealMin: 70,\n    idealMax: 85,\n    rangeMin: 55,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose width divided by nose height Ã— 100',\n    profileType: 'front',\n  },\n\n  intercanthalNasalRatio: {\n    id: 'intercanthalNasalRatio',\n    name: 'Intercanthal-Nasal Width Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 1.04,\n    idealMax: 1.16,\n    rangeMin: 0.7,\n    rangeMax: 1.5,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Alar width should roughly equal intercanthal distance',\n    profileType: 'front',\n  },\n\n  noseBridgeWidth: {\n    id: 'noseBridgeWidth',\n    name: 'Nose Bridge to Nose Width',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.6,\n    idealMax: 0.75,\n    rangeMin: 0.4,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ratio of nose bridge width to alar base width',\n    profileType: 'front',\n  },\n\n  noseTipPosition: {\n    id: 'noseTipPosition',\n    name: 'Nose Tip Position',\n    category: 'Nose',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 3.5,\n    rangeMin: -7.5,\n    rangeMax: 12.5,\n    decayRate: 1.5,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Nose tip deviation from facial midline',\n    profileType: 'front',\n  },\n\n  // MOUTH/LIP MEASUREMENTS\n  mouthWidthToNoseRatio: {\n    id: 'mouthWidthToNoseRatio',\n    name: 'Mouth Width to Nose Width Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.43,\n    idealMax: 1.51,\n    rangeMin: 0.96,\n    rangeMax: 1.91,\n    decayRate: 18.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Mouth width divided by nose width',\n    profileType: 'front',\n  },\n\n  lowerToUpperLipRatio: {\n    id: 'lowerToUpperLipRatio',\n    name: 'Lower Lip to Upper Lip Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.58,\n    idealMax: 1.88,\n    rangeMin: -0.98,\n    rangeMax: 4.03,\n    decayRate: 8.0,\n    maxScore: 7.5,  // FaceIQ: medium priority\n    weight: 0.02,\n    description: 'Lower lip height divided by upper lip height',\n    profileType: 'front',\n  },\n\n  cupidsBowDepth: {\n    id: 'cupidsBowDepth',\n    name: \"Cupid's Bow Depth\",\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2.3,\n    idealMax: 4,\n    rangeMin: 0,\n    rangeMax: 7,\n    decayRate: 2.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: \"Depth of the cupid's bow curve\",\n    profileType: 'front',\n  },\n\n  mouthCornerPosition: {\n    id: 'mouthCornerPosition',\n    name: 'Mouth Corner Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Mouth corner vertical position relative to lip center',\n    profileType: 'front',\n  },\n\n  // CHIN MEASUREMENTS (FRONT)\n  chinToPhiltrumRatio: {\n    id: 'chinToPhiltrumRatio',\n    name: 'Chin to Philtrum Ratio',\n    category: 'Chin',\n    unit: 'ratio',\n    idealMin: 2.15,\n    idealMax: 2.45,\n    rangeMin: 0.3,\n    rangeMax: 4.5,\n    decayRate: 10.0,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.02,\n    description: 'Chin height divided by philtrum length',\n    profileType: 'front',\n  },\n\n  // OTHER FRONT MEASUREMENTS\n  iaaJfaDeviation: {\n    id: 'iaaJfaDeviation',\n    name: 'Deviation of IAA & JFA',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 0,\n    idealMax: 2.5,\n    rangeMin: -25,\n    rangeMax: 30,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Deviation between Ipsilateral Alar Angle and Jaw Frontal Angle',\n    profileType: 'front',\n  },\n\n  ipsilateralAlarAngle: {\n    id: 'ipsilateralAlarAngle',\n    name: 'Ipsilateral Alar Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 60,\n    rangeMax: 125,\n    decayRate: 0.6,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Angle of alar base relative to facial plane',\n    profileType: 'front',\n  },\n\n  earProtrusionAngle: {\n    id: 'earProtrusionAngle',\n    name: 'Ear Protrusion Angle',\n    category: 'Ears',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 11.5,\n    rangeMin: -25,\n    rangeMax: 40,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of ear protrusion from head',\n    profileType: 'front',\n  },\n\n  earProtrusionRatio: {\n    id: 'earProtrusionRatio',\n    name: 'Ear Protrusion Ratio',\n    category: 'Ears',\n    unit: 'percent',\n    idealMin: 8,\n    idealMax: 12,\n    rangeMin: -20,\n    rangeMax: 40,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ear protrusion as percentage of head width',\n    profileType: 'front',\n  },\n\n  neckWidth: {\n    id: 'neckWidth',\n    name: 'Neck Width',\n    category: 'Neck',\n    unit: 'percent',\n    idealMin: 92,\n    idealMax: 98,\n    rangeMin: 60,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Neck width as percentage of jaw width',\n    profileType: 'front',\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS (38)\n  // ==========================================\n\n  gonialAngle: {\n    id: 'gonialAngle',\n    name: 'Gonial Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 130,\n    rangeMin: 105,\n    rangeMax: 145,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle at the jaw corner (gonion)',\n    profileType: 'side',\n  },\n\n  nasolabialAngle: {\n    id: 'nasolabialAngle',\n    name: 'Nasolabial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 90,\n    idealMax: 105,\n    rangeMin: 75,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle between columella and upper lip',\n    profileType: 'side',\n  },\n\n  nasofrontalAngle: {\n    id: 'nasofrontalAngle',\n    name: 'Nasofrontal Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 116,\n    idealMax: 128,\n    rangeMin: 90,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the bridge of nose (nasion)',\n    profileType: 'side',\n  },\n\n  nasofacialAngle: {\n    id: 'nasofacialAngle',\n    name: 'Nasofacial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 31,\n    idealMax: 35,\n    rangeMin: 15,\n    rangeMax: 50,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between nose and face plane',\n    profileType: 'side',\n  },\n\n  nasomentaAngle: {\n    id: 'nasomentaAngle',\n    name: 'Nasomental Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 126,\n    idealMax: 131,\n    rangeMin: 105,\n    rangeMax: 155,\n    decayRate: 0.7,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle from nasion to nose tip to chin',\n    profileType: 'side',\n  },\n\n  nasalTipAngle: {\n    id: 'nasalTipAngle',\n    name: 'Nasal Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 105,\n    rangeMin: 70,\n    rangeMax: 120,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the nose tip',\n    profileType: 'side',\n  },\n\n  nasalProjection: {\n    id: 'nasalProjection',\n    name: 'Nasal Projection',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.55,\n    idealMax: 0.6,\n    rangeMin: 0.4,\n    rangeMax: 0.75,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose projection relative to nasal length (Goode ratio)',\n    profileType: 'side',\n  },\n\n  nasalWToHRatio: {\n    id: 'nasalWToHRatio',\n    name: 'Nasal W to H Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.67,\n    idealMax: 0.78,\n    rangeMin: 0.5,\n    rangeMax: 0.95,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Nose width to height ratio from side view',\n    profileType: 'side',\n  },\n\n  noseTipRotationAngle: {\n    id: 'noseTipRotationAngle',\n    name: 'Nose Tip Rotation Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 95,\n    idealMax: 110,\n    rangeMin: 80,\n    rangeMax: 125,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of nose tip rotation',\n    profileType: 'side',\n  },\n\n  frankfortTipAngle: {\n    id: 'frankfortTipAngle',\n    name: 'Frankfort-Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 28,\n    idealMax: 34,\n    rangeMin: 20,\n    rangeMax: 42,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle between Frankfort plane and nose tip',\n    profileType: 'side',\n  },\n\n  mentolabialAngle: {\n    id: 'mentolabialAngle',\n    name: 'Mentolabial Angle',\n    category: 'Lips',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 140,\n    rangeMin: 100,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the labiomental fold',\n    profileType: 'side',\n  },\n\n  zAngle: {\n    id: 'zAngle',\n    name: 'Z Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 75,\n    idealMax: 85,\n    rangeMin: 60,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Merrifield Z-Angle for profile assessment',\n    profileType: 'side',\n  },\n\n  submentalCervicalAngle: {\n    id: 'submentalCervicalAngle',\n    name: 'Submental Cervical Angle',\n    category: 'Neck',\n    unit: 'degrees',\n    idealMin: 94,\n    idealMax: 106,\n    rangeMin: 70,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between chin and neck',\n    profileType: 'side',\n  },\n\n  facialConvexityGlabella: {\n    id: 'facialConvexityGlabella',\n    name: 'Facial Convexity (Glabella)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 165,\n    idealMax: 175,\n    rangeMin: 150,\n    rangeMax: 185,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Facial convexity angle using glabella',\n    profileType: 'side',\n  },\n\n  facialConvexityNasion: {\n    id: 'facialConvexityNasion',\n    name: 'Facial Convexity (Nasion)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 168,\n    idealMax: 178,\n    rangeMin: 155,\n    rangeMax: 190,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial convexity angle using nasion',\n    profileType: 'side',\n  },\n\n  totalFacialConvexity: {\n    id: 'totalFacialConvexity',\n    name: 'Total Facial Convexity',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 135,\n    idealMax: 145,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Complete facial profile convexity measurement',\n    profileType: 'side',\n  },\n\n  facialDepthToHeight: {\n    id: 'facialDepthToHeight',\n    name: 'Facial Depth to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.3,\n    idealMax: 1.44,\n    rangeMin: 0.7,\n    rangeMax: 1.8,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial depth divided by facial height',\n    profileType: 'side',\n  },\n\n  anteriorFacialDepth: {\n    id: 'anteriorFacialDepth',\n    name: 'Anterior Facial Depth',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 64.5,\n    idealMax: 67.5,\n    rangeMin: 45,\n    rangeMax: 95,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Anterior facial projection angle',\n    profileType: 'side',\n  },\n\n  interiorMidfaceProjectionAngle: {\n    id: 'interiorMidfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 50,\n    idealMax: 56,\n    rangeMin: 30,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Interior midface projection from side profile',\n    profileType: 'side',\n  },\n\n  recessionFromFrankfort: {\n    id: 'recessionFromFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'mm',\n    idealMin: 1.5,\n    idealMax: 15,\n    rangeMin: -30,\n    rangeMax: 30,\n    decayRate: 0.3,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin position relative to Frankfort plane',\n    profileType: 'side',\n  },\n\n  mandibularPlaneAngle: {\n    id: 'mandibularPlaneAngle',\n    name: 'Mandibular Plane Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 22,\n    idealMax: 28,\n    rangeMin: 15,\n    rangeMax: 38,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of mandibular plane to Frankfort plane',\n    profileType: 'side',\n  },\n\n  ramusToMandibleRatio: {\n    id: 'ramusToMandibleRatio',\n    name: 'Ramus to Mandible Ratio',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'ratio',\n    idealMin: 0.65,\n    idealMax: 0.75,\n    rangeMin: 0.5,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Ramus height divided by mandible length',\n    profileType: 'side',\n  },\n\n  gonionToMouthLine: {\n    id: 'gonionToMouthLine',\n    name: 'Gonion to Mouth Line',\n    category: 'Jaw Shape',\n    unit: 'mm',\n    idealMin: -5,\n    idealMax: 5,\n    rangeMin: -20,\n    rangeMax: 20,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from gonion to mouth level line',\n    profileType: 'side',\n  },\n\n  // E-LINE MEASUREMENTS\n  eLineUpperLip: {\n    id: 'eLineUpperLip',\n    name: 'Upper Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -4,\n    idealMax: -2,\n    rangeMin: -10,\n    rangeMax: 4,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Upper lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  eLineLowerLip: {\n    id: 'eLineLowerLip',\n    name: 'Lower Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 0,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Lower lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  // S-LINE MEASUREMENTS\n  sLineUpperLip: {\n    id: 'sLineUpperLip',\n    name: 'Upper Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 3,\n    rangeMin: -5,\n    rangeMax: 8,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  sLineLowerLip: {\n    id: 'sLineLowerLip',\n    name: 'Lower Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -0.4,\n    idealMax: 0.4,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  // BURSTONE LINE\n  burstoneUpperLip: {\n    id: 'burstoneUpperLip',\n    name: 'Upper Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2,\n    idealMax: 4,\n    rangeMin: -2,\n    rangeMax: 8,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  burstoneLowerLip: {\n    id: 'burstoneLowerLip',\n    name: 'Lower Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 1,\n    idealMax: 3,\n    rangeMin: -3,\n    rangeMax: 7,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  // H LINE\n  holdawayHLine: {\n    id: 'holdawayHLine',\n    name: 'Holdaway H Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Holdaway H-line soft tissue assessment',\n    profileType: 'side',\n  },\n\n  // CHIN MEASUREMENTS (SIDE)\n  chinProjection: {\n    id: 'chinProjection',\n    name: 'Chin Projection',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -3,\n    idealMax: 3,\n    rangeMin: -12,\n    rangeMax: 12,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin projection relative to ideal position',\n    profileType: 'side',\n  },\n\n  recessionRelativeToFrankfort: {\n    id: 'recessionRelativeToFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 2,\n    rangeMin: -10,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin recession relative to Frankfort horizontal',\n    profileType: 'side',\n  },\n\n  // FOREHEAD\n  browridgeInclinationAngle: {\n    id: 'browridgeInclinationAngle',\n    name: 'Browridge Inclination Angle',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 18,\n    rangeMin: 0,\n    rangeMax: 28,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the brow ridge from profile',\n    profileType: 'side',\n  },\n\n  upperForeheadSlope: {\n    id: 'upperForeheadSlope',\n    name: 'Upper Forehead Slope',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 5,\n    idealMax: 12,\n    rangeMin: 0,\n    rangeMax: 20,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Slope angle of the upper forehead',\n    profileType: 'side',\n  },\n\n  // MIDFACE PROJECTION\n  midfaceProjectionAngle: {\n    id: 'midfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 95,\n    rangeMin: 75,\n    rangeMax: 105,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of midface projection from profile',\n    profileType: 'side',\n  },\n\n  orbitalVector: {\n    id: 'orbitalVector',\n    name: 'Orbital Vector',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -6,\n    rangeMax: 10,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Relationship of globe to orbital rim',\n    profileType: 'side',\n  },\n\n  skinUniformity: {\n    id: 'skinUniformity',\n    name: 'Skin Uniformity',\n    category: 'Skin Quality',\n    unit: 'ratio',\n    idealMin: 0.90,\n    idealMax: 1.00,\n    rangeMin: 0.50,\n    rangeMax: 1.00,\n    decayRate: 5.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Skin tone evenness and hyperpigmentation. 1.0 = perfectly uniform.',\n    profileType: 'front',\n    polarity: 'higher_is_better',\n    safeFloor: 0.85,  // Acceptable uniformity threshold\n    softZoneScore: 7.5,\n  },\n\n};\n\n// ============================================\n// FLAW MAPPINGS (Extracted from FaceIQ)\n// ============================================\n\nexport interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n  reasoning: string;\n}\n\nexport const METRIC_FLAW_MAPPINGS: Record<string, FlawMapping[]> = {\n  anteriorFacialDepth: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Anterior Facial Depth measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  bitemporalWidth: [\n    { category: 'Upper Third', flawName: 'Narrow forehead', confidence: 'confirmed', reasoning: 'Reduced bitemporal width indicates a narrower than ideal forehead relative to the cheekbones. This disrupts facial harmony by creating a compressed hairline and forehead, altering the overall shape of the face.' },\n  ],\n  cheekboneHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Low-set cheekbones', confidence: 'confirmed', reasoning: 'Reduced cheekbone height indicates that the cheekbones are positioned lower than ideal. This disrupts facial harmony by creating an unpronounced appearance to the cheekbones and facial structure.' },\n  ],\n  eyeAspectRatio: [\n    { category: 'Eyes', flawName: 'Overly round eye shape', confidence: 'confirmed', reasoning: 'A reduced eye aspect ratio indicates overly narrow eyes relative to their height. This disrupts facial harmony by creating an overly surprised appearance and reducing angular definition.' },\n  ],\n  eyeSeparationRatio: [\n    { category: 'Eyes', flawName: 'Close-set eyes', confidence: 'confirmed', reasoning: 'Reduced eye separation indicates close-set eyes. This disrupts facial harmony by making the eye area appear too compressed.' },\n  ],\n  eyebrowLowSetedness: [\n    { category: 'Eyes', flawName: 'Medium-set eyebrows', confidence: 'confirmed', reasoning: 'Increased eyebrow low setedness indicates eyebrows that are positioned higher than ideal. This disrupts facial harmony by reducing the overall visual impact of the eyebrows and framing of the eyes.' },\n  ],\n  faceWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced face width to height ratio indicates an overly long midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  facialDepthToHeight: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'Reduced facial depth to height ratio indicates insufficient mid-face projection relative to height. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  gonialAngle: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  holdawayHLine: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'Decreased H-line indicates the lips are positioned too far in front of the line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  interiorMidfaceProjectionAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Interior Midface Projection Angle measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  ipsilateralAlarAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A decreased ipsilateral alar angle indicates an overly narrow interior midface. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  jawFrontalAngle: [\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A narrower jaw frontal angle indicates a steeper jawline or overly wide chin. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  jawSlope: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'The Jaw Slope measurement is above the ideal range. This disrupts facial harmony in the lower face.' },\n  ],\n  lateralCanthalTilt: [\n    { category: 'Eyes', flawName: 'Insufficient eye tilt', confidence: 'confirmed', reasoning: 'A decreased lateral canthal tilt indicates insufficiently upturned eyes. This disrupts facial harmony by creating a less alert and youthful appearance.' },\n  ],\n  burstoneLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the Burstone line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  eLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned too far in front of the E-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  sLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the S-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  lowerThirdProportion: [\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'The upper jaw is too long relative to lower jaw, possibly from a long upper jaw or short lower jaw, or a combination of both. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  mandibularPlaneAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Hyper-divergent jaw growth', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by elongating the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  midfaceRatio: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  nasofacialAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A smaller nasofacial angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  nasofrontalAngle: [\n    { category: 'Upper Third', flawName: 'Soft and weak brow ridge', confidence: 'confirmed', reasoning: 'An increased nasofrontal angle indicates reduced brow ridge prominence and angularity. This disrupts facial harmony by creating a less defined upper face.' },\n  ],\n  nasomentaAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A larger nasomental angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  noseBridgeWidth: [\n    { category: 'Nose', flawName: 'Overly narrow nose bridge', confidence: 'confirmed', reasoning: 'The Nose Bridge to Nose Width measurement is above the ideal range. This disrupts facial harmony by creating an unbalanced nasal profile.' },\n  ],\n  orbitalVector: [\n    { category: 'Eyes', flawName: 'Sunken orbital region', confidence: 'confirmed', reasoning: 'A decreased orbital vector indicates insufficient projection and volume underneath the eye. This disrupts facial harmony due to the lacking volume underneath the eyes, reducing vibrancy and youthfulness.' },\n  ],\n  ramusToMandibleRatio: [\n    { category: 'Jaw Shape', flawName: 'Short ramus', confidence: 'confirmed', reasoning: 'A reduced ramus-to-mandible ratio indicates a shorter than ideal vertical jawbone (ramus) when compared to the mandible. This disrupts facial harmony by reducing jaw height and definition.' },\n  ],\n  submentalCervicalAngle: [\n    { category: 'Neck', flawName: 'Round neck region', confidence: 'confirmed', reasoning: 'An increased submental cervical angle indicates a round neck region, possibly from excess submental fat or tissue. This disrupts facial harmony by reducing neck definition.' },\n  ],\n  totalFacialWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Overly long face shape', confidence: 'confirmed', reasoning: 'An increased total facial width to height ratio indicates an overly long face relative to its height. This disrupts facial harmony by creating a vertically stretched appearance to the face.' },\n  ],\n};\n\n// ============================================\n// CUSTOM BEZIER CURVES (Extracted from FaceIQ)\n// ============================================\n\nexport const METRIC_CUSTOM_CURVES: Record<string, CurvePoint[]> = {\n  faceWidthToHeight: [\n    { x: 1.49, y: 0, leftHandleX: 1.44, leftHandleY: 0, rightHandleX: 1.55, rightHandleY: 0 },\n    { x: 1.68, y: 1.05, leftHandleX: 1.62, leftHandleY: 0.36, rightHandleX: 1.71, rightHandleY: 1.58 },\n    { x: 1.77, y: 3.07, leftHandleX: 1.74, leftHandleY: 2.15, rightHandleX: 1.79, rightHandleY: 3.88 },\n    { x: 1.83, y: 5.83, leftHandleX: 1.80, leftHandleY: 4.64, rightHandleX: 1.84, rightHandleY: 6.85 },\n    { x: 1.89, y: 8.70, leftHandleX: 1.88, leftHandleY: 8.30, rightHandleX: 1.92, rightHandleY: 9.50 },\n    { x: 1.96, y: 10, leftHandleX: 1.96, leftHandleY: 10, rightHandleX: 1.96, rightHandleY: 10, fixed: true },\n    { x: 2.00, y: 10, leftHandleX: 2.00, leftHandleY: 10, rightHandleX: 2.00, rightHandleY: 10, fixed: true },\n    { x: 2.07, y: 8.70, leftHandleX: 2.04, leftHandleY: 9.50, rightHandleX: 2.08, rightHandleY: 8.30 },\n    { x: 2.13, y: 5.83, leftHandleX: 2.12, leftHandleY: 6.85, rightHandleX: 2.16, rightHandleY: 4.64 },\n    { x: 2.19, y: 3.07, leftHandleX: 2.17, leftHandleY: 3.88, rightHandleX: 2.22, rightHandleY: 2.15 },\n    { x: 2.28, y: 1.05, leftHandleX: 2.25, leftHandleY: 1.58, rightHandleX: 2.34, rightHandleY: 0.36 },\n    { x: 2.47, y: 0, leftHandleX: 2.41, leftHandleY: 0, rightHandleX: 2.52, rightHandleY: 0 },\n  ],\n  lowerThirdProportion: [\n    { x: 25.6, y: 0, leftHandleX: 24.8, leftHandleY: 0, rightHandleX: 26.4, rightHandleY: 0 },\n    { x: 28.01, y: 1.58, leftHandleX: 27.23, leftHandleY: 0.53, rightHandleX: 28.27, rightHandleY: 1.97 },\n    { x: 28.83, y: 3.21, leftHandleX: 28.60, leftHandleY: 2.60, rightHandleX: 29.10, rightHandleY: 3.90 },\n    { x: 29.63, y: 5.85, leftHandleX: 29.40, leftHandleY: 4.90, rightHandleX: 29.85, rightHandleY: 6.80 },\n    { x: 30.27, y: 8.56, leftHandleX: 30.05, leftHandleY: 7.80, rightHandleX: 30.50, rightHandleY: 9.30 },\n    { x: 31, y: 10, leftHandleX: 30.95, leftHandleY: 10, rightHandleX: 31.05, rightHandleY: 10, fixed: true },\n    { x: 33.5, y: 10, leftHandleX: 33.45, leftHandleY: 10, rightHandleX: 33.55, rightHandleY: 10, fixed: true },\n    { x: 34.23, y: 8.56, leftHandleX: 34.00, leftHandleY: 9.30, rightHandleX: 34.45, rightHandleY: 7.80 },\n    { x: 34.87, y: 5.85, leftHandleX: 34.65, leftHandleY: 6.80, rightHandleX: 35.10, rightHandleY: 4.90 },\n    { x: 35.67, y: 3.21, leftHandleX: 35.40, leftHandleY: 3.90, rightHandleX: 35.90, rightHandleY: 2.60 },\n    { x: 36.49, y: 1.58, leftHandleX: 36.23, leftHandleY: 1.97, rightHandleX: 37.27, rightHandleY: 0.53 },\n    { x: 38.9, y: 0, leftHandleX: 38.1, leftHandleY: 0, rightHandleX: 39.7, rightHandleY: 0 },\n  ],\n  lateralCanthalTilt: [\n    { x: -4.5, y: 0, leftHandleX: -5.5, leftHandleY: 0, rightHandleX: -3.5, rightHandleY: 0 },\n    { x: 0.5, y: 1.2, leftHandleX: -0.8, leftHandleY: 0.4, rightHandleX: 1.5, rightHandleY: 1.8 },\n    { x: 2.8, y: 3.5, leftHandleX: 2.2, leftHandleY: 2.5, rightHandleX: 3.4, rightHandleY: 4.3 },\n    { x: 4.5, y: 6.8, leftHandleX: 4.0, leftHandleY: 5.5, rightHandleX: 5.0, rightHandleY: 7.8 },\n    { x: 5.8, y: 9.2, leftHandleX: 5.4, leftHandleY: 8.5, rightHandleX: 5.95, rightHandleY: 9.7 },\n    { x: 6.1, y: 10, leftHandleX: 6.05, leftHandleY: 10, rightHandleX: 6.15, rightHandleY: 10, fixed: true },\n    { x: 7.8, y: 10, leftHandleX: 7.75, leftHandleY: 10, rightHandleX: 7.85, rightHandleY: 10, fixed: true },\n    { x: 8.1, y: 9.2, leftHandleX: 7.95, leftHandleY: 9.7, rightHandleX: 8.5, rightHandleY: 8.5 },\n    { x: 9.4, y: 6.8, leftHandleX: 8.9, leftHandleY: 7.8, rightHandleX: 9.9, rightHandleY: 5.5 },\n    { x: 11.1, y: 3.5, leftHandleX: 10.5, leftHandleY: 4.3, rightHandleX: 11.7, rightHandleY: 2.5 },\n    { x: 13.4, y: 1.2, leftHandleX: 12.4, leftHandleY: 1.8, rightHandleX: 14.7, rightHandleY: 0.4 },\n    { x: 18.4, y: 0, leftHandleX: 17.4, leftHandleY: 0, rightHandleX: 19.4, rightHandleY: 0 },\n  ],\n  gonialAngle: [\n    { x: 105, y: 0, leftHandleX: 102, leftHandleY: 0, rightHandleX: 108, rightHandleY: 0 },\n    { x: 112, y: 1.5, leftHandleX: 110, leftHandleY: 0.5, rightHandleX: 114, rightHandleY: 2.3 },\n    { x: 116, y: 4.2, leftHandleX: 114.5, leftHandleY: 3.0, rightHandleX: 117.5, rightHandleY: 5.2 },\n    { x: 118.5, y: 7.5, leftHandleX: 117.5, leftHandleY: 6.3, rightHandleX: 119.5, rightHandleY: 8.5 },\n    { x: 120, y: 10, leftHandleX: 119.7, leftHandleY: 10, rightHandleX: 120.3, rightHandleY: 10, fixed: true },\n    { x: 130, y: 10, leftHandleX: 129.7, leftHandleY: 10, rightHandleX: 130.3, rightHandleY: 10, fixed: true },\n    { x: 131.5, y: 7.5, leftHandleX: 130.5, leftHandleY: 8.5, rightHandleX: 132.5, rightHandleY: 6.3 },\n    { x: 134, y: 4.2, leftHandleX: 132.5, leftHandleY: 5.2, rightHandleX: 135.5, rightHandleY: 3.0 },\n    { x: 138, y: 1.5, leftHandleX: 136, leftHandleY: 2.3, rightHandleX: 140, rightHandleY: 0.5 },\n    { x: 145, y: 0, leftHandleX: 142, leftHandleY: 0, rightHandleX: 148, rightHandleY: 0 },\n  ],\n  nasolabialAngle: [\n    { x: 75, y: 0, leftHandleX: 72, leftHandleY: 0, rightHandleX: 78, rightHandleY: 0 },\n    { x: 82, y: 2.0, leftHandleX: 79.5, leftHandleY: 0.7, rightHandleX: 84, rightHandleY: 3.0 },\n    { x: 86, y: 5.5, leftHandleX: 84.5, leftHandleY: 4.2, rightHandleX: 87.5, rightHandleY: 6.8 },\n    { x: 89, y: 8.8, leftHandleX: 88, leftHandleY: 7.8, rightHandleX: 89.7, rightHandleY: 9.5 },\n    { x: 90, y: 10, leftHandleX: 89.8, leftHandleY: 10, rightHandleX: 90.2, rightHandleY: 10, fixed: true },\n    { x: 105, y: 10, leftHandleX: 104.8, leftHandleY: 10, rightHandleX: 105.2, rightHandleY: 10, fixed: true },\n    { x: 106, y: 8.8, leftHandleX: 105.3, leftHandleY: 9.5, rightHandleX: 107, rightHandleY: 7.8 },\n    { x: 109, y: 5.5, leftHandleX: 107.5, leftHandleY: 6.8, rightHandleX: 110.5, rightHandleY: 4.2 },\n    { x: 113, y: 2.0, leftHandleX: 111, leftHandleY: 3.0, rightHandleX: 115.5, rightHandleY: 0.7 },\n    { x: 120, y: 0, leftHandleX: 117, leftHandleY: 0, rightHandleX: 123, rightHandleY: 0 },\n  ],\n  // Middle Third Proportion curve (ideal: 31.4-33.4%)\n  middleThirdProportion: [\n    { x: 21.44, y: 0, leftHandleX: 20.29, leftHandleY: 0, rightHandleX: 23.19, rightHandleY: 0.15 },\n    { x: 25.5, y: 1.35, leftHandleX: 24.18, leftHandleY: 0.53, rightHandleX: 26.17, rightHandleY: 1.79 },\n    { x: 27.34, y: 3.18, leftHandleX: 26.84, leftHandleY: 2.42, rightHandleX: 27.73, rightHandleY: 3.81 },\n    { x: 28.65, y: 5.88, leftHandleX: 28.33, leftHandleY: 4.91, rightHandleX: 28.98, rightHandleY: 6.65 },\n    { x: 29.95, y: 8.55, leftHandleX: 29.41, leftHandleY: 7.58, rightHandleX: 30.45, rightHandleY: 9.35 },\n    { x: 31.4, y: 10, leftHandleX: 31.3, leftHandleY: 10, rightHandleX: 31.5, rightHandleY: 10, fixed: true },\n    { x: 33.4, y: 10, leftHandleX: 33.3, leftHandleY: 10, rightHandleX: 33.5, rightHandleY: 10, fixed: true },\n    { x: 34.85, y: 8.55, leftHandleX: 34.35, leftHandleY: 9.35, rightHandleX: 35.39, rightHandleY: 7.58 },\n    { x: 36.15, y: 5.88, leftHandleX: 35.82, leftHandleY: 6.65, rightHandleX: 36.47, rightHandleY: 4.91 },\n    { x: 37.46, y: 3.18, leftHandleX: 37.07, leftHandleY: 3.81, rightHandleX: 37.96, rightHandleY: 2.42 },\n    { x: 39.3, y: 1.35, leftHandleX: 38.63, leftHandleY: 1.79, rightHandleX: 40.62, rightHandleY: 0.53 },\n    { x: 43.36, y: 0, leftHandleX: 41.61, leftHandleY: 0.15, rightHandleX: 44.51, rightHandleY: 0 },\n  ],\n  // Upper Third Proportion curve (ideal: 30-32%)\n  upperThirdProportion: [\n    { x: 18.75, y: 0.02, leftHandleX: 17.15, leftHandleY: 0.02, rightHandleX: 20.35, rightHandleY: 0.02 },\n    { x: 23.82, y: 1.52, leftHandleX: 22.35, leftHandleY: 0.8, rightHandleX: 24.73, rightHandleY: 2.06 },\n    { x: 26.05, y: 4.06, leftHandleX: 25.48, leftHandleY: 2.86, rightHandleX: 26.41, rightHandleY: 4.99 },\n    { x: 27.19, y: 6.79, leftHandleX: 26.96, leftHandleY: 6.16, rightHandleX: 27.66, rightHandleY: 7.85 },\n    { x: 28.54, y: 9.08, leftHandleX: 28.02, leftHandleY: 8.5, rightHandleX: 28.93, rightHandleY: 9.54 },\n    { x: 30, y: 10, leftHandleX: 29.9, leftHandleY: 10, rightHandleX: 30.1, rightHandleY: 10, fixed: true },\n    { x: 32, y: 10, leftHandleX: 31.9, leftHandleY: 10, rightHandleX: 32.1, rightHandleY: 10, fixed: true },\n    { x: 33.46, y: 9.08, leftHandleX: 33.07, leftHandleY: 9.54, rightHandleX: 33.98, rightHandleY: 8.5 },\n    { x: 34.81, y: 6.79, leftHandleX: 34.34, leftHandleY: 7.85, rightHandleX: 35.04, rightHandleY: 6.16 },\n    { x: 35.95, y: 4.06, leftHandleX: 35.59, leftHandleY: 4.99, rightHandleX: 36.52, rightHandleY: 2.86 },\n    { x: 38.18, y: 1.52, leftHandleX: 37.27, leftHandleY: 2.06, rightHandleX: 39.65, rightHandleY: 0.8 },\n    { x: 43.25, y: 0.02, leftHandleX: 41.65, leftHandleY: 0.02, rightHandleX: 44.85, rightHandleY: 0.02 },\n  ],\n  // Eye Separation Ratio curve (ideal: 45.7-46.8%)\n  eyeSeparationRatio: [\n    { x: 36.54, y: 0, leftHandleX: 35.44, leftHandleY: 0, rightHandleX: 37.40, rightHandleY: 0.04 },\n    { x: 39.04, y: 0.63, leftHandleX: 38.16, leftHandleY: 0.21, rightHandleX: 39.77, rightHandleY: 1.05 },\n    { x: 41.08, y: 2.17, leftHandleX: 40.57, leftHandleY: 1.71, rightHandleX: 41.62, rightHandleY: 2.76 },\n    { x: 42.71, y: 4.74, leftHandleX: 42.26, leftHandleY: 3.81, rightHandleX: 43.08, rightHandleY: 5.52 },\n    { x: 43.94, y: 7.37, leftHandleX: 43.65, leftHandleY: 6.79, rightHandleX: 44.17, rightHandleY: 7.77 },\n    { x: 44.86, y: 9.02, leftHandleX: 44.54, leftHandleY: 8.56, rightHandleX: 45.08, rightHandleY: 9.5 },\n    { x: 45.7, y: 10, leftHandleX: 45.65, leftHandleY: 10, rightHandleX: 45.76, rightHandleY: 10, fixed: true },\n    { x: 46.8, y: 10, leftHandleX: 46.75, leftHandleY: 10, rightHandleX: 46.86, rightHandleY: 10, fixed: true },\n    { x: 47.64, y: 9.02, leftHandleX: 47.42, leftHandleY: 9.5, rightHandleX: 47.96, rightHandleY: 8.56 },\n    { x: 48.56, y: 7.37, leftHandleX: 48.33, leftHandleY: 7.77, rightHandleX: 48.85, rightHandleY: 6.79 },\n    { x: 49.79, y: 4.74, leftHandleX: 49.42, leftHandleY: 5.52, rightHandleX: 50.24, rightHandleY: 3.81 },\n    { x: 51.42, y: 2.17, leftHandleX: 50.88, leftHandleY: 2.76, rightHandleX: 51.93, rightHandleY: 1.71 },\n    { x: 53.46, y: 0.63, leftHandleX: 52.73, leftHandleY: 1.05, rightHandleX: 54.34, rightHandleY: 0.21 },\n    { x: 55.96, y: 0, leftHandleX: 55.10, leftHandleY: 0.04, rightHandleX: 57.06, rightHandleY: 0 },\n  ],\n  // Eyebrow Low Setedness curve (ideal: 0-0.45)\n  eyebrowLowSetedness: [\n    { x: -2.78, y: 0, leftHandleX: -3.11, leftHandleY: 0, rightHandleX: -2.67, rightHandleY: 0 },\n    { x: -1.94, y: 0.4, leftHandleX: -2.08, leftHandleY: 0.11, rightHandleX: -1.81, rightHandleY: 0.57 },\n    { x: -1.18, y: 2.25, leftHandleX: -1.36, leftHandleY: 1.5, rightHandleX: -1.05, rightHandleY: 2.72 },\n    { x: -0.79, y: 4.06, leftHandleX: -0.88, leftHandleY: 3.43, rightHandleX: -0.68, rightHandleY: 4.84 },\n    { x: -0.55, y: 6.21, leftHandleX: -0.58, leftHandleY: 5.55, rightHandleX: -0.47, rightHandleY: 6.92 },\n    { x: -0.28, y: 8.76, leftHandleX: -0.37, leftHandleY: 8.23, rightHandleX: -0.23, rightHandleY: 9.22 },\n    { x: 0, y: 10, leftHandleX: -0.02, leftHandleY: 10, rightHandleX: 0.02, rightHandleY: 10, fixed: true },\n    { x: 0.45, y: 10, leftHandleX: 0.43, leftHandleY: 10, rightHandleX: 0.47, rightHandleY: 10, fixed: true },\n    { x: 0.73, y: 8.76, leftHandleX: 0.68, leftHandleY: 9.22, rightHandleX: 0.82, rightHandleY: 8.23 },\n    { x: 1, y: 6.21, leftHandleX: 0.92, leftHandleY: 6.92, rightHandleX: 1.03, rightHandleY: 5.55 },\n    { x: 1.24, y: 4.06, leftHandleX: 1.13, leftHandleY: 4.84, rightHandleX: 1.33, rightHandleY: 3.43 },\n    { x: 1.63, y: 2.25, leftHandleX: 1.50, leftHandleY: 2.72, rightHandleX: 1.81, rightHandleY: 1.5 },\n    { x: 2.39, y: 0.4, leftHandleX: 2.26, leftHandleY: 0.57, rightHandleX: 2.53, rightHandleY: 0.11 },\n    { x: 3.23, y: 0, leftHandleX: 3.12, leftHandleY: 0, rightHandleX: 3.56, rightHandleY: 0 },\n  ],\n  // Submental Cervical Angle curve (ideal: 94-106Â°)\n  submentalCervicalAngle: [\n    { x: 50.48, y: 0, leftHandleX: 44.48, leftHandleY: 0, rightHandleX: 56.48, rightHandleY: 0 },\n    { x: 68.31, y: 1.31, leftHandleX: 62.07, leftHandleY: 0.32, rightHandleX: 72.89, rightHandleY: 2.13 },\n    { x: 77.76, y: 3.71, leftHandleX: 76.00, leftHandleY: 2.89, rightHandleX: 80.39, rightHandleY: 4.59 },\n    { x: 83.99, y: 6.53, leftHandleX: 82.63, leftHandleY: 5.85, rightHandleX: 85.16, rightHandleY: 7.12 },\n    { x: 88.28, y: 8.86, leftHandleX: 86.43, leftHandleY: 7.85, rightHandleX: 89.95, rightHandleY: 9.71 },\n    { x: 94, y: 10, leftHandleX: 93.4, leftHandleY: 10, rightHandleX: 94.6, rightHandleY: 10, fixed: true },\n    { x: 106, y: 10, leftHandleX: 105.4, leftHandleY: 10, rightHandleX: 106.6, rightHandleY: 10, fixed: true },\n    { x: 111.72, y: 8.86, leftHandleX: 110.05, leftHandleY: 9.71, rightHandleX: 113.57, rightHandleY: 7.85 },\n    { x: 116.01, y: 6.53, leftHandleX: 114.84, leftHandleY: 7.12, rightHandleX: 117.37, rightHandleY: 5.85 },\n    { x: 122.24, y: 3.71, leftHandleX: 119.61, leftHandleY: 4.59, rightHandleX: 124.00, rightHandleY: 2.89 },\n    { x: 131.69, y: 1.31, leftHandleX: 127.11, leftHandleY: 2.13, rightHandleX: 137.93, rightHandleY: 0.32 },\n    { x: 149.52, y: 0, leftHandleX: 143.52, leftHandleY: 0, rightHandleX: 155.52, rightHandleY: 0 },\n  ],\n  // Facial Convexity (Glabella) curve (ideal: 169-174Â°)\n  facialConvexityGlabella: [\n    { x: 149.21, y: 0, leftHandleX: 146.21, leftHandleY: 0, rightHandleX: 152.21, rightHandleY: 0 },\n    { x: 158.07, y: 1.41, leftHandleX: 156.03, leftHandleY: 0.74, rightHandleX: 159.63, rightHandleY: 2 },\n    { x: 162.12, y: 4.09, leftHandleX: 161.34, leftHandleY: 3.31, rightHandleX: 163.09, rightHandleY: 5.03 },\n    { x: 165.14, y: 7.76, leftHandleX: 164.46, leftHandleY: 6.56, rightHandleX: 165.54, rightHandleY: 8.29 },\n    { x: 166.65, y: 9.14, leftHandleX: 165.92, leftHandleY: 8.72, rightHandleX: 167.43, rightHandleY: 9.67 },\n    { x: 169, y: 10, leftHandleX: 168.75, leftHandleY: 10, rightHandleX: 169.25, rightHandleY: 10, fixed: true },\n    { x: 174, y: 10, leftHandleX: 173.75, leftHandleY: 10, rightHandleX: 174.25, rightHandleY: 10, fixed: true },\n    { x: 176.35, y: 9.14, leftHandleX: 175.57, leftHandleY: 9.67, rightHandleX: 177.08, rightHandleY: 8.72 },\n    { x: 177.86, y: 7.76, leftHandleX: 177.46, leftHandleY: 8.29, rightHandleX: 178.54, rightHandleY: 6.56 },\n    { x: 180.88, y: 4.09, leftHandleX: 179.91, leftHandleY: 5.03, rightHandleX: 181.66, rightHandleY: 3.31 },\n    { x: 184.93, y: 1.41, leftHandleX: 183.37, leftHandleY: 2, rightHandleX: 186.97, rightHandleY: 0.74 },\n    { x: 193.79, y: 0, leftHandleX: 190.79, leftHandleY: 0, rightHandleX: 196.79, rightHandleY: 0 },\n  ],\n};\n\n// ============================================\n// CATEGORY DEFINITIONS\n// ============================================\n\nexport const MEASUREMENT_CATEGORIES = {\n  'Midface/Face Shape': { color: '#67e8f9', weight: 0.20 },\n  'Occlusion/Jaw Growth': { color: '#a78bfa', weight: 0.15 },\n  'Jaw Shape': { color: '#f97316', weight: 0.13 },\n  'Upper Third': { color: '#84cc16', weight: 0.08 },\n  'Eyes': { color: '#06b6d4', weight: 0.12 },\n  'Nose': { color: '#fbbf24', weight: 0.10 },\n  'Lips': { color: '#ec4899', weight: 0.10 },\n  'Chin': { color: '#ef4444', weight: 0.06 },\n  'Neck': { color: '#14b8a6', weight: 0.03 },\n  'Other': { color: '#6b7280', weight: 0.03 },\n};\n\n// ============================================\n// CORE SCORING FUNCTIONS\n// ============================================\n\n/**\n * FaceIQ Exponential Decay Scoring Algorithm with Directional/Dimorphic Support\n *\n * Standard: score = maxScore Ã— e^(-decayRate Ã— deviation)\n *\n * Directional scoring (polarity):\n * - 'higher_is_better': Values above safeFloor but below ideal get softZoneScore\n *   Example: Canthal Tilt of 3Â° is still positive/good, just not peak ideal (6-8Â°)\n * - 'lower_is_better': Values below safeCeiling but above ideal get softZoneScore\n *   Example: Short philtrum is still attractive even if shorter than \"ideal\"\n */\nexport function calculateFaceIQScore(\n  value: number,\n  config: MetricConfig\n): number {\n  const {\n    idealMin,\n    idealMax,\n    decayRate,\n    maxScore,\n    customCurve,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n    softZoneScore = 8.0, // Default \"Good\" score for acceptable-but-not-ideal values\n  } = config;\n\n  // Use custom curve if available\n  if (customCurve && customCurve.mode === 'custom') {\n    return interpolateCustomCurve(value, customCurve.points, maxScore);\n  }\n\n  // Perfect score within ideal range\n  if (value >= idealMin && value <= idealMax) {\n    return maxScore;\n  }\n\n  // Handle directional/dimorphic scoring\n  if (polarity === 'higher_is_better' && safeFloor !== undefined) {\n    // Higher values are good. Only values below safeFloor are true weaknesses.\n    if (value >= safeFloor && value < idealMin) {\n      // Value is in the \"acceptable but not ideal\" zone\n      // Give a passing score that decreases linearly as we approach the floor\n      const zoneRange = idealMin - safeFloor;\n      const distanceFromIdeal = idealMin - value;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMin â†’ maxScore, safeFloor â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value >= idealMax) {\n      // Values above ideal are still excellent for 'higher_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = value - idealMax;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Below safeFloor - apply normal (or harsher) exponential decay\n    if (value < safeFloor) {\n      const deviation = safeFloor - value;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  if (polarity === 'lower_is_better' && safeCeiling !== undefined) {\n    // Lower values are good. Only values above safeCeiling are true weaknesses.\n    if (value <= safeCeiling && value > idealMax) {\n      // Value is in the \"acceptable but not ideal\" zone\n      const zoneRange = safeCeiling - idealMax;\n      const distanceFromIdeal = value - idealMax;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMax â†’ maxScore, safeCeiling â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value <= idealMin) {\n      // Values below ideal are still excellent for 'lower_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = idealMin - value;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Above safeCeiling - apply normal exponential decay\n    if (value > safeCeiling) {\n      const deviation = value - safeCeiling;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  // Default balanced scoring: deviation in either direction is equally bad\n  const deviation = value < idealMin\n    ? idealMin - value\n    : value - idealMax;\n\n  // Exponential decay\n  const score = maxScore * Math.exp(-decayRate * deviation);\n\n  return Math.max(0, Math.min(maxScore, score));\n}\n\n/**\n * Check if a metric value is in an \"acceptable\" zone (not a true weakness).\n * Used by InsightsEngine to prevent false positives.\n */\nexport function isValueAcceptable(\n  value: number,\n  config: MetricConfig\n): { acceptable: boolean; reason: string } {\n  const {\n    idealMin,\n    idealMax,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n  } = config;\n\n  // Within ideal range is always acceptable\n  if (value >= idealMin && value <= idealMax) {\n    return { acceptable: true, reason: 'within_ideal' };\n  }\n\n  // Check directional acceptability\n  if (polarity === 'higher_is_better') {\n    if (value >= idealMax) {\n      return { acceptable: true, reason: 'above_ideal_higher_is_better' };\n    }\n    if (safeFloor !== undefined && value >= safeFloor) {\n      return { acceptable: true, reason: 'above_safe_floor' };\n    }\n    // Below safe floor - true weakness\n    return { acceptable: false, reason: 'below_safe_floor' };\n  }\n\n  if (polarity === 'lower_is_better') {\n    if (value <= idealMin) {\n      return { acceptable: true, reason: 'below_ideal_lower_is_better' };\n    }\n    if (safeCeiling !== undefined && value <= safeCeiling) {\n      return { acceptable: true, reason: 'below_safe_ceiling' };\n    }\n    // Above safe ceiling - true weakness\n    return { acceptable: false, reason: 'above_safe_ceiling' };\n  }\n\n  // Balanced polarity - outside ideal is not acceptable\n  return { acceptable: false, reason: 'outside_ideal_balanced' };\n}\n\n/**\n * Interpolate custom Bezier curve for scoring\n * Uses cubic Bezier interpolation with control handles for smooth curves\n */\nfunction interpolateCustomCurve(\n  value: number,\n  points: CurvePoint[],\n  maxScore: number\n): number {\n  void maxScore; // Reserved for future custom curve implementations\n  if (points.length === 0) return 0;\n\n  // Sort points by x value\n  const sortedPoints = [...points].sort((a, b) => a.x - b.x);\n\n  // Clamp to range\n  if (value <= sortedPoints[0].x) return sortedPoints[0].y;\n  if (value >= sortedPoints[sortedPoints.length - 1].x) {\n    return sortedPoints[sortedPoints.length - 1].y;\n  }\n\n  // Find bracketing points\n  let lowerIndex = 0;\n  for (let i = 0; i < sortedPoints.length - 1; i++) {\n    if (value >= sortedPoints[i].x && value <= sortedPoints[i + 1].x) {\n      lowerIndex = i;\n      break;\n    }\n  }\n\n  const p0 = sortedPoints[lowerIndex];\n  const p3 = sortedPoints[lowerIndex + 1];\n\n  // Check if we have Bezier control handles\n  const hasHandles = p0.rightHandleX !== undefined && p3.leftHandleX !== undefined;\n\n  if (hasHandles) {\n    // Cubic Bezier interpolation with control points\n    const p1x = p0.rightHandleX!;\n    const p1y = p0.rightHandleY ?? p0.y;\n    const p2x = p3.leftHandleX!;\n    const p2y = p3.leftHandleY ?? p3.y;\n\n    // Find t parameter for given x value using Newton-Raphson iteration\n    let t = (value - p0.x) / (p3.x - p0.x); // Initial guess\n\n    // Newton-Raphson iterations to find t where B_x(t) = value\n    for (let iter = 0; iter < 10; iter++) {\n      const bx = cubicBezier(p0.x, p1x, p2x, p3.x, t);\n      const bxDerivative = cubicBezierDerivative(p0.x, p1x, p2x, p3.x, t);\n\n      if (Math.abs(bxDerivative) < 1e-10) break;\n\n      const newT = t - (bx - value) / bxDerivative;\n      if (Math.abs(newT - t) < 1e-10) break;\n      t = Math.max(0, Math.min(1, newT));\n    }\n\n    // Calculate y using the found t parameter\n    return cubicBezier(p0.y, p1y, p2y, p3.y, t);\n  } else {\n    // Smooth interpolation using Catmull-Rom spline\n    // This provides smoother curves than linear interpolation\n    const t = (value - p0.x) / (p3.x - p0.x);\n\n    // Get neighboring points for spline calculation\n    const pMinus1 = lowerIndex > 0 ? sortedPoints[lowerIndex - 1] : p0;\n    const p4 = lowerIndex + 2 < sortedPoints.length ? sortedPoints[lowerIndex + 2] : p3;\n\n    // Catmull-Rom spline interpolation\n    return catmullRomSpline(pMinus1.y, p0.y, p3.y, p4.y, t);\n  }\n}\n\n/**\n * Cubic Bezier curve evaluation: B(t) = (1-t)Â³P0 + 3(1-t)Â²tP1 + 3(1-t)tÂ²P2 + tÂ³P3\n */\nfunction cubicBezier(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  const mt2 = mt * mt;\n  const mt3 = mt2 * mt;\n  const t2 = t * t;\n  const t3 = t2 * t;\n  return mt3 * p0 + 3 * mt2 * t * p1 + 3 * mt * t2 * p2 + t3 * p3;\n}\n\n/**\n * Cubic Bezier derivative: B'(t) = 3(1-t)Â²(P1-P0) + 6(1-t)t(P2-P1) + 3tÂ²(P3-P2)\n */\nfunction cubicBezierDerivative(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  return 3 * mt * mt * (p1 - p0) + 6 * mt * t * (p2 - p1) + 3 * t * t * (p3 - p2);\n}\n\n/**\n * Catmull-Rom spline interpolation for smooth curves without explicit handles\n */\nfunction catmullRomSpline(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const t2 = t * t;\n  const t3 = t2 * t;\n\n  // Catmull-Rom coefficients with tension = 0.5\n  const a = -0.5 * p0 + 1.5 * p1 - 1.5 * p2 + 0.5 * p3;\n  const b = p0 - 2.5 * p1 + 2 * p2 - 0.5 * p3;\n  const c = -0.5 * p0 + 0.5 * p2;\n  const d = p1;\n\n  return a * t3 + b * t2 + c * t + d;\n}\n\n/**\n * Calculate standardized score (0-10 normalized)\n */\nexport function standardizeScore(score: number, maxScore: number): number {\n  return (score / maxScore) * 10;\n}\n\n/**\n * Determine quality tier based on score\n */\nexport function getQualityTier(score: number, maxScore: number = 10): QualityTier {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 90) return 'ideal';\n  if (normalized >= 70) return 'excellent';\n  if (normalized >= 50) return 'good';\n  return 'below_average';\n}\n\n/**\n * Determine severity level based on score\n */\nexport function getSeverityLevel(score: number, maxScore: number = 10): SeverityLevel {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 85) return 'optimal';\n  if (normalized >= 70) return 'minor';\n  if (normalized >= 50) return 'moderate';\n  if (normalized >= 30) return 'major';\n  if (normalized >= 15) return 'severe';\n  return 'extremely_severe';\n}\n\n/**\n * Calculate deviation description\n */\nexport function getDeviationDescription(\n  value: number,\n  idealMin: number,\n  idealMax: number,\n  unit: MeasurementUnit\n): { deviation: number; direction: 'above' | 'below' | 'within'; description: string } {\n  if (value >= idealMin && value <= idealMax) {\n    return { deviation: 0, direction: 'within', description: 'within ideal range' };\n  }\n\n  const unitLabel = getUnitLabel(unit);\n\n  if (value < idealMin) {\n    const dev = idealMin - value;\n    return {\n      deviation: dev,\n      direction: 'below',\n      description: `${dev.toFixed(2)}${unitLabel} below ideal`,\n    };\n  }\n\n  const dev = value - idealMax;\n  return {\n    deviation: dev,\n    direction: 'above',\n    description: `${dev.toFixed(2)}${unitLabel} above ideal`,\n  };\n}\n\nfunction getUnitLabel(unit: MeasurementUnit): string {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return 'Â°';\n    case 'mm': return 'mm';\n    default: return '';\n  }\n}\n\n// ============================================\n// MEASUREMENT CALCULATION UTILITIES\n// ============================================\n\n/**\n * Calculate distance between two points\n */\nexport function distance(p1: Point, p2: Point): number {\n  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n}\n\n/**\n * Calculate angle at vertex point (in degrees)\n */\nexport function calculateAngle(p1: Point, vertex: Point, p2: Point): number {\n  const v1 = { x: p1.x - vertex.x, y: p1.y - vertex.y };\n  const v2 = { x: p2.x - vertex.x, y: p2.y - vertex.y };\n\n  const dot = v1.x * v2.x + v1.y * v2.y;\n  const cross = v1.x * v2.y - v1.y * v2.x;\n\n  const angle = Math.atan2(cross, dot) * (180 / Math.PI);\n  return Math.abs(angle);\n}\n\n/**\n * Calculate perpendicular distance from point to line (signed)\n */\nexport function perpendicularDistance(\n  point: Point,\n  lineStart: Point,\n  lineEnd: Point\n): number {\n  const A = point.x - lineStart.x;\n  const B = point.y - lineStart.y;\n  const C = lineEnd.x - lineStart.x;\n  const D = lineEnd.y - lineStart.y;\n\n  const dot = A * C + B * D;\n  const lenSq = C * C + D * D;\n  const param = lenSq !== 0 ? dot / lenSq : -1;\n\n  let xx: number, yy: number;\n\n  if (param < 0) {\n    xx = lineStart.x;\n    yy = lineStart.y;\n  } else if (param > 1) {\n    xx = lineEnd.x;\n    yy = lineEnd.y;\n  } else {\n    xx = lineStart.x + param * C;\n    yy = lineStart.y + param * D;\n  }\n\n  const dx = point.x - xx;\n  const dy = point.y - yy;\n\n  const sign =\n    (lineEnd.y - lineStart.y) * point.x -\n      (lineEnd.x - lineStart.x) * point.y +\n      lineEnd.x * lineStart.y -\n      lineEnd.y * lineStart.x >=\n    0\n      ? 1\n      : -1;\n\n  return sign * Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Helper to get landmark by ID\n */\nfunction getLandmark(landmarks: LandmarkPoint[], id: string): Point | null {\n  const lm = landmarks.find((l) => l.id === id);\n  return lm ? { x: lm.x, y: lm.y } : null;\n}\n\n// ============================================\n// SCORE A SINGLE MEASUREMENT\n// ============================================\n\nexport interface DemographicOptions {\n  gender?: Gender;\n  ethnicity?: Ethnicity;\n}\n\n/**\n * Calculate complete score result for a measurement.\n * If demographics provided, uses demographic-specific ideal ranges.\n */\nexport function scoreMeasurement(\n  metricId: string,\n  value: number,\n  demographics?: DemographicOptions\n): FaceIQScoreResult | null {\n  // Get config with demographic overrides if provided\n  const config = demographics?.gender\n    ? getMetricConfigForDemographics(metricId, demographics.gender, demographics.ethnicity || 'other')\n    : FACEIQ_METRICS[metricId];\n\n  if (!config) return null;\n\n  const score = calculateFaceIQScore(value, config);\n  const standardizedScore = standardizeScore(score, config.maxScore);\n  const qualityTier = getQualityTier(score, config.maxScore);\n  const severity = getSeverityLevel(score, config.maxScore);\n  const { deviation, direction } = getDeviationDescription(\n    value,\n    config.idealMin,\n    config.idealMax,\n    config.unit\n  );\n\n  return {\n    metricId,\n    name: config.name,\n    value,\n    score,\n    standardizedScore,\n    qualityTier,\n    severity,\n    idealMin: config.idealMin,\n    idealMax: config.idealMax,\n    deviation,\n    deviationDirection: direction,\n    unit: config.unit,\n    category: config.category,\n  };\n}\n\n// ============================================\n// FRONT PROFILE ANALYSIS\n// ============================================\n\nexport interface FrontProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all front profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeFrontProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): FrontProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  // Helper to add measurement if landmarks available\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const trichion = getLandmark(landmarks, 'trichion');\n  const nasalBase = getLandmark(landmarks, 'nasal_base');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const menton = getLandmark(landmarks, 'menton');\n  const leftZygion = getLandmark(landmarks, 'left_zygion');\n  const rightZygion = getLandmark(landmarks, 'right_zygion');\n  const leftGonion = getLandmark(landmarks, 'left_gonion_inferior');\n  const rightGonion = getLandmark(landmarks, 'right_gonion_inferior');\n  const leftPupil = getLandmark(landmarks, 'left_pupila');\n  const rightPupil = getLandmark(landmarks, 'right_pupila');\n  const leftCanthusM = getLandmark(landmarks, 'left_canthus_medialis');\n  const leftCanthusL = getLandmark(landmarks, 'left_canthus_lateralis');\n  const rightCanthusM = getLandmark(landmarks, 'right_canthus_medialis');\n  const rightCanthusL = getLandmark(landmarks, 'right_canthus_lateralis');\n  void rightCanthusL; // Will be used for asymmetry measurements\n  const leftAlaNasi = getLandmark(landmarks, 'left_ala_nasi');\n  const rightAlaNasi = getLandmark(landmarks, 'right_ala_nasi');\n  const leftCheilion = getLandmark(landmarks, 'left_cheilion');\n  const rightCheilion = getLandmark(landmarks, 'right_cheilion');\n  const labraleSuperius = getLandmark(landmarks, 'labrale_superius');\n  const labraleInferius = getLandmark(landmarks, 'labrale_inferius');\n\n  // FACIAL THIRDS\n  if (trichion && nasalBase && subnasale && menton) {\n    const totalHeight = distance(trichion, menton);\n    if (totalHeight > 0) {\n      const upperThird = (distance(trichion, nasalBase) / totalHeight) * 100;\n      const middleThird = (distance(nasalBase, subnasale) / totalHeight) * 100;\n      const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n\n      addMeasurement('upperThirdProportion', upperThird);\n      addMeasurement('middleThirdProportion', middleThird);\n      addMeasurement('lowerThirdProportion', lowerThird);\n    }\n  }\n\n  // FACE WIDTH TO HEIGHT RATIO (FWHR)\n  if (leftZygion && rightZygion && nasalBase && labraleSuperius) {\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    const upperFaceHeight = distance(nasalBase, labraleSuperius);\n    if (upperFaceHeight > 0) {\n      addMeasurement('faceWidthToHeight', bizygomaticWidth / upperFaceHeight);\n    }\n  }\n\n  // TOTAL FACIAL WIDTH TO HEIGHT\n  if (leftZygion && rightZygion && trichion && menton) {\n    const cheekWidth = distance(leftZygion, rightZygion);\n    const totalHeight = distance(trichion, menton);\n    if (cheekWidth > 0) {\n      addMeasurement('totalFacialWidthToHeight', totalHeight / cheekWidth);\n    }\n  }\n\n  // JAW WIDTH RATIO\n  if (leftGonion && rightGonion && leftZygion && rightZygion) {\n    const bigonialWidth = distance(leftGonion, rightGonion);\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    if (bizygomaticWidth > 0) {\n      const ratio = bigonialWidth / bizygomaticWidth;\n      addMeasurement('jawWidthRatio', ratio);\n      addMeasurement('bigonialWidth', ratio * 100);\n    }\n  }\n\n  // CANTHAL TILT\n  if (leftCanthusM && leftCanthusL) {\n    const deltaY = leftCanthusM.y - leftCanthusL.y;\n    const deltaX = leftCanthusL.x - leftCanthusM.x;\n    const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);\n    addMeasurement('lateralCanthalTilt', angle);\n  }\n\n  // EYE ASPECT RATIO\n  if (leftCanthusM && leftCanthusL) {\n    const leftPalpSup = getLandmark(landmarks, 'left_palpebra_superior');\n    const leftPalpInf = getLandmark(landmarks, 'left_palpebra_inferior');\n    if (leftPalpSup && leftPalpInf) {\n      const eyeWidth = distance(leftCanthusM, leftCanthusL);\n      const eyeHeight = distance(leftPalpSup, leftPalpInf);\n      if (eyeWidth > 0) {\n        addMeasurement('eyeAspectRatio', eyeHeight / eyeWidth);\n      }\n    }\n  }\n\n  // EYE SEPARATION RATIO\n  if (leftCanthusM && rightCanthusM && leftZygion && rightZygion) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('eyeSeparationRatio', intercanthal / bizygomatic);\n    }\n  }\n\n  // IPD RATIO\n  if (leftPupil && rightPupil && leftZygion && rightZygion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('interpupillaryRatio', (ipd / bizygomatic) * 100);\n    }\n  }\n\n  // ONE EYE APART TEST\n  if (leftCanthusM && rightCanthusM && leftCanthusL) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const eyeWidth = distance(leftCanthusM, leftCanthusL);\n    if (eyeWidth > 0) {\n      addMeasurement('oneEyeApartTest', intercanthal / eyeWidth);\n    }\n  }\n\n  // NASAL INDEX\n  if (leftAlaNasi && rightAlaNasi && nasalBase && subnasale) {\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    const nasalHeight = distance(nasalBase, subnasale);\n    if (nasalHeight > 0) {\n      addMeasurement('nasalIndex', (nasalWidth / nasalHeight) * 100);\n    }\n  }\n\n  // INTERCANTHAL-NASAL WIDTH RATIO\n  if (leftCanthusM && rightCanthusM && leftAlaNasi && rightAlaNasi) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('intercanthalNasalRatio', intercanthal / nasalWidth);\n    }\n  }\n\n  // MOUTH TO NOSE RATIO\n  if (leftCheilion && rightCheilion && leftAlaNasi && rightAlaNasi) {\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('mouthWidthToNoseRatio', mouthWidth / nasalWidth);\n    }\n  }\n\n  // IPD TO MOUTH WIDTH RATIO\n  if (leftPupil && rightPupil && leftCheilion && rightCheilion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    if (ipd > 0) {\n      addMeasurement('interpupillaryMouthWidthRatio', mouthWidth / ipd);\n    }\n  }\n\n  // LIP RATIO\n  if (labraleSuperius && labraleInferius && subnasale) {\n    const mouthMiddle = getLandmark(landmarks, 'mouth_middle');\n    if (mouthMiddle) {\n      const upperLipHeight = distance(subnasale, labraleSuperius);\n      const lowerLipHeight = distance(mouthMiddle, labraleInferius);\n      if (upperLipHeight > 0) {\n        addMeasurement('lowerToUpperLipRatio', lowerLipHeight / upperLipHeight);\n      }\n    }\n  }\n\n  // MIDFACE RATIO\n  if (leftZygion && rightZygion && nasalBase && subnasale) {\n    const midfaceWidth = distance(leftZygion, rightZygion);\n    const midfaceHeight = distance(nasalBase, subnasale);\n    if (midfaceHeight > 0) {\n      addMeasurement('midfaceRatio', midfaceWidth / midfaceHeight / 10); // Normalized\n    }\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score (weighted average)\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n  const standardizedScore = overallScore;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// SIDE PROFILE ANALYSIS\n// ============================================\n\nexport interface SideProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all side profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeSideProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): SideProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const glabella = getLandmark(landmarks, 'glabella');\n  const nasion = getLandmark(landmarks, 'nasion');\n  const rhinion = getLandmark(landmarks, 'rhinion');\n  const pronasale = getLandmark(landmarks, 'pronasale');\n  const columella = getLandmark(landmarks, 'columella');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const labraleSuperius = getLandmark(landmarks, 'labraleSuperius');\n  const labraleInferius = getLandmark(landmarks, 'labraleInferius');\n  const sublabiale = getLandmark(landmarks, 'sublabiale');\n  const pogonion = getLandmark(landmarks, 'pogonion');\n  const menton = getLandmark(landmarks, 'menton');\n  const tragus = getLandmark(landmarks, 'tragus');\n  const gonionBottom = getLandmark(landmarks, 'gonionBottom');\n  const cervicalPoint = getLandmark(landmarks, 'cervicalPoint');\n  const orbitale = getLandmark(landmarks, 'orbitale');\n  const porion = getLandmark(landmarks, 'porion');\n\n  // GONIAL ANGLE\n  if (tragus && gonionBottom && menton) {\n    const angle = calculateAngle(tragus, gonionBottom, menton);\n    addMeasurement('gonialAngle', angle);\n  }\n\n  // NASOLABIAL ANGLE\n  if (columella && subnasale && labraleSuperius) {\n    const angle = calculateAngle(columella, subnasale, labraleSuperius);\n    addMeasurement('nasolabialAngle', angle);\n  }\n\n  // NASOFRONTAL ANGLE\n  if (glabella && nasion && rhinion) {\n    const angle = calculateAngle(glabella, nasion, rhinion);\n    addMeasurement('nasofrontalAngle', angle);\n  }\n\n  // MENTOLABIAL ANGLE\n  if (labraleInferius && sublabiale && pogonion) {\n    const angle = calculateAngle(labraleInferius, sublabiale, pogonion);\n    addMeasurement('mentolabialAngle', angle);\n  }\n\n  // E-LINE MEASUREMENTS\n  if (pronasale && pogonion && labraleSuperius && labraleInferius) {\n    const upperLipDist = perpendicularDistance(labraleSuperius, pronasale, pogonion);\n    const lowerLipDist = perpendicularDistance(labraleInferius, pronasale, pogonion);\n    addMeasurement('eLineUpperLip', upperLipDist);\n    addMeasurement('eLineLowerLip', lowerLipDist);\n  }\n\n  // NASOMENTAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    const angle = calculateAngle(nasion, pronasale, pogonion);\n    addMeasurement('nasomentaAngle', angle);\n  }\n\n  // FACIAL CONVEXITY (GLABELLA)\n  if (glabella && subnasale && pogonion) {\n    const angle = calculateAngle(glabella, subnasale, pogonion);\n    addMeasurement('facialConvexityGlabella', angle);\n  }\n\n  // FACIAL CONVEXITY (NASION)\n  if (nasion && subnasale && pogonion) {\n    const angle = calculateAngle(nasion, subnasale, pogonion);\n    addMeasurement('facialConvexityNasion', angle);\n  }\n\n  // TOTAL FACIAL CONVEXITY\n  if (glabella && pronasale && pogonion) {\n    const angle = calculateAngle(glabella, pronasale, pogonion);\n    addMeasurement('totalFacialConvexity', angle);\n  }\n\n  // SUBMENTAL CERVICAL ANGLE\n  if (menton && cervicalPoint && pogonion) {\n    const neckPoint = getLandmark(landmarks, 'neckPoint');\n    if (neckPoint) {\n      const angle = calculateAngle(pogonion, menton, neckPoint);\n      addMeasurement('submentalCervicalAngle', angle);\n    }\n  }\n\n  // NASAL PROJECTION (Goode ratio)\n  if (pronasale && subnasale && nasion) {\n    const projection = distance(pronasale, subnasale);\n    const nasalLength = distance(nasion, pronasale);\n    if (nasalLength > 0) {\n      addMeasurement('nasalProjection', projection / nasalLength);\n    }\n  }\n\n  // NASOFACIAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    // Angle between nose dorsum and facial plane\n    const nasalDorsum = { x: pronasale.x - nasion.x, y: pronasale.y - nasion.y };\n    const facialPlane = { x: pogonion.x - nasion.x, y: pogonion.y - nasion.y };\n\n    const dot = nasalDorsum.x * facialPlane.x + nasalDorsum.y * facialPlane.y;\n    const mag1 = Math.sqrt(nasalDorsum.x ** 2 + nasalDorsum.y ** 2);\n    const mag2 = Math.sqrt(facialPlane.x ** 2 + facialPlane.y ** 2);\n\n    if (mag1 > 0 && mag2 > 0) {\n      const angle = Math.acos(dot / (mag1 * mag2)) * (180 / Math.PI);\n      addMeasurement('nasofacialAngle', angle);\n    }\n  }\n\n  // MANDIBULAR PLANE ANGLE (using Frankfort horizontal)\n  if (porion && orbitale && gonionBottom && menton) {\n    // Frankfort horizontal is porion to orbitale\n    // Mandibular plane is gonion to menton\n    const fhAngle = Math.atan2(orbitale.y - porion.y, orbitale.x - porion.x);\n    const mpAngle = Math.atan2(menton.y - gonionBottom.y, menton.x - gonionBottom.x);\n    const angle = Math.abs(fhAngle - mpAngle) * (180 / Math.PI);\n    addMeasurement('mandibularPlaneAngle', angle);\n  }\n\n  // CHIN PROJECTION\n  if (pogonion && subnasale) {\n    // Distance from pogonion to vertical line through subnasale\n    const projection = pogonion.x - subnasale.x;\n    addMeasurement('chinProjection', projection);\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// COMPLETE HARMONY ANALYSIS\n// ============================================\n\n/**\n * Run complete facial harmony analysis.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeHarmony(\n  frontLandmarks: LandmarkPoint[],\n  sideLandmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): HarmonyAnalysis {\n  const frontResults = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n  const sideResults = analyzeSideProfile(sideLandmarks, gender, ethnicity);\n\n  const allMeasurements = [...frontResults.measurements, ...sideResults.measurements];\n\n  // Combined category scores\n  const allCategories: Record<string, { total: number; count: number }> = {};\n  for (const m of allMeasurements) {\n    if (!allCategories[m.category]) {\n      allCategories[m.category] = { total: 0, count: 0 };\n    }\n    allCategories[m.category].total += m.standardizedScore;\n    allCategories[m.category].count++;\n  }\n\n  const categoryScores: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(allCategories)) {\n    categoryScores[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Overall weighted score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of allMeasurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  // Identify flaws (below average measurements)\n  const flaws: FlawAssessment[] = allMeasurements\n    .filter((m) => m.severity !== 'optimal' && m.severity !== 'minor')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      severity: m.severity,\n      deviation: `${m.deviation.toFixed(2)} ${m.deviationDirection} ideal`,\n      reasoning: `${m.name} is outside the ideal range`,\n      confidence: m.severity === 'extremely_severe' || m.severity === 'severe'\n        ? 'confirmed' as const\n        : 'likely' as const,\n    }))\n    .sort((a, b) => {\n      const severityOrder = { extremely_severe: 0, severe: 1, major: 2, moderate: 3 };\n      return (severityOrder[a.severity as keyof typeof severityOrder] ?? 4) -\n             (severityOrder[b.severity as keyof typeof severityOrder] ?? 4);\n    });\n\n  // Identify strengths (ideal measurements)\n  const strengths: StrengthAssessment[] = allMeasurements\n    .filter((m) => m.qualityTier === 'ideal' || m.qualityTier === 'excellent')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      qualityTier: m.qualityTier,\n      value: m.value,\n      reasoning: `${m.name} is within the ${m.qualityTier} range`,\n    }));\n\n  // Calculate percentile (based on population stats)\n  const percentile = calculateHarmonyPercentile(overallScore);\n\n  return {\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    percentile,\n    frontScore: frontResults.overallScore,\n    sideScore: sideResults.overallScore,\n    categoryScores,\n    measurements: allMeasurements,\n    flaws,\n    strengths,\n  };\n}\n\n/**\n * Calculate percentile from harmony score\n */\nfunction calculateHarmonyPercentile(score: number): number {\n  // Based on normal distribution with mean=5, stdDev=1.5\n  const mean = 5;\n  const stdDev = 1.5;\n  const z = (score - mean) / stdDev;\n  return normalCDF(z) * 100;\n}\n\n/**\n * Standard normal CDF approximation\n */\nfunction normalCDF(z: number): number {\n  const a1 = 0.254829592;\n  const a2 = -0.284496736;\n  const a3 = 1.421413741;\n  const a4 = -1.453152027;\n  const a5 = 1.061405429;\n  const p = 0.3275911;\n\n  const sign = z < 0 ? -1 : 1;\n  const absZ = Math.abs(z) / Math.sqrt(2);\n\n  const t = 1.0 / (1.0 + p * absZ);\n  const y = 1.0 - ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-absZ * absZ);\n\n  return 0.5 * (1.0 + sign * y);\n}\n\n// ============================================\n// PSL RATING CONVERSION\n// ============================================\n\nexport interface PSLRating {\n  score: number;\n  tier: string;\n  percentile: number;\n  description: string;\n}\n\n/**\n * Convert harmony score to PSL rating\n */\nexport function convertToPSL(harmonyScore: number): PSLRating {\n  // Convert 0-10 harmony to 3.0-7.5 PSL range\n  const psl = 3.0 + (harmonyScore / 10) * 4.5;\n  const clampedPSL = Math.max(3.0, Math.min(7.5, psl));\n\n  let tier: string;\n  let percentile: number;\n\n  if (clampedPSL >= 7.5) {\n    tier = 'Top Model';\n    percentile = 99.99;\n  } else if (clampedPSL >= 7.0) {\n    tier = 'Chad';\n    percentile = 99.87;\n  } else if (clampedPSL >= 6.5) {\n    tier = 'Chadlite';\n    percentile = 99.0;\n  } else if (clampedPSL >= 6.0) {\n    tier = 'High Tier Normie+';\n    percentile = 97.25;\n  } else if (clampedPSL >= 5.5) {\n    tier = 'High Tier Normie';\n    percentile = 90.0;\n  } else if (clampedPSL >= 5.0) {\n    tier = 'Mid Tier Normie+';\n    percentile = 84.15;\n  } else if (clampedPSL >= 4.5) {\n    tier = 'Mid Tier Normie';\n    percentile = 65.0;\n  } else if (clampedPSL >= 4.0) {\n    tier = 'Low Tier Normie';\n    percentile = 50.0;\n  } else if (clampedPSL >= 3.5) {\n    tier = 'Below Average';\n    percentile = 30.0;\n  } else {\n    tier = 'Subpar';\n    percentile = 15.0;\n  }\n\n  return {\n    score: clampedPSL,\n    tier,\n    percentile,\n    description: `${tier} (top ${(100 - percentile).toFixed(1)}%)`,\n  };\n}\n\n// ============================================\n// EXPORTS FOR BACKWARD COMPATIBILITY\n// ============================================\n\nexport type { LandmarkPoint } from './landmarks';\n","structuredPatch":[{"oldStart":223,"oldLines":10,"newStart":223,"newLines":11,"lines":[" ","   intercanthalNasalRatio: {","     // Alar width (nose width) relative to intercanthal distance (inner eye spacing)","+    // White: Neoclassical standard - STRICT 1:1 ratio (nose width = inner eye spacing)","     // Research: Wider nose base is standard in African phenotypes","     // Pacific Islander: Similar to Black model, accepts wide nasal base","-    // Extracted from FaceIQ BlackAfrican.htc and Male:Pacific Islander.htc logic","-    white_male: { idealMin: 1.00, idealMax: 1.04 },","+    // Extracted from FaceIQ Male:White.htc (Neoclassical), BlackAfrican.htc and Male:Pacific Islander.htc logic","+    white_male: { idealMin: 0.98, idealMax: 1.05 },  // Neoclassical - strictest nasal width standard","     white_female: { idealMin: 0.98, idealMax: 1.02 },","     east_asian_male: { idealMin: 1.10, idealMax: 1.15 },","     east_asian_female: { idealMin: 1.08, idealMax: 1.13 },"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"fa2bc72b-8c57-443d-a105-214c49330906","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_011YeZVi7mNjovav5o4WHsZp","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Good! Now let me verify the type checking passes and make sure the faceWidthToHeight has white_male explicitly set.","signature":"EpwCCkYIChgCKkCqQyg9pmFV/9vARaeQ3kTyUBPkf2ZjJSp6Reclil202Cnej9K0NRIk2Ac0yRINI8kvywWRUXJSxSJWgJhljpq7EgxNSpaWeDa6IGf4T8UaDL+2TL7zLZ3qMKbnOiIwULQwqXNZMA04StCq0nZoOteEF+9l0FarDTbSb8pX7l93X/ezCUyJbRh+HISIT4HwKoMBB+TkXCNodVcU2mJi9qsT19pS9TtvnJS/ST6TNHsyN5wKfj7nyPCvDm1zK3LFPXccEcGNWIHixNSNeERWA05pkjhvW6aXiYeVtJMSDIa02X0kyiOLzgfT5VVbIE+VzbpKN7k3eziXHR+DuHYx7ctei+cSBmfcGyRgvNQWZTR0j0jWp9cYAQ=="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":1134,"cache_read_input_tokens":48244,"cache_creation":{"ephemeral_5m_input_tokens":1134,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWLDWXJZa69MTdR5MD6fb","type":"assistant","uuid":"c3def352-85e3-45b0-883f-64c82a05a1dc","timestamp":"2025-12-21T17:20:39.953Z"}
{"parentUuid":"c3def352-85e3-45b0-883f-64c82a05a1dc","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_011YeZVi7mNjovav5o4WHsZp","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CBvq29jZDLjrnMmEbG5tei","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","offset":328,"limit":15}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":1134,"cache_read_input_tokens":48244,"cache_creation":{"ephemeral_5m_input_tokens":1134,"ephemeral_1h_input_tokens":0},"output_tokens":152,"service_tier":"standard"}},"requestId":"req_011CWLDWXJZa69MTdR5MD6fb","type":"assistant","uuid":"5d7ad85c-51ce-4be1-a90b-80977b33753c","timestamp":"2025-12-21T17:20:40.809Z"}
{"parentUuid":"5d7ad85c-51ce-4be1-a90b-80977b33753c","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CBvq29jZDLjrnMmEbG5tei","type":"tool_result","content":"   328â†’    white_female: { idealMin: 0.5, idealMax: 3.0 },\n   329â†’    south_asian_male: { idealMin: 0.5, idealMax: 2.0 },  // Prefers visible lid, penalizes hooding\n   330â†’    south_asian_female: { idealMin: 0.7, idealMax: 2.2 },\n   331â†’    east_asian_male: { idealMin: 0.0, idealMax: 1.5 },  // More tolerance for less exposure\n   332â†’    east_asian_female: { idealMin: 0.2, idealMax: 1.8 },\n   333â†’  },\n   334â†’\n   335â†’  // ==========================================\n   336â†’  // FACE PROPORTIONS - Gender variation\n   337â†’  // ==========================================\n   338â†’  faceWidthToHeight: {\n   339â†’    // Males: slightly wider face preferred; Females: slightly narrower\n   340â†’    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n   341â†’    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n   342â†’    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"06d349d2-2286-441a-b7e4-f1eaf4a4d330","timestamp":"2025-12-21T17:20:40.854Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","content":"    white_female: { idealMin: 0.5, idealMax: 3.0 },\n    south_asian_male: { idealMin: 0.5, idealMax: 2.0 },  // Prefers visible lid, penalizes hooding\n    south_asian_female: { idealMin: 0.7, idealMax: 2.2 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.5 },  // More tolerance for less exposure\n    east_asian_female: { idealMin: 0.2, idealMax: 1.8 },\n  },\n\n  // ==========================================\n  // FACE PROPORTIONS - Gender variation\n  // ==========================================\n  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"","numLines":15,"startLine":328,"totalLines":3167}}}
{"parentUuid":"06d349d2-2286-441a-b7e4-f1eaf4a4d330","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01LM1pCvHHrb8Y3aAcacixwq","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Let me continue reading to see the faceWidthToHeight values.","signature":"EuQBCkYIChgCKkAWRNqsMmsCGjsCWuhUIdi/9KyZBpkNoSrZkDEv9HXUrTUIW+fCCggIDQdSGv9jHdlm6jxP+p9FTQX3eYno4O/1Egw/vKeOhp0YWOSqbU8aDLnxX/VndPOSe+Bw+yIwZeqvBO/C3po+uhzWnqc7IUXeX/tqrq5vakuQUdpSYT81PX6TxdFpsOc29dOMZ78LKkw8TZP7j8Ap+Ijv/z4hsK3N/AcQd6ab2b9/6if3a0bzAw11siAyRWipwYqv5PdC8F7a7TUHEpz9W5LdBlTeAbNKw5bMT760HXwPXxOnGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":619,"cache_read_input_tokens":49378,"cache_creation":{"ephemeral_5m_input_tokens":619,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDWtcDzeoLZW9T9LUjG","type":"assistant","uuid":"f7ea6e0a-8ce6-487f-a94d-99fa6993e768","timestamp":"2025-12-21T17:20:45.556Z"}
{"parentUuid":"f7ea6e0a-8ce6-487f-a94d-99fa6993e768","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01LM1pCvHHrb8Y3aAcacixwq","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FFSsB7whKakJ2KQVECetw9","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","offset":342,"limit":10}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":619,"cache_read_input_tokens":49378,"cache_creation":{"ephemeral_5m_input_tokens":619,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDWtcDzeoLZW9T9LUjG","type":"assistant","uuid":"2482caab-f878-4c59-bde9-dc4ab07298c5","timestamp":"2025-12-21T17:20:46.290Z"}
{"parentUuid":"2482caab-f878-4c59-bde9-dc4ab07298c5","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FFSsB7whKakJ2KQVECetw9","type":"tool_result","content":"   342â†’    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"\n   343â†’    male: { idealMin: 1.98, idealMax: 2.02 },\n   344â†’    female: { idealMin: 1.94, idealMax: 1.98 },\n   345â†’    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n   346â†’    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n   347â†’    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n   348â†’    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n   349â†’  },\n   350â†’\n   351â†’  totalFacialWidthToHeight: {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"0933455f-e6de-4dce-aead-8df1b1fe7f7c","timestamp":"2025-12-21T17:20:46.372Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","content":"    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n  },\n\n  totalFacialWidthToHeight: {","numLines":10,"startLine":342,"totalLines":3167}}}
{"parentUuid":"0933455f-e6de-4dce-aead-8df1b1fe7f7c","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01W5fwp4cwD1dgwq6kgkyxa7","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"The faceWidthToHeight doesn't have an explicit white_male entry. The generic male is 1.98-2.02, which seems reasonable for the Neoclassical standard. Let me add an explicit white_male entry for clarity and to document that this is the Neoclassical baseline.","signature":"EqoDCkYIChgCKkBYNcFGwIeatxHJOtep6DZz3XX1eeRQCbvDpyjoGxTbtgBxZuFAsMnt3WO7jE0qUS1kUBZj7hhn0zaDRscTyooqEgydKMVOf+Wa/iC3bQAaDLLj6azMlDQukwVbcSIwsZNw9nIQ9iKSsCEfxIwSkj932aP+RSlMPkvCB/QrTz4txeYXjF3Uw3an+i9LnO4kKpECgrBRiNS4Qs44/69TVefzMB1CKV7GnoCtSAX1IZDL8CfjICCTux1o6JUu5S0wbTFmW0iM0vYO9CcNXAtUYvNABLyRFfr4zPAxDlPHwhHtN59s4d2Z3aIsFBxLNc3FopTYDuaLaYrxH5Z4w+SL2zos/l4NrP35Z0SdPZDZDem++dp8riNu/ENXea4UXaSMAfFdbXomM+qWDrXeE2B830y+pKsvU86L79LwxW1yzy0cyZ4eHNqpIERL8yT4yOetYJW46JuBOeFFSehBCKOg11tWY8alWpu+Qg24bHVmYKfXyPIXlsQSPINp/00RJGo6ve21Pf7j0e1ajhueI/0M/IYWQ3mxN6VdPRKR71YzZreziSNaGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":475,"cache_read_input_tokens":49997,"cache_creation":{"ephemeral_5m_input_tokens":475,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDXGqh4f4Z97D5MTJN5","type":"assistant","uuid":"e28fe6e9-56c4-4e01-aa79-86a993a009f0","timestamp":"2025-12-21T17:20:55.782Z"}
{"parentUuid":"e28fe6e9-56c4-4e01-aa79-86a993a009f0","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01W5fwp4cwD1dgwq6kgkyxa7","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019MXb2RduWFZ13m9BWgsq7d","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","old_string":"  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n  },","new_string":"  faceWidthToHeight: {\n    // White: Neoclassical standard - balanced, moderate width (1.98-2.02)\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:Pacific Islander.htc\n    white_male: { idealMin: 1.98, idealMax: 2.02 },  // Neoclassical - moderate width baseline\n    white_female: { idealMin: 1.94, idealMax: 1.98 },\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n  },"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":475,"cache_read_input_tokens":49997,"cache_creation":{"ephemeral_5m_input_tokens":475,"ephemeral_1h_input_tokens":0},"output_tokens":830,"service_tier":"standard"}},"requestId":"req_011CWLDXGqh4f4Z97D5MTJN5","type":"assistant","uuid":"404f13ed-c59d-4c3b-a813-927a4f9afd59","timestamp":"2025-12-21T17:21:02.091Z"}
{"parentUuid":"404f13ed-c59d-4c3b-a813-927a4f9afd59","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019MXb2RduWFZ13m9BWgsq7d","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n   334â†’\n   335â†’  // ==========================================\n   336â†’  // FACE PROPORTIONS - Gender variation\n   337â†’  // ==========================================\n   338â†’  faceWidthToHeight: {\n   339â†’    // White: Neoclassical standard - balanced, moderate width (1.98-2.02)\n   340â†’    // Males: slightly wider face preferred; Females: slightly narrower\n   341â†’    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n   342â†’    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n   343â†’    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:Pacific Islander.htc\n   344â†’    white_male: { idealMin: 1.98, idealMax: 2.02 },  // Neoclassical - moderate width baseline\n   345â†’    white_female: { idealMin: 1.94, idealMax: 1.98 },\n   346â†’    male: { idealMin: 1.98, idealMax: 2.02 },\n   347â†’    female: { idealMin: 1.94, idealMax: 1.98 },\n   348â†’    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n   349â†’    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n   350â†’    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n   351â†’    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n   352â†’  },\n   353â†’\n   354â†’  totalFacialWidthToHeight: {\n   355â†’    male: { idealMin: 1.35, idealMax: 1.40 },\n   356â†’    female: { idealMin: 1.32, idealMax: 1.37 },"}]},"uuid":"98c99b7e-6f36-4e07-a428-aae9026d7c8a","timestamp":"2025-12-21T17:21:02.115Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","oldString":"  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n  },","newString":"  faceWidthToHeight: {\n    // White: Neoclassical standard - balanced, moderate width (1.98-2.02)\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:Pacific Islander.htc\n    white_male: { idealMin: 1.98, idealMax: 2.02 },  // Neoclassical - moderate width baseline\n    white_female: { idealMin: 1.94, idealMax: 1.98 },\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n  },","originalFile":"/**\n * FaceIQ-Style Facial Analysis Scoring System\n * Complete replication of FaceIQ Labs scoring algorithms\n *\n * Features:\n * - Exponential decay scoring with per-metric decay rates\n * - Bezier curve custom scoring for non-linear measurements\n * - 70+ facial measurements (front + side profiles)\n * - Quality tiers: Ideal, Excellent, Good\n * - 5-tier severity: Extremely Severe, Severe, Major, Moderate, Minor\n */\n\nimport { LandmarkPoint } from './landmarks';\n\n// ============================================\n// CORE TYPES\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\n/**\n * Polarity defines how deviation from the ideal range is interpreted:\n * - 'balanced': Default. Deviation in either direction is equally bad.\n * - 'higher_is_better': Values above the ideal are still good. Only values below\n *   the 'safeFloor' are true weaknesses. E.g., Canthal Tilt (positive tilt is good)\n * - 'lower_is_better': Values below the ideal are still good. Only values above\n *   the 'safeCeiling' are true weaknesses. E.g., Philtrum length (shorter is better)\n */\nexport type MetricPolarity = 'balanced' | 'higher_is_better' | 'lower_is_better';\n\nexport interface MetricConfig {\n  id: string;\n  name: string;\n  category: string;\n  unit: MeasurementUnit;\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  decayRate: number;\n  maxScore: number;\n  weight: number;\n  description: string;\n  profileType: 'front' | 'side';\n  customCurve?: BezierCurveConfig;\n  /**\n   * Polarity for directional/dimorphic scoring.\n   * Defaults to 'balanced' if not specified.\n   */\n  polarity?: MetricPolarity;\n  /**\n   * For 'higher_is_better': minimum value that's still acceptable.\n   * Values above this but below idealMin get a passing score (softFloorScore).\n   * Values below this are true weaknesses.\n   */\n  safeFloor?: number;\n  /**\n   * For 'lower_is_better': maximum value that's still acceptable.\n   * Values below this but above idealMax get a passing score (softCeilingScore).\n   * Values above this are true weaknesses.\n   */\n  safeCeiling?: number;\n  /**\n   * Score given to values in the \"acceptable but not ideal\" zone.\n   * Defaults to 8.0 (Good). Range: 6.0-9.0\n   */\n  softZoneScore?: number;\n}\n\nexport interface BezierCurveConfig {\n  mode: 'custom' | 'exponential';\n  points: CurvePoint[];\n}\n\nexport interface CurvePoint {\n  x: number;\n  y: number;\n  leftHandleX?: number;\n  leftHandleY?: number;\n  rightHandleX?: number;\n  rightHandleY?: number;\n  fixed?: boolean;\n}\n\nexport interface FaceIQScoreResult {\n  metricId: string;\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  severity: SeverityLevel;\n  idealMin: number;\n  idealMax: number;\n  deviation: number;\n  deviationDirection: 'above' | 'below' | 'within';\n  unit: MeasurementUnit;\n  category: string;\n  percentile?: number;\n}\n\nexport interface HarmonyAnalysis {\n  overallScore: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  percentile: number;\n  frontScore: number;\n  sideScore: number;\n  categoryScores: Record<string, number>;\n  measurements: FaceIQScoreResult[];\n  flaws: FlawAssessment[];\n  strengths: StrengthAssessment[];\n}\n\nexport interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n}\n\nexport interface StrengthAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  qualityTier: QualityTier;\n  value: number;\n  reasoning: string;\n}\n\n// ============================================\n// DEMOGRAPHIC TYPES & OVERRIDES\n// ============================================\n\nexport type Ethnicity =\n  | 'east_asian'\n  | 'south_asian'\n  | 'black'\n  | 'hispanic'\n  | 'middle_eastern'\n  | 'native_american'\n  | 'pacific_islander'\n  | 'white'\n  | 'other';\n\nexport type Gender = 'male' | 'female';\n\nexport type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;\n\nexport interface DemographicOverride {\n  idealMin: number;\n  idealMax: number;\n}\n\n/**\n * Demographic-specific ideal ranges based on anthropometric research.\n * FaceIQ uses universal scoring, but this gives more accurate assessments\n * by adjusting ideals based on ethnicity and gender.\n */\nexport const DEMOGRAPHIC_OVERRIDES: Record<string, Partial<Record<DemographicKey, DemographicOverride>>> = {\n  // ==========================================\n  // NOSE METRICS - Highest ethnicity variation\n  // ==========================================\n  nasalIndex: {\n    // Nasal Index = (Nose Width / Nose Height) Ã— 100\n    // Research: African/Pacific Islander tend platyrrhine (85-100), Asian mesorrhine (75-88), European leptorrhine (65-75)\n    east_asian_male: { idealMin: 78, idealMax: 88 },\n    east_asian_female: { idealMin: 76, idealMax: 86 },\n    south_asian_male: { idealMin: 72, idealMax: 82 },\n    south_asian_female: { idealMin: 70, idealMax: 80 },\n    black_male: { idealMin: 85, idealMax: 100 },\n    black_female: { idealMin: 83, idealMax: 98 },\n    hispanic_male: { idealMin: 75, idealMax: 87 },\n    hispanic_female: { idealMin: 73, idealMax: 85 },\n    middle_eastern_male: { idealMin: 68, idealMax: 78 },\n    middle_eastern_female: { idealMin: 66, idealMax: 76 },\n    white_male: { idealMin: 65, idealMax: 75 },\n    white_female: { idealMin: 63, idealMax: 73 },\n    native_american_male: { idealMin: 72, idealMax: 82 },\n    native_american_female: { idealMin: 70, idealMax: 80 },\n    pacific_islander_male: { idealMin: 82, idealMax: 95 },\n    pacific_islander_female: { idealMin: 80, idealMax: 93 },\n  },\n\n  nasolabialAngle: {\n    // Ideal nasolabial angle varies by ethnicity\n    // African: slightly more obtuse, European: slightly more acute\n    // Middle Eastern: Penalizes droopy tip (<90Â°) - common flaw is \"Hooked Nose\"\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    black_male: { idealMin: 95, idealMax: 110 },\n    black_female: { idealMin: 100, idealMax: 115 },\n    east_asian_male: { idealMin: 90, idealMax: 105 },\n    east_asian_female: { idealMin: 95, idealMax: 110 },\n    middle_eastern_male: { idealMin: 90, idealMax: 100 },  // Strict on droopy tip\n    middle_eastern_female: { idealMin: 95, idealMax: 105 },\n    // Gender-only fallbacks\n    male: { idealMin: 90, idealMax: 100 },\n    female: { idealMin: 100, idealMax: 110 },\n  },\n\n  nasalProjection: {\n    // Nose projection relative to face depth\n    // East Asian/African: typically less projection is ideal\n    // Middle Eastern: Accepts stronger projection (bigger nose) than White model\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    east_asian: { idealMin: 0.54, idealMax: 0.60 },\n    black: { idealMin: 0.52, idealMax: 0.58 },\n    south_asian: { idealMin: 0.56, idealMax: 0.62 },\n    middle_eastern: { idealMin: 0.62, idealMax: 0.70 },  // Higher tolerance for larger noses\n    white: { idealMin: 0.60, idealMax: 0.67 },\n    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },\n  },\n\n  intercanthalNasalRatio: {\n    // Alar width (nose width) relative to intercanthal distance (inner eye spacing)\n    // White: Neoclassical standard - STRICT 1:1 ratio (nose width = inner eye spacing)\n    // Research: Wider nose base is standard in African phenotypes\n    // Pacific Islander: Similar to Black model, accepts wide nasal base\n    // Extracted from FaceIQ Male:White.htc (Neoclassical), BlackAfrican.htc and Male:Pacific Islander.htc logic\n    white_male: { idealMin: 0.98, idealMax: 1.05 },  // Neoclassical - strictest nasal width standard\n    white_female: { idealMin: 0.98, idealMax: 1.02 },\n    east_asian_male: { idealMin: 1.10, idealMax: 1.15 },\n    east_asian_female: { idealMin: 1.08, idealMax: 1.13 },\n    south_asian_male: { idealMin: 1.05, idealMax: 1.08 },  // Hybrid: between White and East Asian\n    south_asian_female: { idealMin: 1.04, idealMax: 1.07 },\n    black_male: { idealMin: 1.15, idealMax: 1.25 },  // WIDEST - completely inverts White standard\n    black_female: { idealMin: 1.13, idealMax: 1.23 },\n    hispanic_male: { idealMin: 1.00, idealMax: 1.12 },  // \"Bridge\" tolerance - between White and Black\n    hispanic_female: { idealMin: 0.98, idealMax: 1.10 },\n    pacific_islander_male: { idealMin: 1.10, idealMax: 1.20 },  // Wide tolerance, similar to Black model\n    pacific_islander_female: { idealMin: 1.08, idealMax: 1.18 },\n  },\n\n  // ==========================================\n  // JAW METRICS - Clear gender dimorphism\n  // ==========================================\n  bigonialWidth: {\n    // Jaw width as % of bizygomatic width\n    // Males: wider, more angular; Females: narrower, softer\n    // Pacific Islander: Extremely wide jaw preferred - \"Warrior Skull\" robustness\n    // Extracted from FaceIQ Male:Pacific Islander.htc\n    male: { idealMin: 90, idealMax: 95 },\n    female: { idealMin: 85, idealMax: 90 },\n    pacific_islander_male: { idealMin: 92, idealMax: 98 },  // Jaw width rivals cheekbone width - extreme robustness\n    pacific_islander_female: { idealMin: 88, idealMax: 94 },\n  },\n\n  jawFrontalAngle: {\n    // More angular in males, softer in females\n    male: { idealMin: 88, idealMax: 95 },\n    female: { idealMin: 82, idealMax: 90 },\n  },\n\n  jawWidthRatio: {\n    // Males have stronger jaw width preference\n    male: { idealMin: 0.78, idealMax: 0.85 },\n    female: { idealMin: 0.72, idealMax: 0.80 },\n  },\n\n  gonialAngle: {\n    // White: Neoclassical standard - square, vertically robust jaw (115-125Â°)\n    // Males: more acute (sharper jaw); Females: more obtuse (softer)\n    // Extracted from FaceIQ Male:White.htc\n    white_male: { idealMin: 115, idealMax: 125 },  // Neoclassical square jaw - less tolerant of soft/V-shaped jaws\n    white_female: { idealMin: 120, idealMax: 132 },\n    male: { idealMin: 115, idealMax: 125 },\n    female: { idealMin: 120, idealMax: 135 },\n  },\n\n  // ==========================================\n  // EYE METRICS - Ethnic variation\n  // ==========================================\n  lateralCanthalTilt: {\n    // White: Neoclassical standard - neutral to slightly positive tilt (4-8Â°)\n    // East Asian: naturally higher positive tilt\n    // Hispanic: Strong preference for positive tilt (almond eyes), penalizes neutral/negative more harshly\n    // Middle Eastern: Strong preference for \"Hunter Eyes\" (Dark Triad look)\n    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:MiddleEastern.htc\n    white_male: { idealMin: 4.0, idealMax: 8.0 },  // Neoclassical - neutral to slightly positive\n    white_female: { idealMin: 5.0, idealMax: 9.0 },\n    east_asian_male: { idealMin: 8, idealMax: 12 },\n    east_asian_female: { idealMin: 9, idealMax: 13 },\n    south_asian_male: { idealMin: 6, idealMax: 10 },\n    south_asian_female: { idealMin: 7, idealMax: 11 },\n    hispanic_male: { idealMin: 6.0, idealMax: 12.0 },  // Wide range, heavily rewards positive tilt\n    hispanic_female: { idealMin: 7.0, idealMax: 13.0 },\n    middle_eastern_male: { idealMin: 4.0, idealMax: 10.0 },  // Almond/Hunter eye preference\n    middle_eastern_female: { idealMin: 5.0, idealMax: 11.0 },\n    // Default for others is 4-8 (already in FACEIQ_METRICS)\n  },\n\n  eyeAspectRatio: {\n    // East Asian eyes often have different aspect ratio due to epicanthal fold\n    east_asian_male: { idealMin: 2.6, idealMax: 3.2 },\n    east_asian_female: { idealMin: 2.7, idealMax: 3.3 },\n    // Larger eyes in females considered more attractive\n    male: { idealMin: 2.9, idealMax: 3.4 },\n    female: { idealMin: 3.1, idealMax: 3.6 },\n  },\n\n  tearTroughDepth: {\n    // Under-eye hollowing and dark circles (infraorbital depression)\n    // South Asian: MUCH stricter penalty due to genetic hyperpigmentation\n    // Extracted from FaceIQ Male:SouthAsian.htc - biggest difference vs White model\n    white_male: { idealMin: 0.0, idealMax: 1.5 },\n    white_female: { idealMin: 0.0, idealMax: 1.3 },\n    south_asian_male: { idealMin: 0.0, idealMax: 0.5 },  // VERY strict - 0.5+ triggers \"Tired/Aged Eyes\" flaw\n    south_asian_female: { idealMin: 0.0, idealMax: 0.4 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.2 },\n    east_asian_female: { idealMin: 0.0, idealMax: 1.0 },\n  },\n\n  upperEyelidExposure: {\n    // Visible eyelid platform (space between eyelash and crease)\n    // South Asian ideal: prefers visible lid platform, penalizes hooded eyes more than White model\n    // Extracted from FaceIQ Male:SouthAsian.htc\n    white_male: { idealMin: 0.3, idealMax: 2.5 },\n    white_female: { idealMin: 0.5, idealMax: 3.0 },\n    south_asian_male: { idealMin: 0.5, idealMax: 2.0 },  // Prefers visible lid, penalizes hooding\n    south_asian_female: { idealMin: 0.7, idealMax: 2.2 },\n    east_asian_male: { idealMin: 0.0, idealMax: 1.5 },  // More tolerance for less exposure\n    east_asian_female: { idealMin: 0.2, idealMax: 1.8 },\n  },\n\n  // ==========================================\n  // FACE PROPORTIONS - Gender variation\n  // ==========================================\n  faceWidthToHeight: {\n    // Males: slightly wider face preferred; Females: slightly narrower\n    // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)\n    // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)\n    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"\n    male: { idealMin: 1.98, idealMax: 2.02 },\n    female: { idealMin: 1.94, idealMax: 1.98 },\n    hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes\n    hispanic_female: { idealMin: 1.93, idealMax: 2.05 },\n    pacific_islander_male: { idealMin: 2.10, idealMax: 2.30 },  // \"Warrior Skull\" - extremely broad, square face\n    pacific_islander_female: { idealMin: 2.05, idealMax: 2.25 },\n  },\n\n  totalFacialWidthToHeight: {\n    male: { idealMin: 1.35, idealMax: 1.40 },\n    female: { idealMin: 1.32, idealMax: 1.37 },\n  },\n\n  midfaceRatio: {\n    // Females often have more compact midface\n    // White: Neoclassical standard - strict compact midface preference\n    // Middle Eastern: Similar to White model - compact is better\n    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:MiddleEastern.htc\n    white_male: { idealMin: 0.95, idealMax: 1.02 },  // Neoclassical - penalizes long midface heavily\n    white_female: { idealMin: 0.93, idealMax: 1.00 },\n    male: { idealMin: 0.98, idealMax: 1.02 },\n    female: { idealMin: 0.95, idealMax: 1.00 },\n    middle_eastern_male: { idealMin: 0.95, idealMax: 1.02 },  // Slightly wider tolerance, compact preferred\n    middle_eastern_female: { idealMin: 0.93, idealMax: 0.99 },\n  },\n\n  // ==========================================\n  // LIP METRICS - Ethnicity variation\n  // ==========================================\n  lipRatio: {\n    // African/Hispanic: fuller lips natural\n    black_male: { idealMin: 1.6, idealMax: 2.2 },\n    black_female: { idealMin: 1.7, idealMax: 2.3 },\n    hispanic_male: { idealMin: 1.4, idealMax: 2.0 },\n    hispanic_female: { idealMin: 1.5, idealMax: 2.1 },\n    // East Asian: less full lips\n    east_asian_male: { idealMin: 1.2, idealMax: 1.7 },\n    east_asian_female: { idealMin: 1.3, idealMax: 1.8 },\n    // Default\n    male: { idealMin: 1.3, idealMax: 1.8 },\n    female: { idealMin: 1.4, idealMax: 2.0 },\n  },\n\n  upperLipRatio: {\n    // Fuller upper lip in African phenotypes\n    black: { idealMin: 0.38, idealMax: 0.48 },\n    hispanic: { idealMin: 0.36, idealMax: 0.45 },\n    east_asian: { idealMin: 0.32, idealMax: 0.40 },\n    female: { idealMin: 0.34, idealMax: 0.42 },\n  },\n\n  // ==========================================\n  // PROFILE METRICS - Gender & ethnicity\n  // ==========================================\n  chinProjection: {\n    // Males: more projected chin ideal\n    // Black/African: Adjusted for bimaxillary prognathism (forward mouth projection)\n    // Extracted from FaceIQ BlackAfrican.htc logic\n    male: { idealMin: 0, idealMax: 3 },\n    female: { idealMin: -2, idealMax: 2 },\n    black_male: { idealMin: 0, idealMax: 4 },  // Accommodates natural forward projection\n    black_female: { idealMin: -1, idealMax: 3 },\n  },\n\n  nasofrontalAngle: {\n    // Higher brow ridge in males\n    male: { idealMin: 128, idealMax: 138 },\n    female: { idealMin: 132, idealMax: 142 },\n  },\n\n  chinToPhiltrumRatio: {\n    // White: Neoclassical standard - strict balance between chin and philtrum\n    // Black/African: Fuller lips naturally shorten visible philtrum\n    // Extracted from FaceIQ Male:White.htc (Neoclassical) and BlackAfrican.htc\n    // Higher ratio = shorter philtrum (more acceptable in Black phenotype)\n    white_male: { idealMin: 2.10, idealMax: 2.30 },  // Neoclassical - strict lower face balance\n    white_female: { idealMin: 2.05, idealMax: 2.25 },\n    black_male: { idealMin: 2.15, idealMax: 2.70 },  // Accommodates shorter philtrum\n    black_female: { idealMin: 2.10, idealMax: 2.65 },\n  },\n\n  // ==========================================\n  // SKIN QUALITY - Ethnicity variation\n  // ==========================================\n  skinUniformity: {\n    // South Asian: Stricter standards due to genetic hyperpigmentation tendency\n    // Hispanic: Similar to South Asian - penalizes hyperpigmentation more than White model\n    // Extracted from FaceIQ Male:Hispanic.htc - \"Bridge Model\"\n    white_male: { idealMin: 0.88, idealMax: 1.00 },\n    white_female: { idealMin: 0.90, idealMax: 1.00 },\n    south_asian_male: { idealMin: 0.90, idealMax: 1.00 },  // Stricter - hyperpigmentation common\n    south_asian_female: { idealMin: 0.92, idealMax: 1.00 },\n    east_asian_male: { idealMin: 0.92, idealMax: 1.00 },  // High skin quality standards\n    east_asian_female: { idealMin: 0.94, idealMax: 1.00 },\n    black_male: { idealMin: 0.85, idealMax: 1.00 },  // More tolerance for melanin variation\n    black_female: { idealMin: 0.87, idealMax: 1.00 },\n    hispanic_male: { idealMin: 0.85, idealMax: 1.00 },  // Bridge: more tolerance than South Asian, less than White\n    hispanic_female: { idealMin: 0.87, idealMax: 1.00 },\n  },\n\n  // ==========================================\n  // EYEBROW METRICS - Ethnicity variation\n  // ==========================================\n  eyebrowThickness: {\n    // Middle Eastern: Heavily favors thick, dense eyebrows (\"Dark Triad\" look with deep-set eyes)\n    // Extracted from FaceIQ Male:MiddleEastern.htc - STRICTEST eyebrow requirements\n    middle_eastern_male: { idealMin: 2.5, idealMax: 5.0 },  // Prefers significantly thicker/darker brows\n    middle_eastern_female: { idealMin: 2.0, idealMax: 4.0 },\n    east_asian_male: { idealMin: 1.5, idealMax: 3.0 },  // Typically less thick\n    east_asian_female: { idealMin: 1.3, idealMax: 2.5 },\n    male: { idealMin: 2.0, idealMax: 4.0 },\n    female: { idealMin: 1.8, idealMax: 3.5 },\n  },\n\n  eyebrowDistance: {\n    // Middle Eastern: \"Kill Switch\" for unibrow (synophrys)\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    // While thick brows are favored, unibrow is a critical flaw if distance < 15mm\n    middle_eastern_male: { idealMin: 15, idealMax: 25 },  // Stricter minimum to avoid unibrow\n    middle_eastern_female: { idealMin: 18, idealMax: 28 },\n    male: { idealMin: 15, idealMax: 25 },\n    female: { idealMin: 16, idealMax: 26 },\n  },\n\n  orbitalVector: {\n    // Middle Eastern: Favors deep-set eyes (lower/negative orbital vector)\n    // Part of the \"Dark Triad\" look with heavy brows\n    // Extracted from FaceIQ Male:MiddleEastern.htc\n    middle_eastern_male: { idealMin: -2, idealMax: 3 },  // Allows more deep-set eyes\n    middle_eastern_female: { idealMin: -1, idealMax: 4 },\n    male: { idealMin: 0, idealMax: 4 },\n    female: { idealMin: 1, idealMax: 5 },\n  },\n};\n\n/**\n * Get metric configuration with demographic-specific overrides applied.\n * Lookup priority: ethnicity_gender > gender > ethnicity > default\n */\nexport function getMetricConfigForDemographics(\n  metricId: string,\n  gender: Gender,\n  ethnicity: Ethnicity = 'other'\n): MetricConfig | null {\n  const baseConfig = FACEIQ_METRICS[metricId];\n  if (!baseConfig) return null;\n\n  const overrides = DEMOGRAPHIC_OVERRIDES[metricId];\n  if (!overrides) return baseConfig;\n\n  // Try specific combo first (e.g., \"east_asian_male\")\n  const specificKey = `${ethnicity}_${gender}` as DemographicKey;\n  const override = overrides[specificKey] || overrides[gender] || overrides[ethnicity];\n\n  if (!override) return baseConfig;\n\n  return {\n    ...baseConfig,\n    idealMin: override.idealMin,\n    idealMax: override.idealMax,\n  };\n}\n\n// ============================================\n// FACEIQ MEASUREMENT CONFIGURATIONS (70+)\n// ============================================\n\nexport const FACEIQ_METRICS: Record<string, MetricConfig> = {\n  // ==========================================\n  // FRONT PROFILE - FACIAL PROPORTIONS (32)\n  // ==========================================\n\n  faceWidthToHeight: {\n    id: 'faceWidthToHeight',\n    name: 'Face Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.96,\n    idealMax: 2.0,\n    rangeMin: 1.4,\n    rangeMax: 2.5,\n    decayRate: 6.4,\n    maxScore: 30,  // FaceIQ: highest priority metric\n    weight: 0.06,\n    description: 'Ratio of bizygomatic width to upper face height',\n    profileType: 'front',\n  },\n\n  lowerThirdProportion: {\n    id: 'lowerThirdProportion',\n    name: 'Lower Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31,\n    idealMax: 33.5,\n    rangeMin: 24,\n    rangeMax: 40,\n    decayRate: 1.86,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by lower third (subnasale to menton)',\n    profileType: 'front',\n  },\n\n  middleThirdProportion: {\n    id: 'middleThirdProportion',\n    name: 'Middle Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31.4,\n    idealMax: 33.4,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by middle third',\n    profileType: 'front',\n  },\n\n  upperThirdProportion: {\n    id: 'upperThirdProportion',\n    name: 'Upper Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 30,\n    idealMax: 32,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Percentage of face occupied by upper third (trichion to glabella)',\n    profileType: 'front',\n  },\n\n  bitemporalWidth: {\n    id: 'bitemporalWidth',\n    name: 'Bitemporal Width',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 75,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Temple width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  cheekboneHeight: {\n    id: 'cheekboneHeight',\n    name: 'Cheekbone Height',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 83,\n    idealMax: 100,\n    rangeMin: 30,\n    rangeMax: 140,\n    decayRate: 0.5,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Vertical position of cheekbones relative to face height',\n    profileType: 'front',\n  },\n\n  totalFacialWidthToHeight: {\n    id: 'totalFacialWidthToHeight',\n    name: 'Total Facial Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.34,\n    idealMax: 1.37,\n    rangeMin: 1.0,\n    rangeMax: 1.7,\n    decayRate: 13.2,\n    maxScore: 25,  // Special: higher max score\n    weight: 0.05,\n    description: 'Total face height divided by cheek width',\n    profileType: 'front',\n    customCurve: {\n      mode: 'custom',\n      points: [\n        { x: 1.05, y: 0 },\n        { x: 1.17, y: 1.41 },\n        { x: 1.25, y: 3.86 },\n        { x: 1.29, y: 6.01 },\n        { x: 1.32, y: 8.88 },\n        { x: 1.34, y: 10, fixed: true },\n        { x: 1.37, y: 10, fixed: true },\n        { x: 1.39, y: 8.88 },\n        { x: 1.42, y: 6.01 },\n        { x: 1.46, y: 3.86 },\n        { x: 1.54, y: 1.41 },\n        { x: 1.66, y: 0 },\n      ],\n    },\n  },\n\n  midfaceRatio: {\n    id: 'midfaceRatio',\n    name: 'Midface Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 0.97,\n    idealMax: 1.0,\n    rangeMin: 0.5,\n    rangeMax: 1.5,\n    decayRate: 31.6,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.04,\n    description: 'Midface width to height ratio for facial balance',\n    profileType: 'front',\n  },\n\n  // JAW MEASUREMENTS\n  jawSlope: {\n    id: 'jawSlope',\n    name: 'Jaw Slope',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 140,\n    idealMax: 142.5,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of the jawline from gonion to chin',\n    profileType: 'front',\n  },\n\n  jawFrontalAngle: {\n    id: 'jawFrontalAngle',\n    name: 'Jaw Frontal Angle',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 35,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 20,  // FaceIQ: high priority\n    weight: 0.04,\n    description: 'Angle of jaw corners from frontal view',\n    profileType: 'front',\n  },\n\n  bigonialWidth: {\n    id: 'bigonialWidth',\n    name: 'Bigonial Width',\n    category: 'Jaw Shape',\n    unit: 'percent',\n    idealMin: 87.75,\n    idealMax: 91.75,\n    rangeMin: 60.25,\n    rangeMax: 120.25,\n    decayRate: 0.9,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Jaw width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  jawWidthRatio: {\n    id: 'jawWidthRatio',\n    name: 'Jaw Width to Face Width Ratio',\n    category: 'Jaw Shape',\n    unit: 'ratio',\n    idealMin: 0.75,\n    idealMax: 0.82,\n    rangeMin: 0.6,\n    rangeMax: 0.95,\n    decayRate: 25.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Bigonial width divided by bizygomatic width',\n    profileType: 'front',\n  },\n\n  // EYE MEASUREMENTS\n  lateralCanthalTilt: {\n    id: 'lateralCanthalTilt',\n    name: 'Lateral Canthal Tilt',\n    category: 'Eyes',\n    unit: 'degrees',\n    idealMin: 4.0,   // Updated: 4-8Â° is peak \"hunter eyes\"\n    idealMax: 8.0,\n    rangeMin: -5,\n    rangeMax: 20,\n    decayRate: 1.5,  // Reduced: gentler decay for positive tilts\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle of eye from inner to outer canthus. Positive tilt is attractive.',\n    profileType: 'front',\n    // DIRECTIONAL SCORING: Higher (positive) tilt is better\n    // - Ideal: 4-8Â° (attractive upswept eyes / \"hunter eyes\")\n    // - Good: 0-4Â° (neutral to slight positive - still attractive)\n    // - Weak: < 0Â° (negative/droopy tilt - only this is a true weakness)\n    polarity: 'higher_is_better',\n    safeFloor: 0.0,       // Neutral tilt - anything above is acceptable\n    softZoneScore: 8.0,   // \"Good\" score for 0-4Â° range\n  },\n\n  eyeAspectRatio: {\n    id: 'eyeAspectRatio',\n    name: 'Eye Aspect Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 3.0,\n    idealMax: 3.5,\n    rangeMin: 0.8,\n    rangeMax: 6,\n    decayRate: 2.0,\n    maxScore: 15,  // FaceIQ: higher priority\n    weight: 0.03,\n    description: 'Eye width divided by eye height',\n    profileType: 'front',\n  },\n\n  eyeSeparationRatio: {\n    id: 'eyeSeparationRatio',\n    name: 'Eye Separation Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 45.7,\n    idealMax: 46.8,\n    rangeMin: 35,\n    rangeMax: 55,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Intercanthal distance as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryRatio: {\n    id: 'interpupillaryRatio',\n    name: 'Interpupillary Distance Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 44,\n    idealMax: 48,\n    rangeMin: 38,\n    rangeMax: 54,\n    decayRate: 1.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'IPD as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryMouthWidthRatio: {\n    id: 'interpupillaryMouthWidthRatio',\n    name: 'Interpupillary-Mouth Width Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.83,\n    idealMax: 0.87,\n    rangeMin: 0.6,\n    rangeMax: 1.1,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Mouth width divided by interpupillary distance',\n    profileType: 'front',\n  },\n\n  oneEyeApartTest: {\n    id: 'oneEyeApartTest',\n    name: 'One Eye Apart Test',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.95,\n    idealMax: 1.0,\n    rangeMin: 0.7,\n    rangeMax: 1.3,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Intercanthal distance should equal one eye width',\n    profileType: 'front',\n  },\n\n  tearTroughDepth: {\n    id: 'tearTroughDepth',\n    name: 'Tear Trough Depth',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.0,\n    idealMax: 1.5,\n    rangeMin: 0.0,\n    rangeMax: 4.0,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Under-eye hollow depth (infraorbital depression). Lower is better for youthfulness.',\n    profileType: 'front',\n    polarity: 'lower_is_better',\n    safeCeiling: 1.5,  // White standard\n    softZoneScore: 7.5,\n  },\n\n  upperEyelidExposure: {\n    id: 'upperEyelidExposure',\n    name: 'Upper Eyelid Exposure',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 2.5,\n    rangeMin: 0.0,\n    rangeMax: 5.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Visible upper eyelid platform. Too little creates hooded eyes.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  // EYEBROW MEASUREMENTS\n  eyebrowThickness: {\n    id: 'eyebrowThickness',\n    name: 'Eyebrow Thickness',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 2.0,\n    idealMax: 4.0,\n    rangeMin: 1.0,\n    rangeMax: 6.0,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow density and thickness. Higher values indicate fuller, denser brows.',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  eyebrowDistance: {\n    id: 'eyebrowDistance',\n    name: 'Inter-Eyebrow Distance',\n    category: 'Upper Third',\n    unit: 'mm',\n    idealMin: 15,\n    idealMax: 25,\n    rangeMin: 5,\n    rangeMax: 40,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance between inner edges of eyebrows. Too low creates unibrow (synophrys).',\n    profileType: 'front',\n    polarity: 'balanced',\n  },\n\n  browLengthRatio: {\n    id: 'browLengthRatio',\n    name: 'Brow Length to Face Width Ratio',\n    category: 'Upper Third',\n    unit: 'percent',\n    idealMin: 28,\n    idealMax: 32,\n    rangeMin: 20,\n    rangeMax: 40,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow length as percentage of face width',\n    profileType: 'front',\n  },\n\n  eyebrowTilt: {\n    id: 'eyebrowTilt',\n    name: 'Eyebrow Tilt',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 6.5,\n    idealMax: 11,\n    rangeMin: -5,\n    rangeMax: 25,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of eyebrow from head to tail',\n    profileType: 'front',\n  },\n\n  eyebrowLowSetedness: {\n    id: 'eyebrowLowSetedness',\n    name: 'Eyebrow Low Setedness',\n    category: 'Upper Third',\n    unit: 'ratio',\n    idealMin: 0,\n    idealMax: 0.45,\n    rangeMin: -0.2,\n    rangeMax: 1.0,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from brow to eye relative to eye height',\n    profileType: 'front',\n  },\n\n  // NOSE MEASUREMENTS (FRONT)\n  nasalIndex: {\n    id: 'nasalIndex',\n    name: 'Nasal Index',\n    category: 'Nose',\n    unit: 'percent',\n    idealMin: 70,\n    idealMax: 85,\n    rangeMin: 55,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose width divided by nose height Ã— 100',\n    profileType: 'front',\n  },\n\n  intercanthalNasalRatio: {\n    id: 'intercanthalNasalRatio',\n    name: 'Intercanthal-Nasal Width Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 1.04,\n    idealMax: 1.16,\n    rangeMin: 0.7,\n    rangeMax: 1.5,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Alar width should roughly equal intercanthal distance',\n    profileType: 'front',\n  },\n\n  noseBridgeWidth: {\n    id: 'noseBridgeWidth',\n    name: 'Nose Bridge to Nose Width',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.6,\n    idealMax: 0.75,\n    rangeMin: 0.4,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ratio of nose bridge width to alar base width',\n    profileType: 'front',\n  },\n\n  noseTipPosition: {\n    id: 'noseTipPosition',\n    name: 'Nose Tip Position',\n    category: 'Nose',\n    unit: 'mm',\n    idealMin: 0.5,\n    idealMax: 3.5,\n    rangeMin: -7.5,\n    rangeMax: 12.5,\n    decayRate: 1.5,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Nose tip deviation from facial midline',\n    profileType: 'front',\n  },\n\n  // MOUTH/LIP MEASUREMENTS\n  mouthWidthToNoseRatio: {\n    id: 'mouthWidthToNoseRatio',\n    name: 'Mouth Width to Nose Width Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.43,\n    idealMax: 1.51,\n    rangeMin: 0.96,\n    rangeMax: 1.91,\n    decayRate: 18.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Mouth width divided by nose width',\n    profileType: 'front',\n  },\n\n  lowerToUpperLipRatio: {\n    id: 'lowerToUpperLipRatio',\n    name: 'Lower Lip to Upper Lip Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.58,\n    idealMax: 1.88,\n    rangeMin: -0.98,\n    rangeMax: 4.03,\n    decayRate: 8.0,\n    maxScore: 7.5,  // FaceIQ: medium priority\n    weight: 0.02,\n    description: 'Lower lip height divided by upper lip height',\n    profileType: 'front',\n  },\n\n  cupidsBowDepth: {\n    id: 'cupidsBowDepth',\n    name: \"Cupid's Bow Depth\",\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2.3,\n    idealMax: 4,\n    rangeMin: 0,\n    rangeMax: 7,\n    decayRate: 2.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: \"Depth of the cupid's bow curve\",\n    profileType: 'front',\n  },\n\n  mouthCornerPosition: {\n    id: 'mouthCornerPosition',\n    name: 'Mouth Corner Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Mouth corner vertical position relative to lip center',\n    profileType: 'front',\n  },\n\n  // CHIN MEASUREMENTS (FRONT)\n  chinToPhiltrumRatio: {\n    id: 'chinToPhiltrumRatio',\n    name: 'Chin to Philtrum Ratio',\n    category: 'Chin',\n    unit: 'ratio',\n    idealMin: 2.15,\n    idealMax: 2.45,\n    rangeMin: 0.3,\n    rangeMax: 4.5,\n    decayRate: 10.0,\n    maxScore: 12.5,  // FaceIQ: medium-high priority\n    weight: 0.02,\n    description: 'Chin height divided by philtrum length',\n    profileType: 'front',\n  },\n\n  // OTHER FRONT MEASUREMENTS\n  iaaJfaDeviation: {\n    id: 'iaaJfaDeviation',\n    name: 'Deviation of IAA & JFA',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 0,\n    idealMax: 2.5,\n    rangeMin: -25,\n    rangeMax: 30,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Deviation between Ipsilateral Alar Angle and Jaw Frontal Angle',\n    profileType: 'front',\n  },\n\n  ipsilateralAlarAngle: {\n    id: 'ipsilateralAlarAngle',\n    name: 'Ipsilateral Alar Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 60,\n    rangeMax: 125,\n    decayRate: 0.6,\n    maxScore: 2.5,  // FaceIQ: low priority\n    weight: 0.01,\n    description: 'Angle of alar base relative to facial plane',\n    profileType: 'front',\n  },\n\n  earProtrusionAngle: {\n    id: 'earProtrusionAngle',\n    name: 'Ear Protrusion Angle',\n    category: 'Ears',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 11.5,\n    rangeMin: -25,\n    rangeMax: 40,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of ear protrusion from head',\n    profileType: 'front',\n  },\n\n  earProtrusionRatio: {\n    id: 'earProtrusionRatio',\n    name: 'Ear Protrusion Ratio',\n    category: 'Ears',\n    unit: 'percent',\n    idealMin: 8,\n    idealMax: 12,\n    rangeMin: -20,\n    rangeMax: 40,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ear protrusion as percentage of head width',\n    profileType: 'front',\n  },\n\n  neckWidth: {\n    id: 'neckWidth',\n    name: 'Neck Width',\n    category: 'Neck',\n    unit: 'percent',\n    idealMin: 92,\n    idealMax: 98,\n    rangeMin: 60,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Neck width as percentage of jaw width',\n    profileType: 'front',\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS (38)\n  // ==========================================\n\n  gonialAngle: {\n    id: 'gonialAngle',\n    name: 'Gonial Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 130,\n    rangeMin: 105,\n    rangeMax: 145,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle at the jaw corner (gonion)',\n    profileType: 'side',\n  },\n\n  nasolabialAngle: {\n    id: 'nasolabialAngle',\n    name: 'Nasolabial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 90,\n    idealMax: 105,\n    rangeMin: 75,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle between columella and upper lip',\n    profileType: 'side',\n  },\n\n  nasofrontalAngle: {\n    id: 'nasofrontalAngle',\n    name: 'Nasofrontal Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 116,\n    idealMax: 128,\n    rangeMin: 90,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the bridge of nose (nasion)',\n    profileType: 'side',\n  },\n\n  nasofacialAngle: {\n    id: 'nasofacialAngle',\n    name: 'Nasofacial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 31,\n    idealMax: 35,\n    rangeMin: 15,\n    rangeMax: 50,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between nose and face plane',\n    profileType: 'side',\n  },\n\n  nasomentaAngle: {\n    id: 'nasomentaAngle',\n    name: 'Nasomental Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 126,\n    idealMax: 131,\n    rangeMin: 105,\n    rangeMax: 155,\n    decayRate: 0.7,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle from nasion to nose tip to chin',\n    profileType: 'side',\n  },\n\n  nasalTipAngle: {\n    id: 'nasalTipAngle',\n    name: 'Nasal Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 105,\n    rangeMin: 70,\n    rangeMax: 120,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the nose tip',\n    profileType: 'side',\n  },\n\n  nasalProjection: {\n    id: 'nasalProjection',\n    name: 'Nasal Projection',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.55,\n    idealMax: 0.6,\n    rangeMin: 0.4,\n    rangeMax: 0.75,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose projection relative to nasal length (Goode ratio)',\n    profileType: 'side',\n  },\n\n  nasalWToHRatio: {\n    id: 'nasalWToHRatio',\n    name: 'Nasal W to H Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.67,\n    idealMax: 0.78,\n    rangeMin: 0.5,\n    rangeMax: 0.95,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Nose width to height ratio from side view',\n    profileType: 'side',\n  },\n\n  noseTipRotationAngle: {\n    id: 'noseTipRotationAngle',\n    name: 'Nose Tip Rotation Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 95,\n    idealMax: 110,\n    rangeMin: 80,\n    rangeMax: 125,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of nose tip rotation',\n    profileType: 'side',\n  },\n\n  frankfortTipAngle: {\n    id: 'frankfortTipAngle',\n    name: 'Frankfort-Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 28,\n    idealMax: 34,\n    rangeMin: 20,\n    rangeMax: 42,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle between Frankfort plane and nose tip',\n    profileType: 'side',\n  },\n\n  mentolabialAngle: {\n    id: 'mentolabialAngle',\n    name: 'Mentolabial Angle',\n    category: 'Lips',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 140,\n    rangeMin: 100,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the labiomental fold',\n    profileType: 'side',\n  },\n\n  zAngle: {\n    id: 'zAngle',\n    name: 'Z Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 75,\n    idealMax: 85,\n    rangeMin: 60,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Merrifield Z-Angle for profile assessment',\n    profileType: 'side',\n  },\n\n  submentalCervicalAngle: {\n    id: 'submentalCervicalAngle',\n    name: 'Submental Cervical Angle',\n    category: 'Neck',\n    unit: 'degrees',\n    idealMin: 94,\n    idealMax: 106,\n    rangeMin: 70,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between chin and neck',\n    profileType: 'side',\n  },\n\n  facialConvexityGlabella: {\n    id: 'facialConvexityGlabella',\n    name: 'Facial Convexity (Glabella)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 165,\n    idealMax: 175,\n    rangeMin: 150,\n    rangeMax: 185,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Facial convexity angle using glabella',\n    profileType: 'side',\n  },\n\n  facialConvexityNasion: {\n    id: 'facialConvexityNasion',\n    name: 'Facial Convexity (Nasion)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 168,\n    idealMax: 178,\n    rangeMin: 155,\n    rangeMax: 190,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial convexity angle using nasion',\n    profileType: 'side',\n  },\n\n  totalFacialConvexity: {\n    id: 'totalFacialConvexity',\n    name: 'Total Facial Convexity',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 135,\n    idealMax: 145,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Complete facial profile convexity measurement',\n    profileType: 'side',\n  },\n\n  facialDepthToHeight: {\n    id: 'facialDepthToHeight',\n    name: 'Facial Depth to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.3,\n    idealMax: 1.44,\n    rangeMin: 0.7,\n    rangeMax: 1.8,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial depth divided by facial height',\n    profileType: 'side',\n  },\n\n  anteriorFacialDepth: {\n    id: 'anteriorFacialDepth',\n    name: 'Anterior Facial Depth',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 64.5,\n    idealMax: 67.5,\n    rangeMin: 45,\n    rangeMax: 95,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Anterior facial projection angle',\n    profileType: 'side',\n  },\n\n  interiorMidfaceProjectionAngle: {\n    id: 'interiorMidfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 50,\n    idealMax: 56,\n    rangeMin: 30,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Interior midface projection from side profile',\n    profileType: 'side',\n  },\n\n  recessionFromFrankfort: {\n    id: 'recessionFromFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'mm',\n    idealMin: 1.5,\n    idealMax: 15,\n    rangeMin: -30,\n    rangeMax: 30,\n    decayRate: 0.3,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin position relative to Frankfort plane',\n    profileType: 'side',\n  },\n\n  mandibularPlaneAngle: {\n    id: 'mandibularPlaneAngle',\n    name: 'Mandibular Plane Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 22,\n    idealMax: 28,\n    rangeMin: 15,\n    rangeMax: 38,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of mandibular plane to Frankfort plane',\n    profileType: 'side',\n  },\n\n  ramusToMandibleRatio: {\n    id: 'ramusToMandibleRatio',\n    name: 'Ramus to Mandible Ratio',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'ratio',\n    idealMin: 0.65,\n    idealMax: 0.75,\n    rangeMin: 0.5,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Ramus height divided by mandible length',\n    profileType: 'side',\n  },\n\n  gonionToMouthLine: {\n    id: 'gonionToMouthLine',\n    name: 'Gonion to Mouth Line',\n    category: 'Jaw Shape',\n    unit: 'mm',\n    idealMin: -5,\n    idealMax: 5,\n    rangeMin: -20,\n    rangeMax: 20,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from gonion to mouth level line',\n    profileType: 'side',\n  },\n\n  // E-LINE MEASUREMENTS\n  eLineUpperLip: {\n    id: 'eLineUpperLip',\n    name: 'Upper Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -4,\n    idealMax: -2,\n    rangeMin: -10,\n    rangeMax: 4,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Upper lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  eLineLowerLip: {\n    id: 'eLineLowerLip',\n    name: 'Lower Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 0,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Lower lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  // S-LINE MEASUREMENTS\n  sLineUpperLip: {\n    id: 'sLineUpperLip',\n    name: 'Upper Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 3,\n    rangeMin: -5,\n    rangeMax: 8,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  sLineLowerLip: {\n    id: 'sLineLowerLip',\n    name: 'Lower Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -0.4,\n    idealMax: 0.4,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 3.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  // BURSTONE LINE\n  burstoneUpperLip: {\n    id: 'burstoneUpperLip',\n    name: 'Upper Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2,\n    idealMax: 4,\n    rangeMin: -2,\n    rangeMax: 8,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  burstoneLowerLip: {\n    id: 'burstoneLowerLip',\n    name: 'Lower Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 1,\n    idealMax: 3,\n    rangeMin: -3,\n    rangeMax: 7,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  // H LINE\n  holdawayHLine: {\n    id: 'holdawayHLine',\n    name: 'Holdaway H Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Holdaway H-line soft tissue assessment',\n    profileType: 'side',\n  },\n\n  // CHIN MEASUREMENTS (SIDE)\n  chinProjection: {\n    id: 'chinProjection',\n    name: 'Chin Projection',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -3,\n    idealMax: 3,\n    rangeMin: -12,\n    rangeMax: 12,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin projection relative to ideal position',\n    profileType: 'side',\n  },\n\n  recessionRelativeToFrankfort: {\n    id: 'recessionRelativeToFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 2,\n    rangeMin: -10,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin recession relative to Frankfort horizontal',\n    profileType: 'side',\n  },\n\n  // FOREHEAD\n  browridgeInclinationAngle: {\n    id: 'browridgeInclinationAngle',\n    name: 'Browridge Inclination Angle',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 18,\n    rangeMin: 0,\n    rangeMax: 28,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the brow ridge from profile',\n    profileType: 'side',\n  },\n\n  upperForeheadSlope: {\n    id: 'upperForeheadSlope',\n    name: 'Upper Forehead Slope',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 5,\n    idealMax: 12,\n    rangeMin: 0,\n    rangeMax: 20,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Slope angle of the upper forehead',\n    profileType: 'side',\n  },\n\n  // MIDFACE PROJECTION\n  midfaceProjectionAngle: {\n    id: 'midfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 95,\n    rangeMin: 75,\n    rangeMax: 105,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of midface projection from profile',\n    profileType: 'side',\n  },\n\n  orbitalVector: {\n    id: 'orbitalVector',\n    name: 'Orbital Vector',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -6,\n    rangeMax: 10,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Relationship of globe to orbital rim',\n    profileType: 'side',\n  },\n\n  skinUniformity: {\n    id: 'skinUniformity',\n    name: 'Skin Uniformity',\n    category: 'Skin Quality',\n    unit: 'ratio',\n    idealMin: 0.90,\n    idealMax: 1.00,\n    rangeMin: 0.50,\n    rangeMax: 1.00,\n    decayRate: 5.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Skin tone evenness and hyperpigmentation. 1.0 = perfectly uniform.',\n    profileType: 'front',\n    polarity: 'higher_is_better',\n    safeFloor: 0.85,  // Acceptable uniformity threshold\n    softZoneScore: 7.5,\n  },\n\n};\n\n// ============================================\n// FLAW MAPPINGS (Extracted from FaceIQ)\n// ============================================\n\nexport interface FlawMapping {\n  category: string;\n  flawName: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n  reasoning: string;\n}\n\nexport const METRIC_FLAW_MAPPINGS: Record<string, FlawMapping[]> = {\n  anteriorFacialDepth: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Anterior Facial Depth measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  bitemporalWidth: [\n    { category: 'Upper Third', flawName: 'Narrow forehead', confidence: 'confirmed', reasoning: 'Reduced bitemporal width indicates a narrower than ideal forehead relative to the cheekbones. This disrupts facial harmony by creating a compressed hairline and forehead, altering the overall shape of the face.' },\n  ],\n  cheekboneHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Low-set cheekbones', confidence: 'confirmed', reasoning: 'Reduced cheekbone height indicates that the cheekbones are positioned lower than ideal. This disrupts facial harmony by creating an unpronounced appearance to the cheekbones and facial structure.' },\n  ],\n  eyeAspectRatio: [\n    { category: 'Eyes', flawName: 'Overly round eye shape', confidence: 'confirmed', reasoning: 'A reduced eye aspect ratio indicates overly narrow eyes relative to their height. This disrupts facial harmony by creating an overly surprised appearance and reducing angular definition.' },\n  ],\n  eyeSeparationRatio: [\n    { category: 'Eyes', flawName: 'Close-set eyes', confidence: 'confirmed', reasoning: 'Reduced eye separation indicates close-set eyes. This disrupts facial harmony by making the eye area appear too compressed.' },\n  ],\n  eyebrowLowSetedness: [\n    { category: 'Eyes', flawName: 'Medium-set eyebrows', confidence: 'confirmed', reasoning: 'Increased eyebrow low setedness indicates eyebrows that are positioned higher than ideal. This disrupts facial harmony by reducing the overall visual impact of the eyebrows and framing of the eyes.' },\n  ],\n  faceWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced face width to height ratio indicates an overly long midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  facialDepthToHeight: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'Reduced facial depth to height ratio indicates insufficient mid-face projection relative to height. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  gonialAngle: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A wider gonial angle indicates a softer, less defined jawline with reduced angularity. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  holdawayHLine: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'Decreased H-line indicates the lips are positioned too far in front of the line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  interiorMidfaceProjectionAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Underprojected midface', confidence: 'confirmed', reasoning: 'The Interior Midface Projection Angle measurement is above the ideal range. This disrupts facial harmony by creating a sunken and unprominent appearance to the midface.' },\n  ],\n  ipsilateralAlarAngle: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A decreased ipsilateral alar angle indicates an overly narrow interior midface. This disrupts facial harmony by overemphasizing the middle of the face.' },\n  ],\n  jawFrontalAngle: [\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A narrower jaw frontal angle indicates a steeper jawline or overly wide chin. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  jawSlope: [\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'The Jaw Slope measurement is above the ideal range. This disrupts facial harmony in the lower face.' },\n  ],\n  lateralCanthalTilt: [\n    { category: 'Eyes', flawName: 'Insufficient eye tilt', confidence: 'confirmed', reasoning: 'A decreased lateral canthal tilt indicates insufficiently upturned eyes. This disrupts facial harmony by creating a less alert and youthful appearance.' },\n  ],\n  burstoneLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the Burstone line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  eLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned too far in front of the E-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  sLineLowerLip: [\n    { category: 'Lips', flawName: 'Overly full lower lip', confidence: 'confirmed', reasoning: 'The lower lip is positioned excessively in front of the S-line. This disrupts facial harmony by drawing attention to the lower lip and creating an imbalance between the lower lip, chin, and nose.' },\n  ],\n  lowerThirdProportion: [\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'The upper jaw is too long relative to lower jaw, possibly from a long upper jaw or short lower jaw, or a combination of both. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  mandibularPlaneAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Hyper-divergent jaw growth', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by elongating the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Weak/soft jaw structure', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony in the lower face.' },\n    { category: 'Jaw Shape', flawName: 'Steep jaw', confidence: 'confirmed', reasoning: 'A steeper mandibular plane angle indicates vertical overgrowth, elongating the lower face and potentially indicating malocclusion. This disrupts facial harmony by creating a narrow or pointed chin effect.' },\n  ],\n  midfaceRatio: [\n    { category: 'Midface/Face Shape', flawName: 'Long midface', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the middle of the face.' },\n    { category: 'Midface/Face Shape', flawName: 'Long upper jaw', confidence: 'confirmed', reasoning: 'A reduced midface ratio indicates an overly narrow interior midface relative to its height. This disrupts facial harmony by overemphasizing the upper jaw relative to the lower jaw.' },\n  ],\n  nasofacialAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A smaller nasofacial angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  nasofrontalAngle: [\n    { category: 'Upper Third', flawName: 'Soft and weak brow ridge', confidence: 'confirmed', reasoning: 'An increased nasofrontal angle indicates reduced brow ridge prominence and angularity. This disrupts facial harmony by creating a less defined upper face.' },\n  ],\n  nasomentaAngle: [\n    { category: 'Occlusion/Jaw Growth', flawName: 'Maxillary recession', confidence: 'confirmed', reasoning: 'A larger nasomental angle suggests reduced projection of the nose and midface region, or an overprojected chin. This disrupts facial harmony by creating the appearance of a flat midface.' },\n  ],\n  noseBridgeWidth: [\n    { category: 'Nose', flawName: 'Overly narrow nose bridge', confidence: 'confirmed', reasoning: 'The Nose Bridge to Nose Width measurement is above the ideal range. This disrupts facial harmony by creating an unbalanced nasal profile.' },\n  ],\n  orbitalVector: [\n    { category: 'Eyes', flawName: 'Sunken orbital region', confidence: 'confirmed', reasoning: 'A decreased orbital vector indicates insufficient projection and volume underneath the eye. This disrupts facial harmony due to the lacking volume underneath the eyes, reducing vibrancy and youthfulness.' },\n  ],\n  ramusToMandibleRatio: [\n    { category: 'Jaw Shape', flawName: 'Short ramus', confidence: 'confirmed', reasoning: 'A reduced ramus-to-mandible ratio indicates a shorter than ideal vertical jawbone (ramus) when compared to the mandible. This disrupts facial harmony by reducing jaw height and definition.' },\n  ],\n  submentalCervicalAngle: [\n    { category: 'Neck', flawName: 'Round neck region', confidence: 'confirmed', reasoning: 'An increased submental cervical angle indicates a round neck region, possibly from excess submental fat or tissue. This disrupts facial harmony by reducing neck definition.' },\n  ],\n  totalFacialWidthToHeight: [\n    { category: 'Midface/Face Shape', flawName: 'Overly long face shape', confidence: 'confirmed', reasoning: 'An increased total facial width to height ratio indicates an overly long face relative to its height. This disrupts facial harmony by creating a vertically stretched appearance to the face.' },\n  ],\n};\n\n// ============================================\n// CUSTOM BEZIER CURVES (Extracted from FaceIQ)\n// ============================================\n\nexport const METRIC_CUSTOM_CURVES: Record<string, CurvePoint[]> = {\n  faceWidthToHeight: [\n    { x: 1.49, y: 0, leftHandleX: 1.44, leftHandleY: 0, rightHandleX: 1.55, rightHandleY: 0 },\n    { x: 1.68, y: 1.05, leftHandleX: 1.62, leftHandleY: 0.36, rightHandleX: 1.71, rightHandleY: 1.58 },\n    { x: 1.77, y: 3.07, leftHandleX: 1.74, leftHandleY: 2.15, rightHandleX: 1.79, rightHandleY: 3.88 },\n    { x: 1.83, y: 5.83, leftHandleX: 1.80, leftHandleY: 4.64, rightHandleX: 1.84, rightHandleY: 6.85 },\n    { x: 1.89, y: 8.70, leftHandleX: 1.88, leftHandleY: 8.30, rightHandleX: 1.92, rightHandleY: 9.50 },\n    { x: 1.96, y: 10, leftHandleX: 1.96, leftHandleY: 10, rightHandleX: 1.96, rightHandleY: 10, fixed: true },\n    { x: 2.00, y: 10, leftHandleX: 2.00, leftHandleY: 10, rightHandleX: 2.00, rightHandleY: 10, fixed: true },\n    { x: 2.07, y: 8.70, leftHandleX: 2.04, leftHandleY: 9.50, rightHandleX: 2.08, rightHandleY: 8.30 },\n    { x: 2.13, y: 5.83, leftHandleX: 2.12, leftHandleY: 6.85, rightHandleX: 2.16, rightHandleY: 4.64 },\n    { x: 2.19, y: 3.07, leftHandleX: 2.17, leftHandleY: 3.88, rightHandleX: 2.22, rightHandleY: 2.15 },\n    { x: 2.28, y: 1.05, leftHandleX: 2.25, leftHandleY: 1.58, rightHandleX: 2.34, rightHandleY: 0.36 },\n    { x: 2.47, y: 0, leftHandleX: 2.41, leftHandleY: 0, rightHandleX: 2.52, rightHandleY: 0 },\n  ],\n  lowerThirdProportion: [\n    { x: 25.6, y: 0, leftHandleX: 24.8, leftHandleY: 0, rightHandleX: 26.4, rightHandleY: 0 },\n    { x: 28.01, y: 1.58, leftHandleX: 27.23, leftHandleY: 0.53, rightHandleX: 28.27, rightHandleY: 1.97 },\n    { x: 28.83, y: 3.21, leftHandleX: 28.60, leftHandleY: 2.60, rightHandleX: 29.10, rightHandleY: 3.90 },\n    { x: 29.63, y: 5.85, leftHandleX: 29.40, leftHandleY: 4.90, rightHandleX: 29.85, rightHandleY: 6.80 },\n    { x: 30.27, y: 8.56, leftHandleX: 30.05, leftHandleY: 7.80, rightHandleX: 30.50, rightHandleY: 9.30 },\n    { x: 31, y: 10, leftHandleX: 30.95, leftHandleY: 10, rightHandleX: 31.05, rightHandleY: 10, fixed: true },\n    { x: 33.5, y: 10, leftHandleX: 33.45, leftHandleY: 10, rightHandleX: 33.55, rightHandleY: 10, fixed: true },\n    { x: 34.23, y: 8.56, leftHandleX: 34.00, leftHandleY: 9.30, rightHandleX: 34.45, rightHandleY: 7.80 },\n    { x: 34.87, y: 5.85, leftHandleX: 34.65, leftHandleY: 6.80, rightHandleX: 35.10, rightHandleY: 4.90 },\n    { x: 35.67, y: 3.21, leftHandleX: 35.40, leftHandleY: 3.90, rightHandleX: 35.90, rightHandleY: 2.60 },\n    { x: 36.49, y: 1.58, leftHandleX: 36.23, leftHandleY: 1.97, rightHandleX: 37.27, rightHandleY: 0.53 },\n    { x: 38.9, y: 0, leftHandleX: 38.1, leftHandleY: 0, rightHandleX: 39.7, rightHandleY: 0 },\n  ],\n  lateralCanthalTilt: [\n    { x: -4.5, y: 0, leftHandleX: -5.5, leftHandleY: 0, rightHandleX: -3.5, rightHandleY: 0 },\n    { x: 0.5, y: 1.2, leftHandleX: -0.8, leftHandleY: 0.4, rightHandleX: 1.5, rightHandleY: 1.8 },\n    { x: 2.8, y: 3.5, leftHandleX: 2.2, leftHandleY: 2.5, rightHandleX: 3.4, rightHandleY: 4.3 },\n    { x: 4.5, y: 6.8, leftHandleX: 4.0, leftHandleY: 5.5, rightHandleX: 5.0, rightHandleY: 7.8 },\n    { x: 5.8, y: 9.2, leftHandleX: 5.4, leftHandleY: 8.5, rightHandleX: 5.95, rightHandleY: 9.7 },\n    { x: 6.1, y: 10, leftHandleX: 6.05, leftHandleY: 10, rightHandleX: 6.15, rightHandleY: 10, fixed: true },\n    { x: 7.8, y: 10, leftHandleX: 7.75, leftHandleY: 10, rightHandleX: 7.85, rightHandleY: 10, fixed: true },\n    { x: 8.1, y: 9.2, leftHandleX: 7.95, leftHandleY: 9.7, rightHandleX: 8.5, rightHandleY: 8.5 },\n    { x: 9.4, y: 6.8, leftHandleX: 8.9, leftHandleY: 7.8, rightHandleX: 9.9, rightHandleY: 5.5 },\n    { x: 11.1, y: 3.5, leftHandleX: 10.5, leftHandleY: 4.3, rightHandleX: 11.7, rightHandleY: 2.5 },\n    { x: 13.4, y: 1.2, leftHandleX: 12.4, leftHandleY: 1.8, rightHandleX: 14.7, rightHandleY: 0.4 },\n    { x: 18.4, y: 0, leftHandleX: 17.4, leftHandleY: 0, rightHandleX: 19.4, rightHandleY: 0 },\n  ],\n  gonialAngle: [\n    { x: 105, y: 0, leftHandleX: 102, leftHandleY: 0, rightHandleX: 108, rightHandleY: 0 },\n    { x: 112, y: 1.5, leftHandleX: 110, leftHandleY: 0.5, rightHandleX: 114, rightHandleY: 2.3 },\n    { x: 116, y: 4.2, leftHandleX: 114.5, leftHandleY: 3.0, rightHandleX: 117.5, rightHandleY: 5.2 },\n    { x: 118.5, y: 7.5, leftHandleX: 117.5, leftHandleY: 6.3, rightHandleX: 119.5, rightHandleY: 8.5 },\n    { x: 120, y: 10, leftHandleX: 119.7, leftHandleY: 10, rightHandleX: 120.3, rightHandleY: 10, fixed: true },\n    { x: 130, y: 10, leftHandleX: 129.7, leftHandleY: 10, rightHandleX: 130.3, rightHandleY: 10, fixed: true },\n    { x: 131.5, y: 7.5, leftHandleX: 130.5, leftHandleY: 8.5, rightHandleX: 132.5, rightHandleY: 6.3 },\n    { x: 134, y: 4.2, leftHandleX: 132.5, leftHandleY: 5.2, rightHandleX: 135.5, rightHandleY: 3.0 },\n    { x: 138, y: 1.5, leftHandleX: 136, leftHandleY: 2.3, rightHandleX: 140, rightHandleY: 0.5 },\n    { x: 145, y: 0, leftHandleX: 142, leftHandleY: 0, rightHandleX: 148, rightHandleY: 0 },\n  ],\n  nasolabialAngle: [\n    { x: 75, y: 0, leftHandleX: 72, leftHandleY: 0, rightHandleX: 78, rightHandleY: 0 },\n    { x: 82, y: 2.0, leftHandleX: 79.5, leftHandleY: 0.7, rightHandleX: 84, rightHandleY: 3.0 },\n    { x: 86, y: 5.5, leftHandleX: 84.5, leftHandleY: 4.2, rightHandleX: 87.5, rightHandleY: 6.8 },\n    { x: 89, y: 8.8, leftHandleX: 88, leftHandleY: 7.8, rightHandleX: 89.7, rightHandleY: 9.5 },\n    { x: 90, y: 10, leftHandleX: 89.8, leftHandleY: 10, rightHandleX: 90.2, rightHandleY: 10, fixed: true },\n    { x: 105, y: 10, leftHandleX: 104.8, leftHandleY: 10, rightHandleX: 105.2, rightHandleY: 10, fixed: true },\n    { x: 106, y: 8.8, leftHandleX: 105.3, leftHandleY: 9.5, rightHandleX: 107, rightHandleY: 7.8 },\n    { x: 109, y: 5.5, leftHandleX: 107.5, leftHandleY: 6.8, rightHandleX: 110.5, rightHandleY: 4.2 },\n    { x: 113, y: 2.0, leftHandleX: 111, leftHandleY: 3.0, rightHandleX: 115.5, rightHandleY: 0.7 },\n    { x: 120, y: 0, leftHandleX: 117, leftHandleY: 0, rightHandleX: 123, rightHandleY: 0 },\n  ],\n  // Middle Third Proportion curve (ideal: 31.4-33.4%)\n  middleThirdProportion: [\n    { x: 21.44, y: 0, leftHandleX: 20.29, leftHandleY: 0, rightHandleX: 23.19, rightHandleY: 0.15 },\n    { x: 25.5, y: 1.35, leftHandleX: 24.18, leftHandleY: 0.53, rightHandleX: 26.17, rightHandleY: 1.79 },\n    { x: 27.34, y: 3.18, leftHandleX: 26.84, leftHandleY: 2.42, rightHandleX: 27.73, rightHandleY: 3.81 },\n    { x: 28.65, y: 5.88, leftHandleX: 28.33, leftHandleY: 4.91, rightHandleX: 28.98, rightHandleY: 6.65 },\n    { x: 29.95, y: 8.55, leftHandleX: 29.41, leftHandleY: 7.58, rightHandleX: 30.45, rightHandleY: 9.35 },\n    { x: 31.4, y: 10, leftHandleX: 31.3, leftHandleY: 10, rightHandleX: 31.5, rightHandleY: 10, fixed: true },\n    { x: 33.4, y: 10, leftHandleX: 33.3, leftHandleY: 10, rightHandleX: 33.5, rightHandleY: 10, fixed: true },\n    { x: 34.85, y: 8.55, leftHandleX: 34.35, leftHandleY: 9.35, rightHandleX: 35.39, rightHandleY: 7.58 },\n    { x: 36.15, y: 5.88, leftHandleX: 35.82, leftHandleY: 6.65, rightHandleX: 36.47, rightHandleY: 4.91 },\n    { x: 37.46, y: 3.18, leftHandleX: 37.07, leftHandleY: 3.81, rightHandleX: 37.96, rightHandleY: 2.42 },\n    { x: 39.3, y: 1.35, leftHandleX: 38.63, leftHandleY: 1.79, rightHandleX: 40.62, rightHandleY: 0.53 },\n    { x: 43.36, y: 0, leftHandleX: 41.61, leftHandleY: 0.15, rightHandleX: 44.51, rightHandleY: 0 },\n  ],\n  // Upper Third Proportion curve (ideal: 30-32%)\n  upperThirdProportion: [\n    { x: 18.75, y: 0.02, leftHandleX: 17.15, leftHandleY: 0.02, rightHandleX: 20.35, rightHandleY: 0.02 },\n    { x: 23.82, y: 1.52, leftHandleX: 22.35, leftHandleY: 0.8, rightHandleX: 24.73, rightHandleY: 2.06 },\n    { x: 26.05, y: 4.06, leftHandleX: 25.48, leftHandleY: 2.86, rightHandleX: 26.41, rightHandleY: 4.99 },\n    { x: 27.19, y: 6.79, leftHandleX: 26.96, leftHandleY: 6.16, rightHandleX: 27.66, rightHandleY: 7.85 },\n    { x: 28.54, y: 9.08, leftHandleX: 28.02, leftHandleY: 8.5, rightHandleX: 28.93, rightHandleY: 9.54 },\n    { x: 30, y: 10, leftHandleX: 29.9, leftHandleY: 10, rightHandleX: 30.1, rightHandleY: 10, fixed: true },\n    { x: 32, y: 10, leftHandleX: 31.9, leftHandleY: 10, rightHandleX: 32.1, rightHandleY: 10, fixed: true },\n    { x: 33.46, y: 9.08, leftHandleX: 33.07, leftHandleY: 9.54, rightHandleX: 33.98, rightHandleY: 8.5 },\n    { x: 34.81, y: 6.79, leftHandleX: 34.34, leftHandleY: 7.85, rightHandleX: 35.04, rightHandleY: 6.16 },\n    { x: 35.95, y: 4.06, leftHandleX: 35.59, leftHandleY: 4.99, rightHandleX: 36.52, rightHandleY: 2.86 },\n    { x: 38.18, y: 1.52, leftHandleX: 37.27, leftHandleY: 2.06, rightHandleX: 39.65, rightHandleY: 0.8 },\n    { x: 43.25, y: 0.02, leftHandleX: 41.65, leftHandleY: 0.02, rightHandleX: 44.85, rightHandleY: 0.02 },\n  ],\n  // Eye Separation Ratio curve (ideal: 45.7-46.8%)\n  eyeSeparationRatio: [\n    { x: 36.54, y: 0, leftHandleX: 35.44, leftHandleY: 0, rightHandleX: 37.40, rightHandleY: 0.04 },\n    { x: 39.04, y: 0.63, leftHandleX: 38.16, leftHandleY: 0.21, rightHandleX: 39.77, rightHandleY: 1.05 },\n    { x: 41.08, y: 2.17, leftHandleX: 40.57, leftHandleY: 1.71, rightHandleX: 41.62, rightHandleY: 2.76 },\n    { x: 42.71, y: 4.74, leftHandleX: 42.26, leftHandleY: 3.81, rightHandleX: 43.08, rightHandleY: 5.52 },\n    { x: 43.94, y: 7.37, leftHandleX: 43.65, leftHandleY: 6.79, rightHandleX: 44.17, rightHandleY: 7.77 },\n    { x: 44.86, y: 9.02, leftHandleX: 44.54, leftHandleY: 8.56, rightHandleX: 45.08, rightHandleY: 9.5 },\n    { x: 45.7, y: 10, leftHandleX: 45.65, leftHandleY: 10, rightHandleX: 45.76, rightHandleY: 10, fixed: true },\n    { x: 46.8, y: 10, leftHandleX: 46.75, leftHandleY: 10, rightHandleX: 46.86, rightHandleY: 10, fixed: true },\n    { x: 47.64, y: 9.02, leftHandleX: 47.42, leftHandleY: 9.5, rightHandleX: 47.96, rightHandleY: 8.56 },\n    { x: 48.56, y: 7.37, leftHandleX: 48.33, leftHandleY: 7.77, rightHandleX: 48.85, rightHandleY: 6.79 },\n    { x: 49.79, y: 4.74, leftHandleX: 49.42, leftHandleY: 5.52, rightHandleX: 50.24, rightHandleY: 3.81 },\n    { x: 51.42, y: 2.17, leftHandleX: 50.88, leftHandleY: 2.76, rightHandleX: 51.93, rightHandleY: 1.71 },\n    { x: 53.46, y: 0.63, leftHandleX: 52.73, leftHandleY: 1.05, rightHandleX: 54.34, rightHandleY: 0.21 },\n    { x: 55.96, y: 0, leftHandleX: 55.10, leftHandleY: 0.04, rightHandleX: 57.06, rightHandleY: 0 },\n  ],\n  // Eyebrow Low Setedness curve (ideal: 0-0.45)\n  eyebrowLowSetedness: [\n    { x: -2.78, y: 0, leftHandleX: -3.11, leftHandleY: 0, rightHandleX: -2.67, rightHandleY: 0 },\n    { x: -1.94, y: 0.4, leftHandleX: -2.08, leftHandleY: 0.11, rightHandleX: -1.81, rightHandleY: 0.57 },\n    { x: -1.18, y: 2.25, leftHandleX: -1.36, leftHandleY: 1.5, rightHandleX: -1.05, rightHandleY: 2.72 },\n    { x: -0.79, y: 4.06, leftHandleX: -0.88, leftHandleY: 3.43, rightHandleX: -0.68, rightHandleY: 4.84 },\n    { x: -0.55, y: 6.21, leftHandleX: -0.58, leftHandleY: 5.55, rightHandleX: -0.47, rightHandleY: 6.92 },\n    { x: -0.28, y: 8.76, leftHandleX: -0.37, leftHandleY: 8.23, rightHandleX: -0.23, rightHandleY: 9.22 },\n    { x: 0, y: 10, leftHandleX: -0.02, leftHandleY: 10, rightHandleX: 0.02, rightHandleY: 10, fixed: true },\n    { x: 0.45, y: 10, leftHandleX: 0.43, leftHandleY: 10, rightHandleX: 0.47, rightHandleY: 10, fixed: true },\n    { x: 0.73, y: 8.76, leftHandleX: 0.68, leftHandleY: 9.22, rightHandleX: 0.82, rightHandleY: 8.23 },\n    { x: 1, y: 6.21, leftHandleX: 0.92, leftHandleY: 6.92, rightHandleX: 1.03, rightHandleY: 5.55 },\n    { x: 1.24, y: 4.06, leftHandleX: 1.13, leftHandleY: 4.84, rightHandleX: 1.33, rightHandleY: 3.43 },\n    { x: 1.63, y: 2.25, leftHandleX: 1.50, leftHandleY: 2.72, rightHandleX: 1.81, rightHandleY: 1.5 },\n    { x: 2.39, y: 0.4, leftHandleX: 2.26, leftHandleY: 0.57, rightHandleX: 2.53, rightHandleY: 0.11 },\n    { x: 3.23, y: 0, leftHandleX: 3.12, leftHandleY: 0, rightHandleX: 3.56, rightHandleY: 0 },\n  ],\n  // Submental Cervical Angle curve (ideal: 94-106Â°)\n  submentalCervicalAngle: [\n    { x: 50.48, y: 0, leftHandleX: 44.48, leftHandleY: 0, rightHandleX: 56.48, rightHandleY: 0 },\n    { x: 68.31, y: 1.31, leftHandleX: 62.07, leftHandleY: 0.32, rightHandleX: 72.89, rightHandleY: 2.13 },\n    { x: 77.76, y: 3.71, leftHandleX: 76.00, leftHandleY: 2.89, rightHandleX: 80.39, rightHandleY: 4.59 },\n    { x: 83.99, y: 6.53, leftHandleX: 82.63, leftHandleY: 5.85, rightHandleX: 85.16, rightHandleY: 7.12 },\n    { x: 88.28, y: 8.86, leftHandleX: 86.43, leftHandleY: 7.85, rightHandleX: 89.95, rightHandleY: 9.71 },\n    { x: 94, y: 10, leftHandleX: 93.4, leftHandleY: 10, rightHandleX: 94.6, rightHandleY: 10, fixed: true },\n    { x: 106, y: 10, leftHandleX: 105.4, leftHandleY: 10, rightHandleX: 106.6, rightHandleY: 10, fixed: true },\n    { x: 111.72, y: 8.86, leftHandleX: 110.05, leftHandleY: 9.71, rightHandleX: 113.57, rightHandleY: 7.85 },\n    { x: 116.01, y: 6.53, leftHandleX: 114.84, leftHandleY: 7.12, rightHandleX: 117.37, rightHandleY: 5.85 },\n    { x: 122.24, y: 3.71, leftHandleX: 119.61, leftHandleY: 4.59, rightHandleX: 124.00, rightHandleY: 2.89 },\n    { x: 131.69, y: 1.31, leftHandleX: 127.11, leftHandleY: 2.13, rightHandleX: 137.93, rightHandleY: 0.32 },\n    { x: 149.52, y: 0, leftHandleX: 143.52, leftHandleY: 0, rightHandleX: 155.52, rightHandleY: 0 },\n  ],\n  // Facial Convexity (Glabella) curve (ideal: 169-174Â°)\n  facialConvexityGlabella: [\n    { x: 149.21, y: 0, leftHandleX: 146.21, leftHandleY: 0, rightHandleX: 152.21, rightHandleY: 0 },\n    { x: 158.07, y: 1.41, leftHandleX: 156.03, leftHandleY: 0.74, rightHandleX: 159.63, rightHandleY: 2 },\n    { x: 162.12, y: 4.09, leftHandleX: 161.34, leftHandleY: 3.31, rightHandleX: 163.09, rightHandleY: 5.03 },\n    { x: 165.14, y: 7.76, leftHandleX: 164.46, leftHandleY: 6.56, rightHandleX: 165.54, rightHandleY: 8.29 },\n    { x: 166.65, y: 9.14, leftHandleX: 165.92, leftHandleY: 8.72, rightHandleX: 167.43, rightHandleY: 9.67 },\n    { x: 169, y: 10, leftHandleX: 168.75, leftHandleY: 10, rightHandleX: 169.25, rightHandleY: 10, fixed: true },\n    { x: 174, y: 10, leftHandleX: 173.75, leftHandleY: 10, rightHandleX: 174.25, rightHandleY: 10, fixed: true },\n    { x: 176.35, y: 9.14, leftHandleX: 175.57, leftHandleY: 9.67, rightHandleX: 177.08, rightHandleY: 8.72 },\n    { x: 177.86, y: 7.76, leftHandleX: 177.46, leftHandleY: 8.29, rightHandleX: 178.54, rightHandleY: 6.56 },\n    { x: 180.88, y: 4.09, leftHandleX: 179.91, leftHandleY: 5.03, rightHandleX: 181.66, rightHandleY: 3.31 },\n    { x: 184.93, y: 1.41, leftHandleX: 183.37, leftHandleY: 2, rightHandleX: 186.97, rightHandleY: 0.74 },\n    { x: 193.79, y: 0, leftHandleX: 190.79, leftHandleY: 0, rightHandleX: 196.79, rightHandleY: 0 },\n  ],\n};\n\n// ============================================\n// CATEGORY DEFINITIONS\n// ============================================\n\nexport const MEASUREMENT_CATEGORIES = {\n  'Midface/Face Shape': { color: '#67e8f9', weight: 0.20 },\n  'Occlusion/Jaw Growth': { color: '#a78bfa', weight: 0.15 },\n  'Jaw Shape': { color: '#f97316', weight: 0.13 },\n  'Upper Third': { color: '#84cc16', weight: 0.08 },\n  'Eyes': { color: '#06b6d4', weight: 0.12 },\n  'Nose': { color: '#fbbf24', weight: 0.10 },\n  'Lips': { color: '#ec4899', weight: 0.10 },\n  'Chin': { color: '#ef4444', weight: 0.06 },\n  'Neck': { color: '#14b8a6', weight: 0.03 },\n  'Other': { color: '#6b7280', weight: 0.03 },\n};\n\n// ============================================\n// CORE SCORING FUNCTIONS\n// ============================================\n\n/**\n * FaceIQ Exponential Decay Scoring Algorithm with Directional/Dimorphic Support\n *\n * Standard: score = maxScore Ã— e^(-decayRate Ã— deviation)\n *\n * Directional scoring (polarity):\n * - 'higher_is_better': Values above safeFloor but below ideal get softZoneScore\n *   Example: Canthal Tilt of 3Â° is still positive/good, just not peak ideal (6-8Â°)\n * - 'lower_is_better': Values below safeCeiling but above ideal get softZoneScore\n *   Example: Short philtrum is still attractive even if shorter than \"ideal\"\n */\nexport function calculateFaceIQScore(\n  value: number,\n  config: MetricConfig\n): number {\n  const {\n    idealMin,\n    idealMax,\n    decayRate,\n    maxScore,\n    customCurve,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n    softZoneScore = 8.0, // Default \"Good\" score for acceptable-but-not-ideal values\n  } = config;\n\n  // Use custom curve if available\n  if (customCurve && customCurve.mode === 'custom') {\n    return interpolateCustomCurve(value, customCurve.points, maxScore);\n  }\n\n  // Perfect score within ideal range\n  if (value >= idealMin && value <= idealMax) {\n    return maxScore;\n  }\n\n  // Handle directional/dimorphic scoring\n  if (polarity === 'higher_is_better' && safeFloor !== undefined) {\n    // Higher values are good. Only values below safeFloor are true weaknesses.\n    if (value >= safeFloor && value < idealMin) {\n      // Value is in the \"acceptable but not ideal\" zone\n      // Give a passing score that decreases linearly as we approach the floor\n      const zoneRange = idealMin - safeFloor;\n      const distanceFromIdeal = idealMin - value;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMin â†’ maxScore, safeFloor â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value >= idealMax) {\n      // Values above ideal are still excellent for 'higher_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = value - idealMax;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Below safeFloor - apply normal (or harsher) exponential decay\n    if (value < safeFloor) {\n      const deviation = safeFloor - value;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  if (polarity === 'lower_is_better' && safeCeiling !== undefined) {\n    // Lower values are good. Only values above safeCeiling are true weaknesses.\n    if (value <= safeCeiling && value > idealMax) {\n      // Value is in the \"acceptable but not ideal\" zone\n      const zoneRange = safeCeiling - idealMax;\n      const distanceFromIdeal = value - idealMax;\n      const t = zoneRange > 0 ? distanceFromIdeal / zoneRange : 0;\n      // Linear interpolation: idealMax â†’ maxScore, safeCeiling â†’ softZoneScore\n      return maxScore - t * (maxScore - softZoneScore);\n    }\n    if (value <= idealMin) {\n      // Values below ideal are still excellent for 'lower_is_better'\n      // Apply gentler decay (1/3 the normal rate)\n      const deviation = idealMin - value;\n      const gentleDecay = decayRate / 3;\n      return Math.max(softZoneScore, maxScore * Math.exp(-gentleDecay * deviation));\n    }\n    // Above safeCeiling - apply normal exponential decay\n    if (value > safeCeiling) {\n      const deviation = value - safeCeiling;\n      return Math.max(0, softZoneScore * Math.exp(-decayRate * deviation));\n    }\n  }\n\n  // Default balanced scoring: deviation in either direction is equally bad\n  const deviation = value < idealMin\n    ? idealMin - value\n    : value - idealMax;\n\n  // Exponential decay\n  const score = maxScore * Math.exp(-decayRate * deviation);\n\n  return Math.max(0, Math.min(maxScore, score));\n}\n\n/**\n * Check if a metric value is in an \"acceptable\" zone (not a true weakness).\n * Used by InsightsEngine to prevent false positives.\n */\nexport function isValueAcceptable(\n  value: number,\n  config: MetricConfig\n): { acceptable: boolean; reason: string } {\n  const {\n    idealMin,\n    idealMax,\n    polarity = 'balanced',\n    safeFloor,\n    safeCeiling,\n  } = config;\n\n  // Within ideal range is always acceptable\n  if (value >= idealMin && value <= idealMax) {\n    return { acceptable: true, reason: 'within_ideal' };\n  }\n\n  // Check directional acceptability\n  if (polarity === 'higher_is_better') {\n    if (value >= idealMax) {\n      return { acceptable: true, reason: 'above_ideal_higher_is_better' };\n    }\n    if (safeFloor !== undefined && value >= safeFloor) {\n      return { acceptable: true, reason: 'above_safe_floor' };\n    }\n    // Below safe floor - true weakness\n    return { acceptable: false, reason: 'below_safe_floor' };\n  }\n\n  if (polarity === 'lower_is_better') {\n    if (value <= idealMin) {\n      return { acceptable: true, reason: 'below_ideal_lower_is_better' };\n    }\n    if (safeCeiling !== undefined && value <= safeCeiling) {\n      return { acceptable: true, reason: 'below_safe_ceiling' };\n    }\n    // Above safe ceiling - true weakness\n    return { acceptable: false, reason: 'above_safe_ceiling' };\n  }\n\n  // Balanced polarity - outside ideal is not acceptable\n  return { acceptable: false, reason: 'outside_ideal_balanced' };\n}\n\n/**\n * Interpolate custom Bezier curve for scoring\n * Uses cubic Bezier interpolation with control handles for smooth curves\n */\nfunction interpolateCustomCurve(\n  value: number,\n  points: CurvePoint[],\n  maxScore: number\n): number {\n  void maxScore; // Reserved for future custom curve implementations\n  if (points.length === 0) return 0;\n\n  // Sort points by x value\n  const sortedPoints = [...points].sort((a, b) => a.x - b.x);\n\n  // Clamp to range\n  if (value <= sortedPoints[0].x) return sortedPoints[0].y;\n  if (value >= sortedPoints[sortedPoints.length - 1].x) {\n    return sortedPoints[sortedPoints.length - 1].y;\n  }\n\n  // Find bracketing points\n  let lowerIndex = 0;\n  for (let i = 0; i < sortedPoints.length - 1; i++) {\n    if (value >= sortedPoints[i].x && value <= sortedPoints[i + 1].x) {\n      lowerIndex = i;\n      break;\n    }\n  }\n\n  const p0 = sortedPoints[lowerIndex];\n  const p3 = sortedPoints[lowerIndex + 1];\n\n  // Check if we have Bezier control handles\n  const hasHandles = p0.rightHandleX !== undefined && p3.leftHandleX !== undefined;\n\n  if (hasHandles) {\n    // Cubic Bezier interpolation with control points\n    const p1x = p0.rightHandleX!;\n    const p1y = p0.rightHandleY ?? p0.y;\n    const p2x = p3.leftHandleX!;\n    const p2y = p3.leftHandleY ?? p3.y;\n\n    // Find t parameter for given x value using Newton-Raphson iteration\n    let t = (value - p0.x) / (p3.x - p0.x); // Initial guess\n\n    // Newton-Raphson iterations to find t where B_x(t) = value\n    for (let iter = 0; iter < 10; iter++) {\n      const bx = cubicBezier(p0.x, p1x, p2x, p3.x, t);\n      const bxDerivative = cubicBezierDerivative(p0.x, p1x, p2x, p3.x, t);\n\n      if (Math.abs(bxDerivative) < 1e-10) break;\n\n      const newT = t - (bx - value) / bxDerivative;\n      if (Math.abs(newT - t) < 1e-10) break;\n      t = Math.max(0, Math.min(1, newT));\n    }\n\n    // Calculate y using the found t parameter\n    return cubicBezier(p0.y, p1y, p2y, p3.y, t);\n  } else {\n    // Smooth interpolation using Catmull-Rom spline\n    // This provides smoother curves than linear interpolation\n    const t = (value - p0.x) / (p3.x - p0.x);\n\n    // Get neighboring points for spline calculation\n    const pMinus1 = lowerIndex > 0 ? sortedPoints[lowerIndex - 1] : p0;\n    const p4 = lowerIndex + 2 < sortedPoints.length ? sortedPoints[lowerIndex + 2] : p3;\n\n    // Catmull-Rom spline interpolation\n    return catmullRomSpline(pMinus1.y, p0.y, p3.y, p4.y, t);\n  }\n}\n\n/**\n * Cubic Bezier curve evaluation: B(t) = (1-t)Â³P0 + 3(1-t)Â²tP1 + 3(1-t)tÂ²P2 + tÂ³P3\n */\nfunction cubicBezier(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  const mt2 = mt * mt;\n  const mt3 = mt2 * mt;\n  const t2 = t * t;\n  const t3 = t2 * t;\n  return mt3 * p0 + 3 * mt2 * t * p1 + 3 * mt * t2 * p2 + t3 * p3;\n}\n\n/**\n * Cubic Bezier derivative: B'(t) = 3(1-t)Â²(P1-P0) + 6(1-t)t(P2-P1) + 3tÂ²(P3-P2)\n */\nfunction cubicBezierDerivative(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const mt = 1 - t;\n  return 3 * mt * mt * (p1 - p0) + 6 * mt * t * (p2 - p1) + 3 * t * t * (p3 - p2);\n}\n\n/**\n * Catmull-Rom spline interpolation for smooth curves without explicit handles\n */\nfunction catmullRomSpline(p0: number, p1: number, p2: number, p3: number, t: number): number {\n  const t2 = t * t;\n  const t3 = t2 * t;\n\n  // Catmull-Rom coefficients with tension = 0.5\n  const a = -0.5 * p0 + 1.5 * p1 - 1.5 * p2 + 0.5 * p3;\n  const b = p0 - 2.5 * p1 + 2 * p2 - 0.5 * p3;\n  const c = -0.5 * p0 + 0.5 * p2;\n  const d = p1;\n\n  return a * t3 + b * t2 + c * t + d;\n}\n\n/**\n * Calculate standardized score (0-10 normalized)\n */\nexport function standardizeScore(score: number, maxScore: number): number {\n  return (score / maxScore) * 10;\n}\n\n/**\n * Determine quality tier based on score\n */\nexport function getQualityTier(score: number, maxScore: number = 10): QualityTier {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 90) return 'ideal';\n  if (normalized >= 70) return 'excellent';\n  if (normalized >= 50) return 'good';\n  return 'below_average';\n}\n\n/**\n * Determine severity level based on score\n */\nexport function getSeverityLevel(score: number, maxScore: number = 10): SeverityLevel {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 85) return 'optimal';\n  if (normalized >= 70) return 'minor';\n  if (normalized >= 50) return 'moderate';\n  if (normalized >= 30) return 'major';\n  if (normalized >= 15) return 'severe';\n  return 'extremely_severe';\n}\n\n/**\n * Calculate deviation description\n */\nexport function getDeviationDescription(\n  value: number,\n  idealMin: number,\n  idealMax: number,\n  unit: MeasurementUnit\n): { deviation: number; direction: 'above' | 'below' | 'within'; description: string } {\n  if (value >= idealMin && value <= idealMax) {\n    return { deviation: 0, direction: 'within', description: 'within ideal range' };\n  }\n\n  const unitLabel = getUnitLabel(unit);\n\n  if (value < idealMin) {\n    const dev = idealMin - value;\n    return {\n      deviation: dev,\n      direction: 'below',\n      description: `${dev.toFixed(2)}${unitLabel} below ideal`,\n    };\n  }\n\n  const dev = value - idealMax;\n  return {\n    deviation: dev,\n    direction: 'above',\n    description: `${dev.toFixed(2)}${unitLabel} above ideal`,\n  };\n}\n\nfunction getUnitLabel(unit: MeasurementUnit): string {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return 'Â°';\n    case 'mm': return 'mm';\n    default: return '';\n  }\n}\n\n// ============================================\n// MEASUREMENT CALCULATION UTILITIES\n// ============================================\n\n/**\n * Calculate distance between two points\n */\nexport function distance(p1: Point, p2: Point): number {\n  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n}\n\n/**\n * Calculate angle at vertex point (in degrees)\n */\nexport function calculateAngle(p1: Point, vertex: Point, p2: Point): number {\n  const v1 = { x: p1.x - vertex.x, y: p1.y - vertex.y };\n  const v2 = { x: p2.x - vertex.x, y: p2.y - vertex.y };\n\n  const dot = v1.x * v2.x + v1.y * v2.y;\n  const cross = v1.x * v2.y - v1.y * v2.x;\n\n  const angle = Math.atan2(cross, dot) * (180 / Math.PI);\n  return Math.abs(angle);\n}\n\n/**\n * Calculate perpendicular distance from point to line (signed)\n */\nexport function perpendicularDistance(\n  point: Point,\n  lineStart: Point,\n  lineEnd: Point\n): number {\n  const A = point.x - lineStart.x;\n  const B = point.y - lineStart.y;\n  const C = lineEnd.x - lineStart.x;\n  const D = lineEnd.y - lineStart.y;\n\n  const dot = A * C + B * D;\n  const lenSq = C * C + D * D;\n  const param = lenSq !== 0 ? dot / lenSq : -1;\n\n  let xx: number, yy: number;\n\n  if (param < 0) {\n    xx = lineStart.x;\n    yy = lineStart.y;\n  } else if (param > 1) {\n    xx = lineEnd.x;\n    yy = lineEnd.y;\n  } else {\n    xx = lineStart.x + param * C;\n    yy = lineStart.y + param * D;\n  }\n\n  const dx = point.x - xx;\n  const dy = point.y - yy;\n\n  const sign =\n    (lineEnd.y - lineStart.y) * point.x -\n      (lineEnd.x - lineStart.x) * point.y +\n      lineEnd.x * lineStart.y -\n      lineEnd.y * lineStart.x >=\n    0\n      ? 1\n      : -1;\n\n  return sign * Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Helper to get landmark by ID\n */\nfunction getLandmark(landmarks: LandmarkPoint[], id: string): Point | null {\n  const lm = landmarks.find((l) => l.id === id);\n  return lm ? { x: lm.x, y: lm.y } : null;\n}\n\n// ============================================\n// SCORE A SINGLE MEASUREMENT\n// ============================================\n\nexport interface DemographicOptions {\n  gender?: Gender;\n  ethnicity?: Ethnicity;\n}\n\n/**\n * Calculate complete score result for a measurement.\n * If demographics provided, uses demographic-specific ideal ranges.\n */\nexport function scoreMeasurement(\n  metricId: string,\n  value: number,\n  demographics?: DemographicOptions\n): FaceIQScoreResult | null {\n  // Get config with demographic overrides if provided\n  const config = demographics?.gender\n    ? getMetricConfigForDemographics(metricId, demographics.gender, demographics.ethnicity || 'other')\n    : FACEIQ_METRICS[metricId];\n\n  if (!config) return null;\n\n  const score = calculateFaceIQScore(value, config);\n  const standardizedScore = standardizeScore(score, config.maxScore);\n  const qualityTier = getQualityTier(score, config.maxScore);\n  const severity = getSeverityLevel(score, config.maxScore);\n  const { deviation, direction } = getDeviationDescription(\n    value,\n    config.idealMin,\n    config.idealMax,\n    config.unit\n  );\n\n  return {\n    metricId,\n    name: config.name,\n    value,\n    score,\n    standardizedScore,\n    qualityTier,\n    severity,\n    idealMin: config.idealMin,\n    idealMax: config.idealMax,\n    deviation,\n    deviationDirection: direction,\n    unit: config.unit,\n    category: config.category,\n  };\n}\n\n// ============================================\n// FRONT PROFILE ANALYSIS\n// ============================================\n\nexport interface FrontProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all front profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeFrontProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): FrontProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  // Helper to add measurement if landmarks available\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const trichion = getLandmark(landmarks, 'trichion');\n  const nasalBase = getLandmark(landmarks, 'nasal_base');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const menton = getLandmark(landmarks, 'menton');\n  const leftZygion = getLandmark(landmarks, 'left_zygion');\n  const rightZygion = getLandmark(landmarks, 'right_zygion');\n  const leftGonion = getLandmark(landmarks, 'left_gonion_inferior');\n  const rightGonion = getLandmark(landmarks, 'right_gonion_inferior');\n  const leftPupil = getLandmark(landmarks, 'left_pupila');\n  const rightPupil = getLandmark(landmarks, 'right_pupila');\n  const leftCanthusM = getLandmark(landmarks, 'left_canthus_medialis');\n  const leftCanthusL = getLandmark(landmarks, 'left_canthus_lateralis');\n  const rightCanthusM = getLandmark(landmarks, 'right_canthus_medialis');\n  const rightCanthusL = getLandmark(landmarks, 'right_canthus_lateralis');\n  void rightCanthusL; // Will be used for asymmetry measurements\n  const leftAlaNasi = getLandmark(landmarks, 'left_ala_nasi');\n  const rightAlaNasi = getLandmark(landmarks, 'right_ala_nasi');\n  const leftCheilion = getLandmark(landmarks, 'left_cheilion');\n  const rightCheilion = getLandmark(landmarks, 'right_cheilion');\n  const labraleSuperius = getLandmark(landmarks, 'labrale_superius');\n  const labraleInferius = getLandmark(landmarks, 'labrale_inferius');\n\n  // FACIAL THIRDS\n  if (trichion && nasalBase && subnasale && menton) {\n    const totalHeight = distance(trichion, menton);\n    if (totalHeight > 0) {\n      const upperThird = (distance(trichion, nasalBase) / totalHeight) * 100;\n      const middleThird = (distance(nasalBase, subnasale) / totalHeight) * 100;\n      const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n\n      addMeasurement('upperThirdProportion', upperThird);\n      addMeasurement('middleThirdProportion', middleThird);\n      addMeasurement('lowerThirdProportion', lowerThird);\n    }\n  }\n\n  // FACE WIDTH TO HEIGHT RATIO (FWHR)\n  if (leftZygion && rightZygion && nasalBase && labraleSuperius) {\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    const upperFaceHeight = distance(nasalBase, labraleSuperius);\n    if (upperFaceHeight > 0) {\n      addMeasurement('faceWidthToHeight', bizygomaticWidth / upperFaceHeight);\n    }\n  }\n\n  // TOTAL FACIAL WIDTH TO HEIGHT\n  if (leftZygion && rightZygion && trichion && menton) {\n    const cheekWidth = distance(leftZygion, rightZygion);\n    const totalHeight = distance(trichion, menton);\n    if (cheekWidth > 0) {\n      addMeasurement('totalFacialWidthToHeight', totalHeight / cheekWidth);\n    }\n  }\n\n  // JAW WIDTH RATIO\n  if (leftGonion && rightGonion && leftZygion && rightZygion) {\n    const bigonialWidth = distance(leftGonion, rightGonion);\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    if (bizygomaticWidth > 0) {\n      const ratio = bigonialWidth / bizygomaticWidth;\n      addMeasurement('jawWidthRatio', ratio);\n      addMeasurement('bigonialWidth', ratio * 100);\n    }\n  }\n\n  // CANTHAL TILT\n  if (leftCanthusM && leftCanthusL) {\n    const deltaY = leftCanthusM.y - leftCanthusL.y;\n    const deltaX = leftCanthusL.x - leftCanthusM.x;\n    const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);\n    addMeasurement('lateralCanthalTilt', angle);\n  }\n\n  // EYE ASPECT RATIO\n  if (leftCanthusM && leftCanthusL) {\n    const leftPalpSup = getLandmark(landmarks, 'left_palpebra_superior');\n    const leftPalpInf = getLandmark(landmarks, 'left_palpebra_inferior');\n    if (leftPalpSup && leftPalpInf) {\n      const eyeWidth = distance(leftCanthusM, leftCanthusL);\n      const eyeHeight = distance(leftPalpSup, leftPalpInf);\n      if (eyeWidth > 0) {\n        addMeasurement('eyeAspectRatio', eyeHeight / eyeWidth);\n      }\n    }\n  }\n\n  // EYE SEPARATION RATIO\n  if (leftCanthusM && rightCanthusM && leftZygion && rightZygion) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('eyeSeparationRatio', intercanthal / bizygomatic);\n    }\n  }\n\n  // IPD RATIO\n  if (leftPupil && rightPupil && leftZygion && rightZygion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('interpupillaryRatio', (ipd / bizygomatic) * 100);\n    }\n  }\n\n  // ONE EYE APART TEST\n  if (leftCanthusM && rightCanthusM && leftCanthusL) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const eyeWidth = distance(leftCanthusM, leftCanthusL);\n    if (eyeWidth > 0) {\n      addMeasurement('oneEyeApartTest', intercanthal / eyeWidth);\n    }\n  }\n\n  // NASAL INDEX\n  if (leftAlaNasi && rightAlaNasi && nasalBase && subnasale) {\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    const nasalHeight = distance(nasalBase, subnasale);\n    if (nasalHeight > 0) {\n      addMeasurement('nasalIndex', (nasalWidth / nasalHeight) * 100);\n    }\n  }\n\n  // INTERCANTHAL-NASAL WIDTH RATIO\n  if (leftCanthusM && rightCanthusM && leftAlaNasi && rightAlaNasi) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('intercanthalNasalRatio', intercanthal / nasalWidth);\n    }\n  }\n\n  // MOUTH TO NOSE RATIO\n  if (leftCheilion && rightCheilion && leftAlaNasi && rightAlaNasi) {\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('mouthWidthToNoseRatio', mouthWidth / nasalWidth);\n    }\n  }\n\n  // IPD TO MOUTH WIDTH RATIO\n  if (leftPupil && rightPupil && leftCheilion && rightCheilion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    if (ipd > 0) {\n      addMeasurement('interpupillaryMouthWidthRatio', mouthWidth / ipd);\n    }\n  }\n\n  // LIP RATIO\n  if (labraleSuperius && labraleInferius && subnasale) {\n    const mouthMiddle = getLandmark(landmarks, 'mouth_middle');\n    if (mouthMiddle) {\n      const upperLipHeight = distance(subnasale, labraleSuperius);\n      const lowerLipHeight = distance(mouthMiddle, labraleInferius);\n      if (upperLipHeight > 0) {\n        addMeasurement('lowerToUpperLipRatio', lowerLipHeight / upperLipHeight);\n      }\n    }\n  }\n\n  // MIDFACE RATIO\n  if (leftZygion && rightZygion && nasalBase && subnasale) {\n    const midfaceWidth = distance(leftZygion, rightZygion);\n    const midfaceHeight = distance(nasalBase, subnasale);\n    if (midfaceHeight > 0) {\n      addMeasurement('midfaceRatio', midfaceWidth / midfaceHeight / 10); // Normalized\n    }\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score (weighted average)\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n  const standardizedScore = overallScore;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// SIDE PROFILE ANALYSIS\n// ============================================\n\nexport interface SideProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all side profile measurements from landmarks.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeSideProfile(\n  landmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): SideProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n  const demographics: DemographicOptions = { gender, ethnicity };\n\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value, demographics);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const glabella = getLandmark(landmarks, 'glabella');\n  const nasion = getLandmark(landmarks, 'nasion');\n  const rhinion = getLandmark(landmarks, 'rhinion');\n  const pronasale = getLandmark(landmarks, 'pronasale');\n  const columella = getLandmark(landmarks, 'columella');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const labraleSuperius = getLandmark(landmarks, 'labraleSuperius');\n  const labraleInferius = getLandmark(landmarks, 'labraleInferius');\n  const sublabiale = getLandmark(landmarks, 'sublabiale');\n  const pogonion = getLandmark(landmarks, 'pogonion');\n  const menton = getLandmark(landmarks, 'menton');\n  const tragus = getLandmark(landmarks, 'tragus');\n  const gonionBottom = getLandmark(landmarks, 'gonionBottom');\n  const cervicalPoint = getLandmark(landmarks, 'cervicalPoint');\n  const orbitale = getLandmark(landmarks, 'orbitale');\n  const porion = getLandmark(landmarks, 'porion');\n\n  // GONIAL ANGLE\n  if (tragus && gonionBottom && menton) {\n    const angle = calculateAngle(tragus, gonionBottom, menton);\n    addMeasurement('gonialAngle', angle);\n  }\n\n  // NASOLABIAL ANGLE\n  if (columella && subnasale && labraleSuperius) {\n    const angle = calculateAngle(columella, subnasale, labraleSuperius);\n    addMeasurement('nasolabialAngle', angle);\n  }\n\n  // NASOFRONTAL ANGLE\n  if (glabella && nasion && rhinion) {\n    const angle = calculateAngle(glabella, nasion, rhinion);\n    addMeasurement('nasofrontalAngle', angle);\n  }\n\n  // MENTOLABIAL ANGLE\n  if (labraleInferius && sublabiale && pogonion) {\n    const angle = calculateAngle(labraleInferius, sublabiale, pogonion);\n    addMeasurement('mentolabialAngle', angle);\n  }\n\n  // E-LINE MEASUREMENTS\n  if (pronasale && pogonion && labraleSuperius && labraleInferius) {\n    const upperLipDist = perpendicularDistance(labraleSuperius, pronasale, pogonion);\n    const lowerLipDist = perpendicularDistance(labraleInferius, pronasale, pogonion);\n    addMeasurement('eLineUpperLip', upperLipDist);\n    addMeasurement('eLineLowerLip', lowerLipDist);\n  }\n\n  // NASOMENTAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    const angle = calculateAngle(nasion, pronasale, pogonion);\n    addMeasurement('nasomentaAngle', angle);\n  }\n\n  // FACIAL CONVEXITY (GLABELLA)\n  if (glabella && subnasale && pogonion) {\n    const angle = calculateAngle(glabella, subnasale, pogonion);\n    addMeasurement('facialConvexityGlabella', angle);\n  }\n\n  // FACIAL CONVEXITY (NASION)\n  if (nasion && subnasale && pogonion) {\n    const angle = calculateAngle(nasion, subnasale, pogonion);\n    addMeasurement('facialConvexityNasion', angle);\n  }\n\n  // TOTAL FACIAL CONVEXITY\n  if (glabella && pronasale && pogonion) {\n    const angle = calculateAngle(glabella, pronasale, pogonion);\n    addMeasurement('totalFacialConvexity', angle);\n  }\n\n  // SUBMENTAL CERVICAL ANGLE\n  if (menton && cervicalPoint && pogonion) {\n    const neckPoint = getLandmark(landmarks, 'neckPoint');\n    if (neckPoint) {\n      const angle = calculateAngle(pogonion, menton, neckPoint);\n      addMeasurement('submentalCervicalAngle', angle);\n    }\n  }\n\n  // NASAL PROJECTION (Goode ratio)\n  if (pronasale && subnasale && nasion) {\n    const projection = distance(pronasale, subnasale);\n    const nasalLength = distance(nasion, pronasale);\n    if (nasalLength > 0) {\n      addMeasurement('nasalProjection', projection / nasalLength);\n    }\n  }\n\n  // NASOFACIAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    // Angle between nose dorsum and facial plane\n    const nasalDorsum = { x: pronasale.x - nasion.x, y: pronasale.y - nasion.y };\n    const facialPlane = { x: pogonion.x - nasion.x, y: pogonion.y - nasion.y };\n\n    const dot = nasalDorsum.x * facialPlane.x + nasalDorsum.y * facialPlane.y;\n    const mag1 = Math.sqrt(nasalDorsum.x ** 2 + nasalDorsum.y ** 2);\n    const mag2 = Math.sqrt(facialPlane.x ** 2 + facialPlane.y ** 2);\n\n    if (mag1 > 0 && mag2 > 0) {\n      const angle = Math.acos(dot / (mag1 * mag2)) * (180 / Math.PI);\n      addMeasurement('nasofacialAngle', angle);\n    }\n  }\n\n  // MANDIBULAR PLANE ANGLE (using Frankfort horizontal)\n  if (porion && orbitale && gonionBottom && menton) {\n    // Frankfort horizontal is porion to orbitale\n    // Mandibular plane is gonion to menton\n    const fhAngle = Math.atan2(orbitale.y - porion.y, orbitale.x - porion.x);\n    const mpAngle = Math.atan2(menton.y - gonionBottom.y, menton.x - gonionBottom.x);\n    const angle = Math.abs(fhAngle - mpAngle) * (180 / Math.PI);\n    addMeasurement('mandibularPlaneAngle', angle);\n  }\n\n  // CHIN PROJECTION\n  if (pogonion && subnasale) {\n    // Distance from pogonion to vertical line through subnasale\n    const projection = pogonion.x - subnasale.x;\n    addMeasurement('chinProjection', projection);\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// COMPLETE HARMONY ANALYSIS\n// ============================================\n\n/**\n * Run complete facial harmony analysis.\n * Now supports ethnicity-specific ideal ranges for more accurate scoring.\n */\nexport function analyzeHarmony(\n  frontLandmarks: LandmarkPoint[],\n  sideLandmarks: LandmarkPoint[],\n  gender: Gender = 'male',\n  ethnicity: Ethnicity = 'other'\n): HarmonyAnalysis {\n  const frontResults = analyzeFrontProfile(frontLandmarks, gender, ethnicity);\n  const sideResults = analyzeSideProfile(sideLandmarks, gender, ethnicity);\n\n  const allMeasurements = [...frontResults.measurements, ...sideResults.measurements];\n\n  // Combined category scores\n  const allCategories: Record<string, { total: number; count: number }> = {};\n  for (const m of allMeasurements) {\n    if (!allCategories[m.category]) {\n      allCategories[m.category] = { total: 0, count: 0 };\n    }\n    allCategories[m.category].total += m.standardizedScore;\n    allCategories[m.category].count++;\n  }\n\n  const categoryScores: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(allCategories)) {\n    categoryScores[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Overall weighted score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of allMeasurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  // Identify flaws (below average measurements)\n  const flaws: FlawAssessment[] = allMeasurements\n    .filter((m) => m.severity !== 'optimal' && m.severity !== 'minor')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      severity: m.severity,\n      deviation: `${m.deviation.toFixed(2)} ${m.deviationDirection} ideal`,\n      reasoning: `${m.name} is outside the ideal range`,\n      confidence: m.severity === 'extremely_severe' || m.severity === 'severe'\n        ? 'confirmed' as const\n        : 'likely' as const,\n    }))\n    .sort((a, b) => {\n      const severityOrder = { extremely_severe: 0, severe: 1, major: 2, moderate: 3 };\n      return (severityOrder[a.severity as keyof typeof severityOrder] ?? 4) -\n             (severityOrder[b.severity as keyof typeof severityOrder] ?? 4);\n    });\n\n  // Identify strengths (ideal measurements)\n  const strengths: StrengthAssessment[] = allMeasurements\n    .filter((m) => m.qualityTier === 'ideal' || m.qualityTier === 'excellent')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      qualityTier: m.qualityTier,\n      value: m.value,\n      reasoning: `${m.name} is within the ${m.qualityTier} range`,\n    }));\n\n  // Calculate percentile (based on population stats)\n  const percentile = calculateHarmonyPercentile(overallScore);\n\n  return {\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    percentile,\n    frontScore: frontResults.overallScore,\n    sideScore: sideResults.overallScore,\n    categoryScores,\n    measurements: allMeasurements,\n    flaws,\n    strengths,\n  };\n}\n\n/**\n * Calculate percentile from harmony score\n */\nfunction calculateHarmonyPercentile(score: number): number {\n  // Based on normal distribution with mean=5, stdDev=1.5\n  const mean = 5;\n  const stdDev = 1.5;\n  const z = (score - mean) / stdDev;\n  return normalCDF(z) * 100;\n}\n\n/**\n * Standard normal CDF approximation\n */\nfunction normalCDF(z: number): number {\n  const a1 = 0.254829592;\n  const a2 = -0.284496736;\n  const a3 = 1.421413741;\n  const a4 = -1.453152027;\n  const a5 = 1.061405429;\n  const p = 0.3275911;\n\n  const sign = z < 0 ? -1 : 1;\n  const absZ = Math.abs(z) / Math.sqrt(2);\n\n  const t = 1.0 / (1.0 + p * absZ);\n  const y = 1.0 - ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-absZ * absZ);\n\n  return 0.5 * (1.0 + sign * y);\n}\n\n// ============================================\n// PSL RATING CONVERSION\n// ============================================\n\nexport interface PSLRating {\n  score: number;\n  tier: string;\n  percentile: number;\n  description: string;\n}\n\n/**\n * Convert harmony score to PSL rating\n */\nexport function convertToPSL(harmonyScore: number): PSLRating {\n  // Convert 0-10 harmony to 3.0-7.5 PSL range\n  const psl = 3.0 + (harmonyScore / 10) * 4.5;\n  const clampedPSL = Math.max(3.0, Math.min(7.5, psl));\n\n  let tier: string;\n  let percentile: number;\n\n  if (clampedPSL >= 7.5) {\n    tier = 'Top Model';\n    percentile = 99.99;\n  } else if (clampedPSL >= 7.0) {\n    tier = 'Chad';\n    percentile = 99.87;\n  } else if (clampedPSL >= 6.5) {\n    tier = 'Chadlite';\n    percentile = 99.0;\n  } else if (clampedPSL >= 6.0) {\n    tier = 'High Tier Normie+';\n    percentile = 97.25;\n  } else if (clampedPSL >= 5.5) {\n    tier = 'High Tier Normie';\n    percentile = 90.0;\n  } else if (clampedPSL >= 5.0) {\n    tier = 'Mid Tier Normie+';\n    percentile = 84.15;\n  } else if (clampedPSL >= 4.5) {\n    tier = 'Mid Tier Normie';\n    percentile = 65.0;\n  } else if (clampedPSL >= 4.0) {\n    tier = 'Low Tier Normie';\n    percentile = 50.0;\n  } else if (clampedPSL >= 3.5) {\n    tier = 'Below Average';\n    percentile = 30.0;\n  } else {\n    tier = 'Subpar';\n    percentile = 15.0;\n  }\n\n  return {\n    score: clampedPSL,\n    tier,\n    percentile,\n    description: `${tier} (top ${(100 - percentile).toFixed(1)}%)`,\n  };\n}\n\n// ============================================\n// EXPORTS FOR BACKWARD COMPATIBILITY\n// ============================================\n\nexport type { LandmarkPoint } from './landmarks';\n","structuredPatch":[{"oldStart":336,"oldLines":10,"newStart":336,"newLines":13,"lines":["   // FACE PROPORTIONS - Gender variation","   // ==========================================","   faceWidthToHeight: {","+    // White: Neoclassical standard - balanced, moderate width (1.98-2.02)","     // Males: slightly wider face preferred; Females: slightly narrower","     // Hispanic: Allows broader \"Mesoprosopic\" faces (Mestizo/Indigenous bone structure)","     // Pacific Islander: \"Warrior Skull\" - extremely broad face preferred (highest FWHR of any demographic)","-    // Extracted from FaceIQ Male:Pacific Islander.htc - \"Bridge Model\"","+    // Extracted from FaceIQ Male:White.htc (Neoclassical baseline) and Male:Pacific Islander.htc","+    white_male: { idealMin: 1.98, idealMax: 2.02 },  // Neoclassical - moderate width baseline","+    white_female: { idealMin: 1.94, idealMax: 1.98 },","     male: { idealMin: 1.98, idealMax: 2.02 },","     female: { idealMin: 1.94, idealMax: 1.98 },","     hispanic_male: { idealMin: 1.95, idealMax: 2.10 },  // Rewards broader, robust face shapes"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"98c99b7e-6f36-4e07-a428-aae9026d7c8a","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01NjWUvPV5zE8bPYZJsTfFLM","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Perfect! Now let me run the type checker to make sure everything compiles correctly.","signature":"EvwBCkYIChgCKkAcBNPWJQAlsYfmu56dqatFgtUAS+3suKRr5YcXFiT3DzM0MFYYsZx/WhgH/UFKPeqtMuv7KYkusEMrBVkd/QgNEgzS0lPeB0RgT/oJZ7gaDMq6s1j/YVmzkDBHjyIwfUUiLVtaHEYFPCZAveNTfrgEnT7f+xpyc8VQ4e0qP5NIXqjw8/uBIno0rX/ixy9bKmRhygPZGZq3hwbiXzpX0pZxjS8E+DvGfLSevlR0/wltFQ64TgwQnxsndaK0UgA7bv39UcICT6cOooyR6nH4fWVS0Hb11NIqhurcrauJoTT8NbSJ/WtaMmK40vFGXU0pytFFWi+zGAE="}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":1525,"cache_read_input_tokens":50472,"cache_creation":{"ephemeral_5m_input_tokens":1525,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDYSHFVzXMcw5RDnM5g","type":"assistant","uuid":"32f17c5d-f08e-4b69-97a6-0922603ec409","timestamp":"2025-12-21T17:21:05.346Z"}
{"parentUuid":"32f17c5d-f08e-4b69-97a6-0922603ec409","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01NjWUvPV5zE8bPYZJsTfFLM","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01YCCvNgVhGymc8HJ9q1CLGq","name":"Bash","input":{"command":"npx tsc --noEmit --pretty 2>&1 | head -50","description":"Type check all changes"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":1525,"cache_read_input_tokens":50472,"cache_creation":{"ephemeral_5m_input_tokens":1525,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWLDYSHFVzXMcw5RDnM5g","type":"assistant","uuid":"a685d3ab-9d7d-4972-aa5b-0e8572f328ad","timestamp":"2025-12-21T17:21:06.247Z"}
{"parentUuid":"a685d3ab-9d7d-4972-aa5b-0e8572f328ad","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01YCCvNgVhGymc8HJ9q1CLGq","type":"tool_result","content":"","is_error":false}]},"uuid":"75584da2-b7c5-4003-bb97-3c2504e18ac9","timestamp":"2025-12-21T17:21:07.526Z","toolUseResult":{"stdout":"","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"75584da2-b7c5-4003-bb97-3c2504e18ac9","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01PEtF8h6Eqtn6VGk95tuAFE","type":"message","role":"assistant","content":[{"type":"thinking","thinking":"Great! Type check passed successfully. Now let me create a summary of all the White Male Neoclassical standards I've added.","signature":"EqQCCkYIChgCKkApDWDwHmxtlomo4AX783dzGi6DgfpLxBq8TtuC1UaZUdgmTd5yFLWbZhLuJ+c+GojLu0CPH9TK0/YnmcgXdD5WEgwAVoRVVr4rlqPHYoMaDKoUmdA589IS7bDoDCIwpqQycslAen/TFdovcvKz7963QdSeOakinCITd2BvMd87htE+zr7YzIor1Np2FKySKosBmXU+xQ/RrwF0LVTrd+u6fKDYKfRnDAsMIf0letbAyWxZYVX29eUQrvuqUe4twkWHNyt+8p6muR3FgakPoy05B1+Nu9VovaOswBRh0uxghP8fvjm+0+KkTrlwNCkL0HSBzvQOWmDhnwta0BDaQv5tC6MLrJrEHvdK7bhLQqrjJlTjdPlBuFK5X75bQhgB"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":183,"cache_read_input_tokens":51997,"cache_creation":{"ephemeral_5m_input_tokens":183,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWLDYrZkKFWLRNfiR2Ljx","type":"assistant","uuid":"758aeb8e-e652-412e-b464-3b94baff914c","timestamp":"2025-12-21T17:21:11.364Z"}
{"parentUuid":"758aeb8e-e652-412e-b464-3b94baff914c","isSidechain":false,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"8a2d2fbf-756a-4257-a89f-76c39b089b6d","version":"2.0.70","gitBranch":"main","slug":"melodic-juggling-cook","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01PEtF8h6Eqtn6VGk95tuAFE","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect! I've successfully added the **White Male Neoclassical (Control Group)** demographic logic to your facial metrics database. Here's a comprehensive summary:\n\n## White Male Demographic Overrides Added\n\n### 1. **Intercanthal Nasal Ratio** (Alar Base Width) - Line 230-231\n- **White Male**: 0.98 - 1.05 (strictest of any demographic)\n- **White Female**: 0.98 - 1.02\n- **Logic**: Neoclassical 1:1 ratio - nose width must equal inner eye spacing\n- **Comparison**: Much stricter than Black (1.15-1.25), East Asian (1.10-1.15), or Pacific Islander (1.10-1.20)\n\n### 2. **Gonial Angle** (Jaw Squareness) - Line 273-274\n- **White Male**: 115Â° - 125Â°\n- **White Female**: 120Â° - 132Â°\n- **Logic**: Square, vertically robust jaw preferred - less tolerant of soft/V-shaped jaws\n- **Comparison**: Same as generic male baseline (this IS the baseline)\n\n### 3. **Lateral Canthal Tilt** (Eye Angle) - Line 288-289\n- **White Male**: 4.0Â° - 8.0Â°\n- **White Female**: 5.0Â° - 9.0Â°\n- **Logic**: Neutral to slightly positive tilt\n- **Comparison**: Lower than East Asian (8-12Â°), Hispanic (6-12Â°), or South Asian (6-10Â°)\n\n### 4. **Midface Ratio** (Compactness) - Line 353-354\n- **White Male**: 0.95 - 1.02\n- **White Female**: 0.93 - 1.00\n- **Logic**: STRICT compact midface - heavily penalizes \"long midface\" (creates \"Hunter\" look)\n- **Comparison**: Same as Middle Eastern (both prefer compact), stricter than generic male (0.98-1.02)\n\n### 5. **Face Width to Height Ratio** (FWHR) - Line 344-345\n- **White Male**: 1.98 - 2.02 (Neoclassical baseline)\n- **White Female**: 1.94 - 1.98\n- **Logic**: Moderate, balanced width\n- **Comparison**: Narrower than Hispanic (1.95-2.10) and much narrower than Pacific Islander (2.10-2.30)\n\n### 6. **Chin to Philtrum Ratio** (Lower Face Balance) - Line 410-411\n- **White Male**: 2.10 - 2.30\n- **White Female**: 2.05 - 2.25\n- **Logic**: Strict balance between chin height and philtrum length\n- **Comparison**: Stricter than Black (2.15-2.70) which accommodates fuller lips/shorter philtrum\n\n## Key Phenotype Characteristics\n\nâœ… **Neoclassical Golden Ratio** - Based on Da Vinci/Marquardt Mask  \nâœ… **Strictest Nasal Width** - 1:1 ratio (nose width = eye spacing)  \nâœ… **Compact Midface** - Heavily penalizes long midface  \nâœ… **Square Jaw Definition** - 115-125Â° gonial angle  \nâœ… **Moderate Face Width** - Balanced FWHR (not too broad)  \nâœ… **Precise Lower Face Balance** - Strict chin-to-philtrum ratio\n\nThis White Male model serves as the **\"Control Group\"** baseline for the entire scoring system. All other demographics are variations/deviations from this Neoclassical standard. Type checking passed successfully!"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":183,"cache_read_input_tokens":51997,"cache_creation":{"ephemeral_5m_input_tokens":183,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWLDYrZkKFWLRNfiR2Ljx","type":"assistant","uuid":"4aceb71e-ca03-45a0-9707-9ceb88d4e9a6","timestamp":"2025-12-21T17:21:28.019Z"}
