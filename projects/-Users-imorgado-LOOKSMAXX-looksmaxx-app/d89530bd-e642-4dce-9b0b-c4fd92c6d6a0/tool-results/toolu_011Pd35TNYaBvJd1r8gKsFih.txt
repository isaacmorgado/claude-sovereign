The file /Users/imorgado/LOOKSMAXX/looksmax_engine.py has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
   284→    score = 10.0 * math.exp(-0.5 * (deviation / sigma) ** 2)
   285→    return max(0.0, min(10.0, score))
   286→
   287→
   288→def score_metrics(metrics: Dict[str, float]) -> Dict[str, Tuple[float, float]]:
   289→    """Score all metrics and return (value, score) tuples."""
   290→    results = {}
   291→    for name, value in metrics.items():
   292→        results[name] = (value, None)
   293→    return results
   294→
   295→
   296→# =============================================================================
   297→# HARMONY SCORE - WEIGHTED AGGREGATION
   298→# =============================================================================
   299→
   300→# High Impact (3.0x weight) - Core facial harmony indicators
   301→HIGH_IMPACT_METRICS = {
   302→    "Face Width to Height Ratio",
   303→    "Midface Ratio",
   304→    "Lateral Canthal Tilt",
   305→    "Gonial Angle",
   306→    "Mandibular Plane Angle",
   307→    "Chin to Philtrum Ratio",
   308→}
   309→
   310→# Medium Impact (2.0x weight) - Secondary aesthetic factors
   311→MEDIUM_IMPACT_METRICS = {
   312→    "Nose Bridge to Nose Width",
   313→    "Nasolabial Angle",
   314→    "Cheekbone Height",
   315→    "Ramus to Mandible Ratio",
   316→}
   317→
   318→
   319→def calculate_harmony_score(scored_results: Dict[str, Tuple[float, float]]) -> float:
   320→    """
   321→    Calculate the weighted Harmony Score from scored metric results.
   322→
   323→    Args:
   324→        scored_results: Dict of metric_name -> (value, score) tuples
   325→
   326→    Returns:
   327→        Harmony score as percentage (0-100%)
   328→
   329→    Weights:
   330→        - High Impact (3.0x): FWHR, Midface, Canthal Tilt, Gonial, MPA, Chin:Philtrum
   331→        - Medium Impact (2.0x): Nose Bridge, Nasolabial, Cheekbone, Ramus:Mandible
   332→        - Standard (1.0x): All other metrics
   333→    """
   334→    total_weighted_score = 0.0
   335→    total_weight = 0.0
   336→
   337→    for metric_name, (value, score) in scored_results.items():
   338→        if score is None:
   339→            continue
   340→
   341→        # Determine weight based on metric impact tier
   342→        if metric_name in HIGH_IMPACT_METRICS:
   343→            weight = 3.0
   344→        elif metric_name in MEDIUM_IMPACT_METRICS:
   345→            weight = 2.0
   346→        else:
   347→            weight = 1.0
   348→
   349→        total_weighted_score += score * weight
   350→        total_weight += weight
   351→
   352→    if total_weight == 0:
   353→        return 0.0
   354→
   355→    # Calculate weighted average and convert to percentage
   356→    weighted_avg = total_weighted_score / total_weight
   357→    harmony_percentage = (weighted_avg / 10.0) * 100.0
   358→
   359→    return harmony_percentage
   360→
   361→
   362→# =============================================================================
   363→# ADVICE ENGINE - METRIC-SPECIFIC FEEDBACK STRINGS
   364→# =============================================================================
   365→
   366→# Advice database: metric_name -> {"too_high": str, "too_low": str}
   367→ADVICE_DATABASE = {
   368→    # === HIGH IMPACT METRICS ===
   369→    "Face Width to Height Ratio": {
   370→        "too_high": "Face appears wider. Consider hairstyles that add vertical length.",
   371→        "too_low": "Face is elongated. Hairstyles with side volume can add balance.",
   372→    },
   373→    "Midface Ratio": {
   374→        "too_high": "Midface is elongated. This can project maturity but may benefit from framing.",
   375→        "too_low": "Midface is compact. This is often a dimorphic and youthful trait.",
   376→    },
   377→    "Lateral Canthal Tilt": {
   378→        "too_high": "Eyes have significant positive tilt. Very dimorphic - no action needed.",
   379→        "too_low": "Eyes have negative tilt. Consider brow-maxxing or temporal area work.",
   380→    },
   381→    "Gonial Angle": {
   382→        "too_high": "Jaw angle is steep (obtuse). Lowering body fat or chewing hard gum may improve definition.",
   383→        "too_low": "Jaw angle is very sharp. Strong masculine trait - no action typically needed.",
   384→    },
   385→    "Mandibular Plane Angle": {
   386→        "too_high": "Steep mandibular plane (long face type). May benefit from mewing or jaw work.",
   387→        "too_low": "Flat mandibular plane. This is typically a favorable trait.",
   388→    },
   389→    "Chin to Philtrum Ratio": {
   390→        "too_high": "Chin is long relative to philtrum. Generally masculine; no action needed.",
   391→        "too_low": "Philtrum is long relative to chin. Upper lip lifting or chin augmentation options exist.",
   392→    },
   393→
   394→    # === MEDIUM IMPACT METRICS ===
   395→    "Nose Bridge to Nose Width": {
   396→        "too_high": "Nose appears narrow relative to bridge. This is typically favorable.",
   397→        "too_low": "Nose is wide relative to bridge. Nostril work can refine proportions.",
   398→    },
   399→    "Nasolabial Angle": {
   400→        "too_high": "Nose tip points upward. Can appear more feminine; tip refinement may help.",
   401→        "too_low": "Nose tip points downward (droopy). Tip rotation procedures can improve profile.",
   402→    },
   403→    "Cheekbone Height": {
   404→        "too_high": "Cheekbones are exceptionally high. Very aesthetic - no action needed.",
   405→        "too_low": "Cheekbones are lower set. Malar augmentation or filler can enhance projection.",
   406→    },
   407→    "Ramus to Mandible Ratio": {
   408→        "too_high": "Short mandibular body. Jaw angle implants may improve proportions.",
   409→        "too_low": "Long mandibular body. This is typically favorable for facial width.",
   410→    },
   411→
   412→    # === FRONT PROFILE METRICS ===
   413→    "Jaw Slope": {
   414→        "too_high": "Jaw slopes steeply. Consider gonial angle enhancement.",
   415→        "too_low": "Jaw has minimal slope. Strong horizontal projection is present.",
   416→    },
   417→    "Total Facial Width to Height Ratio": {
   418→        "too_high": "Face is very wide relative to height. Can appear robust/masculine.",
   419→        "too_low": "Face is very tall relative to width. Hairstyles with width can balance.",
   420→    },
   421→    "Mouth Width to Nose Width Ratio": {
   422→        "too_high": "Wide mouth relative to nose. Typically attractive; no action needed.",
   423→        "too_low": "Narrow mouth relative to nose. Lip exercises may help.",
   424→    },
   425→    "Lower Third Proportion": {
   426→        "too_high": "Lower face is long. May benefit from vertical reduction options.",
   427→        "too_low": "Lower face is short. Chin augmentation can add vertical height.",
   428→    },
   429→    "Ipsilateral Alar Angle": {
   430→        "too_high": "Nostril angle is wide. Alar reduction may refine the nose.",
   431→        "too_low": "Nostril angle is narrow. Typically favorable; no action needed.",
   432→    },
   433→    "Jaw Frontal Angle": {
   434→        "too_high": "Jaw is V-shaped. Gonial angle widening may add presence.",
   435→        "too_low": "Jaw is very U-shaped/wide. Strong masculine trait.",
   436→    },
   437→    "Eye Aspect Ratio": {
   438→        "too_high": "Eyes are horizontally elongated. Hunter eyes are typically desirable.",
   439→        "too_low": "Eyes are more round. Lateral canthoplasty can elongate.",
   440→    },
   441→    "Bitemporal Width": {
   442→        "too_high": "Wide temples relative to face. Full head of hair can balance.",
   443→        "too_low": "Narrow temples. Can appear more refined/gracile.",
   444→    },
   445→    "Eyebrow Low Setedness": {
   446→        "too_high": "Brows are low-set (hooded). Creates intense look; browlift if too heavy.",
   447→        "too_low": "Brows are high-set. More open look; brow products can add fullness.",
   448→    },
   449→    "Eye Separation Ratio": {
   450→        "too_high": "Eyes are widely set. Creates softer look; no action typically needed.",
   451→        "too_low": "Eyes are closely set. Can appear intense; glasses can balance.",
   452→    },
   453→    "Bigonial Width": {
   454→        "too_high": "Wide jaw relative to cheekbones. Strong masculine trait.",
   455→        "too_low": "Narrow jaw relative to cheekbones. Jaw angle widening may add presence.",
   456→    },
   457→    "Lower Lip to Upper Lip Ratio": {
   458→        "too_high": "Lower lip is much fuller. Very aesthetic; no action needed.",
   459→        "too_low": "Upper lip is fuller. Standard proportion; lip flip may balance.",
   460→    },
   461→    "Eyebrow Tilt": {
   462→        "too_high": "Brows tilt significantly upward. Can appear expressive.",
   463→        "too_low": "Brows are flat or downturned. Can appear more stoic.",
   464→    },
   465→
   466→    # === SIDE PROFILE METRICS ===
   467→    "Recession Relative to Frankfort Plane": {
   468→        "too_high": "Significant lower jaw recession. Advancement surgery may help.",
   469→        "too_low": "Jaw projects forward strongly. Very masculine; monitor overbite.",
   470→    },
   471→    "Facial Depth to Height Ratio": {
   472→        "too_high": "Face is very deep relative to height. Strong forward growth.",
   473→        "too_low": "Face is flat relative to height. May benefit from midface/chin work.",
   474→    },
   475→    "Interior Midface Projection Angle": {
   476→        "too_high": "Midface projects significantly. Strong forward growth.",
   477→        "too_low": "Flat midface. Cheekbone augmentation may improve profile.",
   478→    },
   479→    "Nasofrontal Angle": {
   480→        "too_high": "Deep nasofrontal angle. Creates dramatic brow/nose transition.",
   481→        "too_low": "Shallow nasofrontal angle. Brow work may add definition.",
   482→    },
   483→    "Gonion to Mouth Line": {
   484→        "too_high": "Gonion is low relative to mouth. May appear long-faced.",
   485→        "too_low": "Gonion is high relative to mouth. Compact proportions.",
   486→    },
   487→    "Lower Lip S-Line Position": {
   488→        "too_high": "Lower lip protrudes past S-line. May indicate maxillary retrusion.",
   489→        "too_low": "Lower lip is behind S-line. Well-balanced profile.",
   490→    },
   491→    "Z Angle": {
   492→        "too_high": "Profile is very upright/vertical. May appear flat.",
   493→        "too_low": "Profile is convex. Standard Western ideal.",
   494→    },
   495→    "Nasomental Angle": {
   496→        "too_high": "Nose-chin line is obtuse. May indicate weak chin.",
   497→        "too_low": "Nose-chin line is acute. Strong chin projection.",
   498→    },
   499→    "Submental Cervical Angle": {
   500→        "too_high": "Weak chin-neck angle. May benefit from submental lipo or implant.",
   501→        "too_low": "Sharp chin-neck angle. Excellent definition.",
   502→    },
   503→    "Nasofacial Angle": {
   504→        "too_high": "Large angle between nose and face. Strong nose or recessed face.",
   505→        "too_low": "Small angle. Well-integrated nose.",
   506→    },
   507→    "Holdaway H Line": {
   508→        "too_high": "Lips project significantly. Monitor for bimax protrusion.",
   509→        "too_low": "Flat lip line. May appear retruded; filler can add volume.",
   510→    },
   511→    "Mentolabial Angle": {
   512→        "too_high": "Deep mentolabial fold. Can appear aged; filler can soften.",
   513→        "too_low": "Shallow mentolabial fold. Youthful and balanced.",
   514→    },
   515→    "Lower Lip E-Line Position": {
   516→        "too_high": "Lower lip protrudes past E-line. May benefit from orthodontics.",
   517→        "too_low": "Lower lip is behind E-line. Balanced or retruded.",
   518→    },
   519→    "Nasal Tip Angle": {
   520→        "too_high": "Nose tip is rotated upward. Can appear feminine.",
   521→        "too_low": "Nose tip droops. Tip rotation surgery can improve.",
   522→    },
   523→    "Nasal Projection": {
   524→        "too_high": "Large nose projection. Reduction rhinoplasty may refine.",
   525→        "too_low": "Minimal nose projection. Augmentation rhinoplasty may enhance.",
   526→    },
   527→    "Nasal W to H Ratio": {
   528→        "too_high": "Wide nose relative to height. Narrowing procedures exist.",
   529→        "too_low": "Narrow nose. Typically favorable; no action needed.",
   530→    },
   531→    "Facial Convexity (Glabella)": {
   532→        "too_high": "Convex profile. Strong midface projection.",
   533→        "too_low": "Flat or concave profile. May benefit from augmentation.",
   534→    },
   535→    "Facial Convexity (Nasion)": {
   536→        "too_high": "Convex profile from nasion. Good forward growth.",
   537→        "too_low": "Straight or concave profile. May appear flat.",
   538→    },
   539→    "Total Facial Convexity": {
   540→        "too_high": "Very convex total profile. Midface is prominent.",
   541→        "too_low": "Flat total profile. Forward growth options may help.",
   542→    },
   543→    "Upper Forehead Slope": {
   544→        "too_high": "Sloped forehead. More masculine/primal appearance.",
   545→        "too_low": "Upright forehead. More neotenous appearance.",
   546→    },
   547→    "Browridge Inclination Angle": {
   548→        "too_high": "Prominent browridge angle. Strong masculine trait.",
   549→        "too_low": "Flat browridge. Implants can add definition.",
   550→    },
   551→}
   552→
   553→
   554→def generate_advice(metric_name: str, score: float, value: float, range_tuple: Tuple[float, float]) -> str:
   555→    """
   556→    Generate advice string based on metric score and value position.
   557→
   558→    Args:
   559→        metric_name: Name of the metric
   560→        score: Score from 0-10
   561→        value: Actual measured value
   562→        range_tuple: (min_ideal, max_ideal) range
   563→
   564→    Returns:
   565→        Advice string for the metric
   566→    """
   567→    min_ideal, max_ideal = range_tuple
   568→
   569→    # Perfect score - no action needed
   570→    if score >= 9.0:
   571→        return "Ideal proportions. No action needed."
   572→
   573→    # Get advice from database
   574→    if metric_name in ADVICE_DATABASE:
   575→        advice = ADVICE_DATABASE[metric_name]
   576→
   577→        if value > max_ideal:
   578→            return advice.get("too_high", f"Value is above the ideal range of {min_ideal:.1f}-{max_ideal:.1f}.")
   579→        elif value < min_ideal:
   580→            return advice.get("too_low", f"Value is below the ideal range of {min_ideal:.1f}-{max_ideal:.1f}.")
   581→
   582→    # Default fallback
   583→    if value > max_ideal:
   584→        return f"Value ({value:.2f}) is above the ideal range of {min_ideal:.1f}-{max_ideal:.1f}."
   585→    elif value < min_ideal:
   586→        return f"Value ({value:.2f}) is below the ideal range of {min_ideal:.1f}-{max_ideal:.1f}."
   587→    else:
   588→        return f"Value is within acceptable range but not optimal."
   589→
   590→
   591→# =============================================================================
   592→# BELL CURVE GRAPH GENERATOR
   593→# =============================================================================
   594→
   595→def plot_bell_curve(metric_name: str, user_value: float, range_tuple: Tuple[float, float],
   596→                   score: float, output_dir: str = ".") -> Optional[str]:
   597→    """
   598→    Generate a Gaussian bell curve visualization for a metric.
   599→
   600→    Args:
   601→        metric_name: Name of the metric (for title)
   602→        user_value: User's measured value
   603→        range_tuple: (min_ideal, max_ideal) range
   604→        score: Score from 0-10
   605→        output_dir: Directory to save the image
   606→
   607→    Returns:
   608→        Path to saved image, or None if matplotlib unavailable
   609→    """
   610→    if not MATPLOTLIB_AVAILABLE:
   611→        return None
   612→
   613→    min_ideal, max_ideal = range_tuple
   614→    target = (min_ideal + max_ideal) / 2  # Center of ideal range
   615→
   616→    # Calculate sigma based on range width
   617→    range_width = max_ideal - min_ideal
   618→    sigma = range_width / 2 if range_width > 0 else 1.0
   619→
   620→    # X-axis range: extend beyond ideal range
   621→    x_min = min_ideal * 0.5 if min_ideal > 0 else min_ideal - abs(max_ideal - min_ideal)
   622→    x_max = max_ideal * 1.5 if max_ideal > 0 else max_ideal + abs(max_ideal - min_ideal)
   623→
   624→    # Handle edge cases where min > max due to negative values
   625→    if x_min > x_max:
   626→        x_min, x_max = x_max, x_min
   627→
   628→    x = np.linspace(x_min, x_max, 500)
   629→
   630→    # Gaussian function: 10 * exp(-0.5 * ((x - target) / sigma)^2)
   631→    y = 10 * np.exp(-0.5 * ((x - target) / sigma) ** 2)
   632→
   633→    # Create figure
   634→    fig, ax = plt.subplots(figsize=(10, 6))
   635→
   636→    # Plot the bell curve
   637→    ax.plot(x, y, 'b-', linewidth=2, label='Score Distribution')
   638→
   639→    # Fill the ideal "green zone"
   640→    mask = (x >= min_ideal) & (x <= max_ideal)
   641→    ax.fill_between(x, y, where=mask, alpha=0.3, color='green', label=f'Ideal Range [{min_ideal:.1f}, {max_ideal:.1f}]')
   642→
   643→    # Plot the user's position as a red dot
   644→    ax.scatter([user_value], [score], color='red', s=150, zorder=5, label=f'Your Value: {user_value:.2f}')
   645→
   646→    # Add vertical line at user value
   647→    ax.axvline(x=user_value, color='red', linestyle='--', alpha=0.5)
   648→
   649→    # Add horizontal reference lines
   650→    ax.axhline(y=10, color='gray', linestyle=':', alpha=0.3)
   651→    ax.axhline(y=5, color='gray', linestyle=':', alpha=0.3)
   652→
   653→    # Labels and styling
   654→    ax.set_xlabel('Value', fontsize=12)
   655→    ax.set_ylabel('Score (0-10)', fontsize=12)
   656→    ax.set_title(f'{metric_name}: {score:.1f}/10', fontsize=14, fontweight='bold')
   657→    ax.set_ylim(0, 11)
   658→    ax.legend(loc='upper right')
   659→    ax.grid(True, alpha=0.3)
   660→
   661→    # Add score annotation
   662→    score_color = 'green' if score >= 7 else 'orange' if score >= 5 else 'red'
   663→    ax.annotate(f'Score: {score:.1f}', xy=(user_value, score), xytext=(user_value, score + 1.5),
   664→                fontsize=11, ha='center', color=score_color, fontweight='bold',
   665→                arrowprops=dict(arrowstyle='->', color=score_color))
   666→
   667→    # Save figure
   668→    safe_name = metric_name.replace(' ', '_').replace('/', '-').replace('(', '').replace(')', '')
   669→    filepath = os.path.join(output_dir, f'report_{safe_name}.png')
   670→    plt.tight_layout()
   671→    plt.savefig(filepath, dpi=150, bbox_inches='tight')
   672→    plt.close()
   673→
   674→    return filepath
   675→
   676→
   677→# =============================================================================
   678→# RANGES LOADER
   679→# =============================================================================
   680→
   681→def load_ranges(filepath: str = None) -> dict:
   682→    """Load scoring ranges from ranges.json file."""
   683→    if filepath is None: