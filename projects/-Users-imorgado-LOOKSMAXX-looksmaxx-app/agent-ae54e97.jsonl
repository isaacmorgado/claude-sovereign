{"parentUuid":null,"isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","type":"user","message":{"role":"user","content":"Find all files related to landmark detection and zoom functionality in /Users/imorgado/LOOKSMAXX/looksmaxx-app/\n\nFocus on:\n1. LandmarkAnalysisTool.tsx - main landmark UI\n2. SideProfileManualTool.tsx - side profile landmarks\n3. useZoomPan.ts hook - zoom/pan logic\n4. mediapipeDetection.ts - landmark offsets\n5. Any other landmark-related components\n\nDocument:\n- Zoom levels used (min, max, discrete levels)\n- Auto-zoom behavior when clicking landmarks\n- Pan/drag functionality\n- Landmark offset configurations\n- How landmarks are rendered on the image"},"uuid":"92ed950e-5b1d-4490-a4e1-556a770e3e62","timestamp":"2025-12-27T03:19:34.449Z"}
{"parentUuid":"92ed950e-5b1d-4490-a4e1-556a770e3e62","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01UdHchFgyzH1DE4MqKqShWi","type":"message","role":"assistant","content":[{"type":"text","text":"I'll search for all files related to landmark detection and zoom functionality in the looksmaxx-app directory."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":33249,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":33249,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWWUEGMjXwNSL5CDqj7jx","type":"assistant","uuid":"38fe06f6-8a4d-446e-b106-8f7a35f362ad","timestamp":"2025-12-27T03:19:38.147Z"}
{"parentUuid":"38fe06f6-8a4d-446e-b106-8f7a35f362ad","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01UdHchFgyzH1DE4MqKqShWi","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01HnijkCAh1XbCkrgMMfMwsx","name":"Glob","input":{"pattern":"**/LandmarkAnalysisTool.tsx","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":33249,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":33249,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWWUEGMjXwNSL5CDqj7jx","type":"assistant","uuid":"7a0dd70e-4394-4043-8327-e981c6d6f4c7","timestamp":"2025-12-27T03:19:38.980Z"}
{"parentUuid":"7a0dd70e-4394-4043-8327-e981c6d6f4c7","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01UdHchFgyzH1DE4MqKqShWi","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Ca2L2F5A9ru9N9giSA8jNK","name":"Glob","input":{"pattern":"**/SideProfileManualTool.tsx","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":33249,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":33249,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWWUEGMjXwNSL5CDqj7jx","type":"assistant","uuid":"2e6caba6-eabd-4a62-a5bd-4d32f55286b7","timestamp":"2025-12-27T03:19:39.594Z"}
{"parentUuid":"2e6caba6-eabd-4a62-a5bd-4d32f55286b7","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01UdHchFgyzH1DE4MqKqShWi","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CasmpGmamrW6EHeTR7t2nB","name":"Glob","input":{"pattern":"**/useZoomPan.ts","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":33249,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":33249,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWWUEGMjXwNSL5CDqj7jx","type":"assistant","uuid":"2915fc36-c97f-4213-bfa1-0a75f945ab39","timestamp":"2025-12-27T03:19:40.053Z"}
{"parentUuid":"2915fc36-c97f-4213-bfa1-0a75f945ab39","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01UdHchFgyzH1DE4MqKqShWi","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PKxWP8ExmYyMSGqbDb578b","name":"Glob","input":{"pattern":"**/mediapipeDetection.ts","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":33249,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":33249,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWWUEGMjXwNSL5CDqj7jx","type":"assistant","uuid":"daffbc27-9267-40eb-9f10-71251c90479f","timestamp":"2025-12-27T03:19:40.720Z"}
{"parentUuid":"daffbc27-9267-40eb-9f10-71251c90479f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01UdHchFgyzH1DE4MqKqShWi","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018nXojgjATXfqig69YqX8N1","name":"Glob","input":{"pattern":"**/*landmark*.{ts,tsx}","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":33249,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":33249,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWWUEGMjXwNSL5CDqj7jx","type":"assistant","uuid":"fc22066f-bdc8-49f3-b40b-ce22ed853d96","timestamp":"2025-12-27T03:19:41.584Z"}
{"parentUuid":"fc22066f-bdc8-49f3-b40b-ce22ed853d96","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01UdHchFgyzH1DE4MqKqShWi","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012HEcTRSrg6wTzjPAvcnuEB","name":"Glob","input":{"pattern":"**/*zoom*.{ts,tsx}","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":33249,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":33249,"ephemeral_1h_input_tokens":0},"output_tokens":512,"service_tier":"standard"}},"requestId":"req_011CWWUEGMjXwNSL5CDqj7jx","type":"assistant","uuid":"9574bcf2-393d-4830-b8db-073137caf519","timestamp":"2025-12-27T03:19:42.111Z"}
{"parentUuid":"9574bcf2-393d-4830-b8db-073137caf519","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01HnijkCAh1XbCkrgMMfMwsx","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/LandmarkAnalysisTool.tsx"}]},"uuid":"961e742c-e898-4d2b-9e2e-1159fea794b2","timestamp":"2025-12-27T03:19:42.964Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/LandmarkAnalysisTool.tsx"],"durationMs":803,"numFiles":1,"truncated":false}}
{"parentUuid":"961e742c-e898-4d2b-9e2e-1159fea794b2","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CasmpGmamrW6EHeTR7t2nB","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useZoomPan.ts"}]},"uuid":"f1e92a45-3c04-4aac-a8c0-eba76d8e8aaf","timestamp":"2025-12-27T03:19:42.971Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useZoomPan.ts"],"durationMs":809,"numFiles":1,"truncated":false}}
{"parentUuid":"f1e92a45-3c04-4aac-a8c0-eba76d8e8aaf","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012HEcTRSrg6wTzjPAvcnuEB","type":"tool_result","content":"No files found"}]},"uuid":"b4e2925e-86ab-42ed-8096-477e8736759c","timestamp":"2025-12-27T03:19:42.964Z","toolUseResult":{"filenames":[],"durationMs":803,"numFiles":0,"truncated":false}}
{"parentUuid":"b4e2925e-86ab-42ed-8096-477e8736759c","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PKxWP8ExmYyMSGqbDb578b","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/mediapipeDetection.ts"}]},"uuid":"f1ccc8e3-0bb3-46af-9d0f-8f54a684b3cb","timestamp":"2025-12-27T03:19:43.089Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/mediapipeDetection.ts"],"durationMs":927,"numFiles":1,"truncated":false}}
{"parentUuid":"f1ccc8e3-0bb3-46af-9d0f-8f54a684b3cb","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018nXojgjATXfqig69YqX8N1","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarkImages.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts"}]},"uuid":"1893d5dd-2855-487f-9a56-e3b0dac0124e","timestamp":"2025-12-27T03:19:43.230Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarkImages.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts"],"durationMs":1068,"numFiles":2,"truncated":false}}
{"parentUuid":"1893d5dd-2855-487f-9a56-e3b0dac0124e","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Ca2L2F5A9ru9N9giSA8jNK","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/SideProfileManualTool.tsx"}]},"uuid":"4607ecab-c493-4e9e-9671-d2eca30ddfaa","timestamp":"2025-12-27T03:19:43.368Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/SideProfileManualTool.tsx"],"durationMs":1207,"numFiles":1,"truncated":false}}
{"parentUuid":"4607ecab-c493-4e9e-9671-d2eca30ddfaa","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016zA1a4uN4aqbnv87UUp5nb","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me read all the key files to document the zoom and landmark functionality:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":222,"cache_creation_input_tokens":773,"cache_read_input_tokens":33249,"cache_creation":{"ephemeral_5m_input_tokens":773,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWWUEvQTYEmNRE4AdMu7g","type":"assistant","uuid":"6324d1f9-9651-4407-9905-f676dc4b6187","timestamp":"2025-12-27T03:19:46.469Z"}
{"parentUuid":"6324d1f9-9651-4407-9905-f676dc4b6187","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016zA1a4uN4aqbnv87UUp5nb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01RZWpMedmixxL1eBF84md1H","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useZoomPan.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":222,"cache_creation_input_tokens":773,"cache_read_input_tokens":33249,"cache_creation":{"ephemeral_5m_input_tokens":773,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWWUEvQTYEmNRE4AdMu7g","type":"assistant","uuid":"ff57b8d7-6223-4fb3-a2ad-264c21710500","timestamp":"2025-12-27T03:19:46.891Z"}
{"parentUuid":"ff57b8d7-6223-4fb3-a2ad-264c21710500","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016zA1a4uN4aqbnv87UUp5nb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VeKXPKiQuWAXRJgTGo4Vdm","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/LandmarkAnalysisTool.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":222,"cache_creation_input_tokens":773,"cache_read_input_tokens":33249,"cache_creation":{"ephemeral_5m_input_tokens":773,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWWUEvQTYEmNRE4AdMu7g","type":"assistant","uuid":"ed5fb471-0bee-42dc-a5d1-c12edbe0ac5b","timestamp":"2025-12-27T03:19:47.463Z"}
{"parentUuid":"ed5fb471-0bee-42dc-a5d1-c12edbe0ac5b","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016zA1a4uN4aqbnv87UUp5nb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0176687F7qSyMRiWgD6qNwAB","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/SideProfileManualTool.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":222,"cache_creation_input_tokens":773,"cache_read_input_tokens":33249,"cache_creation":{"ephemeral_5m_input_tokens":773,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWWUEvQTYEmNRE4AdMu7g","type":"assistant","uuid":"ef1f59f8-ea25-4cb8-ab45-c091099f45e5","timestamp":"2025-12-27T03:19:47.926Z"}
{"parentUuid":"ef1f59f8-ea25-4cb8-ab45-c091099f45e5","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016zA1a4uN4aqbnv87UUp5nb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Bct5KW7d4AYHco2AbzmyCB","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/mediapipeDetection.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":222,"cache_creation_input_tokens":773,"cache_read_input_tokens":33249,"cache_creation":{"ephemeral_5m_input_tokens":773,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWWUEvQTYEmNRE4AdMu7g","type":"assistant","uuid":"09fe359e-85a4-4328-887f-9efdc317bc2a","timestamp":"2025-12-27T03:19:48.386Z"}
{"parentUuid":"09fe359e-85a4-4328-887f-9efdc317bc2a","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016zA1a4uN4aqbnv87UUp5nb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01S2q4yYAHvLFQYXg9y1pZ3B","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":222,"cache_creation_input_tokens":773,"cache_read_input_tokens":33249,"cache_creation":{"ephemeral_5m_input_tokens":773,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWWUEvQTYEmNRE4AdMu7g","type":"assistant","uuid":"1cb38b6a-48a5-451e-a5b3-c734c408eb99","timestamp":"2025-12-27T03:19:48.914Z"}
{"parentUuid":"1cb38b6a-48a5-451e-a5b3-c734c408eb99","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_016zA1a4uN4aqbnv87UUp5nb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01UHtgZRutvmf8bgNyie1VcS","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarkImages.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":222,"cache_creation_input_tokens":773,"cache_read_input_tokens":33249,"cache_creation":{"ephemeral_5m_input_tokens":773,"ephemeral_1h_input_tokens":0},"output_tokens":429,"service_tier":"standard"}},"requestId":"req_011CWWUEvQTYEmNRE4AdMu7g","type":"assistant","uuid":"15631875-0869-4f24-b71a-e01f4f0b9666","timestamp":"2025-12-27T03:19:49.345Z"}
{"parentUuid":"15631875-0869-4f24-b71a-e01f4f0b9666","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01RZWpMedmixxL1eBF84md1H","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useState, useCallback } from 'react';\n     4→\n     5→interface UseZoomPanOptions {\n     6→  /** Initial zoom level (default: 2) - matches FaceIQ starting zoom */\n     7→  initialZoom?: number;\n     8→  /** Minimum zoom level (default: 2) - FaceIQ minimum */\n     9→  minZoom?: number;\n    10→  /** Maximum zoom level (default: 8) - FaceIQ maximum */\n    11→  maxZoom?: number;\n    12→  /** Available zoom levels for quick selection (default: [2, 4, 8]) - FaceIQ parity */\n    13→  zoomLevels?: number[];\n    14→}\n    15→\n    16→interface UseZoomPanReturn {\n    17→  /** Current zoom level */\n    18→  zoomLevel: number;\n    19→  /** Set zoom level directly */\n    20→  setZoomLevel: (level: number) => void;\n    21→  /** Current pan offset */\n    22→  pan: { x: number; y: number };\n    23→  /** Set pan offset directly */\n    24→  setPan: (pan: { x: number; y: number }) => void;\n    25→  /** Whether user is currently dragging to pan */\n    26→  isDragging: boolean;\n    27→  /** Reset zoom and pan to initial state */\n    28→  resetZoom: () => void;\n    29→  /** Mouse down handler for drag initiation */\n    30→  handleMouseDown: (e: React.MouseEvent) => void;\n    31→  /** Mouse move handler for panning */\n    32→  handleMouseMove: (e: React.MouseEvent) => void;\n    33→  /** Mouse up handler to end drag */\n    34→  handleMouseUp: () => void;\n    35→  /** Get cursor style based on current state */\n    36→  getCursor: () => string;\n    37→  /** Inverse scale for landmark sizing (1/zoomLevel) */\n    38→  inverseScale: number;\n    39→  /** Available zoom levels */\n    40→  zoomLevels: number[];\n    41→  /** Zoom to center on a specific point */\n    42→  zoomToPoint: (\n    43→    normalizedX: number,\n    44→    normalizedY: number,\n    45→    bounds: {\n    46→      offsetX: number;\n    47→      offsetY: number;\n    48→      renderedWidth: number;\n    49→      renderedHeight: number;\n    50→      containerWidth: number;\n    51→      containerHeight: number;\n    52→    },\n    53→    targetZoom?: number\n    54→  ) => void;\n    55→}\n    56→\n    57→/**\n    58→ * Custom hook for zoom and pan functionality.\n    59→ * Extracts common zoom/pan logic used across landmark tools.\n    60→ */\n    61→export function useZoomPan(options: UseZoomPanOptions = {}): UseZoomPanReturn {\n    62→  const {\n    63→    initialZoom = 2,\n    64→    minZoom = 2,\n    65→    maxZoom = 8,\n    66→    zoomLevels = [2, 4, 8],\n    67→  } = options;\n    68→\n    69→  const [zoomLevel, setZoomLevelState] = useState(initialZoom);\n    70→  const [pan, setPan] = useState({ x: 0, y: 0 });\n    71→  const [isDragging, setIsDragging] = useState(false);\n    72→\n    73→  const setZoomLevel = useCallback(\n    74→    (level: number, containerCenter?: { x: number; y: number }) => {\n    75→      const clampedLevel = Math.max(minZoom, Math.min(maxZoom, level));\n    76→\n    77→      // Reset pan when zooming to 1x\n    78→      if (clampedLevel === 1) {\n    79→        setZoomLevelState(1);\n    80→        setPan({ x: 0, y: 0 });\n    81→        return;\n    82→      }\n    83→\n    84→      // If container center is provided, adjust pan to keep the same point centered\n    85→      if (containerCenter) {\n    86→        setPan(prevPan => {\n    87→          // Current center in image space: imageCenter = (containerCenter - pan) / oldZoom\n    88→          // New pan to show same center: newPan = containerCenter - imageCenter * newZoom\n    89→          const imageCenterX = (containerCenter.x - prevPan.x) / zoomLevel;\n    90→          const imageCenterY = (containerCenter.y - prevPan.y) / zoomLevel;\n    91→          return {\n    92→            x: containerCenter.x - imageCenterX * clampedLevel,\n    93→            y: containerCenter.y - imageCenterY * clampedLevel,\n    94→          };\n    95→        });\n    96→      }\n    97→\n    98→      setZoomLevelState(clampedLevel);\n    99→    },\n   100→    [minZoom, maxZoom, zoomLevel]\n   101→  );\n   102→\n   103→  const resetZoom = useCallback(() => {\n   104→    setZoomLevelState(initialZoom);\n   105→    setPan({ x: 0, y: 0 });\n   106→  }, [initialZoom]);\n   107→\n   108→  const handleMouseDown = useCallback(\n   109→    (e: React.MouseEvent) => {\n   110→      if (e.button === 0 && zoomLevel > 1) {\n   111→        setIsDragging(true);\n   112→      }\n   113→    },\n   114→    [zoomLevel]\n   115→  );\n   116→\n   117→  const handleMouseMove = useCallback(\n   118→    (e: React.MouseEvent) => {\n   119→      if (isDragging && zoomLevel > 1) {\n   120→        setPan((prev) => ({\n   121→          x: prev.x + e.movementX,\n   122→          y: prev.y + e.movementY,\n   123→        }));\n   124→      }\n   125→    },\n   126→    [isDragging, zoomLevel]\n   127→  );\n   128→\n   129→  const handleMouseUp = useCallback(() => {\n   130→    setIsDragging(false);\n   131→  }, []);\n   132→\n   133→  const getCursor = useCallback(() => {\n   134→    if (zoomLevel > 1 && isDragging) return 'grabbing';\n   135→    if (zoomLevel > 1) return 'grab';\n   136→    return 'crosshair';\n   137→  }, [zoomLevel, isDragging]);\n   138→\n   139→  const zoomToPoint = useCallback(\n   140→    (\n   141→      normalizedX: number,\n   142→      normalizedY: number,\n   143→      bounds: {\n   144→        offsetX: number;\n   145→        offsetY: number;\n   146→        renderedWidth: number;\n   147→        renderedHeight: number;\n   148→        containerWidth: number;\n   149→        containerHeight: number;\n   150→      },\n   151→      targetZoom = 2\n   152→    ) => {\n   153→      setZoomLevelState(targetZoom);\n   154→\n   155→      // Calculate pan to center the point\n   156→      const centerX = bounds.containerWidth / 2;\n   157→      const centerY = bounds.containerHeight / 2;\n   158→      const pointX = bounds.offsetX + normalizedX * bounds.renderedWidth;\n   159→      const pointY = bounds.offsetY + normalizedY * bounds.renderedHeight;\n   160→\n   161→      setPan({\n   162→        x: (centerX - pointX) * targetZoom,\n   163→        y: (centerY - pointY) * targetZoom,\n   164→      });\n   165→    },\n   166→    []\n   167→  );\n   168→\n   169→  return {\n   170→    zoomLevel,\n   171→    setZoomLevel,\n   172→    pan,\n   173→    setPan,\n   174→    isDragging,\n   175→    resetZoom,\n   176→    handleMouseDown,\n   177→    handleMouseMove,\n   178→    handleMouseUp,\n   179→    getCursor,\n   180→    inverseScale: 1 / zoomLevel,\n   181→    zoomLevels,\n   182→    zoomToPoint,\n   183→  };\n   184→}\n   185→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"6efef8a6-9023-4030-8daf-7d3cc07c92cc","timestamp":"2025-12-27T03:19:49.394Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useZoomPan.ts","content":"'use client';\n\nimport { useState, useCallback } from 'react';\n\ninterface UseZoomPanOptions {\n  /** Initial zoom level (default: 2) - matches FaceIQ starting zoom */\n  initialZoom?: number;\n  /** Minimum zoom level (default: 2) - FaceIQ minimum */\n  minZoom?: number;\n  /** Maximum zoom level (default: 8) - FaceIQ maximum */\n  maxZoom?: number;\n  /** Available zoom levels for quick selection (default: [2, 4, 8]) - FaceIQ parity */\n  zoomLevels?: number[];\n}\n\ninterface UseZoomPanReturn {\n  /** Current zoom level */\n  zoomLevel: number;\n  /** Set zoom level directly */\n  setZoomLevel: (level: number) => void;\n  /** Current pan offset */\n  pan: { x: number; y: number };\n  /** Set pan offset directly */\n  setPan: (pan: { x: number; y: number }) => void;\n  /** Whether user is currently dragging to pan */\n  isDragging: boolean;\n  /** Reset zoom and pan to initial state */\n  resetZoom: () => void;\n  /** Mouse down handler for drag initiation */\n  handleMouseDown: (e: React.MouseEvent) => void;\n  /** Mouse move handler for panning */\n  handleMouseMove: (e: React.MouseEvent) => void;\n  /** Mouse up handler to end drag */\n  handleMouseUp: () => void;\n  /** Get cursor style based on current state */\n  getCursor: () => string;\n  /** Inverse scale for landmark sizing (1/zoomLevel) */\n  inverseScale: number;\n  /** Available zoom levels */\n  zoomLevels: number[];\n  /** Zoom to center on a specific point */\n  zoomToPoint: (\n    normalizedX: number,\n    normalizedY: number,\n    bounds: {\n      offsetX: number;\n      offsetY: number;\n      renderedWidth: number;\n      renderedHeight: number;\n      containerWidth: number;\n      containerHeight: number;\n    },\n    targetZoom?: number\n  ) => void;\n}\n\n/**\n * Custom hook for zoom and pan functionality.\n * Extracts common zoom/pan logic used across landmark tools.\n */\nexport function useZoomPan(options: UseZoomPanOptions = {}): UseZoomPanReturn {\n  const {\n    initialZoom = 2,\n    minZoom = 2,\n    maxZoom = 8,\n    zoomLevels = [2, 4, 8],\n  } = options;\n\n  const [zoomLevel, setZoomLevelState] = useState(initialZoom);\n  const [pan, setPan] = useState({ x: 0, y: 0 });\n  const [isDragging, setIsDragging] = useState(false);\n\n  const setZoomLevel = useCallback(\n    (level: number, containerCenter?: { x: number; y: number }) => {\n      const clampedLevel = Math.max(minZoom, Math.min(maxZoom, level));\n\n      // Reset pan when zooming to 1x\n      if (clampedLevel === 1) {\n        setZoomLevelState(1);\n        setPan({ x: 0, y: 0 });\n        return;\n      }\n\n      // If container center is provided, adjust pan to keep the same point centered\n      if (containerCenter) {\n        setPan(prevPan => {\n          // Current center in image space: imageCenter = (containerCenter - pan) / oldZoom\n          // New pan to show same center: newPan = containerCenter - imageCenter * newZoom\n          const imageCenterX = (containerCenter.x - prevPan.x) / zoomLevel;\n          const imageCenterY = (containerCenter.y - prevPan.y) / zoomLevel;\n          return {\n            x: containerCenter.x - imageCenterX * clampedLevel,\n            y: containerCenter.y - imageCenterY * clampedLevel,\n          };\n        });\n      }\n\n      setZoomLevelState(clampedLevel);\n    },\n    [minZoom, maxZoom, zoomLevel]\n  );\n\n  const resetZoom = useCallback(() => {\n    setZoomLevelState(initialZoom);\n    setPan({ x: 0, y: 0 });\n  }, [initialZoom]);\n\n  const handleMouseDown = useCallback(\n    (e: React.MouseEvent) => {\n      if (e.button === 0 && zoomLevel > 1) {\n        setIsDragging(true);\n      }\n    },\n    [zoomLevel]\n  );\n\n  const handleMouseMove = useCallback(\n    (e: React.MouseEvent) => {\n      if (isDragging && zoomLevel > 1) {\n        setPan((prev) => ({\n          x: prev.x + e.movementX,\n          y: prev.y + e.movementY,\n        }));\n      }\n    },\n    [isDragging, zoomLevel]\n  );\n\n  const handleMouseUp = useCallback(() => {\n    setIsDragging(false);\n  }, []);\n\n  const getCursor = useCallback(() => {\n    if (zoomLevel > 1 && isDragging) return 'grabbing';\n    if (zoomLevel > 1) return 'grab';\n    return 'crosshair';\n  }, [zoomLevel, isDragging]);\n\n  const zoomToPoint = useCallback(\n    (\n      normalizedX: number,\n      normalizedY: number,\n      bounds: {\n        offsetX: number;\n        offsetY: number;\n        renderedWidth: number;\n        renderedHeight: number;\n        containerWidth: number;\n        containerHeight: number;\n      },\n      targetZoom = 2\n    ) => {\n      setZoomLevelState(targetZoom);\n\n      // Calculate pan to center the point\n      const centerX = bounds.containerWidth / 2;\n      const centerY = bounds.containerHeight / 2;\n      const pointX = bounds.offsetX + normalizedX * bounds.renderedWidth;\n      const pointY = bounds.offsetY + normalizedY * bounds.renderedHeight;\n\n      setPan({\n        x: (centerX - pointX) * targetZoom,\n        y: (centerY - pointY) * targetZoom,\n      });\n    },\n    []\n  );\n\n  return {\n    zoomLevel,\n    setZoomLevel,\n    pan,\n    setPan,\n    isDragging,\n    resetZoom,\n    handleMouseDown,\n    handleMouseMove,\n    handleMouseUp,\n    getCursor,\n    inverseScale: 1 / zoomLevel,\n    zoomLevels,\n    zoomToPoint,\n  };\n}\n","numLines":185,"startLine":1,"totalLines":185}}}
{"parentUuid":"6efef8a6-9023-4030-8daf-7d3cc07c92cc","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Bct5KW7d4AYHco2AbzmyCB","type":"tool_result","content":"     1→/**\n     2→ * Face Landmark Detection using MediaPipe Tasks Vision\n     3→ * Maps detected landmarks to our custom facial landmarks\n     4→ *\n     5→ * Detection hierarchy:\n     6→ * - Front profile: MediaPipe Face Mesh (478 landmarks)\n     7→ * - Side profile: Server-side InsightFace (106 landmarks) → Edge-based fallback\n     8→ */\n     9→\n    10→import { faceDetectionService } from './faceDetectionService';\n    11→import { detectSideProfile } from './sideProfileDetection';\n    12→import { detectSideProfileServer } from './serverSideDetection';\n    13→\n    14→// MediaPipe Face Mesh landmark indices (478 landmarks total)\n    15→// Reference: https://github.com/google/mediapipe/blob/master/mediapipe/modules/face_geometry/data/canonical_face_model_uv_visualization.png\n    16→\n    17→// Front profile landmark mapping\n    18→// Based on the reference website's exact MediaPipe indices\n    19→// Uses SUBJECT's perspective: \"left\" = subject's left (appears on RIGHT side of image)\n    20→export const MEDIAPIPE_FRONT_MAPPING: Record<string, number> = {\n    21→  // Head\n    22→  // Note: MediaPipe 10 is the forehead/glabella, not actual hairline\n    23→  // We apply a Y offset during mapping to estimate the hairline position\n    24→  trichion: 10, // hairline (requires Y offset - see TRICHION_Y_OFFSET)\n    25→\n    26→  // Left Eye (subject's LEFT eye - appears on RIGHT of image)\n    27→  left_pupila: 468,\n    28→  left_canthus_medialis: 133,\n    29→  left_canthus_lateralis: 33,\n    30→  left_palpebra_superior: 470,\n    31→  left_palpebra_inferior: 472,\n    32→  left_sulcus_palpebralis_lateralis: 247,\n    33→  left_pretarsal_skin_crease: 470,\n    34→\n    35→  // Right Eye (subject's RIGHT eye - appears on LEFT of image)\n    36→  right_pupila: 473,\n    37→  right_canthus_medialis: 362,\n    38→  right_canthus_lateralis: 263,\n    39→  right_palpebra_superior: 475,\n    40→  right_palpebra_inferior: 374,\n    41→  right_sulcus_palpebralis_lateralis: 467,\n    42→  right_pretarsal_skin_crease: 475,\n    43→\n    44→  // Left Brow (subject's LEFT brow - appears on RIGHT of image)\n    45→  left_supercilium_medialis: 107,\n    46→  left_supercilium_medial_corner: 55,\n    47→  left_supercilium_superior: 52,\n    48→  left_supercilium_apex: 105,\n    49→  left_supercilium_lateralis: 70,\n    50→\n    51→  // Right Brow (subject's RIGHT brow - appears on LEFT of image)\n    52→  right_supercilium_medialis: 336,\n    53→  right_supercilium_medial_corner: 285,\n    54→  right_supercilium_superior: 282,\n    55→  right_supercilium_apex: 334,\n    56→  right_supercilium_lateralis: 276,\n    57→\n    58→  // Nose\n    59→  nasal_base: 290, // Base of nose (per landmarkers.js)\n    60→  left_dorsum_nasi: 174,\n    61→  right_dorsum_nasi: 399,\n    62→  left_ala_nasi: 48,\n    63→  right_ala_nasi: 278,\n    64→  subnasale: 2, // noseBottom in landmarkers.js\n    65→  nasion: 6, // Added for correct FWHR calculation\n    66→  glabella: 9, // Added for reference\n    67→\n    68→  // Mouth\n    69→  labrale_superius: 267, // cupidsBow - peak of cupid's bow\n    70→  cupids_bow: 0, // innerCupidsBow - center dip of upper lip\n    71→  mouth_middle: 14,\n    72→  labrale_inferius: 17,\n    73→  left_cheilion: 61,\n    74→  right_cheilion: 306,\n    75→\n    76→  // Jaw\n    77→  left_gonion_superior: 58,\n    78→  right_gonion_superior: 288,\n    79→  left_gonion_inferior: 172,\n    80→  right_gonion_inferior: 397,\n    81→\n    82→  // Chin\n    83→  left_mentum_lateralis: 176,\n    84→  right_mentum_lateralis: 400,\n    85→  menton: 152,\n    86→\n    87→  // Cheeks\n    88→  left_zygion: 234,\n    89→  right_zygion: 454,\n    90→  left_malar: 205,        // Cheek center point for fullness calculation\n    91→  right_malar: 425,       // Cheek center point for fullness calculation\n    92→  left_temporal: 54,\n    93→  right_temporal: 284,\n    94→\n    95→  // Ears\n    96→  left_auricular_lateral: 127,\n    97→  right_auricular_lateral: 356,\n    98→\n    99→  // Neck (same as bottom gonion indices, but apply +5% yOffset when rendering)\n   100→  // Per landmarkers.js: neckLeft: 172 with yOffset: 0.05, neckRight: 397 with yOffset: 0.05\n   101→  left_cervical_lateralis: 172,\n   102→  right_cervical_lateralis: 397,\n   103→};\n   104→\n   105→// ============================================\n   106→// DEPTH VARIANCE RESULT INTERFACE\n   107→// ============================================\n   108→\n   109→export interface DepthVarianceResult {\n   110→  isValid: boolean;\n   111→  confidence: number;\n   112→  depthSpread: number;        // Horizontal distance from nose to ear (0-1 normalized)\n   113→  nosalProjection: number;    // How much the nose projects forward\n   114→  frankfortDeviation: number; // Degrees deviation from horizontal\n   115→  issues: string[];           // List of validation issues\n   116→}\n   117→\n   118→// Side profile landmark mapping (IDs must match SIDE_PROFILE_LANDMARKS in landmarks.ts)\n   119→// Matches 28 side profile landmarks exactly\n   120→// For side profile photos, uses MediaPipe LEFT indices (appearing on left side of image)\n   121→// Note: Server uses a custom server-side model for side detection; this is our MediaPipe fallback\n   122→export const MEDIAPIPE_SIDE_MAPPING: Record<string, number> = {\n   123→  // 1. vertex - top of head\n   124→  vertex: 10,\n   125→  // 2. occiput - back of head (no good MediaPipe equivalent, use top)\n   126→  occiput: 10,\n   127→  // 3. pronasale - nose tip\n   128→  pronasale: 1,\n   129→  // 4. neckPoint - lower neck (no good equivalent, use chin)\n   130→  neckPoint: 152,\n   131→  // 5. porion - ear canal opening (use ear area)\n   132→  porion: 127,\n   133→  // 6. orbitale - lowest point of orbital rim (index 33 per cephalometric landmarkers.js)\n   134→  orbitale: 33,\n   135→  // 7. tragus - ear cartilage\n   136→  tragus: 127,\n   137→  // 8. intertragicNotch - notch in ear\n   138→  intertragicNotch: 127,\n   139→  // 9. cornealApex - forward point of cornea\n   140→  cornealApex: 468,\n   141→  // 10. cheekbone - zygomatic prominence\n   142→  cheekbone: 234,\n   143→  // 11. trichion - hairline\n   144→  trichion: 10,\n   145→  // 12. glabella - between brows\n   146→  glabella: 9,\n   147→  // 13. nasion - nasal root depression\n   148→  nasion: 6,\n   149→  // 14. rhinion - dorsal nose point\n   150→  rhinion: 4,\n   151→  // 15. supratip - above nose tip\n   152→  supratip: 4,\n   153→  // 16. infratip - below nose tip\n   154→  infratip: 2,\n   155→  // 17. columella - nasal septum\n   156→  columella: 2,\n   157→  // 18. subnasale - nose base meets upper lip\n   158→  subnasale: 2,\n   159→  // 19. subalare - nostril wing\n   160→  subalare: 129,\n   161→  // 20. labraleSuperius - upper lip\n   162→  labraleSuperius: 0,\n   163→  // 21. cheilion - mouth corner\n   164→  cheilion: 61,\n   165→  // 22. labraleInferius - lower lip\n   166→  labraleInferius: 17,\n   167→  // 23. sublabiale - below lower lip\n   168→  sublabiale: 18,\n   169→  // 24. pogonion - chin point\n   170→  pogonion: 152,\n   171→  // 25. menton - chin bottom\n   172→  menton: 152,\n   173→  // 26. cervicalPoint - high neck point\n   174→  cervicalPoint: 152,\n   175→  // 27. gonionTop - upper jaw angle\n   176→  gonionTop: 116,\n   177→  // 28. gonionBottom - lower jaw angle\n   178→  gonionBottom: 172,\n   179→};\n   180→\n   181→export interface DetectedLandmarks {\n   182→  landmarks: Array<{ id: string; x: number; y: number }>;\n   183→  confidence: number;\n   184→  faceBox: { x: number; y: number; width: number; height: number };\n   185→  frankfortPlane?: {\n   186→    angle: number;\n   187→    orbitale: { x: number; y: number };\n   188→    porion: { x: number; y: number };\n   189→  };\n   190→  depthValidation?: DepthVarianceResult;\n   191→}\n   192→\n   193→/**\n   194→ * Detect facial landmarks from an image URL\n   195→ *\n   196→ * Detection hierarchy:\n   197→ * - Front profile: MediaPipe Face Mesh (478 landmarks) - unchanged\n   198→ * - Side profile: Server-side InsightFace → Edge-based fallback → Manual placement\n   199→ */\n   200→export async function detectFromImageUrl(\n   201→  imageUrl: string,\n   202→  mode: 'front' | 'side'\n   203→): Promise<DetectedLandmarks | null> {\n   204→  try {\n   205→    // ============================================\n   206→    // SIDE PROFILE: Use server-side detection\n   207→    // ============================================\n   208→    if (mode === 'side') {\n   209→      console.log('[Detection] Side profile mode - trying server-side detection...');\n   210→\n   211→      // Try server-side InsightFace first (best accuracy)\n   212→      const serverResult = await detectSideProfileServer(imageUrl);\n   213→      if (serverResult) {\n   214→        console.log('[Detection] Server-side detection succeeded');\n   215→\n   216→        // Validate side profile depth variance\n   217→        const depthValidation = validateSideProfileDepth(\n   218→          serverResult.landmarks,\n   219→          serverResult.frankfortPlane\n   220→        );\n   221→        console.log('[Detection] Depth validation:', {\n   222→          isValid: depthValidation.isValid,\n   223→          confidence: depthValidation.confidence.toFixed(2),\n   224→          depthSpread: (depthValidation.depthSpread * 100).toFixed(1) + '%',\n   225→          issues: depthValidation.issues,\n   226→        });\n   227→\n   228→        return {\n   229→          landmarks: serverResult.landmarks,\n   230→          confidence: serverResult.confidence,\n   231→          faceBox: serverResult.faceBox,\n   232→          frankfortPlane: serverResult.frankfortPlane,\n   233→          depthValidation,\n   234→        };\n   235→      }\n   236→\n   237→      console.log('[Detection] Server-side failed, trying edge-based detection...');\n   238→\n   239→      // Fallback to edge-based detection\n   240→      const sideResult = await detectSideProfile(imageUrl);\n   241→      if (sideResult) {\n   242→        console.log('[Detection] Edge-based side profile detection succeeded');\n   243→\n   244→        // Validate side profile depth variance\n   245→        const depthValidation = validateSideProfileDepth(sideResult.landmarks);\n   246→        console.log('[Detection] Depth validation (edge-based):', {\n   247→          isValid: depthValidation.isValid,\n   248→          confidence: depthValidation.confidence.toFixed(2),\n   249→          issues: depthValidation.issues,\n   250→        });\n   251→\n   252→        return {\n   253→          landmarks: sideResult.landmarks,\n   254→          confidence: sideResult.confidence,\n   255→          faceBox: {\n   256→            x: 0,\n   257→            y: 0,\n   258→            width: 1,\n   259→            height: 1,\n   260→          },\n   261→          depthValidation,\n   262→        };\n   263→      }\n   264→\n   265→      console.log('[Detection] All side profile detection methods failed - manual placement required');\n   266→      return null;\n   267→    }\n   268→\n   269→    // ============================================\n   270→    // FRONT PROFILE: Use MediaPipe (UNCHANGED)\n   271→    // ============================================\n   272→    // Load the image\n   273→    const img = await loadImage(imageUrl);\n   274→\n   275→    // Use the singleton service\n   276→    const result = await faceDetectionService.detect(img);\n   277→\n   278→    // Check if MediaPipe detected a face\n   279→    const mediaPipeSucceeded = result.faceLandmarks && result.faceLandmarks.length > 0;\n   280→\n   281→    if (!mediaPipeSucceeded) {\n   282→      console.log('No faces detected');\n   283→      return null;\n   284→    }\n   285→\n   286→    const faceLandmarks = result.faceLandmarks[0];\n   287→\n   288→    // Front profile uses MediaPipe mapping\n   289→    const mapping = MEDIAPIPE_FRONT_MAPPING;\n   290→\n   291→    // FaceIQ Parity: Exact landmark offsets from FaceIQ's landmarkers.js\n   292→    // These offsets correct MediaPipe's raw positions to match cephalometric standards\n   293→    const LANDMARK_OFFSETS: Record<string, { xOffset?: number; yOffset?: number }> = {\n   294→      // Hairline offset: MediaPipe index 10 is forehead/glabella, not actual hairline\n   295→      trichion: { yOffset: -0.06 },\n   296→\n   297→      // Pupil offsets: small adjustments for accurate pupil center\n   298→      left_pupila: { xOffset: 0.0015, yOffset: -0.005 },\n   299→      right_pupila: { xOffset: -0.0015, yOffset: -0.005 },\n   300→\n   301→      // Nose side offsets: widen nose detection slightly\n   302→      left_ala_nasi: { xOffset: 0.0025 },\n   303→      right_ala_nasi: { xOffset: -0.0025 },\n   304→\n   305→      // Temple offsets: move temples up slightly\n   306→      left_temporal: { yOffset: -0.01 },\n   307→      right_temporal: { yOffset: -0.01 },\n   308→\n   309→      // Outer ear offsets: push ears outward for accurate face width\n   310→      left_auricular_lateral: { xOffset: -0.04 },\n   311→      right_auricular_lateral: { xOffset: 0.04 },\n   312→\n   313→      // Neck offsets: move neck points down\n   314→      left_cervical_lateralis: { yOffset: 0.05 },\n   315→      right_cervical_lateralis: { yOffset: 0.05 },\n   316→\n   317→      // Upper eyelid crease offsets: move crease up slightly\n   318→      left_pretarsal_skin_crease: { yOffset: -0.015 },\n   319→      right_pretarsal_skin_crease: { yOffset: -0.015 },\n   320→    };\n   321→\n   322→    // Map keypoints to our landmarks\n   323→    const landmarks = Object.entries(mapping).map(([id, index]) => {\n   324→      // Handle index bounds\n   325→      const safeIndex = Math.min(index, faceLandmarks.length - 1);\n   326→      const landmark = faceLandmarks[safeIndex];\n   327→\n   328→      // Apply offsets from FaceIQ parity table\n   329→      const offsets = LANDMARK_OFFSETS[id] || {};\n   330→      const xOffset = offsets.xOffset || 0;\n   331→      const yOffset = offsets.yOffset || 0;\n   332→\n   333→      return {\n   334→        id,\n   335→        // MediaPipe returns normalized coordinates (0-1)\n   336→        // Apply FaceIQ-matching offsets and clamp to valid range\n   337→        x: landmark ? Math.max(0, Math.min(landmark.x + xOffset, 1)) : 0.5,\n   338→        y: landmark ? Math.max(0, Math.min(landmark.y + yOffset, 1)) : 0.5,\n   339→      };\n   340→    });\n   341→\n   342→    // Calculate face bounding box from all landmarks\n   343→    let minX = 1, minY = 1, maxX = 0, maxY = 0;\n   344→    faceLandmarks.forEach((lm) => {\n   345→      minX = Math.min(minX, lm.x);\n   346→      minY = Math.min(minY, lm.y);\n   347→      maxX = Math.max(maxX, lm.x);\n   348→      maxY = Math.max(maxY, lm.y);\n   349→    });\n   350→\n   351→    return {\n   352→      landmarks,\n   353→      confidence: 0.95, // MediaPipe doesn't return confidence per landmark\n   354→      faceBox: {\n   355→        x: minX,\n   356→        y: minY,\n   357→        width: maxX - minX,\n   358→        height: maxY - minY,\n   359→      },\n   360→    };\n   361→  } catch (error) {\n   362→    console.error('Face detection error:', error);\n   363→    return null;\n   364→  }\n   365→}\n   366→\n   367→/**\n   368→ * Load an image from URL\n   369→ */\n   370→function loadImage(url: string): Promise<HTMLImageElement> {\n   371→  return new Promise((resolve, reject) => {\n   372→    const img = new Image();\n   373→    img.crossOrigin = 'anonymous';\n   374→    img.onload = () => resolve(img);\n   375→    img.onerror = (e) => reject(e);\n   376→    img.src = url;\n   377→  });\n   378→}\n   379→\n   380→// ============================================\n   381→// SIDE PROFILE DEPTH VARIANCE VALIDATION\n   382→// ============================================\n   383→\n   384→/**\n   385→ * Validate 3D depth variance from side profile landmarks\n   386→ *\n   387→ * Checks that the photo shows a true side profile by analyzing:\n   388→ * 1. Depth spread: Horizontal distance from nose tip to ear landmarks\n   389→ * 2. Nasal projection: How far the nose projects forward\n   390→ * 3. Frankfort plane: Should be relatively horizontal in proper side profiles\n   391→ *\n   392→ * @param landmarks Array of detected landmarks with x, y coordinates\n   393→ * @param frankfortPlane Optional Frankfort plane data\n   394→ * @returns Validation result with confidence score and issues\n   395→ */\n   396→export function validateSideProfileDepth(\n   397→  landmarks: Array<{ id: string; x: number; y: number }>,\n   398→  frankfortPlane?: { angle: number; orbitale: { x: number; y: number }; porion: { x: number; y: number } }\n   399→): DepthVarianceResult {\n   400→  const issues: string[] = [];\n   401→  let confidence = 1.0;\n   402→\n   403→  // Get key landmarks for depth validation\n   404→  const getLandmark = (id: string) => landmarks.find(l => l.id === id);\n   405→\n   406→  const pronasale = getLandmark('pronasale');     // Nose tip\n   407→  const nasion = getLandmark('nasion');           // Nasal root\n   408→  const porion = getLandmark('porion');           // Ear opening\n   409→  const tragus = getLandmark('tragus');           // Ear cartilage\n   410→  const orbitale = getLandmark('orbitale');       // Lowest orbital point\n   411→  const pogonion = getLandmark('pogonion');       // Chin point\n   412→  const subnasale = getLandmark('subnasale');     // Nose base\n   413→\n   414→  // Calculate depth spread (nose to ear horizontal distance)\n   415→  let depthSpread = 0;\n   416→  const earLandmark = porion || tragus;\n   417→\n   418→  if (pronasale && earLandmark) {\n   419→    // In a true side profile, nose tip should be significantly forward of ear\n   420→    depthSpread = Math.abs(pronasale.x - earLandmark.x);\n   421→\n   422→    // Minimum depth spread threshold (nose should be at least 15% face width from ear)\n   423→    const MIN_DEPTH_SPREAD = 0.15;\n   424→    if (depthSpread < MIN_DEPTH_SPREAD) {\n   425→      issues.push(`Insufficient depth spread (${(depthSpread * 100).toFixed(1)}%): Photo may not be a true side profile`);\n   426→      confidence -= 0.3;\n   427→    }\n   428→  } else {\n   429→    issues.push('Missing key landmarks for depth calculation (pronasale or ear landmark)');\n   430→    confidence -= 0.4;\n   431→  }\n   432→\n   433→  // Calculate nasal projection\n   434→  let nosalProjection = 0;\n   435→  if (pronasale && subnasale) {\n   436→    // Nasal projection: horizontal distance from nose base to tip\n   437→    nosalProjection = Math.abs(pronasale.x - subnasale.x);\n   438→\n   439→    // Minimum nasal projection (nose tip should project at least 5% forward of base)\n   440→    const MIN_NASAL_PROJECTION = 0.05;\n   441→    if (nosalProjection < MIN_NASAL_PROJECTION) {\n   442→      issues.push(`Low nasal projection (${(nosalProjection * 100).toFixed(1)}%): Profile angle may be too frontal`);\n   443→      confidence -= 0.2;\n   444→    }\n   445→  }\n   446→\n   447→  // Check Frankfort plane deviation\n   448→  let frankfortDeviation = 0;\n   449→  if (frankfortPlane) {\n   450→    frankfortDeviation = Math.abs(frankfortPlane.angle);\n   451→\n   452→    // Frankfort plane should be within ±10 degrees of horizontal in ideal photos\n   453→    const MAX_FRANKFORT_DEVIATION = 15;\n   454→    if (frankfortDeviation > MAX_FRANKFORT_DEVIATION) {\n   455→      issues.push(`Head tilt detected (${frankfortDeviation.toFixed(1)}°): Consider re-taking photo with head level`);\n   456→      confidence -= 0.15;\n   457→    }\n   458→  } else if (orbitale && (porion || tragus)) {\n   459→    // Calculate from landmarks if not provided\n   460→    const ear = porion || tragus;\n   461→    if (ear && orbitale) {\n   462→      const dx = ear.x - orbitale.x;\n   463→      const dy = ear.y - orbitale.y;\n   464→      frankfortDeviation = Math.abs(Math.atan2(dy, dx) * (180 / Math.PI));\n   465→\n   466→      const MAX_FRANKFORT_DEVIATION = 15;\n   467→      if (frankfortDeviation > MAX_FRANKFORT_DEVIATION) {\n   468→        issues.push(`Head tilt detected (${frankfortDeviation.toFixed(1)}°): Consider re-taking photo with head level`);\n   469→        confidence -= 0.15;\n   470→      }\n   471→    }\n   472→  }\n   473→\n   474→  // Additional validation: Check landmark horizontal ordering\n   475→  // In a true side profile facing left, nose should be leftmost, ear rightmost\n   476→  // In a true side profile facing right, the opposite\n   477→  if (pronasale && earLandmark && nasion) {\n   478→    const noseToEar = pronasale.x - earLandmark.x;\n   479→    const nasionToEar = nasion.x - earLandmark.x;\n   480→\n   481→    // Both should have the same sign (nose and nasion on same side relative to ear)\n   482→    if (noseToEar * nasionToEar < 0) {\n   483→      issues.push('Inconsistent landmark positions: May indicate partial profile or rotation');\n   484→      confidence -= 0.2;\n   485→    }\n   486→  }\n   487→\n   488→  // Check chin position relative to profile\n   489→  if (pogonion && pronasale && earLandmark) {\n   490→    const chinDepth = Math.abs(pogonion.x - earLandmark.x);\n   491→    const noseDepth = Math.abs(pronasale.x - earLandmark.x);\n   492→\n   493→    // In a normal profile, chin should be closer to ear than nose tip\n   494→    // A severely recessed chin might have issues, but this is a soft check\n   495→    if (noseDepth > 0 && chinDepth / noseDepth < 0.3) {\n   496→      issues.push('Unusual chin position: Very recessed or photo angle issue');\n   497→      confidence -= 0.1;\n   498→    }\n   499→  }\n   500→\n   501→  // Clamp confidence between 0 and 1\n   502→  confidence = Math.max(0, Math.min(1, confidence));\n   503→\n   504→  return {\n   505→    isValid: confidence >= 0.5 && issues.length < 3,\n   506→    confidence,\n   507→    depthSpread,\n   508→    nosalProjection,\n   509→    frankfortDeviation,\n   510→    issues,\n   511→  };\n   512→}\n   513→\n   514→/**\n   515→ * Get the region to zoom into for a specific landmark\n   516→ */\n   517→export function getLandmarkZoomRegion(\n   518→  landmarkId: string\n   519→): { centerX: number; centerY: number; zoomLevel: number } {\n   520→  const regions: Record<string, { centerX: number; centerY: number; zoomLevel: number }> = {\n   521→    // Eyes - zoom in close\n   522→    left_pupila: { centerX: 0.35, centerY: 0.35, zoomLevel: 3 },\n   523→    left_canthus_medialis: { centerX: 0.4, centerY: 0.35, zoomLevel: 3 },\n   524→    left_canthus_lateralis: { centerX: 0.3, centerY: 0.35, zoomLevel: 3 },\n   525→    right_pupila: { centerX: 0.65, centerY: 0.35, zoomLevel: 3 },\n   526→    right_canthus_medialis: { centerX: 0.6, centerY: 0.35, zoomLevel: 3 },\n   527→    right_canthus_lateralis: { centerX: 0.7, centerY: 0.35, zoomLevel: 3 },\n   528→\n   529→    // Brows\n   530→    left_supercilium_apex: { centerX: 0.35, centerY: 0.28, zoomLevel: 2.5 },\n   531→    right_supercilium_apex: { centerX: 0.65, centerY: 0.28, zoomLevel: 2.5 },\n   532→\n   533→    // Nose\n   534→    nasal_base: { centerX: 0.5, centerY: 0.4, zoomLevel: 2 },\n   535→    subnasale: { centerX: 0.5, centerY: 0.55, zoomLevel: 2.5 },\n   536→\n   537→    // Mouth\n   538→    labrale_superius: { centerX: 0.5, centerY: 0.6, zoomLevel: 2.5 },\n   539→    mouth_middle: { centerX: 0.5, centerY: 0.65, zoomLevel: 2 },\n   540→\n   541→    // Chin\n   542→    menton: { centerX: 0.5, centerY: 0.85, zoomLevel: 2 },\n   543→\n   544→    // Default for other landmarks\n   545→    default: { centerX: 0.5, centerY: 0.5, zoomLevel: 1.5 },\n   546→  };\n   547→\n   548→  return regions[landmarkId] || regions.default;\n   549→}\n   550→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"f349d159-df94-4943-bb0c-a6a5652022b5","timestamp":"2025-12-27T03:19:49.394Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/mediapipeDetection.ts","content":"/**\n * Face Landmark Detection using MediaPipe Tasks Vision\n * Maps detected landmarks to our custom facial landmarks\n *\n * Detection hierarchy:\n * - Front profile: MediaPipe Face Mesh (478 landmarks)\n * - Side profile: Server-side InsightFace (106 landmarks) → Edge-based fallback\n */\n\nimport { faceDetectionService } from './faceDetectionService';\nimport { detectSideProfile } from './sideProfileDetection';\nimport { detectSideProfileServer } from './serverSideDetection';\n\n// MediaPipe Face Mesh landmark indices (478 landmarks total)\n// Reference: https://github.com/google/mediapipe/blob/master/mediapipe/modules/face_geometry/data/canonical_face_model_uv_visualization.png\n\n// Front profile landmark mapping\n// Based on the reference website's exact MediaPipe indices\n// Uses SUBJECT's perspective: \"left\" = subject's left (appears on RIGHT side of image)\nexport const MEDIAPIPE_FRONT_MAPPING: Record<string, number> = {\n  // Head\n  // Note: MediaPipe 10 is the forehead/glabella, not actual hairline\n  // We apply a Y offset during mapping to estimate the hairline position\n  trichion: 10, // hairline (requires Y offset - see TRICHION_Y_OFFSET)\n\n  // Left Eye (subject's LEFT eye - appears on RIGHT of image)\n  left_pupila: 468,\n  left_canthus_medialis: 133,\n  left_canthus_lateralis: 33,\n  left_palpebra_superior: 470,\n  left_palpebra_inferior: 472,\n  left_sulcus_palpebralis_lateralis: 247,\n  left_pretarsal_skin_crease: 470,\n\n  // Right Eye (subject's RIGHT eye - appears on LEFT of image)\n  right_pupila: 473,\n  right_canthus_medialis: 362,\n  right_canthus_lateralis: 263,\n  right_palpebra_superior: 475,\n  right_palpebra_inferior: 374,\n  right_sulcus_palpebralis_lateralis: 467,\n  right_pretarsal_skin_crease: 475,\n\n  // Left Brow (subject's LEFT brow - appears on RIGHT of image)\n  left_supercilium_medialis: 107,\n  left_supercilium_medial_corner: 55,\n  left_supercilium_superior: 52,\n  left_supercilium_apex: 105,\n  left_supercilium_lateralis: 70,\n\n  // Right Brow (subject's RIGHT brow - appears on LEFT of image)\n  right_supercilium_medialis: 336,\n  right_supercilium_medial_corner: 285,\n  right_supercilium_superior: 282,\n  right_supercilium_apex: 334,\n  right_supercilium_lateralis: 276,\n\n  // Nose\n  nasal_base: 290, // Base of nose (per landmarkers.js)\n  left_dorsum_nasi: 174,\n  right_dorsum_nasi: 399,\n  left_ala_nasi: 48,\n  right_ala_nasi: 278,\n  subnasale: 2, // noseBottom in landmarkers.js\n  nasion: 6, // Added for correct FWHR calculation\n  glabella: 9, // Added for reference\n\n  // Mouth\n  labrale_superius: 267, // cupidsBow - peak of cupid's bow\n  cupids_bow: 0, // innerCupidsBow - center dip of upper lip\n  mouth_middle: 14,\n  labrale_inferius: 17,\n  left_cheilion: 61,\n  right_cheilion: 306,\n\n  // Jaw\n  left_gonion_superior: 58,\n  right_gonion_superior: 288,\n  left_gonion_inferior: 172,\n  right_gonion_inferior: 397,\n\n  // Chin\n  left_mentum_lateralis: 176,\n  right_mentum_lateralis: 400,\n  menton: 152,\n\n  // Cheeks\n  left_zygion: 234,\n  right_zygion: 454,\n  left_malar: 205,        // Cheek center point for fullness calculation\n  right_malar: 425,       // Cheek center point for fullness calculation\n  left_temporal: 54,\n  right_temporal: 284,\n\n  // Ears\n  left_auricular_lateral: 127,\n  right_auricular_lateral: 356,\n\n  // Neck (same as bottom gonion indices, but apply +5% yOffset when rendering)\n  // Per landmarkers.js: neckLeft: 172 with yOffset: 0.05, neckRight: 397 with yOffset: 0.05\n  left_cervical_lateralis: 172,\n  right_cervical_lateralis: 397,\n};\n\n// ============================================\n// DEPTH VARIANCE RESULT INTERFACE\n// ============================================\n\nexport interface DepthVarianceResult {\n  isValid: boolean;\n  confidence: number;\n  depthSpread: number;        // Horizontal distance from nose to ear (0-1 normalized)\n  nosalProjection: number;    // How much the nose projects forward\n  frankfortDeviation: number; // Degrees deviation from horizontal\n  issues: string[];           // List of validation issues\n}\n\n// Side profile landmark mapping (IDs must match SIDE_PROFILE_LANDMARKS in landmarks.ts)\n// Matches 28 side profile landmarks exactly\n// For side profile photos, uses MediaPipe LEFT indices (appearing on left side of image)\n// Note: Server uses a custom server-side model for side detection; this is our MediaPipe fallback\nexport const MEDIAPIPE_SIDE_MAPPING: Record<string, number> = {\n  // 1. vertex - top of head\n  vertex: 10,\n  // 2. occiput - back of head (no good MediaPipe equivalent, use top)\n  occiput: 10,\n  // 3. pronasale - nose tip\n  pronasale: 1,\n  // 4. neckPoint - lower neck (no good equivalent, use chin)\n  neckPoint: 152,\n  // 5. porion - ear canal opening (use ear area)\n  porion: 127,\n  // 6. orbitale - lowest point of orbital rim (index 33 per cephalometric landmarkers.js)\n  orbitale: 33,\n  // 7. tragus - ear cartilage\n  tragus: 127,\n  // 8. intertragicNotch - notch in ear\n  intertragicNotch: 127,\n  // 9. cornealApex - forward point of cornea\n  cornealApex: 468,\n  // 10. cheekbone - zygomatic prominence\n  cheekbone: 234,\n  // 11. trichion - hairline\n  trichion: 10,\n  // 12. glabella - between brows\n  glabella: 9,\n  // 13. nasion - nasal root depression\n  nasion: 6,\n  // 14. rhinion - dorsal nose point\n  rhinion: 4,\n  // 15. supratip - above nose tip\n  supratip: 4,\n  // 16. infratip - below nose tip\n  infratip: 2,\n  // 17. columella - nasal septum\n  columella: 2,\n  // 18. subnasale - nose base meets upper lip\n  subnasale: 2,\n  // 19. subalare - nostril wing\n  subalare: 129,\n  // 20. labraleSuperius - upper lip\n  labraleSuperius: 0,\n  // 21. cheilion - mouth corner\n  cheilion: 61,\n  // 22. labraleInferius - lower lip\n  labraleInferius: 17,\n  // 23. sublabiale - below lower lip\n  sublabiale: 18,\n  // 24. pogonion - chin point\n  pogonion: 152,\n  // 25. menton - chin bottom\n  menton: 152,\n  // 26. cervicalPoint - high neck point\n  cervicalPoint: 152,\n  // 27. gonionTop - upper jaw angle\n  gonionTop: 116,\n  // 28. gonionBottom - lower jaw angle\n  gonionBottom: 172,\n};\n\nexport interface DetectedLandmarks {\n  landmarks: Array<{ id: string; x: number; y: number }>;\n  confidence: number;\n  faceBox: { x: number; y: number; width: number; height: number };\n  frankfortPlane?: {\n    angle: number;\n    orbitale: { x: number; y: number };\n    porion: { x: number; y: number };\n  };\n  depthValidation?: DepthVarianceResult;\n}\n\n/**\n * Detect facial landmarks from an image URL\n *\n * Detection hierarchy:\n * - Front profile: MediaPipe Face Mesh (478 landmarks) - unchanged\n * - Side profile: Server-side InsightFace → Edge-based fallback → Manual placement\n */\nexport async function detectFromImageUrl(\n  imageUrl: string,\n  mode: 'front' | 'side'\n): Promise<DetectedLandmarks | null> {\n  try {\n    // ============================================\n    // SIDE PROFILE: Use server-side detection\n    // ============================================\n    if (mode === 'side') {\n      console.log('[Detection] Side profile mode - trying server-side detection...');\n\n      // Try server-side InsightFace first (best accuracy)\n      const serverResult = await detectSideProfileServer(imageUrl);\n      if (serverResult) {\n        console.log('[Detection] Server-side detection succeeded');\n\n        // Validate side profile depth variance\n        const depthValidation = validateSideProfileDepth(\n          serverResult.landmarks,\n          serverResult.frankfortPlane\n        );\n        console.log('[Detection] Depth validation:', {\n          isValid: depthValidation.isValid,\n          confidence: depthValidation.confidence.toFixed(2),\n          depthSpread: (depthValidation.depthSpread * 100).toFixed(1) + '%',\n          issues: depthValidation.issues,\n        });\n\n        return {\n          landmarks: serverResult.landmarks,\n          confidence: serverResult.confidence,\n          faceBox: serverResult.faceBox,\n          frankfortPlane: serverResult.frankfortPlane,\n          depthValidation,\n        };\n      }\n\n      console.log('[Detection] Server-side failed, trying edge-based detection...');\n\n      // Fallback to edge-based detection\n      const sideResult = await detectSideProfile(imageUrl);\n      if (sideResult) {\n        console.log('[Detection] Edge-based side profile detection succeeded');\n\n        // Validate side profile depth variance\n        const depthValidation = validateSideProfileDepth(sideResult.landmarks);\n        console.log('[Detection] Depth validation (edge-based):', {\n          isValid: depthValidation.isValid,\n          confidence: depthValidation.confidence.toFixed(2),\n          issues: depthValidation.issues,\n        });\n\n        return {\n          landmarks: sideResult.landmarks,\n          confidence: sideResult.confidence,\n          faceBox: {\n            x: 0,\n            y: 0,\n            width: 1,\n            height: 1,\n          },\n          depthValidation,\n        };\n      }\n\n      console.log('[Detection] All side profile detection methods failed - manual placement required');\n      return null;\n    }\n\n    // ============================================\n    // FRONT PROFILE: Use MediaPipe (UNCHANGED)\n    // ============================================\n    // Load the image\n    const img = await loadImage(imageUrl);\n\n    // Use the singleton service\n    const result = await faceDetectionService.detect(img);\n\n    // Check if MediaPipe detected a face\n    const mediaPipeSucceeded = result.faceLandmarks && result.faceLandmarks.length > 0;\n\n    if (!mediaPipeSucceeded) {\n      console.log('No faces detected');\n      return null;\n    }\n\n    const faceLandmarks = result.faceLandmarks[0];\n\n    // Front profile uses MediaPipe mapping\n    const mapping = MEDIAPIPE_FRONT_MAPPING;\n\n    // FaceIQ Parity: Exact landmark offsets from FaceIQ's landmarkers.js\n    // These offsets correct MediaPipe's raw positions to match cephalometric standards\n    const LANDMARK_OFFSETS: Record<string, { xOffset?: number; yOffset?: number }> = {\n      // Hairline offset: MediaPipe index 10 is forehead/glabella, not actual hairline\n      trichion: { yOffset: -0.06 },\n\n      // Pupil offsets: small adjustments for accurate pupil center\n      left_pupila: { xOffset: 0.0015, yOffset: -0.005 },\n      right_pupila: { xOffset: -0.0015, yOffset: -0.005 },\n\n      // Nose side offsets: widen nose detection slightly\n      left_ala_nasi: { xOffset: 0.0025 },\n      right_ala_nasi: { xOffset: -0.0025 },\n\n      // Temple offsets: move temples up slightly\n      left_temporal: { yOffset: -0.01 },\n      right_temporal: { yOffset: -0.01 },\n\n      // Outer ear offsets: push ears outward for accurate face width\n      left_auricular_lateral: { xOffset: -0.04 },\n      right_auricular_lateral: { xOffset: 0.04 },\n\n      // Neck offsets: move neck points down\n      left_cervical_lateralis: { yOffset: 0.05 },\n      right_cervical_lateralis: { yOffset: 0.05 },\n\n      // Upper eyelid crease offsets: move crease up slightly\n      left_pretarsal_skin_crease: { yOffset: -0.015 },\n      right_pretarsal_skin_crease: { yOffset: -0.015 },\n    };\n\n    // Map keypoints to our landmarks\n    const landmarks = Object.entries(mapping).map(([id, index]) => {\n      // Handle index bounds\n      const safeIndex = Math.min(index, faceLandmarks.length - 1);\n      const landmark = faceLandmarks[safeIndex];\n\n      // Apply offsets from FaceIQ parity table\n      const offsets = LANDMARK_OFFSETS[id] || {};\n      const xOffset = offsets.xOffset || 0;\n      const yOffset = offsets.yOffset || 0;\n\n      return {\n        id,\n        // MediaPipe returns normalized coordinates (0-1)\n        // Apply FaceIQ-matching offsets and clamp to valid range\n        x: landmark ? Math.max(0, Math.min(landmark.x + xOffset, 1)) : 0.5,\n        y: landmark ? Math.max(0, Math.min(landmark.y + yOffset, 1)) : 0.5,\n      };\n    });\n\n    // Calculate face bounding box from all landmarks\n    let minX = 1, minY = 1, maxX = 0, maxY = 0;\n    faceLandmarks.forEach((lm) => {\n      minX = Math.min(minX, lm.x);\n      minY = Math.min(minY, lm.y);\n      maxX = Math.max(maxX, lm.x);\n      maxY = Math.max(maxY, lm.y);\n    });\n\n    return {\n      landmarks,\n      confidence: 0.95, // MediaPipe doesn't return confidence per landmark\n      faceBox: {\n        x: minX,\n        y: minY,\n        width: maxX - minX,\n        height: maxY - minY,\n      },\n    };\n  } catch (error) {\n    console.error('Face detection error:', error);\n    return null;\n  }\n}\n\n/**\n * Load an image from URL\n */\nfunction loadImage(url: string): Promise<HTMLImageElement> {\n  return new Promise((resolve, reject) => {\n    const img = new Image();\n    img.crossOrigin = 'anonymous';\n    img.onload = () => resolve(img);\n    img.onerror = (e) => reject(e);\n    img.src = url;\n  });\n}\n\n// ============================================\n// SIDE PROFILE DEPTH VARIANCE VALIDATION\n// ============================================\n\n/**\n * Validate 3D depth variance from side profile landmarks\n *\n * Checks that the photo shows a true side profile by analyzing:\n * 1. Depth spread: Horizontal distance from nose tip to ear landmarks\n * 2. Nasal projection: How far the nose projects forward\n * 3. Frankfort plane: Should be relatively horizontal in proper side profiles\n *\n * @param landmarks Array of detected landmarks with x, y coordinates\n * @param frankfortPlane Optional Frankfort plane data\n * @returns Validation result with confidence score and issues\n */\nexport function validateSideProfileDepth(\n  landmarks: Array<{ id: string; x: number; y: number }>,\n  frankfortPlane?: { angle: number; orbitale: { x: number; y: number }; porion: { x: number; y: number } }\n): DepthVarianceResult {\n  const issues: string[] = [];\n  let confidence = 1.0;\n\n  // Get key landmarks for depth validation\n  const getLandmark = (id: string) => landmarks.find(l => l.id === id);\n\n  const pronasale = getLandmark('pronasale');     // Nose tip\n  const nasion = getLandmark('nasion');           // Nasal root\n  const porion = getLandmark('porion');           // Ear opening\n  const tragus = getLandmark('tragus');           // Ear cartilage\n  const orbitale = getLandmark('orbitale');       // Lowest orbital point\n  const pogonion = getLandmark('pogonion');       // Chin point\n  const subnasale = getLandmark('subnasale');     // Nose base\n\n  // Calculate depth spread (nose to ear horizontal distance)\n  let depthSpread = 0;\n  const earLandmark = porion || tragus;\n\n  if (pronasale && earLandmark) {\n    // In a true side profile, nose tip should be significantly forward of ear\n    depthSpread = Math.abs(pronasale.x - earLandmark.x);\n\n    // Minimum depth spread threshold (nose should be at least 15% face width from ear)\n    const MIN_DEPTH_SPREAD = 0.15;\n    if (depthSpread < MIN_DEPTH_SPREAD) {\n      issues.push(`Insufficient depth spread (${(depthSpread * 100).toFixed(1)}%): Photo may not be a true side profile`);\n      confidence -= 0.3;\n    }\n  } else {\n    issues.push('Missing key landmarks for depth calculation (pronasale or ear landmark)');\n    confidence -= 0.4;\n  }\n\n  // Calculate nasal projection\n  let nosalProjection = 0;\n  if (pronasale && subnasale) {\n    // Nasal projection: horizontal distance from nose base to tip\n    nosalProjection = Math.abs(pronasale.x - subnasale.x);\n\n    // Minimum nasal projection (nose tip should project at least 5% forward of base)\n    const MIN_NASAL_PROJECTION = 0.05;\n    if (nosalProjection < MIN_NASAL_PROJECTION) {\n      issues.push(`Low nasal projection (${(nosalProjection * 100).toFixed(1)}%): Profile angle may be too frontal`);\n      confidence -= 0.2;\n    }\n  }\n\n  // Check Frankfort plane deviation\n  let frankfortDeviation = 0;\n  if (frankfortPlane) {\n    frankfortDeviation = Math.abs(frankfortPlane.angle);\n\n    // Frankfort plane should be within ±10 degrees of horizontal in ideal photos\n    const MAX_FRANKFORT_DEVIATION = 15;\n    if (frankfortDeviation > MAX_FRANKFORT_DEVIATION) {\n      issues.push(`Head tilt detected (${frankfortDeviation.toFixed(1)}°): Consider re-taking photo with head level`);\n      confidence -= 0.15;\n    }\n  } else if (orbitale && (porion || tragus)) {\n    // Calculate from landmarks if not provided\n    const ear = porion || tragus;\n    if (ear && orbitale) {\n      const dx = ear.x - orbitale.x;\n      const dy = ear.y - orbitale.y;\n      frankfortDeviation = Math.abs(Math.atan2(dy, dx) * (180 / Math.PI));\n\n      const MAX_FRANKFORT_DEVIATION = 15;\n      if (frankfortDeviation > MAX_FRANKFORT_DEVIATION) {\n        issues.push(`Head tilt detected (${frankfortDeviation.toFixed(1)}°): Consider re-taking photo with head level`);\n        confidence -= 0.15;\n      }\n    }\n  }\n\n  // Additional validation: Check landmark horizontal ordering\n  // In a true side profile facing left, nose should be leftmost, ear rightmost\n  // In a true side profile facing right, the opposite\n  if (pronasale && earLandmark && nasion) {\n    const noseToEar = pronasale.x - earLandmark.x;\n    const nasionToEar = nasion.x - earLandmark.x;\n\n    // Both should have the same sign (nose and nasion on same side relative to ear)\n    if (noseToEar * nasionToEar < 0) {\n      issues.push('Inconsistent landmark positions: May indicate partial profile or rotation');\n      confidence -= 0.2;\n    }\n  }\n\n  // Check chin position relative to profile\n  if (pogonion && pronasale && earLandmark) {\n    const chinDepth = Math.abs(pogonion.x - earLandmark.x);\n    const noseDepth = Math.abs(pronasale.x - earLandmark.x);\n\n    // In a normal profile, chin should be closer to ear than nose tip\n    // A severely recessed chin might have issues, but this is a soft check\n    if (noseDepth > 0 && chinDepth / noseDepth < 0.3) {\n      issues.push('Unusual chin position: Very recessed or photo angle issue');\n      confidence -= 0.1;\n    }\n  }\n\n  // Clamp confidence between 0 and 1\n  confidence = Math.max(0, Math.min(1, confidence));\n\n  return {\n    isValid: confidence >= 0.5 && issues.length < 3,\n    confidence,\n    depthSpread,\n    nosalProjection,\n    frankfortDeviation,\n    issues,\n  };\n}\n\n/**\n * Get the region to zoom into for a specific landmark\n */\nexport function getLandmarkZoomRegion(\n  landmarkId: string\n): { centerX: number; centerY: number; zoomLevel: number } {\n  const regions: Record<string, { centerX: number; centerY: number; zoomLevel: number }> = {\n    // Eyes - zoom in close\n    left_pupila: { centerX: 0.35, centerY: 0.35, zoomLevel: 3 },\n    left_canthus_medialis: { centerX: 0.4, centerY: 0.35, zoomLevel: 3 },\n    left_canthus_lateralis: { centerX: 0.3, centerY: 0.35, zoomLevel: 3 },\n    right_pupila: { centerX: 0.65, centerY: 0.35, zoomLevel: 3 },\n    right_canthus_medialis: { centerX: 0.6, centerY: 0.35, zoomLevel: 3 },\n    right_canthus_lateralis: { centerX: 0.7, centerY: 0.35, zoomLevel: 3 },\n\n    // Brows\n    left_supercilium_apex: { centerX: 0.35, centerY: 0.28, zoomLevel: 2.5 },\n    right_supercilium_apex: { centerX: 0.65, centerY: 0.28, zoomLevel: 2.5 },\n\n    // Nose\n    nasal_base: { centerX: 0.5, centerY: 0.4, zoomLevel: 2 },\n    subnasale: { centerX: 0.5, centerY: 0.55, zoomLevel: 2.5 },\n\n    // Mouth\n    labrale_superius: { centerX: 0.5, centerY: 0.6, zoomLevel: 2.5 },\n    mouth_middle: { centerX: 0.5, centerY: 0.65, zoomLevel: 2 },\n\n    // Chin\n    menton: { centerX: 0.5, centerY: 0.85, zoomLevel: 2 },\n\n    // Default for other landmarks\n    default: { centerX: 0.5, centerY: 0.5, zoomLevel: 1.5 },\n  };\n\n  return regions[landmarkId] || regions.default;\n}\n","numLines":550,"startLine":1,"totalLines":550}}}
{"parentUuid":"f349d159-df94-4943-bb0c-a6a5652022b5","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01UHtgZRutvmf8bgNyie1VcS","type":"tool_result","content":"     1→/**\n     2→ * Mapping of landmark IDs to reference image names\n     3→ * Images are stored locally in /public/landmarks/front/ and /public/landmarks/side/\n     4→ *\n     5→ * Two image types available per landmark:\n     6→ * - male_white_*.webp: Photo reference showing landmark on a face\n     7→ * - infographic_*.webp: Diagram/infographic showing landmark placement\n     8→ */\n     9→\n    10→export interface LandmarkImageConfig {\n    11→  imageName: string;\n    12→  fallbackDescription: string;\n    13→}\n    14→\n    15→// Front profile landmark images (52 landmarks)\n    16→export const FRONT_LANDMARK_IMAGES: Record<string, LandmarkImageConfig> = {\n    17→  // Head\n    18→  trichion: {\n    19→    imageName: 'hairline',\n    20→    fallbackDescription: 'Place at the center of your hairline where it meets your forehead',\n    21→  },\n    22→\n    23→  // Eyes - Left\n    24→  left_pupila: {\n    25→    imageName: 'leftEyePupil',\n    26→    fallbackDescription: 'Place at the exact center of your left pupil',\n    27→  },\n    28→  left_canthus_medialis: {\n    29→    imageName: 'leftEyeMedialCanthus',\n    30→    fallbackDescription: 'Place at the inner corner where your left eyelids meet',\n    31→  },\n    32→  left_canthus_lateralis: {\n    33→    imageName: 'leftEyeLateralCanthus',\n    34→    fallbackDescription: 'Place at the outer corner where your left eyelids meet',\n    35→  },\n    36→  left_palpebra_superior: {\n    37→    imageName: 'leftEyeUpperEyelid',\n    38→    fallbackDescription: 'Place at the center of your left upper eyelid margin',\n    39→  },\n    40→  left_palpebra_inferior: {\n    41→    imageName: 'leftEyeLowerEyelid',\n    42→    fallbackDescription: 'Place at the center of your left lower eyelid margin',\n    43→  },\n    44→  left_sulcus_palpebralis_lateralis: {\n    45→    imageName: 'leftEyelidHoodEnd',\n    46→    fallbackDescription: 'Place where your left upper eyelid crease ends laterally',\n    47→  },\n    48→  left_pretarsal_skin_crease: {\n    49→    imageName: 'leftUpperEyelidCrease',\n    50→    fallbackDescription: 'Place at the center of your left upper eyelid crease',\n    51→  },\n    52→\n    53→  // Eyes - Right\n    54→  right_pupila: {\n    55→    imageName: 'rightEyePupil',\n    56→    fallbackDescription: 'Place at the exact center of your right pupil',\n    57→  },\n    58→  right_canthus_medialis: {\n    59→    imageName: 'rightEyeMedialCanthus',\n    60→    fallbackDescription: 'Place at the inner corner where your right eyelids meet',\n    61→  },\n    62→  right_canthus_lateralis: {\n    63→    imageName: 'rightEyeLateralCanthus',\n    64→    fallbackDescription: 'Place at the outer corner where your right eyelids meet',\n    65→  },\n    66→  right_palpebra_superior: {\n    67→    imageName: 'rightEyeUpperEyelid',\n    68→    fallbackDescription: 'Place at the center of your right upper eyelid margin',\n    69→  },\n    70→  right_palpebra_inferior: {\n    71→    imageName: 'rightEyeLowerEyelid',\n    72→    fallbackDescription: 'Place at the center of your right lower eyelid margin',\n    73→  },\n    74→  right_sulcus_palpebralis_lateralis: {\n    75→    imageName: 'rightEyelidHoodEnd',\n    76→    fallbackDescription: 'Place where your right upper eyelid crease ends laterally',\n    77→  },\n    78→  right_pretarsal_skin_crease: {\n    79→    imageName: 'rightUpperEyelidCrease',\n    80→    fallbackDescription: 'Place at the center of your right upper eyelid crease',\n    81→  },\n    82→\n    83→  // Eyebrows - Left\n    84→  left_supercilium_medialis: {\n    85→    imageName: 'leftBrowHead',\n    86→    fallbackDescription: 'Place at the innermost point where your left eyebrow starts',\n    87→  },\n    88→  left_supercilium_medial_corner: {\n    89→    imageName: 'leftBrowInnerCorner',\n    90→    fallbackDescription: 'Place at the inner corner of your left eyebrow',\n    91→  },\n    92→  left_supercilium_superior: {\n    93→    imageName: 'leftBrowArch',\n    94→    fallbackDescription: 'Place at the highest point of your left eyebrow arch',\n    95→  },\n    96→  left_supercilium_apex: {\n    97→    imageName: 'leftBrowPeak',\n    98→    fallbackDescription: 'Place at the peak of your left eyebrow curve',\n    99→  },\n   100→  left_supercilium_lateralis: {\n   101→    imageName: 'leftBrowTail',\n   102→    fallbackDescription: 'Place at the outer end of your left eyebrow',\n   103→  },\n   104→\n   105→  // Eyebrows - Right\n   106→  right_supercilium_medialis: {\n   107→    imageName: 'rightBrowHead',\n   108→    fallbackDescription: 'Place at the innermost point where your right eyebrow starts',\n   109→  },\n   110→  right_supercilium_medial_corner: {\n   111→    imageName: 'rightBrowInnerCorner',\n   112→    fallbackDescription: 'Place at the inner corner of your right eyebrow',\n   113→  },\n   114→  right_supercilium_superior: {\n   115→    imageName: 'rightBrowArch',\n   116→    fallbackDescription: 'Place at the highest point of your right eyebrow arch',\n   117→  },\n   118→  right_supercilium_apex: {\n   119→    imageName: 'rightBrowPeak',\n   120→    fallbackDescription: 'Place at the peak of your right eyebrow curve',\n   121→  },\n   122→  right_supercilium_lateralis: {\n   123→    imageName: 'rightBrowTail',\n   124→    fallbackDescription: 'Place at the outer end of your right eyebrow',\n   125→  },\n   126→\n   127→  // Nose\n   128→  nasal_base: {\n   129→    imageName: 'nasalBase',\n   130→    fallbackDescription: 'Place at the bridge of your nose between your eyes',\n   131→  },\n   132→  left_dorsum_nasi: {\n   133→    imageName: 'leftNoseBridge',\n   134→    fallbackDescription: 'Place on the left side of your nose bridge',\n   135→  },\n   136→  right_dorsum_nasi: {\n   137→    imageName: 'rightNoseBridge',\n   138→    fallbackDescription: 'Place on the right side of your nose bridge',\n   139→  },\n   140→  left_ala_nasi: {\n   141→    imageName: 'noseLeft',\n   142→    fallbackDescription: 'Place at the widest point of your left nostril',\n   143→  },\n   144→  right_ala_nasi: {\n   145→    imageName: 'noseRight',\n   146→    fallbackDescription: 'Place at the widest point of your right nostril',\n   147→  },\n   148→  subnasale: {\n   149→    imageName: 'noseBottom',\n   150→    fallbackDescription: 'Place at the base of your nose where it meets your upper lip',\n   151→  },\n   152→\n   153→  // Mouth\n   154→  labrale_superius: {\n   155→    imageName: 'cupidsBow',\n   156→    fallbackDescription: 'Place at the center peak of your upper lip',\n   157→  },\n   158→  cupids_bow: {\n   159→    imageName: 'innerCupidsBow',\n   160→    fallbackDescription: 'Place at the inner center of your Cupid\\'s bow',\n   161→  },\n   162→  mouth_middle: {\n   163→    imageName: 'mouthMiddle',\n   164→    fallbackDescription: 'Place at the center of your mouth opening',\n   165→  },\n   166→  labrale_inferius: {\n   167→    imageName: 'lowerLip',\n   168→    fallbackDescription: 'Place at the center of your lower lip border',\n   169→  },\n   170→  left_cheilion: {\n   171→    imageName: 'mouthLeft',\n   172→    fallbackDescription: 'Place at the left corner of your mouth',\n   173→  },\n   174→  right_cheilion: {\n   175→    imageName: 'mouthRight',\n   176→    fallbackDescription: 'Place at the right corner of your mouth',\n   177→  },\n   178→\n   179→  // Jaw\n   180→  left_gonion_superior: {\n   181→    imageName: 'leftTopGonion',\n   182→    fallbackDescription: 'Place at the upper angle of your left jaw',\n   183→  },\n   184→  right_gonion_superior: {\n   185→    imageName: 'rightTopGonion',\n   186→    fallbackDescription: 'Place at the upper angle of your right jaw',\n   187→  },\n   188→  left_gonion_inferior: {\n   189→    imageName: 'leftBottomGonion',\n   190→    fallbackDescription: 'Place at the lower angle of your left jaw',\n   191→  },\n   192→  right_gonion_inferior: {\n   193→    imageName: 'rightBottomGonion',\n   194→    fallbackDescription: 'Place at the lower angle of your right jaw',\n   195→  },\n   196→\n   197→  // Chin\n   198→  left_mentum_lateralis: {\n   199→    imageName: 'chinLeft',\n   200→    fallbackDescription: 'Place on the left side of your chin',\n   201→  },\n   202→  right_mentum_lateralis: {\n   203→    imageName: 'chinRight',\n   204→    fallbackDescription: 'Place on the right side of your chin',\n   205→  },\n   206→  menton: {\n   207→    imageName: 'chinBottom',\n   208→    fallbackDescription: 'Place at the lowest point of your chin',\n   209→  },\n   210→\n   211→  // Face Width\n   212→  left_zygion: {\n   213→    imageName: 'leftCheek',\n   214→    fallbackDescription: 'Place at the widest point of your left cheekbone',\n   215→  },\n   216→  right_zygion: {\n   217→    imageName: 'rightCheek',\n   218→    fallbackDescription: 'Place at the widest point of your right cheekbone',\n   219→  },\n   220→  left_temporal: {\n   221→    imageName: 'leftTemple',\n   222→    fallbackDescription: 'Place at your left temple',\n   223→  },\n   224→  right_temporal: {\n   225→    imageName: 'rightTemple',\n   226→    fallbackDescription: 'Place at your right temple',\n   227→  },\n   228→  left_auricular_lateral: {\n   229→    imageName: 'leftOuterEar',\n   230→    fallbackDescription: 'Place at the outermost point of your left ear',\n   231→  },\n   232→  right_auricular_lateral: {\n   233→    imageName: 'rightOuterEar',\n   234→    fallbackDescription: 'Place at the outermost point of your right ear',\n   235→  },\n   236→\n   237→  // Neck\n   238→  left_cervical_lateralis: {\n   239→    imageName: 'neckLeft',\n   240→    fallbackDescription: 'Place on the left side of your neck',\n   241→  },\n   242→  right_cervical_lateralis: {\n   243→    imageName: 'neckRight',\n   244→    fallbackDescription: 'Place on the right side of your neck',\n   245→  },\n   246→};\n   247→\n   248→// Side profile landmark images (28 landmarks)\n   249→// Matches LOOKSMAXX exact naming - IDs must match SIDE_PROFILE_LANDMARKS in landmarks.ts\n   250→export const SIDE_LANDMARK_IMAGES: Record<string, LandmarkImageConfig> = {\n   251→  // 1. vertex\n   252→  vertex: {\n   253→    imageName: 'vertex',\n   254→    fallbackDescription: 'Mark the highest point of the head\\'s curve',\n   255→  },\n   256→  // 2. occiput\n   257→  occiput: {\n   258→    imageName: 'occiput',\n   259→    fallbackDescription: 'Mark the most prominent point on the back of the head\\'s curve',\n   260→  },\n   261→  // 3. pronasale\n   262→  pronasale: {\n   263→    imageName: 'pronasale',\n   264→    fallbackDescription: 'Mark the farthest projecting point of the nose tip',\n   265→  },\n   266→  // 4. neckPoint\n   267→  neckPoint: {\n   268→    imageName: 'neckPoint',\n   269→    fallbackDescription: 'Follow the neck contour down to the Adam\\'s apple area',\n   270→  },\n   271→  // 5. porion\n   272→  porion: {\n   273→    imageName: 'porion',\n   274→    fallbackDescription: 'Mark the uppermost point of the ear canal opening, above the tragus',\n   275→  },\n   276→  // 6. orbitale\n   277→  orbitale: {\n   278→    imageName: 'orbitale',\n   279→    fallbackDescription: 'Trace the undereye contour and mark the most prominent part of the orbital rim',\n   280→  },\n   281→  // 7. tragus\n   282→  tragus: {\n   283→    imageName: 'tragus',\n   284→    fallbackDescription: 'Mark the back part of the small flap in front of the ear canal',\n   285→  },\n   286→  // 8. intertragicNotch\n   287→  intertragicNotch: {\n   288→    imageName: 'intertragicNotch',\n   289→    fallbackDescription: 'Locate the small groove between the tragus and antitragus',\n   290→  },\n   291→  // 9. cornealApex\n   292→  cornealApex: {\n   293→    imageName: 'cornealApex',\n   294→    fallbackDescription: 'Mark the most prominent and forward point of the eye',\n   295→  },\n   296→  // 10. cheekbone\n   297→  cheekbone: {\n   298→    imageName: 'cheekbone',\n   299→    fallbackDescription: 'From the side, mark the bump of the cheekbone below/behind the eye',\n   300→  },\n   301→  // 11. trichion\n   302→  trichion: {\n   303→    imageName: 'trichion',\n   304→    fallbackDescription: 'Mark the highest point of the hairline, where the forehead ends',\n   305→  },\n   306→  // 12. glabella\n   307→  glabella: {\n   308→    imageName: 'glabella',\n   309→    fallbackDescription: 'Locate the most prominent point of the brow ridge between the eyebrows',\n   310→  },\n   311→  // 13. nasion\n   312→  nasion: {\n   313→    imageName: 'nasion',\n   314→    fallbackDescription: 'Mark the small dip between the brow ridge and nose bridge, around eye level',\n   315→  },\n   316→  // 14. rhinion\n   317→  rhinion: {\n   318→    imageName: 'rhinion',\n   319→    fallbackDescription: 'Mark the dorsal point of the nose, the most prominent point of the nose bridge',\n   320→  },\n   321→  // 15. supratip\n   322→  supratip: {\n   323→    imageName: 'supratip',\n   324→    fallbackDescription: 'Follow the bridge toward the tip and mark the highest point right before the nose tip',\n   325→  },\n   326→  // 16. infratip\n   327→  infratip: {\n   328→    imageName: 'infratip',\n   329→    fallbackDescription: 'Follow the nose contour down from the tip and mark the lowest point before the nostrils',\n   330→  },\n   331→  // 17. columella\n   332→  columella: {\n   333→    imageName: 'columella',\n   334→    fallbackDescription: 'Mark the part of the nose that connects the nostrils, to the left of the infratip',\n   335→  },\n   336→  // 18. subnasale\n   337→  subnasale: {\n   338→    imageName: 'subnasale',\n   339→    fallbackDescription: 'Mark the crease point at the base of the nose, where the nose creates an angle with the upper lip',\n   340→  },\n   341→  // 19. subalare\n   342→  subalare: {\n   343→    imageName: 'subalare',\n   344→    fallbackDescription: 'Mark the most prominent edge of the nose wing, near the cheek closest to the eyes',\n   345→  },\n   346→  // 20. labraleSuperius\n   347→  labraleSuperius: {\n   348→    imageName: 'labraleSuperius',\n   349→    fallbackDescription: 'Find the most prominent point of the upper lip, typically the highest point of the lip\\'s natural curve',\n   350→  },\n   351→  // 21. cheilion\n   352→  cheilion: {\n   353→    imageName: 'cheilion',\n   354→    fallbackDescription: 'Mark the rearmost lip corner where the upper and lower lips touch in profile',\n   355→  },\n   356→  // 22. labraleInferius\n   357→  labraleInferius: {\n   358→    imageName: 'labraleInferius',\n   359→    fallbackDescription: 'Find the most prominent point of the lower lip, typically the lowest point of the lip\\'s natural curve',\n   360→  },\n   361→  // 23. sublabiale\n   362→  sublabiale: {\n   363→    imageName: 'sublabiale',\n   364→    fallbackDescription: 'From profile, mark the deepest spot between the lower lip and chin',\n   365→  },\n   366→  // 24. pogonion\n   367→  pogonion: {\n   368→    imageName: 'pogonion',\n   369→    fallbackDescription: 'Mark the most prominent and forward point of the chin',\n   370→  },\n   371→  // 25. menton\n   372→  menton: {\n   373→    imageName: 'menton',\n   374→    fallbackDescription: 'Trace the chin contour downward and mark its lowest point',\n   375→  },\n   376→  // 26. cervicalPoint\n   377→  cervicalPoint: {\n   378→    imageName: 'cervicalPoint',\n   379→    fallbackDescription: 'Mark the most indented point where the underside of the jaw turns into the neck',\n   380→  },\n   381→  // 27. gonionTop\n   382→  gonionTop: {\n   383→    imageName: 'gonionTop',\n   384→    fallbackDescription: 'Locate the upper part of the jaw angle where the ramus forms an angle with the mandible',\n   385→  },\n   386→  // 28. gonionBottom\n   387→  gonionBottom: {\n   388→    imageName: 'gonionBottom',\n   389→    fallbackDescription: 'Locate the lower part of the jaw angle, where the jaw begins to curve towards the chin',\n   390→  },\n   391→};\n   392→\n   393→/**\n   394→ * Get the local image path for a landmark\n   395→ * @param landmarkId - The landmark ID\n   396→ * @param mode - 'front' or 'side' profile\n   397→ * @param type - 'photo' for face reference, 'infographic' for diagram\n   398→ * @returns Image path or null if not found\n   399→ */\n   400→export function getLandmarkImagePath(\n   401→  landmarkId: string,\n   402→  mode: 'front' | 'side',\n   403→  type: 'photo' | 'infographic' = 'photo'\n   404→): string | null {\n   405→  const mapping = mode === 'front' ? FRONT_LANDMARK_IMAGES : SIDE_LANDMARK_IMAGES;\n   406→  const config = mapping[landmarkId];\n   407→\n   408→  if (!config) {\n   409→    return null;\n   410→  }\n   411→\n   412→  const prefix = type === 'photo' ? 'male_white_' : 'infographic_';\n   413→  return `/landmarks/${mode}/${prefix}${config.imageName}.webp`;\n   414→}\n   415→\n   416→/**\n   417→ * Get fallback description for a landmark\n   418→ */\n   419→export function getLandmarkPlacementGuide(landmarkId: string, mode: 'front' | 'side'): string {\n   420→  const mapping = mode === 'front' ? FRONT_LANDMARK_IMAGES : SIDE_LANDMARK_IMAGES;\n   421→  const config = mapping[landmarkId];\n   422→  return config?.fallbackDescription || 'Place this landmark at the indicated position';\n   423→}\n   424→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"3468c530-ff56-4e46-b698-ae439d524ae4","timestamp":"2025-12-27T03:19:49.394Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarkImages.ts","content":"/**\n * Mapping of landmark IDs to reference image names\n * Images are stored locally in /public/landmarks/front/ and /public/landmarks/side/\n *\n * Two image types available per landmark:\n * - male_white_*.webp: Photo reference showing landmark on a face\n * - infographic_*.webp: Diagram/infographic showing landmark placement\n */\n\nexport interface LandmarkImageConfig {\n  imageName: string;\n  fallbackDescription: string;\n}\n\n// Front profile landmark images (52 landmarks)\nexport const FRONT_LANDMARK_IMAGES: Record<string, LandmarkImageConfig> = {\n  // Head\n  trichion: {\n    imageName: 'hairline',\n    fallbackDescription: 'Place at the center of your hairline where it meets your forehead',\n  },\n\n  // Eyes - Left\n  left_pupila: {\n    imageName: 'leftEyePupil',\n    fallbackDescription: 'Place at the exact center of your left pupil',\n  },\n  left_canthus_medialis: {\n    imageName: 'leftEyeMedialCanthus',\n    fallbackDescription: 'Place at the inner corner where your left eyelids meet',\n  },\n  left_canthus_lateralis: {\n    imageName: 'leftEyeLateralCanthus',\n    fallbackDescription: 'Place at the outer corner where your left eyelids meet',\n  },\n  left_palpebra_superior: {\n    imageName: 'leftEyeUpperEyelid',\n    fallbackDescription: 'Place at the center of your left upper eyelid margin',\n  },\n  left_palpebra_inferior: {\n    imageName: 'leftEyeLowerEyelid',\n    fallbackDescription: 'Place at the center of your left lower eyelid margin',\n  },\n  left_sulcus_palpebralis_lateralis: {\n    imageName: 'leftEyelidHoodEnd',\n    fallbackDescription: 'Place where your left upper eyelid crease ends laterally',\n  },\n  left_pretarsal_skin_crease: {\n    imageName: 'leftUpperEyelidCrease',\n    fallbackDescription: 'Place at the center of your left upper eyelid crease',\n  },\n\n  // Eyes - Right\n  right_pupila: {\n    imageName: 'rightEyePupil',\n    fallbackDescription: 'Place at the exact center of your right pupil',\n  },\n  right_canthus_medialis: {\n    imageName: 'rightEyeMedialCanthus',\n    fallbackDescription: 'Place at the inner corner where your right eyelids meet',\n  },\n  right_canthus_lateralis: {\n    imageName: 'rightEyeLateralCanthus',\n    fallbackDescription: 'Place at the outer corner where your right eyelids meet',\n  },\n  right_palpebra_superior: {\n    imageName: 'rightEyeUpperEyelid',\n    fallbackDescription: 'Place at the center of your right upper eyelid margin',\n  },\n  right_palpebra_inferior: {\n    imageName: 'rightEyeLowerEyelid',\n    fallbackDescription: 'Place at the center of your right lower eyelid margin',\n  },\n  right_sulcus_palpebralis_lateralis: {\n    imageName: 'rightEyelidHoodEnd',\n    fallbackDescription: 'Place where your right upper eyelid crease ends laterally',\n  },\n  right_pretarsal_skin_crease: {\n    imageName: 'rightUpperEyelidCrease',\n    fallbackDescription: 'Place at the center of your right upper eyelid crease',\n  },\n\n  // Eyebrows - Left\n  left_supercilium_medialis: {\n    imageName: 'leftBrowHead',\n    fallbackDescription: 'Place at the innermost point where your left eyebrow starts',\n  },\n  left_supercilium_medial_corner: {\n    imageName: 'leftBrowInnerCorner',\n    fallbackDescription: 'Place at the inner corner of your left eyebrow',\n  },\n  left_supercilium_superior: {\n    imageName: 'leftBrowArch',\n    fallbackDescription: 'Place at the highest point of your left eyebrow arch',\n  },\n  left_supercilium_apex: {\n    imageName: 'leftBrowPeak',\n    fallbackDescription: 'Place at the peak of your left eyebrow curve',\n  },\n  left_supercilium_lateralis: {\n    imageName: 'leftBrowTail',\n    fallbackDescription: 'Place at the outer end of your left eyebrow',\n  },\n\n  // Eyebrows - Right\n  right_supercilium_medialis: {\n    imageName: 'rightBrowHead',\n    fallbackDescription: 'Place at the innermost point where your right eyebrow starts',\n  },\n  right_supercilium_medial_corner: {\n    imageName: 'rightBrowInnerCorner',\n    fallbackDescription: 'Place at the inner corner of your right eyebrow',\n  },\n  right_supercilium_superior: {\n    imageName: 'rightBrowArch',\n    fallbackDescription: 'Place at the highest point of your right eyebrow arch',\n  },\n  right_supercilium_apex: {\n    imageName: 'rightBrowPeak',\n    fallbackDescription: 'Place at the peak of your right eyebrow curve',\n  },\n  right_supercilium_lateralis: {\n    imageName: 'rightBrowTail',\n    fallbackDescription: 'Place at the outer end of your right eyebrow',\n  },\n\n  // Nose\n  nasal_base: {\n    imageName: 'nasalBase',\n    fallbackDescription: 'Place at the bridge of your nose between your eyes',\n  },\n  left_dorsum_nasi: {\n    imageName: 'leftNoseBridge',\n    fallbackDescription: 'Place on the left side of your nose bridge',\n  },\n  right_dorsum_nasi: {\n    imageName: 'rightNoseBridge',\n    fallbackDescription: 'Place on the right side of your nose bridge',\n  },\n  left_ala_nasi: {\n    imageName: 'noseLeft',\n    fallbackDescription: 'Place at the widest point of your left nostril',\n  },\n  right_ala_nasi: {\n    imageName: 'noseRight',\n    fallbackDescription: 'Place at the widest point of your right nostril',\n  },\n  subnasale: {\n    imageName: 'noseBottom',\n    fallbackDescription: 'Place at the base of your nose where it meets your upper lip',\n  },\n\n  // Mouth\n  labrale_superius: {\n    imageName: 'cupidsBow',\n    fallbackDescription: 'Place at the center peak of your upper lip',\n  },\n  cupids_bow: {\n    imageName: 'innerCupidsBow',\n    fallbackDescription: 'Place at the inner center of your Cupid\\'s bow',\n  },\n  mouth_middle: {\n    imageName: 'mouthMiddle',\n    fallbackDescription: 'Place at the center of your mouth opening',\n  },\n  labrale_inferius: {\n    imageName: 'lowerLip',\n    fallbackDescription: 'Place at the center of your lower lip border',\n  },\n  left_cheilion: {\n    imageName: 'mouthLeft',\n    fallbackDescription: 'Place at the left corner of your mouth',\n  },\n  right_cheilion: {\n    imageName: 'mouthRight',\n    fallbackDescription: 'Place at the right corner of your mouth',\n  },\n\n  // Jaw\n  left_gonion_superior: {\n    imageName: 'leftTopGonion',\n    fallbackDescription: 'Place at the upper angle of your left jaw',\n  },\n  right_gonion_superior: {\n    imageName: 'rightTopGonion',\n    fallbackDescription: 'Place at the upper angle of your right jaw',\n  },\n  left_gonion_inferior: {\n    imageName: 'leftBottomGonion',\n    fallbackDescription: 'Place at the lower angle of your left jaw',\n  },\n  right_gonion_inferior: {\n    imageName: 'rightBottomGonion',\n    fallbackDescription: 'Place at the lower angle of your right jaw',\n  },\n\n  // Chin\n  left_mentum_lateralis: {\n    imageName: 'chinLeft',\n    fallbackDescription: 'Place on the left side of your chin',\n  },\n  right_mentum_lateralis: {\n    imageName: 'chinRight',\n    fallbackDescription: 'Place on the right side of your chin',\n  },\n  menton: {\n    imageName: 'chinBottom',\n    fallbackDescription: 'Place at the lowest point of your chin',\n  },\n\n  // Face Width\n  left_zygion: {\n    imageName: 'leftCheek',\n    fallbackDescription: 'Place at the widest point of your left cheekbone',\n  },\n  right_zygion: {\n    imageName: 'rightCheek',\n    fallbackDescription: 'Place at the widest point of your right cheekbone',\n  },\n  left_temporal: {\n    imageName: 'leftTemple',\n    fallbackDescription: 'Place at your left temple',\n  },\n  right_temporal: {\n    imageName: 'rightTemple',\n    fallbackDescription: 'Place at your right temple',\n  },\n  left_auricular_lateral: {\n    imageName: 'leftOuterEar',\n    fallbackDescription: 'Place at the outermost point of your left ear',\n  },\n  right_auricular_lateral: {\n    imageName: 'rightOuterEar',\n    fallbackDescription: 'Place at the outermost point of your right ear',\n  },\n\n  // Neck\n  left_cervical_lateralis: {\n    imageName: 'neckLeft',\n    fallbackDescription: 'Place on the left side of your neck',\n  },\n  right_cervical_lateralis: {\n    imageName: 'neckRight',\n    fallbackDescription: 'Place on the right side of your neck',\n  },\n};\n\n// Side profile landmark images (28 landmarks)\n// Matches LOOKSMAXX exact naming - IDs must match SIDE_PROFILE_LANDMARKS in landmarks.ts\nexport const SIDE_LANDMARK_IMAGES: Record<string, LandmarkImageConfig> = {\n  // 1. vertex\n  vertex: {\n    imageName: 'vertex',\n    fallbackDescription: 'Mark the highest point of the head\\'s curve',\n  },\n  // 2. occiput\n  occiput: {\n    imageName: 'occiput',\n    fallbackDescription: 'Mark the most prominent point on the back of the head\\'s curve',\n  },\n  // 3. pronasale\n  pronasale: {\n    imageName: 'pronasale',\n    fallbackDescription: 'Mark the farthest projecting point of the nose tip',\n  },\n  // 4. neckPoint\n  neckPoint: {\n    imageName: 'neckPoint',\n    fallbackDescription: 'Follow the neck contour down to the Adam\\'s apple area',\n  },\n  // 5. porion\n  porion: {\n    imageName: 'porion',\n    fallbackDescription: 'Mark the uppermost point of the ear canal opening, above the tragus',\n  },\n  // 6. orbitale\n  orbitale: {\n    imageName: 'orbitale',\n    fallbackDescription: 'Trace the undereye contour and mark the most prominent part of the orbital rim',\n  },\n  // 7. tragus\n  tragus: {\n    imageName: 'tragus',\n    fallbackDescription: 'Mark the back part of the small flap in front of the ear canal',\n  },\n  // 8. intertragicNotch\n  intertragicNotch: {\n    imageName: 'intertragicNotch',\n    fallbackDescription: 'Locate the small groove between the tragus and antitragus',\n  },\n  // 9. cornealApex\n  cornealApex: {\n    imageName: 'cornealApex',\n    fallbackDescription: 'Mark the most prominent and forward point of the eye',\n  },\n  // 10. cheekbone\n  cheekbone: {\n    imageName: 'cheekbone',\n    fallbackDescription: 'From the side, mark the bump of the cheekbone below/behind the eye',\n  },\n  // 11. trichion\n  trichion: {\n    imageName: 'trichion',\n    fallbackDescription: 'Mark the highest point of the hairline, where the forehead ends',\n  },\n  // 12. glabella\n  glabella: {\n    imageName: 'glabella',\n    fallbackDescription: 'Locate the most prominent point of the brow ridge between the eyebrows',\n  },\n  // 13. nasion\n  nasion: {\n    imageName: 'nasion',\n    fallbackDescription: 'Mark the small dip between the brow ridge and nose bridge, around eye level',\n  },\n  // 14. rhinion\n  rhinion: {\n    imageName: 'rhinion',\n    fallbackDescription: 'Mark the dorsal point of the nose, the most prominent point of the nose bridge',\n  },\n  // 15. supratip\n  supratip: {\n    imageName: 'supratip',\n    fallbackDescription: 'Follow the bridge toward the tip and mark the highest point right before the nose tip',\n  },\n  // 16. infratip\n  infratip: {\n    imageName: 'infratip',\n    fallbackDescription: 'Follow the nose contour down from the tip and mark the lowest point before the nostrils',\n  },\n  // 17. columella\n  columella: {\n    imageName: 'columella',\n    fallbackDescription: 'Mark the part of the nose that connects the nostrils, to the left of the infratip',\n  },\n  // 18. subnasale\n  subnasale: {\n    imageName: 'subnasale',\n    fallbackDescription: 'Mark the crease point at the base of the nose, where the nose creates an angle with the upper lip',\n  },\n  // 19. subalare\n  subalare: {\n    imageName: 'subalare',\n    fallbackDescription: 'Mark the most prominent edge of the nose wing, near the cheek closest to the eyes',\n  },\n  // 20. labraleSuperius\n  labraleSuperius: {\n    imageName: 'labraleSuperius',\n    fallbackDescription: 'Find the most prominent point of the upper lip, typically the highest point of the lip\\'s natural curve',\n  },\n  // 21. cheilion\n  cheilion: {\n    imageName: 'cheilion',\n    fallbackDescription: 'Mark the rearmost lip corner where the upper and lower lips touch in profile',\n  },\n  // 22. labraleInferius\n  labraleInferius: {\n    imageName: 'labraleInferius',\n    fallbackDescription: 'Find the most prominent point of the lower lip, typically the lowest point of the lip\\'s natural curve',\n  },\n  // 23. sublabiale\n  sublabiale: {\n    imageName: 'sublabiale',\n    fallbackDescription: 'From profile, mark the deepest spot between the lower lip and chin',\n  },\n  // 24. pogonion\n  pogonion: {\n    imageName: 'pogonion',\n    fallbackDescription: 'Mark the most prominent and forward point of the chin',\n  },\n  // 25. menton\n  menton: {\n    imageName: 'menton',\n    fallbackDescription: 'Trace the chin contour downward and mark its lowest point',\n  },\n  // 26. cervicalPoint\n  cervicalPoint: {\n    imageName: 'cervicalPoint',\n    fallbackDescription: 'Mark the most indented point where the underside of the jaw turns into the neck',\n  },\n  // 27. gonionTop\n  gonionTop: {\n    imageName: 'gonionTop',\n    fallbackDescription: 'Locate the upper part of the jaw angle where the ramus forms an angle with the mandible',\n  },\n  // 28. gonionBottom\n  gonionBottom: {\n    imageName: 'gonionBottom',\n    fallbackDescription: 'Locate the lower part of the jaw angle, where the jaw begins to curve towards the chin',\n  },\n};\n\n/**\n * Get the local image path for a landmark\n * @param landmarkId - The landmark ID\n * @param mode - 'front' or 'side' profile\n * @param type - 'photo' for face reference, 'infographic' for diagram\n * @returns Image path or null if not found\n */\nexport function getLandmarkImagePath(\n  landmarkId: string,\n  mode: 'front' | 'side',\n  type: 'photo' | 'infographic' = 'photo'\n): string | null {\n  const mapping = mode === 'front' ? FRONT_LANDMARK_IMAGES : SIDE_LANDMARK_IMAGES;\n  const config = mapping[landmarkId];\n\n  if (!config) {\n    return null;\n  }\n\n  const prefix = type === 'photo' ? 'male_white_' : 'infographic_';\n  return `/landmarks/${mode}/${prefix}${config.imageName}.webp`;\n}\n\n/**\n * Get fallback description for a landmark\n */\nexport function getLandmarkPlacementGuide(landmarkId: string, mode: 'front' | 'side'): string {\n  const mapping = mode === 'front' ? FRONT_LANDMARK_IMAGES : SIDE_LANDMARK_IMAGES;\n  const config = mapping[landmarkId];\n  return config?.fallbackDescription || 'Place this landmark at the indicated position';\n}\n","numLines":424,"startLine":1,"totalLines":424}}}
{"parentUuid":"3468c530-ff56-4e46-b698-ae439d524ae4","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VeKXPKiQuWAXRJgTGo4Vdm","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useState, useRef, useCallback, useEffect } from 'react';\n     4→import Image from 'next/image';\n     5→import { motion } from 'framer-motion';\n     6→import {\n     7→  ChevronLeft,\n     8→  ChevronRight,\n     9→  ChevronUp,\n    10→  ChevronDown,\n    11→  Check,\n    12→  Info,\n    13→  Scan,\n    14→  Loader2,\n    15→  Move,\n    16→  Focus,\n    17→  AlertTriangle,\n    18→  X,\n    19→} from 'lucide-react';\n    20→import {\n    21→  LandmarkPoint,\n    22→  FRONT_PROFILE_LANDMARKS,\n    23→  SIDE_PROFILE_LANDMARKS,\n    24→  getLandmarkColor,\n    25→  FRONT_LANDMARK_CATEGORIES,\n    26→  SIDE_LANDMARK_CATEGORIES,\n    27→} from '@/lib/landmarks';\n    28→import { getLandmarkImagePath, getLandmarkPlacementGuide } from '@/lib/landmarkImages';\n    29→import { detectFromImageUrl } from '@/lib/mediapipeDetection';\n    30→\n    31→interface LandmarkAnalysisToolProps {\n    32→  imageUrl: string;\n    33→  mode: 'front' | 'side';\n    34→  initialLandmarks?: LandmarkPoint[];\n    35→  onLandmarksChange?: (landmarks: LandmarkPoint[]) => void;\n    36→  onComplete?: (landmarks: LandmarkPoint[]) => void;\n    37→  onBack?: () => void;\n    38→}\n    39→\n    40→function getOrderedLandmarks(mode: 'front' | 'side'): string[] {\n    41→  const landmarks = mode === 'front' ? FRONT_PROFILE_LANDMARKS : SIDE_PROFILE_LANDMARKS;\n    42→  return landmarks.map(lm => lm.id);\n    43→}\n    44→\n    45→export function LandmarkAnalysisTool({\n    46→  imageUrl,\n    47→  mode,\n    48→  initialLandmarks,\n    49→  onLandmarksChange,\n    50→  onComplete,\n    51→  onBack,\n    52→}: LandmarkAnalysisToolProps) {\n    53→  const containerRef = useRef<HTMLDivElement>(null);\n    54→  const [imageDimensions, setImageDimensions] = useState<{ width: number; height: number } | null>(null);\n    55→  const [containerSize, setContainerSize] = useState<{ width: number; height: number } | null>(null);\n    56→  const defaultLandmarks = mode === 'front' ? FRONT_PROFILE_LANDMARKS : SIDE_PROFILE_LANDMARKS;\n    57→  const categories = mode === 'front' ? FRONT_LANDMARK_CATEGORIES : SIDE_LANDMARK_CATEGORIES;\n    58→  const orderedIds = getOrderedLandmarks(mode);\n    59→\n    60→  const [landmarks, setLandmarks] = useState<LandmarkPoint[]>(\n    61→    initialLandmarks || defaultLandmarks\n    62→  );\n    63→  const [currentStepIndex, setCurrentStepIndex] = useState(0);\n    64→  const [zoomLevel, setZoomLevel] = useState(2); // FaceIQ parity: 2x/4x/8x discrete levels\n    65→\n    66→  // Reset state when mode changes (fixes side profile starting at step 52)\n    67→  useEffect(() => {\n    68→    const newLandmarks = mode === 'front' ? FRONT_PROFILE_LANDMARKS : SIDE_PROFILE_LANDMARKS;\n    69→    setCurrentStepIndex(0);\n    70→    setPlacedLandmarks(new Set());\n    71→    setHasAutoDetected(false);\n    72→    setDetectionFailed(false);\n    73→    setLandmarks(newLandmarks);\n    74→    setPan({ x: 0, y: 0 });\n    75→    setZoomLevel(2); // FaceIQ parity: start at 2x\n    76→  }, [mode]);\n    77→  const [pan, setPan] = useState({ x: 0, y: 0 });\n    78→  const [isDragging, setIsDragging] = useState(false);\n    79→  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\n    80→  const [pressedKeys, setPressedKeys] = useState<Set<string>>(new Set());\n    81→  const [activeTab, setActiveTab] = useState<'info' | 'reference'>('info');\n    82→  const [isDetecting, setIsDetecting] = useState(true);\n    83→  const [hasAutoDetected, setHasAutoDetected] = useState(false);\n    84→  const [autoZoomEnabled, setAutoZoomEnabled] = useState(true);\n    85→  const [detectionFailed, setDetectionFailed] = useState(false);\n    86→  const [placedLandmarks, setPlacedLandmarks] = useState<Set<string>>(new Set());\n    87→  // Frankfort Plane for side profile visualization (from server detection)\n    88→  const [frankfortPlane, setFrankfortPlane] = useState<{\n    89→    angle: number;\n    90→    orbitale: { x: number; y: number };\n    91→    porion: { x: number; y: number };\n    92→  } | null>(null);\n    93→\n    94→  const currentLandmarkId = orderedIds[currentStepIndex];\n    95→  const currentLandmark = landmarks.find((lm) => lm.id === currentLandmarkId);\n    96→  const totalSteps = orderedIds.length;\n    97→  const progress = ((currentStepIndex + 1) / totalSteps) * 100;\n    98→\n    99→  const color = currentLandmark\n   100→    ? getLandmarkColor(currentLandmark.id, categories)\n   101→    : '#00f3ff';\n   102→\n   103→  // Load image dimensions on mount\n   104→  useEffect(() => {\n   105→    const img = new window.Image();\n   106→    img.onload = () => {\n   107→      setImageDimensions({ width: img.naturalWidth, height: img.naturalHeight });\n   108→    };\n   109→    img.src = imageUrl;\n   110→  }, [imageUrl]);\n   111→\n   112→  // Track container size changes with ResizeObserver\n   113→  useEffect(() => {\n   114→    if (!containerRef.current) return;\n   115→\n   116→    const observer = new ResizeObserver((entries) => {\n   117→      const { width, height } = entries[0].contentRect;\n   118→      setContainerSize({ width, height });\n   119→    });\n   120→\n   121→    observer.observe(containerRef.current);\n   122→    return () => observer.disconnect();\n   123→  }, []);\n   124→\n   125→  // Calculate the rendered image bounds within the container (accounting for object-contain)\n   126→  const getImageBounds = useCallback(() => {\n   127→    if (!containerRef.current || !imageDimensions || !containerSize) {\n   128→      return { offsetX: 0, offsetY: 0, renderedWidth: 1, renderedHeight: 1, containerWidth: 1, containerHeight: 1 };\n   129→    }\n   130→\n   131→    const containerWidth = containerSize.width;\n   132→    const containerHeight = containerSize.height;\n   133→    const imageAspect = imageDimensions.width / imageDimensions.height;\n   134→    const containerAspect = containerWidth / containerHeight;\n   135→\n   136→    let renderedWidth: number;\n   137→    let renderedHeight: number;\n   138→    let offsetX = 0;\n   139→    let offsetY = 0;\n   140→\n   141→    if (imageAspect > containerAspect) {\n   142→      renderedWidth = containerWidth;\n   143→      renderedHeight = containerWidth / imageAspect;\n   144→      offsetY = (containerHeight - renderedHeight) / 2;\n   145→    } else {\n   146→      renderedHeight = containerHeight;\n   147→      renderedWidth = containerHeight * imageAspect;\n   148→      offsetX = (containerWidth - renderedWidth) / 2;\n   149→    }\n   150→\n   151→    return { offsetX, offsetY, renderedWidth, renderedHeight, containerWidth, containerHeight };\n   152→  }, [imageDimensions, containerSize]);\n   153→\n   154→  // Get what normalized coordinates the center orb points to on the image\n   155→  const getCrosshairNormalizedPosition = useCallback(() => {\n   156→    const bounds = getImageBounds();\n   157→    if (!bounds.renderedWidth || !bounds.renderedHeight) {\n   158→      return { x: 0.5, y: 0.5 };\n   159→    }\n   160→\n   161→    // The container center (where the orb is) in screen coordinates\n   162→    const containerCenterX = bounds.containerWidth / 2;\n   163→    const containerCenterY = bounds.containerHeight / 2;\n   164→\n   165→    // The transform is: translate(pan.x, pan.y) scale(zoomLevel)\n   166→    // To find what image point is at container center, we reverse this:\n   167→    // 1. The point at container center after transform comes from:\n   168→    //    screenPos = imagePos * zoomLevel + pan\n   169→    // 2. Solving for imagePos:\n   170→    //    imagePos = (screenPos - pan) / zoomLevel\n   171→    const imageX = (containerCenterX - pan.x) / zoomLevel;\n   172→    const imageY = (containerCenterY - pan.y) / zoomLevel;\n   173→\n   174→    // Convert to normalized (0-1) coordinates within the image\n   175→    const normalizedX = (imageX - bounds.offsetX) / bounds.renderedWidth;\n   176→    const normalizedY = (imageY - bounds.offsetY) / bounds.renderedHeight;\n   177→\n   178→    return {\n   179→      x: Math.max(0, Math.min(1, normalizedX)),\n   180→      y: Math.max(0, Math.min(1, normalizedY)),\n   181→    };\n   182→  }, [getImageBounds, pan, zoomLevel]);\n   183→\n   184→  // Convert normalized image coordinates (0-1) to pixel position within the container\n   185→  // Note: This is used for landmarks INSIDE the transformed container, so no zoom/pan needed\n   186→  const getLandmarkPixelPosition = useCallback((x: number, y: number) => {\n   187→    const bounds = getImageBounds();\n   188→    // Position relative to container (the parent transform handles zoom/pan)\n   189→    const pixelX = bounds.offsetX + x * bounds.renderedWidth;\n   190→    const pixelY = bounds.offsetY + y * bounds.renderedHeight;\n   191→    return { left: pixelX, top: pixelY };\n   192→  }, [getImageBounds]);\n   193→\n   194→  useEffect(() => {\n   195→    onLandmarksChange?.(landmarks);\n   196→  }, [landmarks, onLandmarksChange]);\n   197→\n   198→  // Confirm placement: set current landmark to where crosshair points\n   199→  const confirmPlacement = useCallback(() => {\n   200→    const pos = getCrosshairNormalizedPosition();\n   201→    setLandmarks((prev) =>\n   202→      prev.map((lm) =>\n   203→        lm.id === currentLandmarkId ? { ...lm, x: pos.x, y: pos.y } : lm\n   204→      )\n   205→    );\n   206→    setPlacedLandmarks((prev) => new Set(prev).add(currentLandmarkId));\n   207→  }, [currentLandmarkId, getCrosshairNormalizedPosition]);\n   208→\n   209→  // Handle click - confirms placement at crosshair position\n   210→  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n   211→  const handleContainerClick = useCallback(() => {\n   212→    if (isDragging) return;\n   213→    confirmPlacement();\n   214→  }, [isDragging, confirmPlacement]);\n   215→\n   216→  // Mouse down - start dragging to pan\n   217→  const handleMouseDown = useCallback(\n   218→    (e: React.MouseEvent) => {\n   219→      if (e.button === 0) {\n   220→        setIsDragging(true);\n   221→        setDragStart({ x: e.clientX - pan.x, y: e.clientY - pan.y });\n   222→      }\n   223→    },\n   224→    [pan]\n   225→  );\n   226→\n   227→  // Mouse move - pan the image\n   228→  const handleMouseMove = useCallback(\n   229→    (e: React.MouseEvent) => {\n   230→      if (isDragging) {\n   231→        setPan({\n   232→          x: e.clientX - dragStart.x,\n   233→          y: e.clientY - dragStart.y,\n   234→        });\n   235→      }\n   236→    },\n   237→    [isDragging, dragStart]\n   238→  );\n   239→\n   240→  const handleMouseUp = useCallback(() => {\n   241→    setIsDragging(false);\n   242→  }, []);\n   243→\n   244→  const handleResetZoom = useCallback(() => {\n   245→    setZoomLevel(2); // FaceIQ parity: reset to 2x\n   246→    setPan({ x: 0, y: 0 });\n   247→  }, []);\n   248→\n   249→  // Pan the image using arrow keys (moves the crosshair target point on the image)\n   250→  const panImage = useCallback((direction: 'up' | 'down' | 'left' | 'right') => {\n   251→    const step = 20; // pixels to pan per keypress\n   252→    setPan((prev) => {\n   253→      switch (direction) {\n   254→        case 'up': return { ...prev, y: prev.y + step };\n   255→        case 'down': return { ...prev, y: prev.y - step };\n   256→        case 'left': return { ...prev, x: prev.x + step };\n   257→        case 'right': return { ...prev, x: prev.x - step };\n   258→        default: return prev;\n   259→      }\n   260→    });\n   261→  }, []);\n   262→\n   263→  const handleNext = useCallback(() => {\n   264→    // Confirm placement at current crosshair position before moving to next\n   265→    confirmPlacement();\n   266→\n   267→    if (currentStepIndex < totalSteps - 1) {\n   268→      setCurrentStepIndex((prev) => prev + 1);\n   269→      // Don't reset zoom - let zoomToLandmark handle it\n   270→    } else {\n   271→      onComplete?.(landmarks);\n   272→    }\n   273→  }, [currentStepIndex, totalSteps, landmarks, onComplete, confirmPlacement]);\n   274→\n   275→  const handlePrevious = useCallback(() => {\n   276→    if (currentStepIndex > 0) {\n   277→      setCurrentStepIndex((prev) => prev - 1);\n   278→      handleResetZoom();\n   279→    } else {\n   280→      onBack?.();\n   281→    }\n   282→  }, [currentStepIndex, handleResetZoom, onBack]);\n   283→\n   284→  // FaceIQ parity: Landmark-specific zoom levels for optimal precision\n   285→  // Fine detail landmarks (pupils, eyelids) get higher zoom, larger areas get lower zoom\n   286→  const LANDMARK_ZOOM_LEVELS: Record<string, number> = {\n   287→    // 2x zoom - larger landmarks\n   288→    trichion: 2,\n   289→    left_temporal: 2, right_temporal: 2,\n   290→    left_auricular_lateral: 2, right_auricular_lateral: 2,\n   291→\n   292→    // 4x zoom - medium detail landmarks\n   293→    left_pupila: 4, right_pupila: 4,\n   294→    left_canthus_medialis: 4, left_canthus_lateralis: 4,\n   295→    right_canthus_medialis: 4, right_canthus_lateralis: 4,\n   296→    left_sulcus_palpebralis_lateralis: 4, right_sulcus_palpebralis_lateralis: 4,\n   297→    left_supercilium_medialis: 4, left_supercilium_medial_corner: 4,\n   298→    left_supercilium_superior: 4, left_supercilium_apex: 4, left_supercilium_lateralis: 4,\n   299→    right_supercilium_medialis: 4, right_supercilium_medial_corner: 4,\n   300→    right_supercilium_superior: 4, right_supercilium_apex: 4, right_supercilium_lateralis: 4,\n   301→    left_ala_nasi: 4, right_ala_nasi: 4,\n   302→    nasal_base: 4, subnasale: 4,\n   303→    left_dorsum_nasi: 4, right_dorsum_nasi: 4,\n   304→    labrale_superius: 4, cupids_bow: 4, mouth_middle: 4,\n   305→    labrale_inferius: 4, left_cheilion: 4, right_cheilion: 4,\n   306→    left_gonion_superior: 4, left_gonion_inferior: 4,\n   307→    right_gonion_superior: 4, right_gonion_inferior: 4,\n   308→    left_mentum_lateralis: 4, right_mentum_lateralis: 4, menton: 4,\n   309→    left_zygion: 2, right_zygion: 2,\n   310→    left_cervical_lateralis: 4, right_cervical_lateralis: 4,\n   311→\n   312→    // 8x zoom - fine detail landmarks (eyelids)\n   313→    left_palpebra_superior: 8, left_palpebra_inferior: 8,\n   314→    right_palpebra_superior: 8, right_palpebra_inferior: 8,\n   315→    left_pretarsal_skin_crease: 8, right_pretarsal_skin_crease: 8,\n   316→\n   317→    // ========== SIDE PROFILE LANDMARKS (FaceIQ parity) ==========\n   318→    // 2x zoom - larger side landmarks\n   319→    vertex: 2,\n   320→    occiput: 2,\n   321→    neckPoint: 2,\n   322→    forehead: 2,\n   323→\n   324→    // 4x zoom - medium detail side landmarks\n   325→    porion: 4,\n   326→    orbitale: 4,\n   327→    tragus: 4,\n   328→    intertragicNotch: 4,\n   329→    cornealApex: 4,\n   330→    cheekbone: 4,\n   331→    glabella: 4,\n   332→    nasion: 4,\n   333→    pronasale: 4,\n   334→    rhinion: 4,\n   335→    supratip: 4,\n   336→    infratip: 4,\n   337→    columella: 4,\n   338→    subalare: 4,\n   339→    labraleSuperius: 4,\n   340→    cheilion: 4,\n   341→    labraleInferius: 4,\n   342→    sublabiale: 4,\n   343→    pogonion: 4,\n   344→    cervicalPoint: 4,\n   345→    gonionTop: 4,\n   346→    gonionBottom: 4,\n   347→  };\n   348→\n   349→  // Auto-zoom to the current landmark's region - centers the landmark under the fixed orb\n   350→  const zoomToLandmark = useCallback((landmarkId: string) => {\n   351→    if (!autoZoomEnabled || !containerRef.current || !containerSize || !imageDimensions) return;\n   352→\n   353→    const landmark = landmarks.find(lm => lm.id === landmarkId);\n   354→    if (!landmark) return;\n   355→\n   356→    const bounds = getImageBounds();\n   357→    if (bounds.renderedWidth <= 1 || bounds.renderedHeight <= 1) return; // Bounds not ready\n   358→\n   359→    // FaceIQ parity: Use landmark-specific zoom level, default to 2x\n   360→    const newZoom = LANDMARK_ZOOM_LEVELS[landmarkId] || 2;\n   361→    setZoomLevel(newZoom);\n   362→\n   363→    // Calculate pan so the landmark appears at container center (under the fixed orb)\n   364→    const containerCenterX = bounds.containerWidth / 2;\n   365→    const containerCenterY = bounds.containerHeight / 2;\n   366→\n   367→    // Where the landmark is in unzoomed image space\n   368→    const landmarkX = bounds.offsetX + landmark.x * bounds.renderedWidth;\n   369→    const landmarkY = bounds.offsetY + landmark.y * bounds.renderedHeight;\n   370→\n   371→    // Pan needed: after zoom, landmark should be at container center\n   372→    // Transform is: translate(pan) scale(zoom) with origin at 0,0\n   373→    // A point at landmarkPos ends up at: landmarkPos * zoom + pan\n   374→    // We want it at containerCenter, so: pan = containerCenter - landmarkPos * zoom\n   375→    setPan({\n   376→      x: containerCenterX - landmarkX * newZoom,\n   377→      y: containerCenterY - landmarkY * newZoom,\n   378→    });\n   379→  }, [autoZoomEnabled, landmarks, getImageBounds, containerSize, imageDimensions]);\n   380→\n   381→  // Auto-detect landmarks using Human.js/MediaPipe\n   382→  const handleAutoDetect = useCallback(async () => {\n   383→    setIsDetecting(true);\n   384→    setDetectionFailed(false);\n   385→    setFrankfortPlane(null);\n   386→    try {\n   387→      const result = await detectFromImageUrl(imageUrl, mode);\n   388→      console.log('[DEBUG] Detection result:', result);\n   389→      console.log('[DEBUG] Sample landmarks:', result?.landmarks.slice(0, 5));\n   390→      if (result && result.landmarks.length > 0) {\n   391→        // Update landmarks with detected positions\n   392→        setLandmarks(prev =>\n   393→          prev.map(lm => {\n   394→            const detected = result.landmarks.find(d => d.id === lm.id);\n   395→            if (detected) {\n   396→              return { ...lm, x: detected.x, y: detected.y };\n   397→            }\n   398→            return lm;\n   399→          })\n   400→        );\n   401→        setHasAutoDetected(true);\n   402→        setDetectionFailed(false);\n   403→\n   404→        // Capture Frankfort Plane for side profile (from server-side detection)\n   405→        if (mode === 'side' && result.frankfortPlane) {\n   406→          console.log('[DEBUG] Frankfort Plane:', result.frankfortPlane);\n   407→          setFrankfortPlane(result.frankfortPlane);\n   408→        }\n   409→\n   410→        // Zoom to first landmark after detection\n   411→        zoomToLandmark(orderedIds[0]);\n   412→      } else {\n   413→        // Detection returned no results - common for side profile\n   414→        console.log('[DEBUG] No landmarks detected - manual placement required');\n   415→        setDetectionFailed(true);\n   416→        setHasAutoDetected(false);\n   417→      }\n   418→    } catch (error) {\n   419→      console.error('Auto-detection failed:', error);\n   420→      setDetectionFailed(true);\n   421→    } finally {\n   422→      setIsDetecting(false);\n   423→    }\n   424→  }, [imageUrl, mode, orderedIds, zoomToLandmark]);\n   425→\n   426→  // Auto-detect after image dimensions are loaded (prevents race condition)\n   427→  useEffect(() => {\n   428→    if (imageDimensions) {\n   429→      handleAutoDetect();\n   430→    }\n   431→    // eslint-disable-next-line react-hooks/exhaustive-deps\n   432→  }, [imageDimensions]); // Run after dimensions are loaded\n   433→\n   434→  // Auto-zoom when step changes or container size becomes available\n   435→  useEffect(() => {\n   436→    if (hasAutoDetected && autoZoomEnabled && currentLandmarkId && containerSize) {\n   437→      zoomToLandmark(currentLandmarkId);\n   438→    }\n   439→  }, [currentStepIndex, currentLandmarkId, hasAutoDetected, autoZoomEnabled, zoomToLandmark, containerSize]);\n   440→\n   441→  // Keyboard handlers with proper state tracking\n   442→  useEffect(() => {\n   443→    const handleKeyDown = (e: KeyboardEvent) => {\n   444→      if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Enter', 'Backspace', 'r', 'R'].includes(e.key)) {\n   445→        e.preventDefault();\n   446→      }\n   447→\n   448→      setPressedKeys((prev) => new Set(prev).add(e.key));\n   449→\n   450→      switch (e.key) {\n   451→        case 'ArrowUp': panImage('up'); break;\n   452→        case 'ArrowDown': panImage('down'); break;\n   453→        case 'ArrowLeft': panImage('left'); break;\n   454→        case 'ArrowRight': panImage('right'); break;\n   455→        case 'Enter': handleNext(); break;\n   456→        case 'Backspace': handlePrevious(); break;\n   457→        case 'r':\n   458→        case 'R': handleResetZoom(); break;\n   459→      }\n   460→    };\n   461→\n   462→    const handleKeyUp = (e: KeyboardEvent) => {\n   463→      setPressedKeys((prev) => {\n   464→        const next = new Set(prev);\n   465→        next.delete(e.key);\n   466→        return next;\n   467→      });\n   468→    };\n   469→\n   470→    window.addEventListener('keydown', handleKeyDown);\n   471→    window.addEventListener('keyup', handleKeyUp);\n   472→    return () => {\n   473→      window.removeEventListener('keydown', handleKeyDown);\n   474→      window.removeEventListener('keyup', handleKeyUp);\n   475→    };\n   476→  }, [panImage, handleNext, handlePrevious, handleResetZoom]);\n   477→\n   478→  const isKeyPressed = (key: string) => pressedKeys.has(key);\n   479→\n   480→  return (\n   481→    <div className=\"fixed inset-0 bg-black\">\n   482→      <div className=\"flex flex-col md:flex-row h-full gap-3 p-3 md:p-4\">\n   483→        {/* Sidebar - Right on desktop */}\n   484→        <div className=\"w-full md:w-80 flex-shrink-0 flex flex-col gap-3 md:order-2 overflow-hidden md:overflow-y-auto\">\n   485→          {/* Progress Card */}\n   486→          <div className=\"bg-neutral-900 rounded-xl border border-neutral-800 overflow-hidden flex-shrink-0\">\n   487→            <div className=\"p-4\">\n   488→              <div className=\"flex items-center justify-between text-xs text-neutral-400 mb-2\">\n   489→                <span>Step {currentStepIndex + 1} of {totalSteps}</span>\n   490→                <span>{Math.round(progress)}%</span>\n   491→              </div>\n   492→              <div className=\"h-1.5 bg-neutral-800 rounded-full overflow-hidden mb-3\">\n   493→                <motion.div\n   494→                  className=\"h-full rounded-full\"\n   495→                  style={{ width: `${progress}%`, backgroundColor: '#00f3ff' }}\n   496→                  transition={{ duration: 0.3 }}\n   497→                />\n   498→              </div>\n   499→              <div className=\"flex items-center gap-2\">\n   500→                <div className=\"w-6 h-6 bg-[#00f3ff] rounded-full flex items-center justify-center flex-shrink-0\">\n   501→                  <Check className=\"w-3.5 h-3.5 text-black\" />\n   502→                </div>\n   503→                <span className=\"text-sm font-medium text-white\">\n   504→                  {currentStepIndex} placed\n   505→                </span>\n   506→              </div>\n   507→            </div>\n   508→\n   509→            {/* View Tabs */}\n   510→            <div className=\"flex border-t border-neutral-800\">\n   511→              <button\n   512→                onClick={() => setActiveTab('info')}\n   513→                className={`flex-1 py-2.5 text-xs font-medium transition-colors ${\n   514→                  activeTab === 'info'\n   515→                    ? 'text-[#00f3ff] border-b-2 border-[#00f3ff]'\n   516→                    : 'text-neutral-500 hover:text-neutral-300'\n   517→                }`}\n   518→              >\n   519→                Current Point\n   520→              </button>\n   521→              <button\n   522→                onClick={() => setActiveTab('reference')}\n   523→                className={`flex-1 py-2.5 text-xs font-medium transition-colors ${\n   524→                  activeTab === 'reference'\n   525→                    ? 'text-[#00f3ff] border-b-2 border-[#00f3ff]'\n   526→                    : 'text-neutral-500 hover:text-neutral-300'\n   527→                }`}\n   528→              >\n   529→                Reference\n   530→              </button>\n   531→            </div>\n   532→\n   533→            {/* Info/Reference Content */}\n   534→            <div className=\"bg-neutral-900/50\">\n   535→              {activeTab === 'info' ? (\n   536→                <div>\n   537→                  {/* Photo Reference Image */}\n   538→                  {currentLandmark && getLandmarkImagePath(currentLandmark.id, mode, 'photo') ? (\n   539→                    <div className=\"relative w-full aspect-square bg-neutral-800\">\n   540→                      <Image\n   541→                        src={getLandmarkImagePath(currentLandmark.id, mode, 'photo')!}\n   542→                        alt={currentLandmark.label}\n   543→                        fill\n   544→                        className=\"object-contain\"\n   545→                        unoptimized\n   546→                      />\n   547→                    </div>\n   548→                  ) : (\n   549→                    <div className=\"w-full aspect-square bg-neutral-800 flex items-center justify-center\">\n   550→                      <div\n   551→                        className=\"w-14 h-14 rounded-full flex items-center justify-center\"\n   552→                        style={{ backgroundColor: `${color}20`, border: `2px solid ${color}` }}\n   553→                      >\n   554→                        <div className=\"w-4 h-4 rounded-full\" style={{ backgroundColor: color }} />\n   555→                      </div>\n   556→                    </div>\n   557→                  )}\n   558→                  <div className=\"p-3 text-center border-t border-neutral-800\">\n   559→                    <p className=\"text-sm font-semibold text-white\">{currentLandmark?.label}</p>\n   560→                    <p className=\"text-xs text-[#00f3ff] mt-0.5 font-mono\">{currentLandmark?.medicalTerm}</p>\n   561→                  </div>\n   562→                </div>\n   563→              ) : (\n   564→                <div>\n   565→                  {/* Infographic Reference Image */}\n   566→                  {currentLandmark && getLandmarkImagePath(currentLandmark.id, mode, 'infographic') ? (\n   567→                    <div className=\"relative w-full aspect-square bg-neutral-800\">\n   568→                      <Image\n   569→                        src={getLandmarkImagePath(currentLandmark.id, mode, 'infographic')!}\n   570→                        alt={`${currentLandmark.label} infographic`}\n   571→                        fill\n   572→                        className=\"object-contain\"\n   573→                        unoptimized\n   574→                      />\n   575→                    </div>\n   576→                  ) : (\n   577→                    <div className=\"w-full aspect-square bg-neutral-800 flex items-center justify-center\">\n   578→                      <Info className=\"w-12 h-12 text-neutral-600\" />\n   579→                    </div>\n   580→                  )}\n   581→                  <div className=\"p-3 text-center border-t border-neutral-800\">\n   582→                    <p className=\"text-sm text-neutral-300\">\n   583→                      {currentLandmark ? getLandmarkPlacementGuide(currentLandmark.id, mode) : ''}\n   584→                    </p>\n   585→                  </div>\n   586→                </div>\n   587→              )}\n   588→            </div>\n   589→          </div>\n   590→\n   591→          {/* Keyboard Shortcuts - Desktop only */}\n   592→          <div className=\"hidden md:flex flex-col gap-3\">\n   593→            <div className=\"bg-neutral-900 rounded-xl border border-neutral-800 p-4\">\n   594→              <p className=\"text-xs text-neutral-500 font-medium uppercase tracking-wide mb-3 text-center\">\n   595→                Keyboard Controls\n   596→              </p>\n   597→              <div className=\"flex justify-center mb-4\">\n   598→                <div className=\"flex flex-col gap-1 items-center\">\n   599→                  {/* Arrow Up */}\n   600→                  <div\n   601→                    className={`w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-100 ${\n   602→                      isKeyPressed('ArrowUp')\n   603→                        ? 'bg-[#00f3ff] text-black shadow-[0_0_15px_rgba(0,243,255,0.5)]'\n   604→                        : 'bg-neutral-800 text-neutral-400 border border-neutral-700'\n   605→                    }`}\n   606→                  >\n   607→                    <ChevronUp className=\"w-5 h-5\" />\n   608→                  </div>\n   609→                  {/* Arrow Row */}\n   610→                  <div className=\"flex gap-1\">\n   611→                    {[\n   612→                      { key: 'ArrowLeft', icon: ChevronLeft },\n   613→                      { key: 'ArrowDown', icon: ChevronDown },\n   614→                      { key: 'ArrowRight', icon: ChevronRight },\n   615→                    ].map(({ key, icon: Icon }) => (\n   616→                      <div\n   617→                        key={key}\n   618→                        className={`w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-100 ${\n   619→                          isKeyPressed(key)\n   620→                            ? 'bg-[#00f3ff] text-black shadow-[0_0_15px_rgba(0,243,255,0.5)]'\n   621→                            : 'bg-neutral-800 text-neutral-400 border border-neutral-700'\n   622→                        }`}\n   623→                      >\n   624→                        <Icon className=\"w-5 h-5\" />\n   625→                      </div>\n   626→                    ))}\n   627→                  </div>\n   628→                </div>\n   629→              </div>\n   630→\n   631→              <div className=\"space-y-2 text-sm\">\n   632→                <div className=\"flex items-center justify-between\">\n   633→                  <span\n   634→                    className={`px-2 py-1 rounded font-mono text-xs transition-all duration-100 ${\n   635→                      isKeyPressed('Enter')\n   636→                        ? 'bg-[#00f3ff] text-black'\n   637→                        : 'bg-neutral-800 text-neutral-400'\n   638→                    }`}\n   639→                  >\n   640→                    Enter\n   641→                  </span>\n   642→                  <span className=\"text-neutral-500\">Next point</span>\n   643→                </div>\n   644→                <div className=\"flex items-center justify-between\">\n   645→                  <span\n   646→                    className={`px-2 py-1 rounded font-mono text-xs transition-all duration-100 ${\n   647→                      isKeyPressed('Backspace')\n   648→                        ? 'bg-[#00f3ff] text-black'\n   649→                        : 'bg-neutral-800 text-neutral-400'\n   650→                    }`}\n   651→                  >\n   652→                    Backspace\n   653→                  </span>\n   654→                  <span className=\"text-neutral-500\">Previous</span>\n   655→                </div>\n   656→                <div className=\"flex items-center justify-between\">\n   657→                  <span\n   658→                    className={`px-2 py-1 rounded font-mono text-xs transition-all duration-100 ${\n   659→                      isKeyPressed('r') || isKeyPressed('R')\n   660→                        ? 'bg-[#00f3ff] text-black'\n   661→                        : 'bg-neutral-800 text-neutral-400'\n   662→                    }`}\n   663→                  >\n   664→                    R\n   665→                  </span>\n   666→                  <span className=\"text-neutral-500\">Reset zoom</span>\n   667→                </div>\n   668→              </div>\n   669→            </div>\n   670→\n   671→            {/* Zoom Controls */}\n   672→            <div className=\"bg-neutral-900 rounded-xl border border-neutral-800 p-4\">\n   673→              <p className=\"text-xs text-neutral-500 font-medium uppercase tracking-wide mb-3\">\n   674→                Zoom Level\n   675→              </p>\n   676→              <div className=\"flex gap-2\">\n   677→                {/* FaceIQ parity: 2x/4x/8x discrete zoom levels */}\n   678→                {[2, 4, 8].map((level) => (\n   679→                  <button\n   680→                    key={level}\n   681→                    onClick={() => {\n   682→                      if (containerSize) {\n   683→                        // Adjust pan to keep the same center point visible when zoom changes\n   684→                        // Current center in image space: imageCenter = (containerCenter - pan) / oldZoom\n   685→                        // New pan to show same center: newPan = containerCenter - imageCenter * newZoom\n   686→                        const containerCenterX = containerSize.width / 2;\n   687→                        const containerCenterY = containerSize.height / 2;\n   688→                        const imageCenterX = (containerCenterX - pan.x) / zoomLevel;\n   689→                        const imageCenterY = (containerCenterY - pan.y) / zoomLevel;\n   690→                        const newPanX = containerCenterX - imageCenterX * level;\n   691→                        const newPanY = containerCenterY - imageCenterY * level;\n   692→                        setZoomLevel(level);\n   693→                        setPan({ x: newPanX, y: newPanY });\n   694→                      } else {\n   695→                        setZoomLevel(level);\n   696→                      }\n   697→                    }}\n   698→                    className={`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${\n   699→                      zoomLevel === level\n   700→                        ? 'bg-[#00f3ff] text-black'\n   701→                        : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n   702→                    }`}\n   703→                  >\n   704→                    {level}x\n   705→                  </button>\n   706→                ))}\n   707→              </div>\n   708→            </div>\n   709→\n   710→            {/* Auto-Detect Button */}\n   711→            <button\n   712→              onClick={handleAutoDetect}\n   713→              disabled={isDetecting}\n   714→              className={`w-full py-3 rounded-lg text-sm font-medium transition-all flex items-center justify-center gap-2 ${\n   715→                hasAutoDetected\n   716→                  ? 'bg-green-500/20 text-green-400 border border-green-500/30'\n   717→                  : 'bg-gradient-to-r from-[#00f3ff] to-[#00c4cc] text-black hover:shadow-[0_0_20px_rgba(0,243,255,0.3)]'\n   718→              } disabled:opacity-50 disabled:cursor-not-allowed`}\n   719→            >\n   720→              {isDetecting ? (\n   721→                <>\n   722→                  <Loader2 className=\"w-4 h-4 animate-spin\" />\n   723→                  Detecting...\n   724→                </>\n   725→              ) : hasAutoDetected ? (\n   726→                <>\n   727→                  <Check className=\"w-4 h-4\" />\n   728→                  Detected - Adjust if needed\n   729→                </>\n   730→              ) : (\n   731→                <>\n   732→                  <Scan className=\"w-4 h-4\" />\n   733→                  Auto-Detect Landmarks\n   734→                </>\n   735→              )}\n   736→            </button>\n   737→\n   738→            {/* Auto-Zoom Toggle */}\n   739→            <button\n   740→              onClick={() => setAutoZoomEnabled(!autoZoomEnabled)}\n   741→              className={`w-full py-2.5 rounded-lg text-xs font-medium transition-all flex items-center justify-center gap-2 ${\n   742→                autoZoomEnabled\n   743→                  ? 'bg-[#00f3ff] text-black'\n   744→                  : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n   745→              }`}\n   746→            >\n   747→              <Focus className=\"w-4 h-4\" />\n   748→              {autoZoomEnabled ? 'Auto-Zoom: ON' : 'Auto-Zoom: OFF'}\n   749→            </button>\n   750→\n   751→          </div>\n   752→        </div>\n   753→\n   754→        {/* Main Image Area */}\n   755→        <div className=\"flex-1 min-h-0 relative md:order-1 flex flex-col\">\n   756→          <div\n   757→            ref={containerRef}\n   758→            className=\"relative flex-1 bg-neutral-900 overflow-hidden rounded-xl border border-neutral-800 select-none\"\n   759→            onMouseDown={handleMouseDown}\n   760→            onMouseMove={handleMouseMove}\n   761→            onMouseUp={handleMouseUp}\n   762→            onMouseLeave={handleMouseUp}\n   763→            style={{\n   764→              cursor: isDragging ? 'grabbing' : 'grab',\n   765→            }}\n   766→          >\n   767→            {/* Transformed Content - Image and placed landmarks move together */}\n   768→            <div\n   769→              className=\"absolute inset-0\"\n   770→              style={{\n   771→                transform: `translate(${pan.x}px, ${pan.y}px) scale(${zoomLevel})`,\n   772→                transformOrigin: '0 0',\n   773→              }}\n   774→            >\n   775→              {/* User's Image */}\n   776→              <Image\n   777→                src={imageUrl}\n   778→                alt=\"Your photo\"\n   779→                fill\n   780→                className=\"object-contain pointer-events-none select-none\"\n   781→                unoptimized\n   782→                draggable={false}\n   783→              />\n   784→\n   785→              {/* Placed landmarks - always visible as they're placed */}\n   786→              {landmarks.filter(lm => placedLandmarks.has(lm.id) && lm.id !== currentLandmarkId).map((landmark) => {\n   787→                const lmColor = getLandmarkColor(landmark.id, categories);\n   788→                const pos = getLandmarkPixelPosition(landmark.x, landmark.y);\n   789→\n   790→                return (\n   791→                  <div\n   792→                    key={landmark.id}\n   793→                    className=\"absolute pointer-events-none\"\n   794→                    style={{\n   795→                      left: pos.left,\n   796→                      top: pos.top,\n   797→                      transform: `translate(-50%, -50%) scale(${1 / zoomLevel})`,\n   798→                      transformOrigin: 'center center',\n   799→                    }}\n   800→                  >\n   801→                    {/* Small persistent dot - matches Harmony style */}\n   802→                    <div\n   803→                      className=\"absolute rounded-full\"\n   804→                      style={{\n   805→                        width: 8,\n   806→                        height: 8,\n   807→                        left: -4,\n   808→                        top: -4,\n   809→                        backgroundColor: lmColor,\n   810→                        boxShadow: `0 0 4px ${lmColor}, 0 0 8px ${lmColor}60`,\n   811→                        border: '1px solid rgba(255,255,255,0.5)',\n   812→                      }}\n   813→                    />\n   814→                  </div>\n   815→                );\n   816→              })}\n   817→\n   818→              {/* Frankfort Horizontal Plane - green reference line for side profiles */}\n   819→              {mode === 'side' && frankfortPlane && (\n   820→                <svg\n   821→                  className=\"absolute inset-0 pointer-events-none\"\n   822→                  style={{ width: '100%', height: '100%' }}\n   823→                >\n   824→                  {(() => {\n   825→                    const bounds = getImageBounds();\n   826→                    const orbitaleX = bounds.offsetX + frankfortPlane.orbitale.x * bounds.renderedWidth;\n   827→                    const orbitaleY = bounds.offsetY + frankfortPlane.orbitale.y * bounds.renderedHeight;\n   828→                    const porionX = bounds.offsetX + frankfortPlane.porion.x * bounds.renderedWidth;\n   829→                    const porionY = bounds.offsetY + frankfortPlane.porion.y * bounds.renderedHeight;\n   830→\n   831→                    // Extend the line beyond the points for visibility\n   832→                    const dx = porionX - orbitaleX;\n   833→                    const dy = porionY - orbitaleY;\n   834→                    const length = Math.sqrt(dx * dx + dy * dy);\n   835→                    const extendFactor = length > 0 ? 0.3 : 0;\n   836→                    const startX = orbitaleX - (dx / length) * bounds.renderedWidth * extendFactor;\n   837→                    const startY = orbitaleY - (dy / length) * bounds.renderedWidth * extendFactor;\n   838→                    const endX = porionX + (dx / length) * bounds.renderedWidth * extendFactor;\n   839→                    const endY = porionY + (dy / length) * bounds.renderedWidth * extendFactor;\n   840→\n   841→                    return (\n   842→                      <>\n   843→                        {/* Main Frankfort line */}\n   844→                        <line\n   845→                          x1={startX}\n   846→                          y1={startY}\n   847→                          x2={endX}\n   848→                          y2={endY}\n   849→                          stroke=\"#22c55e\"\n   850→                          strokeWidth={2 / zoomLevel}\n   851→                          strokeDasharray={`${6 / zoomLevel} ${4 / zoomLevel}`}\n   852→                          opacity={0.8}\n   853→                        />\n   854→                        {/* Orbitale point marker */}\n   855→                        <circle\n   856→                          cx={orbitaleX}\n   857→                          cy={orbitaleY}\n   858→                          r={4 / zoomLevel}\n   859→                          fill=\"#22c55e\"\n   860→                          stroke=\"white\"\n   861→                          strokeWidth={1 / zoomLevel}\n   862→                        />\n   863→                        {/* Porion point marker */}\n   864→                        <circle\n   865→                          cx={porionX}\n   866→                          cy={porionY}\n   867→                          r={4 / zoomLevel}\n   868→                          fill=\"#22c55e\"\n   869→                          stroke=\"white\"\n   870→                          strokeWidth={1 / zoomLevel}\n   871→                        />\n   872→                        {/* Angle indicator */}\n   873→                        <text\n   874→                          x={startX}\n   875→                          y={startY - 10 / zoomLevel}\n   876→                          fill=\"#22c55e\"\n   877→                          fontSize={12 / zoomLevel}\n   878→                          fontWeight=\"bold\"\n   879→                        >\n   880→                          FH: {frankfortPlane.angle.toFixed(1)}°\n   881→                        </text>\n   882→                      </>\n   883→                    );\n   884→                  })()}\n   885→                </svg>\n   886→              )}\n   887→            </div>\n   888→\n   889→            {/* FIXED CENTER TARGETING DOT - small precise point for accurate placement */}\n   890→            <div className=\"absolute inset-0 pointer-events-none flex items-center justify-center z-20\">\n   891→              {/* Crosshair lines for precision */}\n   892→              <div\n   893→                className=\"absolute\"\n   894→                style={{\n   895→                  width: 20,\n   896→                  height: 1,\n   897→                  backgroundColor: '#00f3ff',\n   898→                  opacity: 0.6,\n   899→                }}\n   900→              />\n   901→              <div\n   902→                className=\"absolute\"\n   903→                style={{\n   904→                  width: 1,\n   905→                  height: 20,\n   906→                  backgroundColor: '#00f3ff',\n   907→                  opacity: 0.6,\n   908→                }}\n   909→              />\n   910→              {/* Subtle glow ring */}\n   911→              <div\n   912→                className=\"absolute rounded-full\"\n   913→                style={{\n   914→                  width: 12,\n   915→                  height: 12,\n   916→                  background: 'radial-gradient(circle, #00f3ff33 0%, transparent 70%)',\n   917→                }}\n   918→              />\n   919→              {/* Center dot - small and precise */}\n   920→              <div\n   921→                className=\"relative rounded-full\"\n   922→                style={{\n   923→                  width: 4,\n   924→                  height: 4,\n   925→                  backgroundColor: '#00f3ff',\n   926→                  boxShadow: '0 0 6px #00f3ff, 0 0 12px #00f3ff80',\n   927→                }}\n   928→              />\n   929→            </div>\n   930→\n   931→            {/* Loading Overlay */}\n   932→            {isDetecting && (\n   933→              <div className=\"absolute inset-0 bg-black/70 flex flex-col items-center justify-center z-50\">\n   934→                <Loader2 className=\"w-12 h-12 text-[#00f3ff] animate-spin mb-4\" />\n   935→                <p className=\"text-white text-lg font-medium\">Detecting landmarks...</p>\n   936→                <p className=\"text-neutral-400 text-sm mt-2\">This may take a few seconds</p>\n   937→              </div>\n   938→            )}\n   939→\n   940→            {/* Detection Failed Banner */}\n   941→            {detectionFailed && !isDetecting && (\n   942→              <motion.div\n   943→                initial={{ opacity: 0, y: -20 }}\n   944→                animate={{ opacity: 1, y: 0 }}\n   945→                className=\"absolute top-12 left-3 right-3 z-30\"\n   946→              >\n   947→                <div className=\"bg-amber-500/20 border border-amber-500/50 rounded-lg px-3 py-2 flex items-center gap-2\">\n   948→                  <AlertTriangle className=\"w-4 h-4 text-amber-400 flex-shrink-0\" />\n   949→                  <p className=\"text-amber-200 text-xs flex-1\">\n   950→                    {mode === 'side'\n   951→                      ? 'Auto-detection could not find profile. Please place landmarks manually for best accuracy.'\n   952→                      : 'Could not detect face. Please place landmarks manually.'}\n   953→                  </p>\n   954→                  <button\n   955→                    onClick={() => setDetectionFailed(false)}\n   956→                    className=\"text-amber-400 hover:text-amber-200 transition-colors\"\n   957→                  >\n   958→                    <X className=\"w-4 h-4\" />\n   959→                  </button>\n   960→                </div>\n   961→              </motion.div>\n   962→            )}\n   963→\n   964→            {/* Zoom indicator */}\n   965→            <div className=\"absolute top-3 left-3 px-3 py-1.5 rounded-lg bg-black/80 border border-neutral-700 text-white text-xs flex items-center gap-2\">\n   966→              <Move className=\"w-3 h-3\" />\n   967→              {zoomLevel.toFixed(1)}x - Drag to align\n   968→            </div>\n   969→\n   970→            {/* Current landmark label overlay */}\n   971→            <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black via-black/80 to-transparent p-4 pointer-events-none\">\n   972→              <p className=\"text-center text-white text-sm font-medium\">\n   973→                Drag image to align:{' '}\n   974→                <span className=\"font-semibold\" style={{ color }}>{currentLandmark?.label}</span>\n   975→              </p>\n   976→              <p className=\"text-center text-neutral-400 text-xs mt-1\">\n   977→                Press Enter or click Next to confirm\n   978→              </p>\n   979→            </div>\n   980→          </div>\n   981→\n   982→          {/* Navigation Bar - Fixed at bottom of image area */}\n   983→          <div className=\"mt-3 flex items-center justify-center gap-3\">\n   984→            <button\n   985→              onClick={handlePrevious}\n   986→              className=\"p-2.5 rounded-xl bg-neutral-800 text-neutral-300 hover:bg-neutral-700 border border-neutral-700 transition-all\"\n   987→            >\n   988→              <ChevronLeft className=\"w-5 h-5\" />\n   989→            </button>\n   990→\n   991→            {/* Step dots - show current position indicator */}\n   992→            <div className=\"flex items-center gap-2 px-4 py-2 bg-neutral-900 rounded-xl border border-neutral-800\">\n   993→              <span className=\"text-xs text-neutral-400 font-mono min-w-[4ch]\">\n   994→                {currentStepIndex + 1}\n   995→              </span>\n   996→              <div className=\"w-32 h-1.5 bg-neutral-800 rounded-full overflow-hidden\">\n   997→                <div\n   998→                  className=\"h-full bg-[#00f3ff] rounded-full transition-all duration-200\"\n   999→                  style={{ width: `${((currentStepIndex + 1) / totalSteps) * 100}%` }}\n  1000→                />\n  1001→              </div>\n  1002→              <span className=\"text-xs text-neutral-400 font-mono min-w-[4ch] text-right\">\n  1003→                {totalSteps}\n  1004→              </span>\n  1005→            </div>\n  1006→\n  1007→            <button\n  1008→              onClick={handleNext}\n  1009→              className={`flex items-center gap-2 px-5 py-2.5 rounded-xl font-medium text-sm transition-all ${\n  1010→                currentStepIndex === totalSteps - 1\n  1011→                  ? 'bg-green-500 text-white hover:bg-green-600'\n  1012→                  : 'bg-[#00f3ff] text-black hover:shadow-[0_0_20px_rgba(0,243,255,0.4)]'\n  1013→              }`}\n  1014→            >\n  1015→              {currentStepIndex === totalSteps - 1 ? (\n  1016→                <>\n  1017→                  <Check className=\"w-4 h-4\" />\n  1018→                  Complete\n  1019→                </>\n  1020→              ) : (\n  1021→                <>\n  1022→                  Next\n  1023→                  <ChevronRight className=\"w-4 h-4\" />\n  1024→                </>\n  1025→              )}\n  1026→            </button>\n  1027→          </div>\n  1028→        </div>\n  1029→      </div>\n  1030→    </div>\n  1031→  );\n  1032→}\n  1033→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"1d1f86b7-92b2-43d9-8c19-dbced397c109","timestamp":"2025-12-27T03:19:49.526Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/LandmarkAnalysisTool.tsx","content":"'use client';\n\nimport { useState, useRef, useCallback, useEffect } from 'react';\nimport Image from 'next/image';\nimport { motion } from 'framer-motion';\nimport {\n  ChevronLeft,\n  ChevronRight,\n  ChevronUp,\n  ChevronDown,\n  Check,\n  Info,\n  Scan,\n  Loader2,\n  Move,\n  Focus,\n  AlertTriangle,\n  X,\n} from 'lucide-react';\nimport {\n  LandmarkPoint,\n  FRONT_PROFILE_LANDMARKS,\n  SIDE_PROFILE_LANDMARKS,\n  getLandmarkColor,\n  FRONT_LANDMARK_CATEGORIES,\n  SIDE_LANDMARK_CATEGORIES,\n} from '@/lib/landmarks';\nimport { getLandmarkImagePath, getLandmarkPlacementGuide } from '@/lib/landmarkImages';\nimport { detectFromImageUrl } from '@/lib/mediapipeDetection';\n\ninterface LandmarkAnalysisToolProps {\n  imageUrl: string;\n  mode: 'front' | 'side';\n  initialLandmarks?: LandmarkPoint[];\n  onLandmarksChange?: (landmarks: LandmarkPoint[]) => void;\n  onComplete?: (landmarks: LandmarkPoint[]) => void;\n  onBack?: () => void;\n}\n\nfunction getOrderedLandmarks(mode: 'front' | 'side'): string[] {\n  const landmarks = mode === 'front' ? FRONT_PROFILE_LANDMARKS : SIDE_PROFILE_LANDMARKS;\n  return landmarks.map(lm => lm.id);\n}\n\nexport function LandmarkAnalysisTool({\n  imageUrl,\n  mode,\n  initialLandmarks,\n  onLandmarksChange,\n  onComplete,\n  onBack,\n}: LandmarkAnalysisToolProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [imageDimensions, setImageDimensions] = useState<{ width: number; height: number } | null>(null);\n  const [containerSize, setContainerSize] = useState<{ width: number; height: number } | null>(null);\n  const defaultLandmarks = mode === 'front' ? FRONT_PROFILE_LANDMARKS : SIDE_PROFILE_LANDMARKS;\n  const categories = mode === 'front' ? FRONT_LANDMARK_CATEGORIES : SIDE_LANDMARK_CATEGORIES;\n  const orderedIds = getOrderedLandmarks(mode);\n\n  const [landmarks, setLandmarks] = useState<LandmarkPoint[]>(\n    initialLandmarks || defaultLandmarks\n  );\n  const [currentStepIndex, setCurrentStepIndex] = useState(0);\n  const [zoomLevel, setZoomLevel] = useState(2); // FaceIQ parity: 2x/4x/8x discrete levels\n\n  // Reset state when mode changes (fixes side profile starting at step 52)\n  useEffect(() => {\n    const newLandmarks = mode === 'front' ? FRONT_PROFILE_LANDMARKS : SIDE_PROFILE_LANDMARKS;\n    setCurrentStepIndex(0);\n    setPlacedLandmarks(new Set());\n    setHasAutoDetected(false);\n    setDetectionFailed(false);\n    setLandmarks(newLandmarks);\n    setPan({ x: 0, y: 0 });\n    setZoomLevel(2); // FaceIQ parity: start at 2x\n  }, [mode]);\n  const [pan, setPan] = useState({ x: 0, y: 0 });\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\n  const [pressedKeys, setPressedKeys] = useState<Set<string>>(new Set());\n  const [activeTab, setActiveTab] = useState<'info' | 'reference'>('info');\n  const [isDetecting, setIsDetecting] = useState(true);\n  const [hasAutoDetected, setHasAutoDetected] = useState(false);\n  const [autoZoomEnabled, setAutoZoomEnabled] = useState(true);\n  const [detectionFailed, setDetectionFailed] = useState(false);\n  const [placedLandmarks, setPlacedLandmarks] = useState<Set<string>>(new Set());\n  // Frankfort Plane for side profile visualization (from server detection)\n  const [frankfortPlane, setFrankfortPlane] = useState<{\n    angle: number;\n    orbitale: { x: number; y: number };\n    porion: { x: number; y: number };\n  } | null>(null);\n\n  const currentLandmarkId = orderedIds[currentStepIndex];\n  const currentLandmark = landmarks.find((lm) => lm.id === currentLandmarkId);\n  const totalSteps = orderedIds.length;\n  const progress = ((currentStepIndex + 1) / totalSteps) * 100;\n\n  const color = currentLandmark\n    ? getLandmarkColor(currentLandmark.id, categories)\n    : '#00f3ff';\n\n  // Load image dimensions on mount\n  useEffect(() => {\n    const img = new window.Image();\n    img.onload = () => {\n      setImageDimensions({ width: img.naturalWidth, height: img.naturalHeight });\n    };\n    img.src = imageUrl;\n  }, [imageUrl]);\n\n  // Track container size changes with ResizeObserver\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const observer = new ResizeObserver((entries) => {\n      const { width, height } = entries[0].contentRect;\n      setContainerSize({ width, height });\n    });\n\n    observer.observe(containerRef.current);\n    return () => observer.disconnect();\n  }, []);\n\n  // Calculate the rendered image bounds within the container (accounting for object-contain)\n  const getImageBounds = useCallback(() => {\n    if (!containerRef.current || !imageDimensions || !containerSize) {\n      return { offsetX: 0, offsetY: 0, renderedWidth: 1, renderedHeight: 1, containerWidth: 1, containerHeight: 1 };\n    }\n\n    const containerWidth = containerSize.width;\n    const containerHeight = containerSize.height;\n    const imageAspect = imageDimensions.width / imageDimensions.height;\n    const containerAspect = containerWidth / containerHeight;\n\n    let renderedWidth: number;\n    let renderedHeight: number;\n    let offsetX = 0;\n    let offsetY = 0;\n\n    if (imageAspect > containerAspect) {\n      renderedWidth = containerWidth;\n      renderedHeight = containerWidth / imageAspect;\n      offsetY = (containerHeight - renderedHeight) / 2;\n    } else {\n      renderedHeight = containerHeight;\n      renderedWidth = containerHeight * imageAspect;\n      offsetX = (containerWidth - renderedWidth) / 2;\n    }\n\n    return { offsetX, offsetY, renderedWidth, renderedHeight, containerWidth, containerHeight };\n  }, [imageDimensions, containerSize]);\n\n  // Get what normalized coordinates the center orb points to on the image\n  const getCrosshairNormalizedPosition = useCallback(() => {\n    const bounds = getImageBounds();\n    if (!bounds.renderedWidth || !bounds.renderedHeight) {\n      return { x: 0.5, y: 0.5 };\n    }\n\n    // The container center (where the orb is) in screen coordinates\n    const containerCenterX = bounds.containerWidth / 2;\n    const containerCenterY = bounds.containerHeight / 2;\n\n    // The transform is: translate(pan.x, pan.y) scale(zoomLevel)\n    // To find what image point is at container center, we reverse this:\n    // 1. The point at container center after transform comes from:\n    //    screenPos = imagePos * zoomLevel + pan\n    // 2. Solving for imagePos:\n    //    imagePos = (screenPos - pan) / zoomLevel\n    const imageX = (containerCenterX - pan.x) / zoomLevel;\n    const imageY = (containerCenterY - pan.y) / zoomLevel;\n\n    // Convert to normalized (0-1) coordinates within the image\n    const normalizedX = (imageX - bounds.offsetX) / bounds.renderedWidth;\n    const normalizedY = (imageY - bounds.offsetY) / bounds.renderedHeight;\n\n    return {\n      x: Math.max(0, Math.min(1, normalizedX)),\n      y: Math.max(0, Math.min(1, normalizedY)),\n    };\n  }, [getImageBounds, pan, zoomLevel]);\n\n  // Convert normalized image coordinates (0-1) to pixel position within the container\n  // Note: This is used for landmarks INSIDE the transformed container, so no zoom/pan needed\n  const getLandmarkPixelPosition = useCallback((x: number, y: number) => {\n    const bounds = getImageBounds();\n    // Position relative to container (the parent transform handles zoom/pan)\n    const pixelX = bounds.offsetX + x * bounds.renderedWidth;\n    const pixelY = bounds.offsetY + y * bounds.renderedHeight;\n    return { left: pixelX, top: pixelY };\n  }, [getImageBounds]);\n\n  useEffect(() => {\n    onLandmarksChange?.(landmarks);\n  }, [landmarks, onLandmarksChange]);\n\n  // Confirm placement: set current landmark to where crosshair points\n  const confirmPlacement = useCallback(() => {\n    const pos = getCrosshairNormalizedPosition();\n    setLandmarks((prev) =>\n      prev.map((lm) =>\n        lm.id === currentLandmarkId ? { ...lm, x: pos.x, y: pos.y } : lm\n      )\n    );\n    setPlacedLandmarks((prev) => new Set(prev).add(currentLandmarkId));\n  }, [currentLandmarkId, getCrosshairNormalizedPosition]);\n\n  // Handle click - confirms placement at crosshair position\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const handleContainerClick = useCallback(() => {\n    if (isDragging) return;\n    confirmPlacement();\n  }, [isDragging, confirmPlacement]);\n\n  // Mouse down - start dragging to pan\n  const handleMouseDown = useCallback(\n    (e: React.MouseEvent) => {\n      if (e.button === 0) {\n        setIsDragging(true);\n        setDragStart({ x: e.clientX - pan.x, y: e.clientY - pan.y });\n      }\n    },\n    [pan]\n  );\n\n  // Mouse move - pan the image\n  const handleMouseMove = useCallback(\n    (e: React.MouseEvent) => {\n      if (isDragging) {\n        setPan({\n          x: e.clientX - dragStart.x,\n          y: e.clientY - dragStart.y,\n        });\n      }\n    },\n    [isDragging, dragStart]\n  );\n\n  const handleMouseUp = useCallback(() => {\n    setIsDragging(false);\n  }, []);\n\n  const handleResetZoom = useCallback(() => {\n    setZoomLevel(2); // FaceIQ parity: reset to 2x\n    setPan({ x: 0, y: 0 });\n  }, []);\n\n  // Pan the image using arrow keys (moves the crosshair target point on the image)\n  const panImage = useCallback((direction: 'up' | 'down' | 'left' | 'right') => {\n    const step = 20; // pixels to pan per keypress\n    setPan((prev) => {\n      switch (direction) {\n        case 'up': return { ...prev, y: prev.y + step };\n        case 'down': return { ...prev, y: prev.y - step };\n        case 'left': return { ...prev, x: prev.x + step };\n        case 'right': return { ...prev, x: prev.x - step };\n        default: return prev;\n      }\n    });\n  }, []);\n\n  const handleNext = useCallback(() => {\n    // Confirm placement at current crosshair position before moving to next\n    confirmPlacement();\n\n    if (currentStepIndex < totalSteps - 1) {\n      setCurrentStepIndex((prev) => prev + 1);\n      // Don't reset zoom - let zoomToLandmark handle it\n    } else {\n      onComplete?.(landmarks);\n    }\n  }, [currentStepIndex, totalSteps, landmarks, onComplete, confirmPlacement]);\n\n  const handlePrevious = useCallback(() => {\n    if (currentStepIndex > 0) {\n      setCurrentStepIndex((prev) => prev - 1);\n      handleResetZoom();\n    } else {\n      onBack?.();\n    }\n  }, [currentStepIndex, handleResetZoom, onBack]);\n\n  // FaceIQ parity: Landmark-specific zoom levels for optimal precision\n  // Fine detail landmarks (pupils, eyelids) get higher zoom, larger areas get lower zoom\n  const LANDMARK_ZOOM_LEVELS: Record<string, number> = {\n    // 2x zoom - larger landmarks\n    trichion: 2,\n    left_temporal: 2, right_temporal: 2,\n    left_auricular_lateral: 2, right_auricular_lateral: 2,\n\n    // 4x zoom - medium detail landmarks\n    left_pupila: 4, right_pupila: 4,\n    left_canthus_medialis: 4, left_canthus_lateralis: 4,\n    right_canthus_medialis: 4, right_canthus_lateralis: 4,\n    left_sulcus_palpebralis_lateralis: 4, right_sulcus_palpebralis_lateralis: 4,\n    left_supercilium_medialis: 4, left_supercilium_medial_corner: 4,\n    left_supercilium_superior: 4, left_supercilium_apex: 4, left_supercilium_lateralis: 4,\n    right_supercilium_medialis: 4, right_supercilium_medial_corner: 4,\n    right_supercilium_superior: 4, right_supercilium_apex: 4, right_supercilium_lateralis: 4,\n    left_ala_nasi: 4, right_ala_nasi: 4,\n    nasal_base: 4, subnasale: 4,\n    left_dorsum_nasi: 4, right_dorsum_nasi: 4,\n    labrale_superius: 4, cupids_bow: 4, mouth_middle: 4,\n    labrale_inferius: 4, left_cheilion: 4, right_cheilion: 4,\n    left_gonion_superior: 4, left_gonion_inferior: 4,\n    right_gonion_superior: 4, right_gonion_inferior: 4,\n    left_mentum_lateralis: 4, right_mentum_lateralis: 4, menton: 4,\n    left_zygion: 2, right_zygion: 2,\n    left_cervical_lateralis: 4, right_cervical_lateralis: 4,\n\n    // 8x zoom - fine detail landmarks (eyelids)\n    left_palpebra_superior: 8, left_palpebra_inferior: 8,\n    right_palpebra_superior: 8, right_palpebra_inferior: 8,\n    left_pretarsal_skin_crease: 8, right_pretarsal_skin_crease: 8,\n\n    // ========== SIDE PROFILE LANDMARKS (FaceIQ parity) ==========\n    // 2x zoom - larger side landmarks\n    vertex: 2,\n    occiput: 2,\n    neckPoint: 2,\n    forehead: 2,\n\n    // 4x zoom - medium detail side landmarks\n    porion: 4,\n    orbitale: 4,\n    tragus: 4,\n    intertragicNotch: 4,\n    cornealApex: 4,\n    cheekbone: 4,\n    glabella: 4,\n    nasion: 4,\n    pronasale: 4,\n    rhinion: 4,\n    supratip: 4,\n    infratip: 4,\n    columella: 4,\n    subalare: 4,\n    labraleSuperius: 4,\n    cheilion: 4,\n    labraleInferius: 4,\n    sublabiale: 4,\n    pogonion: 4,\n    cervicalPoint: 4,\n    gonionTop: 4,\n    gonionBottom: 4,\n  };\n\n  // Auto-zoom to the current landmark's region - centers the landmark under the fixed orb\n  const zoomToLandmark = useCallback((landmarkId: string) => {\n    if (!autoZoomEnabled || !containerRef.current || !containerSize || !imageDimensions) return;\n\n    const landmark = landmarks.find(lm => lm.id === landmarkId);\n    if (!landmark) return;\n\n    const bounds = getImageBounds();\n    if (bounds.renderedWidth <= 1 || bounds.renderedHeight <= 1) return; // Bounds not ready\n\n    // FaceIQ parity: Use landmark-specific zoom level, default to 2x\n    const newZoom = LANDMARK_ZOOM_LEVELS[landmarkId] || 2;\n    setZoomLevel(newZoom);\n\n    // Calculate pan so the landmark appears at container center (under the fixed orb)\n    const containerCenterX = bounds.containerWidth / 2;\n    const containerCenterY = bounds.containerHeight / 2;\n\n    // Where the landmark is in unzoomed image space\n    const landmarkX = bounds.offsetX + landmark.x * bounds.renderedWidth;\n    const landmarkY = bounds.offsetY + landmark.y * bounds.renderedHeight;\n\n    // Pan needed: after zoom, landmark should be at container center\n    // Transform is: translate(pan) scale(zoom) with origin at 0,0\n    // A point at landmarkPos ends up at: landmarkPos * zoom + pan\n    // We want it at containerCenter, so: pan = containerCenter - landmarkPos * zoom\n    setPan({\n      x: containerCenterX - landmarkX * newZoom,\n      y: containerCenterY - landmarkY * newZoom,\n    });\n  }, [autoZoomEnabled, landmarks, getImageBounds, containerSize, imageDimensions]);\n\n  // Auto-detect landmarks using Human.js/MediaPipe\n  const handleAutoDetect = useCallback(async () => {\n    setIsDetecting(true);\n    setDetectionFailed(false);\n    setFrankfortPlane(null);\n    try {\n      const result = await detectFromImageUrl(imageUrl, mode);\n      console.log('[DEBUG] Detection result:', result);\n      console.log('[DEBUG] Sample landmarks:', result?.landmarks.slice(0, 5));\n      if (result && result.landmarks.length > 0) {\n        // Update landmarks with detected positions\n        setLandmarks(prev =>\n          prev.map(lm => {\n            const detected = result.landmarks.find(d => d.id === lm.id);\n            if (detected) {\n              return { ...lm, x: detected.x, y: detected.y };\n            }\n            return lm;\n          })\n        );\n        setHasAutoDetected(true);\n        setDetectionFailed(false);\n\n        // Capture Frankfort Plane for side profile (from server-side detection)\n        if (mode === 'side' && result.frankfortPlane) {\n          console.log('[DEBUG] Frankfort Plane:', result.frankfortPlane);\n          setFrankfortPlane(result.frankfortPlane);\n        }\n\n        // Zoom to first landmark after detection\n        zoomToLandmark(orderedIds[0]);\n      } else {\n        // Detection returned no results - common for side profile\n        console.log('[DEBUG] No landmarks detected - manual placement required');\n        setDetectionFailed(true);\n        setHasAutoDetected(false);\n      }\n    } catch (error) {\n      console.error('Auto-detection failed:', error);\n      setDetectionFailed(true);\n    } finally {\n      setIsDetecting(false);\n    }\n  }, [imageUrl, mode, orderedIds, zoomToLandmark]);\n\n  // Auto-detect after image dimensions are loaded (prevents race condition)\n  useEffect(() => {\n    if (imageDimensions) {\n      handleAutoDetect();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [imageDimensions]); // Run after dimensions are loaded\n\n  // Auto-zoom when step changes or container size becomes available\n  useEffect(() => {\n    if (hasAutoDetected && autoZoomEnabled && currentLandmarkId && containerSize) {\n      zoomToLandmark(currentLandmarkId);\n    }\n  }, [currentStepIndex, currentLandmarkId, hasAutoDetected, autoZoomEnabled, zoomToLandmark, containerSize]);\n\n  // Keyboard handlers with proper state tracking\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Enter', 'Backspace', 'r', 'R'].includes(e.key)) {\n        e.preventDefault();\n      }\n\n      setPressedKeys((prev) => new Set(prev).add(e.key));\n\n      switch (e.key) {\n        case 'ArrowUp': panImage('up'); break;\n        case 'ArrowDown': panImage('down'); break;\n        case 'ArrowLeft': panImage('left'); break;\n        case 'ArrowRight': panImage('right'); break;\n        case 'Enter': handleNext(); break;\n        case 'Backspace': handlePrevious(); break;\n        case 'r':\n        case 'R': handleResetZoom(); break;\n      }\n    };\n\n    const handleKeyUp = (e: KeyboardEvent) => {\n      setPressedKeys((prev) => {\n        const next = new Set(prev);\n        next.delete(e.key);\n        return next;\n      });\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    window.addEventListener('keyup', handleKeyUp);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n      window.removeEventListener('keyup', handleKeyUp);\n    };\n  }, [panImage, handleNext, handlePrevious, handleResetZoom]);\n\n  const isKeyPressed = (key: string) => pressedKeys.has(key);\n\n  return (\n    <div className=\"fixed inset-0 bg-black\">\n      <div className=\"flex flex-col md:flex-row h-full gap-3 p-3 md:p-4\">\n        {/* Sidebar - Right on desktop */}\n        <div className=\"w-full md:w-80 flex-shrink-0 flex flex-col gap-3 md:order-2 overflow-hidden md:overflow-y-auto\">\n          {/* Progress Card */}\n          <div className=\"bg-neutral-900 rounded-xl border border-neutral-800 overflow-hidden flex-shrink-0\">\n            <div className=\"p-4\">\n              <div className=\"flex items-center justify-between text-xs text-neutral-400 mb-2\">\n                <span>Step {currentStepIndex + 1} of {totalSteps}</span>\n                <span>{Math.round(progress)}%</span>\n              </div>\n              <div className=\"h-1.5 bg-neutral-800 rounded-full overflow-hidden mb-3\">\n                <motion.div\n                  className=\"h-full rounded-full\"\n                  style={{ width: `${progress}%`, backgroundColor: '#00f3ff' }}\n                  transition={{ duration: 0.3 }}\n                />\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-6 h-6 bg-[#00f3ff] rounded-full flex items-center justify-center flex-shrink-0\">\n                  <Check className=\"w-3.5 h-3.5 text-black\" />\n                </div>\n                <span className=\"text-sm font-medium text-white\">\n                  {currentStepIndex} placed\n                </span>\n              </div>\n            </div>\n\n            {/* View Tabs */}\n            <div className=\"flex border-t border-neutral-800\">\n              <button\n                onClick={() => setActiveTab('info')}\n                className={`flex-1 py-2.5 text-xs font-medium transition-colors ${\n                  activeTab === 'info'\n                    ? 'text-[#00f3ff] border-b-2 border-[#00f3ff]'\n                    : 'text-neutral-500 hover:text-neutral-300'\n                }`}\n              >\n                Current Point\n              </button>\n              <button\n                onClick={() => setActiveTab('reference')}\n                className={`flex-1 py-2.5 text-xs font-medium transition-colors ${\n                  activeTab === 'reference'\n                    ? 'text-[#00f3ff] border-b-2 border-[#00f3ff]'\n                    : 'text-neutral-500 hover:text-neutral-300'\n                }`}\n              >\n                Reference\n              </button>\n            </div>\n\n            {/* Info/Reference Content */}\n            <div className=\"bg-neutral-900/50\">\n              {activeTab === 'info' ? (\n                <div>\n                  {/* Photo Reference Image */}\n                  {currentLandmark && getLandmarkImagePath(currentLandmark.id, mode, 'photo') ? (\n                    <div className=\"relative w-full aspect-square bg-neutral-800\">\n                      <Image\n                        src={getLandmarkImagePath(currentLandmark.id, mode, 'photo')!}\n                        alt={currentLandmark.label}\n                        fill\n                        className=\"object-contain\"\n                        unoptimized\n                      />\n                    </div>\n                  ) : (\n                    <div className=\"w-full aspect-square bg-neutral-800 flex items-center justify-center\">\n                      <div\n                        className=\"w-14 h-14 rounded-full flex items-center justify-center\"\n                        style={{ backgroundColor: `${color}20`, border: `2px solid ${color}` }}\n                      >\n                        <div className=\"w-4 h-4 rounded-full\" style={{ backgroundColor: color }} />\n                      </div>\n                    </div>\n                  )}\n                  <div className=\"p-3 text-center border-t border-neutral-800\">\n                    <p className=\"text-sm font-semibold text-white\">{currentLandmark?.label}</p>\n                    <p className=\"text-xs text-[#00f3ff] mt-0.5 font-mono\">{currentLandmark?.medicalTerm}</p>\n                  </div>\n                </div>\n              ) : (\n                <div>\n                  {/* Infographic Reference Image */}\n                  {currentLandmark && getLandmarkImagePath(currentLandmark.id, mode, 'infographic') ? (\n                    <div className=\"relative w-full aspect-square bg-neutral-800\">\n                      <Image\n                        src={getLandmarkImagePath(currentLandmark.id, mode, 'infographic')!}\n                        alt={`${currentLandmark.label} infographic`}\n                        fill\n                        className=\"object-contain\"\n                        unoptimized\n                      />\n                    </div>\n                  ) : (\n                    <div className=\"w-full aspect-square bg-neutral-800 flex items-center justify-center\">\n                      <Info className=\"w-12 h-12 text-neutral-600\" />\n                    </div>\n                  )}\n                  <div className=\"p-3 text-center border-t border-neutral-800\">\n                    <p className=\"text-sm text-neutral-300\">\n                      {currentLandmark ? getLandmarkPlacementGuide(currentLandmark.id, mode) : ''}\n                    </p>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Keyboard Shortcuts - Desktop only */}\n          <div className=\"hidden md:flex flex-col gap-3\">\n            <div className=\"bg-neutral-900 rounded-xl border border-neutral-800 p-4\">\n              <p className=\"text-xs text-neutral-500 font-medium uppercase tracking-wide mb-3 text-center\">\n                Keyboard Controls\n              </p>\n              <div className=\"flex justify-center mb-4\">\n                <div className=\"flex flex-col gap-1 items-center\">\n                  {/* Arrow Up */}\n                  <div\n                    className={`w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-100 ${\n                      isKeyPressed('ArrowUp')\n                        ? 'bg-[#00f3ff] text-black shadow-[0_0_15px_rgba(0,243,255,0.5)]'\n                        : 'bg-neutral-800 text-neutral-400 border border-neutral-700'\n                    }`}\n                  >\n                    <ChevronUp className=\"w-5 h-5\" />\n                  </div>\n                  {/* Arrow Row */}\n                  <div className=\"flex gap-1\">\n                    {[\n                      { key: 'ArrowLeft', icon: ChevronLeft },\n                      { key: 'ArrowDown', icon: ChevronDown },\n                      { key: 'ArrowRight', icon: ChevronRight },\n                    ].map(({ key, icon: Icon }) => (\n                      <div\n                        key={key}\n                        className={`w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-100 ${\n                          isKeyPressed(key)\n                            ? 'bg-[#00f3ff] text-black shadow-[0_0_15px_rgba(0,243,255,0.5)]'\n                            : 'bg-neutral-800 text-neutral-400 border border-neutral-700'\n                        }`}\n                      >\n                        <Icon className=\"w-5 h-5\" />\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"space-y-2 text-sm\">\n                <div className=\"flex items-center justify-between\">\n                  <span\n                    className={`px-2 py-1 rounded font-mono text-xs transition-all duration-100 ${\n                      isKeyPressed('Enter')\n                        ? 'bg-[#00f3ff] text-black'\n                        : 'bg-neutral-800 text-neutral-400'\n                    }`}\n                  >\n                    Enter\n                  </span>\n                  <span className=\"text-neutral-500\">Next point</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span\n                    className={`px-2 py-1 rounded font-mono text-xs transition-all duration-100 ${\n                      isKeyPressed('Backspace')\n                        ? 'bg-[#00f3ff] text-black'\n                        : 'bg-neutral-800 text-neutral-400'\n                    }`}\n                  >\n                    Backspace\n                  </span>\n                  <span className=\"text-neutral-500\">Previous</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span\n                    className={`px-2 py-1 rounded font-mono text-xs transition-all duration-100 ${\n                      isKeyPressed('r') || isKeyPressed('R')\n                        ? 'bg-[#00f3ff] text-black'\n                        : 'bg-neutral-800 text-neutral-400'\n                    }`}\n                  >\n                    R\n                  </span>\n                  <span className=\"text-neutral-500\">Reset zoom</span>\n                </div>\n              </div>\n            </div>\n\n            {/* Zoom Controls */}\n            <div className=\"bg-neutral-900 rounded-xl border border-neutral-800 p-4\">\n              <p className=\"text-xs text-neutral-500 font-medium uppercase tracking-wide mb-3\">\n                Zoom Level\n              </p>\n              <div className=\"flex gap-2\">\n                {/* FaceIQ parity: 2x/4x/8x discrete zoom levels */}\n                {[2, 4, 8].map((level) => (\n                  <button\n                    key={level}\n                    onClick={() => {\n                      if (containerSize) {\n                        // Adjust pan to keep the same center point visible when zoom changes\n                        // Current center in image space: imageCenter = (containerCenter - pan) / oldZoom\n                        // New pan to show same center: newPan = containerCenter - imageCenter * newZoom\n                        const containerCenterX = containerSize.width / 2;\n                        const containerCenterY = containerSize.height / 2;\n                        const imageCenterX = (containerCenterX - pan.x) / zoomLevel;\n                        const imageCenterY = (containerCenterY - pan.y) / zoomLevel;\n                        const newPanX = containerCenterX - imageCenterX * level;\n                        const newPanY = containerCenterY - imageCenterY * level;\n                        setZoomLevel(level);\n                        setPan({ x: newPanX, y: newPanY });\n                      } else {\n                        setZoomLevel(level);\n                      }\n                    }}\n                    className={`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${\n                      zoomLevel === level\n                        ? 'bg-[#00f3ff] text-black'\n                        : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n                    }`}\n                  >\n                    {level}x\n                  </button>\n                ))}\n              </div>\n            </div>\n\n            {/* Auto-Detect Button */}\n            <button\n              onClick={handleAutoDetect}\n              disabled={isDetecting}\n              className={`w-full py-3 rounded-lg text-sm font-medium transition-all flex items-center justify-center gap-2 ${\n                hasAutoDetected\n                  ? 'bg-green-500/20 text-green-400 border border-green-500/30'\n                  : 'bg-gradient-to-r from-[#00f3ff] to-[#00c4cc] text-black hover:shadow-[0_0_20px_rgba(0,243,255,0.3)]'\n              } disabled:opacity-50 disabled:cursor-not-allowed`}\n            >\n              {isDetecting ? (\n                <>\n                  <Loader2 className=\"w-4 h-4 animate-spin\" />\n                  Detecting...\n                </>\n              ) : hasAutoDetected ? (\n                <>\n                  <Check className=\"w-4 h-4\" />\n                  Detected - Adjust if needed\n                </>\n              ) : (\n                <>\n                  <Scan className=\"w-4 h-4\" />\n                  Auto-Detect Landmarks\n                </>\n              )}\n            </button>\n\n            {/* Auto-Zoom Toggle */}\n            <button\n              onClick={() => setAutoZoomEnabled(!autoZoomEnabled)}\n              className={`w-full py-2.5 rounded-lg text-xs font-medium transition-all flex items-center justify-center gap-2 ${\n                autoZoomEnabled\n                  ? 'bg-[#00f3ff] text-black'\n                  : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n              }`}\n            >\n              <Focus className=\"w-4 h-4\" />\n              {autoZoomEnabled ? 'Auto-Zoom: ON' : 'Auto-Zoom: OFF'}\n            </button>\n\n          </div>\n        </div>\n\n        {/* Main Image Area */}\n        <div className=\"flex-1 min-h-0 relative md:order-1 flex flex-col\">\n          <div\n            ref={containerRef}\n            className=\"relative flex-1 bg-neutral-900 overflow-hidden rounded-xl border border-neutral-800 select-none\"\n            onMouseDown={handleMouseDown}\n            onMouseMove={handleMouseMove}\n            onMouseUp={handleMouseUp}\n            onMouseLeave={handleMouseUp}\n            style={{\n              cursor: isDragging ? 'grabbing' : 'grab',\n            }}\n          >\n            {/* Transformed Content - Image and placed landmarks move together */}\n            <div\n              className=\"absolute inset-0\"\n              style={{\n                transform: `translate(${pan.x}px, ${pan.y}px) scale(${zoomLevel})`,\n                transformOrigin: '0 0',\n              }}\n            >\n              {/* User's Image */}\n              <Image\n                src={imageUrl}\n                alt=\"Your photo\"\n                fill\n                className=\"object-contain pointer-events-none select-none\"\n                unoptimized\n                draggable={false}\n              />\n\n              {/* Placed landmarks - always visible as they're placed */}\n              {landmarks.filter(lm => placedLandmarks.has(lm.id) && lm.id !== currentLandmarkId).map((landmark) => {\n                const lmColor = getLandmarkColor(landmark.id, categories);\n                const pos = getLandmarkPixelPosition(landmark.x, landmark.y);\n\n                return (\n                  <div\n                    key={landmark.id}\n                    className=\"absolute pointer-events-none\"\n                    style={{\n                      left: pos.left,\n                      top: pos.top,\n                      transform: `translate(-50%, -50%) scale(${1 / zoomLevel})`,\n                      transformOrigin: 'center center',\n                    }}\n                  >\n                    {/* Small persistent dot - matches Harmony style */}\n                    <div\n                      className=\"absolute rounded-full\"\n                      style={{\n                        width: 8,\n                        height: 8,\n                        left: -4,\n                        top: -4,\n                        backgroundColor: lmColor,\n                        boxShadow: `0 0 4px ${lmColor}, 0 0 8px ${lmColor}60`,\n                        border: '1px solid rgba(255,255,255,0.5)',\n                      }}\n                    />\n                  </div>\n                );\n              })}\n\n              {/* Frankfort Horizontal Plane - green reference line for side profiles */}\n              {mode === 'side' && frankfortPlane && (\n                <svg\n                  className=\"absolute inset-0 pointer-events-none\"\n                  style={{ width: '100%', height: '100%' }}\n                >\n                  {(() => {\n                    const bounds = getImageBounds();\n                    const orbitaleX = bounds.offsetX + frankfortPlane.orbitale.x * bounds.renderedWidth;\n                    const orbitaleY = bounds.offsetY + frankfortPlane.orbitale.y * bounds.renderedHeight;\n                    const porionX = bounds.offsetX + frankfortPlane.porion.x * bounds.renderedWidth;\n                    const porionY = bounds.offsetY + frankfortPlane.porion.y * bounds.renderedHeight;\n\n                    // Extend the line beyond the points for visibility\n                    const dx = porionX - orbitaleX;\n                    const dy = porionY - orbitaleY;\n                    const length = Math.sqrt(dx * dx + dy * dy);\n                    const extendFactor = length > 0 ? 0.3 : 0;\n                    const startX = orbitaleX - (dx / length) * bounds.renderedWidth * extendFactor;\n                    const startY = orbitaleY - (dy / length) * bounds.renderedWidth * extendFactor;\n                    const endX = porionX + (dx / length) * bounds.renderedWidth * extendFactor;\n                    const endY = porionY + (dy / length) * bounds.renderedWidth * extendFactor;\n\n                    return (\n                      <>\n                        {/* Main Frankfort line */}\n                        <line\n                          x1={startX}\n                          y1={startY}\n                          x2={endX}\n                          y2={endY}\n                          stroke=\"#22c55e\"\n                          strokeWidth={2 / zoomLevel}\n                          strokeDasharray={`${6 / zoomLevel} ${4 / zoomLevel}`}\n                          opacity={0.8}\n                        />\n                        {/* Orbitale point marker */}\n                        <circle\n                          cx={orbitaleX}\n                          cy={orbitaleY}\n                          r={4 / zoomLevel}\n                          fill=\"#22c55e\"\n                          stroke=\"white\"\n                          strokeWidth={1 / zoomLevel}\n                        />\n                        {/* Porion point marker */}\n                        <circle\n                          cx={porionX}\n                          cy={porionY}\n                          r={4 / zoomLevel}\n                          fill=\"#22c55e\"\n                          stroke=\"white\"\n                          strokeWidth={1 / zoomLevel}\n                        />\n                        {/* Angle indicator */}\n                        <text\n                          x={startX}\n                          y={startY - 10 / zoomLevel}\n                          fill=\"#22c55e\"\n                          fontSize={12 / zoomLevel}\n                          fontWeight=\"bold\"\n                        >\n                          FH: {frankfortPlane.angle.toFixed(1)}°\n                        </text>\n                      </>\n                    );\n                  })()}\n                </svg>\n              )}\n            </div>\n\n            {/* FIXED CENTER TARGETING DOT - small precise point for accurate placement */}\n            <div className=\"absolute inset-0 pointer-events-none flex items-center justify-center z-20\">\n              {/* Crosshair lines for precision */}\n              <div\n                className=\"absolute\"\n                style={{\n                  width: 20,\n                  height: 1,\n                  backgroundColor: '#00f3ff',\n                  opacity: 0.6,\n                }}\n              />\n              <div\n                className=\"absolute\"\n                style={{\n                  width: 1,\n                  height: 20,\n                  backgroundColor: '#00f3ff',\n                  opacity: 0.6,\n                }}\n              />\n              {/* Subtle glow ring */}\n              <div\n                className=\"absolute rounded-full\"\n                style={{\n                  width: 12,\n                  height: 12,\n                  background: 'radial-gradient(circle, #00f3ff33 0%, transparent 70%)',\n                }}\n              />\n              {/* Center dot - small and precise */}\n              <div\n                className=\"relative rounded-full\"\n                style={{\n                  width: 4,\n                  height: 4,\n                  backgroundColor: '#00f3ff',\n                  boxShadow: '0 0 6px #00f3ff, 0 0 12px #00f3ff80',\n                }}\n              />\n            </div>\n\n            {/* Loading Overlay */}\n            {isDetecting && (\n              <div className=\"absolute inset-0 bg-black/70 flex flex-col items-center justify-center z-50\">\n                <Loader2 className=\"w-12 h-12 text-[#00f3ff] animate-spin mb-4\" />\n                <p className=\"text-white text-lg font-medium\">Detecting landmarks...</p>\n                <p className=\"text-neutral-400 text-sm mt-2\">This may take a few seconds</p>\n              </div>\n            )}\n\n            {/* Detection Failed Banner */}\n            {detectionFailed && !isDetecting && (\n              <motion.div\n                initial={{ opacity: 0, y: -20 }}\n                animate={{ opacity: 1, y: 0 }}\n                className=\"absolute top-12 left-3 right-3 z-30\"\n              >\n                <div className=\"bg-amber-500/20 border border-amber-500/50 rounded-lg px-3 py-2 flex items-center gap-2\">\n                  <AlertTriangle className=\"w-4 h-4 text-amber-400 flex-shrink-0\" />\n                  <p className=\"text-amber-200 text-xs flex-1\">\n                    {mode === 'side'\n                      ? 'Auto-detection could not find profile. Please place landmarks manually for best accuracy.'\n                      : 'Could not detect face. Please place landmarks manually.'}\n                  </p>\n                  <button\n                    onClick={() => setDetectionFailed(false)}\n                    className=\"text-amber-400 hover:text-amber-200 transition-colors\"\n                  >\n                    <X className=\"w-4 h-4\" />\n                  </button>\n                </div>\n              </motion.div>\n            )}\n\n            {/* Zoom indicator */}\n            <div className=\"absolute top-3 left-3 px-3 py-1.5 rounded-lg bg-black/80 border border-neutral-700 text-white text-xs flex items-center gap-2\">\n              <Move className=\"w-3 h-3\" />\n              {zoomLevel.toFixed(1)}x - Drag to align\n            </div>\n\n            {/* Current landmark label overlay */}\n            <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black via-black/80 to-transparent p-4 pointer-events-none\">\n              <p className=\"text-center text-white text-sm font-medium\">\n                Drag image to align:{' '}\n                <span className=\"font-semibold\" style={{ color }}>{currentLandmark?.label}</span>\n              </p>\n              <p className=\"text-center text-neutral-400 text-xs mt-1\">\n                Press Enter or click Next to confirm\n              </p>\n            </div>\n          </div>\n\n          {/* Navigation Bar - Fixed at bottom of image area */}\n          <div className=\"mt-3 flex items-center justify-center gap-3\">\n            <button\n              onClick={handlePrevious}\n              className=\"p-2.5 rounded-xl bg-neutral-800 text-neutral-300 hover:bg-neutral-700 border border-neutral-700 transition-all\"\n            >\n              <ChevronLeft className=\"w-5 h-5\" />\n            </button>\n\n            {/* Step dots - show current position indicator */}\n            <div className=\"flex items-center gap-2 px-4 py-2 bg-neutral-900 rounded-xl border border-neutral-800\">\n              <span className=\"text-xs text-neutral-400 font-mono min-w-[4ch]\">\n                {currentStepIndex + 1}\n              </span>\n              <div className=\"w-32 h-1.5 bg-neutral-800 rounded-full overflow-hidden\">\n                <div\n                  className=\"h-full bg-[#00f3ff] rounded-full transition-all duration-200\"\n                  style={{ width: `${((currentStepIndex + 1) / totalSteps) * 100}%` }}\n                />\n              </div>\n              <span className=\"text-xs text-neutral-400 font-mono min-w-[4ch] text-right\">\n                {totalSteps}\n              </span>\n            </div>\n\n            <button\n              onClick={handleNext}\n              className={`flex items-center gap-2 px-5 py-2.5 rounded-xl font-medium text-sm transition-all ${\n                currentStepIndex === totalSteps - 1\n                  ? 'bg-green-500 text-white hover:bg-green-600'\n                  : 'bg-[#00f3ff] text-black hover:shadow-[0_0_20px_rgba(0,243,255,0.4)]'\n              }`}\n            >\n              {currentStepIndex === totalSteps - 1 ? (\n                <>\n                  <Check className=\"w-4 h-4\" />\n                  Complete\n                </>\n              ) : (\n                <>\n                  Next\n                  <ChevronRight className=\"w-4 h-4\" />\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","numLines":1033,"startLine":1,"totalLines":1033}}}
{"parentUuid":"1d1f86b7-92b2-43d9-8c19-dbced397c109","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0176687F7qSyMRiWgD6qNwAB","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useState, useRef, useCallback, useEffect } from 'react';\n     4→import Image from 'next/image';\n     5→import { motion, AnimatePresence } from 'framer-motion';\n     6→import { RotateCcw, ChevronLeft, ChevronRight, Wand2, Loader2, ZoomIn, ZoomOut } from 'lucide-react';\n     7→import {\n     8→  LandmarkPoint,\n     9→  SIDE_PROFILE_LANDMARKS,\n    10→  SIDE_LANDMARK_CATEGORIES,\n    11→  getLandmarkColor,\n    12→} from '@/lib/landmarks';\n    13→import { useFaceApi, FACE_API_LANDMARK_MAPPING } from '@/hooks/useFaceApi';\n    14→\n    15→// Re-export types for backwards compatibility\n    16→export type { LandmarkPoint } from '@/lib/landmarks';\n    17→\n    18→interface SideProfileManualToolProps {\n    19→  imageUrl: string;\n    20→  onLandmarksChange?: (landmarks: LandmarkPoint[]) => void;\n    21→  onComplete?: (landmarks: LandmarkPoint[]) => void;\n    22→}\n    23→\n    24→export function SideProfileManualTool({\n    25→  imageUrl,\n    26→  onLandmarksChange,\n    27→  onComplete,\n    28→}: SideProfileManualToolProps) {\n    29→  const containerRef = useRef<HTMLDivElement>(null);\n    30→  const imageRef = useRef<HTMLImageElement>(null);\n    31→  const [landmarks, setLandmarks] = useState<LandmarkPoint[]>(SIDE_PROFILE_LANDMARKS);\n    32→  const [activeLandmark, setActiveLandmark] = useState<string | null>(null);\n    33→  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\n    34→  const [currentStepIndex, setCurrentStepIndex] = useState(0);\n    35→  const [isGuided, setIsGuided] = useState(true);\n    36→  const [zoomLevel, setZoomLevel] = useState<1 | 2 | 3>(1); // 1=2x, 2=4x, 3=8x (FaceIQ parity)\n    37→  const zoom = zoomLevel === 1 ? 2 : zoomLevel === 2 ? 4 : 8;\n    38→  const [isDetecting, setIsDetecting] = useState(false);\n    39→  const [detectionError, setDetectionError] = useState<string | null>(null);\n    40→\n    41→  // Face API hook for auto-detection\n    42→  const { isLoading: faceApiLoading, isReady: faceApiReady, error: faceApiError, detect } = useFaceApi();\n    43→\n    44→  useEffect(() => {\n    45→    onLandmarksChange?.(landmarks);\n    46→  }, [landmarks, onLandmarksChange]);\n    47→\n    48→  // Auto-detect landmarks using face-api.js\n    49→  const handleAutoDetect = useCallback(async () => {\n    50→    if (!faceApiReady || !imageRef.current) {\n    51→      setDetectionError('Face detection not ready. Please wait...');\n    52→      return;\n    53→    }\n    54→\n    55→    setIsDetecting(true);\n    56→    setDetectionError(null);\n    57→\n    58→    try {\n    59→      const result = await detect(imageRef.current);\n    60→\n    61→      if (!result) {\n    62→        setDetectionError('No face detected. Please ensure your side profile is clearly visible.');\n    63→        setIsDetecting(false);\n    64→        return;\n    65→      }\n    66→\n    67→      // Get image dimensions\n    68→      const imgWidth = imageRef.current.naturalWidth;\n    69→      const imgHeight = imageRef.current.naturalHeight;\n    70→\n    71→      // Map face-api.js 68-point landmarks to our side profile landmarks\n    72→      const detectedLandmarks = result.landmarks;\n    73→\n    74→      setLandmarks((prev) =>\n    75→        prev.map((lm) => {\n    76→          // Map our landmark IDs to face-api indices\n    77→          let detectedPoint = null;\n    78→\n    79→          // cephalometric landmark IDs: vertex, occiput, pronasale, neckPoint, porion, orbitale,\n    80→          // tragus, intertragicNotch, cornealApex, cheekbone, trichion, glabella, nasion,\n    81→          // rhinion, supratip, infratip, columella, subnasale, subalare, labraleSuperius,\n    82→          // cheilion, labraleInferius, sublabiale, pogonion, menton, cervicalPoint, gonionTop, gonionBottom\n    83→          switch (lm.id) {\n    84→            // Chin/Jaw landmarks\n    85→            case 'menton':\n    86→              detectedPoint = detectedLandmarks[FACE_API_LANDMARK_MAPPING.MENTON];\n    87→              break;\n    88→            case 'pogonion':\n    89→              detectedPoint = detectedLandmarks[FACE_API_LANDMARK_MAPPING.MENTON];\n    90→              break;\n    91→            case 'gonionBottom':\n    92→              detectedPoint = detectedLandmarks[4]; // Jaw contour point\n    93→              break;\n    94→            case 'gonionTop':\n    95→              detectedPoint = detectedLandmarks[3]; // Higher jaw point\n    96→              break;\n    97→\n    98→            // Nose landmarks\n    99→            case 'nasion':\n   100→              detectedPoint = detectedLandmarks[FACE_API_LANDMARK_MAPPING.NASION];\n   101→              break;\n   102→            case 'pronasale':\n   103→              detectedPoint = detectedLandmarks[FACE_API_LANDMARK_MAPPING.PRONASALE];\n   104→              break;\n   105→            case 'rhinion':\n   106→              detectedPoint = detectedLandmarks[28]; // Mid nose bridge\n   107→              break;\n   108→            case 'subnasale':\n   109→              detectedPoint = detectedLandmarks[33]; // Nose bottom center\n   110→              break;\n   111→            case 'columella':\n   112→              detectedPoint = detectedLandmarks[33];\n   113→              break;\n   114→\n   115→            // Lip landmarks\n   116→            case 'labraleSuperius':\n   117→              detectedPoint = detectedLandmarks[FACE_API_LANDMARK_MAPPING.UPPER_LIP_TOP];\n   118→              break;\n   119→            case 'labraleInferius':\n   120→              detectedPoint = detectedLandmarks[FACE_API_LANDMARK_MAPPING.LOWER_LIP_BOTTOM];\n   121→              break;\n   122→            case 'cheilion':\n   123→              detectedPoint = detectedLandmarks[FACE_API_LANDMARK_MAPPING.LEFT_MOUTH_CORNER];\n   124→              break;\n   125→            case 'sublabiale':\n   126→              // Approximate from lower lip and chin\n   127→              const lowerLip = detectedLandmarks[57];\n   128→              const chin = detectedLandmarks[8];\n   129→              if (lowerLip && chin) {\n   130→                detectedPoint = {\n   131→                  x: (lowerLip.x + chin.x) / 2,\n   132→                  y: lowerLip.y + (chin.y - lowerLip.y) * 0.3,\n   133→                };\n   134→              }\n   135→              break;\n   136→\n   137→            // Eye region\n   138→            case 'cornealApex':\n   139→              detectedPoint = detectedLandmarks[FACE_API_LANDMARK_MAPPING.LEFT_EYE_OUTER];\n   140→              break;\n   141→            case 'orbitale':\n   142→              detectedPoint = detectedLandmarks[41]; // Lower eye socket\n   143→              break;\n   144→\n   145→            // Forehead\n   146→            case 'glabella':\n   147→              // Approximate from brow points\n   148→              const leftBrow = detectedLandmarks[21];\n   149→              const rightBrow = detectedLandmarks[22];\n   150→              if (leftBrow && rightBrow) {\n   151→                detectedPoint = {\n   152→                  x: (leftBrow.x + rightBrow.x) / 2,\n   153→                  y: (leftBrow.y + rightBrow.y) / 2,\n   154→                };\n   155→              }\n   156→              break;\n   157→\n   158→            // Ear landmarks (use jaw contour as proxy)\n   159→            case 'tragus':\n   160→              detectedPoint = detectedLandmarks[1]; // Upper jaw near ear\n   161→              break;\n   162→            case 'porion':\n   163→              detectedPoint = detectedLandmarks[0]; // Near ear\n   164→              break;\n   165→\n   166→            default:\n   167→              break;\n   168→          }\n   169→\n   170→          if (detectedPoint) {\n   171→            return {\n   172→              ...lm,\n   173→              x: detectedPoint.x / imgWidth,\n   174→              y: detectedPoint.y / imgHeight,\n   175→            };\n   176→          }\n   177→\n   178→          return lm;\n   179→        })\n   180→      );\n   181→\n   182→      setIsDetecting(false);\n   183→    } catch (err) {\n   184→      setDetectionError(err instanceof Error ? err.message : 'Detection failed');\n   185→      setIsDetecting(false);\n   186→    }\n   187→  }, [faceApiReady, detect]);\n   188→\n   189→  // Zoom controls - FaceIQ parity: 2x, 4x, 8x discrete levels\n   190→  const handleZoomIn = () => {\n   191→    if (zoomLevel >= 3) return;\n   192→    setZoomLevel((prev) => (prev + 1) as 2 | 3);\n   193→  };\n   194→  const handleZoomOut = () => {\n   195→    if (zoomLevel <= 1) return;\n   196→    setZoomLevel((prev) => (prev - 1) as 1 | 2);\n   197→  };\n   198→  const handleSetZoomLevel = (level: 1 | 2 | 3) => {\n   199→    setZoomLevel(level);\n   200→  };\n   201→\n   202→  const handleMouseDown = useCallback((id: string) => {\n   203→    setActiveLandmark(id);\n   204→  }, []);\n   205→\n   206→  const handleMouseMove = useCallback(\n   207→    (e: React.MouseEvent<HTMLDivElement>) => {\n   208→      if (!activeLandmark || !containerRef.current) return;\n   209→\n   210→      const rect = containerRef.current.getBoundingClientRect();\n   211→      const x = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));\n   212→      const y = Math.max(0, Math.min(1, (e.clientY - rect.top) / rect.height));\n   213→\n   214→      setLandmarks((prev) =>\n   215→        prev.map((lm) => (lm.id === activeLandmark ? { ...lm, x, y } : lm))\n   216→      );\n   217→    },\n   218→    [activeLandmark]\n   219→  );\n   220→\n   221→  const handleMouseUp = useCallback(() => {\n   222→    setActiveLandmark(null);\n   223→  }, []);\n   224→\n   225→  const handleTouchStart = useCallback((id: string) => {\n   226→    setActiveLandmark(id);\n   227→  }, []);\n   228→\n   229→  const handleTouchMove = useCallback(\n   230→    (e: React.TouchEvent<HTMLDivElement>) => {\n   231→      if (!activeLandmark || !containerRef.current) return;\n   232→\n   233→      const touch = e.touches[0];\n   234→      const rect = containerRef.current.getBoundingClientRect();\n   235→      const x = Math.max(0, Math.min(1, (touch.clientX - rect.left) / rect.width));\n   236→      const y = Math.max(0, Math.min(1, (touch.clientY - rect.top) / rect.height));\n   237→\n   238→      setLandmarks((prev) =>\n   239→        prev.map((lm) => (lm.id === activeLandmark ? { ...lm, x, y } : lm))\n   240→      );\n   241→    },\n   242→    [activeLandmark]\n   243→  );\n   244→\n   245→  const handleTouchEnd = useCallback(() => {\n   246→    setActiveLandmark(null);\n   247→  }, []);\n   248→\n   249→  const handleComplete = () => {\n   250→    onComplete?.(landmarks);\n   251→  };\n   252→\n   253→  const resetLandmarks = () => {\n   254→    setLandmarks(SIDE_PROFILE_LANDMARKS);\n   255→  };\n   256→\n   257→  // Guided mode - step through categories\n   258→  const currentCategory = isGuided ? SIDE_LANDMARK_CATEGORIES[currentStepIndex] : null;\n   259→\n   260→  const filteredLandmarks = selectedCategory\n   261→    ? landmarks.filter((lm) => lm.category === selectedCategory)\n   262→    : isGuided && currentCategory\n   263→      ? landmarks.filter((lm) => lm.category === currentCategory.name)\n   264→      : landmarks;\n   265→\n   266→  const visibleLandmarkIds = isGuided && currentCategory\n   267→    ? new Set(currentCategory.landmarks)\n   268→    : selectedCategory\n   269→      ? new Set(filteredLandmarks.map((lm) => lm.id))\n   270→      : new Set(landmarks.map((lm) => lm.id));\n   271→\n   272→  const nextStep = () => {\n   273→    if (currentStepIndex < SIDE_LANDMARK_CATEGORIES.length - 1) {\n   274→      setCurrentStepIndex(currentStepIndex + 1);\n   275→    }\n   276→  };\n   277→\n   278→  const prevStep = () => {\n   279→    if (currentStepIndex > 0) {\n   280→      setCurrentStepIndex(currentStepIndex - 1);\n   281→    }\n   282→  };\n   283→\n   284→  return (\n   285→    <div className=\"w-full max-w-4xl mx-auto\">\n   286→      {/* Header */}\n   287→      <motion.div\n   288→        initial={{ opacity: 0, y: -10 }}\n   289→        animate={{ opacity: 1, y: 0 }}\n   290→        className=\"mb-6 text-center\"\n   291→      >\n   292→        <h2 className=\"text-xl font-semibold text-white mb-2\">\n   293→          Side Profile Manual Adjustment\n   294→        </h2>\n   295→        <p className=\"text-neutral-400\">\n   296→          Drag each marker to match the facial landmarks on your profile photo\n   297→        </p>\n   298→      </motion.div>\n   299→\n   300→      {/* Mode Toggle and Controls */}\n   301→      <motion.div\n   302→        initial={{ opacity: 0, y: 10 }}\n   303→        animate={{ opacity: 1, y: 0 }}\n   304→        className=\"mb-4 flex flex-wrap justify-center gap-2\"\n   305→      >\n   306→        {/* Auto-Detect Button */}\n   307→        <button\n   308→          onClick={handleAutoDetect}\n   309→          disabled={!faceApiReady || isDetecting}\n   310→          className={`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${\n   311→            faceApiReady && !isDetecting\n   312→              ? 'bg-green-500/20 text-green-400 hover:bg-green-500/30 border border-green-500/30'\n   313→              : 'bg-neutral-800 text-neutral-500 cursor-not-allowed'\n   314→          }`}\n   315→        >\n   316→          {isDetecting ? (\n   317→            <Loader2 className=\"w-4 h-4 animate-spin\" />\n   318→          ) : faceApiLoading ? (\n   319→            <Loader2 className=\"w-4 h-4 animate-spin\" />\n   320→          ) : (\n   321→            <Wand2 className=\"w-4 h-4\" />\n   322→          )}\n   323→          {isDetecting ? 'Detecting...' : faceApiLoading ? 'Loading AI...' : 'Auto-Detect'}\n   324→        </button>\n   325→\n   326→        <div className=\"w-px h-8 bg-neutral-800\" />\n   327→\n   328→        <button\n   329→          onClick={() => {\n   330→            setIsGuided(true);\n   331→            setSelectedCategory(null);\n   332→          }}\n   333→          className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${\n   334→            isGuided\n   335→              ? 'bg-[#00f3ff] text-black'\n   336→              : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n   337→          }`}\n   338→        >\n   339→          Guided Mode\n   340→        </button>\n   341→        <button\n   342→          onClick={() => {\n   343→            setIsGuided(false);\n   344→            setSelectedCategory(null);\n   345→          }}\n   346→          className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${\n   347→            !isGuided\n   348→              ? 'bg-[#00f3ff] text-black'\n   349→              : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n   350→          }`}\n   351→        >\n   352→          Free Edit\n   353→        </button>\n   354→\n   355→        <div className=\"w-px h-8 bg-neutral-800\" />\n   356→\n   357→        {/* Zoom Controls - FaceIQ parity: 2x, 4x, 8x */}\n   358→        <div className=\"flex items-center gap-1\">\n   359→          <button\n   360→            onClick={handleZoomOut}\n   361→            disabled={zoomLevel <= 1}\n   362→            className=\"p-2 rounded-lg bg-neutral-800 text-neutral-400 hover:bg-neutral-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\n   363→          >\n   364→            <ZoomOut className=\"w-4 h-4\" />\n   365→          </button>\n   366→          <div className=\"flex gap-1\">\n   367→            {([1, 2, 3] as const).map((level) => (\n   368→              <button\n   369→                key={level}\n   370→                onClick={() => handleSetZoomLevel(level)}\n   371→                className={`px-2 py-1 rounded text-xs font-mono transition-colors ${\n   372→                  zoomLevel === level\n   373→                    ? 'bg-[#00f3ff] text-black'\n   374→                    : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n   375→                }`}\n   376→              >\n   377→                {level === 1 ? '2x' : level === 2 ? '4x' : '8x'}\n   378→              </button>\n   379→            ))}\n   380→          </div>\n   381→          <button\n   382→            onClick={handleZoomIn}\n   383→            disabled={zoomLevel >= 3}\n   384→            className=\"p-2 rounded-lg bg-neutral-800 text-neutral-400 hover:bg-neutral-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\n   385→          >\n   386→            <ZoomIn className=\"w-4 h-4\" />\n   387→          </button>\n   388→        </div>\n   389→\n   390→        <div className=\"w-px h-8 bg-neutral-800\" />\n   391→\n   392→        <button\n   393→          onClick={resetLandmarks}\n   394→          className=\"px-4 py-2 rounded-lg text-sm font-medium bg-neutral-800 text-neutral-400 hover:bg-neutral-700 transition-all flex items-center gap-2\"\n   395→        >\n   396→          <RotateCcw className=\"w-4 h-4\" />\n   397→          Reset\n   398→        </button>\n   399→      </motion.div>\n   400→\n   401→      {/* Detection Error/Status */}\n   402→      <AnimatePresence>\n   403→        {(detectionError || faceApiError) && (\n   404→          <motion.div\n   405→            initial={{ opacity: 0, y: -10 }}\n   406→            animate={{ opacity: 1, y: 0 }}\n   407→            exit={{ opacity: 0, y: -10 }}\n   408→            className=\"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/30 text-red-400 text-sm text-center\"\n   409→          >\n   410→            {detectionError || faceApiError?.message}\n   411→          </motion.div>\n   412→        )}\n   413→      </AnimatePresence>\n   414→\n   415→      {/* Guided Mode Step Indicator */}\n   416→      {isGuided && currentCategory && (\n   417→        <motion.div\n   418→          key={currentStepIndex}\n   419→          initial={{ opacity: 0, x: 20 }}\n   420→          animate={{ opacity: 1, x: 0 }}\n   421→          className=\"mb-4\"\n   422→        >\n   423→          <div className=\"flex items-center justify-between mb-2\">\n   424→            <button\n   425→              onClick={prevStep}\n   426→              disabled={currentStepIndex === 0}\n   427→              className={`p-2 rounded-lg transition-all ${\n   428→                currentStepIndex === 0\n   429→                  ? 'text-neutral-700 cursor-not-allowed'\n   430→                  : 'text-neutral-400 hover:text-white hover:bg-neutral-800'\n   431→              }`}\n   432→            >\n   433→              <ChevronLeft className=\"w-5 h-5\" />\n   434→            </button>\n   435→\n   436→            <div className=\"text-center\">\n   437→              <div className=\"flex items-center justify-center gap-2 mb-1\">\n   438→                <span\n   439→                  className=\"w-3 h-3 rounded-full\"\n   440→                  style={{ backgroundColor: currentCategory.color }}\n   441→                />\n   442→                <span className=\"text-white font-medium\">{currentCategory.name}</span>\n   443→              </div>\n   444→              <span className=\"text-xs text-neutral-400\">\n   445→                Step {currentStepIndex + 1} of {SIDE_LANDMARK_CATEGORIES.length} •{' '}\n   446→                {currentCategory.landmarks.length} points\n   447→              </span>\n   448→            </div>\n   449→\n   450→            <button\n   451→              onClick={nextStep}\n   452→              disabled={currentStepIndex === SIDE_LANDMARK_CATEGORIES.length - 1}\n   453→              className={`p-2 rounded-lg transition-all ${\n   454→                currentStepIndex === SIDE_LANDMARK_CATEGORIES.length - 1\n   455→                  ? 'text-neutral-700 cursor-not-allowed'\n   456→                  : 'text-neutral-400 hover:text-white hover:bg-neutral-800'\n   457→              }`}\n   458→            >\n   459→              <ChevronRight className=\"w-5 h-5\" />\n   460→            </button>\n   461→          </div>\n   462→\n   463→          {/* Progress bar */}\n   464→          <div className=\"w-full h-1 bg-neutral-800 rounded-full overflow-hidden\">\n   465→            <motion.div\n   466→              className=\"h-full rounded-full\"\n   467→              style={{ backgroundColor: currentCategory.color }}\n   468→              initial={{ width: 0 }}\n   469→              animate={{\n   470→                width: `${((currentStepIndex + 1) / SIDE_LANDMARK_CATEGORIES.length) * 100}%`,\n   471→              }}\n   472→              transition={{ duration: 0.3 }}\n   473→            />\n   474→          </div>\n   475→        </motion.div>\n   476→      )}\n   477→\n   478→      {/* Category Filter (Free Edit Mode) */}\n   479→      {!isGuided && (\n   480→        <motion.div\n   481→          initial={{ opacity: 0, y: 10 }}\n   482→          animate={{ opacity: 1, y: 0 }}\n   483→          className=\"mb-4 flex flex-wrap gap-2 justify-center\"\n   484→        >\n   485→          <button\n   486→            onClick={() => setSelectedCategory(null)}\n   487→            className={`px-3 py-1.5 rounded-full text-xs font-medium transition-all ${\n   488→              selectedCategory === null\n   489→                ? 'bg-[#00f3ff] text-black'\n   490→                : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n   491→            }`}\n   492→          >\n   493→            All ({landmarks.length})\n   494→          </button>\n   495→          {SIDE_LANDMARK_CATEGORIES.map((category) => (\n   496→            <button\n   497→              key={category.name}\n   498→              onClick={() =>\n   499→                setSelectedCategory(\n   500→                  selectedCategory === category.name ? null : category.name\n   501→                )\n   502→              }\n   503→              className={`px-3 py-1.5 rounded-full text-xs font-medium transition-all flex items-center gap-1.5 ${\n   504→                selectedCategory === category.name\n   505→                  ? 'bg-[#00f3ff] text-black'\n   506→                  : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n   507→              }`}\n   508→            >\n   509→              <span\n   510→                className=\"w-2 h-2 rounded-full\"\n   511→                style={{ backgroundColor: category.color }}\n   512→              />\n   513→              {category.name}\n   514→            </button>\n   515→          ))}\n   516→        </motion.div>\n   517→      )}\n   518→\n   519→      {/* Image Container with Landmarks */}\n   520→      <motion.div\n   521→        initial={{ opacity: 0, scale: 0.98 }}\n   522→        animate={{ opacity: 1, scale: 1 }}\n   523→        className=\"relative\"\n   524→      >\n   525→        <div\n   526→          ref={containerRef}\n   527→          className=\"relative w-full aspect-[3/4] rounded-2xl overflow-hidden bg-neutral-900 border border-neutral-800 select-none\"\n   528→          onMouseMove={handleMouseMove}\n   529→          onMouseUp={handleMouseUp}\n   530→          onMouseLeave={handleMouseUp}\n   531→          onTouchMove={handleTouchMove}\n   532→          onTouchEnd={handleTouchEnd}\n   533→        >\n   534→          {/* User's uploaded image with zoom */}\n   535→          <div\n   536→            style={{\n   537→              transform: `scale(${zoom})`,\n   538→              transformOrigin: 'center center',\n   539→            }}\n   540→            className=\"absolute inset-0 transition-transform duration-200\"\n   541→          >\n   542→            <Image\n   543→              ref={imageRef as React.RefObject<HTMLImageElement>}\n   544→              src={imageUrl}\n   545→              alt=\"Side profile\"\n   546→              fill\n   547→              className=\"object-contain pointer-events-none\"\n   548→              unoptimized\n   549→              draggable={false}\n   550→              onLoadingComplete={(img) => {\n   551→                // Store reference for face detection\n   552→                if (imageRef.current !== img) {\n   553→                  (imageRef as React.MutableRefObject<HTMLImageElement>).current = img;\n   554→                }\n   555→              }}\n   556→            />\n   557→          </div>\n   558→\n   559→          {/* Connection lines between sequential landmarks in category */}\n   560→          {isGuided && currentCategory && (\n   561→            <svg\n   562→              className=\"absolute inset-0 w-full h-full pointer-events-none\"\n   563→              viewBox=\"0 0 100 100\"\n   564→              preserveAspectRatio=\"none\"\n   565→            >\n   566→              {currentCategory.landmarks.map((landmarkId, index) => {\n   567→                if (index === currentCategory.landmarks.length - 1) return null;\n   568→                const current = landmarks.find((lm) => lm.id === landmarkId);\n   569→                const next = landmarks.find(\n   570→                  (lm) => lm.id === currentCategory.landmarks[index + 1]\n   571→                );\n   572→                if (!current || !next) return null;\n   573→\n   574→                return (\n   575→                  <line\n   576→                    key={`line-${landmarkId}`}\n   577→                    x1={current.x * 100}\n   578→                    y1={current.y * 100}\n   579→                    x2={next.x * 100}\n   580→                    y2={next.y * 100}\n   581→                    stroke={`${currentCategory.color}66`}\n   582→                    strokeWidth=\"0.3\"\n   583→                    strokeDasharray=\"1,1\"\n   584→                  />\n   585→                );\n   586→              })}\n   587→            </svg>\n   588→          )}\n   589→\n   590→          {/* Landmark Points */}\n   591→          {landmarks.map((landmark) => {\n   592→            const isVisible = visibleLandmarkIds.has(landmark.id);\n   593→            const color = getLandmarkColor(landmark.id, SIDE_LANDMARK_CATEGORIES);\n   594→\n   595→            return (\n   596→              <div\n   597→                key={landmark.id}\n   598→                className={`\n   599→                  absolute w-5 h-5 -translate-x-1/2 -translate-y-1/2 cursor-grab\n   600→                  transition-all duration-200\n   601→                  ${activeLandmark === landmark.id ? 'cursor-grabbing z-30' : 'z-10'}\n   602→                  ${isVisible ? 'opacity-100 scale-100' : 'opacity-10 scale-75 pointer-events-none'}\n   603→                `}\n   604→                style={{\n   605→                  left: `${landmark.x * 100}%`,\n   606→                  top: `${landmark.y * 100}%`,\n   607→                }}\n   608→                onMouseDown={() => isVisible && handleMouseDown(landmark.id)}\n   609→                onTouchStart={() => isVisible && handleTouchStart(landmark.id)}\n   610→              >\n   611→                {/* Outer glow ring */}\n   612→                <div\n   613→                  className={`\n   614→                    absolute inset-0 rounded-full\n   615→                    transition-all duration-200\n   616→                    ${activeLandmark === landmark.id ? 'scale-150' : ''}\n   617→                  `}\n   618→                  style={{\n   619→                    backgroundColor: `${color}33`,\n   620→                    boxShadow:\n   621→                      activeLandmark === landmark.id\n   622→                        ? `0 0 25px ${color}`\n   623→                        : `0 0 10px ${color}`,\n   624→                  }}\n   625→                />\n   626→\n   627→                {/* Main handle */}\n   628→                <div\n   629→                  className={`\n   630→                    absolute inset-1 rounded-full border-2 border-white\n   631→                    transition-all duration-200\n   632→                    ${activeLandmark === landmark.id ? 'scale-125' : ''}\n   633→                  `}\n   634→                  style={{\n   635→                    backgroundColor: color,\n   636→                    boxShadow: `0 0 10px ${color}, 0 0 20px ${color}`,\n   637→                  }}\n   638→                />\n   639→\n   640→                {/* Label tooltip */}\n   641→                <div\n   642→                  className={`\n   643→                    absolute left-6 top-1/2 -translate-y-1/2 whitespace-nowrap\n   644→                    px-2 py-1 rounded bg-black/95 border\n   645→                    text-xs font-medium z-50\n   646→                    pointer-events-none transition-opacity duration-200\n   647→                    ${activeLandmark === landmark.id ? 'opacity-100' : 'opacity-0'}\n   648→                  `}\n   649→                  style={{\n   650→                    borderColor: `${color}80`,\n   651→                    color: color,\n   652→                  }}\n   653→                >\n   654→                  <div>{landmark.label}</div>\n   655→                  <div className=\"text-[10px] opacity-70\">{landmark.medicalTerm}</div>\n   656→                </div>\n   657→              </div>\n   658→            );\n   659→          })}\n   660→        </div>\n   661→      </motion.div>\n   662→\n   663→      {/* Landmark Legend for Current Category */}\n   664→      <motion.div\n   665→        initial={{ opacity: 0, y: 10 }}\n   666→        animate={{ opacity: 1, y: 0 }}\n   667→        transition={{ delay: 0.2 }}\n   668→        className=\"mt-6 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2\"\n   669→      >\n   670→        {filteredLandmarks.map((landmark) => {\n   671→          const color = getLandmarkColor(landmark.id, SIDE_LANDMARK_CATEGORIES);\n   672→          return (\n   673→            <div\n   674→              key={landmark.id}\n   675→              className={`\n   676→                flex items-center gap-2 px-3 py-2 rounded-lg\n   677→                border transition-all duration-200 cursor-pointer\n   678→                ${\n   679→                  activeLandmark === landmark.id\n   680→                    ? 'border-neutral-600 bg-neutral-800'\n   681→                    : 'border-neutral-800 bg-black hover:bg-neutral-900'\n   682→                }\n   683→              `}\n   684→              onMouseEnter={() => setActiveLandmark(landmark.id)}\n   685→              onMouseLeave={() => setActiveLandmark(null)}\n   686→            >\n   687→              <div\n   688→                className=\"w-3 h-3 rounded-full flex-shrink-0\"\n   689→                style={{\n   690→                  backgroundColor: color,\n   691→                }}\n   692→              />\n   693→              <div className=\"min-w-0\">\n   694→                <p className=\"text-sm font-medium text-white truncate\">\n   695→                  {landmark.label}\n   696→                </p>\n   697→                <p className=\"text-xs text-neutral-500 truncate\">\n   698→                  {landmark.description}\n   699→                </p>\n   700→              </div>\n   701→            </div>\n   702→          );\n   703→        })}\n   704→      </motion.div>\n   705→\n   706→      {/* Navigation/Complete Buttons */}\n   707→      <motion.div\n   708→        initial={{ opacity: 0, y: 10 }}\n   709→        animate={{ opacity: 1, y: 0 }}\n   710→        transition={{ delay: 0.3 }}\n   711→        className=\"mt-8 flex justify-center gap-4\"\n   712→      >\n   713→        {isGuided && currentStepIndex < SIDE_LANDMARK_CATEGORIES.length - 1 ? (\n   714→          <button\n   715→            onClick={nextStep}\n   716→            className=\"\n   717→              px-8 py-4 rounded-xl font-semibold text-lg\n   718→              bg-[#00f3ff] text-black\n   719→              hover:shadow-[0_0_20px_rgba(0,243,255,0.3)]\n   720→              transition-all duration-300\n   721→            \"\n   722→          >\n   723→            Next: {SIDE_LANDMARK_CATEGORIES[currentStepIndex + 1]?.name}\n   724→          </button>\n   725→        ) : (\n   726→          <button\n   727→            onClick={handleComplete}\n   728→            className=\"\n   729→              px-8 py-4 rounded-xl font-semibold text-lg\n   730→              bg-[#00f3ff] text-black\n   731→              hover:shadow-[0_0_20px_rgba(0,243,255,0.3)]\n   732→              transition-all duration-300\n   733→            \"\n   734→          >\n   735→            Confirm Side Landmarks\n   736→          </button>\n   737→        )}\n   738→      </motion.div>\n   739→\n   740→      {/* Total Progress */}\n   741→      <motion.div\n   742→        initial={{ opacity: 0 }}\n   743→        animate={{ opacity: 1 }}\n   744→        transition={{ delay: 0.4 }}\n   745→        className=\"mt-4 text-center text-sm text-neutral-500\"\n   746→      >\n   747→        {landmarks.length} landmarks • Drag markers to adjust positions\n   748→      </motion.div>\n   749→    </div>\n   750→  );\n   751→}\n   752→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"cf9b7309-6678-415d-9893-021b85874210","timestamp":"2025-12-27T03:19:49.527Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/SideProfileManualTool.tsx","content":"'use client';\n\nimport { useState, useRef, useCallback, useEffect } from 'react';\nimport Image from 'next/image';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { RotateCcw, ChevronLeft, ChevronRight, Wand2, Loader2, ZoomIn, ZoomOut } from 'lucide-react';\nimport {\n  LandmarkPoint,\n  SIDE_PROFILE_LANDMARKS,\n  SIDE_LANDMARK_CATEGORIES,\n  getLandmarkColor,\n} from '@/lib/landmarks';\nimport { useFaceApi, FACE_API_LANDMARK_MAPPING } from '@/hooks/useFaceApi';\n\n// Re-export types for backwards compatibility\nexport type { LandmarkPoint } from '@/lib/landmarks';\n\ninterface SideProfileManualToolProps {\n  imageUrl: string;\n  onLandmarksChange?: (landmarks: LandmarkPoint[]) => void;\n  onComplete?: (landmarks: LandmarkPoint[]) => void;\n}\n\nexport function SideProfileManualTool({\n  imageUrl,\n  onLandmarksChange,\n  onComplete,\n}: SideProfileManualToolProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const imageRef = useRef<HTMLImageElement>(null);\n  const [landmarks, setLandmarks] = useState<LandmarkPoint[]>(SIDE_PROFILE_LANDMARKS);\n  const [activeLandmark, setActiveLandmark] = useState<string | null>(null);\n  const [selectedCategory, setSelectedCategory] = useState<string | null>(null);\n  const [currentStepIndex, setCurrentStepIndex] = useState(0);\n  const [isGuided, setIsGuided] = useState(true);\n  const [zoomLevel, setZoomLevel] = useState<1 | 2 | 3>(1); // 1=2x, 2=4x, 3=8x (FaceIQ parity)\n  const zoom = zoomLevel === 1 ? 2 : zoomLevel === 2 ? 4 : 8;\n  const [isDetecting, setIsDetecting] = useState(false);\n  const [detectionError, setDetectionError] = useState<string | null>(null);\n\n  // Face API hook for auto-detection\n  const { isLoading: faceApiLoading, isReady: faceApiReady, error: faceApiError, detect } = useFaceApi();\n\n  useEffect(() => {\n    onLandmarksChange?.(landmarks);\n  }, [landmarks, onLandmarksChange]);\n\n  // Auto-detect landmarks using face-api.js\n  const handleAutoDetect = useCallback(async () => {\n    if (!faceApiReady || !imageRef.current) {\n      setDetectionError('Face detection not ready. Please wait...');\n      return;\n    }\n\n    setIsDetecting(true);\n    setDetectionError(null);\n\n    try {\n      const result = await detect(imageRef.current);\n\n      if (!result) {\n        setDetectionError('No face detected. Please ensure your side profile is clearly visible.');\n        setIsDetecting(false);\n        return;\n      }\n\n      // Get image dimensions\n      const imgWidth = imageRef.current.naturalWidth;\n      const imgHeight = imageRef.current.naturalHeight;\n\n      // Map face-api.js 68-point landmarks to our side profile landmarks\n      const detectedLandmarks = result.landmarks;\n\n      setLandmarks((prev) =>\n        prev.map((lm) => {\n          // Map our landmark IDs to face-api indices\n          let detectedPoint = null;\n\n          // cephalometric landmark IDs: vertex, occiput, pronasale, neckPoint, porion, orbitale,\n          // tragus, intertragicNotch, cornealApex, cheekbone, trichion, glabella, nasion,\n          // rhinion, supratip, infratip, columella, subnasale, subalare, labraleSuperius,\n          // cheilion, labraleInferius, sublabiale, pogonion, menton, cervicalPoint, gonionTop, gonionBottom\n          switch (lm.id) {\n            // Chin/Jaw landmarks\n            case 'menton':\n              detectedPoint = detectedLandmarks[FACE_API_LANDMARK_MAPPING.MENTON];\n              break;\n            case 'pogonion':\n              detectedPoint = detectedLandmarks[FACE_API_LANDMARK_MAPPING.MENTON];\n              break;\n            case 'gonionBottom':\n              detectedPoint = detectedLandmarks[4]; // Jaw contour point\n              break;\n            case 'gonionTop':\n              detectedPoint = detectedLandmarks[3]; // Higher jaw point\n              break;\n\n            // Nose landmarks\n            case 'nasion':\n              detectedPoint = detectedLandmarks[FACE_API_LANDMARK_MAPPING.NASION];\n              break;\n            case 'pronasale':\n              detectedPoint = detectedLandmarks[FACE_API_LANDMARK_MAPPING.PRONASALE];\n              break;\n            case 'rhinion':\n              detectedPoint = detectedLandmarks[28]; // Mid nose bridge\n              break;\n            case 'subnasale':\n              detectedPoint = detectedLandmarks[33]; // Nose bottom center\n              break;\n            case 'columella':\n              detectedPoint = detectedLandmarks[33];\n              break;\n\n            // Lip landmarks\n            case 'labraleSuperius':\n              detectedPoint = detectedLandmarks[FACE_API_LANDMARK_MAPPING.UPPER_LIP_TOP];\n              break;\n            case 'labraleInferius':\n              detectedPoint = detectedLandmarks[FACE_API_LANDMARK_MAPPING.LOWER_LIP_BOTTOM];\n              break;\n            case 'cheilion':\n              detectedPoint = detectedLandmarks[FACE_API_LANDMARK_MAPPING.LEFT_MOUTH_CORNER];\n              break;\n            case 'sublabiale':\n              // Approximate from lower lip and chin\n              const lowerLip = detectedLandmarks[57];\n              const chin = detectedLandmarks[8];\n              if (lowerLip && chin) {\n                detectedPoint = {\n                  x: (lowerLip.x + chin.x) / 2,\n                  y: lowerLip.y + (chin.y - lowerLip.y) * 0.3,\n                };\n              }\n              break;\n\n            // Eye region\n            case 'cornealApex':\n              detectedPoint = detectedLandmarks[FACE_API_LANDMARK_MAPPING.LEFT_EYE_OUTER];\n              break;\n            case 'orbitale':\n              detectedPoint = detectedLandmarks[41]; // Lower eye socket\n              break;\n\n            // Forehead\n            case 'glabella':\n              // Approximate from brow points\n              const leftBrow = detectedLandmarks[21];\n              const rightBrow = detectedLandmarks[22];\n              if (leftBrow && rightBrow) {\n                detectedPoint = {\n                  x: (leftBrow.x + rightBrow.x) / 2,\n                  y: (leftBrow.y + rightBrow.y) / 2,\n                };\n              }\n              break;\n\n            // Ear landmarks (use jaw contour as proxy)\n            case 'tragus':\n              detectedPoint = detectedLandmarks[1]; // Upper jaw near ear\n              break;\n            case 'porion':\n              detectedPoint = detectedLandmarks[0]; // Near ear\n              break;\n\n            default:\n              break;\n          }\n\n          if (detectedPoint) {\n            return {\n              ...lm,\n              x: detectedPoint.x / imgWidth,\n              y: detectedPoint.y / imgHeight,\n            };\n          }\n\n          return lm;\n        })\n      );\n\n      setIsDetecting(false);\n    } catch (err) {\n      setDetectionError(err instanceof Error ? err.message : 'Detection failed');\n      setIsDetecting(false);\n    }\n  }, [faceApiReady, detect]);\n\n  // Zoom controls - FaceIQ parity: 2x, 4x, 8x discrete levels\n  const handleZoomIn = () => {\n    if (zoomLevel >= 3) return;\n    setZoomLevel((prev) => (prev + 1) as 2 | 3);\n  };\n  const handleZoomOut = () => {\n    if (zoomLevel <= 1) return;\n    setZoomLevel((prev) => (prev - 1) as 1 | 2);\n  };\n  const handleSetZoomLevel = (level: 1 | 2 | 3) => {\n    setZoomLevel(level);\n  };\n\n  const handleMouseDown = useCallback((id: string) => {\n    setActiveLandmark(id);\n  }, []);\n\n  const handleMouseMove = useCallback(\n    (e: React.MouseEvent<HTMLDivElement>) => {\n      if (!activeLandmark || !containerRef.current) return;\n\n      const rect = containerRef.current.getBoundingClientRect();\n      const x = Math.max(0, Math.min(1, (e.clientX - rect.left) / rect.width));\n      const y = Math.max(0, Math.min(1, (e.clientY - rect.top) / rect.height));\n\n      setLandmarks((prev) =>\n        prev.map((lm) => (lm.id === activeLandmark ? { ...lm, x, y } : lm))\n      );\n    },\n    [activeLandmark]\n  );\n\n  const handleMouseUp = useCallback(() => {\n    setActiveLandmark(null);\n  }, []);\n\n  const handleTouchStart = useCallback((id: string) => {\n    setActiveLandmark(id);\n  }, []);\n\n  const handleTouchMove = useCallback(\n    (e: React.TouchEvent<HTMLDivElement>) => {\n      if (!activeLandmark || !containerRef.current) return;\n\n      const touch = e.touches[0];\n      const rect = containerRef.current.getBoundingClientRect();\n      const x = Math.max(0, Math.min(1, (touch.clientX - rect.left) / rect.width));\n      const y = Math.max(0, Math.min(1, (touch.clientY - rect.top) / rect.height));\n\n      setLandmarks((prev) =>\n        prev.map((lm) => (lm.id === activeLandmark ? { ...lm, x, y } : lm))\n      );\n    },\n    [activeLandmark]\n  );\n\n  const handleTouchEnd = useCallback(() => {\n    setActiveLandmark(null);\n  }, []);\n\n  const handleComplete = () => {\n    onComplete?.(landmarks);\n  };\n\n  const resetLandmarks = () => {\n    setLandmarks(SIDE_PROFILE_LANDMARKS);\n  };\n\n  // Guided mode - step through categories\n  const currentCategory = isGuided ? SIDE_LANDMARK_CATEGORIES[currentStepIndex] : null;\n\n  const filteredLandmarks = selectedCategory\n    ? landmarks.filter((lm) => lm.category === selectedCategory)\n    : isGuided && currentCategory\n      ? landmarks.filter((lm) => lm.category === currentCategory.name)\n      : landmarks;\n\n  const visibleLandmarkIds = isGuided && currentCategory\n    ? new Set(currentCategory.landmarks)\n    : selectedCategory\n      ? new Set(filteredLandmarks.map((lm) => lm.id))\n      : new Set(landmarks.map((lm) => lm.id));\n\n  const nextStep = () => {\n    if (currentStepIndex < SIDE_LANDMARK_CATEGORIES.length - 1) {\n      setCurrentStepIndex(currentStepIndex + 1);\n    }\n  };\n\n  const prevStep = () => {\n    if (currentStepIndex > 0) {\n      setCurrentStepIndex(currentStepIndex - 1);\n    }\n  };\n\n  return (\n    <div className=\"w-full max-w-4xl mx-auto\">\n      {/* Header */}\n      <motion.div\n        initial={{ opacity: 0, y: -10 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"mb-6 text-center\"\n      >\n        <h2 className=\"text-xl font-semibold text-white mb-2\">\n          Side Profile Manual Adjustment\n        </h2>\n        <p className=\"text-neutral-400\">\n          Drag each marker to match the facial landmarks on your profile photo\n        </p>\n      </motion.div>\n\n      {/* Mode Toggle and Controls */}\n      <motion.div\n        initial={{ opacity: 0, y: 10 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"mb-4 flex flex-wrap justify-center gap-2\"\n      >\n        {/* Auto-Detect Button */}\n        <button\n          onClick={handleAutoDetect}\n          disabled={!faceApiReady || isDetecting}\n          className={`px-4 py-2 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${\n            faceApiReady && !isDetecting\n              ? 'bg-green-500/20 text-green-400 hover:bg-green-500/30 border border-green-500/30'\n              : 'bg-neutral-800 text-neutral-500 cursor-not-allowed'\n          }`}\n        >\n          {isDetecting ? (\n            <Loader2 className=\"w-4 h-4 animate-spin\" />\n          ) : faceApiLoading ? (\n            <Loader2 className=\"w-4 h-4 animate-spin\" />\n          ) : (\n            <Wand2 className=\"w-4 h-4\" />\n          )}\n          {isDetecting ? 'Detecting...' : faceApiLoading ? 'Loading AI...' : 'Auto-Detect'}\n        </button>\n\n        <div className=\"w-px h-8 bg-neutral-800\" />\n\n        <button\n          onClick={() => {\n            setIsGuided(true);\n            setSelectedCategory(null);\n          }}\n          className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${\n            isGuided\n              ? 'bg-[#00f3ff] text-black'\n              : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n          }`}\n        >\n          Guided Mode\n        </button>\n        <button\n          onClick={() => {\n            setIsGuided(false);\n            setSelectedCategory(null);\n          }}\n          className={`px-4 py-2 rounded-lg text-sm font-medium transition-all ${\n            !isGuided\n              ? 'bg-[#00f3ff] text-black'\n              : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n          }`}\n        >\n          Free Edit\n        </button>\n\n        <div className=\"w-px h-8 bg-neutral-800\" />\n\n        {/* Zoom Controls - FaceIQ parity: 2x, 4x, 8x */}\n        <div className=\"flex items-center gap-1\">\n          <button\n            onClick={handleZoomOut}\n            disabled={zoomLevel <= 1}\n            className=\"p-2 rounded-lg bg-neutral-800 text-neutral-400 hover:bg-neutral-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            <ZoomOut className=\"w-4 h-4\" />\n          </button>\n          <div className=\"flex gap-1\">\n            {([1, 2, 3] as const).map((level) => (\n              <button\n                key={level}\n                onClick={() => handleSetZoomLevel(level)}\n                className={`px-2 py-1 rounded text-xs font-mono transition-colors ${\n                  zoomLevel === level\n                    ? 'bg-[#00f3ff] text-black'\n                    : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n                }`}\n              >\n                {level === 1 ? '2x' : level === 2 ? '4x' : '8x'}\n              </button>\n            ))}\n          </div>\n          <button\n            onClick={handleZoomIn}\n            disabled={zoomLevel >= 3}\n            className=\"p-2 rounded-lg bg-neutral-800 text-neutral-400 hover:bg-neutral-700 transition-all disabled:opacity-50 disabled:cursor-not-allowed\"\n          >\n            <ZoomIn className=\"w-4 h-4\" />\n          </button>\n        </div>\n\n        <div className=\"w-px h-8 bg-neutral-800\" />\n\n        <button\n          onClick={resetLandmarks}\n          className=\"px-4 py-2 rounded-lg text-sm font-medium bg-neutral-800 text-neutral-400 hover:bg-neutral-700 transition-all flex items-center gap-2\"\n        >\n          <RotateCcw className=\"w-4 h-4\" />\n          Reset\n        </button>\n      </motion.div>\n\n      {/* Detection Error/Status */}\n      <AnimatePresence>\n        {(detectionError || faceApiError) && (\n          <motion.div\n            initial={{ opacity: 0, y: -10 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: -10 }}\n            className=\"mb-4 p-3 rounded-lg bg-red-500/10 border border-red-500/30 text-red-400 text-sm text-center\"\n          >\n            {detectionError || faceApiError?.message}\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Guided Mode Step Indicator */}\n      {isGuided && currentCategory && (\n        <motion.div\n          key={currentStepIndex}\n          initial={{ opacity: 0, x: 20 }}\n          animate={{ opacity: 1, x: 0 }}\n          className=\"mb-4\"\n        >\n          <div className=\"flex items-center justify-between mb-2\">\n            <button\n              onClick={prevStep}\n              disabled={currentStepIndex === 0}\n              className={`p-2 rounded-lg transition-all ${\n                currentStepIndex === 0\n                  ? 'text-neutral-700 cursor-not-allowed'\n                  : 'text-neutral-400 hover:text-white hover:bg-neutral-800'\n              }`}\n            >\n              <ChevronLeft className=\"w-5 h-5\" />\n            </button>\n\n            <div className=\"text-center\">\n              <div className=\"flex items-center justify-center gap-2 mb-1\">\n                <span\n                  className=\"w-3 h-3 rounded-full\"\n                  style={{ backgroundColor: currentCategory.color }}\n                />\n                <span className=\"text-white font-medium\">{currentCategory.name}</span>\n              </div>\n              <span className=\"text-xs text-neutral-400\">\n                Step {currentStepIndex + 1} of {SIDE_LANDMARK_CATEGORIES.length} •{' '}\n                {currentCategory.landmarks.length} points\n              </span>\n            </div>\n\n            <button\n              onClick={nextStep}\n              disabled={currentStepIndex === SIDE_LANDMARK_CATEGORIES.length - 1}\n              className={`p-2 rounded-lg transition-all ${\n                currentStepIndex === SIDE_LANDMARK_CATEGORIES.length - 1\n                  ? 'text-neutral-700 cursor-not-allowed'\n                  : 'text-neutral-400 hover:text-white hover:bg-neutral-800'\n              }`}\n            >\n              <ChevronRight className=\"w-5 h-5\" />\n            </button>\n          </div>\n\n          {/* Progress bar */}\n          <div className=\"w-full h-1 bg-neutral-800 rounded-full overflow-hidden\">\n            <motion.div\n              className=\"h-full rounded-full\"\n              style={{ backgroundColor: currentCategory.color }}\n              initial={{ width: 0 }}\n              animate={{\n                width: `${((currentStepIndex + 1) / SIDE_LANDMARK_CATEGORIES.length) * 100}%`,\n              }}\n              transition={{ duration: 0.3 }}\n            />\n          </div>\n        </motion.div>\n      )}\n\n      {/* Category Filter (Free Edit Mode) */}\n      {!isGuided && (\n        <motion.div\n          initial={{ opacity: 0, y: 10 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"mb-4 flex flex-wrap gap-2 justify-center\"\n        >\n          <button\n            onClick={() => setSelectedCategory(null)}\n            className={`px-3 py-1.5 rounded-full text-xs font-medium transition-all ${\n              selectedCategory === null\n                ? 'bg-[#00f3ff] text-black'\n                : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n            }`}\n          >\n            All ({landmarks.length})\n          </button>\n          {SIDE_LANDMARK_CATEGORIES.map((category) => (\n            <button\n              key={category.name}\n              onClick={() =>\n                setSelectedCategory(\n                  selectedCategory === category.name ? null : category.name\n                )\n              }\n              className={`px-3 py-1.5 rounded-full text-xs font-medium transition-all flex items-center gap-1.5 ${\n                selectedCategory === category.name\n                  ? 'bg-[#00f3ff] text-black'\n                  : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n              }`}\n            >\n              <span\n                className=\"w-2 h-2 rounded-full\"\n                style={{ backgroundColor: category.color }}\n              />\n              {category.name}\n            </button>\n          ))}\n        </motion.div>\n      )}\n\n      {/* Image Container with Landmarks */}\n      <motion.div\n        initial={{ opacity: 0, scale: 0.98 }}\n        animate={{ opacity: 1, scale: 1 }}\n        className=\"relative\"\n      >\n        <div\n          ref={containerRef}\n          className=\"relative w-full aspect-[3/4] rounded-2xl overflow-hidden bg-neutral-900 border border-neutral-800 select-none\"\n          onMouseMove={handleMouseMove}\n          onMouseUp={handleMouseUp}\n          onMouseLeave={handleMouseUp}\n          onTouchMove={handleTouchMove}\n          onTouchEnd={handleTouchEnd}\n        >\n          {/* User's uploaded image with zoom */}\n          <div\n            style={{\n              transform: `scale(${zoom})`,\n              transformOrigin: 'center center',\n            }}\n            className=\"absolute inset-0 transition-transform duration-200\"\n          >\n            <Image\n              ref={imageRef as React.RefObject<HTMLImageElement>}\n              src={imageUrl}\n              alt=\"Side profile\"\n              fill\n              className=\"object-contain pointer-events-none\"\n              unoptimized\n              draggable={false}\n              onLoadingComplete={(img) => {\n                // Store reference for face detection\n                if (imageRef.current !== img) {\n                  (imageRef as React.MutableRefObject<HTMLImageElement>).current = img;\n                }\n              }}\n            />\n          </div>\n\n          {/* Connection lines between sequential landmarks in category */}\n          {isGuided && currentCategory && (\n            <svg\n              className=\"absolute inset-0 w-full h-full pointer-events-none\"\n              viewBox=\"0 0 100 100\"\n              preserveAspectRatio=\"none\"\n            >\n              {currentCategory.landmarks.map((landmarkId, index) => {\n                if (index === currentCategory.landmarks.length - 1) return null;\n                const current = landmarks.find((lm) => lm.id === landmarkId);\n                const next = landmarks.find(\n                  (lm) => lm.id === currentCategory.landmarks[index + 1]\n                );\n                if (!current || !next) return null;\n\n                return (\n                  <line\n                    key={`line-${landmarkId}`}\n                    x1={current.x * 100}\n                    y1={current.y * 100}\n                    x2={next.x * 100}\n                    y2={next.y * 100}\n                    stroke={`${currentCategory.color}66`}\n                    strokeWidth=\"0.3\"\n                    strokeDasharray=\"1,1\"\n                  />\n                );\n              })}\n            </svg>\n          )}\n\n          {/* Landmark Points */}\n          {landmarks.map((landmark) => {\n            const isVisible = visibleLandmarkIds.has(landmark.id);\n            const color = getLandmarkColor(landmark.id, SIDE_LANDMARK_CATEGORIES);\n\n            return (\n              <div\n                key={landmark.id}\n                className={`\n                  absolute w-5 h-5 -translate-x-1/2 -translate-y-1/2 cursor-grab\n                  transition-all duration-200\n                  ${activeLandmark === landmark.id ? 'cursor-grabbing z-30' : 'z-10'}\n                  ${isVisible ? 'opacity-100 scale-100' : 'opacity-10 scale-75 pointer-events-none'}\n                `}\n                style={{\n                  left: `${landmark.x * 100}%`,\n                  top: `${landmark.y * 100}%`,\n                }}\n                onMouseDown={() => isVisible && handleMouseDown(landmark.id)}\n                onTouchStart={() => isVisible && handleTouchStart(landmark.id)}\n              >\n                {/* Outer glow ring */}\n                <div\n                  className={`\n                    absolute inset-0 rounded-full\n                    transition-all duration-200\n                    ${activeLandmark === landmark.id ? 'scale-150' : ''}\n                  `}\n                  style={{\n                    backgroundColor: `${color}33`,\n                    boxShadow:\n                      activeLandmark === landmark.id\n                        ? `0 0 25px ${color}`\n                        : `0 0 10px ${color}`,\n                  }}\n                />\n\n                {/* Main handle */}\n                <div\n                  className={`\n                    absolute inset-1 rounded-full border-2 border-white\n                    transition-all duration-200\n                    ${activeLandmark === landmark.id ? 'scale-125' : ''}\n                  `}\n                  style={{\n                    backgroundColor: color,\n                    boxShadow: `0 0 10px ${color}, 0 0 20px ${color}`,\n                  }}\n                />\n\n                {/* Label tooltip */}\n                <div\n                  className={`\n                    absolute left-6 top-1/2 -translate-y-1/2 whitespace-nowrap\n                    px-2 py-1 rounded bg-black/95 border\n                    text-xs font-medium z-50\n                    pointer-events-none transition-opacity duration-200\n                    ${activeLandmark === landmark.id ? 'opacity-100' : 'opacity-0'}\n                  `}\n                  style={{\n                    borderColor: `${color}80`,\n                    color: color,\n                  }}\n                >\n                  <div>{landmark.label}</div>\n                  <div className=\"text-[10px] opacity-70\">{landmark.medicalTerm}</div>\n                </div>\n              </div>\n            );\n          })}\n        </div>\n      </motion.div>\n\n      {/* Landmark Legend for Current Category */}\n      <motion.div\n        initial={{ opacity: 0, y: 10 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: 0.2 }}\n        className=\"mt-6 grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-2\"\n      >\n        {filteredLandmarks.map((landmark) => {\n          const color = getLandmarkColor(landmark.id, SIDE_LANDMARK_CATEGORIES);\n          return (\n            <div\n              key={landmark.id}\n              className={`\n                flex items-center gap-2 px-3 py-2 rounded-lg\n                border transition-all duration-200 cursor-pointer\n                ${\n                  activeLandmark === landmark.id\n                    ? 'border-neutral-600 bg-neutral-800'\n                    : 'border-neutral-800 bg-black hover:bg-neutral-900'\n                }\n              `}\n              onMouseEnter={() => setActiveLandmark(landmark.id)}\n              onMouseLeave={() => setActiveLandmark(null)}\n            >\n              <div\n                className=\"w-3 h-3 rounded-full flex-shrink-0\"\n                style={{\n                  backgroundColor: color,\n                }}\n              />\n              <div className=\"min-w-0\">\n                <p className=\"text-sm font-medium text-white truncate\">\n                  {landmark.label}\n                </p>\n                <p className=\"text-xs text-neutral-500 truncate\">\n                  {landmark.description}\n                </p>\n              </div>\n            </div>\n          );\n        })}\n      </motion.div>\n\n      {/* Navigation/Complete Buttons */}\n      <motion.div\n        initial={{ opacity: 0, y: 10 }}\n        animate={{ opacity: 1, y: 0 }}\n        transition={{ delay: 0.3 }}\n        className=\"mt-8 flex justify-center gap-4\"\n      >\n        {isGuided && currentStepIndex < SIDE_LANDMARK_CATEGORIES.length - 1 ? (\n          <button\n            onClick={nextStep}\n            className=\"\n              px-8 py-4 rounded-xl font-semibold text-lg\n              bg-[#00f3ff] text-black\n              hover:shadow-[0_0_20px_rgba(0,243,255,0.3)]\n              transition-all duration-300\n            \"\n          >\n            Next: {SIDE_LANDMARK_CATEGORIES[currentStepIndex + 1]?.name}\n          </button>\n        ) : (\n          <button\n            onClick={handleComplete}\n            className=\"\n              px-8 py-4 rounded-xl font-semibold text-lg\n              bg-[#00f3ff] text-black\n              hover:shadow-[0_0_20px_rgba(0,243,255,0.3)]\n              transition-all duration-300\n            \"\n          >\n            Confirm Side Landmarks\n          </button>\n        )}\n      </motion.div>\n\n      {/* Total Progress */}\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        transition={{ delay: 0.4 }}\n        className=\"mt-4 text-center text-sm text-neutral-500\"\n      >\n        {landmarks.length} landmarks • Drag markers to adjust positions\n      </motion.div>\n    </div>\n  );\n}\n","numLines":752,"startLine":1,"totalLines":752}}}
{"parentUuid":"cf9b7309-6678-415d-9893-021b85874210","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01S2q4yYAHvLFQYXg9y1pZ3B","type":"tool_result","content":"     1→/**\n     2→ * Facial Landmark Types and Default Data\n     3→ * Based on TECHNICAL_SPECS.md medical terminology\n     4→ */\n     5→\n     6→export interface LandmarkPoint {\n     7→  id: string;\n     8→  label: string;\n     9→  medicalTerm: string;\n    10→  description: string;\n    11→  x: number;\n    12→  y: number;\n    13→  category: string;\n    14→}\n    15→\n    16→export interface LandmarkCategory {\n    17→  name: string;\n    18→  color: string;\n    19→  landmarks: string[];\n    20→}\n    21→\n    22→// ============================================\n    23→// FRONT PROFILE LANDMARKS (52 Points)\n    24→// ============================================\n    25→\n    26→export const FRONT_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n    27→  {\n    28→    name: 'Head',\n    29→    color: '#FF6B6B',\n    30→    landmarks: ['trichion'],\n    31→  },\n    32→  {\n    33→    name: 'Eyes - Left',\n    34→    color: '#4ECDC4',\n    35→    landmarks: [\n    36→      'left_pupila',\n    37→      'left_canthus_medialis',\n    38→      'left_canthus_lateralis',\n    39→      'left_palpebra_superior',\n    40→      'left_palpebra_inferior',\n    41→      'left_sulcus_palpebralis_lateralis',\n    42→      'left_pretarsal_skin_crease',\n    43→    ],\n    44→  },\n    45→  {\n    46→    name: 'Eyes - Right',\n    47→    color: '#45B7D1',\n    48→    landmarks: [\n    49→      'right_pupila',\n    50→      'right_canthus_medialis',\n    51→      'right_canthus_lateralis',\n    52→      'right_palpebra_superior',\n    53→      'right_palpebra_inferior',\n    54→      'right_sulcus_palpebralis_lateralis',\n    55→      'right_pretarsal_skin_crease',\n    56→    ],\n    57→  },\n    58→  {\n    59→    name: 'Eyebrows - Left',\n    60→    color: '#96CEB4',\n    61→    landmarks: [\n    62→      'left_supercilium_medialis',\n    63→      'left_supercilium_medial_corner',\n    64→      'left_supercilium_superior',\n    65→      'left_supercilium_apex',\n    66→      'left_supercilium_lateralis',\n    67→    ],\n    68→  },\n    69→  {\n    70→    name: 'Eyebrows - Right',\n    71→    color: '#88D8B0',\n    72→    landmarks: [\n    73→      'right_supercilium_medialis',\n    74→      'right_supercilium_medial_corner',\n    75→      'right_supercilium_superior',\n    76→      'right_supercilium_apex',\n    77→      'right_supercilium_lateralis',\n    78→    ],\n    79→  },\n    80→  {\n    81→    name: 'Nose',\n    82→    color: '#FFEAA7',\n    83→    landmarks: [\n    84→      'nasal_base',\n    85→      'left_dorsum_nasi',\n    86→      'right_dorsum_nasi',\n    87→      'left_ala_nasi',\n    88→      'right_ala_nasi',\n    89→      'subnasale',\n    90→    ],\n    91→  },\n    92→  {\n    93→    name: 'Mouth',\n    94→    color: '#DDA0DD',\n    95→    landmarks: [\n    96→      'labrale_superius',\n    97→      'cupids_bow',\n    98→      'mouth_middle',\n    99→      'labrale_inferius',\n   100→      'left_cheilion',\n   101→      'right_cheilion',\n   102→    ],\n   103→  },\n   104→  {\n   105→    name: 'Jaw',\n   106→    color: '#F39C12',\n   107→    landmarks: [\n   108→      'left_gonion_superior',\n   109→      'right_gonion_superior',\n   110→      'left_gonion_inferior',\n   111→      'right_gonion_inferior',\n   112→    ],\n   113→  },\n   114→  {\n   115→    name: 'Chin',\n   116→    color: '#E74C3C',\n   117→    landmarks: ['left_mentum_lateralis', 'right_mentum_lateralis', 'menton'],\n   118→  },\n   119→  {\n   120→    name: 'Face Width',\n   121→    color: '#9B59B6',\n   122→    landmarks: [\n   123→      'left_zygion',\n   124→      'right_zygion',\n   125→      'left_temporal',\n   126→      'right_temporal',\n   127→      'left_auricular_lateral',\n   128→      'right_auricular_lateral',\n   129→    ],\n   130→  },\n   131→  {\n   132→    name: 'Neck',\n   133→    color: '#1ABC9C',\n   134→    landmarks: ['left_cervical_lateralis', 'right_cervical_lateralis'],\n   135→  },\n   136→];\n   137→\n   138→export const FRONT_PROFILE_LANDMARKS: LandmarkPoint[] = [\n   139→  // Head/Hair\n   140→  {\n   141→    id: 'trichion',\n   142→    label: 'Hairline',\n   143→    medicalTerm: 'Trichion (frontal view)',\n   144→    description: 'Anterior hairline at midline',\n   145→    x: 0.5,\n   146→    y: 0.08,\n   147→    category: 'Head',\n   148→  },\n   149→\n   150→  // Eyes - Left\n   151→  {\n   152→    id: 'left_pupila',\n   153→    label: 'Left Pupil',\n   154→    medicalTerm: 'Left Pupila',\n   155→    description: 'Center of left pupil',\n   156→    x: 0.38,\n   157→    y: 0.35,\n   158→    category: 'Eyes - Left',\n   159→  },\n   160→  {\n   161→    id: 'left_canthus_medialis',\n   162→    label: 'Left Medial Canthus',\n   163→    medicalTerm: 'Left Canthus Medialis',\n   164→    description: 'Inner corner of left eye',\n   165→    x: 0.42,\n   166→    y: 0.35,\n   167→    category: 'Eyes - Left',\n   168→  },\n   169→  {\n   170→    id: 'left_canthus_lateralis',\n   171→    label: 'Left Lateral Canthus',\n   172→    medicalTerm: 'Left Canthus Lateralis',\n   173→    description: 'Outer corner of left eye',\n   174→    x: 0.32,\n   175→    y: 0.34,\n   176→    category: 'Eyes - Left',\n   177→  },\n   178→  {\n   179→    id: 'left_palpebra_superior',\n   180→    label: 'Left Upper Eyelid',\n   181→    medicalTerm: 'Left Palpebra Superior',\n   182→    description: 'Upper eyelid of left eye',\n   183→    x: 0.37,\n   184→    y: 0.33,\n   185→    category: 'Eyes - Left',\n   186→  },\n   187→  {\n   188→    id: 'left_palpebra_inferior',\n   189→    label: 'Left Lower Eyelid',\n   190→    medicalTerm: 'Left Palpebra Inferior',\n   191→    description: 'Lower eyelid of left eye',\n   192→    x: 0.37,\n   193→    y: 0.37,\n   194→    category: 'Eyes - Left',\n   195→  },\n   196→  {\n   197→    id: 'left_sulcus_palpebralis_lateralis',\n   198→    label: 'Left Eyelid Hood End',\n   199→    medicalTerm: 'Left Sulcus Palpebralis Lateralis',\n   200→    description: 'Lateral end of left upper eyelid crease',\n   201→    x: 0.31,\n   202→    y: 0.33,\n   203→    category: 'Eyes - Left',\n   204→  },\n   205→  {\n   206→    id: 'left_pretarsal_skin_crease',\n   207→    label: 'Left Upper Eyelid Crease',\n   208→    medicalTerm: 'Left Pretarsal Skin Crease',\n   209→    description: 'Left upper eyelid crease',\n   210→    x: 0.37,\n   211→    y: 0.32,\n   212→    category: 'Eyes - Left',\n   213→  },\n   214→\n   215→  // Eyes - Right\n   216→  {\n   217→    id: 'right_pupila',\n   218→    label: 'Right Pupil',\n   219→    medicalTerm: 'Right Pupila',\n   220→    description: 'Center of right pupil',\n   221→    x: 0.62,\n   222→    y: 0.35,\n   223→    category: 'Eyes - Right',\n   224→  },\n   225→  {\n   226→    id: 'right_canthus_medialis',\n   227→    label: 'Right Medial Canthus',\n   228→    medicalTerm: 'Right Canthus Medialis',\n   229→    description: 'Inner corner of right eye',\n   230→    x: 0.58,\n   231→    y: 0.35,\n   232→    category: 'Eyes - Right',\n   233→  },\n   234→  {\n   235→    id: 'right_canthus_lateralis',\n   236→    label: 'Right Lateral Canthus',\n   237→    medicalTerm: 'Right Canthus Lateralis',\n   238→    description: 'Outer corner of right eye',\n   239→    x: 0.68,\n   240→    y: 0.34,\n   241→    category: 'Eyes - Right',\n   242→  },\n   243→  {\n   244→    id: 'right_palpebra_superior',\n   245→    label: 'Right Upper Eyelid',\n   246→    medicalTerm: 'Right Palpebra Superior',\n   247→    description: 'Upper eyelid of right eye',\n   248→    x: 0.63,\n   249→    y: 0.33,\n   250→    category: 'Eyes - Right',\n   251→  },\n   252→  {\n   253→    id: 'right_palpebra_inferior',\n   254→    label: 'Right Lower Eyelid',\n   255→    medicalTerm: 'Right Palpebra Inferior',\n   256→    description: 'Lower eyelid of right eye',\n   257→    x: 0.63,\n   258→    y: 0.37,\n   259→    category: 'Eyes - Right',\n   260→  },\n   261→  {\n   262→    id: 'right_sulcus_palpebralis_lateralis',\n   263→    label: 'Right Eyelid Hood End',\n   264→    medicalTerm: 'Right Sulcus Palpebralis Lateralis',\n   265→    description: 'Lateral end of right upper eyelid crease',\n   266→    x: 0.69,\n   267→    y: 0.33,\n   268→    category: 'Eyes - Right',\n   269→  },\n   270→  {\n   271→    id: 'right_pretarsal_skin_crease',\n   272→    label: 'Right Upper Eyelid Crease',\n   273→    medicalTerm: 'Right Pretarsal Skin Crease',\n   274→    description: 'Right upper eyelid crease',\n   275→    x: 0.63,\n   276→    y: 0.32,\n   277→    category: 'Eyes - Right',\n   278→  },\n   279→\n   280→  // Eyebrows - Left\n   281→  {\n   282→    id: 'left_supercilium_medialis',\n   283→    label: 'Left Brow Head',\n   284→    medicalTerm: 'Left Supercilium Medialis',\n   285→    description: 'Medial start of left eyebrow',\n   286→    x: 0.43,\n   287→    y: 0.28,\n   288→    category: 'Eyebrows - Left',\n   289→  },\n   290→  {\n   291→    id: 'left_supercilium_medial_corner',\n   292→    label: 'Left Brow Inner Corner',\n   293→    medicalTerm: 'Left Supercilium Medial Corner',\n   294→    description: 'Inner corner of left eyebrow',\n   295→    x: 0.41,\n   296→    y: 0.27,\n   297→    category: 'Eyebrows - Left',\n   298→  },\n   299→  {\n   300→    id: 'left_supercilium_superior',\n   301→    label: 'Left Brow Arch',\n   302→    medicalTerm: 'Left Supercilium Superior',\n   303→    description: 'Superior arc of left eyebrow',\n   304→    x: 0.36,\n   305→    y: 0.26,\n   306→    category: 'Eyebrows - Left',\n   307→  },\n   308→  {\n   309→    id: 'left_supercilium_apex',\n   310→    label: 'Left Brow Peak',\n   311→    medicalTerm: 'Left Supercilium Apex',\n   312→    description: 'Highest point of left eyebrow',\n   313→    x: 0.34,\n   314→    y: 0.26,\n   315→    category: 'Eyebrows - Left',\n   316→  },\n   317→  {\n   318→    id: 'left_supercilium_lateralis',\n   319→    label: 'Left Brow Tail',\n   320→    medicalTerm: 'Left Supercilium Lateralis',\n   321→    description: 'Lateral end of left eyebrow',\n   322→    x: 0.29,\n   323→    y: 0.28,\n   324→    category: 'Eyebrows - Left',\n   325→  },\n   326→\n   327→  // Eyebrows - Right\n   328→  {\n   329→    id: 'right_supercilium_medialis',\n   330→    label: 'Right Brow Head',\n   331→    medicalTerm: 'Right Supercilium Medialis',\n   332→    description: 'Medial start of right eyebrow',\n   333→    x: 0.57,\n   334→    y: 0.28,\n   335→    category: 'Eyebrows - Right',\n   336→  },\n   337→  {\n   338→    id: 'right_supercilium_medial_corner',\n   339→    label: 'Right Brow Inner Corner',\n   340→    medicalTerm: 'Right Supercilium Medial Corner',\n   341→    description: 'Inner corner of right eyebrow',\n   342→    x: 0.59,\n   343→    y: 0.27,\n   344→    category: 'Eyebrows - Right',\n   345→  },\n   346→  {\n   347→    id: 'right_supercilium_superior',\n   348→    label: 'Right Brow Arch',\n   349→    medicalTerm: 'Right Supercilium Superior',\n   350→    description: 'Superior arc of right eyebrow',\n   351→    x: 0.64,\n   352→    y: 0.26,\n   353→    category: 'Eyebrows - Right',\n   354→  },\n   355→  {\n   356→    id: 'right_supercilium_apex',\n   357→    label: 'Right Brow Peak',\n   358→    medicalTerm: 'Right Supercilium Apex',\n   359→    description: 'Highest point of right eyebrow',\n   360→    x: 0.66,\n   361→    y: 0.26,\n   362→    category: 'Eyebrows - Right',\n   363→  },\n   364→  {\n   365→    id: 'right_supercilium_lateralis',\n   366→    label: 'Right Brow Tail',\n   367→    medicalTerm: 'Right Supercilium Lateralis',\n   368→    description: 'Lateral end of right eyebrow',\n   369→    x: 0.71,\n   370→    y: 0.28,\n   371→    category: 'Eyebrows - Right',\n   372→  },\n   373→\n   374→  // Nose\n   375→  {\n   376→    id: 'nasal_base',\n   377→    label: 'Nasal Base',\n   378→    medicalTerm: 'Nasal Base',\n   379→    description: 'Base of nasal dorsum',\n   380→    x: 0.5,\n   381→    y: 0.38,\n   382→    category: 'Nose',\n   383→  },\n   384→  {\n   385→    id: 'left_dorsum_nasi',\n   386→    label: 'Left Nose Bridge',\n   387→    medicalTerm: 'Left Dorsum Nasi',\n   388→    description: 'Left side of nasal bridge',\n   389→    x: 0.47,\n   390→    y: 0.42,\n   391→    category: 'Nose',\n   392→  },\n   393→  {\n   394→    id: 'right_dorsum_nasi',\n   395→    label: 'Right Nose Bridge',\n   396→    medicalTerm: 'Right Dorsum Nasi',\n   397→    description: 'Right side of nasal bridge',\n   398→    x: 0.53,\n   399→    y: 0.42,\n   400→    category: 'Nose',\n   401→  },\n   402→  {\n   403→    id: 'left_ala_nasi',\n   404→    label: 'Left Nose Side',\n   405→    medicalTerm: 'Left Ala Nasi',\n   406→    description: 'Lateral aspect of left nasal ala',\n   407→    x: 0.44,\n   408→    y: 0.5,\n   409→    category: 'Nose',\n   410→  },\n   411→  {\n   412→    id: 'right_ala_nasi',\n   413→    label: 'Right Nose Side',\n   414→    medicalTerm: 'Right Ala Nasi',\n   415→    description: 'Lateral aspect of right nasal ala',\n   416→    x: 0.56,\n   417→    y: 0.5,\n   418→    category: 'Nose',\n   419→  },\n   420→  {\n   421→    id: 'subnasale',\n   422→    label: 'Nose Bottom',\n   423→    medicalTerm: 'Subnasale',\n   424→    description: 'Junction of columella and upper lip',\n   425→    x: 0.5,\n   426→    y: 0.52,\n   427→    category: 'Nose',\n   428→  },\n   429→\n   430→  // Mouth\n   431→  {\n   432→    id: 'labrale_superius',\n   433→    label: \"Cupid's Bow\",\n   434→    medicalTerm: 'Labrale Superius',\n   435→    description: 'Midpoint of upper lip vermilion',\n   436→    x: 0.5,\n   437→    y: 0.58,\n   438→    category: 'Mouth',\n   439→  },\n   440→  {\n   441→    id: 'cupids_bow',\n   442→    label: \"Inner Cupid's Bow\",\n   443→    medicalTerm: \"Cupid's Bow\",\n   444→    description: 'Central peak of upper lip',\n   445→    x: 0.5,\n   446→    y: 0.57,\n   447→    category: 'Mouth',\n   448→  },\n   449→  {\n   450→    id: 'mouth_middle',\n   451→    label: 'Mouth Middle',\n   452→    medicalTerm: 'Mouth Middle',\n   453→    description: 'Center of mouth opening',\n   454→    x: 0.5,\n   455→    y: 0.62,\n   456→    category: 'Mouth',\n   457→  },\n   458→  {\n   459→    id: 'labrale_inferius',\n   460→    label: 'Lower Lip Center',\n   461→    medicalTerm: 'Labrale Inferius',\n   462→    description: 'Midpoint of lower lip vermilion border',\n   463→    x: 0.5,\n   464→    y: 0.66,\n   465→    category: 'Mouth',\n   466→  },\n   467→  {\n   468→    id: 'left_cheilion',\n   469→    label: 'Left Mouth Corner',\n   470→    medicalTerm: 'Left Cheilion',\n   471→    description: 'Left oral commissure',\n   472→    x: 0.42,\n   473→    y: 0.62,\n   474→    category: 'Mouth',\n   475→  },\n   476→  {\n   477→    id: 'right_cheilion',\n   478→    label: 'Right Mouth Corner',\n   479→    medicalTerm: 'Right Cheilion',\n   480→    description: 'Right oral commissure',\n   481→    x: 0.58,\n   482→    y: 0.62,\n   483→    category: 'Mouth',\n   484→  },\n   485→\n   486→  // Jaw\n   487→  {\n   488→    id: 'left_gonion_superior',\n   489→    label: 'Left Upper Jaw Angle',\n   490→    medicalTerm: 'Left Gonion Superior',\n   491→    description: 'Superior aspect of left mandibular angle',\n   492→    x: 0.22,\n   493→    y: 0.55,\n   494→    category: 'Jaw',\n   495→  },\n   496→  {\n   497→    id: 'right_gonion_superior',\n   498→    label: 'Right Upper Jaw Angle',\n   499→    medicalTerm: 'Right Gonion Superior',\n   500→    description: 'Superior aspect of right mandibular angle',\n   501→    x: 0.78,\n   502→    y: 0.55,\n   503→    category: 'Jaw',\n   504→  },\n   505→  {\n   506→    id: 'left_gonion_inferior',\n   507→    label: 'Left Lower Jaw Angle',\n   508→    medicalTerm: 'Left Gonion Inferior',\n   509→    description: 'Inferior aspect of left mandibular angle',\n   510→    x: 0.24,\n   511→    y: 0.7,\n   512→    category: 'Jaw',\n   513→  },\n   514→  {\n   515→    id: 'right_gonion_inferior',\n   516→    label: 'Right Lower Jaw Angle',\n   517→    medicalTerm: 'Right Gonion Inferior',\n   518→    description: 'Inferior aspect of right mandibular angle',\n   519→    x: 0.76,\n   520→    y: 0.7,\n   521→    category: 'Jaw',\n   522→  },\n   523→\n   524→  // Chin\n   525→  {\n   526→    id: 'left_mentum_lateralis',\n   527→    label: 'Left Chin',\n   528→    medicalTerm: 'Left Mentum Lateralis',\n   529→    description: 'Left lateral chin',\n   530→    x: 0.42,\n   531→    y: 0.8,\n   532→    category: 'Chin',\n   533→  },\n   534→  {\n   535→    id: 'right_mentum_lateralis',\n   536→    label: 'Right Chin',\n   537→    medicalTerm: 'Right Mentum Lateralis',\n   538→    description: 'Right lateral chin',\n   539→    x: 0.58,\n   540→    y: 0.8,\n   541→    category: 'Chin',\n   542→  },\n   543→  {\n   544→    id: 'menton',\n   545→    label: 'Chin Bottom',\n   546→    medicalTerm: 'Menton',\n   547→    description: 'Lowest point of chin in midline',\n   548→    x: 0.5,\n   549→    y: 0.88,\n   550→    category: 'Chin',\n   551→  },\n   552→\n   553→  // Face Width\n   554→  {\n   555→    id: 'left_zygion',\n   556→    label: 'Left Cheekbone',\n   557→    medicalTerm: 'Left Zygion',\n   558→    description: 'Most lateral point of left zygomatic arch',\n   559→    x: 0.18,\n   560→    y: 0.42,\n   561→    category: 'Face Width',\n   562→  },\n   563→  {\n   564→    id: 'right_zygion',\n   565→    label: 'Right Cheekbone',\n   566→    medicalTerm: 'Right Zygion',\n   567→    description: 'Most lateral point of right zygomatic arch',\n   568→    x: 0.82,\n   569→    y: 0.42,\n   570→    category: 'Face Width',\n   571→  },\n   572→  {\n   573→    id: 'left_temporal',\n   574→    label: 'Left Temple',\n   575→    medicalTerm: 'Left Temporal Point',\n   576→    description: 'Left temporal region',\n   577→    x: 0.2,\n   578→    y: 0.3,\n   579→    category: 'Face Width',\n   580→  },\n   581→  {\n   582→    id: 'right_temporal',\n   583→    label: 'Right Temple',\n   584→    medicalTerm: 'Right Temporal Point',\n   585→    description: 'Right temporal region',\n   586→    x: 0.8,\n   587→    y: 0.3,\n   588→    category: 'Face Width',\n   589→  },\n   590→  {\n   591→    id: 'left_auricular_lateral',\n   592→    label: 'Left Outer Ear',\n   593→    medicalTerm: 'Left Auricular Lateral Point',\n   594→    description: 'Lateral-most point of left ear',\n   595→    x: 0.12,\n   596→    y: 0.4,\n   597→    category: 'Face Width',\n   598→  },\n   599→  {\n   600→    id: 'right_auricular_lateral',\n   601→    label: 'Right Outer Ear',\n   602→    medicalTerm: 'Right Auricular Lateral Point',\n   603→    description: 'Lateral-most point of right ear',\n   604→    x: 0.88,\n   605→    y: 0.4,\n   606→    category: 'Face Width',\n   607→  },\n   608→\n   609→  // Neck\n   610→  {\n   611→    id: 'left_cervical_lateralis',\n   612→    label: 'Left Neck Point',\n   613→    medicalTerm: 'Left Cervical Lateralis',\n   614→    description: 'Left cervical point',\n   615→    x: 0.35,\n   616→    y: 0.95,\n   617→    category: 'Neck',\n   618→  },\n   619→  {\n   620→    id: 'right_cervical_lateralis',\n   621→    label: 'Right Neck Point',\n   622→    medicalTerm: 'Right Cervical Lateralis',\n   623→    description: 'Right cervical point',\n   624→    x: 0.65,\n   625→    y: 0.95,\n   626→    category: 'Neck',\n   627→  },\n   628→];\n   629→\n   630→// ============================================\n   631→// SIDE PROFILE LANDMARKS (28 Points)\n   632→// Matches LOOKSMAXX exact naming and order\n   633→// ============================================\n   634→\n   635→export const SIDE_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n   636→  {\n   637→    name: 'Cranium',\n   638→    color: '#FF6B6B',\n   639→    landmarks: ['vertex', 'occiput', 'trichion'],\n   640→  },\n   641→  {\n   642→    name: 'Forehead',\n   643→    color: '#4ECDC4',\n   644→    landmarks: ['glabella'],\n   645→  },\n   646→  {\n   647→    name: 'Eye Region',\n   648→    color: '#45B7D1',\n   649→    landmarks: ['cornealApex', 'orbitale'],\n   650→  },\n   651→  {\n   652→    name: 'Nose',\n   653→    color: '#FFEAA7',\n   654→    landmarks: [\n   655→      'nasion',\n   656→      'rhinion',\n   657→      'supratip',\n   658→      'pronasale',\n   659→      'infratip',\n   660→      'columella',\n   661→      'subnasale',\n   662→      'subalare',\n   663→    ],\n   664→  },\n   665→  {\n   666→    name: 'Lips',\n   667→    color: '#DDA0DD',\n   668→    landmarks: ['labraleSuperius', 'cheilion', 'labraleInferius', 'sublabiale'],\n   669→  },\n   670→  {\n   671→    name: 'Chin',\n   672→    color: '#E74C3C',\n   673→    landmarks: ['pogonion', 'menton'],\n   674→  },\n   675→  {\n   676→    name: 'Jaw',\n   677→    color: '#F39C12',\n   678→    landmarks: ['gonionTop', 'gonionBottom'],\n   679→  },\n   680→  {\n   681→    name: 'Cheek',\n   682→    color: '#9B59B6',\n   683→    landmarks: ['cheekbone'],\n   684→  },\n   685→  {\n   686→    name: 'Ear',\n   687→    color: '#3498DB',\n   688→    landmarks: ['porion', 'tragus', 'intertragicNotch'],\n   689→  },\n   690→  {\n   691→    name: 'Neck',\n   692→    color: '#1ABC9C',\n   693→    landmarks: ['cervicalPoint', 'neckPoint'],\n   694→  },\n   695→];\n   696→\n   697→// Standard cephalometric order: vertex, occiput, pronasale, neckPoint, porion, orbitale, tragus,\n   698→// intertragicNotch, cornealApex, cheekbone, trichion, glabella, nasion, rhinion,\n   699→// supratip, infratip, columella, subnasale, subalare, labraleSuperius, cheilion,\n   700→// labraleInferius, sublabiale, pogonion, menton, cervicalPoint, gonionTop, gonionBottom\n   701→export const SIDE_PROFILE_LANDMARKS: LandmarkPoint[] = [\n   702→  // 1. vertex\n   703→  {\n   704→    id: 'vertex',\n   705→    label: 'Top of Head',\n   706→    medicalTerm: 'Vertex',\n   707→    description: 'Highest point on the head in profile',\n   708→    x: 0.45,\n   709→    y: 0.02,\n   710→    category: 'Cranium',\n   711→  },\n   712→  // 2. occiput\n   713→  {\n   714→    id: 'occiput',\n   715→    label: 'Occiput',\n   716→    medicalTerm: 'External Occipital Region',\n   717→    description: 'Back-of-head prominence',\n   718→    x: 0.85,\n   719→    y: 0.15,\n   720→    category: 'Cranium',\n   721→  },\n   722→  // 3. pronasale\n   723→  {\n   724→    id: 'pronasale',\n   725→    label: 'Nose Tip',\n   726→    medicalTerm: 'Pronasale',\n   727→    description: 'Most forward point of the nose tip',\n   728→    x: 0.18,\n   729→    y: 0.48,\n   730→    category: 'Nose',\n   731→  },\n   732→  // 4. neckPoint\n   733→  {\n   734→    id: 'neckPoint',\n   735→    label: 'Neck Point',\n   736→    medicalTerm: 'Anterior Cervical Landmark',\n   737→    description: 'Lower neck inflection on the front border',\n   738→    x: 0.4,\n   739→    y: 0.88,\n   740→    category: 'Neck',\n   741→  },\n   742→  // 5. porion\n   743→  {\n   744→    id: 'porion',\n   745→    label: 'Porion',\n   746→    medicalTerm: 'Porion (soft tissue)',\n   747→    description: 'Upper margin of ear canal opening, used for Frankfort horizontal plane',\n   748→    x: 0.75,\n   749→    y: 0.35,\n   750→    category: 'Ear',\n   751→  },\n   752→  // 6. orbitale\n   753→  {\n   754→    id: 'orbitale',\n   755→    label: 'Orbitale',\n   756→    medicalTerm: 'Orbitale',\n   757→    description: 'Lowest point on the orbital rim',\n   758→    x: 0.35,\n   759→    y: 0.38,\n   760→    category: 'Eye Region',\n   761→  },\n   762→  // 7. tragus\n   763→  {\n   764→    id: 'tragus',\n   765→    label: 'Tragus',\n   766→    medicalTerm: 'Tragion (soft tissue)',\n   767→    description: 'Cartilage nub in front of the ear canal',\n   768→    x: 0.72,\n   769→    y: 0.42,\n   770→    category: 'Ear',\n   771→  },\n   772→  // 8. intertragicNotch\n   773→  {\n   774→    id: 'intertragicNotch',\n   775→    label: 'Intertragic Notch',\n   776→    medicalTerm: 'Incisura Intertragica',\n   777→    description: 'Notch between tragus and antitragus cartilages',\n   778→    x: 0.73,\n   779→    y: 0.45,\n   780→    category: 'Ear',\n   781→  },\n   782→  // 9. cornealApex\n   783→  {\n   784→    id: 'cornealApex',\n   785→    label: 'Corneal Apex',\n   786→    medicalTerm: 'Corneal Apex',\n   787→    description: 'Most forward point of the eye (cornea)',\n   788→    x: 0.28,\n   789→    y: 0.34,\n   790→    category: 'Eye Region',\n   791→  },\n   792→  // 10. cheekbone\n   793→  {\n   794→    id: 'cheekbone',\n   795→    label: 'Cheekbone',\n   796→    medicalTerm: 'Zygion (soft-tissue over zygoma)',\n   797→    description: 'Zygomatic prominence',\n   798→    x: 0.45,\n   799→    y: 0.42,\n   800→    category: 'Cheek',\n   801→  },\n   802→  // 11. trichion\n   803→  {\n   804→    id: 'trichion',\n   805→    label: 'Hairline (Profile)',\n   806→    medicalTerm: 'Trichion',\n   807→    description: 'Forehead hairline point',\n   808→    x: 0.35,\n   809→    y: 0.1,\n   810→    category: 'Cranium',\n   811→  },\n   812→  // 12. glabella\n   813→  {\n   814→    id: 'glabella',\n   815→    label: 'Glabella',\n   816→    medicalTerm: 'Glabella',\n   817→    description: 'Mid-forehead point between brows',\n   818→    x: 0.32,\n   819→    y: 0.28,\n   820→    category: 'Forehead',\n   821→  },\n   822→  // 13. nasion\n   823→  {\n   824→    id: 'nasion',\n   825→    label: 'Nasal Bridge Root',\n   826→    medicalTerm: 'Nasion',\n   827→    description: 'Nasal root depression',\n   828→    x: 0.35,\n   829→    y: 0.32,\n   830→    category: 'Nose',\n   831→  },\n   832→  // 14. rhinion\n   833→  {\n   834→    id: 'rhinion',\n   835→    label: 'Rhinion',\n   836→    medicalTerm: 'Rhinion',\n   837→    description: 'Dorsal point of the nose',\n   838→    x: 0.28,\n   839→    y: 0.4,\n   840→    category: 'Nose',\n   841→  },\n   842→  // 15. supratip\n   843→  {\n   844→    id: 'supratip',\n   845→    label: 'Supratip',\n   846→    medicalTerm: 'Supratip Break',\n   847→    description: 'Dorsal point just above the tip',\n   848→    x: 0.22,\n   849→    y: 0.46,\n   850→    category: 'Nose',\n   851→  },\n   852→  // 16. infratip\n   853→  {\n   854→    id: 'infratip',\n   855→    label: 'Infratip',\n   856→    medicalTerm: 'Infratip Lobule',\n   857→    description: 'Point between nose tip and columella',\n   858→    x: 0.2,\n   859→    y: 0.5,\n   860→    category: 'Nose',\n   861→  },\n   862→  // 17. columella\n   863→  {\n   864→    id: 'columella',\n   865→    label: 'Columella',\n   866→    medicalTerm: 'Columella Nasi',\n   867→    description: 'Inferior border of the nasal septum between nostrils',\n   868→    x: 0.24,\n   869→    y: 0.52,\n   870→    category: 'Nose',\n   871→  },\n   872→  // 18. subnasale\n   873→  {\n   874→    id: 'subnasale',\n   875→    label: 'Subnasale',\n   876→    medicalTerm: 'Subnasale',\n   877→    description: 'Where nose base meets upper lip',\n   878→    x: 0.3,\n   879→    y: 0.54,\n   880→    category: 'Nose',\n   881→  },\n   882→  // 19. subalare\n   883→  {\n   884→    id: 'subalare',\n   885→    label: 'Subalare',\n   886→    medicalTerm: 'Subalare',\n   887→    description: 'Lowest point of the nostril wing on the visible side',\n   888→    x: 0.28,\n   889→    y: 0.53,\n   890→    category: 'Nose',\n   891→  },\n   892→  // 20. labraleSuperius\n   893→  {\n   894→    id: 'labraleSuperius',\n   895→    label: 'Upper Lip',\n   896→    medicalTerm: 'Labrale Superius',\n   897→    description: 'Most forward point of the upper lip vermilion',\n   898→    x: 0.28,\n   899→    y: 0.58,\n   900→    category: 'Lips',\n   901→  },\n   902→  // 21. cheilion\n   903→  {\n   904→    id: 'cheilion',\n   905→    label: 'Mouth Corner',\n   906→    medicalTerm: 'Cheilion',\n   907→    description: 'Mouth corner where the lips meet',\n   908→    x: 0.35,\n   909→    y: 0.62,\n   910→    category: 'Lips',\n   911→  },\n   912→  // 22. labraleInferius\n   913→  {\n   914→    id: 'labraleInferius',\n   915→    label: 'Lower Lip',\n   916→    medicalTerm: 'Labrale Inferius',\n   917→    description: 'Most forward point of the lower lip vermilion',\n   918→    x: 0.3,\n   919→    y: 0.66,\n   920→    category: 'Lips',\n   921→  },\n   922→  // 23. sublabiale\n   923→  {\n   924→    id: 'sublabiale',\n   925→    label: 'Labiomental Fold',\n   926→    medicalTerm: 'Sublabiale',\n   927→    description: 'Deepest point of the crease between lower lip and chin',\n   928→    x: 0.32,\n   929→    y: 0.7,\n   930→    category: 'Lips',\n   931→  },\n   932→  // 24. pogonion\n   933→  {\n   934→    id: 'pogonion',\n   935→    label: 'Chin Point',\n   936→    medicalTerm: 'Pogonion (soft tissue)',\n   937→    description: 'Most forward point on the soft-tissue chin',\n   938→    x: 0.3,\n   939→    y: 0.76,\n   940→    category: 'Chin',\n   941→  },\n   942→  // 25. menton\n   943→  {\n   944→    id: 'menton',\n   945→    label: 'Chin Bottom',\n   946→    medicalTerm: 'Menton (soft tissue)',\n   947→    description: 'Lowest point on the soft-tissue chin',\n   948→    x: 0.35,\n   949→    y: 0.82,\n   950→    category: 'Chin',\n   951→  },\n   952→  // 26. cervicalPoint\n   953→  {\n   954→    id: 'cervicalPoint',\n   955→    label: 'Cervical Point',\n   956→    medicalTerm: 'Cervicale (soft-tissue reference)',\n   957→    description: 'High neck point just under the jaw',\n   958→    x: 0.5,\n   959→    y: 0.9,\n   960→    category: 'Neck',\n   961→  },\n   962→  // 27. gonionTop\n   963→  {\n   964→    id: 'gonionTop',\n   965→    label: 'Upper Jaw Angle',\n   966→    medicalTerm: 'Gonion Superior',\n   967→    description: 'Upper angle point of the jaw from side profile',\n   968→    x: 0.7,\n   969→    y: 0.6,\n   970→    category: 'Jaw',\n   971→  },\n   972→  // 28. gonionBottom\n   973→  {\n   974→    id: 'gonionBottom',\n   975→    label: 'Lower Jaw Angle',\n   976→    medicalTerm: 'Gonion Inferior',\n   977→    description: 'Lower angle point of the jaw from side profile',\n   978→    x: 0.65,\n   979→    y: 0.72,\n   980→    category: 'Jaw',\n   981→  },\n   982→];\n   983→\n   984→// ============================================\n   985→// MediaPipe Face Mesh Index Mapping\n   986→// ============================================\n   987→// NOTE: MEDIAPIPE_FRONT_MAPPING is defined in mediapipeDetection.ts (single source of truth)\n   988→// Import from there if needed: import { MEDIAPIPE_FRONT_MAPPING } from './mediapipeDetection';\n   989→\n   990→// Helper to get category color for a landmark\n   991→export function getLandmarkColor(\n   992→  landmarkId: string,\n   993→  categories: LandmarkCategory[]\n   994→): string {\n   995→  for (const category of categories) {\n   996→    if (category.landmarks.includes(landmarkId)) {\n   997→      return category.color;\n   998→    }\n   999→  }\n  1000→  return '#00f3ff'; // Default cyan\n  1001→}\n  1002→\n  1003→// ============================================\n  1004→// Side Profile Landmark Indices (106 points)\n  1005→// Reverse-engineered from LOOKSMAXX API\n  1006→// ============================================\n  1007→\n  1008→export const SIDE_LANDMARKS = {\n  1009→  // Face Contour (0-16) - Jaw/Chin outline\n  1010→  MENTON: 0, // Chin bottom (lowest point)\n  1011→  POGONION: 2, // Chin prominence\n  1012→  GNATHION: 3, // Chin point\n  1013→  MANDIBLE_CONTOUR: [2, 3, 4, 5, 6, 7, 8], // Jaw line\n  1014→\n  1015→  // Posterior Points (1, 9-16) - Ear/Back of head\n  1016→  TRAGION: 1, // Ear point\n  1017→  EAR_CONTOUR: [9, 10, 11, 12, 13, 14, 15, 16],\n  1018→\n  1019→  // Forehead/Hairline (17)\n  1020→  TRICHION: 17, // Hairline\n  1021→\n  1022→  // Nose Profile (18-32)\n  1023→  NASION: 25, // Bridge of nose (deepest point)\n  1024→  PRONASALE: 32, // Nose tip\n  1025→  SUBNASALE: 52, // Base of nose\n  1026→  COLUMELLA: 53, // Nose columella\n  1027→  NOSE_BRIDGE: [25, 26, 27, 28, 29, 30, 31, 32],\n  1028→  NOSE_TIP_CONTOUR: [52, 53, 54, 55, 56, 57, 58, 59, 60],\n  1029→\n  1030→  // Eye Region (33-51)\n  1031→  EYE_LATERAL_CANTHUS: 33, // Outer eye corner\n  1032→  EYE_MEDIAL_CANTHUS: 35, // Inner eye corner\n  1033→  UPPER_EYELID: [37, 38, 39],\n  1034→  LOWER_EYELID: [40, 41, 42],\n  1035→  PUPIL: 34,\n  1036→  BROW_HEAD: 44, // Inner brow\n  1037→  BROW_ARCH: 45, // Brow peak\n  1038→  BROW_TAIL: 46, // Outer brow\n  1039→\n  1040→  // Lip Region (52-75)\n  1041→  LABRALE_SUPERIUS: 63, // Upper lip top\n  1042→  LABRALE_INFERIUS: 66, // Lower lip bottom\n  1043→  STOMION: 65, // Lip meeting point\n  1044→  UPPER_LIP_CONTOUR: [63, 64, 65],\n  1045→  LOWER_LIP_CONTOUR: [66, 67, 68],\n  1046→\n  1047→  // Additional Profile Points (76-105)\n  1048→  GLABELLA: 76, // Between eyebrows\n  1049→  SELLION: 77, // Deepest point of nasal bridge\n  1050→  SOFT_TISSUE_NASION: 78,\n  1051→  ORBITALE: 79, // Lowest point of eye socket\n  1052→  GONION: 85, // Jaw angle\n  1053→  CONDYLION: 86, // Top of jaw joint\n  1054→};\n  1055→\n  1056→// ============================================\n  1057→// Front Face Landmark Indices (MediaPipe 478 points)\n  1058→// ============================================\n  1059→\n  1060→export const FRONT_LANDMARKS = {\n  1061→  // Key points from MediaPipe Face Mesh\n  1062→  NOSE_TIP: 1,\n  1063→  LEFT_EYE_INNER: 133,\n  1064→  LEFT_EYE_OUTER: 33,\n  1065→  RIGHT_EYE_INNER: 362,\n  1066→  RIGHT_EYE_OUTER: 263,\n  1067→  LEFT_CHEEK: 234,\n  1068→  RIGHT_CHEEK: 454,\n  1069→  UPPER_LIP: 13,\n  1070→  LOWER_LIP: 14,\n  1071→  CHIN: 152,\n  1072→  FOREHEAD: 10,\n  1073→  LEFT_EAR: 234,\n  1074→  RIGHT_EAR: 454,\n  1075→  LEFT_BROW_INNER: 107,\n  1076→  LEFT_BROW_OUTER: 70,\n  1077→  RIGHT_BROW_INNER: 336,\n  1078→  RIGHT_BROW_OUTER: 300,\n  1079→  NOSE_BRIDGE: 6,\n  1080→  LEFT_NOSTRIL: 129,\n  1081→  RIGHT_NOSTRIL: 358,\n  1082→};\n  1083→\n  1084→// ============================================\n  1085→// Scoring Configuration Types\n  1086→// ============================================\n  1087→\n  1088→export interface ScoringConfig {\n  1089→  idealValue: number;\n  1090→  standardDeviation: number;\n  1091→  minScore: number;\n  1092→  maxScore: number;\n  1093→  weight: number;\n  1094→}\n  1095→\n  1096→export interface GenderSpecificValues {\n  1097→  male: { ideal: number; range: [number, number] };\n  1098→  female: { ideal: number; range: [number, number] };\n  1099→}\n  1100→\n  1101→// ============================================\n  1102→// Ideal Values (Gender-Specific)\n  1103→// ============================================\n  1104→\n  1105→export const IDEAL_VALUES: Record<string, GenderSpecificValues> = {\n  1106→  fwhr: {\n  1107→    male: { ideal: 1.9, range: [1.8, 2.1] },\n  1108→    female: { ideal: 1.75, range: [1.6, 1.9] },\n  1109→  },\n  1110→  canthalTilt: {\n  1111→    male: { ideal: 4, range: [2, 7] },\n  1112→    female: { ideal: 6, range: [4, 10] },\n  1113→  },\n  1114→  nasolabialAngle: {\n  1115→    male: { ideal: 95, range: [90, 100] },\n  1116→    female: { ideal: 105, range: [100, 115] },\n  1117→  },\n  1118→  gonialAngle: {\n  1119→    male: { ideal: 125, range: [120, 130] },\n  1120→    female: { ideal: 128, range: [125, 135] },\n  1121→  },\n  1122→  nasalIndex: {\n  1123→    male: { ideal: 0.7, range: [0.65, 0.75] },\n  1124→    female: { ideal: 0.65, range: [0.6, 0.7] },\n  1125→  },\n  1126→  lipRatio: {\n  1127→    male: { ideal: 0.5, range: [0.4, 0.6] },\n  1128→    female: { ideal: 0.5, range: [0.45, 0.55] },\n  1129→  },\n  1130→  facialConvexity: {\n  1131→    male: { ideal: 170, range: [165, 175] },\n  1132→    female: { ideal: 168, range: [163, 173] },\n  1133→  },\n  1134→  chinProjection: {\n  1135→    male: { ideal: 0, range: [-3, 3] },\n  1136→    female: { ideal: -2, range: [-5, 1] },\n  1137→  },\n  1138→};\n  1139→\n  1140→// ============================================\n  1141→// Scoring Configurations\n  1142→// ============================================\n  1143→\n  1144→export const SCORING_CONFIGS: Record<string, ScoringConfig> = {\n  1145→  fwhr: {\n  1146→    idealValue: 1.9,\n  1147→    standardDeviation: 0.15,\n  1148→    minScore: 0,\n  1149→    maxScore: 100,\n  1150→    weight: 0.15,\n  1151→  },\n  1152→  canthalTilt: {\n  1153→    idealValue: 6,\n  1154→    standardDeviation: 3,\n  1155→    minScore: 0,\n  1156→    maxScore: 100,\n  1157→    weight: 0.1,\n  1158→  },\n  1159→  facialThirds: {\n  1160→    idealValue: 33.33,\n  1161→    standardDeviation: 3,\n  1162→    minScore: 0,\n  1163→    maxScore: 100,\n  1164→    weight: 0.1,\n  1165→  },\n  1166→  nasolabialAngle: {\n  1167→    idealValue: 102,\n  1168→    standardDeviation: 8,\n  1169→    minScore: 0,\n  1170→    maxScore: 100,\n  1171→    weight: 0.08,\n  1172→  },\n  1173→  gonialAngle: {\n  1174→    idealValue: 125,\n  1175→    standardDeviation: 5,\n  1176→    minScore: 0,\n  1177→    maxScore: 100,\n  1178→    weight: 0.08,\n  1179→  },\n  1180→  overallSymmetry: {\n  1181→    idealValue: 100,\n  1182→    standardDeviation: 5,\n  1183→    minScore: 0,\n  1184→    maxScore: 100,\n  1185→    weight: 0.15,\n  1186→  },\n  1187→  goldenRatio: {\n  1188→    idealValue: 1.618,\n  1189→    standardDeviation: 0.1,\n  1190→    minScore: 0,\n  1191→    maxScore: 100,\n  1192→    weight: 0.12,\n  1193→  },\n  1194→  nasalIndex: {\n  1195→    idealValue: 0.7,\n  1196→    standardDeviation: 0.08,\n  1197→    minScore: 0,\n  1198→    maxScore: 100,\n  1199→    weight: 0.06,\n  1200→  },\n  1201→  lipRatio: {\n  1202→    idealValue: 0.5,\n  1203→    standardDeviation: 0.1,\n  1204→    minScore: 0,\n  1205→    maxScore: 100,\n  1206→    weight: 0.06,\n  1207→  },\n  1208→  chinProjection: {\n  1209→    idealValue: 0,\n  1210→    standardDeviation: 3,\n  1211→    minScore: 0,\n  1212→    maxScore: 100,\n  1213→    weight: 0.05,\n  1214→  },\n  1215→  noseProjection: {\n  1216→    idealValue: 0.67,\n  1217→    standardDeviation: 0.05,\n  1218→    minScore: 0,\n  1219→    maxScore: 100,\n  1220→    weight: 0.05,\n  1221→  },\n  1222→};\n  1223→\n  1224→// ============================================\n  1225→// Population Statistics for Percentile Ranking\n  1226→// ============================================\n  1227→\n  1228→export interface PopulationStats {\n  1229→  mean: number;\n  1230→  standardDeviation: number;\n  1231→  sampleSize: number;\n  1232→}\n  1233→\n  1234→export const POPULATION_STATS: Record<string, PopulationStats> = {\n  1235→  harmonyScore: { mean: 65, standardDeviation: 12, sampleSize: 10000 },\n  1236→  fwhr: { mean: 1.85, standardDeviation: 0.2, sampleSize: 10000 },\n  1237→  canthalTilt: { mean: 4, standardDeviation: 4, sampleSize: 10000 },\n  1238→  symmetry: { mean: 85, standardDeviation: 8, sampleSize: 10000 },\n  1239→  goldenRatioMatch: { mean: 70, standardDeviation: 15, sampleSize: 10000 },\n  1240→};\n  1241→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"e4f19722-05ac-4495-a8a0-36ae9c501932","timestamp":"2025-12-27T03:19:49.570Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts","content":"/**\n * Facial Landmark Types and Default Data\n * Based on TECHNICAL_SPECS.md medical terminology\n */\n\nexport interface LandmarkPoint {\n  id: string;\n  label: string;\n  medicalTerm: string;\n  description: string;\n  x: number;\n  y: number;\n  category: string;\n}\n\nexport interface LandmarkCategory {\n  name: string;\n  color: string;\n  landmarks: string[];\n}\n\n// ============================================\n// FRONT PROFILE LANDMARKS (52 Points)\n// ============================================\n\nexport const FRONT_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n  {\n    name: 'Head',\n    color: '#FF6B6B',\n    landmarks: ['trichion'],\n  },\n  {\n    name: 'Eyes - Left',\n    color: '#4ECDC4',\n    landmarks: [\n      'left_pupila',\n      'left_canthus_medialis',\n      'left_canthus_lateralis',\n      'left_palpebra_superior',\n      'left_palpebra_inferior',\n      'left_sulcus_palpebralis_lateralis',\n      'left_pretarsal_skin_crease',\n    ],\n  },\n  {\n    name: 'Eyes - Right',\n    color: '#45B7D1',\n    landmarks: [\n      'right_pupila',\n      'right_canthus_medialis',\n      'right_canthus_lateralis',\n      'right_palpebra_superior',\n      'right_palpebra_inferior',\n      'right_sulcus_palpebralis_lateralis',\n      'right_pretarsal_skin_crease',\n    ],\n  },\n  {\n    name: 'Eyebrows - Left',\n    color: '#96CEB4',\n    landmarks: [\n      'left_supercilium_medialis',\n      'left_supercilium_medial_corner',\n      'left_supercilium_superior',\n      'left_supercilium_apex',\n      'left_supercilium_lateralis',\n    ],\n  },\n  {\n    name: 'Eyebrows - Right',\n    color: '#88D8B0',\n    landmarks: [\n      'right_supercilium_medialis',\n      'right_supercilium_medial_corner',\n      'right_supercilium_superior',\n      'right_supercilium_apex',\n      'right_supercilium_lateralis',\n    ],\n  },\n  {\n    name: 'Nose',\n    color: '#FFEAA7',\n    landmarks: [\n      'nasal_base',\n      'left_dorsum_nasi',\n      'right_dorsum_nasi',\n      'left_ala_nasi',\n      'right_ala_nasi',\n      'subnasale',\n    ],\n  },\n  {\n    name: 'Mouth',\n    color: '#DDA0DD',\n    landmarks: [\n      'labrale_superius',\n      'cupids_bow',\n      'mouth_middle',\n      'labrale_inferius',\n      'left_cheilion',\n      'right_cheilion',\n    ],\n  },\n  {\n    name: 'Jaw',\n    color: '#F39C12',\n    landmarks: [\n      'left_gonion_superior',\n      'right_gonion_superior',\n      'left_gonion_inferior',\n      'right_gonion_inferior',\n    ],\n  },\n  {\n    name: 'Chin',\n    color: '#E74C3C',\n    landmarks: ['left_mentum_lateralis', 'right_mentum_lateralis', 'menton'],\n  },\n  {\n    name: 'Face Width',\n    color: '#9B59B6',\n    landmarks: [\n      'left_zygion',\n      'right_zygion',\n      'left_temporal',\n      'right_temporal',\n      'left_auricular_lateral',\n      'right_auricular_lateral',\n    ],\n  },\n  {\n    name: 'Neck',\n    color: '#1ABC9C',\n    landmarks: ['left_cervical_lateralis', 'right_cervical_lateralis'],\n  },\n];\n\nexport const FRONT_PROFILE_LANDMARKS: LandmarkPoint[] = [\n  // Head/Hair\n  {\n    id: 'trichion',\n    label: 'Hairline',\n    medicalTerm: 'Trichion (frontal view)',\n    description: 'Anterior hairline at midline',\n    x: 0.5,\n    y: 0.08,\n    category: 'Head',\n  },\n\n  // Eyes - Left\n  {\n    id: 'left_pupila',\n    label: 'Left Pupil',\n    medicalTerm: 'Left Pupila',\n    description: 'Center of left pupil',\n    x: 0.38,\n    y: 0.35,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_canthus_medialis',\n    label: 'Left Medial Canthus',\n    medicalTerm: 'Left Canthus Medialis',\n    description: 'Inner corner of left eye',\n    x: 0.42,\n    y: 0.35,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_canthus_lateralis',\n    label: 'Left Lateral Canthus',\n    medicalTerm: 'Left Canthus Lateralis',\n    description: 'Outer corner of left eye',\n    x: 0.32,\n    y: 0.34,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_palpebra_superior',\n    label: 'Left Upper Eyelid',\n    medicalTerm: 'Left Palpebra Superior',\n    description: 'Upper eyelid of left eye',\n    x: 0.37,\n    y: 0.33,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_palpebra_inferior',\n    label: 'Left Lower Eyelid',\n    medicalTerm: 'Left Palpebra Inferior',\n    description: 'Lower eyelid of left eye',\n    x: 0.37,\n    y: 0.37,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_sulcus_palpebralis_lateralis',\n    label: 'Left Eyelid Hood End',\n    medicalTerm: 'Left Sulcus Palpebralis Lateralis',\n    description: 'Lateral end of left upper eyelid crease',\n    x: 0.31,\n    y: 0.33,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_pretarsal_skin_crease',\n    label: 'Left Upper Eyelid Crease',\n    medicalTerm: 'Left Pretarsal Skin Crease',\n    description: 'Left upper eyelid crease',\n    x: 0.37,\n    y: 0.32,\n    category: 'Eyes - Left',\n  },\n\n  // Eyes - Right\n  {\n    id: 'right_pupila',\n    label: 'Right Pupil',\n    medicalTerm: 'Right Pupila',\n    description: 'Center of right pupil',\n    x: 0.62,\n    y: 0.35,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_canthus_medialis',\n    label: 'Right Medial Canthus',\n    medicalTerm: 'Right Canthus Medialis',\n    description: 'Inner corner of right eye',\n    x: 0.58,\n    y: 0.35,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_canthus_lateralis',\n    label: 'Right Lateral Canthus',\n    medicalTerm: 'Right Canthus Lateralis',\n    description: 'Outer corner of right eye',\n    x: 0.68,\n    y: 0.34,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_palpebra_superior',\n    label: 'Right Upper Eyelid',\n    medicalTerm: 'Right Palpebra Superior',\n    description: 'Upper eyelid of right eye',\n    x: 0.63,\n    y: 0.33,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_palpebra_inferior',\n    label: 'Right Lower Eyelid',\n    medicalTerm: 'Right Palpebra Inferior',\n    description: 'Lower eyelid of right eye',\n    x: 0.63,\n    y: 0.37,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_sulcus_palpebralis_lateralis',\n    label: 'Right Eyelid Hood End',\n    medicalTerm: 'Right Sulcus Palpebralis Lateralis',\n    description: 'Lateral end of right upper eyelid crease',\n    x: 0.69,\n    y: 0.33,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_pretarsal_skin_crease',\n    label: 'Right Upper Eyelid Crease',\n    medicalTerm: 'Right Pretarsal Skin Crease',\n    description: 'Right upper eyelid crease',\n    x: 0.63,\n    y: 0.32,\n    category: 'Eyes - Right',\n  },\n\n  // Eyebrows - Left\n  {\n    id: 'left_supercilium_medialis',\n    label: 'Left Brow Head',\n    medicalTerm: 'Left Supercilium Medialis',\n    description: 'Medial start of left eyebrow',\n    x: 0.43,\n    y: 0.28,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_medial_corner',\n    label: 'Left Brow Inner Corner',\n    medicalTerm: 'Left Supercilium Medial Corner',\n    description: 'Inner corner of left eyebrow',\n    x: 0.41,\n    y: 0.27,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_superior',\n    label: 'Left Brow Arch',\n    medicalTerm: 'Left Supercilium Superior',\n    description: 'Superior arc of left eyebrow',\n    x: 0.36,\n    y: 0.26,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_apex',\n    label: 'Left Brow Peak',\n    medicalTerm: 'Left Supercilium Apex',\n    description: 'Highest point of left eyebrow',\n    x: 0.34,\n    y: 0.26,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_lateralis',\n    label: 'Left Brow Tail',\n    medicalTerm: 'Left Supercilium Lateralis',\n    description: 'Lateral end of left eyebrow',\n    x: 0.29,\n    y: 0.28,\n    category: 'Eyebrows - Left',\n  },\n\n  // Eyebrows - Right\n  {\n    id: 'right_supercilium_medialis',\n    label: 'Right Brow Head',\n    medicalTerm: 'Right Supercilium Medialis',\n    description: 'Medial start of right eyebrow',\n    x: 0.57,\n    y: 0.28,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_medial_corner',\n    label: 'Right Brow Inner Corner',\n    medicalTerm: 'Right Supercilium Medial Corner',\n    description: 'Inner corner of right eyebrow',\n    x: 0.59,\n    y: 0.27,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_superior',\n    label: 'Right Brow Arch',\n    medicalTerm: 'Right Supercilium Superior',\n    description: 'Superior arc of right eyebrow',\n    x: 0.64,\n    y: 0.26,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_apex',\n    label: 'Right Brow Peak',\n    medicalTerm: 'Right Supercilium Apex',\n    description: 'Highest point of right eyebrow',\n    x: 0.66,\n    y: 0.26,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_lateralis',\n    label: 'Right Brow Tail',\n    medicalTerm: 'Right Supercilium Lateralis',\n    description: 'Lateral end of right eyebrow',\n    x: 0.71,\n    y: 0.28,\n    category: 'Eyebrows - Right',\n  },\n\n  // Nose\n  {\n    id: 'nasal_base',\n    label: 'Nasal Base',\n    medicalTerm: 'Nasal Base',\n    description: 'Base of nasal dorsum',\n    x: 0.5,\n    y: 0.38,\n    category: 'Nose',\n  },\n  {\n    id: 'left_dorsum_nasi',\n    label: 'Left Nose Bridge',\n    medicalTerm: 'Left Dorsum Nasi',\n    description: 'Left side of nasal bridge',\n    x: 0.47,\n    y: 0.42,\n    category: 'Nose',\n  },\n  {\n    id: 'right_dorsum_nasi',\n    label: 'Right Nose Bridge',\n    medicalTerm: 'Right Dorsum Nasi',\n    description: 'Right side of nasal bridge',\n    x: 0.53,\n    y: 0.42,\n    category: 'Nose',\n  },\n  {\n    id: 'left_ala_nasi',\n    label: 'Left Nose Side',\n    medicalTerm: 'Left Ala Nasi',\n    description: 'Lateral aspect of left nasal ala',\n    x: 0.44,\n    y: 0.5,\n    category: 'Nose',\n  },\n  {\n    id: 'right_ala_nasi',\n    label: 'Right Nose Side',\n    medicalTerm: 'Right Ala Nasi',\n    description: 'Lateral aspect of right nasal ala',\n    x: 0.56,\n    y: 0.5,\n    category: 'Nose',\n  },\n  {\n    id: 'subnasale',\n    label: 'Nose Bottom',\n    medicalTerm: 'Subnasale',\n    description: 'Junction of columella and upper lip',\n    x: 0.5,\n    y: 0.52,\n    category: 'Nose',\n  },\n\n  // Mouth\n  {\n    id: 'labrale_superius',\n    label: \"Cupid's Bow\",\n    medicalTerm: 'Labrale Superius',\n    description: 'Midpoint of upper lip vermilion',\n    x: 0.5,\n    y: 0.58,\n    category: 'Mouth',\n  },\n  {\n    id: 'cupids_bow',\n    label: \"Inner Cupid's Bow\",\n    medicalTerm: \"Cupid's Bow\",\n    description: 'Central peak of upper lip',\n    x: 0.5,\n    y: 0.57,\n    category: 'Mouth',\n  },\n  {\n    id: 'mouth_middle',\n    label: 'Mouth Middle',\n    medicalTerm: 'Mouth Middle',\n    description: 'Center of mouth opening',\n    x: 0.5,\n    y: 0.62,\n    category: 'Mouth',\n  },\n  {\n    id: 'labrale_inferius',\n    label: 'Lower Lip Center',\n    medicalTerm: 'Labrale Inferius',\n    description: 'Midpoint of lower lip vermilion border',\n    x: 0.5,\n    y: 0.66,\n    category: 'Mouth',\n  },\n  {\n    id: 'left_cheilion',\n    label: 'Left Mouth Corner',\n    medicalTerm: 'Left Cheilion',\n    description: 'Left oral commissure',\n    x: 0.42,\n    y: 0.62,\n    category: 'Mouth',\n  },\n  {\n    id: 'right_cheilion',\n    label: 'Right Mouth Corner',\n    medicalTerm: 'Right Cheilion',\n    description: 'Right oral commissure',\n    x: 0.58,\n    y: 0.62,\n    category: 'Mouth',\n  },\n\n  // Jaw\n  {\n    id: 'left_gonion_superior',\n    label: 'Left Upper Jaw Angle',\n    medicalTerm: 'Left Gonion Superior',\n    description: 'Superior aspect of left mandibular angle',\n    x: 0.22,\n    y: 0.55,\n    category: 'Jaw',\n  },\n  {\n    id: 'right_gonion_superior',\n    label: 'Right Upper Jaw Angle',\n    medicalTerm: 'Right Gonion Superior',\n    description: 'Superior aspect of right mandibular angle',\n    x: 0.78,\n    y: 0.55,\n    category: 'Jaw',\n  },\n  {\n    id: 'left_gonion_inferior',\n    label: 'Left Lower Jaw Angle',\n    medicalTerm: 'Left Gonion Inferior',\n    description: 'Inferior aspect of left mandibular angle',\n    x: 0.24,\n    y: 0.7,\n    category: 'Jaw',\n  },\n  {\n    id: 'right_gonion_inferior',\n    label: 'Right Lower Jaw Angle',\n    medicalTerm: 'Right Gonion Inferior',\n    description: 'Inferior aspect of right mandibular angle',\n    x: 0.76,\n    y: 0.7,\n    category: 'Jaw',\n  },\n\n  // Chin\n  {\n    id: 'left_mentum_lateralis',\n    label: 'Left Chin',\n    medicalTerm: 'Left Mentum Lateralis',\n    description: 'Left lateral chin',\n    x: 0.42,\n    y: 0.8,\n    category: 'Chin',\n  },\n  {\n    id: 'right_mentum_lateralis',\n    label: 'Right Chin',\n    medicalTerm: 'Right Mentum Lateralis',\n    description: 'Right lateral chin',\n    x: 0.58,\n    y: 0.8,\n    category: 'Chin',\n  },\n  {\n    id: 'menton',\n    label: 'Chin Bottom',\n    medicalTerm: 'Menton',\n    description: 'Lowest point of chin in midline',\n    x: 0.5,\n    y: 0.88,\n    category: 'Chin',\n  },\n\n  // Face Width\n  {\n    id: 'left_zygion',\n    label: 'Left Cheekbone',\n    medicalTerm: 'Left Zygion',\n    description: 'Most lateral point of left zygomatic arch',\n    x: 0.18,\n    y: 0.42,\n    category: 'Face Width',\n  },\n  {\n    id: 'right_zygion',\n    label: 'Right Cheekbone',\n    medicalTerm: 'Right Zygion',\n    description: 'Most lateral point of right zygomatic arch',\n    x: 0.82,\n    y: 0.42,\n    category: 'Face Width',\n  },\n  {\n    id: 'left_temporal',\n    label: 'Left Temple',\n    medicalTerm: 'Left Temporal Point',\n    description: 'Left temporal region',\n    x: 0.2,\n    y: 0.3,\n    category: 'Face Width',\n  },\n  {\n    id: 'right_temporal',\n    label: 'Right Temple',\n    medicalTerm: 'Right Temporal Point',\n    description: 'Right temporal region',\n    x: 0.8,\n    y: 0.3,\n    category: 'Face Width',\n  },\n  {\n    id: 'left_auricular_lateral',\n    label: 'Left Outer Ear',\n    medicalTerm: 'Left Auricular Lateral Point',\n    description: 'Lateral-most point of left ear',\n    x: 0.12,\n    y: 0.4,\n    category: 'Face Width',\n  },\n  {\n    id: 'right_auricular_lateral',\n    label: 'Right Outer Ear',\n    medicalTerm: 'Right Auricular Lateral Point',\n    description: 'Lateral-most point of right ear',\n    x: 0.88,\n    y: 0.4,\n    category: 'Face Width',\n  },\n\n  // Neck\n  {\n    id: 'left_cervical_lateralis',\n    label: 'Left Neck Point',\n    medicalTerm: 'Left Cervical Lateralis',\n    description: 'Left cervical point',\n    x: 0.35,\n    y: 0.95,\n    category: 'Neck',\n  },\n  {\n    id: 'right_cervical_lateralis',\n    label: 'Right Neck Point',\n    medicalTerm: 'Right Cervical Lateralis',\n    description: 'Right cervical point',\n    x: 0.65,\n    y: 0.95,\n    category: 'Neck',\n  },\n];\n\n// ============================================\n// SIDE PROFILE LANDMARKS (28 Points)\n// Matches LOOKSMAXX exact naming and order\n// ============================================\n\nexport const SIDE_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n  {\n    name: 'Cranium',\n    color: '#FF6B6B',\n    landmarks: ['vertex', 'occiput', 'trichion'],\n  },\n  {\n    name: 'Forehead',\n    color: '#4ECDC4',\n    landmarks: ['glabella'],\n  },\n  {\n    name: 'Eye Region',\n    color: '#45B7D1',\n    landmarks: ['cornealApex', 'orbitale'],\n  },\n  {\n    name: 'Nose',\n    color: '#FFEAA7',\n    landmarks: [\n      'nasion',\n      'rhinion',\n      'supratip',\n      'pronasale',\n      'infratip',\n      'columella',\n      'subnasale',\n      'subalare',\n    ],\n  },\n  {\n    name: 'Lips',\n    color: '#DDA0DD',\n    landmarks: ['labraleSuperius', 'cheilion', 'labraleInferius', 'sublabiale'],\n  },\n  {\n    name: 'Chin',\n    color: '#E74C3C',\n    landmarks: ['pogonion', 'menton'],\n  },\n  {\n    name: 'Jaw',\n    color: '#F39C12',\n    landmarks: ['gonionTop', 'gonionBottom'],\n  },\n  {\n    name: 'Cheek',\n    color: '#9B59B6',\n    landmarks: ['cheekbone'],\n  },\n  {\n    name: 'Ear',\n    color: '#3498DB',\n    landmarks: ['porion', 'tragus', 'intertragicNotch'],\n  },\n  {\n    name: 'Neck',\n    color: '#1ABC9C',\n    landmarks: ['cervicalPoint', 'neckPoint'],\n  },\n];\n\n// Standard cephalometric order: vertex, occiput, pronasale, neckPoint, porion, orbitale, tragus,\n// intertragicNotch, cornealApex, cheekbone, trichion, glabella, nasion, rhinion,\n// supratip, infratip, columella, subnasale, subalare, labraleSuperius, cheilion,\n// labraleInferius, sublabiale, pogonion, menton, cervicalPoint, gonionTop, gonionBottom\nexport const SIDE_PROFILE_LANDMARKS: LandmarkPoint[] = [\n  // 1. vertex\n  {\n    id: 'vertex',\n    label: 'Top of Head',\n    medicalTerm: 'Vertex',\n    description: 'Highest point on the head in profile',\n    x: 0.45,\n    y: 0.02,\n    category: 'Cranium',\n  },\n  // 2. occiput\n  {\n    id: 'occiput',\n    label: 'Occiput',\n    medicalTerm: 'External Occipital Region',\n    description: 'Back-of-head prominence',\n    x: 0.85,\n    y: 0.15,\n    category: 'Cranium',\n  },\n  // 3. pronasale\n  {\n    id: 'pronasale',\n    label: 'Nose Tip',\n    medicalTerm: 'Pronasale',\n    description: 'Most forward point of the nose tip',\n    x: 0.18,\n    y: 0.48,\n    category: 'Nose',\n  },\n  // 4. neckPoint\n  {\n    id: 'neckPoint',\n    label: 'Neck Point',\n    medicalTerm: 'Anterior Cervical Landmark',\n    description: 'Lower neck inflection on the front border',\n    x: 0.4,\n    y: 0.88,\n    category: 'Neck',\n  },\n  // 5. porion\n  {\n    id: 'porion',\n    label: 'Porion',\n    medicalTerm: 'Porion (soft tissue)',\n    description: 'Upper margin of ear canal opening, used for Frankfort horizontal plane',\n    x: 0.75,\n    y: 0.35,\n    category: 'Ear',\n  },\n  // 6. orbitale\n  {\n    id: 'orbitale',\n    label: 'Orbitale',\n    medicalTerm: 'Orbitale',\n    description: 'Lowest point on the orbital rim',\n    x: 0.35,\n    y: 0.38,\n    category: 'Eye Region',\n  },\n  // 7. tragus\n  {\n    id: 'tragus',\n    label: 'Tragus',\n    medicalTerm: 'Tragion (soft tissue)',\n    description: 'Cartilage nub in front of the ear canal',\n    x: 0.72,\n    y: 0.42,\n    category: 'Ear',\n  },\n  // 8. intertragicNotch\n  {\n    id: 'intertragicNotch',\n    label: 'Intertragic Notch',\n    medicalTerm: 'Incisura Intertragica',\n    description: 'Notch between tragus and antitragus cartilages',\n    x: 0.73,\n    y: 0.45,\n    category: 'Ear',\n  },\n  // 9. cornealApex\n  {\n    id: 'cornealApex',\n    label: 'Corneal Apex',\n    medicalTerm: 'Corneal Apex',\n    description: 'Most forward point of the eye (cornea)',\n    x: 0.28,\n    y: 0.34,\n    category: 'Eye Region',\n  },\n  // 10. cheekbone\n  {\n    id: 'cheekbone',\n    label: 'Cheekbone',\n    medicalTerm: 'Zygion (soft-tissue over zygoma)',\n    description: 'Zygomatic prominence',\n    x: 0.45,\n    y: 0.42,\n    category: 'Cheek',\n  },\n  // 11. trichion\n  {\n    id: 'trichion',\n    label: 'Hairline (Profile)',\n    medicalTerm: 'Trichion',\n    description: 'Forehead hairline point',\n    x: 0.35,\n    y: 0.1,\n    category: 'Cranium',\n  },\n  // 12. glabella\n  {\n    id: 'glabella',\n    label: 'Glabella',\n    medicalTerm: 'Glabella',\n    description: 'Mid-forehead point between brows',\n    x: 0.32,\n    y: 0.28,\n    category: 'Forehead',\n  },\n  // 13. nasion\n  {\n    id: 'nasion',\n    label: 'Nasal Bridge Root',\n    medicalTerm: 'Nasion',\n    description: 'Nasal root depression',\n    x: 0.35,\n    y: 0.32,\n    category: 'Nose',\n  },\n  // 14. rhinion\n  {\n    id: 'rhinion',\n    label: 'Rhinion',\n    medicalTerm: 'Rhinion',\n    description: 'Dorsal point of the nose',\n    x: 0.28,\n    y: 0.4,\n    category: 'Nose',\n  },\n  // 15. supratip\n  {\n    id: 'supratip',\n    label: 'Supratip',\n    medicalTerm: 'Supratip Break',\n    description: 'Dorsal point just above the tip',\n    x: 0.22,\n    y: 0.46,\n    category: 'Nose',\n  },\n  // 16. infratip\n  {\n    id: 'infratip',\n    label: 'Infratip',\n    medicalTerm: 'Infratip Lobule',\n    description: 'Point between nose tip and columella',\n    x: 0.2,\n    y: 0.5,\n    category: 'Nose',\n  },\n  // 17. columella\n  {\n    id: 'columella',\n    label: 'Columella',\n    medicalTerm: 'Columella Nasi',\n    description: 'Inferior border of the nasal septum between nostrils',\n    x: 0.24,\n    y: 0.52,\n    category: 'Nose',\n  },\n  // 18. subnasale\n  {\n    id: 'subnasale',\n    label: 'Subnasale',\n    medicalTerm: 'Subnasale',\n    description: 'Where nose base meets upper lip',\n    x: 0.3,\n    y: 0.54,\n    category: 'Nose',\n  },\n  // 19. subalare\n  {\n    id: 'subalare',\n    label: 'Subalare',\n    medicalTerm: 'Subalare',\n    description: 'Lowest point of the nostril wing on the visible side',\n    x: 0.28,\n    y: 0.53,\n    category: 'Nose',\n  },\n  // 20. labraleSuperius\n  {\n    id: 'labraleSuperius',\n    label: 'Upper Lip',\n    medicalTerm: 'Labrale Superius',\n    description: 'Most forward point of the upper lip vermilion',\n    x: 0.28,\n    y: 0.58,\n    category: 'Lips',\n  },\n  // 21. cheilion\n  {\n    id: 'cheilion',\n    label: 'Mouth Corner',\n    medicalTerm: 'Cheilion',\n    description: 'Mouth corner where the lips meet',\n    x: 0.35,\n    y: 0.62,\n    category: 'Lips',\n  },\n  // 22. labraleInferius\n  {\n    id: 'labraleInferius',\n    label: 'Lower Lip',\n    medicalTerm: 'Labrale Inferius',\n    description: 'Most forward point of the lower lip vermilion',\n    x: 0.3,\n    y: 0.66,\n    category: 'Lips',\n  },\n  // 23. sublabiale\n  {\n    id: 'sublabiale',\n    label: 'Labiomental Fold',\n    medicalTerm: 'Sublabiale',\n    description: 'Deepest point of the crease between lower lip and chin',\n    x: 0.32,\n    y: 0.7,\n    category: 'Lips',\n  },\n  // 24. pogonion\n  {\n    id: 'pogonion',\n    label: 'Chin Point',\n    medicalTerm: 'Pogonion (soft tissue)',\n    description: 'Most forward point on the soft-tissue chin',\n    x: 0.3,\n    y: 0.76,\n    category: 'Chin',\n  },\n  // 25. menton\n  {\n    id: 'menton',\n    label: 'Chin Bottom',\n    medicalTerm: 'Menton (soft tissue)',\n    description: 'Lowest point on the soft-tissue chin',\n    x: 0.35,\n    y: 0.82,\n    category: 'Chin',\n  },\n  // 26. cervicalPoint\n  {\n    id: 'cervicalPoint',\n    label: 'Cervical Point',\n    medicalTerm: 'Cervicale (soft-tissue reference)',\n    description: 'High neck point just under the jaw',\n    x: 0.5,\n    y: 0.9,\n    category: 'Neck',\n  },\n  // 27. gonionTop\n  {\n    id: 'gonionTop',\n    label: 'Upper Jaw Angle',\n    medicalTerm: 'Gonion Superior',\n    description: 'Upper angle point of the jaw from side profile',\n    x: 0.7,\n    y: 0.6,\n    category: 'Jaw',\n  },\n  // 28. gonionBottom\n  {\n    id: 'gonionBottom',\n    label: 'Lower Jaw Angle',\n    medicalTerm: 'Gonion Inferior',\n    description: 'Lower angle point of the jaw from side profile',\n    x: 0.65,\n    y: 0.72,\n    category: 'Jaw',\n  },\n];\n\n// ============================================\n// MediaPipe Face Mesh Index Mapping\n// ============================================\n// NOTE: MEDIAPIPE_FRONT_MAPPING is defined in mediapipeDetection.ts (single source of truth)\n// Import from there if needed: import { MEDIAPIPE_FRONT_MAPPING } from './mediapipeDetection';\n\n// Helper to get category color for a landmark\nexport function getLandmarkColor(\n  landmarkId: string,\n  categories: LandmarkCategory[]\n): string {\n  for (const category of categories) {\n    if (category.landmarks.includes(landmarkId)) {\n      return category.color;\n    }\n  }\n  return '#00f3ff'; // Default cyan\n}\n\n// ============================================\n// Side Profile Landmark Indices (106 points)\n// Reverse-engineered from LOOKSMAXX API\n// ============================================\n\nexport const SIDE_LANDMARKS = {\n  // Face Contour (0-16) - Jaw/Chin outline\n  MENTON: 0, // Chin bottom (lowest point)\n  POGONION: 2, // Chin prominence\n  GNATHION: 3, // Chin point\n  MANDIBLE_CONTOUR: [2, 3, 4, 5, 6, 7, 8], // Jaw line\n\n  // Posterior Points (1, 9-16) - Ear/Back of head\n  TRAGION: 1, // Ear point\n  EAR_CONTOUR: [9, 10, 11, 12, 13, 14, 15, 16],\n\n  // Forehead/Hairline (17)\n  TRICHION: 17, // Hairline\n\n  // Nose Profile (18-32)\n  NASION: 25, // Bridge of nose (deepest point)\n  PRONASALE: 32, // Nose tip\n  SUBNASALE: 52, // Base of nose\n  COLUMELLA: 53, // Nose columella\n  NOSE_BRIDGE: [25, 26, 27, 28, 29, 30, 31, 32],\n  NOSE_TIP_CONTOUR: [52, 53, 54, 55, 56, 57, 58, 59, 60],\n\n  // Eye Region (33-51)\n  EYE_LATERAL_CANTHUS: 33, // Outer eye corner\n  EYE_MEDIAL_CANTHUS: 35, // Inner eye corner\n  UPPER_EYELID: [37, 38, 39],\n  LOWER_EYELID: [40, 41, 42],\n  PUPIL: 34,\n  BROW_HEAD: 44, // Inner brow\n  BROW_ARCH: 45, // Brow peak\n  BROW_TAIL: 46, // Outer brow\n\n  // Lip Region (52-75)\n  LABRALE_SUPERIUS: 63, // Upper lip top\n  LABRALE_INFERIUS: 66, // Lower lip bottom\n  STOMION: 65, // Lip meeting point\n  UPPER_LIP_CONTOUR: [63, 64, 65],\n  LOWER_LIP_CONTOUR: [66, 67, 68],\n\n  // Additional Profile Points (76-105)\n  GLABELLA: 76, // Between eyebrows\n  SELLION: 77, // Deepest point of nasal bridge\n  SOFT_TISSUE_NASION: 78,\n  ORBITALE: 79, // Lowest point of eye socket\n  GONION: 85, // Jaw angle\n  CONDYLION: 86, // Top of jaw joint\n};\n\n// ============================================\n// Front Face Landmark Indices (MediaPipe 478 points)\n// ============================================\n\nexport const FRONT_LANDMARKS = {\n  // Key points from MediaPipe Face Mesh\n  NOSE_TIP: 1,\n  LEFT_EYE_INNER: 133,\n  LEFT_EYE_OUTER: 33,\n  RIGHT_EYE_INNER: 362,\n  RIGHT_EYE_OUTER: 263,\n  LEFT_CHEEK: 234,\n  RIGHT_CHEEK: 454,\n  UPPER_LIP: 13,\n  LOWER_LIP: 14,\n  CHIN: 152,\n  FOREHEAD: 10,\n  LEFT_EAR: 234,\n  RIGHT_EAR: 454,\n  LEFT_BROW_INNER: 107,\n  LEFT_BROW_OUTER: 70,\n  RIGHT_BROW_INNER: 336,\n  RIGHT_BROW_OUTER: 300,\n  NOSE_BRIDGE: 6,\n  LEFT_NOSTRIL: 129,\n  RIGHT_NOSTRIL: 358,\n};\n\n// ============================================\n// Scoring Configuration Types\n// ============================================\n\nexport interface ScoringConfig {\n  idealValue: number;\n  standardDeviation: number;\n  minScore: number;\n  maxScore: number;\n  weight: number;\n}\n\nexport interface GenderSpecificValues {\n  male: { ideal: number; range: [number, number] };\n  female: { ideal: number; range: [number, number] };\n}\n\n// ============================================\n// Ideal Values (Gender-Specific)\n// ============================================\n\nexport const IDEAL_VALUES: Record<string, GenderSpecificValues> = {\n  fwhr: {\n    male: { ideal: 1.9, range: [1.8, 2.1] },\n    female: { ideal: 1.75, range: [1.6, 1.9] },\n  },\n  canthalTilt: {\n    male: { ideal: 4, range: [2, 7] },\n    female: { ideal: 6, range: [4, 10] },\n  },\n  nasolabialAngle: {\n    male: { ideal: 95, range: [90, 100] },\n    female: { ideal: 105, range: [100, 115] },\n  },\n  gonialAngle: {\n    male: { ideal: 125, range: [120, 130] },\n    female: { ideal: 128, range: [125, 135] },\n  },\n  nasalIndex: {\n    male: { ideal: 0.7, range: [0.65, 0.75] },\n    female: { ideal: 0.65, range: [0.6, 0.7] },\n  },\n  lipRatio: {\n    male: { ideal: 0.5, range: [0.4, 0.6] },\n    female: { ideal: 0.5, range: [0.45, 0.55] },\n  },\n  facialConvexity: {\n    male: { ideal: 170, range: [165, 175] },\n    female: { ideal: 168, range: [163, 173] },\n  },\n  chinProjection: {\n    male: { ideal: 0, range: [-3, 3] },\n    female: { ideal: -2, range: [-5, 1] },\n  },\n};\n\n// ============================================\n// Scoring Configurations\n// ============================================\n\nexport const SCORING_CONFIGS: Record<string, ScoringConfig> = {\n  fwhr: {\n    idealValue: 1.9,\n    standardDeviation: 0.15,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.15,\n  },\n  canthalTilt: {\n    idealValue: 6,\n    standardDeviation: 3,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.1,\n  },\n  facialThirds: {\n    idealValue: 33.33,\n    standardDeviation: 3,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.1,\n  },\n  nasolabialAngle: {\n    idealValue: 102,\n    standardDeviation: 8,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.08,\n  },\n  gonialAngle: {\n    idealValue: 125,\n    standardDeviation: 5,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.08,\n  },\n  overallSymmetry: {\n    idealValue: 100,\n    standardDeviation: 5,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.15,\n  },\n  goldenRatio: {\n    idealValue: 1.618,\n    standardDeviation: 0.1,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.12,\n  },\n  nasalIndex: {\n    idealValue: 0.7,\n    standardDeviation: 0.08,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.06,\n  },\n  lipRatio: {\n    idealValue: 0.5,\n    standardDeviation: 0.1,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.06,\n  },\n  chinProjection: {\n    idealValue: 0,\n    standardDeviation: 3,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.05,\n  },\n  noseProjection: {\n    idealValue: 0.67,\n    standardDeviation: 0.05,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.05,\n  },\n};\n\n// ============================================\n// Population Statistics for Percentile Ranking\n// ============================================\n\nexport interface PopulationStats {\n  mean: number;\n  standardDeviation: number;\n  sampleSize: number;\n}\n\nexport const POPULATION_STATS: Record<string, PopulationStats> = {\n  harmonyScore: { mean: 65, standardDeviation: 12, sampleSize: 10000 },\n  fwhr: { mean: 1.85, standardDeviation: 0.2, sampleSize: 10000 },\n  canthalTilt: { mean: 4, standardDeviation: 4, sampleSize: 10000 },\n  symmetry: { mean: 85, standardDeviation: 8, sampleSize: 10000 },\n  goldenRatioMatch: { mean: 70, standardDeviation: 15, sampleSize: 10000 },\n};\n","numLines":1241,"startLine":1,"totalLines":1241}}}
{"parentUuid":"e4f19722-05ac-4495-a8a0-36ae9c501932","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01He1VvRUStrK2yQrWuf9rkJ","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me search for any additional zoom-related files:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5995,"cache_creation_input_tokens":53412,"cache_read_input_tokens":34022,"cache_creation":{"ephemeral_5m_input_tokens":53412,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWWUFNzNEUzrG5vQVqFfR","type":"assistant","uuid":"58b525f1-488a-4972-8274-8cdd08b4cc3c","timestamp":"2025-12-27T03:19:54.598Z"}
{"parentUuid":"58b525f1-488a-4972-8274-8cdd08b4cc3c","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01He1VvRUStrK2yQrWuf9rkJ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01T2eH5TY6cZYcQEgYZe4MAc","name":"Grep","input":{"pattern":"zoomLevel|zoomToPoint|zoomTo","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src","output_mode":"files_with_matches"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5995,"cache_creation_input_tokens":53412,"cache_read_input_tokens":34022,"cache_creation":{"ephemeral_5m_input_tokens":53412,"ephemeral_1h_input_tokens":0},"output_tokens":136,"service_tier":"standard"}},"requestId":"req_011CWWUFNzNEUzrG5vQVqFfR","type":"assistant","uuid":"57781bb6-e42d-4318-9a28-5c933642489b","timestamp":"2025-12-27T03:19:56.511Z"}
{"parentUuid":"57781bb6-e42d-4318-9a28-5c933642489b","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01T2eH5TY6cZYcQEgYZe4MAc","type":"tool_result","content":"Found 6 files\nsrc/lib/mediapipeDetection.ts\nsrc/components/LandmarkAnalysisTool.tsx\nsrc/components/SideProfileManualTool.tsx\nsrc/hooks/useZoomPan.ts\nsrc/components/GuidedLandmarkPlacement.tsx\nsrc/components/LandmarkDot.tsx"}]},"uuid":"47a8762d-de22-4736-a367-7133d51eb9ce","timestamp":"2025-12-27T03:19:56.926Z","toolUseResult":{"mode":"files_with_matches","filenames":["src/lib/mediapipeDetection.ts","src/components/LandmarkAnalysisTool.tsx","src/components/SideProfileManualTool.tsx","src/hooks/useZoomPan.ts","src/components/GuidedLandmarkPlacement.tsx","src/components/LandmarkDot.tsx"],"numFiles":6}}
{"parentUuid":"47a8762d-de22-4736-a367-7133d51eb9ce","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Rj7Rqzo9Ct6EMk41VejrPt","type":"message","role":"assistant","content":[{"type":"text","text":"Let me check the GuidedLandmarkPlacement component as well:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":6258,"cache_read_input_tokens":87434,"cache_creation":{"ephemeral_5m_input_tokens":6258,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWWUFvUTREU4hbNudVo8i","type":"assistant","uuid":"81525263-cb72-455b-aa7d-94f31dd825fb","timestamp":"2025-12-27T03:20:00.454Z"}
{"parentUuid":"81525263-cb72-455b-aa7d-94f31dd825fb","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01Rj7Rqzo9Ct6EMk41VejrPt","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KoBQs1bLEiJRkieCGW7zoq","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/GuidedLandmarkPlacement.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":6258,"cache_read_input_tokens":87434,"cache_creation":{"ephemeral_5m_input_tokens":6258,"ephemeral_1h_input_tokens":0},"output_tokens":103,"service_tier":"standard"}},"requestId":"req_011CWWUFvUTREU4hbNudVo8i","type":"assistant","uuid":"3860c112-7a21-4f0d-b982-88901ce6b498","timestamp":"2025-12-27T03:20:00.913Z"}
{"parentUuid":"3860c112-7a21-4f0d-b982-88901ce6b498","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KoBQs1bLEiJRkieCGW7zoq","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useState, useRef, useCallback, useEffect } from 'react';\n     4→import Image from 'next/image';\n     5→import { motion } from 'framer-motion';\n     6→import {\n     7→  ChevronLeft,\n     8→  ChevronRight,\n     9→  ChevronUp,\n    10→  ChevronDown,\n    11→  ZoomIn,\n    12→  ZoomOut,\n    13→  RotateCcw,\n    14→  Check,\n    15→  Circle,\n    16→  Info,\n    17→  Maximize2,\n    18→  Minimize2,\n    19→} from 'lucide-react';\n    20→import {\n    21→  LandmarkPoint,\n    22→  FRONT_PROFILE_LANDMARKS,\n    23→  getLandmarkColor,\n    24→  FRONT_LANDMARK_CATEGORIES,\n    25→} from '@/lib/landmarks';\n    26→import {\n    27→  getLandmarkImagePath,\n    28→  getLandmarkPlacementGuide,\n    29→} from '@/lib/landmarkImages';\n    30→\n    31→interface GuidedLandmarkPlacementProps {\n    32→  imageUrl: string;\n    33→  initialLandmarks?: LandmarkPoint[];\n    34→  onLandmarksChange?: (landmarks: LandmarkPoint[]) => void;\n    35→  onComplete?: (landmarks: LandmarkPoint[]) => void;\n    36→}\n    37→\n    38→// Keyboard key component with 3D effect\n    39→function KeyboardKey({ isPressed, icon }: { isPressed: boolean; icon: React.ReactNode }) {\n    40→  return (\n    41→    <div className=\"relative w-9 h-9\">\n    42→      <div\n    43→        className={`absolute inset-0 rounded-md transition-colors duration-75 ${\n    44→          isPressed ? 'bg-accent/50' : 'bg-white/20'\n    45→        }`}\n    46→        style={{ transform: 'translateY(3px)' }}\n    47→      />\n    48→      <div\n    49→        className={`relative w-full h-full rounded-md border flex items-center justify-center transition-colors duration-75 ${\n    50→          isPressed\n    51→            ? 'bg-accent border-accent text-black'\n    52→            : 'bg-background-secondary border-border text-foreground-dim'\n    53→        }`}\n    54→        style={{\n    55→          boxShadow: isPressed\n    56→            ? 'none'\n    57→            : 'rgba(0, 0, 0, 0.2) 0px -1px 0px inset, rgba(0, 0, 0, 0.1) 0px 1px 2px',\n    58→          transform: isPressed ? 'translateY(2px)' : 'none',\n    59→        }}\n    60→      >\n    61→        {icon}\n    62→      </div>\n    63→    </div>\n    64→  );\n    65→}\n    66→\n    67→export function GuidedLandmarkPlacement({\n    68→  imageUrl,\n    69→  initialLandmarks,\n    70→  onLandmarksChange,\n    71→  onComplete,\n    72→}: GuidedLandmarkPlacementProps) {\n    73→  const containerRef = useRef<HTMLDivElement>(null);\n    74→  const [landmarks, setLandmarks] = useState<LandmarkPoint[]>(\n    75→    initialLandmarks || FRONT_PROFILE_LANDMARKS\n    76→  );\n    77→  const [currentStepIndex, setCurrentStepIndex] = useState(0);\n    78→  const [zoomLevel, setZoomLevel] = useState<1 | 2 | 3>(1); // 1=2x, 2=4x, 3=8x\n    79→  const zoom = zoomLevel === 1 ? 2 : zoomLevel === 2 ? 4 : 8;\n    80→  const [pan, setPan] = useState({ x: 0, y: 0 });\n    81→  const [isDragging, setIsDragging] = useState(false);\n    82→  const [showAllPoints, setShowAllPoints] = useState(false);\n    83→  const [isFullscreen, setIsFullscreen] = useState(false);\n    84→  const [referenceImageError, setReferenceImageError] = useState(false);\n    85→  const [activeTab, setActiveTab] = useState<'photo' | 'diagram' | 'howToFind'>('photo');\n    86→  const [pressedKey, setPressedKey] = useState<string | null>(null);\n    87→\n    88→  // Use landmark order from FRONT_PROFILE_LANDMARKS\n    89→  const landmarkOrder = FRONT_PROFILE_LANDMARKS.map(lm => lm.id);\n    90→  const currentLandmarkId = landmarkOrder[currentStepIndex];\n    91→  const currentLandmark = landmarks.find((lm) => lm.id === currentLandmarkId);\n    92→  const totalSteps = landmarkOrder.length;\n    93→  const progress = ((currentStepIndex + 1) / totalSteps) * 100;\n    94→\n    95→  useEffect(() => {\n    96→    onLandmarksChange?.(landmarks);\n    97→  }, [landmarks, onLandmarksChange]);\n    98→\n    99→  useEffect(() => {\n   100→    // Reset reference image error when step changes\n   101→    setReferenceImageError(false);\n   102→  }, [currentStepIndex]);\n   103→\n   104→  const updateLandmarkPosition = useCallback(\n   105→    (x: number, y: number) => {\n   106→      setLandmarks((prev) =>\n   107→        prev.map((lm) =>\n   108→          lm.id === currentLandmarkId ? { ...lm, x, y } : lm\n   109→        )\n   110→      );\n   111→    },\n   112→    [currentLandmarkId]\n   113→  );\n   114→\n   115→  const handleContainerClick = useCallback(\n   116→    (e: React.MouseEvent<HTMLDivElement>) => {\n   117→      if (!containerRef.current || isDragging) return;\n   118→\n   119→      const rect = containerRef.current.getBoundingClientRect();\n   120→      const rawX = (e.clientX - rect.left - rect.width / 2 - pan.x) / zoom + rect.width / 2;\n   121→      const rawY = (e.clientY - rect.top - rect.height / 2 - pan.y) / zoom + rect.height / 2;\n   122→\n   123→      const x = Math.max(0, Math.min(1, rawX / rect.width));\n   124→      const y = Math.max(0, Math.min(1, rawY / rect.height));\n   125→\n   126→      updateLandmarkPosition(x, y);\n   127→    },\n   128→    [isDragging, pan, zoom, updateLandmarkPosition]\n   129→  );\n   130→\n   131→  const handleMouseDown = useCallback(\n   132→    (e: React.MouseEvent) => {\n   133→      if (e.button === 0 && zoom > 1) {\n   134→        // Only allow panning when zoomed in\n   135→        setIsDragging(true);\n   136→      }\n   137→    },\n   138→    [zoom]\n   139→  );\n   140→\n   141→  const handleMouseMove = useCallback(\n   142→    (e: React.MouseEvent) => {\n   143→      if (isDragging && zoom > 1) {\n   144→        setPan((prev) => ({\n   145→          x: prev.x + e.movementX,\n   146→          y: prev.y + e.movementY,\n   147→        }));\n   148→      }\n   149→    },\n   150→    [isDragging, zoom]\n   151→  );\n   152→\n   153→  const handleMouseUp = useCallback(() => {\n   154→    setIsDragging(false);\n   155→  }, []);\n   156→\n   157→  const handleZoomIn = () => {\n   158→    if (zoomLevel >= 3) return;\n   159→    const newLevel = (zoomLevel + 1) as 2 | 3;\n   160→    // Adjust pan to keep the same center point visible\n   161→    const oldZoom = zoom;\n   162→    const newZoom = newLevel === 2 ? 4 : 8;\n   163→    const zoomRatio = newZoom / oldZoom;\n   164→    setPan(prev => ({\n   165→      x: prev.x * zoomRatio,\n   166→      y: prev.y * zoomRatio,\n   167→    }));\n   168→    setZoomLevel(newLevel);\n   169→  };\n   170→\n   171→  const handleZoomOut = () => {\n   172→    if (zoomLevel <= 1) return;\n   173→    const newLevel = (zoomLevel - 1) as 1 | 2;\n   174→    if (newLevel === 1) {\n   175→      setPan({ x: 0, y: 0 });\n   176→    } else {\n   177→      // Adjust pan to keep the same center point visible\n   178→      const oldZoom = zoom;\n   179→      const newZoom = 4; // level 2 = 4x\n   180→      const zoomRatio = newZoom / oldZoom;\n   181→      setPan(prev => ({\n   182→        x: prev.x * zoomRatio,\n   183→        y: prev.y * zoomRatio,\n   184→      }));\n   185→    }\n   186→    setZoomLevel(newLevel);\n   187→  };\n   188→\n   189→  const handleResetZoom = () => {\n   190→    setZoomLevel(1);\n   191→    setPan({ x: 0, y: 0 });\n   192→  };\n   193→\n   194→  const handleSetZoomLevel = useCallback((level: 1 | 2 | 3) => {\n   195→    if (level === 1) {\n   196→      // Reset to level 1: no pan\n   197→      setZoomLevel(1);\n   198→      setPan({ x: 0, y: 0 });\n   199→    } else {\n   200→      // Adjust pan to keep the same center point visible when zoom changes\n   201→      // Transform is: scale(zoom) translate(pan.x / zoom, pan.y / zoom) with origin center\n   202→      // Effective offset = pan / zoom, so to maintain same offset: newPan / newZoom = oldPan / oldZoom\n   203→      // Therefore: newPan = oldPan * newZoom / oldZoom\n   204→      const newZoom = level === 2 ? 4 : 8;\n   205→      const zoomRatio = newZoom / zoom;\n   206→      setPan(prev => ({\n   207→        x: prev.x * zoomRatio,\n   208→        y: prev.y * zoomRatio,\n   209→      }));\n   210→      setZoomLevel(level);\n   211→    }\n   212→  }, [zoom]);\n   213→\n   214→  // Arrow key movement for fine landmark adjustment\n   215→  const moveLandmark = useCallback((direction: 'up' | 'down' | 'left' | 'right') => {\n   216→    const step = 0.002; // Small step for fine adjustment\n   217→    setLandmarks((prev) =>\n   218→      prev.map((lm) => {\n   219→        if (lm.id !== currentLandmarkId) return lm;\n   220→        let newX = lm.x;\n   221→        let newY = lm.y;\n   222→        switch (direction) {\n   223→          case 'up': newY = Math.max(0, lm.y - step); break;\n   224→          case 'down': newY = Math.min(1, lm.y + step); break;\n   225→          case 'left': newX = Math.max(0, lm.x - step); break;\n   226→          case 'right': newX = Math.min(1, lm.x + step); break;\n   227→        }\n   228→        return { ...lm, x: newX, y: newY };\n   229→      })\n   230→    );\n   231→  }, [currentLandmarkId]);\n   232→\n   233→  const handleNext = useCallback(() => {\n   234→    if (currentStepIndex < totalSteps - 1) {\n   235→      setCurrentStepIndex((prev) => prev + 1);\n   236→      handleResetZoom();\n   237→    } else {\n   238→      onComplete?.(landmarks);\n   239→    }\n   240→  }, [currentStepIndex, totalSteps, landmarks, onComplete]);\n   241→\n   242→  const handlePrevious = useCallback(() => {\n   243→    if (currentStepIndex > 0) {\n   244→      setCurrentStepIndex((prev) => prev - 1);\n   245→      handleResetZoom();\n   246→    }\n   247→  }, [currentStepIndex]);\n   248→\n   249→  const handleSkipToEnd = useCallback(() => {\n   250→    onComplete?.(landmarks);\n   251→  }, [landmarks, onComplete]);\n   252→\n   253→  // Keyboard event handler\n   254→  useEffect(() => {\n   255→    const handleKeyDown = (e: KeyboardEvent) => {\n   256→      // Prevent default for our shortcuts\n   257→      if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Enter', 'Backspace', 'r', 'R', '1', '2', '3'].includes(e.key)) {\n   258→        e.preventDefault();\n   259→      }\n   260→\n   261→      setPressedKey(e.key);\n   262→\n   263→      switch (e.key) {\n   264→        case 'ArrowUp':\n   265→          moveLandmark('up');\n   266→          break;\n   267→        case 'ArrowDown':\n   268→          moveLandmark('down');\n   269→          break;\n   270→        case 'ArrowLeft':\n   271→          moveLandmark('left');\n   272→          break;\n   273→        case 'ArrowRight':\n   274→          moveLandmark('right');\n   275→          break;\n   276→        case 'Enter':\n   277→          handleNext();\n   278→          break;\n   279→        case 'Backspace':\n   280→          handlePrevious();\n   281→          break;\n   282→        case 'r':\n   283→        case 'R':\n   284→          handleResetZoom();\n   285→          break;\n   286→        case '1':\n   287→          handleSetZoomLevel(1);\n   288→          break;\n   289→        case '2':\n   290→          handleSetZoomLevel(2);\n   291→          break;\n   292→        case '3':\n   293→          handleSetZoomLevel(3);\n   294→          break;\n   295→      }\n   296→    };\n   297→\n   298→    const handleKeyUp = () => {\n   299→      setPressedKey(null);\n   300→    };\n   301→\n   302→    window.addEventListener('keydown', handleKeyDown);\n   303→    window.addEventListener('keyup', handleKeyUp);\n   304→    return () => {\n   305→      window.removeEventListener('keydown', handleKeyDown);\n   306→      window.removeEventListener('keyup', handleKeyUp);\n   307→    };\n   308→  }, [moveLandmark, handleNext, handlePrevious, handleSetZoomLevel]);\n   309→\n   310→  const referenceImageUrl = currentLandmarkId\n   311→    ? getLandmarkImagePath(currentLandmarkId, 'front', 'infographic')\n   312→    : null;\n   313→\n   314→  const placementGuide = currentLandmarkId\n   315→    ? getLandmarkPlacementGuide(currentLandmarkId, 'front')\n   316→    : '';\n   317→\n   318→  const color = currentLandmark\n   319→    ? getLandmarkColor(currentLandmark.id, FRONT_LANDMARK_CATEGORIES)\n   320→    : '#00f3ff';\n   321→\n   322→  return (\n   323→    <div className=\"w-full max-w-6xl mx-auto\">\n   324→      {/* Progress Bar */}\n   325→      <div className=\"mb-4\">\n   326→        <div className=\"flex items-center justify-between mb-2\">\n   327→          <span className=\"text-sm text-foreground-dim\">\n   328→            Step {currentStepIndex + 1} of {totalSteps}\n   329→          </span>\n   330→          <span className=\"text-sm text-foreground-dim\">\n   331→            {Math.round(progress)}% Complete\n   332→          </span>\n   333→        </div>\n   334→        <div className=\"h-2 bg-background-tertiary rounded-full overflow-hidden\">\n   335→          <motion.div\n   336→            className=\"h-full bg-accent\"\n   337→            initial={{ width: 0 }}\n   338→            animate={{ width: `${progress}%` }}\n   339→            transition={{ duration: 0.3 }}\n   340→          />\n   341→        </div>\n   342→      </div>\n   343→\n   344→      {/* Main Content Grid */}\n   345→      <div className=\"grid lg:grid-cols-3 gap-6\">\n   346→        {/* Left Panel - Reference Image and Instructions */}\n   347→        <div className=\"lg:col-span-1 space-y-4\">\n   348→          {/* Current Landmark Info Card */}\n   349→          <motion.div\n   350→            key={currentLandmarkId}\n   351→            initial={{ opacity: 0, y: 10 }}\n   352→            animate={{ opacity: 1, y: 0 }}\n   353→            className=\"bg-background-secondary rounded-xl border border-border p-4\"\n   354→          >\n   355→            <div className=\"flex items-center gap-3 mb-3\">\n   356→              <div\n   357→                className=\"w-4 h-4 rounded-full border-2 border-white\"\n   358→                style={{ backgroundColor: color }}\n   359→              />\n   360→              <div>\n   361→                <h3 className=\"text-lg font-semibold text-white\">\n   362→                  {currentLandmark?.label}\n   363→                </h3>\n   364→                <p className=\"text-xs text-accent\">{currentLandmark?.medicalTerm}</p>\n   365→              </div>\n   366→            </div>\n   367→\n   368→            <div className=\"flex items-start gap-2 text-sm text-foreground-dim\">\n   369→              <Info className=\"w-4 h-4 mt-0.5 flex-shrink-0\" />\n   370→              <p>{currentLandmark?.description}</p>\n   371→            </div>\n   372→          </motion.div>\n   373→\n   374→          {/* Reference with Tabs */}\n   375→          <motion.div\n   376→            key={`ref-${currentLandmarkId}`}\n   377→            initial={{ opacity: 0, scale: 0.95 }}\n   378→            animate={{ opacity: 1, scale: 1 }}\n   379→            className=\"bg-background-secondary rounded-xl border border-border overflow-hidden\"\n   380→          >\n   381→            {/* Tab Navigation */}\n   382→            <div className=\"flex border-b border-border\">\n   383→              <button\n   384→                onClick={() => setActiveTab('photo')}\n   385→                className={`flex-1 px-3 py-2.5 text-xs font-medium transition-colors ${\n   386→                  activeTab === 'photo'\n   387→                    ? 'text-white border-b-2 border-accent'\n   388→                    : 'text-foreground-dim hover:text-white'\n   389→                }`}\n   390→              >\n   391→                Photo\n   392→              </button>\n   393→              <button\n   394→                onClick={() => setActiveTab('diagram')}\n   395→                className={`flex-1 px-3 py-2.5 text-xs font-medium transition-colors ${\n   396→                  activeTab === 'diagram'\n   397→                    ? 'text-white border-b-2 border-accent'\n   398→                    : 'text-foreground-dim hover:text-white'\n   399→                }`}\n   400→              >\n   401→                Diagram\n   402→              </button>\n   403→              <button\n   404→                onClick={() => setActiveTab('howToFind')}\n   405→                className={`flex-1 px-3 py-2.5 text-xs font-medium transition-colors ${\n   406→                  activeTab === 'howToFind'\n   407→                    ? 'text-white border-b-2 border-accent'\n   408→                    : 'text-foreground-dim hover:text-white'\n   409→                }`}\n   410→              >\n   411→                How to Find\n   412→              </button>\n   413→            </div>\n   414→\n   415→            {/* Tab Content */}\n   416→            <div className=\"relative aspect-square bg-black/50\">\n   417→              {activeTab === 'photo' && (\n   418→                <>\n   419→                  {referenceImageUrl && !referenceImageError ? (\n   420→                    <Image\n   421→                      src={referenceImageUrl}\n   422→                      alt={`Reference for ${currentLandmark?.label}`}\n   423→                      fill\n   424→                      className=\"object-contain p-4\"\n   425→                      unoptimized\n   426→                      onError={() => setReferenceImageError(true)}\n   427→                    />\n   428→                  ) : (\n   429→                    <div className=\"absolute inset-0 flex items-center justify-center p-4 text-center\">\n   430→                      <div>\n   431→                        <div\n   432→                          className=\"w-16 h-16 rounded-full mx-auto mb-3 border-4 border-dashed flex items-center justify-center\"\n   433→                          style={{ borderColor: color }}\n   434→                        >\n   435→                          <Circle className=\"w-6 h-6\" style={{ color: color }} />\n   436→                        </div>\n   437→                        <p className=\"text-foreground-dim text-sm\">Reference photo</p>\n   438→                      </div>\n   439→                    </div>\n   440→                  )}\n   441→                </>\n   442→              )}\n   443→\n   444→              {activeTab === 'diagram' && (\n   445→                <div className=\"absolute inset-0 flex items-center justify-center p-4 text-center\">\n   446→                  <div>\n   447→                    <div\n   448→                      className=\"w-16 h-16 rounded-full mx-auto mb-3 border-4 border-dashed flex items-center justify-center\"\n   449→                      style={{ borderColor: color }}\n   450→                    >\n   451→                      <Circle className=\"w-6 h-6\" style={{ color: color }} />\n   452→                    </div>\n   453→                    <p className=\"text-foreground-dim text-sm\">Anatomical diagram</p>\n   454→                  </div>\n   455→                </div>\n   456→              )}\n   457→\n   458→              {activeTab === 'howToFind' && (\n   459→                <div className=\"absolute inset-0 flex items-center justify-center p-6\">\n   460→                  <div className=\"text-center\">\n   461→                    <Info className=\"w-8 h-8 mx-auto mb-3\" style={{ color: color }} />\n   462→                    <p className=\"text-white text-sm\">{placementGuide}</p>\n   463→                  </div>\n   464→                </div>\n   465→              )}\n   466→            </div>\n   467→          </motion.div>\n   468→\n   469→          {/* Placement Guide Text */}\n   470→          <div className=\"bg-accent/10 rounded-xl border border-accent/30 p-4\">\n   471→            <p className=\"text-sm text-accent\">{placementGuide}</p>\n   472→          </div>\n   473→\n   474→          {/* Quick Actions */}\n   475→          <div className=\"flex gap-2\">\n   476→            <button\n   477→              onClick={() => setShowAllPoints(!showAllPoints)}\n   478→              className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors ${\n   479→                showAllPoints\n   480→                  ? 'bg-accent text-black'\n   481→                  : 'bg-white/10 text-foreground-dim hover:bg-white/20'\n   482→              }`}\n   483→            >\n   484→              {showAllPoints ? 'Hide Other Points' : 'Show All Points'}\n   485→            </button>\n   486→            <button\n   487→              onClick={handleSkipToEnd}\n   488→              className=\"py-2 px-4 rounded-lg text-sm font-medium bg-white/10 text-foreground-dim hover:bg-white/20 transition-colors\"\n   489→            >\n   490→              Skip to End\n   491→            </button>\n   492→          </div>\n   493→\n   494→          {/* Keyboard Shortcuts Panel */}\n   495→          <div className=\"hidden lg:block bg-background-secondary rounded-xl border border-border p-4\">\n   496→            <p className=\"text-xs text-foreground-dim font-medium uppercase tracking-wide mb-3\">\n   497→              Keyboard Shortcuts\n   498→            </p>\n   499→\n   500→            {/* Arrow Keys Visual */}\n   501→            <div className=\"flex justify-center mb-4\">\n   502→              <div className=\"flex flex-col gap-1 items-center\">\n   503→                <KeyboardKey\n   504→                  isPressed={pressedKey === 'ArrowUp'}\n   505→                  icon={<ChevronUp className=\"w-4 h-4\" />}\n   506→                />\n   507→                <div className=\"flex gap-1\">\n   508→                  <KeyboardKey\n   509→                    isPressed={pressedKey === 'ArrowLeft'}\n   510→                    icon={<ChevronLeft className=\"w-4 h-4\" />}\n   511→                  />\n   512→                  <KeyboardKey\n   513→                    isPressed={pressedKey === 'ArrowDown'}\n   514→                    icon={<ChevronDown className=\"w-4 h-4\" />}\n   515→                  />\n   516→                  <KeyboardKey\n   517→                    isPressed={pressedKey === 'ArrowRight'}\n   518→                    icon={<ChevronRight className=\"w-4 h-4\" />}\n   519→                  />\n   520→                </div>\n   521→              </div>\n   522→            </div>\n   523→\n   524→            {/* Shortcut List */}\n   525→            <div className=\"space-y-2\">\n   526→              <div className=\"flex items-center gap-3\">\n   527→                <span className={`px-2 py-1 text-xs font-mono rounded border transition-colors ${\n   528→                  pressedKey === 'Enter'\n   529→                    ? 'bg-accent border-accent text-black'\n   530→                    : 'bg-white/10 border-border text-foreground-dim'\n   531→                }`}>\n   532→                  Enter\n   533→                </span>\n   534→                <span className=\"text-xs text-foreground-dim\">Next / Confirm</span>\n   535→              </div>\n   536→              <div className=\"flex items-center gap-3\">\n   537→                <span className={`px-2 py-1 text-xs font-mono rounded border transition-colors ${\n   538→                  pressedKey === 'Backspace'\n   539→                    ? 'bg-accent border-accent text-black'\n   540→                    : 'bg-white/10 border-border text-foreground-dim'\n   541→                }`}>\n   542→                  Backspace\n   543→                </span>\n   544→                <span className=\"text-xs text-foreground-dim\">Previous</span>\n   545→              </div>\n   546→              <div className=\"flex items-center gap-3\">\n   547→                <span className={`px-2 py-1 text-xs font-mono rounded border transition-colors ${\n   548→                  pressedKey === 'r' || pressedKey === 'R'\n   549→                    ? 'bg-accent border-accent text-black'\n   550→                    : 'bg-white/10 border-border text-foreground-dim'\n   551→                }`}>\n   552→                  R\n   553→                </span>\n   554→                <span className=\"text-xs text-foreground-dim\">Reset</span>\n   555→              </div>\n   556→            </div>\n   557→          </div>\n   558→\n   559→          {/* Zoom Level Panel */}\n   560→          <div className=\"hidden lg:block bg-background-secondary rounded-xl border border-border p-4\">\n   561→            <p className=\"text-xs text-foreground-dim font-medium uppercase tracking-wide mb-3\">\n   562→              Zoom Level\n   563→            </p>\n   564→            <div className=\"flex gap-2\">\n   565→              {([1, 2, 3] as const).map((level) => (\n   566→                <button\n   567→                  key={level}\n   568→                  onClick={() => handleSetZoomLevel(level)}\n   569→                  className={`flex-1 flex flex-col items-center gap-1 py-2 px-3 rounded-lg border transition-colors ${\n   570→                    zoomLevel === level\n   571→                      ? 'bg-accent border-accent text-black'\n   572→                      : 'bg-white/10 border-border text-foreground-dim hover:bg-white/20'\n   573→                  }`}\n   574→                >\n   575→                  <span className=\"text-xs font-mono\">{level}</span>\n   576→                  <span className=\"text-[10px]\">{level === 1 ? '2x' : level === 2 ? '4x' : '8x'}</span>\n   577→                </button>\n   578→              ))}\n   579→            </div>\n   580→          </div>\n   581→        </div>\n   582→\n   583→        {/* Right Panel - Image Canvas */}\n   584→        <div className=\"lg:col-span-2\">\n   585→          {/* Zoom Controls */}\n   586→          <div className=\"flex items-center justify-between mb-3\">\n   587→            <div className=\"flex items-center gap-2\">\n   588→              <button\n   589→                onClick={handleZoomOut}\n   590→                disabled={zoomLevel <= 1}\n   591→                className=\"p-2 rounded-lg bg-white/10 text-white hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n   592→              >\n   593→                <ZoomOut className=\"w-5 h-5\" />\n   594→              </button>\n   595→              <span className=\"text-sm text-foreground-dim min-w-[4rem] text-center\">\n   596→                {Math.round(zoom * 100)}%\n   597→              </span>\n   598→              <button\n   599→                onClick={handleZoomIn}\n   600→                disabled={zoomLevel >= 3}\n   601→                className=\"p-2 rounded-lg bg-white/10 text-white hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n   602→              >\n   603→                <ZoomIn className=\"w-5 h-5\" />\n   604→              </button>\n   605→              <button\n   606→                onClick={handleResetZoom}\n   607→                disabled={zoomLevel === 1}\n   608→                className=\"p-2 rounded-lg bg-white/10 text-white hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n   609→              >\n   610→                <RotateCcw className=\"w-5 h-5\" />\n   611→              </button>\n   612→            </div>\n   613→\n   614→            <button\n   615→              onClick={() => setIsFullscreen(!isFullscreen)}\n   616→              className=\"p-2 rounded-lg bg-white/10 text-white hover:bg-white/20 transition-colors\"\n   617→            >\n   618→              {isFullscreen ? (\n   619→                <Minimize2 className=\"w-5 h-5\" />\n   620→              ) : (\n   621→                <Maximize2 className=\"w-5 h-5\" />\n   622→              )}\n   623→            </button>\n   624→          </div>\n   625→\n   626→          {/* Image Canvas */}\n   627→          <motion.div\n   628→            layout\n   629→            className={`relative rounded-2xl overflow-hidden bg-black border border-border ${\n   630→              isFullscreen ? 'fixed inset-4 z-50' : 'aspect-[3/4]'\n   631→            }`}\n   632→          >\n   633→            {/* Fullscreen overlay background */}\n   634→            {isFullscreen && (\n   635→              <div\n   636→                className=\"fixed inset-0 bg-black/90 -z-10\"\n   637→                onClick={() => setIsFullscreen(false)}\n   638→              />\n   639→            )}\n   640→\n   641→            <div\n   642→              ref={containerRef}\n   643→              className=\"absolute inset-0 cursor-crosshair overflow-hidden\"\n   644→              onClick={handleContainerClick}\n   645→              onMouseDown={handleMouseDown}\n   646→              onMouseMove={handleMouseMove}\n   647→              onMouseUp={handleMouseUp}\n   648→              onMouseLeave={handleMouseUp}\n   649→              style={{\n   650→                cursor: zoom > 1 && isDragging ? 'grabbing' : zoom > 1 ? 'grab' : 'crosshair',\n   651→              }}\n   652→            >\n   653→              {/* Transformed Image Container */}\n   654→              <div\n   655→                className=\"absolute inset-0 transition-transform duration-100\"\n   656→                style={{\n   657→                  transform: `scale(${zoom}) translate(${pan.x / zoom}px, ${pan.y / zoom}px)`,\n   658→                  transformOrigin: 'center center',\n   659→                }}\n   660→              >\n   661→                {/* User's Image */}\n   662→                <Image\n   663→                  src={imageUrl}\n   664→                  alt=\"Your photo\"\n   665→                  fill\n   666→                  className=\"object-contain pointer-events-none select-none\"\n   667→                  unoptimized\n   668→                  draggable={false}\n   669→                />\n   670→\n   671→                {/* All Landmarks (dimmed) */}\n   672→                {showAllPoints &&\n   673→                  landmarks.map((landmark) => {\n   674→                    if (landmark.id === currentLandmarkId) return null;\n   675→                    const lmColor = getLandmarkColor(landmark.id, FRONT_LANDMARK_CATEGORIES);\n   676→                    return (\n   677→                      <div\n   678→                        key={landmark.id}\n   679→                        className=\"absolute w-3 h-3 -translate-x-1/2 -translate-y-1/2 pointer-events-none\"\n   680→                        style={{\n   681→                          left: `${landmark.x * 100}%`,\n   682→                          top: `${landmark.y * 100}%`,\n   683→                          opacity: 0.3,\n   684→                        }}\n   685→                      >\n   686→                        <div\n   687→                          className=\"w-full h-full rounded-full border border-white/50\"\n   688→                          style={{ backgroundColor: lmColor }}\n   689→                        />\n   690→                      </div>\n   691→                    );\n   692→                  })}\n   693→\n   694→                {/* Current Landmark (highlighted) */}\n   695→                {currentLandmark && (\n   696→                  <motion.div\n   697→                    key={currentLandmarkId}\n   698→                    initial={{ scale: 0 }}\n   699→                    animate={{ scale: 1 }}\n   700→                    className=\"absolute w-6 h-6 -translate-x-1/2 -translate-y-1/2 z-20\"\n   701→                    style={{\n   702→                      left: `${currentLandmark.x * 100}%`,\n   703→                      top: `${currentLandmark.y * 100}%`,\n   704→                    }}\n   705→                  >\n   706→                    {/* Pulsing ring */}\n   707→                    <motion.div\n   708→                      className=\"absolute inset-0 rounded-full\"\n   709→                      style={{ borderColor: color }}\n   710→                      animate={{\n   711→                        scale: [1, 1.5, 1],\n   712→                        opacity: [0.8, 0, 0.8],\n   713→                      }}\n   714→                      transition={{\n   715→                        duration: 2,\n   716→                        repeat: Infinity,\n   717→                        ease: 'easeInOut',\n   718→                      }}\n   719→                    >\n   720→                      <div\n   721→                        className=\"w-full h-full rounded-full border-2\"\n   722→                        style={{ borderColor: color }}\n   723→                      />\n   724→                    </motion.div>\n   725→\n   726→                    {/* Main dot */}\n   727→                    <div\n   728→                      className=\"absolute inset-1 rounded-full border-2 border-white shadow-lg\"\n   729→                      style={{\n   730→                        backgroundColor: color,\n   731→                        boxShadow: `0 0 20px ${color}`,\n   732→                      }}\n   733→                    />\n   734→\n   735→                    {/* Crosshair */}\n   736→                    <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\n   737→                      <div\n   738→                        className=\"absolute w-8 h-[2px] -translate-x-1/2 left-1/2\"\n   739→                        style={{ backgroundColor: `${color}80` }}\n   740→                      />\n   741→                      <div\n   742→                        className=\"absolute h-8 w-[2px] -translate-y-1/2 top-1/2\"\n   743→                        style={{ backgroundColor: `${color}80` }}\n   744→                      />\n   745→                    </div>\n   746→                  </motion.div>\n   747→                )}\n   748→              </div>\n   749→\n   750→              {/* Zoom indicator in corner */}\n   751→              {zoom > 1 && (\n   752→                <div className=\"absolute top-3 left-3 px-2 py-1 rounded bg-black/70 text-white text-xs\">\n   753→                  {Math.round(zoom * 100)}% - Drag to pan\n   754→                </div>\n   755→              )}\n   756→            </div>\n   757→\n   758→            {/* Instructions overlay */}\n   759→            <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4\">\n   760→              <p className=\"text-center text-white text-sm\">\n   761→                Click on the image to place the{' '}\n   762→                <span style={{ color: color }}>{currentLandmark?.label}</span> landmark\n   763→              </p>\n   764→            </div>\n   765→          </motion.div>\n   766→\n   767→          {/* Navigation Buttons */}\n   768→          <div className=\"flex items-center justify-between mt-4\">\n   769→            <button\n   770→              onClick={handlePrevious}\n   771→              disabled={currentStepIndex === 0}\n   772→              className=\"flex items-center gap-2 px-4 py-3 rounded-lg bg-white/10 text-white hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n   773→            >\n   774→              <ChevronLeft className=\"w-5 h-5\" />\n   775→              Previous\n   776→            </button>\n   777→\n   778→            <div className=\"flex items-center gap-1\">\n   779→              {/* Step indicators - show subset around current */}\n   780→              {Array.from({ length: Math.min(7, totalSteps) }).map((_, i) => {\n   781→                let stepIndex: number;\n   782→                if (totalSteps <= 7) {\n   783→                  stepIndex = i;\n   784→                } else if (currentStepIndex < 3) {\n   785→                  stepIndex = i;\n   786→                } else if (currentStepIndex > totalSteps - 4) {\n   787→                  stepIndex = totalSteps - 7 + i;\n   788→                } else {\n   789→                  stepIndex = currentStepIndex - 3 + i;\n   790→                }\n   791→\n   792→                const isCompleted = stepIndex < currentStepIndex;\n   793→                const isCurrent = stepIndex === currentStepIndex;\n   794→\n   795→                return (\n   796→                  <button\n   797→                    key={stepIndex}\n   798→                    onClick={() => {\n   799→                      setCurrentStepIndex(stepIndex);\n   800→                      handleResetZoom();\n   801→                    }}\n   802→                    className={`w-2 h-2 rounded-full transition-all ${\n   803→                      isCurrent\n   804→                        ? 'w-6 bg-accent'\n   805→                        : isCompleted\n   806→                          ? 'bg-green-500'\n   807→                          : 'bg-white/20'\n   808→                    }`}\n   809→                  />\n   810→                );\n   811→              })}\n   812→            </div>\n   813→\n   814→            <button\n   815→              onClick={handleNext}\n   816→              className=\"flex items-center gap-2 px-6 py-3 rounded-lg bg-accent text-black font-semibold hover:shadow-[0_0_20px_rgba(0,243,255,0.5)] transition-all\"\n   817→            >\n   818→              {currentStepIndex === totalSteps - 1 ? (\n   819→                <>\n   820→                  <Check className=\"w-5 h-5\" />\n   821→                  Complete\n   822→                </>\n   823→              ) : (\n   824→                <>\n   825→                  Next\n   826→                  <ChevronRight className=\"w-5 h-5\" />\n   827→                </>\n   828→              )}\n   829→            </button>\n   830→          </div>\n   831→        </div>\n   832→      </div>\n   833→    </div>\n   834→  );\n   835→}\n   836→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"5edda6a5-86ae-4954-9622-e1b0cd8130bf","timestamp":"2025-12-27T03:20:01.087Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/GuidedLandmarkPlacement.tsx","content":"'use client';\n\nimport { useState, useRef, useCallback, useEffect } from 'react';\nimport Image from 'next/image';\nimport { motion } from 'framer-motion';\nimport {\n  ChevronLeft,\n  ChevronRight,\n  ChevronUp,\n  ChevronDown,\n  ZoomIn,\n  ZoomOut,\n  RotateCcw,\n  Check,\n  Circle,\n  Info,\n  Maximize2,\n  Minimize2,\n} from 'lucide-react';\nimport {\n  LandmarkPoint,\n  FRONT_PROFILE_LANDMARKS,\n  getLandmarkColor,\n  FRONT_LANDMARK_CATEGORIES,\n} from '@/lib/landmarks';\nimport {\n  getLandmarkImagePath,\n  getLandmarkPlacementGuide,\n} from '@/lib/landmarkImages';\n\ninterface GuidedLandmarkPlacementProps {\n  imageUrl: string;\n  initialLandmarks?: LandmarkPoint[];\n  onLandmarksChange?: (landmarks: LandmarkPoint[]) => void;\n  onComplete?: (landmarks: LandmarkPoint[]) => void;\n}\n\n// Keyboard key component with 3D effect\nfunction KeyboardKey({ isPressed, icon }: { isPressed: boolean; icon: React.ReactNode }) {\n  return (\n    <div className=\"relative w-9 h-9\">\n      <div\n        className={`absolute inset-0 rounded-md transition-colors duration-75 ${\n          isPressed ? 'bg-accent/50' : 'bg-white/20'\n        }`}\n        style={{ transform: 'translateY(3px)' }}\n      />\n      <div\n        className={`relative w-full h-full rounded-md border flex items-center justify-center transition-colors duration-75 ${\n          isPressed\n            ? 'bg-accent border-accent text-black'\n            : 'bg-background-secondary border-border text-foreground-dim'\n        }`}\n        style={{\n          boxShadow: isPressed\n            ? 'none'\n            : 'rgba(0, 0, 0, 0.2) 0px -1px 0px inset, rgba(0, 0, 0, 0.1) 0px 1px 2px',\n          transform: isPressed ? 'translateY(2px)' : 'none',\n        }}\n      >\n        {icon}\n      </div>\n    </div>\n  );\n}\n\nexport function GuidedLandmarkPlacement({\n  imageUrl,\n  initialLandmarks,\n  onLandmarksChange,\n  onComplete,\n}: GuidedLandmarkPlacementProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [landmarks, setLandmarks] = useState<LandmarkPoint[]>(\n    initialLandmarks || FRONT_PROFILE_LANDMARKS\n  );\n  const [currentStepIndex, setCurrentStepIndex] = useState(0);\n  const [zoomLevel, setZoomLevel] = useState<1 | 2 | 3>(1); // 1=2x, 2=4x, 3=8x\n  const zoom = zoomLevel === 1 ? 2 : zoomLevel === 2 ? 4 : 8;\n  const [pan, setPan] = useState({ x: 0, y: 0 });\n  const [isDragging, setIsDragging] = useState(false);\n  const [showAllPoints, setShowAllPoints] = useState(false);\n  const [isFullscreen, setIsFullscreen] = useState(false);\n  const [referenceImageError, setReferenceImageError] = useState(false);\n  const [activeTab, setActiveTab] = useState<'photo' | 'diagram' | 'howToFind'>('photo');\n  const [pressedKey, setPressedKey] = useState<string | null>(null);\n\n  // Use landmark order from FRONT_PROFILE_LANDMARKS\n  const landmarkOrder = FRONT_PROFILE_LANDMARKS.map(lm => lm.id);\n  const currentLandmarkId = landmarkOrder[currentStepIndex];\n  const currentLandmark = landmarks.find((lm) => lm.id === currentLandmarkId);\n  const totalSteps = landmarkOrder.length;\n  const progress = ((currentStepIndex + 1) / totalSteps) * 100;\n\n  useEffect(() => {\n    onLandmarksChange?.(landmarks);\n  }, [landmarks, onLandmarksChange]);\n\n  useEffect(() => {\n    // Reset reference image error when step changes\n    setReferenceImageError(false);\n  }, [currentStepIndex]);\n\n  const updateLandmarkPosition = useCallback(\n    (x: number, y: number) => {\n      setLandmarks((prev) =>\n        prev.map((lm) =>\n          lm.id === currentLandmarkId ? { ...lm, x, y } : lm\n        )\n      );\n    },\n    [currentLandmarkId]\n  );\n\n  const handleContainerClick = useCallback(\n    (e: React.MouseEvent<HTMLDivElement>) => {\n      if (!containerRef.current || isDragging) return;\n\n      const rect = containerRef.current.getBoundingClientRect();\n      const rawX = (e.clientX - rect.left - rect.width / 2 - pan.x) / zoom + rect.width / 2;\n      const rawY = (e.clientY - rect.top - rect.height / 2 - pan.y) / zoom + rect.height / 2;\n\n      const x = Math.max(0, Math.min(1, rawX / rect.width));\n      const y = Math.max(0, Math.min(1, rawY / rect.height));\n\n      updateLandmarkPosition(x, y);\n    },\n    [isDragging, pan, zoom, updateLandmarkPosition]\n  );\n\n  const handleMouseDown = useCallback(\n    (e: React.MouseEvent) => {\n      if (e.button === 0 && zoom > 1) {\n        // Only allow panning when zoomed in\n        setIsDragging(true);\n      }\n    },\n    [zoom]\n  );\n\n  const handleMouseMove = useCallback(\n    (e: React.MouseEvent) => {\n      if (isDragging && zoom > 1) {\n        setPan((prev) => ({\n          x: prev.x + e.movementX,\n          y: prev.y + e.movementY,\n        }));\n      }\n    },\n    [isDragging, zoom]\n  );\n\n  const handleMouseUp = useCallback(() => {\n    setIsDragging(false);\n  }, []);\n\n  const handleZoomIn = () => {\n    if (zoomLevel >= 3) return;\n    const newLevel = (zoomLevel + 1) as 2 | 3;\n    // Adjust pan to keep the same center point visible\n    const oldZoom = zoom;\n    const newZoom = newLevel === 2 ? 4 : 8;\n    const zoomRatio = newZoom / oldZoom;\n    setPan(prev => ({\n      x: prev.x * zoomRatio,\n      y: prev.y * zoomRatio,\n    }));\n    setZoomLevel(newLevel);\n  };\n\n  const handleZoomOut = () => {\n    if (zoomLevel <= 1) return;\n    const newLevel = (zoomLevel - 1) as 1 | 2;\n    if (newLevel === 1) {\n      setPan({ x: 0, y: 0 });\n    } else {\n      // Adjust pan to keep the same center point visible\n      const oldZoom = zoom;\n      const newZoom = 4; // level 2 = 4x\n      const zoomRatio = newZoom / oldZoom;\n      setPan(prev => ({\n        x: prev.x * zoomRatio,\n        y: prev.y * zoomRatio,\n      }));\n    }\n    setZoomLevel(newLevel);\n  };\n\n  const handleResetZoom = () => {\n    setZoomLevel(1);\n    setPan({ x: 0, y: 0 });\n  };\n\n  const handleSetZoomLevel = useCallback((level: 1 | 2 | 3) => {\n    if (level === 1) {\n      // Reset to level 1: no pan\n      setZoomLevel(1);\n      setPan({ x: 0, y: 0 });\n    } else {\n      // Adjust pan to keep the same center point visible when zoom changes\n      // Transform is: scale(zoom) translate(pan.x / zoom, pan.y / zoom) with origin center\n      // Effective offset = pan / zoom, so to maintain same offset: newPan / newZoom = oldPan / oldZoom\n      // Therefore: newPan = oldPan * newZoom / oldZoom\n      const newZoom = level === 2 ? 4 : 8;\n      const zoomRatio = newZoom / zoom;\n      setPan(prev => ({\n        x: prev.x * zoomRatio,\n        y: prev.y * zoomRatio,\n      }));\n      setZoomLevel(level);\n    }\n  }, [zoom]);\n\n  // Arrow key movement for fine landmark adjustment\n  const moveLandmark = useCallback((direction: 'up' | 'down' | 'left' | 'right') => {\n    const step = 0.002; // Small step for fine adjustment\n    setLandmarks((prev) =>\n      prev.map((lm) => {\n        if (lm.id !== currentLandmarkId) return lm;\n        let newX = lm.x;\n        let newY = lm.y;\n        switch (direction) {\n          case 'up': newY = Math.max(0, lm.y - step); break;\n          case 'down': newY = Math.min(1, lm.y + step); break;\n          case 'left': newX = Math.max(0, lm.x - step); break;\n          case 'right': newX = Math.min(1, lm.x + step); break;\n        }\n        return { ...lm, x: newX, y: newY };\n      })\n    );\n  }, [currentLandmarkId]);\n\n  const handleNext = useCallback(() => {\n    if (currentStepIndex < totalSteps - 1) {\n      setCurrentStepIndex((prev) => prev + 1);\n      handleResetZoom();\n    } else {\n      onComplete?.(landmarks);\n    }\n  }, [currentStepIndex, totalSteps, landmarks, onComplete]);\n\n  const handlePrevious = useCallback(() => {\n    if (currentStepIndex > 0) {\n      setCurrentStepIndex((prev) => prev - 1);\n      handleResetZoom();\n    }\n  }, [currentStepIndex]);\n\n  const handleSkipToEnd = useCallback(() => {\n    onComplete?.(landmarks);\n  }, [landmarks, onComplete]);\n\n  // Keyboard event handler\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // Prevent default for our shortcuts\n      if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Enter', 'Backspace', 'r', 'R', '1', '2', '3'].includes(e.key)) {\n        e.preventDefault();\n      }\n\n      setPressedKey(e.key);\n\n      switch (e.key) {\n        case 'ArrowUp':\n          moveLandmark('up');\n          break;\n        case 'ArrowDown':\n          moveLandmark('down');\n          break;\n        case 'ArrowLeft':\n          moveLandmark('left');\n          break;\n        case 'ArrowRight':\n          moveLandmark('right');\n          break;\n        case 'Enter':\n          handleNext();\n          break;\n        case 'Backspace':\n          handlePrevious();\n          break;\n        case 'r':\n        case 'R':\n          handleResetZoom();\n          break;\n        case '1':\n          handleSetZoomLevel(1);\n          break;\n        case '2':\n          handleSetZoomLevel(2);\n          break;\n        case '3':\n          handleSetZoomLevel(3);\n          break;\n      }\n    };\n\n    const handleKeyUp = () => {\n      setPressedKey(null);\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    window.addEventListener('keyup', handleKeyUp);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n      window.removeEventListener('keyup', handleKeyUp);\n    };\n  }, [moveLandmark, handleNext, handlePrevious, handleSetZoomLevel]);\n\n  const referenceImageUrl = currentLandmarkId\n    ? getLandmarkImagePath(currentLandmarkId, 'front', 'infographic')\n    : null;\n\n  const placementGuide = currentLandmarkId\n    ? getLandmarkPlacementGuide(currentLandmarkId, 'front')\n    : '';\n\n  const color = currentLandmark\n    ? getLandmarkColor(currentLandmark.id, FRONT_LANDMARK_CATEGORIES)\n    : '#00f3ff';\n\n  return (\n    <div className=\"w-full max-w-6xl mx-auto\">\n      {/* Progress Bar */}\n      <div className=\"mb-4\">\n        <div className=\"flex items-center justify-between mb-2\">\n          <span className=\"text-sm text-foreground-dim\">\n            Step {currentStepIndex + 1} of {totalSteps}\n          </span>\n          <span className=\"text-sm text-foreground-dim\">\n            {Math.round(progress)}% Complete\n          </span>\n        </div>\n        <div className=\"h-2 bg-background-tertiary rounded-full overflow-hidden\">\n          <motion.div\n            className=\"h-full bg-accent\"\n            initial={{ width: 0 }}\n            animate={{ width: `${progress}%` }}\n            transition={{ duration: 0.3 }}\n          />\n        </div>\n      </div>\n\n      {/* Main Content Grid */}\n      <div className=\"grid lg:grid-cols-3 gap-6\">\n        {/* Left Panel - Reference Image and Instructions */}\n        <div className=\"lg:col-span-1 space-y-4\">\n          {/* Current Landmark Info Card */}\n          <motion.div\n            key={currentLandmarkId}\n            initial={{ opacity: 0, y: 10 }}\n            animate={{ opacity: 1, y: 0 }}\n            className=\"bg-background-secondary rounded-xl border border-border p-4\"\n          >\n            <div className=\"flex items-center gap-3 mb-3\">\n              <div\n                className=\"w-4 h-4 rounded-full border-2 border-white\"\n                style={{ backgroundColor: color }}\n              />\n              <div>\n                <h3 className=\"text-lg font-semibold text-white\">\n                  {currentLandmark?.label}\n                </h3>\n                <p className=\"text-xs text-accent\">{currentLandmark?.medicalTerm}</p>\n              </div>\n            </div>\n\n            <div className=\"flex items-start gap-2 text-sm text-foreground-dim\">\n              <Info className=\"w-4 h-4 mt-0.5 flex-shrink-0\" />\n              <p>{currentLandmark?.description}</p>\n            </div>\n          </motion.div>\n\n          {/* Reference with Tabs */}\n          <motion.div\n            key={`ref-${currentLandmarkId}`}\n            initial={{ opacity: 0, scale: 0.95 }}\n            animate={{ opacity: 1, scale: 1 }}\n            className=\"bg-background-secondary rounded-xl border border-border overflow-hidden\"\n          >\n            {/* Tab Navigation */}\n            <div className=\"flex border-b border-border\">\n              <button\n                onClick={() => setActiveTab('photo')}\n                className={`flex-1 px-3 py-2.5 text-xs font-medium transition-colors ${\n                  activeTab === 'photo'\n                    ? 'text-white border-b-2 border-accent'\n                    : 'text-foreground-dim hover:text-white'\n                }`}\n              >\n                Photo\n              </button>\n              <button\n                onClick={() => setActiveTab('diagram')}\n                className={`flex-1 px-3 py-2.5 text-xs font-medium transition-colors ${\n                  activeTab === 'diagram'\n                    ? 'text-white border-b-2 border-accent'\n                    : 'text-foreground-dim hover:text-white'\n                }`}\n              >\n                Diagram\n              </button>\n              <button\n                onClick={() => setActiveTab('howToFind')}\n                className={`flex-1 px-3 py-2.5 text-xs font-medium transition-colors ${\n                  activeTab === 'howToFind'\n                    ? 'text-white border-b-2 border-accent'\n                    : 'text-foreground-dim hover:text-white'\n                }`}\n              >\n                How to Find\n              </button>\n            </div>\n\n            {/* Tab Content */}\n            <div className=\"relative aspect-square bg-black/50\">\n              {activeTab === 'photo' && (\n                <>\n                  {referenceImageUrl && !referenceImageError ? (\n                    <Image\n                      src={referenceImageUrl}\n                      alt={`Reference for ${currentLandmark?.label}`}\n                      fill\n                      className=\"object-contain p-4\"\n                      unoptimized\n                      onError={() => setReferenceImageError(true)}\n                    />\n                  ) : (\n                    <div className=\"absolute inset-0 flex items-center justify-center p-4 text-center\">\n                      <div>\n                        <div\n                          className=\"w-16 h-16 rounded-full mx-auto mb-3 border-4 border-dashed flex items-center justify-center\"\n                          style={{ borderColor: color }}\n                        >\n                          <Circle className=\"w-6 h-6\" style={{ color: color }} />\n                        </div>\n                        <p className=\"text-foreground-dim text-sm\">Reference photo</p>\n                      </div>\n                    </div>\n                  )}\n                </>\n              )}\n\n              {activeTab === 'diagram' && (\n                <div className=\"absolute inset-0 flex items-center justify-center p-4 text-center\">\n                  <div>\n                    <div\n                      className=\"w-16 h-16 rounded-full mx-auto mb-3 border-4 border-dashed flex items-center justify-center\"\n                      style={{ borderColor: color }}\n                    >\n                      <Circle className=\"w-6 h-6\" style={{ color: color }} />\n                    </div>\n                    <p className=\"text-foreground-dim text-sm\">Anatomical diagram</p>\n                  </div>\n                </div>\n              )}\n\n              {activeTab === 'howToFind' && (\n                <div className=\"absolute inset-0 flex items-center justify-center p-6\">\n                  <div className=\"text-center\">\n                    <Info className=\"w-8 h-8 mx-auto mb-3\" style={{ color: color }} />\n                    <p className=\"text-white text-sm\">{placementGuide}</p>\n                  </div>\n                </div>\n              )}\n            </div>\n          </motion.div>\n\n          {/* Placement Guide Text */}\n          <div className=\"bg-accent/10 rounded-xl border border-accent/30 p-4\">\n            <p className=\"text-sm text-accent\">{placementGuide}</p>\n          </div>\n\n          {/* Quick Actions */}\n          <div className=\"flex gap-2\">\n            <button\n              onClick={() => setShowAllPoints(!showAllPoints)}\n              className={`flex-1 py-2 px-3 rounded-lg text-sm font-medium transition-colors ${\n                showAllPoints\n                  ? 'bg-accent text-black'\n                  : 'bg-white/10 text-foreground-dim hover:bg-white/20'\n              }`}\n            >\n              {showAllPoints ? 'Hide Other Points' : 'Show All Points'}\n            </button>\n            <button\n              onClick={handleSkipToEnd}\n              className=\"py-2 px-4 rounded-lg text-sm font-medium bg-white/10 text-foreground-dim hover:bg-white/20 transition-colors\"\n            >\n              Skip to End\n            </button>\n          </div>\n\n          {/* Keyboard Shortcuts Panel */}\n          <div className=\"hidden lg:block bg-background-secondary rounded-xl border border-border p-4\">\n            <p className=\"text-xs text-foreground-dim font-medium uppercase tracking-wide mb-3\">\n              Keyboard Shortcuts\n            </p>\n\n            {/* Arrow Keys Visual */}\n            <div className=\"flex justify-center mb-4\">\n              <div className=\"flex flex-col gap-1 items-center\">\n                <KeyboardKey\n                  isPressed={pressedKey === 'ArrowUp'}\n                  icon={<ChevronUp className=\"w-4 h-4\" />}\n                />\n                <div className=\"flex gap-1\">\n                  <KeyboardKey\n                    isPressed={pressedKey === 'ArrowLeft'}\n                    icon={<ChevronLeft className=\"w-4 h-4\" />}\n                  />\n                  <KeyboardKey\n                    isPressed={pressedKey === 'ArrowDown'}\n                    icon={<ChevronDown className=\"w-4 h-4\" />}\n                  />\n                  <KeyboardKey\n                    isPressed={pressedKey === 'ArrowRight'}\n                    icon={<ChevronRight className=\"w-4 h-4\" />}\n                  />\n                </div>\n              </div>\n            </div>\n\n            {/* Shortcut List */}\n            <div className=\"space-y-2\">\n              <div className=\"flex items-center gap-3\">\n                <span className={`px-2 py-1 text-xs font-mono rounded border transition-colors ${\n                  pressedKey === 'Enter'\n                    ? 'bg-accent border-accent text-black'\n                    : 'bg-white/10 border-border text-foreground-dim'\n                }`}>\n                  Enter\n                </span>\n                <span className=\"text-xs text-foreground-dim\">Next / Confirm</span>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                <span className={`px-2 py-1 text-xs font-mono rounded border transition-colors ${\n                  pressedKey === 'Backspace'\n                    ? 'bg-accent border-accent text-black'\n                    : 'bg-white/10 border-border text-foreground-dim'\n                }`}>\n                  Backspace\n                </span>\n                <span className=\"text-xs text-foreground-dim\">Previous</span>\n              </div>\n              <div className=\"flex items-center gap-3\">\n                <span className={`px-2 py-1 text-xs font-mono rounded border transition-colors ${\n                  pressedKey === 'r' || pressedKey === 'R'\n                    ? 'bg-accent border-accent text-black'\n                    : 'bg-white/10 border-border text-foreground-dim'\n                }`}>\n                  R\n                </span>\n                <span className=\"text-xs text-foreground-dim\">Reset</span>\n              </div>\n            </div>\n          </div>\n\n          {/* Zoom Level Panel */}\n          <div className=\"hidden lg:block bg-background-secondary rounded-xl border border-border p-4\">\n            <p className=\"text-xs text-foreground-dim font-medium uppercase tracking-wide mb-3\">\n              Zoom Level\n            </p>\n            <div className=\"flex gap-2\">\n              {([1, 2, 3] as const).map((level) => (\n                <button\n                  key={level}\n                  onClick={() => handleSetZoomLevel(level)}\n                  className={`flex-1 flex flex-col items-center gap-1 py-2 px-3 rounded-lg border transition-colors ${\n                    zoomLevel === level\n                      ? 'bg-accent border-accent text-black'\n                      : 'bg-white/10 border-border text-foreground-dim hover:bg-white/20'\n                  }`}\n                >\n                  <span className=\"text-xs font-mono\">{level}</span>\n                  <span className=\"text-[10px]\">{level === 1 ? '2x' : level === 2 ? '4x' : '8x'}</span>\n                </button>\n              ))}\n            </div>\n          </div>\n        </div>\n\n        {/* Right Panel - Image Canvas */}\n        <div className=\"lg:col-span-2\">\n          {/* Zoom Controls */}\n          <div className=\"flex items-center justify-between mb-3\">\n            <div className=\"flex items-center gap-2\">\n              <button\n                onClick={handleZoomOut}\n                disabled={zoomLevel <= 1}\n                className=\"p-2 rounded-lg bg-white/10 text-white hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n              >\n                <ZoomOut className=\"w-5 h-5\" />\n              </button>\n              <span className=\"text-sm text-foreground-dim min-w-[4rem] text-center\">\n                {Math.round(zoom * 100)}%\n              </span>\n              <button\n                onClick={handleZoomIn}\n                disabled={zoomLevel >= 3}\n                className=\"p-2 rounded-lg bg-white/10 text-white hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n              >\n                <ZoomIn className=\"w-5 h-5\" />\n              </button>\n              <button\n                onClick={handleResetZoom}\n                disabled={zoomLevel === 1}\n                className=\"p-2 rounded-lg bg-white/10 text-white hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n              >\n                <RotateCcw className=\"w-5 h-5\" />\n              </button>\n            </div>\n\n            <button\n              onClick={() => setIsFullscreen(!isFullscreen)}\n              className=\"p-2 rounded-lg bg-white/10 text-white hover:bg-white/20 transition-colors\"\n            >\n              {isFullscreen ? (\n                <Minimize2 className=\"w-5 h-5\" />\n              ) : (\n                <Maximize2 className=\"w-5 h-5\" />\n              )}\n            </button>\n          </div>\n\n          {/* Image Canvas */}\n          <motion.div\n            layout\n            className={`relative rounded-2xl overflow-hidden bg-black border border-border ${\n              isFullscreen ? 'fixed inset-4 z-50' : 'aspect-[3/4]'\n            }`}\n          >\n            {/* Fullscreen overlay background */}\n            {isFullscreen && (\n              <div\n                className=\"fixed inset-0 bg-black/90 -z-10\"\n                onClick={() => setIsFullscreen(false)}\n              />\n            )}\n\n            <div\n              ref={containerRef}\n              className=\"absolute inset-0 cursor-crosshair overflow-hidden\"\n              onClick={handleContainerClick}\n              onMouseDown={handleMouseDown}\n              onMouseMove={handleMouseMove}\n              onMouseUp={handleMouseUp}\n              onMouseLeave={handleMouseUp}\n              style={{\n                cursor: zoom > 1 && isDragging ? 'grabbing' : zoom > 1 ? 'grab' : 'crosshair',\n              }}\n            >\n              {/* Transformed Image Container */}\n              <div\n                className=\"absolute inset-0 transition-transform duration-100\"\n                style={{\n                  transform: `scale(${zoom}) translate(${pan.x / zoom}px, ${pan.y / zoom}px)`,\n                  transformOrigin: 'center center',\n                }}\n              >\n                {/* User's Image */}\n                <Image\n                  src={imageUrl}\n                  alt=\"Your photo\"\n                  fill\n                  className=\"object-contain pointer-events-none select-none\"\n                  unoptimized\n                  draggable={false}\n                />\n\n                {/* All Landmarks (dimmed) */}\n                {showAllPoints &&\n                  landmarks.map((landmark) => {\n                    if (landmark.id === currentLandmarkId) return null;\n                    const lmColor = getLandmarkColor(landmark.id, FRONT_LANDMARK_CATEGORIES);\n                    return (\n                      <div\n                        key={landmark.id}\n                        className=\"absolute w-3 h-3 -translate-x-1/2 -translate-y-1/2 pointer-events-none\"\n                        style={{\n                          left: `${landmark.x * 100}%`,\n                          top: `${landmark.y * 100}%`,\n                          opacity: 0.3,\n                        }}\n                      >\n                        <div\n                          className=\"w-full h-full rounded-full border border-white/50\"\n                          style={{ backgroundColor: lmColor }}\n                        />\n                      </div>\n                    );\n                  })}\n\n                {/* Current Landmark (highlighted) */}\n                {currentLandmark && (\n                  <motion.div\n                    key={currentLandmarkId}\n                    initial={{ scale: 0 }}\n                    animate={{ scale: 1 }}\n                    className=\"absolute w-6 h-6 -translate-x-1/2 -translate-y-1/2 z-20\"\n                    style={{\n                      left: `${currentLandmark.x * 100}%`,\n                      top: `${currentLandmark.y * 100}%`,\n                    }}\n                  >\n                    {/* Pulsing ring */}\n                    <motion.div\n                      className=\"absolute inset-0 rounded-full\"\n                      style={{ borderColor: color }}\n                      animate={{\n                        scale: [1, 1.5, 1],\n                        opacity: [0.8, 0, 0.8],\n                      }}\n                      transition={{\n                        duration: 2,\n                        repeat: Infinity,\n                        ease: 'easeInOut',\n                      }}\n                    >\n                      <div\n                        className=\"w-full h-full rounded-full border-2\"\n                        style={{ borderColor: color }}\n                      />\n                    </motion.div>\n\n                    {/* Main dot */}\n                    <div\n                      className=\"absolute inset-1 rounded-full border-2 border-white shadow-lg\"\n                      style={{\n                        backgroundColor: color,\n                        boxShadow: `0 0 20px ${color}`,\n                      }}\n                    />\n\n                    {/* Crosshair */}\n                    <div className=\"absolute inset-0 flex items-center justify-center pointer-events-none\">\n                      <div\n                        className=\"absolute w-8 h-[2px] -translate-x-1/2 left-1/2\"\n                        style={{ backgroundColor: `${color}80` }}\n                      />\n                      <div\n                        className=\"absolute h-8 w-[2px] -translate-y-1/2 top-1/2\"\n                        style={{ backgroundColor: `${color}80` }}\n                      />\n                    </div>\n                  </motion.div>\n                )}\n              </div>\n\n              {/* Zoom indicator in corner */}\n              {zoom > 1 && (\n                <div className=\"absolute top-3 left-3 px-2 py-1 rounded bg-black/70 text-white text-xs\">\n                  {Math.round(zoom * 100)}% - Drag to pan\n                </div>\n              )}\n            </div>\n\n            {/* Instructions overlay */}\n            <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4\">\n              <p className=\"text-center text-white text-sm\">\n                Click on the image to place the{' '}\n                <span style={{ color: color }}>{currentLandmark?.label}</span> landmark\n              </p>\n            </div>\n          </motion.div>\n\n          {/* Navigation Buttons */}\n          <div className=\"flex items-center justify-between mt-4\">\n            <button\n              onClick={handlePrevious}\n              disabled={currentStepIndex === 0}\n              className=\"flex items-center gap-2 px-4 py-3 rounded-lg bg-white/10 text-white hover:bg-white/20 disabled:opacity-50 disabled:cursor-not-allowed transition-colors\"\n            >\n              <ChevronLeft className=\"w-5 h-5\" />\n              Previous\n            </button>\n\n            <div className=\"flex items-center gap-1\">\n              {/* Step indicators - show subset around current */}\n              {Array.from({ length: Math.min(7, totalSteps) }).map((_, i) => {\n                let stepIndex: number;\n                if (totalSteps <= 7) {\n                  stepIndex = i;\n                } else if (currentStepIndex < 3) {\n                  stepIndex = i;\n                } else if (currentStepIndex > totalSteps - 4) {\n                  stepIndex = totalSteps - 7 + i;\n                } else {\n                  stepIndex = currentStepIndex - 3 + i;\n                }\n\n                const isCompleted = stepIndex < currentStepIndex;\n                const isCurrent = stepIndex === currentStepIndex;\n\n                return (\n                  <button\n                    key={stepIndex}\n                    onClick={() => {\n                      setCurrentStepIndex(stepIndex);\n                      handleResetZoom();\n                    }}\n                    className={`w-2 h-2 rounded-full transition-all ${\n                      isCurrent\n                        ? 'w-6 bg-accent'\n                        : isCompleted\n                          ? 'bg-green-500'\n                          : 'bg-white/20'\n                    }`}\n                  />\n                );\n              })}\n            </div>\n\n            <button\n              onClick={handleNext}\n              className=\"flex items-center gap-2 px-6 py-3 rounded-lg bg-accent text-black font-semibold hover:shadow-[0_0_20px_rgba(0,243,255,0.5)] transition-all\"\n            >\n              {currentStepIndex === totalSteps - 1 ? (\n                <>\n                  <Check className=\"w-5 h-5\" />\n                  Complete\n                </>\n              ) : (\n                <>\n                  Next\n                  <ChevronRight className=\"w-5 h-5\" />\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","numLines":836,"startLine":1,"totalLines":836}}}
{"parentUuid":"5edda6a5-86ae-4954-9622-e1b0cd8130bf","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"efb1448a-838d-48b6-a298-5778960f9201","version":"2.0.76","gitBranch":"main","agentId":"ae54e97","slug":"shiny-scribbling-brooks","message":{"model":"claude-sonnet-4-5-20250929","id":"msg_01JznB7oXAKqS3U3rhFHj4qY","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect! I've now analyzed all the landmark detection and zoom functionality files. Here's my comprehensive documentation:\n\n---\n\n# Landmark Detection & Zoom Functionality Documentation\n\n## Overview\nThe LOOKSMAXX app uses a sophisticated landmark placement system with zoom and pan capabilities for precise facial feature marking. The system supports both front profile (52 landmarks) and side profile (28 landmarks) analysis.\n\n---\n\n## 1. Core Files\n\n### `/src/hooks/useZoomPan.ts`\n**Purpose:** Reusable zoom/pan logic hook\n\n**Zoom Levels:**\n- **Minimum:** 2x (default initial)\n- **Maximum:** 8x\n- **Discrete Levels:** [2x, 4x, 8x] (FaceIQ parity)\n\n**Key Features:**\n- `zoomLevel`: Current zoom state (2-8x)\n- `pan`: { x, y } offset for panning\n- `isDragging`: Tracks drag state\n- `inverseScale`: 1/zoomLevel for landmark sizing\n- `zoomToPoint()`: Auto-centers specific coordinates at target zoom\n\n**Pan Behavior:**\n- Only enabled when `zoomLevel > 1`\n- Uses `movementX/movementY` for smooth dragging\n- Reset to `{x: 0, y: 0}` when zoom returns to 1x\n- Maintains center point when changing zoom levels\n\n---\n\n## 2. LandmarkAnalysisTool.tsx\n\n### Zoom Configuration\n```typescript\nconst [zoomLevel, setZoomLevel] = useState(2); // FaceIQ parity: 2x/4x/8x discrete levels\n```\n\n**Discrete Zoom Buttons:** Lines 677-707\n- UI buttons for quick jump: 2x, 4x, 8x\n- Maintains center point when switching levels using containerSize calculation\n\n### Auto-Zoom Behavior\n\n**Landmark-Specific Zoom Levels** (Lines 286-347):\n```typescript\nconst LANDMARK_ZOOM_LEVELS: Record<string, number> = {\n  // 2x zoom - larger landmarks\n  trichion: 2,\n  left_temporal: 2,\n  left_zygion: 2,\n  \n  // 4x zoom - medium detail landmarks\n  left_pupila: 4,\n  left_canthus_medialis: 4,\n  left_supercilium_apex: 4,\n  \n  // 8x zoom - fine detail landmarks (eyelids)\n  left_palpebra_superior: 8,\n  right_palpebra_superior: 8,\n  left_pretarsal_skin_crease: 8,\n  right_pretarsal_skin_crease: 8,\n}\n```\n\n**Auto-Zoom Function** (Lines 350-379):\n- `zoomToLandmark(landmarkId)` - Automatically zooms and centers on landmark\n- Uses landmark-specific zoom level from `LANDMARK_ZOOM_LEVELS`\n- Centers landmark under fixed crosshair orb\n- Triggered on step change if `autoZoomEnabled` is true\n- Toggle: \"Auto-Zoom: ON/OFF\" button (Line 739-749)\n\n### Crosshair System\n\n**Fixed Center Targeting Dot** (Lines 889-929):\n- Fixed at container center (doesn't move with pan/zoom)\n- Composed of:\n  - Crosshair lines (20px wide/tall, cyan)\n  - Glow ring (12px, radial gradient)\n  - Center dot (4px, solid cyan with shadow)\n- Users drag image to align landmark under crosshair\n\n**Placement Logic:**\n```typescript\nconst getCrosshairNormalizedPosition = () => {\n  const containerCenterX = bounds.containerWidth / 2;\n  const containerCenterY = bounds.containerHeight / 2;\n  \n  // Reverse transform: (screenPos - pan) / zoomLevel\n  const imageX = (containerCenterX - pan.x) / zoomLevel;\n  const imageY = (containerCenterY - pan.y) / zoomLevel;\n  \n  // Normalized to 0-1\n  return {\n    x: (imageX - bounds.offsetX) / bounds.renderedWidth,\n    y: (imageY - bounds.offsetY) / bounds.renderedHeight,\n  };\n}\n```\n\n### Transform System\n```typescript\nstyle={{\n  transform: `translate(${pan.x}px, ${pan.y}px) scale(${zoomLevel})`,\n  transformOrigin: '0 0',\n}}\n```\n- Transform applied to container with image + landmarks\n- Landmarks inversely scaled: `scale(${1 / zoomLevel})` to maintain size\n- Pan expressed in pixels, scale is unitless\n\n---\n\n## 3. SideProfileManualTool.tsx\n\n### Zoom Configuration\n```typescript\nconst [zoomLevel, setZoomLevel] = useState<1 | 2 | 3>(1);\nconst zoom = zoomLevel === 1 ? 2 : zoomLevel === 2 ? 4 : 8;\n```\n\n**Zoom Levels:**\n- Level 1 → 2x zoom\n- Level 2 → 4x zoom  \n- Level 3 → 8x zoom\n\n**UI Controls** (Lines 358-388):\n- ZoomIn/ZoomOut buttons with icons\n- Three discrete level buttons (2x/4x/8x)\n- Disabled states when at min/max\n\n### Transform System\n```typescript\nstyle={{\n  transform: `scale(${zoom})`,\n  transformOrigin: 'center center',\n}}\n```\n- Applied to container (NOT image directly)\n- Center origin for symmetric zoom\n- No pan offset in this implementation (simpler than LandmarkAnalysisTool)\n\n### Landmark Rendering\n**Visible landmarks scale inversely** - they maintain visual size:\n- Uses `pointer-events-none` when not visible\n- Glow effects: `boxShadow: activeLandmark ? '0 0 25px' : '0 0 10px'`\n- Active landmark scales up 1.25x with colored glow\n\n---\n\n## 4. GuidedLandmarkPlacement.tsx\n\n### Zoom Configuration\n```typescript\nconst [zoomLevel, setZoomLevel] = useState<1 | 2 | 3>(1);\nconst zoom = zoomLevel === 1 ? 2 : zoomLevel === 2 ? 4 : 8;\n```\n\n**Same pattern as SideProfileManualTool** (2x/4x/8x)\n\n### Pan Adjustment When Zooming (Lines 157-211):\n```typescript\nconst handleSetZoomLevel = (level: 1 | 2 | 3) => {\n  if (level === 1) {\n    setZoomLevel(1);\n    setPan({ x: 0, y: 0 }); // Reset pan at 1x\n  } else {\n    const newZoom = level === 2 ? 4 : 8;\n    const zoomRatio = newZoom / zoom;\n    setPan(prev => ({\n      x: prev.x * zoomRatio,\n      y: prev.y * zoomRatio,\n    })); // Maintain same center point\n    setZoomLevel(level);\n  }\n}\n```\n\n### Keyboard Shortcuts (Lines 254-308):\n- **Arrow Keys:** Fine landmark adjustment (0.002 step)\n- **1/2/3:** Jump to zoom level 1/2/3\n- **R:** Reset zoom\n- **Enter:** Next step\n- **Backspace:** Previous step\n\n### Transform System\n```typescript\nstyle={{\n  transform: `scale(${zoom}) translate(${pan.x / zoom}px, ${pan.y / zoom}px)`,\n  transformOrigin: 'center center',\n}}\n```\n- Different transform pattern than LandmarkAnalysisTool\n- Pan divided by zoom to maintain consistent offset\n\n---\n\n## 5. mediapipeDetection.ts\n\n### Landmark Offset System\n\n**FaceIQ Parity Offsets** (Lines 293-320):\n```typescript\nconst LANDMARK_OFFSETS: Record<string, { xOffset?: number; yOffset?: number }> = {\n  trichion: { yOffset: -0.06 },           // Hairline moved up\n  left_pupila: { xOffset: 0.0015, yOffset: -0.005 },\n  left_ala_nasi: { xOffset: 0.0025 },     // Nose widened\n  left_auricular_lateral: { xOffset: -0.04 }, // Ears pushed outward\n  left_cervical_lateralis: { yOffset: 0.05 }, // Neck moved down\n  left_pretarsal_skin_crease: { yOffset: -0.015 }, // Eyelid crease up\n  // ... (10 total offset mappings)\n}\n```\n\n**Purpose:** Corrects MediaPipe's raw positions to match cephalometric standards\n\n**Application:**\n```typescript\nreturn {\n  id,\n  x: landmark ? Math.max(0, Math.min(landmark.x + xOffset, 1)) : 0.5,\n  y: landmark ? Math.max(0, Math.min(landmark.y + yOffset, 1)) : 0.5,\n};\n```\n\n### Zoom Region Helper (Lines 515-549)\n**Not actively used** but defines suggested zoom regions per landmark:\n```typescript\nexport function getLandmarkZoomRegion(landmarkId: string): {\n  centerX: number;\n  centerY: number;\n  zoomLevel: number;\n} {\n  // Eyes: centerX: 0.35, centerY: 0.35, zoomLevel: 3\n  // Nose: centerX: 0.5, centerY: 0.4, zoomLevel: 2\n  // Mouth: centerX: 0.5, centerY: 0.6, zoomLevel: 2.5\n  // Default: centerX: 0.5, centerY: 0.5, zoomLevel: 1.5\n}\n```\n\n---\n\n## 6. landmarks.ts\n\n### Landmark Data Structure\n```typescript\ninterface LandmarkPoint {\n  id: string;\n  label: string;\n  medicalTerm: string;\n  description: string;\n  x: number;  // Normalized 0-1\n  y: number;  // Normalized 0-1\n  category: string;\n}\n```\n\n**Front Profile:** 52 landmarks across 11 categories\n**Side Profile:** 28 landmarks across 10 categories\n\n### Category Colors\nUsed for landmark color coding:\n```typescript\nexport function getLandmarkColor(\n  landmarkId: string,\n  categories: LandmarkCategory[]\n): string {\n  // Returns category color or default '#00f3ff' (cyan)\n}\n```\n\n---\n\n## 7. landmarkImages.ts\n\n### Image Mapping System\n```typescript\ninterface LandmarkImageConfig {\n  imageName: string;\n  fallbackDescription: string;\n}\n```\n\n**Image Types:**\n1. **Photo Reference:** `male_white_*.webp` - Shows landmark on actual face\n2. **Infographic:** `infographic_*.webp` - Diagram showing placement\n\n**Path Generation:**\n```typescript\nexport function getLandmarkImagePath(\n  landmarkId: string,\n  mode: 'front' | 'side',\n  type: 'photo' | 'infographic' = 'photo'\n): string | null {\n  const prefix = type === 'photo' ? 'male_white_' : 'infographic_';\n  return `/landmarks/${mode}/${prefix}${config.imageName}.webp`;\n}\n```\n\n---\n\n## Summary Table\n\n| Feature | LandmarkAnalysisTool | SideProfileManualTool | GuidedLandmarkPlacement |\n|---------|---------------------|----------------------|------------------------|\n| **Zoom Levels** | 2x, 4x, 8x | 2x, 4x, 8x | 2x, 4x, 8x |\n| **Initial Zoom** | 2x | 2x (level 1) | 2x (level 1) |\n| **Auto-Zoom** | ✅ Per-landmark | ❌ | ❌ |\n| **Pan Enabled** | Always when zoomed | On zoom + drag | On zoom + drag |\n| **Transform Origin** | `0 0` | `center center` | `center center` |\n| **Fixed Crosshair** | ✅ Center orb | ❌ | ❌ |\n| **Landmark Sizing** | Inverse scale | Inverse scale | Standard CSS |\n| **Keyboard Support** | ✅ Full | ❌ | ✅ Full |\n| **Guided Mode** | ❌ | ✅ Category-based | ✅ Step-by-step |\n\n---\n\n## Key Insights\n\n1. **FaceIQ Parity:** All zoom implementations use discrete levels (2x/4x/8x) matching competitor\n2. **Auto-Zoom Strategy:** Only LandmarkAnalysisTool implements per-landmark zoom levels for precision\n3. **Transform Patterns:** Two approaches used:\n   - `translate + scale` (LandmarkAnalysisTool) - pan offset applied first\n   - `scale + translate(pan/zoom)` (GuidedLandmarkPlacement) - pan normalized by zoom\n4. **Landmark Offsets:** 10 key landmarks have positional corrections to match cephalometric standards\n5. **Inverse Scaling:** Landmarks scale down by `1/zoomLevel` to maintain visual size at all zoom levels"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":11834,"cache_read_input_tokens":93692,"cache_creation":{"ephemeral_5m_input_tokens":11834,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWWUGEKWDw29auCvYKVtj","type":"assistant","uuid":"5b4db257-31d0-4a49-a718-dd96257b82c2","timestamp":"2025-12-27T03:21:06.177Z"}
