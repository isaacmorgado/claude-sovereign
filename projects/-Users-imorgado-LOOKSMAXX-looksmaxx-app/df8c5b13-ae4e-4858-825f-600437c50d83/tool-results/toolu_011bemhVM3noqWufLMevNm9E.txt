     1→# FaceIQ Implementation Specification
     2→
     3→## 1. Core measurements & Inputs
     4→### Landmarks
     5→The system uses MediaPipe Face Landmarker. Key landmarks required for specific ratios:
     6→*   **Glabella**: Midpoint between eyebrows.
     7→*   **Subnasale**: Base of the nose.
     8→*   **Pogonion**: Most forward point of the chin.
     9→*   **Nasion**: Root of the nose.
    10→*   (Full list to be populated)
    11→
    12→### Full Ratio & Landmark Definitions
    13→(Extracted from client source code `j2.js`)
    14→
    15→| Ratio Name | Input Landmarks |
    16→| :--- | :--- |
    17→| **Facial Convexity (Glabella)** | `glabella`, `pogonion`, `subnasale` |
    18→| **Facial Convexity (Nasion)** | `nasion`, `pogonion`, `subnasale` |
    19→| **Total Facial Convexity** | `glabella`, `pogonion`, `pronasale` |
    20→| **Nasolabial Angle** | `columella`, `labraleSuperius`, `subnasale` |
    21→| **Nasomental Angle** | `nasion`, `pogonion`, `pronasale` |
    22→| **Gonial Angle** | `gonionBottom`, `gonionTop`, `intertragicNotch`, `menton` |
    23→| **Z Angle** | `labraleSuperius`, `orbitale`, `pogonion`, `porion` |
    24→| **Chin to Philtrum Ratio** | `chinBottom`, `cupidsBow`, `lowerLip`, `nasalBase` |
    25→| **Upper Lip E-Line Position** | `labraleSuperius`, `menton`, `pogonion`, `pronasale`, `trichion` |
    26→| **Lower Lip E-Line Position** | `labraleInferius`, `menton`, `pogonion`, `pronasale`, `trichion` |
    27→| **Nasal Projection** | `nasion`, `pronasale`, `rhinion`, `subalare` |
    28→| **Eye Protrusion** | `cornealApex`, `lowerEyelid`, `menton`, `trichion` |
    29→| **Orbital Vector** | `cornealApex`, `menton`, `orbitale`, `trichion` |
    30→| **Browridge Inclination Angle** | `glabella`, `trichion` |
    31→
    32→## 2. Scoring Standards (The "Ideals")
    33→Extracted from server configuration. These values are hardcoded benchmarks.
    34→
    35→### Ideal Ranges Table
    36→| Metric | Ideal Min | Ideal Max | Unit |
    37→| :--- | :--- | :--- | :--- |
    38→| **Facial Convexity (Glabella)** | 169 | 174 | Degrees |
    39→| **Nasolabial Angle** | 99 | 116 | Degrees |
    40→| **Gonial Angle** | 115 | 121 | Degrees |
    41→| **Z Angle** | 78 | 82 | Degrees |
    42→
    43→## 3. Recommendation Engine ("The Plan")
    44→**Mechanism**: Hardcoded Client-Side Flaw Detection -> Server-Side Treatment Retrieval.
    45→The system defines "Flaws" as rulesets in the client code (`j2.js`).
    46→
    47→### Flaw Detection Rules
    48→*   **Narrow Jaw**
    49→    *   **Trigger**: `Bigonial width` < `idealMin`
    50→    *   **Description**: "The jaw is too slim, creating a delicate or less robust lower face appearance."
    51→*   **Overly wide or bloated jaw**
    52→    *   **Trigger**: `Bigonial width` > `idealMax`
    53→    *   **Description**: "The jaw appears excessively broad, often due to muscle bulk or fat."
    54→*   **Recessed Chin** (Inferred)
    55→    *   **Trigger**: `Nasomental Angle` < `idealMin`
    56→
    57→### Treatment Mapping (Logic Only)
    58→The system uses a **Retrieval Architecture**.
    59→1.  **Client-Side**: Detects Flaw (e.g., "Narrow Jaw").
    60→2.  **Lookup**: Maps Flaw to Treatment IDs (e.g., `["SUR-17", "NST-05"]`).
    61→3.  **Server-Side**: Fetches content for `SUR-17` (Title, Description, Timeline).
    62→
    63→*Note: The actual content database (e.g., "SUR-17" = "Jaw Implants") is not in the client code and wasn't captured in the session, confirming it is securely hosted on the server and fetched only when needed.*
    64→
    65→### Known mappings (from `j2.js`)
    66→*   **Narrow Jaw** -> `["SUR-17", "SUR-07", "SUR-34", "NST-05", "SUR-09", "SUR-20"]`
    67→*   **Recessed Chin** -> `["SUR-07", "SUR-20", "SUR-09"]`
    68→
    69→
    70→## 4. Integration Logic
    71→```javascript
    72→// 1. Calculate Ratio
    73→const ratioValue = calculateRatio(landmarks); // e.g., 105 degrees
    74→
    75→// 2. Score & Deviate
    76→const idealMin = 115, idealMax = 121;
    77→if (ratioValue < idealMin) {
    78→   score = decay(ratioValue, idealMin); 
    79→   deviation = "belowIdeal";
    80→}
    81→
    82→// 3. Trigger Flaw
    83→const flaws = [];
    84→if (deviation === "belowIdeal" && ratioName === "Gonial Angle") {
    85→   flaws.push("steep_jaw"); // Internal ID
    86→}
    87→
    88→// 4. Get Plan
    89→const plan = flaws.map(flaw => database.getTreatments(flaw));
    90→```
    91→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
