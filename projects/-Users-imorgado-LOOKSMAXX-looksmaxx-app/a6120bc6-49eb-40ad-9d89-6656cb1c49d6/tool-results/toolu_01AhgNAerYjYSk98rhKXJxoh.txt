     1→'use client';
     2→
     3→import { motion } from 'framer-motion';
     4→import { ChevronDown, AlertTriangle, CheckCircle } from 'lucide-react';
     5→import { Strength, Flaw, getScoreColor, getQualityColor } from '@/types/results';
     6→import { QualityBadge, CategoryTag, ExpandableSection } from '../shared';
     7→import { generateAIDescription, FlawDetail } from '@/lib/aiDescriptions';
     8→import { useMemo } from 'react';
     9→
    10→// ============================================
    11→// SEVERITY BADGE - FaceIQ Style
    12→// ============================================
    13→
    14→type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor';
    15→
    16→interface SeverityConfig {
    17→  label: string;
    18→  color: string;
    19→  bgColor: string;
    20→  borderColor: string;
    21→}
    22→
    23→const SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {
    24→  extremely_severe: {
    25→    label: 'Extremely Severe',
    26→    color: '#dc2626',
    27→    bgColor: 'rgba(220, 38, 38, 0.15)',
    28→    borderColor: 'rgba(220, 38, 38, 0.4)',
    29→  },
    30→  severe: {
    31→    label: 'Severe',
    32→    color: '#ef4444',
    33→    bgColor: 'rgba(239, 68, 68, 0.15)',
    34→    borderColor: 'rgba(239, 68, 68, 0.4)',
    35→  },
    36→  major: {
    37→    label: 'Major',
    38→    color: '#f97316',
    39→    bgColor: 'rgba(249, 115, 22, 0.15)',
    40→    borderColor: 'rgba(249, 115, 22, 0.4)',
    41→  },
    42→  moderate: {
    43→    label: 'Moderate',
    44→    color: '#fbbf24',
    45→    bgColor: 'rgba(251, 191, 36, 0.15)',
    46→    borderColor: 'rgba(251, 191, 36, 0.4)',
    47→  },
    48→  minor: {
    49→    label: 'Minor',
    50→    color: '#6b7280',
    51→    bgColor: 'rgba(107, 114, 128, 0.15)',
    52→    borderColor: 'rgba(107, 114, 128, 0.4)',
    53→  },
    54→};
    55→
    56→function getSeverityFromImpact(harmonyLost: number): SeverityLevel {
    57→  if (harmonyLost >= 5) return 'extremely_severe';
    58→  if (harmonyLost >= 3.5) return 'severe';
    59→  if (harmonyLost >= 2.5) return 'major';
    60→  if (harmonyLost >= 1.5) return 'moderate';
    61→  return 'minor';
    62→}
    63→
    64→function getSeverityFromScore(score: number): SeverityLevel {
    65→  if (score <= 2) return 'extremely_severe';
    66→  if (score <= 4) return 'severe';
    67→  if (score <= 5.5) return 'major';
    68→  if (score <= 7) return 'moderate';
    69→  return 'minor';
    70→}
    71→
    72→interface SeverityBadgeProps {
    73→  severity: SeverityLevel;
    74→  size?: 'sm' | 'md';
    75→}
    76→
    77→export function SeverityBadge({ severity, size = 'md' }: SeverityBadgeProps) {
    78→  const config = SEVERITY_CONFIGS[severity];
    79→
    80→  return (
    81→    <span
    82→      className={`inline-flex items-center font-medium rounded-full ${
    83→        size === 'sm' ? 'px-2 py-0.5 text-[10px]' : 'px-2.5 py-1 text-xs'
    84→      }`}
    85→      style={{
    86→        color: config.color,
    87→        backgroundColor: config.bgColor,
    88→        border: `1px solid ${config.borderColor}`,
    89→      }}
    90→    >
    91→      {config.label}
    92→    </span>
    93→  );
    94→}
    95→
    96→// ============================================
    97→// STRENGTH CARD
    98→// ============================================
    99→
   100→interface StrengthCardProps {
   101→  strength: Strength;
   102→  isExpanded?: boolean;
   103→  onToggle?: () => void;
   104→}
   105→
   106→export function StrengthCard({ strength, isExpanded = false, onToggle }: StrengthCardProps) {
   107→  const color = getQualityColor(strength.qualityLevel);
   108→
   109→  return (
   110→    <motion.div
   111→      layout
   112→      className={`bg-gradient-to-br from-green-500/10 to-cyan-500/5 border rounded-xl overflow-hidden transition-all ${
   113→        isExpanded ? 'border-green-500/50' : 'border-green-500/20 hover:border-green-500/40'
   114→      }`}
   115→    >
   116→      {/* Header */}
   117→      <button
   118→        onClick={onToggle}
   119→        className="w-full p-4 flex items-start gap-3 text-left"
   120→      >
   121→        {/* Icon */}
   122→        <div className="w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center flex-shrink-0">
   123→          <CheckCircle size={20} className="text-green-400" />
   124→        </div>
   125→
   126→        {/* Content */}
   127→        <div className="flex-1 min-w-0">
   128→          <div className="flex items-center gap-2 mb-1">
   129→            <h3 className="font-semibold text-white">{strength.strengthName}</h3>
   130→            <QualityBadge quality={strength.qualityLevel} size="sm" />
   131→          </div>
   132→          <p className="text-sm text-neutral-400 line-clamp-2">{strength.summary}</p>
   133→          <div className="flex items-center gap-3 mt-2">
   134→            <CategoryTag category={strength.categoryName} />
   135→            <span className="text-sm font-medium" style={{ color }}>
   136→              Score: {strength.avgScore.toFixed(1)}/10
   137→            </span>
   138→          </div>
   139→        </div>
   140→
   141→        {/* Expand indicator */}
   142→        <motion.div
   143→          animate={{ rotate: isExpanded ? 180 : 0 }}
   144→          transition={{ duration: 0.2 }}
   145→          className="flex-shrink-0 mt-1"
   146→        >
   147→          <ChevronDown size={18} className="text-neutral-500" />
   148→        </motion.div>
   149→      </button>
   150→
   151→      {/* Expanded Content */}
   152→      <ExpandableSection isExpanded={isExpanded}>
   153→        <div className="px-4 pb-4 space-y-3 border-t border-green-500/20 pt-3">
   154→          <h4 className="text-sm font-medium text-neutral-300">Responsible Ratios</h4>
   155→          <div className="space-y-2">
   156→            {strength.responsibleRatios.map((ratio, i) => (
   157→              <div
   158→                key={i}
   159→                className="flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg"
   160→              >
   161→                <span className="text-sm text-neutral-300">{ratio.ratioName}</span>
   162→                <div className="flex items-center gap-2">
   163→                  <span className="text-sm text-neutral-500">
   164→                    {ratio.value.toFixed(2)}
   165→                  </span>
   166→                  <span
   167→                    className="text-sm font-medium"
   168→                    style={{ color: getScoreColor(ratio.score) }}
   169→                  >
   170→                    {ratio.score.toFixed(1)}
   171→                  </span>
   172→                </div>
   173→              </div>
   174→            ))}
   175→          </div>
   176→        </div>
   177→      </ExpandableSection>
   178→    </motion.div>
   179→  );
   180→}
   181→
   182→// ============================================
   183→// FLAW CARD
   184→// ============================================
   185→
   186→interface FlawCardProps {
   187→  flaw: Flaw;
   188→  isExpanded?: boolean;
   189→  onToggle?: () => void;
   190→  rank?: number;
   191→  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;
   192→}
   193→
   194→export function FlawCard({ flaw, isExpanded = false, onToggle, onRatioClick }: FlawCardProps) {
   195→  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);
   196→  const severityConfig = SEVERITY_CONFIGS[severity];
   197→
   198→  // Generate AI descriptions for each responsible ratio
   199→  const aiDetails = useMemo<FlawDetail[]>(() => {
   200→    return flaw.responsibleRatios.map((ratio) =>
   201→      generateAIDescription(
   202→        ratio.ratioName.toLowerCase().replace(/\s+/g, ''),
   203→        ratio.ratioName,
   204→        ratio.value,
   205→        ratio.idealMin,
   206→        ratio.idealMax,
   207→        ratio.score,
   208→        ratio.unit,
   209→        flaw.categoryName
   210→      )
   211→    );
   212→  }, [flaw.responsibleRatios, flaw.categoryName]);
   213→
   214→  // Get the primary AI description (from the worst ratio)
   215→  const primaryAI = aiDetails.length > 0
   216→    ? aiDetails.reduce((worst, current) => current.score < worst.score ? current : worst)
   217→    : null;
   218→
   219→  return (
   220→    <motion.div
   221→      layout
   222→      className={`bg-neutral-900/80 border rounded-xl overflow-hidden transition-all ${
   223→        isExpanded ? 'border-red-500/50' : 'border-neutral-800 hover:border-neutral-700'
   224→      }`}
   225→    >
   226→      {/* Header - FaceIQ Style */}
   227→      <button
   228→        onClick={onToggle}
   229→        className="w-full p-4 sm:p-5 text-left hover:bg-neutral-800/30 transition-colors"
   230→      >
   231→        <div className="flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3">
   232→          {/* Left side: Badge + Content */}
   233→          <div className="flex items-start gap-3 flex-1 min-w-0">
   234→            {/* Severity Badge */}
   235→            <SeverityBadgeLegacy severity={severity} size="sm" />
   236→
   237→            {/* Content */}
   238→            <div className="flex-1 min-w-0">
   239→              <h4 className="text-sm sm:text-base font-semibold text-white mb-1 leading-snug">
   240→                {flaw.flawName}
   241→              </h4>
   242→              <p className="text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2">
   243→                {flaw.summary}
   244→              </p>
   245→            </div>
   246→          </div>
   247→
   248→          {/* Right side: Points impact */}
   249→          <div className="flex items-center justify-between sm:justify-end gap-4 sm:gap-3 flex-shrink-0 sm:flex-col sm:items-end">
   250→            <div className="text-right">
   251→              <div
   252→                className="text-xl sm:text-2xl font-bold tracking-tight"
   253→                style={{ color: severityConfig.color }}
   254→              >
   255→                -{flaw.harmonyPercentageLost.toFixed(2)}
   256→              </div>
   257→              <div className="text-[10px] sm:text-xs text-neutral-500 font-medium">points</div>
   258→              {flaw.rollingHarmonyPercentageLost !== undefined && (
   259→                <div className="text-[10px] text-neutral-500 mt-1 pt-1 border-t border-neutral-800">
   260→                  Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}
   261→                </div>
   262→              )}
   263→            </div>
   264→            <motion.div
   265→              animate={{ rotate: isExpanded ? 180 : 0 }}
   266→              transition={{ duration: 0.2 }}
   267→              className="flex-shrink-0"
   268→            >
   269→              <ChevronDown size={18} className="text-neutral-500" />
   270→            </motion.div>
   271→          </div>
   272→        </div>
   273→      </button>
   274→
   275→      {/* Expanded Content */}
   276→      <ExpandableSection isExpanded={isExpanded}>
   277→        <div className="border-t border-neutral-800">
   278→          {/* Affected Ratios Section - FaceIQ Style */}
   279→          <div className="bg-neutral-800/30 px-4 sm:px-5 py-4">
   280→            <div className="text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-3">
   281→              Affected Ratios
   282→            </div>
   283→            <div className="space-y-2">
   284→              {flaw.responsibleRatios.map((ratio, i) => (
   285→                <button
   286→                  key={i}
   287→                  onClick={(e) => {
   288→                    e.stopPropagation();
   289→                    onRatioClick?.(ratio);
   290→                  }}
   291→                  className="w-full flex items-center justify-between py-2.5 px-3 rounded-lg bg-neutral-900/80 border border-neutral-800 hover:border-neutral-700 hover:bg-neutral-900 transition-all text-left group"
   292→                >
   293→                  <span className="text-xs sm:text-sm text-neutral-200 font-medium">
   294→                    {ratio.ratioName}
   295→                  </span>
   296→                  <div className="flex items-baseline gap-1">
   297→                    <span
   298→                      className="text-sm font-semibold"
   299→                      style={{ color: getScoreColor(ratio.score) }}
   300→                    >
   301→                      {ratio.score.toFixed(1)}
   302→                    </span>
   303→                    <span className="text-[10px] sm:text-xs text-neutral-500">/10</span>
   304→                  </div>
   305→                </button>
   306→              ))}
   307→            </div>
   308→          </div>
   309→
   310→          {/* AI Analysis / May Indicate Section */}
   311→          {primaryAI && (
   312→            <div className="bg-amber-500/5 px-4 sm:px-5 py-4 border-t border-neutral-800">
   313→              <div className="flex items-center gap-1.5 mb-2">
   314→                <AlertTriangle size={12} className="text-amber-500" />
   315→                <span className="text-[10px] sm:text-xs font-medium text-amber-400 uppercase tracking-wider">
   316→                  May Indicate
   317→                </span>
   318→              </div>
   319→              <div className="text-xs sm:text-sm text-neutral-300 leading-relaxed">
   320→                {primaryAI.reasoning}
   321→              </div>
   322→            </div>
   323→          )}
   324→        </div>
   325→      </ExpandableSection>
   326→    </motion.div>
   327→  );
   328→}
   329→
   330→// Renamed internal SeverityBadge to avoid conflict with shared export
   331→function SeverityBadgeLegacy({ severity, size = 'md' }: SeverityBadgeProps) {
   332→  const config = SEVERITY_CONFIGS[severity];
   333→
   334→  return (
   335→    <span
   336→      className={`inline-flex items-center font-medium rounded-full ${
   337→        size === 'sm' ? 'px-2 py-0.5 text-[10px]' : 'px-2.5 py-1 text-xs'
   338→      }`}
   339→      style={{
   340→        color: config.color,
   341→        backgroundColor: config.bgColor,
   342→        border: `1px solid ${config.borderColor}`,
   343→      }}
   344→    >
   345→      {config.label}
   346→    </span>
   347→  );
   348→}
   349→
   350→// ============================================
   351→// COMPACT STRENGTH/FLAW BADGES
   352→// ============================================
   353→
   354→interface CompactStrengthBadgeProps {
   355→  strength: Strength;
   356→  onClick?: () => void;
   357→}
   358→
   359→export function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {
   360→  return (
   361→    <button
   362→      onClick={onClick}
   363→      className="inline-flex items-center gap-1.5 px-2 py-1 bg-green-500/10 border border-green-500/20 rounded-lg hover:bg-green-500/20 transition-colors"
   364→    >
   365→      <CheckCircle size={12} className="text-green-400" />
   366→      <span className="text-xs text-green-300">{strength.strengthName}</span>
   367→    </button>
   368→  );
   369→}
   370→
   371→interface CompactFlawBadgeProps {
   372→  flaw: Flaw;
   373→  onClick?: () => void;
   374→  showSeverity?: boolean;
   375→}
   376→
   377→export function CompactFlawBadge({ flaw, onClick, showSeverity = true }: CompactFlawBadgeProps) {
   378→  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);
   379→  const config = SEVERITY_CONFIGS[severity];
   380→
   381→  return (
   382→    <button
   383→      onClick={onClick}
   384→      className="inline-flex items-center gap-1.5 px-2 py-1 rounded-lg hover:opacity-80 transition-all"
   385→      style={{
   386→        backgroundColor: config.bgColor,
   387→        border: `1px solid ${config.borderColor}`,
   388→      }}
   389→    >
   390→      <AlertTriangle size={12} style={{ color: config.color }} />
   391→      <span className="text-xs" style={{ color: config.color }}>{flaw.flawName}</span>
   392→      {showSeverity && (
   393→        <span
   394→          className="text-[10px] px-1.5 py-0.5 rounded-full"
   395→          style={{
   396→            backgroundColor: config.borderColor,
   397→            color: config.color,
   398→          }}
   399→        >
   400→          {config.label}
   401→        </span>
   402→      )}
   403→    </button>
   404→  );
   405→}
   406→
   407→// Export severity utilities for use in other components
   408→export { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };
   409→export type { SeverityLevel };
   410→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
