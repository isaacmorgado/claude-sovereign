     1→'use client';
     2→
     3→import { motion } from 'framer-motion';
     4→import { TrendingUp, TrendingDown, User, ScanFace, Sparkles, ChevronRight } from 'lucide-react';
     5→import { useResults } from '@/contexts/ResultsContext';
     6→import { TabContent } from '../ResultsLayout';
     7→import { ScoreBar, AnimatedScore, ShareButton, ExportButton } from '../shared';
     8→import { StrengthCard, FlawCard } from '../cards/StrengthFlawCards';
     9→import { FacialRadarChart } from '../visualization/FacialRadarChart';
    10→import { MetricDetailModal } from '../modals/MetricDetailModal';
    11→import { getScoreColor, ResponsibleRatio } from '@/types/results';
    12→import { FaceIQScoreResult } from '@/lib/faceiq-scoring';
    13→import { useState } from 'react';
    14→
    15→// ============================================
    16→// SCORE SUMMARY CARDS
    17→// ============================================
    18→
    19→interface ProfileScoreCardProps {
    20→  title: string;
    21→  score: number;
    22→  icon: React.ReactNode;
    23→  photo?: string;
    24→  ratioCount: number;
    25→  onClick?: () => void;
    26→}
    27→
    28→function ProfileScoreCard({ title, score, icon, photo, ratioCount, onClick }: ProfileScoreCardProps) {
    29→  const color = getScoreColor(score);
    30→
    31→  return (
    32→    <motion.button
    33→      onClick={onClick}
    34→      className="bg-neutral-900/80 border border-neutral-800 rounded-xl p-4 hover:border-neutral-700 transition-all text-left w-full"
    35→      whileHover={{ scale: 1.02 }}
    36→      whileTap={{ scale: 0.98 }}
    37→    >
    38→      <div className="flex items-center gap-4">
    39→        {/* Photo or icon */}
    40→        <div className="relative w-16 h-16 rounded-lg overflow-hidden bg-neutral-800 flex-shrink-0">
    41→          {photo ? (
    42→            <img src={photo} alt={title} className="w-full h-full object-cover" />
    43→          ) : (
    44→            <div className="w-full h-full flex items-center justify-center">
    45→              {icon}
    46→            </div>
    47→          )}
    48→        </div>
    49→
    50→        {/* Info */}
    51→        <div className="flex-1">
    52→          <h3 className="text-sm font-medium text-neutral-400 mb-1">{title}</h3>
    53→          <div className="flex items-baseline gap-2">
    54→            <span className="text-2xl font-bold" style={{ color }}>
    55→              {score.toFixed(2)}
    56→            </span>
    57→            <span className="text-sm text-neutral-500">/ 10</span>
    58→          </div>
    59→          <p className="text-xs text-neutral-500 mt-1">{ratioCount} measurements</p>
    60→        </div>
    61→
    62→        {/* Arrow */}
    63→        <ChevronRight size={20} className="text-neutral-600" />
    64→      </div>
    65→
    66→      {/* Score bar */}
    67→      <div className="mt-3">
    68→        <ScoreBar score={score} height={6} />
    69→      </div>
    70→    </motion.button>
    71→  );
    72→}
    73→
    74→// ============================================
    75→// HARMONY SCORE DISPLAY (with AnimatedScore and Radar Chart)
    76→// ============================================
    77→
    78→function HarmonyScoreDisplay() {
    79→  const { overallScore, frontScore, sideScore } = useResults();
    80→  const [showRadar, setShowRadar] = useState(true);
    81→
    82→  return (
    83→    <motion.div
    84→      className="bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-2xl p-6 md:p-8"
    85→      initial={{ opacity: 0, y: 20 }}
    86→      animate={{ opacity: 1, y: 0 }}
    87→      transition={{ duration: 0.5 }}
    88→    >
    89→      <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
    90→        {/* Left: Score Display */}
    91→        <div className="text-center flex flex-col justify-center">
    92→          <h2 className="text-lg font-medium text-neutral-400 mb-6">Overall Harmony Score</h2>
    93→
    94→          {/* Animated Score */}
    95→          <div className="flex justify-center mb-6">
    96→            <AnimatedScore
    97→              score={overallScore}
    98→              duration={2.5}
    99→              delay={0.5}
   100→              showConfetti={true}
   101→              confettiThreshold={7.5}
   102→            />
   103→          </div>
   104→
   105→          {/* Profile Breakdowns */}
   106→          <div className="flex justify-center gap-8 mb-4">
   107→            <div className="text-center">
   108→              <p className="text-xs text-neutral-500 mb-1">Front Profile</p>
   109→              <p className="text-xl font-bold" style={{ color: getScoreColor(frontScore) }}>
   110→                {frontScore.toFixed(2)}
   111→              </p>
   112→            </div>
   113→            <div className="w-px bg-neutral-800" />
   114→            <div className="text-center">
   115→              <p className="text-xs text-neutral-500 mb-1">Side Profile</p>
   116→              <p className="text-xl font-bold" style={{ color: getScoreColor(sideScore) }}>
   117→                {sideScore.toFixed(2)}
   118→              </p>
   119→            </div>
   120→          </div>
   121→
   122→          <p className="text-sm text-neutral-400 max-w-md mx-auto">
   123→            {overallScore >= 8 ? 'Exceptional facial harmony. Your features are well-balanced and proportioned.' :
   124→              overallScore >= 6 ? 'Good facial harmony with some areas that could be optimized.' :
   125→                overallScore >= 4 ? 'Average facial harmony. Several areas have room for improvement.' :
   126→                  'Below average facial harmony. Multiple areas could benefit from attention.'}
   127→          </p>
   128→        </div>
   129→
   130→        {/* Right: Radar Chart */}
   131→        <div className="flex flex-col">
   132→          <div className="flex items-center justify-between mb-2">
   133→            <h3 className="text-sm font-medium text-neutral-400">Category Breakdown</h3>
   134→            <button
   135→              onClick={() => setShowRadar(!showRadar)}
   136→              className="text-xs text-cyan-400 hover:text-cyan-300 transition-colors"
   137→            >
   138→              {showRadar ? 'Hide' : 'Show'}
   139→            </button>
   140→          </div>
   141→          {showRadar && (
   142→            <motion.div
   143→              initial={{ opacity: 0, scale: 0.95 }}
   144→              animate={{ opacity: 1, scale: 1 }}
   145→              transition={{ duration: 0.5, delay: 0.3 }}
   146→              className="flex-1 min-h-[280px]"
   147→            >
   148→              <FacialRadarChart height={280} />
   149→            </motion.div>
   150→          )}
   151→        </div>
   152→      </div>
   153→    </motion.div>
   154→  );
   155→}
   156→
   157→// ============================================
   158→// OVERVIEW TAB
   159→// ============================================
   160→
   161→export function OverviewTab() {
   162→  const {
   163→    overallScore,
   164→    frontScore,
   165→    sideScore,
   166→    frontRatios,
   167→    sideRatios,
   168→    strengths,
   169→    flaws,
   170→    frontPhoto,
   171→    sidePhoto,
   172→    setActiveTab,
   173→  } = useResults();
   174→
   175→  const [expandedStrength, setExpandedStrength] = useState<string | null>(null);
   176→  const [expandedFlaw, setExpandedFlaw] = useState<string | null>(null);
   177→  const [selectedRatio, setSelectedRatio] = useState<FaceIQScoreResult | null>(null);
   178→  const [isModalOpen, setIsModalOpen] = useState(false);
   179→
   180→  // Show top 5 strengths and flaws
   181→  const topStrengths = strengths.slice(0, 5);
   182→  const topFlaws = flaws.slice(0, 5);
   183→
   184→  // Convert ResponsibleRatio to FaceIQScoreResult for modal
   185→  const handleRatioClick = (ratio: ResponsibleRatio, categoryName: string) => {
   186→    // Find the full ratio data from frontRatios or sideRatios
   187→    const fullRatio = [...frontRatios, ...sideRatios].find(
   188→      (r) => r.name === ratio.ratioName || r.id === ratio.ratioId
   189→    );
   190→
   191→    if (fullRatio) {
   192→      // Convert Ratio to FaceIQScoreResult format
   193→      setSelectedRatio({
   194→        metricId: fullRatio.id,
   195→        name: fullRatio.name,
   196→        value: fullRatio.value,
   197→        score: fullRatio.score,
   198→        standardizedScore: fullRatio.standardizedScore,
   199→        idealMin: fullRatio.idealMin,
   200→        idealMax: fullRatio.idealMax,
   201→        deviation: 0,
   202→        deviationDirection: 'within',
   203→        unit: fullRatio.unit === 'x' ? 'ratio' : fullRatio.unit === '%' ? 'percent' : fullRatio.unit === '°' ? 'degrees' : fullRatio.unit,
   204→        category: fullRatio.category,
   205→        qualityTier: fullRatio.qualityLevel,
   206→        severity: fullRatio.severity,
   207→      } as FaceIQScoreResult);
   208→    } else {
   209→      // Create a minimal FaceIQScoreResult from ResponsibleRatio
   210→      setSelectedRatio({
   211→        metricId: ratio.ratioId,
   212→        name: ratio.ratioName,
   213→        value: ratio.value,
   214→        score: ratio.score,
   215→        standardizedScore: ratio.score,
   216→        idealMin: ratio.idealMin,
   217→        idealMax: ratio.idealMax,
   218→        deviation: 0,
   219→        deviationDirection: 'within',
   220→        unit: (ratio.unit as 'ratio' | 'percent' | 'degrees' | 'mm' | 'none') || 'ratio',
   221→        category: ratio.category || categoryName,
   222→        qualityTier: ratio.score >= 8 ? 'ideal' : ratio.score >= 6 ? 'excellent' : ratio.score >= 4 ? 'good' : 'below_average',
   223→        severity: 'optimal',
   224→      } as FaceIQScoreResult);
   225→    }
   226→    setIsModalOpen(true);
   227→  };
   228→
   229→  return (
   230→    <TabContent
   231→      title="Overview"
   232→      subtitle="Your complete facial harmony analysis"
   233→      rightContent={
   234→        <div className="flex items-center gap-2">
   235→          <ShareButton score={overallScore} frontScore={frontScore} sideScore={sideScore} />
   236→          <ExportButton elementId="results-overview" />
   237→        </div>
   238→      }
   239→    >
   240→      {/* Main content with ID for export */}
   241→      <div id="results-overview">
   242→        {/* Harmony Score */}
   243→        <div className="mb-8">
   244→          <HarmonyScoreDisplay />
   245→        </div>
   246→
   247→      {/* Profile Scores */}
   248→      <div className="grid grid-cols-1 md:grid-cols-2 gap-4 mb-8">
   249→        <ProfileScoreCard
   250→          title="Front Profile"
   251→          score={frontScore}
   252→          icon={<User size={24} className="text-neutral-600" />}
   253→          photo={frontPhoto}
   254→          ratioCount={frontRatios.length}
   255→          onClick={() => setActiveTab('front-ratios')}
   256→        />
   257→        <ProfileScoreCard
   258→          title="Side Profile"
   259→          score={sideScore}
   260→          icon={<ScanFace size={24} className="text-neutral-600" />}
   261→          photo={sidePhoto || undefined}
   262→          ratioCount={sideRatios.length}
   263→          onClick={() => setActiveTab('side-ratios')}
   264→        />
   265→      </div>
   266→
   267→      {/* Strengths & Flaws Grid */}
   268→      <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
   269→        {/* Strengths */}
   270→        <div>
   271→          <div className="flex items-center justify-between mb-4">
   272→            <div className="flex items-center gap-2">
   273→              <TrendingUp size={20} className="text-green-400" />
   274→              <h3 className="text-lg font-semibold text-white">Strengths</h3>
   275→              <span className="text-sm text-neutral-500">({strengths.length})</span>
   276→            </div>
   277→          </div>
   278→
   279→          <div className="space-y-3">
   280→            {topStrengths.length > 0 ? (
   281→              topStrengths.map((strength) => (
   282→                <StrengthCard
   283→                  key={strength.id}
   284→                  strength={strength}
   285→                  isExpanded={expandedStrength === strength.id}
   286→                  onToggle={() => setExpandedStrength(
   287→                    expandedStrength === strength.id ? null : strength.id
   288→                  )}
   289→                />
   290→              ))
   291→            ) : (
   292→              <div className="bg-neutral-900/50 border border-neutral-800 rounded-lg p-6 text-center">
   293→                <p className="text-neutral-500">No significant strengths detected</p>
   294→              </div>
   295→            )}
   296→          </div>
   297→
   298→          {strengths.length > 5 && (
   299→            <button className="w-full mt-3 py-2 text-sm text-cyan-400 hover:text-cyan-300 transition-colors">
   300→              View all {strengths.length} strengths
   301→            </button>
   302→          )}
   303→        </div>
   304→
   305→        {/* Flaws */}
   306→        <div>
   307→          <div className="flex items-center justify-between mb-4">
   308→            <div className="flex items-center gap-2">
   309→              <TrendingDown size={20} className="text-red-400" />
   310→              <h3 className="text-lg font-semibold text-white">Areas for Improvement</h3>
   311→              <span className="text-sm text-neutral-500">({flaws.length})</span>
   312→            </div>
   313→          </div>
   314→
   315→          <div className="space-y-3">
   316→            {topFlaws.length > 0 ? (
   317→              topFlaws.map((flaw, index) => (
   318→                <FlawCard
   319→                  key={flaw.id}
   320→                  flaw={flaw}
   321→                  rank={index + 1}
   322→                  isExpanded={expandedFlaw === flaw.id}
   323→                  onToggle={() => setExpandedFlaw(
   324→                    expandedFlaw === flaw.id ? null : flaw.id
   325→                  )}
   326→                  onRatioClick={(ratio) => handleRatioClick(ratio, flaw.categoryName)}
   327→                />
   328→              ))
   329→            ) : (
   330→              <div className="bg-neutral-900/50 border border-neutral-800 rounded-lg p-6 text-center">
   331→                <p className="text-neutral-500">No significant flaws detected</p>
   332→              </div>
   333→            )}
   334→          </div>
   335→
   336→          {flaws.length > 5 && (
   337→            <button className="w-full mt-3 py-2 text-sm text-cyan-400 hover:text-cyan-300 transition-colors">
   338→              View all {flaws.length} areas
   339→            </button>
   340→          )}
   341→        </div>
   342→      </div>
   343→
   344→      {/* Call to Action */}
   345→      <motion.div
   346→        className="mt-8 bg-gradient-to-r from-cyan-500/20 to-blue-600/20 border border-cyan-500/30 rounded-xl p-6 flex items-center justify-between"
   347→        initial={{ opacity: 0 }}
   348→        animate={{ opacity: 1 }}
   349→        transition={{ delay: 0.5 }}
   350→      >
   351→        <div className="flex items-center gap-4">
   352→          <div className="w-12 h-12 rounded-xl bg-cyan-500/20 flex items-center justify-center">
   353→            <Sparkles size={24} className="text-cyan-400" />
   354→          </div>
   355→          <div>
   356→            <h3 className="font-semibold text-white">Unlock Your Potential</h3>
   357→            <p className="text-sm text-neutral-400">
   358→              See personalized recommendations to improve your harmony score
   359→            </p>
   360→          </div>
   361→        </div>
   362→        <button
   363→          onClick={() => setActiveTab('plan')}
   364→          className="px-4 py-2 bg-cyan-500 text-black font-medium rounded-lg hover:bg-cyan-400 transition-colors flex items-center gap-2"
   365→        >
   366→          View Plan
   367→          <ChevronRight size={16} />
   368→        </button>
   369→      </motion.div>
   370→      </div>{/* End of results-overview */}
   371→
   372→      {/* Metric Detail Modal */}
   373→      <MetricDetailModal
   374→        isOpen={isModalOpen}
   375→        onClose={() => setIsModalOpen(false)}
   376→        ratio={selectedRatio}
   377→      />
   378→    </TabContent>
   379→  );
   380→}
   381→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
