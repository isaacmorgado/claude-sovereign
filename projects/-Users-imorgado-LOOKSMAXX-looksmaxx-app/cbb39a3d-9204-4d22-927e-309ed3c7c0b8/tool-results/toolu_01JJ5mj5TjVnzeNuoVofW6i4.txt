    65→
    66→
    67→async def get_current_user(
    68→    credentials: HTTPAuthorizationCredentials = Depends(security),
    69→    db: AsyncSession = Depends(get_db)
    70→) -> User:
    71→    """Dependency to get the current authenticated user"""
    72→    credentials_exception = HTTPException(
    73→        status_code=status.HTTP_401_UNAUTHORIZED,
    74→        detail="Could not validate credentials",
    75→        headers={"WWW-Authenticate": "Bearer"},
    76→    )
    77→
    78→    token = credentials.credentials
    79→    user_id = AuthService.decode_token(token)
    80→
    81→    if user_id is None:
    82→        raise credentials_exception
    83→
    84→    result = await db.execute(select(User).where(User.id == user_id))
    85→    user = result.scalar_one_or_none()
    86→
    87→    if user is None:
    88→        raise credentials_exception
    89→
    90→    return user
    91→
    92→
    93→async def get_current_user_optional(
    94→    credentials: Optional[HTTPAuthorizationCredentials] = Depends(optional_security),
    95→    db: AsyncSession = Depends(get_db)
    96→) -> Optional[User]:
    97→    """Dependency to optionally get the current authenticated user.
    98→    Returns None if no valid token is provided instead of raising an exception.
    99→    """
   100→    if credentials is None:
   101→        return None
   102→
   103→    token = credentials.credentials
   104→    user_id = AuthService.decode_token(token)
   105→
   106→    if user_id is None:
   107→        return None
   108→
   109→    result = await db.execute(select(User).where(User.id == user_id))
   110→    user = result.scalar_one_or_none()
   111→
   112→    return user
   113→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
