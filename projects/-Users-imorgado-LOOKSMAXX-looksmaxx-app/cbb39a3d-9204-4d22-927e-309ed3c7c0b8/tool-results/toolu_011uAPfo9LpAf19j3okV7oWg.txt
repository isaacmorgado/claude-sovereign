     1→"""
     2→User database model
     3→"""
     4→
     5→import uuid
     6→from datetime import datetime
     7→from sqlalchemy import Column, String, DateTime, Enum, Boolean, Integer, Float
     8→from sqlalchemy.dialects.postgresql import UUID
     9→from sqlalchemy.orm import relationship
    10→import enum
    11→
    12→from app.database import Base
    13→
    14→
    15→class PlanType(str, enum.Enum):
    16→    FREE = "free"
    17→    BASIC = "basic"
    18→    PRO = "pro"
    19→
    20→
    21→class UserRole(str, enum.Enum):
    22→    USER = "user"
    23→    MODERATOR = "moderator"
    24→    ADMIN = "admin"
    25→
    26→
    27→class User(Base):
    28→    __tablename__ = "users"
    29→
    30→    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    31→    email = Column(String, unique=True, nullable=False, index=True)
    32→    password_hash = Column(String, nullable=False)
    33→    name = Column(String, nullable=True)
    34→    username = Column(String(30), unique=True, nullable=False, index=True)
    35→    terms_accepted_at = Column(DateTime, nullable=True)
    36→    plan = Column(Enum(PlanType), default=PlanType.FREE)
    37→    stripe_customer_id = Column(String, nullable=True)
    38→    stripe_subscription_id = Column(String, nullable=True)
    39→
    40→    # User role for moderation
    41→    role = Column(Enum(UserRole), default=UserRole.USER)
    42→
    43→    # Referral tracking
    44→    referral_code = Column(String(50), nullable=True, index=True)  # Code used at signup
    45→    referred_by = Column(String(100), nullable=True, index=True)  # Stripe promo code ID
    46→
    47→    # Password reset
    48→    password_reset_token = Column(String(255), nullable=True, index=True)
    49→    password_reset_expires = Column(DateTime, nullable=True)
    50→
    51→    # PSL System - Height & Weight
    52→    height_cm = Column(Integer, nullable=True)  # User height in centimeters for PSL calculation
    53→    weight_kg = Column(Float, nullable=True)  # User weight in kilograms for FFMI calculation
    54→
    55→    created_at = Column(DateTime, default=datetime.utcnow)
    56→    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    57→
    58→    # Relationships
    59→    analyses = relationship("Analysis", back_populates="user", cascade="all, delete-orphan")
    60→    payments = relationship("Payment", back_populates="user", cascade="all, delete-orphan")
    61→
    62→    def __repr__(self):
    63→        return f"<User {self.email}>"
    64→
    65→
    66→class ReferralCode(Base):
    67→    """Influencer referral codes linked to Stripe promotion codes"""
    68→    __tablename__ = "referral_codes"
    69→
    70→    id = Column(UUID(as_uuid=True), primary_key=True, default=uuid.uuid4)
    71→    code = Column(String(50), unique=True, nullable=False, index=True)
    72→    influencer_name = Column(String(100), nullable=False)
    73→    stripe_promotion_code_id = Column(String(100), nullable=True)
    74→    stripe_coupon_id = Column(String(100), nullable=True)
    75→    discount_percent = Column(Integer, default=10)
    76→    is_active = Column(Boolean, default=True)
    77→    total_uses = Column(Integer, default=0)
    78→    created_at = Column(DateTime, default=datetime.utcnow)
    79→    updated_at = Column(DateTime, default=datetime.utcnow, onupdate=datetime.utcnow)
    80→
    81→    def __repr__(self):
    82→        return f"<ReferralCode {self.code}>"
    83→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
