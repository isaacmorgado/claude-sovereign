     1→"""
     2→Database configuration using SQLAlchemy async
     3→"""
     4→print("[DB] Loading database module...", flush=True)
     5→
     6→from sqlalchemy.ext.asyncio import create_async_engine, AsyncSession, async_sessionmaker
     7→from sqlalchemy.orm import declarative_base
     8→
     9→from app.config import get_settings
    10→
    11→settings = get_settings()
    12→print(f"[DB] Database URL prefix: {settings.database_url[:30]}...", flush=True)
    13→
    14→# Create async engine
    15→engine = create_async_engine(
    16→    settings.database_url,
    17→    echo=settings.debug,
    18→    pool_pre_ping=True,
    19→)
    20→print("[DB] Engine created", flush=True)
    21→
    22→# Create async session factory
    23→async_session = async_sessionmaker(
    24→    engine,
    25→    class_=AsyncSession,
    26→    expire_on_commit=False,
    27→)
    28→
    29→# Base class for models
    30→Base = declarative_base()
    31→
    32→
    33→async def get_db():
    34→    """Dependency for getting database session"""
    35→    async with async_session() as session:
    36→        try:
    37→            yield session
    38→            await session.commit()
    39→        except Exception:
    40→            await session.rollback()
    41→            raise
    42→        finally:
    43→            await session.close()
    44→
    45→
    46→async def init_db():
    47→    """Initialize database tables"""
    48→    async with engine.begin() as conn:
    49→        await conn.run_sync(Base.metadata.create_all)
    50→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
