     1→'use client';
     2→
     3→import { useState, useMemo, useRef, useEffect } from 'react';
     4→import { createPortal } from 'react-dom';
     5→import { motion, AnimatePresence } from 'framer-motion';
     6→import { X, ChevronLeft, ChevronRight, AlertTriangle, Sparkles, Info, BarChart3 } from 'lucide-react';
     7→import { FaceIQScoreResult, Gender, Ethnicity, FACEIQ_METRICS } from '@/lib/faceiq-scoring';
     8→import { generateAIDescription, getSeverityFromScore } from '@/lib/aiDescriptions';
     9→import { getScoreColor } from '@/types/results';
    10→import { GradientRangeBar } from '../visualization/GradientRangeBar';
    11→
    12→// ============================================
    13→// TYPES
    14→// ============================================
    15→
    16→interface RatioDetailModalProps {
    17→  isOpen: boolean;
    18→  onClose: () => void;
    19→  ratio: FaceIQScoreResult | null;
    20→  onPrevious?: () => void;
    21→  onNext?: () => void;
    22→  hasPrevious?: boolean;
    23→  hasNext?: boolean;
    24→  facePhoto?: string;
    25→  gender?: Gender;
    26→  ethnicity?: Ethnicity;
    27→}
    28→
    29→// ============================================
    30→// STAT CARD (FaceIQ Style)
    31→// ============================================
    32→
    33→interface StatCardProps {
    34→  label: string;
    35→  value: string;
    36→  subtext?: string;
    37→  variant?: 'default' | 'ideal' | 'score';
    38→  scoreColor?: string;
    39→  subtextColor?: string;
    40→}
    41→
    42→function StatCard({ label, value, subtext, variant = 'default', scoreColor, subtextColor }: StatCardProps) {
    43→  const variants = {
    44→    default: 'bg-neutral-800/80 border-neutral-700',
    45→    ideal: 'bg-cyan-500/10 border-cyan-500/30',
    46→    score: 'bg-blue-500/10 border-blue-500/30',
    47→  };
    48→
    49→  const labelColors = {
    50→    default: 'text-neutral-500',
    51→    ideal: 'text-cyan-400',
    52→    score: 'text-neutral-500',
    53→  };
    54→
    55→  return (
    56→    <div className={`rounded-xl border p-3 md:p-4 ${variants[variant]}`}>
    57→      <div className={`text-[10px] font-medium uppercase tracking-wider mb-1 ${labelColors[variant]}`}>
    58→        {label}
    59→      </div>
    60→      <div
    61→        className="text-lg md:text-xl font-semibold"
    62→        style={scoreColor ? { color: scoreColor } : { color: variant === 'ideal' ? 'rgb(34, 211, 238)' : 'white' }}
    63→      >
    64→        {value}
    65→      </div>
    66→      {subtext && (
    67→        <div
    68→          className="text-[10px] mt-0.5 md:mt-1"
    69→          style={{ color: subtextColor || 'rgb(115, 115, 115)' }}
    70→        >
    71→          {subtext}
    72→        </div>
    73→      )}
    74→    </div>
    75→  );
    76→}
    77→
    78→// ============================================
    79→// SCORING METHODOLOGY CHART
    80→// ============================================
    81→
    82→interface ScoringMethodologyChartProps {
    83→  value: number;
    84→  score: number;
    85→  idealMin: number;
    86→  idealMax: number;
    87→  rangeMin: number;
    88→  rangeMax: number;
    89→  unit: string;
    90→  decayRate?: number;
    91→}
    92→
    93→function ScoringMethodologyChart({
    94→  value,
    95→  score,
    96→  idealMin,
    97→  idealMax,
    98→  rangeMin,
    99→  rangeMax,
   100→  unit,
   101→  decayRate = 4,
   102→}: ScoringMethodologyChartProps) {
   103→  const canvasRef = useRef<HTMLCanvasElement>(null);
   104→
   105→  useEffect(() => {
   106→    const canvas = canvasRef.current;
   107→    if (!canvas) return;
   108→
   109→    const ctx = canvas.getContext('2d');
   110→    if (!ctx) return;
   111→
   112→    const dpr = window.devicePixelRatio || 1;
   113→    const rect = canvas.getBoundingClientRect();
   114→    canvas.width = rect.width * dpr;
   115→    canvas.height = rect.height * dpr;
   116→    ctx.scale(dpr, dpr);
   117→
   118→    const width = rect.width;
   119→    const height = rect.height;
   120→    const padding = { top: 20, right: 40, bottom: 40, left: 50 };
   121→    const chartWidth = width - padding.left - padding.right;
   122→    const chartHeight = height - padding.top - padding.bottom;
   123→
   124→    // Clear canvas
   125→    ctx.clearRect(0, 0, width, height);
   126→
   127→    // Calculate score for any x value using exponential decay
   128→    const calculateScore = (x: number): number => {
   129→      const idealRangeHalf = (idealMax - idealMin) / 2;
   130→
   131→      if (x >= idealMin && x <= idealMax) {
   132→        return 10;
   133→      }
   134→
   135→      const deviation = x < idealMin
   136→        ? (idealMin - x) / idealRangeHalf
   137→        : (x - idealMax) / idealRangeHalf;
   138→
   139→      return Math.max(1, 10 * Math.exp(-decayRate * Math.pow(deviation, 2)));
   140→    };
   141→
   142→    // X-axis scale
   143→    const xScale = (val: number) => padding.left + ((val - rangeMin) / (rangeMax - rangeMin)) * chartWidth;
   144→    const yScale = (val: number) => padding.top + (1 - val / 10) * chartHeight;
   145→
   146→    // Draw gradient fill under curve
   147→    const gradient = ctx.createLinearGradient(padding.left, 0, padding.left + chartWidth, 0);
   148→    const idealMinPos = (idealMin - rangeMin) / (rangeMax - rangeMin);
   149→    const idealMaxPos = (idealMax - rangeMin) / (rangeMax - rangeMin);
   150→
   151→    // Create gradient stops
   152→    gradient.addColorStop(0, 'rgba(185, 28, 28, 0.2)');
   153→    gradient.addColorStop(Math.max(0, idealMinPos - 0.1), 'rgba(249, 115, 22, 0.2)');
   154→    gradient.addColorStop(Math.max(0, idealMinPos), 'rgba(6, 182, 212, 0.3)');
   155→    gradient.addColorStop(Math.min(1, idealMaxPos), 'rgba(6, 182, 212, 0.3)');
   156→    gradient.addColorStop(Math.min(1, idealMaxPos + 0.1), 'rgba(249, 115, 22, 0.2)');
   157→    gradient.addColorStop(1, 'rgba(185, 28, 28, 0.2)');
   158→
   159→    // Draw fill
   160→    ctx.beginPath();
   161→    ctx.moveTo(xScale(rangeMin), yScale(0));
   162→    for (let i = 0; i <= 100; i++) {
   163→      const x = rangeMin + (rangeMax - rangeMin) * (i / 100);
   164→      const y = calculateScore(x);
   165→      if (i === 0) {
   166→        ctx.lineTo(xScale(x), yScale(y));
   167→      } else {
   168→        ctx.lineTo(xScale(x), yScale(y));
   169→      }
   170→    }
   171→    ctx.lineTo(xScale(rangeMax), yScale(0));
   172→    ctx.closePath();
   173→    ctx.fillStyle = gradient;
   174→    ctx.fill();
   175→
   176→    // Draw ideal range highlight
   177→    ctx.fillStyle = 'rgba(6, 182, 212, 0.15)';
   178→    ctx.fillRect(xScale(idealMin), padding.top, xScale(idealMax) - xScale(idealMin), chartHeight);
   179→
   180→    // Draw curve
   181→    const lineGradient = ctx.createLinearGradient(padding.left, 0, padding.left + chartWidth, 0);
   182→    lineGradient.addColorStop(0, 'rgb(185, 28, 28)');
   183→    lineGradient.addColorStop(Math.max(0, idealMinPos - 0.1), 'rgb(249, 115, 22)');
   184→    lineGradient.addColorStop(Math.max(0, idealMinPos), 'rgb(6, 182, 212)');
   185→    lineGradient.addColorStop(Math.min(1, idealMaxPos), 'rgb(6, 182, 212)');
   186→    lineGradient.addColorStop(Math.min(1, idealMaxPos + 0.1), 'rgb(249, 115, 22)');
   187→    lineGradient.addColorStop(1, 'rgb(185, 28, 28)');
   188→
   189→    ctx.beginPath();
   190→    for (let i = 0; i <= 100; i++) {
   191→      const x = rangeMin + (rangeMax - rangeMin) * (i / 100);
   192→      const y = calculateScore(x);
   193→      if (i === 0) {
   194→        ctx.moveTo(xScale(x), yScale(y));
   195→      } else {
   196→        ctx.lineTo(xScale(x), yScale(y));
   197→      }
   198→    }
   199→    ctx.strokeStyle = lineGradient;
   200→    ctx.lineWidth = 2.5;
   201→    ctx.stroke();
   202→
   203→    // Draw axes
   204→    ctx.strokeStyle = 'rgb(64, 64, 64)';
   205→    ctx.lineWidth = 1;
   206→
   207→    // Y-axis
   208→    ctx.beginPath();
   209→    ctx.moveTo(padding.left, padding.top);
   210→    ctx.lineTo(padding.left, padding.top + chartHeight);
   211→    ctx.stroke();
   212→
   213→    // X-axis
   214→    ctx.beginPath();
   215→    ctx.moveTo(padding.left, padding.top + chartHeight);
   216→    ctx.lineTo(padding.left + chartWidth, padding.top + chartHeight);
   217→    ctx.stroke();
   218→
   219→    // Y-axis labels
   220→    ctx.fillStyle = 'rgb(115, 115, 115)';
   221→    ctx.font = '10px system-ui';
   222→    ctx.textAlign = 'right';
   223→    for (let i = 0; i <= 10; i += 2) {
   224→      ctx.fillText(i.toString(), padding.left - 8, yScale(i) + 3);
   225→    }
   226→
   227→    // X-axis labels
   228→    ctx.textAlign = 'center';
   229→    const steps = 5;
   230→    for (let i = 0; i <= steps; i++) {
   231→      const val = rangeMin + (rangeMax - rangeMin) * (i / steps);
   232→      const formatted = unit === 'percent' || unit === '%' ? val.toFixed(0) + '%' : val.toFixed(2);
   233→      ctx.fillText(formatted, xScale(val), padding.top + chartHeight + 20);
   234→    }
   235→
   236→    // Draw current value marker
   237→    const currentX = xScale(value);
   238→    const currentY = yScale(score);
   239→
   240→    // Vertical line
   241→    ctx.setLineDash([4, 4]);
   242→    ctx.strokeStyle = 'rgba(255, 255, 255, 0.3)';
   243→    ctx.beginPath();
   244→    ctx.moveTo(currentX, currentY);
   245→    ctx.lineTo(currentX, padding.top + chartHeight);
   246→    ctx.stroke();
   247→    ctx.setLineDash([]);
   248→
   249→    // Marker circle
   250→    ctx.beginPath();
   251→    ctx.arc(currentX, currentY, 6, 0, Math.PI * 2);
   252→    ctx.fillStyle = 'white';
   253→    ctx.fill();
   254→    ctx.strokeStyle = getScoreColor(score);
   255→    ctx.lineWidth = 2;
   256→    ctx.stroke();
   257→
   258→    // Value label
   259→    ctx.fillStyle = 'white';
   260→    ctx.font = 'bold 11px system-ui';
   261→    const labelText = `${value.toFixed(2)} = ${score.toFixed(1)}/10`;
   262→    const labelWidth = ctx.measureText(labelText).width + 16;
   263→    const labelX = Math.min(Math.max(currentX - labelWidth / 2, padding.left), width - padding.right - labelWidth);
   264→    const labelY = currentY - 20;
   265→
   266→    ctx.fillStyle = 'rgba(38, 38, 38, 0.95)';
   267→    ctx.beginPath();
   268→    ctx.roundRect(labelX, labelY - 12, labelWidth, 20, 4);
   269→    ctx.fill();
   270→
   271→    ctx.fillStyle = 'white';
   272→    ctx.textAlign = 'center';
   273→    ctx.fillText(labelText, labelX + labelWidth / 2, labelY + 2);
   274→
   275→  }, [value, score, idealMin, idealMax, rangeMin, rangeMax, unit, decayRate]);
   276→
   277→  return (
   278→    <div className="rounded-xl bg-neutral-800/50 border border-neutral-700 p-4">
   279→      <div className="mb-3">
   280→        <div className="flex items-start justify-between">
   281→          <div>
   282→            <div className="flex items-center gap-1.5 mb-1">
   283→              <BarChart3 size={14} className="text-neutral-400" />
   284→              <span className="text-[10px] font-medium text-neutral-400 uppercase tracking-wider">
   285→                Scoring Methodology
   286→              </span>
   287→            </div>
   288→            <div className="text-[10px] text-neutral-500">Understand Your Score Better</div>
   289→          </div>
   290→          <div className="text-right bg-neutral-900/80 px-3 py-1.5 rounded-lg border border-neutral-700">
   291→            <div className="text-[10px] text-neutral-500 mb-0.5">Your Value</div>
   292→            <div className="text-xs font-medium" style={{ color: getScoreColor(score) }}>
   293→              {value.toFixed(2)} = {score.toFixed(1)}/10
   294→            </div>
   295→          </div>
   296→        </div>
   297→      </div>
   298→      <div className="h-56 sm:h-64">
   299→        <canvas
   300→          ref={canvasRef}
   301→          className="w-full h-full"
   302→          style={{ display: 'block' }}
   303→        />
   304→      </div>
   305→    </div>
   306→  );
   307→}
   308→
   309→// ============================================
   310→// ABOUT DESCRIPTIONS
   311→// ============================================
   312→
   313→// eslint-disable-next-line @typescript-eslint/no-unused-vars
   314→function getAboutDescription(name: string, category: string, gender?: Gender, ethnicity?: Ethnicity): string {
   315→  const descriptions: Record<string, string> = {
   316→    'Face Width to Height Ratio': 'Facial Width-to-Height Ratio evaluates midface compactness by comparing its width to height. Balanced proportions suit most faces; higher ratios (shorter midfaces) are preferred for males.',
   317→    'Lower Third': 'Facial thirds assess the vertical height of facial thirds relative to total facial height, favoring a balanced proportion with a slightly taller Lower Third in males.',
   318→    'Middle Third': 'The middle third spans from the brow line to the base of the nose. A balanced middle third contributes to overall facial harmony.',
   319→    'Upper Third': 'The upper third spans from the hairline to the brow line. Its proportion affects forehead prominence and hairline positioning.',
   320→    'Lateral Canthal Tilt': 'Canthal tilt measures the angle of the eye from inner to outer corner. A positive tilt (outer corner higher) is generally considered more attractive and youthful.',
   321→    'Gonial Angle': 'The gonial angle measures the angle at the jaw corner. A well-defined angle contributes to jaw prominence and facial structure.',
   322→    'Bigonial Width': 'Bigonial width measures the distance between the jaw angles. It contributes to the perception of jaw strength and facial width.',
   323→    'Eye Aspect Ratio': 'Eye aspect ratio compares eye height to width. Almond-shaped eyes with balanced proportions are often considered ideal.',
   324→    'Nasal Index': 'The nasal index compares nose width to height. Balanced proportions contribute to facial harmony.',
   325→    'Chin Philtrum Ratio': 'This ratio compares chin height to philtrum length. Proper balance contributes to lower face harmony.',
   326→    'Submental Cervical Angle': 'This angle measures the definition between chin and neck. A well-defined angle creates a clean jawline profile.',
   327→    'Nose Bridge Width': 'Compares nose bridge width to the overall nose width. Ideal proportions create a refined nasal appearance.',
   328→    'Eyebrow Tilt': 'Measures the angle of the eyebrows. Balanced tilt contributes to a harmonious eye region.',
   329→    'Brow Length Ratio': 'Compares eyebrow length to face width. Appropriately proportioned eyebrows create better facial framing.',
   330→  };
   331→
   332→  let baseDescription = descriptions[name] ||
   333→    `This measurement evaluates your ${category.toLowerCase()} proportions and contributes to overall facial harmony.`;
   334→
   335→  // Add gender-specific context if available
   336→  if (gender) {
   337→    const genderContext = gender === 'male'
   338→      ? ' Ideal ranges for males tend to favor more angular and defined features.'
   339→      : ' Ideal ranges for females tend to favor softer, more balanced proportions.';
   340→    baseDescription += genderContext;
   341→  }
   342→
   343→  return baseDescription;
   344→}
   345→
   346→// ============================================
   347→// MAIN MODAL COMPONENT
   348→// ============================================
   349→
   350→export function RatioDetailModal({
   351→  isOpen,
   352→  onClose,
   353→  ratio,
   354→  onPrevious,
   355→  onNext,
   356→  hasPrevious = false,
   357→  hasNext = false,
   358→  facePhoto,
   359→  gender,
   360→  ethnicity,
   361→}: RatioDetailModalProps) {
   362→  // Handle client-side mounting for portal
   363→  const [mounted, setMounted] = useState(false);
   364→
   365→  useEffect(() => {
   366→    setMounted(true);
   367→  }, []);
   368→
   369→  // Generate AI description from ratio data
   370→  const flawDetail = useMemo(() => {
   371→    if (!ratio) return null;
   372→
   373→    return generateAIDescription(
   374→      ratio.metricId.toLowerCase().replace(/\s+/g, ''),
   375→      ratio.name,
   376→      ratio.value,
   377→      ratio.idealMin,
   378→      ratio.idealMax,
   379→      ratio.score,
   380→      ratio.unit,
   381→      ratio.category
   382→    );
   383→  }, [ratio]);
   384→
   385→  // Early returns
   386→  if (!mounted) return null;
   387→  if (!ratio || !flawDetail) return null;
   388→
   389→  const scoreColor = getScoreColor(ratio.score);
   390→  const isWithinIdeal = ratio.value >= ratio.idealMin && ratio.value <= ratio.idealMax;
   391→  const severity = getSeverityFromScore(ratio.score);
   392→
   393→  // Get metric config for decay rate
   394→  const metricConfig = FACEIQ_METRICS[ratio.metricId];
   395→  const decayRate = metricConfig?.decayRate || 4;
   396→
   397→  // Format values with units
   398→  const formatUnit = (v: number) => {
   399→    const formatted = v.toFixed(ratio.unit === 'percent' ? 1 : 2);
   400→    let suffix = '';
   401→    switch (ratio.unit) {
   402→      case 'percent':
   403→        suffix = ' %';
   404→        break;
   405→      case 'degrees':
   406→        suffix = '\u00B0';
   407→        break;
   408→      case 'mm':
   409→        suffix = ' mm';
   410→        break;
   411→      case 'ratio':
   412→      default:
   413→        suffix = '';
   414→    }
   415→    return `${formatted}${suffix}`;
   416→  };
   417→
   418→  // Calculate range for visualization
   419→  const idealRange = ratio.idealMax - ratio.idealMin;
   420→  const rangeMin = ratio.idealMin - idealRange * 1.5;
   421→  const rangeMax = ratio.idealMax + idealRange * 1.5;
   422→
   423→  // Use portal to render modal at document body level
   424→  const modalContent = (
   425→    <AnimatePresence>
   426→      {isOpen && (
   427→        <>
   428→          {/* Backdrop */}
   429→          <motion.div
   430→            initial={{ opacity: 0 }}
   431→            animate={{ opacity: 1 }}
   432→            exit={{ opacity: 0 }}
   433→            onClick={onClose}
   434→            className="fixed inset-0 bg-black/80 backdrop-blur-sm z-[9998]"
   435→          />
   436→
   437→          {/* Navigation Arrows - Desktop */}
   438→          {hasPrevious && onPrevious && (
   439→            <motion.button
   440→              initial={{ opacity: 0, x: -10 }}
   441→              animate={{ opacity: 1, x: 0 }}
   442→              exit={{ opacity: 0, x: -10 }}
   443→              onClick={onPrevious}
   444→              className="hidden lg:flex fixed left-4 xl:left-8 top-1/2 -translate-y-1/2 z-[10001] w-12 h-12 rounded-full bg-neutral-800 border border-neutral-600 shadow-xl hover:bg-neutral-700 hover:border-neutral-500 transition-all items-center justify-center group"
   445→              aria-label="Previous measurement"
   446→            >
   447→              <ChevronLeft className="w-6 h-6 text-neutral-300 group-hover:text-white" />
   448→            </motion.button>
   449→          )}
   450→
   451→          {hasNext && onNext && (
   452→            <motion.button
   453→              initial={{ opacity: 0, x: 10 }}
   454→              animate={{ opacity: 1, x: 0 }}
   455→              exit={{ opacity: 0, x: 10 }}
   456→              onClick={onNext}
   457→              className="hidden lg:flex fixed right-4 xl:right-8 top-1/2 -translate-y-1/2 z-[10001] w-12 h-12 rounded-full bg-neutral-800 border border-neutral-600 shadow-xl hover:bg-neutral-700 hover:border-neutral-500 transition-all items-center justify-center group"
   458→              aria-label="Next measurement"
   459→            >
   460→              <ChevronRight className="w-6 h-6 text-neutral-300 group-hover:text-white" />
   461→            </motion.button>
   462→          )}
   463→
   464→          {/* Modal Container - Full screen flex centering */}
   465→          <div className="fixed inset-0 z-[9999] flex items-center justify-center p-4 pointer-events-none">
   466→            <motion.div
   467→              initial={{ opacity: 0, scale: 0.95, y: 20 }}
   468→              animate={{ opacity: 1, scale: 1, y: 0 }}
   469→              exit={{ opacity: 0, scale: 0.95, y: 20 }}
   470→              transition={{ type: 'spring', damping: 25, stiffness: 300 }}
   471→              className="relative w-full max-w-5xl max-h-[90vh] overflow-hidden bg-neutral-900 border border-neutral-700 rounded-2xl shadow-2xl pointer-events-auto"
   472→            >
   473→            {/* Header */}
   474→            <div className="sticky top-0 bg-neutral-900/95 backdrop-blur-sm border-b border-neutral-800 px-4 py-4 md:px-6 z-10">
   475→              <div className="flex items-center justify-between">
   476→                <div className="flex items-center gap-3 flex-1 min-w-0">
   477→                  {/* Mobile nav */}
   478→                  {hasPrevious && onPrevious && (
   479→                    <button
   480→                      onClick={onPrevious}
   481→                      className="lg:hidden flex-shrink-0 p-1.5 rounded-lg hover:bg-neutral-800 transition-colors text-neutral-400"
   482→                      aria-label="Previous measurement"
   483→                    >
   484→                      <ChevronLeft className="w-5 h-5" />
   485→                    </button>
   486→                  )}
   487→
   488→                  <h2 className="text-lg md:text-xl font-semibold text-white truncate">
   489→                    {ratio.name}
   490→                  </h2>
   491→
   492→                  {hasNext && onNext && (
   493→                    <button
   494→                      onClick={onNext}
   495→                      className="lg:hidden flex-shrink-0 p-1.5 rounded-lg hover:bg-neutral-800 transition-colors text-neutral-400"
   496→                      aria-label="Next measurement"
   497→                    >
   498→                      <ChevronRight className="w-5 h-5" />
   499→                    </button>
   500→                  )}
   501→                </div>
   502→
   503→                <button
   504→                  onClick={onClose}
   505→                  className="flex-shrink-0 ml-4 p-2 rounded-lg hover:bg-neutral-800 transition-colors text-neutral-400 hover:text-white"
   506→                >
   507→                  <X className="w-5 h-5" />
   508→                </button>
   509→              </div>
   510→            </div>
   511→
   512→            {/* Content */}
   513→            <div className="p-4 md:p-6 space-y-4 overflow-y-auto max-h-[calc(90vh-72px)]">
   514→              {/* Stats Grid */}
   515→              <div className="grid grid-cols-1 sm:grid-cols-3 gap-3">
   516→                <StatCard
   517→                  label="Your Value"
   518→                  value={formatUnit(ratio.value)}
   519→                  subtext={isWithinIdeal ? 'Within ideal' : 'Outside ideal'}
   520→                  variant="default"
   521→                  subtextColor={isWithinIdeal ? 'rgb(34, 197, 94)' : 'rgb(239, 68, 68)'}
   522→                />
   523→                <StatCard
   524→                  label="Ideal Range"
   525→                  value={`${formatUnit(ratio.idealMin)} - ${formatUnit(ratio.idealMax)}`}
   526→                  subtext="Target range"
   527→                  variant="ideal"
   528→                />
   529→                <StatCard
   530→                  label="Score"
   531→                  value={`${ratio.score.toFixed(2)}/10`}
   532→                  subtext="Normalized score (1-10)"
   533→                  variant="score"
   534→                  scoreColor={scoreColor}
   535→                />
   536→              </div>
   537→
   538→              {/* Gradient Range Bar */}
   539→              <GradientRangeBar
   540→                value={ratio.value}
   541→                idealMin={ratio.idealMin}
   542→                idealMax={ratio.idealMax}
   543→                rangeMin={rangeMin}
   544→                rangeMax={rangeMax}
   545→                unit={ratio.unit}
   546→              />
   547→
   548→              {/* Two Column Layout */}
   549→              <div className="grid lg:grid-cols-2 gap-4">
   550→                {/* Face Image (if available) */}
   551→                {facePhoto && (
   552→                  <div>
   553→                    <div className="relative rounded-xl overflow-hidden border border-neutral-700 bg-neutral-800">
   554→                      <div className="relative w-full" style={{ aspectRatio: '1/1' }}>
   555→                        <img
   556→                          src={facePhoto}
   557→                          alt="Face"
   558→                          className="w-full h-full object-contain"
   559→                        />
   560→                      </div>
   561→                    </div>
   562→                  </div>
   563→                )}
   564→
   565→                {/* Info Sections */}
   566→                <div className={`space-y-4 ${!facePhoto ? 'lg:col-span-2' : ''}`}>
   567→                  {/* May Indicate Strengths - Only show if score is >= 7 */}
   568→                  {ratio.score >= 7 && (
   569→                    <div className="rounded-xl bg-cyan-500/10 border border-cyan-500/30 p-4">
   570→                      <div className="flex items-center gap-2 mb-3">
   571→                        <Sparkles size={14} className="text-cyan-400" />
   572→                        <span className="text-[10px] font-medium text-cyan-400 uppercase tracking-wider">
   573→                          May Indicate Strengths
   574→                        </span>
   575→                      </div>
   576→                      <div className="space-y-3">
   577→                        <div className="pb-3 last:border-0 last:pb-0">
   578→                          <div className="text-sm font-semibold text-white mb-1">
   579→                            {ratio.score >= 9 ? 'Ideal ' : 'Good '}{ratio.name.toLowerCase()}
   580→                          </div>
   581→                          <div className="text-xs text-neutral-300 leading-relaxed">
   582→                            The {ratio.name} measurement is {isWithinIdeal ? 'within' : 'close to'} the ideal range.
   583→                            This contributes to a harmonious {ratio.category.toLowerCase()} appearance.
   584→                          </div>
   585→                        </div>
   586→                      </div>
   587→                    </div>
   588→                  )}
   589→
   590→                  {/* May Indicate Flaws - Only show if score is below 7 */}
   591→                  {ratio.score < 7 && (
   592→                    <div className="rounded-xl bg-amber-500/10 border border-amber-500/30 p-4">
   593→                      <div className="flex items-center gap-2 mb-3">
   594→                        <AlertTriangle size={14} className="text-amber-400" />
   595→                        <span className="text-[10px] font-medium text-amber-400 uppercase tracking-wider">
   596→                          May Indicate Flaws
   597→                        </span>
   598→                      </div>
   599→                      <div className="space-y-3">
   600→                        <div className="pb-3 last:border-0 last:pb-0">
   601→                          <div className="text-sm font-semibold text-white mb-1">
   602→                            {flawDetail.flawName}
   603→                          </div>
   604→                          <div className="text-xs text-neutral-300 leading-relaxed">
   605→                            {flawDetail.reasoning}
   606→                          </div>
   607→                        </div>
   608→                      </div>
   609→                    </div>
   610→                  )}
   611→
   612→                  {/* About This Ratio */}
   613→                  <div className="rounded-xl bg-neutral-800/50 border border-neutral-700 p-4">
   614→                    <div className="flex items-center gap-2 mb-3">
   615→                      <Info size={14} className="text-neutral-400" />
   616→                      <span className="text-[10px] font-medium text-neutral-400 uppercase tracking-wider">
   617→                        About This Ratio
   618→                      </span>
   619→                    </div>
   620→                    <div className="text-sm text-neutral-300 leading-relaxed">
   621→                      {getAboutDescription(ratio.name, ratio.category, gender, ethnicity)}
   622→                    </div>
   623→                  </div>
   624→
   625→                  {/* Scoring Methodology Chart */}
   626→                  <ScoringMethodologyChart
   627→                    value={ratio.value}
   628→                    score={ratio.score}
   629→                    idealMin={ratio.idealMin}
   630→                    idealMax={ratio.idealMax}
   631→                    rangeMin={rangeMin}
   632→                    rangeMax={rangeMax}
   633→                    unit={ratio.unit}
   634→                    decayRate={decayRate}
   635→                  />
   636→
   637→                  {/* Category Badge */}
   638→                  <div className="flex flex-wrap items-center gap-2">
   639→                    <span className="px-3 py-1.5 rounded-lg bg-neutral-800 border border-neutral-700 text-xs font-medium text-neutral-300">
   640→                      {ratio.category}
   641→                    </span>
   642→                    <span
   643→                      className="px-3 py-1.5 rounded-lg text-xs font-medium capitalize"
   644→                      style={{
   645→                        backgroundColor: `${scoreColor}20`,
   646→                        color: scoreColor,
   647→                        border: `1px solid ${scoreColor}40`,
   648→                      }}
   649→                    >
   650→                      {severity.replace('_', ' ')}
   651→                    </span>
   652→                    {gender && (
   653→                      <span className="px-3 py-1.5 rounded-lg bg-neutral-800 border border-neutral-700 text-xs font-medium text-neutral-300 capitalize">
   654→                        {gender}
   655→                      </span>
   656→                    )}
   657→                    {ethnicity && ethnicity !== 'other' && (
   658→                      <span className="px-3 py-1.5 rounded-lg bg-neutral-800 border border-neutral-700 text-xs font-medium text-neutral-300 capitalize">
   659→                        {ethnicity.replace('_', ' ')}
   660→                      </span>
   661→                    )}
   662→                  </div>
   663→                </div>
   664→              </div>
   665→            </div>
   666→            </motion.div>
   667→          </div>
   668→        </>
   669→      )}
   670→    </AnimatePresence>
   671→  );
   672→
   673→  return createPortal(modalContent, document.body);
   674→}
   675→
   676→export default RatioDetailModal;
   677→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
