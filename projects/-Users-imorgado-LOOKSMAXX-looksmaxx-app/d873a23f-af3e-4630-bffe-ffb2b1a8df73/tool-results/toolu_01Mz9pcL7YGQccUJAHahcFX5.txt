     1→'use client';
     2→
     3→import { useMemo } from 'react';
     4→import {
     5→  AreaChart,
     6→  Area,
     7→  XAxis,
     8→  YAxis,
     9→  ReferenceLine,
    10→  ResponsiveContainer,
    11→  Tooltip,
    12→} from 'recharts';
    13→import { motion } from 'framer-motion';
    14→import { BellCurveData } from '@/lib/scoring';
    15→
    16→interface BellCurveChartProps {
    17→  data: BellCurveData;
    18→  title: string;
    19→  unit?: string;
    20→  color?: string;
    21→  showIdeal?: boolean;
    22→  showPercentile?: boolean;
    23→  height?: number;
    24→}
    25→
    26→export function BellCurveChart({
    27→  data,
    28→  title,
    29→  unit = '',
    30→  color = '#00f3ff',
    31→  showIdeal = true,
    32→  showPercentile = true,
    33→  height = 200,
    34→}: BellCurveChartProps) {
    35→  const chartData = useMemo(() => {
    36→    return data.points.map((point) => ({
    37→      x: point.x,
    38→      y: point.y,
    39→      // Add fill color based on distance from user value
    40→      isUser: Math.abs(point.x - data.userValue) < data.standardDeviation * 0.1,
    41→    }));
    42→  }, [data]);
    43→
    44→  const formatValue = (value: number) => {
    45→    if (Math.abs(value) >= 100) {
    46→      return value.toFixed(0);
    47→    }
    48→    return value.toFixed(2);
    49→  };
    50→
    51→  const getPercentileLabel = (percentile: number): string => {
    52→    if (percentile >= 95) return 'Top 5%';
    53→    if (percentile >= 90) return 'Top 10%';
    54→    if (percentile >= 75) return 'Above Average';
    55→    if (percentile >= 50) return 'Average';
    56→    if (percentile >= 25) return 'Below Average';
    57→    return 'Bottom 25%';
    58→  };
    59→
    60→  const getPercentileColor = (percentile: number): string => {
    61→    if (percentile >= 90) return '#10b981'; // green
    62→    if (percentile >= 75) return '#22d3ee'; // cyan
    63→    if (percentile >= 50) return '#fbbf24'; // yellow
    64→    if (percentile >= 25) return '#f97316'; // orange
    65→    return '#ef4444'; // red
    66→  };
    67→
    68→  return (
    69→    <motion.div
    70→      initial={{ opacity: 0, y: 20 }}
    71→      animate={{ opacity: 1, y: 0 }}
    72→      className="bg-background-secondary rounded-xl border border-border p-4"
    73→    >
    74→      {/* Header */}
    75→      <div className="flex items-center justify-between mb-4">
    76→        <h3 className="text-sm font-semibold text-white">{title}</h3>
    77→        {showPercentile && (
    78→          <div className="flex items-center gap-2">
    79→            <span
    80→              className="text-xs font-medium px-2 py-1 rounded-full"
    81→              style={{
    82→                backgroundColor: `${getPercentileColor(data.userPercentile)}20`,
    83→                color: getPercentileColor(data.userPercentile),
    84→              }}
    85→            >
    86→              {getPercentileLabel(data.userPercentile)}
    87→            </span>
    88→            <span className="text-xs text-foreground-dim">
    89→              {data.userPercentile.toFixed(1)}th percentile
    90→            </span>
    91→          </div>
    92→        )}
    93→      </div>
    94→
    95→      {/* Chart */}
    96→      <div style={{ height }}>
    97→        <ResponsiveContainer width="100%" height="100%">
    98→          <AreaChart
    99→            data={chartData}
   100→            margin={{ top: 10, right: 10, left: 10, bottom: 20 }}
   101→          >
   102→            <defs>
   103→              <linearGradient id={`gradient-${title}`} x1="0" y1="0" x2="0" y2="1">
   104→                <stop offset="5%" stopColor={color} stopOpacity={0.3} />
   105→                <stop offset="95%" stopColor={color} stopOpacity={0} />
   106→              </linearGradient>
   107→            </defs>
   108→
   109→            <XAxis
   110→              dataKey="x"
   111→              type="number"
   112→              domain={['dataMin', 'dataMax']}
   113→              tickFormatter={(value) => formatValue(value)}
   114→              tick={{ fill: '#71717a', fontSize: 10 }}
   115→              axisLine={{ stroke: '#27272a' }}
   116→              tickLine={{ stroke: '#27272a' }}
   117→            />
   118→
   119→            <YAxis hide />
   120→
   121→            <Tooltip
   122→              contentStyle={{
   123→                backgroundColor: '#18181b',
   124→                border: '1px solid #27272a',
   125→                borderRadius: '8px',
   126→              }}
   127→              labelStyle={{ color: '#fff' }}
   128→              formatter={(value) => {
   129→                const numValue = typeof value === 'number' ? value : 0;
   130→                return [numValue.toFixed(6), 'Density'];
   131→              }}
   132→              labelFormatter={(value) => {
   133→                const numValue = typeof value === 'number' ? value : 0;
   134→                return `Value: ${formatValue(numValue)}${unit}`;
   135→              }}
   136→            />
   137→
   138→            <Area
   139→              type="monotone"
   140→              dataKey="y"
   141→              stroke={color}
   142→              strokeWidth={2}
   143→              fill={`url(#gradient-${title})`}
   144→            />
   145→
   146→            {/* Population Mean Line */}
   147→            <ReferenceLine
   148→              x={data.mean}
   149→              stroke="#71717a"
   150→              strokeDasharray="3 3"
   151→              label={{
   152→                value: 'Mean',
   153→                position: 'top',
   154→                fill: '#71717a',
   155→                fontSize: 10,
   156→              }}
   157→            />
   158→
   159→            {/* User Value Line */}
   160→            <ReferenceLine
   161→              x={data.userValue}
   162→              stroke={color}
   163→              strokeWidth={2}
   164→              label={{
   165→                value: `You: ${formatValue(data.userValue)}${unit}`,
   166→                position: 'top',
   167→                fill: color,
   168→                fontSize: 11,
   169→                fontWeight: 600,
   170→              }}
   171→            />
   172→
   173→            {/* Ideal Value Line (if different from user) */}
   174→            {showIdeal && data.idealValue !== undefined && (
   175→              <ReferenceLine
   176→                x={data.idealValue}
   177→                stroke="#10b981"
   178→                strokeDasharray="5 5"
   179→                label={{
   180→                  value: 'Ideal',
   181→                  position: 'insideTopRight',
   182→                  fill: '#10b981',
   183→                  fontSize: 10,
   184→                }}
   185→              />
   186→            )}
   187→          </AreaChart>
   188→        </ResponsiveContainer>
   189→      </div>
   190→
   191→      {/* Stats Footer */}
   192→      <div className="mt-3 grid grid-cols-3 gap-2 text-center">
   193→        <div className="bg-black/30 rounded-lg p-2">
   194→          <p className="text-[10px] text-foreground-dim">Your Value</p>
   195→          <p className="text-sm font-semibold" style={{ color }}>
   196→            {formatValue(data.userValue)}
   197→            {unit}
   198→          </p>
   199→        </div>
   200→        <div className="bg-black/30 rounded-lg p-2">
   201→          <p className="text-[10px] text-foreground-dim">Population Mean</p>
   202→          <p className="text-sm font-semibold text-white">
   203→            {formatValue(data.mean)}
   204→            {unit}
   205→          </p>
   206→        </div>
   207→        {data.idealValue !== undefined && (
   208→          <div className="bg-black/30 rounded-lg p-2">
   209→            <p className="text-[10px] text-foreground-dim">Ideal</p>
   210→            <p className="text-sm font-semibold text-emerald-400">
   211→              {formatValue(data.idealValue)}
   212→              {unit}
   213→            </p>
   214→          </div>
   215→        )}
   216→      </div>
   217→    </motion.div>
   218→  );
   219→}
   220→
   221→interface BellCurveComparisonProps {
   222→  measurements: Array<{
   223→    key: string;
   224→    title: string;
   225→    data: BellCurveData;
   226→    unit?: string;
   227→  }>;
   228→}
   229→
   230→export function BellCurveComparison({ measurements }: BellCurveComparisonProps) {
   231→  const colors = [
   232→    '#00f3ff', // cyan
   233→    '#10b981', // green
   234→    '#f59e0b', // amber
   235→    '#8b5cf6', // purple
   236→    '#ec4899', // pink
   237→    '#3b82f6', // blue
   238→  ];
   239→
   240→  return (
   241→    <div className="space-y-4">
   242→      <h2 className="text-lg font-semibold text-white">Percentile Rankings</h2>
   243→      <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
   244→        {measurements.map((measurement, index) => (
   245→          <BellCurveChart
   246→            key={measurement.key}
   247→            data={measurement.data}
   248→            title={measurement.title}
   249→            unit={measurement.unit}
   250→            color={colors[index % colors.length]}
   251→            height={180}
   252→          />
   253→        ))}
   254→      </div>
   255→    </div>
   256→  );
   257→}
   258→
   259→interface ScoreGaugeProps {
   260→  score: number;
   261→  label: string;
   262→  maxScore?: number;
   263→}
   264→
   265→export function ScoreGauge({ score, label, maxScore = 100 }: ScoreGaugeProps) {
   266→  const percentage = (score / maxScore) * 100;
   267→  const circumference = 2 * Math.PI * 45;
   268→  const strokeDashoffset = circumference - (percentage / 100) * circumference;
   269→
   270→  const getScoreColor = (score: number): string => {
   271→    if (score >= 90) return '#10b981';
   272→    if (score >= 75) return '#22d3ee';
   273→    if (score >= 50) return '#fbbf24';
   274→    if (score >= 25) return '#f97316';
   275→    return '#ef4444';
   276→  };
   277→
   278→  return (
   279→    <motion.div
   280→      initial={{ opacity: 0, scale: 0.9 }}
   281→      animate={{ opacity: 1, scale: 1 }}
   282→      className="flex flex-col items-center"
   283→    >
   284→      <div className="relative w-28 h-28">
   285→        <svg className="w-full h-full transform -rotate-90">
   286→          {/* Background circle */}
   287→          <circle
   288→            cx="56"
   289→            cy="56"
   290→            r="45"
   291→            stroke="#27272a"
   292→            strokeWidth="8"
   293→            fill="none"
   294→          />
   295→          {/* Progress circle */}
   296→          <motion.circle
   297→            cx="56"
   298→            cy="56"
   299→            r="45"
   300→            stroke={getScoreColor(score)}
   301→            strokeWidth="8"
   302→            fill="none"
   303→            strokeLinecap="round"
   304→            strokeDasharray={circumference}
   305→            initial={{ strokeDashoffset: circumference }}
   306→            animate={{ strokeDashoffset }}
   307→            transition={{ duration: 1, ease: 'easeOut' }}
   308→          />
   309→        </svg>
   310→        <div className="absolute inset-0 flex items-center justify-center">
   311→          <span
   312→            className="text-2xl font-bold"
   313→            style={{ color: getScoreColor(score) }}
   314→          >
   315→            {score.toFixed(0)}
   316→          </span>
   317→        </div>
   318→      </div>
   319→      <p className="mt-2 text-sm text-foreground-dim text-center">{label}</p>
   320→    </motion.div>
   321→  );
   322→}
   323→
   324→interface HarmonyScoreDisplayProps {
   325→  harmonyScore: number;
   326→  individualScores: Record<string, number>;
   327→}
   328→
   329→export function HarmonyScoreDisplay({
   330→  harmonyScore,
   331→  individualScores,
   332→}: HarmonyScoreDisplayProps) {
   333→  const scoreLabels: Record<string, string> = {
   334→    fwhr: 'Face Ratio',
   335→    canthalTilt: 'Eye Tilt',
   336→    facialThirds: 'Proportions',
   337→    nasolabialAngle: 'Nose-Lip',
   338→    gonialAngle: 'Jaw Angle',
   339→    overallSymmetry: 'Symmetry',
   340→    goldenRatio: 'Golden Ratio',
   341→    nasalIndex: 'Nose Shape',
   342→    lipRatio: 'Lip Ratio',
   343→  };
   344→
   345→  return (
   346→    <motion.div
   347→      initial={{ opacity: 0, y: 20 }}
   348→      animate={{ opacity: 1, y: 0 }}
   349→      className="bg-background-secondary rounded-xl border border-border p-6"
   350→    >
   351→      <div className="flex flex-col md:flex-row items-center gap-6">
   352→        {/* Main Harmony Score */}
   353→        <div className="flex-shrink-0">
   354→          <ScoreGauge score={harmonyScore} label="Harmony Score" />
   355→        </div>
   356→
   357→        {/* Individual Scores */}
   358→        <div className="flex-1 w-full">
   359→          <h3 className="text-sm font-semibold text-white mb-3">
   360→            Individual Scores
   361→          </h3>
   362→          <div className="space-y-2">
   363→            {Object.entries(individualScores).map(([key, score]) => (
   364→              <div key={key} className="flex items-center gap-3">
   365→                <span className="text-xs text-foreground-dim w-24 truncate">
   366→                  {scoreLabels[key] || key}
   367→                </span>
   368→                <div className="flex-1 h-2 bg-black/30 rounded-full overflow-hidden">
   369→                  <motion.div
   370→                    className="h-full rounded-full"
   371→                    style={{
   372→                      backgroundColor:
   373→                        score >= 75
   374→                          ? '#10b981'
   375→                          : score >= 50
   376→                            ? '#fbbf24'
   377→                            : '#ef4444',
   378→                    }}
   379→                    initial={{ width: 0 }}
   380→                    animate={{ width: `${score}%` }}
   381→                    transition={{ duration: 0.8, delay: 0.1 }}
   382→                  />
   383→                </div>
   384→                <span className="text-xs font-medium text-white w-8 text-right">
   385→                  {score.toFixed(0)}
   386→                </span>
   387→              </div>
   388→            ))}
   389→          </div>
   390→        </div>
   391→      </div>
   392→    </motion.div>
   393→  );
   394→}
   395→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
