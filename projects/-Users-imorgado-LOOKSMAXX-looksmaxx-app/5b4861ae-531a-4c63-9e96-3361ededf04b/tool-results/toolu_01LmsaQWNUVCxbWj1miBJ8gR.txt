     1→'use client';
     2→
     3→import { useEffect, useRef } from 'react';
     4→import { useResults } from '@/contexts/ResultsContext';
     5→import { useLeaderboardOptional } from '@/contexts/LeaderboardContext';
     6→import { ResultsLayout } from './ResultsLayout';
     7→import { OverviewTab } from './tabs/OverviewTab';
     8→import { FrontRatiosTab, SideRatiosTab } from './tabs/RatiosTab';
     9→import { PlanTab } from './tabs/PlanTab';
    10→import { OptionsTab } from './tabs/OptionsTab';
    11→import { SupportTab } from './tabs/SupportTab';
    12→import { LeaderboardTab } from './tabs/LeaderboardTab';
    13→import { api } from '@/lib/api';
    14→
    15→export function Results() {
    16→  const { activeTab, overallScore, gender, ethnicity, frontPhoto, strengths, flaws } = useResults();
    17→  const leaderboard = useLeaderboardOptional();
    18→  const hasSubmittedRef = useRef(false);
    19→
    20→  // Auto-submit score to leaderboard on first render when score is available
    21→  useEffect(() => {
    22→    // Only submit once, when we have a valid score and haven't submitted yet
    23→    if (hasSubmittedRef.current || overallScore <= 0 || !leaderboard) return;
    24→
    25→    // Check if user is authenticated
    26→    const token = api.getToken();
    27→    if (!token) return;
    28→
    29→    // Mark as submitted to prevent duplicate submissions
    30→    hasSubmittedRef.current = true;
    31→
    32→    // Extract top 3 strengths and improvements
    33→    const topStrengths = strengths.slice(0, 3).map(s => s.strengthName);
    34→    const topImprovements = flaws.slice(0, 3).map(f => f.flawName);
    35→
    36→    // Submit to leaderboard
    37→    leaderboard.submitScore(overallScore, gender, {
    38→      ethnicity,
    39→      facePhotoUrl: frontPhoto,
    40→      topStrengths,
    41→      topImprovements,
    42→    }).catch(err => {
    43→      // Reset flag on error so user can retry
    44→      hasSubmittedRef.current = false;
    45→      console.error('[Leaderboard] Auto-submit failed:', err);
    46→    });
    47→  }, [overallScore, gender, ethnicity, frontPhoto, strengths, flaws, leaderboard]);
    48→
    49→  const renderTabContent = () => {
    50→    switch (activeTab) {
    51→      case 'overview':
    52→        return <OverviewTab />;
    53→      case 'front-ratios':
    54→        return <FrontRatiosTab />;
    55→      case 'side-ratios':
    56→        return <SideRatiosTab />;
    57→      case 'leaderboard':
    58→        return <LeaderboardTab />;
    59→      case 'plan':
    60→        return <PlanTab />;
    61→      case 'options':
    62→        return <OptionsTab />;
    63→      case 'support':
    64→        return <SupportTab />;
    65→      default:
    66→        return <OverviewTab />;
    67→    }
    68→  };
    69→
    70→  return (
    71→    <ResultsLayout>
    72→      {renderTabContent()}
    73→    </ResultsLayout>
    74→  );
    75→}
    76→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
