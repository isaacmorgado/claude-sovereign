{"parentUuid":null,"isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","type":"user","message":{"role":"user","content":"Design a comprehensive implementation plan to replicate FaceIQ's results page UI in the LOOKSMAXX Next.js app.\n\n## Current Codebase Context\n- Location: /Users/imorgado/LOOKSMAXX/looksmaxx-app\n- Framework: Next.js 14 (App Router), TypeScript, Tailwind CSS, Framer Motion\n- Existing components: src/components/ResultsDashboard.tsx, src/components/BellCurveChart.tsx\n- Scoring: src/lib/faceiq-scoring.ts (already implemented with 70+ FaceIQ metrics)\n- Landmarks: src/lib/landmarks.ts\n\n## FaceIQ Results Page Structure to Replicate\n\n### Main Navigation Tabs:\n1. **Overview** - Harmony score summary, front/side scores, strengths/flaws lists\n2. **Front Ratios** - 33 front profile measurements with scores\n3. **Side Ratios** - 33 side profile measurements with scores\n4. **Your Plan & Potential** - Personalized recommendations (surgeries, non-surgical)\n5. **Options** - Settings/preferences\n6. **Support** - Help section\n\n### Key UI Components Needed:\n\n**Score Displays:**\n- Overall Harmony Score (0-10 with 2 decimals)\n- Front/Side Profile Scores\n- Per-measurement scores with ideal ranges\n\n**Measurement Cards:**\n- Ratio name, your value, unit (x, mm, %)\n- Score out of 10\n- Ideal range visualization (bar/slider)\n- Click to expand for:\n  - Full description (\"About this ratio\")\n  - Landmark visualization on face image\n  - May indicate strengths/flaws\n  - Scoring curve visualization\n\n**Strength/Flaw Cards:**\n- Name, summary, avgScore/impact\n- Quality level badge (ideal/good/fair/poor)\n- Category tag\n- Expandable to show related ratios\n\n**Plan Recommendations:**\n- Procedure cards with:\n  - Name, phase badge (Surgical/Minimally Invasive/Foundational)\n  - Impact score (0-1), coverage (metrics improved)\n  - Matched flaws, matched ratios\n  - Click to expand: timeline, cost, risks, detailed impact\n\n**Face Visualization:**\n- Photo with overlaid landmarks\n- Lines connecting measurement points\n- Toggleable per-measurement\n\n### Data Models Needed:\n\n```typescript\ninterface Ratio {\n  name: string;\n  value: number;\n  score: number;\n  standardizedScore: number;\n  unit: 'x' | 'mm' | '%' | '°';\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  description: string;\n  illustration: { points: Record<string, Point>; lines: Record<string, Line> };\n  mayIndicateFlaws: string[];\n  mayIndicateStrengths: string[];\n}\n\ninterface Strength {\n  strengthName: string;\n  summary: string;\n  avgScore: number;\n  qualityLevel: 'ideal' | 'good' | 'fair' | 'poor';\n  categoryName: string;\n  responsibleRatios: { ratioName: string; score: number }[];\n}\n\ninterface Flaw {\n  flawName: string;\n  summary: string;\n  harmonyPercentageLost: number;\n  standardizedImpact: number;\n  categoryName: string;\n  responsibleRatios: { ratioName: string; score: number }[];\n}\n\ninterface Recommendation {\n  ref_id: string;\n  name: string;\n  description: string;\n  phase: 'Surgical' | 'Minimally Invasive' | 'Foundational';\n  impact: number;\n  coverage: number;\n  matchedFlaws: string[];\n  matchedRatios: string[];\n  timeline: { effect_start: string; full_results_weeks: number };\n  cost: { type: string; min: number; max: number; currency: string };\n  risks_side_effects: string | null;\n}\n```\n\n### Color Scheme:\n- Primary: #5865F2 (Discord Blue)\n- Good/Ideal: #67e8f9 (Cyan)\n- Poor: rgb(227, 67, 67) (Red)\n- Backgrounds: gray-50 to gray-900, neutral tones\n\n### Requirements:\n1. Responsive design (sidebar collapses on mobile)\n2. Smooth animations with Framer Motion\n3. Tab-based navigation\n4. Expandable cards with detail views\n5. Face image with landmark overlay\n6. Score visualizations (bars, curves)\n\nCreate a detailed step-by-step implementation plan with file structure, component hierarchy, and implementation order. The plan should be thorough enough to implement the full FaceIQ-style results experience."},"uuid":"6cc4897c-2380-4496-a9a1-28e0a925c677","timestamp":"2025-12-20T15:49:44.262Z"}
{"parentUuid":"6cc4897c-2380-4496-a9a1-28e0a925c677","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_012XUkKS9iSrJJsBxHU5BmEd","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_013UJaWqbHPKuSKiJ8Hk7VZt","name":"Glob","input":{"pattern":"**/*.{ts,tsx}","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":13352,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":13352,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJCmiZ2kPkW8zp2Sjmvo","type":"assistant","uuid":"92c2e61d-a179-4b9f-a294-6448e8b3d532","timestamp":"2025-12-20T15:49:49.760Z"}
{"parentUuid":"92c2e61d-a179-4b9f-a294-6448e8b3d532","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_012XUkKS9iSrJJsBxHU5BmEd","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01FEeQdymfbfa9wjNFEq66SH","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/ResultsDashboard.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":13352,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":13352,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJCmiZ2kPkW8zp2Sjmvo","type":"assistant","uuid":"b553480a-8735-409e-bccc-7bcd10ce4d68","timestamp":"2025-12-20T15:49:50.269Z"}
{"parentUuid":"b553480a-8735-409e-bccc-7bcd10ce4d68","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_012XUkKS9iSrJJsBxHU5BmEd","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015UyC6ECxut35jRywsHQgNe","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":13352,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":13352,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJCmiZ2kPkW8zp2Sjmvo","type":"assistant","uuid":"153b50e2-c6b6-4dce-967d-2ae6937c1e39","timestamp":"2025-12-20T15:49:50.760Z"}
{"parentUuid":"153b50e2-c6b6-4dce-967d-2ae6937c1e39","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_012XUkKS9iSrJJsBxHU5BmEd","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AmiQKFCAA4DjUxi4cu6jWJ","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/BellCurveChart.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":13352,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":13352,"ephemeral_1h_input_tokens":0},"output_tokens":292,"service_tier":"standard"}},"requestId":"req_011CWJCmiZ2kPkW8zp2Sjmvo","type":"assistant","uuid":"a06d067d-7f81-4e99-8356-f6f1af2fd033","timestamp":"2025-12-20T15:49:51.280Z"}
{"parentUuid":"a06d067d-7f81-4e99-8356-f6f1af2fd033","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01FEeQdymfbfa9wjNFEq66SH","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useMemo } from 'react';\n     4→import { motion } from 'framer-motion';\n     5→import {\n     6→  TrendingUp,\n     7→  TrendingDown,\n     8→  Minus,\n     9→  Star,\n    10→  Target,\n    11→  Activity,\n    12→  Sparkles,\n    13→} from 'lucide-react';\n    14→import { LandmarkPoint } from '@/lib/landmarks';\n    15→import {\n    16→  comprehensiveFrontAnalysis,\n    17→  comprehensiveSideAnalysis,\n    18→  generateMeasurementBellCurve,\n    19→  BellCurveData,\n    20→} from '@/lib/scoring';\n    21→import {\n    22→  BellCurveChart,\n    23→  HarmonyScoreDisplay,\n    24→} from './BellCurveChart';\n    25→\n    26→interface ResultsDashboardProps {\n    27→  frontLandmarks: LandmarkPoint[];\n    28→  sideLandmarks: LandmarkPoint[];\n    29→  gender: 'male' | 'female';\n    30→}\n    31→\n    32→interface MeasurementCardProps {\n    33→  title: string;\n    34→  value: number;\n    35→  unit: string;\n    36→  score: number;\n    37→  idealRange: { min: number; max: number };\n    38→  description: string;\n    39→  rating: 'excellent' | 'good' | 'average' | 'below_average';\n    40→}\n    41→\n    42→function MeasurementCard({\n    43→  title,\n    44→  value,\n    45→  unit,\n    46→  score,\n    47→  idealRange,\n    48→  description,\n    49→  rating,\n    50→}: MeasurementCardProps) {\n    51→  const ratingConfig = {\n    52→    excellent: { color: '#10b981', label: 'Excellent', icon: Star },\n    53→    good: { color: '#0891b2', label: 'Good', icon: TrendingUp },\n    54→    average: { color: '#eab308', label: 'Average', icon: Minus },\n    55→    below_average: { color: '#f97316', label: 'Below Avg', icon: TrendingDown },\n    56→  };\n    57→\n    58→  const config = ratingConfig[rating];\n    59→  const Icon = config.icon;\n    60→\n    61→  const isInRange = value >= idealRange.min && value <= idealRange.max;\n    62→\n    63→  return (\n    64→    <motion.div\n    65→      initial={{ opacity: 0, y: 10 }}\n    66→      animate={{ opacity: 1, y: 0 }}\n    67→      className=\"bg-black rounded-xl border border-neutral-800 p-4 hover:border-neutral-700 transition-colors\"\n    68→    >\n    69→      <div className=\"flex items-start justify-between mb-3\">\n    70→        <div>\n    71→          <h4 className=\"text-sm font-semibold text-white\">{title}</h4>\n    72→          <p className=\"text-xs text-neutral-500 mt-0.5\">{description}</p>\n    73→        </div>\n    74→        <div\n    75→          className=\"flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium\"\n    76→          style={{\n    77→            backgroundColor: `${config.color}15`,\n    78→            color: config.color,\n    79→          }}\n    80→        >\n    81→          <Icon className=\"w-3 h-3\" />\n    82→          {config.label}\n    83→        </div>\n    84→      </div>\n    85→\n    86→      <div className=\"flex items-end justify-between\">\n    87→        <div>\n    88→          <span className=\"text-2xl font-bold text-white\">\n    89→            {typeof value === 'number' ? value.toFixed(2) : value}\n    90→          </span>\n    91→          <span className=\"text-sm text-neutral-500 ml-1\">{unit}</span>\n    92→        </div>\n    93→        <div className=\"text-right\">\n    94→          <div className=\"text-xs text-neutral-500 mb-1\">\n    95→            Ideal: {idealRange.min.toFixed(1)} - {idealRange.max.toFixed(1)}\n    96→          </div>\n    97→          <div\n    98→            className=\"text-xs font-medium\"\n    99→            style={{ color: isInRange ? '#10b981' : '#f97316' }}\n   100→          >\n   101→            {isInRange ? 'In Range' : value < idealRange.min ? 'Below Ideal' : 'Above Ideal'}\n   102→          </div>\n   103→        </div>\n   104→      </div>\n   105→\n   106→      {/* Score bar */}\n   107→      <div className=\"mt-3 h-1.5 bg-neutral-800 rounded-full overflow-hidden\">\n   108→        <motion.div\n   109→          className=\"h-full rounded-full\"\n   110→          style={{ backgroundColor: config.color }}\n   111→          initial={{ width: 0 }}\n   112→          animate={{ width: `${Math.min(score, 100)}%` }}\n   113→          transition={{ duration: 0.8 }}\n   114→        />\n   115→      </div>\n   116→      <div className=\"mt-1 text-right\">\n   117→        <span className=\"text-xs font-medium\" style={{ color: config.color }}>\n   118→          Score: {score.toFixed(0)}/100\n   119→        </span>\n   120→      </div>\n   121→    </motion.div>\n   122→  );\n   123→}\n   124→\n   125→interface StrengthWeaknessProps {\n   126→  strengths: Array<{ name: string; score: number; description: string }>;\n   127→  improvements: Array<{ name: string; score: number; suggestion: string }>;\n   128→}\n   129→\n   130→function StrengthsWeaknesses({ strengths, improvements }: StrengthWeaknessProps) {\n   131→  return (\n   132→    <div className=\"grid md:grid-cols-2 gap-6\">\n   133→      {/* Strengths */}\n   134→      <motion.div\n   135→        initial={{ opacity: 0, x: -20 }}\n   136→        animate={{ opacity: 1, x: 0 }}\n   137→        className=\"bg-black rounded-xl border border-neutral-800 p-5\"\n   138→      >\n   139→        <div className=\"flex items-center gap-2 mb-4\">\n   140→          <div className=\"p-2 rounded-lg bg-green-500/20\">\n   141→            <Sparkles className=\"w-5 h-5 text-green-400\" />\n   142→          </div>\n   143→          <h3 className=\"text-lg font-semibold text-white\">Your Strengths</h3>\n   144→        </div>\n   145→        <div className=\"space-y-3\">\n   146→          {strengths.map((strength, index) => (\n   147→            <div\n   148→              key={index}\n   149→              className=\"flex items-start gap-3 p-3 rounded-lg bg-green-500/10 border border-green-500/20\"\n   150→            >\n   151→              <div className=\"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0\">\n   152→                <span className=\"text-sm font-bold text-green-400\">\n   153→                  {strength.score.toFixed(0)}\n   154→                </span>\n   155→              </div>\n   156→              <div>\n   157→                <p className=\"text-sm font-medium text-white\">{strength.name}</p>\n   158→                <p className=\"text-xs text-neutral-400 mt-0.5\">\n   159→                  {strength.description}\n   160→                </p>\n   161→              </div>\n   162→            </div>\n   163→          ))}\n   164→        </div>\n   165→      </motion.div>\n   166→\n   167→      {/* Areas for Improvement */}\n   168→      <motion.div\n   169→        initial={{ opacity: 0, x: 20 }}\n   170→        animate={{ opacity: 1, x: 0 }}\n   171→        className=\"bg-black rounded-xl border border-neutral-800 p-5\"\n   172→      >\n   173→        <div className=\"flex items-center gap-2 mb-4\">\n   174→          <div className=\"p-2 rounded-lg bg-amber-500/20\">\n   175→            <Target className=\"w-5 h-5 text-amber-400\" />\n   176→          </div>\n   177→          <h3 className=\"text-lg font-semibold text-white\">Areas for Improvement</h3>\n   178→        </div>\n   179→        <div className=\"space-y-3\">\n   180→          {improvements.map((item, index) => (\n   181→            <div\n   182→              key={index}\n   183→              className=\"flex items-start gap-3 p-3 rounded-lg bg-amber-500/10 border border-amber-500/20\"\n   184→            >\n   185→              <div className=\"w-8 h-8 rounded-full bg-amber-500/20 flex items-center justify-center flex-shrink-0\">\n   186→                <span className=\"text-sm font-bold text-amber-400\">\n   187→                  {item.score.toFixed(0)}\n   188→                </span>\n   189→              </div>\n   190→              <div>\n   191→                <p className=\"text-sm font-medium text-white\">{item.name}</p>\n   192→                <p className=\"text-xs text-neutral-400 mt-0.5\">{item.suggestion}</p>\n   193→              </div>\n   194→            </div>\n   195→          ))}\n   196→        </div>\n   197→      </motion.div>\n   198→    </div>\n   199→  );\n   200→}\n   201→\n   202→export function ResultsDashboard({\n   203→  frontLandmarks,\n   204→  sideLandmarks,\n   205→  gender,\n   206→}: ResultsDashboardProps) {\n   207→  // Calculate all analyses\n   208→  const frontAnalysis = useMemo(() => {\n   209→    if (frontLandmarks.length === 0) return null;\n   210→    return comprehensiveFrontAnalysis(frontLandmarks, gender);\n   211→  }, [frontLandmarks, gender]);\n   212→\n   213→  const sideAnalysis = useMemo(() => {\n   214→    if (sideLandmarks.length === 0) return null;\n   215→    return comprehensiveSideAnalysis(sideLandmarks, gender);\n   216→  }, [sideLandmarks, gender]);\n   217→\n   218→  // Calculate overall harmony score\n   219→  const harmonyScore = useMemo(() => {\n   220→    const scores: number[] = [];\n   221→    if (frontAnalysis) scores.push(frontAnalysis.harmonyScore);\n   222→    if (sideAnalysis) scores.push(sideAnalysis.harmonyScore);\n   223→    return scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;\n   224→  }, [frontAnalysis, sideAnalysis]);\n   225→\n   226→  // Collect all individual scores\n   227→  const allScores = useMemo(() => {\n   228→    const scores: Record<string, number> = {};\n   229→\n   230→    if (frontAnalysis) {\n   231→      if (frontAnalysis.fwhr) scores.fwhr = frontAnalysis.fwhr.score;\n   232→      if (frontAnalysis.leftCanthalTilt) scores.canthalTilt = frontAnalysis.leftCanthalTilt.score;\n   233→      if (frontAnalysis.facialThirds) scores.facialThirds = frontAnalysis.facialThirds.overall.score;\n   234→      if (frontAnalysis.nasalIndex) scores.nasalIndex = frontAnalysis.nasalIndex.score;\n   235→      if (frontAnalysis.mouthNoseRatio) scores.mouthNoseRatio = frontAnalysis.mouthNoseRatio.score;\n   236→      if (frontAnalysis.jawRatio) scores.jawRatio = frontAnalysis.jawRatio.score;\n   237→    }\n   238→\n   239→    if (sideAnalysis) {\n   240→      if (sideAnalysis.gonialAngle) scores.gonialAngle = sideAnalysis.gonialAngle.score;\n   241→      if (sideAnalysis.nasolabialAngle) scores.nasolabialAngle = sideAnalysis.nasolabialAngle.score;\n   242→      if (sideAnalysis.eLine) scores.eLine = sideAnalysis.eLine.combined.score;\n   243→      if (sideAnalysis.mentolabialAngle) scores.mentolabialAngle = sideAnalysis.mentolabialAngle.score;\n   244→      if (sideAnalysis.nasofrontalAngle) scores.nasofrontalAngle = sideAnalysis.nasofrontalAngle.score;\n   245→    }\n   246→\n   247→    return scores;\n   248→  }, [frontAnalysis, sideAnalysis]);\n   249→\n   250→  // Generate bell curve data for key measurements\n   251→  const bellCurveData = useMemo(() => {\n   252→    const data: Array<{ key: string; title: string; data: BellCurveData; unit?: string }> = [];\n   253→\n   254→    if (frontAnalysis?.fwhr) {\n   255→      const bellData = generateMeasurementBellCurve('fwhr', frontAnalysis.fwhr.value, gender);\n   256→      if (bellData) {\n   257→        data.push({ key: 'fwhr', title: 'Face Width-to-Height Ratio', data: bellData });\n   258→      }\n   259→    }\n   260→\n   261→    if (frontAnalysis?.leftCanthalTilt) {\n   262→      const bellData = generateMeasurementBellCurve('canthalTilt', frontAnalysis.leftCanthalTilt.value, gender);\n   263→      if (bellData) {\n   264→        data.push({ key: 'canthalTilt', title: 'Canthal Tilt', data: bellData, unit: '°' });\n   265→      }\n   266→    }\n   267→\n   268→    return data;\n   269→  }, [frontAnalysis, gender]);\n   270→\n   271→  // Determine strengths and weaknesses\n   272→  const { strengths, improvements } = useMemo(() => {\n   273→    const allResults: Array<{ name: string; score: number; description: string; suggestion: string }> = [];\n   274→\n   275→    const measurementDescriptions: Record<string, { name: string; desc: string; suggestion: string }> = {\n   276→      fwhr: {\n   277→        name: 'Facial Width-to-Height Ratio',\n   278→        desc: 'Your face has good proportional width relative to height',\n   279→        suggestion: 'Consider facial exercises to enhance jaw definition'\n   280→      },\n   281→      canthalTilt: {\n   282→        name: 'Eye Canthal Tilt',\n   283→        desc: 'Your eyes have an attractive upward tilt',\n   284→        suggestion: 'Eye-lifting treatments or makeup techniques can enhance tilt'\n   285→      },\n   286→      facialThirds: {\n   287→        name: 'Facial Thirds Balance',\n   288→        desc: 'Your face has well-balanced vertical proportions',\n   289→        suggestion: 'Hairstyle adjustments can help balance facial thirds'\n   290→      },\n   291→      nasalIndex: {\n   292→        name: 'Nasal Proportions',\n   293→        desc: 'Your nose width-to-height ratio is harmonious',\n   294→        suggestion: 'Contouring can create the illusion of different proportions'\n   295→      },\n   296→      gonialAngle: {\n   297→        name: 'Jaw Angle',\n   298→        desc: 'Your jaw has an attractive angular definition',\n   299→        suggestion: 'Jaw exercises or mewing can help define the gonial angle'\n   300→      },\n   301→      nasolabialAngle: {\n   302→        name: 'Nose-Lip Angle',\n   303→        desc: 'The angle between your nose and lip is well-balanced',\n   304→        suggestion: 'Nose profile can be enhanced with non-surgical treatments'\n   305→      },\n   306→      eLine: {\n   307→        name: 'E-Line Profile',\n   308→        desc: 'Your lip position relative to nose-chin line is ideal',\n   309→        suggestion: 'Lip fillers or chin augmentation can improve E-line balance'\n   310→      },\n   311→      mouthNoseRatio: {\n   312→        name: 'Mouth-to-Nose Ratio',\n   313→        desc: 'Your mouth width is proportional to your nose',\n   314→        suggestion: 'Lip treatments can adjust the perceived ratio'\n   315→      },\n   316→      jawRatio: {\n   317→        name: 'Jaw-to-Face Width',\n   318→        desc: 'Your jaw width is proportional to your face',\n   319→        suggestion: 'Jaw slimming or enhancement can adjust this ratio'\n   320→      },\n   321→    };\n   322→\n   323→    Object.entries(allScores).forEach(([key, score]) => {\n   324→      const info = measurementDescriptions[key];\n   325→      if (info) {\n   326→        allResults.push({\n   327→          name: info.name,\n   328→          score,\n   329→          description: info.desc,\n   330→          suggestion: info.suggestion,\n   331→        });\n   332→      }\n   333→    });\n   334→\n   335→    // Sort by score\n   336→    allResults.sort((a, b) => b.score - a.score);\n   337→\n   338→    // Top 3 are strengths, bottom 3 are improvements\n   339→    const strengths = allResults.slice(0, 3).map(r => ({\n   340→      name: r.name,\n   341→      score: r.score,\n   342→      description: r.description,\n   343→    }));\n   344→\n   345→    const improvements = allResults.slice(-3).reverse().map(r => ({\n   346→      name: r.name,\n   347→      score: r.score,\n   348→      suggestion: r.suggestion,\n   349→    }));\n   350→\n   351→    return { strengths, improvements };\n   352→  }, [allScores]);\n   353→\n   354→  if (!frontAnalysis && !sideAnalysis) {\n   355→    return (\n   356→      <div className=\"text-center py-12\">\n   357→        <Activity className=\"w-12 h-12 text-neutral-600 mx-auto mb-4\" />\n   358→        <p className=\"text-neutral-400\">No analysis data available</p>\n   359→      </div>\n   360→    );\n   361→  }\n   362→\n   363→  return (\n   364→    <div className=\"space-y-8\">\n   365→      {/* Hero Score Section */}\n   366→      <motion.div\n   367→        initial={{ opacity: 0, y: 20 }}\n   368→        animate={{ opacity: 1, y: 0 }}\n   369→        className=\"text-center\"\n   370→      >\n   371→        <h2 className=\"text-2xl font-bold text-white mb-2\">Your Analysis Results</h2>\n   372→        <p className=\"text-neutral-400 mb-8\">\n   373→          Based on {frontLandmarks.length + sideLandmarks.length} facial landmarks\n   374→        </p>\n   375→\n   376→        {/* Main Harmony Score Display */}\n   377→        <HarmonyScoreDisplay\n   378→          harmonyScore={harmonyScore}\n   379→          individualScores={allScores}\n   380→        />\n   381→      </motion.div>\n   382→\n   383→      {/* Strengths & Weaknesses */}\n   384→      {strengths.length > 0 && improvements.length > 0 && (\n   385→        <StrengthsWeaknesses strengths={strengths} improvements={improvements} />\n   386→      )}\n   387→\n   388→      {/* Front Profile Measurements */}\n   389→      {frontAnalysis && (\n   390→        <motion.div\n   391→          initial={{ opacity: 0, y: 20 }}\n   392→          animate={{ opacity: 1, y: 0 }}\n   393→        >\n   394→          <div className=\"flex items-center gap-2 mb-4\">\n   395→            <h3 className=\"text-lg font-semibold text-white\">Front Profile Analysis</h3>\n   396→            <span className=\"px-2 py-0.5 rounded-full bg-neutral-800 text-neutral-300 text-xs\">\n   397→              {frontLandmarks.length} landmarks\n   398→            </span>\n   399→          </div>\n   400→\n   401→          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n   402→            {frontAnalysis.fwhr && (\n   403→              <MeasurementCard\n   404→                title=\"FWHR\"\n   405→                value={frontAnalysis.fwhr.value}\n   406→                unit=\"ratio\"\n   407→                score={frontAnalysis.fwhr.score}\n   408→                idealRange={frontAnalysis.fwhr.idealRange}\n   409→                description=\"Facial Width-to-Height Ratio\"\n   410→                rating={frontAnalysis.fwhr.rating}\n   411→              />\n   412→            )}\n   413→\n   414→            {frontAnalysis.facialThirds && (\n   415→              <MeasurementCard\n   416→                title=\"Facial Thirds\"\n   417→                value={frontAnalysis.facialThirds.overall.value}\n   418→                unit=\"% deviation\"\n   419→                score={frontAnalysis.facialThirds.overall.score}\n   420→                idealRange={frontAnalysis.facialThirds.overall.idealRange}\n   421→                description=\"Vertical face proportion balance\"\n   422→                rating={frontAnalysis.facialThirds.overall.rating}\n   423→              />\n   424→            )}\n   425→\n   426→            {frontAnalysis.leftCanthalTilt && (\n   427→              <MeasurementCard\n   428→                title=\"Canthal Tilt\"\n   429→                value={frontAnalysis.leftCanthalTilt.value}\n   430→                unit=\"°\"\n   431→                score={frontAnalysis.leftCanthalTilt.score}\n   432→                idealRange={frontAnalysis.leftCanthalTilt.idealRange}\n   433→                description=\"Eye angle from inner to outer corner\"\n   434→                rating={frontAnalysis.leftCanthalTilt.rating}\n   435→              />\n   436→            )}\n   437→\n   438→            {frontAnalysis.nasalIndex && (\n   439→              <MeasurementCard\n   440→                title=\"Nasal Index\"\n   441→                value={frontAnalysis.nasalIndex.value}\n   442→                unit=\"%\"\n   443→                score={frontAnalysis.nasalIndex.score}\n   444→                idealRange={frontAnalysis.nasalIndex.idealRange}\n   445→                description=\"Nose width to height ratio\"\n   446→                rating={frontAnalysis.nasalIndex.rating}\n   447→              />\n   448→            )}\n   449→\n   450→            {frontAnalysis.mouthNoseRatio && (\n   451→              <MeasurementCard\n   452→                title=\"Mouth-Nose Ratio\"\n   453→                value={frontAnalysis.mouthNoseRatio.value}\n   454→                unit=\"ratio\"\n   455→                score={frontAnalysis.mouthNoseRatio.score}\n   456→                idealRange={frontAnalysis.mouthNoseRatio.idealRange}\n   457→                description=\"Mouth width relative to nose\"\n   458→                rating={frontAnalysis.mouthNoseRatio.rating}\n   459→              />\n   460→            )}\n   461→\n   462→            {frontAnalysis.jawRatio && (\n   463→              <MeasurementCard\n   464→                title=\"Jaw-Face Ratio\"\n   465→                value={frontAnalysis.jawRatio.value}\n   466→                unit=\"ratio\"\n   467→                score={frontAnalysis.jawRatio.score}\n   468→                idealRange={frontAnalysis.jawRatio.idealRange}\n   469→                description=\"Jaw width to face width\"\n   470→                rating={frontAnalysis.jawRatio.rating}\n   471→              />\n   472→            )}\n   473→          </div>\n   474→        </motion.div>\n   475→      )}\n   476→\n   477→      {/* Side Profile Measurements */}\n   478→      {sideAnalysis && (\n   479→        <motion.div\n   480→          initial={{ opacity: 0, y: 20 }}\n   481→          animate={{ opacity: 1, y: 0 }}\n   482→        >\n   483→          <div className=\"flex items-center gap-2 mb-4\">\n   484→            <h3 className=\"text-lg font-semibold text-white\">Side Profile Analysis</h3>\n   485→            <span className=\"px-2 py-0.5 rounded-full bg-neutral-800 text-neutral-300 text-xs\">\n   486→              {sideLandmarks.length} landmarks\n   487→            </span>\n   488→          </div>\n   489→\n   490→          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n   491→            {sideAnalysis.gonialAngle && (\n   492→              <MeasurementCard\n   493→                title=\"Gonial Angle\"\n   494→                value={sideAnalysis.gonialAngle.value}\n   495→                unit=\"°\"\n   496→                score={sideAnalysis.gonialAngle.score}\n   497→                idealRange={sideAnalysis.gonialAngle.idealRange}\n   498→                description=\"Jaw angle measurement\"\n   499→                rating={sideAnalysis.gonialAngle.rating}\n   500→              />\n   501→            )}\n   502→\n   503→            {sideAnalysis.nasolabialAngle && (\n   504→              <MeasurementCard\n   505→                title=\"Nasolabial Angle\"\n   506→                value={sideAnalysis.nasolabialAngle.value}\n   507→                unit=\"°\"\n   508→                score={sideAnalysis.nasolabialAngle.score}\n   509→                idealRange={sideAnalysis.nasolabialAngle.idealRange}\n   510→                description=\"Nose to upper lip angle\"\n   511→                rating={sideAnalysis.nasolabialAngle.rating}\n   512→              />\n   513→            )}\n   514→\n   515→            {sideAnalysis.eLine && (\n   516→              <MeasurementCard\n   517→                title=\"E-Line (Ricketts)\"\n   518→                value={sideAnalysis.eLine.combined.value}\n   519→                unit=\"mm\"\n   520→                score={sideAnalysis.eLine.combined.score}\n   521→                idealRange={sideAnalysis.eLine.combined.idealRange}\n   522→                description=\"Lip position relative to nose-chin line\"\n   523→                rating={sideAnalysis.eLine.combined.rating}\n   524→              />\n   525→            )}\n   526→\n   527→            {sideAnalysis.mentolabialAngle && (\n   528→              <MeasurementCard\n   529→                title=\"Mentolabial Angle\"\n   530→                value={sideAnalysis.mentolabialAngle.value}\n   531→                unit=\"°\"\n   532→                score={sideAnalysis.mentolabialAngle.score}\n   533→                idealRange={sideAnalysis.mentolabialAngle.idealRange}\n   534→                description=\"Chin-lip fold depth\"\n   535→                rating={sideAnalysis.mentolabialAngle.rating}\n   536→              />\n   537→            )}\n   538→\n   539→            {sideAnalysis.nasofrontalAngle && (\n   540→              <MeasurementCard\n   541→                title=\"Nasofrontal Angle\"\n   542→                value={sideAnalysis.nasofrontalAngle.value}\n   543→                unit=\"°\"\n   544→                score={sideAnalysis.nasofrontalAngle.score}\n   545→                idealRange={sideAnalysis.nasofrontalAngle.idealRange}\n   546→                description=\"Forehead to nose bridge angle\"\n   547→                rating={sideAnalysis.nasofrontalAngle.rating}\n   548→              />\n   549→            )}\n   550→          </div>\n   551→        </motion.div>\n   552→      )}\n   553→\n   554→      {/* Bell Curve Charts */}\n   555→      {bellCurveData.length > 0 && (\n   556→        <motion.div\n   557→          initial={{ opacity: 0, y: 20 }}\n   558→          animate={{ opacity: 1, y: 0 }}\n   559→        >\n   560→          <h3 className=\"text-lg font-semibold text-white mb-4\">\n   561→            Population Comparison\n   562→          </h3>\n   563→          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n   564→            {bellCurveData.map((item) => (\n   565→              <BellCurveChart\n   566→                key={item.key}\n   567→                data={item.data}\n   568→                title={item.title}\n   569→                unit={item.unit}\n   570→                height={180}\n   571→              />\n   572→            ))}\n   573→          </div>\n   574→        </motion.div>\n   575→      )}\n   576→\n   577→      {/* Detailed Facial Thirds Breakdown */}\n   578→      {frontAnalysis?.facialThirds && (\n   579→        <motion.div\n   580→          initial={{ opacity: 0, y: 20 }}\n   581→          animate={{ opacity: 1, y: 0 }}\n   582→          className=\"bg-black rounded-xl border border-neutral-800 p-5\"\n   583→        >\n   584→          <h3 className=\"text-lg font-semibold text-white mb-4\">\n   585→            Facial Thirds Breakdown\n   586→          </h3>\n   587→          <div className=\"grid grid-cols-3 gap-4\">\n   588→            <div className=\"text-center\">\n   589→              <div className=\"h-20 bg-gradient-to-b from-neutral-700 to-transparent rounded-t-lg mb-2 flex items-end justify-center pb-2\">\n   590→                <span className=\"text-2xl font-bold text-white\">\n   591→                  {frontAnalysis.facialThirds.upper.value.toFixed(1)}%\n   592→                </span>\n   593→              </div>\n   594→              <p className=\"text-xs text-neutral-400\">Upper Third</p>\n   595→              <p className=\"text-xs text-neutral-500\">Hairline to Brow</p>\n   596→            </div>\n   597→            <div className=\"text-center\">\n   598→              <div className=\"h-20 bg-gradient-to-b from-[#00f3ff]/30 to-transparent rounded-t-lg mb-2 flex items-end justify-center pb-2\">\n   599→                <span className=\"text-2xl font-bold text-white\">\n   600→                  {frontAnalysis.facialThirds.middle.value.toFixed(1)}%\n   601→                </span>\n   602→              </div>\n   603→              <p className=\"text-xs text-neutral-400\">Middle Third</p>\n   604→              <p className=\"text-xs text-[#00f3ff]\">Brow to Nose Base</p>\n   605→            </div>\n   606→            <div className=\"text-center\">\n   607→              <div className=\"h-20 bg-gradient-to-b from-green-500/30 to-transparent rounded-t-lg mb-2 flex items-end justify-center pb-2\">\n   608→                <span className=\"text-2xl font-bold text-white\">\n   609→                  {frontAnalysis.facialThirds.lower.value.toFixed(1)}%\n   610→                </span>\n   611→              </div>\n   612→              <p className=\"text-xs text-neutral-400\">Lower Third</p>\n   613→              <p className=\"text-xs text-green-400\">Nose Base to Chin</p>\n   614→            </div>\n   615→          </div>\n   616→          <div className=\"mt-4 text-center\">\n   617→            <p className=\"text-sm text-neutral-400\">\n   618→              Ideal distribution: 33.3% each • Your balance score:{' '}\n   619→              <span className=\"text-white font-medium\">\n   620→                {frontAnalysis.facialThirds.overall.score.toFixed(0)}/100\n   621→              </span>\n   622→            </p>\n   623→          </div>\n   624→        </motion.div>\n   625→      )}\n   626→    </div>\n   627→  );\n   628→}\n   629→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"888a31d1-c9ca-4f0e-ada5-f5b74917a425","timestamp":"2025-12-20T15:49:51.325Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/ResultsDashboard.tsx","content":"'use client';\n\nimport { useMemo } from 'react';\nimport { motion } from 'framer-motion';\nimport {\n  TrendingUp,\n  TrendingDown,\n  Minus,\n  Star,\n  Target,\n  Activity,\n  Sparkles,\n} from 'lucide-react';\nimport { LandmarkPoint } from '@/lib/landmarks';\nimport {\n  comprehensiveFrontAnalysis,\n  comprehensiveSideAnalysis,\n  generateMeasurementBellCurve,\n  BellCurveData,\n} from '@/lib/scoring';\nimport {\n  BellCurveChart,\n  HarmonyScoreDisplay,\n} from './BellCurveChart';\n\ninterface ResultsDashboardProps {\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  gender: 'male' | 'female';\n}\n\ninterface MeasurementCardProps {\n  title: string;\n  value: number;\n  unit: string;\n  score: number;\n  idealRange: { min: number; max: number };\n  description: string;\n  rating: 'excellent' | 'good' | 'average' | 'below_average';\n}\n\nfunction MeasurementCard({\n  title,\n  value,\n  unit,\n  score,\n  idealRange,\n  description,\n  rating,\n}: MeasurementCardProps) {\n  const ratingConfig = {\n    excellent: { color: '#10b981', label: 'Excellent', icon: Star },\n    good: { color: '#0891b2', label: 'Good', icon: TrendingUp },\n    average: { color: '#eab308', label: 'Average', icon: Minus },\n    below_average: { color: '#f97316', label: 'Below Avg', icon: TrendingDown },\n  };\n\n  const config = ratingConfig[rating];\n  const Icon = config.icon;\n\n  const isInRange = value >= idealRange.min && value <= idealRange.max;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"bg-black rounded-xl border border-neutral-800 p-4 hover:border-neutral-700 transition-colors\"\n    >\n      <div className=\"flex items-start justify-between mb-3\">\n        <div>\n          <h4 className=\"text-sm font-semibold text-white\">{title}</h4>\n          <p className=\"text-xs text-neutral-500 mt-0.5\">{description}</p>\n        </div>\n        <div\n          className=\"flex items-center gap-1 px-2 py-1 rounded-full text-xs font-medium\"\n          style={{\n            backgroundColor: `${config.color}15`,\n            color: config.color,\n          }}\n        >\n          <Icon className=\"w-3 h-3\" />\n          {config.label}\n        </div>\n      </div>\n\n      <div className=\"flex items-end justify-between\">\n        <div>\n          <span className=\"text-2xl font-bold text-white\">\n            {typeof value === 'number' ? value.toFixed(2) : value}\n          </span>\n          <span className=\"text-sm text-neutral-500 ml-1\">{unit}</span>\n        </div>\n        <div className=\"text-right\">\n          <div className=\"text-xs text-neutral-500 mb-1\">\n            Ideal: {idealRange.min.toFixed(1)} - {idealRange.max.toFixed(1)}\n          </div>\n          <div\n            className=\"text-xs font-medium\"\n            style={{ color: isInRange ? '#10b981' : '#f97316' }}\n          >\n            {isInRange ? 'In Range' : value < idealRange.min ? 'Below Ideal' : 'Above Ideal'}\n          </div>\n        </div>\n      </div>\n\n      {/* Score bar */}\n      <div className=\"mt-3 h-1.5 bg-neutral-800 rounded-full overflow-hidden\">\n        <motion.div\n          className=\"h-full rounded-full\"\n          style={{ backgroundColor: config.color }}\n          initial={{ width: 0 }}\n          animate={{ width: `${Math.min(score, 100)}%` }}\n          transition={{ duration: 0.8 }}\n        />\n      </div>\n      <div className=\"mt-1 text-right\">\n        <span className=\"text-xs font-medium\" style={{ color: config.color }}>\n          Score: {score.toFixed(0)}/100\n        </span>\n      </div>\n    </motion.div>\n  );\n}\n\ninterface StrengthWeaknessProps {\n  strengths: Array<{ name: string; score: number; description: string }>;\n  improvements: Array<{ name: string; score: number; suggestion: string }>;\n}\n\nfunction StrengthsWeaknesses({ strengths, improvements }: StrengthWeaknessProps) {\n  return (\n    <div className=\"grid md:grid-cols-2 gap-6\">\n      {/* Strengths */}\n      <motion.div\n        initial={{ opacity: 0, x: -20 }}\n        animate={{ opacity: 1, x: 0 }}\n        className=\"bg-black rounded-xl border border-neutral-800 p-5\"\n      >\n        <div className=\"flex items-center gap-2 mb-4\">\n          <div className=\"p-2 rounded-lg bg-green-500/20\">\n            <Sparkles className=\"w-5 h-5 text-green-400\" />\n          </div>\n          <h3 className=\"text-lg font-semibold text-white\">Your Strengths</h3>\n        </div>\n        <div className=\"space-y-3\">\n          {strengths.map((strength, index) => (\n            <div\n              key={index}\n              className=\"flex items-start gap-3 p-3 rounded-lg bg-green-500/10 border border-green-500/20\"\n            >\n              <div className=\"w-8 h-8 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0\">\n                <span className=\"text-sm font-bold text-green-400\">\n                  {strength.score.toFixed(0)}\n                </span>\n              </div>\n              <div>\n                <p className=\"text-sm font-medium text-white\">{strength.name}</p>\n                <p className=\"text-xs text-neutral-400 mt-0.5\">\n                  {strength.description}\n                </p>\n              </div>\n            </div>\n          ))}\n        </div>\n      </motion.div>\n\n      {/* Areas for Improvement */}\n      <motion.div\n        initial={{ opacity: 0, x: 20 }}\n        animate={{ opacity: 1, x: 0 }}\n        className=\"bg-black rounded-xl border border-neutral-800 p-5\"\n      >\n        <div className=\"flex items-center gap-2 mb-4\">\n          <div className=\"p-2 rounded-lg bg-amber-500/20\">\n            <Target className=\"w-5 h-5 text-amber-400\" />\n          </div>\n          <h3 className=\"text-lg font-semibold text-white\">Areas for Improvement</h3>\n        </div>\n        <div className=\"space-y-3\">\n          {improvements.map((item, index) => (\n            <div\n              key={index}\n              className=\"flex items-start gap-3 p-3 rounded-lg bg-amber-500/10 border border-amber-500/20\"\n            >\n              <div className=\"w-8 h-8 rounded-full bg-amber-500/20 flex items-center justify-center flex-shrink-0\">\n                <span className=\"text-sm font-bold text-amber-400\">\n                  {item.score.toFixed(0)}\n                </span>\n              </div>\n              <div>\n                <p className=\"text-sm font-medium text-white\">{item.name}</p>\n                <p className=\"text-xs text-neutral-400 mt-0.5\">{item.suggestion}</p>\n              </div>\n            </div>\n          ))}\n        </div>\n      </motion.div>\n    </div>\n  );\n}\n\nexport function ResultsDashboard({\n  frontLandmarks,\n  sideLandmarks,\n  gender,\n}: ResultsDashboardProps) {\n  // Calculate all analyses\n  const frontAnalysis = useMemo(() => {\n    if (frontLandmarks.length === 0) return null;\n    return comprehensiveFrontAnalysis(frontLandmarks, gender);\n  }, [frontLandmarks, gender]);\n\n  const sideAnalysis = useMemo(() => {\n    if (sideLandmarks.length === 0) return null;\n    return comprehensiveSideAnalysis(sideLandmarks, gender);\n  }, [sideLandmarks, gender]);\n\n  // Calculate overall harmony score\n  const harmonyScore = useMemo(() => {\n    const scores: number[] = [];\n    if (frontAnalysis) scores.push(frontAnalysis.harmonyScore);\n    if (sideAnalysis) scores.push(sideAnalysis.harmonyScore);\n    return scores.length > 0 ? scores.reduce((a, b) => a + b, 0) / scores.length : 0;\n  }, [frontAnalysis, sideAnalysis]);\n\n  // Collect all individual scores\n  const allScores = useMemo(() => {\n    const scores: Record<string, number> = {};\n\n    if (frontAnalysis) {\n      if (frontAnalysis.fwhr) scores.fwhr = frontAnalysis.fwhr.score;\n      if (frontAnalysis.leftCanthalTilt) scores.canthalTilt = frontAnalysis.leftCanthalTilt.score;\n      if (frontAnalysis.facialThirds) scores.facialThirds = frontAnalysis.facialThirds.overall.score;\n      if (frontAnalysis.nasalIndex) scores.nasalIndex = frontAnalysis.nasalIndex.score;\n      if (frontAnalysis.mouthNoseRatio) scores.mouthNoseRatio = frontAnalysis.mouthNoseRatio.score;\n      if (frontAnalysis.jawRatio) scores.jawRatio = frontAnalysis.jawRatio.score;\n    }\n\n    if (sideAnalysis) {\n      if (sideAnalysis.gonialAngle) scores.gonialAngle = sideAnalysis.gonialAngle.score;\n      if (sideAnalysis.nasolabialAngle) scores.nasolabialAngle = sideAnalysis.nasolabialAngle.score;\n      if (sideAnalysis.eLine) scores.eLine = sideAnalysis.eLine.combined.score;\n      if (sideAnalysis.mentolabialAngle) scores.mentolabialAngle = sideAnalysis.mentolabialAngle.score;\n      if (sideAnalysis.nasofrontalAngle) scores.nasofrontalAngle = sideAnalysis.nasofrontalAngle.score;\n    }\n\n    return scores;\n  }, [frontAnalysis, sideAnalysis]);\n\n  // Generate bell curve data for key measurements\n  const bellCurveData = useMemo(() => {\n    const data: Array<{ key: string; title: string; data: BellCurveData; unit?: string }> = [];\n\n    if (frontAnalysis?.fwhr) {\n      const bellData = generateMeasurementBellCurve('fwhr', frontAnalysis.fwhr.value, gender);\n      if (bellData) {\n        data.push({ key: 'fwhr', title: 'Face Width-to-Height Ratio', data: bellData });\n      }\n    }\n\n    if (frontAnalysis?.leftCanthalTilt) {\n      const bellData = generateMeasurementBellCurve('canthalTilt', frontAnalysis.leftCanthalTilt.value, gender);\n      if (bellData) {\n        data.push({ key: 'canthalTilt', title: 'Canthal Tilt', data: bellData, unit: '°' });\n      }\n    }\n\n    return data;\n  }, [frontAnalysis, gender]);\n\n  // Determine strengths and weaknesses\n  const { strengths, improvements } = useMemo(() => {\n    const allResults: Array<{ name: string; score: number; description: string; suggestion: string }> = [];\n\n    const measurementDescriptions: Record<string, { name: string; desc: string; suggestion: string }> = {\n      fwhr: {\n        name: 'Facial Width-to-Height Ratio',\n        desc: 'Your face has good proportional width relative to height',\n        suggestion: 'Consider facial exercises to enhance jaw definition'\n      },\n      canthalTilt: {\n        name: 'Eye Canthal Tilt',\n        desc: 'Your eyes have an attractive upward tilt',\n        suggestion: 'Eye-lifting treatments or makeup techniques can enhance tilt'\n      },\n      facialThirds: {\n        name: 'Facial Thirds Balance',\n        desc: 'Your face has well-balanced vertical proportions',\n        suggestion: 'Hairstyle adjustments can help balance facial thirds'\n      },\n      nasalIndex: {\n        name: 'Nasal Proportions',\n        desc: 'Your nose width-to-height ratio is harmonious',\n        suggestion: 'Contouring can create the illusion of different proportions'\n      },\n      gonialAngle: {\n        name: 'Jaw Angle',\n        desc: 'Your jaw has an attractive angular definition',\n        suggestion: 'Jaw exercises or mewing can help define the gonial angle'\n      },\n      nasolabialAngle: {\n        name: 'Nose-Lip Angle',\n        desc: 'The angle between your nose and lip is well-balanced',\n        suggestion: 'Nose profile can be enhanced with non-surgical treatments'\n      },\n      eLine: {\n        name: 'E-Line Profile',\n        desc: 'Your lip position relative to nose-chin line is ideal',\n        suggestion: 'Lip fillers or chin augmentation can improve E-line balance'\n      },\n      mouthNoseRatio: {\n        name: 'Mouth-to-Nose Ratio',\n        desc: 'Your mouth width is proportional to your nose',\n        suggestion: 'Lip treatments can adjust the perceived ratio'\n      },\n      jawRatio: {\n        name: 'Jaw-to-Face Width',\n        desc: 'Your jaw width is proportional to your face',\n        suggestion: 'Jaw slimming or enhancement can adjust this ratio'\n      },\n    };\n\n    Object.entries(allScores).forEach(([key, score]) => {\n      const info = measurementDescriptions[key];\n      if (info) {\n        allResults.push({\n          name: info.name,\n          score,\n          description: info.desc,\n          suggestion: info.suggestion,\n        });\n      }\n    });\n\n    // Sort by score\n    allResults.sort((a, b) => b.score - a.score);\n\n    // Top 3 are strengths, bottom 3 are improvements\n    const strengths = allResults.slice(0, 3).map(r => ({\n      name: r.name,\n      score: r.score,\n      description: r.description,\n    }));\n\n    const improvements = allResults.slice(-3).reverse().map(r => ({\n      name: r.name,\n      score: r.score,\n      suggestion: r.suggestion,\n    }));\n\n    return { strengths, improvements };\n  }, [allScores]);\n\n  if (!frontAnalysis && !sideAnalysis) {\n    return (\n      <div className=\"text-center py-12\">\n        <Activity className=\"w-12 h-12 text-neutral-600 mx-auto mb-4\" />\n        <p className=\"text-neutral-400\">No analysis data available</p>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"space-y-8\">\n      {/* Hero Score Section */}\n      <motion.div\n        initial={{ opacity: 0, y: 20 }}\n        animate={{ opacity: 1, y: 0 }}\n        className=\"text-center\"\n      >\n        <h2 className=\"text-2xl font-bold text-white mb-2\">Your Analysis Results</h2>\n        <p className=\"text-neutral-400 mb-8\">\n          Based on {frontLandmarks.length + sideLandmarks.length} facial landmarks\n        </p>\n\n        {/* Main Harmony Score Display */}\n        <HarmonyScoreDisplay\n          harmonyScore={harmonyScore}\n          individualScores={allScores}\n        />\n      </motion.div>\n\n      {/* Strengths & Weaknesses */}\n      {strengths.length > 0 && improvements.length > 0 && (\n        <StrengthsWeaknesses strengths={strengths} improvements={improvements} />\n      )}\n\n      {/* Front Profile Measurements */}\n      {frontAnalysis && (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n        >\n          <div className=\"flex items-center gap-2 mb-4\">\n            <h3 className=\"text-lg font-semibold text-white\">Front Profile Analysis</h3>\n            <span className=\"px-2 py-0.5 rounded-full bg-neutral-800 text-neutral-300 text-xs\">\n              {frontLandmarks.length} landmarks\n            </span>\n          </div>\n\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {frontAnalysis.fwhr && (\n              <MeasurementCard\n                title=\"FWHR\"\n                value={frontAnalysis.fwhr.value}\n                unit=\"ratio\"\n                score={frontAnalysis.fwhr.score}\n                idealRange={frontAnalysis.fwhr.idealRange}\n                description=\"Facial Width-to-Height Ratio\"\n                rating={frontAnalysis.fwhr.rating}\n              />\n            )}\n\n            {frontAnalysis.facialThirds && (\n              <MeasurementCard\n                title=\"Facial Thirds\"\n                value={frontAnalysis.facialThirds.overall.value}\n                unit=\"% deviation\"\n                score={frontAnalysis.facialThirds.overall.score}\n                idealRange={frontAnalysis.facialThirds.overall.idealRange}\n                description=\"Vertical face proportion balance\"\n                rating={frontAnalysis.facialThirds.overall.rating}\n              />\n            )}\n\n            {frontAnalysis.leftCanthalTilt && (\n              <MeasurementCard\n                title=\"Canthal Tilt\"\n                value={frontAnalysis.leftCanthalTilt.value}\n                unit=\"°\"\n                score={frontAnalysis.leftCanthalTilt.score}\n                idealRange={frontAnalysis.leftCanthalTilt.idealRange}\n                description=\"Eye angle from inner to outer corner\"\n                rating={frontAnalysis.leftCanthalTilt.rating}\n              />\n            )}\n\n            {frontAnalysis.nasalIndex && (\n              <MeasurementCard\n                title=\"Nasal Index\"\n                value={frontAnalysis.nasalIndex.value}\n                unit=\"%\"\n                score={frontAnalysis.nasalIndex.score}\n                idealRange={frontAnalysis.nasalIndex.idealRange}\n                description=\"Nose width to height ratio\"\n                rating={frontAnalysis.nasalIndex.rating}\n              />\n            )}\n\n            {frontAnalysis.mouthNoseRatio && (\n              <MeasurementCard\n                title=\"Mouth-Nose Ratio\"\n                value={frontAnalysis.mouthNoseRatio.value}\n                unit=\"ratio\"\n                score={frontAnalysis.mouthNoseRatio.score}\n                idealRange={frontAnalysis.mouthNoseRatio.idealRange}\n                description=\"Mouth width relative to nose\"\n                rating={frontAnalysis.mouthNoseRatio.rating}\n              />\n            )}\n\n            {frontAnalysis.jawRatio && (\n              <MeasurementCard\n                title=\"Jaw-Face Ratio\"\n                value={frontAnalysis.jawRatio.value}\n                unit=\"ratio\"\n                score={frontAnalysis.jawRatio.score}\n                idealRange={frontAnalysis.jawRatio.idealRange}\n                description=\"Jaw width to face width\"\n                rating={frontAnalysis.jawRatio.rating}\n              />\n            )}\n          </div>\n        </motion.div>\n      )}\n\n      {/* Side Profile Measurements */}\n      {sideAnalysis && (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n        >\n          <div className=\"flex items-center gap-2 mb-4\">\n            <h3 className=\"text-lg font-semibold text-white\">Side Profile Analysis</h3>\n            <span className=\"px-2 py-0.5 rounded-full bg-neutral-800 text-neutral-300 text-xs\">\n              {sideLandmarks.length} landmarks\n            </span>\n          </div>\n\n          <div className=\"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4\">\n            {sideAnalysis.gonialAngle && (\n              <MeasurementCard\n                title=\"Gonial Angle\"\n                value={sideAnalysis.gonialAngle.value}\n                unit=\"°\"\n                score={sideAnalysis.gonialAngle.score}\n                idealRange={sideAnalysis.gonialAngle.idealRange}\n                description=\"Jaw angle measurement\"\n                rating={sideAnalysis.gonialAngle.rating}\n              />\n            )}\n\n            {sideAnalysis.nasolabialAngle && (\n              <MeasurementCard\n                title=\"Nasolabial Angle\"\n                value={sideAnalysis.nasolabialAngle.value}\n                unit=\"°\"\n                score={sideAnalysis.nasolabialAngle.score}\n                idealRange={sideAnalysis.nasolabialAngle.idealRange}\n                description=\"Nose to upper lip angle\"\n                rating={sideAnalysis.nasolabialAngle.rating}\n              />\n            )}\n\n            {sideAnalysis.eLine && (\n              <MeasurementCard\n                title=\"E-Line (Ricketts)\"\n                value={sideAnalysis.eLine.combined.value}\n                unit=\"mm\"\n                score={sideAnalysis.eLine.combined.score}\n                idealRange={sideAnalysis.eLine.combined.idealRange}\n                description=\"Lip position relative to nose-chin line\"\n                rating={sideAnalysis.eLine.combined.rating}\n              />\n            )}\n\n            {sideAnalysis.mentolabialAngle && (\n              <MeasurementCard\n                title=\"Mentolabial Angle\"\n                value={sideAnalysis.mentolabialAngle.value}\n                unit=\"°\"\n                score={sideAnalysis.mentolabialAngle.score}\n                idealRange={sideAnalysis.mentolabialAngle.idealRange}\n                description=\"Chin-lip fold depth\"\n                rating={sideAnalysis.mentolabialAngle.rating}\n              />\n            )}\n\n            {sideAnalysis.nasofrontalAngle && (\n              <MeasurementCard\n                title=\"Nasofrontal Angle\"\n                value={sideAnalysis.nasofrontalAngle.value}\n                unit=\"°\"\n                score={sideAnalysis.nasofrontalAngle.score}\n                idealRange={sideAnalysis.nasofrontalAngle.idealRange}\n                description=\"Forehead to nose bridge angle\"\n                rating={sideAnalysis.nasofrontalAngle.rating}\n              />\n            )}\n          </div>\n        </motion.div>\n      )}\n\n      {/* Bell Curve Charts */}\n      {bellCurveData.length > 0 && (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n        >\n          <h3 className=\"text-lg font-semibold text-white mb-4\">\n            Population Comparison\n          </h3>\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n            {bellCurveData.map((item) => (\n              <BellCurveChart\n                key={item.key}\n                data={item.data}\n                title={item.title}\n                unit={item.unit}\n                height={180}\n              />\n            ))}\n          </div>\n        </motion.div>\n      )}\n\n      {/* Detailed Facial Thirds Breakdown */}\n      {frontAnalysis?.facialThirds && (\n        <motion.div\n          initial={{ opacity: 0, y: 20 }}\n          animate={{ opacity: 1, y: 0 }}\n          className=\"bg-black rounded-xl border border-neutral-800 p-5\"\n        >\n          <h3 className=\"text-lg font-semibold text-white mb-4\">\n            Facial Thirds Breakdown\n          </h3>\n          <div className=\"grid grid-cols-3 gap-4\">\n            <div className=\"text-center\">\n              <div className=\"h-20 bg-gradient-to-b from-neutral-700 to-transparent rounded-t-lg mb-2 flex items-end justify-center pb-2\">\n                <span className=\"text-2xl font-bold text-white\">\n                  {frontAnalysis.facialThirds.upper.value.toFixed(1)}%\n                </span>\n              </div>\n              <p className=\"text-xs text-neutral-400\">Upper Third</p>\n              <p className=\"text-xs text-neutral-500\">Hairline to Brow</p>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"h-20 bg-gradient-to-b from-[#00f3ff]/30 to-transparent rounded-t-lg mb-2 flex items-end justify-center pb-2\">\n                <span className=\"text-2xl font-bold text-white\">\n                  {frontAnalysis.facialThirds.middle.value.toFixed(1)}%\n                </span>\n              </div>\n              <p className=\"text-xs text-neutral-400\">Middle Third</p>\n              <p className=\"text-xs text-[#00f3ff]\">Brow to Nose Base</p>\n            </div>\n            <div className=\"text-center\">\n              <div className=\"h-20 bg-gradient-to-b from-green-500/30 to-transparent rounded-t-lg mb-2 flex items-end justify-center pb-2\">\n                <span className=\"text-2xl font-bold text-white\">\n                  {frontAnalysis.facialThirds.lower.value.toFixed(1)}%\n                </span>\n              </div>\n              <p className=\"text-xs text-neutral-400\">Lower Third</p>\n              <p className=\"text-xs text-green-400\">Nose Base to Chin</p>\n            </div>\n          </div>\n          <div className=\"mt-4 text-center\">\n            <p className=\"text-sm text-neutral-400\">\n              Ideal distribution: 33.3% each • Your balance score:{' '}\n              <span className=\"text-white font-medium\">\n                {frontAnalysis.facialThirds.overall.score.toFixed(0)}/100\n              </span>\n            </p>\n          </div>\n        </motion.div>\n      )}\n    </div>\n  );\n}\n","numLines":629,"startLine":1,"totalLines":629}}}
{"parentUuid":"888a31d1-c9ca-4f0e-ada5-f5b74917a425","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AmiQKFCAA4DjUxi4cu6jWJ","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useMemo } from 'react';\n     4→import {\n     5→  AreaChart,\n     6→  Area,\n     7→  XAxis,\n     8→  YAxis,\n     9→  ReferenceLine,\n    10→  ResponsiveContainer,\n    11→  Tooltip,\n    12→} from 'recharts';\n    13→import { motion } from 'framer-motion';\n    14→import { BellCurveData } from '@/lib/scoring';\n    15→\n    16→interface BellCurveChartProps {\n    17→  data: BellCurveData;\n    18→  title: string;\n    19→  unit?: string;\n    20→  color?: string;\n    21→  showIdeal?: boolean;\n    22→  showPercentile?: boolean;\n    23→  height?: number;\n    24→}\n    25→\n    26→export function BellCurveChart({\n    27→  data,\n    28→  title,\n    29→  unit = '',\n    30→  color = '#00f3ff',\n    31→  showIdeal = true,\n    32→  showPercentile = true,\n    33→  height = 200,\n    34→}: BellCurveChartProps) {\n    35→  const chartData = useMemo(() => {\n    36→    return data.points.map((point) => ({\n    37→      x: point.x,\n    38→      y: point.y,\n    39→      // Add fill color based on distance from user value\n    40→      isUser: Math.abs(point.x - data.userValue) < data.standardDeviation * 0.1,\n    41→    }));\n    42→  }, [data]);\n    43→\n    44→  const formatValue = (value: number) => {\n    45→    if (Math.abs(value) >= 100) {\n    46→      return value.toFixed(0);\n    47→    }\n    48→    return value.toFixed(2);\n    49→  };\n    50→\n    51→  const getPercentileLabel = (percentile: number): string => {\n    52→    if (percentile >= 95) return 'Top 5%';\n    53→    if (percentile >= 90) return 'Top 10%';\n    54→    if (percentile >= 75) return 'Above Average';\n    55→    if (percentile >= 50) return 'Average';\n    56→    if (percentile >= 25) return 'Below Average';\n    57→    return 'Bottom 25%';\n    58→  };\n    59→\n    60→  const getPercentileColor = (percentile: number): string => {\n    61→    if (percentile >= 90) return '#10b981'; // green\n    62→    if (percentile >= 75) return '#22d3ee'; // cyan\n    63→    if (percentile >= 50) return '#fbbf24'; // yellow\n    64→    if (percentile >= 25) return '#f97316'; // orange\n    65→    return '#ef4444'; // red\n    66→  };\n    67→\n    68→  return (\n    69→    <motion.div\n    70→      initial={{ opacity: 0, y: 20 }}\n    71→      animate={{ opacity: 1, y: 0 }}\n    72→      className=\"bg-background-secondary rounded-xl border border-border p-4\"\n    73→    >\n    74→      {/* Header */}\n    75→      <div className=\"flex items-center justify-between mb-4\">\n    76→        <h3 className=\"text-sm font-semibold text-white\">{title}</h3>\n    77→        {showPercentile && (\n    78→          <div className=\"flex items-center gap-2\">\n    79→            <span\n    80→              className=\"text-xs font-medium px-2 py-1 rounded-full\"\n    81→              style={{\n    82→                backgroundColor: `${getPercentileColor(data.userPercentile)}20`,\n    83→                color: getPercentileColor(data.userPercentile),\n    84→              }}\n    85→            >\n    86→              {getPercentileLabel(data.userPercentile)}\n    87→            </span>\n    88→            <span className=\"text-xs text-foreground-dim\">\n    89→              {data.userPercentile.toFixed(1)}th percentile\n    90→            </span>\n    91→          </div>\n    92→        )}\n    93→      </div>\n    94→\n    95→      {/* Chart */}\n    96→      <div style={{ height }}>\n    97→        <ResponsiveContainer width=\"100%\" height=\"100%\">\n    98→          <AreaChart\n    99→            data={chartData}\n   100→            margin={{ top: 10, right: 10, left: 10, bottom: 20 }}\n   101→          >\n   102→            <defs>\n   103→              <linearGradient id={`gradient-${title}`} x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n   104→                <stop offset=\"5%\" stopColor={color} stopOpacity={0.3} />\n   105→                <stop offset=\"95%\" stopColor={color} stopOpacity={0} />\n   106→              </linearGradient>\n   107→            </defs>\n   108→\n   109→            <XAxis\n   110→              dataKey=\"x\"\n   111→              type=\"number\"\n   112→              domain={['dataMin', 'dataMax']}\n   113→              tickFormatter={(value) => formatValue(value)}\n   114→              tick={{ fill: '#71717a', fontSize: 10 }}\n   115→              axisLine={{ stroke: '#27272a' }}\n   116→              tickLine={{ stroke: '#27272a' }}\n   117→            />\n   118→\n   119→            <YAxis hide />\n   120→\n   121→            <Tooltip\n   122→              contentStyle={{\n   123→                backgroundColor: '#18181b',\n   124→                border: '1px solid #27272a',\n   125→                borderRadius: '8px',\n   126→              }}\n   127→              labelStyle={{ color: '#fff' }}\n   128→              formatter={(value) => {\n   129→                const numValue = typeof value === 'number' ? value : 0;\n   130→                return [numValue.toFixed(6), 'Density'];\n   131→              }}\n   132→              labelFormatter={(value) => {\n   133→                const numValue = typeof value === 'number' ? value : 0;\n   134→                return `Value: ${formatValue(numValue)}${unit}`;\n   135→              }}\n   136→            />\n   137→\n   138→            <Area\n   139→              type=\"monotone\"\n   140→              dataKey=\"y\"\n   141→              stroke={color}\n   142→              strokeWidth={2}\n   143→              fill={`url(#gradient-${title})`}\n   144→            />\n   145→\n   146→            {/* Population Mean Line */}\n   147→            <ReferenceLine\n   148→              x={data.mean}\n   149→              stroke=\"#71717a\"\n   150→              strokeDasharray=\"3 3\"\n   151→              label={{\n   152→                value: 'Mean',\n   153→                position: 'top',\n   154→                fill: '#71717a',\n   155→                fontSize: 10,\n   156→              }}\n   157→            />\n   158→\n   159→            {/* User Value Line */}\n   160→            <ReferenceLine\n   161→              x={data.userValue}\n   162→              stroke={color}\n   163→              strokeWidth={2}\n   164→              label={{\n   165→                value: `You: ${formatValue(data.userValue)}${unit}`,\n   166→                position: 'top',\n   167→                fill: color,\n   168→                fontSize: 11,\n   169→                fontWeight: 600,\n   170→              }}\n   171→            />\n   172→\n   173→            {/* Ideal Value Line (if different from user) */}\n   174→            {showIdeal && data.idealValue !== undefined && (\n   175→              <ReferenceLine\n   176→                x={data.idealValue}\n   177→                stroke=\"#10b981\"\n   178→                strokeDasharray=\"5 5\"\n   179→                label={{\n   180→                  value: 'Ideal',\n   181→                  position: 'insideTopRight',\n   182→                  fill: '#10b981',\n   183→                  fontSize: 10,\n   184→                }}\n   185→              />\n   186→            )}\n   187→          </AreaChart>\n   188→        </ResponsiveContainer>\n   189→      </div>\n   190→\n   191→      {/* Stats Footer */}\n   192→      <div className=\"mt-3 grid grid-cols-3 gap-2 text-center\">\n   193→        <div className=\"bg-black/30 rounded-lg p-2\">\n   194→          <p className=\"text-[10px] text-foreground-dim\">Your Value</p>\n   195→          <p className=\"text-sm font-semibold\" style={{ color }}>\n   196→            {formatValue(data.userValue)}\n   197→            {unit}\n   198→          </p>\n   199→        </div>\n   200→        <div className=\"bg-black/30 rounded-lg p-2\">\n   201→          <p className=\"text-[10px] text-foreground-dim\">Population Mean</p>\n   202→          <p className=\"text-sm font-semibold text-white\">\n   203→            {formatValue(data.mean)}\n   204→            {unit}\n   205→          </p>\n   206→        </div>\n   207→        {data.idealValue !== undefined && (\n   208→          <div className=\"bg-black/30 rounded-lg p-2\">\n   209→            <p className=\"text-[10px] text-foreground-dim\">Ideal</p>\n   210→            <p className=\"text-sm font-semibold text-emerald-400\">\n   211→              {formatValue(data.idealValue)}\n   212→              {unit}\n   213→            </p>\n   214→          </div>\n   215→        )}\n   216→      </div>\n   217→    </motion.div>\n   218→  );\n   219→}\n   220→\n   221→interface BellCurveComparisonProps {\n   222→  measurements: Array<{\n   223→    key: string;\n   224→    title: string;\n   225→    data: BellCurveData;\n   226→    unit?: string;\n   227→  }>;\n   228→}\n   229→\n   230→export function BellCurveComparison({ measurements }: BellCurveComparisonProps) {\n   231→  const colors = [\n   232→    '#00f3ff', // cyan\n   233→    '#10b981', // green\n   234→    '#f59e0b', // amber\n   235→    '#8b5cf6', // purple\n   236→    '#ec4899', // pink\n   237→    '#3b82f6', // blue\n   238→  ];\n   239→\n   240→  return (\n   241→    <div className=\"space-y-4\">\n   242→      <h2 className=\"text-lg font-semibold text-white\">Percentile Rankings</h2>\n   243→      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n   244→        {measurements.map((measurement, index) => (\n   245→          <BellCurveChart\n   246→            key={measurement.key}\n   247→            data={measurement.data}\n   248→            title={measurement.title}\n   249→            unit={measurement.unit}\n   250→            color={colors[index % colors.length]}\n   251→            height={180}\n   252→          />\n   253→        ))}\n   254→      </div>\n   255→    </div>\n   256→  );\n   257→}\n   258→\n   259→interface ScoreGaugeProps {\n   260→  score: number;\n   261→  label: string;\n   262→  maxScore?: number;\n   263→}\n   264→\n   265→export function ScoreGauge({ score, label, maxScore = 100 }: ScoreGaugeProps) {\n   266→  const percentage = (score / maxScore) * 100;\n   267→  const circumference = 2 * Math.PI * 45;\n   268→  const strokeDashoffset = circumference - (percentage / 100) * circumference;\n   269→\n   270→  const getScoreColor = (score: number): string => {\n   271→    if (score >= 90) return '#10b981';\n   272→    if (score >= 75) return '#22d3ee';\n   273→    if (score >= 50) return '#fbbf24';\n   274→    if (score >= 25) return '#f97316';\n   275→    return '#ef4444';\n   276→  };\n   277→\n   278→  return (\n   279→    <motion.div\n   280→      initial={{ opacity: 0, scale: 0.9 }}\n   281→      animate={{ opacity: 1, scale: 1 }}\n   282→      className=\"flex flex-col items-center\"\n   283→    >\n   284→      <div className=\"relative w-28 h-28\">\n   285→        <svg className=\"w-full h-full transform -rotate-90\">\n   286→          {/* Background circle */}\n   287→          <circle\n   288→            cx=\"56\"\n   289→            cy=\"56\"\n   290→            r=\"45\"\n   291→            stroke=\"#27272a\"\n   292→            strokeWidth=\"8\"\n   293→            fill=\"none\"\n   294→          />\n   295→          {/* Progress circle */}\n   296→          <motion.circle\n   297→            cx=\"56\"\n   298→            cy=\"56\"\n   299→            r=\"45\"\n   300→            stroke={getScoreColor(score)}\n   301→            strokeWidth=\"8\"\n   302→            fill=\"none\"\n   303→            strokeLinecap=\"round\"\n   304→            strokeDasharray={circumference}\n   305→            initial={{ strokeDashoffset: circumference }}\n   306→            animate={{ strokeDashoffset }}\n   307→            transition={{ duration: 1, ease: 'easeOut' }}\n   308→          />\n   309→        </svg>\n   310→        <div className=\"absolute inset-0 flex items-center justify-center\">\n   311→          <span\n   312→            className=\"text-2xl font-bold\"\n   313→            style={{ color: getScoreColor(score) }}\n   314→          >\n   315→            {score.toFixed(0)}\n   316→          </span>\n   317→        </div>\n   318→      </div>\n   319→      <p className=\"mt-2 text-sm text-foreground-dim text-center\">{label}</p>\n   320→    </motion.div>\n   321→  );\n   322→}\n   323→\n   324→interface HarmonyScoreDisplayProps {\n   325→  harmonyScore: number;\n   326→  individualScores: Record<string, number>;\n   327→}\n   328→\n   329→export function HarmonyScoreDisplay({\n   330→  harmonyScore,\n   331→  individualScores,\n   332→}: HarmonyScoreDisplayProps) {\n   333→  const scoreLabels: Record<string, string> = {\n   334→    fwhr: 'Face Ratio',\n   335→    canthalTilt: 'Eye Tilt',\n   336→    facialThirds: 'Proportions',\n   337→    nasolabialAngle: 'Nose-Lip',\n   338→    gonialAngle: 'Jaw Angle',\n   339→    overallSymmetry: 'Symmetry',\n   340→    goldenRatio: 'Golden Ratio',\n   341→    nasalIndex: 'Nose Shape',\n   342→    lipRatio: 'Lip Ratio',\n   343→  };\n   344→\n   345→  return (\n   346→    <motion.div\n   347→      initial={{ opacity: 0, y: 20 }}\n   348→      animate={{ opacity: 1, y: 0 }}\n   349→      className=\"bg-background-secondary rounded-xl border border-border p-6\"\n   350→    >\n   351→      <div className=\"flex flex-col md:flex-row items-center gap-6\">\n   352→        {/* Main Harmony Score */}\n   353→        <div className=\"flex-shrink-0\">\n   354→          <ScoreGauge score={harmonyScore} label=\"Harmony Score\" />\n   355→        </div>\n   356→\n   357→        {/* Individual Scores */}\n   358→        <div className=\"flex-1 w-full\">\n   359→          <h3 className=\"text-sm font-semibold text-white mb-3\">\n   360→            Individual Scores\n   361→          </h3>\n   362→          <div className=\"space-y-2\">\n   363→            {Object.entries(individualScores).map(([key, score]) => (\n   364→              <div key={key} className=\"flex items-center gap-3\">\n   365→                <span className=\"text-xs text-foreground-dim w-24 truncate\">\n   366→                  {scoreLabels[key] || key}\n   367→                </span>\n   368→                <div className=\"flex-1 h-2 bg-black/30 rounded-full overflow-hidden\">\n   369→                  <motion.div\n   370→                    className=\"h-full rounded-full\"\n   371→                    style={{\n   372→                      backgroundColor:\n   373→                        score >= 75\n   374→                          ? '#10b981'\n   375→                          : score >= 50\n   376→                            ? '#fbbf24'\n   377→                            : '#ef4444',\n   378→                    }}\n   379→                    initial={{ width: 0 }}\n   380→                    animate={{ width: `${score}%` }}\n   381→                    transition={{ duration: 0.8, delay: 0.1 }}\n   382→                  />\n   383→                </div>\n   384→                <span className=\"text-xs font-medium text-white w-8 text-right\">\n   385→                  {score.toFixed(0)}\n   386→                </span>\n   387→              </div>\n   388→            ))}\n   389→          </div>\n   390→        </div>\n   391→      </div>\n   392→    </motion.div>\n   393→  );\n   394→}\n   395→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"33713d91-4da4-412f-a59e-7361be2015a0","timestamp":"2025-12-20T15:49:51.325Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/BellCurveChart.tsx","content":"'use client';\n\nimport { useMemo } from 'react';\nimport {\n  AreaChart,\n  Area,\n  XAxis,\n  YAxis,\n  ReferenceLine,\n  ResponsiveContainer,\n  Tooltip,\n} from 'recharts';\nimport { motion } from 'framer-motion';\nimport { BellCurveData } from '@/lib/scoring';\n\ninterface BellCurveChartProps {\n  data: BellCurveData;\n  title: string;\n  unit?: string;\n  color?: string;\n  showIdeal?: boolean;\n  showPercentile?: boolean;\n  height?: number;\n}\n\nexport function BellCurveChart({\n  data,\n  title,\n  unit = '',\n  color = '#00f3ff',\n  showIdeal = true,\n  showPercentile = true,\n  height = 200,\n}: BellCurveChartProps) {\n  const chartData = useMemo(() => {\n    return data.points.map((point) => ({\n      x: point.x,\n      y: point.y,\n      // Add fill color based on distance from user value\n      isUser: Math.abs(point.x - data.userValue) < data.standardDeviation * 0.1,\n    }));\n  }, [data]);\n\n  const formatValue = (value: number) => {\n    if (Math.abs(value) >= 100) {\n      return value.toFixed(0);\n    }\n    return value.toFixed(2);\n  };\n\n  const getPercentileLabel = (percentile: number): string => {\n    if (percentile >= 95) return 'Top 5%';\n    if (percentile >= 90) return 'Top 10%';\n    if (percentile >= 75) return 'Above Average';\n    if (percentile >= 50) return 'Average';\n    if (percentile >= 25) return 'Below Average';\n    return 'Bottom 25%';\n  };\n\n  const getPercentileColor = (percentile: number): string => {\n    if (percentile >= 90) return '#10b981'; // green\n    if (percentile >= 75) return '#22d3ee'; // cyan\n    if (percentile >= 50) return '#fbbf24'; // yellow\n    if (percentile >= 25) return '#f97316'; // orange\n    return '#ef4444'; // red\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"bg-background-secondary rounded-xl border border-border p-4\"\n    >\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-4\">\n        <h3 className=\"text-sm font-semibold text-white\">{title}</h3>\n        {showPercentile && (\n          <div className=\"flex items-center gap-2\">\n            <span\n              className=\"text-xs font-medium px-2 py-1 rounded-full\"\n              style={{\n                backgroundColor: `${getPercentileColor(data.userPercentile)}20`,\n                color: getPercentileColor(data.userPercentile),\n              }}\n            >\n              {getPercentileLabel(data.userPercentile)}\n            </span>\n            <span className=\"text-xs text-foreground-dim\">\n              {data.userPercentile.toFixed(1)}th percentile\n            </span>\n          </div>\n        )}\n      </div>\n\n      {/* Chart */}\n      <div style={{ height }}>\n        <ResponsiveContainer width=\"100%\" height=\"100%\">\n          <AreaChart\n            data={chartData}\n            margin={{ top: 10, right: 10, left: 10, bottom: 20 }}\n          >\n            <defs>\n              <linearGradient id={`gradient-${title}`} x1=\"0\" y1=\"0\" x2=\"0\" y2=\"1\">\n                <stop offset=\"5%\" stopColor={color} stopOpacity={0.3} />\n                <stop offset=\"95%\" stopColor={color} stopOpacity={0} />\n              </linearGradient>\n            </defs>\n\n            <XAxis\n              dataKey=\"x\"\n              type=\"number\"\n              domain={['dataMin', 'dataMax']}\n              tickFormatter={(value) => formatValue(value)}\n              tick={{ fill: '#71717a', fontSize: 10 }}\n              axisLine={{ stroke: '#27272a' }}\n              tickLine={{ stroke: '#27272a' }}\n            />\n\n            <YAxis hide />\n\n            <Tooltip\n              contentStyle={{\n                backgroundColor: '#18181b',\n                border: '1px solid #27272a',\n                borderRadius: '8px',\n              }}\n              labelStyle={{ color: '#fff' }}\n              formatter={(value) => {\n                const numValue = typeof value === 'number' ? value : 0;\n                return [numValue.toFixed(6), 'Density'];\n              }}\n              labelFormatter={(value) => {\n                const numValue = typeof value === 'number' ? value : 0;\n                return `Value: ${formatValue(numValue)}${unit}`;\n              }}\n            />\n\n            <Area\n              type=\"monotone\"\n              dataKey=\"y\"\n              stroke={color}\n              strokeWidth={2}\n              fill={`url(#gradient-${title})`}\n            />\n\n            {/* Population Mean Line */}\n            <ReferenceLine\n              x={data.mean}\n              stroke=\"#71717a\"\n              strokeDasharray=\"3 3\"\n              label={{\n                value: 'Mean',\n                position: 'top',\n                fill: '#71717a',\n                fontSize: 10,\n              }}\n            />\n\n            {/* User Value Line */}\n            <ReferenceLine\n              x={data.userValue}\n              stroke={color}\n              strokeWidth={2}\n              label={{\n                value: `You: ${formatValue(data.userValue)}${unit}`,\n                position: 'top',\n                fill: color,\n                fontSize: 11,\n                fontWeight: 600,\n              }}\n            />\n\n            {/* Ideal Value Line (if different from user) */}\n            {showIdeal && data.idealValue !== undefined && (\n              <ReferenceLine\n                x={data.idealValue}\n                stroke=\"#10b981\"\n                strokeDasharray=\"5 5\"\n                label={{\n                  value: 'Ideal',\n                  position: 'insideTopRight',\n                  fill: '#10b981',\n                  fontSize: 10,\n                }}\n              />\n            )}\n          </AreaChart>\n        </ResponsiveContainer>\n      </div>\n\n      {/* Stats Footer */}\n      <div className=\"mt-3 grid grid-cols-3 gap-2 text-center\">\n        <div className=\"bg-black/30 rounded-lg p-2\">\n          <p className=\"text-[10px] text-foreground-dim\">Your Value</p>\n          <p className=\"text-sm font-semibold\" style={{ color }}>\n            {formatValue(data.userValue)}\n            {unit}\n          </p>\n        </div>\n        <div className=\"bg-black/30 rounded-lg p-2\">\n          <p className=\"text-[10px] text-foreground-dim\">Population Mean</p>\n          <p className=\"text-sm font-semibold text-white\">\n            {formatValue(data.mean)}\n            {unit}\n          </p>\n        </div>\n        {data.idealValue !== undefined && (\n          <div className=\"bg-black/30 rounded-lg p-2\">\n            <p className=\"text-[10px] text-foreground-dim\">Ideal</p>\n            <p className=\"text-sm font-semibold text-emerald-400\">\n              {formatValue(data.idealValue)}\n              {unit}\n            </p>\n          </div>\n        )}\n      </div>\n    </motion.div>\n  );\n}\n\ninterface BellCurveComparisonProps {\n  measurements: Array<{\n    key: string;\n    title: string;\n    data: BellCurveData;\n    unit?: string;\n  }>;\n}\n\nexport function BellCurveComparison({ measurements }: BellCurveComparisonProps) {\n  const colors = [\n    '#00f3ff', // cyan\n    '#10b981', // green\n    '#f59e0b', // amber\n    '#8b5cf6', // purple\n    '#ec4899', // pink\n    '#3b82f6', // blue\n  ];\n\n  return (\n    <div className=\"space-y-4\">\n      <h2 className=\"text-lg font-semibold text-white\">Percentile Rankings</h2>\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        {measurements.map((measurement, index) => (\n          <BellCurveChart\n            key={measurement.key}\n            data={measurement.data}\n            title={measurement.title}\n            unit={measurement.unit}\n            color={colors[index % colors.length]}\n            height={180}\n          />\n        ))}\n      </div>\n    </div>\n  );\n}\n\ninterface ScoreGaugeProps {\n  score: number;\n  label: string;\n  maxScore?: number;\n}\n\nexport function ScoreGauge({ score, label, maxScore = 100 }: ScoreGaugeProps) {\n  const percentage = (score / maxScore) * 100;\n  const circumference = 2 * Math.PI * 45;\n  const strokeDashoffset = circumference - (percentage / 100) * circumference;\n\n  const getScoreColor = (score: number): string => {\n    if (score >= 90) return '#10b981';\n    if (score >= 75) return '#22d3ee';\n    if (score >= 50) return '#fbbf24';\n    if (score >= 25) return '#f97316';\n    return '#ef4444';\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, scale: 0.9 }}\n      animate={{ opacity: 1, scale: 1 }}\n      className=\"flex flex-col items-center\"\n    >\n      <div className=\"relative w-28 h-28\">\n        <svg className=\"w-full h-full transform -rotate-90\">\n          {/* Background circle */}\n          <circle\n            cx=\"56\"\n            cy=\"56\"\n            r=\"45\"\n            stroke=\"#27272a\"\n            strokeWidth=\"8\"\n            fill=\"none\"\n          />\n          {/* Progress circle */}\n          <motion.circle\n            cx=\"56\"\n            cy=\"56\"\n            r=\"45\"\n            stroke={getScoreColor(score)}\n            strokeWidth=\"8\"\n            fill=\"none\"\n            strokeLinecap=\"round\"\n            strokeDasharray={circumference}\n            initial={{ strokeDashoffset: circumference }}\n            animate={{ strokeDashoffset }}\n            transition={{ duration: 1, ease: 'easeOut' }}\n          />\n        </svg>\n        <div className=\"absolute inset-0 flex items-center justify-center\">\n          <span\n            className=\"text-2xl font-bold\"\n            style={{ color: getScoreColor(score) }}\n          >\n            {score.toFixed(0)}\n          </span>\n        </div>\n      </div>\n      <p className=\"mt-2 text-sm text-foreground-dim text-center\">{label}</p>\n    </motion.div>\n  );\n}\n\ninterface HarmonyScoreDisplayProps {\n  harmonyScore: number;\n  individualScores: Record<string, number>;\n}\n\nexport function HarmonyScoreDisplay({\n  harmonyScore,\n  individualScores,\n}: HarmonyScoreDisplayProps) {\n  const scoreLabels: Record<string, string> = {\n    fwhr: 'Face Ratio',\n    canthalTilt: 'Eye Tilt',\n    facialThirds: 'Proportions',\n    nasolabialAngle: 'Nose-Lip',\n    gonialAngle: 'Jaw Angle',\n    overallSymmetry: 'Symmetry',\n    goldenRatio: 'Golden Ratio',\n    nasalIndex: 'Nose Shape',\n    lipRatio: 'Lip Ratio',\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"bg-background-secondary rounded-xl border border-border p-6\"\n    >\n      <div className=\"flex flex-col md:flex-row items-center gap-6\">\n        {/* Main Harmony Score */}\n        <div className=\"flex-shrink-0\">\n          <ScoreGauge score={harmonyScore} label=\"Harmony Score\" />\n        </div>\n\n        {/* Individual Scores */}\n        <div className=\"flex-1 w-full\">\n          <h3 className=\"text-sm font-semibold text-white mb-3\">\n            Individual Scores\n          </h3>\n          <div className=\"space-y-2\">\n            {Object.entries(individualScores).map(([key, score]) => (\n              <div key={key} className=\"flex items-center gap-3\">\n                <span className=\"text-xs text-foreground-dim w-24 truncate\">\n                  {scoreLabels[key] || key}\n                </span>\n                <div className=\"flex-1 h-2 bg-black/30 rounded-full overflow-hidden\">\n                  <motion.div\n                    className=\"h-full rounded-full\"\n                    style={{\n                      backgroundColor:\n                        score >= 75\n                          ? '#10b981'\n                          : score >= 50\n                            ? '#fbbf24'\n                            : '#ef4444',\n                    }}\n                    initial={{ width: 0 }}\n                    animate={{ width: `${score}%` }}\n                    transition={{ duration: 0.8, delay: 0.1 }}\n                  />\n                </div>\n                <span className=\"text-xs font-medium text-white w-8 text-right\">\n                  {score.toFixed(0)}\n                </span>\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n","numLines":395,"startLine":1,"totalLines":395}}}
{"parentUuid":"33713d91-4da4-412f-a59e-7361be2015a0","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015UyC6ECxut35jRywsHQgNe","type":"tool_result","content":"     1→/**\n     2→ * FaceIQ-Style Facial Analysis Scoring System\n     3→ * Complete replication of FaceIQ Labs scoring algorithms\n     4→ *\n     5→ * Features:\n     6→ * - Exponential decay scoring with per-metric decay rates\n     7→ * - Bezier curve custom scoring for non-linear measurements\n     8→ * - 70+ facial measurements (front + side profiles)\n     9→ * - Quality tiers: Ideal, Excellent, Good\n    10→ * - 5-tier severity: Extremely Severe, Severe, Major, Moderate, Minor\n    11→ */\n    12→\n    13→import { LandmarkPoint } from './landmarks';\n    14→\n    15→// ============================================\n    16→// CORE TYPES\n    17→// ============================================\n    18→\n    19→export interface Point {\n    20→  x: number;\n    21→  y: number;\n    22→}\n    23→\n    24→export type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\n    25→export type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\n    26→export type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n    27→\n    28→export interface MetricConfig {\n    29→  id: string;\n    30→  name: string;\n    31→  category: string;\n    32→  unit: MeasurementUnit;\n    33→  idealMin: number;\n    34→  idealMax: number;\n    35→  rangeMin: number;\n    36→  rangeMax: number;\n    37→  decayRate: number;\n    38→  maxScore: number;\n    39→  weight: number;\n    40→  description: string;\n    41→  profileType: 'front' | 'side';\n    42→  customCurve?: BezierCurveConfig;\n    43→}\n    44→\n    45→export interface BezierCurveConfig {\n    46→  mode: 'custom' | 'exponential';\n    47→  points: CurvePoint[];\n    48→}\n    49→\n    50→export interface CurvePoint {\n    51→  x: number;\n    52→  y: number;\n    53→  leftHandleX?: number;\n    54→  leftHandleY?: number;\n    55→  rightHandleX?: number;\n    56→  rightHandleY?: number;\n    57→  fixed?: boolean;\n    58→}\n    59→\n    60→export interface FaceIQScoreResult {\n    61→  metricId: string;\n    62→  name: string;\n    63→  value: number;\n    64→  score: number;  // 0-10 scale\n    65→  standardizedScore: number;\n    66→  qualityTier: QualityTier;\n    67→  severity: SeverityLevel;\n    68→  idealMin: number;\n    69→  idealMax: number;\n    70→  deviation: number;\n    71→  deviationDirection: 'above' | 'below' | 'within';\n    72→  unit: MeasurementUnit;\n    73→  category: string;\n    74→  percentile?: number;\n    75→}\n    76→\n    77→export interface HarmonyAnalysis {\n    78→  overallScore: number;  // 0-10 scale\n    79→  standardizedScore: number;\n    80→  qualityTier: QualityTier;\n    81→  percentile: number;\n    82→  frontScore: number;\n    83→  sideScore: number;\n    84→  categoryScores: Record<string, number>;\n    85→  measurements: FaceIQScoreResult[];\n    86→  flaws: FlawAssessment[];\n    87→  strengths: StrengthAssessment[];\n    88→}\n    89→\n    90→export interface FlawAssessment {\n    91→  category: string;\n    92→  metricId: string;\n    93→  metricName: string;\n    94→  severity: SeverityLevel;\n    95→  deviation: string;\n    96→  reasoning: string;\n    97→  confidence: 'confirmed' | 'likely' | 'possible';\n    98→}\n    99→\n   100→export interface StrengthAssessment {\n   101→  category: string;\n   102→  metricId: string;\n   103→  metricName: string;\n   104→  qualityTier: QualityTier;\n   105→  value: number;\n   106→  reasoning: string;\n   107→}\n   108→\n   109→// ============================================\n   110→// FACEIQ MEASUREMENT CONFIGURATIONS (70+)\n   111→// ============================================\n   112→\n   113→export const FACEIQ_METRICS: Record<string, MetricConfig> = {\n   114→  // ==========================================\n   115→  // FRONT PROFILE - FACIAL PROPORTIONS (32)\n   116→  // ==========================================\n   117→\n   118→  faceWidthToHeight: {\n   119→    id: 'faceWidthToHeight',\n   120→    name: 'Face Width to Height Ratio',\n   121→    category: 'Midface/Face Shape',\n   122→    unit: 'ratio',\n   123→    idealMin: 1.96,\n   124→    idealMax: 2.0,\n   125→    rangeMin: 1.5,\n   126→    rangeMax: 2.5,\n   127→    decayRate: 15.0,\n   128→    maxScore: 10,\n   129→    weight: 0.04,\n   130→    description: 'Ratio of bizygomatic width to upper face height',\n   131→    profileType: 'front',\n   132→  },\n   133→\n   134→  lowerThirdProportion: {\n   135→    id: 'lowerThirdProportion',\n   136→    name: 'Lower Third Proportion',\n   137→    category: 'Midface/Face Shape',\n   138→    unit: 'percent',\n   139→    idealMin: 31,\n   140→    idealMax: 33.5,\n   141→    rangeMin: 24,\n   142→    rangeMax: 40,\n   143→    decayRate: 1.86,\n   144→    maxScore: 10,\n   145→    weight: 0.03,\n   146→    description: 'Percentage of face occupied by lower third (subnasale to menton)',\n   147→    profileType: 'front',\n   148→  },\n   149→\n   150→  middleThirdProportion: {\n   151→    id: 'middleThirdProportion',\n   152→    name: 'Middle Third Proportion',\n   153→    category: 'Midface/Face Shape',\n   154→    unit: 'percent',\n   155→    idealMin: 31,\n   156→    idealMax: 34,\n   157→    rangeMin: 24,\n   158→    rangeMax: 42,\n   159→    decayRate: 1.5,\n   160→    maxScore: 10,\n   161→    weight: 0.03,\n   162→    description: 'Percentage of face occupied by middle third',\n   163→    profileType: 'front',\n   164→  },\n   165→\n   166→  upperThirdProportion: {\n   167→    id: 'upperThirdProportion',\n   168→    name: 'Upper Third Proportion',\n   169→    category: 'Midface/Face Shape',\n   170→    unit: 'percent',\n   171→    idealMin: 31,\n   172→    idealMax: 35,\n   173→    rangeMin: 24,\n   174→    rangeMax: 42,\n   175→    decayRate: 1.2,\n   176→    maxScore: 10,\n   177→    weight: 0.02,\n   178→    description: 'Percentage of face occupied by upper third (trichion to glabella)',\n   179→    profileType: 'front',\n   180→  },\n   181→\n   182→  bitemporalWidth: {\n   183→    id: 'bitemporalWidth',\n   184→    name: 'Bitemporal Width',\n   185→    category: 'Midface/Face Shape',\n   186→    unit: 'percent',\n   187→    idealMin: 86.5,\n   188→    idealMax: 92.5,\n   189→    rangeMin: 75,\n   190→    rangeMax: 100,\n   191→    decayRate: 0.8,\n   192→    maxScore: 10,\n   193→    weight: 0.02,\n   194→    description: 'Temple width as percentage of bizygomatic width',\n   195→    profileType: 'front',\n   196→  },\n   197→\n   198→  cheekboneHeight: {\n   199→    id: 'cheekboneHeight',\n   200→    name: 'Cheekbone Height',\n   201→    category: 'Midface/Face Shape',\n   202→    unit: 'percent',\n   203→    idealMin: 83,\n   204→    idealMax: 100,\n   205→    rangeMin: 60,\n   206→    rangeMax: 110,\n   207→    decayRate: 0.5,\n   208→    maxScore: 10,\n   209→    weight: 0.02,\n   210→    description: 'Vertical position of cheekbones relative to face height',\n   211→    profileType: 'front',\n   212→  },\n   213→\n   214→  totalFacialWidthToHeight: {\n   215→    id: 'totalFacialWidthToHeight',\n   216→    name: 'Total Facial Width to Height Ratio',\n   217→    category: 'Midface/Face Shape',\n   218→    unit: 'ratio',\n   219→    idealMin: 1.34,\n   220→    idealMax: 1.37,\n   221→    rangeMin: 1.0,\n   222→    rangeMax: 1.7,\n   223→    decayRate: 13.2,\n   224→    maxScore: 25,  // Special: higher max score\n   225→    weight: 0.05,\n   226→    description: 'Total face height divided by cheek width',\n   227→    profileType: 'front',\n   228→    customCurve: {\n   229→      mode: 'custom',\n   230→      points: [\n   231→        { x: 1.05, y: 0 },\n   232→        { x: 1.17, y: 1.41 },\n   233→        { x: 1.25, y: 3.86 },\n   234→        { x: 1.29, y: 6.01 },\n   235→        { x: 1.32, y: 8.88 },\n   236→        { x: 1.34, y: 10, fixed: true },\n   237→        { x: 1.37, y: 10, fixed: true },\n   238→        { x: 1.39, y: 8.88 },\n   239→        { x: 1.42, y: 6.01 },\n   240→        { x: 1.46, y: 3.86 },\n   241→        { x: 1.54, y: 1.41 },\n   242→        { x: 1.66, y: 0 },\n   243→      ],\n   244→    },\n   245→  },\n   246→\n   247→  midfaceRatio: {\n   248→    id: 'midfaceRatio',\n   249→    name: 'Midface Ratio',\n   250→    category: 'Midface/Face Shape',\n   251→    unit: 'ratio',\n   252→    idealMin: 0.97,\n   253→    idealMax: 1.0,\n   254→    rangeMin: 0.7,\n   255→    rangeMax: 1.3,\n   256→    decayRate: 31.6,\n   257→    maxScore: 10,\n   258→    weight: 0.04,\n   259→    description: 'Midface width to height ratio for facial balance',\n   260→    profileType: 'front',\n   261→  },\n   262→\n   263→  // JAW MEASUREMENTS\n   264→  jawSlope: {\n   265→    id: 'jawSlope',\n   266→    name: 'Jaw Slope',\n   267→    category: 'Jaw Shape',\n   268→    unit: 'degrees',\n   269→    idealMin: 140,\n   270→    idealMax: 142.5,\n   271→    rangeMin: 120,\n   272→    rangeMax: 160,\n   273→    decayRate: 0.8,\n   274→    maxScore: 10,\n   275→    weight: 0.03,\n   276→    description: 'Angle of the jawline from gonion to chin',\n   277→    profileType: 'front',\n   278→  },\n   279→\n   280→  jawFrontalAngle: {\n   281→    id: 'jawFrontalAngle',\n   282→    name: 'Jaw Frontal Angle',\n   283→    category: 'Jaw Shape',\n   284→    unit: 'degrees',\n   285→    idealMin: 86.5,\n   286→    idealMax: 92.5,\n   287→    rangeMin: 70,\n   288→    rangeMax: 110,\n   289→    decayRate: 0.6,\n   290→    maxScore: 10,\n   291→    weight: 0.03,\n   292→    description: 'Angle of jaw corners from frontal view',\n   293→    profileType: 'front',\n   294→  },\n   295→\n   296→  bigonialWidth: {\n   297→    id: 'bigonialWidth',\n   298→    name: 'Bigonial Width',\n   299→    category: 'Jaw Shape',\n   300→    unit: 'percent',\n   301→    idealMin: 75,\n   302→    idealMax: 82,\n   303→    rangeMin: 60,\n   304→    rangeMax: 95,\n   305→    decayRate: 0.9,\n   306→    maxScore: 10,\n   307→    weight: 0.03,\n   308→    description: 'Jaw width as percentage of bizygomatic width',\n   309→    profileType: 'front',\n   310→  },\n   311→\n   312→  jawWidthRatio: {\n   313→    id: 'jawWidthRatio',\n   314→    name: 'Jaw Width to Face Width Ratio',\n   315→    category: 'Jaw Shape',\n   316→    unit: 'ratio',\n   317→    idealMin: 0.75,\n   318→    idealMax: 0.82,\n   319→    rangeMin: 0.6,\n   320→    rangeMax: 0.95,\n   321→    decayRate: 25.0,\n   322→    maxScore: 10,\n   323→    weight: 0.03,\n   324→    description: 'Bigonial width divided by bizygomatic width',\n   325→    profileType: 'front',\n   326→  },\n   327→\n   328→  // EYE MEASUREMENTS\n   329→  lateralCanthalTilt: {\n   330→    id: 'lateralCanthalTilt',\n   331→    name: 'Lateral Canthal Tilt',\n   332→    category: 'Eyes',\n   333→    unit: 'degrees',\n   334→    idealMin: 4,\n   335→    idealMax: 8,\n   336→    rangeMin: -5,\n   337→    rangeMax: 15,\n   338→    decayRate: 2.5,\n   339→    maxScore: 10,\n   340→    weight: 0.04,\n   341→    description: 'Angle of eye from inner to outer canthus',\n   342→    profileType: 'front',\n   343→  },\n   344→\n   345→  eyeAspectRatio: {\n   346→    id: 'eyeAspectRatio',\n   347→    name: 'Eye Aspect Ratio',\n   348→    category: 'Eyes',\n   349→    unit: 'ratio',\n   350→    idealMin: 0.28,\n   351→    idealMax: 0.32,\n   352→    rangeMin: 0.2,\n   353→    rangeMax: 0.45,\n   354→    decayRate: 40.0,\n   355→    maxScore: 10,\n   356→    weight: 0.03,\n   357→    description: 'Eye height divided by eye width',\n   358→    profileType: 'front',\n   359→  },\n   360→\n   361→  eyeSeparationRatio: {\n   362→    id: 'eyeSeparationRatio',\n   363→    name: 'Eye Separation Ratio',\n   364→    category: 'Eyes',\n   365→    unit: 'ratio',\n   366→    idealMin: 0.28,\n   367→    idealMax: 0.32,\n   368→    rangeMin: 0.22,\n   369→    rangeMax: 0.38,\n   370→    decayRate: 35.0,\n   371→    maxScore: 10,\n   372→    weight: 0.03,\n   373→    description: 'Intercanthal distance divided by bizygomatic width',\n   374→    profileType: 'front',\n   375→  },\n   376→\n   377→  interpupillaryRatio: {\n   378→    id: 'interpupillaryRatio',\n   379→    name: 'Interpupillary Distance Ratio',\n   380→    category: 'Eyes',\n   381→    unit: 'percent',\n   382→    idealMin: 44,\n   383→    idealMax: 48,\n   384→    rangeMin: 38,\n   385→    rangeMax: 54,\n   386→    decayRate: 1.8,\n   387→    maxScore: 10,\n   388→    weight: 0.02,\n   389→    description: 'IPD as percentage of bizygomatic width',\n   390→    profileType: 'front',\n   391→  },\n   392→\n   393→  interpupillaryMouthWidthRatio: {\n   394→    id: 'interpupillaryMouthWidthRatio',\n   395→    name: 'Interpupillary-Mouth Width Ratio',\n   396→    category: 'Eyes',\n   397→    unit: 'ratio',\n   398→    idealMin: 0.8,\n   399→    idealMax: 0.9,\n   400→    rangeMin: 0.6,\n   401→    rangeMax: 1.1,\n   402→    decayRate: 12.0,\n   403→    maxScore: 10,\n   404→    weight: 0.02,\n   405→    description: 'Mouth width divided by interpupillary distance',\n   406→    profileType: 'front',\n   407→  },\n   408→\n   409→  oneEyeApartTest: {\n   410→    id: 'oneEyeApartTest',\n   411→    name: 'One Eye Apart Test',\n   412→    category: 'Eyes',\n   413→    unit: 'ratio',\n   414→    idealMin: 0.95,\n   415→    idealMax: 1.05,\n   416→    rangeMin: 0.7,\n   417→    rangeMax: 1.3,\n   418→    decayRate: 20.0,\n   419→    maxScore: 10,\n   420→    weight: 0.02,\n   421→    description: 'Intercanthal distance should equal one eye width',\n   422→    profileType: 'front',\n   423→  },\n   424→\n   425→  // EYEBROW MEASUREMENTS\n   426→  browLengthRatio: {\n   427→    id: 'browLengthRatio',\n   428→    name: 'Brow Length to Face Width Ratio',\n   429→    category: 'Upper Third',\n   430→    unit: 'percent',\n   431→    idealMin: 28,\n   432→    idealMax: 32,\n   433→    rangeMin: 20,\n   434→    rangeMax: 40,\n   435→    decayRate: 1.5,\n   436→    maxScore: 10,\n   437→    weight: 0.02,\n   438→    description: 'Eyebrow length as percentage of face width',\n   439→    profileType: 'front',\n   440→  },\n   441→\n   442→  eyebrowTilt: {\n   443→    id: 'eyebrowTilt',\n   444→    name: 'Eyebrow Tilt',\n   445→    category: 'Upper Third',\n   446→    unit: 'degrees',\n   447→    idealMin: 8,\n   448→    idealMax: 15,\n   449→    rangeMin: 0,\n   450→    rangeMax: 25,\n   451→    decayRate: 1.2,\n   452→    maxScore: 10,\n   453→    weight: 0.02,\n   454→    description: 'Angle of eyebrow from head to tail',\n   455→    profileType: 'front',\n   456→  },\n   457→\n   458→  eyebrowLowSetedness: {\n   459→    id: 'eyebrowLowSetedness',\n   460→    name: 'Eyebrow Low Setedness',\n   461→    category: 'Upper Third',\n   462→    unit: 'ratio',\n   463→    idealMin: 0.18,\n   464→    idealMax: 0.24,\n   465→    rangeMin: 0.1,\n   466→    rangeMax: 0.35,\n   467→    decayRate: 30.0,\n   468→    maxScore: 10,\n   469→    weight: 0.02,\n   470→    description: 'Distance from brow to eye relative to eye height',\n   471→    profileType: 'front',\n   472→  },\n   473→\n   474→  // NOSE MEASUREMENTS (FRONT)\n   475→  nasalIndex: {\n   476→    id: 'nasalIndex',\n   477→    name: 'Nasal Index',\n   478→    category: 'Nose',\n   479→    unit: 'percent',\n   480→    idealMin: 70,\n   481→    idealMax: 85,\n   482→    rangeMin: 55,\n   483→    rangeMax: 100,\n   484→    decayRate: 0.5,\n   485→    maxScore: 10,\n   486→    weight: 0.02,\n   487→    description: 'Nose width divided by nose height × 100',\n   488→    profileType: 'front',\n   489→  },\n   490→\n   491→  intercanthalNasalRatio: {\n   492→    id: 'intercanthalNasalRatio',\n   493→    name: 'Intercanthal-Nasal Width Ratio',\n   494→    category: 'Nose',\n   495→    unit: 'ratio',\n   496→    idealMin: 1.0,\n   497→    idealMax: 1.2,\n   498→    rangeMin: 0.7,\n   499→    rangeMax: 1.5,\n   500→    decayRate: 12.0,\n   501→    maxScore: 10,\n   502→    weight: 0.02,\n   503→    description: 'Alar width should roughly equal intercanthal distance',\n   504→    profileType: 'front',\n   505→  },\n   506→\n   507→  noseBridgeWidth: {\n   508→    id: 'noseBridgeWidth',\n   509→    name: 'Nose Bridge to Nose Width',\n   510→    category: 'Nose',\n   511→    unit: 'ratio',\n   512→    idealMin: 0.6,\n   513→    idealMax: 0.75,\n   514→    rangeMin: 0.4,\n   515→    rangeMax: 0.9,\n   516→    decayRate: 15.0,\n   517→    maxScore: 10,\n   518→    weight: 0.01,\n   519→    description: 'Ratio of nose bridge width to alar base width',\n   520→    profileType: 'front',\n   521→  },\n   522→\n   523→  noseTipPosition: {\n   524→    id: 'noseTipPosition',\n   525→    name: 'Nose Tip Position',\n   526→    category: 'Nose',\n   527→    unit: 'ratio',\n   528→    idealMin: 0.48,\n   529→    idealMax: 0.52,\n   530→    rangeMin: 0.4,\n   531→    rangeMax: 0.6,\n   532→    decayRate: 25.0,\n   533→    maxScore: 10,\n   534→    weight: 0.01,\n   535→    description: 'Nose tip position relative to face centerline',\n   536→    profileType: 'front',\n   537→  },\n   538→\n   539→  // MOUTH/LIP MEASUREMENTS\n   540→  mouthWidthToNoseRatio: {\n   541→    id: 'mouthWidthToNoseRatio',\n   542→    name: 'Mouth Width to Nose Width Ratio',\n   543→    category: 'Lips',\n   544→    unit: 'ratio',\n   545→    idealMin: 1.44,\n   546→    idealMax: 1.52,\n   547→    rangeMin: 1.2,\n   548→    rangeMax: 1.8,\n   549→    decayRate: 18.0,\n   550→    maxScore: 10,\n   551→    weight: 0.03,\n   552→    description: 'Mouth width divided by nose width',\n   553→    profileType: 'front',\n   554→  },\n   555→\n   556→  lowerToUpperLipRatio: {\n   557→    id: 'lowerToUpperLipRatio',\n   558→    name: 'Lower Lip to Upper Lip Ratio',\n   559→    category: 'Lips',\n   560→    unit: 'ratio',\n   561→    idealMin: 1.4,\n   562→    idealMax: 1.8,\n   563→    rangeMin: 1.0,\n   564→    rangeMax: 2.5,\n   565→    decayRate: 8.0,\n   566→    maxScore: 10,\n   567→    weight: 0.02,\n   568→    description: 'Lower lip height divided by upper lip height',\n   569→    profileType: 'front',\n   570→  },\n   571→\n   572→  cupidsBowDepth: {\n   573→    id: 'cupidsBowDepth',\n   574→    name: \"Cupid's Bow Depth\",\n   575→    category: 'Lips',\n   576→    unit: 'mm',\n   577→    idealMin: 2,\n   578→    idealMax: 4,\n   579→    rangeMin: 0,\n   580→    rangeMax: 7,\n   581→    decayRate: 2.0,\n   582→    maxScore: 10,\n   583→    weight: 0.01,\n   584→    description: \"Depth of the cupid's bow curve\",\n   585→    profileType: 'front',\n   586→  },\n   587→\n   588→  mouthCornerPosition: {\n   589→    id: 'mouthCornerPosition',\n   590→    name: 'Mouth Corner Position',\n   591→    category: 'Lips',\n   592→    unit: 'ratio',\n   593→    idealMin: -0.02,\n   594→    idealMax: 0.02,\n   595→    rangeMin: -0.1,\n   596→    rangeMax: 0.1,\n   597→    decayRate: 50.0,\n   598→    maxScore: 10,\n   599→    weight: 0.01,\n   600→    description: 'Mouth corner vertical position relative to lip center',\n   601→    profileType: 'front',\n   602→  },\n   603→\n   604→  // CHIN MEASUREMENTS (FRONT)\n   605→  chinToPhiltrumRatio: {\n   606→    id: 'chinToPhiltrumRatio',\n   607→    name: 'Chin to Philtrum Ratio',\n   608→    category: 'Chin',\n   609→    unit: 'ratio',\n   610→    idealMin: 1.8,\n   611→    idealMax: 2.2,\n   612→    rangeMin: 1.3,\n   613→    rangeMax: 2.8,\n   614→    decayRate: 10.0,\n   615→    maxScore: 10,\n   616→    weight: 0.02,\n   617→    description: 'Chin height divided by philtrum length',\n   618→    profileType: 'front',\n   619→  },\n   620→\n   621→  // OTHER FRONT MEASUREMENTS\n   622→  iaaJfaDeviation: {\n   623→    id: 'iaaJfaDeviation',\n   624→    name: 'Deviation of IAA & JFA',\n   625→    category: 'Jaw Shape',\n   626→    unit: 'degrees',\n   627→    idealMin: -3,\n   628→    idealMax: 3,\n   629→    rangeMin: -15,\n   630→    rangeMax: 15,\n   631→    decayRate: 1.5,\n   632→    maxScore: 10,\n   633→    weight: 0.02,\n   634→    description: 'Deviation between Ipsilateral Alar Angle and Jaw Frontal Angle',\n   635→    profileType: 'front',\n   636→  },\n   637→\n   638→  neckWidth: {\n   639→    id: 'neckWidth',\n   640→    name: 'Neck Width',\n   641→    category: 'Neck',\n   642→    unit: 'percent',\n   643→    idealMin: 70,\n   644→    idealMax: 85,\n   645→    rangeMin: 55,\n   646→    rangeMax: 100,\n   647→    decayRate: 0.6,\n   648→    maxScore: 10,\n   649→    weight: 0.01,\n   650→    description: 'Neck width as percentage of jaw width',\n   651→    profileType: 'front',\n   652→  },\n   653→\n   654→  // ==========================================\n   655→  // SIDE PROFILE MEASUREMENTS (38)\n   656→  // ==========================================\n   657→\n   658→  gonialAngle: {\n   659→    id: 'gonialAngle',\n   660→    name: 'Gonial Angle',\n   661→    category: 'Occlusion/Jaw Growth',\n   662→    unit: 'degrees',\n   663→    idealMin: 120,\n   664→    idealMax: 130,\n   665→    rangeMin: 105,\n   666→    rangeMax: 145,\n   667→    decayRate: 0.8,\n   668→    maxScore: 10,\n   669→    weight: 0.04,\n   670→    description: 'Angle at the jaw corner (gonion)',\n   671→    profileType: 'side',\n   672→  },\n   673→\n   674→  nasolabialAngle: {\n   675→    id: 'nasolabialAngle',\n   676→    name: 'Nasolabial Angle',\n   677→    category: 'Nose',\n   678→    unit: 'degrees',\n   679→    idealMin: 90,\n   680→    idealMax: 105,\n   681→    rangeMin: 75,\n   682→    rangeMax: 120,\n   683→    decayRate: 0.6,\n   684→    maxScore: 10,\n   685→    weight: 0.03,\n   686→    description: 'Angle between columella and upper lip',\n   687→    profileType: 'side',\n   688→  },\n   689→\n   690→  nasofrontalAngle: {\n   691→    id: 'nasofrontalAngle',\n   692→    name: 'Nasofrontal Angle',\n   693→    category: 'Nose',\n   694→    unit: 'degrees',\n   695→    idealMin: 115,\n   696→    idealMax: 135,\n   697→    rangeMin: 100,\n   698→    rangeMax: 150,\n   699→    decayRate: 0.5,\n   700→    maxScore: 10,\n   701→    weight: 0.02,\n   702→    description: 'Angle at the bridge of nose (nasion)',\n   703→    profileType: 'side',\n   704→  },\n   705→\n   706→  nasofacialAngle: {\n   707→    id: 'nasofacialAngle',\n   708→    name: 'Nasofacial Angle',\n   709→    category: 'Nose',\n   710→    unit: 'degrees',\n   711→    idealMin: 30,\n   712→    idealMax: 40,\n   713→    rangeMin: 20,\n   714→    rangeMax: 50,\n   715→    decayRate: 1.2,\n   716→    maxScore: 10,\n   717→    weight: 0.02,\n   718→    description: 'Angle between nose and face plane',\n   719→    profileType: 'side',\n   720→  },\n   721→\n   722→  nasomentaAngle: {\n   723→    id: 'nasomentaAngle',\n   724→    name: 'Nasomental Angle',\n   725→    category: 'Nose',\n   726→    unit: 'degrees',\n   727→    idealMin: 120,\n   728→    idealMax: 132,\n   729→    rangeMin: 105,\n   730→    rangeMax: 145,\n   731→    decayRate: 0.7,\n   732→    maxScore: 10,\n   733→    weight: 0.02,\n   734→    description: 'Angle from nasion to nose tip to chin',\n   735→    profileType: 'side',\n   736→  },\n   737→\n   738→  nasalTipAngle: {\n   739→    id: 'nasalTipAngle',\n   740→    name: 'Nasal Tip Angle',\n   741→    category: 'Nose',\n   742→    unit: 'degrees',\n   743→    idealMin: 85,\n   744→    idealMax: 105,\n   745→    rangeMin: 70,\n   746→    rangeMax: 120,\n   747→    decayRate: 0.8,\n   748→    maxScore: 10,\n   749→    weight: 0.02,\n   750→    description: 'Angle of the nose tip',\n   751→    profileType: 'side',\n   752→  },\n   753→\n   754→  nasalProjection: {\n   755→    id: 'nasalProjection',\n   756→    name: 'Nasal Projection',\n   757→    category: 'Nose',\n   758→    unit: 'ratio',\n   759→    idealMin: 0.55,\n   760→    idealMax: 0.6,\n   761→    rangeMin: 0.4,\n   762→    rangeMax: 0.75,\n   763→    decayRate: 20.0,\n   764→    maxScore: 10,\n   765→    weight: 0.02,\n   766→    description: 'Nose projection relative to nasal length (Goode ratio)',\n   767→    profileType: 'side',\n   768→  },\n   769→\n   770→  nasalWToHRatio: {\n   771→    id: 'nasalWToHRatio',\n   772→    name: 'Nasal W to H Ratio',\n   773→    category: 'Nose',\n   774→    unit: 'ratio',\n   775→    idealMin: 0.67,\n   776→    idealMax: 0.78,\n   777→    rangeMin: 0.5,\n   778→    rangeMax: 0.95,\n   779→    decayRate: 15.0,\n   780→    maxScore: 10,\n   781→    weight: 0.01,\n   782→    description: 'Nose width to height ratio from side view',\n   783→    profileType: 'side',\n   784→  },\n   785→\n   786→  noseTipRotationAngle: {\n   787→    id: 'noseTipRotationAngle',\n   788→    name: 'Nose Tip Rotation Angle',\n   789→    category: 'Nose',\n   790→    unit: 'degrees',\n   791→    idealMin: 95,\n   792→    idealMax: 110,\n   793→    rangeMin: 80,\n   794→    rangeMax: 125,\n   795→    decayRate: 0.8,\n   796→    maxScore: 10,\n   797→    weight: 0.01,\n   798→    description: 'Angle of nose tip rotation',\n   799→    profileType: 'side',\n   800→  },\n   801→\n   802→  frankfortTipAngle: {\n   803→    id: 'frankfortTipAngle',\n   804→    name: 'Frankfort-Tip Angle',\n   805→    category: 'Nose',\n   806→    unit: 'degrees',\n   807→    idealMin: 28,\n   808→    idealMax: 34,\n   809→    rangeMin: 20,\n   810→    rangeMax: 42,\n   811→    decayRate: 1.0,\n   812→    maxScore: 10,\n   813→    weight: 0.01,\n   814→    description: 'Angle between Frankfort plane and nose tip',\n   815→    profileType: 'side',\n   816→  },\n   817→\n   818→  mentolabialAngle: {\n   819→    id: 'mentolabialAngle',\n   820→    name: 'Mentolabial Angle',\n   821→    category: 'Lips',\n   822→    unit: 'degrees',\n   823→    idealMin: 120,\n   824→    idealMax: 140,\n   825→    rangeMin: 100,\n   826→    rangeMax: 160,\n   827→    decayRate: 0.5,\n   828→    maxScore: 10,\n   829→    weight: 0.02,\n   830→    description: 'Angle at the labiomental fold',\n   831→    profileType: 'side',\n   832→  },\n   833→\n   834→  zAngle: {\n   835→    id: 'zAngle',\n   836→    name: 'Z Angle',\n   837→    category: 'Occlusion/Jaw Growth',\n   838→    unit: 'degrees',\n   839→    idealMin: 75,\n   840→    idealMax: 85,\n   841→    rangeMin: 60,\n   842→    rangeMax: 100,\n   843→    decayRate: 0.8,\n   844→    maxScore: 10,\n   845→    weight: 0.02,\n   846→    description: 'Merrifield Z-Angle for profile assessment',\n   847→    profileType: 'side',\n   848→  },\n   849→\n   850→  submentalCervicalAngle: {\n   851→    id: 'submentalCervicalAngle',\n   852→    name: 'Submental Cervical Angle',\n   853→    category: 'Neck',\n   854→    unit: 'degrees',\n   855→    idealMin: 105,\n   856→    idealMax: 120,\n   857→    rangeMin: 90,\n   858→    rangeMax: 140,\n   859→    decayRate: 0.6,\n   860→    maxScore: 10,\n   861→    weight: 0.02,\n   862→    description: 'Angle between chin and neck',\n   863→    profileType: 'side',\n   864→  },\n   865→\n   866→  facialConvexityGlabella: {\n   867→    id: 'facialConvexityGlabella',\n   868→    name: 'Facial Convexity (Glabella)',\n   869→    category: 'Midface/Face Shape',\n   870→    unit: 'degrees',\n   871→    idealMin: 165,\n   872→    idealMax: 175,\n   873→    rangeMin: 150,\n   874→    rangeMax: 185,\n   875→    decayRate: 0.4,\n   876→    maxScore: 10,\n   877→    weight: 0.03,\n   878→    description: 'Facial convexity angle using glabella',\n   879→    profileType: 'side',\n   880→  },\n   881→\n   882→  facialConvexityNasion: {\n   883→    id: 'facialConvexityNasion',\n   884→    name: 'Facial Convexity (Nasion)',\n   885→    category: 'Midface/Face Shape',\n   886→    unit: 'degrees',\n   887→    idealMin: 168,\n   888→    idealMax: 178,\n   889→    rangeMin: 155,\n   890→    rangeMax: 190,\n   891→    decayRate: 0.4,\n   892→    maxScore: 10,\n   893→    weight: 0.02,\n   894→    description: 'Facial convexity angle using nasion',\n   895→    profileType: 'side',\n   896→  },\n   897→\n   898→  totalFacialConvexity: {\n   899→    id: 'totalFacialConvexity',\n   900→    name: 'Total Facial Convexity',\n   901→    category: 'Midface/Face Shape',\n   902→    unit: 'degrees',\n   903→    idealMin: 135,\n   904→    idealMax: 145,\n   905→    rangeMin: 120,\n   906→    rangeMax: 160,\n   907→    decayRate: 0.5,\n   908→    maxScore: 10,\n   909→    weight: 0.03,\n   910→    description: 'Complete facial profile convexity measurement',\n   911→    profileType: 'side',\n   912→  },\n   913→\n   914→  facialDepthToHeight: {\n   915→    id: 'facialDepthToHeight',\n   916→    name: 'Facial Depth to Height Ratio',\n   917→    category: 'Midface/Face Shape',\n   918→    unit: 'ratio',\n   919→    idealMin: 0.85,\n   920→    idealMax: 0.95,\n   921→    rangeMin: 0.7,\n   922→    rangeMax: 1.1,\n   923→    decayRate: 15.0,\n   924→    maxScore: 10,\n   925→    weight: 0.02,\n   926→    description: 'Facial depth divided by facial height',\n   927→    profileType: 'side',\n   928→  },\n   929→\n   930→  anteriorFacialDepth: {\n   931→    id: 'anteriorFacialDepth',\n   932→    name: 'Anterior Facial Depth',\n   933→    category: 'Midface/Face Shape',\n   934→    unit: 'mm',\n   935→    idealMin: 85,\n   936→    idealMax: 100,\n   937→    rangeMin: 70,\n   938→    rangeMax: 115,\n   939→    decayRate: 0.3,\n   940→    maxScore: 10,\n   941→    weight: 0.01,\n   942→    description: 'Depth of the anterior face',\n   943→    profileType: 'side',\n   944→  },\n   945→\n   946→  mandibularPlaneAngle: {\n   947→    id: 'mandibularPlaneAngle',\n   948→    name: 'Mandibular Plane Angle',\n   949→    category: 'Occlusion/Jaw Growth',\n   950→    unit: 'degrees',\n   951→    idealMin: 22,\n   952→    idealMax: 28,\n   953→    rangeMin: 15,\n   954→    rangeMax: 38,\n   955→    decayRate: 0.8,\n   956→    maxScore: 10,\n   957→    weight: 0.03,\n   958→    description: 'Angle of mandibular plane to Frankfort plane',\n   959→    profileType: 'side',\n   960→  },\n   961→\n   962→  ramusToMandibleRatio: {\n   963→    id: 'ramusToMandibleRatio',\n   964→    name: 'Ramus to Mandible Ratio',\n   965→    category: 'Occlusion/Jaw Growth',\n   966→    unit: 'ratio',\n   967→    idealMin: 0.65,\n   968→    idealMax: 0.75,\n   969→    rangeMin: 0.5,\n   970→    rangeMax: 0.9,\n   971→    decayRate: 15.0,\n   972→    maxScore: 10,\n   973→    weight: 0.02,\n   974→    description: 'Ramus height divided by mandible length',\n   975→    profileType: 'side',\n   976→  },\n   977→\n   978→  gonionToMouthLine: {\n   979→    id: 'gonionToMouthLine',\n   980→    name: 'Gonion to Mouth Line',\n   981→    category: 'Jaw Shape',\n   982→    unit: 'mm',\n   983→    idealMin: -5,\n   984→    idealMax: 5,\n   985→    rangeMin: -20,\n   986→    rangeMax: 20,\n   987→    decayRate: 0.5,\n   988→    maxScore: 10,\n   989→    weight: 0.02,\n   990→    description: 'Distance from gonion to mouth level line',\n   991→    profileType: 'side',\n   992→  },\n   993→\n   994→  // E-LINE MEASUREMENTS\n   995→  eLineUpperLip: {\n   996→    id: 'eLineUpperLip',\n   997→    name: 'Upper Lip E-Line Position',\n   998→    category: 'Lips',\n   999→    unit: 'mm',\n  1000→    idealMin: -4,\n  1001→    idealMax: -2,\n  1002→    rangeMin: -10,\n  1003→    rangeMax: 4,\n  1004→    decayRate: 1.0,\n  1005→    maxScore: 10,\n  1006→    weight: 0.02,\n  1007→    description: 'Upper lip distance from E-line (Ricketts)',\n  1008→    profileType: 'side',\n  1009→  },\n  1010→\n  1011→  eLineLowerLip: {\n  1012→    id: 'eLineLowerLip',\n  1013→    name: 'Lower Lip E-Line Position',\n  1014→    category: 'Lips',\n  1015→    unit: 'mm',\n  1016→    idealMin: -2,\n  1017→    idealMax: 0,\n  1018→    rangeMin: -8,\n  1019→    rangeMax: 6,\n  1020→    decayRate: 1.0,\n  1021→    maxScore: 10,\n  1022→    weight: 0.02,\n  1023→    description: 'Lower lip distance from E-line (Ricketts)',\n  1024→    profileType: 'side',\n  1025→  },\n  1026→\n  1027→  // S-LINE MEASUREMENTS\n  1028→  sLineUpperLip: {\n  1029→    id: 'sLineUpperLip',\n  1030→    name: 'Upper Lip S-Line Position',\n  1031→    category: 'Lips',\n  1032→    unit: 'mm',\n  1033→    idealMin: 0,\n  1034→    idealMax: 3,\n  1035→    rangeMin: -5,\n  1036→    rangeMax: 8,\n  1037→    decayRate: 1.2,\n  1038→    maxScore: 10,\n  1039→    weight: 0.01,\n  1040→    description: 'Upper lip distance from S-line (Steiner)',\n  1041→    profileType: 'side',\n  1042→  },\n  1043→\n  1044→  sLineLowerLip: {\n  1045→    id: 'sLineLowerLip',\n  1046→    name: 'Lower Lip S-Line Position',\n  1047→    category: 'Lips',\n  1048→    unit: 'mm',\n  1049→    idealMin: 0,\n  1050→    idealMax: 2,\n  1051→    rangeMin: -4,\n  1052→    rangeMax: 6,\n  1053→    decayRate: 1.2,\n  1054→    maxScore: 10,\n  1055→    weight: 0.01,\n  1056→    description: 'Lower lip distance from S-line (Steiner)',\n  1057→    profileType: 'side',\n  1058→  },\n  1059→\n  1060→  // BURSTONE LINE\n  1061→  burstoneUpperLip: {\n  1062→    id: 'burstoneUpperLip',\n  1063→    name: 'Upper Lip Burstone Line',\n  1064→    category: 'Lips',\n  1065→    unit: 'mm',\n  1066→    idealMin: 2,\n  1067→    idealMax: 4,\n  1068→    rangeMin: -2,\n  1069→    rangeMax: 8,\n  1070→    decayRate: 1.0,\n  1071→    maxScore: 10,\n  1072→    weight: 0.01,\n  1073→    description: 'Upper lip to Burstone line distance',\n  1074→    profileType: 'side',\n  1075→  },\n  1076→\n  1077→  burstoneLowerLip: {\n  1078→    id: 'burstoneLowerLip',\n  1079→    name: 'Lower Lip Burstone Line',\n  1080→    category: 'Lips',\n  1081→    unit: 'mm',\n  1082→    idealMin: 1,\n  1083→    idealMax: 3,\n  1084→    rangeMin: -3,\n  1085→    rangeMax: 7,\n  1086→    decayRate: 1.0,\n  1087→    maxScore: 10,\n  1088→    weight: 0.01,\n  1089→    description: 'Lower lip to Burstone line distance',\n  1090→    profileType: 'side',\n  1091→  },\n  1092→\n  1093→  // H LINE\n  1094→  holdawayHLine: {\n  1095→    id: 'holdawayHLine',\n  1096→    name: 'Holdaway H Line',\n  1097→    category: 'Lips',\n  1098→    unit: 'mm',\n  1099→    idealMin: 0,\n  1100→    idealMax: 4,\n  1101→    rangeMin: -5,\n  1102→    rangeMax: 10,\n  1103→    decayRate: 0.8,\n  1104→    maxScore: 10,\n  1105→    weight: 0.01,\n  1106→    description: 'Holdaway H-line soft tissue assessment',\n  1107→    profileType: 'side',\n  1108→  },\n  1109→\n  1110→  // CHIN MEASUREMENTS (SIDE)\n  1111→  chinProjection: {\n  1112→    id: 'chinProjection',\n  1113→    name: 'Chin Projection',\n  1114→    category: 'Chin',\n  1115→    unit: 'mm',\n  1116→    idealMin: -3,\n  1117→    idealMax: 3,\n  1118→    rangeMin: -12,\n  1119→    rangeMax: 12,\n  1120→    decayRate: 0.8,\n  1121→    maxScore: 10,\n  1122→    weight: 0.02,\n  1123→    description: 'Chin projection relative to ideal position',\n  1124→    profileType: 'side',\n  1125→  },\n  1126→\n  1127→  recessionRelativeToFrankfort: {\n  1128→    id: 'recessionRelativeToFrankfort',\n  1129→    name: 'Recession Relative to Frankfort Plane',\n  1130→    category: 'Chin',\n  1131→    unit: 'mm',\n  1132→    idealMin: -2,\n  1133→    idealMax: 2,\n  1134→    rangeMin: -10,\n  1135→    rangeMax: 10,\n  1136→    decayRate: 0.8,\n  1137→    maxScore: 10,\n  1138→    weight: 0.02,\n  1139→    description: 'Chin recession relative to Frankfort horizontal',\n  1140→    profileType: 'side',\n  1141→  },\n  1142→\n  1143→  // FOREHEAD\n  1144→  browridgeInclinationAngle: {\n  1145→    id: 'browridgeInclinationAngle',\n  1146→    name: 'Browridge Inclination Angle',\n  1147→    category: 'Upper Third',\n  1148→    unit: 'degrees',\n  1149→    idealMin: 10,\n  1150→    idealMax: 18,\n  1151→    rangeMin: 0,\n  1152→    rangeMax: 28,\n  1153→    decayRate: 1.0,\n  1154→    maxScore: 10,\n  1155→    weight: 0.02,\n  1156→    description: 'Angle of the brow ridge from profile',\n  1157→    profileType: 'side',\n  1158→  },\n  1159→\n  1160→  upperForeheadSlope: {\n  1161→    id: 'upperForeheadSlope',\n  1162→    name: 'Upper Forehead Slope',\n  1163→    category: 'Upper Third',\n  1164→    unit: 'degrees',\n  1165→    idealMin: 5,\n  1166→    idealMax: 12,\n  1167→    rangeMin: 0,\n  1168→    rangeMax: 20,\n  1169→    decayRate: 1.2,\n  1170→    maxScore: 10,\n  1171→    weight: 0.01,\n  1172→    description: 'Slope angle of the upper forehead',\n  1173→    profileType: 'side',\n  1174→  },\n  1175→\n  1176→  // MIDFACE PROJECTION\n  1177→  midfaceProjectionAngle: {\n  1178→    id: 'midfaceProjectionAngle',\n  1179→    name: 'Interior Midface Projection Angle',\n  1180→    category: 'Midface/Face Shape',\n  1181→    unit: 'degrees',\n  1182→    idealMin: 85,\n  1183→    idealMax: 95,\n  1184→    rangeMin: 75,\n  1185→    rangeMax: 105,\n  1186→    decayRate: 0.8,\n  1187→    maxScore: 10,\n  1188→    weight: 0.02,\n  1189→    description: 'Angle of midface projection from profile',\n  1190→    profileType: 'side',\n  1191→  },\n  1192→\n  1193→  orbitalVector: {\n  1194→    id: 'orbitalVector',\n  1195→    name: 'Orbital Vector',\n  1196→    category: 'Eyes',\n  1197→    unit: 'mm',\n  1198→    idealMin: 0,\n  1199→    idealMax: 4,\n  1200→    rangeMin: -6,\n  1201→    rangeMax: 10,\n  1202→    decayRate: 1.0,\n  1203→    maxScore: 10,\n  1204→    weight: 0.02,\n  1205→    description: 'Relationship of globe to orbital rim',\n  1206→    profileType: 'side',\n  1207→  },\n  1208→\n  1209→  // EAR MEASUREMENTS\n  1210→  earProtrusionAngle: {\n  1211→    id: 'earProtrusionAngle',\n  1212→    name: 'Ear Protrusion Angle',\n  1213→    category: 'Other',\n  1214→    unit: 'degrees',\n  1215→    idealMin: 15,\n  1216→    idealMax: 25,\n  1217→    rangeMin: 5,\n  1218→    rangeMax: 40,\n  1219→    decayRate: 1.0,\n  1220→    maxScore: 10,\n  1221→    weight: 0.01,\n  1222→    description: 'Angle of ear protrusion from head',\n  1223→    profileType: 'front',\n  1224→  },\n  1225→\n  1226→  earProtrusionRatio: {\n  1227→    id: 'earProtrusionRatio',\n  1228→    name: 'Ear Protrusion Ratio',\n  1229→    category: 'Other',\n  1230→    unit: 'percent',\n  1231→    idealMin: 15,\n  1232→    idealMax: 25,\n  1233→    rangeMin: 8,\n  1234→    rangeMax: 40,\n  1235→    decayRate: 1.5,\n  1236→    maxScore: 10,\n  1237→    weight: 0.01,\n  1238→    description: 'Ear protrusion as percentage of ear height',\n  1239→    profileType: 'front',\n  1240→  },\n  1241→};\n  1242→\n  1243→// ============================================\n  1244→// CATEGORY DEFINITIONS\n  1245→// ============================================\n  1246→\n  1247→export const MEASUREMENT_CATEGORIES = {\n  1248→  'Midface/Face Shape': { color: '#67e8f9', weight: 0.20 },\n  1249→  'Occlusion/Jaw Growth': { color: '#a78bfa', weight: 0.15 },\n  1250→  'Jaw Shape': { color: '#f97316', weight: 0.13 },\n  1251→  'Upper Third': { color: '#84cc16', weight: 0.08 },\n  1252→  'Eyes': { color: '#06b6d4', weight: 0.12 },\n  1253→  'Nose': { color: '#fbbf24', weight: 0.10 },\n  1254→  'Lips': { color: '#ec4899', weight: 0.10 },\n  1255→  'Chin': { color: '#ef4444', weight: 0.06 },\n  1256→  'Neck': { color: '#14b8a6', weight: 0.03 },\n  1257→  'Other': { color: '#6b7280', weight: 0.03 },\n  1258→};\n  1259→\n  1260→// ============================================\n  1261→// CORE SCORING FUNCTIONS\n  1262→// ============================================\n  1263→\n  1264→/**\n  1265→ * FaceIQ Exponential Decay Scoring Algorithm\n  1266→ * score = maxScore × e^(-decayRate × deviation)\n  1267→ */\n  1268→export function calculateFaceIQScore(\n  1269→  value: number,\n  1270→  config: MetricConfig\n  1271→): number {\n  1272→  const { idealMin, idealMax, decayRate, maxScore, customCurve } = config;\n  1273→\n  1274→  // Use custom curve if available\n  1275→  if (customCurve && customCurve.mode === 'custom') {\n  1276→    return interpolateCustomCurve(value, customCurve.points, maxScore);\n  1277→  }\n  1278→\n  1279→  // Perfect score within ideal range\n  1280→  if (value >= idealMin && value <= idealMax) {\n  1281→    return maxScore;\n  1282→  }\n  1283→\n  1284→  // Calculate deviation from ideal range\n  1285→  const deviation = value < idealMin\n  1286→    ? idealMin - value\n  1287→    : value - idealMax;\n  1288→\n  1289→  // Exponential decay\n  1290→  const score = maxScore * Math.exp(-decayRate * deviation);\n  1291→\n  1292→  return Math.max(0, Math.min(maxScore, score));\n  1293→}\n  1294→\n  1295→/**\n  1296→ * Interpolate custom Bezier curve for scoring\n  1297→ */\n  1298→function interpolateCustomCurve(\n  1299→  value: number,\n  1300→  points: CurvePoint[],\n  1301→  maxScore: number\n  1302→): number {\n  1303→  if (points.length === 0) return 0;\n  1304→\n  1305→  // Sort points by x value\n  1306→  const sortedPoints = [...points].sort((a, b) => a.x - b.x);\n  1307→\n  1308→  // Find bracketing points\n  1309→  let lowerIndex = 0;\n  1310→  let upperIndex = sortedPoints.length - 1;\n  1311→\n  1312→  for (let i = 0; i < sortedPoints.length - 1; i++) {\n  1313→    if (value >= sortedPoints[i].x && value <= sortedPoints[i + 1].x) {\n  1314→      lowerIndex = i;\n  1315→      upperIndex = i + 1;\n  1316→      break;\n  1317→    }\n  1318→  }\n  1319→\n  1320→  // Clamp to range\n  1321→  if (value <= sortedPoints[0].x) return sortedPoints[0].y;\n  1322→  if (value >= sortedPoints[sortedPoints.length - 1].x) {\n  1323→    return sortedPoints[sortedPoints.length - 1].y;\n  1324→  }\n  1325→\n  1326→  // Linear interpolation between points\n  1327→  const lower = sortedPoints[lowerIndex];\n  1328→  const upper = sortedPoints[upperIndex];\n  1329→  const t = (value - lower.x) / (upper.x - lower.x);\n  1330→\n  1331→  return lower.y + t * (upper.y - lower.y);\n  1332→}\n  1333→\n  1334→/**\n  1335→ * Calculate standardized score (0-10 normalized)\n  1336→ */\n  1337→export function standardizeScore(score: number, maxScore: number): number {\n  1338→  return (score / maxScore) * 10;\n  1339→}\n  1340→\n  1341→/**\n  1342→ * Determine quality tier based on score\n  1343→ */\n  1344→export function getQualityTier(score: number, maxScore: number = 10): QualityTier {\n  1345→  const normalized = (score / maxScore) * 100;\n  1346→\n  1347→  if (normalized >= 90) return 'ideal';\n  1348→  if (normalized >= 70) return 'excellent';\n  1349→  if (normalized >= 50) return 'good';\n  1350→  return 'below_average';\n  1351→}\n  1352→\n  1353→/**\n  1354→ * Determine severity level based on score\n  1355→ */\n  1356→export function getSeverityLevel(score: number, maxScore: number = 10): SeverityLevel {\n  1357→  const normalized = (score / maxScore) * 100;\n  1358→\n  1359→  if (normalized >= 85) return 'optimal';\n  1360→  if (normalized >= 70) return 'minor';\n  1361→  if (normalized >= 50) return 'moderate';\n  1362→  if (normalized >= 30) return 'major';\n  1363→  if (normalized >= 15) return 'severe';\n  1364→  return 'extremely_severe';\n  1365→}\n  1366→\n  1367→/**\n  1368→ * Calculate deviation description\n  1369→ */\n  1370→export function getDeviationDescription(\n  1371→  value: number,\n  1372→  idealMin: number,\n  1373→  idealMax: number,\n  1374→  unit: MeasurementUnit\n  1375→): { deviation: number; direction: 'above' | 'below' | 'within'; description: string } {\n  1376→  if (value >= idealMin && value <= idealMax) {\n  1377→    return { deviation: 0, direction: 'within', description: 'within ideal range' };\n  1378→  }\n  1379→\n  1380→  const unitLabel = getUnitLabel(unit);\n  1381→\n  1382→  if (value < idealMin) {\n  1383→    const dev = idealMin - value;\n  1384→    return {\n  1385→      deviation: dev,\n  1386→      direction: 'below',\n  1387→      description: `${dev.toFixed(2)}${unitLabel} below ideal`,\n  1388→    };\n  1389→  }\n  1390→\n  1391→  const dev = value - idealMax;\n  1392→  return {\n  1393→    deviation: dev,\n  1394→    direction: 'above',\n  1395→    description: `${dev.toFixed(2)}${unitLabel} above ideal`,\n  1396→  };\n  1397→}\n  1398→\n  1399→function getUnitLabel(unit: MeasurementUnit): string {\n  1400→  switch (unit) {\n  1401→    case 'ratio': return 'x';\n  1402→    case 'percent': return '%';\n  1403→    case 'degrees': return '°';\n  1404→    case 'mm': return 'mm';\n  1405→    default: return '';\n  1406→  }\n  1407→}\n  1408→\n  1409→// ============================================\n  1410→// MEASUREMENT CALCULATION UTILITIES\n  1411→// ============================================\n  1412→\n  1413→/**\n  1414→ * Calculate distance between two points\n  1415→ */\n  1416→export function distance(p1: Point, p2: Point): number {\n  1417→  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n  1418→}\n  1419→\n  1420→/**\n  1421→ * Calculate angle at vertex point (in degrees)\n  1422→ */\n  1423→export function calculateAngle(p1: Point, vertex: Point, p2: Point): number {\n  1424→  const v1 = { x: p1.x - vertex.x, y: p1.y - vertex.y };\n  1425→  const v2 = { x: p2.x - vertex.x, y: p2.y - vertex.y };\n  1426→\n  1427→  const dot = v1.x * v2.x + v1.y * v2.y;\n  1428→  const cross = v1.x * v2.y - v1.y * v2.x;\n  1429→\n  1430→  const angle = Math.atan2(cross, dot) * (180 / Math.PI);\n  1431→  return Math.abs(angle);\n  1432→}\n  1433→\n  1434→/**\n  1435→ * Calculate perpendicular distance from point to line (signed)\n  1436→ */\n  1437→export function perpendicularDistance(\n  1438→  point: Point,\n  1439→  lineStart: Point,\n  1440→  lineEnd: Point\n  1441→): number {\n  1442→  const A = point.x - lineStart.x;\n  1443→  const B = point.y - lineStart.y;\n  1444→  const C = lineEnd.x - lineStart.x;\n  1445→  const D = lineEnd.y - lineStart.y;\n  1446→\n  1447→  const dot = A * C + B * D;\n  1448→  const lenSq = C * C + D * D;\n  1449→  const param = lenSq !== 0 ? dot / lenSq : -1;\n  1450→\n  1451→  let xx: number, yy: number;\n  1452→\n  1453→  if (param < 0) {\n  1454→    xx = lineStart.x;\n  1455→    yy = lineStart.y;\n  1456→  } else if (param > 1) {\n  1457→    xx = lineEnd.x;\n  1458→    yy = lineEnd.y;\n  1459→  } else {\n  1460→    xx = lineStart.x + param * C;\n  1461→    yy = lineStart.y + param * D;\n  1462→  }\n  1463→\n  1464→  const dx = point.x - xx;\n  1465→  const dy = point.y - yy;\n  1466→\n  1467→  const sign =\n  1468→    (lineEnd.y - lineStart.y) * point.x -\n  1469→      (lineEnd.x - lineStart.x) * point.y +\n  1470→      lineEnd.x * lineStart.y -\n  1471→      lineEnd.y * lineStart.x >=\n  1472→    0\n  1473→      ? 1\n  1474→      : -1;\n  1475→\n  1476→  return sign * Math.sqrt(dx * dx + dy * dy);\n  1477→}\n  1478→\n  1479→/**\n  1480→ * Helper to get landmark by ID\n  1481→ */\n  1482→function getLandmark(landmarks: LandmarkPoint[], id: string): Point | null {\n  1483→  const lm = landmarks.find((l) => l.id === id);\n  1484→  return lm ? { x: lm.x, y: lm.y } : null;\n  1485→}\n  1486→\n  1487→// ============================================\n  1488→// SCORE A SINGLE MEASUREMENT\n  1489→// ============================================\n  1490→\n  1491→/**\n  1492→ * Calculate complete score result for a measurement\n  1493→ */\n  1494→export function scoreMeasurement(\n  1495→  metricId: string,\n  1496→  value: number\n  1497→): FaceIQScoreResult | null {\n  1498→  const config = FACEIQ_METRICS[metricId];\n  1499→  if (!config) return null;\n  1500→\n  1501→  const score = calculateFaceIQScore(value, config);\n  1502→  const standardizedScore = standardizeScore(score, config.maxScore);\n  1503→  const qualityTier = getQualityTier(score, config.maxScore);\n  1504→  const severity = getSeverityLevel(score, config.maxScore);\n  1505→  const { deviation, direction, description } = getDeviationDescription(\n  1506→    value,\n  1507→    config.idealMin,\n  1508→    config.idealMax,\n  1509→    config.unit\n  1510→  );\n  1511→\n  1512→  return {\n  1513→    metricId,\n  1514→    name: config.name,\n  1515→    value,\n  1516→    score,\n  1517→    standardizedScore,\n  1518→    qualityTier,\n  1519→    severity,\n  1520→    idealMin: config.idealMin,\n  1521→    idealMax: config.idealMax,\n  1522→    deviation,\n  1523→    deviationDirection: direction,\n  1524→    unit: config.unit,\n  1525→    category: config.category,\n  1526→  };\n  1527→}\n  1528→\n  1529→// ============================================\n  1530→// FRONT PROFILE ANALYSIS\n  1531→// ============================================\n  1532→\n  1533→export interface FrontProfileResults {\n  1534→  measurements: FaceIQScoreResult[];\n  1535→  overallScore: number;\n  1536→  standardizedScore: number;\n  1537→  qualityTier: QualityTier;\n  1538→  categoryScores: Record<string, number>;\n  1539→}\n  1540→\n  1541→/**\n  1542→ * Calculate all front profile measurements from landmarks\n  1543→ */\n  1544→export function analyzeFrontProfile(\n  1545→  landmarks: LandmarkPoint[],\n  1546→  gender: 'male' | 'female' = 'male'\n  1547→): FrontProfileResults {\n  1548→  const measurements: FaceIQScoreResult[] = [];\n  1549→\n  1550→  // Helper to add measurement if landmarks available\n  1551→  const addMeasurement = (metricId: string, value: number | null) => {\n  1552→    if (value !== null) {\n  1553→      const result = scoreMeasurement(metricId, value);\n  1554→      if (result) measurements.push(result);\n  1555→    }\n  1556→  };\n  1557→\n  1558→  // Get key landmarks\n  1559→  const trichion = getLandmark(landmarks, 'trichion');\n  1560→  const nasalBase = getLandmark(landmarks, 'nasal_base');\n  1561→  const subnasale = getLandmark(landmarks, 'subnasale');\n  1562→  const menton = getLandmark(landmarks, 'menton');\n  1563→  const leftZygion = getLandmark(landmarks, 'left_zygion');\n  1564→  const rightZygion = getLandmark(landmarks, 'right_zygion');\n  1565→  const leftGonion = getLandmark(landmarks, 'left_gonion_inferior');\n  1566→  const rightGonion = getLandmark(landmarks, 'right_gonion_inferior');\n  1567→  const leftPupil = getLandmark(landmarks, 'left_pupila');\n  1568→  const rightPupil = getLandmark(landmarks, 'right_pupila');\n  1569→  const leftCanthusM = getLandmark(landmarks, 'left_canthus_medialis');\n  1570→  const leftCanthusL = getLandmark(landmarks, 'left_canthus_lateralis');\n  1571→  const rightCanthusM = getLandmark(landmarks, 'right_canthus_medialis');\n  1572→  const rightCanthusL = getLandmark(landmarks, 'right_canthus_lateralis');\n  1573→  const leftAlaNasi = getLandmark(landmarks, 'left_ala_nasi');\n  1574→  const rightAlaNasi = getLandmark(landmarks, 'right_ala_nasi');\n  1575→  const leftCheilion = getLandmark(landmarks, 'left_cheilion');\n  1576→  const rightCheilion = getLandmark(landmarks, 'right_cheilion');\n  1577→  const labraleSuperius = getLandmark(landmarks, 'labrale_superius');\n  1578→  const labraleInferius = getLandmark(landmarks, 'labrale_inferius');\n  1579→\n  1580→  // FACIAL THIRDS\n  1581→  if (trichion && nasalBase && subnasale && menton) {\n  1582→    const totalHeight = distance(trichion, menton);\n  1583→    if (totalHeight > 0) {\n  1584→      const upperThird = (distance(trichion, nasalBase) / totalHeight) * 100;\n  1585→      const middleThird = (distance(nasalBase, subnasale) / totalHeight) * 100;\n  1586→      const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n  1587→\n  1588→      addMeasurement('upperThirdProportion', upperThird);\n  1589→      addMeasurement('middleThirdProportion', middleThird);\n  1590→      addMeasurement('lowerThirdProportion', lowerThird);\n  1591→    }\n  1592→  }\n  1593→\n  1594→  // FACE WIDTH TO HEIGHT RATIO (FWHR)\n  1595→  if (leftZygion && rightZygion && nasalBase && labraleSuperius) {\n  1596→    const bizygomaticWidth = distance(leftZygion, rightZygion);\n  1597→    const upperFaceHeight = distance(nasalBase, labraleSuperius);\n  1598→    if (upperFaceHeight > 0) {\n  1599→      addMeasurement('faceWidthToHeight', bizygomaticWidth / upperFaceHeight);\n  1600→    }\n  1601→  }\n  1602→\n  1603→  // TOTAL FACIAL WIDTH TO HEIGHT\n  1604→  if (leftZygion && rightZygion && trichion && menton) {\n  1605→    const cheekWidth = distance(leftZygion, rightZygion);\n  1606→    const totalHeight = distance(trichion, menton);\n  1607→    if (cheekWidth > 0) {\n  1608→      addMeasurement('totalFacialWidthToHeight', totalHeight / cheekWidth);\n  1609→    }\n  1610→  }\n  1611→\n  1612→  // JAW WIDTH RATIO\n  1613→  if (leftGonion && rightGonion && leftZygion && rightZygion) {\n  1614→    const bigonialWidth = distance(leftGonion, rightGonion);\n  1615→    const bizygomaticWidth = distance(leftZygion, rightZygion);\n  1616→    if (bizygomaticWidth > 0) {\n  1617→      const ratio = bigonialWidth / bizygomaticWidth;\n  1618→      addMeasurement('jawWidthRatio', ratio);\n  1619→      addMeasurement('bigonialWidth', ratio * 100);\n  1620→    }\n  1621→  }\n  1622→\n  1623→  // CANTHAL TILT\n  1624→  if (leftCanthusM && leftCanthusL) {\n  1625→    const deltaY = leftCanthusM.y - leftCanthusL.y;\n  1626→    const deltaX = leftCanthusL.x - leftCanthusM.x;\n  1627→    const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);\n  1628→    addMeasurement('lateralCanthalTilt', angle);\n  1629→  }\n  1630→\n  1631→  // EYE ASPECT RATIO\n  1632→  if (leftCanthusM && leftCanthusL) {\n  1633→    const leftPalpSup = getLandmark(landmarks, 'left_palpebra_superior');\n  1634→    const leftPalpInf = getLandmark(landmarks, 'left_palpebra_inferior');\n  1635→    if (leftPalpSup && leftPalpInf) {\n  1636→      const eyeWidth = distance(leftCanthusM, leftCanthusL);\n  1637→      const eyeHeight = distance(leftPalpSup, leftPalpInf);\n  1638→      if (eyeWidth > 0) {\n  1639→        addMeasurement('eyeAspectRatio', eyeHeight / eyeWidth);\n  1640→      }\n  1641→    }\n  1642→  }\n  1643→\n  1644→  // EYE SEPARATION RATIO\n  1645→  if (leftCanthusM && rightCanthusM && leftZygion && rightZygion) {\n  1646→    const intercanthal = distance(leftCanthusM, rightCanthusM);\n  1647→    const bizygomatic = distance(leftZygion, rightZygion);\n  1648→    if (bizygomatic > 0) {\n  1649→      addMeasurement('eyeSeparationRatio', intercanthal / bizygomatic);\n  1650→    }\n  1651→  }\n  1652→\n  1653→  // IPD RATIO\n  1654→  if (leftPupil && rightPupil && leftZygion && rightZygion) {\n  1655→    const ipd = distance(leftPupil, rightPupil);\n  1656→    const bizygomatic = distance(leftZygion, rightZygion);\n  1657→    if (bizygomatic > 0) {\n  1658→      addMeasurement('interpupillaryRatio', (ipd / bizygomatic) * 100);\n  1659→    }\n  1660→  }\n  1661→\n  1662→  // ONE EYE APART TEST\n  1663→  if (leftCanthusM && rightCanthusM && leftCanthusL) {\n  1664→    const intercanthal = distance(leftCanthusM, rightCanthusM);\n  1665→    const eyeWidth = distance(leftCanthusM, leftCanthusL);\n  1666→    if (eyeWidth > 0) {\n  1667→      addMeasurement('oneEyeApartTest', intercanthal / eyeWidth);\n  1668→    }\n  1669→  }\n  1670→\n  1671→  // NASAL INDEX\n  1672→  if (leftAlaNasi && rightAlaNasi && nasalBase && subnasale) {\n  1673→    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n  1674→    const nasalHeight = distance(nasalBase, subnasale);\n  1675→    if (nasalHeight > 0) {\n  1676→      addMeasurement('nasalIndex', (nasalWidth / nasalHeight) * 100);\n  1677→    }\n  1678→  }\n  1679→\n  1680→  // INTERCANTHAL-NASAL WIDTH RATIO\n  1681→  if (leftCanthusM && rightCanthusM && leftAlaNasi && rightAlaNasi) {\n  1682→    const intercanthal = distance(leftCanthusM, rightCanthusM);\n  1683→    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n  1684→    if (nasalWidth > 0) {\n  1685→      addMeasurement('intercanthalNasalRatio', intercanthal / nasalWidth);\n  1686→    }\n  1687→  }\n  1688→\n  1689→  // MOUTH TO NOSE RATIO\n  1690→  if (leftCheilion && rightCheilion && leftAlaNasi && rightAlaNasi) {\n  1691→    const mouthWidth = distance(leftCheilion, rightCheilion);\n  1692→    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n  1693→    if (nasalWidth > 0) {\n  1694→      addMeasurement('mouthWidthToNoseRatio', mouthWidth / nasalWidth);\n  1695→    }\n  1696→  }\n  1697→\n  1698→  // IPD TO MOUTH WIDTH RATIO\n  1699→  if (leftPupil && rightPupil && leftCheilion && rightCheilion) {\n  1700→    const ipd = distance(leftPupil, rightPupil);\n  1701→    const mouthWidth = distance(leftCheilion, rightCheilion);\n  1702→    if (ipd > 0) {\n  1703→      addMeasurement('interpupillaryMouthWidthRatio', mouthWidth / ipd);\n  1704→    }\n  1705→  }\n  1706→\n  1707→  // LIP RATIO\n  1708→  if (labraleSuperius && labraleInferius && subnasale) {\n  1709→    const mouthMiddle = getLandmark(landmarks, 'mouth_middle');\n  1710→    if (mouthMiddle) {\n  1711→      const upperLipHeight = distance(subnasale, labraleSuperius);\n  1712→      const lowerLipHeight = distance(mouthMiddle, labraleInferius);\n  1713→      if (upperLipHeight > 0) {\n  1714→        addMeasurement('lowerToUpperLipRatio', lowerLipHeight / upperLipHeight);\n  1715→      }\n  1716→    }\n  1717→  }\n  1718→\n  1719→  // MIDFACE RATIO\n  1720→  if (leftZygion && rightZygion && nasalBase && subnasale) {\n  1721→    const midfaceWidth = distance(leftZygion, rightZygion);\n  1722→    const midfaceHeight = distance(nasalBase, subnasale);\n  1723→    if (midfaceHeight > 0) {\n  1724→      addMeasurement('midfaceRatio', midfaceWidth / midfaceHeight / 10); // Normalized\n  1725→    }\n  1726→  }\n  1727→\n  1728→  // Calculate category scores\n  1729→  const categoryScores: Record<string, { total: number; count: number }> = {};\n  1730→  for (const m of measurements) {\n  1731→    if (!categoryScores[m.category]) {\n  1732→      categoryScores[m.category] = { total: 0, count: 0 };\n  1733→    }\n  1734→    categoryScores[m.category].total += m.standardizedScore;\n  1735→    categoryScores[m.category].count++;\n  1736→  }\n  1737→\n  1738→  const categoryAvg: Record<string, number> = {};\n  1739→  for (const [cat, data] of Object.entries(categoryScores)) {\n  1740→    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  1741→  }\n  1742→\n  1743→  // Calculate overall score (weighted average)\n  1744→  let totalWeight = 0;\n  1745→  let weightedSum = 0;\n  1746→  for (const m of measurements) {\n  1747→    const config = FACEIQ_METRICS[m.metricId];\n  1748→    if (config) {\n  1749→      weightedSum += m.standardizedScore * config.weight;\n  1750→      totalWeight += config.weight;\n  1751→    }\n  1752→  }\n  1753→\n  1754→  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n  1755→  const standardizedScore = overallScore;\n  1756→\n  1757→  return {\n  1758→    measurements,\n  1759→    overallScore,\n  1760→    standardizedScore,\n  1761→    qualityTier: getQualityTier(overallScore),\n  1762→    categoryScores: categoryAvg,\n  1763→  };\n  1764→}\n  1765→\n  1766→// ============================================\n  1767→// SIDE PROFILE ANALYSIS\n  1768→// ============================================\n  1769→\n  1770→export interface SideProfileResults {\n  1771→  measurements: FaceIQScoreResult[];\n  1772→  overallScore: number;\n  1773→  standardizedScore: number;\n  1774→  qualityTier: QualityTier;\n  1775→  categoryScores: Record<string, number>;\n  1776→}\n  1777→\n  1778→/**\n  1779→ * Calculate all side profile measurements from landmarks\n  1780→ */\n  1781→export function analyzeSideProfile(\n  1782→  landmarks: LandmarkPoint[],\n  1783→  gender: 'male' | 'female' = 'male'\n  1784→): SideProfileResults {\n  1785→  const measurements: FaceIQScoreResult[] = [];\n  1786→\n  1787→  const addMeasurement = (metricId: string, value: number | null) => {\n  1788→    if (value !== null) {\n  1789→      const result = scoreMeasurement(metricId, value);\n  1790→      if (result) measurements.push(result);\n  1791→    }\n  1792→  };\n  1793→\n  1794→  // Get key landmarks\n  1795→  const glabella = getLandmark(landmarks, 'glabella');\n  1796→  const nasion = getLandmark(landmarks, 'nasion');\n  1797→  const rhinion = getLandmark(landmarks, 'rhinion');\n  1798→  const pronasale = getLandmark(landmarks, 'pronasale');\n  1799→  const columella = getLandmark(landmarks, 'columella');\n  1800→  const subnasale = getLandmark(landmarks, 'subnasale');\n  1801→  const labraleSuperius = getLandmark(landmarks, 'labraleSuperius');\n  1802→  const labraleInferius = getLandmark(landmarks, 'labraleInferius');\n  1803→  const sublabiale = getLandmark(landmarks, 'sublabiale');\n  1804→  const pogonion = getLandmark(landmarks, 'pogonion');\n  1805→  const menton = getLandmark(landmarks, 'menton');\n  1806→  const tragus = getLandmark(landmarks, 'tragus');\n  1807→  const gonionBottom = getLandmark(landmarks, 'gonionBottom');\n  1808→  const cervicalPoint = getLandmark(landmarks, 'cervicalPoint');\n  1809→  const orbitale = getLandmark(landmarks, 'orbitale');\n  1810→  const porion = getLandmark(landmarks, 'porion');\n  1811→\n  1812→  // GONIAL ANGLE\n  1813→  if (tragus && gonionBottom && menton) {\n  1814→    const angle = calculateAngle(tragus, gonionBottom, menton);\n  1815→    addMeasurement('gonialAngle', angle);\n  1816→  }\n  1817→\n  1818→  // NASOLABIAL ANGLE\n  1819→  if (columella && subnasale && labraleSuperius) {\n  1820→    const angle = calculateAngle(columella, subnasale, labraleSuperius);\n  1821→    addMeasurement('nasolabialAngle', angle);\n  1822→  }\n  1823→\n  1824→  // NASOFRONTAL ANGLE\n  1825→  if (glabella && nasion && rhinion) {\n  1826→    const angle = calculateAngle(glabella, nasion, rhinion);\n  1827→    addMeasurement('nasofrontalAngle', angle);\n  1828→  }\n  1829→\n  1830→  // MENTOLABIAL ANGLE\n  1831→  if (labraleInferius && sublabiale && pogonion) {\n  1832→    const angle = calculateAngle(labraleInferius, sublabiale, pogonion);\n  1833→    addMeasurement('mentolabialAngle', angle);\n  1834→  }\n  1835→\n  1836→  // E-LINE MEASUREMENTS\n  1837→  if (pronasale && pogonion && labraleSuperius && labraleInferius) {\n  1838→    const upperLipDist = perpendicularDistance(labraleSuperius, pronasale, pogonion);\n  1839→    const lowerLipDist = perpendicularDistance(labraleInferius, pronasale, pogonion);\n  1840→    addMeasurement('eLineUpperLip', upperLipDist);\n  1841→    addMeasurement('eLineLowerLip', lowerLipDist);\n  1842→  }\n  1843→\n  1844→  // NASOMENTAL ANGLE\n  1845→  if (nasion && pronasale && pogonion) {\n  1846→    const angle = calculateAngle(nasion, pronasale, pogonion);\n  1847→    addMeasurement('nasomentaAngle', angle);\n  1848→  }\n  1849→\n  1850→  // FACIAL CONVEXITY (GLABELLA)\n  1851→  if (glabella && subnasale && pogonion) {\n  1852→    const angle = calculateAngle(glabella, subnasale, pogonion);\n  1853→    addMeasurement('facialConvexityGlabella', angle);\n  1854→  }\n  1855→\n  1856→  // FACIAL CONVEXITY (NASION)\n  1857→  if (nasion && subnasale && pogonion) {\n  1858→    const angle = calculateAngle(nasion, subnasale, pogonion);\n  1859→    addMeasurement('facialConvexityNasion', angle);\n  1860→  }\n  1861→\n  1862→  // TOTAL FACIAL CONVEXITY\n  1863→  if (glabella && pronasale && pogonion) {\n  1864→    const angle = calculateAngle(glabella, pronasale, pogonion);\n  1865→    addMeasurement('totalFacialConvexity', angle);\n  1866→  }\n  1867→\n  1868→  // SUBMENTAL CERVICAL ANGLE\n  1869→  if (menton && cervicalPoint && pogonion) {\n  1870→    const neckPoint = getLandmark(landmarks, 'neckPoint');\n  1871→    if (neckPoint) {\n  1872→      const angle = calculateAngle(pogonion, menton, neckPoint);\n  1873→      addMeasurement('submentalCervicalAngle', angle);\n  1874→    }\n  1875→  }\n  1876→\n  1877→  // NASAL PROJECTION (Goode ratio)\n  1878→  if (pronasale && subnasale && nasion) {\n  1879→    const projection = distance(pronasale, subnasale);\n  1880→    const nasalLength = distance(nasion, pronasale);\n  1881→    if (nasalLength > 0) {\n  1882→      addMeasurement('nasalProjection', projection / nasalLength);\n  1883→    }\n  1884→  }\n  1885→\n  1886→  // NASOFACIAL ANGLE\n  1887→  if (nasion && pronasale && pogonion) {\n  1888→    // Angle between nose dorsum and facial plane\n  1889→    const nasalDorsum = { x: pronasale.x - nasion.x, y: pronasale.y - nasion.y };\n  1890→    const facialPlane = { x: pogonion.x - nasion.x, y: pogonion.y - nasion.y };\n  1891→\n  1892→    const dot = nasalDorsum.x * facialPlane.x + nasalDorsum.y * facialPlane.y;\n  1893→    const mag1 = Math.sqrt(nasalDorsum.x ** 2 + nasalDorsum.y ** 2);\n  1894→    const mag2 = Math.sqrt(facialPlane.x ** 2 + facialPlane.y ** 2);\n  1895→\n  1896→    if (mag1 > 0 && mag2 > 0) {\n  1897→      const angle = Math.acos(dot / (mag1 * mag2)) * (180 / Math.PI);\n  1898→      addMeasurement('nasofacialAngle', angle);\n  1899→    }\n  1900→  }\n  1901→\n  1902→  // MANDIBULAR PLANE ANGLE (using Frankfort horizontal)\n  1903→  if (porion && orbitale && gonionBottom && menton) {\n  1904→    // Frankfort horizontal is porion to orbitale\n  1905→    // Mandibular plane is gonion to menton\n  1906→    const fhAngle = Math.atan2(orbitale.y - porion.y, orbitale.x - porion.x);\n  1907→    const mpAngle = Math.atan2(menton.y - gonionBottom.y, menton.x - gonionBottom.x);\n  1908→    const angle = Math.abs(fhAngle - mpAngle) * (180 / Math.PI);\n  1909→    addMeasurement('mandibularPlaneAngle', angle);\n  1910→  }\n  1911→\n  1912→  // CHIN PROJECTION\n  1913→  if (pogonion && subnasale) {\n  1914→    // Distance from pogonion to vertical line through subnasale\n  1915→    const projection = pogonion.x - subnasale.x;\n  1916→    addMeasurement('chinProjection', projection);\n  1917→  }\n  1918→\n  1919→  // Calculate category scores\n  1920→  const categoryScores: Record<string, { total: number; count: number }> = {};\n  1921→  for (const m of measurements) {\n  1922→    if (!categoryScores[m.category]) {\n  1923→      categoryScores[m.category] = { total: 0, count: 0 };\n  1924→    }\n  1925→    categoryScores[m.category].total += m.standardizedScore;\n  1926→    categoryScores[m.category].count++;\n  1927→  }\n  1928→\n  1929→  const categoryAvg: Record<string, number> = {};\n  1930→  for (const [cat, data] of Object.entries(categoryScores)) {\n  1931→    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  1932→  }\n  1933→\n  1934→  // Calculate overall score\n  1935→  let totalWeight = 0;\n  1936→  let weightedSum = 0;\n  1937→  for (const m of measurements) {\n  1938→    const config = FACEIQ_METRICS[m.metricId];\n  1939→    if (config) {\n  1940→      weightedSum += m.standardizedScore * config.weight;\n  1941→      totalWeight += config.weight;\n  1942→    }\n  1943→  }\n  1944→\n  1945→  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n  1946→\n  1947→  return {\n  1948→    measurements,\n  1949→    overallScore,\n  1950→    standardizedScore: overallScore,\n  1951→    qualityTier: getQualityTier(overallScore),\n  1952→    categoryScores: categoryAvg,\n  1953→  };\n  1954→}\n  1955→\n  1956→// ============================================\n  1957→// COMPLETE HARMONY ANALYSIS\n  1958→// ============================================\n  1959→\n  1960→/**\n  1961→ * Run complete facial harmony analysis\n  1962→ */\n  1963→export function analyzeHarmony(\n  1964→  frontLandmarks: LandmarkPoint[],\n  1965→  sideLandmarks: LandmarkPoint[],\n  1966→  gender: 'male' | 'female' = 'male'\n  1967→): HarmonyAnalysis {\n  1968→  const frontResults = analyzeFrontProfile(frontLandmarks, gender);\n  1969→  const sideResults = analyzeSideProfile(sideLandmarks, gender);\n  1970→\n  1971→  const allMeasurements = [...frontResults.measurements, ...sideResults.measurements];\n  1972→\n  1973→  // Combined category scores\n  1974→  const allCategories: Record<string, { total: number; count: number }> = {};\n  1975→  for (const m of allMeasurements) {\n  1976→    if (!allCategories[m.category]) {\n  1977→      allCategories[m.category] = { total: 0, count: 0 };\n  1978→    }\n  1979→    allCategories[m.category].total += m.standardizedScore;\n  1980→    allCategories[m.category].count++;\n  1981→  }\n  1982→\n  1983→  const categoryScores: Record<string, number> = {};\n  1984→  for (const [cat, data] of Object.entries(allCategories)) {\n  1985→    categoryScores[cat] = data.count > 0 ? data.total / data.count : 0;\n  1986→  }\n  1987→\n  1988→  // Overall weighted score\n  1989→  let totalWeight = 0;\n  1990→  let weightedSum = 0;\n  1991→  for (const m of allMeasurements) {\n  1992→    const config = FACEIQ_METRICS[m.metricId];\n  1993→    if (config) {\n  1994→      weightedSum += m.standardizedScore * config.weight;\n  1995→      totalWeight += config.weight;\n  1996→    }\n  1997→  }\n  1998→\n  1999→  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n  2000→\n  2001→  // Identify flaws (below average measurements)\n  2002→  const flaws: FlawAssessment[] = allMeasurements\n  2003→    .filter((m) => m.severity !== 'optimal' && m.severity !== 'minor')\n  2004→    .map((m) => ({\n  2005→      category: m.category,\n  2006→      metricId: m.metricId,\n  2007→      metricName: m.name,\n  2008→      severity: m.severity,\n  2009→      deviation: `${m.deviation.toFixed(2)} ${m.deviationDirection} ideal`,\n  2010→      reasoning: `${m.name} is outside the ideal range`,\n  2011→      confidence: m.severity === 'extremely_severe' || m.severity === 'severe'\n  2012→        ? 'confirmed' as const\n  2013→        : 'likely' as const,\n  2014→    }))\n  2015→    .sort((a, b) => {\n  2016→      const severityOrder = { extremely_severe: 0, severe: 1, major: 2, moderate: 3 };\n  2017→      return (severityOrder[a.severity as keyof typeof severityOrder] ?? 4) -\n  2018→             (severityOrder[b.severity as keyof typeof severityOrder] ?? 4);\n  2019→    });\n  2020→\n  2021→  // Identify strengths (ideal measurements)\n  2022→  const strengths: StrengthAssessment[] = allMeasurements\n  2023→    .filter((m) => m.qualityTier === 'ideal' || m.qualityTier === 'excellent')\n  2024→    .map((m) => ({\n  2025→      category: m.category,\n  2026→      metricId: m.metricId,\n  2027→      metricName: m.name,\n  2028→      qualityTier: m.qualityTier,\n  2029→      value: m.value,\n  2030→      reasoning: `${m.name} is within the ${m.qualityTier} range`,\n  2031→    }));\n  2032→\n  2033→  // Calculate percentile (based on population stats)\n  2034→  const percentile = calculateHarmonyPercentile(overallScore);\n  2035→\n  2036→  return {\n  2037→    overallScore,\n  2038→    standardizedScore: overallScore,\n  2039→    qualityTier: getQualityTier(overallScore),\n  2040→    percentile,\n  2041→    frontScore: frontResults.overallScore,\n  2042→    sideScore: sideResults.overallScore,\n  2043→    categoryScores,\n  2044→    measurements: allMeasurements,\n  2045→    flaws,\n  2046→    strengths,\n  2047→  };\n  2048→}\n  2049→\n  2050→/**\n  2051→ * Calculate percentile from harmony score\n  2052→ */\n  2053→function calculateHarmonyPercentile(score: number): number {\n  2054→  // Based on normal distribution with mean=5, stdDev=1.5\n  2055→  const mean = 5;\n  2056→  const stdDev = 1.5;\n  2057→  const z = (score - mean) / stdDev;\n  2058→  return normalCDF(z) * 100;\n  2059→}\n  2060→\n  2061→/**\n  2062→ * Standard normal CDF approximation\n  2063→ */\n  2064→function normalCDF(z: number): number {\n  2065→  const a1 = 0.254829592;\n  2066→  const a2 = -0.284496736;\n  2067→  const a3 = 1.421413741;\n  2068→  const a4 = -1.453152027;\n  2069→  const a5 = 1.061405429;\n  2070→  const p = 0.3275911;\n  2071→\n  2072→  const sign = z < 0 ? -1 : 1;\n  2073→  const absZ = Math.abs(z) / Math.sqrt(2);\n  2074→\n  2075→  const t = 1.0 / (1.0 + p * absZ);\n  2076→  const y = 1.0 - ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-absZ * absZ);\n  2077→\n  2078→  return 0.5 * (1.0 + sign * y);\n  2079→}\n  2080→\n  2081→// ============================================\n  2082→// PSL RATING CONVERSION\n  2083→// ============================================\n  2084→\n  2085→export interface PSLRating {\n  2086→  score: number;\n  2087→  tier: string;\n  2088→  percentile: number;\n  2089→  description: string;\n  2090→}\n  2091→\n  2092→/**\n  2093→ * Convert harmony score to PSL rating\n  2094→ */\n  2095→export function convertToPSL(harmonyScore: number): PSLRating {\n  2096→  // Convert 0-10 harmony to 3.0-7.5 PSL range\n  2097→  const psl = 3.0 + (harmonyScore / 10) * 4.5;\n  2098→  const clampedPSL = Math.max(3.0, Math.min(7.5, psl));\n  2099→\n  2100→  let tier: string;\n  2101→  let percentile: number;\n  2102→\n  2103→  if (clampedPSL >= 7.5) {\n  2104→    tier = 'Top Model';\n  2105→    percentile = 99.99;\n  2106→  } else if (clampedPSL >= 7.0) {\n  2107→    tier = 'Chad';\n  2108→    percentile = 99.87;\n  2109→  } else if (clampedPSL >= 6.5) {\n  2110→    tier = 'Chadlite';\n  2111→    percentile = 99.0;\n  2112→  } else if (clampedPSL >= 6.0) {\n  2113→    tier = 'High Tier Normie+';\n  2114→    percentile = 97.25;\n  2115→  } else if (clampedPSL >= 5.5) {\n  2116→    tier = 'High Tier Normie';\n  2117→    percentile = 90.0;\n  2118→  } else if (clampedPSL >= 5.0) {\n  2119→    tier = 'Mid Tier Normie+';\n  2120→    percentile = 84.15;\n  2121→  } else if (clampedPSL >= 4.5) {\n  2122→    tier = 'Mid Tier Normie';\n  2123→    percentile = 65.0;\n  2124→  } else if (clampedPSL >= 4.0) {\n  2125→    tier = 'Low Tier Normie';\n  2126→    percentile = 50.0;\n  2127→  } else if (clampedPSL >= 3.5) {\n  2128→    tier = 'Below Average';\n  2129→    percentile = 30.0;\n  2130→  } else {\n  2131→    tier = 'Subpar';\n  2132→    percentile = 15.0;\n  2133→  }\n  2134→\n  2135→  return {\n  2136→    score: clampedPSL,\n  2137→    tier,\n  2138→    percentile,\n  2139→    description: `${tier} (top ${(100 - percentile).toFixed(1)}%)`,\n  2140→  };\n  2141→}\n  2142→\n  2143→// ============================================\n  2144→// EXPORTS FOR BACKWARD COMPATIBILITY\n  2145→// ============================================\n  2146→\n  2147→export type { LandmarkPoint } from './landmarks';\n  2148→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"f07e2170-21fc-4646-9e01-77e2885cff5c","timestamp":"2025-12-20T15:49:51.466Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","content":"/**\n * FaceIQ-Style Facial Analysis Scoring System\n * Complete replication of FaceIQ Labs scoring algorithms\n *\n * Features:\n * - Exponential decay scoring with per-metric decay rates\n * - Bezier curve custom scoring for non-linear measurements\n * - 70+ facial measurements (front + side profiles)\n * - Quality tiers: Ideal, Excellent, Good\n * - 5-tier severity: Extremely Severe, Severe, Major, Moderate, Minor\n */\n\nimport { LandmarkPoint } from './landmarks';\n\n// ============================================\n// CORE TYPES\n// ============================================\n\nexport interface Point {\n  x: number;\n  y: number;\n}\n\nexport type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\nexport type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';\nexport type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';\n\nexport interface MetricConfig {\n  id: string;\n  name: string;\n  category: string;\n  unit: MeasurementUnit;\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  decayRate: number;\n  maxScore: number;\n  weight: number;\n  description: string;\n  profileType: 'front' | 'side';\n  customCurve?: BezierCurveConfig;\n}\n\nexport interface BezierCurveConfig {\n  mode: 'custom' | 'exponential';\n  points: CurvePoint[];\n}\n\nexport interface CurvePoint {\n  x: number;\n  y: number;\n  leftHandleX?: number;\n  leftHandleY?: number;\n  rightHandleX?: number;\n  rightHandleY?: number;\n  fixed?: boolean;\n}\n\nexport interface FaceIQScoreResult {\n  metricId: string;\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  severity: SeverityLevel;\n  idealMin: number;\n  idealMax: number;\n  deviation: number;\n  deviationDirection: 'above' | 'below' | 'within';\n  unit: MeasurementUnit;\n  category: string;\n  percentile?: number;\n}\n\nexport interface HarmonyAnalysis {\n  overallScore: number;  // 0-10 scale\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  percentile: number;\n  frontScore: number;\n  sideScore: number;\n  categoryScores: Record<string, number>;\n  measurements: FaceIQScoreResult[];\n  flaws: FlawAssessment[];\n  strengths: StrengthAssessment[];\n}\n\nexport interface FlawAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  severity: SeverityLevel;\n  deviation: string;\n  reasoning: string;\n  confidence: 'confirmed' | 'likely' | 'possible';\n}\n\nexport interface StrengthAssessment {\n  category: string;\n  metricId: string;\n  metricName: string;\n  qualityTier: QualityTier;\n  value: number;\n  reasoning: string;\n}\n\n// ============================================\n// FACEIQ MEASUREMENT CONFIGURATIONS (70+)\n// ============================================\n\nexport const FACEIQ_METRICS: Record<string, MetricConfig> = {\n  // ==========================================\n  // FRONT PROFILE - FACIAL PROPORTIONS (32)\n  // ==========================================\n\n  faceWidthToHeight: {\n    id: 'faceWidthToHeight',\n    name: 'Face Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.96,\n    idealMax: 2.0,\n    rangeMin: 1.5,\n    rangeMax: 2.5,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Ratio of bizygomatic width to upper face height',\n    profileType: 'front',\n  },\n\n  lowerThirdProportion: {\n    id: 'lowerThirdProportion',\n    name: 'Lower Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31,\n    idealMax: 33.5,\n    rangeMin: 24,\n    rangeMax: 40,\n    decayRate: 1.86,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by lower third (subnasale to menton)',\n    profileType: 'front',\n  },\n\n  middleThirdProportion: {\n    id: 'middleThirdProportion',\n    name: 'Middle Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31,\n    idealMax: 34,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Percentage of face occupied by middle third',\n    profileType: 'front',\n  },\n\n  upperThirdProportion: {\n    id: 'upperThirdProportion',\n    name: 'Upper Third Proportion',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 31,\n    idealMax: 35,\n    rangeMin: 24,\n    rangeMax: 42,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Percentage of face occupied by upper third (trichion to glabella)',\n    profileType: 'front',\n  },\n\n  bitemporalWidth: {\n    id: 'bitemporalWidth',\n    name: 'Bitemporal Width',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 75,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Temple width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  cheekboneHeight: {\n    id: 'cheekboneHeight',\n    name: 'Cheekbone Height',\n    category: 'Midface/Face Shape',\n    unit: 'percent',\n    idealMin: 83,\n    idealMax: 100,\n    rangeMin: 60,\n    rangeMax: 110,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Vertical position of cheekbones relative to face height',\n    profileType: 'front',\n  },\n\n  totalFacialWidthToHeight: {\n    id: 'totalFacialWidthToHeight',\n    name: 'Total Facial Width to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 1.34,\n    idealMax: 1.37,\n    rangeMin: 1.0,\n    rangeMax: 1.7,\n    decayRate: 13.2,\n    maxScore: 25,  // Special: higher max score\n    weight: 0.05,\n    description: 'Total face height divided by cheek width',\n    profileType: 'front',\n    customCurve: {\n      mode: 'custom',\n      points: [\n        { x: 1.05, y: 0 },\n        { x: 1.17, y: 1.41 },\n        { x: 1.25, y: 3.86 },\n        { x: 1.29, y: 6.01 },\n        { x: 1.32, y: 8.88 },\n        { x: 1.34, y: 10, fixed: true },\n        { x: 1.37, y: 10, fixed: true },\n        { x: 1.39, y: 8.88 },\n        { x: 1.42, y: 6.01 },\n        { x: 1.46, y: 3.86 },\n        { x: 1.54, y: 1.41 },\n        { x: 1.66, y: 0 },\n      ],\n    },\n  },\n\n  midfaceRatio: {\n    id: 'midfaceRatio',\n    name: 'Midface Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 0.97,\n    idealMax: 1.0,\n    rangeMin: 0.7,\n    rangeMax: 1.3,\n    decayRate: 31.6,\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Midface width to height ratio for facial balance',\n    profileType: 'front',\n  },\n\n  // JAW MEASUREMENTS\n  jawSlope: {\n    id: 'jawSlope',\n    name: 'Jaw Slope',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 140,\n    idealMax: 142.5,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of the jawline from gonion to chin',\n    profileType: 'front',\n  },\n\n  jawFrontalAngle: {\n    id: 'jawFrontalAngle',\n    name: 'Jaw Frontal Angle',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: 86.5,\n    idealMax: 92.5,\n    rangeMin: 70,\n    rangeMax: 110,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of jaw corners from frontal view',\n    profileType: 'front',\n  },\n\n  bigonialWidth: {\n    id: 'bigonialWidth',\n    name: 'Bigonial Width',\n    category: 'Jaw Shape',\n    unit: 'percent',\n    idealMin: 75,\n    idealMax: 82,\n    rangeMin: 60,\n    rangeMax: 95,\n    decayRate: 0.9,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Jaw width as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  jawWidthRatio: {\n    id: 'jawWidthRatio',\n    name: 'Jaw Width to Face Width Ratio',\n    category: 'Jaw Shape',\n    unit: 'ratio',\n    idealMin: 0.75,\n    idealMax: 0.82,\n    rangeMin: 0.6,\n    rangeMax: 0.95,\n    decayRate: 25.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Bigonial width divided by bizygomatic width',\n    profileType: 'front',\n  },\n\n  // EYE MEASUREMENTS\n  lateralCanthalTilt: {\n    id: 'lateralCanthalTilt',\n    name: 'Lateral Canthal Tilt',\n    category: 'Eyes',\n    unit: 'degrees',\n    idealMin: 4,\n    idealMax: 8,\n    rangeMin: -5,\n    rangeMax: 15,\n    decayRate: 2.5,\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle of eye from inner to outer canthus',\n    profileType: 'front',\n  },\n\n  eyeAspectRatio: {\n    id: 'eyeAspectRatio',\n    name: 'Eye Aspect Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.28,\n    idealMax: 0.32,\n    rangeMin: 0.2,\n    rangeMax: 0.45,\n    decayRate: 40.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Eye height divided by eye width',\n    profileType: 'front',\n  },\n\n  eyeSeparationRatio: {\n    id: 'eyeSeparationRatio',\n    name: 'Eye Separation Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.28,\n    idealMax: 0.32,\n    rangeMin: 0.22,\n    rangeMax: 0.38,\n    decayRate: 35.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Intercanthal distance divided by bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryRatio: {\n    id: 'interpupillaryRatio',\n    name: 'Interpupillary Distance Ratio',\n    category: 'Eyes',\n    unit: 'percent',\n    idealMin: 44,\n    idealMax: 48,\n    rangeMin: 38,\n    rangeMax: 54,\n    decayRate: 1.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'IPD as percentage of bizygomatic width',\n    profileType: 'front',\n  },\n\n  interpupillaryMouthWidthRatio: {\n    id: 'interpupillaryMouthWidthRatio',\n    name: 'Interpupillary-Mouth Width Ratio',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.8,\n    idealMax: 0.9,\n    rangeMin: 0.6,\n    rangeMax: 1.1,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Mouth width divided by interpupillary distance',\n    profileType: 'front',\n  },\n\n  oneEyeApartTest: {\n    id: 'oneEyeApartTest',\n    name: 'One Eye Apart Test',\n    category: 'Eyes',\n    unit: 'ratio',\n    idealMin: 0.95,\n    idealMax: 1.05,\n    rangeMin: 0.7,\n    rangeMax: 1.3,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Intercanthal distance should equal one eye width',\n    profileType: 'front',\n  },\n\n  // EYEBROW MEASUREMENTS\n  browLengthRatio: {\n    id: 'browLengthRatio',\n    name: 'Brow Length to Face Width Ratio',\n    category: 'Upper Third',\n    unit: 'percent',\n    idealMin: 28,\n    idealMax: 32,\n    rangeMin: 20,\n    rangeMax: 40,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Eyebrow length as percentage of face width',\n    profileType: 'front',\n  },\n\n  eyebrowTilt: {\n    id: 'eyebrowTilt',\n    name: 'Eyebrow Tilt',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 8,\n    idealMax: 15,\n    rangeMin: 0,\n    rangeMax: 25,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of eyebrow from head to tail',\n    profileType: 'front',\n  },\n\n  eyebrowLowSetedness: {\n    id: 'eyebrowLowSetedness',\n    name: 'Eyebrow Low Setedness',\n    category: 'Upper Third',\n    unit: 'ratio',\n    idealMin: 0.18,\n    idealMax: 0.24,\n    rangeMin: 0.1,\n    rangeMax: 0.35,\n    decayRate: 30.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from brow to eye relative to eye height',\n    profileType: 'front',\n  },\n\n  // NOSE MEASUREMENTS (FRONT)\n  nasalIndex: {\n    id: 'nasalIndex',\n    name: 'Nasal Index',\n    category: 'Nose',\n    unit: 'percent',\n    idealMin: 70,\n    idealMax: 85,\n    rangeMin: 55,\n    rangeMax: 100,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose width divided by nose height × 100',\n    profileType: 'front',\n  },\n\n  intercanthalNasalRatio: {\n    id: 'intercanthalNasalRatio',\n    name: 'Intercanthal-Nasal Width Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 1.0,\n    idealMax: 1.2,\n    rangeMin: 0.7,\n    rangeMax: 1.5,\n    decayRate: 12.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Alar width should roughly equal intercanthal distance',\n    profileType: 'front',\n  },\n\n  noseBridgeWidth: {\n    id: 'noseBridgeWidth',\n    name: 'Nose Bridge to Nose Width',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.6,\n    idealMax: 0.75,\n    rangeMin: 0.4,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ratio of nose bridge width to alar base width',\n    profileType: 'front',\n  },\n\n  noseTipPosition: {\n    id: 'noseTipPosition',\n    name: 'Nose Tip Position',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.48,\n    idealMax: 0.52,\n    rangeMin: 0.4,\n    rangeMax: 0.6,\n    decayRate: 25.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Nose tip position relative to face centerline',\n    profileType: 'front',\n  },\n\n  // MOUTH/LIP MEASUREMENTS\n  mouthWidthToNoseRatio: {\n    id: 'mouthWidthToNoseRatio',\n    name: 'Mouth Width to Nose Width Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.44,\n    idealMax: 1.52,\n    rangeMin: 1.2,\n    rangeMax: 1.8,\n    decayRate: 18.0,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Mouth width divided by nose width',\n    profileType: 'front',\n  },\n\n  lowerToUpperLipRatio: {\n    id: 'lowerToUpperLipRatio',\n    name: 'Lower Lip to Upper Lip Ratio',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: 1.4,\n    idealMax: 1.8,\n    rangeMin: 1.0,\n    rangeMax: 2.5,\n    decayRate: 8.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Lower lip height divided by upper lip height',\n    profileType: 'front',\n  },\n\n  cupidsBowDepth: {\n    id: 'cupidsBowDepth',\n    name: \"Cupid's Bow Depth\",\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2,\n    idealMax: 4,\n    rangeMin: 0,\n    rangeMax: 7,\n    decayRate: 2.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: \"Depth of the cupid's bow curve\",\n    profileType: 'front',\n  },\n\n  mouthCornerPosition: {\n    id: 'mouthCornerPosition',\n    name: 'Mouth Corner Position',\n    category: 'Lips',\n    unit: 'ratio',\n    idealMin: -0.02,\n    idealMax: 0.02,\n    rangeMin: -0.1,\n    rangeMax: 0.1,\n    decayRate: 50.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Mouth corner vertical position relative to lip center',\n    profileType: 'front',\n  },\n\n  // CHIN MEASUREMENTS (FRONT)\n  chinToPhiltrumRatio: {\n    id: 'chinToPhiltrumRatio',\n    name: 'Chin to Philtrum Ratio',\n    category: 'Chin',\n    unit: 'ratio',\n    idealMin: 1.8,\n    idealMax: 2.2,\n    rangeMin: 1.3,\n    rangeMax: 2.8,\n    decayRate: 10.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin height divided by philtrum length',\n    profileType: 'front',\n  },\n\n  // OTHER FRONT MEASUREMENTS\n  iaaJfaDeviation: {\n    id: 'iaaJfaDeviation',\n    name: 'Deviation of IAA & JFA',\n    category: 'Jaw Shape',\n    unit: 'degrees',\n    idealMin: -3,\n    idealMax: 3,\n    rangeMin: -15,\n    rangeMax: 15,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Deviation between Ipsilateral Alar Angle and Jaw Frontal Angle',\n    profileType: 'front',\n  },\n\n  neckWidth: {\n    id: 'neckWidth',\n    name: 'Neck Width',\n    category: 'Neck',\n    unit: 'percent',\n    idealMin: 70,\n    idealMax: 85,\n    rangeMin: 55,\n    rangeMax: 100,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Neck width as percentage of jaw width',\n    profileType: 'front',\n  },\n\n  // ==========================================\n  // SIDE PROFILE MEASUREMENTS (38)\n  // ==========================================\n\n  gonialAngle: {\n    id: 'gonialAngle',\n    name: 'Gonial Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 130,\n    rangeMin: 105,\n    rangeMax: 145,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.04,\n    description: 'Angle at the jaw corner (gonion)',\n    profileType: 'side',\n  },\n\n  nasolabialAngle: {\n    id: 'nasolabialAngle',\n    name: 'Nasolabial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 90,\n    idealMax: 105,\n    rangeMin: 75,\n    rangeMax: 120,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle between columella and upper lip',\n    profileType: 'side',\n  },\n\n  nasofrontalAngle: {\n    id: 'nasofrontalAngle',\n    name: 'Nasofrontal Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 115,\n    idealMax: 135,\n    rangeMin: 100,\n    rangeMax: 150,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the bridge of nose (nasion)',\n    profileType: 'side',\n  },\n\n  nasofacialAngle: {\n    id: 'nasofacialAngle',\n    name: 'Nasofacial Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 30,\n    idealMax: 40,\n    rangeMin: 20,\n    rangeMax: 50,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between nose and face plane',\n    profileType: 'side',\n  },\n\n  nasomentaAngle: {\n    id: 'nasomentaAngle',\n    name: 'Nasomental Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 132,\n    rangeMin: 105,\n    rangeMax: 145,\n    decayRate: 0.7,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle from nasion to nose tip to chin',\n    profileType: 'side',\n  },\n\n  nasalTipAngle: {\n    id: 'nasalTipAngle',\n    name: 'Nasal Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 105,\n    rangeMin: 70,\n    rangeMax: 120,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the nose tip',\n    profileType: 'side',\n  },\n\n  nasalProjection: {\n    id: 'nasalProjection',\n    name: 'Nasal Projection',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.55,\n    idealMax: 0.6,\n    rangeMin: 0.4,\n    rangeMax: 0.75,\n    decayRate: 20.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Nose projection relative to nasal length (Goode ratio)',\n    profileType: 'side',\n  },\n\n  nasalWToHRatio: {\n    id: 'nasalWToHRatio',\n    name: 'Nasal W to H Ratio',\n    category: 'Nose',\n    unit: 'ratio',\n    idealMin: 0.67,\n    idealMax: 0.78,\n    rangeMin: 0.5,\n    rangeMax: 0.95,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Nose width to height ratio from side view',\n    profileType: 'side',\n  },\n\n  noseTipRotationAngle: {\n    id: 'noseTipRotationAngle',\n    name: 'Nose Tip Rotation Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 95,\n    idealMax: 110,\n    rangeMin: 80,\n    rangeMax: 125,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of nose tip rotation',\n    profileType: 'side',\n  },\n\n  frankfortTipAngle: {\n    id: 'frankfortTipAngle',\n    name: 'Frankfort-Tip Angle',\n    category: 'Nose',\n    unit: 'degrees',\n    idealMin: 28,\n    idealMax: 34,\n    rangeMin: 20,\n    rangeMax: 42,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle between Frankfort plane and nose tip',\n    profileType: 'side',\n  },\n\n  mentolabialAngle: {\n    id: 'mentolabialAngle',\n    name: 'Mentolabial Angle',\n    category: 'Lips',\n    unit: 'degrees',\n    idealMin: 120,\n    idealMax: 140,\n    rangeMin: 100,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle at the labiomental fold',\n    profileType: 'side',\n  },\n\n  zAngle: {\n    id: 'zAngle',\n    name: 'Z Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 75,\n    idealMax: 85,\n    rangeMin: 60,\n    rangeMax: 100,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Merrifield Z-Angle for profile assessment',\n    profileType: 'side',\n  },\n\n  submentalCervicalAngle: {\n    id: 'submentalCervicalAngle',\n    name: 'Submental Cervical Angle',\n    category: 'Neck',\n    unit: 'degrees',\n    idealMin: 105,\n    idealMax: 120,\n    rangeMin: 90,\n    rangeMax: 140,\n    decayRate: 0.6,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle between chin and neck',\n    profileType: 'side',\n  },\n\n  facialConvexityGlabella: {\n    id: 'facialConvexityGlabella',\n    name: 'Facial Convexity (Glabella)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 165,\n    idealMax: 175,\n    rangeMin: 150,\n    rangeMax: 185,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Facial convexity angle using glabella',\n    profileType: 'side',\n  },\n\n  facialConvexityNasion: {\n    id: 'facialConvexityNasion',\n    name: 'Facial Convexity (Nasion)',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 168,\n    idealMax: 178,\n    rangeMin: 155,\n    rangeMax: 190,\n    decayRate: 0.4,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial convexity angle using nasion',\n    profileType: 'side',\n  },\n\n  totalFacialConvexity: {\n    id: 'totalFacialConvexity',\n    name: 'Total Facial Convexity',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 135,\n    idealMax: 145,\n    rangeMin: 120,\n    rangeMax: 160,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Complete facial profile convexity measurement',\n    profileType: 'side',\n  },\n\n  facialDepthToHeight: {\n    id: 'facialDepthToHeight',\n    name: 'Facial Depth to Height Ratio',\n    category: 'Midface/Face Shape',\n    unit: 'ratio',\n    idealMin: 0.85,\n    idealMax: 0.95,\n    rangeMin: 0.7,\n    rangeMax: 1.1,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Facial depth divided by facial height',\n    profileType: 'side',\n  },\n\n  anteriorFacialDepth: {\n    id: 'anteriorFacialDepth',\n    name: 'Anterior Facial Depth',\n    category: 'Midface/Face Shape',\n    unit: 'mm',\n    idealMin: 85,\n    idealMax: 100,\n    rangeMin: 70,\n    rangeMax: 115,\n    decayRate: 0.3,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Depth of the anterior face',\n    profileType: 'side',\n  },\n\n  mandibularPlaneAngle: {\n    id: 'mandibularPlaneAngle',\n    name: 'Mandibular Plane Angle',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'degrees',\n    idealMin: 22,\n    idealMax: 28,\n    rangeMin: 15,\n    rangeMax: 38,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.03,\n    description: 'Angle of mandibular plane to Frankfort plane',\n    profileType: 'side',\n  },\n\n  ramusToMandibleRatio: {\n    id: 'ramusToMandibleRatio',\n    name: 'Ramus to Mandible Ratio',\n    category: 'Occlusion/Jaw Growth',\n    unit: 'ratio',\n    idealMin: 0.65,\n    idealMax: 0.75,\n    rangeMin: 0.5,\n    rangeMax: 0.9,\n    decayRate: 15.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Ramus height divided by mandible length',\n    profileType: 'side',\n  },\n\n  gonionToMouthLine: {\n    id: 'gonionToMouthLine',\n    name: 'Gonion to Mouth Line',\n    category: 'Jaw Shape',\n    unit: 'mm',\n    idealMin: -5,\n    idealMax: 5,\n    rangeMin: -20,\n    rangeMax: 20,\n    decayRate: 0.5,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Distance from gonion to mouth level line',\n    profileType: 'side',\n  },\n\n  // E-LINE MEASUREMENTS\n  eLineUpperLip: {\n    id: 'eLineUpperLip',\n    name: 'Upper Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -4,\n    idealMax: -2,\n    rangeMin: -10,\n    rangeMax: 4,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Upper lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  eLineLowerLip: {\n    id: 'eLineLowerLip',\n    name: 'Lower Lip E-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 0,\n    rangeMin: -8,\n    rangeMax: 6,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Lower lip distance from E-line (Ricketts)',\n    profileType: 'side',\n  },\n\n  // S-LINE MEASUREMENTS\n  sLineUpperLip: {\n    id: 'sLineUpperLip',\n    name: 'Upper Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 3,\n    rangeMin: -5,\n    rangeMax: 8,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  sLineLowerLip: {\n    id: 'sLineLowerLip',\n    name: 'Lower Lip S-Line Position',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 2,\n    rangeMin: -4,\n    rangeMax: 6,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip distance from S-line (Steiner)',\n    profileType: 'side',\n  },\n\n  // BURSTONE LINE\n  burstoneUpperLip: {\n    id: 'burstoneUpperLip',\n    name: 'Upper Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 2,\n    idealMax: 4,\n    rangeMin: -2,\n    rangeMax: 8,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Upper lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  burstoneLowerLip: {\n    id: 'burstoneLowerLip',\n    name: 'Lower Lip Burstone Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 1,\n    idealMax: 3,\n    rangeMin: -3,\n    rangeMax: 7,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Lower lip to Burstone line distance',\n    profileType: 'side',\n  },\n\n  // H LINE\n  holdawayHLine: {\n    id: 'holdawayHLine',\n    name: 'Holdaway H Line',\n    category: 'Lips',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -5,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Holdaway H-line soft tissue assessment',\n    profileType: 'side',\n  },\n\n  // CHIN MEASUREMENTS (SIDE)\n  chinProjection: {\n    id: 'chinProjection',\n    name: 'Chin Projection',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -3,\n    idealMax: 3,\n    rangeMin: -12,\n    rangeMax: 12,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin projection relative to ideal position',\n    profileType: 'side',\n  },\n\n  recessionRelativeToFrankfort: {\n    id: 'recessionRelativeToFrankfort',\n    name: 'Recession Relative to Frankfort Plane',\n    category: 'Chin',\n    unit: 'mm',\n    idealMin: -2,\n    idealMax: 2,\n    rangeMin: -10,\n    rangeMax: 10,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Chin recession relative to Frankfort horizontal',\n    profileType: 'side',\n  },\n\n  // FOREHEAD\n  browridgeInclinationAngle: {\n    id: 'browridgeInclinationAngle',\n    name: 'Browridge Inclination Angle',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 10,\n    idealMax: 18,\n    rangeMin: 0,\n    rangeMax: 28,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of the brow ridge from profile',\n    profileType: 'side',\n  },\n\n  upperForeheadSlope: {\n    id: 'upperForeheadSlope',\n    name: 'Upper Forehead Slope',\n    category: 'Upper Third',\n    unit: 'degrees',\n    idealMin: 5,\n    idealMax: 12,\n    rangeMin: 0,\n    rangeMax: 20,\n    decayRate: 1.2,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Slope angle of the upper forehead',\n    profileType: 'side',\n  },\n\n  // MIDFACE PROJECTION\n  midfaceProjectionAngle: {\n    id: 'midfaceProjectionAngle',\n    name: 'Interior Midface Projection Angle',\n    category: 'Midface/Face Shape',\n    unit: 'degrees',\n    idealMin: 85,\n    idealMax: 95,\n    rangeMin: 75,\n    rangeMax: 105,\n    decayRate: 0.8,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Angle of midface projection from profile',\n    profileType: 'side',\n  },\n\n  orbitalVector: {\n    id: 'orbitalVector',\n    name: 'Orbital Vector',\n    category: 'Eyes',\n    unit: 'mm',\n    idealMin: 0,\n    idealMax: 4,\n    rangeMin: -6,\n    rangeMax: 10,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.02,\n    description: 'Relationship of globe to orbital rim',\n    profileType: 'side',\n  },\n\n  // EAR MEASUREMENTS\n  earProtrusionAngle: {\n    id: 'earProtrusionAngle',\n    name: 'Ear Protrusion Angle',\n    category: 'Other',\n    unit: 'degrees',\n    idealMin: 15,\n    idealMax: 25,\n    rangeMin: 5,\n    rangeMax: 40,\n    decayRate: 1.0,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Angle of ear protrusion from head',\n    profileType: 'front',\n  },\n\n  earProtrusionRatio: {\n    id: 'earProtrusionRatio',\n    name: 'Ear Protrusion Ratio',\n    category: 'Other',\n    unit: 'percent',\n    idealMin: 15,\n    idealMax: 25,\n    rangeMin: 8,\n    rangeMax: 40,\n    decayRate: 1.5,\n    maxScore: 10,\n    weight: 0.01,\n    description: 'Ear protrusion as percentage of ear height',\n    profileType: 'front',\n  },\n};\n\n// ============================================\n// CATEGORY DEFINITIONS\n// ============================================\n\nexport const MEASUREMENT_CATEGORIES = {\n  'Midface/Face Shape': { color: '#67e8f9', weight: 0.20 },\n  'Occlusion/Jaw Growth': { color: '#a78bfa', weight: 0.15 },\n  'Jaw Shape': { color: '#f97316', weight: 0.13 },\n  'Upper Third': { color: '#84cc16', weight: 0.08 },\n  'Eyes': { color: '#06b6d4', weight: 0.12 },\n  'Nose': { color: '#fbbf24', weight: 0.10 },\n  'Lips': { color: '#ec4899', weight: 0.10 },\n  'Chin': { color: '#ef4444', weight: 0.06 },\n  'Neck': { color: '#14b8a6', weight: 0.03 },\n  'Other': { color: '#6b7280', weight: 0.03 },\n};\n\n// ============================================\n// CORE SCORING FUNCTIONS\n// ============================================\n\n/**\n * FaceIQ Exponential Decay Scoring Algorithm\n * score = maxScore × e^(-decayRate × deviation)\n */\nexport function calculateFaceIQScore(\n  value: number,\n  config: MetricConfig\n): number {\n  const { idealMin, idealMax, decayRate, maxScore, customCurve } = config;\n\n  // Use custom curve if available\n  if (customCurve && customCurve.mode === 'custom') {\n    return interpolateCustomCurve(value, customCurve.points, maxScore);\n  }\n\n  // Perfect score within ideal range\n  if (value >= idealMin && value <= idealMax) {\n    return maxScore;\n  }\n\n  // Calculate deviation from ideal range\n  const deviation = value < idealMin\n    ? idealMin - value\n    : value - idealMax;\n\n  // Exponential decay\n  const score = maxScore * Math.exp(-decayRate * deviation);\n\n  return Math.max(0, Math.min(maxScore, score));\n}\n\n/**\n * Interpolate custom Bezier curve for scoring\n */\nfunction interpolateCustomCurve(\n  value: number,\n  points: CurvePoint[],\n  maxScore: number\n): number {\n  if (points.length === 0) return 0;\n\n  // Sort points by x value\n  const sortedPoints = [...points].sort((a, b) => a.x - b.x);\n\n  // Find bracketing points\n  let lowerIndex = 0;\n  let upperIndex = sortedPoints.length - 1;\n\n  for (let i = 0; i < sortedPoints.length - 1; i++) {\n    if (value >= sortedPoints[i].x && value <= sortedPoints[i + 1].x) {\n      lowerIndex = i;\n      upperIndex = i + 1;\n      break;\n    }\n  }\n\n  // Clamp to range\n  if (value <= sortedPoints[0].x) return sortedPoints[0].y;\n  if (value >= sortedPoints[sortedPoints.length - 1].x) {\n    return sortedPoints[sortedPoints.length - 1].y;\n  }\n\n  // Linear interpolation between points\n  const lower = sortedPoints[lowerIndex];\n  const upper = sortedPoints[upperIndex];\n  const t = (value - lower.x) / (upper.x - lower.x);\n\n  return lower.y + t * (upper.y - lower.y);\n}\n\n/**\n * Calculate standardized score (0-10 normalized)\n */\nexport function standardizeScore(score: number, maxScore: number): number {\n  return (score / maxScore) * 10;\n}\n\n/**\n * Determine quality tier based on score\n */\nexport function getQualityTier(score: number, maxScore: number = 10): QualityTier {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 90) return 'ideal';\n  if (normalized >= 70) return 'excellent';\n  if (normalized >= 50) return 'good';\n  return 'below_average';\n}\n\n/**\n * Determine severity level based on score\n */\nexport function getSeverityLevel(score: number, maxScore: number = 10): SeverityLevel {\n  const normalized = (score / maxScore) * 100;\n\n  if (normalized >= 85) return 'optimal';\n  if (normalized >= 70) return 'minor';\n  if (normalized >= 50) return 'moderate';\n  if (normalized >= 30) return 'major';\n  if (normalized >= 15) return 'severe';\n  return 'extremely_severe';\n}\n\n/**\n * Calculate deviation description\n */\nexport function getDeviationDescription(\n  value: number,\n  idealMin: number,\n  idealMax: number,\n  unit: MeasurementUnit\n): { deviation: number; direction: 'above' | 'below' | 'within'; description: string } {\n  if (value >= idealMin && value <= idealMax) {\n    return { deviation: 0, direction: 'within', description: 'within ideal range' };\n  }\n\n  const unitLabel = getUnitLabel(unit);\n\n  if (value < idealMin) {\n    const dev = idealMin - value;\n    return {\n      deviation: dev,\n      direction: 'below',\n      description: `${dev.toFixed(2)}${unitLabel} below ideal`,\n    };\n  }\n\n  const dev = value - idealMax;\n  return {\n    deviation: dev,\n    direction: 'above',\n    description: `${dev.toFixed(2)}${unitLabel} above ideal`,\n  };\n}\n\nfunction getUnitLabel(unit: MeasurementUnit): string {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return '°';\n    case 'mm': return 'mm';\n    default: return '';\n  }\n}\n\n// ============================================\n// MEASUREMENT CALCULATION UTILITIES\n// ============================================\n\n/**\n * Calculate distance between two points\n */\nexport function distance(p1: Point, p2: Point): number {\n  return Math.sqrt(Math.pow(p2.x - p1.x, 2) + Math.pow(p2.y - p1.y, 2));\n}\n\n/**\n * Calculate angle at vertex point (in degrees)\n */\nexport function calculateAngle(p1: Point, vertex: Point, p2: Point): number {\n  const v1 = { x: p1.x - vertex.x, y: p1.y - vertex.y };\n  const v2 = { x: p2.x - vertex.x, y: p2.y - vertex.y };\n\n  const dot = v1.x * v2.x + v1.y * v2.y;\n  const cross = v1.x * v2.y - v1.y * v2.x;\n\n  const angle = Math.atan2(cross, dot) * (180 / Math.PI);\n  return Math.abs(angle);\n}\n\n/**\n * Calculate perpendicular distance from point to line (signed)\n */\nexport function perpendicularDistance(\n  point: Point,\n  lineStart: Point,\n  lineEnd: Point\n): number {\n  const A = point.x - lineStart.x;\n  const B = point.y - lineStart.y;\n  const C = lineEnd.x - lineStart.x;\n  const D = lineEnd.y - lineStart.y;\n\n  const dot = A * C + B * D;\n  const lenSq = C * C + D * D;\n  const param = lenSq !== 0 ? dot / lenSq : -1;\n\n  let xx: number, yy: number;\n\n  if (param < 0) {\n    xx = lineStart.x;\n    yy = lineStart.y;\n  } else if (param > 1) {\n    xx = lineEnd.x;\n    yy = lineEnd.y;\n  } else {\n    xx = lineStart.x + param * C;\n    yy = lineStart.y + param * D;\n  }\n\n  const dx = point.x - xx;\n  const dy = point.y - yy;\n\n  const sign =\n    (lineEnd.y - lineStart.y) * point.x -\n      (lineEnd.x - lineStart.x) * point.y +\n      lineEnd.x * lineStart.y -\n      lineEnd.y * lineStart.x >=\n    0\n      ? 1\n      : -1;\n\n  return sign * Math.sqrt(dx * dx + dy * dy);\n}\n\n/**\n * Helper to get landmark by ID\n */\nfunction getLandmark(landmarks: LandmarkPoint[], id: string): Point | null {\n  const lm = landmarks.find((l) => l.id === id);\n  return lm ? { x: lm.x, y: lm.y } : null;\n}\n\n// ============================================\n// SCORE A SINGLE MEASUREMENT\n// ============================================\n\n/**\n * Calculate complete score result for a measurement\n */\nexport function scoreMeasurement(\n  metricId: string,\n  value: number\n): FaceIQScoreResult | null {\n  const config = FACEIQ_METRICS[metricId];\n  if (!config) return null;\n\n  const score = calculateFaceIQScore(value, config);\n  const standardizedScore = standardizeScore(score, config.maxScore);\n  const qualityTier = getQualityTier(score, config.maxScore);\n  const severity = getSeverityLevel(score, config.maxScore);\n  const { deviation, direction, description } = getDeviationDescription(\n    value,\n    config.idealMin,\n    config.idealMax,\n    config.unit\n  );\n\n  return {\n    metricId,\n    name: config.name,\n    value,\n    score,\n    standardizedScore,\n    qualityTier,\n    severity,\n    idealMin: config.idealMin,\n    idealMax: config.idealMax,\n    deviation,\n    deviationDirection: direction,\n    unit: config.unit,\n    category: config.category,\n  };\n}\n\n// ============================================\n// FRONT PROFILE ANALYSIS\n// ============================================\n\nexport interface FrontProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all front profile measurements from landmarks\n */\nexport function analyzeFrontProfile(\n  landmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): FrontProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n\n  // Helper to add measurement if landmarks available\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const trichion = getLandmark(landmarks, 'trichion');\n  const nasalBase = getLandmark(landmarks, 'nasal_base');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const menton = getLandmark(landmarks, 'menton');\n  const leftZygion = getLandmark(landmarks, 'left_zygion');\n  const rightZygion = getLandmark(landmarks, 'right_zygion');\n  const leftGonion = getLandmark(landmarks, 'left_gonion_inferior');\n  const rightGonion = getLandmark(landmarks, 'right_gonion_inferior');\n  const leftPupil = getLandmark(landmarks, 'left_pupila');\n  const rightPupil = getLandmark(landmarks, 'right_pupila');\n  const leftCanthusM = getLandmark(landmarks, 'left_canthus_medialis');\n  const leftCanthusL = getLandmark(landmarks, 'left_canthus_lateralis');\n  const rightCanthusM = getLandmark(landmarks, 'right_canthus_medialis');\n  const rightCanthusL = getLandmark(landmarks, 'right_canthus_lateralis');\n  const leftAlaNasi = getLandmark(landmarks, 'left_ala_nasi');\n  const rightAlaNasi = getLandmark(landmarks, 'right_ala_nasi');\n  const leftCheilion = getLandmark(landmarks, 'left_cheilion');\n  const rightCheilion = getLandmark(landmarks, 'right_cheilion');\n  const labraleSuperius = getLandmark(landmarks, 'labrale_superius');\n  const labraleInferius = getLandmark(landmarks, 'labrale_inferius');\n\n  // FACIAL THIRDS\n  if (trichion && nasalBase && subnasale && menton) {\n    const totalHeight = distance(trichion, menton);\n    if (totalHeight > 0) {\n      const upperThird = (distance(trichion, nasalBase) / totalHeight) * 100;\n      const middleThird = (distance(nasalBase, subnasale) / totalHeight) * 100;\n      const lowerThird = (distance(subnasale, menton) / totalHeight) * 100;\n\n      addMeasurement('upperThirdProportion', upperThird);\n      addMeasurement('middleThirdProportion', middleThird);\n      addMeasurement('lowerThirdProportion', lowerThird);\n    }\n  }\n\n  // FACE WIDTH TO HEIGHT RATIO (FWHR)\n  if (leftZygion && rightZygion && nasalBase && labraleSuperius) {\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    const upperFaceHeight = distance(nasalBase, labraleSuperius);\n    if (upperFaceHeight > 0) {\n      addMeasurement('faceWidthToHeight', bizygomaticWidth / upperFaceHeight);\n    }\n  }\n\n  // TOTAL FACIAL WIDTH TO HEIGHT\n  if (leftZygion && rightZygion && trichion && menton) {\n    const cheekWidth = distance(leftZygion, rightZygion);\n    const totalHeight = distance(trichion, menton);\n    if (cheekWidth > 0) {\n      addMeasurement('totalFacialWidthToHeight', totalHeight / cheekWidth);\n    }\n  }\n\n  // JAW WIDTH RATIO\n  if (leftGonion && rightGonion && leftZygion && rightZygion) {\n    const bigonialWidth = distance(leftGonion, rightGonion);\n    const bizygomaticWidth = distance(leftZygion, rightZygion);\n    if (bizygomaticWidth > 0) {\n      const ratio = bigonialWidth / bizygomaticWidth;\n      addMeasurement('jawWidthRatio', ratio);\n      addMeasurement('bigonialWidth', ratio * 100);\n    }\n  }\n\n  // CANTHAL TILT\n  if (leftCanthusM && leftCanthusL) {\n    const deltaY = leftCanthusM.y - leftCanthusL.y;\n    const deltaX = leftCanthusL.x - leftCanthusM.x;\n    const angle = Math.atan2(deltaY, deltaX) * (180 / Math.PI);\n    addMeasurement('lateralCanthalTilt', angle);\n  }\n\n  // EYE ASPECT RATIO\n  if (leftCanthusM && leftCanthusL) {\n    const leftPalpSup = getLandmark(landmarks, 'left_palpebra_superior');\n    const leftPalpInf = getLandmark(landmarks, 'left_palpebra_inferior');\n    if (leftPalpSup && leftPalpInf) {\n      const eyeWidth = distance(leftCanthusM, leftCanthusL);\n      const eyeHeight = distance(leftPalpSup, leftPalpInf);\n      if (eyeWidth > 0) {\n        addMeasurement('eyeAspectRatio', eyeHeight / eyeWidth);\n      }\n    }\n  }\n\n  // EYE SEPARATION RATIO\n  if (leftCanthusM && rightCanthusM && leftZygion && rightZygion) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('eyeSeparationRatio', intercanthal / bizygomatic);\n    }\n  }\n\n  // IPD RATIO\n  if (leftPupil && rightPupil && leftZygion && rightZygion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const bizygomatic = distance(leftZygion, rightZygion);\n    if (bizygomatic > 0) {\n      addMeasurement('interpupillaryRatio', (ipd / bizygomatic) * 100);\n    }\n  }\n\n  // ONE EYE APART TEST\n  if (leftCanthusM && rightCanthusM && leftCanthusL) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const eyeWidth = distance(leftCanthusM, leftCanthusL);\n    if (eyeWidth > 0) {\n      addMeasurement('oneEyeApartTest', intercanthal / eyeWidth);\n    }\n  }\n\n  // NASAL INDEX\n  if (leftAlaNasi && rightAlaNasi && nasalBase && subnasale) {\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    const nasalHeight = distance(nasalBase, subnasale);\n    if (nasalHeight > 0) {\n      addMeasurement('nasalIndex', (nasalWidth / nasalHeight) * 100);\n    }\n  }\n\n  // INTERCANTHAL-NASAL WIDTH RATIO\n  if (leftCanthusM && rightCanthusM && leftAlaNasi && rightAlaNasi) {\n    const intercanthal = distance(leftCanthusM, rightCanthusM);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('intercanthalNasalRatio', intercanthal / nasalWidth);\n    }\n  }\n\n  // MOUTH TO NOSE RATIO\n  if (leftCheilion && rightCheilion && leftAlaNasi && rightAlaNasi) {\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    const nasalWidth = distance(leftAlaNasi, rightAlaNasi);\n    if (nasalWidth > 0) {\n      addMeasurement('mouthWidthToNoseRatio', mouthWidth / nasalWidth);\n    }\n  }\n\n  // IPD TO MOUTH WIDTH RATIO\n  if (leftPupil && rightPupil && leftCheilion && rightCheilion) {\n    const ipd = distance(leftPupil, rightPupil);\n    const mouthWidth = distance(leftCheilion, rightCheilion);\n    if (ipd > 0) {\n      addMeasurement('interpupillaryMouthWidthRatio', mouthWidth / ipd);\n    }\n  }\n\n  // LIP RATIO\n  if (labraleSuperius && labraleInferius && subnasale) {\n    const mouthMiddle = getLandmark(landmarks, 'mouth_middle');\n    if (mouthMiddle) {\n      const upperLipHeight = distance(subnasale, labraleSuperius);\n      const lowerLipHeight = distance(mouthMiddle, labraleInferius);\n      if (upperLipHeight > 0) {\n        addMeasurement('lowerToUpperLipRatio', lowerLipHeight / upperLipHeight);\n      }\n    }\n  }\n\n  // MIDFACE RATIO\n  if (leftZygion && rightZygion && nasalBase && subnasale) {\n    const midfaceWidth = distance(leftZygion, rightZygion);\n    const midfaceHeight = distance(nasalBase, subnasale);\n    if (midfaceHeight > 0) {\n      addMeasurement('midfaceRatio', midfaceWidth / midfaceHeight / 10); // Normalized\n    }\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score (weighted average)\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n  const standardizedScore = overallScore;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// SIDE PROFILE ANALYSIS\n// ============================================\n\nexport interface SideProfileResults {\n  measurements: FaceIQScoreResult[];\n  overallScore: number;\n  standardizedScore: number;\n  qualityTier: QualityTier;\n  categoryScores: Record<string, number>;\n}\n\n/**\n * Calculate all side profile measurements from landmarks\n */\nexport function analyzeSideProfile(\n  landmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): SideProfileResults {\n  const measurements: FaceIQScoreResult[] = [];\n\n  const addMeasurement = (metricId: string, value: number | null) => {\n    if (value !== null) {\n      const result = scoreMeasurement(metricId, value);\n      if (result) measurements.push(result);\n    }\n  };\n\n  // Get key landmarks\n  const glabella = getLandmark(landmarks, 'glabella');\n  const nasion = getLandmark(landmarks, 'nasion');\n  const rhinion = getLandmark(landmarks, 'rhinion');\n  const pronasale = getLandmark(landmarks, 'pronasale');\n  const columella = getLandmark(landmarks, 'columella');\n  const subnasale = getLandmark(landmarks, 'subnasale');\n  const labraleSuperius = getLandmark(landmarks, 'labraleSuperius');\n  const labraleInferius = getLandmark(landmarks, 'labraleInferius');\n  const sublabiale = getLandmark(landmarks, 'sublabiale');\n  const pogonion = getLandmark(landmarks, 'pogonion');\n  const menton = getLandmark(landmarks, 'menton');\n  const tragus = getLandmark(landmarks, 'tragus');\n  const gonionBottom = getLandmark(landmarks, 'gonionBottom');\n  const cervicalPoint = getLandmark(landmarks, 'cervicalPoint');\n  const orbitale = getLandmark(landmarks, 'orbitale');\n  const porion = getLandmark(landmarks, 'porion');\n\n  // GONIAL ANGLE\n  if (tragus && gonionBottom && menton) {\n    const angle = calculateAngle(tragus, gonionBottom, menton);\n    addMeasurement('gonialAngle', angle);\n  }\n\n  // NASOLABIAL ANGLE\n  if (columella && subnasale && labraleSuperius) {\n    const angle = calculateAngle(columella, subnasale, labraleSuperius);\n    addMeasurement('nasolabialAngle', angle);\n  }\n\n  // NASOFRONTAL ANGLE\n  if (glabella && nasion && rhinion) {\n    const angle = calculateAngle(glabella, nasion, rhinion);\n    addMeasurement('nasofrontalAngle', angle);\n  }\n\n  // MENTOLABIAL ANGLE\n  if (labraleInferius && sublabiale && pogonion) {\n    const angle = calculateAngle(labraleInferius, sublabiale, pogonion);\n    addMeasurement('mentolabialAngle', angle);\n  }\n\n  // E-LINE MEASUREMENTS\n  if (pronasale && pogonion && labraleSuperius && labraleInferius) {\n    const upperLipDist = perpendicularDistance(labraleSuperius, pronasale, pogonion);\n    const lowerLipDist = perpendicularDistance(labraleInferius, pronasale, pogonion);\n    addMeasurement('eLineUpperLip', upperLipDist);\n    addMeasurement('eLineLowerLip', lowerLipDist);\n  }\n\n  // NASOMENTAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    const angle = calculateAngle(nasion, pronasale, pogonion);\n    addMeasurement('nasomentaAngle', angle);\n  }\n\n  // FACIAL CONVEXITY (GLABELLA)\n  if (glabella && subnasale && pogonion) {\n    const angle = calculateAngle(glabella, subnasale, pogonion);\n    addMeasurement('facialConvexityGlabella', angle);\n  }\n\n  // FACIAL CONVEXITY (NASION)\n  if (nasion && subnasale && pogonion) {\n    const angle = calculateAngle(nasion, subnasale, pogonion);\n    addMeasurement('facialConvexityNasion', angle);\n  }\n\n  // TOTAL FACIAL CONVEXITY\n  if (glabella && pronasale && pogonion) {\n    const angle = calculateAngle(glabella, pronasale, pogonion);\n    addMeasurement('totalFacialConvexity', angle);\n  }\n\n  // SUBMENTAL CERVICAL ANGLE\n  if (menton && cervicalPoint && pogonion) {\n    const neckPoint = getLandmark(landmarks, 'neckPoint');\n    if (neckPoint) {\n      const angle = calculateAngle(pogonion, menton, neckPoint);\n      addMeasurement('submentalCervicalAngle', angle);\n    }\n  }\n\n  // NASAL PROJECTION (Goode ratio)\n  if (pronasale && subnasale && nasion) {\n    const projection = distance(pronasale, subnasale);\n    const nasalLength = distance(nasion, pronasale);\n    if (nasalLength > 0) {\n      addMeasurement('nasalProjection', projection / nasalLength);\n    }\n  }\n\n  // NASOFACIAL ANGLE\n  if (nasion && pronasale && pogonion) {\n    // Angle between nose dorsum and facial plane\n    const nasalDorsum = { x: pronasale.x - nasion.x, y: pronasale.y - nasion.y };\n    const facialPlane = { x: pogonion.x - nasion.x, y: pogonion.y - nasion.y };\n\n    const dot = nasalDorsum.x * facialPlane.x + nasalDorsum.y * facialPlane.y;\n    const mag1 = Math.sqrt(nasalDorsum.x ** 2 + nasalDorsum.y ** 2);\n    const mag2 = Math.sqrt(facialPlane.x ** 2 + facialPlane.y ** 2);\n\n    if (mag1 > 0 && mag2 > 0) {\n      const angle = Math.acos(dot / (mag1 * mag2)) * (180 / Math.PI);\n      addMeasurement('nasofacialAngle', angle);\n    }\n  }\n\n  // MANDIBULAR PLANE ANGLE (using Frankfort horizontal)\n  if (porion && orbitale && gonionBottom && menton) {\n    // Frankfort horizontal is porion to orbitale\n    // Mandibular plane is gonion to menton\n    const fhAngle = Math.atan2(orbitale.y - porion.y, orbitale.x - porion.x);\n    const mpAngle = Math.atan2(menton.y - gonionBottom.y, menton.x - gonionBottom.x);\n    const angle = Math.abs(fhAngle - mpAngle) * (180 / Math.PI);\n    addMeasurement('mandibularPlaneAngle', angle);\n  }\n\n  // CHIN PROJECTION\n  if (pogonion && subnasale) {\n    // Distance from pogonion to vertical line through subnasale\n    const projection = pogonion.x - subnasale.x;\n    addMeasurement('chinProjection', projection);\n  }\n\n  // Calculate category scores\n  const categoryScores: Record<string, { total: number; count: number }> = {};\n  for (const m of measurements) {\n    if (!categoryScores[m.category]) {\n      categoryScores[m.category] = { total: 0, count: 0 };\n    }\n    categoryScores[m.category].total += m.standardizedScore;\n    categoryScores[m.category].count++;\n  }\n\n  const categoryAvg: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(categoryScores)) {\n    categoryAvg[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Calculate overall score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of measurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  return {\n    measurements,\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    categoryScores: categoryAvg,\n  };\n}\n\n// ============================================\n// COMPLETE HARMONY ANALYSIS\n// ============================================\n\n/**\n * Run complete facial harmony analysis\n */\nexport function analyzeHarmony(\n  frontLandmarks: LandmarkPoint[],\n  sideLandmarks: LandmarkPoint[],\n  gender: 'male' | 'female' = 'male'\n): HarmonyAnalysis {\n  const frontResults = analyzeFrontProfile(frontLandmarks, gender);\n  const sideResults = analyzeSideProfile(sideLandmarks, gender);\n\n  const allMeasurements = [...frontResults.measurements, ...sideResults.measurements];\n\n  // Combined category scores\n  const allCategories: Record<string, { total: number; count: number }> = {};\n  for (const m of allMeasurements) {\n    if (!allCategories[m.category]) {\n      allCategories[m.category] = { total: 0, count: 0 };\n    }\n    allCategories[m.category].total += m.standardizedScore;\n    allCategories[m.category].count++;\n  }\n\n  const categoryScores: Record<string, number> = {};\n  for (const [cat, data] of Object.entries(allCategories)) {\n    categoryScores[cat] = data.count > 0 ? data.total / data.count : 0;\n  }\n\n  // Overall weighted score\n  let totalWeight = 0;\n  let weightedSum = 0;\n  for (const m of allMeasurements) {\n    const config = FACEIQ_METRICS[m.metricId];\n    if (config) {\n      weightedSum += m.standardizedScore * config.weight;\n      totalWeight += config.weight;\n    }\n  }\n\n  const overallScore = totalWeight > 0 ? weightedSum / totalWeight : 0;\n\n  // Identify flaws (below average measurements)\n  const flaws: FlawAssessment[] = allMeasurements\n    .filter((m) => m.severity !== 'optimal' && m.severity !== 'minor')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      severity: m.severity,\n      deviation: `${m.deviation.toFixed(2)} ${m.deviationDirection} ideal`,\n      reasoning: `${m.name} is outside the ideal range`,\n      confidence: m.severity === 'extremely_severe' || m.severity === 'severe'\n        ? 'confirmed' as const\n        : 'likely' as const,\n    }))\n    .sort((a, b) => {\n      const severityOrder = { extremely_severe: 0, severe: 1, major: 2, moderate: 3 };\n      return (severityOrder[a.severity as keyof typeof severityOrder] ?? 4) -\n             (severityOrder[b.severity as keyof typeof severityOrder] ?? 4);\n    });\n\n  // Identify strengths (ideal measurements)\n  const strengths: StrengthAssessment[] = allMeasurements\n    .filter((m) => m.qualityTier === 'ideal' || m.qualityTier === 'excellent')\n    .map((m) => ({\n      category: m.category,\n      metricId: m.metricId,\n      metricName: m.name,\n      qualityTier: m.qualityTier,\n      value: m.value,\n      reasoning: `${m.name} is within the ${m.qualityTier} range`,\n    }));\n\n  // Calculate percentile (based on population stats)\n  const percentile = calculateHarmonyPercentile(overallScore);\n\n  return {\n    overallScore,\n    standardizedScore: overallScore,\n    qualityTier: getQualityTier(overallScore),\n    percentile,\n    frontScore: frontResults.overallScore,\n    sideScore: sideResults.overallScore,\n    categoryScores,\n    measurements: allMeasurements,\n    flaws,\n    strengths,\n  };\n}\n\n/**\n * Calculate percentile from harmony score\n */\nfunction calculateHarmonyPercentile(score: number): number {\n  // Based on normal distribution with mean=5, stdDev=1.5\n  const mean = 5;\n  const stdDev = 1.5;\n  const z = (score - mean) / stdDev;\n  return normalCDF(z) * 100;\n}\n\n/**\n * Standard normal CDF approximation\n */\nfunction normalCDF(z: number): number {\n  const a1 = 0.254829592;\n  const a2 = -0.284496736;\n  const a3 = 1.421413741;\n  const a4 = -1.453152027;\n  const a5 = 1.061405429;\n  const p = 0.3275911;\n\n  const sign = z < 0 ? -1 : 1;\n  const absZ = Math.abs(z) / Math.sqrt(2);\n\n  const t = 1.0 / (1.0 + p * absZ);\n  const y = 1.0 - ((((a5 * t + a4) * t + a3) * t + a2) * t + a1) * t * Math.exp(-absZ * absZ);\n\n  return 0.5 * (1.0 + sign * y);\n}\n\n// ============================================\n// PSL RATING CONVERSION\n// ============================================\n\nexport interface PSLRating {\n  score: number;\n  tier: string;\n  percentile: number;\n  description: string;\n}\n\n/**\n * Convert harmony score to PSL rating\n */\nexport function convertToPSL(harmonyScore: number): PSLRating {\n  // Convert 0-10 harmony to 3.0-7.5 PSL range\n  const psl = 3.0 + (harmonyScore / 10) * 4.5;\n  const clampedPSL = Math.max(3.0, Math.min(7.5, psl));\n\n  let tier: string;\n  let percentile: number;\n\n  if (clampedPSL >= 7.5) {\n    tier = 'Top Model';\n    percentile = 99.99;\n  } else if (clampedPSL >= 7.0) {\n    tier = 'Chad';\n    percentile = 99.87;\n  } else if (clampedPSL >= 6.5) {\n    tier = 'Chadlite';\n    percentile = 99.0;\n  } else if (clampedPSL >= 6.0) {\n    tier = 'High Tier Normie+';\n    percentile = 97.25;\n  } else if (clampedPSL >= 5.5) {\n    tier = 'High Tier Normie';\n    percentile = 90.0;\n  } else if (clampedPSL >= 5.0) {\n    tier = 'Mid Tier Normie+';\n    percentile = 84.15;\n  } else if (clampedPSL >= 4.5) {\n    tier = 'Mid Tier Normie';\n    percentile = 65.0;\n  } else if (clampedPSL >= 4.0) {\n    tier = 'Low Tier Normie';\n    percentile = 50.0;\n  } else if (clampedPSL >= 3.5) {\n    tier = 'Below Average';\n    percentile = 30.0;\n  } else {\n    tier = 'Subpar';\n    percentile = 15.0;\n  }\n\n  return {\n    score: clampedPSL,\n    tier,\n    percentile,\n    description: `${tier} (top ${(100 - percentile).toFixed(1)}%)`,\n  };\n}\n\n// ============================================\n// EXPORTS FOR BACKWARD COMPATIBILITY\n// ============================================\n\nexport type { LandmarkPoint } from './landmarks';\n","numLines":2148,"startLine":1,"totalLines":2148}}}
{"parentUuid":"f07e2170-21fc-4646-9e01-77e2885cff5c","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_013UJaWqbHPKuSKiJ8Hk7VZt","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/HeadScene.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/HeroBackground.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/GenderContext.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/UploadContext.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/Providers.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useFaceApi.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/BellCurveChart.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/layout.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/login/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/ResultsDashboard.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/gender/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/EthnicityContext.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/ethnicity/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/analysis/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/upload/page.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/LandmarkDot.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useContainerBounds.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/FrontProfileLandmarks.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/GuidedLandmarkPlacement.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useZoomPan.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceDetectionService.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useFaceLandmarker.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarkImages.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useAutoDetection.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/SideProfileManualTool.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/sideProfileDetection.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/mediapipeDetection.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/LandmarkAnalysisTool.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/api/side-landmarks/route.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/AuthContext.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/api.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/serverSideDetection.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/types.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/nonSurgical.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/index.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/softmaxxing.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/supplements.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/hardmaxxing.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/severity.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/engine.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring.ts"}]},"uuid":"367a18bf-69d3-4491-8712-243ae5a4e765","timestamp":"2025-12-20T15:49:51.699Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/HeadScene.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/HeroBackground.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/GenderContext.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/UploadContext.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/Providers.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useFaceApi.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/BellCurveChart.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/layout.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/page.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/login/page.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/ResultsDashboard.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/gender/page.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/EthnicityContext.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/ethnicity/page.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/analysis/page.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/upload/page.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/LandmarkDot.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useContainerBounds.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/FrontProfileLandmarks.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/GuidedLandmarkPlacement.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useZoomPan.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceDetectionService.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useFaceLandmarker.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarkImages.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/hooks/useAutoDetection.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/SideProfileManualTool.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/sideProfileDetection.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/mediapipeDetection.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/LandmarkAnalysisTool.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/api/side-landmarks/route.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/AuthContext.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/api.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/serverSideDetection.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/types.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/nonSurgical.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/index.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/softmaxxing.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/supplements.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/hardmaxxing.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/severity.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/engine.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/scoring.ts"],"durationMs":380,"numFiles":44,"truncated":false}}
{"parentUuid":"367a18bf-69d3-4491-8712-243ae5a4e765","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_01YQxzrmw7gQRbEhGwhjN7qS","type":"message","role":"assistant","content":[{"type":"text","text":"Let me explore more files to understand the existing architecture, particularly the landmarks, recommendations system, and the app structure."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":43264,"cache_creation_input_tokens":1727,"cache_read_input_tokens":13352,"cache_creation":{"ephemeral_5m_input_tokens":1727,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJCnGTfXZTNoNL35CXF1","type":"assistant","uuid":"e52ada5d-b75c-43a0-8fe4-e5c3cd6cfcc8","timestamp":"2025-12-20T15:49:57.847Z"}
{"parentUuid":"e52ada5d-b75c-43a0-8fe4-e5c3cd6cfcc8","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_01YQxzrmw7gQRbEhGwhjN7qS","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01D5sfoigtf7g9Jtcfyzs21d","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":43264,"cache_creation_input_tokens":1727,"cache_read_input_tokens":13352,"cache_creation":{"ephemeral_5m_input_tokens":1727,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJCnGTfXZTNoNL35CXF1","type":"assistant","uuid":"b259629a-c88f-4ede-b0e1-c083df9fa4c3","timestamp":"2025-12-20T15:49:58.831Z"}
{"parentUuid":"b259629a-c88f-4ede-b0e1-c083df9fa4c3","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_01YQxzrmw7gQRbEhGwhjN7qS","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01BJRKHVEqmZF42qhPHBxGE1","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/types.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":43264,"cache_creation_input_tokens":1727,"cache_read_input_tokens":13352,"cache_creation":{"ephemeral_5m_input_tokens":1727,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJCnGTfXZTNoNL35CXF1","type":"assistant","uuid":"d04815fc-e7ea-4518-b29e-0a8c0c10a542","timestamp":"2025-12-20T15:49:59.327Z"}
{"parentUuid":"d04815fc-e7ea-4518-b29e-0a8c0c10a542","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_01YQxzrmw7gQRbEhGwhjN7qS","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01AVc1VfYdK64cQG4vgzGD44","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/engine.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":43264,"cache_creation_input_tokens":1727,"cache_read_input_tokens":13352,"cache_creation":{"ephemeral_5m_input_tokens":1727,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJCnGTfXZTNoNL35CXF1","type":"assistant","uuid":"14e3c20d-ab19-487d-bf94-d2bb9fb0b734","timestamp":"2025-12-20T15:49:59.796Z"}
{"parentUuid":"14e3c20d-ab19-487d-bf94-d2bb9fb0b734","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_01YQxzrmw7gQRbEhGwhjN7qS","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WgrjC6E7h7vTEMsY7WJp1p","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/analysis/page.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":43264,"cache_creation_input_tokens":1727,"cache_read_input_tokens":13352,"cache_creation":{"ephemeral_5m_input_tokens":1727,"ephemeral_1h_input_tokens":0},"output_tokens":295,"service_tier":"standard"}},"requestId":"req_011CWJCnGTfXZTNoNL35CXF1","type":"assistant","uuid":"c4ac5052-9715-43ec-aeb1-05231e8e1a02","timestamp":"2025-12-20T15:50:00.209Z"}
{"parentUuid":"c4ac5052-9715-43ec-aeb1-05231e8e1a02","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01BJRKHVEqmZF42qhPHBxGE1","type":"tool_result","content":"     1→/**\n     2→ * Recommendation System Types\n     3→ * Comprehensive type definitions for looksmaxxing recommendations\n     4→ */\n     5→\n     6→// ============================================\n     7→// ENUMS & BASIC TYPES\n     8→// ============================================\n     9→\n    10→export type Severity = 'optimal' | 'mild' | 'moderate' | 'severe';\n    11→\n    12→export type TreatmentCategory =\n    13→  | 'lifestyle'\n    14→  | 'softmaxxing'\n    15→  | 'non_surgical'\n    16→  | 'minimally_invasive'\n    17→  | 'surgical';\n    18→\n    19→export type CostLevel = 'free' | 'low' | 'medium' | 'high' | 'very_high';\n    20→\n    21→export type EvidenceLevel = 'strong' | 'moderate' | 'weak' | 'anecdotal';\n    22→\n    23→export type RiskLevel = 'none' | 'very_low' | 'low' | 'medium' | 'high' | 'very_high';\n    24→\n    25→export type Gender = 'male' | 'female';\n    26→\n    27→export type ProfileType = 'front' | 'side';\n    28→\n    29→// ============================================\n    30→// TREATMENT TYPES\n    31→// ============================================\n    32→\n    33→export interface Treatment {\n    34→  id: string;\n    35→  name: string;\n    36→  category: TreatmentCategory;\n    37→  description: string;\n    38→  howItWorks: string;\n    39→\n    40→  // Effectiveness\n    41→  effectiveness: number; // 1-10\n    42→  evidenceLevel: EvidenceLevel;\n    43→  pslImprovement: { min: number; max: number };\n    44→\n    45→  // Costs\n    46→  costLevel: CostLevel;\n    47→  costRange: { min: number; max: number; currency: string };\n    48→  costFrequency: 'one-time' | 'monthly' | 'per-session' | 'annual';\n    49→\n    50→  // Timeline\n    51→  timelineToResults: string;\n    52→  resultsDuration: string;\n    53→  maintenanceRequired: boolean;\n    54→  maintenanceFrequency?: string;\n    55→\n    56→  // Recovery\n    57→  recoveryTime: string;\n    58→  downtime: string;\n    59→  painLevel: 'none' | 'low' | 'moderate' | 'high';\n    60→\n    61→  // Risk\n    62→  riskLevel: RiskLevel;\n    63→  sideEffects: string[];\n    64→  contraindications: string[];\n    65→\n    66→  // Applicability\n    67→  targetMetrics: string[];\n    68→  targetIssues: string[];\n    69→  genderSpecific?: Gender;\n    70→  ageRestrictions?: { min?: number; max?: number };\n    71→\n    72→  // Additional info\n    73→  notes?: string[];\n    74→  sources?: string[];\n    75→}\n    76→\n    77→export interface Surgery extends Treatment {\n    78→  category: 'surgical';\n    79→  surgeonRecommendations?: SurgeonInfo[];\n    80→  regionalCosts: RegionalCost[];\n    81→  revisionRate?: number;\n    82→  permanence: 'permanent' | 'semi-permanent' | 'temporary';\n    83→  hospitalStay?: string;\n    84→  anesthesiaType: 'local' | 'sedation' | 'general';\n    85→}\n    86→\n    87→export interface SurgeonInfo {\n    88→  name: string;\n    89→  location: string;\n    90→  specialty: string;\n    91→  costRange: string;\n    92→  notes?: string;\n    93→}\n    94→\n    95→export interface RegionalCost {\n    96→  region: string;\n    97→  min: number;\n    98→  max: number;\n    99→  currency: string;\n   100→  notes?: string;\n   101→}\n   102→\n   103→export interface Supplement {\n   104→  id: string;\n   105→  name: string;\n   106→  category: 'skin' | 'hair' | 'bone' | 'hormonal' | 'anti-aging' | 'general';\n   107→  description: string;\n   108→\n   109→  // Dosage\n   110→  dosage: string;\n   111→  frequency: string;\n   112→  timing?: string; // e.g., \"with meals\", \"before bed\"\n   113→\n   114→  // Effectiveness\n   115→  effectiveness: number; // 1-10\n   116→  evidenceLevel: EvidenceLevel;\n   117→\n   118→  // Cost\n   119→  costPerMonth: { min: number; max: number };\n   120→\n   121→  // Timeline\n   122→  timelineToResults: string;\n   123→\n   124→  // Safety\n   125→  riskLevel: RiskLevel;\n   126→  sideEffects: string[];\n   127→  interactions: string[];\n   128→  contraindications: string[];\n   129→\n   130→  // Applicability\n   131→  targetBenefits: string[];\n   132→  requiresPrescription: boolean;\n   133→\n   134→  notes?: string[];\n   135→  sources?: string[];\n   136→}\n   137→\n   138→// ============================================\n   139→// SEVERITY & SCORING\n   140→// ============================================\n   141→\n   142→export interface SeverityThreshold {\n   143→  metric: string;\n   144→  optimal: { min: number; max: number };\n   145→  mild: { min: number; max: number };\n   146→  moderate: { min: number; max: number };\n   147→  severe: { min: number; max: number };\n   148→  unit: string;\n   149→  higherIsBetter?: boolean;\n   150→}\n   151→\n   152→export interface SeverityResult {\n   153→  severity: Severity;\n   154→  label: string;\n   155→  color: string;\n   156→  icon: string;\n   157→  description: string;\n   158→}\n   159→\n   160→// ============================================\n   161→// RECOMMENDATION ENGINE TYPES\n   162→// ============================================\n   163→\n   164→export interface MetricAnalysis {\n   165→  metricId: string;\n   166→  metricName: string;\n   167→  currentValue: number;\n   168→  idealValue: number;\n   169→  idealRange: { min: number; max: number };\n   170→  deviation: number;\n   171→  deviationPercent: number;\n   172→  score: number;\n   173→  severity: SeverityResult;\n   174→  issue?: string;\n   175→  profileType: ProfileType;\n   176→}\n   177→\n   178→export interface TreatmentRecommendation {\n   179→  treatment: Treatment | Surgery | Supplement;\n   180→  priority: 'high' | 'medium' | 'low';\n   181→  relevanceScore: number; // 0-100\n   182→  targetMetrics: string[];\n   183→  estimatedImprovement: number;\n   184→  reasoning: string;\n   185→}\n   186→\n   187→export interface RecommendationPlan {\n   188→  // Summary\n   189→  overallScore: number;\n   190→  overallSeverity: SeverityResult;\n   191→  harmonyScore: number;\n   192→  percentile: number;\n   193→\n   194→  // Analysis\n   195→  metricAnalyses: MetricAnalysis[];\n   196→  strengths: MetricAnalysis[];\n   197→  weaknesses: MetricAnalysis[];\n   198→\n   199→  // Recommendations by category\n   200→  lifestyle: TreatmentRecommendation[];\n   201→  softmaxxing: TreatmentRecommendation[];\n   202→  nonSurgical: TreatmentRecommendation[];\n   203→  minimallyInvasive: TreatmentRecommendation[];\n   204→  surgical: TreatmentRecommendation[];\n   205→  supplements: TreatmentRecommendation[];\n   206→\n   207→  // Potential\n   208→  currentPSL: number;\n   209→  potentialPSL: number;\n   210→  potentialImprovement: number;\n   211→\n   212→  // Order of operations\n   213→  orderOfOperations: OrderOfOperation[];\n   214→}\n   215→\n   216→export interface OrderOfOperation {\n   217→  step: number;\n   218→  category: TreatmentCategory;\n   219→  treatment: Treatment | Surgery;\n   220→  reasoning: string;\n   221→  prerequisites?: string[];\n   222→  waitTime?: string;\n   223→}\n   224→\n   225→// ============================================\n   226→// METRIC TO ISSUE MAPPING\n   227→// ============================================\n   228→\n   229→export interface MetricIssueMapping {\n   230→  metric: string;\n   231→  lowIssue: string;\n   232→  highIssue: string;\n   233→  lowTreatments: string[];\n   234→  highTreatments: string[];\n   235→}\n   236→\n   237→// ============================================\n   238→// PSL RATING SYSTEM\n   239→// ============================================\n   240→\n   241→export interface PSLRating {\n   242→  score: number;\n   243→  tier: string;\n   244→  percentile: number;\n   245→  description: string;\n   246→}\n   247→\n   248→export const PSL_TIERS: PSLRating[] = [\n   249→  { score: 7.5, tier: 'Top Model', percentile: 99.99, description: 'Near perfection - world-class genetics' },\n   250→  { score: 7.0, tier: 'Chad', percentile: 99.87, description: 'Exceptional - top 0.1%' },\n   251→  { score: 6.5, tier: 'Chadlite', percentile: 99.0, description: 'Very attractive - top 1%' },\n   252→  { score: 6.0, tier: 'High Tier Normie+', percentile: 97.25, description: 'Notably attractive - top 3%' },\n   253→  { score: 5.5, tier: 'High Tier Normie', percentile: 90.0, description: 'Above average - top 10%' },\n   254→  { score: 5.0, tier: 'Mid Tier Normie+', percentile: 84.15, description: 'Slightly above average' },\n   255→  { score: 4.5, tier: 'Mid Tier Normie', percentile: 65.0, description: 'Average' },\n   256→  { score: 4.0, tier: 'Low Tier Normie', percentile: 50.0, description: 'Median' },\n   257→  { score: 3.5, tier: 'Below Average', percentile: 30.0, description: 'Below average' },\n   258→  { score: 3.0, tier: 'Subpar', percentile: 15.0, description: 'Noticeably below average' },\n   259→];\n   260→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"4c90245f-413e-44d3-900e-849c41096d6b","timestamp":"2025-12-20T15:50:00.256Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/types.ts","content":"/**\n * Recommendation System Types\n * Comprehensive type definitions for looksmaxxing recommendations\n */\n\n// ============================================\n// ENUMS & BASIC TYPES\n// ============================================\n\nexport type Severity = 'optimal' | 'mild' | 'moderate' | 'severe';\n\nexport type TreatmentCategory =\n  | 'lifestyle'\n  | 'softmaxxing'\n  | 'non_surgical'\n  | 'minimally_invasive'\n  | 'surgical';\n\nexport type CostLevel = 'free' | 'low' | 'medium' | 'high' | 'very_high';\n\nexport type EvidenceLevel = 'strong' | 'moderate' | 'weak' | 'anecdotal';\n\nexport type RiskLevel = 'none' | 'very_low' | 'low' | 'medium' | 'high' | 'very_high';\n\nexport type Gender = 'male' | 'female';\n\nexport type ProfileType = 'front' | 'side';\n\n// ============================================\n// TREATMENT TYPES\n// ============================================\n\nexport interface Treatment {\n  id: string;\n  name: string;\n  category: TreatmentCategory;\n  description: string;\n  howItWorks: string;\n\n  // Effectiveness\n  effectiveness: number; // 1-10\n  evidenceLevel: EvidenceLevel;\n  pslImprovement: { min: number; max: number };\n\n  // Costs\n  costLevel: CostLevel;\n  costRange: { min: number; max: number; currency: string };\n  costFrequency: 'one-time' | 'monthly' | 'per-session' | 'annual';\n\n  // Timeline\n  timelineToResults: string;\n  resultsDuration: string;\n  maintenanceRequired: boolean;\n  maintenanceFrequency?: string;\n\n  // Recovery\n  recoveryTime: string;\n  downtime: string;\n  painLevel: 'none' | 'low' | 'moderate' | 'high';\n\n  // Risk\n  riskLevel: RiskLevel;\n  sideEffects: string[];\n  contraindications: string[];\n\n  // Applicability\n  targetMetrics: string[];\n  targetIssues: string[];\n  genderSpecific?: Gender;\n  ageRestrictions?: { min?: number; max?: number };\n\n  // Additional info\n  notes?: string[];\n  sources?: string[];\n}\n\nexport interface Surgery extends Treatment {\n  category: 'surgical';\n  surgeonRecommendations?: SurgeonInfo[];\n  regionalCosts: RegionalCost[];\n  revisionRate?: number;\n  permanence: 'permanent' | 'semi-permanent' | 'temporary';\n  hospitalStay?: string;\n  anesthesiaType: 'local' | 'sedation' | 'general';\n}\n\nexport interface SurgeonInfo {\n  name: string;\n  location: string;\n  specialty: string;\n  costRange: string;\n  notes?: string;\n}\n\nexport interface RegionalCost {\n  region: string;\n  min: number;\n  max: number;\n  currency: string;\n  notes?: string;\n}\n\nexport interface Supplement {\n  id: string;\n  name: string;\n  category: 'skin' | 'hair' | 'bone' | 'hormonal' | 'anti-aging' | 'general';\n  description: string;\n\n  // Dosage\n  dosage: string;\n  frequency: string;\n  timing?: string; // e.g., \"with meals\", \"before bed\"\n\n  // Effectiveness\n  effectiveness: number; // 1-10\n  evidenceLevel: EvidenceLevel;\n\n  // Cost\n  costPerMonth: { min: number; max: number };\n\n  // Timeline\n  timelineToResults: string;\n\n  // Safety\n  riskLevel: RiskLevel;\n  sideEffects: string[];\n  interactions: string[];\n  contraindications: string[];\n\n  // Applicability\n  targetBenefits: string[];\n  requiresPrescription: boolean;\n\n  notes?: string[];\n  sources?: string[];\n}\n\n// ============================================\n// SEVERITY & SCORING\n// ============================================\n\nexport interface SeverityThreshold {\n  metric: string;\n  optimal: { min: number; max: number };\n  mild: { min: number; max: number };\n  moderate: { min: number; max: number };\n  severe: { min: number; max: number };\n  unit: string;\n  higherIsBetter?: boolean;\n}\n\nexport interface SeverityResult {\n  severity: Severity;\n  label: string;\n  color: string;\n  icon: string;\n  description: string;\n}\n\n// ============================================\n// RECOMMENDATION ENGINE TYPES\n// ============================================\n\nexport interface MetricAnalysis {\n  metricId: string;\n  metricName: string;\n  currentValue: number;\n  idealValue: number;\n  idealRange: { min: number; max: number };\n  deviation: number;\n  deviationPercent: number;\n  score: number;\n  severity: SeverityResult;\n  issue?: string;\n  profileType: ProfileType;\n}\n\nexport interface TreatmentRecommendation {\n  treatment: Treatment | Surgery | Supplement;\n  priority: 'high' | 'medium' | 'low';\n  relevanceScore: number; // 0-100\n  targetMetrics: string[];\n  estimatedImprovement: number;\n  reasoning: string;\n}\n\nexport interface RecommendationPlan {\n  // Summary\n  overallScore: number;\n  overallSeverity: SeverityResult;\n  harmonyScore: number;\n  percentile: number;\n\n  // Analysis\n  metricAnalyses: MetricAnalysis[];\n  strengths: MetricAnalysis[];\n  weaknesses: MetricAnalysis[];\n\n  // Recommendations by category\n  lifestyle: TreatmentRecommendation[];\n  softmaxxing: TreatmentRecommendation[];\n  nonSurgical: TreatmentRecommendation[];\n  minimallyInvasive: TreatmentRecommendation[];\n  surgical: TreatmentRecommendation[];\n  supplements: TreatmentRecommendation[];\n\n  // Potential\n  currentPSL: number;\n  potentialPSL: number;\n  potentialImprovement: number;\n\n  // Order of operations\n  orderOfOperations: OrderOfOperation[];\n}\n\nexport interface OrderOfOperation {\n  step: number;\n  category: TreatmentCategory;\n  treatment: Treatment | Surgery;\n  reasoning: string;\n  prerequisites?: string[];\n  waitTime?: string;\n}\n\n// ============================================\n// METRIC TO ISSUE MAPPING\n// ============================================\n\nexport interface MetricIssueMapping {\n  metric: string;\n  lowIssue: string;\n  highIssue: string;\n  lowTreatments: string[];\n  highTreatments: string[];\n}\n\n// ============================================\n// PSL RATING SYSTEM\n// ============================================\n\nexport interface PSLRating {\n  score: number;\n  tier: string;\n  percentile: number;\n  description: string;\n}\n\nexport const PSL_TIERS: PSLRating[] = [\n  { score: 7.5, tier: 'Top Model', percentile: 99.99, description: 'Near perfection - world-class genetics' },\n  { score: 7.0, tier: 'Chad', percentile: 99.87, description: 'Exceptional - top 0.1%' },\n  { score: 6.5, tier: 'Chadlite', percentile: 99.0, description: 'Very attractive - top 1%' },\n  { score: 6.0, tier: 'High Tier Normie+', percentile: 97.25, description: 'Notably attractive - top 3%' },\n  { score: 5.5, tier: 'High Tier Normie', percentile: 90.0, description: 'Above average - top 10%' },\n  { score: 5.0, tier: 'Mid Tier Normie+', percentile: 84.15, description: 'Slightly above average' },\n  { score: 4.5, tier: 'Mid Tier Normie', percentile: 65.0, description: 'Average' },\n  { score: 4.0, tier: 'Low Tier Normie', percentile: 50.0, description: 'Median' },\n  { score: 3.5, tier: 'Below Average', percentile: 30.0, description: 'Below average' },\n  { score: 3.0, tier: 'Subpar', percentile: 15.0, description: 'Noticeably below average' },\n];\n","numLines":260,"startLine":1,"totalLines":260}}}
{"parentUuid":"4c90245f-413e-44d3-900e-849c41096d6b","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01AVc1VfYdK64cQG4vgzGD44","type":"tool_result","content":"     1→/**\n     2→ * Recommendation Engine\n     3→ * Analyzes facial metrics and generates personalized treatment recommendations\n     4→ */\n     5→\n     6→import {\n     7→  Treatment,\n     8→  Surgery,\n     9→  Supplement,\n    10→  TreatmentRecommendation,\n    11→  MetricAnalysis,\n    12→  RecommendationPlan,\n    13→  OrderOfOperation,\n    14→  TreatmentCategory,\n    15→  Gender,\n    16→  ProfileType,\n    17→} from './types';\n    18→import { SOFTMAXXING_TREATMENTS } from './softmaxxing';\n    19→import { SURGICAL_TREATMENTS } from './hardmaxxing';\n    20→import { SUPPLEMENTS } from './supplements';\n    21→import { NON_SURGICAL_TREATMENTS } from './nonSurgical';\n    22→import {\n    23→  classifyMetricValue,\n    24→  calculateDeviation,\n    25→  getIssueForMetric,\n    26→  getTreatmentIdsForMetric,\n    27→  getOverallSeverity,\n    28→  harmonyToPSL,\n    29→  estimatePotentialPSL,\n    30→} from './severity';\n    31→\n    32→// ============================================\n    33→// ALL TREATMENTS COMBINED\n    34→// ============================================\n    35→\n    36→const ALL_TREATMENTS: (Treatment | Surgery)[] = [\n    37→  ...SOFTMAXXING_TREATMENTS,\n    38→  ...NON_SURGICAL_TREATMENTS,\n    39→  ...SURGICAL_TREATMENTS,\n    40→];\n    41→\n    42→// ============================================\n    43→// METRIC ANALYSIS\n    44→// ============================================\n    45→\n    46→export interface MetricInput {\n    47→  metricId: string;\n    48→  metricName: string;\n    49→  currentValue: number;\n    50→  idealValue: number;\n    51→  idealRange: { min: number; max: number };\n    52→  score: number;\n    53→  profileType: ProfileType;\n    54→}\n    55→\n    56→/**\n    57→ * Analyze a single metric and determine severity\n    58→ */\n    59→export function analyzeMetric(\n    60→  input: MetricInput,\n    61→  gender?: Gender\n    62→): MetricAnalysis {\n    63→  const { deviation, deviationPercent, direction } = calculateDeviation(\n    64→    input.metricId,\n    65→    input.currentValue\n    66→  );\n    67→\n    68→  const severity = classifyMetricValue(input.metricId, input.currentValue, gender);\n    69→  const issue = getIssueForMetric(input.metricId, direction);\n    70→\n    71→  return {\n    72→    metricId: input.metricId,\n    73→    metricName: input.metricName,\n    74→    currentValue: input.currentValue,\n    75→    idealValue: input.idealValue,\n    76→    idealRange: input.idealRange,\n    77→    deviation,\n    78→    deviationPercent,\n    79→    score: input.score,\n    80→    severity,\n    81→    issue: issue || undefined,\n    82→    profileType: input.profileType,\n    83→  };\n    84→}\n    85→\n    86→/**\n    87→ * Analyze all metrics and sort by severity\n    88→ */\n    89→export function analyzeAllMetrics(\n    90→  metrics: MetricInput[],\n    91→  gender?: Gender\n    92→): MetricAnalysis[] {\n    93→  const analyses = metrics.map(m => analyzeMetric(m, gender));\n    94→\n    95→  // Sort by severity (severe first) then by score (lowest first)\n    96→  const severityOrder = { severe: 0, moderate: 1, mild: 2, optimal: 3 };\n    97→\n    98→  return analyses.sort((a, b) => {\n    99→    const severityDiff = severityOrder[a.severity.severity] - severityOrder[b.severity.severity];\n   100→    if (severityDiff !== 0) return severityDiff;\n   101→    return a.score - b.score;\n   102→  });\n   103→}\n   104→\n   105→// ============================================\n   106→// TREATMENT MATCHING\n   107→// ============================================\n   108→\n   109→/**\n   110→ * Find treatment by ID\n   111→ */\n   112→export function findTreatment(id: string): Treatment | Surgery | Supplement | undefined {\n   113→  const treatment = ALL_TREATMENTS.find(t => t.id === id);\n   114→  if (treatment) return treatment;\n   115→\n   116→  return SUPPLEMENTS.find(s => s.id === id);\n   117→}\n   118→\n   119→/**\n   120→ * Find treatments that target a specific issue\n   121→ */\n   122→export function findTreatmentsForIssue(issue: string): (Treatment | Surgery)[] {\n   123→  return ALL_TREATMENTS.filter(t =>\n   124→    t.targetIssues.some(i =>\n   125→      i.toLowerCase().includes(issue.toLowerCase()) ||\n   126→      issue.toLowerCase().includes(i.toLowerCase())\n   127→    )\n   128→  );\n   129→}\n   130→\n   131→/**\n   132→ * Find treatments that target a specific metric\n   133→ */\n   134→export function findTreatmentsForMetric(metricId: string): (Treatment | Surgery)[] {\n   135→  return ALL_TREATMENTS.filter(t =>\n   136→    t.targetMetrics.some(m =>\n   137→      m.toLowerCase().includes(metricId.toLowerCase()) ||\n   138→      metricId.toLowerCase().includes(m.toLowerCase())\n   139→    )\n   140→  );\n   141→}\n   142→\n   143→/**\n   144→ * Score treatment relevance for a metric analysis\n   145→ */\n   146→function scoreTreatmentRelevance(\n   147→  treatment: Treatment | Surgery,\n   148→  analysis: MetricAnalysis\n   149→): number {\n   150→  let score = 0;\n   151→\n   152→  // Check if treatment targets this metric\n   153→  const targetsMetric = treatment.targetMetrics.some(m =>\n   154→    m.toLowerCase().includes(analysis.metricId.toLowerCase())\n   155→  );\n   156→  if (targetsMetric) score += 30;\n   157→\n   158→  // Check if treatment addresses the issue\n   159→  if (analysis.issue) {\n   160→    const addressesIssue = treatment.targetIssues.some(i =>\n   161→      i.toLowerCase().includes(analysis.issue!.toLowerCase()) ||\n   162→      analysis.issue!.toLowerCase().includes(i.toLowerCase())\n   163→    );\n   164→    if (addressesIssue) score += 40;\n   165→  }\n   166→\n   167→  // Factor in severity\n   168→  const severityMultiplier = {\n   169→    severe: 1.5,\n   170→    moderate: 1.2,\n   171→    mild: 1.0,\n   172→    optimal: 0.3,\n   173→  };\n   174→  score *= severityMultiplier[analysis.severity.severity];\n   175→\n   176→  // Factor in treatment effectiveness\n   177→  score += treatment.effectiveness * 2;\n   178→\n   179→  // Factor in PSL improvement potential\n   180→  const avgPSLImprovement = (treatment.pslImprovement.min + treatment.pslImprovement.max) / 2;\n   181→  score += avgPSLImprovement * 10;\n   182→\n   183→  return Math.round(score);\n   184→}\n   185→\n   186→/**\n   187→ * Generate treatment recommendations for a metric analysis\n   188→ */\n   189→export function getRecommendationsForMetric(\n   190→  analysis: MetricAnalysis,\n   191→  gender?: Gender,\n   192→  maxRecommendations: number = 5\n   193→): TreatmentRecommendation[] {\n   194→  if (analysis.severity.severity === 'optimal') {\n   195→    return []; // No treatment needed for optimal metrics\n   196→  }\n   197→\n   198→  // Get treatment IDs from mapping\n   199→  const { direction } = calculateDeviation(analysis.metricId, analysis.currentValue);\n   200→  const treatmentIds = getTreatmentIdsForMetric(analysis.metricId, direction);\n   201→\n   202→  // Find matching treatments\n   203→  let treatments: (Treatment | Surgery)[] = [];\n   204→\n   205→  // First, add treatments from the mapping\n   206→  for (const id of treatmentIds) {\n   207→    const treatment = findTreatment(id);\n   208→    if (treatment && 'category' in treatment && treatment.category !== undefined) {\n   209→      treatments.push(treatment as Treatment | Surgery);\n   210→    }\n   211→  }\n   212→\n   213→  // Then, find additional treatments that target this metric or issue\n   214→  const additionalTreatments = [\n   215→    ...findTreatmentsForMetric(analysis.metricId),\n   216→    ...(analysis.issue ? findTreatmentsForIssue(analysis.issue) : []),\n   217→  ];\n   218→\n   219→  // Remove duplicates\n   220→  const seenIds = treatments.map(t => t.id);\n   221→  for (const t of additionalTreatments) {\n   222→    if (!seenIds.includes(t.id)) {\n   223→      seenIds.push(t.id);\n   224→      treatments.push(t);\n   225→    }\n   226→  }\n   227→\n   228→  // Filter by gender if specified\n   229→  if (gender) {\n   230→    treatments = treatments.filter(t =>\n   231→      !t.genderSpecific || t.genderSpecific === gender\n   232→    );\n   233→  }\n   234→\n   235→  // Score and rank treatments\n   236→  const scoredTreatments = treatments.map(treatment => ({\n   237→    treatment,\n   238→    relevanceScore: scoreTreatmentRelevance(treatment, analysis),\n   239→  }));\n   240→\n   241→  // Sort by relevance score\n   242→  scoredTreatments.sort((a, b) => b.relevanceScore - a.relevanceScore);\n   243→\n   244→  // Create recommendations\n   245→  return scoredTreatments.slice(0, maxRecommendations).map(({ treatment, relevanceScore }) => {\n   246→    const avgPSLImprovement = (treatment.pslImprovement.min + treatment.pslImprovement.max) / 2;\n   247→\n   248→    return {\n   249→      treatment,\n   250→      priority: relevanceScore >= 60 ? 'high' as const :\n   251→                relevanceScore >= 40 ? 'medium' as const :\n   252→                'low' as const,\n   253→      relevanceScore,\n   254→      targetMetrics: [analysis.metricId],\n   255→      estimatedImprovement: avgPSLImprovement,\n   256→      reasoning: generateReasoning(treatment, analysis),\n   257→    };\n   258→  });\n   259→}\n   260→\n   261→/**\n   262→ * Generate human-readable reasoning for a recommendation\n   263→ */\n   264→function generateReasoning(\n   265→  treatment: Treatment | Surgery,\n   266→  analysis: MetricAnalysis\n   267→): string {\n   268→  const parts: string[] = [];\n   269→\n   270→  // Issue description\n   271→  if (analysis.issue) {\n   272→    parts.push(`Addresses ${analysis.issue.replace(/_/g, ' ')}`);\n   273→  }\n   274→\n   275→  // Effectiveness\n   276→  parts.push(`Effectiveness: ${treatment.effectiveness}/10`);\n   277→\n   278→  // PSL improvement\n   279→  const pslRange = `${treatment.pslImprovement.min}-${treatment.pslImprovement.max}`;\n   280→  parts.push(`Expected improvement: ${pslRange} PSL points`);\n   281→\n   282→  // Timeline\n   283→  parts.push(`Results in: ${treatment.timelineToResults}`);\n   284→\n   285→  return parts.join('. ') + '.';\n   286→}\n   287→\n   288→// ============================================\n   289→// RECOMMENDATION PLAN GENERATION\n   290→// ============================================\n   291→\n   292→/**\n   293→ * Generate a comprehensive recommendation plan\n   294→ */\n   295→export function generateRecommendationPlan(\n   296→  metrics: MetricInput[],\n   297→  overallScore: number,\n   298→  harmonyPercent: number,\n   299→  gender?: Gender\n   300→): RecommendationPlan {\n   301→  // Analyze all metrics\n   302→  const metricAnalyses = analyzeAllMetrics(metrics, gender);\n   303→\n   304→  // Determine strengths and weaknesses\n   305→  const strengths = metricAnalyses.filter(m =>\n   306→    m.severity.severity === 'optimal' || m.score >= 85\n   307→  );\n   308→  const weaknesses = metricAnalyses.filter(m =>\n   309→    m.severity.severity !== 'optimal' && m.score < 85\n   310→  );\n   311→\n   312→  // Get recommendations for each weakness\n   313→  const allRecommendations: TreatmentRecommendation[] = [];\n   314→  for (const weakness of weaknesses) {\n   315→    const recs = getRecommendationsForMetric(weakness, gender);\n   316→    allRecommendations.push(...recs);\n   317→  }\n   318→\n   319→  // Deduplicate recommendations (same treatment might help multiple metrics)\n   320→  const uniqueRecommendations = deduplicateRecommendations(allRecommendations);\n   321→\n   322→  // Categorize recommendations\n   323→  const lifestyle = uniqueRecommendations.filter(r =>\n   324→    r.treatment.category === 'lifestyle' || r.treatment.category === 'softmaxxing'\n   325→  );\n   326→  const softmaxxing = uniqueRecommendations.filter(r =>\n   327→    r.treatment.category === 'softmaxxing'\n   328→  );\n   329→  const nonSurgical = uniqueRecommendations.filter(r =>\n   330→    r.treatment.category === 'non_surgical'\n   331→  );\n   332→  const minimallyInvasive = uniqueRecommendations.filter(r =>\n   333→    r.treatment.category === 'minimally_invasive'\n   334→  );\n   335→  const surgical = uniqueRecommendations.filter(r =>\n   336→    r.treatment.category === 'surgical'\n   337→  );\n   338→\n   339→  // Get supplement recommendations\n   340→  const supplements = getSupplementRecommendations(weaknesses, gender);\n   341→\n   342→  // Calculate PSL ratings\n   343→  const pslRating = harmonyToPSL(harmonyPercent);\n   344→  const treatmentImprovements = uniqueRecommendations.map(r => r.estimatedImprovement);\n   345→  const potentialPSL = estimatePotentialPSL(pslRating.psl, treatmentImprovements);\n   346→\n   347→  // Generate order of operations\n   348→  const orderOfOperations = generateOrderOfOperations(uniqueRecommendations);\n   349→\n   350→  // Get overall severity\n   351→  const overallSeverity = getOverallSeverity(metricAnalyses.map(m => m.severity.severity));\n   352→\n   353→  return {\n   354→    overallScore,\n   355→    overallSeverity,\n   356→    harmonyScore: harmonyPercent,\n   357→    percentile: pslRating.percentile,\n   358→    metricAnalyses,\n   359→    strengths,\n   360→    weaknesses,\n   361→    lifestyle,\n   362→    softmaxxing,\n   363→    nonSurgical,\n   364→    minimallyInvasive,\n   365→    surgical,\n   366→    supplements,\n   367→    currentPSL: pslRating.psl,\n   368→    potentialPSL: potentialPSL.potentialPSL,\n   369→    potentialImprovement: potentialPSL.totalImprovement,\n   370→    orderOfOperations,\n   371→  };\n   372→}\n   373→\n   374→/**\n   375→ * Deduplicate recommendations, combining target metrics for same treatment\n   376→ */\n   377→function deduplicateRecommendations(\n   378→  recommendations: TreatmentRecommendation[]\n   379→): TreatmentRecommendation[] {\n   380→  const byId = new Map<string, TreatmentRecommendation>();\n   381→\n   382→  for (const rec of recommendations) {\n   383→    const existing = byId.get(rec.treatment.id);\n   384→    if (existing) {\n   385→      // Combine target metrics (deduplicate using filter)\n   386→      const combined = [...existing.targetMetrics, ...rec.targetMetrics];\n   387→      existing.targetMetrics = combined.filter((m, i) => combined.indexOf(m) === i);\n   388→\n   389→      // Take higher relevance score\n   390→      existing.relevanceScore = Math.max(existing.relevanceScore, rec.relevanceScore);\n   391→\n   392→      // Update priority based on new relevance\n   393→      existing.priority = existing.relevanceScore >= 60 ? 'high' :\n   394→                         existing.relevanceScore >= 40 ? 'medium' :\n   395→                         'low';\n   396→    } else {\n   397→      byId.set(rec.treatment.id, { ...rec });\n   398→    }\n   399→  }\n   400→\n   401→  return Array.from(byId.values()).sort((a, b) => b.relevanceScore - a.relevanceScore);\n   402→}\n   403→\n   404→/**\n   405→ * Get supplement recommendations based on weaknesses\n   406→ */\n   407→function getSupplementRecommendations(\n   408→  weaknesses: MetricAnalysis[],\n   409→  gender?: Gender\n   410→): TreatmentRecommendation[] {\n   411→  const recommendations: TreatmentRecommendation[] = [];\n   412→\n   413→  // Map weakness types to supplement categories\n   414→  const hasSkinIssues = weaknesses.some(w =>\n   415→    w.issue?.includes('skin') || w.metricId.includes('skin')\n   416→  );\n   417→  const hasHairIssues = weaknesses.some(w =>\n   418→    w.issue?.includes('hair') || w.metricId.includes('hairline')\n   419→  );\n   420→  const hasGeneralAging = weaknesses.some(w =>\n   421→    w.issue?.includes('aging') || w.severity.severity === 'moderate' || w.severity.severity === 'severe'\n   422→  );\n   423→\n   424→  // Helper to create supplement recommendation\n   425→  const createSupplementRec = (\n   426→    supp: Supplement,\n   427→    priority: 'high' | 'medium' | 'low',\n   428→    relevanceScore: number,\n   429→    targetMetrics: string[],\n   430→    reasoning: string\n   431→  ): TreatmentRecommendation => ({\n   432→    treatment: {\n   433→      id: supp.id,\n   434→      name: supp.name,\n   435→      category: 'lifestyle',\n   436→      description: supp.description,\n   437→      howItWorks: `Dosage: ${supp.dosage} ${supp.frequency}`,\n   438→      effectiveness: supp.effectiveness,\n   439→      evidenceLevel: supp.evidenceLevel,\n   440→      pslImprovement: { min: 0.05, max: 0.15 },\n   441→      costLevel: supp.costPerMonth.max > 30 ? 'medium' : 'low',\n   442→      costRange: { min: supp.costPerMonth.min, max: supp.costPerMonth.max, currency: 'USD' },\n   443→      costFrequency: 'monthly',\n   444→      timelineToResults: supp.timelineToResults,\n   445→      resultsDuration: 'Ongoing with continued use',\n   446→      maintenanceRequired: true,\n   447→      maintenanceFrequency: supp.frequency,\n   448→      recoveryTime: 'None',\n   449→      downtime: 'None',\n   450→      painLevel: 'none',\n   451→      riskLevel: supp.riskLevel,\n   452→      sideEffects: supp.sideEffects,\n   453→      contraindications: supp.contraindications,\n   454→      targetMetrics,\n   455→      targetIssues: supp.targetBenefits,\n   456→      notes: supp.notes,\n   457→      sources: supp.sources,\n   458→    },\n   459→    priority,\n   460→    relevanceScore,\n   461→    targetMetrics,\n   462→    estimatedImprovement: 0.1,\n   463→    reasoning,\n   464→  });\n   465→\n   466→  // Add relevant supplements\n   467→  if (hasSkinIssues || hasGeneralAging) {\n   468→    const skinSupplements = SUPPLEMENTS.filter(s =>\n   469→      s.category === 'skin' || s.category === 'anti-aging'\n   470→    );\n   471→    for (const supp of skinSupplements.slice(0, 3)) {\n   472→      recommendations.push(createSupplementRec(\n   473→        supp,\n   474→        'medium',\n   475→        50,\n   476→        ['skin_quality'],\n   477→        `${supp.name} supports skin health and anti-aging.`\n   478→      ));\n   479→    }\n   480→  }\n   481→\n   482→  if (hasHairIssues && gender === 'male') {\n   483→    const hairSupplements = SUPPLEMENTS.filter(s => s.category === 'hair');\n   484→    for (const supp of hairSupplements.slice(0, 3)) {\n   485→      recommendations.push(createSupplementRec(\n   486→        supp,\n   487→        'medium',\n   488→        45,\n   489→        ['hairline'],\n   490→        `${supp.name} supports hair health.`\n   491→      ));\n   492→    }\n   493→  }\n   494→\n   495→  // Always recommend foundational supplements\n   496→  const foundational = SUPPLEMENTS.filter(s =>\n   497→    ['vitamin_d3', 'omega_3', 'magnesium'].includes(s.id)\n   498→  );\n   499→  for (const supp of foundational) {\n   500→    if (!recommendations.some(r => r.treatment.id === supp.id)) {\n   501→      recommendations.push(createSupplementRec(\n   502→        supp,\n   503→        'low',\n   504→        30,\n   505→        ['general_health'],\n   506→        `${supp.name} supports overall health and wellbeing.`\n   507→      ));\n   508→    }\n   509→  }\n   510→\n   511→  return recommendations.slice(0, 10);\n   512→}\n   513→\n   514→/**\n   515→ * Generate order of operations for treatments\n   516→ */\n   517→function generateOrderOfOperations(\n   518→  recommendations: TreatmentRecommendation[]\n   519→): OrderOfOperation[] {\n   520→  const operations: OrderOfOperation[] = [];\n   521→\n   522→  // Define category order: lifestyle -> softmaxxing -> non-surgical -> minimally invasive -> surgical\n   523→  const categoryOrder: TreatmentCategory[] = [\n   524→    'lifestyle',\n   525→    'softmaxxing',\n   526→    'non_surgical',\n   527→    'minimally_invasive',\n   528→    'surgical',\n   529→  ];\n   530→\n   531→  // Group by category (only for valid treatment categories)\n   532→  const validCategories: TreatmentCategory[] = ['lifestyle', 'softmaxxing', 'non_surgical', 'minimally_invasive', 'surgical'];\n   533→  const byCategory = new Map<TreatmentCategory, TreatmentRecommendation[]>();\n   534→  for (const rec of recommendations) {\n   535→    const cat = rec.treatment.category as TreatmentCategory;\n   536→    if (validCategories.includes(cat)) {\n   537→      if (!byCategory.has(cat)) {\n   538→        byCategory.set(cat, []);\n   539→      }\n   540→      byCategory.get(cat)!.push(rec);\n   541→    }\n   542→  }\n   543→\n   544→  let step = 1;\n   545→  for (const category of categoryOrder) {\n   546→    const recs = byCategory.get(category) || [];\n   547→    // Sort by priority and relevance\n   548→    recs.sort((a, b) => {\n   549→      if (a.priority !== b.priority) {\n   550→        const priorityOrder = { high: 0, medium: 1, low: 2 };\n   551→        return priorityOrder[a.priority] - priorityOrder[b.priority];\n   552→      }\n   553→      return b.relevanceScore - a.relevanceScore;\n   554→    });\n   555→\n   556→    for (const rec of recs.slice(0, 3)) { // Max 3 per category\n   557→      const treatment = rec.treatment as Treatment | Surgery;\n   558→      const operation: OrderOfOperation = {\n   559→        step,\n   560→        category,\n   561→        treatment,\n   562→        reasoning: getStepReasoning(step, category),\n   563→      };\n   564→\n   565→      // Add prerequisites for surgical procedures\n   566→      if (category === 'surgical') {\n   567→        operation.prerequisites = ['Complete non-surgical options first', 'Consult with board-certified surgeon'];\n   568→        operation.waitTime = '6-12 months recovery between major procedures';\n   569→      }\n   570→\n   571→      operations.push(operation);\n   572→      step++;\n   573→    }\n   574→  }\n   575→\n   576→  return operations;\n   577→}\n   578→\n   579→/**\n   580→ * Generate reasoning for a step in order of operations\n   581→ */\n   582→function getStepReasoning(\n   583→  step: number,\n   584→  category: TreatmentCategory\n   585→): string {\n   586→  if (step === 1) {\n   587→    return 'Start with foundational changes before considering more invasive options.';\n   588→  }\n   589→\n   590→  if (category === 'lifestyle' || category === 'softmaxxing') {\n   591→    return 'Low-risk, reversible changes that can provide noticeable improvement.';\n   592→  }\n   593→\n   594→  if (category === 'non_surgical') {\n   595→    return 'Non-invasive treatments with minimal downtime to test results before committing to surgery.';\n   596→  }\n   597→\n   598→  if (category === 'minimally_invasive') {\n   599→    return 'Minimally invasive procedures can provide significant results with less risk than surgery.';\n   600→  }\n   601→\n   602→  if (category === 'surgical') {\n   603→    return 'Consider surgery only after exhausting less invasive options and with realistic expectations.';\n   604→  }\n   605→\n   606→  return '';\n   607→}\n   608→\n   609→// ============================================\n   610→// UTILITY FUNCTIONS\n   611→// ============================================\n   612→\n   613→/**\n   614→ * Get top priority recommendations across all categories\n   615→ */\n   616→export function getTopRecommendations(\n   617→  plan: RecommendationPlan,\n   618→  count: number = 5\n   619→): TreatmentRecommendation[] {\n   620→  const all = [\n   621→    ...plan.lifestyle,\n   622→    ...plan.softmaxxing,\n   623→    ...plan.nonSurgical,\n   624→    ...plan.minimallyInvasive,\n   625→    ...plan.surgical,\n   626→  ];\n   627→\n   628→  return all\n   629→    .sort((a, b) => b.relevanceScore - a.relevanceScore)\n   630→    .slice(0, count);\n   631→}\n   632→\n   633→/**\n   634→ * Get recommendations filtered by cost level\n   635→ */\n   636→export function getRecommendationsByCost(\n   637→  plan: RecommendationPlan,\n   638→  maxCost: 'free' | 'low' | 'medium' | 'high' | 'very_high'\n   639→): TreatmentRecommendation[] {\n   640→  const costOrder = ['free', 'low', 'medium', 'high', 'very_high'];\n   641→  const maxCostIndex = costOrder.indexOf(maxCost);\n   642→\n   643→  const all = [\n   644→    ...plan.lifestyle,\n   645→    ...plan.softmaxxing,\n   646→    ...plan.nonSurgical,\n   647→    ...plan.minimallyInvasive,\n   648→    ...plan.surgical,\n   649→  ];\n   650→\n   651→  return all.filter(r => {\n   652→    const treatment = r.treatment as Treatment;\n   653→    if ('costLevel' in treatment) {\n   654→      return costOrder.indexOf(treatment.costLevel) <= maxCostIndex;\n   655→    }\n   656→    return true;\n   657→  });\n   658→}\n   659→\n   660→/**\n   661→ * Get recommendations with minimal downtime\n   662→ */\n   663→export function getNoDowntimeRecommendations(\n   664→  plan: RecommendationPlan\n   665→): TreatmentRecommendation[] {\n   666→  const all = [\n   667→    ...plan.lifestyle,\n   668→    ...plan.softmaxxing,\n   669→    ...plan.nonSurgical,\n   670→    ...plan.minimallyInvasive,\n   671→  ];\n   672→\n   673→  return all.filter(r => {\n   674→    const treatment = r.treatment as Treatment;\n   675→    if ('downtime' in treatment) {\n   676→      const downtime = treatment.downtime.toLowerCase();\n   677→      return downtime.includes('none') || downtime.includes('minimal');\n   678→    }\n   679→    return true;\n   680→  });\n   681→}\n   682→\n   683→/**\n   684→ * Format cost for display\n   685→ */\n   686→export function formatCost(treatment: Treatment | Surgery): string {\n   687→  const { min, max, currency } = treatment.costRange;\n   688→  const symbol = currency === 'USD' ? '$' : currency === 'EUR' ? '€' : currency === 'GBP' ? '£' : currency;\n   689→\n   690→  if (min === max) {\n   691→    return `${symbol}${min.toLocaleString()}`;\n   692→  }\n   693→\n   694→  return `${symbol}${min.toLocaleString()} - ${symbol}${max.toLocaleString()}`;\n   695→}\n   696→\n   697→/**\n   698→ * Get summary statistics for a plan\n   699→ */\n   700→export function getPlanSummary(plan: RecommendationPlan): {\n   701→  totalRecommendations: number;\n   702→  highPriority: number;\n   703→  mediumPriority: number;\n   704→  lowPriority: number;\n   705→  categoryCounts: Record<string, number>;\n   706→  estimatedTotalImprovement: number;\n   707→} {\n   708→  const all = [\n   709→    ...plan.lifestyle,\n   710→    ...plan.softmaxxing,\n   711→    ...plan.nonSurgical,\n   712→    ...plan.minimallyInvasive,\n   713→    ...plan.surgical,\n   714→  ];\n   715→\n   716→  return {\n   717→    totalRecommendations: all.length,\n   718→    highPriority: all.filter(r => r.priority === 'high').length,\n   719→    mediumPriority: all.filter(r => r.priority === 'medium').length,\n   720→    lowPriority: all.filter(r => r.priority === 'low').length,\n   721→    categoryCounts: {\n   722→      lifestyle: plan.lifestyle.length,\n   723→      softmaxxing: plan.softmaxxing.length,\n   724→      nonSurgical: plan.nonSurgical.length,\n   725→      minimallyInvasive: plan.minimallyInvasive.length,\n   726→      surgical: plan.surgical.length,\n   727→      supplements: plan.supplements.length,\n   728→    },\n   729→    estimatedTotalImprovement: plan.potentialImprovement,\n   730→  };\n   731→}\n   732→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"730eb8a6-3289-4f66-9497-c8cf9cdcc914","timestamp":"2025-12-20T15:50:00.256Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/engine.ts","content":"/**\n * Recommendation Engine\n * Analyzes facial metrics and generates personalized treatment recommendations\n */\n\nimport {\n  Treatment,\n  Surgery,\n  Supplement,\n  TreatmentRecommendation,\n  MetricAnalysis,\n  RecommendationPlan,\n  OrderOfOperation,\n  TreatmentCategory,\n  Gender,\n  ProfileType,\n} from './types';\nimport { SOFTMAXXING_TREATMENTS } from './softmaxxing';\nimport { SURGICAL_TREATMENTS } from './hardmaxxing';\nimport { SUPPLEMENTS } from './supplements';\nimport { NON_SURGICAL_TREATMENTS } from './nonSurgical';\nimport {\n  classifyMetricValue,\n  calculateDeviation,\n  getIssueForMetric,\n  getTreatmentIdsForMetric,\n  getOverallSeverity,\n  harmonyToPSL,\n  estimatePotentialPSL,\n} from './severity';\n\n// ============================================\n// ALL TREATMENTS COMBINED\n// ============================================\n\nconst ALL_TREATMENTS: (Treatment | Surgery)[] = [\n  ...SOFTMAXXING_TREATMENTS,\n  ...NON_SURGICAL_TREATMENTS,\n  ...SURGICAL_TREATMENTS,\n];\n\n// ============================================\n// METRIC ANALYSIS\n// ============================================\n\nexport interface MetricInput {\n  metricId: string;\n  metricName: string;\n  currentValue: number;\n  idealValue: number;\n  idealRange: { min: number; max: number };\n  score: number;\n  profileType: ProfileType;\n}\n\n/**\n * Analyze a single metric and determine severity\n */\nexport function analyzeMetric(\n  input: MetricInput,\n  gender?: Gender\n): MetricAnalysis {\n  const { deviation, deviationPercent, direction } = calculateDeviation(\n    input.metricId,\n    input.currentValue\n  );\n\n  const severity = classifyMetricValue(input.metricId, input.currentValue, gender);\n  const issue = getIssueForMetric(input.metricId, direction);\n\n  return {\n    metricId: input.metricId,\n    metricName: input.metricName,\n    currentValue: input.currentValue,\n    idealValue: input.idealValue,\n    idealRange: input.idealRange,\n    deviation,\n    deviationPercent,\n    score: input.score,\n    severity,\n    issue: issue || undefined,\n    profileType: input.profileType,\n  };\n}\n\n/**\n * Analyze all metrics and sort by severity\n */\nexport function analyzeAllMetrics(\n  metrics: MetricInput[],\n  gender?: Gender\n): MetricAnalysis[] {\n  const analyses = metrics.map(m => analyzeMetric(m, gender));\n\n  // Sort by severity (severe first) then by score (lowest first)\n  const severityOrder = { severe: 0, moderate: 1, mild: 2, optimal: 3 };\n\n  return analyses.sort((a, b) => {\n    const severityDiff = severityOrder[a.severity.severity] - severityOrder[b.severity.severity];\n    if (severityDiff !== 0) return severityDiff;\n    return a.score - b.score;\n  });\n}\n\n// ============================================\n// TREATMENT MATCHING\n// ============================================\n\n/**\n * Find treatment by ID\n */\nexport function findTreatment(id: string): Treatment | Surgery | Supplement | undefined {\n  const treatment = ALL_TREATMENTS.find(t => t.id === id);\n  if (treatment) return treatment;\n\n  return SUPPLEMENTS.find(s => s.id === id);\n}\n\n/**\n * Find treatments that target a specific issue\n */\nexport function findTreatmentsForIssue(issue: string): (Treatment | Surgery)[] {\n  return ALL_TREATMENTS.filter(t =>\n    t.targetIssues.some(i =>\n      i.toLowerCase().includes(issue.toLowerCase()) ||\n      issue.toLowerCase().includes(i.toLowerCase())\n    )\n  );\n}\n\n/**\n * Find treatments that target a specific metric\n */\nexport function findTreatmentsForMetric(metricId: string): (Treatment | Surgery)[] {\n  return ALL_TREATMENTS.filter(t =>\n    t.targetMetrics.some(m =>\n      m.toLowerCase().includes(metricId.toLowerCase()) ||\n      metricId.toLowerCase().includes(m.toLowerCase())\n    )\n  );\n}\n\n/**\n * Score treatment relevance for a metric analysis\n */\nfunction scoreTreatmentRelevance(\n  treatment: Treatment | Surgery,\n  analysis: MetricAnalysis\n): number {\n  let score = 0;\n\n  // Check if treatment targets this metric\n  const targetsMetric = treatment.targetMetrics.some(m =>\n    m.toLowerCase().includes(analysis.metricId.toLowerCase())\n  );\n  if (targetsMetric) score += 30;\n\n  // Check if treatment addresses the issue\n  if (analysis.issue) {\n    const addressesIssue = treatment.targetIssues.some(i =>\n      i.toLowerCase().includes(analysis.issue!.toLowerCase()) ||\n      analysis.issue!.toLowerCase().includes(i.toLowerCase())\n    );\n    if (addressesIssue) score += 40;\n  }\n\n  // Factor in severity\n  const severityMultiplier = {\n    severe: 1.5,\n    moderate: 1.2,\n    mild: 1.0,\n    optimal: 0.3,\n  };\n  score *= severityMultiplier[analysis.severity.severity];\n\n  // Factor in treatment effectiveness\n  score += treatment.effectiveness * 2;\n\n  // Factor in PSL improvement potential\n  const avgPSLImprovement = (treatment.pslImprovement.min + treatment.pslImprovement.max) / 2;\n  score += avgPSLImprovement * 10;\n\n  return Math.round(score);\n}\n\n/**\n * Generate treatment recommendations for a metric analysis\n */\nexport function getRecommendationsForMetric(\n  analysis: MetricAnalysis,\n  gender?: Gender,\n  maxRecommendations: number = 5\n): TreatmentRecommendation[] {\n  if (analysis.severity.severity === 'optimal') {\n    return []; // No treatment needed for optimal metrics\n  }\n\n  // Get treatment IDs from mapping\n  const { direction } = calculateDeviation(analysis.metricId, analysis.currentValue);\n  const treatmentIds = getTreatmentIdsForMetric(analysis.metricId, direction);\n\n  // Find matching treatments\n  let treatments: (Treatment | Surgery)[] = [];\n\n  // First, add treatments from the mapping\n  for (const id of treatmentIds) {\n    const treatment = findTreatment(id);\n    if (treatment && 'category' in treatment && treatment.category !== undefined) {\n      treatments.push(treatment as Treatment | Surgery);\n    }\n  }\n\n  // Then, find additional treatments that target this metric or issue\n  const additionalTreatments = [\n    ...findTreatmentsForMetric(analysis.metricId),\n    ...(analysis.issue ? findTreatmentsForIssue(analysis.issue) : []),\n  ];\n\n  // Remove duplicates\n  const seenIds = treatments.map(t => t.id);\n  for (const t of additionalTreatments) {\n    if (!seenIds.includes(t.id)) {\n      seenIds.push(t.id);\n      treatments.push(t);\n    }\n  }\n\n  // Filter by gender if specified\n  if (gender) {\n    treatments = treatments.filter(t =>\n      !t.genderSpecific || t.genderSpecific === gender\n    );\n  }\n\n  // Score and rank treatments\n  const scoredTreatments = treatments.map(treatment => ({\n    treatment,\n    relevanceScore: scoreTreatmentRelevance(treatment, analysis),\n  }));\n\n  // Sort by relevance score\n  scoredTreatments.sort((a, b) => b.relevanceScore - a.relevanceScore);\n\n  // Create recommendations\n  return scoredTreatments.slice(0, maxRecommendations).map(({ treatment, relevanceScore }) => {\n    const avgPSLImprovement = (treatment.pslImprovement.min + treatment.pslImprovement.max) / 2;\n\n    return {\n      treatment,\n      priority: relevanceScore >= 60 ? 'high' as const :\n                relevanceScore >= 40 ? 'medium' as const :\n                'low' as const,\n      relevanceScore,\n      targetMetrics: [analysis.metricId],\n      estimatedImprovement: avgPSLImprovement,\n      reasoning: generateReasoning(treatment, analysis),\n    };\n  });\n}\n\n/**\n * Generate human-readable reasoning for a recommendation\n */\nfunction generateReasoning(\n  treatment: Treatment | Surgery,\n  analysis: MetricAnalysis\n): string {\n  const parts: string[] = [];\n\n  // Issue description\n  if (analysis.issue) {\n    parts.push(`Addresses ${analysis.issue.replace(/_/g, ' ')}`);\n  }\n\n  // Effectiveness\n  parts.push(`Effectiveness: ${treatment.effectiveness}/10`);\n\n  // PSL improvement\n  const pslRange = `${treatment.pslImprovement.min}-${treatment.pslImprovement.max}`;\n  parts.push(`Expected improvement: ${pslRange} PSL points`);\n\n  // Timeline\n  parts.push(`Results in: ${treatment.timelineToResults}`);\n\n  return parts.join('. ') + '.';\n}\n\n// ============================================\n// RECOMMENDATION PLAN GENERATION\n// ============================================\n\n/**\n * Generate a comprehensive recommendation plan\n */\nexport function generateRecommendationPlan(\n  metrics: MetricInput[],\n  overallScore: number,\n  harmonyPercent: number,\n  gender?: Gender\n): RecommendationPlan {\n  // Analyze all metrics\n  const metricAnalyses = analyzeAllMetrics(metrics, gender);\n\n  // Determine strengths and weaknesses\n  const strengths = metricAnalyses.filter(m =>\n    m.severity.severity === 'optimal' || m.score >= 85\n  );\n  const weaknesses = metricAnalyses.filter(m =>\n    m.severity.severity !== 'optimal' && m.score < 85\n  );\n\n  // Get recommendations for each weakness\n  const allRecommendations: TreatmentRecommendation[] = [];\n  for (const weakness of weaknesses) {\n    const recs = getRecommendationsForMetric(weakness, gender);\n    allRecommendations.push(...recs);\n  }\n\n  // Deduplicate recommendations (same treatment might help multiple metrics)\n  const uniqueRecommendations = deduplicateRecommendations(allRecommendations);\n\n  // Categorize recommendations\n  const lifestyle = uniqueRecommendations.filter(r =>\n    r.treatment.category === 'lifestyle' || r.treatment.category === 'softmaxxing'\n  );\n  const softmaxxing = uniqueRecommendations.filter(r =>\n    r.treatment.category === 'softmaxxing'\n  );\n  const nonSurgical = uniqueRecommendations.filter(r =>\n    r.treatment.category === 'non_surgical'\n  );\n  const minimallyInvasive = uniqueRecommendations.filter(r =>\n    r.treatment.category === 'minimally_invasive'\n  );\n  const surgical = uniqueRecommendations.filter(r =>\n    r.treatment.category === 'surgical'\n  );\n\n  // Get supplement recommendations\n  const supplements = getSupplementRecommendations(weaknesses, gender);\n\n  // Calculate PSL ratings\n  const pslRating = harmonyToPSL(harmonyPercent);\n  const treatmentImprovements = uniqueRecommendations.map(r => r.estimatedImprovement);\n  const potentialPSL = estimatePotentialPSL(pslRating.psl, treatmentImprovements);\n\n  // Generate order of operations\n  const orderOfOperations = generateOrderOfOperations(uniqueRecommendations);\n\n  // Get overall severity\n  const overallSeverity = getOverallSeverity(metricAnalyses.map(m => m.severity.severity));\n\n  return {\n    overallScore,\n    overallSeverity,\n    harmonyScore: harmonyPercent,\n    percentile: pslRating.percentile,\n    metricAnalyses,\n    strengths,\n    weaknesses,\n    lifestyle,\n    softmaxxing,\n    nonSurgical,\n    minimallyInvasive,\n    surgical,\n    supplements,\n    currentPSL: pslRating.psl,\n    potentialPSL: potentialPSL.potentialPSL,\n    potentialImprovement: potentialPSL.totalImprovement,\n    orderOfOperations,\n  };\n}\n\n/**\n * Deduplicate recommendations, combining target metrics for same treatment\n */\nfunction deduplicateRecommendations(\n  recommendations: TreatmentRecommendation[]\n): TreatmentRecommendation[] {\n  const byId = new Map<string, TreatmentRecommendation>();\n\n  for (const rec of recommendations) {\n    const existing = byId.get(rec.treatment.id);\n    if (existing) {\n      // Combine target metrics (deduplicate using filter)\n      const combined = [...existing.targetMetrics, ...rec.targetMetrics];\n      existing.targetMetrics = combined.filter((m, i) => combined.indexOf(m) === i);\n\n      // Take higher relevance score\n      existing.relevanceScore = Math.max(existing.relevanceScore, rec.relevanceScore);\n\n      // Update priority based on new relevance\n      existing.priority = existing.relevanceScore >= 60 ? 'high' :\n                         existing.relevanceScore >= 40 ? 'medium' :\n                         'low';\n    } else {\n      byId.set(rec.treatment.id, { ...rec });\n    }\n  }\n\n  return Array.from(byId.values()).sort((a, b) => b.relevanceScore - a.relevanceScore);\n}\n\n/**\n * Get supplement recommendations based on weaknesses\n */\nfunction getSupplementRecommendations(\n  weaknesses: MetricAnalysis[],\n  gender?: Gender\n): TreatmentRecommendation[] {\n  const recommendations: TreatmentRecommendation[] = [];\n\n  // Map weakness types to supplement categories\n  const hasSkinIssues = weaknesses.some(w =>\n    w.issue?.includes('skin') || w.metricId.includes('skin')\n  );\n  const hasHairIssues = weaknesses.some(w =>\n    w.issue?.includes('hair') || w.metricId.includes('hairline')\n  );\n  const hasGeneralAging = weaknesses.some(w =>\n    w.issue?.includes('aging') || w.severity.severity === 'moderate' || w.severity.severity === 'severe'\n  );\n\n  // Helper to create supplement recommendation\n  const createSupplementRec = (\n    supp: Supplement,\n    priority: 'high' | 'medium' | 'low',\n    relevanceScore: number,\n    targetMetrics: string[],\n    reasoning: string\n  ): TreatmentRecommendation => ({\n    treatment: {\n      id: supp.id,\n      name: supp.name,\n      category: 'lifestyle',\n      description: supp.description,\n      howItWorks: `Dosage: ${supp.dosage} ${supp.frequency}`,\n      effectiveness: supp.effectiveness,\n      evidenceLevel: supp.evidenceLevel,\n      pslImprovement: { min: 0.05, max: 0.15 },\n      costLevel: supp.costPerMonth.max > 30 ? 'medium' : 'low',\n      costRange: { min: supp.costPerMonth.min, max: supp.costPerMonth.max, currency: 'USD' },\n      costFrequency: 'monthly',\n      timelineToResults: supp.timelineToResults,\n      resultsDuration: 'Ongoing with continued use',\n      maintenanceRequired: true,\n      maintenanceFrequency: supp.frequency,\n      recoveryTime: 'None',\n      downtime: 'None',\n      painLevel: 'none',\n      riskLevel: supp.riskLevel,\n      sideEffects: supp.sideEffects,\n      contraindications: supp.contraindications,\n      targetMetrics,\n      targetIssues: supp.targetBenefits,\n      notes: supp.notes,\n      sources: supp.sources,\n    },\n    priority,\n    relevanceScore,\n    targetMetrics,\n    estimatedImprovement: 0.1,\n    reasoning,\n  });\n\n  // Add relevant supplements\n  if (hasSkinIssues || hasGeneralAging) {\n    const skinSupplements = SUPPLEMENTS.filter(s =>\n      s.category === 'skin' || s.category === 'anti-aging'\n    );\n    for (const supp of skinSupplements.slice(0, 3)) {\n      recommendations.push(createSupplementRec(\n        supp,\n        'medium',\n        50,\n        ['skin_quality'],\n        `${supp.name} supports skin health and anti-aging.`\n      ));\n    }\n  }\n\n  if (hasHairIssues && gender === 'male') {\n    const hairSupplements = SUPPLEMENTS.filter(s => s.category === 'hair');\n    for (const supp of hairSupplements.slice(0, 3)) {\n      recommendations.push(createSupplementRec(\n        supp,\n        'medium',\n        45,\n        ['hairline'],\n        `${supp.name} supports hair health.`\n      ));\n    }\n  }\n\n  // Always recommend foundational supplements\n  const foundational = SUPPLEMENTS.filter(s =>\n    ['vitamin_d3', 'omega_3', 'magnesium'].includes(s.id)\n  );\n  for (const supp of foundational) {\n    if (!recommendations.some(r => r.treatment.id === supp.id)) {\n      recommendations.push(createSupplementRec(\n        supp,\n        'low',\n        30,\n        ['general_health'],\n        `${supp.name} supports overall health and wellbeing.`\n      ));\n    }\n  }\n\n  return recommendations.slice(0, 10);\n}\n\n/**\n * Generate order of operations for treatments\n */\nfunction generateOrderOfOperations(\n  recommendations: TreatmentRecommendation[]\n): OrderOfOperation[] {\n  const operations: OrderOfOperation[] = [];\n\n  // Define category order: lifestyle -> softmaxxing -> non-surgical -> minimally invasive -> surgical\n  const categoryOrder: TreatmentCategory[] = [\n    'lifestyle',\n    'softmaxxing',\n    'non_surgical',\n    'minimally_invasive',\n    'surgical',\n  ];\n\n  // Group by category (only for valid treatment categories)\n  const validCategories: TreatmentCategory[] = ['lifestyle', 'softmaxxing', 'non_surgical', 'minimally_invasive', 'surgical'];\n  const byCategory = new Map<TreatmentCategory, TreatmentRecommendation[]>();\n  for (const rec of recommendations) {\n    const cat = rec.treatment.category as TreatmentCategory;\n    if (validCategories.includes(cat)) {\n      if (!byCategory.has(cat)) {\n        byCategory.set(cat, []);\n      }\n      byCategory.get(cat)!.push(rec);\n    }\n  }\n\n  let step = 1;\n  for (const category of categoryOrder) {\n    const recs = byCategory.get(category) || [];\n    // Sort by priority and relevance\n    recs.sort((a, b) => {\n      if (a.priority !== b.priority) {\n        const priorityOrder = { high: 0, medium: 1, low: 2 };\n        return priorityOrder[a.priority] - priorityOrder[b.priority];\n      }\n      return b.relevanceScore - a.relevanceScore;\n    });\n\n    for (const rec of recs.slice(0, 3)) { // Max 3 per category\n      const treatment = rec.treatment as Treatment | Surgery;\n      const operation: OrderOfOperation = {\n        step,\n        category,\n        treatment,\n        reasoning: getStepReasoning(step, category),\n      };\n\n      // Add prerequisites for surgical procedures\n      if (category === 'surgical') {\n        operation.prerequisites = ['Complete non-surgical options first', 'Consult with board-certified surgeon'];\n        operation.waitTime = '6-12 months recovery between major procedures';\n      }\n\n      operations.push(operation);\n      step++;\n    }\n  }\n\n  return operations;\n}\n\n/**\n * Generate reasoning for a step in order of operations\n */\nfunction getStepReasoning(\n  step: number,\n  category: TreatmentCategory\n): string {\n  if (step === 1) {\n    return 'Start with foundational changes before considering more invasive options.';\n  }\n\n  if (category === 'lifestyle' || category === 'softmaxxing') {\n    return 'Low-risk, reversible changes that can provide noticeable improvement.';\n  }\n\n  if (category === 'non_surgical') {\n    return 'Non-invasive treatments with minimal downtime to test results before committing to surgery.';\n  }\n\n  if (category === 'minimally_invasive') {\n    return 'Minimally invasive procedures can provide significant results with less risk than surgery.';\n  }\n\n  if (category === 'surgical') {\n    return 'Consider surgery only after exhausting less invasive options and with realistic expectations.';\n  }\n\n  return '';\n}\n\n// ============================================\n// UTILITY FUNCTIONS\n// ============================================\n\n/**\n * Get top priority recommendations across all categories\n */\nexport function getTopRecommendations(\n  plan: RecommendationPlan,\n  count: number = 5\n): TreatmentRecommendation[] {\n  const all = [\n    ...plan.lifestyle,\n    ...plan.softmaxxing,\n    ...plan.nonSurgical,\n    ...plan.minimallyInvasive,\n    ...plan.surgical,\n  ];\n\n  return all\n    .sort((a, b) => b.relevanceScore - a.relevanceScore)\n    .slice(0, count);\n}\n\n/**\n * Get recommendations filtered by cost level\n */\nexport function getRecommendationsByCost(\n  plan: RecommendationPlan,\n  maxCost: 'free' | 'low' | 'medium' | 'high' | 'very_high'\n): TreatmentRecommendation[] {\n  const costOrder = ['free', 'low', 'medium', 'high', 'very_high'];\n  const maxCostIndex = costOrder.indexOf(maxCost);\n\n  const all = [\n    ...plan.lifestyle,\n    ...plan.softmaxxing,\n    ...plan.nonSurgical,\n    ...plan.minimallyInvasive,\n    ...plan.surgical,\n  ];\n\n  return all.filter(r => {\n    const treatment = r.treatment as Treatment;\n    if ('costLevel' in treatment) {\n      return costOrder.indexOf(treatment.costLevel) <= maxCostIndex;\n    }\n    return true;\n  });\n}\n\n/**\n * Get recommendations with minimal downtime\n */\nexport function getNoDowntimeRecommendations(\n  plan: RecommendationPlan\n): TreatmentRecommendation[] {\n  const all = [\n    ...plan.lifestyle,\n    ...plan.softmaxxing,\n    ...plan.nonSurgical,\n    ...plan.minimallyInvasive,\n  ];\n\n  return all.filter(r => {\n    const treatment = r.treatment as Treatment;\n    if ('downtime' in treatment) {\n      const downtime = treatment.downtime.toLowerCase();\n      return downtime.includes('none') || downtime.includes('minimal');\n    }\n    return true;\n  });\n}\n\n/**\n * Format cost for display\n */\nexport function formatCost(treatment: Treatment | Surgery): string {\n  const { min, max, currency } = treatment.costRange;\n  const symbol = currency === 'USD' ? '$' : currency === 'EUR' ? '€' : currency === 'GBP' ? '£' : currency;\n\n  if (min === max) {\n    return `${symbol}${min.toLocaleString()}`;\n  }\n\n  return `${symbol}${min.toLocaleString()} - ${symbol}${max.toLocaleString()}`;\n}\n\n/**\n * Get summary statistics for a plan\n */\nexport function getPlanSummary(plan: RecommendationPlan): {\n  totalRecommendations: number;\n  highPriority: number;\n  mediumPriority: number;\n  lowPriority: number;\n  categoryCounts: Record<string, number>;\n  estimatedTotalImprovement: number;\n} {\n  const all = [\n    ...plan.lifestyle,\n    ...plan.softmaxxing,\n    ...plan.nonSurgical,\n    ...plan.minimallyInvasive,\n    ...plan.surgical,\n  ];\n\n  return {\n    totalRecommendations: all.length,\n    highPriority: all.filter(r => r.priority === 'high').length,\n    mediumPriority: all.filter(r => r.priority === 'medium').length,\n    lowPriority: all.filter(r => r.priority === 'low').length,\n    categoryCounts: {\n      lifestyle: plan.lifestyle.length,\n      softmaxxing: plan.softmaxxing.length,\n      nonSurgical: plan.nonSurgical.length,\n      minimallyInvasive: plan.minimallyInvasive.length,\n      surgical: plan.surgical.length,\n      supplements: plan.supplements.length,\n    },\n    estimatedTotalImprovement: plan.potentialImprovement,\n  };\n}\n","numLines":732,"startLine":1,"totalLines":732}}}
{"parentUuid":"730eb8a6-3289-4f66-9497-c8cf9cdcc914","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01WgrjC6E7h7vTEMsY7WJp1p","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useState } from 'react';\n     4→import { useRouter } from 'next/navigation';\n     5→import { useUpload } from '@/contexts/UploadContext';\n     6→import { useGender } from '@/contexts/GenderContext';\n     7→import { LandmarkAnalysisTool } from '@/components/LandmarkAnalysisTool';\n     8→import { ResultsDashboard } from '@/components/ResultsDashboard';\n     9→import { LandmarkPoint } from '@/lib/landmarks';\n    10→\n    11→type AnalysisStep = 'front' | 'side' | 'results';\n    12→\n    13→export default function AnalysisPage() {\n    14→  const router = useRouter();\n    15→  const { frontPhoto, sidePhoto } = useUpload();\n    16→  const { gender } = useGender();\n    17→  const [currentStep, setCurrentStep] = useState<AnalysisStep>('front');\n    18→  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>([]);\n    19→  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>([]);\n    20→\n    21→  // Redirect if no photos uploaded\n    22→  if (!frontPhoto && !sidePhoto) {\n    23→    return (\n    24→      <main className=\"min-h-screen bg-black flex flex-col items-center justify-center px-4\">\n    25→        <div className=\"text-center\">\n    26→          <h1 className=\"text-2xl font-semibold text-white mb-4\">No Photos Found</h1>\n    27→          <p className=\"text-neutral-400 mb-8\">\n    28→            Please upload your photos first to begin the analysis.\n    29→          </p>\n    30→          <button\n    31→            onClick={() => router.push('/upload')}\n    32→            className=\"h-12 px-8 rounded-xl bg-[#00f3ff] text-black font-medium hover:shadow-[0_0_20px_rgba(0,243,255,0.3)] transition-all\"\n    33→          >\n    34→            Go to Upload\n    35→          </button>\n    36→        </div>\n    37→      </main>\n    38→    );\n    39→  }\n    40→\n    41→  const handleFrontComplete = (landmarks: LandmarkPoint[]) => {\n    42→    setFrontLandmarks(landmarks);\n    43→    if (sidePhoto) {\n    44→      setCurrentStep('side');\n    45→    } else {\n    46→      setCurrentStep('results');\n    47→    }\n    48→  };\n    49→\n    50→  const handleSideComplete = (landmarks: LandmarkPoint[]) => {\n    51→    setSideLandmarks(landmarks);\n    52→    setCurrentStep('results');\n    53→  };\n    54→\n    55→  const handleBackFromFront = () => {\n    56→    router.push('/upload');\n    57→  };\n    58→\n    59→  const handleBackFromSide = () => {\n    60→    setCurrentStep('front');\n    61→  };\n    62→\n    63→  const handleBackFromResults = () => {\n    64→    setCurrentStep(sidePhoto ? 'side' : 'front');\n    65→  };\n    66→\n    67→  // Front Profile Analysis\n    68→  if (currentStep === 'front' && frontPhoto) {\n    69→    return (\n    70→      <LandmarkAnalysisTool\n    71→        imageUrl={frontPhoto.preview}\n    72→        mode=\"front\"\n    73→        onLandmarksChange={setFrontLandmarks}\n    74→        onComplete={handleFrontComplete}\n    75→        onBack={handleBackFromFront}\n    76→      />\n    77→    );\n    78→  }\n    79→\n    80→  // Side Profile Analysis\n    81→  if (currentStep === 'side' && sidePhoto) {\n    82→    return (\n    83→      <LandmarkAnalysisTool\n    84→        imageUrl={sidePhoto.preview}\n    85→        mode=\"side\"\n    86→        onLandmarksChange={setSideLandmarks}\n    87→        onComplete={handleSideComplete}\n    88→        onBack={handleBackFromSide}\n    89→      />\n    90→    );\n    91→  }\n    92→\n    93→  // Results Dashboard\n    94→  if (currentStep === 'results') {\n    95→    return (\n    96→      <main className=\"min-h-screen bg-black\">\n    97→        <div className=\"max-w-6xl mx-auto px-4 py-8\">\n    98→          <button\n    99→            onClick={handleBackFromResults}\n   100→            className=\"flex items-center gap-2 text-neutral-400 hover:text-white transition-colors text-sm mb-6\"\n   101→          >\n   102→            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n   103→              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n   104→            </svg>\n   105→            Back to Analysis\n   106→          </button>\n   107→          <ResultsDashboard\n   108→            frontLandmarks={frontLandmarks}\n   109→            sideLandmarks={sideLandmarks}\n   110→            gender={gender || 'male'}\n   111→          />\n   112→        </div>\n   113→      </main>\n   114→    );\n   115→  }\n   116→\n   117→  return null;\n   118→}\n   119→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"c6840f63-2b2f-4e67-b871-b8611215e6b4","timestamp":"2025-12-20T15:50:00.256Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/analysis/page.tsx","content":"'use client';\n\nimport { useState } from 'react';\nimport { useRouter } from 'next/navigation';\nimport { useUpload } from '@/contexts/UploadContext';\nimport { useGender } from '@/contexts/GenderContext';\nimport { LandmarkAnalysisTool } from '@/components/LandmarkAnalysisTool';\nimport { ResultsDashboard } from '@/components/ResultsDashboard';\nimport { LandmarkPoint } from '@/lib/landmarks';\n\ntype AnalysisStep = 'front' | 'side' | 'results';\n\nexport default function AnalysisPage() {\n  const router = useRouter();\n  const { frontPhoto, sidePhoto } = useUpload();\n  const { gender } = useGender();\n  const [currentStep, setCurrentStep] = useState<AnalysisStep>('front');\n  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>([]);\n  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>([]);\n\n  // Redirect if no photos uploaded\n  if (!frontPhoto && !sidePhoto) {\n    return (\n      <main className=\"min-h-screen bg-black flex flex-col items-center justify-center px-4\">\n        <div className=\"text-center\">\n          <h1 className=\"text-2xl font-semibold text-white mb-4\">No Photos Found</h1>\n          <p className=\"text-neutral-400 mb-8\">\n            Please upload your photos first to begin the analysis.\n          </p>\n          <button\n            onClick={() => router.push('/upload')}\n            className=\"h-12 px-8 rounded-xl bg-[#00f3ff] text-black font-medium hover:shadow-[0_0_20px_rgba(0,243,255,0.3)] transition-all\"\n          >\n            Go to Upload\n          </button>\n        </div>\n      </main>\n    );\n  }\n\n  const handleFrontComplete = (landmarks: LandmarkPoint[]) => {\n    setFrontLandmarks(landmarks);\n    if (sidePhoto) {\n      setCurrentStep('side');\n    } else {\n      setCurrentStep('results');\n    }\n  };\n\n  const handleSideComplete = (landmarks: LandmarkPoint[]) => {\n    setSideLandmarks(landmarks);\n    setCurrentStep('results');\n  };\n\n  const handleBackFromFront = () => {\n    router.push('/upload');\n  };\n\n  const handleBackFromSide = () => {\n    setCurrentStep('front');\n  };\n\n  const handleBackFromResults = () => {\n    setCurrentStep(sidePhoto ? 'side' : 'front');\n  };\n\n  // Front Profile Analysis\n  if (currentStep === 'front' && frontPhoto) {\n    return (\n      <LandmarkAnalysisTool\n        imageUrl={frontPhoto.preview}\n        mode=\"front\"\n        onLandmarksChange={setFrontLandmarks}\n        onComplete={handleFrontComplete}\n        onBack={handleBackFromFront}\n      />\n    );\n  }\n\n  // Side Profile Analysis\n  if (currentStep === 'side' && sidePhoto) {\n    return (\n      <LandmarkAnalysisTool\n        imageUrl={sidePhoto.preview}\n        mode=\"side\"\n        onLandmarksChange={setSideLandmarks}\n        onComplete={handleSideComplete}\n        onBack={handleBackFromSide}\n      />\n    );\n  }\n\n  // Results Dashboard\n  if (currentStep === 'results') {\n    return (\n      <main className=\"min-h-screen bg-black\">\n        <div className=\"max-w-6xl mx-auto px-4 py-8\">\n          <button\n            onClick={handleBackFromResults}\n            className=\"flex items-center gap-2 text-neutral-400 hover:text-white transition-colors text-sm mb-6\"\n          >\n            <svg className=\"w-4 h-4\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M15 19l-7-7 7-7\" />\n            </svg>\n            Back to Analysis\n          </button>\n          <ResultsDashboard\n            frontLandmarks={frontLandmarks}\n            sideLandmarks={sideLandmarks}\n            gender={gender || 'male'}\n          />\n        </div>\n      </main>\n    );\n  }\n\n  return null;\n}\n","numLines":119,"startLine":1,"totalLines":119}}}
{"parentUuid":"c6840f63-2b2f-4e67-b871-b8611215e6b4","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01D5sfoigtf7g9Jtcfyzs21d","type":"tool_result","content":"     1→/**\n     2→ * Facial Landmark Types and Default Data\n     3→ * Based on TECHNICAL_SPECS.md medical terminology\n     4→ */\n     5→\n     6→export interface LandmarkPoint {\n     7→  id: string;\n     8→  label: string;\n     9→  medicalTerm: string;\n    10→  description: string;\n    11→  x: number;\n    12→  y: number;\n    13→  category: string;\n    14→}\n    15→\n    16→export interface LandmarkCategory {\n    17→  name: string;\n    18→  color: string;\n    19→  landmarks: string[];\n    20→}\n    21→\n    22→// ============================================\n    23→// FRONT PROFILE LANDMARKS (52 Points)\n    24→// ============================================\n    25→\n    26→export const FRONT_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n    27→  {\n    28→    name: 'Head',\n    29→    color: '#FF6B6B',\n    30→    landmarks: ['trichion'],\n    31→  },\n    32→  {\n    33→    name: 'Eyes - Left',\n    34→    color: '#4ECDC4',\n    35→    landmarks: [\n    36→      'left_pupila',\n    37→      'left_canthus_medialis',\n    38→      'left_canthus_lateralis',\n    39→      'left_palpebra_superior',\n    40→      'left_palpebra_inferior',\n    41→      'left_sulcus_palpebralis_lateralis',\n    42→      'left_pretarsal_skin_crease',\n    43→    ],\n    44→  },\n    45→  {\n    46→    name: 'Eyes - Right',\n    47→    color: '#45B7D1',\n    48→    landmarks: [\n    49→      'right_pupila',\n    50→      'right_canthus_medialis',\n    51→      'right_canthus_lateralis',\n    52→      'right_palpebra_superior',\n    53→      'right_palpebra_inferior',\n    54→      'right_sulcus_palpebralis_lateralis',\n    55→      'right_pretarsal_skin_crease',\n    56→    ],\n    57→  },\n    58→  {\n    59→    name: 'Eyebrows - Left',\n    60→    color: '#96CEB4',\n    61→    landmarks: [\n    62→      'left_supercilium_medialis',\n    63→      'left_supercilium_medial_corner',\n    64→      'left_supercilium_superior',\n    65→      'left_supercilium_apex',\n    66→      'left_supercilium_lateralis',\n    67→    ],\n    68→  },\n    69→  {\n    70→    name: 'Eyebrows - Right',\n    71→    color: '#88D8B0',\n    72→    landmarks: [\n    73→      'right_supercilium_medialis',\n    74→      'right_supercilium_medial_corner',\n    75→      'right_supercilium_superior',\n    76→      'right_supercilium_apex',\n    77→      'right_supercilium_lateralis',\n    78→    ],\n    79→  },\n    80→  {\n    81→    name: 'Nose',\n    82→    color: '#FFEAA7',\n    83→    landmarks: [\n    84→      'nasal_base',\n    85→      'left_dorsum_nasi',\n    86→      'right_dorsum_nasi',\n    87→      'left_ala_nasi',\n    88→      'right_ala_nasi',\n    89→      'subnasale',\n    90→    ],\n    91→  },\n    92→  {\n    93→    name: 'Mouth',\n    94→    color: '#DDA0DD',\n    95→    landmarks: [\n    96→      'labrale_superius',\n    97→      'cupids_bow',\n    98→      'mouth_middle',\n    99→      'labrale_inferius',\n   100→      'left_cheilion',\n   101→      'right_cheilion',\n   102→    ],\n   103→  },\n   104→  {\n   105→    name: 'Jaw',\n   106→    color: '#F39C12',\n   107→    landmarks: [\n   108→      'left_gonion_superior',\n   109→      'right_gonion_superior',\n   110→      'left_gonion_inferior',\n   111→      'right_gonion_inferior',\n   112→    ],\n   113→  },\n   114→  {\n   115→    name: 'Chin',\n   116→    color: '#E74C3C',\n   117→    landmarks: ['left_mentum_lateralis', 'right_mentum_lateralis', 'menton'],\n   118→  },\n   119→  {\n   120→    name: 'Face Width',\n   121→    color: '#9B59B6',\n   122→    landmarks: [\n   123→      'left_zygion',\n   124→      'right_zygion',\n   125→      'left_temporal',\n   126→      'right_temporal',\n   127→      'left_auricular_lateral',\n   128→      'right_auricular_lateral',\n   129→    ],\n   130→  },\n   131→  {\n   132→    name: 'Neck',\n   133→    color: '#1ABC9C',\n   134→    landmarks: ['left_cervical_lateralis', 'right_cervical_lateralis'],\n   135→  },\n   136→];\n   137→\n   138→export const FRONT_PROFILE_LANDMARKS: LandmarkPoint[] = [\n   139→  // Head/Hair\n   140→  {\n   141→    id: 'trichion',\n   142→    label: 'Hairline',\n   143→    medicalTerm: 'Trichion (frontal view)',\n   144→    description: 'Anterior hairline at midline',\n   145→    x: 0.5,\n   146→    y: 0.08,\n   147→    category: 'Head',\n   148→  },\n   149→\n   150→  // Eyes - Left\n   151→  {\n   152→    id: 'left_pupila',\n   153→    label: 'Left Pupil',\n   154→    medicalTerm: 'Left Pupila',\n   155→    description: 'Center of left pupil',\n   156→    x: 0.38,\n   157→    y: 0.35,\n   158→    category: 'Eyes - Left',\n   159→  },\n   160→  {\n   161→    id: 'left_canthus_medialis',\n   162→    label: 'Left Medial Canthus',\n   163→    medicalTerm: 'Left Canthus Medialis',\n   164→    description: 'Inner corner of left eye',\n   165→    x: 0.42,\n   166→    y: 0.35,\n   167→    category: 'Eyes - Left',\n   168→  },\n   169→  {\n   170→    id: 'left_canthus_lateralis',\n   171→    label: 'Left Lateral Canthus',\n   172→    medicalTerm: 'Left Canthus Lateralis',\n   173→    description: 'Outer corner of left eye',\n   174→    x: 0.32,\n   175→    y: 0.34,\n   176→    category: 'Eyes - Left',\n   177→  },\n   178→  {\n   179→    id: 'left_palpebra_superior',\n   180→    label: 'Left Upper Eyelid',\n   181→    medicalTerm: 'Left Palpebra Superior',\n   182→    description: 'Upper eyelid of left eye',\n   183→    x: 0.37,\n   184→    y: 0.33,\n   185→    category: 'Eyes - Left',\n   186→  },\n   187→  {\n   188→    id: 'left_palpebra_inferior',\n   189→    label: 'Left Lower Eyelid',\n   190→    medicalTerm: 'Left Palpebra Inferior',\n   191→    description: 'Lower eyelid of left eye',\n   192→    x: 0.37,\n   193→    y: 0.37,\n   194→    category: 'Eyes - Left',\n   195→  },\n   196→  {\n   197→    id: 'left_sulcus_palpebralis_lateralis',\n   198→    label: 'Left Eyelid Hood End',\n   199→    medicalTerm: 'Left Sulcus Palpebralis Lateralis',\n   200→    description: 'Lateral end of left upper eyelid crease',\n   201→    x: 0.31,\n   202→    y: 0.33,\n   203→    category: 'Eyes - Left',\n   204→  },\n   205→  {\n   206→    id: 'left_pretarsal_skin_crease',\n   207→    label: 'Left Upper Eyelid Crease',\n   208→    medicalTerm: 'Left Pretarsal Skin Crease',\n   209→    description: 'Left upper eyelid crease',\n   210→    x: 0.37,\n   211→    y: 0.32,\n   212→    category: 'Eyes - Left',\n   213→  },\n   214→\n   215→  // Eyes - Right\n   216→  {\n   217→    id: 'right_pupila',\n   218→    label: 'Right Pupil',\n   219→    medicalTerm: 'Right Pupila',\n   220→    description: 'Center of right pupil',\n   221→    x: 0.62,\n   222→    y: 0.35,\n   223→    category: 'Eyes - Right',\n   224→  },\n   225→  {\n   226→    id: 'right_canthus_medialis',\n   227→    label: 'Right Medial Canthus',\n   228→    medicalTerm: 'Right Canthus Medialis',\n   229→    description: 'Inner corner of right eye',\n   230→    x: 0.58,\n   231→    y: 0.35,\n   232→    category: 'Eyes - Right',\n   233→  },\n   234→  {\n   235→    id: 'right_canthus_lateralis',\n   236→    label: 'Right Lateral Canthus',\n   237→    medicalTerm: 'Right Canthus Lateralis',\n   238→    description: 'Outer corner of right eye',\n   239→    x: 0.68,\n   240→    y: 0.34,\n   241→    category: 'Eyes - Right',\n   242→  },\n   243→  {\n   244→    id: 'right_palpebra_superior',\n   245→    label: 'Right Upper Eyelid',\n   246→    medicalTerm: 'Right Palpebra Superior',\n   247→    description: 'Upper eyelid of right eye',\n   248→    x: 0.63,\n   249→    y: 0.33,\n   250→    category: 'Eyes - Right',\n   251→  },\n   252→  {\n   253→    id: 'right_palpebra_inferior',\n   254→    label: 'Right Lower Eyelid',\n   255→    medicalTerm: 'Right Palpebra Inferior',\n   256→    description: 'Lower eyelid of right eye',\n   257→    x: 0.63,\n   258→    y: 0.37,\n   259→    category: 'Eyes - Right',\n   260→  },\n   261→  {\n   262→    id: 'right_sulcus_palpebralis_lateralis',\n   263→    label: 'Right Eyelid Hood End',\n   264→    medicalTerm: 'Right Sulcus Palpebralis Lateralis',\n   265→    description: 'Lateral end of right upper eyelid crease',\n   266→    x: 0.69,\n   267→    y: 0.33,\n   268→    category: 'Eyes - Right',\n   269→  },\n   270→  {\n   271→    id: 'right_pretarsal_skin_crease',\n   272→    label: 'Right Upper Eyelid Crease',\n   273→    medicalTerm: 'Right Pretarsal Skin Crease',\n   274→    description: 'Right upper eyelid crease',\n   275→    x: 0.63,\n   276→    y: 0.32,\n   277→    category: 'Eyes - Right',\n   278→  },\n   279→\n   280→  // Eyebrows - Left\n   281→  {\n   282→    id: 'left_supercilium_medialis',\n   283→    label: 'Left Brow Head',\n   284→    medicalTerm: 'Left Supercilium Medialis',\n   285→    description: 'Medial start of left eyebrow',\n   286→    x: 0.43,\n   287→    y: 0.28,\n   288→    category: 'Eyebrows - Left',\n   289→  },\n   290→  {\n   291→    id: 'left_supercilium_medial_corner',\n   292→    label: 'Left Brow Inner Corner',\n   293→    medicalTerm: 'Left Supercilium Medial Corner',\n   294→    description: 'Inner corner of left eyebrow',\n   295→    x: 0.41,\n   296→    y: 0.27,\n   297→    category: 'Eyebrows - Left',\n   298→  },\n   299→  {\n   300→    id: 'left_supercilium_superior',\n   301→    label: 'Left Brow Arch',\n   302→    medicalTerm: 'Left Supercilium Superior',\n   303→    description: 'Superior arc of left eyebrow',\n   304→    x: 0.36,\n   305→    y: 0.26,\n   306→    category: 'Eyebrows - Left',\n   307→  },\n   308→  {\n   309→    id: 'left_supercilium_apex',\n   310→    label: 'Left Brow Peak',\n   311→    medicalTerm: 'Left Supercilium Apex',\n   312→    description: 'Highest point of left eyebrow',\n   313→    x: 0.34,\n   314→    y: 0.26,\n   315→    category: 'Eyebrows - Left',\n   316→  },\n   317→  {\n   318→    id: 'left_supercilium_lateralis',\n   319→    label: 'Left Brow Tail',\n   320→    medicalTerm: 'Left Supercilium Lateralis',\n   321→    description: 'Lateral end of left eyebrow',\n   322→    x: 0.29,\n   323→    y: 0.28,\n   324→    category: 'Eyebrows - Left',\n   325→  },\n   326→\n   327→  // Eyebrows - Right\n   328→  {\n   329→    id: 'right_supercilium_medialis',\n   330→    label: 'Right Brow Head',\n   331→    medicalTerm: 'Right Supercilium Medialis',\n   332→    description: 'Medial start of right eyebrow',\n   333→    x: 0.57,\n   334→    y: 0.28,\n   335→    category: 'Eyebrows - Right',\n   336→  },\n   337→  {\n   338→    id: 'right_supercilium_medial_corner',\n   339→    label: 'Right Brow Inner Corner',\n   340→    medicalTerm: 'Right Supercilium Medial Corner',\n   341→    description: 'Inner corner of right eyebrow',\n   342→    x: 0.59,\n   343→    y: 0.27,\n   344→    category: 'Eyebrows - Right',\n   345→  },\n   346→  {\n   347→    id: 'right_supercilium_superior',\n   348→    label: 'Right Brow Arch',\n   349→    medicalTerm: 'Right Supercilium Superior',\n   350→    description: 'Superior arc of right eyebrow',\n   351→    x: 0.64,\n   352→    y: 0.26,\n   353→    category: 'Eyebrows - Right',\n   354→  },\n   355→  {\n   356→    id: 'right_supercilium_apex',\n   357→    label: 'Right Brow Peak',\n   358→    medicalTerm: 'Right Supercilium Apex',\n   359→    description: 'Highest point of right eyebrow',\n   360→    x: 0.66,\n   361→    y: 0.26,\n   362→    category: 'Eyebrows - Right',\n   363→  },\n   364→  {\n   365→    id: 'right_supercilium_lateralis',\n   366→    label: 'Right Brow Tail',\n   367→    medicalTerm: 'Right Supercilium Lateralis',\n   368→    description: 'Lateral end of right eyebrow',\n   369→    x: 0.71,\n   370→    y: 0.28,\n   371→    category: 'Eyebrows - Right',\n   372→  },\n   373→\n   374→  // Nose\n   375→  {\n   376→    id: 'nasal_base',\n   377→    label: 'Nasal Base',\n   378→    medicalTerm: 'Nasal Base',\n   379→    description: 'Base of nasal dorsum',\n   380→    x: 0.5,\n   381→    y: 0.38,\n   382→    category: 'Nose',\n   383→  },\n   384→  {\n   385→    id: 'left_dorsum_nasi',\n   386→    label: 'Left Nose Bridge',\n   387→    medicalTerm: 'Left Dorsum Nasi',\n   388→    description: 'Left side of nasal bridge',\n   389→    x: 0.47,\n   390→    y: 0.42,\n   391→    category: 'Nose',\n   392→  },\n   393→  {\n   394→    id: 'right_dorsum_nasi',\n   395→    label: 'Right Nose Bridge',\n   396→    medicalTerm: 'Right Dorsum Nasi',\n   397→    description: 'Right side of nasal bridge',\n   398→    x: 0.53,\n   399→    y: 0.42,\n   400→    category: 'Nose',\n   401→  },\n   402→  {\n   403→    id: 'left_ala_nasi',\n   404→    label: 'Left Nose Side',\n   405→    medicalTerm: 'Left Ala Nasi',\n   406→    description: 'Lateral aspect of left nasal ala',\n   407→    x: 0.44,\n   408→    y: 0.5,\n   409→    category: 'Nose',\n   410→  },\n   411→  {\n   412→    id: 'right_ala_nasi',\n   413→    label: 'Right Nose Side',\n   414→    medicalTerm: 'Right Ala Nasi',\n   415→    description: 'Lateral aspect of right nasal ala',\n   416→    x: 0.56,\n   417→    y: 0.5,\n   418→    category: 'Nose',\n   419→  },\n   420→  {\n   421→    id: 'subnasale',\n   422→    label: 'Nose Bottom',\n   423→    medicalTerm: 'Subnasale',\n   424→    description: 'Junction of columella and upper lip',\n   425→    x: 0.5,\n   426→    y: 0.52,\n   427→    category: 'Nose',\n   428→  },\n   429→\n   430→  // Mouth\n   431→  {\n   432→    id: 'labrale_superius',\n   433→    label: \"Cupid's Bow\",\n   434→    medicalTerm: 'Labrale Superius',\n   435→    description: 'Midpoint of upper lip vermilion',\n   436→    x: 0.5,\n   437→    y: 0.58,\n   438→    category: 'Mouth',\n   439→  },\n   440→  {\n   441→    id: 'cupids_bow',\n   442→    label: \"Inner Cupid's Bow\",\n   443→    medicalTerm: \"Cupid's Bow\",\n   444→    description: 'Central peak of upper lip',\n   445→    x: 0.5,\n   446→    y: 0.57,\n   447→    category: 'Mouth',\n   448→  },\n   449→  {\n   450→    id: 'mouth_middle',\n   451→    label: 'Mouth Middle',\n   452→    medicalTerm: 'Mouth Middle',\n   453→    description: 'Center of mouth opening',\n   454→    x: 0.5,\n   455→    y: 0.62,\n   456→    category: 'Mouth',\n   457→  },\n   458→  {\n   459→    id: 'labrale_inferius',\n   460→    label: 'Lower Lip Center',\n   461→    medicalTerm: 'Labrale Inferius',\n   462→    description: 'Midpoint of lower lip vermilion border',\n   463→    x: 0.5,\n   464→    y: 0.66,\n   465→    category: 'Mouth',\n   466→  },\n   467→  {\n   468→    id: 'left_cheilion',\n   469→    label: 'Left Mouth Corner',\n   470→    medicalTerm: 'Left Cheilion',\n   471→    description: 'Left oral commissure',\n   472→    x: 0.42,\n   473→    y: 0.62,\n   474→    category: 'Mouth',\n   475→  },\n   476→  {\n   477→    id: 'right_cheilion',\n   478→    label: 'Right Mouth Corner',\n   479→    medicalTerm: 'Right Cheilion',\n   480→    description: 'Right oral commissure',\n   481→    x: 0.58,\n   482→    y: 0.62,\n   483→    category: 'Mouth',\n   484→  },\n   485→\n   486→  // Jaw\n   487→  {\n   488→    id: 'left_gonion_superior',\n   489→    label: 'Left Upper Jaw Angle',\n   490→    medicalTerm: 'Left Gonion Superior',\n   491→    description: 'Superior aspect of left mandibular angle',\n   492→    x: 0.22,\n   493→    y: 0.55,\n   494→    category: 'Jaw',\n   495→  },\n   496→  {\n   497→    id: 'right_gonion_superior',\n   498→    label: 'Right Upper Jaw Angle',\n   499→    medicalTerm: 'Right Gonion Superior',\n   500→    description: 'Superior aspect of right mandibular angle',\n   501→    x: 0.78,\n   502→    y: 0.55,\n   503→    category: 'Jaw',\n   504→  },\n   505→  {\n   506→    id: 'left_gonion_inferior',\n   507→    label: 'Left Lower Jaw Angle',\n   508→    medicalTerm: 'Left Gonion Inferior',\n   509→    description: 'Inferior aspect of left mandibular angle',\n   510→    x: 0.24,\n   511→    y: 0.7,\n   512→    category: 'Jaw',\n   513→  },\n   514→  {\n   515→    id: 'right_gonion_inferior',\n   516→    label: 'Right Lower Jaw Angle',\n   517→    medicalTerm: 'Right Gonion Inferior',\n   518→    description: 'Inferior aspect of right mandibular angle',\n   519→    x: 0.76,\n   520→    y: 0.7,\n   521→    category: 'Jaw',\n   522→  },\n   523→\n   524→  // Chin\n   525→  {\n   526→    id: 'left_mentum_lateralis',\n   527→    label: 'Left Chin',\n   528→    medicalTerm: 'Left Mentum Lateralis',\n   529→    description: 'Left lateral chin',\n   530→    x: 0.42,\n   531→    y: 0.8,\n   532→    category: 'Chin',\n   533→  },\n   534→  {\n   535→    id: 'right_mentum_lateralis',\n   536→    label: 'Right Chin',\n   537→    medicalTerm: 'Right Mentum Lateralis',\n   538→    description: 'Right lateral chin',\n   539→    x: 0.58,\n   540→    y: 0.8,\n   541→    category: 'Chin',\n   542→  },\n   543→  {\n   544→    id: 'menton',\n   545→    label: 'Chin Bottom',\n   546→    medicalTerm: 'Menton',\n   547→    description: 'Lowest point of chin in midline',\n   548→    x: 0.5,\n   549→    y: 0.88,\n   550→    category: 'Chin',\n   551→  },\n   552→\n   553→  // Face Width\n   554→  {\n   555→    id: 'left_zygion',\n   556→    label: 'Left Cheekbone',\n   557→    medicalTerm: 'Left Zygion',\n   558→    description: 'Most lateral point of left zygomatic arch',\n   559→    x: 0.18,\n   560→    y: 0.42,\n   561→    category: 'Face Width',\n   562→  },\n   563→  {\n   564→    id: 'right_zygion',\n   565→    label: 'Right Cheekbone',\n   566→    medicalTerm: 'Right Zygion',\n   567→    description: 'Most lateral point of right zygomatic arch',\n   568→    x: 0.82,\n   569→    y: 0.42,\n   570→    category: 'Face Width',\n   571→  },\n   572→  {\n   573→    id: 'left_temporal',\n   574→    label: 'Left Temple',\n   575→    medicalTerm: 'Left Temporal Point',\n   576→    description: 'Left temporal region',\n   577→    x: 0.2,\n   578→    y: 0.3,\n   579→    category: 'Face Width',\n   580→  },\n   581→  {\n   582→    id: 'right_temporal',\n   583→    label: 'Right Temple',\n   584→    medicalTerm: 'Right Temporal Point',\n   585→    description: 'Right temporal region',\n   586→    x: 0.8,\n   587→    y: 0.3,\n   588→    category: 'Face Width',\n   589→  },\n   590→  {\n   591→    id: 'left_auricular_lateral',\n   592→    label: 'Left Outer Ear',\n   593→    medicalTerm: 'Left Auricular Lateral Point',\n   594→    description: 'Lateral-most point of left ear',\n   595→    x: 0.12,\n   596→    y: 0.4,\n   597→    category: 'Face Width',\n   598→  },\n   599→  {\n   600→    id: 'right_auricular_lateral',\n   601→    label: 'Right Outer Ear',\n   602→    medicalTerm: 'Right Auricular Lateral Point',\n   603→    description: 'Lateral-most point of right ear',\n   604→    x: 0.88,\n   605→    y: 0.4,\n   606→    category: 'Face Width',\n   607→  },\n   608→\n   609→  // Neck\n   610→  {\n   611→    id: 'left_cervical_lateralis',\n   612→    label: 'Left Neck Point',\n   613→    medicalTerm: 'Left Cervical Lateralis',\n   614→    description: 'Left cervical point',\n   615→    x: 0.35,\n   616→    y: 0.95,\n   617→    category: 'Neck',\n   618→  },\n   619→  {\n   620→    id: 'right_cervical_lateralis',\n   621→    label: 'Right Neck Point',\n   622→    medicalTerm: 'Right Cervical Lateralis',\n   623→    description: 'Right cervical point',\n   624→    x: 0.65,\n   625→    y: 0.95,\n   626→    category: 'Neck',\n   627→  },\n   628→];\n   629→\n   630→// ============================================\n   631→// SIDE PROFILE LANDMARKS (28 Points)\n   632→// Matches FaceIQ Labs exact naming and order\n   633→// ============================================\n   634→\n   635→export const SIDE_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n   636→  {\n   637→    name: 'Cranium',\n   638→    color: '#FF6B6B',\n   639→    landmarks: ['vertex', 'occiput', 'trichion'],\n   640→  },\n   641→  {\n   642→    name: 'Forehead',\n   643→    color: '#4ECDC4',\n   644→    landmarks: ['glabella'],\n   645→  },\n   646→  {\n   647→    name: 'Eye Region',\n   648→    color: '#45B7D1',\n   649→    landmarks: ['cornealApex', 'orbitale'],\n   650→  },\n   651→  {\n   652→    name: 'Nose',\n   653→    color: '#FFEAA7',\n   654→    landmarks: [\n   655→      'nasion',\n   656→      'rhinion',\n   657→      'supratip',\n   658→      'pronasale',\n   659→      'infratip',\n   660→      'columella',\n   661→      'subnasale',\n   662→      'subalare',\n   663→    ],\n   664→  },\n   665→  {\n   666→    name: 'Lips',\n   667→    color: '#DDA0DD',\n   668→    landmarks: ['labraleSuperius', 'cheilion', 'labraleInferius', 'sublabiale'],\n   669→  },\n   670→  {\n   671→    name: 'Chin',\n   672→    color: '#E74C3C',\n   673→    landmarks: ['pogonion', 'menton'],\n   674→  },\n   675→  {\n   676→    name: 'Jaw',\n   677→    color: '#F39C12',\n   678→    landmarks: ['gonionTop', 'gonionBottom'],\n   679→  },\n   680→  {\n   681→    name: 'Cheek',\n   682→    color: '#9B59B6',\n   683→    landmarks: ['cheekbone'],\n   684→  },\n   685→  {\n   686→    name: 'Ear',\n   687→    color: '#3498DB',\n   688→    landmarks: ['porion', 'tragus', 'intertragicNotch'],\n   689→  },\n   690→  {\n   691→    name: 'Neck',\n   692→    color: '#1ABC9C',\n   693→    landmarks: ['cervicalPoint', 'neckPoint'],\n   694→  },\n   695→];\n   696→\n   697→// FaceIQ order: vertex, occiput, pronasale, neckPoint, porion, orbitale, tragus,\n   698→// intertragicNotch, cornealApex, cheekbone, trichion, glabella, nasion, rhinion,\n   699→// supratip, infratip, columella, subnasale, subalare, labraleSuperius, cheilion,\n   700→// labraleInferius, sublabiale, pogonion, menton, cervicalPoint, gonionTop, gonionBottom\n   701→export const SIDE_PROFILE_LANDMARKS: LandmarkPoint[] = [\n   702→  // 1. vertex\n   703→  {\n   704→    id: 'vertex',\n   705→    label: 'Top of Head',\n   706→    medicalTerm: 'Vertex',\n   707→    description: 'Highest point on the head in profile',\n   708→    x: 0.45,\n   709→    y: 0.02,\n   710→    category: 'Cranium',\n   711→  },\n   712→  // 2. occiput\n   713→  {\n   714→    id: 'occiput',\n   715→    label: 'Occiput',\n   716→    medicalTerm: 'External Occipital Region',\n   717→    description: 'Back-of-head prominence',\n   718→    x: 0.85,\n   719→    y: 0.15,\n   720→    category: 'Cranium',\n   721→  },\n   722→  // 3. pronasale\n   723→  {\n   724→    id: 'pronasale',\n   725→    label: 'Nose Tip',\n   726→    medicalTerm: 'Pronasale',\n   727→    description: 'Most forward point of the nose tip',\n   728→    x: 0.18,\n   729→    y: 0.48,\n   730→    category: 'Nose',\n   731→  },\n   732→  // 4. neckPoint\n   733→  {\n   734→    id: 'neckPoint',\n   735→    label: 'Neck Point',\n   736→    medicalTerm: 'Anterior Cervical Landmark',\n   737→    description: 'Lower neck inflection on the front border',\n   738→    x: 0.4,\n   739→    y: 0.88,\n   740→    category: 'Neck',\n   741→  },\n   742→  // 5. porion\n   743→  {\n   744→    id: 'porion',\n   745→    label: 'Porion',\n   746→    medicalTerm: 'Porion (soft tissue)',\n   747→    description: 'Upper margin of ear canal opening, used for Frankfort horizontal plane',\n   748→    x: 0.75,\n   749→    y: 0.35,\n   750→    category: 'Ear',\n   751→  },\n   752→  // 6. orbitale\n   753→  {\n   754→    id: 'orbitale',\n   755→    label: 'Orbitale',\n   756→    medicalTerm: 'Orbitale',\n   757→    description: 'Lowest point on the orbital rim',\n   758→    x: 0.35,\n   759→    y: 0.38,\n   760→    category: 'Eye Region',\n   761→  },\n   762→  // 7. tragus\n   763→  {\n   764→    id: 'tragus',\n   765→    label: 'Tragus',\n   766→    medicalTerm: 'Tragion (soft tissue)',\n   767→    description: 'Cartilage nub in front of the ear canal',\n   768→    x: 0.72,\n   769→    y: 0.42,\n   770→    category: 'Ear',\n   771→  },\n   772→  // 8. intertragicNotch\n   773→  {\n   774→    id: 'intertragicNotch',\n   775→    label: 'Intertragic Notch',\n   776→    medicalTerm: 'Incisura Intertragica',\n   777→    description: 'Notch between tragus and antitragus cartilages',\n   778→    x: 0.73,\n   779→    y: 0.45,\n   780→    category: 'Ear',\n   781→  },\n   782→  // 9. cornealApex\n   783→  {\n   784→    id: 'cornealApex',\n   785→    label: 'Corneal Apex',\n   786→    medicalTerm: 'Corneal Apex',\n   787→    description: 'Most forward point of the eye (cornea)',\n   788→    x: 0.28,\n   789→    y: 0.34,\n   790→    category: 'Eye Region',\n   791→  },\n   792→  // 10. cheekbone\n   793→  {\n   794→    id: 'cheekbone',\n   795→    label: 'Cheekbone',\n   796→    medicalTerm: 'Zygion (soft-tissue over zygoma)',\n   797→    description: 'Zygomatic prominence',\n   798→    x: 0.45,\n   799→    y: 0.42,\n   800→    category: 'Cheek',\n   801→  },\n   802→  // 11. trichion\n   803→  {\n   804→    id: 'trichion',\n   805→    label: 'Hairline (Profile)',\n   806→    medicalTerm: 'Trichion',\n   807→    description: 'Forehead hairline point',\n   808→    x: 0.35,\n   809→    y: 0.1,\n   810→    category: 'Cranium',\n   811→  },\n   812→  // 12. glabella\n   813→  {\n   814→    id: 'glabella',\n   815→    label: 'Glabella',\n   816→    medicalTerm: 'Glabella',\n   817→    description: 'Mid-forehead point between brows',\n   818→    x: 0.32,\n   819→    y: 0.28,\n   820→    category: 'Forehead',\n   821→  },\n   822→  // 13. nasion\n   823→  {\n   824→    id: 'nasion',\n   825→    label: 'Nasal Bridge Root',\n   826→    medicalTerm: 'Nasion',\n   827→    description: 'Nasal root depression',\n   828→    x: 0.35,\n   829→    y: 0.32,\n   830→    category: 'Nose',\n   831→  },\n   832→  // 14. rhinion\n   833→  {\n   834→    id: 'rhinion',\n   835→    label: 'Rhinion',\n   836→    medicalTerm: 'Rhinion',\n   837→    description: 'Dorsal point of the nose',\n   838→    x: 0.28,\n   839→    y: 0.4,\n   840→    category: 'Nose',\n   841→  },\n   842→  // 15. supratip\n   843→  {\n   844→    id: 'supratip',\n   845→    label: 'Supratip',\n   846→    medicalTerm: 'Supratip Break',\n   847→    description: 'Dorsal point just above the tip',\n   848→    x: 0.22,\n   849→    y: 0.46,\n   850→    category: 'Nose',\n   851→  },\n   852→  // 16. infratip\n   853→  {\n   854→    id: 'infratip',\n   855→    label: 'Infratip',\n   856→    medicalTerm: 'Infratip Lobule',\n   857→    description: 'Point between nose tip and columella',\n   858→    x: 0.2,\n   859→    y: 0.5,\n   860→    category: 'Nose',\n   861→  },\n   862→  // 17. columella\n   863→  {\n   864→    id: 'columella',\n   865→    label: 'Columella',\n   866→    medicalTerm: 'Columella Nasi',\n   867→    description: 'Inferior border of the nasal septum between nostrils',\n   868→    x: 0.24,\n   869→    y: 0.52,\n   870→    category: 'Nose',\n   871→  },\n   872→  // 18. subnasale\n   873→  {\n   874→    id: 'subnasale',\n   875→    label: 'Subnasale',\n   876→    medicalTerm: 'Subnasale',\n   877→    description: 'Where nose base meets upper lip',\n   878→    x: 0.3,\n   879→    y: 0.54,\n   880→    category: 'Nose',\n   881→  },\n   882→  // 19. subalare\n   883→  {\n   884→    id: 'subalare',\n   885→    label: 'Subalare',\n   886→    medicalTerm: 'Subalare',\n   887→    description: 'Lowest point of the nostril wing on the visible side',\n   888→    x: 0.28,\n   889→    y: 0.53,\n   890→    category: 'Nose',\n   891→  },\n   892→  // 20. labraleSuperius\n   893→  {\n   894→    id: 'labraleSuperius',\n   895→    label: 'Upper Lip',\n   896→    medicalTerm: 'Labrale Superius',\n   897→    description: 'Most forward point of the upper lip vermilion',\n   898→    x: 0.28,\n   899→    y: 0.58,\n   900→    category: 'Lips',\n   901→  },\n   902→  // 21. cheilion\n   903→  {\n   904→    id: 'cheilion',\n   905→    label: 'Mouth Corner',\n   906→    medicalTerm: 'Cheilion',\n   907→    description: 'Mouth corner where the lips meet',\n   908→    x: 0.35,\n   909→    y: 0.62,\n   910→    category: 'Lips',\n   911→  },\n   912→  // 22. labraleInferius\n   913→  {\n   914→    id: 'labraleInferius',\n   915→    label: 'Lower Lip',\n   916→    medicalTerm: 'Labrale Inferius',\n   917→    description: 'Most forward point of the lower lip vermilion',\n   918→    x: 0.3,\n   919→    y: 0.66,\n   920→    category: 'Lips',\n   921→  },\n   922→  // 23. sublabiale\n   923→  {\n   924→    id: 'sublabiale',\n   925→    label: 'Labiomental Fold',\n   926→    medicalTerm: 'Sublabiale',\n   927→    description: 'Deepest point of the crease between lower lip and chin',\n   928→    x: 0.32,\n   929→    y: 0.7,\n   930→    category: 'Lips',\n   931→  },\n   932→  // 24. pogonion\n   933→  {\n   934→    id: 'pogonion',\n   935→    label: 'Chin Point',\n   936→    medicalTerm: 'Pogonion (soft tissue)',\n   937→    description: 'Most forward point on the soft-tissue chin',\n   938→    x: 0.3,\n   939→    y: 0.76,\n   940→    category: 'Chin',\n   941→  },\n   942→  // 25. menton\n   943→  {\n   944→    id: 'menton',\n   945→    label: 'Chin Bottom',\n   946→    medicalTerm: 'Menton (soft tissue)',\n   947→    description: 'Lowest point on the soft-tissue chin',\n   948→    x: 0.35,\n   949→    y: 0.82,\n   950→    category: 'Chin',\n   951→  },\n   952→  // 26. cervicalPoint\n   953→  {\n   954→    id: 'cervicalPoint',\n   955→    label: 'Cervical Point',\n   956→    medicalTerm: 'Cervicale (soft-tissue reference)',\n   957→    description: 'High neck point just under the jaw',\n   958→    x: 0.5,\n   959→    y: 0.9,\n   960→    category: 'Neck',\n   961→  },\n   962→  // 27. gonionTop\n   963→  {\n   964→    id: 'gonionTop',\n   965→    label: 'Upper Jaw Angle',\n   966→    medicalTerm: 'Gonion Superior',\n   967→    description: 'Upper angle point of the jaw from side profile',\n   968→    x: 0.7,\n   969→    y: 0.6,\n   970→    category: 'Jaw',\n   971→  },\n   972→  // 28. gonionBottom\n   973→  {\n   974→    id: 'gonionBottom',\n   975→    label: 'Lower Jaw Angle',\n   976→    medicalTerm: 'Gonion Inferior',\n   977→    description: 'Lower angle point of the jaw from side profile',\n   978→    x: 0.65,\n   979→    y: 0.72,\n   980→    category: 'Jaw',\n   981→  },\n   982→];\n   983→\n   984→// ============================================\n   985→// MediaPipe Face Mesh Index Mapping\n   986→// ============================================\n   987→// NOTE: MEDIAPIPE_FRONT_MAPPING is defined in mediapipeDetection.ts (single source of truth)\n   988→// Import from there if needed: import { MEDIAPIPE_FRONT_MAPPING } from './mediapipeDetection';\n   989→\n   990→// Helper to get category color for a landmark\n   991→export function getLandmarkColor(\n   992→  landmarkId: string,\n   993→  categories: LandmarkCategory[]\n   994→): string {\n   995→  for (const category of categories) {\n   996→    if (category.landmarks.includes(landmarkId)) {\n   997→      return category.color;\n   998→    }\n   999→  }\n  1000→  return '#00f3ff'; // Default cyan\n  1001→}\n  1002→\n  1003→// ============================================\n  1004→// FaceIQ Side Profile Landmark Indices (106 points)\n  1005→// Reverse-engineered from FaceIQ Labs API\n  1006→// ============================================\n  1007→\n  1008→export const FACEIQ_SIDE_LANDMARKS = {\n  1009→  // Face Contour (0-16) - Jaw/Chin outline\n  1010→  MENTON: 0, // Chin bottom (lowest point)\n  1011→  POGONION: 2, // Chin prominence\n  1012→  GNATHION: 3, // Chin point\n  1013→  MANDIBLE_CONTOUR: [2, 3, 4, 5, 6, 7, 8], // Jaw line\n  1014→\n  1015→  // Posterior Points (1, 9-16) - Ear/Back of head\n  1016→  TRAGION: 1, // Ear point\n  1017→  EAR_CONTOUR: [9, 10, 11, 12, 13, 14, 15, 16],\n  1018→\n  1019→  // Forehead/Hairline (17)\n  1020→  TRICHION: 17, // Hairline\n  1021→\n  1022→  // Nose Profile (18-32)\n  1023→  NASION: 25, // Bridge of nose (deepest point)\n  1024→  PRONASALE: 32, // Nose tip\n  1025→  SUBNASALE: 52, // Base of nose\n  1026→  COLUMELLA: 53, // Nose columella\n  1027→  NOSE_BRIDGE: [25, 26, 27, 28, 29, 30, 31, 32],\n  1028→  NOSE_TIP_CONTOUR: [52, 53, 54, 55, 56, 57, 58, 59, 60],\n  1029→\n  1030→  // Eye Region (33-51)\n  1031→  EYE_LATERAL_CANTHUS: 33, // Outer eye corner\n  1032→  EYE_MEDIAL_CANTHUS: 35, // Inner eye corner\n  1033→  UPPER_EYELID: [37, 38, 39],\n  1034→  LOWER_EYELID: [40, 41, 42],\n  1035→  PUPIL: 34,\n  1036→  BROW_HEAD: 44, // Inner brow\n  1037→  BROW_ARCH: 45, // Brow peak\n  1038→  BROW_TAIL: 46, // Outer brow\n  1039→\n  1040→  // Lip Region (52-75)\n  1041→  LABRALE_SUPERIUS: 63, // Upper lip top\n  1042→  LABRALE_INFERIUS: 66, // Lower lip bottom\n  1043→  STOMION: 65, // Lip meeting point\n  1044→  UPPER_LIP_CONTOUR: [63, 64, 65],\n  1045→  LOWER_LIP_CONTOUR: [66, 67, 68],\n  1046→\n  1047→  // Additional Profile Points (76-105)\n  1048→  GLABELLA: 76, // Between eyebrows\n  1049→  SELLION: 77, // Deepest point of nasal bridge\n  1050→  SOFT_TISSUE_NASION: 78,\n  1051→  ORBITALE: 79, // Lowest point of eye socket\n  1052→  GONION: 85, // Jaw angle\n  1053→  CONDYLION: 86, // Top of jaw joint\n  1054→};\n  1055→\n  1056→// ============================================\n  1057→// FaceIQ Front Face Landmark Indices (MediaPipe 478 points)\n  1058→// ============================================\n  1059→\n  1060→export const FACEIQ_FRONT_LANDMARKS = {\n  1061→  // Key points from MediaPipe Face Mesh\n  1062→  NOSE_TIP: 1,\n  1063→  LEFT_EYE_INNER: 133,\n  1064→  LEFT_EYE_OUTER: 33,\n  1065→  RIGHT_EYE_INNER: 362,\n  1066→  RIGHT_EYE_OUTER: 263,\n  1067→  LEFT_CHEEK: 234,\n  1068→  RIGHT_CHEEK: 454,\n  1069→  UPPER_LIP: 13,\n  1070→  LOWER_LIP: 14,\n  1071→  CHIN: 152,\n  1072→  FOREHEAD: 10,\n  1073→  LEFT_EAR: 234,\n  1074→  RIGHT_EAR: 454,\n  1075→  LEFT_BROW_INNER: 107,\n  1076→  LEFT_BROW_OUTER: 70,\n  1077→  RIGHT_BROW_INNER: 336,\n  1078→  RIGHT_BROW_OUTER: 300,\n  1079→  NOSE_BRIDGE: 6,\n  1080→  LEFT_NOSTRIL: 129,\n  1081→  RIGHT_NOSTRIL: 358,\n  1082→};\n  1083→\n  1084→// ============================================\n  1085→// Scoring Configuration Types\n  1086→// ============================================\n  1087→\n  1088→export interface ScoringConfig {\n  1089→  idealValue: number;\n  1090→  standardDeviation: number;\n  1091→  minScore: number;\n  1092→  maxScore: number;\n  1093→  weight: number;\n  1094→}\n  1095→\n  1096→export interface GenderSpecificValues {\n  1097→  male: { ideal: number; range: [number, number] };\n  1098→  female: { ideal: number; range: [number, number] };\n  1099→}\n  1100→\n  1101→// ============================================\n  1102→// FaceIQ Ideal Values (Gender-Specific)\n  1103→// ============================================\n  1104→\n  1105→export const FACEIQ_IDEAL_VALUES: Record<string, GenderSpecificValues> = {\n  1106→  fwhr: {\n  1107→    male: { ideal: 1.9, range: [1.8, 2.1] },\n  1108→    female: { ideal: 1.75, range: [1.6, 1.9] },\n  1109→  },\n  1110→  canthalTilt: {\n  1111→    male: { ideal: 4, range: [2, 7] },\n  1112→    female: { ideal: 6, range: [4, 10] },\n  1113→  },\n  1114→  nasolabialAngle: {\n  1115→    male: { ideal: 95, range: [90, 100] },\n  1116→    female: { ideal: 105, range: [100, 115] },\n  1117→  },\n  1118→  gonialAngle: {\n  1119→    male: { ideal: 125, range: [120, 130] },\n  1120→    female: { ideal: 128, range: [125, 135] },\n  1121→  },\n  1122→  nasalIndex: {\n  1123→    male: { ideal: 0.7, range: [0.65, 0.75] },\n  1124→    female: { ideal: 0.65, range: [0.6, 0.7] },\n  1125→  },\n  1126→  lipRatio: {\n  1127→    male: { ideal: 0.5, range: [0.4, 0.6] },\n  1128→    female: { ideal: 0.5, range: [0.45, 0.55] },\n  1129→  },\n  1130→  facialConvexity: {\n  1131→    male: { ideal: 170, range: [165, 175] },\n  1132→    female: { ideal: 168, range: [163, 173] },\n  1133→  },\n  1134→  chinProjection: {\n  1135→    male: { ideal: 0, range: [-3, 3] },\n  1136→    female: { ideal: -2, range: [-5, 1] },\n  1137→  },\n  1138→};\n  1139→\n  1140→// ============================================\n  1141→// FaceIQ Scoring Configurations\n  1142→// ============================================\n  1143→\n  1144→export const FACEIQ_SCORING_CONFIGS: Record<string, ScoringConfig> = {\n  1145→  fwhr: {\n  1146→    idealValue: 1.9,\n  1147→    standardDeviation: 0.15,\n  1148→    minScore: 0,\n  1149→    maxScore: 100,\n  1150→    weight: 0.15,\n  1151→  },\n  1152→  canthalTilt: {\n  1153→    idealValue: 6,\n  1154→    standardDeviation: 3,\n  1155→    minScore: 0,\n  1156→    maxScore: 100,\n  1157→    weight: 0.1,\n  1158→  },\n  1159→  facialThirds: {\n  1160→    idealValue: 33.33,\n  1161→    standardDeviation: 3,\n  1162→    minScore: 0,\n  1163→    maxScore: 100,\n  1164→    weight: 0.1,\n  1165→  },\n  1166→  nasolabialAngle: {\n  1167→    idealValue: 102,\n  1168→    standardDeviation: 8,\n  1169→    minScore: 0,\n  1170→    maxScore: 100,\n  1171→    weight: 0.08,\n  1172→  },\n  1173→  gonialAngle: {\n  1174→    idealValue: 125,\n  1175→    standardDeviation: 5,\n  1176→    minScore: 0,\n  1177→    maxScore: 100,\n  1178→    weight: 0.08,\n  1179→  },\n  1180→  overallSymmetry: {\n  1181→    idealValue: 100,\n  1182→    standardDeviation: 5,\n  1183→    minScore: 0,\n  1184→    maxScore: 100,\n  1185→    weight: 0.15,\n  1186→  },\n  1187→  goldenRatio: {\n  1188→    idealValue: 1.618,\n  1189→    standardDeviation: 0.1,\n  1190→    minScore: 0,\n  1191→    maxScore: 100,\n  1192→    weight: 0.12,\n  1193→  },\n  1194→  nasalIndex: {\n  1195→    idealValue: 0.7,\n  1196→    standardDeviation: 0.08,\n  1197→    minScore: 0,\n  1198→    maxScore: 100,\n  1199→    weight: 0.06,\n  1200→  },\n  1201→  lipRatio: {\n  1202→    idealValue: 0.5,\n  1203→    standardDeviation: 0.1,\n  1204→    minScore: 0,\n  1205→    maxScore: 100,\n  1206→    weight: 0.06,\n  1207→  },\n  1208→  chinProjection: {\n  1209→    idealValue: 0,\n  1210→    standardDeviation: 3,\n  1211→    minScore: 0,\n  1212→    maxScore: 100,\n  1213→    weight: 0.05,\n  1214→  },\n  1215→  noseProjection: {\n  1216→    idealValue: 0.67,\n  1217→    standardDeviation: 0.05,\n  1218→    minScore: 0,\n  1219→    maxScore: 100,\n  1220→    weight: 0.05,\n  1221→  },\n  1222→};\n  1223→\n  1224→// ============================================\n  1225→// Population Statistics for Percentile Ranking\n  1226→// ============================================\n  1227→\n  1228→export interface PopulationStats {\n  1229→  mean: number;\n  1230→  standardDeviation: number;\n  1231→  sampleSize: number;\n  1232→}\n  1233→\n  1234→export const POPULATION_STATS: Record<string, PopulationStats> = {\n  1235→  harmonyScore: { mean: 65, standardDeviation: 12, sampleSize: 10000 },\n  1236→  fwhr: { mean: 1.85, standardDeviation: 0.2, sampleSize: 10000 },\n  1237→  canthalTilt: { mean: 4, standardDeviation: 4, sampleSize: 10000 },\n  1238→  symmetry: { mean: 85, standardDeviation: 8, sampleSize: 10000 },\n  1239→  goldenRatioMatch: { mean: 70, standardDeviation: 15, sampleSize: 10000 },\n  1240→};\n  1241→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"39bb82ca-6899-4c2d-b71a-dce8ff2a013d","timestamp":"2025-12-20T15:50:00.383Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts","content":"/**\n * Facial Landmark Types and Default Data\n * Based on TECHNICAL_SPECS.md medical terminology\n */\n\nexport interface LandmarkPoint {\n  id: string;\n  label: string;\n  medicalTerm: string;\n  description: string;\n  x: number;\n  y: number;\n  category: string;\n}\n\nexport interface LandmarkCategory {\n  name: string;\n  color: string;\n  landmarks: string[];\n}\n\n// ============================================\n// FRONT PROFILE LANDMARKS (52 Points)\n// ============================================\n\nexport const FRONT_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n  {\n    name: 'Head',\n    color: '#FF6B6B',\n    landmarks: ['trichion'],\n  },\n  {\n    name: 'Eyes - Left',\n    color: '#4ECDC4',\n    landmarks: [\n      'left_pupila',\n      'left_canthus_medialis',\n      'left_canthus_lateralis',\n      'left_palpebra_superior',\n      'left_palpebra_inferior',\n      'left_sulcus_palpebralis_lateralis',\n      'left_pretarsal_skin_crease',\n    ],\n  },\n  {\n    name: 'Eyes - Right',\n    color: '#45B7D1',\n    landmarks: [\n      'right_pupila',\n      'right_canthus_medialis',\n      'right_canthus_lateralis',\n      'right_palpebra_superior',\n      'right_palpebra_inferior',\n      'right_sulcus_palpebralis_lateralis',\n      'right_pretarsal_skin_crease',\n    ],\n  },\n  {\n    name: 'Eyebrows - Left',\n    color: '#96CEB4',\n    landmarks: [\n      'left_supercilium_medialis',\n      'left_supercilium_medial_corner',\n      'left_supercilium_superior',\n      'left_supercilium_apex',\n      'left_supercilium_lateralis',\n    ],\n  },\n  {\n    name: 'Eyebrows - Right',\n    color: '#88D8B0',\n    landmarks: [\n      'right_supercilium_medialis',\n      'right_supercilium_medial_corner',\n      'right_supercilium_superior',\n      'right_supercilium_apex',\n      'right_supercilium_lateralis',\n    ],\n  },\n  {\n    name: 'Nose',\n    color: '#FFEAA7',\n    landmarks: [\n      'nasal_base',\n      'left_dorsum_nasi',\n      'right_dorsum_nasi',\n      'left_ala_nasi',\n      'right_ala_nasi',\n      'subnasale',\n    ],\n  },\n  {\n    name: 'Mouth',\n    color: '#DDA0DD',\n    landmarks: [\n      'labrale_superius',\n      'cupids_bow',\n      'mouth_middle',\n      'labrale_inferius',\n      'left_cheilion',\n      'right_cheilion',\n    ],\n  },\n  {\n    name: 'Jaw',\n    color: '#F39C12',\n    landmarks: [\n      'left_gonion_superior',\n      'right_gonion_superior',\n      'left_gonion_inferior',\n      'right_gonion_inferior',\n    ],\n  },\n  {\n    name: 'Chin',\n    color: '#E74C3C',\n    landmarks: ['left_mentum_lateralis', 'right_mentum_lateralis', 'menton'],\n  },\n  {\n    name: 'Face Width',\n    color: '#9B59B6',\n    landmarks: [\n      'left_zygion',\n      'right_zygion',\n      'left_temporal',\n      'right_temporal',\n      'left_auricular_lateral',\n      'right_auricular_lateral',\n    ],\n  },\n  {\n    name: 'Neck',\n    color: '#1ABC9C',\n    landmarks: ['left_cervical_lateralis', 'right_cervical_lateralis'],\n  },\n];\n\nexport const FRONT_PROFILE_LANDMARKS: LandmarkPoint[] = [\n  // Head/Hair\n  {\n    id: 'trichion',\n    label: 'Hairline',\n    medicalTerm: 'Trichion (frontal view)',\n    description: 'Anterior hairline at midline',\n    x: 0.5,\n    y: 0.08,\n    category: 'Head',\n  },\n\n  // Eyes - Left\n  {\n    id: 'left_pupila',\n    label: 'Left Pupil',\n    medicalTerm: 'Left Pupila',\n    description: 'Center of left pupil',\n    x: 0.38,\n    y: 0.35,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_canthus_medialis',\n    label: 'Left Medial Canthus',\n    medicalTerm: 'Left Canthus Medialis',\n    description: 'Inner corner of left eye',\n    x: 0.42,\n    y: 0.35,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_canthus_lateralis',\n    label: 'Left Lateral Canthus',\n    medicalTerm: 'Left Canthus Lateralis',\n    description: 'Outer corner of left eye',\n    x: 0.32,\n    y: 0.34,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_palpebra_superior',\n    label: 'Left Upper Eyelid',\n    medicalTerm: 'Left Palpebra Superior',\n    description: 'Upper eyelid of left eye',\n    x: 0.37,\n    y: 0.33,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_palpebra_inferior',\n    label: 'Left Lower Eyelid',\n    medicalTerm: 'Left Palpebra Inferior',\n    description: 'Lower eyelid of left eye',\n    x: 0.37,\n    y: 0.37,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_sulcus_palpebralis_lateralis',\n    label: 'Left Eyelid Hood End',\n    medicalTerm: 'Left Sulcus Palpebralis Lateralis',\n    description: 'Lateral end of left upper eyelid crease',\n    x: 0.31,\n    y: 0.33,\n    category: 'Eyes - Left',\n  },\n  {\n    id: 'left_pretarsal_skin_crease',\n    label: 'Left Upper Eyelid Crease',\n    medicalTerm: 'Left Pretarsal Skin Crease',\n    description: 'Left upper eyelid crease',\n    x: 0.37,\n    y: 0.32,\n    category: 'Eyes - Left',\n  },\n\n  // Eyes - Right\n  {\n    id: 'right_pupila',\n    label: 'Right Pupil',\n    medicalTerm: 'Right Pupila',\n    description: 'Center of right pupil',\n    x: 0.62,\n    y: 0.35,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_canthus_medialis',\n    label: 'Right Medial Canthus',\n    medicalTerm: 'Right Canthus Medialis',\n    description: 'Inner corner of right eye',\n    x: 0.58,\n    y: 0.35,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_canthus_lateralis',\n    label: 'Right Lateral Canthus',\n    medicalTerm: 'Right Canthus Lateralis',\n    description: 'Outer corner of right eye',\n    x: 0.68,\n    y: 0.34,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_palpebra_superior',\n    label: 'Right Upper Eyelid',\n    medicalTerm: 'Right Palpebra Superior',\n    description: 'Upper eyelid of right eye',\n    x: 0.63,\n    y: 0.33,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_palpebra_inferior',\n    label: 'Right Lower Eyelid',\n    medicalTerm: 'Right Palpebra Inferior',\n    description: 'Lower eyelid of right eye',\n    x: 0.63,\n    y: 0.37,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_sulcus_palpebralis_lateralis',\n    label: 'Right Eyelid Hood End',\n    medicalTerm: 'Right Sulcus Palpebralis Lateralis',\n    description: 'Lateral end of right upper eyelid crease',\n    x: 0.69,\n    y: 0.33,\n    category: 'Eyes - Right',\n  },\n  {\n    id: 'right_pretarsal_skin_crease',\n    label: 'Right Upper Eyelid Crease',\n    medicalTerm: 'Right Pretarsal Skin Crease',\n    description: 'Right upper eyelid crease',\n    x: 0.63,\n    y: 0.32,\n    category: 'Eyes - Right',\n  },\n\n  // Eyebrows - Left\n  {\n    id: 'left_supercilium_medialis',\n    label: 'Left Brow Head',\n    medicalTerm: 'Left Supercilium Medialis',\n    description: 'Medial start of left eyebrow',\n    x: 0.43,\n    y: 0.28,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_medial_corner',\n    label: 'Left Brow Inner Corner',\n    medicalTerm: 'Left Supercilium Medial Corner',\n    description: 'Inner corner of left eyebrow',\n    x: 0.41,\n    y: 0.27,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_superior',\n    label: 'Left Brow Arch',\n    medicalTerm: 'Left Supercilium Superior',\n    description: 'Superior arc of left eyebrow',\n    x: 0.36,\n    y: 0.26,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_apex',\n    label: 'Left Brow Peak',\n    medicalTerm: 'Left Supercilium Apex',\n    description: 'Highest point of left eyebrow',\n    x: 0.34,\n    y: 0.26,\n    category: 'Eyebrows - Left',\n  },\n  {\n    id: 'left_supercilium_lateralis',\n    label: 'Left Brow Tail',\n    medicalTerm: 'Left Supercilium Lateralis',\n    description: 'Lateral end of left eyebrow',\n    x: 0.29,\n    y: 0.28,\n    category: 'Eyebrows - Left',\n  },\n\n  // Eyebrows - Right\n  {\n    id: 'right_supercilium_medialis',\n    label: 'Right Brow Head',\n    medicalTerm: 'Right Supercilium Medialis',\n    description: 'Medial start of right eyebrow',\n    x: 0.57,\n    y: 0.28,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_medial_corner',\n    label: 'Right Brow Inner Corner',\n    medicalTerm: 'Right Supercilium Medial Corner',\n    description: 'Inner corner of right eyebrow',\n    x: 0.59,\n    y: 0.27,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_superior',\n    label: 'Right Brow Arch',\n    medicalTerm: 'Right Supercilium Superior',\n    description: 'Superior arc of right eyebrow',\n    x: 0.64,\n    y: 0.26,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_apex',\n    label: 'Right Brow Peak',\n    medicalTerm: 'Right Supercilium Apex',\n    description: 'Highest point of right eyebrow',\n    x: 0.66,\n    y: 0.26,\n    category: 'Eyebrows - Right',\n  },\n  {\n    id: 'right_supercilium_lateralis',\n    label: 'Right Brow Tail',\n    medicalTerm: 'Right Supercilium Lateralis',\n    description: 'Lateral end of right eyebrow',\n    x: 0.71,\n    y: 0.28,\n    category: 'Eyebrows - Right',\n  },\n\n  // Nose\n  {\n    id: 'nasal_base',\n    label: 'Nasal Base',\n    medicalTerm: 'Nasal Base',\n    description: 'Base of nasal dorsum',\n    x: 0.5,\n    y: 0.38,\n    category: 'Nose',\n  },\n  {\n    id: 'left_dorsum_nasi',\n    label: 'Left Nose Bridge',\n    medicalTerm: 'Left Dorsum Nasi',\n    description: 'Left side of nasal bridge',\n    x: 0.47,\n    y: 0.42,\n    category: 'Nose',\n  },\n  {\n    id: 'right_dorsum_nasi',\n    label: 'Right Nose Bridge',\n    medicalTerm: 'Right Dorsum Nasi',\n    description: 'Right side of nasal bridge',\n    x: 0.53,\n    y: 0.42,\n    category: 'Nose',\n  },\n  {\n    id: 'left_ala_nasi',\n    label: 'Left Nose Side',\n    medicalTerm: 'Left Ala Nasi',\n    description: 'Lateral aspect of left nasal ala',\n    x: 0.44,\n    y: 0.5,\n    category: 'Nose',\n  },\n  {\n    id: 'right_ala_nasi',\n    label: 'Right Nose Side',\n    medicalTerm: 'Right Ala Nasi',\n    description: 'Lateral aspect of right nasal ala',\n    x: 0.56,\n    y: 0.5,\n    category: 'Nose',\n  },\n  {\n    id: 'subnasale',\n    label: 'Nose Bottom',\n    medicalTerm: 'Subnasale',\n    description: 'Junction of columella and upper lip',\n    x: 0.5,\n    y: 0.52,\n    category: 'Nose',\n  },\n\n  // Mouth\n  {\n    id: 'labrale_superius',\n    label: \"Cupid's Bow\",\n    medicalTerm: 'Labrale Superius',\n    description: 'Midpoint of upper lip vermilion',\n    x: 0.5,\n    y: 0.58,\n    category: 'Mouth',\n  },\n  {\n    id: 'cupids_bow',\n    label: \"Inner Cupid's Bow\",\n    medicalTerm: \"Cupid's Bow\",\n    description: 'Central peak of upper lip',\n    x: 0.5,\n    y: 0.57,\n    category: 'Mouth',\n  },\n  {\n    id: 'mouth_middle',\n    label: 'Mouth Middle',\n    medicalTerm: 'Mouth Middle',\n    description: 'Center of mouth opening',\n    x: 0.5,\n    y: 0.62,\n    category: 'Mouth',\n  },\n  {\n    id: 'labrale_inferius',\n    label: 'Lower Lip Center',\n    medicalTerm: 'Labrale Inferius',\n    description: 'Midpoint of lower lip vermilion border',\n    x: 0.5,\n    y: 0.66,\n    category: 'Mouth',\n  },\n  {\n    id: 'left_cheilion',\n    label: 'Left Mouth Corner',\n    medicalTerm: 'Left Cheilion',\n    description: 'Left oral commissure',\n    x: 0.42,\n    y: 0.62,\n    category: 'Mouth',\n  },\n  {\n    id: 'right_cheilion',\n    label: 'Right Mouth Corner',\n    medicalTerm: 'Right Cheilion',\n    description: 'Right oral commissure',\n    x: 0.58,\n    y: 0.62,\n    category: 'Mouth',\n  },\n\n  // Jaw\n  {\n    id: 'left_gonion_superior',\n    label: 'Left Upper Jaw Angle',\n    medicalTerm: 'Left Gonion Superior',\n    description: 'Superior aspect of left mandibular angle',\n    x: 0.22,\n    y: 0.55,\n    category: 'Jaw',\n  },\n  {\n    id: 'right_gonion_superior',\n    label: 'Right Upper Jaw Angle',\n    medicalTerm: 'Right Gonion Superior',\n    description: 'Superior aspect of right mandibular angle',\n    x: 0.78,\n    y: 0.55,\n    category: 'Jaw',\n  },\n  {\n    id: 'left_gonion_inferior',\n    label: 'Left Lower Jaw Angle',\n    medicalTerm: 'Left Gonion Inferior',\n    description: 'Inferior aspect of left mandibular angle',\n    x: 0.24,\n    y: 0.7,\n    category: 'Jaw',\n  },\n  {\n    id: 'right_gonion_inferior',\n    label: 'Right Lower Jaw Angle',\n    medicalTerm: 'Right Gonion Inferior',\n    description: 'Inferior aspect of right mandibular angle',\n    x: 0.76,\n    y: 0.7,\n    category: 'Jaw',\n  },\n\n  // Chin\n  {\n    id: 'left_mentum_lateralis',\n    label: 'Left Chin',\n    medicalTerm: 'Left Mentum Lateralis',\n    description: 'Left lateral chin',\n    x: 0.42,\n    y: 0.8,\n    category: 'Chin',\n  },\n  {\n    id: 'right_mentum_lateralis',\n    label: 'Right Chin',\n    medicalTerm: 'Right Mentum Lateralis',\n    description: 'Right lateral chin',\n    x: 0.58,\n    y: 0.8,\n    category: 'Chin',\n  },\n  {\n    id: 'menton',\n    label: 'Chin Bottom',\n    medicalTerm: 'Menton',\n    description: 'Lowest point of chin in midline',\n    x: 0.5,\n    y: 0.88,\n    category: 'Chin',\n  },\n\n  // Face Width\n  {\n    id: 'left_zygion',\n    label: 'Left Cheekbone',\n    medicalTerm: 'Left Zygion',\n    description: 'Most lateral point of left zygomatic arch',\n    x: 0.18,\n    y: 0.42,\n    category: 'Face Width',\n  },\n  {\n    id: 'right_zygion',\n    label: 'Right Cheekbone',\n    medicalTerm: 'Right Zygion',\n    description: 'Most lateral point of right zygomatic arch',\n    x: 0.82,\n    y: 0.42,\n    category: 'Face Width',\n  },\n  {\n    id: 'left_temporal',\n    label: 'Left Temple',\n    medicalTerm: 'Left Temporal Point',\n    description: 'Left temporal region',\n    x: 0.2,\n    y: 0.3,\n    category: 'Face Width',\n  },\n  {\n    id: 'right_temporal',\n    label: 'Right Temple',\n    medicalTerm: 'Right Temporal Point',\n    description: 'Right temporal region',\n    x: 0.8,\n    y: 0.3,\n    category: 'Face Width',\n  },\n  {\n    id: 'left_auricular_lateral',\n    label: 'Left Outer Ear',\n    medicalTerm: 'Left Auricular Lateral Point',\n    description: 'Lateral-most point of left ear',\n    x: 0.12,\n    y: 0.4,\n    category: 'Face Width',\n  },\n  {\n    id: 'right_auricular_lateral',\n    label: 'Right Outer Ear',\n    medicalTerm: 'Right Auricular Lateral Point',\n    description: 'Lateral-most point of right ear',\n    x: 0.88,\n    y: 0.4,\n    category: 'Face Width',\n  },\n\n  // Neck\n  {\n    id: 'left_cervical_lateralis',\n    label: 'Left Neck Point',\n    medicalTerm: 'Left Cervical Lateralis',\n    description: 'Left cervical point',\n    x: 0.35,\n    y: 0.95,\n    category: 'Neck',\n  },\n  {\n    id: 'right_cervical_lateralis',\n    label: 'Right Neck Point',\n    medicalTerm: 'Right Cervical Lateralis',\n    description: 'Right cervical point',\n    x: 0.65,\n    y: 0.95,\n    category: 'Neck',\n  },\n];\n\n// ============================================\n// SIDE PROFILE LANDMARKS (28 Points)\n// Matches FaceIQ Labs exact naming and order\n// ============================================\n\nexport const SIDE_LANDMARK_CATEGORIES: LandmarkCategory[] = [\n  {\n    name: 'Cranium',\n    color: '#FF6B6B',\n    landmarks: ['vertex', 'occiput', 'trichion'],\n  },\n  {\n    name: 'Forehead',\n    color: '#4ECDC4',\n    landmarks: ['glabella'],\n  },\n  {\n    name: 'Eye Region',\n    color: '#45B7D1',\n    landmarks: ['cornealApex', 'orbitale'],\n  },\n  {\n    name: 'Nose',\n    color: '#FFEAA7',\n    landmarks: [\n      'nasion',\n      'rhinion',\n      'supratip',\n      'pronasale',\n      'infratip',\n      'columella',\n      'subnasale',\n      'subalare',\n    ],\n  },\n  {\n    name: 'Lips',\n    color: '#DDA0DD',\n    landmarks: ['labraleSuperius', 'cheilion', 'labraleInferius', 'sublabiale'],\n  },\n  {\n    name: 'Chin',\n    color: '#E74C3C',\n    landmarks: ['pogonion', 'menton'],\n  },\n  {\n    name: 'Jaw',\n    color: '#F39C12',\n    landmarks: ['gonionTop', 'gonionBottom'],\n  },\n  {\n    name: 'Cheek',\n    color: '#9B59B6',\n    landmarks: ['cheekbone'],\n  },\n  {\n    name: 'Ear',\n    color: '#3498DB',\n    landmarks: ['porion', 'tragus', 'intertragicNotch'],\n  },\n  {\n    name: 'Neck',\n    color: '#1ABC9C',\n    landmarks: ['cervicalPoint', 'neckPoint'],\n  },\n];\n\n// FaceIQ order: vertex, occiput, pronasale, neckPoint, porion, orbitale, tragus,\n// intertragicNotch, cornealApex, cheekbone, trichion, glabella, nasion, rhinion,\n// supratip, infratip, columella, subnasale, subalare, labraleSuperius, cheilion,\n// labraleInferius, sublabiale, pogonion, menton, cervicalPoint, gonionTop, gonionBottom\nexport const SIDE_PROFILE_LANDMARKS: LandmarkPoint[] = [\n  // 1. vertex\n  {\n    id: 'vertex',\n    label: 'Top of Head',\n    medicalTerm: 'Vertex',\n    description: 'Highest point on the head in profile',\n    x: 0.45,\n    y: 0.02,\n    category: 'Cranium',\n  },\n  // 2. occiput\n  {\n    id: 'occiput',\n    label: 'Occiput',\n    medicalTerm: 'External Occipital Region',\n    description: 'Back-of-head prominence',\n    x: 0.85,\n    y: 0.15,\n    category: 'Cranium',\n  },\n  // 3. pronasale\n  {\n    id: 'pronasale',\n    label: 'Nose Tip',\n    medicalTerm: 'Pronasale',\n    description: 'Most forward point of the nose tip',\n    x: 0.18,\n    y: 0.48,\n    category: 'Nose',\n  },\n  // 4. neckPoint\n  {\n    id: 'neckPoint',\n    label: 'Neck Point',\n    medicalTerm: 'Anterior Cervical Landmark',\n    description: 'Lower neck inflection on the front border',\n    x: 0.4,\n    y: 0.88,\n    category: 'Neck',\n  },\n  // 5. porion\n  {\n    id: 'porion',\n    label: 'Porion',\n    medicalTerm: 'Porion (soft tissue)',\n    description: 'Upper margin of ear canal opening, used for Frankfort horizontal plane',\n    x: 0.75,\n    y: 0.35,\n    category: 'Ear',\n  },\n  // 6. orbitale\n  {\n    id: 'orbitale',\n    label: 'Orbitale',\n    medicalTerm: 'Orbitale',\n    description: 'Lowest point on the orbital rim',\n    x: 0.35,\n    y: 0.38,\n    category: 'Eye Region',\n  },\n  // 7. tragus\n  {\n    id: 'tragus',\n    label: 'Tragus',\n    medicalTerm: 'Tragion (soft tissue)',\n    description: 'Cartilage nub in front of the ear canal',\n    x: 0.72,\n    y: 0.42,\n    category: 'Ear',\n  },\n  // 8. intertragicNotch\n  {\n    id: 'intertragicNotch',\n    label: 'Intertragic Notch',\n    medicalTerm: 'Incisura Intertragica',\n    description: 'Notch between tragus and antitragus cartilages',\n    x: 0.73,\n    y: 0.45,\n    category: 'Ear',\n  },\n  // 9. cornealApex\n  {\n    id: 'cornealApex',\n    label: 'Corneal Apex',\n    medicalTerm: 'Corneal Apex',\n    description: 'Most forward point of the eye (cornea)',\n    x: 0.28,\n    y: 0.34,\n    category: 'Eye Region',\n  },\n  // 10. cheekbone\n  {\n    id: 'cheekbone',\n    label: 'Cheekbone',\n    medicalTerm: 'Zygion (soft-tissue over zygoma)',\n    description: 'Zygomatic prominence',\n    x: 0.45,\n    y: 0.42,\n    category: 'Cheek',\n  },\n  // 11. trichion\n  {\n    id: 'trichion',\n    label: 'Hairline (Profile)',\n    medicalTerm: 'Trichion',\n    description: 'Forehead hairline point',\n    x: 0.35,\n    y: 0.1,\n    category: 'Cranium',\n  },\n  // 12. glabella\n  {\n    id: 'glabella',\n    label: 'Glabella',\n    medicalTerm: 'Glabella',\n    description: 'Mid-forehead point between brows',\n    x: 0.32,\n    y: 0.28,\n    category: 'Forehead',\n  },\n  // 13. nasion\n  {\n    id: 'nasion',\n    label: 'Nasal Bridge Root',\n    medicalTerm: 'Nasion',\n    description: 'Nasal root depression',\n    x: 0.35,\n    y: 0.32,\n    category: 'Nose',\n  },\n  // 14. rhinion\n  {\n    id: 'rhinion',\n    label: 'Rhinion',\n    medicalTerm: 'Rhinion',\n    description: 'Dorsal point of the nose',\n    x: 0.28,\n    y: 0.4,\n    category: 'Nose',\n  },\n  // 15. supratip\n  {\n    id: 'supratip',\n    label: 'Supratip',\n    medicalTerm: 'Supratip Break',\n    description: 'Dorsal point just above the tip',\n    x: 0.22,\n    y: 0.46,\n    category: 'Nose',\n  },\n  // 16. infratip\n  {\n    id: 'infratip',\n    label: 'Infratip',\n    medicalTerm: 'Infratip Lobule',\n    description: 'Point between nose tip and columella',\n    x: 0.2,\n    y: 0.5,\n    category: 'Nose',\n  },\n  // 17. columella\n  {\n    id: 'columella',\n    label: 'Columella',\n    medicalTerm: 'Columella Nasi',\n    description: 'Inferior border of the nasal septum between nostrils',\n    x: 0.24,\n    y: 0.52,\n    category: 'Nose',\n  },\n  // 18. subnasale\n  {\n    id: 'subnasale',\n    label: 'Subnasale',\n    medicalTerm: 'Subnasale',\n    description: 'Where nose base meets upper lip',\n    x: 0.3,\n    y: 0.54,\n    category: 'Nose',\n  },\n  // 19. subalare\n  {\n    id: 'subalare',\n    label: 'Subalare',\n    medicalTerm: 'Subalare',\n    description: 'Lowest point of the nostril wing on the visible side',\n    x: 0.28,\n    y: 0.53,\n    category: 'Nose',\n  },\n  // 20. labraleSuperius\n  {\n    id: 'labraleSuperius',\n    label: 'Upper Lip',\n    medicalTerm: 'Labrale Superius',\n    description: 'Most forward point of the upper lip vermilion',\n    x: 0.28,\n    y: 0.58,\n    category: 'Lips',\n  },\n  // 21. cheilion\n  {\n    id: 'cheilion',\n    label: 'Mouth Corner',\n    medicalTerm: 'Cheilion',\n    description: 'Mouth corner where the lips meet',\n    x: 0.35,\n    y: 0.62,\n    category: 'Lips',\n  },\n  // 22. labraleInferius\n  {\n    id: 'labraleInferius',\n    label: 'Lower Lip',\n    medicalTerm: 'Labrale Inferius',\n    description: 'Most forward point of the lower lip vermilion',\n    x: 0.3,\n    y: 0.66,\n    category: 'Lips',\n  },\n  // 23. sublabiale\n  {\n    id: 'sublabiale',\n    label: 'Labiomental Fold',\n    medicalTerm: 'Sublabiale',\n    description: 'Deepest point of the crease between lower lip and chin',\n    x: 0.32,\n    y: 0.7,\n    category: 'Lips',\n  },\n  // 24. pogonion\n  {\n    id: 'pogonion',\n    label: 'Chin Point',\n    medicalTerm: 'Pogonion (soft tissue)',\n    description: 'Most forward point on the soft-tissue chin',\n    x: 0.3,\n    y: 0.76,\n    category: 'Chin',\n  },\n  // 25. menton\n  {\n    id: 'menton',\n    label: 'Chin Bottom',\n    medicalTerm: 'Menton (soft tissue)',\n    description: 'Lowest point on the soft-tissue chin',\n    x: 0.35,\n    y: 0.82,\n    category: 'Chin',\n  },\n  // 26. cervicalPoint\n  {\n    id: 'cervicalPoint',\n    label: 'Cervical Point',\n    medicalTerm: 'Cervicale (soft-tissue reference)',\n    description: 'High neck point just under the jaw',\n    x: 0.5,\n    y: 0.9,\n    category: 'Neck',\n  },\n  // 27. gonionTop\n  {\n    id: 'gonionTop',\n    label: 'Upper Jaw Angle',\n    medicalTerm: 'Gonion Superior',\n    description: 'Upper angle point of the jaw from side profile',\n    x: 0.7,\n    y: 0.6,\n    category: 'Jaw',\n  },\n  // 28. gonionBottom\n  {\n    id: 'gonionBottom',\n    label: 'Lower Jaw Angle',\n    medicalTerm: 'Gonion Inferior',\n    description: 'Lower angle point of the jaw from side profile',\n    x: 0.65,\n    y: 0.72,\n    category: 'Jaw',\n  },\n];\n\n// ============================================\n// MediaPipe Face Mesh Index Mapping\n// ============================================\n// NOTE: MEDIAPIPE_FRONT_MAPPING is defined in mediapipeDetection.ts (single source of truth)\n// Import from there if needed: import { MEDIAPIPE_FRONT_MAPPING } from './mediapipeDetection';\n\n// Helper to get category color for a landmark\nexport function getLandmarkColor(\n  landmarkId: string,\n  categories: LandmarkCategory[]\n): string {\n  for (const category of categories) {\n    if (category.landmarks.includes(landmarkId)) {\n      return category.color;\n    }\n  }\n  return '#00f3ff'; // Default cyan\n}\n\n// ============================================\n// FaceIQ Side Profile Landmark Indices (106 points)\n// Reverse-engineered from FaceIQ Labs API\n// ============================================\n\nexport const FACEIQ_SIDE_LANDMARKS = {\n  // Face Contour (0-16) - Jaw/Chin outline\n  MENTON: 0, // Chin bottom (lowest point)\n  POGONION: 2, // Chin prominence\n  GNATHION: 3, // Chin point\n  MANDIBLE_CONTOUR: [2, 3, 4, 5, 6, 7, 8], // Jaw line\n\n  // Posterior Points (1, 9-16) - Ear/Back of head\n  TRAGION: 1, // Ear point\n  EAR_CONTOUR: [9, 10, 11, 12, 13, 14, 15, 16],\n\n  // Forehead/Hairline (17)\n  TRICHION: 17, // Hairline\n\n  // Nose Profile (18-32)\n  NASION: 25, // Bridge of nose (deepest point)\n  PRONASALE: 32, // Nose tip\n  SUBNASALE: 52, // Base of nose\n  COLUMELLA: 53, // Nose columella\n  NOSE_BRIDGE: [25, 26, 27, 28, 29, 30, 31, 32],\n  NOSE_TIP_CONTOUR: [52, 53, 54, 55, 56, 57, 58, 59, 60],\n\n  // Eye Region (33-51)\n  EYE_LATERAL_CANTHUS: 33, // Outer eye corner\n  EYE_MEDIAL_CANTHUS: 35, // Inner eye corner\n  UPPER_EYELID: [37, 38, 39],\n  LOWER_EYELID: [40, 41, 42],\n  PUPIL: 34,\n  BROW_HEAD: 44, // Inner brow\n  BROW_ARCH: 45, // Brow peak\n  BROW_TAIL: 46, // Outer brow\n\n  // Lip Region (52-75)\n  LABRALE_SUPERIUS: 63, // Upper lip top\n  LABRALE_INFERIUS: 66, // Lower lip bottom\n  STOMION: 65, // Lip meeting point\n  UPPER_LIP_CONTOUR: [63, 64, 65],\n  LOWER_LIP_CONTOUR: [66, 67, 68],\n\n  // Additional Profile Points (76-105)\n  GLABELLA: 76, // Between eyebrows\n  SELLION: 77, // Deepest point of nasal bridge\n  SOFT_TISSUE_NASION: 78,\n  ORBITALE: 79, // Lowest point of eye socket\n  GONION: 85, // Jaw angle\n  CONDYLION: 86, // Top of jaw joint\n};\n\n// ============================================\n// FaceIQ Front Face Landmark Indices (MediaPipe 478 points)\n// ============================================\n\nexport const FACEIQ_FRONT_LANDMARKS = {\n  // Key points from MediaPipe Face Mesh\n  NOSE_TIP: 1,\n  LEFT_EYE_INNER: 133,\n  LEFT_EYE_OUTER: 33,\n  RIGHT_EYE_INNER: 362,\n  RIGHT_EYE_OUTER: 263,\n  LEFT_CHEEK: 234,\n  RIGHT_CHEEK: 454,\n  UPPER_LIP: 13,\n  LOWER_LIP: 14,\n  CHIN: 152,\n  FOREHEAD: 10,\n  LEFT_EAR: 234,\n  RIGHT_EAR: 454,\n  LEFT_BROW_INNER: 107,\n  LEFT_BROW_OUTER: 70,\n  RIGHT_BROW_INNER: 336,\n  RIGHT_BROW_OUTER: 300,\n  NOSE_BRIDGE: 6,\n  LEFT_NOSTRIL: 129,\n  RIGHT_NOSTRIL: 358,\n};\n\n// ============================================\n// Scoring Configuration Types\n// ============================================\n\nexport interface ScoringConfig {\n  idealValue: number;\n  standardDeviation: number;\n  minScore: number;\n  maxScore: number;\n  weight: number;\n}\n\nexport interface GenderSpecificValues {\n  male: { ideal: number; range: [number, number] };\n  female: { ideal: number; range: [number, number] };\n}\n\n// ============================================\n// FaceIQ Ideal Values (Gender-Specific)\n// ============================================\n\nexport const FACEIQ_IDEAL_VALUES: Record<string, GenderSpecificValues> = {\n  fwhr: {\n    male: { ideal: 1.9, range: [1.8, 2.1] },\n    female: { ideal: 1.75, range: [1.6, 1.9] },\n  },\n  canthalTilt: {\n    male: { ideal: 4, range: [2, 7] },\n    female: { ideal: 6, range: [4, 10] },\n  },\n  nasolabialAngle: {\n    male: { ideal: 95, range: [90, 100] },\n    female: { ideal: 105, range: [100, 115] },\n  },\n  gonialAngle: {\n    male: { ideal: 125, range: [120, 130] },\n    female: { ideal: 128, range: [125, 135] },\n  },\n  nasalIndex: {\n    male: { ideal: 0.7, range: [0.65, 0.75] },\n    female: { ideal: 0.65, range: [0.6, 0.7] },\n  },\n  lipRatio: {\n    male: { ideal: 0.5, range: [0.4, 0.6] },\n    female: { ideal: 0.5, range: [0.45, 0.55] },\n  },\n  facialConvexity: {\n    male: { ideal: 170, range: [165, 175] },\n    female: { ideal: 168, range: [163, 173] },\n  },\n  chinProjection: {\n    male: { ideal: 0, range: [-3, 3] },\n    female: { ideal: -2, range: [-5, 1] },\n  },\n};\n\n// ============================================\n// FaceIQ Scoring Configurations\n// ============================================\n\nexport const FACEIQ_SCORING_CONFIGS: Record<string, ScoringConfig> = {\n  fwhr: {\n    idealValue: 1.9,\n    standardDeviation: 0.15,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.15,\n  },\n  canthalTilt: {\n    idealValue: 6,\n    standardDeviation: 3,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.1,\n  },\n  facialThirds: {\n    idealValue: 33.33,\n    standardDeviation: 3,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.1,\n  },\n  nasolabialAngle: {\n    idealValue: 102,\n    standardDeviation: 8,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.08,\n  },\n  gonialAngle: {\n    idealValue: 125,\n    standardDeviation: 5,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.08,\n  },\n  overallSymmetry: {\n    idealValue: 100,\n    standardDeviation: 5,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.15,\n  },\n  goldenRatio: {\n    idealValue: 1.618,\n    standardDeviation: 0.1,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.12,\n  },\n  nasalIndex: {\n    idealValue: 0.7,\n    standardDeviation: 0.08,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.06,\n  },\n  lipRatio: {\n    idealValue: 0.5,\n    standardDeviation: 0.1,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.06,\n  },\n  chinProjection: {\n    idealValue: 0,\n    standardDeviation: 3,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.05,\n  },\n  noseProjection: {\n    idealValue: 0.67,\n    standardDeviation: 0.05,\n    minScore: 0,\n    maxScore: 100,\n    weight: 0.05,\n  },\n};\n\n// ============================================\n// Population Statistics for Percentile Ranking\n// ============================================\n\nexport interface PopulationStats {\n  mean: number;\n  standardDeviation: number;\n  sampleSize: number;\n}\n\nexport const POPULATION_STATS: Record<string, PopulationStats> = {\n  harmonyScore: { mean: 65, standardDeviation: 12, sampleSize: 10000 },\n  fwhr: { mean: 1.85, standardDeviation: 0.2, sampleSize: 10000 },\n  canthalTilt: { mean: 4, standardDeviation: 4, sampleSize: 10000 },\n  symmetry: { mean: 85, standardDeviation: 8, sampleSize: 10000 },\n  goldenRatioMatch: { mean: 70, standardDeviation: 15, sampleSize: 10000 },\n};\n","numLines":1241,"startLine":1,"totalLines":1241}}}
{"parentUuid":"39bb82ca-6899-4c2d-b71a-dce8ff2a013d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_016umtT4CE4fWVkBVjVjJ7Ma","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me look at more files to understand the current styling patterns, the layout structure, and any additional components."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13683,"cache_creation_input_tokens":59704,"cache_read_input_tokens":15079,"cache_creation":{"ephemeral_5m_input_tokens":59704,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWJCnudKGci91KZV1EtdV","type":"assistant","uuid":"1073a34a-81f3-40bf-b796-46f4a9527d2e","timestamp":"2025-12-20T15:50:06.652Z"}
{"parentUuid":"1073a34a-81f3-40bf-b796-46f4a9527d2e","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_016umtT4CE4fWVkBVjVjJ7Ma","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WqS4BKk2kiJMqL6LAxcE6b","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/layout.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13683,"cache_creation_input_tokens":59704,"cache_read_input_tokens":15079,"cache_creation":{"ephemeral_5m_input_tokens":59704,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWJCnudKGci91KZV1EtdV","type":"assistant","uuid":"f81c2cc0-018f-4572-beb2-fb948744ef26","timestamp":"2025-12-20T15:50:07.677Z"}
{"parentUuid":"f81c2cc0-018f-4572-beb2-fb948744ef26","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_016umtT4CE4fWVkBVjVjJ7Ma","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Fxb8okQs691nt6nSUin48z","name":"Glob","input":{"pattern":"**/*.css","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13683,"cache_creation_input_tokens":59704,"cache_read_input_tokens":15079,"cache_creation":{"ephemeral_5m_input_tokens":59704,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWJCnudKGci91KZV1EtdV","type":"assistant","uuid":"f5431ed7-57e9-48d2-b128-d184a8bfd60a","timestamp":"2025-12-20T15:50:08.206Z"}
{"parentUuid":"f5431ed7-57e9-48d2-b128-d184a8bfd60a","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_016umtT4CE4fWVkBVjVjJ7Ma","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01YVhBvxSyEytRzmbfseG6wY","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/tailwind.config.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13683,"cache_creation_input_tokens":59704,"cache_read_input_tokens":15079,"cache_creation":{"ephemeral_5m_input_tokens":59704,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWJCnudKGci91KZV1EtdV","type":"assistant","uuid":"1e2b35d6-4a96-4535-a517-69a229a4bffd","timestamp":"2025-12-20T15:50:08.627Z"}
{"parentUuid":"1e2b35d6-4a96-4535-a517-69a229a4bffd","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_016umtT4CE4fWVkBVjVjJ7Ma","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JteegChKTfhDjVRUPFMeCV","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/package.json"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":13683,"cache_creation_input_tokens":59704,"cache_read_input_tokens":15079,"cache_creation":{"ephemeral_5m_input_tokens":59704,"ephemeral_1h_input_tokens":0},"output_tokens":296,"service_tier":"standard"}},"requestId":"req_011CWJCnudKGci91KZV1EtdV","type":"assistant","uuid":"66649e06-4191-411b-bd7c-b4b2a29d9eaa","timestamp":"2025-12-20T15:50:09.081Z"}
{"parentUuid":"66649e06-4191-411b-bd7c-b4b2a29d9eaa","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01WqS4BKk2kiJMqL6LAxcE6b","type":"tool_result","content":"     1→import type { Metadata } from \"next\";\n     2→import { Manrope } from \"next/font/google\";\n     3→import \"./globals.css\";\n     4→import { Providers } from \"@/components/Providers\";\n     5→\n     6→const manrope = Manrope({\n     7→  subsets: [\"latin\"],\n     8→  variable: \"--font-manrope\",\n     9→  display: \"swap\",\n    10→});\n    11→\n    12→export const metadata: Metadata = {\n    13→  title: \"LOOKSMAXX - Advanced Facial Analysis\",\n    14→  description: \"Professional facial analysis platform powered by AI\",\n    15→  openGraph: {\n    16→    title: \"LOOKSMAXX - Advanced Facial Analysis\",\n    17→    description: \"Professional facial analysis platform powered by AI\",\n    18→    type: \"website\",\n    19→  },\n    20→  twitter: {\n    21→    card: \"summary_large_image\",\n    22→    title: \"LOOKSMAXX - Advanced Facial Analysis\",\n    23→    description: \"Professional facial analysis platform powered by AI\",\n    24→  },\n    25→};\n    26→\n    27→export default function RootLayout({\n    28→  children,\n    29→}: Readonly<{\n    30→  children: React.ReactNode;\n    31→}>) {\n    32→  return (\n    33→    <html lang=\"en\">\n    34→      <body className={`${manrope.variable} font-sans antialiased`}>\n    35→        <Providers>{children}</Providers>\n    36→      </body>\n    37→    </html>\n    38→  );\n    39→}\n    40→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"7b5b093e-a533-4e70-9a59-98d54fd30ebd","timestamp":"2025-12-20T15:50:09.128Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/layout.tsx","content":"import type { Metadata } from \"next\";\nimport { Manrope } from \"next/font/google\";\nimport \"./globals.css\";\nimport { Providers } from \"@/components/Providers\";\n\nconst manrope = Manrope({\n  subsets: [\"latin\"],\n  variable: \"--font-manrope\",\n  display: \"swap\",\n});\n\nexport const metadata: Metadata = {\n  title: \"LOOKSMAXX - Advanced Facial Analysis\",\n  description: \"Professional facial analysis platform powered by AI\",\n  openGraph: {\n    title: \"LOOKSMAXX - Advanced Facial Analysis\",\n    description: \"Professional facial analysis platform powered by AI\",\n    type: \"website\",\n  },\n  twitter: {\n    card: \"summary_large_image\",\n    title: \"LOOKSMAXX - Advanced Facial Analysis\",\n    description: \"Professional facial analysis platform powered by AI\",\n  },\n};\n\nexport default function RootLayout({\n  children,\n}: Readonly<{\n  children: React.ReactNode;\n}>) {\n  return (\n    <html lang=\"en\">\n      <body className={`${manrope.variable} font-sans antialiased`}>\n        <Providers>{children}</Providers>\n      </body>\n    </html>\n  );\n}\n","numLines":40,"startLine":1,"totalLines":40}}}
{"parentUuid":"7b5b093e-a533-4e70-9a59-98d54fd30ebd","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01YVhBvxSyEytRzmbfseG6wY","type":"tool_result","content":"     1→import type { Config } from \"tailwindcss\";\n     2→\n     3→const config: Config = {\n     4→  content: [\n     5→    \"./src/pages/**/*.{js,ts,jsx,tsx,mdx}\",\n     6→    \"./src/components/**/*.{js,ts,jsx,tsx,mdx}\",\n     7→    \"./src/app/**/*.{js,ts,jsx,tsx,mdx}\",\n     8→  ],\n     9→  theme: {\n    10→    extend: {\n    11→      colors: {\n    12→        background: {\n    13→          DEFAULT: \"var(--background)\",\n    14→          secondary: \"var(--background-secondary)\",\n    15→          tertiary: \"var(--background-tertiary)\",\n    16→        },\n    17→        foreground: {\n    18→          DEFAULT: \"var(--foreground)\",\n    19→          muted: \"var(--foreground-muted)\",\n    20→          dim: \"var(--foreground-dim)\",\n    21→          light: \"var(--foreground-light)\",\n    22→        },\n    23→        border: {\n    24→          DEFAULT: \"var(--border)\",\n    25→          hover: \"var(--border-hover)\",\n    26→          focus: \"var(--border-focus)\",\n    27→        },\n    28→        success: \"var(--success)\",\n    29→        warning: \"var(--warning)\",\n    30→        error: \"var(--error)\",\n    31→        primary: {\n    32→          DEFAULT: \"var(--primary)\",\n    33→          hover: \"var(--primary-hover)\",\n    34→        },\n    35→      },\n    36→      fontFamily: {\n    37→        sans: [\"var(--font-manrope)\", \"system-ui\", \"sans-serif\"],\n    38→      },\n    39→      animation: {\n    40→        \"fade-in\": \"fadeIn 0.5s ease-in-out\",\n    41→        \"slide-up\": \"slideUp 0.5s ease-out\",\n    42→        \"slide-down\": \"slideDown 0.5s ease-out\",\n    43→      },\n    44→      keyframes: {\n    45→        fadeIn: {\n    46→          \"0%\": { opacity: \"0\" },\n    47→          \"100%\": { opacity: \"1\" },\n    48→        },\n    49→        slideUp: {\n    50→          \"0%\": { opacity: \"0\", transform: \"translateY(20px)\" },\n    51→          \"100%\": { opacity: \"1\", transform: \"translateY(0)\" },\n    52→        },\n    53→        slideDown: {\n    54→          \"0%\": { opacity: \"0\", transform: \"translateY(-20px)\" },\n    55→          \"100%\": { opacity: \"1\", transform: \"translateY(0)\" },\n    56→        },\n    57→      },\n    58→    },\n    59→  },\n    60→  plugins: [],\n    61→};\n    62→\n    63→export default config;\n    64→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"b109fc2a-4f71-4949-8461-b6bf1347f429","timestamp":"2025-12-20T15:50:09.128Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/tailwind.config.ts","content":"import type { Config } from \"tailwindcss\";\n\nconst config: Config = {\n  content: [\n    \"./src/pages/**/*.{js,ts,jsx,tsx,mdx}\",\n    \"./src/components/**/*.{js,ts,jsx,tsx,mdx}\",\n    \"./src/app/**/*.{js,ts,jsx,tsx,mdx}\",\n  ],\n  theme: {\n    extend: {\n      colors: {\n        background: {\n          DEFAULT: \"var(--background)\",\n          secondary: \"var(--background-secondary)\",\n          tertiary: \"var(--background-tertiary)\",\n        },\n        foreground: {\n          DEFAULT: \"var(--foreground)\",\n          muted: \"var(--foreground-muted)\",\n          dim: \"var(--foreground-dim)\",\n          light: \"var(--foreground-light)\",\n        },\n        border: {\n          DEFAULT: \"var(--border)\",\n          hover: \"var(--border-hover)\",\n          focus: \"var(--border-focus)\",\n        },\n        success: \"var(--success)\",\n        warning: \"var(--warning)\",\n        error: \"var(--error)\",\n        primary: {\n          DEFAULT: \"var(--primary)\",\n          hover: \"var(--primary-hover)\",\n        },\n      },\n      fontFamily: {\n        sans: [\"var(--font-manrope)\", \"system-ui\", \"sans-serif\"],\n      },\n      animation: {\n        \"fade-in\": \"fadeIn 0.5s ease-in-out\",\n        \"slide-up\": \"slideUp 0.5s ease-out\",\n        \"slide-down\": \"slideDown 0.5s ease-out\",\n      },\n      keyframes: {\n        fadeIn: {\n          \"0%\": { opacity: \"0\" },\n          \"100%\": { opacity: \"1\" },\n        },\n        slideUp: {\n          \"0%\": { opacity: \"0\", transform: \"translateY(20px)\" },\n          \"100%\": { opacity: \"1\", transform: \"translateY(0)\" },\n        },\n        slideDown: {\n          \"0%\": { opacity: \"0\", transform: \"translateY(-20px)\" },\n          \"100%\": { opacity: \"1\", transform: \"translateY(0)\" },\n        },\n      },\n    },\n  },\n  plugins: [],\n};\n\nexport default config;\n","numLines":64,"startLine":1,"totalLines":64}}}
{"parentUuid":"b109fc2a-4f71-4949-8461-b6bf1347f429","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JteegChKTfhDjVRUPFMeCV","type":"tool_result","content":"     1→{\n     2→  \"name\": \"looksmaxx-app\",\n     3→  \"version\": \"0.1.0\",\n     4→  \"private\": true,\n     5→  \"scripts\": {\n     6→    \"dev\": \"next dev\",\n     7→    \"build\": \"next build\",\n     8→    \"start\": \"next start\",\n     9→    \"lint\": \"next lint\"\n    10→  },\n    11→  \"dependencies\": {\n    12→    \"@mediapipe/tasks-vision\": \"^0.10.14\",\n    13→    \"@types/three\": \"^0.182.0\",\n    14→    \"clsx\": \"^2.1.1\",\n    15→    \"face-api.js\": \"^0.22.2\",\n    16→    \"framer-motion\": \"^12.23.26\",\n    17→    \"lucide-react\": \"^0.561.0\",\n    18→    \"next\": \"14.2.35\",\n    19→    \"react\": \"^18\",\n    20→    \"react-dom\": \"^18\",\n    21→    \"react-dropzone\": \"^14.3.8\",\n    22→    \"recharts\": \"^3.6.0\",\n    23→    \"three\": \"^0.182.0\"\n    24→  },\n    25→  \"devDependencies\": {\n    26→    \"@types/node\": \"^20\",\n    27→    \"@types/react\": \"^18\",\n    28→    \"@types/react-dom\": \"^18\",\n    29→    \"eslint\": \"^8\",\n    30→    \"eslint-config-next\": \"14.2.35\",\n    31→    \"postcss\": \"^8\",\n    32→    \"tailwindcss\": \"^3.4.1\",\n    33→    \"typescript\": \"^5\"\n    34→  }\n    35→}\n    36→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"d4254950-2bf4-424b-b94e-e1c140d878eb","timestamp":"2025-12-20T15:50:09.128Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/package.json","content":"{\n  \"name\": \"looksmaxx-app\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"scripts\": {\n    \"dev\": \"next dev\",\n    \"build\": \"next build\",\n    \"start\": \"next start\",\n    \"lint\": \"next lint\"\n  },\n  \"dependencies\": {\n    \"@mediapipe/tasks-vision\": \"^0.10.14\",\n    \"@types/three\": \"^0.182.0\",\n    \"clsx\": \"^2.1.1\",\n    \"face-api.js\": \"^0.22.2\",\n    \"framer-motion\": \"^12.23.26\",\n    \"lucide-react\": \"^0.561.0\",\n    \"next\": \"14.2.35\",\n    \"react\": \"^18\",\n    \"react-dom\": \"^18\",\n    \"react-dropzone\": \"^14.3.8\",\n    \"recharts\": \"^3.6.0\",\n    \"three\": \"^0.182.0\"\n  },\n  \"devDependencies\": {\n    \"@types/node\": \"^20\",\n    \"@types/react\": \"^18\",\n    \"@types/react-dom\": \"^18\",\n    \"eslint\": \"^8\",\n    \"eslint-config-next\": \"14.2.35\",\n    \"postcss\": \"^8\",\n    \"tailwindcss\": \"^3.4.1\",\n    \"typescript\": \"^5\"\n  }\n}\n","numLines":36,"startLine":1,"totalLines":36}}}
{"parentUuid":"d4254950-2bf4-424b-b94e-e1c140d878eb","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Fxb8okQs691nt6nSUin48z","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/HeroAnimations.css\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/globals.css"}]},"uuid":"54411e96-5267-403c-99f4-af8bae61c41f","timestamp":"2025-12-20T15:50:09.449Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/HeroAnimations.css","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/globals.css"],"durationMs":330,"numFiles":2,"truncated":false}}
{"parentUuid":"54411e96-5267-403c-99f4-af8bae61c41f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NhoAQ1gMfUHQkrQEPhF12M","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01DyAXAYw76HTLL8uQvLrmHx","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/globals.css"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1468,"cache_creation_input_tokens":14742,"cache_read_input_tokens":74783,"cache_creation":{"ephemeral_5m_input_tokens":14742,"ephemeral_1h_input_tokens":0},"output_tokens":25,"service_tier":"standard"}},"requestId":"req_011CWJCoaQCaLakjFHFYVye2","type":"assistant","uuid":"17fce8d8-2316-42a0-8303-02d7be8ec7d5","timestamp":"2025-12-20T15:50:14.636Z"}
{"parentUuid":"17fce8d8-2316-42a0-8303-02d7be8ec7d5","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NhoAQ1gMfUHQkrQEPhF12M","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CEyhqB8qQmn51zbKBjLneL","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/hardmaxxing.ts"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1468,"cache_creation_input_tokens":14742,"cache_read_input_tokens":74783,"cache_creation":{"ephemeral_5m_input_tokens":14742,"ephemeral_1h_input_tokens":0},"output_tokens":25,"service_tier":"standard"}},"requestId":"req_011CWJCoaQCaLakjFHFYVye2","type":"assistant","uuid":"8119207d-323d-4bbd-a577-a401a14050b9","timestamp":"2025-12-20T15:50:15.495Z"}
{"parentUuid":"8119207d-323d-4bbd-a577-a401a14050b9","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NhoAQ1gMfUHQkrQEPhF12M","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GD3tvKQVBKLt4LyLzwZryv","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/LandmarkAnalysisTool.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1468,"cache_creation_input_tokens":14742,"cache_read_input_tokens":74783,"cache_creation":{"ephemeral_5m_input_tokens":14742,"ephemeral_1h_input_tokens":0},"output_tokens":215,"service_tier":"standard"}},"requestId":"req_011CWJCoaQCaLakjFHFYVye2","type":"assistant","uuid":"0dc63b2e-137f-41a5-ab97-3a50d768b3fd","timestamp":"2025-12-20T15:50:15.849Z"}
{"parentUuid":"0dc63b2e-137f-41a5-ab97-3a50d768b3fd","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01DyAXAYw76HTLL8uQvLrmHx","type":"tool_result","content":"     1→@tailwind base;\n     2→@tailwind components;\n     3→@tailwind utilities;\n     4→\n     5→/* Dark theme with cyan/neon accents - FaceIQ structure */\n     6→:root {\n     7→  /* Background colors - Dark theme */\n     8→  --background: #000000;\n     9→  --background-secondary: #0a0a0a;\n    10→  --background-tertiary: #111111;\n    11→\n    12→  /* Text colors */\n    13→  --foreground: #ffffff;\n    14→  --foreground-muted: #e5e5e5;\n    15→  --foreground-dim: #a3a3a3;\n    16→  --foreground-light: #737373;\n    17→\n    18→  /* Border colors */\n    19→  --border: #262626;\n    20→  --border-hover: #404040;\n    21→  --border-focus: #525252;\n    22→\n    23→  /* Accent - Cyan/Neon */\n    24→  --accent: #00f3ff;\n    25→  --accent-dim: #00c4cc;\n    26→  --accent-glow: rgba(0, 243, 255, 0.3);\n    27→\n    28→  /* Status colors */\n    29→  --success: #22c55e;\n    30→  --warning: #eab308;\n    31→  --error: #ef4444;\n    32→}\n    33→\n    34→* {\n    35→  box-sizing: border-box;\n    36→  padding: 0;\n    37→  margin: 0;\n    38→}\n    39→\n    40→html,\n    41→body {\n    42→  max-width: 100vw;\n    43→  overflow-x: hidden;\n    44→}\n    45→\n    46→body {\n    47→  color: var(--foreground);\n    48→  background: var(--background);\n    49→  font-family: var(--font-manrope), -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    50→  -webkit-font-smoothing: antialiased;\n    51→  -moz-osx-font-smoothing: grayscale;\n    52→}\n    53→\n    54→/* Scrollbar styling - dark theme */\n    55→::-webkit-scrollbar {\n    56→  width: 8px;\n    57→  height: 8px;\n    58→}\n    59→\n    60→::-webkit-scrollbar-track {\n    61→  background: var(--background-secondary);\n    62→}\n    63→\n    64→::-webkit-scrollbar-thumb {\n    65→  background: var(--border-hover);\n    66→  border-radius: 4px;\n    67→}\n    68→\n    69→::-webkit-scrollbar-thumb:hover {\n    70→  background: var(--foreground-light);\n    71→}\n    72→\n    73→/* Selection styling */\n    74→::selection {\n    75→  background: var(--accent);\n    76→  color: var(--background);\n    77→}\n    78→\n    79→@layer utilities {\n    80→  .text-balance {\n    81→    text-wrap: balance;\n    82→  }\n    83→}\n    84→\n    85→@layer components {\n    86→  /* Primary Button - Cyan accent with glow */\n    87→  .btn-primary {\n    88→    @apply inline-flex items-center justify-center gap-2;\n    89→    @apply h-11 px-5 rounded-lg;\n    90→    @apply text-black text-sm font-medium;\n    91→    @apply transition-all;\n    92→    background-color: var(--accent);\n    93→  }\n    94→\n    95→  .btn-primary:hover {\n    96→    box-shadow: 0 0 20px var(--accent-glow);\n    97→  }\n    98→\n    99→  .btn-primary:disabled {\n   100→    @apply bg-neutral-800 text-neutral-500 cursor-not-allowed;\n   101→    box-shadow: none;\n   102→  }\n   103→\n   104→  /* Secondary Button - Outline */\n   105→  .btn-secondary {\n   106→    @apply inline-flex items-center justify-center gap-2;\n   107→    @apply h-11 px-5 rounded-lg;\n   108→    @apply border border-neutral-700 bg-transparent text-white text-sm font-medium;\n   109→    @apply transition-all;\n   110→  }\n   111→\n   112→  .btn-secondary:hover {\n   113→    @apply border-neutral-500 bg-white/5;\n   114→  }\n   115→\n   116→  /* Input - Dark */\n   117→  .input {\n   118→    @apply h-11 px-3.5 text-sm;\n   119→    @apply bg-black border border-neutral-700 rounded-lg text-white;\n   120→    @apply placeholder:text-neutral-500;\n   121→    @apply focus:outline-none focus:border-neutral-500;\n   122→    @apply disabled:bg-neutral-900 disabled:text-neutral-500 disabled:cursor-not-allowed;\n   123→    @apply transition-all;\n   124→  }\n   125→\n   126→  /* Card - Dark */\n   127→  .card {\n   128→    @apply bg-neutral-900/50 border border-neutral-800 rounded-xl p-6;\n   129→    @apply transition-all;\n   130→  }\n   131→\n   132→  .card:hover {\n   133→    @apply border-neutral-700;\n   134→  }\n   135→}\n   136→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"f4d46898-273c-40b0-b417-34d9d9caa4c0","timestamp":"2025-12-20T15:50:15.889Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/globals.css","content":"@tailwind base;\n@tailwind components;\n@tailwind utilities;\n\n/* Dark theme with cyan/neon accents - FaceIQ structure */\n:root {\n  /* Background colors - Dark theme */\n  --background: #000000;\n  --background-secondary: #0a0a0a;\n  --background-tertiary: #111111;\n\n  /* Text colors */\n  --foreground: #ffffff;\n  --foreground-muted: #e5e5e5;\n  --foreground-dim: #a3a3a3;\n  --foreground-light: #737373;\n\n  /* Border colors */\n  --border: #262626;\n  --border-hover: #404040;\n  --border-focus: #525252;\n\n  /* Accent - Cyan/Neon */\n  --accent: #00f3ff;\n  --accent-dim: #00c4cc;\n  --accent-glow: rgba(0, 243, 255, 0.3);\n\n  /* Status colors */\n  --success: #22c55e;\n  --warning: #eab308;\n  --error: #ef4444;\n}\n\n* {\n  box-sizing: border-box;\n  padding: 0;\n  margin: 0;\n}\n\nhtml,\nbody {\n  max-width: 100vw;\n  overflow-x: hidden;\n}\n\nbody {\n  color: var(--foreground);\n  background: var(--background);\n  font-family: var(--font-manrope), -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n/* Scrollbar styling - dark theme */\n::-webkit-scrollbar {\n  width: 8px;\n  height: 8px;\n}\n\n::-webkit-scrollbar-track {\n  background: var(--background-secondary);\n}\n\n::-webkit-scrollbar-thumb {\n  background: var(--border-hover);\n  border-radius: 4px;\n}\n\n::-webkit-scrollbar-thumb:hover {\n  background: var(--foreground-light);\n}\n\n/* Selection styling */\n::selection {\n  background: var(--accent);\n  color: var(--background);\n}\n\n@layer utilities {\n  .text-balance {\n    text-wrap: balance;\n  }\n}\n\n@layer components {\n  /* Primary Button - Cyan accent with glow */\n  .btn-primary {\n    @apply inline-flex items-center justify-center gap-2;\n    @apply h-11 px-5 rounded-lg;\n    @apply text-black text-sm font-medium;\n    @apply transition-all;\n    background-color: var(--accent);\n  }\n\n  .btn-primary:hover {\n    box-shadow: 0 0 20px var(--accent-glow);\n  }\n\n  .btn-primary:disabled {\n    @apply bg-neutral-800 text-neutral-500 cursor-not-allowed;\n    box-shadow: none;\n  }\n\n  /* Secondary Button - Outline */\n  .btn-secondary {\n    @apply inline-flex items-center justify-center gap-2;\n    @apply h-11 px-5 rounded-lg;\n    @apply border border-neutral-700 bg-transparent text-white text-sm font-medium;\n    @apply transition-all;\n  }\n\n  .btn-secondary:hover {\n    @apply border-neutral-500 bg-white/5;\n  }\n\n  /* Input - Dark */\n  .input {\n    @apply h-11 px-3.5 text-sm;\n    @apply bg-black border border-neutral-700 rounded-lg text-white;\n    @apply placeholder:text-neutral-500;\n    @apply focus:outline-none focus:border-neutral-500;\n    @apply disabled:bg-neutral-900 disabled:text-neutral-500 disabled:cursor-not-allowed;\n    @apply transition-all;\n  }\n\n  /* Card - Dark */\n  .card {\n    @apply bg-neutral-900/50 border border-neutral-800 rounded-xl p-6;\n    @apply transition-all;\n  }\n\n  .card:hover {\n    @apply border-neutral-700;\n  }\n}\n","numLines":136,"startLine":1,"totalLines":136}}}
{"parentUuid":"f4d46898-273c-40b0-b417-34d9d9caa4c0","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CEyhqB8qQmn51zbKBjLneL","type":"tool_result","content":"     1→/**\n     2→ * Hardmaxxing Surgery Database\n     3→ * Comprehensive database of facial aesthetic surgeries\n     4→ */\n     5→\n     6→import { Surgery, RegionalCost } from './types';\n     7→\n     8→export const SURGICAL_TREATMENTS: Surgery[] = [\n     9→  // ============================================\n    10→  // RHINOPLASTY (NOSE SURGERIES)\n    11→  // ============================================\n    12→  {\n    13→    id: 'rhinoplasty_reduction',\n    14→    name: 'Reduction Rhinoplasty',\n    15→    category: 'surgical',\n    16→    description: 'Surgical reduction of nose size, hump removal, and tip refinement',\n    17→    howItWorks: 'Surgeon removes bone and cartilage to reduce overall nose size, refine the tip, and straighten the bridge',\n    18→    effectiveness: 9,\n    19→    evidenceLevel: 'strong',\n    20→    pslImprovement: { min: 0.5, max: 1.0 },\n    21→    costLevel: 'very_high',\n    22→    costRange: { min: 5000, max: 15000, currency: 'USD' },\n    23→    costFrequency: 'one-time',\n    24→    timelineToResults: 'Initial results at 2-4 weeks, final results at 12-18 months',\n    25→    resultsDuration: 'Permanent',\n    26→    maintenanceRequired: false,\n    27→    recoveryTime: '1-2 weeks for major swelling, full recovery 12-18 months',\n    28→    downtime: '1-2 weeks off work',\n    29→    painLevel: 'moderate',\n    30→    riskLevel: 'medium',\n    31→    sideEffects: ['Swelling', 'Bruising', 'Numbness', 'Breathing changes', 'Asymmetry'],\n    32→    contraindications: ['Unrealistic expectations', 'Active skin infections', 'Bleeding disorders'],\n    33→    targetMetrics: ['nasal_index', 'nasolabial_angle', 'nasofrontal_angle', 'overall_harmony'],\n    34→    targetIssues: ['large_nose', 'dorsal_hump', 'bulbous_tip', 'wide_nose', 'crooked_nose'],\n    35→    permanence: 'permanent',\n    36→    anesthesiaType: 'general',\n    37→    revisionRate: 0.15,\n    38→    regionalCosts: [\n    39→      { region: 'USA', min: 7000, max: 15000, currency: 'USD' },\n    40→      { region: 'Turkey', min: 2500, max: 5000, currency: 'USD', notes: 'Popular medical tourism destination' },\n    41→      { region: 'South Korea', min: 4000, max: 10000, currency: 'USD', notes: 'K-beauty rhinoplasty style' },\n    42→      { region: 'Mexico', min: 3000, max: 6000, currency: 'USD' },\n    43→      { region: 'UK', min: 5000, max: 12000, currency: 'GBP' },\n    44→    ],\n    45→    surgeonRecommendations: [\n    46→      { name: 'Dr. Sam Rizk', location: 'New York, USA', specialty: 'Preservation rhinoplasty', costRange: '$15,000-25,000' },\n    47→      { name: 'Dr. Paul Nassif', location: 'Beverly Hills, USA', specialty: 'Revision rhinoplasty', costRange: '$12,000-30,000' },\n    48→      { name: 'Dr. Amir Keshavarz', location: 'Istanbul, Turkey', specialty: 'Ethnic rhinoplasty', costRange: '$3,000-6,000' },\n    49→    ],\n    50→    notes: [\n    51→      '85% satisfaction rate on RealSelf',\n    52→      'Most requested cosmetic surgery worldwide',\n    53→      'Preservation rhinoplasty has faster recovery but limited to certain nose types',\n    54→      'Ethnic rhinoplasty maintains cultural features while enhancing proportions',\n    55→    ],\n    56→    sources: ['ASPS', 'RealSelf', 'JAMA Facial Plastic Surgery'],\n    57→  },\n    58→  {\n    59→    id: 'rhinoplasty_tip',\n    60→    name: 'Tip Rhinoplasty (Tipplasty)',\n    61→    category: 'surgical',\n    62→    description: 'Focused nasal tip refinement without bridge modification',\n    63→    howItWorks: 'Reshapes tip cartilages through closed or open approach, refining tip projection and rotation',\n    64→    effectiveness: 8,\n    65→    evidenceLevel: 'strong',\n    66→    pslImprovement: { min: 0.3, max: 0.7 },\n    67→    costLevel: 'high',\n    68→    costRange: { min: 3500, max: 8000, currency: 'USD' },\n    69→    costFrequency: 'one-time',\n    70→    timelineToResults: '2-4 weeks initial, 6-12 months final',\n    71→    resultsDuration: 'Permanent',\n    72→    maintenanceRequired: false,\n    73→    recoveryTime: '1 week for major swelling',\n    74→    downtime: '5-7 days off work',\n    75→    painLevel: 'low',\n    76→    riskLevel: 'low',\n    77→    sideEffects: ['Tip swelling', 'Minor bruising', 'Temporary numbness'],\n    78→    contraindications: ['Bridge concerns', 'Severe tip deformities'],\n    79→    targetMetrics: ['nasolabial_angle', 'tip_projection', 'overall_harmony'],\n    80→    targetIssues: ['bulbous_tip', 'droopy_tip', 'upturned_tip', 'tip_asymmetry'],\n    81→    permanence: 'permanent',\n    82→    anesthesiaType: 'local',\n    83→    revisionRate: 0.10,\n    84→    regionalCosts: [\n    85→      { region: 'USA', min: 4000, max: 8000, currency: 'USD' },\n    86→      { region: 'Turkey', min: 1500, max: 3000, currency: 'USD' },\n    87→      { region: 'South Korea', min: 2500, max: 5000, currency: 'USD' },\n    88→    ],\n    89→    notes: [\n    90→      'Less invasive than full rhinoplasty',\n    91→      'Shorter recovery time',\n    92→      'Can be done under local anesthesia',\n    93→      'Ideal for patients with good bridge but tip concerns',\n    94→    ],\n    95→    sources: ['ASPS', 'RealSelf'],\n    96→  },\n    97→  {\n    98→    id: 'septorhinoplasty',\n    99→    name: 'Septorhinoplasty',\n   100→    category: 'surgical',\n   101→    description: 'Combination of septum repair and cosmetic rhinoplasty',\n   102→    howItWorks: 'Corrects deviated septum while reshaping external nose appearance',\n   103→    effectiveness: 9,\n   104→    evidenceLevel: 'strong',\n   105→    pslImprovement: { min: 0.4, max: 0.9 },\n   106→    costLevel: 'very_high',\n   107→    costRange: { min: 6000, max: 18000, currency: 'USD' },\n   108→    costFrequency: 'one-time',\n   109→    timelineToResults: '2-4 weeks initial, 12-18 months final',\n   110→    resultsDuration: 'Permanent',\n   111→    maintenanceRequired: false,\n   112→    recoveryTime: '2 weeks for major swelling, full recovery 12-18 months',\n   113→    downtime: '1-2 weeks off work',\n   114→    painLevel: 'moderate',\n   115→    riskLevel: 'medium',\n   116→    sideEffects: ['Swelling', 'Bruising', 'Numbness', 'Septal perforation (rare)'],\n   117→    contraindications: ['Bleeding disorders', 'Active infections'],\n   118→    targetMetrics: ['nasal_index', 'nasolabial_angle', 'overall_harmony'],\n   119→    targetIssues: ['deviated_septum', 'breathing_issues', 'crooked_nose', 'asymmetry'],\n   120→    permanence: 'permanent',\n   121→    anesthesiaType: 'general',\n   122→    revisionRate: 0.12,\n   123→    regionalCosts: [\n   124→      { region: 'USA', min: 7000, max: 18000, currency: 'USD' },\n   125→      { region: 'Turkey', min: 3000, max: 6000, currency: 'USD' },\n   126→    ],\n   127→    notes: [\n   128→      'May be partially covered by insurance if septum is functionally deviated',\n   129→      'Combines functional and aesthetic improvement',\n   130→      'Two-for-one recovery period',\n   131→    ],\n   132→    sources: ['ASPS', 'AAO-HNS'],\n   133→  },\n   134→\n   135→  // ============================================\n   136→  // JAW & CHIN SURGERIES\n   137→  // ============================================\n   138→  {\n   139→    id: 'genioplasty',\n   140→    name: 'Sliding Genioplasty',\n   141→    category: 'surgical',\n   142→    description: 'Chin advancement or setback by cutting and repositioning the chin bone',\n   143→    howItWorks: 'Horizontal osteotomy of the mandible allows the chin segment to be moved forward, backward, up, or down',\n   144→    effectiveness: 9,\n   145→    evidenceLevel: 'strong',\n   146→    pslImprovement: { min: 0.5, max: 1.2 },\n   147→    costLevel: 'very_high',\n   148→    costRange: { min: 5000, max: 15000, currency: 'USD' },\n   149→    costFrequency: 'one-time',\n   150→    timelineToResults: '3-6 months for swelling resolution, 12 months final',\n   151→    resultsDuration: 'Permanent',\n   152→    maintenanceRequired: false,\n   153→    recoveryTime: '4-6 weeks',\n   154→    downtime: '1-2 weeks off work',\n   155→    painLevel: 'moderate',\n   156→    riskLevel: 'medium',\n   157→    sideEffects: ['Swelling', 'Numbness (temporary to permanent)', 'Asymmetry', 'Bone resorption'],\n   158→    contraindications: ['Active infections', 'Poor bone health', 'Unrealistic expectations'],\n   159→    targetMetrics: ['chin_projection', 'pogonion', 'facial_convexity', 'profile_harmony'],\n   160→    targetIssues: ['recessed_chin', 'weak_chin', 'chin_excess', 'facial_imbalance'],\n   161→    permanence: 'permanent',\n   162→    anesthesiaType: 'general',\n   163→    revisionRate: 0.08,\n   164→    regionalCosts: [\n   165→      { region: 'USA', min: 6000, max: 15000, currency: 'USD' },\n   166→      { region: 'South Korea', min: 4000, max: 8000, currency: 'USD' },\n   167→      { region: 'Turkey', min: 3000, max: 6000, currency: 'USD' },\n   168→    ],\n   169→    surgeonRecommendations: [\n   170→      { name: 'Dr. Barry Eppley', location: 'Indianapolis, USA', specialty: 'Custom facial implants & genioplasty', costRange: '$8,000-15,000' },\n   171→      { name: 'Dr. Yaremchuk', location: 'Boston, USA', specialty: 'Facial skeletal surgery', costRange: '$10,000-20,000' },\n   172→    ],\n   173→    notes: [\n   174→      'More versatile than chin implants (can move in all directions)',\n   175→      'Uses your own bone - no implant rejection risk',\n   176→      '5-10% permanent numbness of lower lip',\n   177→      'Can be combined with jaw surgery for comprehensive lower third correction',\n   178→    ],\n   179→    sources: ['ASPS', 'AAOMS', 'PubMed'],\n   180→  },\n   181→  {\n   182→    id: 'chin_implant',\n   183→    name: 'Chin Implant (Mentoplasty)',\n   184→    category: 'surgical',\n   185→    description: 'Silicone or PEEK implant to augment chin projection',\n   186→    howItWorks: 'Implant placed through intraoral or submental incision, sits on the bone to increase projection',\n   187→    effectiveness: 8,\n   188→    evidenceLevel: 'strong',\n   189→    pslImprovement: { min: 0.4, max: 0.9 },\n   190→    costLevel: 'high',\n   191→    costRange: { min: 3000, max: 8000, currency: 'USD' },\n   192→    costFrequency: 'one-time',\n   193→    timelineToResults: '2-4 weeks for swelling, 3 months final',\n   194→    resultsDuration: 'Permanent (may need replacement in 15-20 years)',\n   195→    maintenanceRequired: false,\n   196→    recoveryTime: '1-2 weeks',\n   197→    downtime: '3-7 days off work',\n   198→    painLevel: 'low',\n   199→    riskLevel: 'low',\n   200→    sideEffects: ['Swelling', 'Numbness', 'Implant shifting', 'Bone erosion', 'Infection'],\n   201→    contraindications: ['Active oral infections', 'Unrealistic expectations'],\n   202→    targetMetrics: ['chin_projection', 'profile_harmony'],\n   203→    targetIssues: ['recessed_chin', 'weak_chin', 'short_chin'],\n   204→    permanence: 'permanent',\n   205→    anesthesiaType: 'local',\n   206→    revisionRate: 0.05,\n   207→    regionalCosts: [\n   208→      { region: 'USA', min: 3500, max: 8000, currency: 'USD' },\n   209→      { region: 'Turkey', min: 2000, max: 4000, currency: 'USD' },\n   210→      { region: 'Mexico', min: 2000, max: 4500, currency: 'USD' },\n   211→    ],\n   212→    notes: [\n   213→      'Faster recovery than genioplasty',\n   214→      'Reversible if desired',\n   215→      'Can only add projection, not reduce or move vertically',\n   216→      'Bone erosion occurs in many patients but rarely clinically significant',\n   217→      'PEEK implants more expensive but no erosion',\n   218→    ],\n   219→    sources: ['ASPS', 'RealSelf'],\n   220→  },\n   221→  {\n   222→    id: 'jaw_implants',\n   223→    name: 'Jaw Angle Implants',\n   224→    category: 'surgical',\n   225→    description: 'Implants to widen and define the jaw angles (gonion)',\n   226→    howItWorks: 'Silicone or PEEK implants placed over the mandibular angle to increase width and definition',\n   227→    effectiveness: 9,\n   228→    evidenceLevel: 'strong',\n   229→    pslImprovement: { min: 0.5, max: 1.2 },\n   230→    costLevel: 'very_high',\n   231→    costRange: { min: 7000, max: 20000, currency: 'USD' },\n   232→    costFrequency: 'one-time',\n   233→    timelineToResults: '4-8 weeks for swelling, 3-6 months final',\n   234→    resultsDuration: 'Permanent',\n   235→    maintenanceRequired: false,\n   236→    recoveryTime: '2-4 weeks',\n   237→    downtime: '1-2 weeks off work',\n   238→    painLevel: 'moderate',\n   239→    riskLevel: 'medium',\n   240→    sideEffects: ['Swelling', 'Numbness', 'Asymmetry', 'Implant shifting', 'Masseter tightness'],\n   241→    contraindications: ['Active infections', 'Very thin soft tissue'],\n   242→    targetMetrics: ['gonial_angle', 'bigonial_width', 'jaw_width_ratio', 'fwhr'],\n   243→    targetIssues: ['narrow_jaw', 'weak_gonial_angle', 'round_face', 'undefined_jawline'],\n   244→    genderSpecific: 'male',\n   245→    permanence: 'permanent',\n   246→    anesthesiaType: 'general',\n   247→    revisionRate: 0.10,\n   248→    regionalCosts: [\n   249→      { region: 'USA', min: 8000, max: 20000, currency: 'USD' },\n   250→      { region: 'South Korea', min: 6000, max: 12000, currency: 'USD' },\n   251→      { region: 'Turkey', min: 4000, max: 8000, currency: 'USD' },\n   252→    ],\n   253→    surgeonRecommendations: [\n   254→      { name: 'Dr. Barry Eppley', location: 'Indianapolis, USA', specialty: 'Custom wrap-around jaw implants', costRange: '$15,000-25,000' },\n   255→      { name: 'Dr. Yaremchuk', location: 'Boston, USA', specialty: 'Facial implants', costRange: '$12,000-20,000' },\n   256→    ],\n   257→    notes: [\n   258→      'Custom implants provide better results than stock',\n   259→      'Often combined with chin implant for comprehensive jawline',\n   260→      'Wrap-around implants cover jaw angle + body + chin',\n   261→      'PEEK implants cost more but no bone erosion',\n   262→    ],\n   263→    sources: ['ASPS', 'RealSelf', 'Dr. Eppley publications'],\n   264→  },\n   265→  {\n   266→    id: 'bsso',\n   267→    name: 'BSSO (Bilateral Sagittal Split Osteotomy)',\n   268→    category: 'surgical',\n   269→    description: 'Mandibular advancement or setback surgery for jaw positioning',\n   270→    howItWorks: 'The mandible is split and repositioned forward or backward, then fixed with titanium plates',\n   271→    effectiveness: 10,\n   272→    evidenceLevel: 'strong',\n   273→    pslImprovement: { min: 0.8, max: 2.0 },\n   274→    costLevel: 'very_high',\n   275→    costRange: { min: 20000, max: 50000, currency: 'USD' },\n   276→    costFrequency: 'one-time',\n   277→    timelineToResults: '3-6 months for major swelling, 12-18 months final',\n   278→    resultsDuration: 'Permanent',\n   279→    maintenanceRequired: false,\n   280→    recoveryTime: '6-8 weeks liquid/soft diet',\n   281→    downtime: '2-4 weeks off work',\n   282→    painLevel: 'high',\n   283→    riskLevel: 'high',\n   284→    sideEffects: ['Numbness (permanent in 10-15%)', 'Swelling', 'Relapse', 'TMJ issues', 'Malocclusion'],\n   285→    contraindications: ['Poor dental health', 'Bleeding disorders', 'Uncontrolled diabetes'],\n   286→    targetMetrics: ['chin_projection', 'gonial_angle', 'profile_harmony', 'facial_convexity'],\n   287→    targetIssues: ['recessed_mandible', 'prognathic_mandible', 'severe_overbite', 'severe_underbite'],\n   288→    permanence: 'permanent',\n   289→    anesthesiaType: 'general',\n   290→    hospitalStay: '1-2 nights',\n   291→    revisionRate: 0.05,\n   292→    regionalCosts: [\n   293→      { region: 'USA', min: 25000, max: 50000, currency: 'USD' },\n   294→      { region: 'South Korea', min: 15000, max: 25000, currency: 'USD' },\n   295→      { region: 'Germany', min: 20000, max: 40000, currency: 'EUR' },\n   296→    ],\n   297→    notes: [\n   298→      'Usually requires 1-2 years of orthodontics before and after',\n   299→      'May be covered by insurance if medically necessary',\n   300→      'CCW rotation (counter-clockwise) is common in aesthetic cases',\n   301→      'Often combined with Le Fort I for bimax surgery',\n   302→    ],\n   303→    sources: ['AAOMS', 'Journal of Oral and Maxillofacial Surgery'],\n   304→  },\n   305→  {\n   306→    id: 'bimax',\n   307→    name: 'Bimaxillary Osteotomy (Bimax / Double Jaw Surgery)',\n   308→    category: 'surgical',\n   309→    description: 'Combined Le Fort I and BSSO to reposition both jaws',\n   310→    howItWorks: 'Upper jaw (maxilla) and lower jaw (mandible) are both cut and repositioned to optimal positions',\n   311→    effectiveness: 10,\n   312→    evidenceLevel: 'strong',\n   313→    pslImprovement: { min: 1.0, max: 2.5 },\n   314→    costLevel: 'very_high',\n   315→    costRange: { min: 30000, max: 80000, currency: 'USD' },\n   316→    costFrequency: 'one-time',\n   317→    timelineToResults: '6-12 months for major swelling, 18-24 months final',\n   318→    resultsDuration: 'Permanent',\n   319→    maintenanceRequired: false,\n   320→    recoveryTime: '6-8 weeks liquid/soft diet, 6-12 months full recovery',\n   321→    downtime: '4-6 weeks off work',\n   322→    painLevel: 'high',\n   323→    riskLevel: 'high',\n   324→    sideEffects: ['Numbness', 'Swelling', 'Relapse', 'TMJ issues', 'Nerve damage', 'Bleeding'],\n   325→    contraindications: ['Poor general health', 'Bleeding disorders', 'Uncontrolled diabetes', 'Smoking'],\n   326→    targetMetrics: ['facial_convexity', 'profile_harmony', 'midface_ratio', 'overall_harmony'],\n   327→    targetIssues: ['bimaxillary_protrusion', 'facial_asymmetry', 'long_face_syndrome', 'short_face_syndrome', 'severe_malocclusion'],\n   328→    permanence: 'permanent',\n   329→    anesthesiaType: 'general',\n   330→    hospitalStay: '2-3 nights',\n   331→    revisionRate: 0.08,\n   332→    regionalCosts: [\n   333→      { region: 'USA', min: 40000, max: 80000, currency: 'USD' },\n   334→      { region: 'South Korea', min: 20000, max: 35000, currency: 'USD', notes: 'Most popular destination for bimax' },\n   335→      { region: 'Germany', min: 30000, max: 50000, currency: 'EUR' },\n   336→      { region: 'Spain', min: 20000, max: 35000, currency: 'EUR' },\n   337→    ],\n   338→    surgeonRecommendations: [\n   339→      { name: 'Dr. Alfaro', location: 'Barcelona, Spain', specialty: 'Aesthetic jaw surgery', costRange: '€25,000-35,000' },\n   340→      { name: 'Dr. Gunson/Arnett', location: 'Santa Barbara, USA', specialty: 'Orthognathic surgery', costRange: '$60,000-100,000' },\n   341→      { name: 'ID Hospital', location: 'Seoul, South Korea', specialty: 'V-line surgery', costRange: '$20,000-30,000' },\n   342→    ],\n   343→    notes: [\n   344→      'Most transformative facial surgery available',\n   345→      'Requires 12-24 months of orthodontics (braces)',\n   346→      'CCW rotation with maxillary advancement is the aesthetic gold standard',\n   347→      'May be partially covered by insurance if sleep apnea or functional issues',\n   348→      'Korea specializes in aesthetic bimax; Western surgeons often focus on function',\n   349→    ],\n   350→    sources: ['AAOMS', 'Dr. Arnett publications', 'Journal of Craniomaxillofacial Surgery'],\n   351→  },\n   352→  {\n   353→    id: 'mandible_reduction',\n   354→    name: 'Mandible Angle Reduction',\n   355→    category: 'surgical',\n   356→    description: 'Reduction of prominent jaw angles for a slimmer face shape',\n   357→    howItWorks: 'Bone is shaved or cut from the mandibular angle to reduce width and create V-line appearance',\n   358→    effectiveness: 9,\n   359→    evidenceLevel: 'strong',\n   360→    pslImprovement: { min: 0.5, max: 1.0 },\n   361→    costLevel: 'very_high',\n   362→    costRange: { min: 8000, max: 25000, currency: 'USD' },\n   363→    costFrequency: 'one-time',\n   364→    timelineToResults: '3-6 months for swelling, 12 months final',\n   365→    resultsDuration: 'Permanent',\n   366→    maintenanceRequired: false,\n   367→    recoveryTime: '2-4 weeks',\n   368→    downtime: '1-2 weeks off work',\n   369→    painLevel: 'moderate',\n   370→    riskLevel: 'medium',\n   371→    sideEffects: ['Swelling', 'Numbness', 'Asymmetry', 'Masseter atrophy'],\n   372→    contraindications: ['Bleeding disorders', 'Active infections'],\n   373→    targetMetrics: ['bigonial_width', 'jaw_width_ratio', 'fwhr'],\n   374→    targetIssues: ['wide_jaw', 'square_jaw', 'masculine_jaw'],\n   375→    genderSpecific: 'female',\n   376→    permanence: 'permanent',\n   377→    anesthesiaType: 'general',\n   378→    revisionRate: 0.07,\n   379→    regionalCosts: [\n   380→      { region: 'South Korea', min: 8000, max: 15000, currency: 'USD', notes: 'V-line surgery capital' },\n   381→      { region: 'USA', min: 15000, max: 25000, currency: 'USD' },\n   382→    ],\n   383→    notes: [\n   384→      'Very popular in East Asia for V-line face shape',\n   385→      'Often combined with chin reduction for full V-line',\n   386→      'Can also be achieved with Botox for masseter (non-surgical)',\n   387→      'Long curve osteotomy provides most natural result',\n   388→    ],\n   389→    sources: ['Korean aesthetic surgery journals', 'ASPS'],\n   390→  },\n   391→\n   392→  // ============================================\n   393→  // CHEEK & MIDFACE SURGERIES\n   394→  // ============================================\n   395→  {\n   396→    id: 'cheek_implants',\n   397→    name: 'Cheek Implants (Malar/Submalar)',\n   398→    category: 'surgical',\n   399→    description: 'Silicone or PEEK implants to augment cheekbone projection',\n   400→    howItWorks: 'Implants placed over the malar (cheekbone) or submalar area through intraoral incision',\n   401→    effectiveness: 8,\n   402→    evidenceLevel: 'strong',\n   403→    pslImprovement: { min: 0.4, max: 1.0 },\n   404→    costLevel: 'high',\n   405→    costRange: { min: 4000, max: 12000, currency: 'USD' },\n   406→    costFrequency: 'one-time',\n   407→    timelineToResults: '4-8 weeks for swelling, 3-6 months final',\n   408→    resultsDuration: 'Permanent',\n   409→    maintenanceRequired: false,\n   410→    recoveryTime: '1-2 weeks',\n   411→    downtime: '1 week off work',\n   412→    painLevel: 'moderate',\n   413→    riskLevel: 'medium',\n   414→    sideEffects: ['Swelling', 'Numbness', 'Asymmetry', 'Implant shifting', 'Bone erosion'],\n   415→    contraindications: ['Very thin soft tissue', 'Active infections'],\n   416→    targetMetrics: ['cheekbone_projection', 'fwhr', 'midface_ratio', 'overall_harmony'],\n   417→    targetIssues: ['flat_cheeks', 'midface_deficiency', 'sunken_cheeks', 'aging_midface'],\n   418→    permanence: 'permanent',\n   419→    anesthesiaType: 'local',\n   420→    revisionRate: 0.08,\n   421→    regionalCosts: [\n   422→      { region: 'USA', min: 5000, max: 12000, currency: 'USD' },\n   423→      { region: 'Turkey', min: 3000, max: 6000, currency: 'USD' },\n   424→      { region: 'South Korea', min: 4000, max: 8000, currency: 'USD' },\n   425→    ],\n   426→    notes: [\n   427→      'Malar implants: on cheekbone for projection',\n   428→      'Submalar implants: below cheekbone for fullness',\n   429→      'Combined malar-submalar for comprehensive midface enhancement',\n   430→      'Custom implants provide best results but cost more',\n   431→    ],\n   432→    sources: ['ASPS', 'RealSelf'],\n   433→  },\n   434→  {\n   435→    id: 'zygoma_reduction',\n   436→    name: 'Zygoma Reduction (Cheekbone Reduction)',\n   437→    category: 'surgical',\n   438→    description: 'Reduction of prominent cheekbones for narrower midface',\n   439→    howItWorks: 'Zygomatic arch is cut and repositioned inward to reduce facial width',\n   440→    effectiveness: 8,\n   441→    evidenceLevel: 'strong',\n   442→    pslImprovement: { min: 0.4, max: 0.9 },\n   443→    costLevel: 'very_high',\n   444→    costRange: { min: 10000, max: 25000, currency: 'USD' },\n   445→    costFrequency: 'one-time',\n   446→    timelineToResults: '3-6 months for swelling, 12 months final',\n   447→    resultsDuration: 'Permanent',\n   448→    maintenanceRequired: false,\n   449→    recoveryTime: '2-4 weeks',\n   450→    downtime: '2 weeks off work',\n   451→    painLevel: 'moderate',\n   452→    riskLevel: 'medium',\n   453→    sideEffects: ['Swelling', 'Numbness', 'Asymmetry', 'Cheek sagging'],\n   454→    contraindications: ['Bleeding disorders', 'Active infections'],\n   455→    targetMetrics: ['bizygomatic_width', 'fwhr', 'facial_width'],\n   456→    targetIssues: ['wide_cheekbones', 'prominent_zygoma', 'wide_midface'],\n   457→    permanence: 'permanent',\n   458→    anesthesiaType: 'general',\n   459→    revisionRate: 0.06,\n   460→    regionalCosts: [\n   461→      { region: 'South Korea', min: 10000, max: 18000, currency: 'USD' },\n   462→      { region: 'USA', min: 15000, max: 25000, currency: 'USD' },\n   463→    ],\n   464→    notes: [\n   465→      'Popular in East Asia where high cheekbones common',\n   466→      'Risk of cheek sagging if soft tissue not managed',\n   467→      'Often combined with V-line jaw reduction',\n   468→    ],\n   469→    sources: ['Korean aesthetic surgery journals'],\n   470→  },\n   471→  {\n   472→    id: 'lefort_1',\n   473→    name: 'Le Fort I Osteotomy (Maxillary Advancement)',\n   474→    category: 'surgical',\n   475→    description: 'Repositioning of the upper jaw (maxilla)',\n   476→    howItWorks: 'Maxilla is cut and moved forward, backward, up, or down, then fixed with titanium plates',\n   477→    effectiveness: 9,\n   478→    evidenceLevel: 'strong',\n   479→    pslImprovement: { min: 0.6, max: 1.5 },\n   480→    costLevel: 'very_high',\n   481→    costRange: { min: 20000, max: 45000, currency: 'USD' },\n   482→    costFrequency: 'one-time',\n   483→    timelineToResults: '3-6 months for swelling, 12-18 months final',\n   484→    resultsDuration: 'Permanent',\n   485→    maintenanceRequired: false,\n   486→    recoveryTime: '4-6 weeks',\n   487→    downtime: '2-4 weeks off work',\n   488→    painLevel: 'moderate',\n   489→    riskLevel: 'medium',\n   490→    sideEffects: ['Swelling', 'Numbness', 'Relapse', 'Bleeding', 'Deviated septum'],\n   491→    contraindications: ['Poor dental health', 'Bleeding disorders'],\n   492→    targetMetrics: ['midface_projection', 'nasolabial_angle', 'upper_lip_support', 'facial_convexity'],\n   493→    targetIssues: ['recessed_maxilla', 'midface_deficiency', 'long_face', 'short_face', 'gummy_smile'],\n   494→    permanence: 'permanent',\n   495→    anesthesiaType: 'general',\n   496→    hospitalStay: '1-2 nights',\n   497→    revisionRate: 0.06,\n   498→    regionalCosts: [\n   499→      { region: 'USA', min: 25000, max: 45000, currency: 'USD' },\n   500→      { region: 'South Korea', min: 12000, max: 20000, currency: 'USD' },\n   501→      { region: 'Spain', min: 15000, max: 25000, currency: 'EUR' },\n   502→    ],\n   503→    notes: [\n   504→      'Often combined with BSSO for bimax surgery',\n   505→      'Can correct gummy smile by impacting maxilla upward',\n   506→      'May improve nasal breathing',\n   507→      'Usually requires orthodontics before and after',\n   508→    ],\n   509→    sources: ['AAOMS', 'Journal of Oral and Maxillofacial Surgery'],\n   510→  },\n   511→\n   512→  // ============================================\n   513→  // EYE SURGERIES\n   514→  // ============================================\n   515→  {\n   516→    id: 'canthoplasty',\n   517→    name: 'Canthoplasty (Lateral Canthopexy)',\n   518→    category: 'surgical',\n   519→    description: 'Surgical repositioning of the outer corner of the eye',\n   520→    howItWorks: 'Lateral canthal tendon is released and reattached at a higher position to lift eye corner',\n   521→    effectiveness: 8,\n   522→    evidenceLevel: 'strong',\n   523→    pslImprovement: { min: 0.3, max: 0.7 },\n   524→    costLevel: 'high',\n   525→    costRange: { min: 4000, max: 12000, currency: 'USD' },\n   526→    costFrequency: 'one-time',\n   527→    timelineToResults: '2-4 weeks for swelling, 3-6 months final',\n   528→    resultsDuration: 'Permanent',\n   529→    maintenanceRequired: false,\n   530→    recoveryTime: '2-3 weeks',\n   531→    downtime: '1-2 weeks off work',\n   532→    painLevel: 'low',\n   533→    riskLevel: 'medium',\n   534→    sideEffects: ['Swelling', 'Bruising', 'Asymmetry', 'Dry eyes', 'Ectropion (eyelid turning out)'],\n   535→    contraindications: ['Dry eye syndrome', 'Previous eyelid surgery', 'Unrealistic expectations'],\n   536→    targetMetrics: ['canthal_tilt', 'palpebral_fissure', 'eye_area'],\n   537→    targetIssues: ['negative_canthal_tilt', 'droopy_eyes', 'sad_eyes', 'aging_eyes'],\n   538→    permanence: 'permanent',\n   539→    anesthesiaType: 'local',\n   540→    revisionRate: 0.12,\n   541→    regionalCosts: [\n   542→      { region: 'USA', min: 5000, max: 12000, currency: 'USD' },\n   543→      { region: 'South Korea', min: 3000, max: 6000, currency: 'USD' },\n   544→      { region: 'Turkey', min: 2500, max: 5000, currency: 'USD' },\n   545→    ],\n   546→    surgeonRecommendations: [\n   547→      { name: 'Dr. Taban', location: 'Los Angeles, USA', specialty: 'Oculoplastic surgery', costRange: '$8,000-15,000' },\n   548→    ],\n   549→    notes: [\n   550→      'High satisfaction but also higher revision rate',\n   551→      'Fox eye look is a more aggressive version',\n   552→      'Conservative approach recommended to avoid unnatural look',\n   553→      'Thread canthoplasty is less invasive but temporary',\n   554→    ],\n   555→    sources: ['ASOPRS', 'RealSelf'],\n   556→  },\n   557→  {\n   558→    id: 'upper_blepharoplasty',\n   559→    name: 'Upper Blepharoplasty (Eyelid Surgery)',\n   560→    category: 'surgical',\n   561→    description: 'Removal of excess skin and fat from upper eyelids',\n   562→    howItWorks: 'Excess skin, muscle, and fat are removed through incision hidden in eyelid crease',\n   563→    effectiveness: 8,\n   564→    evidenceLevel: 'strong',\n   565→    pslImprovement: { min: 0.2, max: 0.6 },\n   566→    costLevel: 'medium',\n   567→    costRange: { min: 2500, max: 7000, currency: 'USD' },\n   568→    costFrequency: 'one-time',\n   569→    timelineToResults: '2-4 weeks for swelling, 3 months final',\n   570→    resultsDuration: 'Long-lasting (10-15 years)',\n   571→    maintenanceRequired: false,\n   572→    recoveryTime: '1-2 weeks',\n   573→    downtime: '5-7 days off work',\n   574→    painLevel: 'low',\n   575→    riskLevel: 'low',\n   576→    sideEffects: ['Swelling', 'Bruising', 'Dry eyes', 'Asymmetry', 'Scarring'],\n   577→    contraindications: ['Dry eye syndrome', 'Glaucoma', 'Thyroid eye disease'],\n   578→    targetMetrics: ['upper_eyelid_exposure', 'palpebral_fissure', 'eye_area'],\n   579→    targetIssues: ['hooded_eyelids', 'excess_eyelid_skin', 'aging_eyes', 'tired_appearance'],\n   580→    permanence: 'semi-permanent',\n   581→    anesthesiaType: 'local',\n   582→    revisionRate: 0.05,\n   583→    regionalCosts: [\n   584→      { region: 'USA', min: 3000, max: 7000, currency: 'USD' },\n   585→      { region: 'Turkey', min: 1500, max: 3000, currency: 'USD' },\n   586→      { region: 'South Korea', min: 2000, max: 4000, currency: 'USD' },\n   587→    ],\n   588→    notes: [\n   589→      'One of the most common facial surgeries',\n   590→      'May be covered by insurance if obstructing vision',\n   591→      'Hidden incision in natural crease',\n   592→      'Double eyelid surgery (Asian blepharoplasty) is different procedure',\n   593→    ],\n   594→    sources: ['ASPS', 'RealSelf'],\n   595→  },\n   596→  {\n   597→    id: 'lower_blepharoplasty',\n   598→    name: 'Lower Blepharoplasty',\n   599→    category: 'surgical',\n   600→    description: 'Treatment of under-eye bags and excess skin',\n   601→    howItWorks: 'Fat is repositioned or removed, and excess skin removed through incision below lash line or inside eyelid',\n   602→    effectiveness: 8,\n   603→    evidenceLevel: 'strong',\n   604→    pslImprovement: { min: 0.2, max: 0.5 },\n   605→    costLevel: 'high',\n   606→    costRange: { min: 4000, max: 10000, currency: 'USD' },\n   607→    costFrequency: 'one-time',\n   608→    timelineToResults: '2-4 weeks for swelling, 3-6 months final',\n   609→    resultsDuration: 'Long-lasting (10-15 years)',\n   610→    maintenanceRequired: false,\n   611→    recoveryTime: '2 weeks',\n   612→    downtime: '7-10 days off work',\n   613→    painLevel: 'low',\n   614→    riskLevel: 'low',\n   615→    sideEffects: ['Swelling', 'Bruising', 'Dry eyes', 'Ectropion', 'Hollowing'],\n   616→    contraindications: ['Dry eye syndrome', 'Thyroid disorders'],\n   617→    targetMetrics: ['infraorbital_area', 'tear_trough', 'eye_area'],\n   618→    targetIssues: ['eye_bags', 'dark_circles', 'excess_lower_lid_skin', 'aging_eyes'],\n   619→    permanence: 'semi-permanent',\n   620→    anesthesiaType: 'local',\n   621→    revisionRate: 0.08,\n   622→    regionalCosts: [\n   623→      { region: 'USA', min: 5000, max: 10000, currency: 'USD' },\n   624→      { region: 'Turkey', min: 2000, max: 4000, currency: 'USD' },\n   625→      { region: 'South Korea', min: 2500, max: 5000, currency: 'USD' },\n   626→    ],\n   627→    notes: [\n   628→      'Transconjunctival approach (inside eyelid) leaves no visible scar',\n   629→      'Fat repositioning preferred over removal to avoid hollow look',\n   630→      'Often combined with fat transfer for best results',\n   631→    ],\n   632→    sources: ['ASPS', 'RealSelf'],\n   633→  },\n   634→  {\n   635→    id: 'orbital_decompression',\n   636→    name: 'Orbital Rim Implants',\n   637→    category: 'surgical',\n   638→    description: 'Implants to augment the bony rim around the eye',\n   639→    howItWorks: 'Custom implants placed along infraorbital or supraorbital rim to improve eye support',\n   640→    effectiveness: 8,\n   641→    evidenceLevel: 'moderate',\n   642→    pslImprovement: { min: 0.4, max: 0.8 },\n   643→    costLevel: 'very_high',\n   644→    costRange: { min: 10000, max: 25000, currency: 'USD' },\n   645→    costFrequency: 'one-time',\n   646→    timelineToResults: '4-8 weeks for swelling, 6 months final',\n   647→    resultsDuration: 'Permanent',\n   648→    maintenanceRequired: false,\n   649→    recoveryTime: '2-4 weeks',\n   650→    downtime: '1-2 weeks off work',\n   651→    painLevel: 'moderate',\n   652→    riskLevel: 'medium',\n   653→    sideEffects: ['Swelling', 'Numbness', 'Implant visibility', 'Asymmetry'],\n   654→    contraindications: ['Thyroid eye disease', 'Very thin skin'],\n   655→    targetMetrics: ['infraorbital_rim', 'upper_eyelid_support', 'eye_area'],\n   656→    targetIssues: ['negative_orbital_vector', 'under_eye_hollows', 'prominent_eyes', 'aging_midface'],\n   657→    permanence: 'permanent',\n   658→    anesthesiaType: 'general',\n   659→    revisionRate: 0.10,\n   660→    regionalCosts: [\n   661→      { region: 'USA', min: 12000, max: 25000, currency: 'USD' },\n   662→    ],\n   663→    surgeonRecommendations: [\n   664→      { name: 'Dr. Barry Eppley', location: 'Indianapolis, USA', specialty: 'Custom facial implants', costRange: '$15,000-25,000' },\n   665→    ],\n   666→    notes: [\n   667→      'Custom implants designed from CT scan',\n   668→      'Can dramatically change eye appearance',\n   669→      'Often combined with other facial implants',\n   670→    ],\n   671→    sources: ['Dr. Eppley publications'],\n   672→  },\n   673→\n   674→  // ============================================\n   675→  // FOREHEAD & BROW SURGERIES\n   676→  // ============================================\n   677→  {\n   678→    id: 'brow_lift',\n   679→    name: 'Endoscopic Brow Lift',\n   680→    category: 'surgical',\n   681→    description: 'Lifting of the eyebrows through minimally invasive technique',\n   682→    howItWorks: 'Small incisions in hairline allow endoscopic repositioning of brow tissue',\n   683→    effectiveness: 8,\n   684→    evidenceLevel: 'strong',\n   685→    pslImprovement: { min: 0.2, max: 0.5 },\n   686→    costLevel: 'high',\n   687→    costRange: { min: 5000, max: 12000, currency: 'USD' },\n   688→    costFrequency: 'one-time',\n   689→    timelineToResults: '2-4 weeks for swelling, 3-6 months final',\n   690→    resultsDuration: 'Long-lasting (7-10 years)',\n   691→    maintenanceRequired: false,\n   692→    recoveryTime: '1-2 weeks',\n   693→    downtime: '7-10 days off work',\n   694→    painLevel: 'moderate',\n   695→    riskLevel: 'low',\n   696→    sideEffects: ['Swelling', 'Numbness', 'Hair loss at incisions', 'Asymmetry'],\n   697→    contraindications: ['Very high hairline', 'Male pattern baldness'],\n   698→    targetMetrics: ['brow_position', 'upper_eyelid_exposure', 'eye_area'],\n   699→    targetIssues: ['low_brows', 'brow_ptosis', 'forehead_wrinkles', 'hooded_eyes_from_brow'],\n   700→    permanence: 'semi-permanent',\n   701→    anesthesiaType: 'sedation',\n   702→    revisionRate: 0.08,\n   703→    regionalCosts: [\n   704→      { region: 'USA', min: 6000, max: 12000, currency: 'USD' },\n   705→      { region: 'Turkey', min: 3000, max: 6000, currency: 'USD' },\n   706→    ],\n   707→    notes: [\n   708→      'Less invasive than coronal brow lift',\n   709→      'Shorter recovery than traditional methods',\n   710→      'Can be combined with upper blepharoplasty',\n   711→      'Results last 7-10 years on average',\n   712→    ],\n   713→    sources: ['ASPS', 'RealSelf'],\n   714→  },\n   715→  {\n   716→    id: 'forehead_reduction',\n   717→    name: 'Forehead Reduction (Hairline Lowering)',\n   718→    category: 'surgical',\n   719→    description: 'Surgical lowering of the hairline by removing forehead skin',\n   720→    howItWorks: 'Scalp is advanced forward and excess forehead skin is removed',\n   721→    effectiveness: 9,\n   722→    evidenceLevel: 'strong',\n   723→    pslImprovement: { min: 0.3, max: 0.7 },\n   724→    costLevel: 'high',\n   725→    costRange: { min: 7000, max: 15000, currency: 'USD' },\n   726→    costFrequency: 'one-time',\n   727→    timelineToResults: '4-8 weeks for swelling, 6-12 months final',\n   728→    resultsDuration: 'Permanent',\n   729→    maintenanceRequired: false,\n   730→    recoveryTime: '1-2 weeks',\n   731→    downtime: '7-10 days off work',\n   732→    painLevel: 'moderate',\n   733→    riskLevel: 'low',\n   734→    sideEffects: ['Swelling', 'Numbness', 'Visible scar', 'Hair shock loss'],\n   735→    contraindications: ['Male pattern baldness', 'Very tight scalp'],\n   736→    targetMetrics: ['facial_thirds', 'forehead_height', 'upper_third'],\n   737→    targetIssues: ['large_forehead', 'high_hairline', 'long_upper_third'],\n   738→    permanence: 'permanent',\n   739→    anesthesiaType: 'sedation',\n   740→    revisionRate: 0.05,\n   741→    regionalCosts: [\n   742→      { region: 'USA', min: 8000, max: 15000, currency: 'USD' },\n   743→      { region: 'Turkey', min: 4000, max: 8000, currency: 'USD' },\n   744→    ],\n   745→    notes: [\n   746→      'Can lower hairline 2-5 cm depending on scalp laxity',\n   747→      'Scar hidden at hairline but visible in some cases',\n   748→      'Often combined with hair transplant for feathering',\n   749→      'Alternative: hair transplant to lower hairline',\n   750→    ],\n   751→    sources: ['ASPS', 'RealSelf'],\n   752→  },\n   753→  {\n   754→    id: 'forehead_implant',\n   755→    name: 'Forehead/Brow Bone Implant',\n   756→    category: 'surgical',\n   757→    description: 'Custom implant to augment forehead shape or brow bone',\n   758→    howItWorks: 'PEEK or silicone implant placed to add projection to forehead or brow ridge',\n   759→    effectiveness: 8,\n   760→    evidenceLevel: 'moderate',\n   761→    pslImprovement: { min: 0.3, max: 0.6 },\n   762→    costLevel: 'very_high',\n   763→    costRange: { min: 10000, max: 25000, currency: 'USD' },\n   764→    costFrequency: 'one-time',\n   765→    timelineToResults: '4-8 weeks for swelling, 6 months final',\n   766→    resultsDuration: 'Permanent',\n   767→    maintenanceRequired: false,\n   768→    recoveryTime: '2-3 weeks',\n   769→    downtime: '1-2 weeks off work',\n   770→    painLevel: 'moderate',\n   771→    riskLevel: 'medium',\n   772→    sideEffects: ['Swelling', 'Numbness', 'Implant visibility', 'Infection'],\n   773→    contraindications: ['Very thin skin', 'Unrealistic expectations'],\n   774→    targetMetrics: ['brow_ridge', 'forehead_projection', 'facial_convexity'],\n   775→    targetIssues: ['flat_forehead', 'weak_brow_ridge', 'feminine_forehead'],\n   776→    genderSpecific: 'male',\n   777→    permanence: 'permanent',\n   778→    anesthesiaType: 'general',\n   779→    revisionRate: 0.08,\n   780→    regionalCosts: [\n   781→      { region: 'USA', min: 12000, max: 25000, currency: 'USD' },\n   782→    ],\n   783→    surgeonRecommendations: [\n   784→      { name: 'Dr. Barry Eppley', location: 'Indianapolis, USA', specialty: 'Custom facial implants', costRange: '$15,000-25,000' },\n   785→    ],\n   786→    notes: [\n   787→      'Custom implants designed from CT scan',\n   788→      'Can create more masculine brow ridge',\n   789→      'FFS (facial feminization) does the opposite - reduces brow bone',\n   790→    ],\n   791→    sources: ['Dr. Eppley publications'],\n   792→  },\n   793→\n   794→  // ============================================\n   795→  // LIP SURGERIES\n   796→  // ============================================\n   797→  {\n   798→    id: 'lip_lift',\n   799→    name: 'Lip Lift (Bullhorn Lip Lift)',\n   800→    category: 'surgical',\n   801→    description: 'Shortening of the philtrum to increase upper lip show',\n   802→    howItWorks: 'Skin removed from under the nose, pulling the upper lip upward and creating more vermillion show',\n   803→    effectiveness: 8,\n   804→    evidenceLevel: 'strong',\n   805→    pslImprovement: { min: 0.2, max: 0.5 },\n   806→    costLevel: 'high',\n   807→    costRange: { min: 3500, max: 8000, currency: 'USD' },\n   808→    costFrequency: 'one-time',\n   809→    timelineToResults: '2-4 weeks for swelling, 3-6 months final',\n   810→    resultsDuration: 'Permanent',\n   811→    maintenanceRequired: false,\n   812→    recoveryTime: '1-2 weeks',\n   813→    downtime: '5-7 days off work',\n   814→    painLevel: 'low',\n   815→    riskLevel: 'low',\n   816→    sideEffects: ['Swelling', 'Numbness', 'Visible scar', 'Over-correction'],\n   817→    contraindications: ['Already short philtrum', 'Dark skin (scarring risk)'],\n   818→    targetMetrics: ['philtrum_length', 'upper_lip_ratio', 'vermillion_show'],\n   819→    targetIssues: ['long_philtrum', 'thin_upper_lip', 'aging_lips', 'hidden_vermillion'],\n   820→    permanence: 'permanent',\n   821→    anesthesiaType: 'local',\n   822→    revisionRate: 0.10,\n   823→    regionalCosts: [\n   824→      { region: 'USA', min: 4000, max: 8000, currency: 'USD' },\n   825→      { region: 'Turkey', min: 2000, max: 4000, currency: 'USD' },\n   826→    ],\n   827→    notes: [\n   828→      'Ideal philtrum: 11-13mm for women, 13-15mm for men',\n   829→      'Removes 3-8mm of skin typically',\n   830→      'Scar hidden in nose crease but takes months to mature',\n   831→      'Can look unnatural if overdone',\n   832→    ],\n   833→    sources: ['ASPS', 'RealSelf'],\n   834→  },\n   835→  {\n   836→    id: 'lip_reduction',\n   837→    name: 'Lip Reduction',\n   838→    category: 'surgical',\n   839→    description: 'Surgical reduction of overly large lips',\n   840→    howItWorks: 'Excess tissue removed from inside the lip to reduce size while maintaining natural shape',\n   841→    effectiveness: 8,\n   842→    evidenceLevel: 'moderate',\n   843→    pslImprovement: { min: 0.2, max: 0.5 },\n   844→    costLevel: 'medium',\n   845→    costRange: { min: 2000, max: 5000, currency: 'USD' },\n   846→    costFrequency: 'one-time',\n   847→    timelineToResults: '2-4 weeks for swelling, 3 months final',\n   848→    resultsDuration: 'Permanent',\n   849→    maintenanceRequired: false,\n   850→    recoveryTime: '1-2 weeks',\n   851→    downtime: '3-5 days off work',\n   852→    painLevel: 'low',\n   853→    riskLevel: 'low',\n   854→    sideEffects: ['Swelling', 'Numbness', 'Asymmetry', 'Scarring inside lip'],\n   855→    contraindications: ['Unrealistic expectations'],\n   856→    targetMetrics: ['lip_ratio', 'vermillion_height', 'facial_harmony'],\n   857→    targetIssues: ['overly_large_lips', 'disproportionate_lips', 'lip_asymmetry'],\n   858→    permanence: 'permanent',\n   859→    anesthesiaType: 'local',\n   860→    revisionRate: 0.08,\n   861→    regionalCosts: [\n   862→      { region: 'USA', min: 2500, max: 5000, currency: 'USD' },\n   863→      { region: 'Turkey', min: 1500, max: 3000, currency: 'USD' },\n   864→    ],\n   865→    notes: [\n   866→      'Incision hidden inside lip',\n   867→      'Can be done on upper, lower, or both lips',\n   868→      'Less common than lip augmentation',\n   869→    ],\n   870→    sources: ['ASPS', 'RealSelf'],\n   871→  },\n   872→\n   873→  // ============================================\n   874→  // OTHER FACIAL SURGERIES\n   875→  // ============================================\n   876→  {\n   877→    id: 'buccal_fat_removal',\n   878→    name: 'Buccal Fat Removal',\n   879→    category: 'surgical',\n   880→    description: 'Removal of buccal fat pads to slim the cheeks',\n   881→    howItWorks: 'Fat pads in lower cheeks removed through small intraoral incision',\n   882→    effectiveness: 7,\n   883→    evidenceLevel: 'moderate',\n   884→    pslImprovement: { min: 0.2, max: 0.5 },\n   885→    costLevel: 'medium',\n   886→    costRange: { min: 2500, max: 6000, currency: 'USD' },\n   887→    costFrequency: 'one-time',\n   888→    timelineToResults: '2-4 weeks for swelling, 3-6 months final',\n   889→    resultsDuration: 'Permanent',\n   890→    maintenanceRequired: false,\n   891→    recoveryTime: '1-2 weeks',\n   892→    downtime: '3-5 days off work',\n   893→    painLevel: 'low',\n   894→    riskLevel: 'low',\n   895→    sideEffects: ['Swelling', 'Asymmetry', 'Facial nerve injury (rare)', 'Over-removal leading to gaunt look'],\n   896→    contraindications: ['Thin face', 'Older patients', 'Patients with significant weight fluctuations'],\n   897→    targetMetrics: ['cheek_fullness', 'facial_width', 'jawline_definition'],\n   898→    targetIssues: ['chubby_cheeks', 'round_face', 'undefined_cheekbones'],\n   899→    ageRestrictions: { max: 40 },\n   900→    permanence: 'permanent',\n   901→    anesthesiaType: 'local',\n   902→    revisionRate: 0.05,\n   903→    regionalCosts: [\n   904→      { region: 'USA', min: 3000, max: 6000, currency: 'USD' },\n   905→      { region: 'Turkey', min: 1500, max: 3000, currency: 'USD' },\n   906→      { region: 'Mexico', min: 2000, max: 4000, currency: 'USD' },\n   907→    ],\n   908→    notes: [\n   909→      'Controversial procedure - natural fat loss with age may cause gaunt look',\n   910→      'Best for younger patients with genetically full cheeks',\n   911→      'Face naturally loses fat with age - consider this carefully',\n   912→      'Many celebrities have reportedly regretted this procedure',\n   913→    ],\n   914→    sources: ['ASPS', 'RealSelf'],\n   915→  },\n   916→  {\n   917→    id: 'hair_transplant_fue',\n   918→    name: 'FUE Hair Transplant',\n   919→    category: 'surgical',\n   920→    description: 'Follicular Unit Extraction for permanent hair restoration',\n   921→    howItWorks: 'Individual hair follicles extracted from donor area and transplanted to balding areas',\n   922→    effectiveness: 9,\n   923→    evidenceLevel: 'strong',\n   924→    pslImprovement: { min: 0.3, max: 1.0 },\n   925→    costLevel: 'very_high',\n   926→    costRange: { min: 4000, max: 20000, currency: 'USD' },\n   927→    costFrequency: 'one-time',\n   928→    timelineToResults: '6-12 months for growth, 12-18 months final',\n   929→    resultsDuration: 'Permanent (transplanted hairs)',\n   930→    maintenanceRequired: true,\n   931→    maintenanceFrequency: 'Finasteride/minoxidil to protect native hair',\n   932→    recoveryTime: '1-2 weeks',\n   933→    downtime: '3-7 days off work',\n   934→    painLevel: 'low',\n   935→    riskLevel: 'low',\n   936→    sideEffects: ['Swelling', 'Scabbing', 'Shock loss', 'Scarring in donor area', 'Unnatural appearance if poorly done'],\n   937→    contraindications: ['Insufficient donor hair', 'Unrealistic expectations', 'Active hair loss without stabilization'],\n   938→    targetMetrics: ['hairline', 'hair_density', 'overall_harmony'],\n   939→    targetIssues: ['male_pattern_baldness', 'receding_hairline', 'hair_loss', 'thin_hair'],\n   940→    genderSpecific: 'male',\n   941→    permanence: 'permanent',\n   942→    anesthesiaType: 'local',\n   943→    revisionRate: 0.15,\n   944→    regionalCosts: [\n   945→      { region: 'USA', min: 8000, max: 20000, currency: 'USD' },\n   946→      { region: 'Turkey', min: 2000, max: 5000, currency: 'USD', notes: 'World capital of hair transplants' },\n   947→      { region: 'UK', min: 6000, max: 15000, currency: 'GBP' },\n   948→    ],\n   949→    surgeonRecommendations: [\n   950→      { name: 'Dr. Koray Erdogan', location: 'Istanbul, Turkey', specialty: 'Large graft counts', costRange: '$3,000-6,000' },\n   951→      { name: 'Dr. Rahal', location: 'Ottawa, Canada', specialty: 'Natural hairlines', costRange: '$10,000-20,000' },\n   952→      { name: 'Dr. William Rassman', location: 'Los Angeles, USA', specialty: 'FUE pioneer', costRange: '$8,000-15,000' },\n   953→    ],\n   954→    notes: [\n   955→      'Turkey is the world leader in hair transplants - 500,000+ procedures/year',\n   956→      'Must stabilize hair loss with finasteride first',\n   957→      'Average: 2500-4000 grafts per session',\n   958→      'May need 2+ sessions for full coverage',\n   959→      'Transplanted hairs are DHT-resistant and permanent',\n   960→    ],\n   961→    sources: ['ISHRS', 'RealSelf', 'Tressless community'],\n   962→  },\n   963→  {\n   964→    id: 'otoplasty',\n   965→    name: 'Otoplasty (Ear Pinning)',\n   966→    category: 'surgical',\n   967→    description: 'Reshaping and repositioning of protruding ears',\n   968→    howItWorks: 'Cartilage is reshaped through incisions behind the ear to bring ears closer to head',\n   969→    effectiveness: 9,\n   970→    evidenceLevel: 'strong',\n   971→    pslImprovement: { min: 0.2, max: 0.5 },\n   972→    costLevel: 'medium',\n   973→    costRange: { min: 3000, max: 8000, currency: 'USD' },\n   974→    costFrequency: 'one-time',\n   975→    timelineToResults: '2-4 weeks for swelling, 6 months final',\n   976→    resultsDuration: 'Permanent',\n   977→    maintenanceRequired: false,\n   978→    recoveryTime: '1-2 weeks',\n   979→    downtime: '1 week off work',\n   980→    painLevel: 'low',\n   981→    riskLevel: 'low',\n   982→    sideEffects: ['Swelling', 'Bruising', 'Asymmetry', 'Numbness', 'Overcorrection'],\n   983→    contraindications: ['Unrealistic expectations', 'Blood thinners'],\n   984→    targetMetrics: ['ear_protrusion', 'facial_harmony'],\n   985→    targetIssues: ['protruding_ears', 'ear_asymmetry', 'large_ears'],\n   986→    permanence: 'permanent',\n   987→    anesthesiaType: 'local',\n   988→    revisionRate: 0.05,\n   989→    regionalCosts: [\n   990→      { region: 'USA', min: 4000, max: 8000, currency: 'USD' },\n   991→      { region: 'Turkey', min: 2000, max: 4000, currency: 'USD' },\n   992→      { region: 'UK', min: 3000, max: 6000, currency: 'GBP' },\n   993→    ],\n   994→    notes: [\n   995→      'High satisfaction rate - 95%+',\n   996→      'Incision hidden behind ear',\n   997→      'Headband worn for 6 weeks post-op',\n   998→      'Often performed in childhood but can be done at any age',\n   999→    ],\n  1000→    sources: ['ASPS', 'RealSelf'],\n  1001→  },\n  1002→  {\n  1003→    id: 'fat_transfer_face',\n  1004→    name: 'Facial Fat Transfer (Lipofilling)',\n  1005→    category: 'surgical',\n  1006→    description: 'Transfer of your own fat to restore facial volume',\n  1007→    howItWorks: 'Fat harvested from body via liposuction, processed, and injected into face',\n  1008→    effectiveness: 7,\n  1009→    evidenceLevel: 'strong',\n  1010→    pslImprovement: { min: 0.2, max: 0.6 },\n  1011→    costLevel: 'high',\n  1012→    costRange: { min: 4000, max: 12000, currency: 'USD' },\n  1013→    costFrequency: 'one-time',\n  1014→    timelineToResults: '3-6 months for final volume (some fat absorbed)',\n  1015→    resultsDuration: 'Long-lasting (5-10 years) for surviving fat',\n  1016→    maintenanceRequired: false,\n  1017→    recoveryTime: '1-2 weeks',\n  1018→    downtime: '7-10 days off work',\n  1019→    painLevel: 'moderate',\n  1020→    riskLevel: 'low',\n  1021→    sideEffects: ['Swelling', 'Bruising', 'Asymmetry', 'Fat necrosis', 'Over/under correction'],\n  1022→    contraindications: ['Very low body fat', 'Unrealistic expectations'],\n  1023→    targetMetrics: ['cheek_volume', 'under_eye_hollows', 'overall_harmony'],\n  1024→    targetIssues: ['volume_loss', 'sunken_cheeks', 'under_eye_hollows', 'aging_face', 'thin_face'],\n  1025→    permanence: 'semi-permanent',\n  1026→    anesthesiaType: 'sedation',\n  1027→    revisionRate: 0.20,\n  1028→    regionalCosts: [\n  1029→      { region: 'USA', min: 5000, max: 12000, currency: 'USD' },\n  1030→      { region: 'Turkey', min: 3000, max: 6000, currency: 'USD' },\n  1031→    ],\n  1032→    notes: [\n  1033→      '40-60% of transferred fat survives permanently',\n  1034→      'Natural result using your own tissue',\n  1035→      'May need multiple sessions for optimal result',\n  1036→      'Fat contains stem cells that improve skin quality',\n  1037→    ],\n  1038→    sources: ['ASPS', 'RealSelf'],\n  1039→  },\n  1040→];\n  1041→\n  1042→// Helper functions\n  1043→export function getSurgeryByIssue(issue: string): Surgery[] {\n  1044→  return SURGICAL_TREATMENTS.filter(s =>\n  1045→    s.targetIssues.some(i => i.toLowerCase().includes(issue.toLowerCase()))\n  1046→  );\n  1047→}\n  1048→\n  1049→export function getSurgeryByMetric(metric: string): Surgery[] {\n  1050→  return SURGICAL_TREATMENTS.filter(s =>\n  1051→    s.targetMetrics.some(m => m.toLowerCase().includes(metric.toLowerCase()))\n  1052→  );\n  1053→}\n  1054→\n  1055→export function getSurgeriesByRiskLevel(maxRisk: 'low' | 'medium' | 'high' | 'very_high'): Surgery[] {\n  1056→  const riskOrder = ['none', 'very_low', 'low', 'medium', 'high', 'very_high'];\n  1057→  const maxRiskIndex = riskOrder.indexOf(maxRisk);\n  1058→  return SURGICAL_TREATMENTS.filter(s => riskOrder.indexOf(s.riskLevel) <= maxRiskIndex);\n  1059→}\n  1060→\n  1061→export function getSurgeriesByCostLevel(maxCost: 'low' | 'medium' | 'high' | 'very_high'): Surgery[] {\n  1062→  const costOrder = ['free', 'low', 'medium', 'high', 'very_high'];\n  1063→  const maxCostIndex = costOrder.indexOf(maxCost);\n  1064→  return SURGICAL_TREATMENTS.filter(s => costOrder.indexOf(s.costLevel) <= maxCostIndex);\n  1065→}\n  1066→\n  1067→export function getSurgeriesByRegion(region: string): { surgery: Surgery; cost: RegionalCost }[] {\n  1068→  const results: { surgery: Surgery; cost: RegionalCost }[] = [];\n  1069→  for (const surgery of SURGICAL_TREATMENTS) {\n  1070→    const regionCost = surgery.regionalCosts.find(r =>\n  1071→      r.region.toLowerCase().includes(region.toLowerCase())\n  1072→    );\n  1073→    if (regionCost) {\n  1074→      results.push({ surgery, cost: regionCost });\n  1075→    }\n  1076→  }\n  1077→  return results.sort((a, b) => a.cost.min - b.cost.min);\n  1078→}\n  1079→\n  1080→export function getMostEffectiveSurgeries(minEffectiveness: number = 8): Surgery[] {\n  1081→  return SURGICAL_TREATMENTS\n  1082→    .filter(s => s.effectiveness >= minEffectiveness)\n  1083→    .sort((a, b) => b.pslImprovement.max - a.pslImprovement.max);\n  1084→}\n  1085→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"83f7a74d-90d0-4d31-abd4-5574680b0566","timestamp":"2025-12-20T15:50:16.055Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/hardmaxxing.ts","content":"/**\n * Hardmaxxing Surgery Database\n * Comprehensive database of facial aesthetic surgeries\n */\n\nimport { Surgery, RegionalCost } from './types';\n\nexport const SURGICAL_TREATMENTS: Surgery[] = [\n  // ============================================\n  // RHINOPLASTY (NOSE SURGERIES)\n  // ============================================\n  {\n    id: 'rhinoplasty_reduction',\n    name: 'Reduction Rhinoplasty',\n    category: 'surgical',\n    description: 'Surgical reduction of nose size, hump removal, and tip refinement',\n    howItWorks: 'Surgeon removes bone and cartilage to reduce overall nose size, refine the tip, and straighten the bridge',\n    effectiveness: 9,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.5, max: 1.0 },\n    costLevel: 'very_high',\n    costRange: { min: 5000, max: 15000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: 'Initial results at 2-4 weeks, final results at 12-18 months',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '1-2 weeks for major swelling, full recovery 12-18 months',\n    downtime: '1-2 weeks off work',\n    painLevel: 'moderate',\n    riskLevel: 'medium',\n    sideEffects: ['Swelling', 'Bruising', 'Numbness', 'Breathing changes', 'Asymmetry'],\n    contraindications: ['Unrealistic expectations', 'Active skin infections', 'Bleeding disorders'],\n    targetMetrics: ['nasal_index', 'nasolabial_angle', 'nasofrontal_angle', 'overall_harmony'],\n    targetIssues: ['large_nose', 'dorsal_hump', 'bulbous_tip', 'wide_nose', 'crooked_nose'],\n    permanence: 'permanent',\n    anesthesiaType: 'general',\n    revisionRate: 0.15,\n    regionalCosts: [\n      { region: 'USA', min: 7000, max: 15000, currency: 'USD' },\n      { region: 'Turkey', min: 2500, max: 5000, currency: 'USD', notes: 'Popular medical tourism destination' },\n      { region: 'South Korea', min: 4000, max: 10000, currency: 'USD', notes: 'K-beauty rhinoplasty style' },\n      { region: 'Mexico', min: 3000, max: 6000, currency: 'USD' },\n      { region: 'UK', min: 5000, max: 12000, currency: 'GBP' },\n    ],\n    surgeonRecommendations: [\n      { name: 'Dr. Sam Rizk', location: 'New York, USA', specialty: 'Preservation rhinoplasty', costRange: '$15,000-25,000' },\n      { name: 'Dr. Paul Nassif', location: 'Beverly Hills, USA', specialty: 'Revision rhinoplasty', costRange: '$12,000-30,000' },\n      { name: 'Dr. Amir Keshavarz', location: 'Istanbul, Turkey', specialty: 'Ethnic rhinoplasty', costRange: '$3,000-6,000' },\n    ],\n    notes: [\n      '85% satisfaction rate on RealSelf',\n      'Most requested cosmetic surgery worldwide',\n      'Preservation rhinoplasty has faster recovery but limited to certain nose types',\n      'Ethnic rhinoplasty maintains cultural features while enhancing proportions',\n    ],\n    sources: ['ASPS', 'RealSelf', 'JAMA Facial Plastic Surgery'],\n  },\n  {\n    id: 'rhinoplasty_tip',\n    name: 'Tip Rhinoplasty (Tipplasty)',\n    category: 'surgical',\n    description: 'Focused nasal tip refinement without bridge modification',\n    howItWorks: 'Reshapes tip cartilages through closed or open approach, refining tip projection and rotation',\n    effectiveness: 8,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.3, max: 0.7 },\n    costLevel: 'high',\n    costRange: { min: 3500, max: 8000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '2-4 weeks initial, 6-12 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '1 week for major swelling',\n    downtime: '5-7 days off work',\n    painLevel: 'low',\n    riskLevel: 'low',\n    sideEffects: ['Tip swelling', 'Minor bruising', 'Temporary numbness'],\n    contraindications: ['Bridge concerns', 'Severe tip deformities'],\n    targetMetrics: ['nasolabial_angle', 'tip_projection', 'overall_harmony'],\n    targetIssues: ['bulbous_tip', 'droopy_tip', 'upturned_tip', 'tip_asymmetry'],\n    permanence: 'permanent',\n    anesthesiaType: 'local',\n    revisionRate: 0.10,\n    regionalCosts: [\n      { region: 'USA', min: 4000, max: 8000, currency: 'USD' },\n      { region: 'Turkey', min: 1500, max: 3000, currency: 'USD' },\n      { region: 'South Korea', min: 2500, max: 5000, currency: 'USD' },\n    ],\n    notes: [\n      'Less invasive than full rhinoplasty',\n      'Shorter recovery time',\n      'Can be done under local anesthesia',\n      'Ideal for patients with good bridge but tip concerns',\n    ],\n    sources: ['ASPS', 'RealSelf'],\n  },\n  {\n    id: 'septorhinoplasty',\n    name: 'Septorhinoplasty',\n    category: 'surgical',\n    description: 'Combination of septum repair and cosmetic rhinoplasty',\n    howItWorks: 'Corrects deviated septum while reshaping external nose appearance',\n    effectiveness: 9,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.4, max: 0.9 },\n    costLevel: 'very_high',\n    costRange: { min: 6000, max: 18000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '2-4 weeks initial, 12-18 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '2 weeks for major swelling, full recovery 12-18 months',\n    downtime: '1-2 weeks off work',\n    painLevel: 'moderate',\n    riskLevel: 'medium',\n    sideEffects: ['Swelling', 'Bruising', 'Numbness', 'Septal perforation (rare)'],\n    contraindications: ['Bleeding disorders', 'Active infections'],\n    targetMetrics: ['nasal_index', 'nasolabial_angle', 'overall_harmony'],\n    targetIssues: ['deviated_septum', 'breathing_issues', 'crooked_nose', 'asymmetry'],\n    permanence: 'permanent',\n    anesthesiaType: 'general',\n    revisionRate: 0.12,\n    regionalCosts: [\n      { region: 'USA', min: 7000, max: 18000, currency: 'USD' },\n      { region: 'Turkey', min: 3000, max: 6000, currency: 'USD' },\n    ],\n    notes: [\n      'May be partially covered by insurance if septum is functionally deviated',\n      'Combines functional and aesthetic improvement',\n      'Two-for-one recovery period',\n    ],\n    sources: ['ASPS', 'AAO-HNS'],\n  },\n\n  // ============================================\n  // JAW & CHIN SURGERIES\n  // ============================================\n  {\n    id: 'genioplasty',\n    name: 'Sliding Genioplasty',\n    category: 'surgical',\n    description: 'Chin advancement or setback by cutting and repositioning the chin bone',\n    howItWorks: 'Horizontal osteotomy of the mandible allows the chin segment to be moved forward, backward, up, or down',\n    effectiveness: 9,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.5, max: 1.2 },\n    costLevel: 'very_high',\n    costRange: { min: 5000, max: 15000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '3-6 months for swelling resolution, 12 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '4-6 weeks',\n    downtime: '1-2 weeks off work',\n    painLevel: 'moderate',\n    riskLevel: 'medium',\n    sideEffects: ['Swelling', 'Numbness (temporary to permanent)', 'Asymmetry', 'Bone resorption'],\n    contraindications: ['Active infections', 'Poor bone health', 'Unrealistic expectations'],\n    targetMetrics: ['chin_projection', 'pogonion', 'facial_convexity', 'profile_harmony'],\n    targetIssues: ['recessed_chin', 'weak_chin', 'chin_excess', 'facial_imbalance'],\n    permanence: 'permanent',\n    anesthesiaType: 'general',\n    revisionRate: 0.08,\n    regionalCosts: [\n      { region: 'USA', min: 6000, max: 15000, currency: 'USD' },\n      { region: 'South Korea', min: 4000, max: 8000, currency: 'USD' },\n      { region: 'Turkey', min: 3000, max: 6000, currency: 'USD' },\n    ],\n    surgeonRecommendations: [\n      { name: 'Dr. Barry Eppley', location: 'Indianapolis, USA', specialty: 'Custom facial implants & genioplasty', costRange: '$8,000-15,000' },\n      { name: 'Dr. Yaremchuk', location: 'Boston, USA', specialty: 'Facial skeletal surgery', costRange: '$10,000-20,000' },\n    ],\n    notes: [\n      'More versatile than chin implants (can move in all directions)',\n      'Uses your own bone - no implant rejection risk',\n      '5-10% permanent numbness of lower lip',\n      'Can be combined with jaw surgery for comprehensive lower third correction',\n    ],\n    sources: ['ASPS', 'AAOMS', 'PubMed'],\n  },\n  {\n    id: 'chin_implant',\n    name: 'Chin Implant (Mentoplasty)',\n    category: 'surgical',\n    description: 'Silicone or PEEK implant to augment chin projection',\n    howItWorks: 'Implant placed through intraoral or submental incision, sits on the bone to increase projection',\n    effectiveness: 8,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.4, max: 0.9 },\n    costLevel: 'high',\n    costRange: { min: 3000, max: 8000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '2-4 weeks for swelling, 3 months final',\n    resultsDuration: 'Permanent (may need replacement in 15-20 years)',\n    maintenanceRequired: false,\n    recoveryTime: '1-2 weeks',\n    downtime: '3-7 days off work',\n    painLevel: 'low',\n    riskLevel: 'low',\n    sideEffects: ['Swelling', 'Numbness', 'Implant shifting', 'Bone erosion', 'Infection'],\n    contraindications: ['Active oral infections', 'Unrealistic expectations'],\n    targetMetrics: ['chin_projection', 'profile_harmony'],\n    targetIssues: ['recessed_chin', 'weak_chin', 'short_chin'],\n    permanence: 'permanent',\n    anesthesiaType: 'local',\n    revisionRate: 0.05,\n    regionalCosts: [\n      { region: 'USA', min: 3500, max: 8000, currency: 'USD' },\n      { region: 'Turkey', min: 2000, max: 4000, currency: 'USD' },\n      { region: 'Mexico', min: 2000, max: 4500, currency: 'USD' },\n    ],\n    notes: [\n      'Faster recovery than genioplasty',\n      'Reversible if desired',\n      'Can only add projection, not reduce or move vertically',\n      'Bone erosion occurs in many patients but rarely clinically significant',\n      'PEEK implants more expensive but no erosion',\n    ],\n    sources: ['ASPS', 'RealSelf'],\n  },\n  {\n    id: 'jaw_implants',\n    name: 'Jaw Angle Implants',\n    category: 'surgical',\n    description: 'Implants to widen and define the jaw angles (gonion)',\n    howItWorks: 'Silicone or PEEK implants placed over the mandibular angle to increase width and definition',\n    effectiveness: 9,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.5, max: 1.2 },\n    costLevel: 'very_high',\n    costRange: { min: 7000, max: 20000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '4-8 weeks for swelling, 3-6 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '2-4 weeks',\n    downtime: '1-2 weeks off work',\n    painLevel: 'moderate',\n    riskLevel: 'medium',\n    sideEffects: ['Swelling', 'Numbness', 'Asymmetry', 'Implant shifting', 'Masseter tightness'],\n    contraindications: ['Active infections', 'Very thin soft tissue'],\n    targetMetrics: ['gonial_angle', 'bigonial_width', 'jaw_width_ratio', 'fwhr'],\n    targetIssues: ['narrow_jaw', 'weak_gonial_angle', 'round_face', 'undefined_jawline'],\n    genderSpecific: 'male',\n    permanence: 'permanent',\n    anesthesiaType: 'general',\n    revisionRate: 0.10,\n    regionalCosts: [\n      { region: 'USA', min: 8000, max: 20000, currency: 'USD' },\n      { region: 'South Korea', min: 6000, max: 12000, currency: 'USD' },\n      { region: 'Turkey', min: 4000, max: 8000, currency: 'USD' },\n    ],\n    surgeonRecommendations: [\n      { name: 'Dr. Barry Eppley', location: 'Indianapolis, USA', specialty: 'Custom wrap-around jaw implants', costRange: '$15,000-25,000' },\n      { name: 'Dr. Yaremchuk', location: 'Boston, USA', specialty: 'Facial implants', costRange: '$12,000-20,000' },\n    ],\n    notes: [\n      'Custom implants provide better results than stock',\n      'Often combined with chin implant for comprehensive jawline',\n      'Wrap-around implants cover jaw angle + body + chin',\n      'PEEK implants cost more but no bone erosion',\n    ],\n    sources: ['ASPS', 'RealSelf', 'Dr. Eppley publications'],\n  },\n  {\n    id: 'bsso',\n    name: 'BSSO (Bilateral Sagittal Split Osteotomy)',\n    category: 'surgical',\n    description: 'Mandibular advancement or setback surgery for jaw positioning',\n    howItWorks: 'The mandible is split and repositioned forward or backward, then fixed with titanium plates',\n    effectiveness: 10,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.8, max: 2.0 },\n    costLevel: 'very_high',\n    costRange: { min: 20000, max: 50000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '3-6 months for major swelling, 12-18 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '6-8 weeks liquid/soft diet',\n    downtime: '2-4 weeks off work',\n    painLevel: 'high',\n    riskLevel: 'high',\n    sideEffects: ['Numbness (permanent in 10-15%)', 'Swelling', 'Relapse', 'TMJ issues', 'Malocclusion'],\n    contraindications: ['Poor dental health', 'Bleeding disorders', 'Uncontrolled diabetes'],\n    targetMetrics: ['chin_projection', 'gonial_angle', 'profile_harmony', 'facial_convexity'],\n    targetIssues: ['recessed_mandible', 'prognathic_mandible', 'severe_overbite', 'severe_underbite'],\n    permanence: 'permanent',\n    anesthesiaType: 'general',\n    hospitalStay: '1-2 nights',\n    revisionRate: 0.05,\n    regionalCosts: [\n      { region: 'USA', min: 25000, max: 50000, currency: 'USD' },\n      { region: 'South Korea', min: 15000, max: 25000, currency: 'USD' },\n      { region: 'Germany', min: 20000, max: 40000, currency: 'EUR' },\n    ],\n    notes: [\n      'Usually requires 1-2 years of orthodontics before and after',\n      'May be covered by insurance if medically necessary',\n      'CCW rotation (counter-clockwise) is common in aesthetic cases',\n      'Often combined with Le Fort I for bimax surgery',\n    ],\n    sources: ['AAOMS', 'Journal of Oral and Maxillofacial Surgery'],\n  },\n  {\n    id: 'bimax',\n    name: 'Bimaxillary Osteotomy (Bimax / Double Jaw Surgery)',\n    category: 'surgical',\n    description: 'Combined Le Fort I and BSSO to reposition both jaws',\n    howItWorks: 'Upper jaw (maxilla) and lower jaw (mandible) are both cut and repositioned to optimal positions',\n    effectiveness: 10,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 1.0, max: 2.5 },\n    costLevel: 'very_high',\n    costRange: { min: 30000, max: 80000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '6-12 months for major swelling, 18-24 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '6-8 weeks liquid/soft diet, 6-12 months full recovery',\n    downtime: '4-6 weeks off work',\n    painLevel: 'high',\n    riskLevel: 'high',\n    sideEffects: ['Numbness', 'Swelling', 'Relapse', 'TMJ issues', 'Nerve damage', 'Bleeding'],\n    contraindications: ['Poor general health', 'Bleeding disorders', 'Uncontrolled diabetes', 'Smoking'],\n    targetMetrics: ['facial_convexity', 'profile_harmony', 'midface_ratio', 'overall_harmony'],\n    targetIssues: ['bimaxillary_protrusion', 'facial_asymmetry', 'long_face_syndrome', 'short_face_syndrome', 'severe_malocclusion'],\n    permanence: 'permanent',\n    anesthesiaType: 'general',\n    hospitalStay: '2-3 nights',\n    revisionRate: 0.08,\n    regionalCosts: [\n      { region: 'USA', min: 40000, max: 80000, currency: 'USD' },\n      { region: 'South Korea', min: 20000, max: 35000, currency: 'USD', notes: 'Most popular destination for bimax' },\n      { region: 'Germany', min: 30000, max: 50000, currency: 'EUR' },\n      { region: 'Spain', min: 20000, max: 35000, currency: 'EUR' },\n    ],\n    surgeonRecommendations: [\n      { name: 'Dr. Alfaro', location: 'Barcelona, Spain', specialty: 'Aesthetic jaw surgery', costRange: '€25,000-35,000' },\n      { name: 'Dr. Gunson/Arnett', location: 'Santa Barbara, USA', specialty: 'Orthognathic surgery', costRange: '$60,000-100,000' },\n      { name: 'ID Hospital', location: 'Seoul, South Korea', specialty: 'V-line surgery', costRange: '$20,000-30,000' },\n    ],\n    notes: [\n      'Most transformative facial surgery available',\n      'Requires 12-24 months of orthodontics (braces)',\n      'CCW rotation with maxillary advancement is the aesthetic gold standard',\n      'May be partially covered by insurance if sleep apnea or functional issues',\n      'Korea specializes in aesthetic bimax; Western surgeons often focus on function',\n    ],\n    sources: ['AAOMS', 'Dr. Arnett publications', 'Journal of Craniomaxillofacial Surgery'],\n  },\n  {\n    id: 'mandible_reduction',\n    name: 'Mandible Angle Reduction',\n    category: 'surgical',\n    description: 'Reduction of prominent jaw angles for a slimmer face shape',\n    howItWorks: 'Bone is shaved or cut from the mandibular angle to reduce width and create V-line appearance',\n    effectiveness: 9,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.5, max: 1.0 },\n    costLevel: 'very_high',\n    costRange: { min: 8000, max: 25000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '3-6 months for swelling, 12 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '2-4 weeks',\n    downtime: '1-2 weeks off work',\n    painLevel: 'moderate',\n    riskLevel: 'medium',\n    sideEffects: ['Swelling', 'Numbness', 'Asymmetry', 'Masseter atrophy'],\n    contraindications: ['Bleeding disorders', 'Active infections'],\n    targetMetrics: ['bigonial_width', 'jaw_width_ratio', 'fwhr'],\n    targetIssues: ['wide_jaw', 'square_jaw', 'masculine_jaw'],\n    genderSpecific: 'female',\n    permanence: 'permanent',\n    anesthesiaType: 'general',\n    revisionRate: 0.07,\n    regionalCosts: [\n      { region: 'South Korea', min: 8000, max: 15000, currency: 'USD', notes: 'V-line surgery capital' },\n      { region: 'USA', min: 15000, max: 25000, currency: 'USD' },\n    ],\n    notes: [\n      'Very popular in East Asia for V-line face shape',\n      'Often combined with chin reduction for full V-line',\n      'Can also be achieved with Botox for masseter (non-surgical)',\n      'Long curve osteotomy provides most natural result',\n    ],\n    sources: ['Korean aesthetic surgery journals', 'ASPS'],\n  },\n\n  // ============================================\n  // CHEEK & MIDFACE SURGERIES\n  // ============================================\n  {\n    id: 'cheek_implants',\n    name: 'Cheek Implants (Malar/Submalar)',\n    category: 'surgical',\n    description: 'Silicone or PEEK implants to augment cheekbone projection',\n    howItWorks: 'Implants placed over the malar (cheekbone) or submalar area through intraoral incision',\n    effectiveness: 8,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.4, max: 1.0 },\n    costLevel: 'high',\n    costRange: { min: 4000, max: 12000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '4-8 weeks for swelling, 3-6 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '1-2 weeks',\n    downtime: '1 week off work',\n    painLevel: 'moderate',\n    riskLevel: 'medium',\n    sideEffects: ['Swelling', 'Numbness', 'Asymmetry', 'Implant shifting', 'Bone erosion'],\n    contraindications: ['Very thin soft tissue', 'Active infections'],\n    targetMetrics: ['cheekbone_projection', 'fwhr', 'midface_ratio', 'overall_harmony'],\n    targetIssues: ['flat_cheeks', 'midface_deficiency', 'sunken_cheeks', 'aging_midface'],\n    permanence: 'permanent',\n    anesthesiaType: 'local',\n    revisionRate: 0.08,\n    regionalCosts: [\n      { region: 'USA', min: 5000, max: 12000, currency: 'USD' },\n      { region: 'Turkey', min: 3000, max: 6000, currency: 'USD' },\n      { region: 'South Korea', min: 4000, max: 8000, currency: 'USD' },\n    ],\n    notes: [\n      'Malar implants: on cheekbone for projection',\n      'Submalar implants: below cheekbone for fullness',\n      'Combined malar-submalar for comprehensive midface enhancement',\n      'Custom implants provide best results but cost more',\n    ],\n    sources: ['ASPS', 'RealSelf'],\n  },\n  {\n    id: 'zygoma_reduction',\n    name: 'Zygoma Reduction (Cheekbone Reduction)',\n    category: 'surgical',\n    description: 'Reduction of prominent cheekbones for narrower midface',\n    howItWorks: 'Zygomatic arch is cut and repositioned inward to reduce facial width',\n    effectiveness: 8,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.4, max: 0.9 },\n    costLevel: 'very_high',\n    costRange: { min: 10000, max: 25000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '3-6 months for swelling, 12 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '2-4 weeks',\n    downtime: '2 weeks off work',\n    painLevel: 'moderate',\n    riskLevel: 'medium',\n    sideEffects: ['Swelling', 'Numbness', 'Asymmetry', 'Cheek sagging'],\n    contraindications: ['Bleeding disorders', 'Active infections'],\n    targetMetrics: ['bizygomatic_width', 'fwhr', 'facial_width'],\n    targetIssues: ['wide_cheekbones', 'prominent_zygoma', 'wide_midface'],\n    permanence: 'permanent',\n    anesthesiaType: 'general',\n    revisionRate: 0.06,\n    regionalCosts: [\n      { region: 'South Korea', min: 10000, max: 18000, currency: 'USD' },\n      { region: 'USA', min: 15000, max: 25000, currency: 'USD' },\n    ],\n    notes: [\n      'Popular in East Asia where high cheekbones common',\n      'Risk of cheek sagging if soft tissue not managed',\n      'Often combined with V-line jaw reduction',\n    ],\n    sources: ['Korean aesthetic surgery journals'],\n  },\n  {\n    id: 'lefort_1',\n    name: 'Le Fort I Osteotomy (Maxillary Advancement)',\n    category: 'surgical',\n    description: 'Repositioning of the upper jaw (maxilla)',\n    howItWorks: 'Maxilla is cut and moved forward, backward, up, or down, then fixed with titanium plates',\n    effectiveness: 9,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.6, max: 1.5 },\n    costLevel: 'very_high',\n    costRange: { min: 20000, max: 45000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '3-6 months for swelling, 12-18 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '4-6 weeks',\n    downtime: '2-4 weeks off work',\n    painLevel: 'moderate',\n    riskLevel: 'medium',\n    sideEffects: ['Swelling', 'Numbness', 'Relapse', 'Bleeding', 'Deviated septum'],\n    contraindications: ['Poor dental health', 'Bleeding disorders'],\n    targetMetrics: ['midface_projection', 'nasolabial_angle', 'upper_lip_support', 'facial_convexity'],\n    targetIssues: ['recessed_maxilla', 'midface_deficiency', 'long_face', 'short_face', 'gummy_smile'],\n    permanence: 'permanent',\n    anesthesiaType: 'general',\n    hospitalStay: '1-2 nights',\n    revisionRate: 0.06,\n    regionalCosts: [\n      { region: 'USA', min: 25000, max: 45000, currency: 'USD' },\n      { region: 'South Korea', min: 12000, max: 20000, currency: 'USD' },\n      { region: 'Spain', min: 15000, max: 25000, currency: 'EUR' },\n    ],\n    notes: [\n      'Often combined with BSSO for bimax surgery',\n      'Can correct gummy smile by impacting maxilla upward',\n      'May improve nasal breathing',\n      'Usually requires orthodontics before and after',\n    ],\n    sources: ['AAOMS', 'Journal of Oral and Maxillofacial Surgery'],\n  },\n\n  // ============================================\n  // EYE SURGERIES\n  // ============================================\n  {\n    id: 'canthoplasty',\n    name: 'Canthoplasty (Lateral Canthopexy)',\n    category: 'surgical',\n    description: 'Surgical repositioning of the outer corner of the eye',\n    howItWorks: 'Lateral canthal tendon is released and reattached at a higher position to lift eye corner',\n    effectiveness: 8,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.3, max: 0.7 },\n    costLevel: 'high',\n    costRange: { min: 4000, max: 12000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '2-4 weeks for swelling, 3-6 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '2-3 weeks',\n    downtime: '1-2 weeks off work',\n    painLevel: 'low',\n    riskLevel: 'medium',\n    sideEffects: ['Swelling', 'Bruising', 'Asymmetry', 'Dry eyes', 'Ectropion (eyelid turning out)'],\n    contraindications: ['Dry eye syndrome', 'Previous eyelid surgery', 'Unrealistic expectations'],\n    targetMetrics: ['canthal_tilt', 'palpebral_fissure', 'eye_area'],\n    targetIssues: ['negative_canthal_tilt', 'droopy_eyes', 'sad_eyes', 'aging_eyes'],\n    permanence: 'permanent',\n    anesthesiaType: 'local',\n    revisionRate: 0.12,\n    regionalCosts: [\n      { region: 'USA', min: 5000, max: 12000, currency: 'USD' },\n      { region: 'South Korea', min: 3000, max: 6000, currency: 'USD' },\n      { region: 'Turkey', min: 2500, max: 5000, currency: 'USD' },\n    ],\n    surgeonRecommendations: [\n      { name: 'Dr. Taban', location: 'Los Angeles, USA', specialty: 'Oculoplastic surgery', costRange: '$8,000-15,000' },\n    ],\n    notes: [\n      'High satisfaction but also higher revision rate',\n      'Fox eye look is a more aggressive version',\n      'Conservative approach recommended to avoid unnatural look',\n      'Thread canthoplasty is less invasive but temporary',\n    ],\n    sources: ['ASOPRS', 'RealSelf'],\n  },\n  {\n    id: 'upper_blepharoplasty',\n    name: 'Upper Blepharoplasty (Eyelid Surgery)',\n    category: 'surgical',\n    description: 'Removal of excess skin and fat from upper eyelids',\n    howItWorks: 'Excess skin, muscle, and fat are removed through incision hidden in eyelid crease',\n    effectiveness: 8,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.2, max: 0.6 },\n    costLevel: 'medium',\n    costRange: { min: 2500, max: 7000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '2-4 weeks for swelling, 3 months final',\n    resultsDuration: 'Long-lasting (10-15 years)',\n    maintenanceRequired: false,\n    recoveryTime: '1-2 weeks',\n    downtime: '5-7 days off work',\n    painLevel: 'low',\n    riskLevel: 'low',\n    sideEffects: ['Swelling', 'Bruising', 'Dry eyes', 'Asymmetry', 'Scarring'],\n    contraindications: ['Dry eye syndrome', 'Glaucoma', 'Thyroid eye disease'],\n    targetMetrics: ['upper_eyelid_exposure', 'palpebral_fissure', 'eye_area'],\n    targetIssues: ['hooded_eyelids', 'excess_eyelid_skin', 'aging_eyes', 'tired_appearance'],\n    permanence: 'semi-permanent',\n    anesthesiaType: 'local',\n    revisionRate: 0.05,\n    regionalCosts: [\n      { region: 'USA', min: 3000, max: 7000, currency: 'USD' },\n      { region: 'Turkey', min: 1500, max: 3000, currency: 'USD' },\n      { region: 'South Korea', min: 2000, max: 4000, currency: 'USD' },\n    ],\n    notes: [\n      'One of the most common facial surgeries',\n      'May be covered by insurance if obstructing vision',\n      'Hidden incision in natural crease',\n      'Double eyelid surgery (Asian blepharoplasty) is different procedure',\n    ],\n    sources: ['ASPS', 'RealSelf'],\n  },\n  {\n    id: 'lower_blepharoplasty',\n    name: 'Lower Blepharoplasty',\n    category: 'surgical',\n    description: 'Treatment of under-eye bags and excess skin',\n    howItWorks: 'Fat is repositioned or removed, and excess skin removed through incision below lash line or inside eyelid',\n    effectiveness: 8,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.2, max: 0.5 },\n    costLevel: 'high',\n    costRange: { min: 4000, max: 10000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '2-4 weeks for swelling, 3-6 months final',\n    resultsDuration: 'Long-lasting (10-15 years)',\n    maintenanceRequired: false,\n    recoveryTime: '2 weeks',\n    downtime: '7-10 days off work',\n    painLevel: 'low',\n    riskLevel: 'low',\n    sideEffects: ['Swelling', 'Bruising', 'Dry eyes', 'Ectropion', 'Hollowing'],\n    contraindications: ['Dry eye syndrome', 'Thyroid disorders'],\n    targetMetrics: ['infraorbital_area', 'tear_trough', 'eye_area'],\n    targetIssues: ['eye_bags', 'dark_circles', 'excess_lower_lid_skin', 'aging_eyes'],\n    permanence: 'semi-permanent',\n    anesthesiaType: 'local',\n    revisionRate: 0.08,\n    regionalCosts: [\n      { region: 'USA', min: 5000, max: 10000, currency: 'USD' },\n      { region: 'Turkey', min: 2000, max: 4000, currency: 'USD' },\n      { region: 'South Korea', min: 2500, max: 5000, currency: 'USD' },\n    ],\n    notes: [\n      'Transconjunctival approach (inside eyelid) leaves no visible scar',\n      'Fat repositioning preferred over removal to avoid hollow look',\n      'Often combined with fat transfer for best results',\n    ],\n    sources: ['ASPS', 'RealSelf'],\n  },\n  {\n    id: 'orbital_decompression',\n    name: 'Orbital Rim Implants',\n    category: 'surgical',\n    description: 'Implants to augment the bony rim around the eye',\n    howItWorks: 'Custom implants placed along infraorbital or supraorbital rim to improve eye support',\n    effectiveness: 8,\n    evidenceLevel: 'moderate',\n    pslImprovement: { min: 0.4, max: 0.8 },\n    costLevel: 'very_high',\n    costRange: { min: 10000, max: 25000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '4-8 weeks for swelling, 6 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '2-4 weeks',\n    downtime: '1-2 weeks off work',\n    painLevel: 'moderate',\n    riskLevel: 'medium',\n    sideEffects: ['Swelling', 'Numbness', 'Implant visibility', 'Asymmetry'],\n    contraindications: ['Thyroid eye disease', 'Very thin skin'],\n    targetMetrics: ['infraorbital_rim', 'upper_eyelid_support', 'eye_area'],\n    targetIssues: ['negative_orbital_vector', 'under_eye_hollows', 'prominent_eyes', 'aging_midface'],\n    permanence: 'permanent',\n    anesthesiaType: 'general',\n    revisionRate: 0.10,\n    regionalCosts: [\n      { region: 'USA', min: 12000, max: 25000, currency: 'USD' },\n    ],\n    surgeonRecommendations: [\n      { name: 'Dr. Barry Eppley', location: 'Indianapolis, USA', specialty: 'Custom facial implants', costRange: '$15,000-25,000' },\n    ],\n    notes: [\n      'Custom implants designed from CT scan',\n      'Can dramatically change eye appearance',\n      'Often combined with other facial implants',\n    ],\n    sources: ['Dr. Eppley publications'],\n  },\n\n  // ============================================\n  // FOREHEAD & BROW SURGERIES\n  // ============================================\n  {\n    id: 'brow_lift',\n    name: 'Endoscopic Brow Lift',\n    category: 'surgical',\n    description: 'Lifting of the eyebrows through minimally invasive technique',\n    howItWorks: 'Small incisions in hairline allow endoscopic repositioning of brow tissue',\n    effectiveness: 8,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.2, max: 0.5 },\n    costLevel: 'high',\n    costRange: { min: 5000, max: 12000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '2-4 weeks for swelling, 3-6 months final',\n    resultsDuration: 'Long-lasting (7-10 years)',\n    maintenanceRequired: false,\n    recoveryTime: '1-2 weeks',\n    downtime: '7-10 days off work',\n    painLevel: 'moderate',\n    riskLevel: 'low',\n    sideEffects: ['Swelling', 'Numbness', 'Hair loss at incisions', 'Asymmetry'],\n    contraindications: ['Very high hairline', 'Male pattern baldness'],\n    targetMetrics: ['brow_position', 'upper_eyelid_exposure', 'eye_area'],\n    targetIssues: ['low_brows', 'brow_ptosis', 'forehead_wrinkles', 'hooded_eyes_from_brow'],\n    permanence: 'semi-permanent',\n    anesthesiaType: 'sedation',\n    revisionRate: 0.08,\n    regionalCosts: [\n      { region: 'USA', min: 6000, max: 12000, currency: 'USD' },\n      { region: 'Turkey', min: 3000, max: 6000, currency: 'USD' },\n    ],\n    notes: [\n      'Less invasive than coronal brow lift',\n      'Shorter recovery than traditional methods',\n      'Can be combined with upper blepharoplasty',\n      'Results last 7-10 years on average',\n    ],\n    sources: ['ASPS', 'RealSelf'],\n  },\n  {\n    id: 'forehead_reduction',\n    name: 'Forehead Reduction (Hairline Lowering)',\n    category: 'surgical',\n    description: 'Surgical lowering of the hairline by removing forehead skin',\n    howItWorks: 'Scalp is advanced forward and excess forehead skin is removed',\n    effectiveness: 9,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.3, max: 0.7 },\n    costLevel: 'high',\n    costRange: { min: 7000, max: 15000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '4-8 weeks for swelling, 6-12 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '1-2 weeks',\n    downtime: '7-10 days off work',\n    painLevel: 'moderate',\n    riskLevel: 'low',\n    sideEffects: ['Swelling', 'Numbness', 'Visible scar', 'Hair shock loss'],\n    contraindications: ['Male pattern baldness', 'Very tight scalp'],\n    targetMetrics: ['facial_thirds', 'forehead_height', 'upper_third'],\n    targetIssues: ['large_forehead', 'high_hairline', 'long_upper_third'],\n    permanence: 'permanent',\n    anesthesiaType: 'sedation',\n    revisionRate: 0.05,\n    regionalCosts: [\n      { region: 'USA', min: 8000, max: 15000, currency: 'USD' },\n      { region: 'Turkey', min: 4000, max: 8000, currency: 'USD' },\n    ],\n    notes: [\n      'Can lower hairline 2-5 cm depending on scalp laxity',\n      'Scar hidden at hairline but visible in some cases',\n      'Often combined with hair transplant for feathering',\n      'Alternative: hair transplant to lower hairline',\n    ],\n    sources: ['ASPS', 'RealSelf'],\n  },\n  {\n    id: 'forehead_implant',\n    name: 'Forehead/Brow Bone Implant',\n    category: 'surgical',\n    description: 'Custom implant to augment forehead shape or brow bone',\n    howItWorks: 'PEEK or silicone implant placed to add projection to forehead or brow ridge',\n    effectiveness: 8,\n    evidenceLevel: 'moderate',\n    pslImprovement: { min: 0.3, max: 0.6 },\n    costLevel: 'very_high',\n    costRange: { min: 10000, max: 25000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '4-8 weeks for swelling, 6 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '2-3 weeks',\n    downtime: '1-2 weeks off work',\n    painLevel: 'moderate',\n    riskLevel: 'medium',\n    sideEffects: ['Swelling', 'Numbness', 'Implant visibility', 'Infection'],\n    contraindications: ['Very thin skin', 'Unrealistic expectations'],\n    targetMetrics: ['brow_ridge', 'forehead_projection', 'facial_convexity'],\n    targetIssues: ['flat_forehead', 'weak_brow_ridge', 'feminine_forehead'],\n    genderSpecific: 'male',\n    permanence: 'permanent',\n    anesthesiaType: 'general',\n    revisionRate: 0.08,\n    regionalCosts: [\n      { region: 'USA', min: 12000, max: 25000, currency: 'USD' },\n    ],\n    surgeonRecommendations: [\n      { name: 'Dr. Barry Eppley', location: 'Indianapolis, USA', specialty: 'Custom facial implants', costRange: '$15,000-25,000' },\n    ],\n    notes: [\n      'Custom implants designed from CT scan',\n      'Can create more masculine brow ridge',\n      'FFS (facial feminization) does the opposite - reduces brow bone',\n    ],\n    sources: ['Dr. Eppley publications'],\n  },\n\n  // ============================================\n  // LIP SURGERIES\n  // ============================================\n  {\n    id: 'lip_lift',\n    name: 'Lip Lift (Bullhorn Lip Lift)',\n    category: 'surgical',\n    description: 'Shortening of the philtrum to increase upper lip show',\n    howItWorks: 'Skin removed from under the nose, pulling the upper lip upward and creating more vermillion show',\n    effectiveness: 8,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.2, max: 0.5 },\n    costLevel: 'high',\n    costRange: { min: 3500, max: 8000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '2-4 weeks for swelling, 3-6 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '1-2 weeks',\n    downtime: '5-7 days off work',\n    painLevel: 'low',\n    riskLevel: 'low',\n    sideEffects: ['Swelling', 'Numbness', 'Visible scar', 'Over-correction'],\n    contraindications: ['Already short philtrum', 'Dark skin (scarring risk)'],\n    targetMetrics: ['philtrum_length', 'upper_lip_ratio', 'vermillion_show'],\n    targetIssues: ['long_philtrum', 'thin_upper_lip', 'aging_lips', 'hidden_vermillion'],\n    permanence: 'permanent',\n    anesthesiaType: 'local',\n    revisionRate: 0.10,\n    regionalCosts: [\n      { region: 'USA', min: 4000, max: 8000, currency: 'USD' },\n      { region: 'Turkey', min: 2000, max: 4000, currency: 'USD' },\n    ],\n    notes: [\n      'Ideal philtrum: 11-13mm for women, 13-15mm for men',\n      'Removes 3-8mm of skin typically',\n      'Scar hidden in nose crease but takes months to mature',\n      'Can look unnatural if overdone',\n    ],\n    sources: ['ASPS', 'RealSelf'],\n  },\n  {\n    id: 'lip_reduction',\n    name: 'Lip Reduction',\n    category: 'surgical',\n    description: 'Surgical reduction of overly large lips',\n    howItWorks: 'Excess tissue removed from inside the lip to reduce size while maintaining natural shape',\n    effectiveness: 8,\n    evidenceLevel: 'moderate',\n    pslImprovement: { min: 0.2, max: 0.5 },\n    costLevel: 'medium',\n    costRange: { min: 2000, max: 5000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '2-4 weeks for swelling, 3 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '1-2 weeks',\n    downtime: '3-5 days off work',\n    painLevel: 'low',\n    riskLevel: 'low',\n    sideEffects: ['Swelling', 'Numbness', 'Asymmetry', 'Scarring inside lip'],\n    contraindications: ['Unrealistic expectations'],\n    targetMetrics: ['lip_ratio', 'vermillion_height', 'facial_harmony'],\n    targetIssues: ['overly_large_lips', 'disproportionate_lips', 'lip_asymmetry'],\n    permanence: 'permanent',\n    anesthesiaType: 'local',\n    revisionRate: 0.08,\n    regionalCosts: [\n      { region: 'USA', min: 2500, max: 5000, currency: 'USD' },\n      { region: 'Turkey', min: 1500, max: 3000, currency: 'USD' },\n    ],\n    notes: [\n      'Incision hidden inside lip',\n      'Can be done on upper, lower, or both lips',\n      'Less common than lip augmentation',\n    ],\n    sources: ['ASPS', 'RealSelf'],\n  },\n\n  // ============================================\n  // OTHER FACIAL SURGERIES\n  // ============================================\n  {\n    id: 'buccal_fat_removal',\n    name: 'Buccal Fat Removal',\n    category: 'surgical',\n    description: 'Removal of buccal fat pads to slim the cheeks',\n    howItWorks: 'Fat pads in lower cheeks removed through small intraoral incision',\n    effectiveness: 7,\n    evidenceLevel: 'moderate',\n    pslImprovement: { min: 0.2, max: 0.5 },\n    costLevel: 'medium',\n    costRange: { min: 2500, max: 6000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '2-4 weeks for swelling, 3-6 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '1-2 weeks',\n    downtime: '3-5 days off work',\n    painLevel: 'low',\n    riskLevel: 'low',\n    sideEffects: ['Swelling', 'Asymmetry', 'Facial nerve injury (rare)', 'Over-removal leading to gaunt look'],\n    contraindications: ['Thin face', 'Older patients', 'Patients with significant weight fluctuations'],\n    targetMetrics: ['cheek_fullness', 'facial_width', 'jawline_definition'],\n    targetIssues: ['chubby_cheeks', 'round_face', 'undefined_cheekbones'],\n    ageRestrictions: { max: 40 },\n    permanence: 'permanent',\n    anesthesiaType: 'local',\n    revisionRate: 0.05,\n    regionalCosts: [\n      { region: 'USA', min: 3000, max: 6000, currency: 'USD' },\n      { region: 'Turkey', min: 1500, max: 3000, currency: 'USD' },\n      { region: 'Mexico', min: 2000, max: 4000, currency: 'USD' },\n    ],\n    notes: [\n      'Controversial procedure - natural fat loss with age may cause gaunt look',\n      'Best for younger patients with genetically full cheeks',\n      'Face naturally loses fat with age - consider this carefully',\n      'Many celebrities have reportedly regretted this procedure',\n    ],\n    sources: ['ASPS', 'RealSelf'],\n  },\n  {\n    id: 'hair_transplant_fue',\n    name: 'FUE Hair Transplant',\n    category: 'surgical',\n    description: 'Follicular Unit Extraction for permanent hair restoration',\n    howItWorks: 'Individual hair follicles extracted from donor area and transplanted to balding areas',\n    effectiveness: 9,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.3, max: 1.0 },\n    costLevel: 'very_high',\n    costRange: { min: 4000, max: 20000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '6-12 months for growth, 12-18 months final',\n    resultsDuration: 'Permanent (transplanted hairs)',\n    maintenanceRequired: true,\n    maintenanceFrequency: 'Finasteride/minoxidil to protect native hair',\n    recoveryTime: '1-2 weeks',\n    downtime: '3-7 days off work',\n    painLevel: 'low',\n    riskLevel: 'low',\n    sideEffects: ['Swelling', 'Scabbing', 'Shock loss', 'Scarring in donor area', 'Unnatural appearance if poorly done'],\n    contraindications: ['Insufficient donor hair', 'Unrealistic expectations', 'Active hair loss without stabilization'],\n    targetMetrics: ['hairline', 'hair_density', 'overall_harmony'],\n    targetIssues: ['male_pattern_baldness', 'receding_hairline', 'hair_loss', 'thin_hair'],\n    genderSpecific: 'male',\n    permanence: 'permanent',\n    anesthesiaType: 'local',\n    revisionRate: 0.15,\n    regionalCosts: [\n      { region: 'USA', min: 8000, max: 20000, currency: 'USD' },\n      { region: 'Turkey', min: 2000, max: 5000, currency: 'USD', notes: 'World capital of hair transplants' },\n      { region: 'UK', min: 6000, max: 15000, currency: 'GBP' },\n    ],\n    surgeonRecommendations: [\n      { name: 'Dr. Koray Erdogan', location: 'Istanbul, Turkey', specialty: 'Large graft counts', costRange: '$3,000-6,000' },\n      { name: 'Dr. Rahal', location: 'Ottawa, Canada', specialty: 'Natural hairlines', costRange: '$10,000-20,000' },\n      { name: 'Dr. William Rassman', location: 'Los Angeles, USA', specialty: 'FUE pioneer', costRange: '$8,000-15,000' },\n    ],\n    notes: [\n      'Turkey is the world leader in hair transplants - 500,000+ procedures/year',\n      'Must stabilize hair loss with finasteride first',\n      'Average: 2500-4000 grafts per session',\n      'May need 2+ sessions for full coverage',\n      'Transplanted hairs are DHT-resistant and permanent',\n    ],\n    sources: ['ISHRS', 'RealSelf', 'Tressless community'],\n  },\n  {\n    id: 'otoplasty',\n    name: 'Otoplasty (Ear Pinning)',\n    category: 'surgical',\n    description: 'Reshaping and repositioning of protruding ears',\n    howItWorks: 'Cartilage is reshaped through incisions behind the ear to bring ears closer to head',\n    effectiveness: 9,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.2, max: 0.5 },\n    costLevel: 'medium',\n    costRange: { min: 3000, max: 8000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '2-4 weeks for swelling, 6 months final',\n    resultsDuration: 'Permanent',\n    maintenanceRequired: false,\n    recoveryTime: '1-2 weeks',\n    downtime: '1 week off work',\n    painLevel: 'low',\n    riskLevel: 'low',\n    sideEffects: ['Swelling', 'Bruising', 'Asymmetry', 'Numbness', 'Overcorrection'],\n    contraindications: ['Unrealistic expectations', 'Blood thinners'],\n    targetMetrics: ['ear_protrusion', 'facial_harmony'],\n    targetIssues: ['protruding_ears', 'ear_asymmetry', 'large_ears'],\n    permanence: 'permanent',\n    anesthesiaType: 'local',\n    revisionRate: 0.05,\n    regionalCosts: [\n      { region: 'USA', min: 4000, max: 8000, currency: 'USD' },\n      { region: 'Turkey', min: 2000, max: 4000, currency: 'USD' },\n      { region: 'UK', min: 3000, max: 6000, currency: 'GBP' },\n    ],\n    notes: [\n      'High satisfaction rate - 95%+',\n      'Incision hidden behind ear',\n      'Headband worn for 6 weeks post-op',\n      'Often performed in childhood but can be done at any age',\n    ],\n    sources: ['ASPS', 'RealSelf'],\n  },\n  {\n    id: 'fat_transfer_face',\n    name: 'Facial Fat Transfer (Lipofilling)',\n    category: 'surgical',\n    description: 'Transfer of your own fat to restore facial volume',\n    howItWorks: 'Fat harvested from body via liposuction, processed, and injected into face',\n    effectiveness: 7,\n    evidenceLevel: 'strong',\n    pslImprovement: { min: 0.2, max: 0.6 },\n    costLevel: 'high',\n    costRange: { min: 4000, max: 12000, currency: 'USD' },\n    costFrequency: 'one-time',\n    timelineToResults: '3-6 months for final volume (some fat absorbed)',\n    resultsDuration: 'Long-lasting (5-10 years) for surviving fat',\n    maintenanceRequired: false,\n    recoveryTime: '1-2 weeks',\n    downtime: '7-10 days off work',\n    painLevel: 'moderate',\n    riskLevel: 'low',\n    sideEffects: ['Swelling', 'Bruising', 'Asymmetry', 'Fat necrosis', 'Over/under correction'],\n    contraindications: ['Very low body fat', 'Unrealistic expectations'],\n    targetMetrics: ['cheek_volume', 'under_eye_hollows', 'overall_harmony'],\n    targetIssues: ['volume_loss', 'sunken_cheeks', 'under_eye_hollows', 'aging_face', 'thin_face'],\n    permanence: 'semi-permanent',\n    anesthesiaType: 'sedation',\n    revisionRate: 0.20,\n    regionalCosts: [\n      { region: 'USA', min: 5000, max: 12000, currency: 'USD' },\n      { region: 'Turkey', min: 3000, max: 6000, currency: 'USD' },\n    ],\n    notes: [\n      '40-60% of transferred fat survives permanently',\n      'Natural result using your own tissue',\n      'May need multiple sessions for optimal result',\n      'Fat contains stem cells that improve skin quality',\n    ],\n    sources: ['ASPS', 'RealSelf'],\n  },\n];\n\n// Helper functions\nexport function getSurgeryByIssue(issue: string): Surgery[] {\n  return SURGICAL_TREATMENTS.filter(s =>\n    s.targetIssues.some(i => i.toLowerCase().includes(issue.toLowerCase()))\n  );\n}\n\nexport function getSurgeryByMetric(metric: string): Surgery[] {\n  return SURGICAL_TREATMENTS.filter(s =>\n    s.targetMetrics.some(m => m.toLowerCase().includes(metric.toLowerCase()))\n  );\n}\n\nexport function getSurgeriesByRiskLevel(maxRisk: 'low' | 'medium' | 'high' | 'very_high'): Surgery[] {\n  const riskOrder = ['none', 'very_low', 'low', 'medium', 'high', 'very_high'];\n  const maxRiskIndex = riskOrder.indexOf(maxRisk);\n  return SURGICAL_TREATMENTS.filter(s => riskOrder.indexOf(s.riskLevel) <= maxRiskIndex);\n}\n\nexport function getSurgeriesByCostLevel(maxCost: 'low' | 'medium' | 'high' | 'very_high'): Surgery[] {\n  const costOrder = ['free', 'low', 'medium', 'high', 'very_high'];\n  const maxCostIndex = costOrder.indexOf(maxCost);\n  return SURGICAL_TREATMENTS.filter(s => costOrder.indexOf(s.costLevel) <= maxCostIndex);\n}\n\nexport function getSurgeriesByRegion(region: string): { surgery: Surgery; cost: RegionalCost }[] {\n  const results: { surgery: Surgery; cost: RegionalCost }[] = [];\n  for (const surgery of SURGICAL_TREATMENTS) {\n    const regionCost = surgery.regionalCosts.find(r =>\n      r.region.toLowerCase().includes(region.toLowerCase())\n    );\n    if (regionCost) {\n      results.push({ surgery, cost: regionCost });\n    }\n  }\n  return results.sort((a, b) => a.cost.min - b.cost.min);\n}\n\nexport function getMostEffectiveSurgeries(minEffectiveness: number = 8): Surgery[] {\n  return SURGICAL_TREATMENTS\n    .filter(s => s.effectiveness >= minEffectiveness)\n    .sort((a, b) => b.pslImprovement.max - a.pslImprovement.max);\n}\n","numLines":1085,"startLine":1,"totalLines":1085}}}
{"parentUuid":"83f7a74d-90d0-4d31-abd4-5574680b0566","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GD3tvKQVBKLt4LyLzwZryv","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useState, useRef, useCallback, useEffect } from 'react';\n     4→import Image from 'next/image';\n     5→import { motion } from 'framer-motion';\n     6→import {\n     7→  ChevronLeft,\n     8→  ChevronRight,\n     9→  ChevronUp,\n    10→  ChevronDown,\n    11→  Check,\n    12→  Info,\n    13→  Scan,\n    14→  Loader2,\n    15→  Move,\n    16→  Focus,\n    17→  AlertTriangle,\n    18→  X,\n    19→} from 'lucide-react';\n    20→import {\n    21→  LandmarkPoint,\n    22→  FRONT_PROFILE_LANDMARKS,\n    23→  SIDE_PROFILE_LANDMARKS,\n    24→  getLandmarkColor,\n    25→  FRONT_LANDMARK_CATEGORIES,\n    26→  SIDE_LANDMARK_CATEGORIES,\n    27→} from '@/lib/landmarks';\n    28→import { getLandmarkImagePath, getLandmarkPlacementGuide } from '@/lib/landmarkImages';\n    29→import { detectFromImageUrl } from '@/lib/mediapipeDetection';\n    30→\n    31→interface LandmarkAnalysisToolProps {\n    32→  imageUrl: string;\n    33→  mode: 'front' | 'side';\n    34→  initialLandmarks?: LandmarkPoint[];\n    35→  onLandmarksChange?: (landmarks: LandmarkPoint[]) => void;\n    36→  onComplete?: (landmarks: LandmarkPoint[]) => void;\n    37→  onBack?: () => void;\n    38→}\n    39→\n    40→function getOrderedLandmarks(mode: 'front' | 'side'): string[] {\n    41→  const landmarks = mode === 'front' ? FRONT_PROFILE_LANDMARKS : SIDE_PROFILE_LANDMARKS;\n    42→  return landmarks.map(lm => lm.id);\n    43→}\n    44→\n    45→export function LandmarkAnalysisTool({\n    46→  imageUrl,\n    47→  mode,\n    48→  initialLandmarks,\n    49→  onLandmarksChange,\n    50→  onComplete,\n    51→  onBack,\n    52→}: LandmarkAnalysisToolProps) {\n    53→  const containerRef = useRef<HTMLDivElement>(null);\n    54→  const [imageDimensions, setImageDimensions] = useState<{ width: number; height: number } | null>(null);\n    55→  const [containerSize, setContainerSize] = useState<{ width: number; height: number } | null>(null);\n    56→  const defaultLandmarks = mode === 'front' ? FRONT_PROFILE_LANDMARKS : SIDE_PROFILE_LANDMARKS;\n    57→  const categories = mode === 'front' ? FRONT_LANDMARK_CATEGORIES : SIDE_LANDMARK_CATEGORIES;\n    58→  const orderedIds = getOrderedLandmarks(mode);\n    59→\n    60→  const [landmarks, setLandmarks] = useState<LandmarkPoint[]>(\n    61→    initialLandmarks || defaultLandmarks\n    62→  );\n    63→  const [currentStepIndex, setCurrentStepIndex] = useState(0);\n    64→  const [zoomLevel, setZoomLevel] = useState(2.5); // Start zoomed in for precision\n    65→\n    66→  // Reset state when mode changes (fixes side profile starting at step 52)\n    67→  useEffect(() => {\n    68→    const newLandmarks = mode === 'front' ? FRONT_PROFILE_LANDMARKS : SIDE_PROFILE_LANDMARKS;\n    69→    setCurrentStepIndex(0);\n    70→    setPlacedLandmarks(new Set());\n    71→    setHasAutoDetected(false);\n    72→    setDetectionFailed(false);\n    73→    setLandmarks(newLandmarks);\n    74→    setPan({ x: 0, y: 0 });\n    75→    setZoomLevel(2.5);\n    76→  }, [mode]);\n    77→  const [pan, setPan] = useState({ x: 0, y: 0 });\n    78→  const [isDragging, setIsDragging] = useState(false);\n    79→  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\n    80→  const [pressedKeys, setPressedKeys] = useState<Set<string>>(new Set());\n    81→  const [activeTab, setActiveTab] = useState<'info' | 'reference'>('info');\n    82→  const [isDetecting, setIsDetecting] = useState(true);\n    83→  const [hasAutoDetected, setHasAutoDetected] = useState(false);\n    84→  const [autoZoomEnabled, setAutoZoomEnabled] = useState(true);\n    85→  const [detectionFailed, setDetectionFailed] = useState(false);\n    86→  const [placedLandmarks, setPlacedLandmarks] = useState<Set<string>>(new Set());\n    87→  // Frankfort Plane for side profile visualization (from server detection)\n    88→  const [frankfortPlane, setFrankfortPlane] = useState<{\n    89→    angle: number;\n    90→    orbitale: { x: number; y: number };\n    91→    porion: { x: number; y: number };\n    92→  } | null>(null);\n    93→\n    94→  const currentLandmarkId = orderedIds[currentStepIndex];\n    95→  const currentLandmark = landmarks.find((lm) => lm.id === currentLandmarkId);\n    96→  const totalSteps = orderedIds.length;\n    97→  const progress = ((currentStepIndex + 1) / totalSteps) * 100;\n    98→\n    99→  const color = currentLandmark\n   100→    ? getLandmarkColor(currentLandmark.id, categories)\n   101→    : '#00f3ff';\n   102→\n   103→  // Load image dimensions on mount\n   104→  useEffect(() => {\n   105→    const img = new window.Image();\n   106→    img.onload = () => {\n   107→      setImageDimensions({ width: img.naturalWidth, height: img.naturalHeight });\n   108→    };\n   109→    img.src = imageUrl;\n   110→  }, [imageUrl]);\n   111→\n   112→  // Track container size changes with ResizeObserver\n   113→  useEffect(() => {\n   114→    if (!containerRef.current) return;\n   115→\n   116→    const observer = new ResizeObserver((entries) => {\n   117→      const { width, height } = entries[0].contentRect;\n   118→      setContainerSize({ width, height });\n   119→    });\n   120→\n   121→    observer.observe(containerRef.current);\n   122→    return () => observer.disconnect();\n   123→  }, []);\n   124→\n   125→  // Calculate the rendered image bounds within the container (accounting for object-contain)\n   126→  const getImageBounds = useCallback(() => {\n   127→    if (!containerRef.current || !imageDimensions || !containerSize) {\n   128→      return { offsetX: 0, offsetY: 0, renderedWidth: 1, renderedHeight: 1, containerWidth: 1, containerHeight: 1 };\n   129→    }\n   130→\n   131→    const containerWidth = containerSize.width;\n   132→    const containerHeight = containerSize.height;\n   133→    const imageAspect = imageDimensions.width / imageDimensions.height;\n   134→    const containerAspect = containerWidth / containerHeight;\n   135→\n   136→    let renderedWidth: number;\n   137→    let renderedHeight: number;\n   138→    let offsetX = 0;\n   139→    let offsetY = 0;\n   140→\n   141→    if (imageAspect > containerAspect) {\n   142→      renderedWidth = containerWidth;\n   143→      renderedHeight = containerWidth / imageAspect;\n   144→      offsetY = (containerHeight - renderedHeight) / 2;\n   145→    } else {\n   146→      renderedHeight = containerHeight;\n   147→      renderedWidth = containerHeight * imageAspect;\n   148→      offsetX = (containerWidth - renderedWidth) / 2;\n   149→    }\n   150→\n   151→    return { offsetX, offsetY, renderedWidth, renderedHeight, containerWidth, containerHeight };\n   152→  }, [imageDimensions, containerSize]);\n   153→\n   154→  // Get what normalized coordinates the center orb points to on the image\n   155→  const getCrosshairNormalizedPosition = useCallback(() => {\n   156→    const bounds = getImageBounds();\n   157→    if (!bounds.renderedWidth || !bounds.renderedHeight) {\n   158→      return { x: 0.5, y: 0.5 };\n   159→    }\n   160→\n   161→    // The container center (where the orb is) in screen coordinates\n   162→    const containerCenterX = bounds.containerWidth / 2;\n   163→    const containerCenterY = bounds.containerHeight / 2;\n   164→\n   165→    // The transform is: translate(pan.x, pan.y) scale(zoomLevel)\n   166→    // To find what image point is at container center, we reverse this:\n   167→    // 1. The point at container center after transform comes from:\n   168→    //    screenPos = imagePos * zoomLevel + pan\n   169→    // 2. Solving for imagePos:\n   170→    //    imagePos = (screenPos - pan) / zoomLevel\n   171→    const imageX = (containerCenterX - pan.x) / zoomLevel;\n   172→    const imageY = (containerCenterY - pan.y) / zoomLevel;\n   173→\n   174→    // Convert to normalized (0-1) coordinates within the image\n   175→    const normalizedX = (imageX - bounds.offsetX) / bounds.renderedWidth;\n   176→    const normalizedY = (imageY - bounds.offsetY) / bounds.renderedHeight;\n   177→\n   178→    return {\n   179→      x: Math.max(0, Math.min(1, normalizedX)),\n   180→      y: Math.max(0, Math.min(1, normalizedY)),\n   181→    };\n   182→  }, [getImageBounds, pan, zoomLevel]);\n   183→\n   184→  // Convert normalized image coordinates (0-1) to pixel position within the container\n   185→  // Note: This is used for landmarks INSIDE the transformed container, so no zoom/pan needed\n   186→  const getLandmarkPixelPosition = useCallback((x: number, y: number) => {\n   187→    const bounds = getImageBounds();\n   188→    // Position relative to container (the parent transform handles zoom/pan)\n   189→    const pixelX = bounds.offsetX + x * bounds.renderedWidth;\n   190→    const pixelY = bounds.offsetY + y * bounds.renderedHeight;\n   191→    return { left: pixelX, top: pixelY };\n   192→  }, [getImageBounds]);\n   193→\n   194→  useEffect(() => {\n   195→    onLandmarksChange?.(landmarks);\n   196→  }, [landmarks, onLandmarksChange]);\n   197→\n   198→  // Confirm placement: set current landmark to where crosshair points\n   199→  const confirmPlacement = useCallback(() => {\n   200→    const pos = getCrosshairNormalizedPosition();\n   201→    setLandmarks((prev) =>\n   202→      prev.map((lm) =>\n   203→        lm.id === currentLandmarkId ? { ...lm, x: pos.x, y: pos.y } : lm\n   204→      )\n   205→    );\n   206→    setPlacedLandmarks((prev) => new Set(prev).add(currentLandmarkId));\n   207→  }, [currentLandmarkId, getCrosshairNormalizedPosition]);\n   208→\n   209→  // Handle click - confirms placement at crosshair position\n   210→  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n   211→  const handleContainerClick = useCallback(() => {\n   212→    if (isDragging) return;\n   213→    confirmPlacement();\n   214→  }, [isDragging, confirmPlacement]);\n   215→\n   216→  // Mouse down - start dragging to pan\n   217→  const handleMouseDown = useCallback(\n   218→    (e: React.MouseEvent) => {\n   219→      if (e.button === 0) {\n   220→        setIsDragging(true);\n   221→        setDragStart({ x: e.clientX - pan.x, y: e.clientY - pan.y });\n   222→      }\n   223→    },\n   224→    [pan]\n   225→  );\n   226→\n   227→  // Mouse move - pan the image\n   228→  const handleMouseMove = useCallback(\n   229→    (e: React.MouseEvent) => {\n   230→      if (isDragging) {\n   231→        setPan({\n   232→          x: e.clientX - dragStart.x,\n   233→          y: e.clientY - dragStart.y,\n   234→        });\n   235→      }\n   236→    },\n   237→    [isDragging, dragStart]\n   238→  );\n   239→\n   240→  const handleMouseUp = useCallback(() => {\n   241→    setIsDragging(false);\n   242→  }, []);\n   243→\n   244→  const handleResetZoom = useCallback(() => {\n   245→    setZoomLevel(2.5);\n   246→    setPan({ x: 0, y: 0 });\n   247→  }, []);\n   248→\n   249→  // Pan the image using arrow keys (moves the crosshair target point on the image)\n   250→  const panImage = useCallback((direction: 'up' | 'down' | 'left' | 'right') => {\n   251→    const step = 20; // pixels to pan per keypress\n   252→    setPan((prev) => {\n   253→      switch (direction) {\n   254→        case 'up': return { ...prev, y: prev.y + step };\n   255→        case 'down': return { ...prev, y: prev.y - step };\n   256→        case 'left': return { ...prev, x: prev.x + step };\n   257→        case 'right': return { ...prev, x: prev.x - step };\n   258→        default: return prev;\n   259→      }\n   260→    });\n   261→  }, []);\n   262→\n   263→  const handleNext = useCallback(() => {\n   264→    // Confirm placement at current crosshair position before moving to next\n   265→    confirmPlacement();\n   266→\n   267→    if (currentStepIndex < totalSteps - 1) {\n   268→      setCurrentStepIndex((prev) => prev + 1);\n   269→      // Don't reset zoom - let zoomToLandmark handle it\n   270→    } else {\n   271→      onComplete?.(landmarks);\n   272→    }\n   273→  }, [currentStepIndex, totalSteps, landmarks, onComplete, confirmPlacement]);\n   274→\n   275→  const handlePrevious = useCallback(() => {\n   276→    if (currentStepIndex > 0) {\n   277→      setCurrentStepIndex((prev) => prev - 1);\n   278→      handleResetZoom();\n   279→    } else {\n   280→      onBack?.();\n   281→    }\n   282→  }, [currentStepIndex, handleResetZoom, onBack]);\n   283→\n   284→  // Auto-zoom to the current landmark's region - centers the landmark under the fixed orb\n   285→  const zoomToLandmark = useCallback((landmarkId: string) => {\n   286→    if (!autoZoomEnabled || !containerRef.current || !containerSize || !imageDimensions) return;\n   287→\n   288→    const landmark = landmarks.find(lm => lm.id === landmarkId);\n   289→    if (!landmark) return;\n   290→\n   291→    const bounds = getImageBounds();\n   292→    if (bounds.renderedWidth <= 1 || bounds.renderedHeight <= 1) return; // Bounds not ready\n   293→\n   294→    // Zoom to 2.5x for good precision\n   295→    const newZoom = 2.5;\n   296→    setZoomLevel(newZoom);\n   297→\n   298→    // Calculate pan so the landmark appears at container center (under the fixed orb)\n   299→    const containerCenterX = bounds.containerWidth / 2;\n   300→    const containerCenterY = bounds.containerHeight / 2;\n   301→\n   302→    // Where the landmark is in unzoomed image space\n   303→    const landmarkX = bounds.offsetX + landmark.x * bounds.renderedWidth;\n   304→    const landmarkY = bounds.offsetY + landmark.y * bounds.renderedHeight;\n   305→\n   306→    // Pan needed: after zoom, landmark should be at container center\n   307→    // Transform is: translate(pan) scale(zoom) with origin at 0,0\n   308→    // A point at landmarkPos ends up at: landmarkPos * zoom + pan\n   309→    // We want it at containerCenter, so: pan = containerCenter - landmarkPos * zoom\n   310→    setPan({\n   311→      x: containerCenterX - landmarkX * newZoom,\n   312→      y: containerCenterY - landmarkY * newZoom,\n   313→    });\n   314→  }, [autoZoomEnabled, landmarks, getImageBounds, containerSize, imageDimensions]);\n   315→\n   316→  // Auto-detect landmarks using Human.js/MediaPipe\n   317→  const handleAutoDetect = useCallback(async () => {\n   318→    setIsDetecting(true);\n   319→    setDetectionFailed(false);\n   320→    setFrankfortPlane(null);\n   321→    try {\n   322→      const result = await detectFromImageUrl(imageUrl, mode);\n   323→      console.log('[DEBUG] Detection result:', result);\n   324→      console.log('[DEBUG] Sample landmarks:', result?.landmarks.slice(0, 5));\n   325→      if (result && result.landmarks.length > 0) {\n   326→        // Update landmarks with detected positions\n   327→        setLandmarks(prev =>\n   328→          prev.map(lm => {\n   329→            const detected = result.landmarks.find(d => d.id === lm.id);\n   330→            if (detected) {\n   331→              return { ...lm, x: detected.x, y: detected.y };\n   332→            }\n   333→            return lm;\n   334→          })\n   335→        );\n   336→        setHasAutoDetected(true);\n   337→        setDetectionFailed(false);\n   338→\n   339→        // Capture Frankfort Plane for side profile (from server-side detection)\n   340→        if (mode === 'side' && result.frankfortPlane) {\n   341→          console.log('[DEBUG] Frankfort Plane:', result.frankfortPlane);\n   342→          setFrankfortPlane(result.frankfortPlane);\n   343→        }\n   344→\n   345→        // Zoom to first landmark after detection\n   346→        zoomToLandmark(orderedIds[0]);\n   347→      } else {\n   348→        // Detection returned no results - common for side profile\n   349→        console.log('[DEBUG] No landmarks detected - manual placement required');\n   350→        setDetectionFailed(true);\n   351→        setHasAutoDetected(false);\n   352→      }\n   353→    } catch (error) {\n   354→      console.error('Auto-detection failed:', error);\n   355→      setDetectionFailed(true);\n   356→    } finally {\n   357→      setIsDetecting(false);\n   358→    }\n   359→  }, [imageUrl, mode, orderedIds, zoomToLandmark]);\n   360→\n   361→  // Auto-detect after image dimensions are loaded (prevents race condition)\n   362→  useEffect(() => {\n   363→    if (imageDimensions) {\n   364→      handleAutoDetect();\n   365→    }\n   366→    // eslint-disable-next-line react-hooks/exhaustive-deps\n   367→  }, [imageDimensions]); // Run after dimensions are loaded\n   368→\n   369→  // Auto-zoom when step changes or container size becomes available\n   370→  useEffect(() => {\n   371→    if (hasAutoDetected && autoZoomEnabled && currentLandmarkId && containerSize) {\n   372→      zoomToLandmark(currentLandmarkId);\n   373→    }\n   374→  }, [currentStepIndex, currentLandmarkId, hasAutoDetected, autoZoomEnabled, zoomToLandmark, containerSize]);\n   375→\n   376→  // Keyboard handlers with proper state tracking\n   377→  useEffect(() => {\n   378→    const handleKeyDown = (e: KeyboardEvent) => {\n   379→      if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Enter', 'Backspace', 'r', 'R'].includes(e.key)) {\n   380→        e.preventDefault();\n   381→      }\n   382→\n   383→      setPressedKeys((prev) => new Set(prev).add(e.key));\n   384→\n   385→      switch (e.key) {\n   386→        case 'ArrowUp': panImage('up'); break;\n   387→        case 'ArrowDown': panImage('down'); break;\n   388→        case 'ArrowLeft': panImage('left'); break;\n   389→        case 'ArrowRight': panImage('right'); break;\n   390→        case 'Enter': handleNext(); break;\n   391→        case 'Backspace': handlePrevious(); break;\n   392→        case 'r':\n   393→        case 'R': handleResetZoom(); break;\n   394→      }\n   395→    };\n   396→\n   397→    const handleKeyUp = (e: KeyboardEvent) => {\n   398→      setPressedKeys((prev) => {\n   399→        const next = new Set(prev);\n   400→        next.delete(e.key);\n   401→        return next;\n   402→      });\n   403→    };\n   404→\n   405→    window.addEventListener('keydown', handleKeyDown);\n   406→    window.addEventListener('keyup', handleKeyUp);\n   407→    return () => {\n   408→      window.removeEventListener('keydown', handleKeyDown);\n   409→      window.removeEventListener('keyup', handleKeyUp);\n   410→    };\n   411→  }, [panImage, handleNext, handlePrevious, handleResetZoom]);\n   412→\n   413→  const isKeyPressed = (key: string) => pressedKeys.has(key);\n   414→\n   415→  return (\n   416→    <div className=\"fixed inset-0 bg-black\">\n   417→      <div className=\"flex flex-col md:flex-row h-full gap-3 p-3 md:p-4\">\n   418→        {/* Sidebar - Right on desktop */}\n   419→        <div className=\"w-full md:w-80 flex-shrink-0 flex flex-col gap-3 md:order-2 overflow-hidden md:overflow-y-auto\">\n   420→          {/* Progress Card */}\n   421→          <div className=\"bg-neutral-900 rounded-xl border border-neutral-800 overflow-hidden flex-shrink-0\">\n   422→            <div className=\"p-4\">\n   423→              <div className=\"flex items-center justify-between text-xs text-neutral-400 mb-2\">\n   424→                <span>Step {currentStepIndex + 1} of {totalSteps}</span>\n   425→                <span>{Math.round(progress)}%</span>\n   426→              </div>\n   427→              <div className=\"h-1.5 bg-neutral-800 rounded-full overflow-hidden mb-3\">\n   428→                <motion.div\n   429→                  className=\"h-full rounded-full\"\n   430→                  style={{ width: `${progress}%`, backgroundColor: '#00f3ff' }}\n   431→                  transition={{ duration: 0.3 }}\n   432→                />\n   433→              </div>\n   434→              <div className=\"flex items-center gap-2\">\n   435→                <div className=\"w-6 h-6 bg-[#00f3ff] rounded-full flex items-center justify-center flex-shrink-0\">\n   436→                  <Check className=\"w-3.5 h-3.5 text-black\" />\n   437→                </div>\n   438→                <span className=\"text-sm font-medium text-white\">\n   439→                  {currentStepIndex} placed\n   440→                </span>\n   441→              </div>\n   442→            </div>\n   443→\n   444→            {/* View Tabs */}\n   445→            <div className=\"flex border-t border-neutral-800\">\n   446→              <button\n   447→                onClick={() => setActiveTab('info')}\n   448→                className={`flex-1 py-2.5 text-xs font-medium transition-colors ${\n   449→                  activeTab === 'info'\n   450→                    ? 'text-[#00f3ff] border-b-2 border-[#00f3ff]'\n   451→                    : 'text-neutral-500 hover:text-neutral-300'\n   452→                }`}\n   453→              >\n   454→                Current Point\n   455→              </button>\n   456→              <button\n   457→                onClick={() => setActiveTab('reference')}\n   458→                className={`flex-1 py-2.5 text-xs font-medium transition-colors ${\n   459→                  activeTab === 'reference'\n   460→                    ? 'text-[#00f3ff] border-b-2 border-[#00f3ff]'\n   461→                    : 'text-neutral-500 hover:text-neutral-300'\n   462→                }`}\n   463→              >\n   464→                Reference\n   465→              </button>\n   466→            </div>\n   467→\n   468→            {/* Info/Reference Content */}\n   469→            <div className=\"bg-neutral-900/50\">\n   470→              {activeTab === 'info' ? (\n   471→                <div>\n   472→                  {/* Photo Reference Image */}\n   473→                  {currentLandmark && getLandmarkImagePath(currentLandmark.id, mode, 'photo') ? (\n   474→                    <div className=\"relative w-full aspect-square bg-neutral-800\">\n   475→                      <Image\n   476→                        src={getLandmarkImagePath(currentLandmark.id, mode, 'photo')!}\n   477→                        alt={currentLandmark.label}\n   478→                        fill\n   479→                        className=\"object-contain\"\n   480→                        unoptimized\n   481→                      />\n   482→                    </div>\n   483→                  ) : (\n   484→                    <div className=\"w-full aspect-square bg-neutral-800 flex items-center justify-center\">\n   485→                      <div\n   486→                        className=\"w-14 h-14 rounded-full flex items-center justify-center\"\n   487→                        style={{ backgroundColor: `${color}20`, border: `2px solid ${color}` }}\n   488→                      >\n   489→                        <div className=\"w-4 h-4 rounded-full\" style={{ backgroundColor: color }} />\n   490→                      </div>\n   491→                    </div>\n   492→                  )}\n   493→                  <div className=\"p-3 text-center border-t border-neutral-800\">\n   494→                    <p className=\"text-sm font-semibold text-white\">{currentLandmark?.label}</p>\n   495→                    <p className=\"text-xs text-[#00f3ff] mt-0.5 font-mono\">{currentLandmark?.medicalTerm}</p>\n   496→                  </div>\n   497→                </div>\n   498→              ) : (\n   499→                <div>\n   500→                  {/* Infographic Reference Image */}\n   501→                  {currentLandmark && getLandmarkImagePath(currentLandmark.id, mode, 'infographic') ? (\n   502→                    <div className=\"relative w-full aspect-square bg-neutral-800\">\n   503→                      <Image\n   504→                        src={getLandmarkImagePath(currentLandmark.id, mode, 'infographic')!}\n   505→                        alt={`${currentLandmark.label} infographic`}\n   506→                        fill\n   507→                        className=\"object-contain\"\n   508→                        unoptimized\n   509→                      />\n   510→                    </div>\n   511→                  ) : (\n   512→                    <div className=\"w-full aspect-square bg-neutral-800 flex items-center justify-center\">\n   513→                      <Info className=\"w-12 h-12 text-neutral-600\" />\n   514→                    </div>\n   515→                  )}\n   516→                  <div className=\"p-3 text-center border-t border-neutral-800\">\n   517→                    <p className=\"text-sm text-neutral-300\">\n   518→                      {currentLandmark ? getLandmarkPlacementGuide(currentLandmark.id, mode) : ''}\n   519→                    </p>\n   520→                  </div>\n   521→                </div>\n   522→              )}\n   523→            </div>\n   524→          </div>\n   525→\n   526→          {/* Keyboard Shortcuts - Desktop only */}\n   527→          <div className=\"hidden md:flex flex-col gap-3\">\n   528→            <div className=\"bg-neutral-900 rounded-xl border border-neutral-800 p-4\">\n   529→              <p className=\"text-xs text-neutral-500 font-medium uppercase tracking-wide mb-3 text-center\">\n   530→                Keyboard Controls\n   531→              </p>\n   532→              <div className=\"flex justify-center mb-4\">\n   533→                <div className=\"flex flex-col gap-1 items-center\">\n   534→                  {/* Arrow Up */}\n   535→                  <div\n   536→                    className={`w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-100 ${\n   537→                      isKeyPressed('ArrowUp')\n   538→                        ? 'bg-[#00f3ff] text-black shadow-[0_0_15px_rgba(0,243,255,0.5)]'\n   539→                        : 'bg-neutral-800 text-neutral-400 border border-neutral-700'\n   540→                    }`}\n   541→                  >\n   542→                    <ChevronUp className=\"w-5 h-5\" />\n   543→                  </div>\n   544→                  {/* Arrow Row */}\n   545→                  <div className=\"flex gap-1\">\n   546→                    {[\n   547→                      { key: 'ArrowLeft', icon: ChevronLeft },\n   548→                      { key: 'ArrowDown', icon: ChevronDown },\n   549→                      { key: 'ArrowRight', icon: ChevronRight },\n   550→                    ].map(({ key, icon: Icon }) => (\n   551→                      <div\n   552→                        key={key}\n   553→                        className={`w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-100 ${\n   554→                          isKeyPressed(key)\n   555→                            ? 'bg-[#00f3ff] text-black shadow-[0_0_15px_rgba(0,243,255,0.5)]'\n   556→                            : 'bg-neutral-800 text-neutral-400 border border-neutral-700'\n   557→                        }`}\n   558→                      >\n   559→                        <Icon className=\"w-5 h-5\" />\n   560→                      </div>\n   561→                    ))}\n   562→                  </div>\n   563→                </div>\n   564→              </div>\n   565→\n   566→              <div className=\"space-y-2 text-sm\">\n   567→                <div className=\"flex items-center justify-between\">\n   568→                  <span\n   569→                    className={`px-2 py-1 rounded font-mono text-xs transition-all duration-100 ${\n   570→                      isKeyPressed('Enter')\n   571→                        ? 'bg-[#00f3ff] text-black'\n   572→                        : 'bg-neutral-800 text-neutral-400'\n   573→                    }`}\n   574→                  >\n   575→                    Enter\n   576→                  </span>\n   577→                  <span className=\"text-neutral-500\">Next point</span>\n   578→                </div>\n   579→                <div className=\"flex items-center justify-between\">\n   580→                  <span\n   581→                    className={`px-2 py-1 rounded font-mono text-xs transition-all duration-100 ${\n   582→                      isKeyPressed('Backspace')\n   583→                        ? 'bg-[#00f3ff] text-black'\n   584→                        : 'bg-neutral-800 text-neutral-400'\n   585→                    }`}\n   586→                  >\n   587→                    Backspace\n   588→                  </span>\n   589→                  <span className=\"text-neutral-500\">Previous</span>\n   590→                </div>\n   591→                <div className=\"flex items-center justify-between\">\n   592→                  <span\n   593→                    className={`px-2 py-1 rounded font-mono text-xs transition-all duration-100 ${\n   594→                      isKeyPressed('r') || isKeyPressed('R')\n   595→                        ? 'bg-[#00f3ff] text-black'\n   596→                        : 'bg-neutral-800 text-neutral-400'\n   597→                    }`}\n   598→                  >\n   599→                    R\n   600→                  </span>\n   601→                  <span className=\"text-neutral-500\">Reset zoom</span>\n   602→                </div>\n   603→              </div>\n   604→            </div>\n   605→\n   606→            {/* Zoom Controls */}\n   607→            <div className=\"bg-neutral-900 rounded-xl border border-neutral-800 p-4\">\n   608→              <p className=\"text-xs text-neutral-500 font-medium uppercase tracking-wide mb-3\">\n   609→                Zoom Level\n   610→              </p>\n   611→              <div className=\"flex gap-2\">\n   612→                {[1, 2, 4].map((level) => (\n   613→                  <button\n   614→                    key={level}\n   615→                    onClick={() => {\n   616→                      if (level === 1) {\n   617→                        // Reset to 1x: no zoom, no pan\n   618→                        setZoomLevel(1);\n   619→                        setPan({ x: 0, y: 0 });\n   620→                      } else if (containerSize) {\n   621→                        // Adjust pan to keep the same center point visible when zoom changes\n   622→                        // Current center in image space: imageCenter = (containerCenter - pan) / oldZoom\n   623→                        // New pan to show same center: newPan = containerCenter - imageCenter * newZoom\n   624→                        const containerCenterX = containerSize.width / 2;\n   625→                        const containerCenterY = containerSize.height / 2;\n   626→                        const imageCenterX = (containerCenterX - pan.x) / zoomLevel;\n   627→                        const imageCenterY = (containerCenterY - pan.y) / zoomLevel;\n   628→                        const newPanX = containerCenterX - imageCenterX * level;\n   629→                        const newPanY = containerCenterY - imageCenterY * level;\n   630→                        setZoomLevel(level);\n   631→                        setPan({ x: newPanX, y: newPanY });\n   632→                      } else {\n   633→                        setZoomLevel(level);\n   634→                      }\n   635→                    }}\n   636→                    className={`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${\n   637→                      zoomLevel === level\n   638→                        ? 'bg-[#00f3ff] text-black'\n   639→                        : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n   640→                    }`}\n   641→                  >\n   642→                    {level}x\n   643→                  </button>\n   644→                ))}\n   645→              </div>\n   646→            </div>\n   647→\n   648→            {/* Auto-Detect Button */}\n   649→            <button\n   650→              onClick={handleAutoDetect}\n   651→              disabled={isDetecting}\n   652→              className={`w-full py-3 rounded-lg text-sm font-medium transition-all flex items-center justify-center gap-2 ${\n   653→                hasAutoDetected\n   654→                  ? 'bg-green-500/20 text-green-400 border border-green-500/30'\n   655→                  : 'bg-gradient-to-r from-[#00f3ff] to-[#00c4cc] text-black hover:shadow-[0_0_20px_rgba(0,243,255,0.3)]'\n   656→              } disabled:opacity-50 disabled:cursor-not-allowed`}\n   657→            >\n   658→              {isDetecting ? (\n   659→                <>\n   660→                  <Loader2 className=\"w-4 h-4 animate-spin\" />\n   661→                  Detecting...\n   662→                </>\n   663→              ) : hasAutoDetected ? (\n   664→                <>\n   665→                  <Check className=\"w-4 h-4\" />\n   666→                  Detected - Adjust if needed\n   667→                </>\n   668→              ) : (\n   669→                <>\n   670→                  <Scan className=\"w-4 h-4\" />\n   671→                  Auto-Detect Landmarks\n   672→                </>\n   673→              )}\n   674→            </button>\n   675→\n   676→            {/* Auto-Zoom Toggle */}\n   677→            <button\n   678→              onClick={() => setAutoZoomEnabled(!autoZoomEnabled)}\n   679→              className={`w-full py-2.5 rounded-lg text-xs font-medium transition-all flex items-center justify-center gap-2 ${\n   680→                autoZoomEnabled\n   681→                  ? 'bg-[#00f3ff] text-black'\n   682→                  : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n   683→              }`}\n   684→            >\n   685→              <Focus className=\"w-4 h-4\" />\n   686→              {autoZoomEnabled ? 'Auto-Zoom: ON' : 'Auto-Zoom: OFF'}\n   687→            </button>\n   688→\n   689→          </div>\n   690→        </div>\n   691→\n   692→        {/* Main Image Area */}\n   693→        <div className=\"flex-1 min-h-0 relative md:order-1 flex flex-col\">\n   694→          <div\n   695→            ref={containerRef}\n   696→            className=\"relative flex-1 bg-neutral-900 overflow-hidden rounded-xl border border-neutral-800 select-none\"\n   697→            onMouseDown={handleMouseDown}\n   698→            onMouseMove={handleMouseMove}\n   699→            onMouseUp={handleMouseUp}\n   700→            onMouseLeave={handleMouseUp}\n   701→            style={{\n   702→              cursor: isDragging ? 'grabbing' : 'grab',\n   703→            }}\n   704→          >\n   705→            {/* Transformed Content - Image and placed landmarks move together */}\n   706→            <div\n   707→              className=\"absolute inset-0\"\n   708→              style={{\n   709→                transform: `translate(${pan.x}px, ${pan.y}px) scale(${zoomLevel})`,\n   710→                transformOrigin: '0 0',\n   711→              }}\n   712→            >\n   713→              {/* User's Image */}\n   714→              <Image\n   715→                src={imageUrl}\n   716→                alt=\"Your photo\"\n   717→                fill\n   718→                className=\"object-contain pointer-events-none select-none\"\n   719→                unoptimized\n   720→                draggable={false}\n   721→              />\n   722→\n   723→              {/* Placed landmarks - always visible as they're placed */}\n   724→              {landmarks.filter(lm => placedLandmarks.has(lm.id) && lm.id !== currentLandmarkId).map((landmark) => {\n   725→                const lmColor = getLandmarkColor(landmark.id, categories);\n   726→                const pos = getLandmarkPixelPosition(landmark.x, landmark.y);\n   727→\n   728→                return (\n   729→                  <div\n   730→                    key={landmark.id}\n   731→                    className=\"absolute pointer-events-none\"\n   732→                    style={{\n   733→                      left: pos.left,\n   734→                      top: pos.top,\n   735→                      transform: `translate(-50%, -50%) scale(${1 / zoomLevel})`,\n   736→                      transformOrigin: 'center center',\n   737→                    }}\n   738→                  >\n   739→                    {/* Small persistent dot - matches FaceIQ style */}\n   740→                    <div\n   741→                      className=\"absolute rounded-full\"\n   742→                      style={{\n   743→                        width: 8,\n   744→                        height: 8,\n   745→                        left: -4,\n   746→                        top: -4,\n   747→                        backgroundColor: lmColor,\n   748→                        boxShadow: `0 0 4px ${lmColor}, 0 0 8px ${lmColor}60`,\n   749→                        border: '1px solid rgba(255,255,255,0.5)',\n   750→                      }}\n   751→                    />\n   752→                  </div>\n   753→                );\n   754→              })}\n   755→\n   756→              {/* Frankfort Horizontal Plane - green reference line for side profiles */}\n   757→              {mode === 'side' && frankfortPlane && (\n   758→                <svg\n   759→                  className=\"absolute inset-0 pointer-events-none\"\n   760→                  style={{ width: '100%', height: '100%' }}\n   761→                >\n   762→                  {(() => {\n   763→                    const bounds = getImageBounds();\n   764→                    const orbitaleX = bounds.offsetX + frankfortPlane.orbitale.x * bounds.renderedWidth;\n   765→                    const orbitaleY = bounds.offsetY + frankfortPlane.orbitale.y * bounds.renderedHeight;\n   766→                    const porionX = bounds.offsetX + frankfortPlane.porion.x * bounds.renderedWidth;\n   767→                    const porionY = bounds.offsetY + frankfortPlane.porion.y * bounds.renderedHeight;\n   768→\n   769→                    // Extend the line beyond the points for visibility\n   770→                    const dx = porionX - orbitaleX;\n   771→                    const dy = porionY - orbitaleY;\n   772→                    const length = Math.sqrt(dx * dx + dy * dy);\n   773→                    const extendFactor = length > 0 ? 0.3 : 0;\n   774→                    const startX = orbitaleX - (dx / length) * bounds.renderedWidth * extendFactor;\n   775→                    const startY = orbitaleY - (dy / length) * bounds.renderedWidth * extendFactor;\n   776→                    const endX = porionX + (dx / length) * bounds.renderedWidth * extendFactor;\n   777→                    const endY = porionY + (dy / length) * bounds.renderedWidth * extendFactor;\n   778→\n   779→                    return (\n   780→                      <>\n   781→                        {/* Main Frankfort line */}\n   782→                        <line\n   783→                          x1={startX}\n   784→                          y1={startY}\n   785→                          x2={endX}\n   786→                          y2={endY}\n   787→                          stroke=\"#22c55e\"\n   788→                          strokeWidth={2 / zoomLevel}\n   789→                          strokeDasharray={`${6 / zoomLevel} ${4 / zoomLevel}`}\n   790→                          opacity={0.8}\n   791→                        />\n   792→                        {/* Orbitale point marker */}\n   793→                        <circle\n   794→                          cx={orbitaleX}\n   795→                          cy={orbitaleY}\n   796→                          r={4 / zoomLevel}\n   797→                          fill=\"#22c55e\"\n   798→                          stroke=\"white\"\n   799→                          strokeWidth={1 / zoomLevel}\n   800→                        />\n   801→                        {/* Porion point marker */}\n   802→                        <circle\n   803→                          cx={porionX}\n   804→                          cy={porionY}\n   805→                          r={4 / zoomLevel}\n   806→                          fill=\"#22c55e\"\n   807→                          stroke=\"white\"\n   808→                          strokeWidth={1 / zoomLevel}\n   809→                        />\n   810→                        {/* Angle indicator */}\n   811→                        <text\n   812→                          x={startX}\n   813→                          y={startY - 10 / zoomLevel}\n   814→                          fill=\"#22c55e\"\n   815→                          fontSize={12 / zoomLevel}\n   816→                          fontWeight=\"bold\"\n   817→                        >\n   818→                          FH: {frankfortPlane.angle.toFixed(1)}°\n   819→                        </text>\n   820→                      </>\n   821→                    );\n   822→                  })()}\n   823→                </svg>\n   824→              )}\n   825→            </div>\n   826→\n   827→            {/* FIXED CENTER TARGETING DOT - small precise point for accurate placement */}\n   828→            <div className=\"absolute inset-0 pointer-events-none flex items-center justify-center z-20\">\n   829→              {/* Crosshair lines for precision */}\n   830→              <div\n   831→                className=\"absolute\"\n   832→                style={{\n   833→                  width: 20,\n   834→                  height: 1,\n   835→                  backgroundColor: '#00f3ff',\n   836→                  opacity: 0.6,\n   837→                }}\n   838→              />\n   839→              <div\n   840→                className=\"absolute\"\n   841→                style={{\n   842→                  width: 1,\n   843→                  height: 20,\n   844→                  backgroundColor: '#00f3ff',\n   845→                  opacity: 0.6,\n   846→                }}\n   847→              />\n   848→              {/* Subtle glow ring */}\n   849→              <div\n   850→                className=\"absolute rounded-full\"\n   851→                style={{\n   852→                  width: 12,\n   853→                  height: 12,\n   854→                  background: 'radial-gradient(circle, #00f3ff33 0%, transparent 70%)',\n   855→                }}\n   856→              />\n   857→              {/* Center dot - small and precise */}\n   858→              <div\n   859→                className=\"relative rounded-full\"\n   860→                style={{\n   861→                  width: 4,\n   862→                  height: 4,\n   863→                  backgroundColor: '#00f3ff',\n   864→                  boxShadow: '0 0 6px #00f3ff, 0 0 12px #00f3ff80',\n   865→                }}\n   866→              />\n   867→            </div>\n   868→\n   869→            {/* Loading Overlay */}\n   870→            {isDetecting && (\n   871→              <div className=\"absolute inset-0 bg-black/70 flex flex-col items-center justify-center z-50\">\n   872→                <Loader2 className=\"w-12 h-12 text-[#00f3ff] animate-spin mb-4\" />\n   873→                <p className=\"text-white text-lg font-medium\">Detecting landmarks...</p>\n   874→                <p className=\"text-neutral-400 text-sm mt-2\">This may take a few seconds</p>\n   875→              </div>\n   876→            )}\n   877→\n   878→            {/* Detection Failed Banner */}\n   879→            {detectionFailed && !isDetecting && (\n   880→              <motion.div\n   881→                initial={{ opacity: 0, y: -20 }}\n   882→                animate={{ opacity: 1, y: 0 }}\n   883→                className=\"absolute top-12 left-3 right-3 z-30\"\n   884→              >\n   885→                <div className=\"bg-amber-500/20 border border-amber-500/50 rounded-lg px-3 py-2 flex items-center gap-2\">\n   886→                  <AlertTriangle className=\"w-4 h-4 text-amber-400 flex-shrink-0\" />\n   887→                  <p className=\"text-amber-200 text-xs flex-1\">\n   888→                    {mode === 'side'\n   889→                      ? 'Auto-detection could not find profile. Please place landmarks manually for best accuracy.'\n   890→                      : 'Could not detect face. Please place landmarks manually.'}\n   891→                  </p>\n   892→                  <button\n   893→                    onClick={() => setDetectionFailed(false)}\n   894→                    className=\"text-amber-400 hover:text-amber-200 transition-colors\"\n   895→                  >\n   896→                    <X className=\"w-4 h-4\" />\n   897→                  </button>\n   898→                </div>\n   899→              </motion.div>\n   900→            )}\n   901→\n   902→            {/* Zoom indicator */}\n   903→            <div className=\"absolute top-3 left-3 px-3 py-1.5 rounded-lg bg-black/80 border border-neutral-700 text-white text-xs flex items-center gap-2\">\n   904→              <Move className=\"w-3 h-3\" />\n   905→              {zoomLevel.toFixed(1)}x - Drag to align\n   906→            </div>\n   907→\n   908→            {/* Current landmark label overlay */}\n   909→            <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black via-black/80 to-transparent p-4 pointer-events-none\">\n   910→              <p className=\"text-center text-white text-sm font-medium\">\n   911→                Drag image to align:{' '}\n   912→                <span className=\"font-semibold\" style={{ color }}>{currentLandmark?.label}</span>\n   913→              </p>\n   914→              <p className=\"text-center text-neutral-400 text-xs mt-1\">\n   915→                Press Enter or click Next to confirm\n   916→              </p>\n   917→            </div>\n   918→          </div>\n   919→\n   920→          {/* Navigation Bar - Fixed at bottom of image area */}\n   921→          <div className=\"mt-3 flex items-center justify-center gap-3\">\n   922→            <button\n   923→              onClick={handlePrevious}\n   924→              className=\"p-2.5 rounded-xl bg-neutral-800 text-neutral-300 hover:bg-neutral-700 border border-neutral-700 transition-all\"\n   925→            >\n   926→              <ChevronLeft className=\"w-5 h-5\" />\n   927→            </button>\n   928→\n   929→            {/* Step dots - show current position indicator */}\n   930→            <div className=\"flex items-center gap-2 px-4 py-2 bg-neutral-900 rounded-xl border border-neutral-800\">\n   931→              <span className=\"text-xs text-neutral-400 font-mono min-w-[4ch]\">\n   932→                {currentStepIndex + 1}\n   933→              </span>\n   934→              <div className=\"w-32 h-1.5 bg-neutral-800 rounded-full overflow-hidden\">\n   935→                <div\n   936→                  className=\"h-full bg-[#00f3ff] rounded-full transition-all duration-200\"\n   937→                  style={{ width: `${((currentStepIndex + 1) / totalSteps) * 100}%` }}\n   938→                />\n   939→              </div>\n   940→              <span className=\"text-xs text-neutral-400 font-mono min-w-[4ch] text-right\">\n   941→                {totalSteps}\n   942→              </span>\n   943→            </div>\n   944→\n   945→            <button\n   946→              onClick={handleNext}\n   947→              className={`flex items-center gap-2 px-5 py-2.5 rounded-xl font-medium text-sm transition-all ${\n   948→                currentStepIndex === totalSteps - 1\n   949→                  ? 'bg-green-500 text-white hover:bg-green-600'\n   950→                  : 'bg-[#00f3ff] text-black hover:shadow-[0_0_20px_rgba(0,243,255,0.4)]'\n   951→              }`}\n   952→            >\n   953→              {currentStepIndex === totalSteps - 1 ? (\n   954→                <>\n   955→                  <Check className=\"w-4 h-4\" />\n   956→                  Complete\n   957→                </>\n   958→              ) : (\n   959→                <>\n   960→                  Next\n   961→                  <ChevronRight className=\"w-4 h-4\" />\n   962→                </>\n   963→              )}\n   964→            </button>\n   965→          </div>\n   966→        </div>\n   967→      </div>\n   968→    </div>\n   969→  );\n   970→}\n   971→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"7171bc25-73dc-4671-9578-9afb6208b863","timestamp":"2025-12-20T15:50:16.066Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/LandmarkAnalysisTool.tsx","content":"'use client';\n\nimport { useState, useRef, useCallback, useEffect } from 'react';\nimport Image from 'next/image';\nimport { motion } from 'framer-motion';\nimport {\n  ChevronLeft,\n  ChevronRight,\n  ChevronUp,\n  ChevronDown,\n  Check,\n  Info,\n  Scan,\n  Loader2,\n  Move,\n  Focus,\n  AlertTriangle,\n  X,\n} from 'lucide-react';\nimport {\n  LandmarkPoint,\n  FRONT_PROFILE_LANDMARKS,\n  SIDE_PROFILE_LANDMARKS,\n  getLandmarkColor,\n  FRONT_LANDMARK_CATEGORIES,\n  SIDE_LANDMARK_CATEGORIES,\n} from '@/lib/landmarks';\nimport { getLandmarkImagePath, getLandmarkPlacementGuide } from '@/lib/landmarkImages';\nimport { detectFromImageUrl } from '@/lib/mediapipeDetection';\n\ninterface LandmarkAnalysisToolProps {\n  imageUrl: string;\n  mode: 'front' | 'side';\n  initialLandmarks?: LandmarkPoint[];\n  onLandmarksChange?: (landmarks: LandmarkPoint[]) => void;\n  onComplete?: (landmarks: LandmarkPoint[]) => void;\n  onBack?: () => void;\n}\n\nfunction getOrderedLandmarks(mode: 'front' | 'side'): string[] {\n  const landmarks = mode === 'front' ? FRONT_PROFILE_LANDMARKS : SIDE_PROFILE_LANDMARKS;\n  return landmarks.map(lm => lm.id);\n}\n\nexport function LandmarkAnalysisTool({\n  imageUrl,\n  mode,\n  initialLandmarks,\n  onLandmarksChange,\n  onComplete,\n  onBack,\n}: LandmarkAnalysisToolProps) {\n  const containerRef = useRef<HTMLDivElement>(null);\n  const [imageDimensions, setImageDimensions] = useState<{ width: number; height: number } | null>(null);\n  const [containerSize, setContainerSize] = useState<{ width: number; height: number } | null>(null);\n  const defaultLandmarks = mode === 'front' ? FRONT_PROFILE_LANDMARKS : SIDE_PROFILE_LANDMARKS;\n  const categories = mode === 'front' ? FRONT_LANDMARK_CATEGORIES : SIDE_LANDMARK_CATEGORIES;\n  const orderedIds = getOrderedLandmarks(mode);\n\n  const [landmarks, setLandmarks] = useState<LandmarkPoint[]>(\n    initialLandmarks || defaultLandmarks\n  );\n  const [currentStepIndex, setCurrentStepIndex] = useState(0);\n  const [zoomLevel, setZoomLevel] = useState(2.5); // Start zoomed in for precision\n\n  // Reset state when mode changes (fixes side profile starting at step 52)\n  useEffect(() => {\n    const newLandmarks = mode === 'front' ? FRONT_PROFILE_LANDMARKS : SIDE_PROFILE_LANDMARKS;\n    setCurrentStepIndex(0);\n    setPlacedLandmarks(new Set());\n    setHasAutoDetected(false);\n    setDetectionFailed(false);\n    setLandmarks(newLandmarks);\n    setPan({ x: 0, y: 0 });\n    setZoomLevel(2.5);\n  }, [mode]);\n  const [pan, setPan] = useState({ x: 0, y: 0 });\n  const [isDragging, setIsDragging] = useState(false);\n  const [dragStart, setDragStart] = useState({ x: 0, y: 0 });\n  const [pressedKeys, setPressedKeys] = useState<Set<string>>(new Set());\n  const [activeTab, setActiveTab] = useState<'info' | 'reference'>('info');\n  const [isDetecting, setIsDetecting] = useState(true);\n  const [hasAutoDetected, setHasAutoDetected] = useState(false);\n  const [autoZoomEnabled, setAutoZoomEnabled] = useState(true);\n  const [detectionFailed, setDetectionFailed] = useState(false);\n  const [placedLandmarks, setPlacedLandmarks] = useState<Set<string>>(new Set());\n  // Frankfort Plane for side profile visualization (from server detection)\n  const [frankfortPlane, setFrankfortPlane] = useState<{\n    angle: number;\n    orbitale: { x: number; y: number };\n    porion: { x: number; y: number };\n  } | null>(null);\n\n  const currentLandmarkId = orderedIds[currentStepIndex];\n  const currentLandmark = landmarks.find((lm) => lm.id === currentLandmarkId);\n  const totalSteps = orderedIds.length;\n  const progress = ((currentStepIndex + 1) / totalSteps) * 100;\n\n  const color = currentLandmark\n    ? getLandmarkColor(currentLandmark.id, categories)\n    : '#00f3ff';\n\n  // Load image dimensions on mount\n  useEffect(() => {\n    const img = new window.Image();\n    img.onload = () => {\n      setImageDimensions({ width: img.naturalWidth, height: img.naturalHeight });\n    };\n    img.src = imageUrl;\n  }, [imageUrl]);\n\n  // Track container size changes with ResizeObserver\n  useEffect(() => {\n    if (!containerRef.current) return;\n\n    const observer = new ResizeObserver((entries) => {\n      const { width, height } = entries[0].contentRect;\n      setContainerSize({ width, height });\n    });\n\n    observer.observe(containerRef.current);\n    return () => observer.disconnect();\n  }, []);\n\n  // Calculate the rendered image bounds within the container (accounting for object-contain)\n  const getImageBounds = useCallback(() => {\n    if (!containerRef.current || !imageDimensions || !containerSize) {\n      return { offsetX: 0, offsetY: 0, renderedWidth: 1, renderedHeight: 1, containerWidth: 1, containerHeight: 1 };\n    }\n\n    const containerWidth = containerSize.width;\n    const containerHeight = containerSize.height;\n    const imageAspect = imageDimensions.width / imageDimensions.height;\n    const containerAspect = containerWidth / containerHeight;\n\n    let renderedWidth: number;\n    let renderedHeight: number;\n    let offsetX = 0;\n    let offsetY = 0;\n\n    if (imageAspect > containerAspect) {\n      renderedWidth = containerWidth;\n      renderedHeight = containerWidth / imageAspect;\n      offsetY = (containerHeight - renderedHeight) / 2;\n    } else {\n      renderedHeight = containerHeight;\n      renderedWidth = containerHeight * imageAspect;\n      offsetX = (containerWidth - renderedWidth) / 2;\n    }\n\n    return { offsetX, offsetY, renderedWidth, renderedHeight, containerWidth, containerHeight };\n  }, [imageDimensions, containerSize]);\n\n  // Get what normalized coordinates the center orb points to on the image\n  const getCrosshairNormalizedPosition = useCallback(() => {\n    const bounds = getImageBounds();\n    if (!bounds.renderedWidth || !bounds.renderedHeight) {\n      return { x: 0.5, y: 0.5 };\n    }\n\n    // The container center (where the orb is) in screen coordinates\n    const containerCenterX = bounds.containerWidth / 2;\n    const containerCenterY = bounds.containerHeight / 2;\n\n    // The transform is: translate(pan.x, pan.y) scale(zoomLevel)\n    // To find what image point is at container center, we reverse this:\n    // 1. The point at container center after transform comes from:\n    //    screenPos = imagePos * zoomLevel + pan\n    // 2. Solving for imagePos:\n    //    imagePos = (screenPos - pan) / zoomLevel\n    const imageX = (containerCenterX - pan.x) / zoomLevel;\n    const imageY = (containerCenterY - pan.y) / zoomLevel;\n\n    // Convert to normalized (0-1) coordinates within the image\n    const normalizedX = (imageX - bounds.offsetX) / bounds.renderedWidth;\n    const normalizedY = (imageY - bounds.offsetY) / bounds.renderedHeight;\n\n    return {\n      x: Math.max(0, Math.min(1, normalizedX)),\n      y: Math.max(0, Math.min(1, normalizedY)),\n    };\n  }, [getImageBounds, pan, zoomLevel]);\n\n  // Convert normalized image coordinates (0-1) to pixel position within the container\n  // Note: This is used for landmarks INSIDE the transformed container, so no zoom/pan needed\n  const getLandmarkPixelPosition = useCallback((x: number, y: number) => {\n    const bounds = getImageBounds();\n    // Position relative to container (the parent transform handles zoom/pan)\n    const pixelX = bounds.offsetX + x * bounds.renderedWidth;\n    const pixelY = bounds.offsetY + y * bounds.renderedHeight;\n    return { left: pixelX, top: pixelY };\n  }, [getImageBounds]);\n\n  useEffect(() => {\n    onLandmarksChange?.(landmarks);\n  }, [landmarks, onLandmarksChange]);\n\n  // Confirm placement: set current landmark to where crosshair points\n  const confirmPlacement = useCallback(() => {\n    const pos = getCrosshairNormalizedPosition();\n    setLandmarks((prev) =>\n      prev.map((lm) =>\n        lm.id === currentLandmarkId ? { ...lm, x: pos.x, y: pos.y } : lm\n      )\n    );\n    setPlacedLandmarks((prev) => new Set(prev).add(currentLandmarkId));\n  }, [currentLandmarkId, getCrosshairNormalizedPosition]);\n\n  // Handle click - confirms placement at crosshair position\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  const handleContainerClick = useCallback(() => {\n    if (isDragging) return;\n    confirmPlacement();\n  }, [isDragging, confirmPlacement]);\n\n  // Mouse down - start dragging to pan\n  const handleMouseDown = useCallback(\n    (e: React.MouseEvent) => {\n      if (e.button === 0) {\n        setIsDragging(true);\n        setDragStart({ x: e.clientX - pan.x, y: e.clientY - pan.y });\n      }\n    },\n    [pan]\n  );\n\n  // Mouse move - pan the image\n  const handleMouseMove = useCallback(\n    (e: React.MouseEvent) => {\n      if (isDragging) {\n        setPan({\n          x: e.clientX - dragStart.x,\n          y: e.clientY - dragStart.y,\n        });\n      }\n    },\n    [isDragging, dragStart]\n  );\n\n  const handleMouseUp = useCallback(() => {\n    setIsDragging(false);\n  }, []);\n\n  const handleResetZoom = useCallback(() => {\n    setZoomLevel(2.5);\n    setPan({ x: 0, y: 0 });\n  }, []);\n\n  // Pan the image using arrow keys (moves the crosshair target point on the image)\n  const panImage = useCallback((direction: 'up' | 'down' | 'left' | 'right') => {\n    const step = 20; // pixels to pan per keypress\n    setPan((prev) => {\n      switch (direction) {\n        case 'up': return { ...prev, y: prev.y + step };\n        case 'down': return { ...prev, y: prev.y - step };\n        case 'left': return { ...prev, x: prev.x + step };\n        case 'right': return { ...prev, x: prev.x - step };\n        default: return prev;\n      }\n    });\n  }, []);\n\n  const handleNext = useCallback(() => {\n    // Confirm placement at current crosshair position before moving to next\n    confirmPlacement();\n\n    if (currentStepIndex < totalSteps - 1) {\n      setCurrentStepIndex((prev) => prev + 1);\n      // Don't reset zoom - let zoomToLandmark handle it\n    } else {\n      onComplete?.(landmarks);\n    }\n  }, [currentStepIndex, totalSteps, landmarks, onComplete, confirmPlacement]);\n\n  const handlePrevious = useCallback(() => {\n    if (currentStepIndex > 0) {\n      setCurrentStepIndex((prev) => prev - 1);\n      handleResetZoom();\n    } else {\n      onBack?.();\n    }\n  }, [currentStepIndex, handleResetZoom, onBack]);\n\n  // Auto-zoom to the current landmark's region - centers the landmark under the fixed orb\n  const zoomToLandmark = useCallback((landmarkId: string) => {\n    if (!autoZoomEnabled || !containerRef.current || !containerSize || !imageDimensions) return;\n\n    const landmark = landmarks.find(lm => lm.id === landmarkId);\n    if (!landmark) return;\n\n    const bounds = getImageBounds();\n    if (bounds.renderedWidth <= 1 || bounds.renderedHeight <= 1) return; // Bounds not ready\n\n    // Zoom to 2.5x for good precision\n    const newZoom = 2.5;\n    setZoomLevel(newZoom);\n\n    // Calculate pan so the landmark appears at container center (under the fixed orb)\n    const containerCenterX = bounds.containerWidth / 2;\n    const containerCenterY = bounds.containerHeight / 2;\n\n    // Where the landmark is in unzoomed image space\n    const landmarkX = bounds.offsetX + landmark.x * bounds.renderedWidth;\n    const landmarkY = bounds.offsetY + landmark.y * bounds.renderedHeight;\n\n    // Pan needed: after zoom, landmark should be at container center\n    // Transform is: translate(pan) scale(zoom) with origin at 0,0\n    // A point at landmarkPos ends up at: landmarkPos * zoom + pan\n    // We want it at containerCenter, so: pan = containerCenter - landmarkPos * zoom\n    setPan({\n      x: containerCenterX - landmarkX * newZoom,\n      y: containerCenterY - landmarkY * newZoom,\n    });\n  }, [autoZoomEnabled, landmarks, getImageBounds, containerSize, imageDimensions]);\n\n  // Auto-detect landmarks using Human.js/MediaPipe\n  const handleAutoDetect = useCallback(async () => {\n    setIsDetecting(true);\n    setDetectionFailed(false);\n    setFrankfortPlane(null);\n    try {\n      const result = await detectFromImageUrl(imageUrl, mode);\n      console.log('[DEBUG] Detection result:', result);\n      console.log('[DEBUG] Sample landmarks:', result?.landmarks.slice(0, 5));\n      if (result && result.landmarks.length > 0) {\n        // Update landmarks with detected positions\n        setLandmarks(prev =>\n          prev.map(lm => {\n            const detected = result.landmarks.find(d => d.id === lm.id);\n            if (detected) {\n              return { ...lm, x: detected.x, y: detected.y };\n            }\n            return lm;\n          })\n        );\n        setHasAutoDetected(true);\n        setDetectionFailed(false);\n\n        // Capture Frankfort Plane for side profile (from server-side detection)\n        if (mode === 'side' && result.frankfortPlane) {\n          console.log('[DEBUG] Frankfort Plane:', result.frankfortPlane);\n          setFrankfortPlane(result.frankfortPlane);\n        }\n\n        // Zoom to first landmark after detection\n        zoomToLandmark(orderedIds[0]);\n      } else {\n        // Detection returned no results - common for side profile\n        console.log('[DEBUG] No landmarks detected - manual placement required');\n        setDetectionFailed(true);\n        setHasAutoDetected(false);\n      }\n    } catch (error) {\n      console.error('Auto-detection failed:', error);\n      setDetectionFailed(true);\n    } finally {\n      setIsDetecting(false);\n    }\n  }, [imageUrl, mode, orderedIds, zoomToLandmark]);\n\n  // Auto-detect after image dimensions are loaded (prevents race condition)\n  useEffect(() => {\n    if (imageDimensions) {\n      handleAutoDetect();\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [imageDimensions]); // Run after dimensions are loaded\n\n  // Auto-zoom when step changes or container size becomes available\n  useEffect(() => {\n    if (hasAutoDetected && autoZoomEnabled && currentLandmarkId && containerSize) {\n      zoomToLandmark(currentLandmarkId);\n    }\n  }, [currentStepIndex, currentLandmarkId, hasAutoDetected, autoZoomEnabled, zoomToLandmark, containerSize]);\n\n  // Keyboard handlers with proper state tracking\n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (['ArrowUp', 'ArrowDown', 'ArrowLeft', 'ArrowRight', 'Enter', 'Backspace', 'r', 'R'].includes(e.key)) {\n        e.preventDefault();\n      }\n\n      setPressedKeys((prev) => new Set(prev).add(e.key));\n\n      switch (e.key) {\n        case 'ArrowUp': panImage('up'); break;\n        case 'ArrowDown': panImage('down'); break;\n        case 'ArrowLeft': panImage('left'); break;\n        case 'ArrowRight': panImage('right'); break;\n        case 'Enter': handleNext(); break;\n        case 'Backspace': handlePrevious(); break;\n        case 'r':\n        case 'R': handleResetZoom(); break;\n      }\n    };\n\n    const handleKeyUp = (e: KeyboardEvent) => {\n      setPressedKeys((prev) => {\n        const next = new Set(prev);\n        next.delete(e.key);\n        return next;\n      });\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    window.addEventListener('keyup', handleKeyUp);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n      window.removeEventListener('keyup', handleKeyUp);\n    };\n  }, [panImage, handleNext, handlePrevious, handleResetZoom]);\n\n  const isKeyPressed = (key: string) => pressedKeys.has(key);\n\n  return (\n    <div className=\"fixed inset-0 bg-black\">\n      <div className=\"flex flex-col md:flex-row h-full gap-3 p-3 md:p-4\">\n        {/* Sidebar - Right on desktop */}\n        <div className=\"w-full md:w-80 flex-shrink-0 flex flex-col gap-3 md:order-2 overflow-hidden md:overflow-y-auto\">\n          {/* Progress Card */}\n          <div className=\"bg-neutral-900 rounded-xl border border-neutral-800 overflow-hidden flex-shrink-0\">\n            <div className=\"p-4\">\n              <div className=\"flex items-center justify-between text-xs text-neutral-400 mb-2\">\n                <span>Step {currentStepIndex + 1} of {totalSteps}</span>\n                <span>{Math.round(progress)}%</span>\n              </div>\n              <div className=\"h-1.5 bg-neutral-800 rounded-full overflow-hidden mb-3\">\n                <motion.div\n                  className=\"h-full rounded-full\"\n                  style={{ width: `${progress}%`, backgroundColor: '#00f3ff' }}\n                  transition={{ duration: 0.3 }}\n                />\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <div className=\"w-6 h-6 bg-[#00f3ff] rounded-full flex items-center justify-center flex-shrink-0\">\n                  <Check className=\"w-3.5 h-3.5 text-black\" />\n                </div>\n                <span className=\"text-sm font-medium text-white\">\n                  {currentStepIndex} placed\n                </span>\n              </div>\n            </div>\n\n            {/* View Tabs */}\n            <div className=\"flex border-t border-neutral-800\">\n              <button\n                onClick={() => setActiveTab('info')}\n                className={`flex-1 py-2.5 text-xs font-medium transition-colors ${\n                  activeTab === 'info'\n                    ? 'text-[#00f3ff] border-b-2 border-[#00f3ff]'\n                    : 'text-neutral-500 hover:text-neutral-300'\n                }`}\n              >\n                Current Point\n              </button>\n              <button\n                onClick={() => setActiveTab('reference')}\n                className={`flex-1 py-2.5 text-xs font-medium transition-colors ${\n                  activeTab === 'reference'\n                    ? 'text-[#00f3ff] border-b-2 border-[#00f3ff]'\n                    : 'text-neutral-500 hover:text-neutral-300'\n                }`}\n              >\n                Reference\n              </button>\n            </div>\n\n            {/* Info/Reference Content */}\n            <div className=\"bg-neutral-900/50\">\n              {activeTab === 'info' ? (\n                <div>\n                  {/* Photo Reference Image */}\n                  {currentLandmark && getLandmarkImagePath(currentLandmark.id, mode, 'photo') ? (\n                    <div className=\"relative w-full aspect-square bg-neutral-800\">\n                      <Image\n                        src={getLandmarkImagePath(currentLandmark.id, mode, 'photo')!}\n                        alt={currentLandmark.label}\n                        fill\n                        className=\"object-contain\"\n                        unoptimized\n                      />\n                    </div>\n                  ) : (\n                    <div className=\"w-full aspect-square bg-neutral-800 flex items-center justify-center\">\n                      <div\n                        className=\"w-14 h-14 rounded-full flex items-center justify-center\"\n                        style={{ backgroundColor: `${color}20`, border: `2px solid ${color}` }}\n                      >\n                        <div className=\"w-4 h-4 rounded-full\" style={{ backgroundColor: color }} />\n                      </div>\n                    </div>\n                  )}\n                  <div className=\"p-3 text-center border-t border-neutral-800\">\n                    <p className=\"text-sm font-semibold text-white\">{currentLandmark?.label}</p>\n                    <p className=\"text-xs text-[#00f3ff] mt-0.5 font-mono\">{currentLandmark?.medicalTerm}</p>\n                  </div>\n                </div>\n              ) : (\n                <div>\n                  {/* Infographic Reference Image */}\n                  {currentLandmark && getLandmarkImagePath(currentLandmark.id, mode, 'infographic') ? (\n                    <div className=\"relative w-full aspect-square bg-neutral-800\">\n                      <Image\n                        src={getLandmarkImagePath(currentLandmark.id, mode, 'infographic')!}\n                        alt={`${currentLandmark.label} infographic`}\n                        fill\n                        className=\"object-contain\"\n                        unoptimized\n                      />\n                    </div>\n                  ) : (\n                    <div className=\"w-full aspect-square bg-neutral-800 flex items-center justify-center\">\n                      <Info className=\"w-12 h-12 text-neutral-600\" />\n                    </div>\n                  )}\n                  <div className=\"p-3 text-center border-t border-neutral-800\">\n                    <p className=\"text-sm text-neutral-300\">\n                      {currentLandmark ? getLandmarkPlacementGuide(currentLandmark.id, mode) : ''}\n                    </p>\n                  </div>\n                </div>\n              )}\n            </div>\n          </div>\n\n          {/* Keyboard Shortcuts - Desktop only */}\n          <div className=\"hidden md:flex flex-col gap-3\">\n            <div className=\"bg-neutral-900 rounded-xl border border-neutral-800 p-4\">\n              <p className=\"text-xs text-neutral-500 font-medium uppercase tracking-wide mb-3 text-center\">\n                Keyboard Controls\n              </p>\n              <div className=\"flex justify-center mb-4\">\n                <div className=\"flex flex-col gap-1 items-center\">\n                  {/* Arrow Up */}\n                  <div\n                    className={`w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-100 ${\n                      isKeyPressed('ArrowUp')\n                        ? 'bg-[#00f3ff] text-black shadow-[0_0_15px_rgba(0,243,255,0.5)]'\n                        : 'bg-neutral-800 text-neutral-400 border border-neutral-700'\n                    }`}\n                  >\n                    <ChevronUp className=\"w-5 h-5\" />\n                  </div>\n                  {/* Arrow Row */}\n                  <div className=\"flex gap-1\">\n                    {[\n                      { key: 'ArrowLeft', icon: ChevronLeft },\n                      { key: 'ArrowDown', icon: ChevronDown },\n                      { key: 'ArrowRight', icon: ChevronRight },\n                    ].map(({ key, icon: Icon }) => (\n                      <div\n                        key={key}\n                        className={`w-10 h-10 rounded-lg flex items-center justify-center transition-all duration-100 ${\n                          isKeyPressed(key)\n                            ? 'bg-[#00f3ff] text-black shadow-[0_0_15px_rgba(0,243,255,0.5)]'\n                            : 'bg-neutral-800 text-neutral-400 border border-neutral-700'\n                        }`}\n                      >\n                        <Icon className=\"w-5 h-5\" />\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              </div>\n\n              <div className=\"space-y-2 text-sm\">\n                <div className=\"flex items-center justify-between\">\n                  <span\n                    className={`px-2 py-1 rounded font-mono text-xs transition-all duration-100 ${\n                      isKeyPressed('Enter')\n                        ? 'bg-[#00f3ff] text-black'\n                        : 'bg-neutral-800 text-neutral-400'\n                    }`}\n                  >\n                    Enter\n                  </span>\n                  <span className=\"text-neutral-500\">Next point</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span\n                    className={`px-2 py-1 rounded font-mono text-xs transition-all duration-100 ${\n                      isKeyPressed('Backspace')\n                        ? 'bg-[#00f3ff] text-black'\n                        : 'bg-neutral-800 text-neutral-400'\n                    }`}\n                  >\n                    Backspace\n                  </span>\n                  <span className=\"text-neutral-500\">Previous</span>\n                </div>\n                <div className=\"flex items-center justify-between\">\n                  <span\n                    className={`px-2 py-1 rounded font-mono text-xs transition-all duration-100 ${\n                      isKeyPressed('r') || isKeyPressed('R')\n                        ? 'bg-[#00f3ff] text-black'\n                        : 'bg-neutral-800 text-neutral-400'\n                    }`}\n                  >\n                    R\n                  </span>\n                  <span className=\"text-neutral-500\">Reset zoom</span>\n                </div>\n              </div>\n            </div>\n\n            {/* Zoom Controls */}\n            <div className=\"bg-neutral-900 rounded-xl border border-neutral-800 p-4\">\n              <p className=\"text-xs text-neutral-500 font-medium uppercase tracking-wide mb-3\">\n                Zoom Level\n              </p>\n              <div className=\"flex gap-2\">\n                {[1, 2, 4].map((level) => (\n                  <button\n                    key={level}\n                    onClick={() => {\n                      if (level === 1) {\n                        // Reset to 1x: no zoom, no pan\n                        setZoomLevel(1);\n                        setPan({ x: 0, y: 0 });\n                      } else if (containerSize) {\n                        // Adjust pan to keep the same center point visible when zoom changes\n                        // Current center in image space: imageCenter = (containerCenter - pan) / oldZoom\n                        // New pan to show same center: newPan = containerCenter - imageCenter * newZoom\n                        const containerCenterX = containerSize.width / 2;\n                        const containerCenterY = containerSize.height / 2;\n                        const imageCenterX = (containerCenterX - pan.x) / zoomLevel;\n                        const imageCenterY = (containerCenterY - pan.y) / zoomLevel;\n                        const newPanX = containerCenterX - imageCenterX * level;\n                        const newPanY = containerCenterY - imageCenterY * level;\n                        setZoomLevel(level);\n                        setPan({ x: newPanX, y: newPanY });\n                      } else {\n                        setZoomLevel(level);\n                      }\n                    }}\n                    className={`flex-1 py-2 rounded-lg text-sm font-medium transition-all ${\n                      zoomLevel === level\n                        ? 'bg-[#00f3ff] text-black'\n                        : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n                    }`}\n                  >\n                    {level}x\n                  </button>\n                ))}\n              </div>\n            </div>\n\n            {/* Auto-Detect Button */}\n            <button\n              onClick={handleAutoDetect}\n              disabled={isDetecting}\n              className={`w-full py-3 rounded-lg text-sm font-medium transition-all flex items-center justify-center gap-2 ${\n                hasAutoDetected\n                  ? 'bg-green-500/20 text-green-400 border border-green-500/30'\n                  : 'bg-gradient-to-r from-[#00f3ff] to-[#00c4cc] text-black hover:shadow-[0_0_20px_rgba(0,243,255,0.3)]'\n              } disabled:opacity-50 disabled:cursor-not-allowed`}\n            >\n              {isDetecting ? (\n                <>\n                  <Loader2 className=\"w-4 h-4 animate-spin\" />\n                  Detecting...\n                </>\n              ) : hasAutoDetected ? (\n                <>\n                  <Check className=\"w-4 h-4\" />\n                  Detected - Adjust if needed\n                </>\n              ) : (\n                <>\n                  <Scan className=\"w-4 h-4\" />\n                  Auto-Detect Landmarks\n                </>\n              )}\n            </button>\n\n            {/* Auto-Zoom Toggle */}\n            <button\n              onClick={() => setAutoZoomEnabled(!autoZoomEnabled)}\n              className={`w-full py-2.5 rounded-lg text-xs font-medium transition-all flex items-center justify-center gap-2 ${\n                autoZoomEnabled\n                  ? 'bg-[#00f3ff] text-black'\n                  : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n              }`}\n            >\n              <Focus className=\"w-4 h-4\" />\n              {autoZoomEnabled ? 'Auto-Zoom: ON' : 'Auto-Zoom: OFF'}\n            </button>\n\n          </div>\n        </div>\n\n        {/* Main Image Area */}\n        <div className=\"flex-1 min-h-0 relative md:order-1 flex flex-col\">\n          <div\n            ref={containerRef}\n            className=\"relative flex-1 bg-neutral-900 overflow-hidden rounded-xl border border-neutral-800 select-none\"\n            onMouseDown={handleMouseDown}\n            onMouseMove={handleMouseMove}\n            onMouseUp={handleMouseUp}\n            onMouseLeave={handleMouseUp}\n            style={{\n              cursor: isDragging ? 'grabbing' : 'grab',\n            }}\n          >\n            {/* Transformed Content - Image and placed landmarks move together */}\n            <div\n              className=\"absolute inset-0\"\n              style={{\n                transform: `translate(${pan.x}px, ${pan.y}px) scale(${zoomLevel})`,\n                transformOrigin: '0 0',\n              }}\n            >\n              {/* User's Image */}\n              <Image\n                src={imageUrl}\n                alt=\"Your photo\"\n                fill\n                className=\"object-contain pointer-events-none select-none\"\n                unoptimized\n                draggable={false}\n              />\n\n              {/* Placed landmarks - always visible as they're placed */}\n              {landmarks.filter(lm => placedLandmarks.has(lm.id) && lm.id !== currentLandmarkId).map((landmark) => {\n                const lmColor = getLandmarkColor(landmark.id, categories);\n                const pos = getLandmarkPixelPosition(landmark.x, landmark.y);\n\n                return (\n                  <div\n                    key={landmark.id}\n                    className=\"absolute pointer-events-none\"\n                    style={{\n                      left: pos.left,\n                      top: pos.top,\n                      transform: `translate(-50%, -50%) scale(${1 / zoomLevel})`,\n                      transformOrigin: 'center center',\n                    }}\n                  >\n                    {/* Small persistent dot - matches FaceIQ style */}\n                    <div\n                      className=\"absolute rounded-full\"\n                      style={{\n                        width: 8,\n                        height: 8,\n                        left: -4,\n                        top: -4,\n                        backgroundColor: lmColor,\n                        boxShadow: `0 0 4px ${lmColor}, 0 0 8px ${lmColor}60`,\n                        border: '1px solid rgba(255,255,255,0.5)',\n                      }}\n                    />\n                  </div>\n                );\n              })}\n\n              {/* Frankfort Horizontal Plane - green reference line for side profiles */}\n              {mode === 'side' && frankfortPlane && (\n                <svg\n                  className=\"absolute inset-0 pointer-events-none\"\n                  style={{ width: '100%', height: '100%' }}\n                >\n                  {(() => {\n                    const bounds = getImageBounds();\n                    const orbitaleX = bounds.offsetX + frankfortPlane.orbitale.x * bounds.renderedWidth;\n                    const orbitaleY = bounds.offsetY + frankfortPlane.orbitale.y * bounds.renderedHeight;\n                    const porionX = bounds.offsetX + frankfortPlane.porion.x * bounds.renderedWidth;\n                    const porionY = bounds.offsetY + frankfortPlane.porion.y * bounds.renderedHeight;\n\n                    // Extend the line beyond the points for visibility\n                    const dx = porionX - orbitaleX;\n                    const dy = porionY - orbitaleY;\n                    const length = Math.sqrt(dx * dx + dy * dy);\n                    const extendFactor = length > 0 ? 0.3 : 0;\n                    const startX = orbitaleX - (dx / length) * bounds.renderedWidth * extendFactor;\n                    const startY = orbitaleY - (dy / length) * bounds.renderedWidth * extendFactor;\n                    const endX = porionX + (dx / length) * bounds.renderedWidth * extendFactor;\n                    const endY = porionY + (dy / length) * bounds.renderedWidth * extendFactor;\n\n                    return (\n                      <>\n                        {/* Main Frankfort line */}\n                        <line\n                          x1={startX}\n                          y1={startY}\n                          x2={endX}\n                          y2={endY}\n                          stroke=\"#22c55e\"\n                          strokeWidth={2 / zoomLevel}\n                          strokeDasharray={`${6 / zoomLevel} ${4 / zoomLevel}`}\n                          opacity={0.8}\n                        />\n                        {/* Orbitale point marker */}\n                        <circle\n                          cx={orbitaleX}\n                          cy={orbitaleY}\n                          r={4 / zoomLevel}\n                          fill=\"#22c55e\"\n                          stroke=\"white\"\n                          strokeWidth={1 / zoomLevel}\n                        />\n                        {/* Porion point marker */}\n                        <circle\n                          cx={porionX}\n                          cy={porionY}\n                          r={4 / zoomLevel}\n                          fill=\"#22c55e\"\n                          stroke=\"white\"\n                          strokeWidth={1 / zoomLevel}\n                        />\n                        {/* Angle indicator */}\n                        <text\n                          x={startX}\n                          y={startY - 10 / zoomLevel}\n                          fill=\"#22c55e\"\n                          fontSize={12 / zoomLevel}\n                          fontWeight=\"bold\"\n                        >\n                          FH: {frankfortPlane.angle.toFixed(1)}°\n                        </text>\n                      </>\n                    );\n                  })()}\n                </svg>\n              )}\n            </div>\n\n            {/* FIXED CENTER TARGETING DOT - small precise point for accurate placement */}\n            <div className=\"absolute inset-0 pointer-events-none flex items-center justify-center z-20\">\n              {/* Crosshair lines for precision */}\n              <div\n                className=\"absolute\"\n                style={{\n                  width: 20,\n                  height: 1,\n                  backgroundColor: '#00f3ff',\n                  opacity: 0.6,\n                }}\n              />\n              <div\n                className=\"absolute\"\n                style={{\n                  width: 1,\n                  height: 20,\n                  backgroundColor: '#00f3ff',\n                  opacity: 0.6,\n                }}\n              />\n              {/* Subtle glow ring */}\n              <div\n                className=\"absolute rounded-full\"\n                style={{\n                  width: 12,\n                  height: 12,\n                  background: 'radial-gradient(circle, #00f3ff33 0%, transparent 70%)',\n                }}\n              />\n              {/* Center dot - small and precise */}\n              <div\n                className=\"relative rounded-full\"\n                style={{\n                  width: 4,\n                  height: 4,\n                  backgroundColor: '#00f3ff',\n                  boxShadow: '0 0 6px #00f3ff, 0 0 12px #00f3ff80',\n                }}\n              />\n            </div>\n\n            {/* Loading Overlay */}\n            {isDetecting && (\n              <div className=\"absolute inset-0 bg-black/70 flex flex-col items-center justify-center z-50\">\n                <Loader2 className=\"w-12 h-12 text-[#00f3ff] animate-spin mb-4\" />\n                <p className=\"text-white text-lg font-medium\">Detecting landmarks...</p>\n                <p className=\"text-neutral-400 text-sm mt-2\">This may take a few seconds</p>\n              </div>\n            )}\n\n            {/* Detection Failed Banner */}\n            {detectionFailed && !isDetecting && (\n              <motion.div\n                initial={{ opacity: 0, y: -20 }}\n                animate={{ opacity: 1, y: 0 }}\n                className=\"absolute top-12 left-3 right-3 z-30\"\n              >\n                <div className=\"bg-amber-500/20 border border-amber-500/50 rounded-lg px-3 py-2 flex items-center gap-2\">\n                  <AlertTriangle className=\"w-4 h-4 text-amber-400 flex-shrink-0\" />\n                  <p className=\"text-amber-200 text-xs flex-1\">\n                    {mode === 'side'\n                      ? 'Auto-detection could not find profile. Please place landmarks manually for best accuracy.'\n                      : 'Could not detect face. Please place landmarks manually.'}\n                  </p>\n                  <button\n                    onClick={() => setDetectionFailed(false)}\n                    className=\"text-amber-400 hover:text-amber-200 transition-colors\"\n                  >\n                    <X className=\"w-4 h-4\" />\n                  </button>\n                </div>\n              </motion.div>\n            )}\n\n            {/* Zoom indicator */}\n            <div className=\"absolute top-3 left-3 px-3 py-1.5 rounded-lg bg-black/80 border border-neutral-700 text-white text-xs flex items-center gap-2\">\n              <Move className=\"w-3 h-3\" />\n              {zoomLevel.toFixed(1)}x - Drag to align\n            </div>\n\n            {/* Current landmark label overlay */}\n            <div className=\"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black via-black/80 to-transparent p-4 pointer-events-none\">\n              <p className=\"text-center text-white text-sm font-medium\">\n                Drag image to align:{' '}\n                <span className=\"font-semibold\" style={{ color }}>{currentLandmark?.label}</span>\n              </p>\n              <p className=\"text-center text-neutral-400 text-xs mt-1\">\n                Press Enter or click Next to confirm\n              </p>\n            </div>\n          </div>\n\n          {/* Navigation Bar - Fixed at bottom of image area */}\n          <div className=\"mt-3 flex items-center justify-center gap-3\">\n            <button\n              onClick={handlePrevious}\n              className=\"p-2.5 rounded-xl bg-neutral-800 text-neutral-300 hover:bg-neutral-700 border border-neutral-700 transition-all\"\n            >\n              <ChevronLeft className=\"w-5 h-5\" />\n            </button>\n\n            {/* Step dots - show current position indicator */}\n            <div className=\"flex items-center gap-2 px-4 py-2 bg-neutral-900 rounded-xl border border-neutral-800\">\n              <span className=\"text-xs text-neutral-400 font-mono min-w-[4ch]\">\n                {currentStepIndex + 1}\n              </span>\n              <div className=\"w-32 h-1.5 bg-neutral-800 rounded-full overflow-hidden\">\n                <div\n                  className=\"h-full bg-[#00f3ff] rounded-full transition-all duration-200\"\n                  style={{ width: `${((currentStepIndex + 1) / totalSteps) * 100}%` }}\n                />\n              </div>\n              <span className=\"text-xs text-neutral-400 font-mono min-w-[4ch] text-right\">\n                {totalSteps}\n              </span>\n            </div>\n\n            <button\n              onClick={handleNext}\n              className={`flex items-center gap-2 px-5 py-2.5 rounded-xl font-medium text-sm transition-all ${\n                currentStepIndex === totalSteps - 1\n                  ? 'bg-green-500 text-white hover:bg-green-600'\n                  : 'bg-[#00f3ff] text-black hover:shadow-[0_0_20px_rgba(0,243,255,0.4)]'\n              }`}\n            >\n              {currentStepIndex === totalSteps - 1 ? (\n                <>\n                  <Check className=\"w-4 h-4\" />\n                  Complete\n                </>\n              ) : (\n                <>\n                  Next\n                  <ChevronRight className=\"w-4 h-4\" />\n                </>\n              )}\n            </button>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n","numLines":971,"startLine":1,"totalLines":971}}}
{"parentUuid":"7171bc25-73dc-4671-9578-9afb6208b863","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"e4dc6512-abf0-459a-80ba-d5664c1601bd","version":"2.0.70","gitBranch":"main","agentId":"a00f8c1","slug":"peaceful-munching-robin","message":{"model":"claude-opus-4-5-20251101","id":"msg_01VLe3XFTKmHnL7sb3xPvK2N","type":"message","role":"assistant","content":[{"type":"text","text":"Now I have a comprehensive understanding of the codebase. Let me create the detailed implementation plan for replicating FaceIQ's results page UI.\n\n---\n\n# Comprehensive Implementation Plan: FaceIQ-Style Results Page UI\n\n## Executive Summary\n\nThis plan outlines the implementation of a FaceIQ-style results page for the LOOKSMAXX Next.js app. The implementation will transform the existing `ResultsDashboard.tsx` into a full-featured, tabbed results experience with expandable measurement cards, face visualization overlays, strength/flaw cards, and personalized recommendations.\n\n---\n\n## Phase 1: Data Model & Type Definitions\n\n### 1.1 Create New Type Definitions\n\n**File: `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/types/results.ts`** (new file)\n\nThis file should define all FaceIQ-compatible result types:\n\n```typescript\n// Core result types matching the requirement\ninterface Ratio {\n  name: string;\n  value: number;\n  score: number;  // 0-10 scale\n  standardizedScore: number;\n  unit: 'x' | 'mm' | '%' | '°';\n  idealMin: number;\n  idealMax: number;\n  rangeMin: number;\n  rangeMax: number;\n  description: string;\n  illustration: {\n    points: Record<string, { x: number; y: number; label: string }>;\n    lines: Record<string, { start: string; end: string; color: string }>;\n  };\n  mayIndicateFlaws: string[];\n  mayIndicateStrengths: string[];\n  category: string;\n}\n\ninterface Strength {\n  strengthName: string;\n  summary: string;\n  avgScore: number;\n  qualityLevel: 'ideal' | 'good' | 'fair' | 'poor';\n  categoryName: string;\n  responsibleRatios: { ratioName: string; score: number }[];\n}\n\ninterface Flaw {\n  flawName: string;\n  summary: string;\n  harmonyPercentageLost: number;\n  standardizedImpact: number;\n  categoryName: string;\n  responsibleRatios: { ratioName: string; score: number }[];\n}\n\ninterface Recommendation {\n  ref_id: string;\n  name: string;\n  description: string;\n  phase: 'Surgical' | 'Minimally Invasive' | 'Foundational';\n  impact: number;\n  coverage: number;\n  matchedFlaws: string[];\n  matchedRatios: string[];\n  timeline: { effect_start: string; full_results_weeks: number };\n  cost: { type: string; min: number; max: number; currency: string };\n  risks_side_effects: string | null;\n}\n```\n\n### 1.2 Extend FaceIQ Scoring\n\n**File: `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts`** (modify)\n\nAdd functions to:\n1. Map existing `FaceIQScoreResult` to the new `Ratio` interface\n2. Generate illustration data (points/lines) for each measurement\n3. Add `mayIndicateFlaws` and `mayIndicateStrengths` mappings per metric\n\nKey additions:\n- `generateRatioFromMetric(result: FaceIQScoreResult, landmarks: LandmarkPoint[]): Ratio`\n- `METRIC_FLAW_MAPPINGS: Record<string, { low: string[]; high: string[] }>`\n- `METRIC_STRENGTH_MAPPINGS: Record<string, { low: string[]; high: string[] }>`\n- `generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Illustration`\n\n---\n\n## Phase 2: Component Architecture\n\n### 2.1 Main Results Page Structure\n\n**File: `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/results/page.tsx`** (new file - dedicated results route)\n\nStructure:\n```\n<ResultsPage>\n  <ResultsSidebar> (collapsible on mobile)\n    <ProfilePhoto with landmark toggle>\n    <NavigationTabs>\n  </ResultsSidebar>\n  <ResultsMainContent>\n    <TabContent varies by tab>\n  </ResultsMainContent>\n</ResultsPage>\n```\n\n### 2.2 Component Hierarchy\n\n```\nsrc/components/results/\n├── ResultsLayout.tsx           # Main layout with sidebar + content\n├── ResultsSidebar.tsx          # Left sidebar with photo + nav\n├── ResultsTabNavigation.tsx    # Tab buttons (Overview, Front, Side, Plan, Options, Support)\n├── tabs/\n│   ├── OverviewTab.tsx         # Harmony score summary + strengths/flaws\n│   ├── FrontRatiosTab.tsx      # 33 front profile measurements\n│   ├── SideRatiosTab.tsx       # 33 side profile measurements\n│   ├── PlanTab.tsx             # Recommendations + potential\n│   ├── OptionsTab.tsx          # Settings/preferences\n│   └── SupportTab.tsx          # Help section\n├── cards/\n│   ├── HarmonyScoreCard.tsx    # Overall score display (0-10)\n│   ├── ProfileScoreCard.tsx    # Front/Side individual scores\n│   ├── MeasurementCard.tsx     # Individual ratio card (expandable)\n│   ├── StrengthCard.tsx        # Strength display card (expandable)\n│   ├── FlawCard.tsx            # Flaw display card (expandable)\n│   └── RecommendationCard.tsx  # Procedure recommendation card\n├── visualization/\n│   ├── FaceOverlay.tsx         # Photo with landmark overlay\n│   ├── MeasurementLines.tsx    # Lines connecting measurement points\n│   ├── IdealRangeBar.tsx       # Horizontal bar showing ideal range\n│   └── ScoringCurve.tsx        # Bell curve for measurement\n└── shared/\n    ├── QualityBadge.tsx        # ideal/good/fair/poor badge\n    ├── PhaseBadge.tsx          # Surgical/Minimally Invasive/Foundational\n    ├── ScoreCircle.tsx         # Circular score display\n    └── ExpandableSection.tsx   # Generic expand/collapse wrapper\n```\n\n---\n\n## Phase 3: Component Implementation Details\n\n### 3.1 ResultsLayout.tsx\n\n**Purpose:** Main layout wrapper with responsive sidebar behavior\n\n**Key features:**\n- Desktop: Fixed 280px sidebar on left, scrollable main content\n- Mobile: Collapsible sidebar (hamburger menu or bottom sheet)\n- Smooth tab transitions with Framer Motion\n\n**Implementation approach:**\n```tsx\n// Responsive layout using Tailwind\n<div className=\"flex min-h-screen bg-black\">\n  {/* Sidebar - hidden on mobile, shown on md+ */}\n  <aside className=\"hidden md:flex md:w-[280px] md:flex-col md:fixed md:inset-y-0 bg-neutral-900 border-r border-neutral-800\">\n    <ResultsSidebar />\n  </aside>\n  {/* Mobile header */}\n  <header className=\"md:hidden fixed top-0 w-full bg-neutral-900 border-b border-neutral-800 z-50\">\n    <MobileHeader onMenuClick={() => setMobileMenuOpen(true)} />\n  </header>\n  {/* Main content */}\n  <main className=\"flex-1 md:pl-[280px]\">\n    <AnimatePresence mode=\"wait\">\n      {renderTabContent(activeTab)}\n    </AnimatePresence>\n  </main>\n</div>\n```\n\n### 3.2 MeasurementCard.tsx (Critical Component)\n\n**Purpose:** Display individual ratio with expandable detail view\n\n**Collapsed state shows:**\n- Ratio name\n- Current value + unit\n- Score out of 10 (with color coding)\n- Ideal range indicator bar\n\n**Expanded state adds:**\n- Full description (\"About this ratio\")\n- Landmark visualization on face image\n- May indicate strengths/flaws\n- Scoring curve visualization\n- Category tag\n\n**Implementation approach:**\n```tsx\ninterface MeasurementCardProps {\n  ratio: Ratio;\n  faceImage: string;\n  landmarks: LandmarkPoint[];\n  isExpanded: boolean;\n  onToggle: () => void;\n}\n\n// Color logic based on score\nconst getScoreColor = (score: number): string => {\n  if (score >= 8) return '#67e8f9'; // Cyan - ideal\n  if (score >= 6) return '#22c55e'; // Green - good\n  if (score >= 4) return '#fbbf24'; // Yellow - fair\n  return 'rgb(227, 67, 67)';        // Red - poor\n};\n```\n\n### 3.3 IdealRangeBar.tsx\n\n**Purpose:** Visual indicator showing value position within ideal/acceptable range\n\n**Design:**\n- Full bar represents rangeMin to rangeMax\n- Colored middle section represents idealMin to idealMax (green)\n- Marker shows current value position\n- Labels for key values\n\n```tsx\n// Visual representation\n[rangeMin]---[idealMin ====== idealMax]---[rangeMax]\n                        ^\n                    yourValue\n```\n\n### 3.4 StrengthCard.tsx and FlawCard.tsx\n\n**Purpose:** Display strength/flaw with responsible ratios\n\n**Key features:**\n- Name and summary\n- Average score / impact level\n- Quality level badge (ideal/good/fair/poor)\n- Category tag with appropriate color\n- Expandable to show related ratios\n\n**Color scheme from requirement:**\n- Strengths: Green-cyan gradient backgrounds\n- Flaws: Red-orange gradient backgrounds\n\n### 3.5 RecommendationCard.tsx\n\n**Purpose:** Display treatment/procedure recommendation\n\n**Collapsed shows:**\n- Name + phase badge\n- Impact score (0-1) with progress bar\n- Coverage percentage (metrics improved)\n- Cost range\n\n**Expanded adds:**\n- Full description\n- Matched flaws list\n- Matched ratios list\n- Timeline info\n- Risk/side effects\n- Before/after expectations\n\n### 3.6 FaceOverlay.tsx\n\n**Purpose:** Show user's photo with toggleable measurement overlays\n\n**Features:**\n- Display user's uploaded photo\n- Toggle specific measurement lines on/off\n- Highlight relevant landmarks when measurement selected\n- Lines with configurable colors per category\n- Animation when toggling\n\n**Implementation approach:**\n```tsx\n// SVG overlay on top of image\n<div className=\"relative\">\n  <Image src={userPhoto} alt=\"Your face\" />\n  <svg className=\"absolute inset-0\">\n    {selectedMeasurement && (\n      <MeasurementLines\n        points={selectedMeasurement.illustration.points}\n        lines={selectedMeasurement.illustration.lines}\n        landmarks={landmarks}\n      />\n    )}\n  </svg>\n</div>\n```\n\n---\n\n## Phase 4: Tab Content Implementation\n\n### 4.1 OverviewTab.tsx\n\n**Layout:**\n```\n[Harmony Score Card - Large centered]\n  7.42 / 10\n\n[Front Score Card] [Side Score Card]\n     6.85              8.12\n\n[Strengths Section]\n  - 3-5 StrengthCards in grid\n\n[Flaws Section]\n  - 3-5 FlawCards in grid\n\n[Quick Actions]\n  - \"See Your Plan\" CTA button\n```\n\n### 4.2 FrontRatiosTab.tsx and SideRatiosTab.tsx\n\n**Layout:**\n```\n[Score Summary Banner]\n  Front Profile: 6.85/10\n\n[Category Filter Pills]\n  All | Midface | Eyes | Nose | Lips | Jaw | Chin\n\n[Measurement Grid]\n  <MeasurementCard /> x 33 (filterable by category)\n\n[Face Visualization Panel] (sticky on desktop)\n  <FaceOverlay with selected measurement highlighted />\n```\n\n**Key features:**\n- Filter by category\n- Click measurement to see on face\n- Lazy load cards for performance\n- Virtual scrolling for large lists\n\n### 4.3 PlanTab.tsx\n\n**Layout:**\n```\n[Current vs Potential Score]\n  Current PSL: 5.2 → Potential: 6.8 (+1.6)\n\n[Recommendation Categories Tabs]\n  Foundational | Non-Surgical | Surgical\n\n[Recommendations Grid]\n  <RecommendationCard /> sorted by impact\n\n[Order of Operations Timeline]\n  1. Start with foundational...\n  2. Then non-surgical...\n  3. Consider surgical...\n```\n\n**Integration with existing recommendations:**\n- Use `/src/lib/recommendations/engine.ts` `generateRecommendationPlan()`\n- Map `TreatmentRecommendation` to new `Recommendation` interface\n- Add phase categorization\n\n---\n\n## Phase 5: Data Flow & State Management\n\n### 5.1 Results Context\n\n**File: `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx`** (new file)\n\n```tsx\ninterface ResultsContextType {\n  // Raw data\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  gender: 'male' | 'female';\n  frontPhoto: string;\n  sidePhoto: string;\n\n  // Computed results\n  harmonyAnalysis: HarmonyAnalysis;\n  frontRatios: Ratio[];\n  sideRatios: Ratio[];\n  strengths: Strength[];\n  flaws: Flaw[];\n  recommendations: Recommendation[];\n\n  // UI state\n  activeTab: TabType;\n  setActiveTab: (tab: TabType) => void;\n  expandedMeasurementId: string | null;\n  setExpandedMeasurementId: (id: string | null) => void;\n  selectedVisualizationMetric: string | null;\n  setSelectedVisualizationMetric: (id: string | null) => void;\n}\n```\n\n### 5.2 Data Transformation Pipeline\n\n```\n1. LandmarkPoint[] from analysis\n        ↓\n2. analyzeFrontProfile() / analyzeSideProfile() from faceiq-scoring.ts\n        ↓\n3. FaceIQScoreResult[] \n        ↓\n4. Transform to Ratio[] with illustration data\n        ↓\n5. analyzeHarmony() → flaws/strengths\n        ↓\n6. generateRecommendationPlan() → recommendations\n        ↓\n7. ResultsContext provides to all components\n```\n\n---\n\n## Phase 6: Styling & Design System\n\n### 6.1 Color Palette (from requirements)\n\nAdd to `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/globals.css`:\n\n```css\n:root {\n  /* Existing colors... */\n\n  /* FaceIQ Score Colors */\n  --score-ideal: #67e8f9;      /* Cyan */\n  --score-good: #22c55e;       /* Green */\n  --score-fair: #fbbf24;       /* Yellow/Amber */\n  --score-poor: rgb(227, 67, 67); /* Red */\n\n  /* Primary accent (Discord Blue) */\n  --primary-faceiq: #5865F2;\n\n  /* Category colors (from MEASUREMENT_CATEGORIES) */\n  --cat-midface: #67e8f9;\n  --cat-jaw-growth: #a78bfa;\n  --cat-jaw-shape: #f97316;\n  --cat-upper-third: #84cc16;\n  --cat-eyes: #06b6d4;\n  --cat-nose: #fbbf24;\n  --cat-lips: #ec4899;\n  --cat-chin: #ef4444;\n  --cat-neck: #14b8a6;\n}\n```\n\n### 6.2 Component Utilities\n\nAdd to Tailwind config or globals.css:\n\n```css\n@layer components {\n  /* Score display variants */\n  .score-ideal { @apply text-[#67e8f9] bg-[#67e8f9]/10; }\n  .score-good { @apply text-[#22c55e] bg-[#22c55e]/10; }\n  .score-fair { @apply text-[#fbbf24] bg-[#fbbf24]/10; }\n  .score-poor { @apply text-[rgb(227,67,67)] bg-[rgb(227,67,67)]/10; }\n\n  /* Card variants */\n  .results-card {\n    @apply bg-neutral-900/80 border border-neutral-800 rounded-xl;\n    @apply hover:border-neutral-700 transition-all duration-200;\n  }\n\n  .results-card-expandable {\n    @apply results-card cursor-pointer;\n  }\n\n  /* Badge variants */\n  .badge-phase-surgical { @apply bg-red-500/20 text-red-400 border-red-500/30; }\n  .badge-phase-minimally { @apply bg-amber-500/20 text-amber-400 border-amber-500/30; }\n  .badge-phase-foundational { @apply bg-green-500/20 text-green-400 border-green-500/30; }\n}\n```\n\n---\n\n## Phase 7: Animation & Interactions\n\n### 7.1 Framer Motion Variants\n\n**File: `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/animations.ts`** (new file)\n\n```typescript\nexport const cardExpandVariants = {\n  collapsed: { height: 'auto', opacity: 1 },\n  expanded: {\n    height: 'auto',\n    opacity: 1,\n    transition: { duration: 0.3, ease: 'easeInOut' }\n  }\n};\n\nexport const tabContentVariants = {\n  initial: { opacity: 0, x: 20 },\n  animate: { opacity: 1, x: 0 },\n  exit: { opacity: 0, x: -20 }\n};\n\nexport const scoreCountUpVariants = {\n  initial: { scale: 0.8, opacity: 0 },\n  animate: {\n    scale: 1,\n    opacity: 1,\n    transition: { duration: 0.5, ease: 'easeOut' }\n  }\n};\n\nexport const staggerContainerVariants = {\n  animate: {\n    transition: { staggerChildren: 0.05 }\n  }\n};\n\nexport const staggerItemVariants = {\n  initial: { opacity: 0, y: 20 },\n  animate: { opacity: 1, y: 0 }\n};\n```\n\n### 7.2 Key Interactions\n\n1. **Card expansion:** Click to expand/collapse with height animation\n2. **Tab switching:** Crossfade with slight horizontal slide\n3. **Score appearance:** Count-up animation for numerical scores\n4. **Face overlay:** Fade in/out measurement lines when selected\n5. **List stagger:** Cards appear with staggered animation\n\n---\n\n## Phase 8: Implementation Order\n\n### Sprint 1: Foundation (Days 1-2)\n1. Create type definitions (`src/types/results.ts`)\n2. Extend `faceiq-scoring.ts` with new utility functions\n3. Create `ResultsContext.tsx`\n4. Set up `/app/results/page.tsx` with basic routing\n\n### Sprint 2: Core Components (Days 3-5)\n1. `ResultsLayout.tsx` with responsive sidebar\n2. `ResultsTabNavigation.tsx`\n3. `HarmonyScoreCard.tsx` with count-up animation\n4. `MeasurementCard.tsx` (collapsed state)\n5. `IdealRangeBar.tsx`\n6. `QualityBadge.tsx`, `PhaseBadge.tsx`, `ScoreCircle.tsx`\n\n### Sprint 3: Tab Content (Days 6-8)\n1. `OverviewTab.tsx` with score cards grid\n2. `FrontRatiosTab.tsx` with filtering\n3. `SideRatiosTab.tsx`\n4. `StrengthCard.tsx` and `FlawCard.tsx`\n\n### Sprint 4: Advanced Features (Days 9-11)\n1. `MeasurementCard.tsx` expanded state\n2. `FaceOverlay.tsx` with SVG lines\n3. `MeasurementLines.tsx`\n4. `ScoringCurve.tsx` (using existing BellCurveChart as reference)\n\n### Sprint 5: Plan & Polish (Days 12-14)\n1. `PlanTab.tsx`\n2. `RecommendationCard.tsx`\n3. `OptionsTab.tsx` and `SupportTab.tsx`\n4. Mobile responsive refinements\n5. Animation polish\n6. Performance optimization (lazy loading, memoization)\n\n---\n\n## Phase 9: Integration Points\n\n### 9.1 Connecting to Existing Code\n\n1. **From `analysis/page.tsx`:**\n   - After landmark placement complete, navigate to `/results`\n   - Pass landmarks via context or route state\n\n2. **From `faceiq-scoring.ts`:**\n   - Use `analyzeHarmony()` for overall analysis\n   - Use `FACEIQ_METRICS` for metric configurations\n   - Use `MEASUREMENT_CATEGORIES` for category colors\n\n3. **From `recommendations/engine.ts`:**\n   - Use `generateRecommendationPlan()` for plan tab\n   - Map `TreatmentRecommendation` to FaceIQ-style format\n\n4. **From `BellCurveChart.tsx`:**\n   - Reuse or extend for measurement scoring curves\n\n### 9.2 Data Flow Modification\n\nModify `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/analysis/page.tsx`:\n\n```tsx\n// After completing analysis, navigate to results\nconst handleAnalysisComplete = () => {\n  // Store results in context or localStorage\n  setResultsData({\n    frontLandmarks,\n    sideLandmarks,\n    frontPhoto: frontPhoto.preview,\n    sidePhoto: sidePhoto?.preview,\n    gender\n  });\n  router.push('/results');\n};\n```\n\n---\n\n## Phase 10: Illustration Data Generation\n\n### 10.1 Metric-to-Landmark Mappings\n\n**File: `/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/metricIllustrations.ts`** (new file)\n\nDefine which landmarks and lines to show for each measurement:\n\n```typescript\nexport const METRIC_ILLUSTRATIONS: Record<string, {\n  points: string[];  // Landmark IDs to highlight\n  lines: Array<{ from: string; to: string; color: string }>;\n  description: string;\n}> = {\n  faceWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'nasal_base', 'labrale_superius'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', color: '#67e8f9' },\n      { from: 'nasal_base', to: 'labrale_superius', color: '#67e8f9' }\n    ],\n    description: 'Ratio of bizygomatic width to upper face height'\n  },\n  lateralCanthalTilt: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', color: '#06b6d4' }\n    ],\n    description: 'Angle from inner to outer corner of the eye'\n  },\n  gonialAngle: {\n    points: ['tragus', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'tragus', to: 'gonionBottom', color: '#a78bfa' },\n      { from: 'gonionBottom', to: 'menton', color: '#a78bfa' }\n    ],\n    description: 'Angle at the jaw corner (gonion)'\n  },\n  // ... 70+ more metrics\n};\n```\n\n---\n\n## Key Dependencies & Considerations\n\n### Existing Dependencies (Already Installed)\n- `framer-motion` - animations\n- `lucide-react` - icons\n- `recharts` - charts (for bell curves)\n- `clsx` - conditional classes\n\n### No New Dependencies Required\nAll features can be implemented with existing packages.\n\n### Performance Considerations\n1. Use `useMemo` for expensive computations (ratio transformations)\n2. Lazy load tab content that's not currently visible\n3. Use `React.memo` for card components\n4. Consider virtual scrolling for 33+ measurement lists\n\n### Accessibility\n1. Ensure proper ARIA labels on expandable cards\n2. Keyboard navigation for tabs\n3. Color-blind friendly score indicators (use icons + colors)\n4. Screen reader announcements for score changes\n\n---\n\n### Critical Files for Implementation\n\n1. **`/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/faceiq-scoring.ts`** - Core scoring logic to extend with illustration data and flaw/strength mappings. Contains 70+ metrics with ideal ranges.\n\n2. **`/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/ResultsDashboard.tsx`** - Existing results component to either replace or use as reference for the new tabbed UI. Contains MeasurementCard and scoring display patterns.\n\n3. **`/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/recommendations/engine.ts`** - Recommendation generation engine to integrate with Plan tab. Already has `generateRecommendationPlan()` function.\n\n4. **`/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/lib/landmarks.ts`** - Landmark definitions needed for illustration overlays. Contains both front (52 points) and side (28 points) landmarks.\n\n5. **`/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/BellCurveChart.tsx`** - Existing chart component to reuse/extend for measurement scoring curves."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":38016,"cache_read_input_tokens":89525,"cache_creation":{"ephemeral_5m_input_tokens":38016,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWJCp55rigJ5tWHrxsnQ7","type":"assistant","uuid":"0263dd41-76e5-4e03-a402-1c72d26ef8a0","timestamp":"2025-12-20T15:51:57.517Z"}
