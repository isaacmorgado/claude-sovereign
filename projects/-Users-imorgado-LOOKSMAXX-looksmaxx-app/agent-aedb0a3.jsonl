{"parentUuid":null,"isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","type":"user","message":{"role":"user","content":"Redesign /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/PlanTab.tsx to match this premium design style from the FAQ/Sources pages:\n\nDESIGN PATTERNS TO APPLY:\n1. Headers: `text-3xl font-black tracking-tighter italic uppercase` with cyan accent spans\n2. Section headers: `text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600` with divider line (`flex-1 h-px bg-neutral-800`)\n3. Cards: `rounded-2xl bg-neutral-900/40 border border-white/5 hover:border-white/10`\n4. Badges: `font-black uppercase tracking-wider rounded-lg` with subtle bg and border\n5. Labels: `text-[10px] font-bold uppercase tracking-wider text-neutral-600`\n6. Buttons: `rounded-xl bg-neutral-900/50 border border-white/5` with hover states\n7. Premium containers: `rounded-[2rem] bg-neutral-900/40 border border-white/5 p-5`\n8. Icons in boxes: `w-10 h-10 rounded-xl bg-neutral-900 border border-white/10 flex items-center justify-center`\n\nMake sure to:\n- Update all badges to use UPPERCASE text with tracking-wider\n- Use consistent rounded-xl or rounded-2xl on cards\n- Add subtle borders with white/5 opacity\n- Use font-black for important text\n- Keep the functionality intact, just update the styling\n\nWrite the updated file directly."},"uuid":"0e759456-d2d0-4972-8a29-7ef1b4ad30fe","timestamp":"2025-12-26T20:36:38.747Z"}
{"parentUuid":"0e759456-d2d0-4972-8a29-7ef1b4ad30fe","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_01FWyj8ZJiLTEvUwmrnjKwJ1","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0186CdceEdBo7HfnakVcUfEk","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/PlanTab.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":35480,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":35480,"ephemeral_1h_input_tokens":0},"output_tokens":85,"service_tier":"standard"}},"requestId":"req_011CWVwWAyNPexbECSY5Tiaq","type":"assistant","uuid":"6fe666e9-85fe-412f-a7f0-d5773909dd8f","timestamp":"2025-12-26T20:36:44.443Z"}
{"parentUuid":"6fe666e9-85fe-412f-a7f0-d5773909dd8f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0186CdceEdBo7HfnakVcUfEk","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useState, useMemo, useCallback } from 'react';\n     4→import { motion, AnimatePresence } from 'framer-motion';\n     5→import {\n     6→  Sparkles,\n     7→  TrendingUp,\n     8→  Target,\n     9→  Zap,\n    10→  ChevronRight,\n    11→  Lock,\n    12→  CheckCircle,\n    13→  AlertCircle,\n    14→  CheckCircle2,\n    15→  Scale,\n    16→  Dumbbell,\n    17→  Salad,\n    18→  ArrowDown,\n    19→  ArrowUp,\n    20→  Minus,\n    21→  Package,\n    22→  ShoppingCart,\n    23→} from 'lucide-react';\n    24→import { useResults } from '@/contexts/ResultsContext';\n    25→import { useAuth } from '@/contexts/AuthContext';\n    26→import { usePricing } from '@/contexts/PricingContext';\n    27→import { usePhysiqueOptional } from '@/contexts/PhysiqueContext';\n    28→import { TabContent } from '../ResultsLayout';\n    29→import { EnhancedRecommendationCard } from '../cards/EnhancedRecommendationCard';\n    30→import { ScoreCircle, PhaseBadge } from '../shared';\n    31→import { BeforeAfterPreview } from '../visualization/BeforeAfterPreview';\n    32→import { FaceMorphing } from '../visualization/FaceMorphing';\n    33→import { TreatmentTimeline } from '../visualization/TreatmentTimeline';\n    34→import { RecommendationPhase, ProductRecommendation } from '@/types/results';\n    35→import { DailyStackCard } from '../cards/DailyStackCard';\n    36→import { ProductCard } from '../cards/ProductCard';\n    37→import { WeakPointCard } from '../cards/WeakPointCard';\n    38→import { ProgressComparisonCard } from '../cards/ProgressComparisonCard';\n    39→import { MedicalPrescriptionCard } from '../cards/MedicalPrescriptionCard';\n    40→import { generateDailyStack } from '@/lib/daily-stack';\n    41→import { getProductRecommendations } from '@/lib/product-recommendations';\n    42→import { SUPPLEMENTS } from '@/lib/recommendations/supplements';\n    43→import {\n    44→  TreatmentConflictList,\n    45→  SelectionWarningModal,\n    46→} from '../cards/TreatmentConflictWarning';\n    47→import {\n    48→  findTreatmentConflicts,\n    49→  type TreatmentConflict,\n    50→} from '@/lib/recommendations/engine';\n    51→\n    52→// ============================================\n    53→// POTENTIAL SCORE CARD\n    54→// ============================================\n    55→\n    56→function PotentialScoreCard() {\n    57→  const { overallScore, recommendations } = useResults();\n    58→  const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n    59→\n    60→  // Calculate potential improvement\n    61→  const potentialImprovement = useMemo(() => {\n    62→    if (recommendations.length === 0) return 0;\n    63→    const totalImpact = recommendations.slice(0, 5).reduce((sum, r) => sum + (r.impact || 0), 0);\n    64→    return Math.min(totalImpact * 1.5, 10 - numericScore);\n    65→  }, [recommendations, numericScore]);\n    66→\n    67→  const potentialScore = Math.min(10, numericScore + potentialImprovement);\n    68→\n    69→  return (\n    70→    <motion.div\n    71→      className=\"bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-2xl p-6\"\n    72→      initial={{ opacity: 0, y: 20 }}\n    73→      animate={{ opacity: 1, y: 0 }}\n    74→    >\n    75→      <div className=\"flex items-center gap-2 mb-4\">\n    76→        <Sparkles size={20} className=\"text-cyan-400\" />\n    77→        <h3 className=\"font-semibold text-white\">Your Potential</h3>\n    78→      </div>\n    79→\n    80→      <div className=\"flex items-center justify-center gap-8 mb-6\">\n    81→        {/* Current */}\n    82→        <div className=\"text-center\">\n    83→          <p className=\"text-xs text-neutral-500 mb-2\">Current</p>\n    84→          <ScoreCircle score={overallScore} size=\"lg\" animate={false} />\n    85→        </div>\n    86→\n    87→        {/* Arrow */}\n    88→        <div className=\"flex flex-col items-center gap-1\">\n    89→          <ChevronRight size={24} className=\"text-cyan-400\" />\n    90→          <span className=\"text-xs text-green-400\">+{potentialImprovement.toFixed(1)}</span>\n    91→        </div>\n    92→\n    93→        {/* Potential */}\n    94→        <div className=\"text-center\">\n    95→          <p className=\"text-xs text-neutral-500 mb-2\">Potential</p>\n    96→          <div className=\"relative\">\n    97→            <ScoreCircle score={potentialScore} size=\"lg\" animate={false} />\n    98→            <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center\">\n    99→              <TrendingUp size={12} className=\"text-black\" />\n   100→            </div>\n   101→          </div>\n   102→        </div>\n   103→      </div>\n   104→\n   105→      <p className=\"text-sm text-neutral-400 text-center\">\n   106→        Following our recommendations could improve your harmony score by up to{' '}\n   107→        <span className=\"text-green-400 font-medium\">+{potentialImprovement.toFixed(1)} points</span>\n   108→      </p>\n   109→    </motion.div>\n   110→  );\n   111→}\n   112→\n   113→// ============================================\n   114→// PHASE FILTER\n   115→// ============================================\n   116→\n   117→interface PhaseFilterProps {\n   118→  selectedPhase: RecommendationPhase | null;\n   119→  onSelect: (phase: RecommendationPhase | null) => void;\n   120→  counts: Record<RecommendationPhase, number>;\n   121→}\n   122→\n   123→function PhaseFilter({ selectedPhase, onSelect, counts }: PhaseFilterProps) {\n   124→  const phases: RecommendationPhase[] = ['Foundational', 'Minimally Invasive', 'Surgical'];\n   125→\n   126→  return (\n   127→    <div className=\"flex flex-wrap gap-2\">\n   128→      <button\n   129→        onClick={() => onSelect(null)}\n   130→        className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${selectedPhase === null\n   131→          ? 'bg-cyan-500 text-black'\n   132→          : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n   133→          }`}\n   134→      >\n   135→        All ({Object.values(counts).reduce((a, b) => a + b, 0)})\n   136→      </button>\n   137→      {phases.map(phase => (\n   138→        <button\n   139→          key={phase}\n   140→          onClick={() => onSelect(phase)}\n   141→          className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${selectedPhase === phase\n   142→            ? 'bg-neutral-700 text-white'\n   143→            : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n   144→            }`}\n   145→        >\n   146→          <PhaseBadge phase={phase} size=\"sm\" />\n   147→          ({counts[phase] || 0})\n   148→        </button>\n   149→      ))}\n   150→    </div>\n   151→  );\n   152→}\n   153→\n   154→// ============================================\n   155→// BEFORE/AFTER PREVIEW SECTION WITH MORPHING\n   156→// ============================================\n   157→\n   158→type PreviewMode = 'static' | 'morphing';\n   159→\n   160→function BeforeAfterPreviewSection() {\n   161→  const { frontPhoto, overallScore, recommendations, frontLandmarks } = useResults();\n   162→  const [previewMode, setPreviewMode] = useState<PreviewMode>('morphing');\n   163→  const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n   164→\n   165→  // Calculate potential improvement\n   166→  const potentialImprovement = useMemo(() => {\n   167→    if (recommendations.length === 0) return 0;\n   168→    const totalImpact = recommendations.slice(0, 5).reduce((sum, r) => sum + r.impact, 0);\n   169→    return Math.min(totalImpact * 1.5, 10 - numericScore);\n   170→  }, [recommendations, numericScore]);\n   171→\n   172→  const potentialScore = Math.min(10, numericScore + potentialImprovement);\n   173→\n   174→  if (!frontPhoto) return null;\n   175→\n   176→  return (\n   177→    <div className=\"space-y-3\">\n   178→      {/* Mode Toggle */}\n   179→      <div className=\"flex items-center justify-center gap-1 p-1 bg-black/40 rounded-lg border border-white/10\">\n   180→        <button\n   181→          onClick={() => setPreviewMode('morphing')}\n   182→          className={`flex-1 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${\n   183→            previewMode === 'morphing'\n   184→              ? 'bg-cyan-500/20 text-cyan-400'\n   185→              : 'text-neutral-500 hover:text-white'\n   186→          }`}\n   187→        >\n   188→          Face Morphing\n   189→        </button>\n   190→        <button\n   191→          onClick={() => setPreviewMode('static')}\n   192→          className={`flex-1 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${\n   193→            previewMode === 'static'\n   194→              ? 'bg-neutral-700 text-white'\n   195→              : 'text-neutral-500 hover:text-white'\n   196→          }`}\n   197→        >\n   198→          Static Preview\n   199→        </button>\n   200→      </div>\n   201→\n   202→      {/* Preview Component */}\n   203→      <AnimatePresence mode=\"wait\">\n   204→        {previewMode === 'morphing' && frontLandmarks.length > 0 ? (\n   205→          <motion.div\n   206→            key=\"morphing\"\n   207→            initial={{ opacity: 0, x: -20 }}\n   208→            animate={{ opacity: 1, x: 0 }}\n   209→            exit={{ opacity: 0, x: 20 }}\n   210→            transition={{ duration: 0.2 }}\n   211→          >\n   212→            <FaceMorphing\n   213→              photo={frontPhoto}\n   214→              frontLandmarks={frontLandmarks}\n   215→              currentScore={numericScore}\n   216→              potentialScore={potentialScore}\n   217→              recommendations={recommendations}\n   218→            />\n   219→          </motion.div>\n   220→        ) : (\n   221→          <motion.div\n   222→            key=\"static\"\n   223→            initial={{ opacity: 0, x: 20 }}\n   224→            animate={{ opacity: 1, x: 0 }}\n   225→            exit={{ opacity: 0, x: -20 }}\n   226→            transition={{ duration: 0.2 }}\n   227→          >\n   228→            <BeforeAfterPreview\n   229→              photo={frontPhoto}\n   230→              currentScore={numericScore}\n   231→              potentialScore={potentialScore}\n   232→              recommendations={recommendations}\n   233→            />\n   234→          </motion.div>\n   235→        )}\n   236→      </AnimatePresence>\n   237→    </div>\n   238→  );\n   239→}\n   240→\n   241→// ============================================\n   242→// ORDER OF OPERATIONS\n   243→// ============================================\n   244→\n   245→function OrderOfOperations() {\n   246→  return (\n   247→    <div className=\"bg-neutral-900/50 border border-neutral-800 rounded-xl p-4\">\n   248→      <h4 className=\"font-medium text-white mb-3 flex items-center gap-2\">\n   249→        <Target size={16} className=\"text-cyan-400\" />\n   250→        Recommended Order\n   251→      </h4>\n   252→      <div className=\"space-y-3\">\n   253→        <div className=\"flex items-start gap-3\">\n   254→          <div className=\"w-6 h-6 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0 mt-0.5\">\n   255→            <span className=\"text-xs font-bold text-green-400\">1</span>\n   256→          </div>\n   257→          <div>\n   258→            <p className=\"text-sm font-medium text-white\">Start with Foundational</p>\n   259→            <p className=\"text-xs text-neutral-500\">Low-cost, no-risk improvements that anyone can do</p>\n   260→          </div>\n   261→        </div>\n   262→        <div className=\"flex items-start gap-3\">\n   263→          <div className=\"w-6 h-6 rounded-full bg-yellow-500/20 flex items-center justify-center flex-shrink-0 mt-0.5\">\n   264→            <span className=\"text-xs font-bold text-yellow-400\">2</span>\n   265→          </div>\n   266→          <div>\n   267→            <p className=\"text-sm font-medium text-white\">Consider Minimally Invasive</p>\n   268→            <p className=\"text-xs text-neutral-500\">Temporary or reversible options with moderate impact</p>\n   269→          </div>\n   270→        </div>\n   271→        <div className=\"flex items-start gap-3\">\n   272→          <div className=\"w-6 h-6 rounded-full bg-red-500/20 flex items-center justify-center flex-shrink-0 mt-0.5\">\n   273→            <span className=\"text-xs font-bold text-red-400\">3</span>\n   274→          </div>\n   275→          <div>\n   276→            <p className=\"text-sm font-medium text-white\">Evaluate Surgical Options</p>\n   277→            <p className=\"text-xs text-neutral-500\">Permanent solutions for significant improvements</p>\n   278→          </div>\n   279→        </div>\n   280→      </div>\n   281→    </div>\n   282→  );\n   283→}\n   284→\n   285→// ============================================\n   286→// YOUR PHASE CARD (Body Composition Phase)\n   287→// ============================================\n   288→\n   289→type BodyPhase = 'bulk' | 'cut' | 'maintain';\n   290→\n   291→interface YourPhaseCardProps {\n   292→  bodyFatPercent?: number;\n   293→  gender: 'male' | 'female';\n   294→}\n   295→\n   296→function YourPhaseCard({ bodyFatPercent, gender }: YourPhaseCardProps) {\n   297→  // Determine phase based on body fat and gender\n   298→  const getPhase = (): { phase: BodyPhase; message: string; color: string; icon: React.ReactNode } => {\n   299→    if (!bodyFatPercent) {\n   300→      return {\n   301→        phase: 'maintain',\n   302→        message: 'Complete your physique analysis to get personalized phase recommendations.',\n   303→        color: 'from-neutral-700 to-neutral-800',\n   304→        icon: <Scale size={24} className=\"text-neutral-400\" />,\n   305→      };\n   306→    }\n   307→\n   308→    // Male thresholds: <12% = bulk, 12-18% = maintain, >18% = cut\n   309→    // Female thresholds: <18% = bulk, 18-25% = maintain, >25% = cut\n   310→    const bulkThreshold = gender === 'male' ? 12 : 18;\n   311→    const cutThreshold = gender === 'male' ? 18 : 25;\n   312→\n   313→    if (bodyFatPercent < bulkThreshold) {\n   314→      return {\n   315→        phase: 'bulk',\n   316→        message: `At ${bodyFatPercent.toFixed(1)}% body fat, you're lean enough to build muscle. Focus on a slight caloric surplus with progressive overload.`,\n   317→        color: 'from-green-600 to-emerald-700',\n   318→        icon: <Dumbbell size={24} className=\"text-white\" />,\n   319→      };\n   320→    } else if (bodyFatPercent > cutThreshold) {\n   321→      return {\n   322→        phase: 'cut',\n   323→        message: `At ${bodyFatPercent.toFixed(1)}% body fat, prioritize fat loss. A moderate caloric deficit with high protein will reveal your facial structure.`,\n   324→        color: 'from-orange-600 to-red-700',\n   325→        icon: <Salad size={24} className=\"text-white\" />,\n   326→      };\n   327→    } else {\n   328→      return {\n   329→        phase: 'maintain',\n   330→        message: `At ${bodyFatPercent.toFixed(1)}% body fat, you're in the optimal range. Focus on body recomposition to build muscle while staying lean.`,\n   331→        color: 'from-blue-600 to-cyan-700',\n   332→        icon: <Scale size={24} className=\"text-white\" />,\n   333→      };\n   334→    }\n   335→  };\n   336→\n   337→  const { phase, message, color, icon } = getPhase();\n   338→  const phaseLabels: Record<BodyPhase, string> = {\n   339→    bulk: 'Lean Bulk Phase',\n   340→    cut: 'Cutting Phase',\n   341→    maintain: 'Maintenance Phase',\n   342→  };\n   343→\n   344→  return (\n   345→    <motion.div\n   346→      className={`bg-gradient-to-br ${color} rounded-2xl p-6 border border-white/10`}\n   347→      initial={{ opacity: 0, y: 20 }}\n   348→      animate={{ opacity: 1, y: 0 }}\n   349→    >\n   350→      <div className=\"flex items-start gap-4\">\n   351→        <div className=\"w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center flex-shrink-0\">\n   352→          {icon}\n   353→        </div>\n   354→        <div className=\"flex-1\">\n   355→          <div className=\"flex items-center gap-2 mb-1\">\n   356→            <h3 className=\"font-semibold text-white text-lg\">Your Phase</h3>\n   357→            <div className=\"px-2 py-0.5 bg-white/20 rounded-full text-xs font-medium text-white\">\n   358→              {phaseLabels[phase]}\n   359→            </div>\n   360→          </div>\n   361→          <p className=\"text-sm text-white/80 mb-4\">{message}</p>\n   362→\n   363→          {/* Phase-specific tips */}\n   364→          <div className=\"grid grid-cols-3 gap-2\">\n   365→            <div className=\"bg-black/20 rounded-lg p-2 text-center\">\n   366→              <div className=\"flex items-center justify-center gap-1 mb-0.5\">\n   367→                {phase === 'bulk' ? (\n   368→                  <ArrowUp size={12} className=\"text-green-300\" />\n   369→                ) : phase === 'cut' ? (\n   370→                  <ArrowDown size={12} className=\"text-orange-300\" />\n   371→                ) : (\n   372→                  <Minus size={12} className=\"text-blue-300\" />\n   373→                )}\n   374→                <span className=\"text-xs text-white/60\">Calories</span>\n   375→              </div>\n   376→              <span className=\"text-sm font-medium text-white\">\n   377→                {phase === 'bulk' ? '+300' : phase === 'cut' ? '-500' : '±0'}\n   378→              </span>\n   379→            </div>\n   380→            <div className=\"bg-black/20 rounded-lg p-2 text-center\">\n   381→              <span className=\"text-xs text-white/60 block mb-0.5\">Protein</span>\n   382→              <span className=\"text-sm font-medium text-white\">\n   383→                {phase === 'cut' ? '1.2g/lb' : '1g/lb'}\n   384→              </span>\n   385→            </div>\n   386→            <div className=\"bg-black/20 rounded-lg p-2 text-center\">\n   387→              <span className=\"text-xs text-white/60 block mb-0.5\">Cardio</span>\n   388→              <span className=\"text-sm font-medium text-white\">\n   389→                {phase === 'bulk' ? 'Minimal' : phase === 'cut' ? '4-5x/wk' : '2-3x/wk'}\n   390→              </span>\n   391→            </div>\n   392→          </div>\n   393→        </div>\n   394→      </div>\n   395→    </motion.div>\n   396→  );\n   397→}\n   398→\n   399→// ============================================\n   400→// PRODUCT BUNDLE CTA\n   401→// ============================================\n   402→\n   403→interface ProductBundleCardProps {\n   404→  products: ProductRecommendation[];\n   405→  title?: string;\n   406→}\n   407→\n   408→function ProductBundleCard({ products, title = 'Recommended Bundle' }: ProductBundleCardProps) {\n   409→  // Get top 3 most important products\n   410→  const bundleProducts = products.slice(0, 3);\n   411→\n   412→  // Calculate total cost\n   413→  const totalCost = bundleProducts.reduce((sum, rec) => {\n   414→    const supplement = SUPPLEMENTS.find(s => s.id === rec.product.supplementId);\n   415→    return sum + (supplement?.costPerMonth.min || 0);\n   416→  }, 0);\n   417→\n   418→  if (bundleProducts.length === 0) return null;\n   419→\n   420→  return (\n   421→    <motion.div\n   422→      className=\"bg-gradient-to-br from-purple-900/50 to-violet-950/50 border border-purple-500/30 rounded-2xl p-6\"\n   423→      initial={{ opacity: 0, y: 20 }}\n   424→      animate={{ opacity: 1, y: 0 }}\n   425→    >\n   426→      <div className=\"flex items-center gap-2 mb-4\">\n   427→        <Package size={20} className=\"text-purple-400\" />\n   428→        <h3 className=\"font-semibold text-white\">{title}</h3>\n   429→        <div className=\"ml-auto px-2 py-0.5 bg-purple-500/20 text-purple-300 text-xs font-medium rounded-full\">\n   430→          Save 15%\n   431→        </div>\n   432→      </div>\n   433→\n   434→      <p className=\"text-sm text-neutral-300 mb-4\">\n   435→        Your analysis recommends these {bundleProducts.length} supplements - optimized for your specific weak points.\n   436→      </p>\n   437→\n   438→      {/* Bundle Items */}\n   439→      <div className=\"space-y-2 mb-4\">\n   440→        {bundleProducts.map((rec, index) => (\n   441→          <div\n   442→            key={rec.product.id}\n   443→            className=\"flex items-center gap-3 p-2 bg-black/20 rounded-lg\"\n   444→          >\n   445→            <div className=\"w-6 h-6 rounded-full bg-purple-500/30 flex items-center justify-center flex-shrink-0\">\n   446→              <span className=\"text-xs font-bold text-purple-300\">{index + 1}</span>\n   447→            </div>\n   448→            <div className=\"flex-1 min-w-0\">\n   449→              <p className=\"text-sm font-medium text-white truncate\">{rec.product.name}</p>\n   450→              <p className=\"text-xs text-neutral-400 truncate\">Targets: {rec.targetMetric}</p>\n   451→            </div>\n   452→            <div className=\"text-right flex-shrink-0\">\n   453→              <p className=\"text-sm text-white\">\n   454→                ${SUPPLEMENTS.find(s => s.id === rec.product.supplementId)?.costPerMonth.min || 0}/mo\n   455→              </p>\n   456→            </div>\n   457→          </div>\n   458→        ))}\n   459→      </div>\n   460→\n   461→      {/* Total & CTA */}\n   462→      <div className=\"border-t border-purple-500/20 pt-4\">\n   463→        <div className=\"flex items-center justify-between mb-3\">\n   464→          <span className=\"text-neutral-400\">Bundle Total</span>\n   465→          <div className=\"text-right\">\n   466→            <span className=\"text-lg font-bold text-white\">${totalCost}/mo</span>\n   467→            <span className=\"text-xs text-neutral-500 ml-2 line-through\">${Math.round(totalCost * 1.15)}/mo</span>\n   468→          </div>\n   469→        </div>\n   470→        <button\n   471→          className=\"w-full flex items-center justify-center gap-2 py-3 bg-gradient-to-r from-purple-500 to-violet-600 text-white font-medium rounded-lg hover:opacity-90 transition-opacity\"\n   472→        >\n   473→          <ShoppingCart size={18} />\n   474→          Get Your Bundle\n   475→        </button>\n   476→      </div>\n   477→    </motion.div>\n   478→  );\n   479→}\n   480→\n   481→// ============================================\n   482→// PLAN TAB\n   483→// ============================================\n   484→\n   485→export function PlanTab() {\n   486→  const { recommendations, flaws, gender, ethnicity, frontRatios, sideRatios, overallScore, frontPhoto, vision, isUnlocked } = useResults();\n   487→  const { user } = useAuth();\n   488→  const physiqueContext = usePhysiqueOptional();\n   489→  const [selectedPhase, setSelectedPhase] = useState<RecommendationPhase | null>(null);\n   490→  const [expandedId, setExpandedId] = useState<string | null>(null);\n   491→  const [completedIds, setCompletedIds] = useState<Set<string>>(new Set());\n   492→  const [removedIds, setRemovedIds] = useState<Set<string>>(new Set());\n   493→  const [previousAnalysis, setPreviousAnalysis] = useState<{\n   494→    date: string;\n   495→    overallScore: number;\n   496→    bodyFatPercent?: number;\n   497→    frontPhotoUrl?: string;\n   498→  } | null>(null);\n   499→\n   500→  // Treatment conflict state\n   501→  const [dismissedConflicts, setDismissedConflicts] = useState<Set<string>>(new Set());\n   502→  const [conflictModal, setConflictModal] = useState<{\n   503→    isOpen: boolean;\n   504→    conflict: TreatmentConflict | null;\n   505→    newTreatmentId: string;\n   506→  }>({ isOpen: false, conflict: null, newTreatmentId: '' });\n   507→\n   508→  const { openPricingModal } = usePricing();\n   509→\n   510→  // Convert to number for arithmetic operations\n   511→  const numericOverallScore = typeof overallScore === 'number' ? overallScore : 0;\n   512→\n   513→  // Check if user has a paid plan\n   514→  const hasPaidPlan = user?.plan === 'basic' || user?.plan === 'pro';\n   515→\n   516→  // Get body fat from physique analysis\n   517→  const bodyFatPercent = physiqueContext?.physiqueAnalysis?.bodyFatPercent;\n   518→\n   519→  // Generate Daily Stack for all users\n   520→  const dailyStack = useMemo(() => {\n   521→    return generateDailyStack(gender);\n   522→  }, [gender]);\n   523→\n   524→  // Generate Product Recommendations based on metrics\n   525→  const productRecommendations = useMemo(() => {\n   526→    // Build metrics and severity dictionaries from ratios\n   527→    const metricsDict: Record<string, number> = {};\n   528→    const severityDict: Record<string, string> = {};\n   529→\n   530→    [...frontRatios, ...sideRatios].forEach(ratio => {\n   531→      metricsDict[ratio.name] = typeof ratio.value === 'number' ? ratio.value : 0;\n   532→      severityDict[ratio.name] = ratio.severity;\n   533→    });\n   534→\n   535→    return getProductRecommendations(metricsDict, severityDict, gender, ethnicity);\n   536→  }, [frontRatios, sideRatios, gender, ethnicity]);\n   537→\n   538→  // Split product recommendations by state\n   539→  const { flawProducts, idealProducts } = useMemo(() => {\n   540→    const flaw = productRecommendations.filter(r => r.state === 'flaw');\n   541→    const ideal = productRecommendations.filter(r => r.state === 'ideal');\n   542→    return { flawProducts: flaw, idealProducts: ideal };\n   543→  }, [productRecommendations]);\n   544→\n   545→  // Map flaws to products and treatments\n   546→  const flawsWithProducts = useMemo(() => {\n   547→    return flaws.slice(0, 5).map(flaw => {\n   548→      // Find products that target metrics related to this flaw\n   549→      const relatedProducts = productRecommendations.filter(rec =>\n   550→        flaw && flaw.responsibleRatios && flaw.responsibleRatios.some(ratio =>\n   551→          rec.matchedMetrics.some(metric =>\n   552→            metric.toLowerCase().includes(ratio.ratioName.toLowerCase()) ||\n   553→            ratio.ratioName.toLowerCase().includes(metric.toLowerCase())\n   554→          )\n   555→        )\n   556→      );\n   557→\n   558→      // Find treatments that match this flaw\n   559→      const relatedTreatments = recommendations.filter(rec =>\n   560→        rec.matchedFlaws.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase()))\n   561→      );\n   562→\n   563→      return {\n   564→        flaw,\n   565→        products: relatedProducts.slice(0, 2),\n   566→        treatments: relatedTreatments.slice(0, 3),\n   567→      };\n   568→    });\n   569→  }, [flaws, productRecommendations, recommendations]);\n   570→\n   571→  // Handle progress photo upload\n   572→  const handleProgressPhotoUpload = useCallback(async (file: File) => {\n   573→    // Store current analysis as previous before re-analyzing\n   574→    const numScore = typeof overallScore === 'number' ? overallScore : 0;\n   575→    setPreviousAnalysis({\n   576→      date: new Date().toISOString(),\n   577→      overallScore: numScore,\n   578→      bodyFatPercent,\n   579→      frontPhotoUrl: frontPhoto || undefined,\n   580→    });\n   581→\n   582→    // In a real implementation, this would upload to API and trigger re-analysis\n   583→    console.log('Progress photo uploaded:', file.name);\n   584→  }, [overallScore, bodyFatPercent, frontPhoto]);\n   585→\n   586→  // Count recommendations by phase\n   587→  const phaseCounts = useMemo(() => {\n   588→    const counts: Record<RecommendationPhase, number> = {\n   589→      'Foundational': 0,\n   590→      'Minimally Invasive': 0,\n   591→      'Surgical': 0,\n   592→    };\n   593→    recommendations.forEach(r => {\n   594→      if (!removedIds.has(r.ref_id)) {\n   595→        counts[r.phase]++;\n   596→      }\n   597→    });\n   598→    return counts;\n   599→  }, [recommendations, removedIds]);\n   600→\n   601→  // Filter recommendations\n   602→  const filteredRecommendations = useMemo(() => {\n   603→    let filtered = recommendations.filter(r => !removedIds.has(r.ref_id));\n   604→    if (selectedPhase) {\n   605→      filtered = filtered.filter(r => r.phase === selectedPhase);\n   606→    }\n   607→    return filtered;\n   608→  }, [recommendations, selectedPhase, removedIds]);\n   609→\n   610→  const hasRecommendations = filteredRecommendations.length > 0;\n   611→\n   612→  // Detect treatment conflicts in current recommendations\n   613→  const treatmentConflicts = useMemo(() => {\n   614→    const selectedIds = filteredRecommendations.map(r => r.ref_id);\n   615→    const nameMap = Object.fromEntries(\n   616→      filteredRecommendations.map(r => [r.ref_id, r.name])\n   617→    );\n   618→    const conflicts = findTreatmentConflicts(selectedIds, nameMap);\n   619→\n   620→    // Filter out dismissed conflicts\n   621→    return conflicts.filter(c => {\n   622→      const conflictKey = `${c.treatment1Id}-${c.treatment2Id}`;\n   623→      return !dismissedConflicts.has(conflictKey);\n   624→    });\n   625→  }, [filteredRecommendations, dismissedConflicts]);\n   626→\n   627→  // Handle dismissing a conflict\n   628→  const handleDismissConflict = useCallback((conflict: TreatmentConflict) => {\n   629→    const conflictKey = `${conflict.treatment1Id}-${conflict.treatment2Id}`;\n   630→    setDismissedConflicts(prev => new Set(Array.from(prev).concat(conflictKey)));\n   631→  }, []);\n   632→\n   633→  // Handle dismissing all conflicts\n   634→  const handleDismissAllConflicts = useCallback(() => {\n   635→    const allKeys = treatmentConflicts.map(\n   636→      c => `${c.treatment1Id}-${c.treatment2Id}`\n   637→    );\n   638→    setDismissedConflicts(prev => new Set(Array.from(prev).concat(allKeys)));\n   639→  }, [treatmentConflicts]);\n   640→\n   641→  // Handle conflict modal actions\n   642→  const handleConflictProceed = useCallback(() => {\n   643→    if (conflictModal.conflict) {\n   644→      // Remove the lower priority (existing) treatment\n   645→      setRemovedIds(prev => new Set(Array.from(prev).concat(conflictModal.conflict!.treatment1Id)));\n   646→    }\n   647→    setConflictModal({ isOpen: false, conflict: null, newTreatmentId: '' });\n   648→  }, [conflictModal.conflict]);\n   649→\n   650→  const handleConflictCancel = useCallback(() => {\n   651→    setConflictModal({ isOpen: false, conflict: null, newTreatmentId: '' });\n   652→  }, []);\n   653→\n   654→  // Handle mark complete\n   655→  const handleMarkComplete = useCallback((id: string) => {\n   656→    setCompletedIds(prev => {\n   657→      const newSet = new Set(prev);\n   658→      if (newSet.has(id)) {\n   659→        newSet.delete(id);\n   660→      } else {\n   661→        newSet.add(id);\n   662→      }\n   663→      return newSet;\n   664→    });\n   665→  }, []);\n   666→\n   667→  // Handle remove\n   668→  const handleRemove = useCallback((id: string) => {\n   669→    setRemovedIds(prev => {\n   670→      const newSet = new Set(prev);\n   671→      newSet.add(id);\n   672→      return newSet;\n   673→    });\n   674→    if (expandedId === id) {\n   675→      setExpandedId(null);\n   676→    }\n   677→  }, [expandedId]);\n   678→\n   679→  return (\n   680→    <TabContent\n   681→      title=\"Your Plan & Potential\"\n   682→      subtitle=\"Personalized recommendations based on your analysis\"\n   683→    >\n   684→      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n   685→        {/* Main Content */}\n   686→        <div className=\"lg:col-span-2 space-y-6\">\n   687→          {/* Your Phase Card - Body Composition Phase */}\n   688→          <YourPhaseCard bodyFatPercent={bodyFatPercent} gender={gender} />\n   689→\n   690→          {/* Daily Stack Card - Hero Element for ALL users */}\n   691→          {dailyStack && <DailyStackCard dailyStack={dailyStack} />}\n   692→\n   693→          {/* Potential Score */}\n   694→          <PotentialScoreCard />\n   695→\n   696→          {/* Fix Your Weak Points Section */}\n   697→          {flawsWithProducts.length > 0 && (\n   698→            <div className=\"space-y-4\">\n   699→              <div className=\"flex items-center gap-2\">\n   700→                <AlertCircle size={20} className=\"text-red-400\" />\n   701→                <h3 className=\"text-lg font-semibold text-white\">Fix Your Weak Points</h3>\n   702→                <span className=\"px-2 py-0.5 bg-red-500/20 text-red-400 text-xs rounded-full border border-red-500/30\">\n   703→                  {flawsWithProducts.length} Issues\n   704→                </span>\n   705→              </div>\n   706→              <div className=\"space-y-3\">\n   707→                {flawsWithProducts.map((item, index) => (\n   708→                  <WeakPointCard\n   709→                    key={item.flaw.id}\n   710→                    flaw={item.flaw}\n   711→                    rank={index + 1}\n   712→                    products={item.products}\n   713→                    treatments={item.treatments}\n   714→                    onViewTreatment={(treatment) => setExpandedId(treatment.ref_id)}\n   715→                  />\n   716→                ))}\n   717→              </div>\n   718→            </div>\n   719→          )}\n   720→\n   721→          {/* Targeted Product Recommendations - Corrective */}\n   722→          {flawProducts.length > 0 && (\n   723→            <div className=\"space-y-4\">\n   724→              <div className=\"flex items-center gap-2\">\n   725→                <Package size={20} className=\"text-cyan-400\" />\n   726→                <h3 className=\"text-lg font-semibold text-white\">Recommended Products</h3>\n   727→                <span className=\"px-2 py-0.5 bg-cyan-500/20 text-cyan-400 text-xs rounded-full border border-cyan-500/30\">\n   728→                  Corrective\n   729→                </span>\n   730→              </div>\n   731→              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n   732→                {flawProducts.slice(0, 6).map((rec, index) => (\n   733→                  <ProductCard key={rec.product.id} recommendation={rec} rank={index + 1} />\n   734→                ))}\n   735→              </div>\n   736→            </div>\n   737→          )}\n   738→\n   739→          {/* Targeted Product Recommendations - Maintenance */}\n   740→          {idealProducts.length > 0 && (\n   741→            <div className=\"space-y-4\">\n   742→              <div className=\"flex items-center gap-2\">\n   743→                <CheckCircle2 size={20} className=\"text-green-400\" />\n   744→                <h3 className=\"text-lg font-semibold text-white\">Protect Your Strengths</h3>\n   745→                <span className=\"px-2 py-0.5 bg-green-500/20 text-green-400 text-xs rounded-full border border-green-500/30\">\n   746→                  Maintenance\n   747→                </span>\n   748→              </div>\n   749→              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n   750→                {idealProducts.slice(0, 4).map((rec) => (\n   751→                  <ProductCard key={rec.product.id} recommendation={rec} />\n   752→                ))}\n   753→              </div>\n   754→            </div>\n   755→          )}\n   756→\n   757→          {/* Treatment Timeline */}\n   758→          {recommendations.length > 0 && (\n   759→            <TreatmentTimeline recommendations={recommendations.filter(r => !removedIds.has(r.ref_id))} />\n   760→          )}\n   761→\n   762→          {/* Treatment Conflict Warnings */}\n   763→          {treatmentConflicts.length > 0 && (\n   764→            <TreatmentConflictList\n   765→              conflicts={treatmentConflicts}\n   766→              onDismiss={handleDismissConflict}\n   767→              onDismissAll={handleDismissAllConflicts}\n   768→            />\n   769→          )}\n   770→\n   771→          {/* Phase Filter */}\n   772→          <PhaseFilter\n   773→            selectedPhase={selectedPhase}\n   774→            onSelect={setSelectedPhase}\n   775→            counts={phaseCounts}\n   776→          />\n   777→\n   778→          {/* Recommendations List */}\n   779→          {hasRecommendations ? (\n   780→            <motion.div className=\"space-y-4\" layout>\n   781→              <AnimatePresence mode=\"popLayout\">\n   782→                {filteredRecommendations.map((rec, index) => (\n   783→                  <motion.div\n   784→                    key={rec.ref_id}\n   785→                    layout\n   786→                    initial={{ opacity: 0, y: 20 }}\n   787→                    animate={{ opacity: 1, y: 0 }}\n   788→                    exit={{ opacity: 0, y: -20 }}\n   789→                    transition={{ duration: 0.2, delay: index * 0.05 }}\n   790→                  >\n   791→                    <EnhancedRecommendationCard\n   792→                      recommendation={rec}\n   793→                      rank={index + 1}\n   794→                      isExpanded={expandedId === rec.ref_id}\n   795→                      onToggle={() => setExpandedId(\n   796→                        expandedId === rec.ref_id ? null : rec.ref_id\n   797→                      )}\n   798→                      onMarkComplete={handleMarkComplete}\n   799→                      onRemove={handleRemove}\n   800→                      isCompleted={completedIds.has(rec.ref_id)}\n   801→                      gender={gender}\n   802→                      ethnicity={ethnicity}\n   803→                    />\n   804→                  </motion.div>\n   805→                ))}\n   806→              </AnimatePresence>\n   807→            </motion.div>\n   808→          ) : (\n   809→            <div className=\"bg-neutral-900/50 border border-neutral-800 rounded-xl p-8 text-center\">\n   810→              <Sparkles size={48} className=\"mx-auto text-neutral-700 mb-4\" />\n   811→              <h3 className=\"text-lg font-medium text-white mb-2\">No Recommendations Yet</h3>\n   812→              <p className=\"text-neutral-500 mb-4\">\n   813→                Complete a facial analysis to get personalized recommendations\n   814→              </p>\n   815→            </div>\n   816→          )}\n   817→        </div>\n   818→\n   819→        {/* Sidebar */}\n   820→        <div className=\"space-y-6\">\n   821→          {/* Medical Prescription Card (Dental) */}\n   822→          {vision?.teeth && (\n   823→            <MedicalPrescriptionCard vision={vision} isUnlocked={isUnlocked} />\n   824→          )}\n   825→\n   826→          {/* Progress Comparison Card */}\n   827→          <ProgressComparisonCard\n   828→            currentAnalysis={{\n   829→              date: new Date().toISOString(),\n   830→              overallScore: numericOverallScore,\n   831→              bodyFatPercent,\n   832→              frontPhotoUrl: frontPhoto || undefined,\n   833→            }}\n   834→            previousAnalysis={previousAnalysis}\n   835→            onUploadNewPhoto={handleProgressPhotoUpload}\n   836→          />\n   837→\n   838→          {/* Product Bundle CTA */}\n   839→          {flawProducts.length >= 3 && (\n   840→            <ProductBundleCard\n   841→              products={flawProducts}\n   842→              title=\"Your Fix Bundle\"\n   843→            />\n   844→          )}\n   845→\n   846→          {/* Before/After Preview */}\n   847→          <BeforeAfterPreviewSection />\n   848→\n   849→          {/* Order of Operations */}\n   850→          <OrderOfOperations />\n   851→\n   852→          {/* My Plan Summary */}\n   853→          <div className=\"bg-neutral-900/50 border border-neutral-800 rounded-xl p-4\">\n   854→            <h4 className=\"font-medium text-white mb-3 flex items-center gap-2\">\n   855→              <Zap size={16} className=\"text-yellow-400\" />\n   856→              My Plan\n   857→            </h4>\n   858→            <div className=\"text-center py-6\">\n   859→              <div className=\"w-12 h-12 mx-auto mb-3 rounded-xl bg-neutral-800 flex items-center justify-center\">\n   860→                <Lock size={20} className=\"text-neutral-600\" />\n   861→              </div>\n   862→              <p className=\"text-sm text-neutral-500 mb-3\">\n   863→                Add recommendations to build your personalized plan\n   864→              </p>\n   865→              <p className=\"text-xs text-neutral-600\">\n   866→                0 items selected\n   867→              </p>\n   868→            </div>\n   869→          </div>\n   870→\n   871→          {/* Issues Summary */}\n   872→          <div className=\"bg-neutral-900/50 border border-neutral-800 rounded-xl p-4\">\n   873→            <h4 className=\"font-medium text-white mb-3\">Detected Issues</h4>\n   874→            <div className=\"space-y-2\">\n   875→              {flaws.slice(0, 5).map(flaw => (\n   876→                <div\n   877→                  key={flaw.id}\n   878→                  className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n   879→                >\n   880→                  <span className=\"text-sm text-neutral-300 truncate\">{flaw.flawName}</span>\n   881→                  <span className=\"text-xs text-red-400 flex-shrink-0\">\n   882→                    -{flaw.harmonyPercentageLost.toFixed(1)}%\n   883→                  </span>\n   884→                </div>\n   885→              ))}\n   886→              {flaws.length === 0 && (\n   887→                <p className=\"text-sm text-neutral-500 text-center py-4\">\n   888→                  No issues detected\n   889→                </p>\n   890→              )}\n   891→            </div>\n   892→          </div>\n   893→\n   894→          {/* Upgrade CTA or Premium Badge */}\n   895→          {hasPaidPlan ? (\n   896→            <motion.div\n   897→              className=\"bg-gradient-to-br from-green-500/10 to-emerald-600/10 border border-green-500/30 rounded-xl p-4\"\n   898→              initial={{ opacity: 0, y: 20 }}\n   899→              animate={{ opacity: 1, y: 0 }}\n   900→              transition={{ delay: 0.3 }}\n   901→            >\n   902→              <div className=\"flex items-center gap-2 mb-2\">\n   903→                <CheckCircle size={16} className=\"text-green-400\" />\n   904→                <span className=\"text-sm font-medium text-white\">\n   905→                  {user?.plan === 'pro' ? 'Pro Plan' : 'Basic Plan'} Active\n   906→                </span>\n   907→              </div>\n   908→              <p className=\"text-xs text-neutral-400\">\n   909→                You have full access to all {user?.plan === 'pro' ? 'features' : 'non-surgical recommendations'}.\n   910→              </p>\n   911→            </motion.div>\n   912→          ) : (\n   913→            <motion.div\n   914→              className=\"bg-gradient-to-br from-cyan-500/10 to-blue-600/10 border border-cyan-500/30 rounded-xl p-4\"\n   915→              initial={{ opacity: 0, y: 20 }}\n   916→              animate={{ opacity: 1, y: 0 }}\n   917→              transition={{ delay: 0.3 }}\n   918→            >\n   919→              <div className=\"flex items-center gap-2 mb-2\">\n   920→                <Sparkles size={16} className=\"text-cyan-400\" />\n   921→                <span className=\"text-sm font-medium text-white\">Unlock Full Plan</span>\n   922→              </div>\n   923→              <p className=\"text-xs text-neutral-400 mb-3\">\n   924→                Get detailed treatment guides, cost estimates, and provider recommendations.\n   925→              </p>\n   926→              <button\n   927→                onClick={() => openPricingModal('plan_sidebar')}\n   928→                className=\"block w-full py-2 bg-cyan-500 text-black text-sm font-medium rounded-lg text-center hover:bg-cyan-400 transition-colors\"\n   929→              >\n   930→                Upgrade Now\n   931→              </button>\n   932→            </motion.div>\n   933→          )}\n   934→        </div>\n   935→      </div>\n   936→\n   937→      {/* Treatment Conflict Modal */}\n   938→      <SelectionWarningModal\n   939→        isOpen={conflictModal.isOpen}\n   940→        onClose={handleConflictCancel}\n   941→        conflict={conflictModal.conflict || {\n   942→          treatment1Id: '',\n   943→          treatment1Name: '',\n   944→          treatment2Id: '',\n   945→          treatment2Name: '',\n   946→          reason: '',\n   947→        }}\n   948→        onProceed={handleConflictProceed}\n   949→        onCancel={handleConflictCancel}\n   950→      />\n   951→    </TabContent>\n   952→  );\n   953→}\n   954→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"9949cf6d-c1e7-4e04-8cc8-40974a37fe9a","timestamp":"2025-12-26T20:36:44.635Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/PlanTab.tsx","content":"'use client';\n\nimport { useState, useMemo, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Sparkles,\n  TrendingUp,\n  Target,\n  Zap,\n  ChevronRight,\n  Lock,\n  CheckCircle,\n  AlertCircle,\n  CheckCircle2,\n  Scale,\n  Dumbbell,\n  Salad,\n  ArrowDown,\n  ArrowUp,\n  Minus,\n  Package,\n  ShoppingCart,\n} from 'lucide-react';\nimport { useResults } from '@/contexts/ResultsContext';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { usePricing } from '@/contexts/PricingContext';\nimport { usePhysiqueOptional } from '@/contexts/PhysiqueContext';\nimport { TabContent } from '../ResultsLayout';\nimport { EnhancedRecommendationCard } from '../cards/EnhancedRecommendationCard';\nimport { ScoreCircle, PhaseBadge } from '../shared';\nimport { BeforeAfterPreview } from '../visualization/BeforeAfterPreview';\nimport { FaceMorphing } from '../visualization/FaceMorphing';\nimport { TreatmentTimeline } from '../visualization/TreatmentTimeline';\nimport { RecommendationPhase, ProductRecommendation } from '@/types/results';\nimport { DailyStackCard } from '../cards/DailyStackCard';\nimport { ProductCard } from '../cards/ProductCard';\nimport { WeakPointCard } from '../cards/WeakPointCard';\nimport { ProgressComparisonCard } from '../cards/ProgressComparisonCard';\nimport { MedicalPrescriptionCard } from '../cards/MedicalPrescriptionCard';\nimport { generateDailyStack } from '@/lib/daily-stack';\nimport { getProductRecommendations } from '@/lib/product-recommendations';\nimport { SUPPLEMENTS } from '@/lib/recommendations/supplements';\nimport {\n  TreatmentConflictList,\n  SelectionWarningModal,\n} from '../cards/TreatmentConflictWarning';\nimport {\n  findTreatmentConflicts,\n  type TreatmentConflict,\n} from '@/lib/recommendations/engine';\n\n// ============================================\n// POTENTIAL SCORE CARD\n// ============================================\n\nfunction PotentialScoreCard() {\n  const { overallScore, recommendations } = useResults();\n  const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n\n  // Calculate potential improvement\n  const potentialImprovement = useMemo(() => {\n    if (recommendations.length === 0) return 0;\n    const totalImpact = recommendations.slice(0, 5).reduce((sum, r) => sum + (r.impact || 0), 0);\n    return Math.min(totalImpact * 1.5, 10 - numericScore);\n  }, [recommendations, numericScore]);\n\n  const potentialScore = Math.min(10, numericScore + potentialImprovement);\n\n  return (\n    <motion.div\n      className=\"bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-2xl p-6\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-center gap-2 mb-4\">\n        <Sparkles size={20} className=\"text-cyan-400\" />\n        <h3 className=\"font-semibold text-white\">Your Potential</h3>\n      </div>\n\n      <div className=\"flex items-center justify-center gap-8 mb-6\">\n        {/* Current */}\n        <div className=\"text-center\">\n          <p className=\"text-xs text-neutral-500 mb-2\">Current</p>\n          <ScoreCircle score={overallScore} size=\"lg\" animate={false} />\n        </div>\n\n        {/* Arrow */}\n        <div className=\"flex flex-col items-center gap-1\">\n          <ChevronRight size={24} className=\"text-cyan-400\" />\n          <span className=\"text-xs text-green-400\">+{potentialImprovement.toFixed(1)}</span>\n        </div>\n\n        {/* Potential */}\n        <div className=\"text-center\">\n          <p className=\"text-xs text-neutral-500 mb-2\">Potential</p>\n          <div className=\"relative\">\n            <ScoreCircle score={potentialScore} size=\"lg\" animate={false} />\n            <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center\">\n              <TrendingUp size={12} className=\"text-black\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <p className=\"text-sm text-neutral-400 text-center\">\n        Following our recommendations could improve your harmony score by up to{' '}\n        <span className=\"text-green-400 font-medium\">+{potentialImprovement.toFixed(1)} points</span>\n      </p>\n    </motion.div>\n  );\n}\n\n// ============================================\n// PHASE FILTER\n// ============================================\n\ninterface PhaseFilterProps {\n  selectedPhase: RecommendationPhase | null;\n  onSelect: (phase: RecommendationPhase | null) => void;\n  counts: Record<RecommendationPhase, number>;\n}\n\nfunction PhaseFilter({ selectedPhase, onSelect, counts }: PhaseFilterProps) {\n  const phases: RecommendationPhase[] = ['Foundational', 'Minimally Invasive', 'Surgical'];\n\n  return (\n    <div className=\"flex flex-wrap gap-2\">\n      <button\n        onClick={() => onSelect(null)}\n        className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${selectedPhase === null\n          ? 'bg-cyan-500 text-black'\n          : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n          }`}\n      >\n        All ({Object.values(counts).reduce((a, b) => a + b, 0)})\n      </button>\n      {phases.map(phase => (\n        <button\n          key={phase}\n          onClick={() => onSelect(phase)}\n          className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${selectedPhase === phase\n            ? 'bg-neutral-700 text-white'\n            : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n            }`}\n        >\n          <PhaseBadge phase={phase} size=\"sm\" />\n          ({counts[phase] || 0})\n        </button>\n      ))}\n    </div>\n  );\n}\n\n// ============================================\n// BEFORE/AFTER PREVIEW SECTION WITH MORPHING\n// ============================================\n\ntype PreviewMode = 'static' | 'morphing';\n\nfunction BeforeAfterPreviewSection() {\n  const { frontPhoto, overallScore, recommendations, frontLandmarks } = useResults();\n  const [previewMode, setPreviewMode] = useState<PreviewMode>('morphing');\n  const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n\n  // Calculate potential improvement\n  const potentialImprovement = useMemo(() => {\n    if (recommendations.length === 0) return 0;\n    const totalImpact = recommendations.slice(0, 5).reduce((sum, r) => sum + r.impact, 0);\n    return Math.min(totalImpact * 1.5, 10 - numericScore);\n  }, [recommendations, numericScore]);\n\n  const potentialScore = Math.min(10, numericScore + potentialImprovement);\n\n  if (!frontPhoto) return null;\n\n  return (\n    <div className=\"space-y-3\">\n      {/* Mode Toggle */}\n      <div className=\"flex items-center justify-center gap-1 p-1 bg-black/40 rounded-lg border border-white/10\">\n        <button\n          onClick={() => setPreviewMode('morphing')}\n          className={`flex-1 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${\n            previewMode === 'morphing'\n              ? 'bg-cyan-500/20 text-cyan-400'\n              : 'text-neutral-500 hover:text-white'\n          }`}\n        >\n          Face Morphing\n        </button>\n        <button\n          onClick={() => setPreviewMode('static')}\n          className={`flex-1 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${\n            previewMode === 'static'\n              ? 'bg-neutral-700 text-white'\n              : 'text-neutral-500 hover:text-white'\n          }`}\n        >\n          Static Preview\n        </button>\n      </div>\n\n      {/* Preview Component */}\n      <AnimatePresence mode=\"wait\">\n        {previewMode === 'morphing' && frontLandmarks.length > 0 ? (\n          <motion.div\n            key=\"morphing\"\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: 20 }}\n            transition={{ duration: 0.2 }}\n          >\n            <FaceMorphing\n              photo={frontPhoto}\n              frontLandmarks={frontLandmarks}\n              currentScore={numericScore}\n              potentialScore={potentialScore}\n              recommendations={recommendations}\n            />\n          </motion.div>\n        ) : (\n          <motion.div\n            key=\"static\"\n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: -20 }}\n            transition={{ duration: 0.2 }}\n          >\n            <BeforeAfterPreview\n              photo={frontPhoto}\n              currentScore={numericScore}\n              potentialScore={potentialScore}\n              recommendations={recommendations}\n            />\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// ORDER OF OPERATIONS\n// ============================================\n\nfunction OrderOfOperations() {\n  return (\n    <div className=\"bg-neutral-900/50 border border-neutral-800 rounded-xl p-4\">\n      <h4 className=\"font-medium text-white mb-3 flex items-center gap-2\">\n        <Target size={16} className=\"text-cyan-400\" />\n        Recommended Order\n      </h4>\n      <div className=\"space-y-3\">\n        <div className=\"flex items-start gap-3\">\n          <div className=\"w-6 h-6 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0 mt-0.5\">\n            <span className=\"text-xs font-bold text-green-400\">1</span>\n          </div>\n          <div>\n            <p className=\"text-sm font-medium text-white\">Start with Foundational</p>\n            <p className=\"text-xs text-neutral-500\">Low-cost, no-risk improvements that anyone can do</p>\n          </div>\n        </div>\n        <div className=\"flex items-start gap-3\">\n          <div className=\"w-6 h-6 rounded-full bg-yellow-500/20 flex items-center justify-center flex-shrink-0 mt-0.5\">\n            <span className=\"text-xs font-bold text-yellow-400\">2</span>\n          </div>\n          <div>\n            <p className=\"text-sm font-medium text-white\">Consider Minimally Invasive</p>\n            <p className=\"text-xs text-neutral-500\">Temporary or reversible options with moderate impact</p>\n          </div>\n        </div>\n        <div className=\"flex items-start gap-3\">\n          <div className=\"w-6 h-6 rounded-full bg-red-500/20 flex items-center justify-center flex-shrink-0 mt-0.5\">\n            <span className=\"text-xs font-bold text-red-400\">3</span>\n          </div>\n          <div>\n            <p className=\"text-sm font-medium text-white\">Evaluate Surgical Options</p>\n            <p className=\"text-xs text-neutral-500\">Permanent solutions for significant improvements</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// YOUR PHASE CARD (Body Composition Phase)\n// ============================================\n\ntype BodyPhase = 'bulk' | 'cut' | 'maintain';\n\ninterface YourPhaseCardProps {\n  bodyFatPercent?: number;\n  gender: 'male' | 'female';\n}\n\nfunction YourPhaseCard({ bodyFatPercent, gender }: YourPhaseCardProps) {\n  // Determine phase based on body fat and gender\n  const getPhase = (): { phase: BodyPhase; message: string; color: string; icon: React.ReactNode } => {\n    if (!bodyFatPercent) {\n      return {\n        phase: 'maintain',\n        message: 'Complete your physique analysis to get personalized phase recommendations.',\n        color: 'from-neutral-700 to-neutral-800',\n        icon: <Scale size={24} className=\"text-neutral-400\" />,\n      };\n    }\n\n    // Male thresholds: <12% = bulk, 12-18% = maintain, >18% = cut\n    // Female thresholds: <18% = bulk, 18-25% = maintain, >25% = cut\n    const bulkThreshold = gender === 'male' ? 12 : 18;\n    const cutThreshold = gender === 'male' ? 18 : 25;\n\n    if (bodyFatPercent < bulkThreshold) {\n      return {\n        phase: 'bulk',\n        message: `At ${bodyFatPercent.toFixed(1)}% body fat, you're lean enough to build muscle. Focus on a slight caloric surplus with progressive overload.`,\n        color: 'from-green-600 to-emerald-700',\n        icon: <Dumbbell size={24} className=\"text-white\" />,\n      };\n    } else if (bodyFatPercent > cutThreshold) {\n      return {\n        phase: 'cut',\n        message: `At ${bodyFatPercent.toFixed(1)}% body fat, prioritize fat loss. A moderate caloric deficit with high protein will reveal your facial structure.`,\n        color: 'from-orange-600 to-red-700',\n        icon: <Salad size={24} className=\"text-white\" />,\n      };\n    } else {\n      return {\n        phase: 'maintain',\n        message: `At ${bodyFatPercent.toFixed(1)}% body fat, you're in the optimal range. Focus on body recomposition to build muscle while staying lean.`,\n        color: 'from-blue-600 to-cyan-700',\n        icon: <Scale size={24} className=\"text-white\" />,\n      };\n    }\n  };\n\n  const { phase, message, color, icon } = getPhase();\n  const phaseLabels: Record<BodyPhase, string> = {\n    bulk: 'Lean Bulk Phase',\n    cut: 'Cutting Phase',\n    maintain: 'Maintenance Phase',\n  };\n\n  return (\n    <motion.div\n      className={`bg-gradient-to-br ${color} rounded-2xl p-6 border border-white/10`}\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-start gap-4\">\n        <div className=\"w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center flex-shrink-0\">\n          {icon}\n        </div>\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h3 className=\"font-semibold text-white text-lg\">Your Phase</h3>\n            <div className=\"px-2 py-0.5 bg-white/20 rounded-full text-xs font-medium text-white\">\n              {phaseLabels[phase]}\n            </div>\n          </div>\n          <p className=\"text-sm text-white/80 mb-4\">{message}</p>\n\n          {/* Phase-specific tips */}\n          <div className=\"grid grid-cols-3 gap-2\">\n            <div className=\"bg-black/20 rounded-lg p-2 text-center\">\n              <div className=\"flex items-center justify-center gap-1 mb-0.5\">\n                {phase === 'bulk' ? (\n                  <ArrowUp size={12} className=\"text-green-300\" />\n                ) : phase === 'cut' ? (\n                  <ArrowDown size={12} className=\"text-orange-300\" />\n                ) : (\n                  <Minus size={12} className=\"text-blue-300\" />\n                )}\n                <span className=\"text-xs text-white/60\">Calories</span>\n              </div>\n              <span className=\"text-sm font-medium text-white\">\n                {phase === 'bulk' ? '+300' : phase === 'cut' ? '-500' : '±0'}\n              </span>\n            </div>\n            <div className=\"bg-black/20 rounded-lg p-2 text-center\">\n              <span className=\"text-xs text-white/60 block mb-0.5\">Protein</span>\n              <span className=\"text-sm font-medium text-white\">\n                {phase === 'cut' ? '1.2g/lb' : '1g/lb'}\n              </span>\n            </div>\n            <div className=\"bg-black/20 rounded-lg p-2 text-center\">\n              <span className=\"text-xs text-white/60 block mb-0.5\">Cardio</span>\n              <span className=\"text-sm font-medium text-white\">\n                {phase === 'bulk' ? 'Minimal' : phase === 'cut' ? '4-5x/wk' : '2-3x/wk'}\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// PRODUCT BUNDLE CTA\n// ============================================\n\ninterface ProductBundleCardProps {\n  products: ProductRecommendation[];\n  title?: string;\n}\n\nfunction ProductBundleCard({ products, title = 'Recommended Bundle' }: ProductBundleCardProps) {\n  // Get top 3 most important products\n  const bundleProducts = products.slice(0, 3);\n\n  // Calculate total cost\n  const totalCost = bundleProducts.reduce((sum, rec) => {\n    const supplement = SUPPLEMENTS.find(s => s.id === rec.product.supplementId);\n    return sum + (supplement?.costPerMonth.min || 0);\n  }, 0);\n\n  if (bundleProducts.length === 0) return null;\n\n  return (\n    <motion.div\n      className=\"bg-gradient-to-br from-purple-900/50 to-violet-950/50 border border-purple-500/30 rounded-2xl p-6\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-center gap-2 mb-4\">\n        <Package size={20} className=\"text-purple-400\" />\n        <h3 className=\"font-semibold text-white\">{title}</h3>\n        <div className=\"ml-auto px-2 py-0.5 bg-purple-500/20 text-purple-300 text-xs font-medium rounded-full\">\n          Save 15%\n        </div>\n      </div>\n\n      <p className=\"text-sm text-neutral-300 mb-4\">\n        Your analysis recommends these {bundleProducts.length} supplements - optimized for your specific weak points.\n      </p>\n\n      {/* Bundle Items */}\n      <div className=\"space-y-2 mb-4\">\n        {bundleProducts.map((rec, index) => (\n          <div\n            key={rec.product.id}\n            className=\"flex items-center gap-3 p-2 bg-black/20 rounded-lg\"\n          >\n            <div className=\"w-6 h-6 rounded-full bg-purple-500/30 flex items-center justify-center flex-shrink-0\">\n              <span className=\"text-xs font-bold text-purple-300\">{index + 1}</span>\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-sm font-medium text-white truncate\">{rec.product.name}</p>\n              <p className=\"text-xs text-neutral-400 truncate\">Targets: {rec.targetMetric}</p>\n            </div>\n            <div className=\"text-right flex-shrink-0\">\n              <p className=\"text-sm text-white\">\n                ${SUPPLEMENTS.find(s => s.id === rec.product.supplementId)?.costPerMonth.min || 0}/mo\n              </p>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* Total & CTA */}\n      <div className=\"border-t border-purple-500/20 pt-4\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <span className=\"text-neutral-400\">Bundle Total</span>\n          <div className=\"text-right\">\n            <span className=\"text-lg font-bold text-white\">${totalCost}/mo</span>\n            <span className=\"text-xs text-neutral-500 ml-2 line-through\">${Math.round(totalCost * 1.15)}/mo</span>\n          </div>\n        </div>\n        <button\n          className=\"w-full flex items-center justify-center gap-2 py-3 bg-gradient-to-r from-purple-500 to-violet-600 text-white font-medium rounded-lg hover:opacity-90 transition-opacity\"\n        >\n          <ShoppingCart size={18} />\n          Get Your Bundle\n        </button>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// PLAN TAB\n// ============================================\n\nexport function PlanTab() {\n  const { recommendations, flaws, gender, ethnicity, frontRatios, sideRatios, overallScore, frontPhoto, vision, isUnlocked } = useResults();\n  const { user } = useAuth();\n  const physiqueContext = usePhysiqueOptional();\n  const [selectedPhase, setSelectedPhase] = useState<RecommendationPhase | null>(null);\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [completedIds, setCompletedIds] = useState<Set<string>>(new Set());\n  const [removedIds, setRemovedIds] = useState<Set<string>>(new Set());\n  const [previousAnalysis, setPreviousAnalysis] = useState<{\n    date: string;\n    overallScore: number;\n    bodyFatPercent?: number;\n    frontPhotoUrl?: string;\n  } | null>(null);\n\n  // Treatment conflict state\n  const [dismissedConflicts, setDismissedConflicts] = useState<Set<string>>(new Set());\n  const [conflictModal, setConflictModal] = useState<{\n    isOpen: boolean;\n    conflict: TreatmentConflict | null;\n    newTreatmentId: string;\n  }>({ isOpen: false, conflict: null, newTreatmentId: '' });\n\n  const { openPricingModal } = usePricing();\n\n  // Convert to number for arithmetic operations\n  const numericOverallScore = typeof overallScore === 'number' ? overallScore : 0;\n\n  // Check if user has a paid plan\n  const hasPaidPlan = user?.plan === 'basic' || user?.plan === 'pro';\n\n  // Get body fat from physique analysis\n  const bodyFatPercent = physiqueContext?.physiqueAnalysis?.bodyFatPercent;\n\n  // Generate Daily Stack for all users\n  const dailyStack = useMemo(() => {\n    return generateDailyStack(gender);\n  }, [gender]);\n\n  // Generate Product Recommendations based on metrics\n  const productRecommendations = useMemo(() => {\n    // Build metrics and severity dictionaries from ratios\n    const metricsDict: Record<string, number> = {};\n    const severityDict: Record<string, string> = {};\n\n    [...frontRatios, ...sideRatios].forEach(ratio => {\n      metricsDict[ratio.name] = typeof ratio.value === 'number' ? ratio.value : 0;\n      severityDict[ratio.name] = ratio.severity;\n    });\n\n    return getProductRecommendations(metricsDict, severityDict, gender, ethnicity);\n  }, [frontRatios, sideRatios, gender, ethnicity]);\n\n  // Split product recommendations by state\n  const { flawProducts, idealProducts } = useMemo(() => {\n    const flaw = productRecommendations.filter(r => r.state === 'flaw');\n    const ideal = productRecommendations.filter(r => r.state === 'ideal');\n    return { flawProducts: flaw, idealProducts: ideal };\n  }, [productRecommendations]);\n\n  // Map flaws to products and treatments\n  const flawsWithProducts = useMemo(() => {\n    return flaws.slice(0, 5).map(flaw => {\n      // Find products that target metrics related to this flaw\n      const relatedProducts = productRecommendations.filter(rec =>\n        flaw && flaw.responsibleRatios && flaw.responsibleRatios.some(ratio =>\n          rec.matchedMetrics.some(metric =>\n            metric.toLowerCase().includes(ratio.ratioName.toLowerCase()) ||\n            ratio.ratioName.toLowerCase().includes(metric.toLowerCase())\n          )\n        )\n      );\n\n      // Find treatments that match this flaw\n      const relatedTreatments = recommendations.filter(rec =>\n        rec.matchedFlaws.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase()))\n      );\n\n      return {\n        flaw,\n        products: relatedProducts.slice(0, 2),\n        treatments: relatedTreatments.slice(0, 3),\n      };\n    });\n  }, [flaws, productRecommendations, recommendations]);\n\n  // Handle progress photo upload\n  const handleProgressPhotoUpload = useCallback(async (file: File) => {\n    // Store current analysis as previous before re-analyzing\n    const numScore = typeof overallScore === 'number' ? overallScore : 0;\n    setPreviousAnalysis({\n      date: new Date().toISOString(),\n      overallScore: numScore,\n      bodyFatPercent,\n      frontPhotoUrl: frontPhoto || undefined,\n    });\n\n    // In a real implementation, this would upload to API and trigger re-analysis\n    console.log('Progress photo uploaded:', file.name);\n  }, [overallScore, bodyFatPercent, frontPhoto]);\n\n  // Count recommendations by phase\n  const phaseCounts = useMemo(() => {\n    const counts: Record<RecommendationPhase, number> = {\n      'Foundational': 0,\n      'Minimally Invasive': 0,\n      'Surgical': 0,\n    };\n    recommendations.forEach(r => {\n      if (!removedIds.has(r.ref_id)) {\n        counts[r.phase]++;\n      }\n    });\n    return counts;\n  }, [recommendations, removedIds]);\n\n  // Filter recommendations\n  const filteredRecommendations = useMemo(() => {\n    let filtered = recommendations.filter(r => !removedIds.has(r.ref_id));\n    if (selectedPhase) {\n      filtered = filtered.filter(r => r.phase === selectedPhase);\n    }\n    return filtered;\n  }, [recommendations, selectedPhase, removedIds]);\n\n  const hasRecommendations = filteredRecommendations.length > 0;\n\n  // Detect treatment conflicts in current recommendations\n  const treatmentConflicts = useMemo(() => {\n    const selectedIds = filteredRecommendations.map(r => r.ref_id);\n    const nameMap = Object.fromEntries(\n      filteredRecommendations.map(r => [r.ref_id, r.name])\n    );\n    const conflicts = findTreatmentConflicts(selectedIds, nameMap);\n\n    // Filter out dismissed conflicts\n    return conflicts.filter(c => {\n      const conflictKey = `${c.treatment1Id}-${c.treatment2Id}`;\n      return !dismissedConflicts.has(conflictKey);\n    });\n  }, [filteredRecommendations, dismissedConflicts]);\n\n  // Handle dismissing a conflict\n  const handleDismissConflict = useCallback((conflict: TreatmentConflict) => {\n    const conflictKey = `${conflict.treatment1Id}-${conflict.treatment2Id}`;\n    setDismissedConflicts(prev => new Set(Array.from(prev).concat(conflictKey)));\n  }, []);\n\n  // Handle dismissing all conflicts\n  const handleDismissAllConflicts = useCallback(() => {\n    const allKeys = treatmentConflicts.map(\n      c => `${c.treatment1Id}-${c.treatment2Id}`\n    );\n    setDismissedConflicts(prev => new Set(Array.from(prev).concat(allKeys)));\n  }, [treatmentConflicts]);\n\n  // Handle conflict modal actions\n  const handleConflictProceed = useCallback(() => {\n    if (conflictModal.conflict) {\n      // Remove the lower priority (existing) treatment\n      setRemovedIds(prev => new Set(Array.from(prev).concat(conflictModal.conflict!.treatment1Id)));\n    }\n    setConflictModal({ isOpen: false, conflict: null, newTreatmentId: '' });\n  }, [conflictModal.conflict]);\n\n  const handleConflictCancel = useCallback(() => {\n    setConflictModal({ isOpen: false, conflict: null, newTreatmentId: '' });\n  }, []);\n\n  // Handle mark complete\n  const handleMarkComplete = useCallback((id: string) => {\n    setCompletedIds(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(id)) {\n        newSet.delete(id);\n      } else {\n        newSet.add(id);\n      }\n      return newSet;\n    });\n  }, []);\n\n  // Handle remove\n  const handleRemove = useCallback((id: string) => {\n    setRemovedIds(prev => {\n      const newSet = new Set(prev);\n      newSet.add(id);\n      return newSet;\n    });\n    if (expandedId === id) {\n      setExpandedId(null);\n    }\n  }, [expandedId]);\n\n  return (\n    <TabContent\n      title=\"Your Plan & Potential\"\n      subtitle=\"Personalized recommendations based on your analysis\"\n    >\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Main Content */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          {/* Your Phase Card - Body Composition Phase */}\n          <YourPhaseCard bodyFatPercent={bodyFatPercent} gender={gender} />\n\n          {/* Daily Stack Card - Hero Element for ALL users */}\n          {dailyStack && <DailyStackCard dailyStack={dailyStack} />}\n\n          {/* Potential Score */}\n          <PotentialScoreCard />\n\n          {/* Fix Your Weak Points Section */}\n          {flawsWithProducts.length > 0 && (\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center gap-2\">\n                <AlertCircle size={20} className=\"text-red-400\" />\n                <h3 className=\"text-lg font-semibold text-white\">Fix Your Weak Points</h3>\n                <span className=\"px-2 py-0.5 bg-red-500/20 text-red-400 text-xs rounded-full border border-red-500/30\">\n                  {flawsWithProducts.length} Issues\n                </span>\n              </div>\n              <div className=\"space-y-3\">\n                {flawsWithProducts.map((item, index) => (\n                  <WeakPointCard\n                    key={item.flaw.id}\n                    flaw={item.flaw}\n                    rank={index + 1}\n                    products={item.products}\n                    treatments={item.treatments}\n                    onViewTreatment={(treatment) => setExpandedId(treatment.ref_id)}\n                  />\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Targeted Product Recommendations - Corrective */}\n          {flawProducts.length > 0 && (\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center gap-2\">\n                <Package size={20} className=\"text-cyan-400\" />\n                <h3 className=\"text-lg font-semibold text-white\">Recommended Products</h3>\n                <span className=\"px-2 py-0.5 bg-cyan-500/20 text-cyan-400 text-xs rounded-full border border-cyan-500/30\">\n                  Corrective\n                </span>\n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {flawProducts.slice(0, 6).map((rec, index) => (\n                  <ProductCard key={rec.product.id} recommendation={rec} rank={index + 1} />\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Targeted Product Recommendations - Maintenance */}\n          {idealProducts.length > 0 && (\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle2 size={20} className=\"text-green-400\" />\n                <h3 className=\"text-lg font-semibold text-white\">Protect Your Strengths</h3>\n                <span className=\"px-2 py-0.5 bg-green-500/20 text-green-400 text-xs rounded-full border border-green-500/30\">\n                  Maintenance\n                </span>\n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {idealProducts.slice(0, 4).map((rec) => (\n                  <ProductCard key={rec.product.id} recommendation={rec} />\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Treatment Timeline */}\n          {recommendations.length > 0 && (\n            <TreatmentTimeline recommendations={recommendations.filter(r => !removedIds.has(r.ref_id))} />\n          )}\n\n          {/* Treatment Conflict Warnings */}\n          {treatmentConflicts.length > 0 && (\n            <TreatmentConflictList\n              conflicts={treatmentConflicts}\n              onDismiss={handleDismissConflict}\n              onDismissAll={handleDismissAllConflicts}\n            />\n          )}\n\n          {/* Phase Filter */}\n          <PhaseFilter\n            selectedPhase={selectedPhase}\n            onSelect={setSelectedPhase}\n            counts={phaseCounts}\n          />\n\n          {/* Recommendations List */}\n          {hasRecommendations ? (\n            <motion.div className=\"space-y-4\" layout>\n              <AnimatePresence mode=\"popLayout\">\n                {filteredRecommendations.map((rec, index) => (\n                  <motion.div\n                    key={rec.ref_id}\n                    layout\n                    initial={{ opacity: 0, y: 20 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    exit={{ opacity: 0, y: -20 }}\n                    transition={{ duration: 0.2, delay: index * 0.05 }}\n                  >\n                    <EnhancedRecommendationCard\n                      recommendation={rec}\n                      rank={index + 1}\n                      isExpanded={expandedId === rec.ref_id}\n                      onToggle={() => setExpandedId(\n                        expandedId === rec.ref_id ? null : rec.ref_id\n                      )}\n                      onMarkComplete={handleMarkComplete}\n                      onRemove={handleRemove}\n                      isCompleted={completedIds.has(rec.ref_id)}\n                      gender={gender}\n                      ethnicity={ethnicity}\n                    />\n                  </motion.div>\n                ))}\n              </AnimatePresence>\n            </motion.div>\n          ) : (\n            <div className=\"bg-neutral-900/50 border border-neutral-800 rounded-xl p-8 text-center\">\n              <Sparkles size={48} className=\"mx-auto text-neutral-700 mb-4\" />\n              <h3 className=\"text-lg font-medium text-white mb-2\">No Recommendations Yet</h3>\n              <p className=\"text-neutral-500 mb-4\">\n                Complete a facial analysis to get personalized recommendations\n              </p>\n            </div>\n          )}\n        </div>\n\n        {/* Sidebar */}\n        <div className=\"space-y-6\">\n          {/* Medical Prescription Card (Dental) */}\n          {vision?.teeth && (\n            <MedicalPrescriptionCard vision={vision} isUnlocked={isUnlocked} />\n          )}\n\n          {/* Progress Comparison Card */}\n          <ProgressComparisonCard\n            currentAnalysis={{\n              date: new Date().toISOString(),\n              overallScore: numericOverallScore,\n              bodyFatPercent,\n              frontPhotoUrl: frontPhoto || undefined,\n            }}\n            previousAnalysis={previousAnalysis}\n            onUploadNewPhoto={handleProgressPhotoUpload}\n          />\n\n          {/* Product Bundle CTA */}\n          {flawProducts.length >= 3 && (\n            <ProductBundleCard\n              products={flawProducts}\n              title=\"Your Fix Bundle\"\n            />\n          )}\n\n          {/* Before/After Preview */}\n          <BeforeAfterPreviewSection />\n\n          {/* Order of Operations */}\n          <OrderOfOperations />\n\n          {/* My Plan Summary */}\n          <div className=\"bg-neutral-900/50 border border-neutral-800 rounded-xl p-4\">\n            <h4 className=\"font-medium text-white mb-3 flex items-center gap-2\">\n              <Zap size={16} className=\"text-yellow-400\" />\n              My Plan\n            </h4>\n            <div className=\"text-center py-6\">\n              <div className=\"w-12 h-12 mx-auto mb-3 rounded-xl bg-neutral-800 flex items-center justify-center\">\n                <Lock size={20} className=\"text-neutral-600\" />\n              </div>\n              <p className=\"text-sm text-neutral-500 mb-3\">\n                Add recommendations to build your personalized plan\n              </p>\n              <p className=\"text-xs text-neutral-600\">\n                0 items selected\n              </p>\n            </div>\n          </div>\n\n          {/* Issues Summary */}\n          <div className=\"bg-neutral-900/50 border border-neutral-800 rounded-xl p-4\">\n            <h4 className=\"font-medium text-white mb-3\">Detected Issues</h4>\n            <div className=\"space-y-2\">\n              {flaws.slice(0, 5).map(flaw => (\n                <div\n                  key={flaw.id}\n                  className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n                >\n                  <span className=\"text-sm text-neutral-300 truncate\">{flaw.flawName}</span>\n                  <span className=\"text-xs text-red-400 flex-shrink-0\">\n                    -{flaw.harmonyPercentageLost.toFixed(1)}%\n                  </span>\n                </div>\n              ))}\n              {flaws.length === 0 && (\n                <p className=\"text-sm text-neutral-500 text-center py-4\">\n                  No issues detected\n                </p>\n              )}\n            </div>\n          </div>\n\n          {/* Upgrade CTA or Premium Badge */}\n          {hasPaidPlan ? (\n            <motion.div\n              className=\"bg-gradient-to-br from-green-500/10 to-emerald-600/10 border border-green-500/30 rounded-xl p-4\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.3 }}\n            >\n              <div className=\"flex items-center gap-2 mb-2\">\n                <CheckCircle size={16} className=\"text-green-400\" />\n                <span className=\"text-sm font-medium text-white\">\n                  {user?.plan === 'pro' ? 'Pro Plan' : 'Basic Plan'} Active\n                </span>\n              </div>\n              <p className=\"text-xs text-neutral-400\">\n                You have full access to all {user?.plan === 'pro' ? 'features' : 'non-surgical recommendations'}.\n              </p>\n            </motion.div>\n          ) : (\n            <motion.div\n              className=\"bg-gradient-to-br from-cyan-500/10 to-blue-600/10 border border-cyan-500/30 rounded-xl p-4\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.3 }}\n            >\n              <div className=\"flex items-center gap-2 mb-2\">\n                <Sparkles size={16} className=\"text-cyan-400\" />\n                <span className=\"text-sm font-medium text-white\">Unlock Full Plan</span>\n              </div>\n              <p className=\"text-xs text-neutral-400 mb-3\">\n                Get detailed treatment guides, cost estimates, and provider recommendations.\n              </p>\n              <button\n                onClick={() => openPricingModal('plan_sidebar')}\n                className=\"block w-full py-2 bg-cyan-500 text-black text-sm font-medium rounded-lg text-center hover:bg-cyan-400 transition-colors\"\n              >\n                Upgrade Now\n              </button>\n            </motion.div>\n          )}\n        </div>\n      </div>\n\n      {/* Treatment Conflict Modal */}\n      <SelectionWarningModal\n        isOpen={conflictModal.isOpen}\n        onClose={handleConflictCancel}\n        conflict={conflictModal.conflict || {\n          treatment1Id: '',\n          treatment1Name: '',\n          treatment2Id: '',\n          treatment2Name: '',\n          reason: '',\n        }}\n        onProceed={handleConflictProceed}\n        onCancel={handleConflictCancel}\n      />\n    </TabContent>\n  );\n}\n","numLines":954,"startLine":1,"totalLines":954}}}
{"parentUuid":"9949cf6d-c1e7-4e04-8cc8-40974a37fe9a","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_017wrMVokVqPmHQbLXfxvo3g","type":"message","role":"assistant","content":[{"type":"text","text":"Let me also check the FAQ and Sources pages to see the design patterns more clearly:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":14191,"cache_read_input_tokens":35480,"cache_creation":{"ephemeral_5m_input_tokens":14191,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWVwWbzGY5arL6du7eXX7","type":"assistant","uuid":"b7ac1c1a-9fc3-4e98-b3d4-8ca9b253d4c7","timestamp":"2025-12-26T20:36:50.409Z"}
{"parentUuid":"b7ac1c1a-9fc3-4e98-b3d4-8ca9b253d4c7","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_017wrMVokVqPmHQbLXfxvo3g","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016vaktgUj2tbeWFLBq4bHre","name":"Glob","input":{"pattern":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/faq/**/*.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":14191,"cache_read_input_tokens":35480,"cache_creation":{"ephemeral_5m_input_tokens":14191,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWVwWbzGY5arL6du7eXX7","type":"assistant","uuid":"bd4f0fbb-eca6-4e73-b964-509ff98a62c2","timestamp":"2025-12-26T20:36:51.590Z"}
{"parentUuid":"bd4f0fbb-eca6-4e73-b964-509ff98a62c2","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_017wrMVokVqPmHQbLXfxvo3g","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01SEqX4mUPqRwz5PGHPNujRY","name":"Glob","input":{"pattern":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/sources/**/*.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":14191,"cache_read_input_tokens":35480,"cache_creation":{"ephemeral_5m_input_tokens":14191,"ephemeral_1h_input_tokens":0},"output_tokens":160,"service_tier":"standard"}},"requestId":"req_011CWVwWbzGY5arL6du7eXX7","type":"assistant","uuid":"97c885d3-4e8a-496b-ab05-6d03cf04a38a","timestamp":"2025-12-26T20:36:52.221Z"}
{"parentUuid":"97c885d3-4e8a-496b-ab05-6d03cf04a38a","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01SEqX4mUPqRwz5PGHPNujRY","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/sources/page.tsx"}]},"uuid":"05d58e10-e3e9-424e-8d64-d4663baa28ef","timestamp":"2025-12-26T20:36:52.992Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/sources/page.tsx"],"durationMs":725,"numFiles":1,"truncated":false}}
{"parentUuid":"05d58e10-e3e9-424e-8d64-d4663baa28ef","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016vaktgUj2tbeWFLBq4bHre","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/faq/page.tsx"}]},"uuid":"e8a2bf27-9f70-4938-adc4-33cd774ab723","timestamp":"2025-12-26T20:36:53.566Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/faq/page.tsx"],"durationMs":1300,"numFiles":1,"truncated":false}}
{"parentUuid":"e8a2bf27-9f70-4938-adc4-33cd774ab723","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_01K5hjYf2UK6y2jfjjZncYUy","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01GA6KeThT8Vp4CWLa3ytZcB","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/faq/page.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":58,"cache_creation_input_tokens":220,"cache_read_input_tokens":49671,"cache_creation":{"ephemeral_5m_input_tokens":220,"ephemeral_1h_input_tokens":0},"output_tokens":18,"service_tier":"standard"}},"requestId":"req_011CWVwXGABsYWnWsXgxZR1P","type":"assistant","uuid":"5c127fd9-5269-4c37-80de-d3bb6b81da0e","timestamp":"2025-12-26T20:37:00.765Z"}
{"parentUuid":"5c127fd9-5269-4c37-80de-d3bb6b81da0e","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_01K5hjYf2UK6y2jfjjZncYUy","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NKUbXfvpQDx4NupTBVSoC7","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/sources/page.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":58,"cache_creation_input_tokens":220,"cache_read_input_tokens":49671,"cache_creation":{"ephemeral_5m_input_tokens":220,"ephemeral_1h_input_tokens":0},"output_tokens":146,"service_tier":"standard"}},"requestId":"req_011CWVwXGABsYWnWsXgxZR1P","type":"assistant","uuid":"8fcb1348-d476-41f5-b512-6a86fe953854","timestamp":"2025-12-26T20:37:01.403Z"}
{"parentUuid":"8fcb1348-d476-41f5-b512-6a86fe953854","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01GA6KeThT8Vp4CWLa3ytZcB","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import React from 'react';\n     4→import Link from 'next/link';\n     5→import { ArrowLeft } from 'lucide-react';\n     6→\n     7→const faqs = [\n     8→    {\n     9→        category: \"General\",\n    10→        items: [\n    11→            { q: \"What is LooksMaxx AI?\", a: \"LooksMaxx AI is a premium facial morphometric engine that uses artificial intelligence to analyze facial landmarks, symmetry, and proportions based on established aesthetic scientific canons.\" },\n    12→            { q: \"Is this medically accurate?\", a: \"While our algorithms are based on anthropometric research and neo-classical canons, this is an aesthetic validation tool, not a medical diagnosis device. Always consult with a board-certified plastic surgeon for medical advice.\" },\n    13→        ]\n    14→    },\n    15→    {\n    16→        category: \"Analysis & Metrics\",\n    17→        items: [\n    18→            { q: \"How many ratios do you track?\", a: \"Our Pro engine tracks over 60 distinct facial ratios, including the golden ratio, canthal tilt, gonial angle, midface height, and more.\" },\n    19→            { q: \"What is the PSL scale?\", a: \"The 'Pretty Scale Level' (PSL) is a standardized aesthetic metric used in high-fashion and modeling industries to quantify facial attractiveness on a 1-10 scale based on developmental stability and harmony.\" },\n    20→        ]\n    21→    },\n    22→    {\n    23→        category: \"Privacy & Security\",\n    24→        items: [\n    25→            { q: \"Are my photos private?\", a: \"Yes. Your photos are processed securely and are never shared with third parties. You have the right to delete your data at any time from your settings.\" },\n    26→            { q: \"Do you store my biometric data?\", a: \"We only store the landmark coordinates and resultant scores to provide your analysis history. Raw images can be deleted immediately after processing.\" },\n    27→        ]\n    28→    }\n    29→];\n    30→\n    31→export default function FAQPage() {\n    32→    return (\n    33→        <main className=\"min-h-screen bg-black text-white selection:bg-cyan-500/30\">\n    34→            <div className=\"max-w-4xl mx-auto px-6 pt-32 pb-20\">\n    35→                <Link href=\"/\" className=\"inline-flex items-center gap-2 text-neutral-500 hover:text-cyan-400 text-xs font-black uppercase tracking-widest mb-12 transition-colors\">\n    36→                    <ArrowLeft size={14} />\n    37→                    Back to Labs\n    38→                </Link>\n    39→\n    40→                <header className=\"mb-20\">\n    41→                    <h1 className=\"text-5xl font-black tracking-tighter italic uppercase mb-4\">\n    42→                        Knowledge <span className=\"text-cyan-400\">Base</span>\n    43→                    </h1>\n    44→                    <p className=\"text-neutral-500 font-medium max-w-md uppercase text-xs tracking-[0.2em]\">\n    45→                        Frequently Asked Questions & Technical Documentation\n    46→                    </p>\n    47→                </header>\n    48→\n    49→                <div className=\"space-y-16\">\n    50→                    {faqs.map((cat, idx) => (\n    51→                        <section key={idx}>\n    52→                            <h2 className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-8 flex items-center gap-4\">\n    53→                                {cat.category}\n    54→                                <div className=\"flex-1 h-px bg-neutral-900\" />\n    55→                            </h2>\n    56→                            <div className=\"space-y-4\">\n    57→                                {cat.items.map((item, iIdx) => (\n    58→                                    <div key={iIdx} className=\"p-8 rounded-3xl bg-neutral-900/30 border border-white/5 hover:border-white/10 transition-colors\">\n    59→                                        <h3 className=\"text-lg font-black italic uppercase text-white mb-4\">{item.q}</h3>\n    60→                                        <p className=\"text-neutral-400 text-sm font-medium leading-relaxed\">{item.a}</p>\n    61→                                    </div>\n    62→                                ))}\n    63→                            </div>\n    64→                        </section>\n    65→                    ))}\n    66→                </div>\n    67→\n    68→                <footer className=\"mt-20 pt-12 border-t border-neutral-900 flex flex-col items-center gap-6\">\n    69→                    <p className=\"text-neutral-600 text-[10px] font-black uppercase tracking-widest\">Still have technical queries?</p>\n    70→                    <Link href=\"mailto:support@looksmaxx.app\" className=\"h-12 px-8 rounded-2xl bg-white/5 border border-white/10 text-white font-black uppercase tracking-widest text-xs flex items-center hover:bg-white/10 transition-all\">\n    71→                        Contact Ops\n    72→                    </Link>\n    73→                </footer>\n    74→            </div>\n    75→        </main>\n    76→    );\n    77→}\n    78→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"248c7ddd-6114-4231-876d-324765d0c725","timestamp":"2025-12-26T20:37:01.459Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/faq/page.tsx","content":"'use client';\n\nimport React from 'react';\nimport Link from 'next/link';\nimport { ArrowLeft } from 'lucide-react';\n\nconst faqs = [\n    {\n        category: \"General\",\n        items: [\n            { q: \"What is LooksMaxx AI?\", a: \"LooksMaxx AI is a premium facial morphometric engine that uses artificial intelligence to analyze facial landmarks, symmetry, and proportions based on established aesthetic scientific canons.\" },\n            { q: \"Is this medically accurate?\", a: \"While our algorithms are based on anthropometric research and neo-classical canons, this is an aesthetic validation tool, not a medical diagnosis device. Always consult with a board-certified plastic surgeon for medical advice.\" },\n        ]\n    },\n    {\n        category: \"Analysis & Metrics\",\n        items: [\n            { q: \"How many ratios do you track?\", a: \"Our Pro engine tracks over 60 distinct facial ratios, including the golden ratio, canthal tilt, gonial angle, midface height, and more.\" },\n            { q: \"What is the PSL scale?\", a: \"The 'Pretty Scale Level' (PSL) is a standardized aesthetic metric used in high-fashion and modeling industries to quantify facial attractiveness on a 1-10 scale based on developmental stability and harmony.\" },\n        ]\n    },\n    {\n        category: \"Privacy & Security\",\n        items: [\n            { q: \"Are my photos private?\", a: \"Yes. Your photos are processed securely and are never shared with third parties. You have the right to delete your data at any time from your settings.\" },\n            { q: \"Do you store my biometric data?\", a: \"We only store the landmark coordinates and resultant scores to provide your analysis history. Raw images can be deleted immediately after processing.\" },\n        ]\n    }\n];\n\nexport default function FAQPage() {\n    return (\n        <main className=\"min-h-screen bg-black text-white selection:bg-cyan-500/30\">\n            <div className=\"max-w-4xl mx-auto px-6 pt-32 pb-20\">\n                <Link href=\"/\" className=\"inline-flex items-center gap-2 text-neutral-500 hover:text-cyan-400 text-xs font-black uppercase tracking-widest mb-12 transition-colors\">\n                    <ArrowLeft size={14} />\n                    Back to Labs\n                </Link>\n\n                <header className=\"mb-20\">\n                    <h1 className=\"text-5xl font-black tracking-tighter italic uppercase mb-4\">\n                        Knowledge <span className=\"text-cyan-400\">Base</span>\n                    </h1>\n                    <p className=\"text-neutral-500 font-medium max-w-md uppercase text-xs tracking-[0.2em]\">\n                        Frequently Asked Questions & Technical Documentation\n                    </p>\n                </header>\n\n                <div className=\"space-y-16\">\n                    {faqs.map((cat, idx) => (\n                        <section key={idx}>\n                            <h2 className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-8 flex items-center gap-4\">\n                                {cat.category}\n                                <div className=\"flex-1 h-px bg-neutral-900\" />\n                            </h2>\n                            <div className=\"space-y-4\">\n                                {cat.items.map((item, iIdx) => (\n                                    <div key={iIdx} className=\"p-8 rounded-3xl bg-neutral-900/30 border border-white/5 hover:border-white/10 transition-colors\">\n                                        <h3 className=\"text-lg font-black italic uppercase text-white mb-4\">{item.q}</h3>\n                                        <p className=\"text-neutral-400 text-sm font-medium leading-relaxed\">{item.a}</p>\n                                    </div>\n                                ))}\n                            </div>\n                        </section>\n                    ))}\n                </div>\n\n                <footer className=\"mt-20 pt-12 border-t border-neutral-900 flex flex-col items-center gap-6\">\n                    <p className=\"text-neutral-600 text-[10px] font-black uppercase tracking-widest\">Still have technical queries?</p>\n                    <Link href=\"mailto:support@looksmaxx.app\" className=\"h-12 px-8 rounded-2xl bg-white/5 border border-white/10 text-white font-black uppercase tracking-widest text-xs flex items-center hover:bg-white/10 transition-all\">\n                        Contact Ops\n                    </Link>\n                </footer>\n            </div>\n        </main>\n    );\n}\n","numLines":78,"startLine":1,"totalLines":78}}}
{"parentUuid":"248c7ddd-6114-4231-876d-324765d0c725","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NKUbXfvpQDx4NupTBVSoC7","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import React from 'react';\n     4→import Link from 'next/link';\n     5→import { ArrowLeft, BookOpen, FileText, Globe, User } from 'lucide-react';\n     6→\n     7→const sources = [\n     8→    {\n     9→        title: \"The Neo-Classical Canons of Facial Proportion\",\n    10→        author: \"Farkas LG, Hreczko TA, Kolar JC, Munro IR.\",\n    11→        publication: \"Plastic and Reconstructive Surgery Journal (1985)\",\n    12→        link: \"https://pubmed.ncbi.nlm.nih.gov/3991668/\",\n    13→        snippet: \"Establishing the quantitative measurements for the 'ideal' facial structure based on European Renaissance standards and verified through anthropometric analysis of 2,326 healthy subjects.\"\n    14→    },\n    15→    {\n    16→        title: \"Vertical Facial Proportions and the Golden Ratio\",\n    17→        author: \"Jefferson Y.\",\n    18→        publication: \"Journal of General Orthodontics (2004)\",\n    19→        link: \"https://pubmed.ncbi.nlm.nih.gov/15317378/\",\n    20→        snippet: \"Exploring the relationship between facial harmony, the divine proportion (phi), and its role in orthodontic treatment and aesthetic perception.\"\n    21→    },\n    22→    {\n    23→        title: \"The Mandibular Plane Angle and Facial Harmony\",\n    24→        author: \"Ricketts RM.\",\n    25→        publication: \"American Journal of Orthodontics (1960)\",\n    26→        link: \"https://pubmed.ncbi.nlm.nih.gov/13741364/\",\n    27→        snippet: \"A critical study on the relationship between mandibular slope, gonial angle, and perceived masculinity/femininity in human profiles.\"\n    28→    },\n    29→    {\n    30→        title: \"Canthal Tilt and the Perception of Attractiveness\",\n    31→        author: \"Bashour M.\",\n    32→        publication: \"Aesthetic Plastic Surgery (2006)\",\n    33→        link: \"https://pubmed.ncbi.nlm.nih.gov/16544067/\",\n    34→        snippet: \"Standardizing the measurement of lateral canthal tilt and its statistically significant correlation with perceived facial vitality and youth.\"\n    35→    }\n    36→];\n    37→\n    38→export default function SourcesPage() {\n    39→    return (\n    40→        <main className=\"min-h-screen bg-black text-white selection:bg-cyan-500/30\">\n    41→            <div className=\"max-w-4xl mx-auto px-6 pt-32 pb-20\">\n    42→                <Link href=\"/\" className=\"inline-flex items-center gap-2 text-neutral-500 hover:text-cyan-400 text-xs font-black uppercase tracking-widest mb-12 transition-colors\">\n    43→                    <ArrowLeft size={14} />\n    44→                    Back to Labs\n    45→                </Link>\n    46→\n    47→                <header className=\"mb-20\">\n    48→                    <h1 className=\"text-5xl font-black tracking-tighter italic uppercase mb-4\">\n    49→                        Aesthetic <span className=\"text-cyan-400\">Methodology</span>\n    50→                    </h1>\n    51→                    <p className=\"text-neutral-500 font-medium max-w-md uppercase text-xs tracking-[0.2em]\">\n    52→                        Scientific Foundations & Peer-Reviewed Source Citations\n    53→                    </p>\n    54→                </header>\n    55→\n    56→                <div className=\"space-y-24\">\n    57→                    <section className=\"p-10 rounded-[2.5rem] bg-neutral-900/40 border border-white/5 relative overflow-hidden\">\n    58→                        <div className=\"absolute top-0 right-0 p-8 opacity-10\">\n    59→                            <BookOpen size={120} />\n    60→                        </div>\n    61→                        <h2 className=\"text-xs font-black uppercase tracking-[0.4em] text-cyan-500 mb-6\">Our Approach</h2>\n    62→                        <p className=\"text-xl font-bold italic text-neutral-200 leading-relaxed mb-6\">\n    63→                            &ldquo;FACIAL HARMONY IS NOT SUBJECTIVE—IT IS A BIOMETRIC EQUILIBRIUM.&rdquo;\n    64→                        </p>\n    65→                        <p className=\"text-neutral-500 text-sm leading-relaxed max-w-2xl\">\n    66→                            Every score generated by LOOKSMAXX LABS is derived from comparative analysis against the Neo-Classical Canons, Average Composite Models, and modern high-fashion developmental stability metrics. Our engine uses Computer Vision (CV) to identify landmarks with 99.8% precision across diverse lighting conditions.\n    67→                        </p>\n    68→                    </section>\n    69→\n    70→                    <section>\n    71→                        <h2 className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-12 flex items-center gap-4\">\n    72→                            Peer-Reviewed Citations\n    73→                            <div className=\"flex-1 h-px bg-neutral-900\" />\n    74→                        </h2>\n    75→                        <div className=\"space-y-16\">\n    76→                            {sources.map((source, idx) => (\n    77→                                <div key={idx} className=\"group relative\">\n    78→                                    <div className=\"absolute -left-6 top-0 bottom-0 w-1 bg-cyan-500/0 group-hover:bg-cyan-500/50 transition-all\" />\n    79→                                    <div className=\"flex gap-8 items-start\">\n    80→                                        <div className=\"w-14 h-14 rounded-2xl bg-neutral-900 border border-white/10 flex items-center justify-center shrink-0 group-hover:border-cyan-500/50 transition-colors shadow-2xl\">\n    81→                                            <FileText size={20} className=\"text-neutral-500 group-hover:text-cyan-400\" />\n    82→                                        </div>\n    83→                                        <div>\n    84→                                            <h3 className=\"text-xl font-black italic uppercase text-white mb-3 leading-[1.1] tracking-tight group-hover:text-cyan-400 transition-colors\">\n    85→                                                {source.title}\n    86→                                            </h3>\n    87→                                            <div className=\"flex flex-wrap items-center gap-x-4 gap-y-2 mb-4\">\n    88→                                                <div className=\"flex items-center gap-2 px-2 py-0.5 rounded bg-white/5 border border-white/10 text-[10px] font-black uppercase tracking-widest text-neutral-300\">\n    89→                                                    <User size={10} className=\"text-cyan-500\" />\n    90→                                                    {source.author.split(',')[0]} ET AL.\n    91→                                                </div>\n    92→                                                <div className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600\">\n    93→                                                    {source.publication}\n    94→                                                </div>\n    95→                                            </div>\n    96→                                            <p className=\"text-neutral-400 text-sm font-medium leading-relaxed mb-6 max-w-3xl border-l border-neutral-800 pl-6 italic\">\n    97→                                                {source.snippet}\n    98→                                            </p>\n    99→                                            <a\n   100→                                                href={source.link}\n   101→                                                target=\"_blank\"\n   102→                                                rel=\"noopener noreferrer\"\n   103→                                                className=\"inline-flex items-center gap-3 px-4 py-2 rounded-xl bg-neutral-900 border border-white/5 text-cyan-400 text-[10px] font-black uppercase tracking-[0.2em] hover:bg-neutral-800 hover:border-cyan-500/30 transition-all\"\n   104→                                            >\n   105→                                                Protocol Archive <Globe size={12} />\n   106→                                            </a>\n   107→                                        </div>\n   108→                                    </div>\n   109→                                </div>\n   110→                            ))}\n   111→                        </div>\n   112→                    </section>\n   113→                </div>\n   114→\n   115→                <footer className=\"mt-32 pt-12 border-t border-neutral-900 text-center\">\n   116→                    <p className=\"text-neutral-700 text-[10px] font-mono uppercase tracking-[0.2em]\">\n   117→                        Engine: Quantum-V4.2 | Citations Verified: 2025.12.23\n   118→                    </p>\n   119→                </footer>\n   120→            </div>\n   121→        </main>\n   122→    );\n   123→}\n   124→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"27dc035b-0dfb-4354-ae6d-53e83459f9da","timestamp":"2025-12-26T20:37:01.459Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/sources/page.tsx","content":"'use client';\n\nimport React from 'react';\nimport Link from 'next/link';\nimport { ArrowLeft, BookOpen, FileText, Globe, User } from 'lucide-react';\n\nconst sources = [\n    {\n        title: \"The Neo-Classical Canons of Facial Proportion\",\n        author: \"Farkas LG, Hreczko TA, Kolar JC, Munro IR.\",\n        publication: \"Plastic and Reconstructive Surgery Journal (1985)\",\n        link: \"https://pubmed.ncbi.nlm.nih.gov/3991668/\",\n        snippet: \"Establishing the quantitative measurements for the 'ideal' facial structure based on European Renaissance standards and verified through anthropometric analysis of 2,326 healthy subjects.\"\n    },\n    {\n        title: \"Vertical Facial Proportions and the Golden Ratio\",\n        author: \"Jefferson Y.\",\n        publication: \"Journal of General Orthodontics (2004)\",\n        link: \"https://pubmed.ncbi.nlm.nih.gov/15317378/\",\n        snippet: \"Exploring the relationship between facial harmony, the divine proportion (phi), and its role in orthodontic treatment and aesthetic perception.\"\n    },\n    {\n        title: \"The Mandibular Plane Angle and Facial Harmony\",\n        author: \"Ricketts RM.\",\n        publication: \"American Journal of Orthodontics (1960)\",\n        link: \"https://pubmed.ncbi.nlm.nih.gov/13741364/\",\n        snippet: \"A critical study on the relationship between mandibular slope, gonial angle, and perceived masculinity/femininity in human profiles.\"\n    },\n    {\n        title: \"Canthal Tilt and the Perception of Attractiveness\",\n        author: \"Bashour M.\",\n        publication: \"Aesthetic Plastic Surgery (2006)\",\n        link: \"https://pubmed.ncbi.nlm.nih.gov/16544067/\",\n        snippet: \"Standardizing the measurement of lateral canthal tilt and its statistically significant correlation with perceived facial vitality and youth.\"\n    }\n];\n\nexport default function SourcesPage() {\n    return (\n        <main className=\"min-h-screen bg-black text-white selection:bg-cyan-500/30\">\n            <div className=\"max-w-4xl mx-auto px-6 pt-32 pb-20\">\n                <Link href=\"/\" className=\"inline-flex items-center gap-2 text-neutral-500 hover:text-cyan-400 text-xs font-black uppercase tracking-widest mb-12 transition-colors\">\n                    <ArrowLeft size={14} />\n                    Back to Labs\n                </Link>\n\n                <header className=\"mb-20\">\n                    <h1 className=\"text-5xl font-black tracking-tighter italic uppercase mb-4\">\n                        Aesthetic <span className=\"text-cyan-400\">Methodology</span>\n                    </h1>\n                    <p className=\"text-neutral-500 font-medium max-w-md uppercase text-xs tracking-[0.2em]\">\n                        Scientific Foundations & Peer-Reviewed Source Citations\n                    </p>\n                </header>\n\n                <div className=\"space-y-24\">\n                    <section className=\"p-10 rounded-[2.5rem] bg-neutral-900/40 border border-white/5 relative overflow-hidden\">\n                        <div className=\"absolute top-0 right-0 p-8 opacity-10\">\n                            <BookOpen size={120} />\n                        </div>\n                        <h2 className=\"text-xs font-black uppercase tracking-[0.4em] text-cyan-500 mb-6\">Our Approach</h2>\n                        <p className=\"text-xl font-bold italic text-neutral-200 leading-relaxed mb-6\">\n                            &ldquo;FACIAL HARMONY IS NOT SUBJECTIVE—IT IS A BIOMETRIC EQUILIBRIUM.&rdquo;\n                        </p>\n                        <p className=\"text-neutral-500 text-sm leading-relaxed max-w-2xl\">\n                            Every score generated by LOOKSMAXX LABS is derived from comparative analysis against the Neo-Classical Canons, Average Composite Models, and modern high-fashion developmental stability metrics. Our engine uses Computer Vision (CV) to identify landmarks with 99.8% precision across diverse lighting conditions.\n                        </p>\n                    </section>\n\n                    <section>\n                        <h2 className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-12 flex items-center gap-4\">\n                            Peer-Reviewed Citations\n                            <div className=\"flex-1 h-px bg-neutral-900\" />\n                        </h2>\n                        <div className=\"space-y-16\">\n                            {sources.map((source, idx) => (\n                                <div key={idx} className=\"group relative\">\n                                    <div className=\"absolute -left-6 top-0 bottom-0 w-1 bg-cyan-500/0 group-hover:bg-cyan-500/50 transition-all\" />\n                                    <div className=\"flex gap-8 items-start\">\n                                        <div className=\"w-14 h-14 rounded-2xl bg-neutral-900 border border-white/10 flex items-center justify-center shrink-0 group-hover:border-cyan-500/50 transition-colors shadow-2xl\">\n                                            <FileText size={20} className=\"text-neutral-500 group-hover:text-cyan-400\" />\n                                        </div>\n                                        <div>\n                                            <h3 className=\"text-xl font-black italic uppercase text-white mb-3 leading-[1.1] tracking-tight group-hover:text-cyan-400 transition-colors\">\n                                                {source.title}\n                                            </h3>\n                                            <div className=\"flex flex-wrap items-center gap-x-4 gap-y-2 mb-4\">\n                                                <div className=\"flex items-center gap-2 px-2 py-0.5 rounded bg-white/5 border border-white/10 text-[10px] font-black uppercase tracking-widest text-neutral-300\">\n                                                    <User size={10} className=\"text-cyan-500\" />\n                                                    {source.author.split(',')[0]} ET AL.\n                                                </div>\n                                                <div className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600\">\n                                                    {source.publication}\n                                                </div>\n                                            </div>\n                                            <p className=\"text-neutral-400 text-sm font-medium leading-relaxed mb-6 max-w-3xl border-l border-neutral-800 pl-6 italic\">\n                                                {source.snippet}\n                                            </p>\n                                            <a\n                                                href={source.link}\n                                                target=\"_blank\"\n                                                rel=\"noopener noreferrer\"\n                                                className=\"inline-flex items-center gap-3 px-4 py-2 rounded-xl bg-neutral-900 border border-white/5 text-cyan-400 text-[10px] font-black uppercase tracking-[0.2em] hover:bg-neutral-800 hover:border-cyan-500/30 transition-all\"\n                                            >\n                                                Protocol Archive <Globe size={12} />\n                                            </a>\n                                        </div>\n                                    </div>\n                                </div>\n                            ))}\n                        </div>\n                    </section>\n                </div>\n\n                <footer className=\"mt-32 pt-12 border-t border-neutral-900 text-center\">\n                    <p className=\"text-neutral-700 text-[10px] font-mono uppercase tracking-[0.2em]\">\n                        Engine: Quantum-V4.2 | Citations Verified: 2025.12.23\n                    </p>\n                </footer>\n            </div>\n        </main>\n    );\n}\n","numLines":124,"startLine":1,"totalLines":124}}}
{"parentUuid":"27dc035b-0dfb-4354-ae6d-53e83459f9da","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_01F3QVEqFyCUgMDKrxSiNBtB","type":"message","role":"assistant","content":[{"type":"text","text":"Now I have a clear understanding of the premium design patterns. Let me also check the `TabContent` component to understand how the title/subtitle work:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":4213,"cache_read_input_tokens":49891,"cache_creation":{"ephemeral_5m_input_tokens":4213,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVwXquTeksbWmoPP2SC8","type":"assistant","uuid":"f3270c99-ec8d-4a2a-a674-40b19db09218","timestamp":"2025-12-26T20:37:05.757Z"}
{"parentUuid":"f3270c99-ec8d-4a2a-a674-40b19db09218","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_01F3QVEqFyCUgMDKrxSiNBtB","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Sxa25meDnVdJAU4JJhkmHn","name":"Grep","input":{"pattern":"export.*TabContent","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":4213,"cache_read_input_tokens":49891,"cache_creation":{"ephemeral_5m_input_tokens":4213,"ephemeral_1h_input_tokens":0},"output_tokens":128,"service_tier":"standard"}},"requestId":"req_011CWVwXquTeksbWmoPP2SC8","type":"assistant","uuid":"c3393f5a-794e-40bf-9c85-c3a41bee4eeb","timestamp":"2025-12-26T20:37:07.050Z"}
{"parentUuid":"c3393f5a-794e-40bf-9c85-c3a41bee4eeb","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Sxa25meDnVdJAU4JJhkmHn","type":"tool_result","content":"Found 2 files\nsrc/components/results/ResultsLayout.tsx\nsrc/components/results/index.tsx"}]},"uuid":"4fdcf391-3b16-4ec0-9b9d-c78b9bac6f75","timestamp":"2025-12-26T20:37:07.497Z","toolUseResult":{"mode":"files_with_matches","filenames":["src/components/results/ResultsLayout.tsx","src/components/results/index.tsx"],"numFiles":2}}
{"parentUuid":"4fdcf391-3b16-4ec0-9b9d-c78b9bac6f75","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_01C8RgsX5GbuxdcTVBkS9N3S","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014AwLdFeRCGkRpa1qBRxhqr","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/ResultsLayout.tsx","limit":100}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":270,"cache_read_input_tokens":54104,"cache_creation":{"ephemeral_5m_input_tokens":270,"ephemeral_1h_input_tokens":0},"output_tokens":22,"service_tier":"standard"}},"requestId":"req_011CWVwYHhjkuzxfBh2kFVWj","type":"assistant","uuid":"0d0a1608-98b7-4c78-ad71-5c57ce55eda7","timestamp":"2025-12-26T20:37:12.846Z"}
{"parentUuid":"0d0a1608-98b7-4c78-ad71-5c57ce55eda7","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014AwLdFeRCGkRpa1qBRxhqr","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useState, useEffect } from 'react';\n     4→import { motion, AnimatePresence } from 'framer-motion';\n     5→import Image from 'next/image';\n     6→import Link from 'next/link';\n     7→import {\n     8→  LayoutDashboard,\n     9→  User,\n    10→  ScanFace,\n    11→  Sparkles,\n    12→  Settings,\n    13→  HelpCircle,\n    14→  Menu,\n    15→  X,\n    16→  ChevronRight,\n    17→  Trophy,\n    18→  Users,\n    19→  Gauge,\n    20→  Shapes,\n    21→  BookOpen,\n    22→  Gift,\n    23→  Share2,\n    24→  Download,\n    25→  ShieldCheck,\n    26→} from 'lucide-react';\n    27→import { useResults } from '@/contexts/ResultsContext';\n    28→import { useLeaderboardOptional } from '@/contexts/LeaderboardContext';\n    29→import { ResultsTab } from '@/types/results';\n    30→import { ScoreCircle, RankBadge } from './shared';\n    31→import { api } from '@/lib/api';\n    32→\n    33→// ============================================\n    34→// TAB NAVIGATION\n    35→// ============================================\n    36→\n    37→interface TabConfig {\n    38→  id: ResultsTab;\n    39→  label: string;\n    40→  icon: React.ReactNode;\n    41→}\n    42→\n    43→const TABS: TabConfig[] = [\n    44→  { id: 'overview', label: 'Overview', icon: <LayoutDashboard size={16} /> },\n    45→  { id: 'front-ratios', label: 'Front Ratios', icon: <User size={16} /> },\n    46→  { id: 'side-ratios', label: 'Side Ratios', icon: <ScanFace size={16} /> },\n    47→  { id: 'leaderboard', label: 'Leaderboard', icon: <Trophy size={16} /> },\n    48→  { id: 'psl', label: 'PSL Rating', icon: <Gauge size={16} /> },\n    49→  { id: 'archetype', label: 'Archetype', icon: <Shapes size={16} /> },\n    50→  { id: 'plan', label: 'Your Plan', icon: <Sparkles size={16} /> },\n    51→  { id: 'guides', label: 'Guides', icon: <BookOpen size={16} /> },\n    52→  { id: 'community', label: 'Community', icon: <Users size={16} /> },\n    53→  { id: 'referrals', label: 'Referrals', icon: <Gift size={16} /> },\n    54→  { id: 'options', label: 'Options', icon: <Settings size={16} /> },\n    55→  { id: 'support', label: 'Support', icon: <HelpCircle size={16} /> },\n    56→];\n    57→\n    58→// ============================================\n    59→// SIDEBAR\n    60→// ============================================\n    61→\n    62→interface SidebarProps {\n    63→  onClose?: () => void;\n    64→}\n    65→\n    66→function Sidebar({ onClose }: SidebarProps) {\n    67→  const { activeTab, setActiveTab, overallScore, frontPhoto, pslRating } = useResults();\n    68→\n    69→  return (\n    70→    <div className=\"flex flex-col h-full bg-black border-r border-white/5\">\n    71→      {/* Header */}\n    72→      <div className=\"flex items-center justify-between p-5 border-b border-white/5\">\n    73→        <Link href=\"/\" className=\"flex items-center gap-3\">\n    74→          <div className=\"w-8 h-8 rounded-xl bg-gradient-to-br from-cyan-400 to-blue-600 flex items-center justify-center shadow-lg shadow-cyan-500/20\">\n    75→            <ShieldCheck size={16} className=\"text-white\" />\n    76→          </div>\n    77→          <span className=\"text-xs font-black uppercase tracking-widest text-white\">LOOKSMAXX</span>\n    78→        </Link>\n    79→        {onClose && (\n    80→          <button\n    81→            onClick={onClose}\n    82→            className=\"p-2 hover:bg-white/5 rounded-xl transition-colors md:hidden\"\n    83→          >\n    84→            <X size={18} className=\"text-neutral-500\" />\n    85→          </button>\n    86→        )}\n    87→      </div>\n    88→\n    89→      {/* Profile Photo & Score */}\n    90→      <div className=\"p-5 border-b border-white/5\">\n    91→        <div className=\"relative aspect-square rounded-2xl overflow-hidden bg-neutral-900/50 border border-white/5 mb-5\">\n    92→          {frontPhoto ? (\n    93→            <Image\n    94→              src={frontPhoto}\n    95→              alt=\"Your face\"\n    96→              fill\n    97→              className=\"object-cover\"\n    98→              unoptimized\n    99→            />\n   100→          ) : (\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"198cf62f-8958-4467-a318-26e59e77ccbe","timestamp":"2025-12-26T20:37:12.957Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/ResultsLayout.tsx","content":"'use client';\n\nimport { useState, useEffect } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport Image from 'next/image';\nimport Link from 'next/link';\nimport {\n  LayoutDashboard,\n  User,\n  ScanFace,\n  Sparkles,\n  Settings,\n  HelpCircle,\n  Menu,\n  X,\n  ChevronRight,\n  Trophy,\n  Users,\n  Gauge,\n  Shapes,\n  BookOpen,\n  Gift,\n  Share2,\n  Download,\n  ShieldCheck,\n} from 'lucide-react';\nimport { useResults } from '@/contexts/ResultsContext';\nimport { useLeaderboardOptional } from '@/contexts/LeaderboardContext';\nimport { ResultsTab } from '@/types/results';\nimport { ScoreCircle, RankBadge } from './shared';\nimport { api } from '@/lib/api';\n\n// ============================================\n// TAB NAVIGATION\n// ============================================\n\ninterface TabConfig {\n  id: ResultsTab;\n  label: string;\n  icon: React.ReactNode;\n}\n\nconst TABS: TabConfig[] = [\n  { id: 'overview', label: 'Overview', icon: <LayoutDashboard size={16} /> },\n  { id: 'front-ratios', label: 'Front Ratios', icon: <User size={16} /> },\n  { id: 'side-ratios', label: 'Side Ratios', icon: <ScanFace size={16} /> },\n  { id: 'leaderboard', label: 'Leaderboard', icon: <Trophy size={16} /> },\n  { id: 'psl', label: 'PSL Rating', icon: <Gauge size={16} /> },\n  { id: 'archetype', label: 'Archetype', icon: <Shapes size={16} /> },\n  { id: 'plan', label: 'Your Plan', icon: <Sparkles size={16} /> },\n  { id: 'guides', label: 'Guides', icon: <BookOpen size={16} /> },\n  { id: 'community', label: 'Community', icon: <Users size={16} /> },\n  { id: 'referrals', label: 'Referrals', icon: <Gift size={16} /> },\n  { id: 'options', label: 'Options', icon: <Settings size={16} /> },\n  { id: 'support', label: 'Support', icon: <HelpCircle size={16} /> },\n];\n\n// ============================================\n// SIDEBAR\n// ============================================\n\ninterface SidebarProps {\n  onClose?: () => void;\n}\n\nfunction Sidebar({ onClose }: SidebarProps) {\n  const { activeTab, setActiveTab, overallScore, frontPhoto, pslRating } = useResults();\n\n  return (\n    <div className=\"flex flex-col h-full bg-black border-r border-white/5\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between p-5 border-b border-white/5\">\n        <Link href=\"/\" className=\"flex items-center gap-3\">\n          <div className=\"w-8 h-8 rounded-xl bg-gradient-to-br from-cyan-400 to-blue-600 flex items-center justify-center shadow-lg shadow-cyan-500/20\">\n            <ShieldCheck size={16} className=\"text-white\" />\n          </div>\n          <span className=\"text-xs font-black uppercase tracking-widest text-white\">LOOKSMAXX</span>\n        </Link>\n        {onClose && (\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-white/5 rounded-xl transition-colors md:hidden\"\n          >\n            <X size={18} className=\"text-neutral-500\" />\n          </button>\n        )}\n      </div>\n\n      {/* Profile Photo & Score */}\n      <div className=\"p-5 border-b border-white/5\">\n        <div className=\"relative aspect-square rounded-2xl overflow-hidden bg-neutral-900/50 border border-white/5 mb-5\">\n          {frontPhoto ? (\n            <Image\n              src={frontPhoto}\n              alt=\"Your face\"\n              fill\n              className=\"object-cover\"\n              unoptimized\n            />\n          ) : (","numLines":100,"startLine":1,"totalLines":408}}}
{"parentUuid":"198cf62f-8958-4467-a318-26e59e77ccbe","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_01UaFqsvD9RmJwxNgFVTZdXn","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01XKSxr3gi3ff9WrzS98FrUc","name":"Grep","input":{"pattern":"function TabContent|TabContent\\s*=","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/ResultsLayout.tsx","output_mode":"content","-A":20}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":1599,"cache_read_input_tokens":54374,"cache_creation":{"ephemeral_5m_input_tokens":1599,"ephemeral_1h_input_tokens":0},"output_tokens":23,"service_tier":"standard"}},"requestId":"req_011CWVwYh8PakPMEVJywJK8n","type":"assistant","uuid":"0a59416e-dc88-4bea-87a3-7913ac0a3b6a","timestamp":"2025-12-26T20:37:17.758Z"}
{"parentUuid":"0a59416e-dc88-4bea-87a3-7913ac0a3b6a","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01XKSxr3gi3ff9WrzS98FrUc","type":"tool_result","content":"346:export function TabContent({ title, subtitle, children, rightContent, actions }: TabContentProps) {\n347-  // Split title to highlight last word in cyan\n348-  const titleWords = title.split(' ');\n349-  const lastWord = titleWords.pop();\n350-  const firstWords = titleWords.join(' ');\n351-\n352-  return (\n353-    <div className=\"p-6 md:p-10 lg:p-12 max-w-6xl mx-auto\">\n354-      {/* Header */}\n355-      <div className=\"flex flex-col md:flex-row md:items-start md:justify-between mb-10 md:mb-14\">\n356-        <div>\n357-          <h1 className=\"text-4xl md:text-5xl font-black tracking-tighter italic uppercase mb-3\">\n358-            {firstWords} <span className=\"text-cyan-400\">{lastWord}</span>\n359-          </h1>\n360-          {subtitle && (\n361-            <p className=\"text-neutral-500 font-medium uppercase text-xs tracking-[0.2em] max-w-lg\">\n362-              {subtitle}\n363-            </p>\n364-          )}\n365-        </div>\n366-        {(rightContent || actions) && ("}]},"uuid":"7325bbc9-6748-4c1b-945c-62a1cbc757a2","timestamp":"2025-12-26T20:37:18.270Z","toolUseResult":{"mode":"content","numFiles":0,"filenames":[],"content":"346:export function TabContent({ title, subtitle, children, rightContent, actions }: TabContentProps) {\n347-  // Split title to highlight last word in cyan\n348-  const titleWords = title.split(' ');\n349-  const lastWord = titleWords.pop();\n350-  const firstWords = titleWords.join(' ');\n351-\n352-  return (\n353-    <div className=\"p-6 md:p-10 lg:p-12 max-w-6xl mx-auto\">\n354-      {/* Header */}\n355-      <div className=\"flex flex-col md:flex-row md:items-start md:justify-between mb-10 md:mb-14\">\n356-        <div>\n357-          <h1 className=\"text-4xl md:text-5xl font-black tracking-tighter italic uppercase mb-3\">\n358-            {firstWords} <span className=\"text-cyan-400\">{lastWord}</span>\n359-          </h1>\n360-          {subtitle && (\n361-            <p className=\"text-neutral-500 font-medium uppercase text-xs tracking-[0.2em] max-w-lg\">\n362-              {subtitle}\n363-            </p>\n364-          )}\n365-        </div>\n366-        {(rightContent || actions) && (","numLines":21}}
{"parentUuid":"7325bbc9-6748-4c1b-945c-62a1cbc757a2","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_01JYiuTpzDVAse8M1EYvaXMq","type":"message","role":"assistant","content":[{"type":"text","text":"Now I have a clear understanding. The `TabContent` component already supports the premium header style. Let me now write the redesigned `PlanTab.tsx`:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":479,"cache_read_input_tokens":55973,"cache_creation":{"ephemeral_5m_input_tokens":479,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVwZ5nAC6z9uLzwt72NY","type":"assistant","uuid":"7db6cc34-af64-4ec5-bbde-dfa4415fb895","timestamp":"2025-12-26T20:37:22.387Z"}
{"parentUuid":"7db6cc34-af64-4ec5-bbde-dfa4415fb895","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_01JYiuTpzDVAse8M1EYvaXMq","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01RPNQqcVD8e4uNvEisMPrgE","name":"Write","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/PlanTab.tsx","content":"'use client';\n\nimport { useState, useMemo, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Sparkles,\n  TrendingUp,\n  Target,\n  Zap,\n  ChevronRight,\n  Lock,\n  CheckCircle,\n  AlertCircle,\n  CheckCircle2,\n  Scale,\n  Dumbbell,\n  Salad,\n  ArrowDown,\n  ArrowUp,\n  Minus,\n  Package,\n  ShoppingCart,\n} from 'lucide-react';\nimport { useResults } from '@/contexts/ResultsContext';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { usePricing } from '@/contexts/PricingContext';\nimport { usePhysiqueOptional } from '@/contexts/PhysiqueContext';\nimport { TabContent } from '../ResultsLayout';\nimport { EnhancedRecommendationCard } from '../cards/EnhancedRecommendationCard';\nimport { ScoreCircle, PhaseBadge } from '../shared';\nimport { BeforeAfterPreview } from '../visualization/BeforeAfterPreview';\nimport { FaceMorphing } from '../visualization/FaceMorphing';\nimport { TreatmentTimeline } from '../visualization/TreatmentTimeline';\nimport { RecommendationPhase, ProductRecommendation } from '@/types/results';\nimport { DailyStackCard } from '../cards/DailyStackCard';\nimport { ProductCard } from '../cards/ProductCard';\nimport { WeakPointCard } from '../cards/WeakPointCard';\nimport { ProgressComparisonCard } from '../cards/ProgressComparisonCard';\nimport { MedicalPrescriptionCard } from '../cards/MedicalPrescriptionCard';\nimport { generateDailyStack } from '@/lib/daily-stack';\nimport { getProductRecommendations } from '@/lib/product-recommendations';\nimport { SUPPLEMENTS } from '@/lib/recommendations/supplements';\nimport {\n  TreatmentConflictList,\n  SelectionWarningModal,\n} from '../cards/TreatmentConflictWarning';\nimport {\n  findTreatmentConflicts,\n  type TreatmentConflict,\n} from '@/lib/recommendations/engine';\n\n// ============================================\n// SECTION HEADER COMPONENT\n// ============================================\n\nfunction SectionHeader({ title, children }: { title: string; children?: React.ReactNode }) {\n  return (\n    <div className=\"flex items-center gap-4 mb-6\">\n      <h2 className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 whitespace-nowrap\">\n        {title}\n      </h2>\n      <div className=\"flex-1 h-px bg-neutral-800\" />\n      {children}\n    </div>\n  );\n}\n\n// ============================================\n// POTENTIAL SCORE CARD\n// ============================================\n\nfunction PotentialScoreCard() {\n  const { overallScore, recommendations } = useResults();\n  const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n\n  // Calculate potential improvement\n  const potentialImprovement = useMemo(() => {\n    if (recommendations.length === 0) return 0;\n    const totalImpact = recommendations.slice(0, 5).reduce((sum, r) => sum + (r.impact || 0), 0);\n    return Math.min(totalImpact * 1.5, 10 - numericScore);\n  }, [recommendations, numericScore]);\n\n  const potentialScore = Math.min(10, numericScore + potentialImprovement);\n\n  return (\n    <motion.div\n      className=\"rounded-[2rem] bg-neutral-900/40 border border-white/5 p-6 md:p-8\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-center gap-3 mb-6\">\n        <div className=\"w-10 h-10 rounded-xl bg-neutral-900 border border-white/10 flex items-center justify-center\">\n          <Sparkles size={18} className=\"text-cyan-400\" />\n        </div>\n        <div>\n          <h3 className=\"text-sm font-black uppercase tracking-wider text-white\">Your Potential</h3>\n          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600\">Maximum Achievable Score</p>\n        </div>\n      </div>\n\n      <div className=\"flex items-center justify-center gap-6 md:gap-10 mb-6\">\n        {/* Current */}\n        <div className=\"text-center\">\n          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mb-3\">Current</p>\n          <ScoreCircle score={overallScore} size=\"lg\" animate={false} />\n        </div>\n\n        {/* Arrow */}\n        <div className=\"flex flex-col items-center gap-2\">\n          <ChevronRight size={28} className=\"text-cyan-400\" />\n          <span className=\"px-2 py-1 rounded-lg bg-green-500/20 border border-green-500/30 text-xs font-black uppercase tracking-wider text-green-400\">\n            +{potentialImprovement.toFixed(1)}\n          </span>\n        </div>\n\n        {/* Potential */}\n        <div className=\"text-center\">\n          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mb-3\">Potential</p>\n          <div className=\"relative\">\n            <ScoreCircle score={potentialScore} size=\"lg\" animate={false} />\n            <div className=\"absolute -top-1 -right-1 w-6 h-6 bg-green-500 rounded-lg flex items-center justify-center shadow-lg shadow-green-500/30\">\n              <TrendingUp size={14} className=\"text-black\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <p className=\"text-sm text-neutral-400 text-center leading-relaxed\">\n        Following our recommendations could improve your harmony score by up to{' '}\n        <span className=\"text-green-400 font-black\">+{potentialImprovement.toFixed(1)} points</span>\n      </p>\n    </motion.div>\n  );\n}\n\n// ============================================\n// PHASE FILTER\n// ============================================\n\ninterface PhaseFilterProps {\n  selectedPhase: RecommendationPhase | null;\n  onSelect: (phase: RecommendationPhase | null) => void;\n  counts: Record<RecommendationPhase, number>;\n}\n\nfunction PhaseFilter({ selectedPhase, onSelect, counts }: PhaseFilterProps) {\n  const phases: RecommendationPhase[] = ['Foundational', 'Minimally Invasive', 'Surgical'];\n\n  return (\n    <div className=\"flex flex-wrap gap-2\">\n      <button\n        onClick={() => onSelect(null)}\n        className={`px-4 py-2 rounded-xl text-xs font-black uppercase tracking-wider transition-all border ${selectedPhase === null\n          ? 'bg-cyan-500 text-black border-cyan-400'\n          : 'bg-neutral-900/50 text-neutral-400 border-white/5 hover:border-white/10 hover:text-white'\n          }`}\n      >\n        All ({Object.values(counts).reduce((a, b) => a + b, 0)})\n      </button>\n      {phases.map(phase => (\n        <button\n          key={phase}\n          onClick={() => onSelect(phase)}\n          className={`px-4 py-2 rounded-xl text-xs font-black uppercase tracking-wider transition-all flex items-center gap-2 border ${selectedPhase === phase\n            ? 'bg-neutral-800 text-white border-white/10'\n            : 'bg-neutral-900/50 text-neutral-400 border-white/5 hover:border-white/10 hover:text-white'\n            }`}\n        >\n          <PhaseBadge phase={phase} size=\"sm\" />\n          ({counts[phase] || 0})\n        </button>\n      ))}\n    </div>\n  );\n}\n\n// ============================================\n// BEFORE/AFTER PREVIEW SECTION WITH MORPHING\n// ============================================\n\ntype PreviewMode = 'static' | 'morphing';\n\nfunction BeforeAfterPreviewSection() {\n  const { frontPhoto, overallScore, recommendations, frontLandmarks } = useResults();\n  const [previewMode, setPreviewMode] = useState<PreviewMode>('morphing');\n  const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n\n  // Calculate potential improvement\n  const potentialImprovement = useMemo(() => {\n    if (recommendations.length === 0) return 0;\n    const totalImpact = recommendations.slice(0, 5).reduce((sum, r) => sum + r.impact, 0);\n    return Math.min(totalImpact * 1.5, 10 - numericScore);\n  }, [recommendations, numericScore]);\n\n  const potentialScore = Math.min(10, numericScore + potentialImprovement);\n\n  if (!frontPhoto) return null;\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Mode Toggle */}\n      <div className=\"flex items-center justify-center gap-1 p-1 bg-neutral-900/50 rounded-xl border border-white/5\">\n        <button\n          onClick={() => setPreviewMode('morphing')}\n          className={`flex-1 px-4 py-2 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${\n            previewMode === 'morphing'\n              ? 'bg-cyan-500/20 text-cyan-400 border border-cyan-500/30'\n              : 'text-neutral-500 hover:text-white border border-transparent'\n          }`}\n        >\n          Face Morphing\n        </button>\n        <button\n          onClick={() => setPreviewMode('static')}\n          className={`flex-1 px-4 py-2 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${\n            previewMode === 'static'\n              ? 'bg-neutral-800 text-white border border-white/10'\n              : 'text-neutral-500 hover:text-white border border-transparent'\n          }`}\n        >\n          Static Preview\n        </button>\n      </div>\n\n      {/* Preview Component */}\n      <AnimatePresence mode=\"wait\">\n        {previewMode === 'morphing' && frontLandmarks.length > 0 ? (\n          <motion.div\n            key=\"morphing\"\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: 20 }}\n            transition={{ duration: 0.2 }}\n          >\n            <FaceMorphing\n              photo={frontPhoto}\n              frontLandmarks={frontLandmarks}\n              currentScore={numericScore}\n              potentialScore={potentialScore}\n              recommendations={recommendations}\n            />\n          </motion.div>\n        ) : (\n          <motion.div\n            key=\"static\"\n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: -20 }}\n            transition={{ duration: 0.2 }}\n          >\n            <BeforeAfterPreview\n              photo={frontPhoto}\n              currentScore={numericScore}\n              potentialScore={potentialScore}\n              recommendations={recommendations}\n            />\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// ORDER OF OPERATIONS\n// ============================================\n\nfunction OrderOfOperations() {\n  return (\n    <div className=\"rounded-2xl bg-neutral-900/40 border border-white/5 p-5\">\n      <h4 className=\"text-xs font-black uppercase tracking-wider text-white mb-4 flex items-center gap-3\">\n        <div className=\"w-8 h-8 rounded-lg bg-neutral-900 border border-white/10 flex items-center justify-center\">\n          <Target size={14} className=\"text-cyan-400\" />\n        </div>\n        Recommended Order\n      </h4>\n      <div className=\"space-y-4\">\n        <div className=\"flex items-start gap-4\">\n          <div className=\"w-7 h-7 rounded-lg bg-green-500/20 border border-green-500/30 flex items-center justify-center flex-shrink-0 mt-0.5\">\n            <span className=\"text-xs font-black text-green-400\">1</span>\n          </div>\n          <div>\n            <p className=\"text-sm font-black uppercase tracking-wider text-white\">Start with Foundational</p>\n            <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mt-1\">Low-cost, no-risk improvements</p>\n          </div>\n        </div>\n        <div className=\"flex items-start gap-4\">\n          <div className=\"w-7 h-7 rounded-lg bg-yellow-500/20 border border-yellow-500/30 flex items-center justify-center flex-shrink-0 mt-0.5\">\n            <span className=\"text-xs font-black text-yellow-400\">2</span>\n          </div>\n          <div>\n            <p className=\"text-sm font-black uppercase tracking-wider text-white\">Consider Minimally Invasive</p>\n            <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mt-1\">Temporary or reversible options</p>\n          </div>\n        </div>\n        <div className=\"flex items-start gap-4\">\n          <div className=\"w-7 h-7 rounded-lg bg-red-500/20 border border-red-500/30 flex items-center justify-center flex-shrink-0 mt-0.5\">\n            <span className=\"text-xs font-black text-red-400\">3</span>\n          </div>\n          <div>\n            <p className=\"text-sm font-black uppercase tracking-wider text-white\">Evaluate Surgical Options</p>\n            <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mt-1\">Permanent solutions for significant improvements</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// YOUR PHASE CARD (Body Composition Phase)\n// ============================================\n\ntype BodyPhase = 'bulk' | 'cut' | 'maintain';\n\ninterface YourPhaseCardProps {\n  bodyFatPercent?: number;\n  gender: 'male' | 'female';\n}\n\nfunction YourPhaseCard({ bodyFatPercent, gender }: YourPhaseCardProps) {\n  // Determine phase based on body fat and gender\n  const getPhase = (): { phase: BodyPhase; message: string; color: string; icon: React.ReactNode } => {\n    if (!bodyFatPercent) {\n      return {\n        phase: 'maintain',\n        message: 'Complete your physique analysis to get personalized phase recommendations.',\n        color: 'from-neutral-800 to-neutral-900',\n        icon: <Scale size={24} className=\"text-neutral-400\" />,\n      };\n    }\n\n    // Male thresholds: <12% = bulk, 12-18% = maintain, >18% = cut\n    // Female thresholds: <18% = bulk, 18-25% = maintain, >25% = cut\n    const bulkThreshold = gender === 'male' ? 12 : 18;\n    const cutThreshold = gender === 'male' ? 18 : 25;\n\n    if (bodyFatPercent < bulkThreshold) {\n      return {\n        phase: 'bulk',\n        message: `At ${bodyFatPercent.toFixed(1)}% body fat, you're lean enough to build muscle. Focus on a slight caloric surplus with progressive overload.`,\n        color: 'from-green-600 to-emerald-700',\n        icon: <Dumbbell size={24} className=\"text-white\" />,\n      };\n    } else if (bodyFatPercent > cutThreshold) {\n      return {\n        phase: 'cut',\n        message: `At ${bodyFatPercent.toFixed(1)}% body fat, prioritize fat loss. A moderate caloric deficit with high protein will reveal your facial structure.`,\n        color: 'from-orange-600 to-red-700',\n        icon: <Salad size={24} className=\"text-white\" />,\n      };\n    } else {\n      return {\n        phase: 'maintain',\n        message: `At ${bodyFatPercent.toFixed(1)}% body fat, you're in the optimal range. Focus on body recomposition to build muscle while staying lean.`,\n        color: 'from-blue-600 to-cyan-700',\n        icon: <Scale size={24} className=\"text-white\" />,\n      };\n    }\n  };\n\n  const { phase, message, color, icon } = getPhase();\n  const phaseLabels: Record<BodyPhase, string> = {\n    bulk: 'Lean Bulk Phase',\n    cut: 'Cutting Phase',\n    maintain: 'Maintenance Phase',\n  };\n\n  return (\n    <motion.div\n      className={`bg-gradient-to-br ${color} rounded-[2rem] p-6 md:p-8 border border-white/10`}\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-start gap-5\">\n        <div className=\"w-14 h-14 rounded-2xl bg-white/20 border border-white/20 flex items-center justify-center flex-shrink-0 shadow-xl\">\n          {icon}\n        </div>\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-3 mb-2\">\n            <h3 className=\"text-lg font-black uppercase tracking-wider text-white\">Your Phase</h3>\n            <div className=\"px-3 py-1 bg-white/20 border border-white/20 rounded-lg text-[10px] font-black uppercase tracking-wider text-white\">\n              {phaseLabels[phase]}\n            </div>\n          </div>\n          <p className=\"text-sm text-white/80 leading-relaxed mb-5\">{message}</p>\n\n          {/* Phase-specific tips */}\n          <div className=\"grid grid-cols-3 gap-3\">\n            <div className=\"bg-black/20 rounded-xl p-3 text-center border border-white/10\">\n              <div className=\"flex items-center justify-center gap-1.5 mb-1\">\n                {phase === 'bulk' ? (\n                  <ArrowUp size={12} className=\"text-green-300\" />\n                ) : phase === 'cut' ? (\n                  <ArrowDown size={12} className=\"text-orange-300\" />\n                ) : (\n                  <Minus size={12} className=\"text-blue-300\" />\n                )}\n                <span className=\"text-[10px] font-bold uppercase tracking-wider text-white/60\">Calories</span>\n              </div>\n              <span className=\"text-sm font-black uppercase text-white\">\n                {phase === 'bulk' ? '+300' : phase === 'cut' ? '-500' : '+/-0'}\n              </span>\n            </div>\n            <div className=\"bg-black/20 rounded-xl p-3 text-center border border-white/10\">\n              <span className=\"text-[10px] font-bold uppercase tracking-wider text-white/60 block mb-1\">Protein</span>\n              <span className=\"text-sm font-black uppercase text-white\">\n                {phase === 'cut' ? '1.2g/lb' : '1g/lb'}\n              </span>\n            </div>\n            <div className=\"bg-black/20 rounded-xl p-3 text-center border border-white/10\">\n              <span className=\"text-[10px] font-bold uppercase tracking-wider text-white/60 block mb-1\">Cardio</span>\n              <span className=\"text-sm font-black uppercase text-white\">\n                {phase === 'bulk' ? 'Minimal' : phase === 'cut' ? '4-5x/wk' : '2-3x/wk'}\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// PRODUCT BUNDLE CTA\n// ============================================\n\ninterface ProductBundleCardProps {\n  products: ProductRecommendation[];\n  title?: string;\n}\n\nfunction ProductBundleCard({ products, title = 'Recommended Bundle' }: ProductBundleCardProps) {\n  // Get top 3 most important products\n  const bundleProducts = products.slice(0, 3);\n\n  // Calculate total cost\n  const totalCost = bundleProducts.reduce((sum, rec) => {\n    const supplement = SUPPLEMENTS.find(s => s.id === rec.product.supplementId);\n    return sum + (supplement?.costPerMonth.min || 0);\n  }, 0);\n\n  if (bundleProducts.length === 0) return null;\n\n  return (\n    <motion.div\n      className=\"rounded-[2rem] bg-gradient-to-br from-purple-900/50 to-violet-950/50 border border-purple-500/30 p-6\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-center gap-3 mb-5\">\n        <div className=\"w-10 h-10 rounded-xl bg-purple-500/20 border border-purple-500/30 flex items-center justify-center\">\n          <Package size={18} className=\"text-purple-400\" />\n        </div>\n        <div className=\"flex-1\">\n          <h3 className=\"text-sm font-black uppercase tracking-wider text-white\">{title}</h3>\n        </div>\n        <div className=\"px-3 py-1.5 bg-purple-500/20 border border-purple-500/30 text-purple-300 text-[10px] font-black uppercase tracking-wider rounded-lg\">\n          Save 15%\n        </div>\n      </div>\n\n      <p className=\"text-sm text-neutral-300 mb-5 leading-relaxed\">\n        Your analysis recommends these {bundleProducts.length} supplements - optimized for your specific weak points.\n      </p>\n\n      {/* Bundle Items */}\n      <div className=\"space-y-2 mb-5\">\n        {bundleProducts.map((rec, index) => (\n          <div\n            key={rec.product.id}\n            className=\"flex items-center gap-4 p-3 bg-black/30 rounded-xl border border-white/5\"\n          >\n            <div className=\"w-7 h-7 rounded-lg bg-purple-500/30 border border-purple-500/30 flex items-center justify-center flex-shrink-0\">\n              <span className=\"text-xs font-black text-purple-300\">{index + 1}</span>\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-sm font-black uppercase tracking-wider text-white truncate\">{rec.product.name}</p>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-500 truncate\">Targets: {rec.targetMetric}</p>\n            </div>\n            <div className=\"text-right flex-shrink-0\">\n              <p className=\"text-sm font-black text-white\">\n                ${SUPPLEMENTS.find(s => s.id === rec.product.supplementId)?.costPerMonth.min || 0}/mo\n              </p>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* Total & CTA */}\n      <div className=\"border-t border-purple-500/20 pt-5\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <span className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-400\">Bundle Total</span>\n          <div className=\"text-right\">\n            <span className=\"text-xl font-black text-white\">${totalCost}/mo</span>\n            <span className=\"text-xs font-bold text-neutral-500 ml-2 line-through\">${Math.round(totalCost * 1.15)}/mo</span>\n          </div>\n        </div>\n        <button\n          className=\"w-full flex items-center justify-center gap-3 py-3.5 bg-gradient-to-r from-purple-500 to-violet-600 text-white text-xs font-black uppercase tracking-wider rounded-xl hover:opacity-90 transition-opacity border border-purple-400/30\"\n        >\n          <ShoppingCart size={16} />\n          Get Your Bundle\n        </button>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// PLAN TAB\n// ============================================\n\nexport function PlanTab() {\n  const { recommendations, flaws, gender, ethnicity, frontRatios, sideRatios, overallScore, frontPhoto, vision, isUnlocked } = useResults();\n  const { user } = useAuth();\n  const physiqueContext = usePhysiqueOptional();\n  const [selectedPhase, setSelectedPhase] = useState<RecommendationPhase | null>(null);\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [completedIds, setCompletedIds] = useState<Set<string>>(new Set());\n  const [removedIds, setRemovedIds] = useState<Set<string>>(new Set());\n  const [previousAnalysis, setPreviousAnalysis] = useState<{\n    date: string;\n    overallScore: number;\n    bodyFatPercent?: number;\n    frontPhotoUrl?: string;\n  } | null>(null);\n\n  // Treatment conflict state\n  const [dismissedConflicts, setDismissedConflicts] = useState<Set<string>>(new Set());\n  const [conflictModal, setConflictModal] = useState<{\n    isOpen: boolean;\n    conflict: TreatmentConflict | null;\n    newTreatmentId: string;\n  }>({ isOpen: false, conflict: null, newTreatmentId: '' });\n\n  const { openPricingModal } = usePricing();\n\n  // Convert to number for arithmetic operations\n  const numericOverallScore = typeof overallScore === 'number' ? overallScore : 0;\n\n  // Check if user has a paid plan\n  const hasPaidPlan = user?.plan === 'basic' || user?.plan === 'pro';\n\n  // Get body fat from physique analysis\n  const bodyFatPercent = physiqueContext?.physiqueAnalysis?.bodyFatPercent;\n\n  // Generate Daily Stack for all users\n  const dailyStack = useMemo(() => {\n    return generateDailyStack(gender);\n  }, [gender]);\n\n  // Generate Product Recommendations based on metrics\n  const productRecommendations = useMemo(() => {\n    // Build metrics and severity dictionaries from ratios\n    const metricsDict: Record<string, number> = {};\n    const severityDict: Record<string, string> = {};\n\n    [...frontRatios, ...sideRatios].forEach(ratio => {\n      metricsDict[ratio.name] = typeof ratio.value === 'number' ? ratio.value : 0;\n      severityDict[ratio.name] = ratio.severity;\n    });\n\n    return getProductRecommendations(metricsDict, severityDict, gender, ethnicity);\n  }, [frontRatios, sideRatios, gender, ethnicity]);\n\n  // Split product recommendations by state\n  const { flawProducts, idealProducts } = useMemo(() => {\n    const flaw = productRecommendations.filter(r => r.state === 'flaw');\n    const ideal = productRecommendations.filter(r => r.state === 'ideal');\n    return { flawProducts: flaw, idealProducts: ideal };\n  }, [productRecommendations]);\n\n  // Map flaws to products and treatments\n  const flawsWithProducts = useMemo(() => {\n    return flaws.slice(0, 5).map(flaw => {\n      // Find products that target metrics related to this flaw\n      const relatedProducts = productRecommendations.filter(rec =>\n        flaw && flaw.responsibleRatios && flaw.responsibleRatios.some(ratio =>\n          rec.matchedMetrics.some(metric =>\n            metric.toLowerCase().includes(ratio.ratioName.toLowerCase()) ||\n            ratio.ratioName.toLowerCase().includes(metric.toLowerCase())\n          )\n        )\n      );\n\n      // Find treatments that match this flaw\n      const relatedTreatments = recommendations.filter(rec =>\n        rec.matchedFlaws.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase()))\n      );\n\n      return {\n        flaw,\n        products: relatedProducts.slice(0, 2),\n        treatments: relatedTreatments.slice(0, 3),\n      };\n    });\n  }, [flaws, productRecommendations, recommendations]);\n\n  // Handle progress photo upload\n  const handleProgressPhotoUpload = useCallback(async (file: File) => {\n    // Store current analysis as previous before re-analyzing\n    const numScore = typeof overallScore === 'number' ? overallScore : 0;\n    setPreviousAnalysis({\n      date: new Date().toISOString(),\n      overallScore: numScore,\n      bodyFatPercent,\n      frontPhotoUrl: frontPhoto || undefined,\n    });\n\n    // In a real implementation, this would upload to API and trigger re-analysis\n    console.log('Progress photo uploaded:', file.name);\n  }, [overallScore, bodyFatPercent, frontPhoto]);\n\n  // Count recommendations by phase\n  const phaseCounts = useMemo(() => {\n    const counts: Record<RecommendationPhase, number> = {\n      'Foundational': 0,\n      'Minimally Invasive': 0,\n      'Surgical': 0,\n    };\n    recommendations.forEach(r => {\n      if (!removedIds.has(r.ref_id)) {\n        counts[r.phase]++;\n      }\n    });\n    return counts;\n  }, [recommendations, removedIds]);\n\n  // Filter recommendations\n  const filteredRecommendations = useMemo(() => {\n    let filtered = recommendations.filter(r => !removedIds.has(r.ref_id));\n    if (selectedPhase) {\n      filtered = filtered.filter(r => r.phase === selectedPhase);\n    }\n    return filtered;\n  }, [recommendations, selectedPhase, removedIds]);\n\n  const hasRecommendations = filteredRecommendations.length > 0;\n\n  // Detect treatment conflicts in current recommendations\n  const treatmentConflicts = useMemo(() => {\n    const selectedIds = filteredRecommendations.map(r => r.ref_id);\n    const nameMap = Object.fromEntries(\n      filteredRecommendations.map(r => [r.ref_id, r.name])\n    );\n    const conflicts = findTreatmentConflicts(selectedIds, nameMap);\n\n    // Filter out dismissed conflicts\n    return conflicts.filter(c => {\n      const conflictKey = `${c.treatment1Id}-${c.treatment2Id}`;\n      return !dismissedConflicts.has(conflictKey);\n    });\n  }, [filteredRecommendations, dismissedConflicts]);\n\n  // Handle dismissing a conflict\n  const handleDismissConflict = useCallback((conflict: TreatmentConflict) => {\n    const conflictKey = `${conflict.treatment1Id}-${conflict.treatment2Id}`;\n    setDismissedConflicts(prev => new Set(Array.from(prev).concat(conflictKey)));\n  }, []);\n\n  // Handle dismissing all conflicts\n  const handleDismissAllConflicts = useCallback(() => {\n    const allKeys = treatmentConflicts.map(\n      c => `${c.treatment1Id}-${c.treatment2Id}`\n    );\n    setDismissedConflicts(prev => new Set(Array.from(prev).concat(allKeys)));\n  }, [treatmentConflicts]);\n\n  // Handle conflict modal actions\n  const handleConflictProceed = useCallback(() => {\n    if (conflictModal.conflict) {\n      // Remove the lower priority (existing) treatment\n      setRemovedIds(prev => new Set(Array.from(prev).concat(conflictModal.conflict!.treatment1Id)));\n    }\n    setConflictModal({ isOpen: false, conflict: null, newTreatmentId: '' });\n  }, [conflictModal.conflict]);\n\n  const handleConflictCancel = useCallback(() => {\n    setConflictModal({ isOpen: false, conflict: null, newTreatmentId: '' });\n  }, []);\n\n  // Handle mark complete\n  const handleMarkComplete = useCallback((id: string) => {\n    setCompletedIds(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(id)) {\n        newSet.delete(id);\n      } else {\n        newSet.add(id);\n      }\n      return newSet;\n    });\n  }, []);\n\n  // Handle remove\n  const handleRemove = useCallback((id: string) => {\n    setRemovedIds(prev => {\n      const newSet = new Set(prev);\n      newSet.add(id);\n      return newSet;\n    });\n    if (expandedId === id) {\n      setExpandedId(null);\n    }\n  }, [expandedId]);\n\n  return (\n    <TabContent\n      title=\"Your Plan & Potential\"\n      subtitle=\"Personalized recommendations based on your analysis\"\n    >\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n        {/* Main Content */}\n        <div className=\"lg:col-span-2 space-y-10\">\n          {/* Your Phase Card - Body Composition Phase */}\n          <YourPhaseCard bodyFatPercent={bodyFatPercent} gender={gender} />\n\n          {/* Daily Stack Card - Hero Element for ALL users */}\n          {dailyStack && <DailyStackCard dailyStack={dailyStack} />}\n\n          {/* Potential Score */}\n          <PotentialScoreCard />\n\n          {/* Fix Your Weak Points Section */}\n          {flawsWithProducts.length > 0 && (\n            <section>\n              <SectionHeader title=\"Fix Your Weak Points\">\n                <span className=\"px-3 py-1.5 bg-red-500/20 border border-red-500/30 text-red-400 text-[10px] font-black uppercase tracking-wider rounded-lg\">\n                  {flawsWithProducts.length} Issues\n                </span>\n              </SectionHeader>\n              <div className=\"space-y-4\">\n                {flawsWithProducts.map((item, index) => (\n                  <WeakPointCard\n                    key={item.flaw.id}\n                    flaw={item.flaw}\n                    rank={index + 1}\n                    products={item.products}\n                    treatments={item.treatments}\n                    onViewTreatment={(treatment) => setExpandedId(treatment.ref_id)}\n                  />\n                ))}\n              </div>\n            </section>\n          )}\n\n          {/* Targeted Product Recommendations - Corrective */}\n          {flawProducts.length > 0 && (\n            <section>\n              <SectionHeader title=\"Recommended Products\">\n                <span className=\"px-3 py-1.5 bg-cyan-500/20 border border-cyan-500/30 text-cyan-400 text-[10px] font-black uppercase tracking-wider rounded-lg\">\n                  Corrective\n                </span>\n              </SectionHeader>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {flawProducts.slice(0, 6).map((rec, index) => (\n                  <ProductCard key={rec.product.id} recommendation={rec} rank={index + 1} />\n                ))}\n              </div>\n            </section>\n          )}\n\n          {/* Targeted Product Recommendations - Maintenance */}\n          {idealProducts.length > 0 && (\n            <section>\n              <SectionHeader title=\"Protect Your Strengths\">\n                <span className=\"px-3 py-1.5 bg-green-500/20 border border-green-500/30 text-green-400 text-[10px] font-black uppercase tracking-wider rounded-lg\">\n                  Maintenance\n                </span>\n              </SectionHeader>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {idealProducts.slice(0, 4).map((rec) => (\n                  <ProductCard key={rec.product.id} recommendation={rec} />\n                ))}\n              </div>\n            </section>\n          )}\n\n          {/* Treatment Timeline */}\n          {recommendations.length > 0 && (\n            <section>\n              <SectionHeader title=\"Treatment Timeline\" />\n              <TreatmentTimeline recommendations={recommendations.filter(r => !removedIds.has(r.ref_id))} />\n            </section>\n          )}\n\n          {/* Treatment Conflict Warnings */}\n          {treatmentConflicts.length > 0 && (\n            <TreatmentConflictList\n              conflicts={treatmentConflicts}\n              onDismiss={handleDismissConflict}\n              onDismissAll={handleDismissAllConflicts}\n            />\n          )}\n\n          {/* Phase Filter Section */}\n          <section>\n            <SectionHeader title=\"Treatment Options\" />\n            <PhaseFilter\n              selectedPhase={selectedPhase}\n              onSelect={setSelectedPhase}\n              counts={phaseCounts}\n            />\n          </section>\n\n          {/* Recommendations List */}\n          {hasRecommendations ? (\n            <motion.div className=\"space-y-4\" layout>\n              <AnimatePresence mode=\"popLayout\">\n                {filteredRecommendations.map((rec, index) => (\n                  <motion.div\n                    key={rec.ref_id}\n                    layout\n                    initial={{ opacity: 0, y: 20 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    exit={{ opacity: 0, y: -20 }}\n                    transition={{ duration: 0.2, delay: index * 0.05 }}\n                  >\n                    <EnhancedRecommendationCard\n                      recommendation={rec}\n                      rank={index + 1}\n                      isExpanded={expandedId === rec.ref_id}\n                      onToggle={() => setExpandedId(\n                        expandedId === rec.ref_id ? null : rec.ref_id\n                      )}\n                      onMarkComplete={handleMarkComplete}\n                      onRemove={handleRemove}\n                      isCompleted={completedIds.has(rec.ref_id)}\n                      gender={gender}\n                      ethnicity={ethnicity}\n                    />\n                  </motion.div>\n                ))}\n              </AnimatePresence>\n            </motion.div>\n          ) : (\n            <div className=\"rounded-[2rem] bg-neutral-900/40 border border-white/5 p-10 text-center\">\n              <div className=\"w-16 h-16 rounded-2xl bg-neutral-900 border border-white/10 flex items-center justify-center mx-auto mb-5\">\n                <Sparkles size={28} className=\"text-neutral-600\" />\n              </div>\n              <h3 className=\"text-lg font-black uppercase tracking-wider text-white mb-2\">No Recommendations Yet</h3>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600\">\n                Complete a facial analysis to get personalized recommendations\n              </p>\n            </div>\n          )}\n        </div>\n\n        {/* Sidebar */}\n        <div className=\"space-y-6\">\n          {/* Medical Prescription Card (Dental) */}\n          {vision?.teeth && (\n            <MedicalPrescriptionCard vision={vision} isUnlocked={isUnlocked} />\n          )}\n\n          {/* Progress Comparison Card */}\n          <ProgressComparisonCard\n            currentAnalysis={{\n              date: new Date().toISOString(),\n              overallScore: numericOverallScore,\n              bodyFatPercent,\n              frontPhotoUrl: frontPhoto || undefined,\n            }}\n            previousAnalysis={previousAnalysis}\n            onUploadNewPhoto={handleProgressPhotoUpload}\n          />\n\n          {/* Product Bundle CTA */}\n          {flawProducts.length >= 3 && (\n            <ProductBundleCard\n              products={flawProducts}\n              title=\"Your Fix Bundle\"\n            />\n          )}\n\n          {/* Before/After Preview */}\n          <BeforeAfterPreviewSection />\n\n          {/* Order of Operations */}\n          <OrderOfOperations />\n\n          {/* My Plan Summary */}\n          <div className=\"rounded-2xl bg-neutral-900/40 border border-white/5 p-5\">\n            <h4 className=\"text-xs font-black uppercase tracking-wider text-white mb-4 flex items-center gap-3\">\n              <div className=\"w-8 h-8 rounded-lg bg-neutral-900 border border-white/10 flex items-center justify-center\">\n                <Zap size={14} className=\"text-yellow-400\" />\n              </div>\n              My Plan\n            </h4>\n            <div className=\"text-center py-8\">\n              <div className=\"w-14 h-14 mx-auto mb-4 rounded-2xl bg-neutral-900 border border-white/10 flex items-center justify-center\">\n                <Lock size={20} className=\"text-neutral-600\" />\n              </div>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mb-2\">\n                Add recommendations to build your personalized plan\n              </p>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-700\">\n                0 items selected\n              </p>\n            </div>\n          </div>\n\n          {/* Issues Summary */}\n          <div className=\"rounded-2xl bg-neutral-900/40 border border-white/5 p-5\">\n            <h4 className=\"text-xs font-black uppercase tracking-wider text-white mb-4\">Detected Issues</h4>\n            <div className=\"space-y-2\">\n              {flaws.slice(0, 5).map(flaw => (\n                <div\n                  key={flaw.id}\n                  className=\"flex items-center justify-between p-3 bg-neutral-900/50 border border-white/5 rounded-xl hover:border-white/10 transition-colors\"\n                >\n                  <span className=\"text-sm font-bold text-neutral-300 truncate\">{flaw.flawName}</span>\n                  <span className=\"text-[10px] font-black uppercase tracking-wider text-red-400 flex-shrink-0 px-2 py-1 bg-red-500/20 border border-red-500/30 rounded-lg\">\n                    -{flaw.harmonyPercentageLost.toFixed(1)}%\n                  </span>\n                </div>\n              ))}\n              {flaws.length === 0 && (\n                <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 text-center py-6\">\n                  No issues detected\n                </p>\n              )}\n            </div>\n          </div>\n\n          {/* Upgrade CTA or Premium Badge */}\n          {hasPaidPlan ? (\n            <motion.div\n              className=\"rounded-2xl bg-gradient-to-br from-green-500/10 to-emerald-600/10 border border-green-500/30 p-5\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.3 }}\n            >\n              <div className=\"flex items-center gap-3 mb-3\">\n                <div className=\"w-8 h-8 rounded-lg bg-green-500/20 border border-green-500/30 flex items-center justify-center\">\n                  <CheckCircle size={14} className=\"text-green-400\" />\n                </div>\n                <span className=\"text-xs font-black uppercase tracking-wider text-white\">\n                  {user?.plan === 'pro' ? 'Pro Plan' : 'Basic Plan'} Active\n                </span>\n              </div>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-500\">\n                You have full access to all {user?.plan === 'pro' ? 'features' : 'non-surgical recommendations'}.\n              </p>\n            </motion.div>\n          ) : (\n            <motion.div\n              className=\"rounded-2xl bg-gradient-to-br from-cyan-500/10 to-blue-600/10 border border-cyan-500/30 p-5\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.3 }}\n            >\n              <div className=\"flex items-center gap-3 mb-3\">\n                <div className=\"w-8 h-8 rounded-lg bg-cyan-500/20 border border-cyan-500/30 flex items-center justify-center\">\n                  <Sparkles size={14} className=\"text-cyan-400\" />\n                </div>\n                <span className=\"text-xs font-black uppercase tracking-wider text-white\">Unlock Full Plan</span>\n              </div>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-500 mb-4\">\n                Get detailed treatment guides, cost estimates, and provider recommendations.\n              </p>\n              <button\n                onClick={() => openPricingModal('plan_sidebar')}\n                className=\"block w-full py-3 bg-cyan-500 text-black text-xs font-black uppercase tracking-wider rounded-xl text-center hover:bg-cyan-400 transition-colors\"\n              >\n                Upgrade Now\n              </button>\n            </motion.div>\n          )}\n        </div>\n      </div>\n\n      {/* Treatment Conflict Modal */}\n      <SelectionWarningModal\n        isOpen={conflictModal.isOpen}\n        onClose={handleConflictCancel}\n        conflict={conflictModal.conflict || {\n          treatment1Id: '',\n          treatment1Name: '',\n          treatment2Id: '',\n          treatment2Name: '',\n          reason: '',\n        }}\n        onProceed={handleConflictProceed}\n        onCancel={handleConflictCancel}\n      />\n    </TabContent>\n  );\n}\n"}}],"stop_reason":"tool_use","stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":479,"cache_read_input_tokens":55973,"cache_creation":{"ephemeral_5m_input_tokens":479,"ephemeral_1h_input_tokens":0},"output_tokens":12217,"service_tier":"standard"}},"requestId":"req_011CWVwZ5nAC6z9uLzwt72NY","type":"assistant","uuid":"906bf109-da6e-4510-9bc5-9a37a54de080","timestamp":"2025-12-26T20:40:29.731Z"}
{"parentUuid":"906bf109-da6e-4510-9bc5-9a37a54de080","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01RPNQqcVD8e4uNvEisMPrgE","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/PlanTab.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n     1→'use client';\n     2→\n     3→import { useState, useMemo, useCallback } from 'react';\n     4→import { motion, AnimatePresence } from 'framer-motion';\n     5→import {\n     6→  Sparkles,\n     7→  TrendingUp,\n     8→  Target,\n     9→  Zap,\n    10→  ChevronRight,\n    11→  Lock,\n    12→  CheckCircle,\n    13→  AlertCircle,\n    14→  CheckCircle2,\n    15→  Scale,\n    16→  Dumbbell,\n    17→  Salad,\n    18→  ArrowDown,\n    19→  ArrowUp,\n    20→  Minus,\n    21→  Package,\n    22→  ShoppingCart,\n    23→} from 'lucide-react';\n    24→import { useResults } from '@/contexts/ResultsContext';\n    25→import { useAuth } from '@/contexts/AuthContext';\n    26→import { usePricing } from '@/contexts/PricingContext';\n    27→import { usePhysiqueOptional } from '@/contexts/PhysiqueContext';\n    28→import { TabContent } from '../ResultsLayout';\n    29→import { EnhancedRecommendationCard } from '../cards/EnhancedRecommendationCard';\n    30→import { ScoreCircle, PhaseBadge } from '../shared';\n    31→import { BeforeAfterPreview } from '../visualization/BeforeAfterPreview';\n    32→import { FaceMorphing } from '../visualization/FaceMorphing';\n    33→import { TreatmentTimeline } from '../visualization/TreatmentTimeline';\n    34→import { RecommendationPhase, ProductRecommendation } from '@/types/results';\n    35→import { DailyStackCard } from '../cards/DailyStackCard';\n    36→import { ProductCard } from '../cards/ProductCard';\n    37→import { WeakPointCard } from '../cards/WeakPointCard';\n    38→import { ProgressComparisonCard } from '../cards/ProgressComparisonCard';\n    39→import { MedicalPrescriptionCard } from '../cards/MedicalPrescriptionCard';\n    40→import { generateDailyStack } from '@/lib/daily-stack';\n    41→import { getProductRecommendations } from '@/lib/product-recommendations';\n    42→import { SUPPLEMENTS } from '@/lib/recommendations/supplements';\n    43→import {\n    44→  TreatmentConflictList,\n    45→  SelectionWarningModal,\n    46→} from '../cards/TreatmentConflictWarning';\n    47→import {\n    48→  findTreatmentConflicts,\n    49→  type TreatmentConflict,\n    50→} from '@/lib/recommendations/engine';\n    51→\n    52→// ============================================\n    53→// SECTION HEADER COMPONENT\n    54→// ============================================\n    55→\n    56→function SectionHeader({ title, children }: { title: string; children?: React.ReactNode }) {\n    57→  return (\n    58→    <div className=\"flex items-center gap-4 mb-6\">\n    59→      <h2 className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 whitespace-nowrap\">\n    60→        {title}\n    61→      </h2>\n    62→      <div className=\"flex-1 h-px bg-neutral-800\" />\n    63→      {children}\n    64→    </div>\n    65→  );\n    66→}\n    67→\n    68→// ============================================\n    69→// POTENTIAL SCORE CARD\n    70→// ============================================\n    71→\n    72→function PotentialScoreCard() {\n    73→  const { overallScore, recommendations } = useResults();\n    74→  const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n    75→\n    76→  // Calculate potential improvement\n    77→  const potentialImprovement = useMemo(() => {\n    78→    if (recommendations.length === 0) return 0;\n    79→    const totalImpact = recommendations.slice(0, 5).reduce((sum, r) => sum + (r.impact || 0), 0);\n    80→    return Math.min(totalImpact * 1.5, 10 - numericScore);\n    81→  }, [recommendations, numericScore]);\n    82→\n    83→  const potentialScore = Math.min(10, numericScore + potentialImprovement);\n    84→\n    85→  return (\n    86→    <motion.div\n    87→      className=\"rounded-[2rem] bg-neutral-900/40 border border-white/5 p-6 md:p-8\"\n    88→      initial={{ opacity: 0, y: 20 }}\n    89→      animate={{ opacity: 1, y: 0 }}\n    90→    >\n    91→      <div className=\"flex items-center gap-3 mb-6\">\n    92→        <div className=\"w-10 h-10 rounded-xl bg-neutral-900 border border-white/10 flex items-center justify-center\">\n    93→          <Sparkles size={18} className=\"text-cyan-400\" />\n    94→        </div>\n    95→        <div>\n    96→          <h3 className=\"text-sm font-black uppercase tracking-wider text-white\">Your Potential</h3>\n    97→          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600\">Maximum Achievable Score</p>\n    98→        </div>\n    99→      </div>\n   100→\n   101→      <div className=\"flex items-center justify-center gap-6 md:gap-10 mb-6\">\n   102→        {/* Current */}\n   103→        <div className=\"text-center\">\n   104→          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mb-3\">Current</p>\n   105→          <ScoreCircle score={overallScore} size=\"lg\" animate={false} />\n   106→        </div>\n   107→\n   108→        {/* Arrow */}\n   109→        <div className=\"flex flex-col items-center gap-2\">\n   110→          <ChevronRight size={28} className=\"text-cyan-400\" />\n   111→          <span className=\"px-2 py-1 rounded-lg bg-green-500/20 border border-green-500/30 text-xs font-black uppercase tracking-wider text-green-400\">\n   112→            +{potentialImprovement.toFixed(1)}\n   113→          </span>\n   114→        </div>\n   115→\n   116→        {/* Potential */}\n   117→        <div className=\"text-center\">\n   118→          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mb-3\">Potential</p>\n   119→          <div className=\"relative\">\n   120→            <ScoreCircle score={potentialScore} size=\"lg\" animate={false} />\n   121→            <div className=\"absolute -top-1 -right-1 w-6 h-6 bg-green-500 rounded-lg flex items-center justify-center shadow-lg shadow-green-500/30\">\n   122→              <TrendingUp size={14} className=\"text-black\" />\n   123→            </div>\n   124→          </div>\n   125→        </div>\n   126→      </div>\n   127→\n   128→      <p className=\"text-sm text-neutral-400 text-center leading-relaxed\">\n   129→        Following our recommendations could improve your harmony score by up to{' '}\n   130→        <span className=\"text-green-400 font-black\">+{potentialImprovement.toFixed(1)} points</span>\n   131→      </p>\n   132→    </motion.div>\n   133→  );\n   134→}\n   135→\n   136→// ============================================\n   137→// PHASE FILTER\n   138→// ============================================\n   139→\n   140→interface PhaseFilterProps {\n   141→  selectedPhase: RecommendationPhase | null;\n   142→  onSelect: (phase: RecommendationPhase | null) => void;\n   143→  counts: Record<RecommendationPhase, number>;\n   144→}\n   145→\n   146→function PhaseFilter({ selectedPhase, onSelect, counts }: PhaseFilterProps) {\n   147→  const phases: RecommendationPhase[] = ['Foundational', 'Minimally Invasive', 'Surgical'];\n   148→\n   149→  return (\n   150→    <div className=\"flex flex-wrap gap-2\">\n   151→      <button\n   152→        onClick={() => onSelect(null)}\n   153→        className={`px-4 py-2 rounded-xl text-xs font-black uppercase tracking-wider transition-all border ${selectedPhase === null\n   154→          ? 'bg-cyan-500 text-black border-cyan-400'\n   155→          : 'bg-neutral-900/50 text-neutral-400 border-white/5 hover:border-white/10 hover:text-white'\n   156→          }`}\n   157→      >\n   158→        All ({Object.values(counts).reduce((a, b) => a + b, 0)})\n   159→      </button>\n   160→      {phases.map(phase => (\n   161→        <button\n   162→          key={phase}\n   163→          onClick={() => onSelect(phase)}\n   164→          className={`px-4 py-2 rounded-xl text-xs font-black uppercase tracking-wider transition-all flex items-center gap-2 border ${selectedPhase === phase\n   165→            ? 'bg-neutral-800 text-white border-white/10'\n   166→            : 'bg-neutral-900/50 text-neutral-400 border-white/5 hover:border-white/10 hover:text-white'\n   167→            }`}\n   168→        >\n   169→          <PhaseBadge phase={phase} size=\"sm\" />\n   170→          ({counts[phase] || 0})\n   171→        </button>\n   172→      ))}\n   173→    </div>\n   174→  );\n   175→}\n   176→\n   177→// ============================================\n   178→// BEFORE/AFTER PREVIEW SECTION WITH MORPHING\n   179→// ============================================\n   180→\n   181→type PreviewMode = 'static' | 'morphing';\n   182→\n   183→function BeforeAfterPreviewSection() {\n   184→  const { frontPhoto, overallScore, recommendations, frontLandmarks } = useResults();\n   185→  const [previewMode, setPreviewMode] = useState<PreviewMode>('morphing');\n   186→  const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n   187→\n   188→  // Calculate potential improvement\n   189→  const potentialImprovement = useMemo(() => {\n   190→    if (recommendations.length === 0) return 0;\n   191→    const totalImpact = recommendations.slice(0, 5).reduce((sum, r) => sum + r.impact, 0);\n   192→    return Math.min(totalImpact * 1.5, 10 - numericScore);\n   193→  }, [recommendations, numericScore]);\n   194→\n   195→  const potentialScore = Math.min(10, numericScore + potentialImprovement);\n   196→\n   197→  if (!frontPhoto) return null;\n   198→\n   199→  return (\n   200→    <div className=\"space-y-4\">\n   201→      {/* Mode Toggle */}\n   202→      <div className=\"flex items-center justify-center gap-1 p-1 bg-neutral-900/50 rounded-xl border border-white/5\">\n   203→        <button\n   204→          onClick={() => setPreviewMode('morphing')}\n   205→          className={`flex-1 px-4 py-2 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${\n   206→            previewMode === 'morphing'\n   207→              ? 'bg-cyan-500/20 text-cyan-400 border border-cyan-500/30'\n   208→              : 'text-neutral-500 hover:text-white border border-transparent'\n   209→          }`}\n   210→        >\n   211→          Face Morphing\n   212→        </button>\n   213→        <button\n   214→          onClick={() => setPreviewMode('static')}\n   215→          className={`flex-1 px-4 py-2 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${\n   216→            previewMode === 'static'\n   217→              ? 'bg-neutral-800 text-white border border-white/10'\n   218→              : 'text-neutral-500 hover:text-white border border-transparent'\n   219→          }`}\n   220→        >\n   221→          Static Preview\n   222→        </button>\n   223→      </div>\n   224→\n   225→      {/* Preview Component */}\n   226→      <AnimatePresence mode=\"wait\">\n   227→        {previewMode === 'morphing' && frontLandmarks.length > 0 ? (\n   228→          <motion.div\n   229→            key=\"morphing\"\n   230→            initial={{ opacity: 0, x: -20 }}\n   231→            animate={{ opacity: 1, x: 0 }}\n   232→            exit={{ opacity: 0, x: 20 }}\n   233→            transition={{ duration: 0.2 }}\n   234→          >\n   235→            <FaceMorphing\n   236→              photo={frontPhoto}\n   237→              frontLandmarks={frontLandmarks}\n   238→              currentScore={numericScore}\n   239→              potentialScore={potentialScore}\n   240→              recommendations={recommendations}\n   241→            />\n   242→          </motion.div>\n   243→        ) : (\n   244→          <motion.div\n   245→            key=\"static\"\n   246→            initial={{ opacity: 0, x: 20 }}\n   247→            animate={{ opacity: 1, x: 0 }}\n   248→            exit={{ opacity: 0, x: -20 }}\n   249→            transition={{ duration: 0.2 }}\n   250→          >\n   251→            <BeforeAfterPreview\n   252→              photo={frontPhoto}\n   253→              currentScore={numericScore}\n   254→              potentialScore={potentialScore}\n   255→              recommendations={recommendations}\n   256→            />\n   257→          </motion.div>\n   258→        )}\n   259→      </AnimatePresence>\n   260→    </div>\n   261→  );\n   262→}\n   263→\n   264→// ============================================\n   265→// ORDER OF OPERATIONS\n   266→// ============================================\n   267→\n   268→function OrderOfOperations() {\n   269→  return (\n   270→    <div className=\"rounded-2xl bg-neutral-900/40 border border-white/5 p-5\">\n   271→      <h4 className=\"text-xs font-black uppercase tracking-wider text-white mb-4 flex items-center gap-3\">\n   272→        <div className=\"w-8 h-8 rounded-lg bg-neutral-900 border border-white/10 flex items-center justify-center\">\n   273→          <Target size={14} className=\"text-cyan-400\" />\n   274→        </div>\n   275→        Recommended Order\n   276→      </h4>\n   277→      <div className=\"space-y-4\">\n   278→        <div className=\"flex items-start gap-4\">\n   279→          <div className=\"w-7 h-7 rounded-lg bg-green-500/20 border border-green-500/30 flex items-center justify-center flex-shrink-0 mt-0.5\">\n   280→            <span className=\"text-xs font-black text-green-400\">1</span>\n   281→          </div>\n   282→          <div>\n   283→            <p className=\"text-sm font-black uppercase tracking-wider text-white\">Start with Foundational</p>\n   284→            <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mt-1\">Low-cost, no-risk improvements</p>\n   285→          </div>\n   286→        </div>\n   287→        <div className=\"flex items-start gap-4\">\n   288→          <div className=\"w-7 h-7 rounded-lg bg-yellow-500/20 border border-yellow-500/30 flex items-center justify-center flex-shrink-0 mt-0.5\">\n   289→            <span className=\"text-xs font-black text-yellow-400\">2</span>\n   290→          </div>\n   291→          <div>\n   292→            <p className=\"text-sm font-black uppercase tracking-wider text-white\">Consider Minimally Invasive</p>\n   293→            <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mt-1\">Temporary or reversible options</p>\n   294→          </div>\n   295→        </div>\n   296→        <div className=\"flex items-start gap-4\">\n   297→          <div className=\"w-7 h-7 rounded-lg bg-red-500/20 border border-red-500/30 flex items-center justify-center flex-shrink-0 mt-0.5\">\n   298→            <span className=\"text-xs font-black text-red-400\">3</span>\n   299→          </div>\n   300→          <div>\n   301→            <p className=\"text-sm font-black uppercase tracking-wider text-white\">Evaluate Surgical Options</p>\n   302→            <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mt-1\">Permanent solutions for significant improvements</p>\n   303→          </div>\n   304→        </div>\n   305→      </div>\n   306→    </div>\n   307→  );\n   308→}\n   309→\n   310→// ============================================\n   311→// YOUR PHASE CARD (Body Composition Phase)\n   312→// ============================================\n   313→\n   314→type BodyPhase = 'bulk' | 'cut' | 'maintain';\n   315→\n   316→interface YourPhaseCardProps {\n   317→  bodyFatPercent?: number;\n   318→  gender: 'male' | 'female';\n   319→}\n   320→\n   321→function YourPhaseCard({ bodyFatPercent, gender }: YourPhaseCardProps) {\n   322→  // Determine phase based on body fat and gender\n   323→  const getPhase = (): { phase: BodyPhase; message: string; color: string; icon: React.ReactNode } => {\n   324→    if (!bodyFatPercent) {\n   325→      return {\n   326→        phase: 'maintain',\n   327→        message: 'Complete your physique analysis to get personalized phase recommendations.',\n   328→        color: 'from-neutral-800 to-neutral-900',\n   329→        icon: <Scale size={24} className=\"text-neutral-400\" />,\n   330→      };\n   331→    }\n   332→\n   333→    // Male thresholds: <12% = bulk, 12-18% = maintain, >18% = cut\n   334→    // Female thresholds: <18% = bulk, 18-25% = maintain, >25% = cut\n   335→    const bulkThreshold = gender === 'male' ? 12 : 18;\n   336→    const cutThreshold = gender === 'male' ? 18 : 25;\n   337→\n   338→    if (bodyFatPercent < bulkThreshold) {\n   339→      return {\n   340→        phase: 'bulk',\n   341→        message: `At ${bodyFatPercent.toFixed(1)}% body fat, you're lean enough to build muscle. Focus on a slight caloric surplus with progressive overload.`,\n   342→        color: 'from-green-600 to-emerald-700',\n   343→        icon: <Dumbbell size={24} className=\"text-white\" />,\n   344→      };\n   345→    } else if (bodyFatPercent > cutThreshold) {\n   346→      return {\n   347→        phase: 'cut',\n   348→        message: `At ${bodyFatPercent.toFixed(1)}% body fat, prioritize fat loss. A moderate caloric deficit with high protein will reveal your facial structure.`,\n   349→        color: 'from-orange-600 to-red-700',\n   350→        icon: <Salad size={24} className=\"text-white\" />,\n   351→      };\n   352→    } else {\n   353→      return {\n   354→        phase: 'maintain',\n   355→        message: `At ${bodyFatPercent.toFixed(1)}% body fat, you're in the optimal range. Focus on body recomposition to build muscle while staying lean.`,\n   356→        color: 'from-blue-600 to-cyan-700',\n   357→        icon: <Scale size={24} className=\"text-white\" />,\n   358→      };\n   359→    }\n   360→  };\n   361→\n   362→  const { phase, message, color, icon } = getPhase();\n   363→  const phaseLabels: Record<BodyPhase, string> = {\n   364→    bulk: 'Lean Bulk Phase',\n   365→    cut: 'Cutting Phase',\n   366→    maintain: 'Maintenance Phase',\n   367→  };\n   368→\n   369→  return (\n   370→    <motion.div\n   371→      className={`bg-gradient-to-br ${color} rounded-[2rem] p-6 md:p-8 border border-white/10`}\n   372→      initial={{ opacity: 0, y: 20 }}\n   373→      animate={{ opacity: 1, y: 0 }}\n   374→    >\n   375→      <div className=\"flex items-start gap-5\">\n   376→        <div className=\"w-14 h-14 rounded-2xl bg-white/20 border border-white/20 flex items-center justify-center flex-shrink-0 shadow-xl\">\n   377→          {icon}\n   378→        </div>\n   379→        <div className=\"flex-1\">\n   380→          <div className=\"flex items-center gap-3 mb-2\">\n   381→            <h3 className=\"text-lg font-black uppercase tracking-wider text-white\">Your Phase</h3>\n   382→            <div className=\"px-3 py-1 bg-white/20 border border-white/20 rounded-lg text-[10px] font-black uppercase tracking-wider text-white\">\n   383→              {phaseLabels[phase]}\n   384→            </div>\n   385→          </div>\n   386→          <p className=\"text-sm text-white/80 leading-relaxed mb-5\">{message}</p>\n   387→\n   388→          {/* Phase-specific tips */}\n   389→          <div className=\"grid grid-cols-3 gap-3\">\n   390→            <div className=\"bg-black/20 rounded-xl p-3 text-center border border-white/10\">\n   391→              <div className=\"flex items-center justify-center gap-1.5 mb-1\">\n   392→                {phase === 'bulk' ? (\n   393→                  <ArrowUp size={12} className=\"text-green-300\" />\n   394→                ) : phase === 'cut' ? (\n   395→                  <ArrowDown size={12} className=\"text-orange-300\" />\n   396→                ) : (\n   397→                  <Minus size={12} className=\"text-blue-300\" />\n   398→                )}\n   399→                <span className=\"text-[10px] font-bold uppercase tracking-wider text-white/60\">Calories</span>\n   400→              </div>\n   401→              <span className=\"text-sm font-black uppercase text-white\">\n   402→                {phase === 'bulk' ? '+300' : phase === 'cut' ? '-500' : '+/-0'}\n   403→              </span>\n   404→            </div>\n   405→            <div className=\"bg-black/20 rounded-xl p-3 text-center border border-white/10\">\n   406→              <span className=\"text-[10px] font-bold uppercase tracking-wider text-white/60 block mb-1\">Protein</span>\n   407→              <span className=\"text-sm font-black uppercase text-white\">\n   408→                {phase === 'cut' ? '1.2g/lb' : '1g/lb'}\n   409→              </span>\n   410→            </div>\n   411→            <div className=\"bg-black/20 rounded-xl p-3 text-center border border-white/10\">\n   412→              <span className=\"text-[10px] font-bold uppercase tracking-wider text-white/60 block mb-1\">Cardio</span>\n   413→              <span className=\"text-sm font-black uppercase text-white\">\n   414→                {phase === 'bulk' ? 'Minimal' : phase === 'cut' ? '4-5x/wk' : '2-3x/wk'}\n   415→              </span>\n   416→            </div>\n   417→          </div>\n   418→        </div>\n   419→      </div>\n   420→    </motion.div>\n   421→  );\n   422→}\n   423→\n   424→// ============================================\n   425→// PRODUCT BUNDLE CTA\n   426→// ============================================\n   427→\n   428→interface ProductBundleCardProps {\n   429→  products: ProductRecommendation[];\n   430→  title?: string;\n   431→}\n   432→\n   433→function ProductBundleCard({ products, title = 'Recommended Bundle' }: ProductBundleCardProps) {\n   434→  // Get top 3 most important products\n   435→  const bundleProducts = products.slice(0, 3);\n   436→\n   437→  // Calculate total cost\n   438→  const totalCost = bundleProducts.reduce((sum, rec) => {\n   439→    const supplement = SUPPLEMENTS.find(s => s.id === rec.product.supplementId);\n   440→    return sum + (supplement?.costPerMonth.min || 0);\n   441→  }, 0);\n   442→\n   443→  if (bundleProducts.length === 0) return null;\n   444→\n   445→  return (\n   446→    <motion.div\n   447→      className=\"rounded-[2rem] bg-gradient-to-br from-purple-900/50 to-violet-950/50 border border-purple-500/30 p-6\"\n   448→      initial={{ opacity: 0, y: 20 }}\n   449→      animate={{ opacity: 1, y: 0 }}\n   450→    >\n   451→      <div className=\"flex items-center gap-3 mb-5\">\n   452→        <div className=\"w-10 h-10 rounded-xl bg-purple-500/20 border border-purple-500/30 flex items-center justify-center\">\n   453→          <Package size={18} className=\"text-purple-400\" />\n   454→        </div>\n   455→        <div className=\"flex-1\">\n   456→          <h3 className=\"text-sm font-black uppercase tracking-wider text-white\">{title}</h3>\n   457→        </div>\n   458→        <div className=\"px-3 py-1.5 bg-purple-500/20 border border-purple-500/30 text-purple-300 text-[10px] font-black uppercase tracking-wider rounded-lg\">\n   459→          Save 15%\n   460→        </div>\n   461→      </div>\n   462→\n   463→      <p className=\"text-sm text-neutral-300 mb-5 leading-relaxed\">\n   464→        Your analysis recommends these {bundleProducts.length} supplements - optimized for your specific weak points.\n   465→      </p>\n   466→\n   467→      {/* Bundle Items */}\n   468→      <div className=\"space-y-2 mb-5\">\n   469→        {bundleProducts.map((rec, index) => (\n   470→          <div\n   471→            key={rec.product.id}\n   472→            className=\"flex items-center gap-4 p-3 bg-black/30 rounded-xl border border-white/5\"\n   473→          >\n   474→            <div className=\"w-7 h-7 rounded-lg bg-purple-500/30 border border-purple-500/30 flex items-center justify-center flex-shrink-0\">\n   475→              <span className=\"text-xs font-black text-purple-300\">{index + 1}</span>\n   476→            </div>\n   477→            <div className=\"flex-1 min-w-0\">\n   478→              <p className=\"text-sm font-black uppercase tracking-wider text-white truncate\">{rec.product.name}</p>\n   479→              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-500 truncate\">Targets: {rec.targetMetric}</p>\n   480→            </div>\n   481→            <div className=\"text-right flex-shrink-0\">\n   482→              <p className=\"text-sm font-black text-white\">\n   483→                ${SUPPLEMENTS.find(s => s.id === rec.product.supplementId)?.costPerMonth.min || 0}/mo\n   484→              </p>\n   485→            </div>\n   486→          </div>\n   487→        ))}\n   488→      </div>\n   489→\n   490→      {/* Total & CTA */}\n   491→      <div className=\"border-t border-purple-500/20 pt-5\">\n   492→        <div className=\"flex items-center justify-between mb-4\">\n   493→          <span className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-400\">Bundle Total</span>\n   494→          <div className=\"text-right\">\n   495→            <span className=\"text-xl font-black text-white\">${totalCost}/mo</span>\n   496→            <span className=\"text-xs font-bold text-neutral-500 ml-2 line-through\">${Math.round(totalCost * 1.15)}/mo</span>\n   497→          </div>\n   498→        </div>\n   499→        <button\n   500→          className=\"w-full flex items-center justify-center gap-3 py-3.5 bg-gradient-to-r from-purple-500 to-violet-600 text-white text-xs font-black uppercase tracking-wider rounded-xl hover:opacity-90 transition-opacity border border-purple-400/30\"\n   501→        >\n   502→          <ShoppingCart size={16} />\n   503→          Get Your Bundle\n   504→        </button>\n   505→      </div>\n   506→    </motion.div>\n   507→  );\n   508→}\n   509→\n   510→// ============================================\n   511→// PLAN TAB\n   512→// ============================================\n   513→\n   514→export function PlanTab() {\n   515→  const { recommendations, flaws, gender, ethnicity, frontRatios, sideRatios, overallScore, frontPhoto, vision, isUnlocked } = useResults();\n   516→  const { user } = useAuth();\n   517→  const physiqueContext = usePhysiqueOptional();\n   518→  const [selectedPhase, setSelectedPhase] = useState<RecommendationPhase | null>(null);\n   519→  const [expandedId, setExpandedId] = useState<string | null>(null);\n   520→  const [completedIds, setCompletedIds] = useState<Set<string>>(new Set());\n   521→  const [removedIds, setRemovedIds] = useState<Set<string>>(new Set());\n   522→  const [previousAnalysis, setPreviousAnalysis] = useState<{\n   523→    date: string;\n   524→    overallScore: number;\n   525→    bodyFatPercent?: number;\n   526→    frontPhotoUrl?: string;\n   527→  } | null>(null);\n   528→\n   529→  // Treatment conflict state\n   530→  const [dismissedConflicts, setDismissedConflicts] = useState<Set<string>>(new Set());\n   531→  const [conflictModal, setConflictModal] = useState<{\n   532→    isOpen: boolean;\n   533→    conflict: TreatmentConflict | null;\n   534→    newTreatmentId: string;\n   535→  }>({ isOpen: false, conflict: null, newTreatmentId: '' });\n   536→\n   537→  const { openPricingModal } = usePricing();\n   538→\n   539→  // Convert to number for arithmetic operations\n   540→  const numericOverallScore = typeof overallScore === 'number' ? overallScore : 0;\n   541→\n   542→  // Check if user has a paid plan\n   543→  const hasPaidPlan = user?.plan === 'basic' || user?.plan === 'pro';\n   544→\n   545→  // Get body fat from physique analysis\n   546→  const bodyFatPercent = physiqueContext?.physiqueAnalysis?.bodyFatPercent;\n   547→\n   548→  // Generate Daily Stack for all users\n   549→  const dailyStack = useMemo(() => {\n   550→    return generateDailyStack(gender);\n   551→  }, [gender]);\n   552→\n   553→  // Generate Product Recommendations based on metrics\n   554→  const productRecommendations = useMemo(() => {\n   555→    // Build metrics and severity dictionaries from ratios\n   556→    const metricsDict: Record<string, number> = {};\n   557→    const severityDict: Record<string, string> = {};\n   558→\n   559→    [...frontRatios, ...sideRatios].forEach(ratio => {\n   560→      metricsDict[ratio.name] = typeof ratio.value === 'number' ? ratio.value : 0;\n   561→      severityDict[ratio.name] = ratio.severity;\n   562→    });\n   563→\n   564→    return getProductRecommendations(metricsDict, severityDict, gender, ethnicity);\n   565→  }, [frontRatios, sideRatios, gender, ethnicity]);\n   566→\n   567→  // Split product recommendations by state\n   568→  const { flawProducts, idealProducts } = useMemo(() => {\n   569→    const flaw = productRecommendations.filter(r => r.state === 'flaw');\n   570→    const ideal = productRecommendations.filter(r => r.state === 'ideal');\n   571→    return { flawProducts: flaw, idealProducts: ideal };\n   572→  }, [productRecommendations]);\n   573→\n   574→  // Map flaws to products and treatments\n   575→  const flawsWithProducts = useMemo(() => {\n   576→    return flaws.slice(0, 5).map(flaw => {\n   577→      // Find products that target metrics related to this flaw\n   578→      const relatedProducts = productRecommendations.filter(rec =>\n   579→        flaw && flaw.responsibleRatios && flaw.responsibleRatios.some(ratio =>\n   580→          rec.matchedMetrics.some(metric =>\n   581→            metric.toLowerCase().includes(ratio.ratioName.toLowerCase()) ||\n   582→            ratio.ratioName.toLowerCase().includes(metric.toLowerCase())\n   583→          )\n   584→        )\n   585→      );\n   586→\n   587→      // Find treatments that match this flaw\n   588→      const relatedTreatments = recommendations.filter(rec =>\n   589→        rec.matchedFlaws.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase()))\n   590→      );\n   591→\n   592→      return {\n   593→        flaw,\n   594→        products: relatedProducts.slice(0, 2),\n   595→        treatments: relatedTreatments.slice(0, 3),\n   596→      };\n   597→    });\n   598→  }, [flaws, productRecommendations, recommendations]);\n   599→\n   600→  // Handle progress photo upload\n   601→  const handleProgressPhotoUpload = useCallback(async (file: File) => {\n   602→    // Store current analysis as previous before re-analyzing\n   603→    const numScore = typeof overallScore === 'number' ? overallScore : 0;\n   604→    setPreviousAnalysis({\n   605→      date: new Date().toISOString(),\n   606→      overallScore: numScore,\n   607→      bodyFatPercent,\n   608→      frontPhotoUrl: frontPhoto || undefined,\n   609→    });\n   610→\n   611→    // In a real implementation, this would upload to API and trigger re-analysis\n   612→    console.log('Progress photo uploaded:', file.name);\n   613→  }, [overallScore, bodyFatPercent, frontPhoto]);\n   614→\n   615→  // Count recommendations by phase\n   616→  const phaseCounts = useMemo(() => {\n   617→    const counts: Record<RecommendationPhase, number> = {\n   618→      'Foundational': 0,\n   619→      'Minimally Invasive': 0,\n   620→      'Surgical': 0,\n   621→    };\n   622→    recommendations.forEach(r => {\n   623→      if (!removedIds.has(r.ref_id)) {\n   624→        counts[r.phase]++;\n   625→      }\n   626→    });\n   627→    return counts;\n   628→  }, [recommendations, removedIds]);\n   629→\n   630→  // Filter recommendations\n   631→  const filteredRecommendations = useMemo(() => {\n   632→    let filtered = recommendations.filter(r => !removedIds.has(r.ref_id));\n   633→    if (selectedPhase) {\n   634→      filtered = filtered.filter(r => r.phase === selectedPhase);\n   635→    }\n   636→    return filtered;\n   637→  }, [recommendations, selectedPhase, removedIds]);\n   638→\n   639→  const hasRecommendations = filteredRecommendations.length > 0;\n   640→\n   641→  // Detect treatment conflicts in current recommendations\n   642→  const treatmentConflicts = useMemo(() => {\n   643→    const selectedIds = filteredRecommendations.map(r => r.ref_id);\n   644→    const nameMap = Object.fromEntries(\n   645→      filteredRecommendations.map(r => [r.ref_id, r.name])\n   646→    );\n   647→    const conflicts = findTreatmentConflicts(selectedIds, nameMap);\n   648→\n   649→    // Filter out dismissed conflicts\n   650→    return conflicts.filter(c => {\n   651→      const conflictKey = `${c.treatment1Id}-${c.treatment2Id}`;\n   652→      return !dismissedConflicts.has(conflictKey);\n   653→    });\n   654→  }, [filteredRecommendations, dismissedConflicts]);\n   655→\n   656→  // Handle dismissing a conflict\n   657→  const handleDismissConflict = useCallback((conflict: TreatmentConflict) => {\n   658→    const conflictKey = `${conflict.treatment1Id}-${conflict.treatment2Id}`;\n   659→    setDismissedConflicts(prev => new Set(Array.from(prev).concat(conflictKey)));\n   660→  }, []);\n   661→\n   662→  // Handle dismissing all conflicts\n   663→  const handleDismissAllConflicts = useCallback(() => {\n   664→    const allKeys = treatmentConflicts.map(\n   665→      c => `${c.treatment1Id}-${c.treatment2Id}`\n   666→    );\n   667→    setDismissedConflicts(prev => new Set(Array.from(prev).concat(allKeys)));\n   668→  }, [treatmentConflicts]);\n   669→\n   670→  // Handle conflict modal actions\n   671→  const handleConflictProceed = useCallback(() => {\n   672→    if (conflictModal.conflict) {\n   673→      // Remove the lower priority (existing) treatment\n   674→      setRemovedIds(prev => new Set(Array.from(prev).concat(conflictModal.conflict!.treatment1Id)));\n   675→    }\n   676→    setConflictModal({ isOpen: false, conflict: null, newTreatmentId: '' });\n   677→  }, [conflictModal.conflict]);\n   678→\n   679→  const handleConflictCancel = useCallback(() => {\n   680→    setConflictModal({ isOpen: false, conflict: null, newTreatmentId: '' });\n   681→  }, []);\n   682→\n   683→  // Handle mark complete\n   684→  const handleMarkComplete = useCallback((id: string) => {\n   685→    setCompletedIds(prev => {\n   686→      const newSet = new Set(prev);\n   687→      if (newSet.has(id)) {\n   688→        newSet.delete(id);\n   689→      } else {\n   690→        newSet.add(id);\n   691→      }\n   692→      return newSet;\n   693→    });\n   694→  }, []);\n   695→\n   696→  // Handle remove\n   697→  const handleRemove = useCallback((id: string) => {\n   698→    setRemovedIds(prev => {\n   699→      const newSet = new Set(prev);\n   700→      newSet.add(id);\n   701→      return newSet;\n   702→    });\n   703→    if (expandedId === id) {\n   704→      setExpandedId(null);\n   705→    }\n   706→  }, [expandedId]);\n   707→\n   708→  return (\n   709→    <TabContent\n   710→      title=\"Your Plan & Potential\"\n   711→      subtitle=\"Personalized recommendations based on your analysis\"\n   712→    >\n   713→      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n   714→        {/* Main Content */}\n   715→        <div className=\"lg:col-span-2 space-y-10\">\n   716→          {/* Your Phase Card - Body Composition Phase */}\n   717→          <YourPhaseCard bodyFatPercent={bodyFatPercent} gender={gender} />\n   718→\n   719→          {/* Daily Stack Card - Hero Element for ALL users */}\n   720→          {dailyStack && <DailyStackCard dailyStack={dailyStack} />}\n   721→\n   722→          {/* Potential Score */}\n   723→          <PotentialScoreCard />\n   724→\n   725→          {/* Fix Your Weak Points Section */}\n   726→          {flawsWithProducts.length > 0 && (\n   727→            <section>\n   728→              <SectionHeader title=\"Fix Your Weak Points\">\n   729→                <span className=\"px-3 py-1.5 bg-red-500/20 border border-red-500/30 text-red-400 text-[10px] font-black uppercase tracking-wider rounded-lg\">\n   730→                  {flawsWithProducts.length} Issues\n   731→                </span>\n   732→              </SectionHeader>\n   733→              <div className=\"space-y-4\">\n   734→                {flawsWithProducts.map((item, index) => (\n   735→                  <WeakPointCard\n   736→                    key={item.flaw.id}\n   737→                    flaw={item.flaw}\n   738→                    rank={index + 1}\n   739→                    products={item.products}\n   740→                    treatments={item.treatments}\n   741→                    onViewTreatment={(treatment) => setExpandedId(treatment.ref_id)}\n   742→                  />\n   743→                ))}\n   744→              </div>\n   745→            </section>\n   746→          )}\n   747→\n   748→          {/* Targeted Product Recommendations - Corrective */}\n   749→          {flawProducts.length > 0 && (\n   750→            <section>\n   751→              <SectionHeader title=\"Recommended Products\">\n   752→                <span className=\"px-3 py-1.5 bg-cyan-500/20 border border-cyan-500/30 text-cyan-400 text-[10px] font-black uppercase tracking-wider rounded-lg\">\n   753→                  Corrective\n   754→                </span>\n   755→              </SectionHeader>\n   756→              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n   757→                {flawProducts.slice(0, 6).map((rec, index) => (\n   758→                  <ProductCard key={rec.product.id} recommendation={rec} rank={index + 1} />\n   759→                ))}\n   760→              </div>\n   761→            </section>\n   762→          )}\n   763→\n   764→          {/* Targeted Product Recommendations - Maintenance */}\n   765→          {idealProducts.length > 0 && (\n   766→            <section>\n   767→              <SectionHeader title=\"Protect Your Strengths\">\n   768→                <span className=\"px-3 py-1.5 bg-green-500/20 border border-green-500/30 text-green-400 text-[10px] font-black uppercase tracking-wider rounded-lg\">\n   769→                  Maintenance\n   770→                </span>\n   771→              </SectionHeader>\n   772→              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n   773→                {idealProducts.slice(0, 4).map((rec) => (\n   774→                  <ProductCard key={rec.product.id} recommendation={rec} />\n   775→                ))}\n   776→              </div>\n   777→            </section>\n   778→          )}\n   779→\n   780→          {/* Treatment Timeline */}\n   781→          {recommendations.length > 0 && (\n   782→            <section>\n   783→              <SectionHeader title=\"Treatment Timeline\" />\n   784→              <TreatmentTimeline recommendations={recommendations.filter(r => !removedIds.has(r.ref_id))} />\n   785→            </section>\n   786→          )}\n   787→\n   788→          {/* Treatment Conflict Warnings */}\n   789→          {treatmentConflicts.length > 0 && (\n   790→            <TreatmentConflictList\n   791→              conflicts={treatmentConflicts}\n   792→              onDismiss={handleDismissConflict}\n   793→              onDismissAll={handleDismissAllConflicts}\n   794→            />\n   795→          )}\n   796→\n   797→          {/* Phase Filter Section */}\n   798→          <section>\n   799→            <SectionHeader title=\"Treatment Options\" />\n   800→            <PhaseFilter\n   801→              selectedPhase={selectedPhase}\n   802→              onSelect={setSelectedPhase}\n   803→              counts={phaseCounts}\n   804→            />\n   805→          </section>\n   806→\n   807→          {/* Recommendations List */}\n   808→          {hasRecommendations ? (\n   809→            <motion.div className=\"space-y-4\" layout>\n   810→              <AnimatePresence mode=\"popLayout\">\n   811→                {filteredRecommendations.map((rec, index) => (\n   812→                  <motion.div\n   813→                    key={rec.ref_id}\n   814→                    layout\n   815→                    initial={{ opacity: 0, y: 20 }}\n   816→                    animate={{ opacity: 1, y: 0 }}\n   817→                    exit={{ opacity: 0, y: -20 }}\n   818→                    transition={{ duration: 0.2, delay: index * 0.05 }}\n   819→                  >\n   820→                    <EnhancedRecommendationCard\n   821→                      recommendation={rec}\n   822→                      rank={index + 1}\n   823→                      isExpanded={expandedId === rec.ref_id}\n   824→                      onToggle={() => setExpandedId(\n   825→                        expandedId === rec.ref_id ? null : rec.ref_id\n   826→                      )}\n   827→                      onMarkComplete={handleMarkComplete}\n   828→                      onRemove={handleRemove}\n   829→                      isCompleted={completedIds.has(rec.ref_id)}\n   830→                      gender={gender}\n   831→                      ethnicity={ethnicity}\n   832→                    />\n   833→                  </motion.div>\n   834→                ))}\n   835→              </AnimatePresence>\n   836→            </motion.div>\n   837→          ) : (\n   838→            <div className=\"rounded-[2rem] bg-neutral-900/40 border border-white/5 p-10 text-center\">\n   839→              <div className=\"w-16 h-16 rounded-2xl bg-neutral-900 border border-white/10 flex items-center justify-center mx-auto mb-5\">\n   840→                <Sparkles size={28} className=\"text-neutral-600\" />\n   841→              </div>\n   842→              <h3 className=\"text-lg font-black uppercase tracking-wider text-white mb-2\">No Recommendations Yet</h3>\n   843→              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600\">\n   844→                Complete a facial analysis to get personalized recommendations\n   845→              </p>\n   846→            </div>\n   847→          )}\n   848→        </div>\n   849→\n   850→        {/* Sidebar */}\n   851→        <div className=\"space-y-6\">\n   852→          {/* Medical Prescription Card (Dental) */}\n   853→          {vision?.teeth && (\n   854→            <MedicalPrescriptionCard vision={vision} isUnlocked={isUnlocked} />\n   855→          )}\n   856→\n   857→          {/* Progress Comparison Card */}\n   858→          <ProgressComparisonCard\n   859→            currentAnalysis={{\n   860→              date: new Date().toISOString(),\n   861→              overallScore: numericOverallScore,\n   862→              bodyFatPercent,\n   863→              frontPhotoUrl: frontPhoto || undefined,\n   864→            }}\n   865→            previousAnalysis={previousAnalysis}\n   866→            onUploadNewPhoto={handleProgressPhotoUpload}\n   867→          />\n   868→\n   869→          {/* Product Bundle CTA */}\n   870→          {flawProducts.length >= 3 && (\n   871→            <ProductBundleCard\n   872→              products={flawProducts}\n   873→              title=\"Your Fix Bundle\"\n   874→            />\n   875→          )}\n   876→\n   877→          {/* Before/After Preview */}\n   878→          <BeforeAfterPreviewSection />\n   879→\n   880→          {/* Order of Operations */}\n   881→          <OrderOfOperations />\n   882→\n   883→          {/* My Plan Summary */}\n   884→          <div className=\"rounded-2xl bg-neutral-900/40 border border-white/5 p-5\">\n   885→            <h4 className=\"text-xs font-black uppercase tracking-wider text-white mb-4 flex items-center gap-3\">\n   886→              <div className=\"w-8 h-8 rounded-lg bg-neutral-900 border border-white/10 flex items-center justify-center\">\n   887→                <Zap size={14} className=\"text-yellow-400\" />\n   888→              </div>\n   889→              My Plan\n   890→            </h4>\n   891→            <div className=\"text-center py-8\">\n   892→              <div className=\"w-14 h-14 mx-auto mb-4 rounded-2xl bg-neutral-900 border border-white/10 flex items-center justify-center\">\n   893→                <Lock size={20} className=\"text-neutral-600\" />\n   894→              </div>\n   895→              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mb-2\">\n   896→                Add recommendations to build your personalized plan\n   897→              </p>\n   898→              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-700\">\n   899→                0 items selected\n   900→              </p>\n   901→            </div>\n   902→          </div>\n   903→\n   904→          {/* Issues Summary */}\n   905→          <div className=\"rounded-2xl bg-neutral-900/40 border border-white/5 p-5\">\n   906→            <h4 className=\"text-xs font-black uppercase tracking-wider text-white mb-4\">Detected Issues</h4>\n   907→            <div className=\"space-y-2\">\n   908→              {flaws.slice(0, 5).map(flaw => (\n   909→                <div\n   910→                  key={flaw.id}\n   911→                  className=\"flex items-center justify-between p-3 bg-neutral-900/50 border border-white/5 rounded-xl hover:border-white/10 transition-colors\"\n   912→                >\n   913→                  <span className=\"text-sm font-bold text-neutral-300 truncate\">{flaw.flawName}</span>\n   914→                  <span className=\"text-[10px] font-black uppercase tracking-wider text-red-400 flex-shrink-0 px-2 py-1 bg-red-500/20 border border-red-500/30 rounded-lg\">\n   915→                    -{flaw.harmonyPercentageLost.toFixed(1)}%\n   916→                  </span>\n   917→                </div>\n   918→              ))}\n   919→              {flaws.length === 0 && (\n   920→                <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 text-center py-6\">\n   921→                  No issues detected\n   922→                </p>\n   923→              )}\n   924→            </div>\n   925→          </div>\n   926→\n   927→          {/* Upgrade CTA or Premium Badge */}\n   928→          {hasPaidPlan ? (\n   929→            <motion.div\n   930→              className=\"rounded-2xl bg-gradient-to-br from-green-500/10 to-emerald-600/10 border border-green-500/30 p-5\"\n   931→              initial={{ opacity: 0, y: 20 }}\n   932→              animate={{ opacity: 1, y: 0 }}\n   933→              transition={{ delay: 0.3 }}\n   934→            >\n   935→              <div className=\"flex items-center gap-3 mb-3\">\n   936→                <div className=\"w-8 h-8 rounded-lg bg-green-500/20 border border-green-500/30 flex items-center justify-center\">\n   937→                  <CheckCircle size={14} className=\"text-green-400\" />\n   938→                </div>\n   939→                <span className=\"text-xs font-black uppercase tracking-wider text-white\">\n   940→                  {user?.plan === 'pro' ? 'Pro Plan' : 'Basic Plan'} Active\n   941→                </span>\n   942→              </div>\n   943→              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-500\">\n   944→                You have full access to all {user?.plan === 'pro' ? 'features' : 'non-surgical recommendations'}.\n   945→              </p>\n   946→            </motion.div>\n   947→          ) : (\n   948→            <motion.div\n   949→              className=\"rounded-2xl bg-gradient-to-br from-cyan-500/10 to-blue-600/10 border border-cyan-500/30 p-5\"\n   950→              initial={{ opacity: 0, y: 20 }}\n   951→              animate={{ opacity: 1, y: 0 }}\n   952→              transition={{ delay: 0.3 }}\n   953→            >\n   954→              <div className=\"flex items-center gap-3 mb-3\">\n   955→                <div className=\"w-8 h-8 rounded-lg bg-cyan-500/20 border border-cyan-500/30 flex items-center justify-center\">\n   956→                  <Sparkles size={14} className=\"text-cyan-400\" />\n   957→                </div>\n   958→                <span className=\"text-xs font-black uppercase tracking-wider text-white\">Unlock Full Plan</span>\n   959→              </div>\n   960→              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-500 mb-4\">\n   961→                Get detailed treatment guides, cost estimates, and provider recommendations.\n   962→              </p>\n   963→              <button\n   964→                onClick={() => openPricingModal('plan_sidebar')}\n   965→                className=\"block w-full py-3 bg-cyan-500 text-black text-xs font-black uppercase tracking-wider rounded-xl text-center hover:bg-cyan-400 transition-colors\"\n   966→              >\n   967→                Upgrade Now\n   968→              </button>\n   969→            </motion.div>\n   970→          )}\n   971→        </div>\n   972→      </div>\n   973→\n   974→      {/* Treatment Conflict Modal */}\n   975→      <SelectionWarningModal\n   976→        isOpen={conflictModal.isOpen}\n   977→        onClose={handleConflictCancel}\n   978→        conflict={conflictModal.conflict || {\n   979→          treatment1Id: '',\n   980→          treatment1Name: '',\n   981→          treatment2Id: '',\n   982→          treatment2Name: '',\n   983→          reason: '',\n   984→        }}\n   985→        onProceed={handleConflictProceed}\n   986→        onCancel={handleConflictCancel}\n   987→      />\n   988→    </TabContent>\n   989→  );\n   990→}\n   991→"}]},"uuid":"57d5e0b8-9118-4ae9-92f0-84e941f685dc","timestamp":"2025-12-26T20:40:29.813Z","toolUseResult":{"type":"update","filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/PlanTab.tsx","content":"'use client';\n\nimport { useState, useMemo, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Sparkles,\n  TrendingUp,\n  Target,\n  Zap,\n  ChevronRight,\n  Lock,\n  CheckCircle,\n  AlertCircle,\n  CheckCircle2,\n  Scale,\n  Dumbbell,\n  Salad,\n  ArrowDown,\n  ArrowUp,\n  Minus,\n  Package,\n  ShoppingCart,\n} from 'lucide-react';\nimport { useResults } from '@/contexts/ResultsContext';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { usePricing } from '@/contexts/PricingContext';\nimport { usePhysiqueOptional } from '@/contexts/PhysiqueContext';\nimport { TabContent } from '../ResultsLayout';\nimport { EnhancedRecommendationCard } from '../cards/EnhancedRecommendationCard';\nimport { ScoreCircle, PhaseBadge } from '../shared';\nimport { BeforeAfterPreview } from '../visualization/BeforeAfterPreview';\nimport { FaceMorphing } from '../visualization/FaceMorphing';\nimport { TreatmentTimeline } from '../visualization/TreatmentTimeline';\nimport { RecommendationPhase, ProductRecommendation } from '@/types/results';\nimport { DailyStackCard } from '../cards/DailyStackCard';\nimport { ProductCard } from '../cards/ProductCard';\nimport { WeakPointCard } from '../cards/WeakPointCard';\nimport { ProgressComparisonCard } from '../cards/ProgressComparisonCard';\nimport { MedicalPrescriptionCard } from '../cards/MedicalPrescriptionCard';\nimport { generateDailyStack } from '@/lib/daily-stack';\nimport { getProductRecommendations } from '@/lib/product-recommendations';\nimport { SUPPLEMENTS } from '@/lib/recommendations/supplements';\nimport {\n  TreatmentConflictList,\n  SelectionWarningModal,\n} from '../cards/TreatmentConflictWarning';\nimport {\n  findTreatmentConflicts,\n  type TreatmentConflict,\n} from '@/lib/recommendations/engine';\n\n// ============================================\n// SECTION HEADER COMPONENT\n// ============================================\n\nfunction SectionHeader({ title, children }: { title: string; children?: React.ReactNode }) {\n  return (\n    <div className=\"flex items-center gap-4 mb-6\">\n      <h2 className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 whitespace-nowrap\">\n        {title}\n      </h2>\n      <div className=\"flex-1 h-px bg-neutral-800\" />\n      {children}\n    </div>\n  );\n}\n\n// ============================================\n// POTENTIAL SCORE CARD\n// ============================================\n\nfunction PotentialScoreCard() {\n  const { overallScore, recommendations } = useResults();\n  const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n\n  // Calculate potential improvement\n  const potentialImprovement = useMemo(() => {\n    if (recommendations.length === 0) return 0;\n    const totalImpact = recommendations.slice(0, 5).reduce((sum, r) => sum + (r.impact || 0), 0);\n    return Math.min(totalImpact * 1.5, 10 - numericScore);\n  }, [recommendations, numericScore]);\n\n  const potentialScore = Math.min(10, numericScore + potentialImprovement);\n\n  return (\n    <motion.div\n      className=\"rounded-[2rem] bg-neutral-900/40 border border-white/5 p-6 md:p-8\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-center gap-3 mb-6\">\n        <div className=\"w-10 h-10 rounded-xl bg-neutral-900 border border-white/10 flex items-center justify-center\">\n          <Sparkles size={18} className=\"text-cyan-400\" />\n        </div>\n        <div>\n          <h3 className=\"text-sm font-black uppercase tracking-wider text-white\">Your Potential</h3>\n          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600\">Maximum Achievable Score</p>\n        </div>\n      </div>\n\n      <div className=\"flex items-center justify-center gap-6 md:gap-10 mb-6\">\n        {/* Current */}\n        <div className=\"text-center\">\n          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mb-3\">Current</p>\n          <ScoreCircle score={overallScore} size=\"lg\" animate={false} />\n        </div>\n\n        {/* Arrow */}\n        <div className=\"flex flex-col items-center gap-2\">\n          <ChevronRight size={28} className=\"text-cyan-400\" />\n          <span className=\"px-2 py-1 rounded-lg bg-green-500/20 border border-green-500/30 text-xs font-black uppercase tracking-wider text-green-400\">\n            +{potentialImprovement.toFixed(1)}\n          </span>\n        </div>\n\n        {/* Potential */}\n        <div className=\"text-center\">\n          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mb-3\">Potential</p>\n          <div className=\"relative\">\n            <ScoreCircle score={potentialScore} size=\"lg\" animate={false} />\n            <div className=\"absolute -top-1 -right-1 w-6 h-6 bg-green-500 rounded-lg flex items-center justify-center shadow-lg shadow-green-500/30\">\n              <TrendingUp size={14} className=\"text-black\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <p className=\"text-sm text-neutral-400 text-center leading-relaxed\">\n        Following our recommendations could improve your harmony score by up to{' '}\n        <span className=\"text-green-400 font-black\">+{potentialImprovement.toFixed(1)} points</span>\n      </p>\n    </motion.div>\n  );\n}\n\n// ============================================\n// PHASE FILTER\n// ============================================\n\ninterface PhaseFilterProps {\n  selectedPhase: RecommendationPhase | null;\n  onSelect: (phase: RecommendationPhase | null) => void;\n  counts: Record<RecommendationPhase, number>;\n}\n\nfunction PhaseFilter({ selectedPhase, onSelect, counts }: PhaseFilterProps) {\n  const phases: RecommendationPhase[] = ['Foundational', 'Minimally Invasive', 'Surgical'];\n\n  return (\n    <div className=\"flex flex-wrap gap-2\">\n      <button\n        onClick={() => onSelect(null)}\n        className={`px-4 py-2 rounded-xl text-xs font-black uppercase tracking-wider transition-all border ${selectedPhase === null\n          ? 'bg-cyan-500 text-black border-cyan-400'\n          : 'bg-neutral-900/50 text-neutral-400 border-white/5 hover:border-white/10 hover:text-white'\n          }`}\n      >\n        All ({Object.values(counts).reduce((a, b) => a + b, 0)})\n      </button>\n      {phases.map(phase => (\n        <button\n          key={phase}\n          onClick={() => onSelect(phase)}\n          className={`px-4 py-2 rounded-xl text-xs font-black uppercase tracking-wider transition-all flex items-center gap-2 border ${selectedPhase === phase\n            ? 'bg-neutral-800 text-white border-white/10'\n            : 'bg-neutral-900/50 text-neutral-400 border-white/5 hover:border-white/10 hover:text-white'\n            }`}\n        >\n          <PhaseBadge phase={phase} size=\"sm\" />\n          ({counts[phase] || 0})\n        </button>\n      ))}\n    </div>\n  );\n}\n\n// ============================================\n// BEFORE/AFTER PREVIEW SECTION WITH MORPHING\n// ============================================\n\ntype PreviewMode = 'static' | 'morphing';\n\nfunction BeforeAfterPreviewSection() {\n  const { frontPhoto, overallScore, recommendations, frontLandmarks } = useResults();\n  const [previewMode, setPreviewMode] = useState<PreviewMode>('morphing');\n  const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n\n  // Calculate potential improvement\n  const potentialImprovement = useMemo(() => {\n    if (recommendations.length === 0) return 0;\n    const totalImpact = recommendations.slice(0, 5).reduce((sum, r) => sum + r.impact, 0);\n    return Math.min(totalImpact * 1.5, 10 - numericScore);\n  }, [recommendations, numericScore]);\n\n  const potentialScore = Math.min(10, numericScore + potentialImprovement);\n\n  if (!frontPhoto) return null;\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Mode Toggle */}\n      <div className=\"flex items-center justify-center gap-1 p-1 bg-neutral-900/50 rounded-xl border border-white/5\">\n        <button\n          onClick={() => setPreviewMode('morphing')}\n          className={`flex-1 px-4 py-2 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${\n            previewMode === 'morphing'\n              ? 'bg-cyan-500/20 text-cyan-400 border border-cyan-500/30'\n              : 'text-neutral-500 hover:text-white border border-transparent'\n          }`}\n        >\n          Face Morphing\n        </button>\n        <button\n          onClick={() => setPreviewMode('static')}\n          className={`flex-1 px-4 py-2 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${\n            previewMode === 'static'\n              ? 'bg-neutral-800 text-white border border-white/10'\n              : 'text-neutral-500 hover:text-white border border-transparent'\n          }`}\n        >\n          Static Preview\n        </button>\n      </div>\n\n      {/* Preview Component */}\n      <AnimatePresence mode=\"wait\">\n        {previewMode === 'morphing' && frontLandmarks.length > 0 ? (\n          <motion.div\n            key=\"morphing\"\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: 20 }}\n            transition={{ duration: 0.2 }}\n          >\n            <FaceMorphing\n              photo={frontPhoto}\n              frontLandmarks={frontLandmarks}\n              currentScore={numericScore}\n              potentialScore={potentialScore}\n              recommendations={recommendations}\n            />\n          </motion.div>\n        ) : (\n          <motion.div\n            key=\"static\"\n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: -20 }}\n            transition={{ duration: 0.2 }}\n          >\n            <BeforeAfterPreview\n              photo={frontPhoto}\n              currentScore={numericScore}\n              potentialScore={potentialScore}\n              recommendations={recommendations}\n            />\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// ORDER OF OPERATIONS\n// ============================================\n\nfunction OrderOfOperations() {\n  return (\n    <div className=\"rounded-2xl bg-neutral-900/40 border border-white/5 p-5\">\n      <h4 className=\"text-xs font-black uppercase tracking-wider text-white mb-4 flex items-center gap-3\">\n        <div className=\"w-8 h-8 rounded-lg bg-neutral-900 border border-white/10 flex items-center justify-center\">\n          <Target size={14} className=\"text-cyan-400\" />\n        </div>\n        Recommended Order\n      </h4>\n      <div className=\"space-y-4\">\n        <div className=\"flex items-start gap-4\">\n          <div className=\"w-7 h-7 rounded-lg bg-green-500/20 border border-green-500/30 flex items-center justify-center flex-shrink-0 mt-0.5\">\n            <span className=\"text-xs font-black text-green-400\">1</span>\n          </div>\n          <div>\n            <p className=\"text-sm font-black uppercase tracking-wider text-white\">Start with Foundational</p>\n            <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mt-1\">Low-cost, no-risk improvements</p>\n          </div>\n        </div>\n        <div className=\"flex items-start gap-4\">\n          <div className=\"w-7 h-7 rounded-lg bg-yellow-500/20 border border-yellow-500/30 flex items-center justify-center flex-shrink-0 mt-0.5\">\n            <span className=\"text-xs font-black text-yellow-400\">2</span>\n          </div>\n          <div>\n            <p className=\"text-sm font-black uppercase tracking-wider text-white\">Consider Minimally Invasive</p>\n            <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mt-1\">Temporary or reversible options</p>\n          </div>\n        </div>\n        <div className=\"flex items-start gap-4\">\n          <div className=\"w-7 h-7 rounded-lg bg-red-500/20 border border-red-500/30 flex items-center justify-center flex-shrink-0 mt-0.5\">\n            <span className=\"text-xs font-black text-red-400\">3</span>\n          </div>\n          <div>\n            <p className=\"text-sm font-black uppercase tracking-wider text-white\">Evaluate Surgical Options</p>\n            <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mt-1\">Permanent solutions for significant improvements</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// YOUR PHASE CARD (Body Composition Phase)\n// ============================================\n\ntype BodyPhase = 'bulk' | 'cut' | 'maintain';\n\ninterface YourPhaseCardProps {\n  bodyFatPercent?: number;\n  gender: 'male' | 'female';\n}\n\nfunction YourPhaseCard({ bodyFatPercent, gender }: YourPhaseCardProps) {\n  // Determine phase based on body fat and gender\n  const getPhase = (): { phase: BodyPhase; message: string; color: string; icon: React.ReactNode } => {\n    if (!bodyFatPercent) {\n      return {\n        phase: 'maintain',\n        message: 'Complete your physique analysis to get personalized phase recommendations.',\n        color: 'from-neutral-800 to-neutral-900',\n        icon: <Scale size={24} className=\"text-neutral-400\" />,\n      };\n    }\n\n    // Male thresholds: <12% = bulk, 12-18% = maintain, >18% = cut\n    // Female thresholds: <18% = bulk, 18-25% = maintain, >25% = cut\n    const bulkThreshold = gender === 'male' ? 12 : 18;\n    const cutThreshold = gender === 'male' ? 18 : 25;\n\n    if (bodyFatPercent < bulkThreshold) {\n      return {\n        phase: 'bulk',\n        message: `At ${bodyFatPercent.toFixed(1)}% body fat, you're lean enough to build muscle. Focus on a slight caloric surplus with progressive overload.`,\n        color: 'from-green-600 to-emerald-700',\n        icon: <Dumbbell size={24} className=\"text-white\" />,\n      };\n    } else if (bodyFatPercent > cutThreshold) {\n      return {\n        phase: 'cut',\n        message: `At ${bodyFatPercent.toFixed(1)}% body fat, prioritize fat loss. A moderate caloric deficit with high protein will reveal your facial structure.`,\n        color: 'from-orange-600 to-red-700',\n        icon: <Salad size={24} className=\"text-white\" />,\n      };\n    } else {\n      return {\n        phase: 'maintain',\n        message: `At ${bodyFatPercent.toFixed(1)}% body fat, you're in the optimal range. Focus on body recomposition to build muscle while staying lean.`,\n        color: 'from-blue-600 to-cyan-700',\n        icon: <Scale size={24} className=\"text-white\" />,\n      };\n    }\n  };\n\n  const { phase, message, color, icon } = getPhase();\n  const phaseLabels: Record<BodyPhase, string> = {\n    bulk: 'Lean Bulk Phase',\n    cut: 'Cutting Phase',\n    maintain: 'Maintenance Phase',\n  };\n\n  return (\n    <motion.div\n      className={`bg-gradient-to-br ${color} rounded-[2rem] p-6 md:p-8 border border-white/10`}\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-start gap-5\">\n        <div className=\"w-14 h-14 rounded-2xl bg-white/20 border border-white/20 flex items-center justify-center flex-shrink-0 shadow-xl\">\n          {icon}\n        </div>\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-3 mb-2\">\n            <h3 className=\"text-lg font-black uppercase tracking-wider text-white\">Your Phase</h3>\n            <div className=\"px-3 py-1 bg-white/20 border border-white/20 rounded-lg text-[10px] font-black uppercase tracking-wider text-white\">\n              {phaseLabels[phase]}\n            </div>\n          </div>\n          <p className=\"text-sm text-white/80 leading-relaxed mb-5\">{message}</p>\n\n          {/* Phase-specific tips */}\n          <div className=\"grid grid-cols-3 gap-3\">\n            <div className=\"bg-black/20 rounded-xl p-3 text-center border border-white/10\">\n              <div className=\"flex items-center justify-center gap-1.5 mb-1\">\n                {phase === 'bulk' ? (\n                  <ArrowUp size={12} className=\"text-green-300\" />\n                ) : phase === 'cut' ? (\n                  <ArrowDown size={12} className=\"text-orange-300\" />\n                ) : (\n                  <Minus size={12} className=\"text-blue-300\" />\n                )}\n                <span className=\"text-[10px] font-bold uppercase tracking-wider text-white/60\">Calories</span>\n              </div>\n              <span className=\"text-sm font-black uppercase text-white\">\n                {phase === 'bulk' ? '+300' : phase === 'cut' ? '-500' : '+/-0'}\n              </span>\n            </div>\n            <div className=\"bg-black/20 rounded-xl p-3 text-center border border-white/10\">\n              <span className=\"text-[10px] font-bold uppercase tracking-wider text-white/60 block mb-1\">Protein</span>\n              <span className=\"text-sm font-black uppercase text-white\">\n                {phase === 'cut' ? '1.2g/lb' : '1g/lb'}\n              </span>\n            </div>\n            <div className=\"bg-black/20 rounded-xl p-3 text-center border border-white/10\">\n              <span className=\"text-[10px] font-bold uppercase tracking-wider text-white/60 block mb-1\">Cardio</span>\n              <span className=\"text-sm font-black uppercase text-white\">\n                {phase === 'bulk' ? 'Minimal' : phase === 'cut' ? '4-5x/wk' : '2-3x/wk'}\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// PRODUCT BUNDLE CTA\n// ============================================\n\ninterface ProductBundleCardProps {\n  products: ProductRecommendation[];\n  title?: string;\n}\n\nfunction ProductBundleCard({ products, title = 'Recommended Bundle' }: ProductBundleCardProps) {\n  // Get top 3 most important products\n  const bundleProducts = products.slice(0, 3);\n\n  // Calculate total cost\n  const totalCost = bundleProducts.reduce((sum, rec) => {\n    const supplement = SUPPLEMENTS.find(s => s.id === rec.product.supplementId);\n    return sum + (supplement?.costPerMonth.min || 0);\n  }, 0);\n\n  if (bundleProducts.length === 0) return null;\n\n  return (\n    <motion.div\n      className=\"rounded-[2rem] bg-gradient-to-br from-purple-900/50 to-violet-950/50 border border-purple-500/30 p-6\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-center gap-3 mb-5\">\n        <div className=\"w-10 h-10 rounded-xl bg-purple-500/20 border border-purple-500/30 flex items-center justify-center\">\n          <Package size={18} className=\"text-purple-400\" />\n        </div>\n        <div className=\"flex-1\">\n          <h3 className=\"text-sm font-black uppercase tracking-wider text-white\">{title}</h3>\n        </div>\n        <div className=\"px-3 py-1.5 bg-purple-500/20 border border-purple-500/30 text-purple-300 text-[10px] font-black uppercase tracking-wider rounded-lg\">\n          Save 15%\n        </div>\n      </div>\n\n      <p className=\"text-sm text-neutral-300 mb-5 leading-relaxed\">\n        Your analysis recommends these {bundleProducts.length} supplements - optimized for your specific weak points.\n      </p>\n\n      {/* Bundle Items */}\n      <div className=\"space-y-2 mb-5\">\n        {bundleProducts.map((rec, index) => (\n          <div\n            key={rec.product.id}\n            className=\"flex items-center gap-4 p-3 bg-black/30 rounded-xl border border-white/5\"\n          >\n            <div className=\"w-7 h-7 rounded-lg bg-purple-500/30 border border-purple-500/30 flex items-center justify-center flex-shrink-0\">\n              <span className=\"text-xs font-black text-purple-300\">{index + 1}</span>\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-sm font-black uppercase tracking-wider text-white truncate\">{rec.product.name}</p>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-500 truncate\">Targets: {rec.targetMetric}</p>\n            </div>\n            <div className=\"text-right flex-shrink-0\">\n              <p className=\"text-sm font-black text-white\">\n                ${SUPPLEMENTS.find(s => s.id === rec.product.supplementId)?.costPerMonth.min || 0}/mo\n              </p>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* Total & CTA */}\n      <div className=\"border-t border-purple-500/20 pt-5\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <span className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-400\">Bundle Total</span>\n          <div className=\"text-right\">\n            <span className=\"text-xl font-black text-white\">${totalCost}/mo</span>\n            <span className=\"text-xs font-bold text-neutral-500 ml-2 line-through\">${Math.round(totalCost * 1.15)}/mo</span>\n          </div>\n        </div>\n        <button\n          className=\"w-full flex items-center justify-center gap-3 py-3.5 bg-gradient-to-r from-purple-500 to-violet-600 text-white text-xs font-black uppercase tracking-wider rounded-xl hover:opacity-90 transition-opacity border border-purple-400/30\"\n        >\n          <ShoppingCart size={16} />\n          Get Your Bundle\n        </button>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// PLAN TAB\n// ============================================\n\nexport function PlanTab() {\n  const { recommendations, flaws, gender, ethnicity, frontRatios, sideRatios, overallScore, frontPhoto, vision, isUnlocked } = useResults();\n  const { user } = useAuth();\n  const physiqueContext = usePhysiqueOptional();\n  const [selectedPhase, setSelectedPhase] = useState<RecommendationPhase | null>(null);\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [completedIds, setCompletedIds] = useState<Set<string>>(new Set());\n  const [removedIds, setRemovedIds] = useState<Set<string>>(new Set());\n  const [previousAnalysis, setPreviousAnalysis] = useState<{\n    date: string;\n    overallScore: number;\n    bodyFatPercent?: number;\n    frontPhotoUrl?: string;\n  } | null>(null);\n\n  // Treatment conflict state\n  const [dismissedConflicts, setDismissedConflicts] = useState<Set<string>>(new Set());\n  const [conflictModal, setConflictModal] = useState<{\n    isOpen: boolean;\n    conflict: TreatmentConflict | null;\n    newTreatmentId: string;\n  }>({ isOpen: false, conflict: null, newTreatmentId: '' });\n\n  const { openPricingModal } = usePricing();\n\n  // Convert to number for arithmetic operations\n  const numericOverallScore = typeof overallScore === 'number' ? overallScore : 0;\n\n  // Check if user has a paid plan\n  const hasPaidPlan = user?.plan === 'basic' || user?.plan === 'pro';\n\n  // Get body fat from physique analysis\n  const bodyFatPercent = physiqueContext?.physiqueAnalysis?.bodyFatPercent;\n\n  // Generate Daily Stack for all users\n  const dailyStack = useMemo(() => {\n    return generateDailyStack(gender);\n  }, [gender]);\n\n  // Generate Product Recommendations based on metrics\n  const productRecommendations = useMemo(() => {\n    // Build metrics and severity dictionaries from ratios\n    const metricsDict: Record<string, number> = {};\n    const severityDict: Record<string, string> = {};\n\n    [...frontRatios, ...sideRatios].forEach(ratio => {\n      metricsDict[ratio.name] = typeof ratio.value === 'number' ? ratio.value : 0;\n      severityDict[ratio.name] = ratio.severity;\n    });\n\n    return getProductRecommendations(metricsDict, severityDict, gender, ethnicity);\n  }, [frontRatios, sideRatios, gender, ethnicity]);\n\n  // Split product recommendations by state\n  const { flawProducts, idealProducts } = useMemo(() => {\n    const flaw = productRecommendations.filter(r => r.state === 'flaw');\n    const ideal = productRecommendations.filter(r => r.state === 'ideal');\n    return { flawProducts: flaw, idealProducts: ideal };\n  }, [productRecommendations]);\n\n  // Map flaws to products and treatments\n  const flawsWithProducts = useMemo(() => {\n    return flaws.slice(0, 5).map(flaw => {\n      // Find products that target metrics related to this flaw\n      const relatedProducts = productRecommendations.filter(rec =>\n        flaw && flaw.responsibleRatios && flaw.responsibleRatios.some(ratio =>\n          rec.matchedMetrics.some(metric =>\n            metric.toLowerCase().includes(ratio.ratioName.toLowerCase()) ||\n            ratio.ratioName.toLowerCase().includes(metric.toLowerCase())\n          )\n        )\n      );\n\n      // Find treatments that match this flaw\n      const relatedTreatments = recommendations.filter(rec =>\n        rec.matchedFlaws.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase()))\n      );\n\n      return {\n        flaw,\n        products: relatedProducts.slice(0, 2),\n        treatments: relatedTreatments.slice(0, 3),\n      };\n    });\n  }, [flaws, productRecommendations, recommendations]);\n\n  // Handle progress photo upload\n  const handleProgressPhotoUpload = useCallback(async (file: File) => {\n    // Store current analysis as previous before re-analyzing\n    const numScore = typeof overallScore === 'number' ? overallScore : 0;\n    setPreviousAnalysis({\n      date: new Date().toISOString(),\n      overallScore: numScore,\n      bodyFatPercent,\n      frontPhotoUrl: frontPhoto || undefined,\n    });\n\n    // In a real implementation, this would upload to API and trigger re-analysis\n    console.log('Progress photo uploaded:', file.name);\n  }, [overallScore, bodyFatPercent, frontPhoto]);\n\n  // Count recommendations by phase\n  const phaseCounts = useMemo(() => {\n    const counts: Record<RecommendationPhase, number> = {\n      'Foundational': 0,\n      'Minimally Invasive': 0,\n      'Surgical': 0,\n    };\n    recommendations.forEach(r => {\n      if (!removedIds.has(r.ref_id)) {\n        counts[r.phase]++;\n      }\n    });\n    return counts;\n  }, [recommendations, removedIds]);\n\n  // Filter recommendations\n  const filteredRecommendations = useMemo(() => {\n    let filtered = recommendations.filter(r => !removedIds.has(r.ref_id));\n    if (selectedPhase) {\n      filtered = filtered.filter(r => r.phase === selectedPhase);\n    }\n    return filtered;\n  }, [recommendations, selectedPhase, removedIds]);\n\n  const hasRecommendations = filteredRecommendations.length > 0;\n\n  // Detect treatment conflicts in current recommendations\n  const treatmentConflicts = useMemo(() => {\n    const selectedIds = filteredRecommendations.map(r => r.ref_id);\n    const nameMap = Object.fromEntries(\n      filteredRecommendations.map(r => [r.ref_id, r.name])\n    );\n    const conflicts = findTreatmentConflicts(selectedIds, nameMap);\n\n    // Filter out dismissed conflicts\n    return conflicts.filter(c => {\n      const conflictKey = `${c.treatment1Id}-${c.treatment2Id}`;\n      return !dismissedConflicts.has(conflictKey);\n    });\n  }, [filteredRecommendations, dismissedConflicts]);\n\n  // Handle dismissing a conflict\n  const handleDismissConflict = useCallback((conflict: TreatmentConflict) => {\n    const conflictKey = `${conflict.treatment1Id}-${conflict.treatment2Id}`;\n    setDismissedConflicts(prev => new Set(Array.from(prev).concat(conflictKey)));\n  }, []);\n\n  // Handle dismissing all conflicts\n  const handleDismissAllConflicts = useCallback(() => {\n    const allKeys = treatmentConflicts.map(\n      c => `${c.treatment1Id}-${c.treatment2Id}`\n    );\n    setDismissedConflicts(prev => new Set(Array.from(prev).concat(allKeys)));\n  }, [treatmentConflicts]);\n\n  // Handle conflict modal actions\n  const handleConflictProceed = useCallback(() => {\n    if (conflictModal.conflict) {\n      // Remove the lower priority (existing) treatment\n      setRemovedIds(prev => new Set(Array.from(prev).concat(conflictModal.conflict!.treatment1Id)));\n    }\n    setConflictModal({ isOpen: false, conflict: null, newTreatmentId: '' });\n  }, [conflictModal.conflict]);\n\n  const handleConflictCancel = useCallback(() => {\n    setConflictModal({ isOpen: false, conflict: null, newTreatmentId: '' });\n  }, []);\n\n  // Handle mark complete\n  const handleMarkComplete = useCallback((id: string) => {\n    setCompletedIds(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(id)) {\n        newSet.delete(id);\n      } else {\n        newSet.add(id);\n      }\n      return newSet;\n    });\n  }, []);\n\n  // Handle remove\n  const handleRemove = useCallback((id: string) => {\n    setRemovedIds(prev => {\n      const newSet = new Set(prev);\n      newSet.add(id);\n      return newSet;\n    });\n    if (expandedId === id) {\n      setExpandedId(null);\n    }\n  }, [expandedId]);\n\n  return (\n    <TabContent\n      title=\"Your Plan & Potential\"\n      subtitle=\"Personalized recommendations based on your analysis\"\n    >\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n        {/* Main Content */}\n        <div className=\"lg:col-span-2 space-y-10\">\n          {/* Your Phase Card - Body Composition Phase */}\n          <YourPhaseCard bodyFatPercent={bodyFatPercent} gender={gender} />\n\n          {/* Daily Stack Card - Hero Element for ALL users */}\n          {dailyStack && <DailyStackCard dailyStack={dailyStack} />}\n\n          {/* Potential Score */}\n          <PotentialScoreCard />\n\n          {/* Fix Your Weak Points Section */}\n          {flawsWithProducts.length > 0 && (\n            <section>\n              <SectionHeader title=\"Fix Your Weak Points\">\n                <span className=\"px-3 py-1.5 bg-red-500/20 border border-red-500/30 text-red-400 text-[10px] font-black uppercase tracking-wider rounded-lg\">\n                  {flawsWithProducts.length} Issues\n                </span>\n              </SectionHeader>\n              <div className=\"space-y-4\">\n                {flawsWithProducts.map((item, index) => (\n                  <WeakPointCard\n                    key={item.flaw.id}\n                    flaw={item.flaw}\n                    rank={index + 1}\n                    products={item.products}\n                    treatments={item.treatments}\n                    onViewTreatment={(treatment) => setExpandedId(treatment.ref_id)}\n                  />\n                ))}\n              </div>\n            </section>\n          )}\n\n          {/* Targeted Product Recommendations - Corrective */}\n          {flawProducts.length > 0 && (\n            <section>\n              <SectionHeader title=\"Recommended Products\">\n                <span className=\"px-3 py-1.5 bg-cyan-500/20 border border-cyan-500/30 text-cyan-400 text-[10px] font-black uppercase tracking-wider rounded-lg\">\n                  Corrective\n                </span>\n              </SectionHeader>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {flawProducts.slice(0, 6).map((rec, index) => (\n                  <ProductCard key={rec.product.id} recommendation={rec} rank={index + 1} />\n                ))}\n              </div>\n            </section>\n          )}\n\n          {/* Targeted Product Recommendations - Maintenance */}\n          {idealProducts.length > 0 && (\n            <section>\n              <SectionHeader title=\"Protect Your Strengths\">\n                <span className=\"px-3 py-1.5 bg-green-500/20 border border-green-500/30 text-green-400 text-[10px] font-black uppercase tracking-wider rounded-lg\">\n                  Maintenance\n                </span>\n              </SectionHeader>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {idealProducts.slice(0, 4).map((rec) => (\n                  <ProductCard key={rec.product.id} recommendation={rec} />\n                ))}\n              </div>\n            </section>\n          )}\n\n          {/* Treatment Timeline */}\n          {recommendations.length > 0 && (\n            <section>\n              <SectionHeader title=\"Treatment Timeline\" />\n              <TreatmentTimeline recommendations={recommendations.filter(r => !removedIds.has(r.ref_id))} />\n            </section>\n          )}\n\n          {/* Treatment Conflict Warnings */}\n          {treatmentConflicts.length > 0 && (\n            <TreatmentConflictList\n              conflicts={treatmentConflicts}\n              onDismiss={handleDismissConflict}\n              onDismissAll={handleDismissAllConflicts}\n            />\n          )}\n\n          {/* Phase Filter Section */}\n          <section>\n            <SectionHeader title=\"Treatment Options\" />\n            <PhaseFilter\n              selectedPhase={selectedPhase}\n              onSelect={setSelectedPhase}\n              counts={phaseCounts}\n            />\n          </section>\n\n          {/* Recommendations List */}\n          {hasRecommendations ? (\n            <motion.div className=\"space-y-4\" layout>\n              <AnimatePresence mode=\"popLayout\">\n                {filteredRecommendations.map((rec, index) => (\n                  <motion.div\n                    key={rec.ref_id}\n                    layout\n                    initial={{ opacity: 0, y: 20 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    exit={{ opacity: 0, y: -20 }}\n                    transition={{ duration: 0.2, delay: index * 0.05 }}\n                  >\n                    <EnhancedRecommendationCard\n                      recommendation={rec}\n                      rank={index + 1}\n                      isExpanded={expandedId === rec.ref_id}\n                      onToggle={() => setExpandedId(\n                        expandedId === rec.ref_id ? null : rec.ref_id\n                      )}\n                      onMarkComplete={handleMarkComplete}\n                      onRemove={handleRemove}\n                      isCompleted={completedIds.has(rec.ref_id)}\n                      gender={gender}\n                      ethnicity={ethnicity}\n                    />\n                  </motion.div>\n                ))}\n              </AnimatePresence>\n            </motion.div>\n          ) : (\n            <div className=\"rounded-[2rem] bg-neutral-900/40 border border-white/5 p-10 text-center\">\n              <div className=\"w-16 h-16 rounded-2xl bg-neutral-900 border border-white/10 flex items-center justify-center mx-auto mb-5\">\n                <Sparkles size={28} className=\"text-neutral-600\" />\n              </div>\n              <h3 className=\"text-lg font-black uppercase tracking-wider text-white mb-2\">No Recommendations Yet</h3>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600\">\n                Complete a facial analysis to get personalized recommendations\n              </p>\n            </div>\n          )}\n        </div>\n\n        {/* Sidebar */}\n        <div className=\"space-y-6\">\n          {/* Medical Prescription Card (Dental) */}\n          {vision?.teeth && (\n            <MedicalPrescriptionCard vision={vision} isUnlocked={isUnlocked} />\n          )}\n\n          {/* Progress Comparison Card */}\n          <ProgressComparisonCard\n            currentAnalysis={{\n              date: new Date().toISOString(),\n              overallScore: numericOverallScore,\n              bodyFatPercent,\n              frontPhotoUrl: frontPhoto || undefined,\n            }}\n            previousAnalysis={previousAnalysis}\n            onUploadNewPhoto={handleProgressPhotoUpload}\n          />\n\n          {/* Product Bundle CTA */}\n          {flawProducts.length >= 3 && (\n            <ProductBundleCard\n              products={flawProducts}\n              title=\"Your Fix Bundle\"\n            />\n          )}\n\n          {/* Before/After Preview */}\n          <BeforeAfterPreviewSection />\n\n          {/* Order of Operations */}\n          <OrderOfOperations />\n\n          {/* My Plan Summary */}\n          <div className=\"rounded-2xl bg-neutral-900/40 border border-white/5 p-5\">\n            <h4 className=\"text-xs font-black uppercase tracking-wider text-white mb-4 flex items-center gap-3\">\n              <div className=\"w-8 h-8 rounded-lg bg-neutral-900 border border-white/10 flex items-center justify-center\">\n                <Zap size={14} className=\"text-yellow-400\" />\n              </div>\n              My Plan\n            </h4>\n            <div className=\"text-center py-8\">\n              <div className=\"w-14 h-14 mx-auto mb-4 rounded-2xl bg-neutral-900 border border-white/10 flex items-center justify-center\">\n                <Lock size={20} className=\"text-neutral-600\" />\n              </div>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mb-2\">\n                Add recommendations to build your personalized plan\n              </p>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-700\">\n                0 items selected\n              </p>\n            </div>\n          </div>\n\n          {/* Issues Summary */}\n          <div className=\"rounded-2xl bg-neutral-900/40 border border-white/5 p-5\">\n            <h4 className=\"text-xs font-black uppercase tracking-wider text-white mb-4\">Detected Issues</h4>\n            <div className=\"space-y-2\">\n              {flaws.slice(0, 5).map(flaw => (\n                <div\n                  key={flaw.id}\n                  className=\"flex items-center justify-between p-3 bg-neutral-900/50 border border-white/5 rounded-xl hover:border-white/10 transition-colors\"\n                >\n                  <span className=\"text-sm font-bold text-neutral-300 truncate\">{flaw.flawName}</span>\n                  <span className=\"text-[10px] font-black uppercase tracking-wider text-red-400 flex-shrink-0 px-2 py-1 bg-red-500/20 border border-red-500/30 rounded-lg\">\n                    -{flaw.harmonyPercentageLost.toFixed(1)}%\n                  </span>\n                </div>\n              ))}\n              {flaws.length === 0 && (\n                <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 text-center py-6\">\n                  No issues detected\n                </p>\n              )}\n            </div>\n          </div>\n\n          {/* Upgrade CTA or Premium Badge */}\n          {hasPaidPlan ? (\n            <motion.div\n              className=\"rounded-2xl bg-gradient-to-br from-green-500/10 to-emerald-600/10 border border-green-500/30 p-5\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.3 }}\n            >\n              <div className=\"flex items-center gap-3 mb-3\">\n                <div className=\"w-8 h-8 rounded-lg bg-green-500/20 border border-green-500/30 flex items-center justify-center\">\n                  <CheckCircle size={14} className=\"text-green-400\" />\n                </div>\n                <span className=\"text-xs font-black uppercase tracking-wider text-white\">\n                  {user?.plan === 'pro' ? 'Pro Plan' : 'Basic Plan'} Active\n                </span>\n              </div>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-500\">\n                You have full access to all {user?.plan === 'pro' ? 'features' : 'non-surgical recommendations'}.\n              </p>\n            </motion.div>\n          ) : (\n            <motion.div\n              className=\"rounded-2xl bg-gradient-to-br from-cyan-500/10 to-blue-600/10 border border-cyan-500/30 p-5\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.3 }}\n            >\n              <div className=\"flex items-center gap-3 mb-3\">\n                <div className=\"w-8 h-8 rounded-lg bg-cyan-500/20 border border-cyan-500/30 flex items-center justify-center\">\n                  <Sparkles size={14} className=\"text-cyan-400\" />\n                </div>\n                <span className=\"text-xs font-black uppercase tracking-wider text-white\">Unlock Full Plan</span>\n              </div>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-500 mb-4\">\n                Get detailed treatment guides, cost estimates, and provider recommendations.\n              </p>\n              <button\n                onClick={() => openPricingModal('plan_sidebar')}\n                className=\"block w-full py-3 bg-cyan-500 text-black text-xs font-black uppercase tracking-wider rounded-xl text-center hover:bg-cyan-400 transition-colors\"\n              >\n                Upgrade Now\n              </button>\n            </motion.div>\n          )}\n        </div>\n      </div>\n\n      {/* Treatment Conflict Modal */}\n      <SelectionWarningModal\n        isOpen={conflictModal.isOpen}\n        onClose={handleConflictCancel}\n        conflict={conflictModal.conflict || {\n          treatment1Id: '',\n          treatment1Name: '',\n          treatment2Id: '',\n          treatment2Name: '',\n          reason: '',\n        }}\n        onProceed={handleConflictProceed}\n        onCancel={handleConflictCancel}\n      />\n    </TabContent>\n  );\n}\n","structuredPatch":[{"oldStart":50,"oldLines":6,"newStart":50,"newLines":22,"lines":[" } from '@/lib/recommendations/engine';"," "," // ============================================","+// SECTION HEADER COMPONENT","+// ============================================","+","+function SectionHeader({ title, children }: { title: string; children?: React.ReactNode }) {","+  return (","+    <div className=\"flex items-center gap-4 mb-6\">","+      <h2 className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 whitespace-nowrap\">","+        {title}","+      </h2>","+      <div className=\"flex-1 h-px bg-neutral-800\" />","+      {children}","+    </div>","+  );","+}","+","+// ============================================"," // POTENTIAL SCORE CARD"," // ============================================"," "]},{"oldStart":68,"oldLines":43,"newStart":84,"newLines":50,"lines":[" ","   return (","     <motion.div","-      className=\"bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-2xl p-6\"","+      className=\"rounded-[2rem] bg-neutral-900/40 border border-white/5 p-6 md:p-8\"","       initial={{ opacity: 0, y: 20 }}","       animate={{ opacity: 1, y: 0 }}","     >","-      <div className=\"flex items-center gap-2 mb-4\">","-        <Sparkles size={20} className=\"text-cyan-400\" />","-        <h3 className=\"font-semibold text-white\">Your Potential</h3>","+      <div className=\"flex items-center gap-3 mb-6\">","+        <div className=\"w-10 h-10 rounded-xl bg-neutral-900 border border-white/10 flex items-center justify-center\">","+          <Sparkles size={18} className=\"text-cyan-400\" />","+        </div>","+        <div>","+          <h3 className=\"text-sm font-black uppercase tracking-wider text-white\">Your Potential</h3>","+          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600\">Maximum Achievable Score</p>","+        </div>","       </div>"," ","-      <div className=\"flex items-center justify-center gap-8 mb-6\">","+      <div className=\"flex items-center justify-center gap-6 md:gap-10 mb-6\">","         {/* Current */}","         <div className=\"text-center\">","-          <p className=\"text-xs text-neutral-500 mb-2\">Current</p>","+          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mb-3\">Current</p>","           <ScoreCircle score={overallScore} size=\"lg\" animate={false} />","         </div>"," ","         {/* Arrow */}","-        <div className=\"flex flex-col items-center gap-1\">","-          <ChevronRight size={24} className=\"text-cyan-400\" />","-          <span className=\"text-xs text-green-400\">+{potentialImprovement.toFixed(1)}</span>","+        <div className=\"flex flex-col items-center gap-2\">","+          <ChevronRight size={28} className=\"text-cyan-400\" />","+          <span className=\"px-2 py-1 rounded-lg bg-green-500/20 border border-green-500/30 text-xs font-black uppercase tracking-wider text-green-400\">","+            +{potentialImprovement.toFixed(1)}","+          </span>","         </div>"," ","         {/* Potential */}","         <div className=\"text-center\">","-          <p className=\"text-xs text-neutral-500 mb-2\">Potential</p>","+          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mb-3\">Potential</p>","           <div className=\"relative\">","             <ScoreCircle score={potentialScore} size=\"lg\" animate={false} />","-            <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center\">","-              <TrendingUp size={12} className=\"text-black\" />","+            <div className=\"absolute -top-1 -right-1 w-6 h-6 bg-green-500 rounded-lg flex items-center justify-center shadow-lg shadow-green-500/30\">","+              <TrendingUp size={14} className=\"text-black\" />","             </div>","           </div>","         </div>","       </div>"," ","-      <p className=\"text-sm text-neutral-400 text-center\">","+      <p className=\"text-sm text-neutral-400 text-center leading-relaxed\">","         Following our recommendations could improve your harmony score by up to{' '}","-        <span className=\"text-green-400 font-medium\">+{potentialImprovement.toFixed(1)} points</span>","+        <span className=\"text-green-400 font-black\">+{potentialImprovement.toFixed(1)} points</span>","       </p>","     </motion.div>","   );"]},{"oldStart":127,"oldLines":9,"newStart":150,"newLines":9,"lines":["     <div className=\"flex flex-wrap gap-2\">","       <button","         onClick={() => onSelect(null)}","-        className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${selectedPhase === null","-          ? 'bg-cyan-500 text-black'","-          : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'","+        className={`px-4 py-2 rounded-xl text-xs font-black uppercase tracking-wider transition-all border ${selectedPhase === null","+          ? 'bg-cyan-500 text-black border-cyan-400'","+          : 'bg-neutral-900/50 text-neutral-400 border-white/5 hover:border-white/10 hover:text-white'","           }`}","       >","         All ({Object.values(counts).reduce((a, b) => a + b, 0)})"]},{"oldStart":138,"oldLines":9,"newStart":161,"newLines":9,"lines":["         <button","           key={phase}","           onClick={() => onSelect(phase)}","-          className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${selectedPhase === phase","-            ? 'bg-neutral-700 text-white'","-            : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'","+          className={`px-4 py-2 rounded-xl text-xs font-black uppercase tracking-wider transition-all flex items-center gap-2 border ${selectedPhase === phase","+            ? 'bg-neutral-800 text-white border-white/10'","+            : 'bg-neutral-900/50 text-neutral-400 border-white/5 hover:border-white/10 hover:text-white'","             }`}","         >","           <PhaseBadge phase={phase} size=\"sm\" />"]},{"oldStart":174,"oldLines":25,"newStart":197,"newLines":25,"lines":["   if (!frontPhoto) return null;"," ","   return (","-    <div className=\"space-y-3\">","+    <div className=\"space-y-4\">","       {/* Mode Toggle */}","-      <div className=\"flex items-center justify-center gap-1 p-1 bg-black/40 rounded-lg border border-white/10\">","+      <div className=\"flex items-center justify-center gap-1 p-1 bg-neutral-900/50 rounded-xl border border-white/5\">","         <button","           onClick={() => setPreviewMode('morphing')}","-          className={`flex-1 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${","+          className={`flex-1 px-4 py-2 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${","             previewMode === 'morphing'","-              ? 'bg-cyan-500/20 text-cyan-400'","-              : 'text-neutral-500 hover:text-white'","+              ? 'bg-cyan-500/20 text-cyan-400 border border-cyan-500/30'","+              : 'text-neutral-500 hover:text-white border border-transparent'","           }`}","         >","           Face Morphing","         </button>","         <button","           onClick={() => setPreviewMode('static')}","-          className={`flex-1 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${","+          className={`flex-1 px-4 py-2 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${","             previewMode === 'static'","-              ? 'bg-neutral-700 text-white'","-              : 'text-neutral-500 hover:text-white'","+              ? 'bg-neutral-800 text-white border border-white/10'","+              : 'text-neutral-500 hover:text-white border border-transparent'","           }`}","         >","           Static Preview"]},{"oldStart":244,"oldLines":37,"newStart":267,"newLines":39,"lines":[" "," function OrderOfOperations() {","   return (","-    <div className=\"bg-neutral-900/50 border border-neutral-800 rounded-xl p-4\">","-      <h4 className=\"font-medium text-white mb-3 flex items-center gap-2\">","-        <Target size={16} className=\"text-cyan-400\" />","+    <div className=\"rounded-2xl bg-neutral-900/40 border border-white/5 p-5\">","+      <h4 className=\"text-xs font-black uppercase tracking-wider text-white mb-4 flex items-center gap-3\">","+        <div className=\"w-8 h-8 rounded-lg bg-neutral-900 border border-white/10 flex items-center justify-center\">","+          <Target size={14} className=\"text-cyan-400\" />","+        </div>","         Recommended Order","       </h4>","-      <div className=\"space-y-3\">","-        <div className=\"flex items-start gap-3\">","-          <div className=\"w-6 h-6 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0 mt-0.5\">","-            <span className=\"text-xs font-bold text-green-400\">1</span>","+      <div className=\"space-y-4\">","+        <div className=\"flex items-start gap-4\">","+          <div className=\"w-7 h-7 rounded-lg bg-green-500/20 border border-green-500/30 flex items-center justify-center flex-shrink-0 mt-0.5\">","+            <span className=\"text-xs font-black text-green-400\">1</span>","           </div>","           <div>","-            <p className=\"text-sm font-medium text-white\">Start with Foundational</p>","-            <p className=\"text-xs text-neutral-500\">Low-cost, no-risk improvements that anyone can do</p>","+            <p className=\"text-sm font-black uppercase tracking-wider text-white\">Start with Foundational</p>","+            <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mt-1\">Low-cost, no-risk improvements</p>","           </div>","         </div>","-        <div className=\"flex items-start gap-3\">","-          <div className=\"w-6 h-6 rounded-full bg-yellow-500/20 flex items-center justify-center flex-shrink-0 mt-0.5\">","-            <span className=\"text-xs font-bold text-yellow-400\">2</span>","+        <div className=\"flex items-start gap-4\">","+          <div className=\"w-7 h-7 rounded-lg bg-yellow-500/20 border border-yellow-500/30 flex items-center justify-center flex-shrink-0 mt-0.5\">","+            <span className=\"text-xs font-black text-yellow-400\">2</span>","           </div>","           <div>","-            <p className=\"text-sm font-medium text-white\">Consider Minimally Invasive</p>","-            <p className=\"text-xs text-neutral-500\">Temporary or reversible options with moderate impact</p>","+            <p className=\"text-sm font-black uppercase tracking-wider text-white\">Consider Minimally Invasive</p>","+            <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mt-1\">Temporary or reversible options</p>","           </div>","         </div>","-        <div className=\"flex items-start gap-3\">","-          <div className=\"w-6 h-6 rounded-full bg-red-500/20 flex items-center justify-center flex-shrink-0 mt-0.5\">","-            <span className=\"text-xs font-bold text-red-400\">3</span>","+        <div className=\"flex items-start gap-4\">","+          <div className=\"w-7 h-7 rounded-lg bg-red-500/20 border border-red-500/30 flex items-center justify-center flex-shrink-0 mt-0.5\">","+            <span className=\"text-xs font-black text-red-400\">3</span>","           </div>","           <div>","-            <p className=\"text-sm font-medium text-white\">Evaluate Surgical Options</p>","-            <p className=\"text-xs text-neutral-500\">Permanent solutions for significant improvements</p>","+            <p className=\"text-sm font-black uppercase tracking-wider text-white\">Evaluate Surgical Options</p>","+            <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mt-1\">Permanent solutions for significant improvements</p>","           </div>","         </div>","       </div>"]},{"oldStart":300,"oldLines":7,"newStart":325,"newLines":7,"lines":["       return {","         phase: 'maintain',","         message: 'Complete your physique analysis to get personalized phase recommendations.',","-        color: 'from-neutral-700 to-neutral-800',","+        color: 'from-neutral-800 to-neutral-900',","         icon: <Scale size={24} className=\"text-neutral-400\" />,","       };","     }"]},{"oldStart":343,"oldLines":27,"newStart":368,"newLines":27,"lines":[" ","   return (","     <motion.div","-      className={`bg-gradient-to-br ${color} rounded-2xl p-6 border border-white/10`}","+      className={`bg-gradient-to-br ${color} rounded-[2rem] p-6 md:p-8 border border-white/10`}","       initial={{ opacity: 0, y: 20 }}","       animate={{ opacity: 1, y: 0 }}","     >","-      <div className=\"flex items-start gap-4\">","-        <div className=\"w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center flex-shrink-0\">","+      <div className=\"flex items-start gap-5\">","+        <div className=\"w-14 h-14 rounded-2xl bg-white/20 border border-white/20 flex items-center justify-center flex-shrink-0 shadow-xl\">","           {icon}","         </div>","         <div className=\"flex-1\">","-          <div className=\"flex items-center gap-2 mb-1\">","-            <h3 className=\"font-semibold text-white text-lg\">Your Phase</h3>","-            <div className=\"px-2 py-0.5 bg-white/20 rounded-full text-xs font-medium text-white\">","+          <div className=\"flex items-center gap-3 mb-2\">","+            <h3 className=\"text-lg font-black uppercase tracking-wider text-white\">Your Phase</h3>","+            <div className=\"px-3 py-1 bg-white/20 border border-white/20 rounded-lg text-[10px] font-black uppercase tracking-wider text-white\">","               {phaseLabels[phase]}","             </div>","           </div>","-          <p className=\"text-sm text-white/80 mb-4\">{message}</p>","+          <p className=\"text-sm text-white/80 leading-relaxed mb-5\">{message}</p>"," ","           {/* Phase-specific tips */}","-          <div className=\"grid grid-cols-3 gap-2\">","-            <div className=\"bg-black/20 rounded-lg p-2 text-center\">","-              <div className=\"flex items-center justify-center gap-1 mb-0.5\">","+          <div className=\"grid grid-cols-3 gap-3\">","+            <div className=\"bg-black/20 rounded-xl p-3 text-center border border-white/10\">","+              <div className=\"flex items-center justify-center gap-1.5 mb-1\">","                 {phase === 'bulk' ? (","                   <ArrowUp size={12} className=\"text-green-300\" />","                 ) : phase === 'cut' ? ("]},{"oldStart":371,"oldLines":21,"newStart":396,"newLines":21,"lines":["                 ) : (","                   <Minus size={12} className=\"text-blue-300\" />","                 )}","-                <span className=\"text-xs text-white/60\">Calories</span>","+                <span className=\"text-[10px] font-bold uppercase tracking-wider text-white/60\">Calories</span>","               </div>","-              <span className=\"text-sm font-medium text-white\">","-                {phase === 'bulk' ? '+300' : phase === 'cut' ? '-500' : '±0'}","+              <span className=\"text-sm font-black uppercase text-white\">","+                {phase === 'bulk' ? '+300' : phase === 'cut' ? '-500' : '+/-0'}","               </span>","             </div>","-            <div className=\"bg-black/20 rounded-lg p-2 text-center\">","-              <span className=\"text-xs text-white/60 block mb-0.5\">Protein</span>","-              <span className=\"text-sm font-medium text-white\">","+            <div className=\"bg-black/20 rounded-xl p-3 text-center border border-white/10\">","+              <span className=\"text-[10px] font-bold uppercase tracking-wider text-white/60 block mb-1\">Protein</span>","+              <span className=\"text-sm font-black uppercase text-white\">","                 {phase === 'cut' ? '1.2g/lb' : '1g/lb'}","               </span>","             </div>","-            <div className=\"bg-black/20 rounded-lg p-2 text-center\">","-              <span className=\"text-xs text-white/60 block mb-0.5\">Cardio</span>","-              <span className=\"text-sm font-medium text-white\">","+            <div className=\"bg-black/20 rounded-xl p-3 text-center border border-white/10\">","+              <span className=\"text-[10px] font-bold uppercase tracking-wider text-white/60 block mb-1\">Cardio</span>","+              <span className=\"text-sm font-black uppercase text-white\">","                 {phase === 'bulk' ? 'Minimal' : phase === 'cut' ? '4-5x/wk' : '2-3x/wk'}","               </span>","             </div>"]},{"oldStart":419,"oldLines":38,"newStart":444,"newLines":42,"lines":[" ","   return (","     <motion.div","-      className=\"bg-gradient-to-br from-purple-900/50 to-violet-950/50 border border-purple-500/30 rounded-2xl p-6\"","+      className=\"rounded-[2rem] bg-gradient-to-br from-purple-900/50 to-violet-950/50 border border-purple-500/30 p-6\"","       initial={{ opacity: 0, y: 20 }}","       animate={{ opacity: 1, y: 0 }}","     >","-      <div className=\"flex items-center gap-2 mb-4\">","-        <Package size={20} className=\"text-purple-400\" />","-        <h3 className=\"font-semibold text-white\">{title}</h3>","-        <div className=\"ml-auto px-2 py-0.5 bg-purple-500/20 text-purple-300 text-xs font-medium rounded-full\">","+      <div className=\"flex items-center gap-3 mb-5\">","+        <div className=\"w-10 h-10 rounded-xl bg-purple-500/20 border border-purple-500/30 flex items-center justify-center\">","+          <Package size={18} className=\"text-purple-400\" />","+        </div>","+        <div className=\"flex-1\">","+          <h3 className=\"text-sm font-black uppercase tracking-wider text-white\">{title}</h3>","+        </div>","+        <div className=\"px-3 py-1.5 bg-purple-500/20 border border-purple-500/30 text-purple-300 text-[10px] font-black uppercase tracking-wider rounded-lg\">","           Save 15%","         </div>","       </div>"," ","-      <p className=\"text-sm text-neutral-300 mb-4\">","+      <p className=\"text-sm text-neutral-300 mb-5 leading-relaxed\">","         Your analysis recommends these {bundleProducts.length} supplements - optimized for your specific weak points.","       </p>"," ","       {/* Bundle Items */}","-      <div className=\"space-y-2 mb-4\">","+      <div className=\"space-y-2 mb-5\">","         {bundleProducts.map((rec, index) => (","           <div","             key={rec.product.id}","-            className=\"flex items-center gap-3 p-2 bg-black/20 rounded-lg\"","+            className=\"flex items-center gap-4 p-3 bg-black/30 rounded-xl border border-white/5\"","           >","-            <div className=\"w-6 h-6 rounded-full bg-purple-500/30 flex items-center justify-center flex-shrink-0\">","-              <span className=\"text-xs font-bold text-purple-300\">{index + 1}</span>","+            <div className=\"w-7 h-7 rounded-lg bg-purple-500/30 border border-purple-500/30 flex items-center justify-center flex-shrink-0\">","+              <span className=\"text-xs font-black text-purple-300\">{index + 1}</span>","             </div>","             <div className=\"flex-1 min-w-0\">","-              <p className=\"text-sm font-medium text-white truncate\">{rec.product.name}</p>","-              <p className=\"text-xs text-neutral-400 truncate\">Targets: {rec.targetMetric}</p>","+              <p className=\"text-sm font-black uppercase tracking-wider text-white truncate\">{rec.product.name}</p>","+              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-500 truncate\">Targets: {rec.targetMetric}</p>","             </div>","             <div className=\"text-right flex-shrink-0\">","-              <p className=\"text-sm text-white\">","+              <p className=\"text-sm font-black text-white\">","                 ${SUPPLEMENTS.find(s => s.id === rec.product.supplementId)?.costPerMonth.min || 0}/mo","               </p>","             </div>"]},{"oldStart":459,"oldLines":18,"newStart":488,"newLines":18,"lines":["       </div>"," ","       {/* Total & CTA */}","-      <div className=\"border-t border-purple-500/20 pt-4\">","-        <div className=\"flex items-center justify-between mb-3\">","-          <span className=\"text-neutral-400\">Bundle Total</span>","+      <div className=\"border-t border-purple-500/20 pt-5\">","+        <div className=\"flex items-center justify-between mb-4\">","+          <span className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-400\">Bundle Total</span>","           <div className=\"text-right\">","-            <span className=\"text-lg font-bold text-white\">${totalCost}/mo</span>","-            <span className=\"text-xs text-neutral-500 ml-2 line-through\">${Math.round(totalCost * 1.15)}/mo</span>","+            <span className=\"text-xl font-black text-white\">${totalCost}/mo</span>","+            <span className=\"text-xs font-bold text-neutral-500 ml-2 line-through\">${Math.round(totalCost * 1.15)}/mo</span>","           </div>","         </div>","         <button","-          className=\"w-full flex items-center justify-center gap-2 py-3 bg-gradient-to-r from-purple-500 to-violet-600 text-white font-medium rounded-lg hover:opacity-90 transition-opacity\"","+          className=\"w-full flex items-center justify-center gap-3 py-3.5 bg-gradient-to-r from-purple-500 to-violet-600 text-white text-xs font-black uppercase tracking-wider rounded-xl hover:opacity-90 transition-opacity border border-purple-400/30\"","         >","-          <ShoppingCart size={18} />","+          <ShoppingCart size={16} />","           Get Your Bundle","         </button>","       </div>"]},{"oldStart":681,"oldLines":9,"newStart":710,"newLines":9,"lines":["       title=\"Your Plan & Potential\"","       subtitle=\"Personalized recommendations based on your analysis\"","     >","-      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">","+      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">","         {/* Main Content */}","-        <div className=\"lg:col-span-2 space-y-6\">","+        <div className=\"lg:col-span-2 space-y-10\">","           {/* Your Phase Card - Body Composition Phase */}","           <YourPhaseCard bodyFatPercent={bodyFatPercent} gender={gender} />"," "]},{"oldStart":695,"oldLines":15,"newStart":724,"newLines":13,"lines":[" ","           {/* Fix Your Weak Points Section */}","           {flawsWithProducts.length > 0 && (","-            <div className=\"space-y-4\">","-              <div className=\"flex items-center gap-2\">","-                <AlertCircle size={20} className=\"text-red-400\" />","-                <h3 className=\"text-lg font-semibold text-white\">Fix Your Weak Points</h3>","-                <span className=\"px-2 py-0.5 bg-red-500/20 text-red-400 text-xs rounded-full border border-red-500/30\">","+            <section>","+              <SectionHeader title=\"Fix Your Weak Points\">","+                <span className=\"px-3 py-1.5 bg-red-500/20 border border-red-500/30 text-red-400 text-[10px] font-black uppercase tracking-wider rounded-lg\">","                   {flawsWithProducts.length} Issues","                 </span>","-              </div>","-              <div className=\"space-y-3\">","+              </SectionHeader>","+              <div className=\"space-y-4\">","                 {flawsWithProducts.map((item, index) => (","                   <WeakPointCard","                     key={item.flaw.id}"]},{"oldStart":715,"oldLines":48,"newStart":742,"newLines":47,"lines":["                   />","                 ))}","               </div>","-            </div>","+            </section>","           )}"," ","           {/* Targeted Product Recommendations - Corrective */}","           {flawProducts.length > 0 && (","-            <div className=\"space-y-4\">","-              <div className=\"flex items-center gap-2\">","-                <Package size={20} className=\"text-cyan-400\" />","-                <h3 className=\"text-lg font-semibold text-white\">Recommended Products</h3>","-                <span className=\"px-2 py-0.5 bg-cyan-500/20 text-cyan-400 text-xs rounded-full border border-cyan-500/30\">","+            <section>","+              <SectionHeader title=\"Recommended Products\">","+                <span className=\"px-3 py-1.5 bg-cyan-500/20 border border-cyan-500/30 text-cyan-400 text-[10px] font-black uppercase tracking-wider rounded-lg\">","                   Corrective","                 </span>","-              </div>","+              </SectionHeader>","               <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">","                 {flawProducts.slice(0, 6).map((rec, index) => (","                   <ProductCard key={rec.product.id} recommendation={rec} rank={index + 1} />","                 ))}","               </div>","-            </div>","+            </section>","           )}"," ","           {/* Targeted Product Recommendations - Maintenance */}","           {idealProducts.length > 0 && (","-            <div className=\"space-y-4\">","-              <div className=\"flex items-center gap-2\">","-                <CheckCircle2 size={20} className=\"text-green-400\" />","-                <h3 className=\"text-lg font-semibold text-white\">Protect Your Strengths</h3>","-                <span className=\"px-2 py-0.5 bg-green-500/20 text-green-400 text-xs rounded-full border border-green-500/30\">","+            <section>","+              <SectionHeader title=\"Protect Your Strengths\">","+                <span className=\"px-3 py-1.5 bg-green-500/20 border border-green-500/30 text-green-400 text-[10px] font-black uppercase tracking-wider rounded-lg\">","                   Maintenance","                 </span>","-              </div>","+              </SectionHeader>","               <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">","                 {idealProducts.slice(0, 4).map((rec) => (","                   <ProductCard key={rec.product.id} recommendation={rec} />","                 ))}","               </div>","-            </div>","+            </section>","           )}"," ","           {/* Treatment Timeline */}","           {recommendations.length > 0 && (","-            <TreatmentTimeline recommendations={recommendations.filter(r => !removedIds.has(r.ref_id))} />","+            <section>","+              <SectionHeader title=\"Treatment Timeline\" />","+              <TreatmentTimeline recommendations={recommendations.filter(r => !removedIds.has(r.ref_id))} />","+            </section>","           )}"," ","           {/* Treatment Conflict Warnings */}"]},{"oldStart":768,"oldLines":12,"newStart":794,"newLines":15,"lines":["             />","           )}"," ","-          {/* Phase Filter */}","-          <PhaseFilter","-            selectedPhase={selectedPhase}","-            onSelect={setSelectedPhase}","-            counts={phaseCounts}","-          />","+          {/* Phase Filter Section */}","+          <section>","+            <SectionHeader title=\"Treatment Options\" />","+            <PhaseFilter","+              selectedPhase={selectedPhase}","+              onSelect={setSelectedPhase}","+              counts={phaseCounts}","+            />","+          </section>"," ","           {/* Recommendations List */}","           {hasRecommendations ? ("]},{"oldStart":806,"oldLines":10,"newStart":835,"newLines":12,"lines":["               </AnimatePresence>","             </motion.div>","           ) : (","-            <div className=\"bg-neutral-900/50 border border-neutral-800 rounded-xl p-8 text-center\">","-              <Sparkles size={48} className=\"mx-auto text-neutral-700 mb-4\" />","-              <h3 className=\"text-lg font-medium text-white mb-2\">No Recommendations Yet</h3>","-              <p className=\"text-neutral-500 mb-4\">","+            <div className=\"rounded-[2rem] bg-neutral-900/40 border border-white/5 p-10 text-center\">","+              <div className=\"w-16 h-16 rounded-2xl bg-neutral-900 border border-white/10 flex items-center justify-center mx-auto mb-5\">","+                <Sparkles size={28} className=\"text-neutral-600\" />","+              </div>","+              <h3 className=\"text-lg font-black uppercase tracking-wider text-white mb-2\">No Recommendations Yet</h3>","+              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600\">","                 Complete a facial analysis to get personalized recommendations","               </p>","             </div>"]},{"oldStart":850,"oldLines":41,"newStart":881,"newLines":43,"lines":["           <OrderOfOperations />"," ","           {/* My Plan Summary */}","-          <div className=\"bg-neutral-900/50 border border-neutral-800 rounded-xl p-4\">","-            <h4 className=\"font-medium text-white mb-3 flex items-center gap-2\">","-              <Zap size={16} className=\"text-yellow-400\" />","+          <div className=\"rounded-2xl bg-neutral-900/40 border border-white/5 p-5\">","+            <h4 className=\"text-xs font-black uppercase tracking-wider text-white mb-4 flex items-center gap-3\">","+              <div className=\"w-8 h-8 rounded-lg bg-neutral-900 border border-white/10 flex items-center justify-center\">","+                <Zap size={14} className=\"text-yellow-400\" />","+              </div>","               My Plan","             </h4>","-            <div className=\"text-center py-6\">","-              <div className=\"w-12 h-12 mx-auto mb-3 rounded-xl bg-neutral-800 flex items-center justify-center\">","+            <div className=\"text-center py-8\">","+              <div className=\"w-14 h-14 mx-auto mb-4 rounded-2xl bg-neutral-900 border border-white/10 flex items-center justify-center\">","                 <Lock size={20} className=\"text-neutral-600\" />","               </div>","-              <p className=\"text-sm text-neutral-500 mb-3\">","+              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mb-2\">","                 Add recommendations to build your personalized plan","               </p>","-              <p className=\"text-xs text-neutral-600\">","+              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-700\">","                 0 items selected","               </p>","             </div>","           </div>"," ","           {/* Issues Summary */}","-          <div className=\"bg-neutral-900/50 border border-neutral-800 rounded-xl p-4\">","-            <h4 className=\"font-medium text-white mb-3\">Detected Issues</h4>","+          <div className=\"rounded-2xl bg-neutral-900/40 border border-white/5 p-5\">","+            <h4 className=\"text-xs font-black uppercase tracking-wider text-white mb-4\">Detected Issues</h4>","             <div className=\"space-y-2\">","               {flaws.slice(0, 5).map(flaw => (","                 <div","                   key={flaw.id}","-                  className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"","+                  className=\"flex items-center justify-between p-3 bg-neutral-900/50 border border-white/5 rounded-xl hover:border-white/10 transition-colors\"","                 >","-                  <span className=\"text-sm text-neutral-300 truncate\">{flaw.flawName}</span>","-                  <span className=\"text-xs text-red-400 flex-shrink-0\">","+                  <span className=\"text-sm font-bold text-neutral-300 truncate\">{flaw.flawName}</span>","+                  <span className=\"text-[10px] font-black uppercase tracking-wider text-red-400 flex-shrink-0 px-2 py-1 bg-red-500/20 border border-red-500/30 rounded-lg\">","                     -{flaw.harmonyPercentageLost.toFixed(1)}%","                   </span>","                 </div>","               ))}","               {flaws.length === 0 && (","-                <p className=\"text-sm text-neutral-500 text-center py-4\">","+                <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 text-center py-6\">","                   No issues detected","                 </p>","               )}"]},{"oldStart":894,"oldLines":38,"newStart":927,"newLines":42,"lines":["           {/* Upgrade CTA or Premium Badge */}","           {hasPaidPlan ? (","             <motion.div","-              className=\"bg-gradient-to-br from-green-500/10 to-emerald-600/10 border border-green-500/30 rounded-xl p-4\"","+              className=\"rounded-2xl bg-gradient-to-br from-green-500/10 to-emerald-600/10 border border-green-500/30 p-5\"","               initial={{ opacity: 0, y: 20 }}","               animate={{ opacity: 1, y: 0 }}","               transition={{ delay: 0.3 }}","             >","-              <div className=\"flex items-center gap-2 mb-2\">","-                <CheckCircle size={16} className=\"text-green-400\" />","-                <span className=\"text-sm font-medium text-white\">","+              <div className=\"flex items-center gap-3 mb-3\">","+                <div className=\"w-8 h-8 rounded-lg bg-green-500/20 border border-green-500/30 flex items-center justify-center\">","+                  <CheckCircle size={14} className=\"text-green-400\" />","+                </div>","+                <span className=\"text-xs font-black uppercase tracking-wider text-white\">","                   {user?.plan === 'pro' ? 'Pro Plan' : 'Basic Plan'} Active","                 </span>","               </div>","-              <p className=\"text-xs text-neutral-400\">","+              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-500\">","                 You have full access to all {user?.plan === 'pro' ? 'features' : 'non-surgical recommendations'}.","               </p>","             </motion.div>","           ) : (","             <motion.div","-              className=\"bg-gradient-to-br from-cyan-500/10 to-blue-600/10 border border-cyan-500/30 rounded-xl p-4\"","+              className=\"rounded-2xl bg-gradient-to-br from-cyan-500/10 to-blue-600/10 border border-cyan-500/30 p-5\"","               initial={{ opacity: 0, y: 20 }}","               animate={{ opacity: 1, y: 0 }}","               transition={{ delay: 0.3 }}","             >","-              <div className=\"flex items-center gap-2 mb-2\">","-                <Sparkles size={16} className=\"text-cyan-400\" />","-                <span className=\"text-sm font-medium text-white\">Unlock Full Plan</span>","+              <div className=\"flex items-center gap-3 mb-3\">","+                <div className=\"w-8 h-8 rounded-lg bg-cyan-500/20 border border-cyan-500/30 flex items-center justify-center\">","+                  <Sparkles size={14} className=\"text-cyan-400\" />","+                </div>","+                <span className=\"text-xs font-black uppercase tracking-wider text-white\">Unlock Full Plan</span>","               </div>","-              <p className=\"text-xs text-neutral-400 mb-3\">","+              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-500 mb-4\">","                 Get detailed treatment guides, cost estimates, and provider recommendations.","               </p>","               <button","                 onClick={() => openPricingModal('plan_sidebar')}","-                className=\"block w-full py-2 bg-cyan-500 text-black text-sm font-medium rounded-lg text-center hover:bg-cyan-400 transition-colors\"","+                className=\"block w-full py-3 bg-cyan-500 text-black text-xs font-black uppercase tracking-wider rounded-xl text-center hover:bg-cyan-400 transition-colors\"","               >","                 Upgrade Now","               </button>"]}],"originalFile":"'use client';\n\nimport { useState, useMemo, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Sparkles,\n  TrendingUp,\n  Target,\n  Zap,\n  ChevronRight,\n  Lock,\n  CheckCircle,\n  AlertCircle,\n  CheckCircle2,\n  Scale,\n  Dumbbell,\n  Salad,\n  ArrowDown,\n  ArrowUp,\n  Minus,\n  Package,\n  ShoppingCart,\n} from 'lucide-react';\nimport { useResults } from '@/contexts/ResultsContext';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { usePricing } from '@/contexts/PricingContext';\nimport { usePhysiqueOptional } from '@/contexts/PhysiqueContext';\nimport { TabContent } from '../ResultsLayout';\nimport { EnhancedRecommendationCard } from '../cards/EnhancedRecommendationCard';\nimport { ScoreCircle, PhaseBadge } from '../shared';\nimport { BeforeAfterPreview } from '../visualization/BeforeAfterPreview';\nimport { FaceMorphing } from '../visualization/FaceMorphing';\nimport { TreatmentTimeline } from '../visualization/TreatmentTimeline';\nimport { RecommendationPhase, ProductRecommendation } from '@/types/results';\nimport { DailyStackCard } from '../cards/DailyStackCard';\nimport { ProductCard } from '../cards/ProductCard';\nimport { WeakPointCard } from '../cards/WeakPointCard';\nimport { ProgressComparisonCard } from '../cards/ProgressComparisonCard';\nimport { MedicalPrescriptionCard } from '../cards/MedicalPrescriptionCard';\nimport { generateDailyStack } from '@/lib/daily-stack';\nimport { getProductRecommendations } from '@/lib/product-recommendations';\nimport { SUPPLEMENTS } from '@/lib/recommendations/supplements';\nimport {\n  TreatmentConflictList,\n  SelectionWarningModal,\n} from '../cards/TreatmentConflictWarning';\nimport {\n  findTreatmentConflicts,\n  type TreatmentConflict,\n} from '@/lib/recommendations/engine';\n\n// ============================================\n// POTENTIAL SCORE CARD\n// ============================================\n\nfunction PotentialScoreCard() {\n  const { overallScore, recommendations } = useResults();\n  const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n\n  // Calculate potential improvement\n  const potentialImprovement = useMemo(() => {\n    if (recommendations.length === 0) return 0;\n    const totalImpact = recommendations.slice(0, 5).reduce((sum, r) => sum + (r.impact || 0), 0);\n    return Math.min(totalImpact * 1.5, 10 - numericScore);\n  }, [recommendations, numericScore]);\n\n  const potentialScore = Math.min(10, numericScore + potentialImprovement);\n\n  return (\n    <motion.div\n      className=\"bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-2xl p-6\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-center gap-2 mb-4\">\n        <Sparkles size={20} className=\"text-cyan-400\" />\n        <h3 className=\"font-semibold text-white\">Your Potential</h3>\n      </div>\n\n      <div className=\"flex items-center justify-center gap-8 mb-6\">\n        {/* Current */}\n        <div className=\"text-center\">\n          <p className=\"text-xs text-neutral-500 mb-2\">Current</p>\n          <ScoreCircle score={overallScore} size=\"lg\" animate={false} />\n        </div>\n\n        {/* Arrow */}\n        <div className=\"flex flex-col items-center gap-1\">\n          <ChevronRight size={24} className=\"text-cyan-400\" />\n          <span className=\"text-xs text-green-400\">+{potentialImprovement.toFixed(1)}</span>\n        </div>\n\n        {/* Potential */}\n        <div className=\"text-center\">\n          <p className=\"text-xs text-neutral-500 mb-2\">Potential</p>\n          <div className=\"relative\">\n            <ScoreCircle score={potentialScore} size=\"lg\" animate={false} />\n            <div className=\"absolute -top-1 -right-1 w-5 h-5 bg-green-500 rounded-full flex items-center justify-center\">\n              <TrendingUp size={12} className=\"text-black\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <p className=\"text-sm text-neutral-400 text-center\">\n        Following our recommendations could improve your harmony score by up to{' '}\n        <span className=\"text-green-400 font-medium\">+{potentialImprovement.toFixed(1)} points</span>\n      </p>\n    </motion.div>\n  );\n}\n\n// ============================================\n// PHASE FILTER\n// ============================================\n\ninterface PhaseFilterProps {\n  selectedPhase: RecommendationPhase | null;\n  onSelect: (phase: RecommendationPhase | null) => void;\n  counts: Record<RecommendationPhase, number>;\n}\n\nfunction PhaseFilter({ selectedPhase, onSelect, counts }: PhaseFilterProps) {\n  const phases: RecommendationPhase[] = ['Foundational', 'Minimally Invasive', 'Surgical'];\n\n  return (\n    <div className=\"flex flex-wrap gap-2\">\n      <button\n        onClick={() => onSelect(null)}\n        className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all ${selectedPhase === null\n          ? 'bg-cyan-500 text-black'\n          : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n          }`}\n      >\n        All ({Object.values(counts).reduce((a, b) => a + b, 0)})\n      </button>\n      {phases.map(phase => (\n        <button\n          key={phase}\n          onClick={() => onSelect(phase)}\n          className={`px-3 py-1.5 rounded-lg text-sm font-medium transition-all flex items-center gap-2 ${selectedPhase === phase\n            ? 'bg-neutral-700 text-white'\n            : 'bg-neutral-800 text-neutral-400 hover:bg-neutral-700'\n            }`}\n        >\n          <PhaseBadge phase={phase} size=\"sm\" />\n          ({counts[phase] || 0})\n        </button>\n      ))}\n    </div>\n  );\n}\n\n// ============================================\n// BEFORE/AFTER PREVIEW SECTION WITH MORPHING\n// ============================================\n\ntype PreviewMode = 'static' | 'morphing';\n\nfunction BeforeAfterPreviewSection() {\n  const { frontPhoto, overallScore, recommendations, frontLandmarks } = useResults();\n  const [previewMode, setPreviewMode] = useState<PreviewMode>('morphing');\n  const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n\n  // Calculate potential improvement\n  const potentialImprovement = useMemo(() => {\n    if (recommendations.length === 0) return 0;\n    const totalImpact = recommendations.slice(0, 5).reduce((sum, r) => sum + r.impact, 0);\n    return Math.min(totalImpact * 1.5, 10 - numericScore);\n  }, [recommendations, numericScore]);\n\n  const potentialScore = Math.min(10, numericScore + potentialImprovement);\n\n  if (!frontPhoto) return null;\n\n  return (\n    <div className=\"space-y-3\">\n      {/* Mode Toggle */}\n      <div className=\"flex items-center justify-center gap-1 p-1 bg-black/40 rounded-lg border border-white/10\">\n        <button\n          onClick={() => setPreviewMode('morphing')}\n          className={`flex-1 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${\n            previewMode === 'morphing'\n              ? 'bg-cyan-500/20 text-cyan-400'\n              : 'text-neutral-500 hover:text-white'\n          }`}\n        >\n          Face Morphing\n        </button>\n        <button\n          onClick={() => setPreviewMode('static')}\n          className={`flex-1 px-3 py-1.5 rounded-md text-xs font-medium transition-all ${\n            previewMode === 'static'\n              ? 'bg-neutral-700 text-white'\n              : 'text-neutral-500 hover:text-white'\n          }`}\n        >\n          Static Preview\n        </button>\n      </div>\n\n      {/* Preview Component */}\n      <AnimatePresence mode=\"wait\">\n        {previewMode === 'morphing' && frontLandmarks.length > 0 ? (\n          <motion.div\n            key=\"morphing\"\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: 20 }}\n            transition={{ duration: 0.2 }}\n          >\n            <FaceMorphing\n              photo={frontPhoto}\n              frontLandmarks={frontLandmarks}\n              currentScore={numericScore}\n              potentialScore={potentialScore}\n              recommendations={recommendations}\n            />\n          </motion.div>\n        ) : (\n          <motion.div\n            key=\"static\"\n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: -20 }}\n            transition={{ duration: 0.2 }}\n          >\n            <BeforeAfterPreview\n              photo={frontPhoto}\n              currentScore={numericScore}\n              potentialScore={potentialScore}\n              recommendations={recommendations}\n            />\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// ORDER OF OPERATIONS\n// ============================================\n\nfunction OrderOfOperations() {\n  return (\n    <div className=\"bg-neutral-900/50 border border-neutral-800 rounded-xl p-4\">\n      <h4 className=\"font-medium text-white mb-3 flex items-center gap-2\">\n        <Target size={16} className=\"text-cyan-400\" />\n        Recommended Order\n      </h4>\n      <div className=\"space-y-3\">\n        <div className=\"flex items-start gap-3\">\n          <div className=\"w-6 h-6 rounded-full bg-green-500/20 flex items-center justify-center flex-shrink-0 mt-0.5\">\n            <span className=\"text-xs font-bold text-green-400\">1</span>\n          </div>\n          <div>\n            <p className=\"text-sm font-medium text-white\">Start with Foundational</p>\n            <p className=\"text-xs text-neutral-500\">Low-cost, no-risk improvements that anyone can do</p>\n          </div>\n        </div>\n        <div className=\"flex items-start gap-3\">\n          <div className=\"w-6 h-6 rounded-full bg-yellow-500/20 flex items-center justify-center flex-shrink-0 mt-0.5\">\n            <span className=\"text-xs font-bold text-yellow-400\">2</span>\n          </div>\n          <div>\n            <p className=\"text-sm font-medium text-white\">Consider Minimally Invasive</p>\n            <p className=\"text-xs text-neutral-500\">Temporary or reversible options with moderate impact</p>\n          </div>\n        </div>\n        <div className=\"flex items-start gap-3\">\n          <div className=\"w-6 h-6 rounded-full bg-red-500/20 flex items-center justify-center flex-shrink-0 mt-0.5\">\n            <span className=\"text-xs font-bold text-red-400\">3</span>\n          </div>\n          <div>\n            <p className=\"text-sm font-medium text-white\">Evaluate Surgical Options</p>\n            <p className=\"text-xs text-neutral-500\">Permanent solutions for significant improvements</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// YOUR PHASE CARD (Body Composition Phase)\n// ============================================\n\ntype BodyPhase = 'bulk' | 'cut' | 'maintain';\n\ninterface YourPhaseCardProps {\n  bodyFatPercent?: number;\n  gender: 'male' | 'female';\n}\n\nfunction YourPhaseCard({ bodyFatPercent, gender }: YourPhaseCardProps) {\n  // Determine phase based on body fat and gender\n  const getPhase = (): { phase: BodyPhase; message: string; color: string; icon: React.ReactNode } => {\n    if (!bodyFatPercent) {\n      return {\n        phase: 'maintain',\n        message: 'Complete your physique analysis to get personalized phase recommendations.',\n        color: 'from-neutral-700 to-neutral-800',\n        icon: <Scale size={24} className=\"text-neutral-400\" />,\n      };\n    }\n\n    // Male thresholds: <12% = bulk, 12-18% = maintain, >18% = cut\n    // Female thresholds: <18% = bulk, 18-25% = maintain, >25% = cut\n    const bulkThreshold = gender === 'male' ? 12 : 18;\n    const cutThreshold = gender === 'male' ? 18 : 25;\n\n    if (bodyFatPercent < bulkThreshold) {\n      return {\n        phase: 'bulk',\n        message: `At ${bodyFatPercent.toFixed(1)}% body fat, you're lean enough to build muscle. Focus on a slight caloric surplus with progressive overload.`,\n        color: 'from-green-600 to-emerald-700',\n        icon: <Dumbbell size={24} className=\"text-white\" />,\n      };\n    } else if (bodyFatPercent > cutThreshold) {\n      return {\n        phase: 'cut',\n        message: `At ${bodyFatPercent.toFixed(1)}% body fat, prioritize fat loss. A moderate caloric deficit with high protein will reveal your facial structure.`,\n        color: 'from-orange-600 to-red-700',\n        icon: <Salad size={24} className=\"text-white\" />,\n      };\n    } else {\n      return {\n        phase: 'maintain',\n        message: `At ${bodyFatPercent.toFixed(1)}% body fat, you're in the optimal range. Focus on body recomposition to build muscle while staying lean.`,\n        color: 'from-blue-600 to-cyan-700',\n        icon: <Scale size={24} className=\"text-white\" />,\n      };\n    }\n  };\n\n  const { phase, message, color, icon } = getPhase();\n  const phaseLabels: Record<BodyPhase, string> = {\n    bulk: 'Lean Bulk Phase',\n    cut: 'Cutting Phase',\n    maintain: 'Maintenance Phase',\n  };\n\n  return (\n    <motion.div\n      className={`bg-gradient-to-br ${color} rounded-2xl p-6 border border-white/10`}\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-start gap-4\">\n        <div className=\"w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center flex-shrink-0\">\n          {icon}\n        </div>\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h3 className=\"font-semibold text-white text-lg\">Your Phase</h3>\n            <div className=\"px-2 py-0.5 bg-white/20 rounded-full text-xs font-medium text-white\">\n              {phaseLabels[phase]}\n            </div>\n          </div>\n          <p className=\"text-sm text-white/80 mb-4\">{message}</p>\n\n          {/* Phase-specific tips */}\n          <div className=\"grid grid-cols-3 gap-2\">\n            <div className=\"bg-black/20 rounded-lg p-2 text-center\">\n              <div className=\"flex items-center justify-center gap-1 mb-0.5\">\n                {phase === 'bulk' ? (\n                  <ArrowUp size={12} className=\"text-green-300\" />\n                ) : phase === 'cut' ? (\n                  <ArrowDown size={12} className=\"text-orange-300\" />\n                ) : (\n                  <Minus size={12} className=\"text-blue-300\" />\n                )}\n                <span className=\"text-xs text-white/60\">Calories</span>\n              </div>\n              <span className=\"text-sm font-medium text-white\">\n                {phase === 'bulk' ? '+300' : phase === 'cut' ? '-500' : '±0'}\n              </span>\n            </div>\n            <div className=\"bg-black/20 rounded-lg p-2 text-center\">\n              <span className=\"text-xs text-white/60 block mb-0.5\">Protein</span>\n              <span className=\"text-sm font-medium text-white\">\n                {phase === 'cut' ? '1.2g/lb' : '1g/lb'}\n              </span>\n            </div>\n            <div className=\"bg-black/20 rounded-lg p-2 text-center\">\n              <span className=\"text-xs text-white/60 block mb-0.5\">Cardio</span>\n              <span className=\"text-sm font-medium text-white\">\n                {phase === 'bulk' ? 'Minimal' : phase === 'cut' ? '4-5x/wk' : '2-3x/wk'}\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// PRODUCT BUNDLE CTA\n// ============================================\n\ninterface ProductBundleCardProps {\n  products: ProductRecommendation[];\n  title?: string;\n}\n\nfunction ProductBundleCard({ products, title = 'Recommended Bundle' }: ProductBundleCardProps) {\n  // Get top 3 most important products\n  const bundleProducts = products.slice(0, 3);\n\n  // Calculate total cost\n  const totalCost = bundleProducts.reduce((sum, rec) => {\n    const supplement = SUPPLEMENTS.find(s => s.id === rec.product.supplementId);\n    return sum + (supplement?.costPerMonth.min || 0);\n  }, 0);\n\n  if (bundleProducts.length === 0) return null;\n\n  return (\n    <motion.div\n      className=\"bg-gradient-to-br from-purple-900/50 to-violet-950/50 border border-purple-500/30 rounded-2xl p-6\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-center gap-2 mb-4\">\n        <Package size={20} className=\"text-purple-400\" />\n        <h3 className=\"font-semibold text-white\">{title}</h3>\n        <div className=\"ml-auto px-2 py-0.5 bg-purple-500/20 text-purple-300 text-xs font-medium rounded-full\">\n          Save 15%\n        </div>\n      </div>\n\n      <p className=\"text-sm text-neutral-300 mb-4\">\n        Your analysis recommends these {bundleProducts.length} supplements - optimized for your specific weak points.\n      </p>\n\n      {/* Bundle Items */}\n      <div className=\"space-y-2 mb-4\">\n        {bundleProducts.map((rec, index) => (\n          <div\n            key={rec.product.id}\n            className=\"flex items-center gap-3 p-2 bg-black/20 rounded-lg\"\n          >\n            <div className=\"w-6 h-6 rounded-full bg-purple-500/30 flex items-center justify-center flex-shrink-0\">\n              <span className=\"text-xs font-bold text-purple-300\">{index + 1}</span>\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-sm font-medium text-white truncate\">{rec.product.name}</p>\n              <p className=\"text-xs text-neutral-400 truncate\">Targets: {rec.targetMetric}</p>\n            </div>\n            <div className=\"text-right flex-shrink-0\">\n              <p className=\"text-sm text-white\">\n                ${SUPPLEMENTS.find(s => s.id === rec.product.supplementId)?.costPerMonth.min || 0}/mo\n              </p>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* Total & CTA */}\n      <div className=\"border-t border-purple-500/20 pt-4\">\n        <div className=\"flex items-center justify-between mb-3\">\n          <span className=\"text-neutral-400\">Bundle Total</span>\n          <div className=\"text-right\">\n            <span className=\"text-lg font-bold text-white\">${totalCost}/mo</span>\n            <span className=\"text-xs text-neutral-500 ml-2 line-through\">${Math.round(totalCost * 1.15)}/mo</span>\n          </div>\n        </div>\n        <button\n          className=\"w-full flex items-center justify-center gap-2 py-3 bg-gradient-to-r from-purple-500 to-violet-600 text-white font-medium rounded-lg hover:opacity-90 transition-opacity\"\n        >\n          <ShoppingCart size={18} />\n          Get Your Bundle\n        </button>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// PLAN TAB\n// ============================================\n\nexport function PlanTab() {\n  const { recommendations, flaws, gender, ethnicity, frontRatios, sideRatios, overallScore, frontPhoto, vision, isUnlocked } = useResults();\n  const { user } = useAuth();\n  const physiqueContext = usePhysiqueOptional();\n  const [selectedPhase, setSelectedPhase] = useState<RecommendationPhase | null>(null);\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [completedIds, setCompletedIds] = useState<Set<string>>(new Set());\n  const [removedIds, setRemovedIds] = useState<Set<string>>(new Set());\n  const [previousAnalysis, setPreviousAnalysis] = useState<{\n    date: string;\n    overallScore: number;\n    bodyFatPercent?: number;\n    frontPhotoUrl?: string;\n  } | null>(null);\n\n  // Treatment conflict state\n  const [dismissedConflicts, setDismissedConflicts] = useState<Set<string>>(new Set());\n  const [conflictModal, setConflictModal] = useState<{\n    isOpen: boolean;\n    conflict: TreatmentConflict | null;\n    newTreatmentId: string;\n  }>({ isOpen: false, conflict: null, newTreatmentId: '' });\n\n  const { openPricingModal } = usePricing();\n\n  // Convert to number for arithmetic operations\n  const numericOverallScore = typeof overallScore === 'number' ? overallScore : 0;\n\n  // Check if user has a paid plan\n  const hasPaidPlan = user?.plan === 'basic' || user?.plan === 'pro';\n\n  // Get body fat from physique analysis\n  const bodyFatPercent = physiqueContext?.physiqueAnalysis?.bodyFatPercent;\n\n  // Generate Daily Stack for all users\n  const dailyStack = useMemo(() => {\n    return generateDailyStack(gender);\n  }, [gender]);\n\n  // Generate Product Recommendations based on metrics\n  const productRecommendations = useMemo(() => {\n    // Build metrics and severity dictionaries from ratios\n    const metricsDict: Record<string, number> = {};\n    const severityDict: Record<string, string> = {};\n\n    [...frontRatios, ...sideRatios].forEach(ratio => {\n      metricsDict[ratio.name] = typeof ratio.value === 'number' ? ratio.value : 0;\n      severityDict[ratio.name] = ratio.severity;\n    });\n\n    return getProductRecommendations(metricsDict, severityDict, gender, ethnicity);\n  }, [frontRatios, sideRatios, gender, ethnicity]);\n\n  // Split product recommendations by state\n  const { flawProducts, idealProducts } = useMemo(() => {\n    const flaw = productRecommendations.filter(r => r.state === 'flaw');\n    const ideal = productRecommendations.filter(r => r.state === 'ideal');\n    return { flawProducts: flaw, idealProducts: ideal };\n  }, [productRecommendations]);\n\n  // Map flaws to products and treatments\n  const flawsWithProducts = useMemo(() => {\n    return flaws.slice(0, 5).map(flaw => {\n      // Find products that target metrics related to this flaw\n      const relatedProducts = productRecommendations.filter(rec =>\n        flaw && flaw.responsibleRatios && flaw.responsibleRatios.some(ratio =>\n          rec.matchedMetrics.some(metric =>\n            metric.toLowerCase().includes(ratio.ratioName.toLowerCase()) ||\n            ratio.ratioName.toLowerCase().includes(metric.toLowerCase())\n          )\n        )\n      );\n\n      // Find treatments that match this flaw\n      const relatedTreatments = recommendations.filter(rec =>\n        rec.matchedFlaws.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase()))\n      );\n\n      return {\n        flaw,\n        products: relatedProducts.slice(0, 2),\n        treatments: relatedTreatments.slice(0, 3),\n      };\n    });\n  }, [flaws, productRecommendations, recommendations]);\n\n  // Handle progress photo upload\n  const handleProgressPhotoUpload = useCallback(async (file: File) => {\n    // Store current analysis as previous before re-analyzing\n    const numScore = typeof overallScore === 'number' ? overallScore : 0;\n    setPreviousAnalysis({\n      date: new Date().toISOString(),\n      overallScore: numScore,\n      bodyFatPercent,\n      frontPhotoUrl: frontPhoto || undefined,\n    });\n\n    // In a real implementation, this would upload to API and trigger re-analysis\n    console.log('Progress photo uploaded:', file.name);\n  }, [overallScore, bodyFatPercent, frontPhoto]);\n\n  // Count recommendations by phase\n  const phaseCounts = useMemo(() => {\n    const counts: Record<RecommendationPhase, number> = {\n      'Foundational': 0,\n      'Minimally Invasive': 0,\n      'Surgical': 0,\n    };\n    recommendations.forEach(r => {\n      if (!removedIds.has(r.ref_id)) {\n        counts[r.phase]++;\n      }\n    });\n    return counts;\n  }, [recommendations, removedIds]);\n\n  // Filter recommendations\n  const filteredRecommendations = useMemo(() => {\n    let filtered = recommendations.filter(r => !removedIds.has(r.ref_id));\n    if (selectedPhase) {\n      filtered = filtered.filter(r => r.phase === selectedPhase);\n    }\n    return filtered;\n  }, [recommendations, selectedPhase, removedIds]);\n\n  const hasRecommendations = filteredRecommendations.length > 0;\n\n  // Detect treatment conflicts in current recommendations\n  const treatmentConflicts = useMemo(() => {\n    const selectedIds = filteredRecommendations.map(r => r.ref_id);\n    const nameMap = Object.fromEntries(\n      filteredRecommendations.map(r => [r.ref_id, r.name])\n    );\n    const conflicts = findTreatmentConflicts(selectedIds, nameMap);\n\n    // Filter out dismissed conflicts\n    return conflicts.filter(c => {\n      const conflictKey = `${c.treatment1Id}-${c.treatment2Id}`;\n      return !dismissedConflicts.has(conflictKey);\n    });\n  }, [filteredRecommendations, dismissedConflicts]);\n\n  // Handle dismissing a conflict\n  const handleDismissConflict = useCallback((conflict: TreatmentConflict) => {\n    const conflictKey = `${conflict.treatment1Id}-${conflict.treatment2Id}`;\n    setDismissedConflicts(prev => new Set(Array.from(prev).concat(conflictKey)));\n  }, []);\n\n  // Handle dismissing all conflicts\n  const handleDismissAllConflicts = useCallback(() => {\n    const allKeys = treatmentConflicts.map(\n      c => `${c.treatment1Id}-${c.treatment2Id}`\n    );\n    setDismissedConflicts(prev => new Set(Array.from(prev).concat(allKeys)));\n  }, [treatmentConflicts]);\n\n  // Handle conflict modal actions\n  const handleConflictProceed = useCallback(() => {\n    if (conflictModal.conflict) {\n      // Remove the lower priority (existing) treatment\n      setRemovedIds(prev => new Set(Array.from(prev).concat(conflictModal.conflict!.treatment1Id)));\n    }\n    setConflictModal({ isOpen: false, conflict: null, newTreatmentId: '' });\n  }, [conflictModal.conflict]);\n\n  const handleConflictCancel = useCallback(() => {\n    setConflictModal({ isOpen: false, conflict: null, newTreatmentId: '' });\n  }, []);\n\n  // Handle mark complete\n  const handleMarkComplete = useCallback((id: string) => {\n    setCompletedIds(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(id)) {\n        newSet.delete(id);\n      } else {\n        newSet.add(id);\n      }\n      return newSet;\n    });\n  }, []);\n\n  // Handle remove\n  const handleRemove = useCallback((id: string) => {\n    setRemovedIds(prev => {\n      const newSet = new Set(prev);\n      newSet.add(id);\n      return newSet;\n    });\n    if (expandedId === id) {\n      setExpandedId(null);\n    }\n  }, [expandedId]);\n\n  return (\n    <TabContent\n      title=\"Your Plan & Potential\"\n      subtitle=\"Personalized recommendations based on your analysis\"\n    >\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-6\">\n        {/* Main Content */}\n        <div className=\"lg:col-span-2 space-y-6\">\n          {/* Your Phase Card - Body Composition Phase */}\n          <YourPhaseCard bodyFatPercent={bodyFatPercent} gender={gender} />\n\n          {/* Daily Stack Card - Hero Element for ALL users */}\n          {dailyStack && <DailyStackCard dailyStack={dailyStack} />}\n\n          {/* Potential Score */}\n          <PotentialScoreCard />\n\n          {/* Fix Your Weak Points Section */}\n          {flawsWithProducts.length > 0 && (\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center gap-2\">\n                <AlertCircle size={20} className=\"text-red-400\" />\n                <h3 className=\"text-lg font-semibold text-white\">Fix Your Weak Points</h3>\n                <span className=\"px-2 py-0.5 bg-red-500/20 text-red-400 text-xs rounded-full border border-red-500/30\">\n                  {flawsWithProducts.length} Issues\n                </span>\n              </div>\n              <div className=\"space-y-3\">\n                {flawsWithProducts.map((item, index) => (\n                  <WeakPointCard\n                    key={item.flaw.id}\n                    flaw={item.flaw}\n                    rank={index + 1}\n                    products={item.products}\n                    treatments={item.treatments}\n                    onViewTreatment={(treatment) => setExpandedId(treatment.ref_id)}\n                  />\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Targeted Product Recommendations - Corrective */}\n          {flawProducts.length > 0 && (\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center gap-2\">\n                <Package size={20} className=\"text-cyan-400\" />\n                <h3 className=\"text-lg font-semibold text-white\">Recommended Products</h3>\n                <span className=\"px-2 py-0.5 bg-cyan-500/20 text-cyan-400 text-xs rounded-full border border-cyan-500/30\">\n                  Corrective\n                </span>\n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {flawProducts.slice(0, 6).map((rec, index) => (\n                  <ProductCard key={rec.product.id} recommendation={rec} rank={index + 1} />\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Targeted Product Recommendations - Maintenance */}\n          {idealProducts.length > 0 && (\n            <div className=\"space-y-4\">\n              <div className=\"flex items-center gap-2\">\n                <CheckCircle2 size={20} className=\"text-green-400\" />\n                <h3 className=\"text-lg font-semibold text-white\">Protect Your Strengths</h3>\n                <span className=\"px-2 py-0.5 bg-green-500/20 text-green-400 text-xs rounded-full border border-green-500/30\">\n                  Maintenance\n                </span>\n              </div>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {idealProducts.slice(0, 4).map((rec) => (\n                  <ProductCard key={rec.product.id} recommendation={rec} />\n                ))}\n              </div>\n            </div>\n          )}\n\n          {/* Treatment Timeline */}\n          {recommendations.length > 0 && (\n            <TreatmentTimeline recommendations={recommendations.filter(r => !removedIds.has(r.ref_id))} />\n          )}\n\n          {/* Treatment Conflict Warnings */}\n          {treatmentConflicts.length > 0 && (\n            <TreatmentConflictList\n              conflicts={treatmentConflicts}\n              onDismiss={handleDismissConflict}\n              onDismissAll={handleDismissAllConflicts}\n            />\n          )}\n\n          {/* Phase Filter */}\n          <PhaseFilter\n            selectedPhase={selectedPhase}\n            onSelect={setSelectedPhase}\n            counts={phaseCounts}\n          />\n\n          {/* Recommendations List */}\n          {hasRecommendations ? (\n            <motion.div className=\"space-y-4\" layout>\n              <AnimatePresence mode=\"popLayout\">\n                {filteredRecommendations.map((rec, index) => (\n                  <motion.div\n                    key={rec.ref_id}\n                    layout\n                    initial={{ opacity: 0, y: 20 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    exit={{ opacity: 0, y: -20 }}\n                    transition={{ duration: 0.2, delay: index * 0.05 }}\n                  >\n                    <EnhancedRecommendationCard\n                      recommendation={rec}\n                      rank={index + 1}\n                      isExpanded={expandedId === rec.ref_id}\n                      onToggle={() => setExpandedId(\n                        expandedId === rec.ref_id ? null : rec.ref_id\n                      )}\n                      onMarkComplete={handleMarkComplete}\n                      onRemove={handleRemove}\n                      isCompleted={completedIds.has(rec.ref_id)}\n                      gender={gender}\n                      ethnicity={ethnicity}\n                    />\n                  </motion.div>\n                ))}\n              </AnimatePresence>\n            </motion.div>\n          ) : (\n            <div className=\"bg-neutral-900/50 border border-neutral-800 rounded-xl p-8 text-center\">\n              <Sparkles size={48} className=\"mx-auto text-neutral-700 mb-4\" />\n              <h3 className=\"text-lg font-medium text-white mb-2\">No Recommendations Yet</h3>\n              <p className=\"text-neutral-500 mb-4\">\n                Complete a facial analysis to get personalized recommendations\n              </p>\n            </div>\n          )}\n        </div>\n\n        {/* Sidebar */}\n        <div className=\"space-y-6\">\n          {/* Medical Prescription Card (Dental) */}\n          {vision?.teeth && (\n            <MedicalPrescriptionCard vision={vision} isUnlocked={isUnlocked} />\n          )}\n\n          {/* Progress Comparison Card */}\n          <ProgressComparisonCard\n            currentAnalysis={{\n              date: new Date().toISOString(),\n              overallScore: numericOverallScore,\n              bodyFatPercent,\n              frontPhotoUrl: frontPhoto || undefined,\n            }}\n            previousAnalysis={previousAnalysis}\n            onUploadNewPhoto={handleProgressPhotoUpload}\n          />\n\n          {/* Product Bundle CTA */}\n          {flawProducts.length >= 3 && (\n            <ProductBundleCard\n              products={flawProducts}\n              title=\"Your Fix Bundle\"\n            />\n          )}\n\n          {/* Before/After Preview */}\n          <BeforeAfterPreviewSection />\n\n          {/* Order of Operations */}\n          <OrderOfOperations />\n\n          {/* My Plan Summary */}\n          <div className=\"bg-neutral-900/50 border border-neutral-800 rounded-xl p-4\">\n            <h4 className=\"font-medium text-white mb-3 flex items-center gap-2\">\n              <Zap size={16} className=\"text-yellow-400\" />\n              My Plan\n            </h4>\n            <div className=\"text-center py-6\">\n              <div className=\"w-12 h-12 mx-auto mb-3 rounded-xl bg-neutral-800 flex items-center justify-center\">\n                <Lock size={20} className=\"text-neutral-600\" />\n              </div>\n              <p className=\"text-sm text-neutral-500 mb-3\">\n                Add recommendations to build your personalized plan\n              </p>\n              <p className=\"text-xs text-neutral-600\">\n                0 items selected\n              </p>\n            </div>\n          </div>\n\n          {/* Issues Summary */}\n          <div className=\"bg-neutral-900/50 border border-neutral-800 rounded-xl p-4\">\n            <h4 className=\"font-medium text-white mb-3\">Detected Issues</h4>\n            <div className=\"space-y-2\">\n              {flaws.slice(0, 5).map(flaw => (\n                <div\n                  key={flaw.id}\n                  className=\"flex items-center justify-between p-2 bg-neutral-800/50 rounded-lg\"\n                >\n                  <span className=\"text-sm text-neutral-300 truncate\">{flaw.flawName}</span>\n                  <span className=\"text-xs text-red-400 flex-shrink-0\">\n                    -{flaw.harmonyPercentageLost.toFixed(1)}%\n                  </span>\n                </div>\n              ))}\n              {flaws.length === 0 && (\n                <p className=\"text-sm text-neutral-500 text-center py-4\">\n                  No issues detected\n                </p>\n              )}\n            </div>\n          </div>\n\n          {/* Upgrade CTA or Premium Badge */}\n          {hasPaidPlan ? (\n            <motion.div\n              className=\"bg-gradient-to-br from-green-500/10 to-emerald-600/10 border border-green-500/30 rounded-xl p-4\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.3 }}\n            >\n              <div className=\"flex items-center gap-2 mb-2\">\n                <CheckCircle size={16} className=\"text-green-400\" />\n                <span className=\"text-sm font-medium text-white\">\n                  {user?.plan === 'pro' ? 'Pro Plan' : 'Basic Plan'} Active\n                </span>\n              </div>\n              <p className=\"text-xs text-neutral-400\">\n                You have full access to all {user?.plan === 'pro' ? 'features' : 'non-surgical recommendations'}.\n              </p>\n            </motion.div>\n          ) : (\n            <motion.div\n              className=\"bg-gradient-to-br from-cyan-500/10 to-blue-600/10 border border-cyan-500/30 rounded-xl p-4\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.3 }}\n            >\n              <div className=\"flex items-center gap-2 mb-2\">\n                <Sparkles size={16} className=\"text-cyan-400\" />\n                <span className=\"text-sm font-medium text-white\">Unlock Full Plan</span>\n              </div>\n              <p className=\"text-xs text-neutral-400 mb-3\">\n                Get detailed treatment guides, cost estimates, and provider recommendations.\n              </p>\n              <button\n                onClick={() => openPricingModal('plan_sidebar')}\n                className=\"block w-full py-2 bg-cyan-500 text-black text-sm font-medium rounded-lg text-center hover:bg-cyan-400 transition-colors\"\n              >\n                Upgrade Now\n              </button>\n            </motion.div>\n          )}\n        </div>\n      </div>\n\n      {/* Treatment Conflict Modal */}\n      <SelectionWarningModal\n        isOpen={conflictModal.isOpen}\n        onClose={handleConflictCancel}\n        conflict={conflictModal.conflict || {\n          treatment1Id: '',\n          treatment1Name: '',\n          treatment2Id: '',\n          treatment2Name: '',\n          reason: '',\n        }}\n        onProceed={handleConflictProceed}\n        onCancel={handleConflictCancel}\n      />\n    </TabContent>\n  );\n}\n"}}
{"parentUuid":"57d5e0b8-9118-4ae9-92f0-84e941f685dc","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_01GZ5D8wpEsyWMzLU57VHpSR","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me verify the file compiles correctly by running TypeScript check:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":27536,"cache_read_input_tokens":56452,"cache_creation":{"ephemeral_5m_input_tokens":27536,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVwoCtBiKVotsvhQAqCg","type":"assistant","uuid":"0fcbce8b-aa9f-4f31-95fa-c1e1e8bd4396","timestamp":"2025-12-26T20:40:39.398Z"}
{"parentUuid":"0fcbce8b-aa9f-4f31-95fa-c1e1e8bd4396","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_01GZ5D8wpEsyWMzLU57VHpSR","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01KipAfHfRzNzxT6s6bQC6wg","name":"Bash","input":{"command":"npx tsc --noEmit --skipLibCheck 2>&1 | head -50","description":"Check TypeScript compilation","timeout":60000}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":27536,"cache_read_input_tokens":56452,"cache_creation":{"ephemeral_5m_input_tokens":27536,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVwoCtBiKVotsvhQAqCg","type":"assistant","uuid":"284317a0-1bf3-4f00-ad5f-c31d580857b0","timestamp":"2025-12-26T20:40:41.231Z"}
{"parentUuid":"284317a0-1bf3-4f00-ad5f-c31d580857b0","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01KipAfHfRzNzxT6s6bQC6wg","type":"tool_result","content":"","is_error":false}]},"uuid":"a6670aa6-3b1a-4210-8015-d2fd9489ef6d","timestamp":"2025-12-26T20:40:43.399Z","toolUseResult":{"stdout":"","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"a6670aa6-3b1a-4210-8015-d2fd9489ef6d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NQeh23QrFHxJn5P9EMtv5Q","type":"message","role":"assistant","content":[{"type":"text","text":"The file compiles without errors. Let me also run a quick lint check:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":152,"cache_read_input_tokens":83988,"cache_creation":{"ephemeral_5m_input_tokens":152,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVwpCtiLpe2aJzigaD9v","type":"assistant","uuid":"2661c516-b89c-4405-859d-586d4fe70755","timestamp":"2025-12-26T20:40:46.426Z"}
{"parentUuid":"2661c516-b89c-4405-859d-586d4fe70755","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NQeh23QrFHxJn5P9EMtv5Q","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Bdx7PLPy73mD9YnsuKVud2","name":"Bash","input":{"command":"npm run lint -- --quiet 2>&1 | head -30","description":"Check ESLint for errors","timeout":60000}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":152,"cache_read_input_tokens":83988,"cache_creation":{"ephemeral_5m_input_tokens":152,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVwpCtiLpe2aJzigaD9v","type":"assistant","uuid":"84394c2a-3a06-4162-bbd5-b6b79f1311df","timestamp":"2025-12-26T20:40:48.194Z"}
{"parentUuid":"84394c2a-3a06-4162-bbd5-b6b79f1311df","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Bdx7PLPy73mD9YnsuKVud2","type":"tool_result","content":"> looksmaxx-app@0.1.0 lint\n> next lint --quiet\n\n\n./src/components/results/tabs/PlanTab.tsx\n13:3  Error: 'AlertCircle' is defined but never used.  @typescript-eslint/no-unused-vars\n14:3  Error: 'CheckCircle2' is defined but never used.  @typescript-eslint/no-unused-vars\n\ninfo  - Need to disable some ESLint rules? Learn more here: https://nextjs.org/docs/basic-features/eslint#disabling-rules","is_error":false}]},"uuid":"c695351a-b13d-44e3-bbf4-28954ed8d9f3","timestamp":"2025-12-26T20:40:50.114Z","toolUseResult":{"stdout":"> looksmaxx-app@0.1.0 lint\n> next lint --quiet\n\n\n./src/components/results/tabs/PlanTab.tsx\n13:3  Error: 'AlertCircle' is defined but never used.  @typescript-eslint/no-unused-vars\n14:3  Error: 'CheckCircle2' is defined but never used.  @typescript-eslint/no-unused-vars\n\ninfo  - Need to disable some ESLint rules? Learn more here: https://nextjs.org/docs/basic-features/eslint#disabling-rules","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"c695351a-b13d-44e3-bbf4-28954ed8d9f3","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_01LMY8nUv23kn1Rham7AAsih","type":"message","role":"assistant","content":[{"type":"text","text":"Let me fix the unused imports:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":373,"cache_read_input_tokens":84140,"cache_creation":{"ephemeral_5m_input_tokens":373,"ephemeral_1h_input_tokens":0},"output_tokens":2,"service_tier":"standard"}},"requestId":"req_011CWVwphZdkriB1bJ1JGN5B","type":"assistant","uuid":"3b30f7a7-54b0-4eb2-8661-dbaaf9217fd4","timestamp":"2025-12-26T20:40:53.578Z"}
{"parentUuid":"3b30f7a7-54b0-4eb2-8661-dbaaf9217fd4","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_01LMY8nUv23kn1Rham7AAsih","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018j8aD35YYXkHdHV7HVd7HH","name":"Edit","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/PlanTab.tsx","old_string":"import {\n  Sparkles,\n  TrendingUp,\n  Target,\n  Zap,\n  ChevronRight,\n  Lock,\n  CheckCircle,\n  AlertCircle,\n  CheckCircle2,\n  Scale,\n  Dumbbell,\n  Salad,\n  ArrowDown,\n  ArrowUp,\n  Minus,\n  Package,\n  ShoppingCart,\n} from 'lucide-react';","new_string":"import {\n  Sparkles,\n  TrendingUp,\n  Target,\n  Zap,\n  ChevronRight,\n  Lock,\n  CheckCircle,\n  Scale,\n  Dumbbell,\n  Salad,\n  ArrowDown,\n  ArrowUp,\n  Minus,\n  Package,\n  ShoppingCart,\n} from 'lucide-react';"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":373,"cache_read_input_tokens":84140,"cache_creation":{"ephemeral_5m_input_tokens":373,"ephemeral_1h_input_tokens":0},"output_tokens":334,"service_tier":"standard"}},"requestId":"req_011CWVwphZdkriB1bJ1JGN5B","type":"assistant","uuid":"add63b77-be0a-4d44-a176-5c5d3699f657","timestamp":"2025-12-26T20:40:57.917Z"}
{"parentUuid":"add63b77-be0a-4d44-a176-5c5d3699f657","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018j8aD35YYXkHdHV7HVd7HH","type":"tool_result","content":"The file /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/PlanTab.tsx has been updated. Here's the result of running `cat -n` on a snippet of the edited file:\n     1→'use client';\n     2→\n     3→import { useState, useMemo, useCallback } from 'react';\n     4→import { motion, AnimatePresence } from 'framer-motion';\n     5→import {\n     6→  Sparkles,\n     7→  TrendingUp,\n     8→  Target,\n     9→  Zap,\n    10→  ChevronRight,\n    11→  Lock,\n    12→  CheckCircle,\n    13→  Scale,\n    14→  Dumbbell,\n    15→  Salad,\n    16→  ArrowDown,\n    17→  ArrowUp,\n    18→  Minus,\n    19→  Package,\n    20→  ShoppingCart,\n    21→} from 'lucide-react';\n    22→import { useResults } from '@/contexts/ResultsContext';\n    23→import { useAuth } from '@/contexts/AuthContext';\n    24→import { usePricing } from '@/contexts/PricingContext';\n    25→import { usePhysiqueOptional } from '@/contexts/PhysiqueContext';"}]},"uuid":"881f6588-3d6b-49cb-a87b-6adae8f4a89c","timestamp":"2025-12-26T20:40:57.973Z","toolUseResult":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/PlanTab.tsx","oldString":"import {\n  Sparkles,\n  TrendingUp,\n  Target,\n  Zap,\n  ChevronRight,\n  Lock,\n  CheckCircle,\n  AlertCircle,\n  CheckCircle2,\n  Scale,\n  Dumbbell,\n  Salad,\n  ArrowDown,\n  ArrowUp,\n  Minus,\n  Package,\n  ShoppingCart,\n} from 'lucide-react';","newString":"import {\n  Sparkles,\n  TrendingUp,\n  Target,\n  Zap,\n  ChevronRight,\n  Lock,\n  CheckCircle,\n  Scale,\n  Dumbbell,\n  Salad,\n  ArrowDown,\n  ArrowUp,\n  Minus,\n  Package,\n  ShoppingCart,\n} from 'lucide-react';","originalFile":"'use client';\n\nimport { useState, useMemo, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Sparkles,\n  TrendingUp,\n  Target,\n  Zap,\n  ChevronRight,\n  Lock,\n  CheckCircle,\n  AlertCircle,\n  CheckCircle2,\n  Scale,\n  Dumbbell,\n  Salad,\n  ArrowDown,\n  ArrowUp,\n  Minus,\n  Package,\n  ShoppingCart,\n} from 'lucide-react';\nimport { useResults } from '@/contexts/ResultsContext';\nimport { useAuth } from '@/contexts/AuthContext';\nimport { usePricing } from '@/contexts/PricingContext';\nimport { usePhysiqueOptional } from '@/contexts/PhysiqueContext';\nimport { TabContent } from '../ResultsLayout';\nimport { EnhancedRecommendationCard } from '../cards/EnhancedRecommendationCard';\nimport { ScoreCircle, PhaseBadge } from '../shared';\nimport { BeforeAfterPreview } from '../visualization/BeforeAfterPreview';\nimport { FaceMorphing } from '../visualization/FaceMorphing';\nimport { TreatmentTimeline } from '../visualization/TreatmentTimeline';\nimport { RecommendationPhase, ProductRecommendation } from '@/types/results';\nimport { DailyStackCard } from '../cards/DailyStackCard';\nimport { ProductCard } from '../cards/ProductCard';\nimport { WeakPointCard } from '../cards/WeakPointCard';\nimport { ProgressComparisonCard } from '../cards/ProgressComparisonCard';\nimport { MedicalPrescriptionCard } from '../cards/MedicalPrescriptionCard';\nimport { generateDailyStack } from '@/lib/daily-stack';\nimport { getProductRecommendations } from '@/lib/product-recommendations';\nimport { SUPPLEMENTS } from '@/lib/recommendations/supplements';\nimport {\n  TreatmentConflictList,\n  SelectionWarningModal,\n} from '../cards/TreatmentConflictWarning';\nimport {\n  findTreatmentConflicts,\n  type TreatmentConflict,\n} from '@/lib/recommendations/engine';\n\n// ============================================\n// SECTION HEADER COMPONENT\n// ============================================\n\nfunction SectionHeader({ title, children }: { title: string; children?: React.ReactNode }) {\n  return (\n    <div className=\"flex items-center gap-4 mb-6\">\n      <h2 className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 whitespace-nowrap\">\n        {title}\n      </h2>\n      <div className=\"flex-1 h-px bg-neutral-800\" />\n      {children}\n    </div>\n  );\n}\n\n// ============================================\n// POTENTIAL SCORE CARD\n// ============================================\n\nfunction PotentialScoreCard() {\n  const { overallScore, recommendations } = useResults();\n  const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n\n  // Calculate potential improvement\n  const potentialImprovement = useMemo(() => {\n    if (recommendations.length === 0) return 0;\n    const totalImpact = recommendations.slice(0, 5).reduce((sum, r) => sum + (r.impact || 0), 0);\n    return Math.min(totalImpact * 1.5, 10 - numericScore);\n  }, [recommendations, numericScore]);\n\n  const potentialScore = Math.min(10, numericScore + potentialImprovement);\n\n  return (\n    <motion.div\n      className=\"rounded-[2rem] bg-neutral-900/40 border border-white/5 p-6 md:p-8\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-center gap-3 mb-6\">\n        <div className=\"w-10 h-10 rounded-xl bg-neutral-900 border border-white/10 flex items-center justify-center\">\n          <Sparkles size={18} className=\"text-cyan-400\" />\n        </div>\n        <div>\n          <h3 className=\"text-sm font-black uppercase tracking-wider text-white\">Your Potential</h3>\n          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600\">Maximum Achievable Score</p>\n        </div>\n      </div>\n\n      <div className=\"flex items-center justify-center gap-6 md:gap-10 mb-6\">\n        {/* Current */}\n        <div className=\"text-center\">\n          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mb-3\">Current</p>\n          <ScoreCircle score={overallScore} size=\"lg\" animate={false} />\n        </div>\n\n        {/* Arrow */}\n        <div className=\"flex flex-col items-center gap-2\">\n          <ChevronRight size={28} className=\"text-cyan-400\" />\n          <span className=\"px-2 py-1 rounded-lg bg-green-500/20 border border-green-500/30 text-xs font-black uppercase tracking-wider text-green-400\">\n            +{potentialImprovement.toFixed(1)}\n          </span>\n        </div>\n\n        {/* Potential */}\n        <div className=\"text-center\">\n          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mb-3\">Potential</p>\n          <div className=\"relative\">\n            <ScoreCircle score={potentialScore} size=\"lg\" animate={false} />\n            <div className=\"absolute -top-1 -right-1 w-6 h-6 bg-green-500 rounded-lg flex items-center justify-center shadow-lg shadow-green-500/30\">\n              <TrendingUp size={14} className=\"text-black\" />\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <p className=\"text-sm text-neutral-400 text-center leading-relaxed\">\n        Following our recommendations could improve your harmony score by up to{' '}\n        <span className=\"text-green-400 font-black\">+{potentialImprovement.toFixed(1)} points</span>\n      </p>\n    </motion.div>\n  );\n}\n\n// ============================================\n// PHASE FILTER\n// ============================================\n\ninterface PhaseFilterProps {\n  selectedPhase: RecommendationPhase | null;\n  onSelect: (phase: RecommendationPhase | null) => void;\n  counts: Record<RecommendationPhase, number>;\n}\n\nfunction PhaseFilter({ selectedPhase, onSelect, counts }: PhaseFilterProps) {\n  const phases: RecommendationPhase[] = ['Foundational', 'Minimally Invasive', 'Surgical'];\n\n  return (\n    <div className=\"flex flex-wrap gap-2\">\n      <button\n        onClick={() => onSelect(null)}\n        className={`px-4 py-2 rounded-xl text-xs font-black uppercase tracking-wider transition-all border ${selectedPhase === null\n          ? 'bg-cyan-500 text-black border-cyan-400'\n          : 'bg-neutral-900/50 text-neutral-400 border-white/5 hover:border-white/10 hover:text-white'\n          }`}\n      >\n        All ({Object.values(counts).reduce((a, b) => a + b, 0)})\n      </button>\n      {phases.map(phase => (\n        <button\n          key={phase}\n          onClick={() => onSelect(phase)}\n          className={`px-4 py-2 rounded-xl text-xs font-black uppercase tracking-wider transition-all flex items-center gap-2 border ${selectedPhase === phase\n            ? 'bg-neutral-800 text-white border-white/10'\n            : 'bg-neutral-900/50 text-neutral-400 border-white/5 hover:border-white/10 hover:text-white'\n            }`}\n        >\n          <PhaseBadge phase={phase} size=\"sm\" />\n          ({counts[phase] || 0})\n        </button>\n      ))}\n    </div>\n  );\n}\n\n// ============================================\n// BEFORE/AFTER PREVIEW SECTION WITH MORPHING\n// ============================================\n\ntype PreviewMode = 'static' | 'morphing';\n\nfunction BeforeAfterPreviewSection() {\n  const { frontPhoto, overallScore, recommendations, frontLandmarks } = useResults();\n  const [previewMode, setPreviewMode] = useState<PreviewMode>('morphing');\n  const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n\n  // Calculate potential improvement\n  const potentialImprovement = useMemo(() => {\n    if (recommendations.length === 0) return 0;\n    const totalImpact = recommendations.slice(0, 5).reduce((sum, r) => sum + r.impact, 0);\n    return Math.min(totalImpact * 1.5, 10 - numericScore);\n  }, [recommendations, numericScore]);\n\n  const potentialScore = Math.min(10, numericScore + potentialImprovement);\n\n  if (!frontPhoto) return null;\n\n  return (\n    <div className=\"space-y-4\">\n      {/* Mode Toggle */}\n      <div className=\"flex items-center justify-center gap-1 p-1 bg-neutral-900/50 rounded-xl border border-white/5\">\n        <button\n          onClick={() => setPreviewMode('morphing')}\n          className={`flex-1 px-4 py-2 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${\n            previewMode === 'morphing'\n              ? 'bg-cyan-500/20 text-cyan-400 border border-cyan-500/30'\n              : 'text-neutral-500 hover:text-white border border-transparent'\n          }`}\n        >\n          Face Morphing\n        </button>\n        <button\n          onClick={() => setPreviewMode('static')}\n          className={`flex-1 px-4 py-2 rounded-lg text-[10px] font-black uppercase tracking-wider transition-all ${\n            previewMode === 'static'\n              ? 'bg-neutral-800 text-white border border-white/10'\n              : 'text-neutral-500 hover:text-white border border-transparent'\n          }`}\n        >\n          Static Preview\n        </button>\n      </div>\n\n      {/* Preview Component */}\n      <AnimatePresence mode=\"wait\">\n        {previewMode === 'morphing' && frontLandmarks.length > 0 ? (\n          <motion.div\n            key=\"morphing\"\n            initial={{ opacity: 0, x: -20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: 20 }}\n            transition={{ duration: 0.2 }}\n          >\n            <FaceMorphing\n              photo={frontPhoto}\n              frontLandmarks={frontLandmarks}\n              currentScore={numericScore}\n              potentialScore={potentialScore}\n              recommendations={recommendations}\n            />\n          </motion.div>\n        ) : (\n          <motion.div\n            key=\"static\"\n            initial={{ opacity: 0, x: 20 }}\n            animate={{ opacity: 1, x: 0 }}\n            exit={{ opacity: 0, x: -20 }}\n            transition={{ duration: 0.2 }}\n          >\n            <BeforeAfterPreview\n              photo={frontPhoto}\n              currentScore={numericScore}\n              potentialScore={potentialScore}\n              recommendations={recommendations}\n            />\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// ORDER OF OPERATIONS\n// ============================================\n\nfunction OrderOfOperations() {\n  return (\n    <div className=\"rounded-2xl bg-neutral-900/40 border border-white/5 p-5\">\n      <h4 className=\"text-xs font-black uppercase tracking-wider text-white mb-4 flex items-center gap-3\">\n        <div className=\"w-8 h-8 rounded-lg bg-neutral-900 border border-white/10 flex items-center justify-center\">\n          <Target size={14} className=\"text-cyan-400\" />\n        </div>\n        Recommended Order\n      </h4>\n      <div className=\"space-y-4\">\n        <div className=\"flex items-start gap-4\">\n          <div className=\"w-7 h-7 rounded-lg bg-green-500/20 border border-green-500/30 flex items-center justify-center flex-shrink-0 mt-0.5\">\n            <span className=\"text-xs font-black text-green-400\">1</span>\n          </div>\n          <div>\n            <p className=\"text-sm font-black uppercase tracking-wider text-white\">Start with Foundational</p>\n            <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mt-1\">Low-cost, no-risk improvements</p>\n          </div>\n        </div>\n        <div className=\"flex items-start gap-4\">\n          <div className=\"w-7 h-7 rounded-lg bg-yellow-500/20 border border-yellow-500/30 flex items-center justify-center flex-shrink-0 mt-0.5\">\n            <span className=\"text-xs font-black text-yellow-400\">2</span>\n          </div>\n          <div>\n            <p className=\"text-sm font-black uppercase tracking-wider text-white\">Consider Minimally Invasive</p>\n            <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mt-1\">Temporary or reversible options</p>\n          </div>\n        </div>\n        <div className=\"flex items-start gap-4\">\n          <div className=\"w-7 h-7 rounded-lg bg-red-500/20 border border-red-500/30 flex items-center justify-center flex-shrink-0 mt-0.5\">\n            <span className=\"text-xs font-black text-red-400\">3</span>\n          </div>\n          <div>\n            <p className=\"text-sm font-black uppercase tracking-wider text-white\">Evaluate Surgical Options</p>\n            <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mt-1\">Permanent solutions for significant improvements</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// YOUR PHASE CARD (Body Composition Phase)\n// ============================================\n\ntype BodyPhase = 'bulk' | 'cut' | 'maintain';\n\ninterface YourPhaseCardProps {\n  bodyFatPercent?: number;\n  gender: 'male' | 'female';\n}\n\nfunction YourPhaseCard({ bodyFatPercent, gender }: YourPhaseCardProps) {\n  // Determine phase based on body fat and gender\n  const getPhase = (): { phase: BodyPhase; message: string; color: string; icon: React.ReactNode } => {\n    if (!bodyFatPercent) {\n      return {\n        phase: 'maintain',\n        message: 'Complete your physique analysis to get personalized phase recommendations.',\n        color: 'from-neutral-800 to-neutral-900',\n        icon: <Scale size={24} className=\"text-neutral-400\" />,\n      };\n    }\n\n    // Male thresholds: <12% = bulk, 12-18% = maintain, >18% = cut\n    // Female thresholds: <18% = bulk, 18-25% = maintain, >25% = cut\n    const bulkThreshold = gender === 'male' ? 12 : 18;\n    const cutThreshold = gender === 'male' ? 18 : 25;\n\n    if (bodyFatPercent < bulkThreshold) {\n      return {\n        phase: 'bulk',\n        message: `At ${bodyFatPercent.toFixed(1)}% body fat, you're lean enough to build muscle. Focus on a slight caloric surplus with progressive overload.`,\n        color: 'from-green-600 to-emerald-700',\n        icon: <Dumbbell size={24} className=\"text-white\" />,\n      };\n    } else if (bodyFatPercent > cutThreshold) {\n      return {\n        phase: 'cut',\n        message: `At ${bodyFatPercent.toFixed(1)}% body fat, prioritize fat loss. A moderate caloric deficit with high protein will reveal your facial structure.`,\n        color: 'from-orange-600 to-red-700',\n        icon: <Salad size={24} className=\"text-white\" />,\n      };\n    } else {\n      return {\n        phase: 'maintain',\n        message: `At ${bodyFatPercent.toFixed(1)}% body fat, you're in the optimal range. Focus on body recomposition to build muscle while staying lean.`,\n        color: 'from-blue-600 to-cyan-700',\n        icon: <Scale size={24} className=\"text-white\" />,\n      };\n    }\n  };\n\n  const { phase, message, color, icon } = getPhase();\n  const phaseLabels: Record<BodyPhase, string> = {\n    bulk: 'Lean Bulk Phase',\n    cut: 'Cutting Phase',\n    maintain: 'Maintenance Phase',\n  };\n\n  return (\n    <motion.div\n      className={`bg-gradient-to-br ${color} rounded-[2rem] p-6 md:p-8 border border-white/10`}\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-start gap-5\">\n        <div className=\"w-14 h-14 rounded-2xl bg-white/20 border border-white/20 flex items-center justify-center flex-shrink-0 shadow-xl\">\n          {icon}\n        </div>\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-3 mb-2\">\n            <h3 className=\"text-lg font-black uppercase tracking-wider text-white\">Your Phase</h3>\n            <div className=\"px-3 py-1 bg-white/20 border border-white/20 rounded-lg text-[10px] font-black uppercase tracking-wider text-white\">\n              {phaseLabels[phase]}\n            </div>\n          </div>\n          <p className=\"text-sm text-white/80 leading-relaxed mb-5\">{message}</p>\n\n          {/* Phase-specific tips */}\n          <div className=\"grid grid-cols-3 gap-3\">\n            <div className=\"bg-black/20 rounded-xl p-3 text-center border border-white/10\">\n              <div className=\"flex items-center justify-center gap-1.5 mb-1\">\n                {phase === 'bulk' ? (\n                  <ArrowUp size={12} className=\"text-green-300\" />\n                ) : phase === 'cut' ? (\n                  <ArrowDown size={12} className=\"text-orange-300\" />\n                ) : (\n                  <Minus size={12} className=\"text-blue-300\" />\n                )}\n                <span className=\"text-[10px] font-bold uppercase tracking-wider text-white/60\">Calories</span>\n              </div>\n              <span className=\"text-sm font-black uppercase text-white\">\n                {phase === 'bulk' ? '+300' : phase === 'cut' ? '-500' : '+/-0'}\n              </span>\n            </div>\n            <div className=\"bg-black/20 rounded-xl p-3 text-center border border-white/10\">\n              <span className=\"text-[10px] font-bold uppercase tracking-wider text-white/60 block mb-1\">Protein</span>\n              <span className=\"text-sm font-black uppercase text-white\">\n                {phase === 'cut' ? '1.2g/lb' : '1g/lb'}\n              </span>\n            </div>\n            <div className=\"bg-black/20 rounded-xl p-3 text-center border border-white/10\">\n              <span className=\"text-[10px] font-bold uppercase tracking-wider text-white/60 block mb-1\">Cardio</span>\n              <span className=\"text-sm font-black uppercase text-white\">\n                {phase === 'bulk' ? 'Minimal' : phase === 'cut' ? '4-5x/wk' : '2-3x/wk'}\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// PRODUCT BUNDLE CTA\n// ============================================\n\ninterface ProductBundleCardProps {\n  products: ProductRecommendation[];\n  title?: string;\n}\n\nfunction ProductBundleCard({ products, title = 'Recommended Bundle' }: ProductBundleCardProps) {\n  // Get top 3 most important products\n  const bundleProducts = products.slice(0, 3);\n\n  // Calculate total cost\n  const totalCost = bundleProducts.reduce((sum, rec) => {\n    const supplement = SUPPLEMENTS.find(s => s.id === rec.product.supplementId);\n    return sum + (supplement?.costPerMonth.min || 0);\n  }, 0);\n\n  if (bundleProducts.length === 0) return null;\n\n  return (\n    <motion.div\n      className=\"rounded-[2rem] bg-gradient-to-br from-purple-900/50 to-violet-950/50 border border-purple-500/30 p-6\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-center gap-3 mb-5\">\n        <div className=\"w-10 h-10 rounded-xl bg-purple-500/20 border border-purple-500/30 flex items-center justify-center\">\n          <Package size={18} className=\"text-purple-400\" />\n        </div>\n        <div className=\"flex-1\">\n          <h3 className=\"text-sm font-black uppercase tracking-wider text-white\">{title}</h3>\n        </div>\n        <div className=\"px-3 py-1.5 bg-purple-500/20 border border-purple-500/30 text-purple-300 text-[10px] font-black uppercase tracking-wider rounded-lg\">\n          Save 15%\n        </div>\n      </div>\n\n      <p className=\"text-sm text-neutral-300 mb-5 leading-relaxed\">\n        Your analysis recommends these {bundleProducts.length} supplements - optimized for your specific weak points.\n      </p>\n\n      {/* Bundle Items */}\n      <div className=\"space-y-2 mb-5\">\n        {bundleProducts.map((rec, index) => (\n          <div\n            key={rec.product.id}\n            className=\"flex items-center gap-4 p-3 bg-black/30 rounded-xl border border-white/5\"\n          >\n            <div className=\"w-7 h-7 rounded-lg bg-purple-500/30 border border-purple-500/30 flex items-center justify-center flex-shrink-0\">\n              <span className=\"text-xs font-black text-purple-300\">{index + 1}</span>\n            </div>\n            <div className=\"flex-1 min-w-0\">\n              <p className=\"text-sm font-black uppercase tracking-wider text-white truncate\">{rec.product.name}</p>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-500 truncate\">Targets: {rec.targetMetric}</p>\n            </div>\n            <div className=\"text-right flex-shrink-0\">\n              <p className=\"text-sm font-black text-white\">\n                ${SUPPLEMENTS.find(s => s.id === rec.product.supplementId)?.costPerMonth.min || 0}/mo\n              </p>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      {/* Total & CTA */}\n      <div className=\"border-t border-purple-500/20 pt-5\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <span className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-400\">Bundle Total</span>\n          <div className=\"text-right\">\n            <span className=\"text-xl font-black text-white\">${totalCost}/mo</span>\n            <span className=\"text-xs font-bold text-neutral-500 ml-2 line-through\">${Math.round(totalCost * 1.15)}/mo</span>\n          </div>\n        </div>\n        <button\n          className=\"w-full flex items-center justify-center gap-3 py-3.5 bg-gradient-to-r from-purple-500 to-violet-600 text-white text-xs font-black uppercase tracking-wider rounded-xl hover:opacity-90 transition-opacity border border-purple-400/30\"\n        >\n          <ShoppingCart size={16} />\n          Get Your Bundle\n        </button>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// PLAN TAB\n// ============================================\n\nexport function PlanTab() {\n  const { recommendations, flaws, gender, ethnicity, frontRatios, sideRatios, overallScore, frontPhoto, vision, isUnlocked } = useResults();\n  const { user } = useAuth();\n  const physiqueContext = usePhysiqueOptional();\n  const [selectedPhase, setSelectedPhase] = useState<RecommendationPhase | null>(null);\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [completedIds, setCompletedIds] = useState<Set<string>>(new Set());\n  const [removedIds, setRemovedIds] = useState<Set<string>>(new Set());\n  const [previousAnalysis, setPreviousAnalysis] = useState<{\n    date: string;\n    overallScore: number;\n    bodyFatPercent?: number;\n    frontPhotoUrl?: string;\n  } | null>(null);\n\n  // Treatment conflict state\n  const [dismissedConflicts, setDismissedConflicts] = useState<Set<string>>(new Set());\n  const [conflictModal, setConflictModal] = useState<{\n    isOpen: boolean;\n    conflict: TreatmentConflict | null;\n    newTreatmentId: string;\n  }>({ isOpen: false, conflict: null, newTreatmentId: '' });\n\n  const { openPricingModal } = usePricing();\n\n  // Convert to number for arithmetic operations\n  const numericOverallScore = typeof overallScore === 'number' ? overallScore : 0;\n\n  // Check if user has a paid plan\n  const hasPaidPlan = user?.plan === 'basic' || user?.plan === 'pro';\n\n  // Get body fat from physique analysis\n  const bodyFatPercent = physiqueContext?.physiqueAnalysis?.bodyFatPercent;\n\n  // Generate Daily Stack for all users\n  const dailyStack = useMemo(() => {\n    return generateDailyStack(gender);\n  }, [gender]);\n\n  // Generate Product Recommendations based on metrics\n  const productRecommendations = useMemo(() => {\n    // Build metrics and severity dictionaries from ratios\n    const metricsDict: Record<string, number> = {};\n    const severityDict: Record<string, string> = {};\n\n    [...frontRatios, ...sideRatios].forEach(ratio => {\n      metricsDict[ratio.name] = typeof ratio.value === 'number' ? ratio.value : 0;\n      severityDict[ratio.name] = ratio.severity;\n    });\n\n    return getProductRecommendations(metricsDict, severityDict, gender, ethnicity);\n  }, [frontRatios, sideRatios, gender, ethnicity]);\n\n  // Split product recommendations by state\n  const { flawProducts, idealProducts } = useMemo(() => {\n    const flaw = productRecommendations.filter(r => r.state === 'flaw');\n    const ideal = productRecommendations.filter(r => r.state === 'ideal');\n    return { flawProducts: flaw, idealProducts: ideal };\n  }, [productRecommendations]);\n\n  // Map flaws to products and treatments\n  const flawsWithProducts = useMemo(() => {\n    return flaws.slice(0, 5).map(flaw => {\n      // Find products that target metrics related to this flaw\n      const relatedProducts = productRecommendations.filter(rec =>\n        flaw && flaw.responsibleRatios && flaw.responsibleRatios.some(ratio =>\n          rec.matchedMetrics.some(metric =>\n            metric.toLowerCase().includes(ratio.ratioName.toLowerCase()) ||\n            ratio.ratioName.toLowerCase().includes(metric.toLowerCase())\n          )\n        )\n      );\n\n      // Find treatments that match this flaw\n      const relatedTreatments = recommendations.filter(rec =>\n        rec.matchedFlaws.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase()))\n      );\n\n      return {\n        flaw,\n        products: relatedProducts.slice(0, 2),\n        treatments: relatedTreatments.slice(0, 3),\n      };\n    });\n  }, [flaws, productRecommendations, recommendations]);\n\n  // Handle progress photo upload\n  const handleProgressPhotoUpload = useCallback(async (file: File) => {\n    // Store current analysis as previous before re-analyzing\n    const numScore = typeof overallScore === 'number' ? overallScore : 0;\n    setPreviousAnalysis({\n      date: new Date().toISOString(),\n      overallScore: numScore,\n      bodyFatPercent,\n      frontPhotoUrl: frontPhoto || undefined,\n    });\n\n    // In a real implementation, this would upload to API and trigger re-analysis\n    console.log('Progress photo uploaded:', file.name);\n  }, [overallScore, bodyFatPercent, frontPhoto]);\n\n  // Count recommendations by phase\n  const phaseCounts = useMemo(() => {\n    const counts: Record<RecommendationPhase, number> = {\n      'Foundational': 0,\n      'Minimally Invasive': 0,\n      'Surgical': 0,\n    };\n    recommendations.forEach(r => {\n      if (!removedIds.has(r.ref_id)) {\n        counts[r.phase]++;\n      }\n    });\n    return counts;\n  }, [recommendations, removedIds]);\n\n  // Filter recommendations\n  const filteredRecommendations = useMemo(() => {\n    let filtered = recommendations.filter(r => !removedIds.has(r.ref_id));\n    if (selectedPhase) {\n      filtered = filtered.filter(r => r.phase === selectedPhase);\n    }\n    return filtered;\n  }, [recommendations, selectedPhase, removedIds]);\n\n  const hasRecommendations = filteredRecommendations.length > 0;\n\n  // Detect treatment conflicts in current recommendations\n  const treatmentConflicts = useMemo(() => {\n    const selectedIds = filteredRecommendations.map(r => r.ref_id);\n    const nameMap = Object.fromEntries(\n      filteredRecommendations.map(r => [r.ref_id, r.name])\n    );\n    const conflicts = findTreatmentConflicts(selectedIds, nameMap);\n\n    // Filter out dismissed conflicts\n    return conflicts.filter(c => {\n      const conflictKey = `${c.treatment1Id}-${c.treatment2Id}`;\n      return !dismissedConflicts.has(conflictKey);\n    });\n  }, [filteredRecommendations, dismissedConflicts]);\n\n  // Handle dismissing a conflict\n  const handleDismissConflict = useCallback((conflict: TreatmentConflict) => {\n    const conflictKey = `${conflict.treatment1Id}-${conflict.treatment2Id}`;\n    setDismissedConflicts(prev => new Set(Array.from(prev).concat(conflictKey)));\n  }, []);\n\n  // Handle dismissing all conflicts\n  const handleDismissAllConflicts = useCallback(() => {\n    const allKeys = treatmentConflicts.map(\n      c => `${c.treatment1Id}-${c.treatment2Id}`\n    );\n    setDismissedConflicts(prev => new Set(Array.from(prev).concat(allKeys)));\n  }, [treatmentConflicts]);\n\n  // Handle conflict modal actions\n  const handleConflictProceed = useCallback(() => {\n    if (conflictModal.conflict) {\n      // Remove the lower priority (existing) treatment\n      setRemovedIds(prev => new Set(Array.from(prev).concat(conflictModal.conflict!.treatment1Id)));\n    }\n    setConflictModal({ isOpen: false, conflict: null, newTreatmentId: '' });\n  }, [conflictModal.conflict]);\n\n  const handleConflictCancel = useCallback(() => {\n    setConflictModal({ isOpen: false, conflict: null, newTreatmentId: '' });\n  }, []);\n\n  // Handle mark complete\n  const handleMarkComplete = useCallback((id: string) => {\n    setCompletedIds(prev => {\n      const newSet = new Set(prev);\n      if (newSet.has(id)) {\n        newSet.delete(id);\n      } else {\n        newSet.add(id);\n      }\n      return newSet;\n    });\n  }, []);\n\n  // Handle remove\n  const handleRemove = useCallback((id: string) => {\n    setRemovedIds(prev => {\n      const newSet = new Set(prev);\n      newSet.add(id);\n      return newSet;\n    });\n    if (expandedId === id) {\n      setExpandedId(null);\n    }\n  }, [expandedId]);\n\n  return (\n    <TabContent\n      title=\"Your Plan & Potential\"\n      subtitle=\"Personalized recommendations based on your analysis\"\n    >\n      <div className=\"grid grid-cols-1 lg:grid-cols-3 gap-8\">\n        {/* Main Content */}\n        <div className=\"lg:col-span-2 space-y-10\">\n          {/* Your Phase Card - Body Composition Phase */}\n          <YourPhaseCard bodyFatPercent={bodyFatPercent} gender={gender} />\n\n          {/* Daily Stack Card - Hero Element for ALL users */}\n          {dailyStack && <DailyStackCard dailyStack={dailyStack} />}\n\n          {/* Potential Score */}\n          <PotentialScoreCard />\n\n          {/* Fix Your Weak Points Section */}\n          {flawsWithProducts.length > 0 && (\n            <section>\n              <SectionHeader title=\"Fix Your Weak Points\">\n                <span className=\"px-3 py-1.5 bg-red-500/20 border border-red-500/30 text-red-400 text-[10px] font-black uppercase tracking-wider rounded-lg\">\n                  {flawsWithProducts.length} Issues\n                </span>\n              </SectionHeader>\n              <div className=\"space-y-4\">\n                {flawsWithProducts.map((item, index) => (\n                  <WeakPointCard\n                    key={item.flaw.id}\n                    flaw={item.flaw}\n                    rank={index + 1}\n                    products={item.products}\n                    treatments={item.treatments}\n                    onViewTreatment={(treatment) => setExpandedId(treatment.ref_id)}\n                  />\n                ))}\n              </div>\n            </section>\n          )}\n\n          {/* Targeted Product Recommendations - Corrective */}\n          {flawProducts.length > 0 && (\n            <section>\n              <SectionHeader title=\"Recommended Products\">\n                <span className=\"px-3 py-1.5 bg-cyan-500/20 border border-cyan-500/30 text-cyan-400 text-[10px] font-black uppercase tracking-wider rounded-lg\">\n                  Corrective\n                </span>\n              </SectionHeader>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {flawProducts.slice(0, 6).map((rec, index) => (\n                  <ProductCard key={rec.product.id} recommendation={rec} rank={index + 1} />\n                ))}\n              </div>\n            </section>\n          )}\n\n          {/* Targeted Product Recommendations - Maintenance */}\n          {idealProducts.length > 0 && (\n            <section>\n              <SectionHeader title=\"Protect Your Strengths\">\n                <span className=\"px-3 py-1.5 bg-green-500/20 border border-green-500/30 text-green-400 text-[10px] font-black uppercase tracking-wider rounded-lg\">\n                  Maintenance\n                </span>\n              </SectionHeader>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {idealProducts.slice(0, 4).map((rec) => (\n                  <ProductCard key={rec.product.id} recommendation={rec} />\n                ))}\n              </div>\n            </section>\n          )}\n\n          {/* Treatment Timeline */}\n          {recommendations.length > 0 && (\n            <section>\n              <SectionHeader title=\"Treatment Timeline\" />\n              <TreatmentTimeline recommendations={recommendations.filter(r => !removedIds.has(r.ref_id))} />\n            </section>\n          )}\n\n          {/* Treatment Conflict Warnings */}\n          {treatmentConflicts.length > 0 && (\n            <TreatmentConflictList\n              conflicts={treatmentConflicts}\n              onDismiss={handleDismissConflict}\n              onDismissAll={handleDismissAllConflicts}\n            />\n          )}\n\n          {/* Phase Filter Section */}\n          <section>\n            <SectionHeader title=\"Treatment Options\" />\n            <PhaseFilter\n              selectedPhase={selectedPhase}\n              onSelect={setSelectedPhase}\n              counts={phaseCounts}\n            />\n          </section>\n\n          {/* Recommendations List */}\n          {hasRecommendations ? (\n            <motion.div className=\"space-y-4\" layout>\n              <AnimatePresence mode=\"popLayout\">\n                {filteredRecommendations.map((rec, index) => (\n                  <motion.div\n                    key={rec.ref_id}\n                    layout\n                    initial={{ opacity: 0, y: 20 }}\n                    animate={{ opacity: 1, y: 0 }}\n                    exit={{ opacity: 0, y: -20 }}\n                    transition={{ duration: 0.2, delay: index * 0.05 }}\n                  >\n                    <EnhancedRecommendationCard\n                      recommendation={rec}\n                      rank={index + 1}\n                      isExpanded={expandedId === rec.ref_id}\n                      onToggle={() => setExpandedId(\n                        expandedId === rec.ref_id ? null : rec.ref_id\n                      )}\n                      onMarkComplete={handleMarkComplete}\n                      onRemove={handleRemove}\n                      isCompleted={completedIds.has(rec.ref_id)}\n                      gender={gender}\n                      ethnicity={ethnicity}\n                    />\n                  </motion.div>\n                ))}\n              </AnimatePresence>\n            </motion.div>\n          ) : (\n            <div className=\"rounded-[2rem] bg-neutral-900/40 border border-white/5 p-10 text-center\">\n              <div className=\"w-16 h-16 rounded-2xl bg-neutral-900 border border-white/10 flex items-center justify-center mx-auto mb-5\">\n                <Sparkles size={28} className=\"text-neutral-600\" />\n              </div>\n              <h3 className=\"text-lg font-black uppercase tracking-wider text-white mb-2\">No Recommendations Yet</h3>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600\">\n                Complete a facial analysis to get personalized recommendations\n              </p>\n            </div>\n          )}\n        </div>\n\n        {/* Sidebar */}\n        <div className=\"space-y-6\">\n          {/* Medical Prescription Card (Dental) */}\n          {vision?.teeth && (\n            <MedicalPrescriptionCard vision={vision} isUnlocked={isUnlocked} />\n          )}\n\n          {/* Progress Comparison Card */}\n          <ProgressComparisonCard\n            currentAnalysis={{\n              date: new Date().toISOString(),\n              overallScore: numericOverallScore,\n              bodyFatPercent,\n              frontPhotoUrl: frontPhoto || undefined,\n            }}\n            previousAnalysis={previousAnalysis}\n            onUploadNewPhoto={handleProgressPhotoUpload}\n          />\n\n          {/* Product Bundle CTA */}\n          {flawProducts.length >= 3 && (\n            <ProductBundleCard\n              products={flawProducts}\n              title=\"Your Fix Bundle\"\n            />\n          )}\n\n          {/* Before/After Preview */}\n          <BeforeAfterPreviewSection />\n\n          {/* Order of Operations */}\n          <OrderOfOperations />\n\n          {/* My Plan Summary */}\n          <div className=\"rounded-2xl bg-neutral-900/40 border border-white/5 p-5\">\n            <h4 className=\"text-xs font-black uppercase tracking-wider text-white mb-4 flex items-center gap-3\">\n              <div className=\"w-8 h-8 rounded-lg bg-neutral-900 border border-white/10 flex items-center justify-center\">\n                <Zap size={14} className=\"text-yellow-400\" />\n              </div>\n              My Plan\n            </h4>\n            <div className=\"text-center py-8\">\n              <div className=\"w-14 h-14 mx-auto mb-4 rounded-2xl bg-neutral-900 border border-white/10 flex items-center justify-center\">\n                <Lock size={20} className=\"text-neutral-600\" />\n              </div>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mb-2\">\n                Add recommendations to build your personalized plan\n              </p>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-700\">\n                0 items selected\n              </p>\n            </div>\n          </div>\n\n          {/* Issues Summary */}\n          <div className=\"rounded-2xl bg-neutral-900/40 border border-white/5 p-5\">\n            <h4 className=\"text-xs font-black uppercase tracking-wider text-white mb-4\">Detected Issues</h4>\n            <div className=\"space-y-2\">\n              {flaws.slice(0, 5).map(flaw => (\n                <div\n                  key={flaw.id}\n                  className=\"flex items-center justify-between p-3 bg-neutral-900/50 border border-white/5 rounded-xl hover:border-white/10 transition-colors\"\n                >\n                  <span className=\"text-sm font-bold text-neutral-300 truncate\">{flaw.flawName}</span>\n                  <span className=\"text-[10px] font-black uppercase tracking-wider text-red-400 flex-shrink-0 px-2 py-1 bg-red-500/20 border border-red-500/30 rounded-lg\">\n                    -{flaw.harmonyPercentageLost.toFixed(1)}%\n                  </span>\n                </div>\n              ))}\n              {flaws.length === 0 && (\n                <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 text-center py-6\">\n                  No issues detected\n                </p>\n              )}\n            </div>\n          </div>\n\n          {/* Upgrade CTA or Premium Badge */}\n          {hasPaidPlan ? (\n            <motion.div\n              className=\"rounded-2xl bg-gradient-to-br from-green-500/10 to-emerald-600/10 border border-green-500/30 p-5\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.3 }}\n            >\n              <div className=\"flex items-center gap-3 mb-3\">\n                <div className=\"w-8 h-8 rounded-lg bg-green-500/20 border border-green-500/30 flex items-center justify-center\">\n                  <CheckCircle size={14} className=\"text-green-400\" />\n                </div>\n                <span className=\"text-xs font-black uppercase tracking-wider text-white\">\n                  {user?.plan === 'pro' ? 'Pro Plan' : 'Basic Plan'} Active\n                </span>\n              </div>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-500\">\n                You have full access to all {user?.plan === 'pro' ? 'features' : 'non-surgical recommendations'}.\n              </p>\n            </motion.div>\n          ) : (\n            <motion.div\n              className=\"rounded-2xl bg-gradient-to-br from-cyan-500/10 to-blue-600/10 border border-cyan-500/30 p-5\"\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              transition={{ delay: 0.3 }}\n            >\n              <div className=\"flex items-center gap-3 mb-3\">\n                <div className=\"w-8 h-8 rounded-lg bg-cyan-500/20 border border-cyan-500/30 flex items-center justify-center\">\n                  <Sparkles size={14} className=\"text-cyan-400\" />\n                </div>\n                <span className=\"text-xs font-black uppercase tracking-wider text-white\">Unlock Full Plan</span>\n              </div>\n              <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-500 mb-4\">\n                Get detailed treatment guides, cost estimates, and provider recommendations.\n              </p>\n              <button\n                onClick={() => openPricingModal('plan_sidebar')}\n                className=\"block w-full py-3 bg-cyan-500 text-black text-xs font-black uppercase tracking-wider rounded-xl text-center hover:bg-cyan-400 transition-colors\"\n              >\n                Upgrade Now\n              </button>\n            </motion.div>\n          )}\n        </div>\n      </div>\n\n      {/* Treatment Conflict Modal */}\n      <SelectionWarningModal\n        isOpen={conflictModal.isOpen}\n        onClose={handleConflictCancel}\n        conflict={conflictModal.conflict || {\n          treatment1Id: '',\n          treatment1Name: '',\n          treatment2Id: '',\n          treatment2Name: '',\n          reason: '',\n        }}\n        onProceed={handleConflictProceed}\n        onCancel={handleConflictCancel}\n      />\n    </TabContent>\n  );\n}\n","structuredPatch":[{"oldStart":10,"oldLines":8,"newStart":10,"newLines":6,"lines":["   ChevronRight,","   Lock,","   CheckCircle,","-  AlertCircle,","-  CheckCircle2,","   Scale,","   Dumbbell,","   Salad,"]}],"userModified":false,"replaceAll":false}}
{"parentUuid":"881f6588-3d6b-49cb-a87b-6adae8f4a89c","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_01PD6E7YofmQ2Qj24ET8aeZZ","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Km2yqgCZTJFT9Va5tbcphu","name":"Bash","input":{"command":"npm run lint -- --quiet 2>&1 | head -30","description":"Verify ESLint passes","timeout":60000}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":686,"cache_read_input_tokens":84513,"cache_creation":{"ephemeral_5m_input_tokens":686,"ephemeral_1h_input_tokens":0},"output_tokens":23,"service_tier":"standard"}},"requestId":"req_011CWVwqHCCj24C4D8Qafz7E","type":"assistant","uuid":"b95f90d0-fb36-4d34-961f-48f6849326c1","timestamp":"2025-12-26T20:41:01.362Z"}
{"parentUuid":"b95f90d0-fb36-4d34-961f-48f6849326c1","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Km2yqgCZTJFT9Va5tbcphu","type":"tool_result","content":"> looksmaxx-app@0.1.0 lint\n> next lint --quiet\n\n✔ No ESLint warnings or errors","is_error":false}]},"uuid":"64a0e4c4-83b1-4ceb-a9c4-5e333b781de5","timestamp":"2025-12-26T20:41:03.093Z","toolUseResult":{"stdout":"> looksmaxx-app@0.1.0 lint\n> next lint --quiet\n\n✔ No ESLint warnings or errors","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"64a0e4c4-83b1-4ceb-a9c4-5e333b781de5","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"07eb15f9-1807-445c-a67f-e2b0c9b2588f","version":"2.0.76","gitBranch":"main","agentId":"aedb0a3","slug":"mellow-inventing-toast","message":{"model":"claude-opus-4-5-20251101","id":"msg_01Q5JKkZsMXc5Ck3Hm4xD1qB","type":"message","role":"assistant","content":[{"type":"text","text":"The redesigned `PlanTab.tsx` now passes all checks. Here is a summary of the design changes made:\n\n## Summary of Design Updates\n\n### Key Design Pattern Changes Applied:\n\n1. **Section Headers**: Added a reusable `SectionHeader` component with `text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600` and a horizontal divider line (`flex-1 h-px bg-neutral-800`)\n\n2. **Card Containers**: \n   - Changed from `rounded-2xl` to `rounded-[2rem]` for premium containers\n   - Updated backgrounds to `bg-neutral-900/40` with `border border-white/5`\n   - Added hover states with `hover:border-white/10`\n\n3. **Badges**:\n   - All badges now use `font-black uppercase tracking-wider`\n   - Added subtle backgrounds with `bg-color-500/20`\n   - Added borders with `border border-color-500/30`\n   - Text size standardized to `text-[10px]` or `text-xs`\n\n4. **Icon Boxes**:\n   - Icons now sit in `w-10 h-10 rounded-xl bg-neutral-900 border border-white/10 flex items-center justify-center` boxes\n   - Larger hero icons use `w-14 h-14 rounded-2xl`\n\n5. **Labels**:\n   - All labels use `text-[10px] font-bold uppercase tracking-wider text-neutral-600`\n\n6. **Buttons**:\n   - Phase filter buttons use `rounded-xl bg-neutral-900/50 border border-white/5`\n   - Active states use solid backgrounds with appropriate borders\n   - CTA buttons remain cyan with `font-black uppercase tracking-wider`\n\n7. **Typography**:\n   - Headers use `font-black uppercase tracking-wider`\n   - Body text uses `font-bold` or `font-medium`\n   - Consistent use of neutral-400/500/600 for secondary text\n\n8. **Spacing**:\n   - Increased gap between sections (`space-y-10` for main content)\n   - Cards use `p-5` or `p-6 md:p-8` for padding\n   - Consistent `gap-3` or `gap-4` for flexbox layouts"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":0,"cache_creation_input_tokens":252,"cache_read_input_tokens":85199,"cache_creation":{"ephemeral_5m_input_tokens":252,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVwqf6aMZJTDLty3kpJ6","type":"assistant","uuid":"09246739-4f53-49df-87ba-16bf2b2cc6a1","timestamp":"2025-12-26T20:41:19.180Z"}
