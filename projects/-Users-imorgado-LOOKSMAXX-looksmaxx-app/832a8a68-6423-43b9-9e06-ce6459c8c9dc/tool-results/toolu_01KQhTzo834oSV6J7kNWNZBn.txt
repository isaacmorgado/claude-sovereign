     1→/**
     2→ * FaceIQ-Style Facial Analysis Scoring System
     3→ * Complete replication of FaceIQ Labs scoring algorithms
     4→ *
     5→ * Features:
     6→ * - Exponential decay scoring with per-metric decay rates
     7→ * - Bezier curve custom scoring for non-linear measurements
     8→ * - 70+ facial measurements (front + side profiles)
     9→ * - Quality tiers: Ideal, Excellent, Good
    10→ * - 5-tier severity: Extremely Severe, Severe, Major, Moderate, Minor
    11→ */
    12→
    13→import { LandmarkPoint } from './landmarks';
    14→
    15→// ============================================
    16→// CORE TYPES
    17→// ============================================
    18→
    19→export interface Point {
    20→  x: number;
    21→  y: number;
    22→}
    23→
    24→export type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';
    25→export type SeverityLevel = 'extremely_severe' | 'severe' | 'major' | 'moderate' | 'minor' | 'optimal';
    26→export type MeasurementUnit = 'ratio' | 'percent' | 'degrees' | 'mm' | 'none';
    27→
    28→export interface MetricConfig {
    29→  id: string;
    30→  name: string;
    31→  category: string;
    32→  unit: MeasurementUnit;
    33→  idealMin: number;
    34→  idealMax: number;
    35→  rangeMin: number;
    36→  rangeMax: number;
    37→  decayRate: number;
    38→  maxScore: number;
    39→  weight: number;
    40→  description: string;
    41→  profileType: 'front' | 'side';
    42→  customCurve?: BezierCurveConfig;
    43→}
    44→
    45→export interface BezierCurveConfig {
    46→  mode: 'custom' | 'exponential';
    47→  points: CurvePoint[];
    48→}
    49→
    50→export interface CurvePoint {
    51→  x: number;
    52→  y: number;
    53→  leftHandleX?: number;
    54→  leftHandleY?: number;
    55→  rightHandleX?: number;
    56→  rightHandleY?: number;
    57→  fixed?: boolean;
    58→}
    59→
    60→export interface FaceIQScoreResult {
    61→  metricId: string;
    62→  name: string;
    63→  value: number;
    64→  score: number;  // 0-10 scale
    65→  standardizedScore: number;
    66→  qualityTier: QualityTier;
    67→  severity: SeverityLevel;
    68→  idealMin: number;
    69→  idealMax: number;
    70→  deviation: number;
    71→  deviationDirection: 'above' | 'below' | 'within';
    72→  unit: MeasurementUnit;
    73→  category: string;
    74→  percentile?: number;
    75→}
    76→
    77→export interface HarmonyAnalysis {
    78→  overallScore: number;  // 0-10 scale
    79→  standardizedScore: number;
    80→  qualityTier: QualityTier;
    81→  percentile: number;
    82→  frontScore: number;
    83→  sideScore: number;
    84→  categoryScores: Record<string, number>;
    85→  measurements: FaceIQScoreResult[];
    86→  flaws: FlawAssessment[];
    87→  strengths: StrengthAssessment[];
    88→}
    89→
    90→export interface FlawAssessment {
    91→  category: string;
    92→  metricId: string;
    93→  metricName: string;
    94→  severity: SeverityLevel;
    95→  deviation: string;
    96→  reasoning: string;
    97→  confidence: 'confirmed' | 'likely' | 'possible';
    98→}
    99→
   100→export interface StrengthAssessment {
   101→  category: string;
   102→  metricId: string;
   103→  metricName: string;
   104→  qualityTier: QualityTier;
   105→  value: number;
   106→  reasoning: string;
   107→}
   108→
   109→// ============================================
   110→// DEMOGRAPHIC TYPES & OVERRIDES
   111→// ============================================
   112→
   113→export type Ethnicity =
   114→  | 'east_asian'
   115→  | 'south_asian'
   116→  | 'black'
   117→  | 'hispanic'
   118→  | 'middle_eastern'
   119→  | 'native_american'
   120→  | 'pacific_islander'
   121→  | 'white'
   122→  | 'other';
   123→
   124→export type Gender = 'male' | 'female';
   125→
   126→export type DemographicKey = `${Ethnicity}_${Gender}` | Gender | Ethnicity;
   127→
   128→export interface DemographicOverride {
   129→  idealMin: number;
   130→  idealMax: number;
   131→}
   132→
   133→/**
   134→ * Demographic-specific ideal ranges based on anthropometric research.
   135→ * FaceIQ uses universal scoring, but this gives more accurate assessments
   136→ * by adjusting ideals based on ethnicity and gender.
   137→ */
   138→export const DEMOGRAPHIC_OVERRIDES: Record<string, Partial<Record<DemographicKey, DemographicOverride>>> = {
   139→  // ==========================================
   140→  // NOSE METRICS - Highest ethnicity variation
   141→  // ==========================================
   142→  nasalIndex: {
   143→    // Nasal Index = (Nose Width / Nose Height) × 100
   144→    // Research: African/Pacific Islander tend platyrrhine (85-100), Asian mesorrhine (75-88), European leptorrhine (65-75)
   145→    east_asian_male: { idealMin: 78, idealMax: 88 },
   146→    east_asian_female: { idealMin: 76, idealMax: 86 },
   147→    south_asian_male: { idealMin: 72, idealMax: 82 },
   148→    south_asian_female: { idealMin: 70, idealMax: 80 },
   149→    black_male: { idealMin: 85, idealMax: 100 },
   150→    black_female: { idealMin: 83, idealMax: 98 },
   151→    hispanic_male: { idealMin: 75, idealMax: 87 },
   152→    hispanic_female: { idealMin: 73, idealMax: 85 },
   153→    middle_eastern_male: { idealMin: 68, idealMax: 78 },
   154→    middle_eastern_female: { idealMin: 66, idealMax: 76 },
   155→    white_male: { idealMin: 65, idealMax: 75 },
   156→    white_female: { idealMin: 63, idealMax: 73 },
   157→    native_american_male: { idealMin: 72, idealMax: 82 },
   158→    native_american_female: { idealMin: 70, idealMax: 80 },
   159→    pacific_islander_male: { idealMin: 82, idealMax: 95 },
   160→    pacific_islander_female: { idealMin: 80, idealMax: 93 },
   161→  },
   162→
   163→  nasolabialAngle: {
   164→    // Ideal nasolabial angle varies by ethnicity
   165→    // African: slightly more obtuse, European: slightly more acute
   166→    black_male: { idealMin: 95, idealMax: 110 },
   167→    black_female: { idealMin: 100, idealMax: 115 },
   168→    east_asian_male: { idealMin: 90, idealMax: 105 },
   169→    east_asian_female: { idealMin: 95, idealMax: 110 },
   170→    // Gender-only fallbacks
   171→    male: { idealMin: 90, idealMax: 100 },
   172→    female: { idealMin: 100, idealMax: 110 },
   173→  },
   174→
   175→  nasalProjection: {
   176→    // Nose projection relative to face depth
   177→    // East Asian/African: typically less projection is ideal
   178→    east_asian: { idealMin: 0.54, idealMax: 0.60 },
   179→    black: { idealMin: 0.52, idealMax: 0.58 },
   180→    south_asian: { idealMin: 0.56, idealMax: 0.62 },
   181→    middle_eastern: { idealMin: 0.62, idealMax: 0.68 },
   182→    white: { idealMin: 0.60, idealMax: 0.67 },
   183→    pacific_islander: { idealMin: 0.52, idealMax: 0.58 },
   184→  },
   185→
   186→  // ==========================================
   187→  // JAW METRICS - Clear gender dimorphism
   188→  // ==========================================
   189→  bigonialWidth: {
   190→    // Jaw width as % of bizygomatic width
   191→    // Males: wider, more angular; Females: narrower, softer
   192→    male: { idealMin: 90, idealMax: 95 },
   193→    female: { idealMin: 85, idealMax: 90 },
   194→  },
   195→
   196→  jawFrontalAngle: {
   197→    // More angular in males, softer in females
   198→    male: { idealMin: 88, idealMax: 95 },
   199→    female: { idealMin: 82, idealMax: 90 },
   200→  },
   201→
   202→  jawWidthRatio: {
   203→    // Males have stronger jaw width preference
   204→    male: { idealMin: 0.78, idealMax: 0.85 },
   205→    female: { idealMin: 0.72, idealMax: 0.80 },
   206→  },
   207→
   208→  gonialAngle: {
   209→    // Males: more acute (sharper jaw); Females: more obtuse (softer)
   210→    male: { idealMin: 115, idealMax: 125 },
   211→    female: { idealMin: 120, idealMax: 135 },
   212→  },
   213→
   214→  // ==========================================
   215→  // EYE METRICS - Ethnic variation
   216→  // ==========================================
   217→  lateralCanthalTilt: {
   218→    // East Asian: naturally higher positive tilt
   219→    east_asian_male: { idealMin: 8, idealMax: 12 },
   220→    east_asian_female: { idealMin: 9, idealMax: 13 },
   221→    south_asian_male: { idealMin: 6, idealMax: 10 },
   222→    south_asian_female: { idealMin: 7, idealMax: 11 },
   223→    // Default for others is 6-8 (already in FACEIQ_METRICS)
   224→  },
   225→
   226→  eyeAspectRatio: {
   227→    // East Asian eyes often have different aspect ratio due to epicanthal fold
   228→    east_asian_male: { idealMin: 2.6, idealMax: 3.2 },
   229→    east_asian_female: { idealMin: 2.7, idealMax: 3.3 },
   230→    // Larger eyes in females considered more attractive
   231→    male: { idealMin: 2.9, idealMax: 3.4 },
   232→    female: { idealMin: 3.1, idealMax: 3.6 },
   233→  },
   234→
   235→  // ==========================================
   236→  // FACE PROPORTIONS - Gender variation
   237→  // ==========================================
   238→  faceWidthToHeight: {
   239→    // Males: slightly wider face preferred; Females: slightly narrower
   240→    male: { idealMin: 1.98, idealMax: 2.02 },
   241→    female: { idealMin: 1.94, idealMax: 1.98 },
   242→  },
   243→
   244→  totalFacialWidthToHeight: {
   245→    male: { idealMin: 1.35, idealMax: 1.40 },
   246→    female: { idealMin: 1.32, idealMax: 1.37 },
   247→  },
   248→
   249→  midfaceRatio: {
   250→    // Females often have more compact midface
   251→    male: { idealMin: 0.98, idealMax: 1.02 },
   252→    female: { idealMin: 0.95, idealMax: 1.00 },
   253→  },
   254→
   255→  // ==========================================
   256→  // LIP METRICS - Ethnicity variation
   257→  // ==========================================
   258→  lipRatio: {
   259→    // African/Hispanic: fuller lips natural
   260→    black_male: { idealMin: 1.6, idealMax: 2.2 },
   261→    black_female: { idealMin: 1.7, idealMax: 2.3 },
   262→    hispanic_male: { idealMin: 1.4, idealMax: 2.0 },
   263→    hispanic_female: { idealMin: 1.5, idealMax: 2.1 },
   264→    // East Asian: less full lips
   265→    east_asian_male: { idealMin: 1.2, idealMax: 1.7 },
   266→    east_asian_female: { idealMin: 1.3, idealMax: 1.8 },
   267→    // Default
   268→    male: { idealMin: 1.3, idealMax: 1.8 },
   269→    female: { idealMin: 1.4, idealMax: 2.0 },
   270→  },
   271→
   272→  upperLipRatio: {
   273→    // Fuller upper lip in African phenotypes
   274→    black: { idealMin: 0.38, idealMax: 0.48 },
   275→    hispanic: { idealMin: 0.36, idealMax: 0.45 },
   276→    east_asian: { idealMin: 0.32, idealMax: 0.40 },
   277→    female: { idealMin: 0.34, idealMax: 0.42 },
   278→  },
   279→
   280→  // ==========================================
   281→  // PROFILE METRICS - Gender & ethnicity
   282→  // ==========================================
   283→  chinProjection: {
   284→    // Males: more projected chin ideal
   285→    male: { idealMin: 0, idealMax: 3 },
   286→    female: { idealMin: -2, idealMax: 2 },
   287→  },
   288→
   289→  nasofrontalAngle: {
   290→    // Higher brow ridge in males
   291→    male: { idealMin: 128, idealMax: 138 },
   292→    female: { idealMin: 132, idealMax: 142 },
   293→  },
   294→};
   295→
   296→/**
   297→ * Get metric configuration with demographic-specific overrides applied.
   298→ * Lookup priority: ethnicity_gender > gender > ethnicity > default
   299→ */
   300→export function getMetricConfigForDemographics(

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
