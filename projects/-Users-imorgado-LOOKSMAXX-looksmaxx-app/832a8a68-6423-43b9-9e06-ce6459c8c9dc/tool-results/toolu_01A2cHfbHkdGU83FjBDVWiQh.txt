     1→# LOOKSMAXX - FaceIQ Parity Fixes
     2→
     3→## Session Date: 2025-12-20
     4→
     5→## Current State Summary
     6→
     7→### What's Complete
     8→- [x] Core exponential decay scoring formula (exact match)
     9→- [x] Bezier curve interpolation with Newton-Raphson
    10→- [x] Updated all metric ideal ranges to match FaceIQ exactly
    11→- [x] Updated maxScore weights (2.5-30 scale)
    12→- [x] Results page layout with 6 tabs
    13→- [x] Surgery database (100+ procedures in `hardmaxxing.ts`)
    14→- [x] Softmaxxing treatments database
    15→- [x] Non-surgical treatments database
    16→- [x] Supplements database
    17→- [x] TypeScript compilation passing
    18→
    19→### What's Complete (Added 2025-12-20)
    20→- [x] InsightFace on Railway - FIXED! detection_ready: true
    21→- [x] Detailed flaw mappings for 28 metrics (METRIC_FLAW_MAPPINGS)
    22→- [x] Custom Bezier curves for 5 key metrics (METRIC_CUSTOM_CURVES)
    23→
    24→---
    25→
    26→## Gaps to Fix (FaceIQ Parity)
    27→
    28→### 1. Detailed Flaw Mappings Per Metric [COMPLETED]
    29→
    30→**Current:** Basic string arrays like `["Wide face", "Long midface"]`
    31→
    32→**FaceIQ Format:**
    33→```typescript
    34→interface FlawMapping {
    35→  category: string;           // "Occlusion/Jaw Growth"
    36→  flawName: string;           // "Hyper-divergent jaw growth"
    37→  confidence: 'confirmed' | 'likely' | 'possible';
    38→  actualValue: string;        // "38.05%"
    39→  idealRange: string;         // "31-33.5%"
    40→  deviation: string;          // "4.55% above ideal"
    41→  score: number;              // 0.19
    42→  severity: 'extremely severe' | 'severe' | 'major' | 'moderate' | 'minor';
    43→  reasoning: string;          // AI-generated explanation
    44→  isUnlocked: boolean;
    45→}
    46→```
    47→
    48→**Example from FaceIQ (Lower Third Proportion at 38.05%):**
    49→```json
    50→{
    51→  "mayIndicateFlaws": [
    52→    {
    53→      "category": "Occlusion/Jaw Growth",
    54→      "flawName": "Hyper-divergent jaw growth",
    55→      "confidence": "confirmed",
    56→      "actualValue": "38.05%",
    57→      "idealRange": "31-33.5%",
    58→      "deviation": "4.55% above ideal",
    59→      "score": 0.19,
    60→      "severity": "extremely severe",
    61→      "reasoning": "The upper jaw is too long relative to lower jaw, possibly from a long upper jaw or short lower jaw, or a combination of both. This disrupts facial harmony by elongating the lower face."
    62→    },
    63→    {
    64→      "category": "Jaw Shape",
    65→      "flawName": "Disproportionate lower face (short chin or long philtrum)",
    66→      "confidence": "confirmed",
    67→      ...
    68→    },
    69→    {
    70→      "category": "Midface/Face Shape",
    71→      "flawName": "Long upper jaw",
    72→      "confidence": "confirmed",
    73→      ...
    74→    },
    75→    {
    76→      "category": "Midface/Face Shape",
    77→      "flawName": "Short lower jaw",
    78→      "confidence": "confirmed",
    79→      ...
    80→    }
    81→  ]
    82→}
    83→```
    84→
    85→**Files to modify:**
    86→- `src/lib/faceiq-scoring.ts` - Add FLAW_MAPPINGS constant
    87→- `src/contexts/ResultsContext.tsx` - Update `getFlawStrengthMappings()` function
    88→- `src/types/results.ts` - Add FlawMapping interface
    89→
    90→---
    91→
    92→### 2. Custom Bezier Curves for ALL Metrics [PARTIALLY COMPLETE - 5 key metrics added]
    93→
    94→**Current:** Only `totalFacialWidthToHeight` has custom curves
    95→
    96→**FaceIQ Format:** 12 control points with Bezier handles per metric
    97→```typescript
    98→interface CurvePoint {
    99→  x: number;
   100→  y: number;
   101→  leftHandleX?: number;
   102→  leftHandleY?: number;
   103→  rightHandleX?: number;
   104→  rightHandleY?: number;
   105→  fixed?: boolean;
   106→}
   107→
   108→interface CurveConfig {
   109→  mode: 'custom' | 'exponential';
   110→  customPoints?: CurvePoint[];
   111→  idealMin: number;
   112→  idealMax: number;
   113→  maxScore: number;
   114→  chartRange: { min: number; max: number };
   115→  decayRate?: number;
   116→}
   117→```
   118→
   119→**Example from FaceIQ (Lower Third Proportion):**
   120→```json
   121→{
   122→  "customPoints": [
   123→    {"x": 25.6, "y": 0, "leftHandleX": 24.8, "leftHandleY": 0, "rightHandleX": 26.4, "rightHandleY": 0},
   124→    {"x": 28.01, "y": 1.58, "leftHandleX": 27.23, "leftHandleY": 0.53, "rightHandleX": 28.27, "rightHandleY": 1.97},
   125→    {"x": 28.83, "y": 3.21, ...},
   126→    {"x": 29.63, "y": 5.85, ...},
   127→    {"x": 30.27, "y": 8.56, ...},
   128→    {"x": 31, "y": 10, "fixed": true},
   129→    {"x": 33.5, "y": 10, "fixed": true},
   130→    {"x": 34.23, "y": 8.56, ...},
   131→    {"x": 34.87, "y": 5.85, ...},
   132→    {"x": 35.67, "y": 3.21, ...},
   133→    {"x": 36.49, "y": 1.58, ...},
   134→    {"x": 38.9, "y": 0, ...}
   135→  ]
   136→}
   137→```
   138→
   139→**Files to modify:**
   140→- `src/lib/faceiq-scoring.ts` - Add `customCurve` to each metric in FACEIQ_METRICS
   141→
   142→**Data source:** Extract from `/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/FACEIQ-FRONT RATIOS.html`
   143→
   144→---
   145→
   146→### 3. Enhanced Illustration Configs [MEDIUM PRIORITY]
   147→
   148→**Current:** Basic configs for ~8 metrics
   149→
   150→**FaceIQ Format:**
   151→```typescript
   152→interface IllustrationConfig {
   153→  points: Record<string, {
   154→    type: 'landmark' | 'calculated';
   155→    x?: number;
   156→    y?: number;
   157→  }>;
   158→  lines: Array<{
   159→    from: string;
   160→    to: string;
   161→    label: string;
   162→    color: string;
   163→    labelColor: string;
   164→    labelPosition: 'left' | 'right' | 'top' | 'bottom';
   165→  }>;
   166→}
   167→```
   168→
   169→**Files to modify:**
   170→- `src/contexts/ResultsContext.tsx` - Expand `generateIllustration()` function
   171→
   172→---
   173→
   174→### 4. Improved Flaw-to-Treatment Matching [MEDIUM PRIORITY]
   175→
   176→**Current:** Basic keyword matching in `generateRecommendations()`
   177→
   178→**Target:**
   179→- Use metric scores to prioritize treatments
   180→- Match specific flaws to specific procedures
   181→- Calculate expected improvement percentages
   182→
   183→**Files to modify:**
   184→- `src/contexts/ResultsContext.tsx` - `generateRecommendations()` function
   185→- `src/lib/recommendations/severity.ts` - Enhance `getTreatmentIdsForMetric()`
   186→
   187→---
   188→
   189→### 5. Severity Display Enhancement [MEDIUM PRIORITY]
   190→
   191→**Current:** 5-tier but not prominently displayed
   192→
   193→**Target:** Show severity badges like FaceIQ:
   194→- "Extremely Severe" (red)
   195→- "Severe" (orange)
   196→- "Major" (yellow)
   197→- "Moderate" (light yellow)
   198→- "Minor" (gray)
   199→
   200→**Files to modify:**
   201→- `src/components/results/cards/StrengthFlawCards.tsx`
   202→- `src/types/results.ts` - Add severity color mapping
   203→
   204→---
   205→
   206→### 6. Railway InsightFace Deployment [FIXED ✓]
   207→
   208→**Status:** WORKING - detection_ready: true
   209→- Deployed using `railway up --service api`
   210→- python:3.11-bookworm base with cmake & libopenblas-dev
   211→- onnxruntime-cpu==1.16.3
   212→
   213→---
   214→
   215→### 7. AI-Generated Descriptions [LOW PRIORITY]
   216→
   217→**Current:** Static descriptions per metric
   218→
   219→**Target:** Add `aiDescription` field with personalized explanations based on the user's actual values
   220→
   221→---
   222→
   223→### 8. Decay Curve Charts [LOW PRIORITY]
   224→
   225→**Current:** Not implemented
   226→
   227→**Target:** Visualize the scoring curve showing where user's value falls
   228→
   229→---
   230→
   231→### 9. Potential Score Calculations [LOW PRIORITY]
   232→
   233→**Current:** Basic in Plan tab
   234→
   235→**Target:** "Your score could be X with treatment Y" with projected improvements
   236→
   237→---
   238→
   239→## File Locations
   240→
   241→### Key Files to Modify
   242→```
   243→src/lib/faceiq-scoring.ts          # Scoring configs, ideal ranges, curves
   244→src/contexts/ResultsContext.tsx     # Data transformation, flaw mappings
   245→src/types/results.ts                # Type definitions
   246→src/lib/recommendations/severity.ts # Flaw-to-treatment mapping
   247→src/components/results/cards/       # UI components for flaws/strengths
   248→```
   249→
   250→### FaceIQ Reference Data
   251→```
   252→/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/
   253→├── FACEIQ-FRONT RATIOS.html   # Front profile metrics with curves
   254→├── FACEIQ-SIDERATIOS.html     # Side profile metrics
   255→├── FACEIQ-ALL.har             # API calls with full response data
   256→├── FACEIQALL-HTML.html        # Full page capture
   257→└── site-capture-*.json        # Additional capture data
   258→```
   259→
   260→---
   261→
   262→## Metrics Updated This Session
   263→
   264→### Front Profile (Updated ideal ranges + maxScores)
   265→| Metric | New Ideal | maxScore |
   266→|--------|-----------|----------|
   267→| Face Width to Height | 1.96-2.0 | 30 |
   268→| Middle Third | 31.4-33.4% | 10 |
   269→| Upper Third | 30-32% | 10 |
   270→| Cheekbone Height | 83-100% | 15 |
   271→| Midface Ratio | 0.97-1.0 | 12.5 |
   272→| Jaw Frontal Angle | 86.5-92.5° | 20 |
   273→| Bigonial Width | 87.75-91.75% | 15 |
   274→| Lateral Canthal Tilt | 6.1-7.8° | 10 |
   275→| Eye Aspect Ratio | 3.0-3.5 | 15 |
   276→| Eye Separation | 45.7-46.8% | 10 |
   277→| IPD-Mouth Ratio | 0.83-0.87 | 10 |
   278→| Eyebrow Tilt | 6.5-11° | 10 |
   279→| Eyebrow Low Setedness | 0-0.45 | 10 |
   280→| Intercanthal-Nasal | 1.04-1.16 | 10 |
   281→| Nose Tip Position | 0.5-3.5mm | 2.5 |
   282→| Mouth/Nose Ratio | 1.43-1.51 | 10 |
   283→| Lower/Upper Lip | 1.58-1.88 | 7.5 |
   284→| Chin/Philtrum | 2.15-2.45 | 12.5 |
   285→| IAA-JFA Deviation | 0-2.5° | 10 |
   286→| Neck Width | 92-98% | 10 |
   287→
   288→### Side Profile (Updated ideal ranges)
   289→| Metric | New Ideal |
   290→|--------|-----------|
   291→| Nasofrontal Angle | 116-128° |
   292→| Nasofacial Angle | 31-35° |
   293→| Nasomental Angle | 126-131° |
   294→| Submental Cervical | 94-106° |
   295→| Facial Depth/Height | 1.3-1.44 |
   296→| Anterior Facial Depth | 64.5-67.5° |
   297→| S-Line Lower Lip | -0.4 to 0.4mm |
   298→
   299→### New Metrics Added
   300→- Ipsilateral Alar Angle (front)
   301→- Ear Protrusion Angle (front)
   302→- Ear Protrusion Ratio (front)
   303→- Interior Midface Projection Angle (side)
   304→- Recession from Frankfort Plane (side)
   305→
   306→---
   307→
   308→## Commands Reference
   309→
   310→### Run Type Check
   311→```bash
   312→cd /Users/imorgado/LOOKSMAXX/looksmaxx-app && npx tsc --noEmit
   313→```
   314→
   315→### Run Lint
   316→```bash
   317→cd /Users/imorgado/LOOKSMAXX/looksmaxx-app && npm run lint
   318→```
   319→
   320→### Extract FaceIQ Data
   321→```bash
   322→# Extract metric configs from HTML
   323→cat "/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/FACEIQ-FRONT RATIOS.html" | sed 's/\\"/"/g' | grep -oE '"name":"[^"]+","value":[0-9.-]+.*?"idealMax":[0-9.-]+'
   324→
   325→# Extract flaw mappings
   326→cat "/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/FACEIQ-FRONT RATIOS.html" | sed 's/\\"/"/g' | grep -oE '"mayIndicateFlaws":\[\{[^]]+'
   327→
   328→# Extract custom curves
   329→cat "/Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/FACEIQ-FRONT RATIOS.html" | sed 's/\\"/"/g' | grep -oE '"customPoints":\[[^\]]+\]'
   330→```
   331→
   332→---
   333→
   334→## Continuation Prompt
   335→
   336→Use this prompt to continue this work:
   337→
   338→```
   339→Continue work on LOOKSMAXX FaceIQ parity. Read /Users/imorgado/LOOKSMAXX/fixit.md for context.
   340→
   341→Current priorities:
   342→1. Add detailed FLAW_MAPPINGS to faceiq-scoring.ts with FaceIQ's structure (category, flawName, confidence, severity, reasoning)
   343→2. Extract and add custom Bezier curves for all metrics from the FaceIQ HTML files
   344→3. Update ResultsContext.tsx to use the new flaw mappings
   345→
   346→Reference data is in /Users/imorgado/Desktop/FACEIQCOPY/FACEIQPAID/
   347→
   348→Start with the flaw mappings - extract them from FACEIQ-FRONT RATIOS.html and create a comprehensive FLAW_MAPPINGS constant.
   349→```
   350→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
