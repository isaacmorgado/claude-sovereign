{"parentUuid":null,"isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","type":"user","message":{"role":"user","content":"Explore how the guide viewer/reader modal works when a guide is opened. Focus on:\n\n1. The GuideViewer component or modal that displays guide content\n2. State management for which guide is currently being viewed\n3. How the modal opens and closes\n4. Any early returns or conditions that might cause the modal to close unexpectedly\n\nLook in GuidesTab.tsx and any related modal components. Check for issues like:\n- State being reset unexpectedly\n- Modal closing on certain conditions\n- Guide content not rendering properly\n\nThis is a research task - do not write any code."},"uuid":"14ae404d-3643-48e2-b666-9063c775fb41","timestamp":"2025-12-27T12:31:43.574Z"}
{"parentUuid":"14ae404d-3643-48e2-b666-9063c775fb41","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01P1Su4MCFiRXEW6xq97VMPN","type":"message","role":"assistant","content":[{"type":"text","text":"I'll explore how the guide viewer/reader modal works by examining the relevant components. Let me start by searching for and reading the key files."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":36138,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":36138,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWXCLMT8DQnHxwBqL9aBj","type":"assistant","uuid":"0fbd216b-4ef6-4e01-959b-f1214575e663","timestamp":"2025-12-27T12:31:46.075Z"}
{"parentUuid":"0fbd216b-4ef6-4e01-959b-f1214575e663","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01P1Su4MCFiRXEW6xq97VMPN","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Aj9TKTMs8Z9JUw9vSBDxxn","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/GuidesTab.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":36138,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":36138,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWXCLMT8DQnHxwBqL9aBj","type":"assistant","uuid":"58df998b-277a-4a4e-90ba-c10c9d33311a","timestamp":"2025-12-27T12:31:46.515Z"}
{"parentUuid":"58df998b-277a-4a4e-90ba-c10c9d33311a","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01P1Su4MCFiRXEW6xq97VMPN","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018DiVEfh7sDvbsHkRreqnZM","name":"Glob","input":{"pattern":"**/GuideViewer*.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":36138,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":36138,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWXCLMT8DQnHxwBqL9aBj","type":"assistant","uuid":"e0e06fd1-7ebd-43c2-8c9f-017bb907c8fc","timestamp":"2025-12-27T12:31:46.716Z"}
{"parentUuid":"e0e06fd1-7ebd-43c2-8c9f-017bb907c8fc","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01P1Su4MCFiRXEW6xq97VMPN","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MMEifwFBmiBfdKVLng6Xpz","name":"Glob","input":{"pattern":"**/Guide*Modal*.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":36138,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":36138,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWXCLMT8DQnHxwBqL9aBj","type":"assistant","uuid":"ca58e02f-0893-41a3-9145-83f5edf67bde","timestamp":"2025-12-27T12:31:46.919Z"}
{"parentUuid":"ca58e02f-0893-41a3-9145-83f5edf67bde","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01P1Su4MCFiRXEW6xq97VMPN","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01E6Ch4hDXmRN99J6mHzCu59","name":"Glob","input":{"pattern":"src/components/results/modals/**/*.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":36138,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":36138,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWXCLMT8DQnHxwBqL9aBj","type":"assistant","uuid":"92f158d5-85ea-40ba-bde7-59f86151f3f8","timestamp":"2025-12-27T12:31:47.080Z"}
{"parentUuid":"92f158d5-85ea-40ba-bde7-59f86151f3f8","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Aj9TKTMs8Z9JUw9vSBDxxn","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useState, useCallback } from 'react';\n     4→import { motion, AnimatePresence } from 'framer-motion';\n     5→import {\n     6→  BookOpen,\n     7→  Dumbbell,\n     8→  Sparkles,\n     9→  Clock,\n    10→  ChevronRight,\n    11→  Search,\n    12→  Brain,\n    13→  Wrench,\n    14→  TrendingDown,\n    15→  Calendar,\n    16→  Target,\n    17→  Heart,\n    18→  Utensils,\n    19→  Droplet,\n    20→  X,\n    21→  ArrowLeft,\n    22→  MessageSquare,\n    23→  ExternalLink,\n    24→  ShoppingCart,\n    25→  CheckCircle2,\n    26→} from 'lucide-react';\n    27→import Image from 'next/image';\n    28→import Link from 'next/link';\n    29→import { TabContent } from '../ResultsLayout';\n    30→import {\n    31→  GUIDE_CATEGORIES,\n    32→  getGuidesByCategory,\n    33→  getTotalGuideCount,\n    34→  getTotalReadTime,\n    35→  getGuideProductById,\n    36→  getGuidesByGender,\n    37→} from '@/data/guides';\n    38→import { Guide, GuideCategory, GuideMedia } from '@/types/guides';\n    39→import { useRegion } from '@/contexts/RegionContext';\n    40→import { useResults } from '@/contexts/ResultsContext';\n    41→import ReactMarkdown from 'react-markdown';\n    42→import remarkGfm from 'remark-gfm';\n    43→\n    44→// ============================================\n    45→// ICON MAPPING\n    46→// ============================================\n    47→\n    48→const ICON_MAP: Record<string, React.ReactNode> = {\n    49→  BookOpen: <BookOpen size={20} />,\n    50→  Dumbbell: <Dumbbell size={20} />,\n    51→  Sparkles: <Sparkles size={20} />,\n    52→  Brain: <Brain size={20} />,\n    53→  Wrench: <Wrench size={20} />,\n    54→  TrendingDown: <TrendingDown size={20} />,\n    55→  Calendar: <Calendar size={20} />,\n    56→  Target: <Target size={20} />,\n    57→  Heart: <Heart size={20} />,\n    58→  Utensils: <Utensils size={20} />,\n    59→  Droplet: <Droplet size={20} />,\n    60→};\n    61→\n    62→function getIconComponent(iconName: string, size = 20): React.ReactNode {\n    63→  // Check icon map first\n    64→  const mappedIcon = ICON_MAP[iconName];\n    65→  if (mappedIcon) return mappedIcon;\n    66→\n    67→  // Fallback to BookOpen\n    68→  return <BookOpen size={size} />;\n    69→}\n    70→\n    71→// ============================================\n    72→// MEDIA RENDERER\n    73→// ============================================\n    74→\n    75→interface MediaRendererProps {\n    76→  media: GuideMedia;\n    77→}\n    78→\n    79→function MediaRenderer({ media }: MediaRendererProps) {\n    80→  const [hasError, setHasError] = useState(false);\n    81→  const [isLoading, setIsLoading] = useState(true);\n    82→\n    83→  const handleError = useCallback(() => {\n    84→    setHasError(true);\n    85→    setIsLoading(false);\n    86→  }, []);\n    87→\n    88→  const handleLoad = useCallback(() => {\n    89→    setIsLoading(false);\n    90→  }, []);\n    91→\n    92→  const placementClasses = {\n    93→    inline: 'max-w-lg mx-auto',\n    94→    hero: 'w-full',\n    95→    'full-width': 'w-full',\n    96→  };\n    97→\n    98→  const isGif = media.type === 'gif' || media.url.endsWith('.gif');\n    99→\n   100→  // Show styled placeholder if image failed to load or doesn't exist\n   101→  if (hasError) {\n   102→    return (\n   103→      <figure className={`my-10 ${placementClasses[media.placement || 'inline']}`}>\n   104→        <div className=\"relative rounded-2xl overflow-hidden bg-neutral-900/40 border border-white/5\">\n   105→          <div className=\"aspect-video flex items-center justify-center p-8\">\n   106→            <div className=\"text-center max-w-sm\">\n   107→              <div className=\"w-16 h-16 bg-cyan-500/10 rounded-2xl flex items-center justify-center mx-auto mb-4 border border-cyan-500/20\">\n   108→                {isGif ? (\n   109→                  <div className=\"w-6 h-6 border-2 border-cyan-400 border-t-transparent rounded-full animate-spin\" />\n   110→                ) : (\n   111→                  <Sparkles size={28} className=\"text-cyan-400\" />\n   112→                )}\n   113→              </div>\n   114→              <p className=\"text-neutral-300 font-black uppercase tracking-wider text-sm mb-2\">{media.alt}</p>\n   115→              {media.caption && (\n   116→                <p className=\"text-neutral-600 text-xs\">{media.caption}</p>\n   117→              )}\n   118→            </div>\n   119→          </div>\n   120→        </div>\n   121→      </figure>\n   122→    );\n   123→  }\n   124→\n   125→  return (\n   126→    <figure className={`my-10 ${placementClasses[media.placement || 'inline']}`}>\n   127→      <div className=\"relative rounded-2xl overflow-hidden bg-neutral-900/40 border border-white/5\">\n   128→        {/* Loading skeleton */}\n   129→        {isLoading && (\n   130→          <div className=\"absolute inset-0 bg-neutral-900/40 animate-pulse flex items-center justify-center\">\n   131→            <div className=\"w-8 h-8 border-2 border-cyan-500 border-t-transparent rounded-full animate-spin\" />\n   132→          </div>\n   133→        )}\n   134→\n   135→        {isGif ? (\n   136→          // Use img for GIFs to preserve animation\n   137→          // eslint-disable-next-line @next/next/no-img-element\n   138→          <img\n   139→            src={media.url}\n   140→            alt={media.alt}\n   141→            className={`w-full h-auto max-h-[400px] object-contain transition-opacity duration-300 ${isLoading ? 'opacity-0' : 'opacity-100'}`}\n   142→            loading=\"lazy\"\n   143→            onError={handleError}\n   144→            onLoad={handleLoad}\n   145→          />\n   146→        ) : (\n   147→          <Image\n   148→            src={media.url}\n   149→            alt={media.alt}\n   150→            width={media.width || 800}\n   151→            height={media.height || 450}\n   152→            className={`w-full h-auto max-h-[400px] object-contain transition-opacity duration-300 ${isLoading ? 'opacity-0' : 'opacity-100'}`}\n   153→            onError={handleError}\n   154→            onLoad={handleLoad}\n   155→          />\n   156→        )}\n   157→      </div>\n   158→      {media.caption && (\n   159→        <figcaption className=\"mt-4 text-center text-[10px] font-black uppercase tracking-widest text-neutral-600\">\n   160→          {media.caption}\n   161→        </figcaption>\n   162→      )}\n   163→    </figure>\n   164→  );\n   165→}\n   166→\n   167→// ============================================\n   168→// PRODUCT CALLOUT (CONVERSION OPTIMIZED)\n   169→// ============================================\n   170→\n   171→interface ProductCalloutProps {\n   172→  productId: string;\n   173→}\n   174→\n   175→function ProductCallout({ productId }: ProductCalloutProps) {\n   176→  const { getLink } = useRegion();\n   177→  const product = getGuideProductById(productId);\n   178→  const [hasError, setHasError] = useState(false);\n   179→  const [isLoading, setIsLoading] = useState(true);\n   180→\n   181→  if (!product) return null;\n   182→\n   183→  const link = getLink(product.regionLinks, product.directLink);\n   184→\n   185→  return (\n   186→    <div className=\"my-6 p-5 rounded-2xl bg-neutral-900/40 border border-white/5 hover:border-cyan-500/20 transition-all\">\n   187→      <div className=\"flex items-center gap-4\">\n   188→        {/* Product Image */}\n   189→        <div className=\"w-16 h-16 rounded-xl bg-neutral-900 border border-white/10 overflow-hidden flex-shrink-0 relative\">\n   190→          {isLoading && !hasError && product.imageUrl && (\n   191→            <div className=\"absolute inset-0 bg-neutral-900/60 animate-pulse flex items-center justify-center z-10\">\n   192→              <div className=\"w-4 h-4 border-2 border-cyan-500 border-t-transparent rounded-full animate-spin\" />\n   193→            </div>\n   194→          )}\n   195→          {hasError || !product.imageUrl ? (\n   196→            <div className=\"w-full h-full flex items-center justify-center bg-neutral-900\">\n   197→              <ShoppingCart size={20} className=\"text-neutral-600\" />\n   198→            </div>\n   199→          ) : (\n   200→            <Image\n   201→              src={product.imageUrl}\n   202→              alt={product.name}\n   203→              width={64}\n   204→              height={64}\n   205→              className={`w-full h-full object-cover transition-opacity ${isLoading ? 'opacity-0' : 'opacity-100'}`}\n   206→              onLoad={() => setIsLoading(false)}\n   207→              onError={() => { setHasError(true); setIsLoading(false); }}\n   208→              unoptimized\n   209→            />\n   210→          )}\n   211→        </div>\n   212→\n   213→        {/* Product Info */}\n   214→        <div className=\"flex-1 min-w-0\">\n   215→          <div className=\"flex items-center gap-2 mb-1\">\n   216→            <h4 className=\"font-black uppercase tracking-wide text-white truncate\">{product.name}</h4>\n   217→            {product.brand && (\n   218→              <span className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600\">{product.brand}</span>\n   219→            )}\n   220→          </div>\n   221→          <p className=\"text-sm text-cyan-400 italic\">&ldquo;{product.tagline}&rdquo;</p>\n   222→        </div>\n   223→\n   224→        {/* CTA Button */}\n   225→        <a\n   226→          href={link}\n   227→          target=\"_blank\"\n   228→          rel=\"noopener noreferrer\"\n   229→          className=\"flex-shrink-0 flex items-center gap-2 px-5 py-2.5 rounded-xl bg-cyan-500 hover:bg-cyan-400 text-black font-black uppercase tracking-wider text-xs transition-colors\"\n   230→        >\n   231→          <ShoppingCart size={14} />\n   232→          <span className=\"hidden sm:inline\">BUY</span>\n   233→        </a>\n   234→      </div>\n   235→    </div>\n   236→  );\n   237→}\n   238→\n   239→// ============================================\n   240→// FORUM DISCUSSION LINK\n   241→// ============================================\n   242→\n   243→interface ForumDiscussionLinkProps {\n   244→  forumCategory?: string;\n   245→  guideTitle: string;\n   246→}\n   247→\n   248→function ForumDiscussionLink({ forumCategory, guideTitle }: ForumDiscussionLinkProps) {\n   249→  if (!forumCategory) return null;\n   250→\n   251→  return (\n   252→    <div className=\"mt-8 p-6 rounded-2xl bg-neutral-900/40 border border-white/5\">\n   253→      <div className=\"flex items-center gap-3 mb-4\">\n   254→        <div className=\"w-10 h-10 rounded-xl bg-purple-500/10 border border-purple-500/20 flex items-center justify-center\">\n   255→          <MessageSquare size={20} className=\"text-purple-400\" />\n   256→        </div>\n   257→        <div>\n   258→          <h3 className=\"font-black uppercase tracking-wide text-white\">DISCUSS THIS GUIDE</h3>\n   259→          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600\">Join the community conversation</p>\n   260→        </div>\n   261→      </div>\n   262→\n   263→      <p className=\"text-sm text-neutral-400 mb-5\">\n   264→        Have questions about {guideTitle.toLowerCase()}? Want to share your experience?\n   265→        Join the discussion in our community forum.\n   266→      </p>\n   267→\n   268→      <Link\n   269→        href={`/forum/${forumCategory}`}\n   270→        className=\"inline-flex items-center gap-2 px-5 py-2.5 rounded-xl bg-neutral-900/50 border border-white/5 hover:border-purple-500/30 text-purple-400 font-black uppercase tracking-wider text-xs transition-all\"\n   271→      >\n   272→        <MessageSquare size={14} />\n   273→        GO TO FORUM\n   274→        <ExternalLink size={12} />\n   275→      </Link>\n   276→    </div>\n   277→  );\n   278→}\n   279→\n   280→// ============================================\n   281→// GUIDE STATS CARD\n   282→// ============================================\n   283→\n   284→function GuideStatsCard() {\n   285→  const totalGuides = getTotalGuideCount();\n   286→  const totalMinutes = getTotalReadTime();\n   287→\n   288→  return (\n   289→    <motion.div\n   290→      className=\"rounded-[2rem] bg-neutral-900/40 border border-white/5 p-6 mb-8\"\n   291→      initial={{ opacity: 0, y: 20 }}\n   292→      animate={{ opacity: 1, y: 0 }}\n   293→    >\n   294→      <div className=\"flex items-center gap-4 mb-6\">\n   295→        <div className=\"w-12 h-12 rounded-xl bg-neutral-900 border border-white/10 flex items-center justify-center\">\n   296→          <BookOpen size={22} className=\"text-cyan-400\" />\n   297→        </div>\n   298→        <div>\n   299→          <h2 className=\"text-xl font-black italic uppercase tracking-tight text-white\">PRODUCT <span className=\"text-cyan-400\">GUIDES</span></h2>\n   300→          <p className=\"text-[10px] font-black uppercase tracking-[0.2em] text-neutral-600\">EVIDENCE-BASED LOOKSMAXXING RESOURCES</p>\n   301→        </div>\n   302→      </div>\n   303→\n   304→      <div className=\"grid grid-cols-2 gap-4\">\n   305→        <div className=\"rounded-xl bg-neutral-900/50 border border-white/5 p-4\">\n   306→          <div className=\"text-3xl font-black text-white mb-1\">{totalGuides}</div>\n   307→          <div className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600\">TOTAL GUIDES</div>\n   308→        </div>\n   309→        <div className=\"rounded-xl bg-neutral-900/50 border border-white/5 p-4\">\n   310→          <div className=\"flex items-center gap-2 mb-1\">\n   311→            <Clock size={18} className=\"text-cyan-400\" />\n   312→            <div className=\"text-3xl font-black text-white\">{totalMinutes}</div>\n   313→          </div>\n   314→          <div className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600\">MINUTES OF CONTENT</div>\n   315→        </div>\n   316→      </div>\n   317→    </motion.div>\n   318→  );\n   319→}\n   320→\n   321→// ============================================\n   322→// GUIDE VIEWER MODAL\n   323→// ============================================\n   324→\n   325→interface GuideViewerProps {\n   326→  guide: Guide;\n   327→  onClose: () => void;\n   328→  onSwitchGuide: (guide: Guide) => void;\n   329→  allGuides: Guide[];\n   330→  gender: 'male' | 'female';\n   331→}\n   332→\n   333→function GuideViewer({ guide, onClose, onSwitchGuide, allGuides, gender }: GuideViewerProps) {\n   334→  const [currentSection, setCurrentSection] = useState(0);\n   335→  const [isSidebarOpen, setIsSidebarOpen] = useState(false);\n   336→  const [expandedCategories, setExpandedCategories] = useState<string[]>(() => {\n   337→    // Find the category of the current guide and expand it by default\n   338→    const currentCategory = GUIDE_CATEGORIES.find(c => c.guideIds.includes(guide.id));\n   339→    return currentCategory ? [currentCategory.id] : [];\n   340→  });\n   341→\n   342→  const section = guide.sections[currentSection];\n   343→\n   344→  if (!section) return null;\n   345→\n   346→  // Calculate reading progress (0% at start, 100% at last section)\n   347→  const progress = guide.sections.length > 1\n   348→    ? (currentSection / (guide.sections.length - 1)) * 100\n   349→    : 100;\n   350→\n   351→  const toggleCategory = (categoryId: string) => {\n   352→    setExpandedCategories(prev =>\n   353→      prev.includes(categoryId)\n   354→        ? prev.filter(id => id !== categoryId)\n   355→        : [...prev, categoryId]\n   356→    );\n   357→  };\n   358→\n   359→  // Filter categories by gender\n   360→  const filteredCategories = GUIDE_CATEGORIES.filter(cat => {\n   361→    if (cat.id === 'male' && gender === 'female') return false;\n   362→    if (cat.id === 'female' && gender === 'male') return false;\n   363→    return true;\n   364→  });\n   365→\n   366→  const colorClasses: Record<string, { text: string; bg: string; border: string }> = {\n   367→    blue: { text: 'text-cyan-400', bg: 'bg-cyan-500/10', border: 'border-cyan-500/20' },\n   368→    purple: { text: 'text-purple-400', bg: 'bg-purple-500/10', border: 'border-purple-500/20' },\n   369→    amber: { text: 'text-amber-400', bg: 'bg-amber-500/10', border: 'border-amber-500/20' },\n   370→    pink: { text: 'text-pink-400', bg: 'bg-pink-500/10', border: 'border-pink-500/20' },\n   371→    emerald: { text: 'text-emerald-400', bg: 'bg-emerald-500/10', border: 'border-emerald-500/20' },\n   372→    red: { text: 'text-red-400', bg: 'bg-red-500/10', border: 'border-red-500/20' },\n   373→  };\n   374→\n   375→  return (\n   376→    <motion.div\n   377→      initial={{ opacity: 0 }}\n   378→      animate={{ opacity: 1 }}\n   379→      exit={{ opacity: 0 }}\n   380→      className=\"fixed inset-0 z-50 bg-black\"\n   381→    >\n   382→      {/* Header */}\n   383→      <div className=\"sticky top-0 z-20 bg-black/95 backdrop-blur-md border-b border-neutral-900\">\n   384→        <div className=\"flex items-center justify-between px-4 lg:px-8 py-3\">\n   385→          <button\n   386→            onClick={onClose}\n   387→            className=\"flex items-center gap-2 text-neutral-500 hover:text-cyan-400 text-xs font-black uppercase tracking-widest transition-colors\"\n   388→          >\n   389→            <ArrowLeft size={14} />\n   390→            <span className=\"hidden sm:inline\">BACK TO GUIDES</span>\n   391→          </button>\n   392→\n   393→          {/* Progress bar */}\n   394→          <div className=\"hidden md:flex items-center gap-4 flex-1 max-w-md mx-8\">\n   395→            <div className=\"flex-1 h-1 bg-neutral-900 rounded-full overflow-hidden\">\n   396→              <motion.div\n   397→                className=\"h-full bg-gradient-to-r from-cyan-500 to-cyan-400\"\n   398→                initial={{ width: 0 }}\n   399→                animate={{ width: `${progress}%` }}\n   400→                transition={{ duration: 0.3 }}\n   401→              />\n   402→            </div>\n   403→            <span className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600 whitespace-nowrap\">\n   404→              {currentSection + 1} / {guide.sections.length}\n   405→            </span>\n   406→          </div>\n   407→\n   408→          <div className=\"flex items-center gap-3\">\n   409→            {/* Mobile menu button */}\n   410→            <button\n   411→              onClick={() => setIsSidebarOpen(!isSidebarOpen)}\n   412→              className=\"lg:hidden p-2 rounded-xl bg-neutral-900/50 border border-white/5 hover:border-white/10 transition-colors\"\n   413→            >\n   414→              <BookOpen size={18} className=\"text-neutral-400\" />\n   415→            </button>\n   416→            <button\n   417→              onClick={onClose}\n   418→              className=\"p-2 rounded-xl bg-neutral-900/50 border border-white/5 hover:border-white/10 transition-colors\"\n   419→            >\n   420→              <X size={18} className=\"text-neutral-400\" />\n   421→            </button>\n   422→          </div>\n   423→        </div>\n   424→      </div>\n   425→\n   426→      {/* Main Layout: Sidebar + Content */}\n   427→      <div className=\"flex h-[calc(100vh-57px)]\">\n   428→        {/* Sidebar Navigation */}\n   429→        <aside\n   430→          className={`\n   431→            fixed lg:relative inset-y-0 left-0 z-30 lg:z-0\n   432→            w-72 lg:w-80 bg-black lg:bg-neutral-950/50\n   433→            border-r border-neutral-900\n   434→            transform transition-transform duration-300 ease-in-out\n   435→            ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}\n   436→            flex flex-col\n   437→          `}\n   438→        >\n   439→          {/* Sidebar Header */}\n   440→          <div className=\"p-4 border-b border-neutral-900\">\n   441→            <div className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-2\">\n   442→              ALL GUIDES\n   443→            </div>\n   444→            <p className=\"text-xs text-neutral-500\">Select a lesson below</p>\n   445→          </div>\n   446→\n   447→          {/* Categories & Guides List */}\n   448→          <nav className=\"flex-1 overflow-y-auto p-3\">\n   449→            {filteredCategories.map(category => {\n   450→              const categoryGuides = allGuides.filter(g => category.guideIds.includes(g.id));\n   451→              if (categoryGuides.length === 0) return null;\n   452→\n   453→              const isExpanded = expandedCategories.includes(category.id);\n   454→              const styles = colorClasses[category.color] || colorClasses.blue;\n   455→              const hasCurrentGuide = categoryGuides.some(g => g.id === guide.id);\n   456→\n   457→              return (\n   458→                <div key={category.id} className=\"mb-2\">\n   459→                  {/* Category Header */}\n   460→                  <button\n   461→                    onClick={() => toggleCategory(category.id)}\n   462→                    className={`\n   463→                      w-full text-left px-3 py-3 rounded-xl transition-all\n   464→                      flex items-center gap-3 group\n   465→                      ${hasCurrentGuide ? `${styles.bg} border ${styles.border}` : 'hover:bg-neutral-900/50 border border-transparent'}\n   466→                    `}\n   467→                  >\n   468→                    <div className={`w-8 h-8 rounded-xl ${styles.bg} border ${styles.border} flex items-center justify-center ${styles.text} flex-shrink-0`}>\n   469→                      {getIconComponent(category.icon, 16)}\n   470→                    </div>\n   471→                    <div className=\"flex-1 min-w-0\">\n   472→                      <span className={`text-xs font-black uppercase tracking-wide block ${hasCurrentGuide ? 'text-white' : 'text-neutral-400 group-hover:text-white'}`}>\n   473→                        {category.name}\n   474→                      </span>\n   475→                      <span className=\"text-[10px] text-neutral-600\">\n   476→                        {categoryGuides.length} guide{categoryGuides.length !== 1 ? 's' : ''}\n   477→                      </span>\n   478→                    </div>\n   479→                    <ChevronRight\n   480→                      size={14}\n   481→                      className={`${styles.text} transition-transform ${isExpanded ? 'rotate-90' : ''}`}\n   482→                    />\n   483→                  </button>\n   484→\n   485→                  {/* Guides List (collapsible) */}\n   486→                  <AnimatePresence>\n   487→                    {isExpanded && (\n   488→                      <motion.ul\n   489→                        initial={{ height: 0, opacity: 0 }}\n   490→                        animate={{ height: 'auto', opacity: 1 }}\n   491→                        exit={{ height: 0, opacity: 0 }}\n   492→                        transition={{ duration: 0.2 }}\n   493→                        className=\"overflow-hidden ml-4 mt-1 space-y-0.5\"\n   494→                      >\n   495→                        {categoryGuides.map(g => {\n   496→                          const isCurrentGuide = g.id === guide.id;\n   497→                          return (\n   498→                            <li key={g.id}>\n   499→                              <button\n   500→                                onClick={() => {\n   501→                                  if (isCurrentGuide) {\n   502→                                    // Already on this guide, just close sidebar on mobile\n   503→                                    setIsSidebarOpen(false);\n   504→                                  } else {\n   505→                                    onSwitchGuide(g);\n   506→                                    setIsSidebarOpen(false);\n   507→                                  }\n   508→                                }}\n   509→                                className={`\n   510→                                  w-full text-left px-3 py-2 rounded-lg transition-all\n   511→                                  flex items-center gap-2 group\n   512→                                  ${isCurrentGuide\n   513→                                    ? `${styles.bg} border ${styles.border}`\n   514→                                    : 'hover:bg-neutral-900/30 border border-transparent'\n   515→                                  }\n   516→                                `}\n   517→                              >\n   518→                                <span className={`w-1.5 h-1.5 rounded-full flex-shrink-0 ${isCurrentGuide ? styles.text.replace('text-', 'bg-') : 'bg-neutral-700'}`} />\n   519→                                <span className={`text-xs font-medium truncate ${isCurrentGuide ? 'text-white' : 'text-neutral-500 group-hover:text-neutral-300'}`}>\n   520→                                  {g.title}\n   521→                                </span>\n   522→                                {isCurrentGuide && (\n   523→                                  <span className=\"ml-auto text-[8px] font-black uppercase tracking-wider text-neutral-600\">\n   524→                                    VIEWING\n   525→                                  </span>\n   526→                                )}\n   527→                              </button>\n   528→                            </li>\n   529→                          );\n   530→                        })}\n   531→                      </motion.ul>\n   532→                    )}\n   533→                  </AnimatePresence>\n   534→                </div>\n   535→              );\n   536→            })}\n   537→          </nav>\n   538→\n   539→          {/* Current Guide Sections */}\n   540→          <div className=\"border-t border-neutral-900\">\n   541→            <div className=\"p-3\">\n   542→              <div className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-3 px-2 flex items-center gap-2\">\n   543→                <BookOpen size={10} />\n   544→                SECTIONS\n   545→              </div>\n   546→              <ul className=\"space-y-0.5 max-h-48 overflow-y-auto\">\n   547→                {guide.sections.map((s, idx) => (\n   548→                  <li key={s.id}>\n   549→                    <button\n   550→                      onClick={() => {\n   551→                        setCurrentSection(idx);\n   552→                        setIsSidebarOpen(false);\n   553→                      }}\n   554→                      className={`\n   555→                        w-full text-left px-3 py-2 rounded-lg transition-all\n   556→                        flex items-center gap-2 group\n   557→                        ${currentSection === idx\n   558→                          ? 'bg-cyan-500/10 border border-cyan-500/20'\n   559→                          : 'hover:bg-neutral-900/30 border border-transparent'\n   560→                        }\n   561→                      `}\n   562→                    >\n   563→                      <span\n   564→                        className={`\n   565→                          flex-shrink-0 w-5 h-5 rounded text-[9px] font-black\n   566→                          flex items-center justify-center transition-colors\n   567→                          ${currentSection === idx\n   568→                            ? 'bg-cyan-500 text-black'\n   569→                            : idx < currentSection\n   570→                              ? 'bg-green-500/20 text-green-400'\n   571→                              : 'bg-neutral-900 border border-white/10 text-neutral-600'\n   572→                          }\n   573→                        `}\n   574→                      >\n   575→                        {idx < currentSection ? <CheckCircle2 size={10} /> : idx + 1}\n   576→                      </span>\n   577→                      <span className={`text-[10px] font-bold uppercase tracking-wide truncate ${currentSection === idx ? 'text-white' : 'text-neutral-500'}`}>\n   578→                        {s.title}\n   579→                      </span>\n   580→                    </button>\n   581→                  </li>\n   582→                ))}\n   583→              </ul>\n   584→            </div>\n   585→          </div>\n   586→\n   587→          {/* Sidebar Footer */}\n   588→          <div className=\"p-4 border-t border-neutral-900\">\n   589→            <div className=\"flex items-center justify-between text-[10px] font-black uppercase tracking-widest text-neutral-600 mb-2\">\n   590→              <span>PROGRESS</span>\n   591→              <span>{Math.round(progress)}%</span>\n   592→            </div>\n   593→            <div className=\"h-1.5 bg-neutral-900 rounded-full overflow-hidden\">\n   594→              <motion.div\n   595→                className=\"h-full bg-gradient-to-r from-cyan-500 to-green-500\"\n   596→                animate={{ width: `${progress}%` }}\n   597→              />\n   598→            </div>\n   599→          </div>\n   600→        </aside>\n   601→\n   602→        {/* Mobile sidebar overlay */}\n   603→        {isSidebarOpen && (\n   604→          <div\n   605→            className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-20 lg:hidden\"\n   606→            onClick={() => setIsSidebarOpen(false)}\n   607→          />\n   608→        )}\n   609→\n   610→        {/* Main Content Area */}\n   611→        <main className=\"flex-1 overflow-y-auto\">\n   612→          <article className=\"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-10 lg:py-16\">\n   613→            {/* Hero Media (only on first section) */}\n   614→            {guide.heroMedia && currentSection === 0 && (\n   615→              <div className=\"mb-10\">\n   616→                <MediaRenderer media={guide.heroMedia} />\n   617→              </div>\n   618→            )}\n   619→\n   620→            {/* Article Header (only on first section) */}\n   621→            {currentSection === 0 && (\n   622→              <header className=\"mb-12\">\n   623→                <div className=\"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-cyan-500/10 border border-cyan-500/20 text-[10px] font-black uppercase tracking-widest text-cyan-400 mb-6\">\n   624→                  {getIconComponent(guide.icon, 12)}\n   625→                  <span>GUIDE</span>\n   626→                </div>\n   627→\n   628→                <h1 className=\"text-3xl md:text-4xl font-black tracking-tighter italic uppercase text-white mb-4 leading-tight\">\n   629→                  {guide.title.split(' ').slice(0, -1).join(' ')} <span className=\"text-cyan-400\">{guide.title.split(' ').slice(-1)}</span>\n   630→                </h1>\n   631→\n   632→                <p className=\"text-neutral-400 text-base leading-relaxed\">\n   633→                  {guide.description}\n   634→                </p>\n   635→              </header>\n   636→            )}\n   637→\n   638→            {/* Section Content */}\n   639→            <AnimatePresence mode=\"wait\">\n   640→              <motion.section\n   641→                key={section.id}\n   642→                initial={{ opacity: 0, x: 20 }}\n   643→                animate={{ opacity: 1, x: 0 }}\n   644→                exit={{ opacity: 0, x: -20 }}\n   645→                transition={{ duration: 0.3 }}\n   646→              >\n   647→                {/* Section Title - Largest heading in section content */}\n   648→                <h2 className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-8 flex items-center gap-4\">\n   649→                  {section.title}\n   650→                  <div className=\"flex-1 h-px bg-neutral-800\" />\n   651→                </h2>\n   652→\n   653→                {/* Tips Callout */}\n   654→                {section.tips && section.tips.length > 0 && (\n   655→                  <aside className=\"mb-10 p-6 rounded-2xl bg-cyan-500/5 border border-cyan-500/10\">\n   656→                    <h4 className=\"text-[10px] font-black uppercase tracking-[0.3em] text-cyan-400 mb-4\">\n   657→                      QUICK TIPS\n   658→                    </h4>\n   659→                    <ul className=\"space-y-3\">\n   660→                      {section.tips.map((tip, i) => (\n   661→                        <li key={i} className=\"flex items-start gap-3 text-neutral-300\">\n   662→                          <span className=\"flex-shrink-0 w-5 h-5 bg-cyan-500/20 rounded-lg flex items-center justify-center mt-0.5\">\n   663→                            <span className=\"text-cyan-400 text-[10px] font-black\">{i + 1}</span>\n   664→                          </span>\n   665→                          <span className=\"leading-relaxed text-sm\">{tip}</span>\n   666→                        </li>\n   667→                      ))}\n   668→                    </ul>\n   669→                  </aside>\n   670→                )}\n   671→\n   672→                {/* Warnings Callout */}\n   673→                {section.warnings && section.warnings.length > 0 && (\n   674→                  <aside className=\"mb-10 p-6 rounded-2xl bg-amber-500/5 border border-amber-500/10\">\n   675→                    <h4 className=\"text-[10px] font-black uppercase tracking-[0.3em] text-amber-400 mb-4\">\n   676→                      IMPORTANT\n   677→                    </h4>\n   678→                    <ul className=\"space-y-3\">\n   679→                      {section.warnings.map((warning, i) => (\n   680→                        <li key={i} className=\"flex items-start gap-3 text-neutral-300\">\n   681→                          <span className=\"text-amber-400 mt-1\">*</span>\n   682→                          <span className=\"leading-relaxed text-sm\">{warning}</span>\n   683→                        </li>\n   684→                      ))}\n   685→                    </ul>\n   686→                  </aside>\n   687→                )}\n   688→\n   689→                {/* Hero Media for Section */}\n   690→                {section.media && section.media.filter(m => m.placement === 'hero').map(media => (\n   691→                  <div key={media.id} className=\"mb-10\">\n   692→                    <MediaRenderer media={media} />\n   693→                  </div>\n   694→                ))}\n   695→\n   696→                {/* Article Body - Custom Markdown Rendering */}\n   697→                <div className=\"article-content\">\n   698→                  <ReactMarkdown\n   699→                    remarkPlugins={[remarkGfm]}\n   700→                    components={{\n   701→                      // Paragraphs with generous spacing\n   702→                      p: ({ children }) => (\n   703→                        <p className=\"text-neutral-400 text-base leading-[1.8] mb-6 font-medium\">\n   704→                          {children}\n   705→                        </p>\n   706→                      ),\n   707→                      // Headers with clear hierarchy (smaller than section title)\n   708→                      h1: ({ children }) => (\n   709→                        <h3 className=\"text-xl font-black italic uppercase text-white mt-12 mb-6 tracking-tight flex items-center gap-3\">\n   710→                          <span className=\"w-1.5 h-8 bg-cyan-500 rounded-full\" />\n   711→                          {children}\n   712→                        </h3>\n   713→                      ),\n   714→                      h2: ({ children }) => (\n   715→                        <div className=\"mt-10 mb-6 p-4 rounded-xl bg-neutral-900/60 border border-white/5\">\n   716→                          <h4 className=\"text-base font-black uppercase text-cyan-400 tracking-wide flex items-center gap-2\">\n   717→                            <span className=\"w-2 h-2 bg-cyan-400 rounded-full\" />\n   718→                            {children}\n   719→                          </h4>\n   720→                        </div>\n   721→                      ),\n   722→                      h3: ({ children }) => (\n   723→                        <h5 className=\"text-sm font-black uppercase text-white mt-8 mb-4 tracking-wide pl-4 border-l-2 border-purple-500/50\">\n   724→                          {children}\n   725→                        </h5>\n   726→                      ),\n   727→                      // Strong text\n   728→                      strong: ({ children }) => (\n   729→                        <strong className=\"font-black text-white\">\n   730→                          {children}\n   731→                        </strong>\n   732→                      ),\n   733→                      // Emphasis\n   734→                      em: ({ children }) => (\n   735→                        <em className=\"text-neutral-500 not-italic\">\n   736→                          {children}\n   737→                        </em>\n   738→                      ),\n   739→                      // Lists with proper spacing\n   740→                      ul: ({ children }) => (\n   741→                        <ul className=\"my-6 ml-0 space-y-3\">\n   742→                          {children}\n   743→                        </ul>\n   744→                      ),\n   745→                      ol: ({ children }) => (\n   746→                        <ol className=\"my-6 ml-0 space-y-3 list-decimal list-inside\">\n   747→                          {children}\n   748→                        </ol>\n   749→                      ),\n   750→                      li: ({ children }) => (\n   751→                        <li className=\"text-neutral-400 text-base leading-[1.8] flex items-start gap-3 font-medium\">\n   752→                          <span className=\"text-cyan-500 mt-1.5 flex-shrink-0\">*</span>\n   753→                          <span>{children}</span>\n   754→                        </li>\n   755→                      ),\n   756→                      // Tables - styled beautifully\n   757→                      table: ({ children }) => (\n   758→                        <div className=\"my-8 overflow-x-auto rounded-2xl border border-white/5\">\n   759→                          <table className=\"w-full text-left\">\n   760→                            {children}\n   761→                          </table>\n   762→                        </div>\n   763→                      ),\n   764→                      thead: ({ children }) => (\n   765→                        <thead className=\"bg-neutral-900/80 border-b border-white/5\">\n   766→                          {children}\n   767→                        </thead>\n   768→                      ),\n   769→                      tbody: ({ children }) => (\n   770→                        <tbody className=\"divide-y divide-white/5\">\n   771→                          {children}\n   772→                        </tbody>\n   773→                      ),\n   774→                      tr: ({ children }) => (\n   775→                        <tr className=\"hover:bg-neutral-900/50 transition-colors\">\n   776→                          {children}\n   777→                        </tr>\n   778→                      ),\n   779→                      th: ({ children }) => (\n   780→                        <th className=\"px-4 py-3 text-[10px] font-black uppercase tracking-widest text-cyan-400\">\n   781→                          {children}\n   782→                        </th>\n   783→                      ),\n   784→                      td: ({ children }) => (\n   785→                        <td className=\"px-4 py-3 text-neutral-400 text-sm font-medium\">\n   786→                          {children}\n   787→                        </td>\n   788→                      ),\n   789→                      // Blockquotes\n   790→                      blockquote: ({ children }) => (\n   791→                        <blockquote className=\"my-8 pl-6 border-l-2 border-cyan-500 bg-neutral-900/30 py-4 pr-6 rounded-r-xl\">\n   792→                          {children}\n   793→                        </blockquote>\n   794→                      ),\n   795→                      // Code\n   796→                      code: ({ children }) => (\n   797→                        <code className=\"text-cyan-400 bg-neutral-900 px-2 py-1 rounded-lg text-sm font-mono\">\n   798→                          {children}\n   799→                        </code>\n   800→                      ),\n   801→                      // Links\n   802→                      a: ({ href, children }) => (\n   803→                        <a\n   804→                          href={href}\n   805→                          className=\"text-cyan-400 hover:text-cyan-300 underline underline-offset-4 decoration-cyan-500/30 hover:decoration-cyan-400 transition-colors font-bold\"\n   806→                          target=\"_blank\"\n   807→                          rel=\"noopener noreferrer\"\n   808→                        >\n   809→                          {children}\n   810→                        </a>\n   811→                      ),\n   812→                      // Horizontal rule\n   813→                      hr: () => (\n   814→                        <hr className=\"my-10 border-neutral-900\" />\n   815→                      ),\n   816→                    }}\n   817→                  >\n   818→                    {section.content}\n   819→                  </ReactMarkdown>\n   820→                </div>\n   821→\n   822→                {/* Inline Media */}\n   823→                {section.media && section.media.filter(m => m.placement !== 'hero').map(media => (\n   824→                  <div key={media.id} className=\"my-10\">\n   825→                    <MediaRenderer media={media} />\n   826→                  </div>\n   827→                ))}\n   828→\n   829→                {/* Product Recommendations */}\n   830→                {section.products && section.products.length > 0 && (\n   831→                  <div className=\"mt-12 pt-8 border-t border-neutral-900\">\n   832→                    <h4 className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-6 flex items-center gap-4\">\n   833→                      RECOMMENDED PRODUCTS\n   834→                      <div className=\"flex-1 h-px bg-neutral-800\" />\n   835→                    </h4>\n   836→                    <div className=\"space-y-4\">\n   837→                      {section.products.map(productId => (\n   838→                        <ProductCallout key={productId} productId={productId} />\n   839→                      ))}\n   840→                    </div>\n   841→                  </div>\n   842→                )}\n   843→\n   844→                {/* Section Navigation */}\n   845→                <nav className=\"flex items-center justify-between mt-16 pt-8 border-t border-neutral-900\">\n   846→                  <button\n   847→                    onClick={() => setCurrentSection(Math.max(0, currentSection - 1))}\n   848→                    disabled={currentSection === 0}\n   849→                    className={`flex items-center gap-3 group transition-all ${currentSection === 0\n   850→                      ? 'text-neutral-800 cursor-not-allowed'\n   851→                      : 'text-neutral-500 hover:text-white'\n   852→                      }`}\n   853→                  >\n   854→                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center transition-colors ${currentSection === 0 ? 'bg-neutral-900/30' : 'bg-neutral-900/50 border border-white/5 group-hover:border-white/10'\n   855→                      }`}>\n   856→                      <ArrowLeft size={18} />\n   857→                    </div>\n   858→                    <div className=\"hidden sm:block text-left\">\n   859→                      <div className=\"text-[10px] font-black uppercase tracking-widest text-neutral-700 mb-1\">PREVIOUS</div>\n   860→                      {currentSection > 0 && (\n   861→                        <div className=\"text-xs font-bold uppercase tracking-wide text-neutral-400\">{guide.sections[currentSection - 1].title}</div>\n   862→                      )}\n   863→                    </div>\n   864→                  </button>\n   865→\n   866→                  <button\n   867→                    onClick={() => setCurrentSection(Math.min(guide.sections.length - 1, currentSection + 1))}\n   868→                    disabled={currentSection === guide.sections.length - 1}\n   869→                    className={`flex items-center gap-3 group transition-all ${currentSection === guide.sections.length - 1\n   870→                      ? 'text-neutral-800 cursor-not-allowed'\n   871→                      : 'text-neutral-500 hover:text-white'\n   872→                      }`}\n   873→                  >\n   874→                    <div className=\"hidden sm:block text-right\">\n   875→                      <div className=\"text-[10px] font-black uppercase tracking-widest text-neutral-700 mb-1\">NEXT</div>\n   876→                      {currentSection < guide.sections.length - 1 && (\n   877→                        <div className=\"text-xs font-bold uppercase tracking-wide text-neutral-400\">{guide.sections[currentSection + 1].title}</div>\n   878→                      )}\n   879→                    </div>\n   880→                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center transition-colors ${currentSection === guide.sections.length - 1\n   881→                      ? 'bg-neutral-900/30'\n   882→                      : 'bg-cyan-500/10 border border-cyan-500/20 group-hover:bg-cyan-500/20'\n   883→                      }`}>\n   884→                      <ChevronRight size={18} className={currentSection === guide.sections.length - 1 ? '' : 'text-cyan-400'} />\n   885→                    </div>\n   886→                  </button>\n   887→                </nav>\n   888→              </motion.section>\n   889→            </AnimatePresence>\n   890→\n   891→            {/* Forum Discussion Link (after last section) */}\n   892→            {currentSection === guide.sections.length - 1 && (\n   893→              <div className=\"mt-16\">\n   894→                <ForumDiscussionLink\n   895→                  forumCategory={guide.forumCategory}\n   896→                  guideTitle={guide.title}\n   897→                />\n   898→              </div>\n   899→            )}\n   900→          </article>\n   901→        </main>\n   902→      </div>\n   903→    </motion.div>\n   904→  );\n   905→}\n   906→\n   907→// ============================================\n   908→// GUIDE CARD\n   909→// ============================================\n   910→\n   911→interface GuideCardProps {\n   912→  guide: Guide;\n   913→  index: number;\n   914→  onOpen: (guide: Guide) => void;\n   915→}\n   916→\n   917→function GuideCard({ guide, index, onOpen }: GuideCardProps) {\n   918→  const getCategoryColor = (guideId: string) => {\n   919→    const category = GUIDE_CATEGORIES.find(c => c.guideIds.includes(guideId));\n   920→    if (!category) return 'cyan';\n   921→    const colorMap: Record<string, string> = {\n   922→      blue: 'cyan',\n   923→      purple: 'purple',\n   924→      amber: 'amber',\n   925→      pink: 'pink',\n   926→      emerald: 'emerald',\n   927→      red: 'red',\n   928→    };\n   929→    return colorMap[category.color] || 'cyan';\n   930→  };\n   931→\n   932→  const color = getCategoryColor(guide.id);\n   933→\n   934→  const colorClasses: Record<string, { bg: string; border: string; text: string; iconBg: string }> = {\n   935→    cyan: {\n   936→      bg: 'bg-neutral-900/40',\n   937→      border: 'border-white/5 hover:border-cyan-500/20',\n   938→      text: 'text-cyan-400',\n   939→      iconBg: 'bg-neutral-900 border border-white/10',\n   940→    },\n   941→    purple: {\n   942→      bg: 'bg-neutral-900/40',\n   943→      border: 'border-white/5 hover:border-purple-500/20',\n   944→      text: 'text-purple-400',\n   945→      iconBg: 'bg-neutral-900 border border-white/10',\n   946→    },\n   947→    amber: {\n   948→      bg: 'bg-neutral-900/40',\n   949→      border: 'border-white/5 hover:border-amber-500/20',\n   950→      text: 'text-amber-400',\n   951→      iconBg: 'bg-neutral-900 border border-white/10',\n   952→    },\n   953→    pink: {\n   954→      bg: 'bg-neutral-900/40',\n   955→      border: 'border-white/5 hover:border-pink-500/20',\n   956→      text: 'text-pink-400',\n   957→      iconBg: 'bg-neutral-900 border border-white/10',\n   958→    },\n   959→    emerald: {\n   960→      bg: 'bg-neutral-900/40',\n   961→      border: 'border-white/5 hover:border-emerald-500/20',\n   962→      text: 'text-emerald-400',\n   963→      iconBg: 'bg-neutral-900 border border-white/10',\n   964→    },\n   965→    red: {\n   966→      bg: 'bg-neutral-900/40',\n   967→      border: 'border-white/5 hover:border-red-500/20',\n   968→      text: 'text-red-400',\n   969→      iconBg: 'bg-neutral-900 border border-white/10',\n   970→    },\n   971→  };\n   972→\n   973→  const styles = colorClasses[color] || colorClasses.cyan;\n   974→\n   975→  return (\n   976→    <motion.div\n   977→      onClick={() => onOpen(guide)}\n   978→      className={`${styles.bg} ${styles.border} border rounded-2xl p-5 transition-all cursor-pointer group`}\n   979→      initial={{ opacity: 0, y: 20 }}\n   980→      animate={{ opacity: 1, y: 0 }}\n   981→      transition={{ delay: index * 0.05 }}\n   982→      whileHover={{ y: -2 }}\n   983→    >\n   984→      <div className=\"flex items-start justify-between mb-4\">\n   985→        <div className={`w-10 h-10 ${styles.iconBg} rounded-xl flex items-center justify-center ${styles.text}`}>\n   986→          {getIconComponent(guide.icon)}\n   987→        </div>\n   988→        <div className=\"flex items-center gap-1.5 px-2 py-1 rounded-lg bg-neutral-900/50 border border-white/5\">\n   989→          <Clock size={10} className=\"text-neutral-600\" />\n   990→          <span className=\"text-[10px] font-black uppercase tracking-wider text-neutral-500\">{guide.estimatedReadTime} MIN</span>\n   991→        </div>\n   992→      </div>\n   993→\n   994→      <h3 className=\"font-black uppercase tracking-tight text-white mb-1 group-hover:text-cyan-400 transition-colors\">\n   995→        {guide.title}\n   996→      </h3>\n   997→\n   998→      {guide.subtitle && (\n   999→        <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mb-2\">{guide.subtitle}</p>\n  1000→      )}\n  1001→\n  1002→      <p className=\"text-sm text-neutral-500 mb-4 line-clamp-2 font-medium\">{guide.description}</p>\n  1003→\n  1004→      <div className=\"flex items-center justify-between pt-3 border-t border-white/5\">\n  1005→        <div className=\"flex items-center gap-2\">\n  1006→          <span className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600\">\n  1007→            {guide.sections.length} SECTIONS\n  1008→          </span>\n  1009→          {guide.productIds && guide.productIds.length > 0 && (\n  1010→            <>\n  1011→              <span className=\"w-1 h-1 rounded-full bg-neutral-800\" />\n  1012→              <span className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600\">\n  1013→                {guide.productIds.length} PRODUCTS\n  1014→              </span>\n  1015→            </>\n  1016→          )}\n  1017→        </div>\n  1018→        <ChevronRight size={16} className=\"text-neutral-700 group-hover:text-cyan-400 transition-colors\" />\n  1019→      </div>\n  1020→    </motion.div>\n  1021→  );\n  1022→}\n  1023→\n  1024→// ============================================\n  1025→// CATEGORY SECTION\n  1026→// ============================================\n  1027→\n  1028→interface CategorySectionProps {\n  1029→  category: GuideCategory;\n  1030→  onOpenGuide: (guide: Guide) => void;\n  1031→  gender: 'male' | 'female';\n  1032→}\n  1033→\n  1034→function CategorySection({ category, onOpenGuide, gender }: CategorySectionProps) {\n  1035→  // Skip gender-specific categories for the opposite gender\n  1036→  if (category.id === 'male' && gender === 'female') return null;\n  1037→  if (category.id === 'female' && gender === 'male') return null;\n  1038→\n  1039→  const guides = getGuidesByCategory(category.id);\n  1040→\n  1041→  if (guides.length === 0) return null;\n  1042→\n  1043→  const colorClasses: Record<string, { text: string; iconBg: string }> = {\n  1044→    blue: { text: 'text-cyan-400', iconBg: 'bg-neutral-900 border border-white/10' },\n  1045→    purple: { text: 'text-purple-400', iconBg: 'bg-neutral-900 border border-white/10' },\n  1046→    pink: { text: 'text-pink-400', iconBg: 'bg-neutral-900 border border-white/10' },\n  1047→    cyan: { text: 'text-cyan-400', iconBg: 'bg-neutral-900 border border-white/10' },\n  1048→    emerald: { text: 'text-emerald-400', iconBg: 'bg-neutral-900 border border-white/10' },\n  1049→    red: { text: 'text-red-400', iconBg: 'bg-neutral-900 border border-white/10' },\n  1050→    amber: { text: 'text-amber-400', iconBg: 'bg-neutral-900 border border-white/10' },\n  1051→  };\n  1052→\n  1053→  const styles = colorClasses[category.color] || colorClasses.cyan;\n  1054→\n  1055→  return (\n  1056→    <div className=\"mb-12\">\n  1057→      {/* Category Header */}\n  1058→      <div className=\"flex items-center gap-4 mb-6\">\n  1059→        <div className={`w-10 h-10 ${styles.iconBg} rounded-xl flex items-center justify-center ${styles.text}`}>\n  1060→          {getIconComponent(category.icon)}\n  1061→        </div>\n  1062→        <div className=\"flex-1\">\n  1063→          <h3 className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 flex items-center gap-4\">\n  1064→            {category.name}\n  1065→            <div className=\"flex-1 h-px bg-neutral-800\" />\n  1066→          </h3>\n  1067→          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-700 mt-1\">{category.description}</p>\n  1068→        </div>\n  1069→      </div>\n  1070→\n  1071→      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n  1072→        {guides.map((guide, idx) => (\n  1073→          <GuideCard key={guide.id} guide={guide} index={idx} onOpen={onOpenGuide} />\n  1074→        ))}\n  1075→      </div>\n  1076→    </div>\n  1077→  );\n  1078→}\n  1079→\n  1080→// ============================================\n  1081→// SEARCH BAR\n  1082→// ============================================\n  1083→\n  1084→interface SearchBarProps {\n  1085→  query: string;\n  1086→  onQueryChange: (query: string) => void;\n  1087→}\n  1088→\n  1089→function SearchBar({ query, onQueryChange }: SearchBarProps) {\n  1090→  return (\n  1091→    <div className=\"relative mb-8\">\n  1092→      <Search size={16} className=\"absolute left-4 top-1/2 -translate-y-1/2 text-neutral-600\" />\n  1093→      <input\n  1094→        type=\"text\"\n  1095→        placeholder=\"SEARCH GUIDES...\"\n  1096→        value={query}\n  1097→        onChange={(e) => onQueryChange(e.target.value)}\n  1098→        className=\"w-full bg-neutral-900/40 border border-white/5 rounded-xl pl-11 pr-4 py-3.5 text-white placeholder:text-neutral-600 placeholder:font-black placeholder:uppercase placeholder:tracking-widest placeholder:text-xs focus:outline-none focus:border-cyan-500/30 transition-colors font-medium text-sm\"\n  1099→      />\n  1100→    </div>\n  1101→  );\n  1102→}\n  1103→\n  1104→// ============================================\n  1105→// MAIN TAB COMPONENT\n  1106→// ============================================\n  1107→\n  1108→export function GuidesTab() {\n  1109→  const [searchQuery, setSearchQuery] = useState('');\n  1110→  const [selectedGuide, setSelectedGuide] = useState<Guide | null>(null);\n  1111→  const { gender } = useResults();\n  1112→\n  1113→  // Filter guides by gender (excludes opposite gender's specific guides)\n  1114→  const genderFilteredGuides = getGuidesByGender(gender);\n  1115→\n  1116→  const filteredGuides = searchQuery.trim()\n  1117→    ? genderFilteredGuides.filter(g =>\n  1118→        g.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n  1119→        g.description.toLowerCase().includes(searchQuery.toLowerCase()) ||\n  1120→        (g.subtitle && g.subtitle.toLowerCase().includes(searchQuery.toLowerCase())) ||\n  1121→        (g.tags && g.tags.some(tag => tag.toLowerCase().includes(searchQuery.toLowerCase())))\n  1122→      )\n  1123→    : null;\n  1124→\n  1125→  const handleOpenGuide = (guide: Guide) => {\n  1126→    setSelectedGuide(guide);\n  1127→  };\n  1128→\n  1129→  const handleCloseGuide = () => {\n  1130→    setSelectedGuide(null);\n  1131→  };\n  1132→\n  1133→  const handleSwitchGuide = (guide: Guide) => {\n  1134→    setSelectedGuide(guide);\n  1135→  };\n  1136→\n  1137→  return (\n  1138→    <>\n  1139→      <TabContent\n  1140→        title=\"Product Guides\"\n  1141→        subtitle=\"Evidence-based guides for optimal results\"\n  1142→      >\n  1143→        <div className=\"max-w-5xl mx-auto\">\n  1144→          <GuideStatsCard />\n  1145→\n  1146→          <SearchBar query={searchQuery} onQueryChange={setSearchQuery} />\n  1147→\n  1148→          {filteredGuides ? (\n  1149→            // Search Results\n  1150→            <div>\n  1151→              <p className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600 mb-6\">\n  1152→                FOUND {filteredGuides.length} GUIDE{filteredGuides.length !== 1 ? 'S' : ''} MATCHING &ldquo;{searchQuery.toUpperCase()}&rdquo;\n  1153→              </p>\n  1154→              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n  1155→                {filteredGuides.map((guide, idx) => (\n  1156→                  <GuideCard key={guide.id} guide={guide} index={idx} onOpen={handleOpenGuide} />\n  1157→                ))}\n  1158→              </div>\n  1159→              {filteredGuides.length === 0 && (\n  1160→                <div className=\"text-center py-16\">\n  1161→                  <div className=\"w-16 h-16 rounded-2xl bg-neutral-900 border border-white/10 flex items-center justify-center mx-auto mb-4\">\n  1162→                    <Search size={24} className=\"text-neutral-700\" />\n  1163→                  </div>\n  1164→                  <p className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600\">NO GUIDES FOUND MATCHING YOUR SEARCH</p>\n  1165→                </div>\n  1166→              )}\n  1167→            </div>\n  1168→          ) : (\n  1169→            // Category View\n  1170→            <div>\n  1171→              {GUIDE_CATEGORIES.map(category => (\n  1172→                <CategorySection key={category.id} category={category} onOpenGuide={handleOpenGuide} gender={gender} />\n  1173→              ))}\n  1174→            </div>\n  1175→          )}\n  1176→        </div>\n  1177→      </TabContent>\n  1178→\n  1179→      {/* Guide Viewer Modal */}\n  1180→      <AnimatePresence>\n  1181→        {selectedGuide && (\n  1182→          <GuideViewer\n  1183→            guide={selectedGuide}\n  1184→            onClose={handleCloseGuide}\n  1185→            onSwitchGuide={handleSwitchGuide}\n  1186→            allGuides={genderFilteredGuides}\n  1187→            gender={gender}\n  1188→          />\n  1189→        )}\n  1190→      </AnimatePresence>\n  1191→    </>\n  1192→  );\n  1193→}\n  1194→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"c8a5092d-87a3-4d42-8ecd-e060b5cb4bdf","timestamp":"2025-12-27T12:31:47.303Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/GuidesTab.tsx","content":"'use client';\n\nimport { useState, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  BookOpen,\n  Dumbbell,\n  Sparkles,\n  Clock,\n  ChevronRight,\n  Search,\n  Brain,\n  Wrench,\n  TrendingDown,\n  Calendar,\n  Target,\n  Heart,\n  Utensils,\n  Droplet,\n  X,\n  ArrowLeft,\n  MessageSquare,\n  ExternalLink,\n  ShoppingCart,\n  CheckCircle2,\n} from 'lucide-react';\nimport Image from 'next/image';\nimport Link from 'next/link';\nimport { TabContent } from '../ResultsLayout';\nimport {\n  GUIDE_CATEGORIES,\n  getGuidesByCategory,\n  getTotalGuideCount,\n  getTotalReadTime,\n  getGuideProductById,\n  getGuidesByGender,\n} from '@/data/guides';\nimport { Guide, GuideCategory, GuideMedia } from '@/types/guides';\nimport { useRegion } from '@/contexts/RegionContext';\nimport { useResults } from '@/contexts/ResultsContext';\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\n\n// ============================================\n// ICON MAPPING\n// ============================================\n\nconst ICON_MAP: Record<string, React.ReactNode> = {\n  BookOpen: <BookOpen size={20} />,\n  Dumbbell: <Dumbbell size={20} />,\n  Sparkles: <Sparkles size={20} />,\n  Brain: <Brain size={20} />,\n  Wrench: <Wrench size={20} />,\n  TrendingDown: <TrendingDown size={20} />,\n  Calendar: <Calendar size={20} />,\n  Target: <Target size={20} />,\n  Heart: <Heart size={20} />,\n  Utensils: <Utensils size={20} />,\n  Droplet: <Droplet size={20} />,\n};\n\nfunction getIconComponent(iconName: string, size = 20): React.ReactNode {\n  // Check icon map first\n  const mappedIcon = ICON_MAP[iconName];\n  if (mappedIcon) return mappedIcon;\n\n  // Fallback to BookOpen\n  return <BookOpen size={size} />;\n}\n\n// ============================================\n// MEDIA RENDERER\n// ============================================\n\ninterface MediaRendererProps {\n  media: GuideMedia;\n}\n\nfunction MediaRenderer({ media }: MediaRendererProps) {\n  const [hasError, setHasError] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const handleError = useCallback(() => {\n    setHasError(true);\n    setIsLoading(false);\n  }, []);\n\n  const handleLoad = useCallback(() => {\n    setIsLoading(false);\n  }, []);\n\n  const placementClasses = {\n    inline: 'max-w-lg mx-auto',\n    hero: 'w-full',\n    'full-width': 'w-full',\n  };\n\n  const isGif = media.type === 'gif' || media.url.endsWith('.gif');\n\n  // Show styled placeholder if image failed to load or doesn't exist\n  if (hasError) {\n    return (\n      <figure className={`my-10 ${placementClasses[media.placement || 'inline']}`}>\n        <div className=\"relative rounded-2xl overflow-hidden bg-neutral-900/40 border border-white/5\">\n          <div className=\"aspect-video flex items-center justify-center p-8\">\n            <div className=\"text-center max-w-sm\">\n              <div className=\"w-16 h-16 bg-cyan-500/10 rounded-2xl flex items-center justify-center mx-auto mb-4 border border-cyan-500/20\">\n                {isGif ? (\n                  <div className=\"w-6 h-6 border-2 border-cyan-400 border-t-transparent rounded-full animate-spin\" />\n                ) : (\n                  <Sparkles size={28} className=\"text-cyan-400\" />\n                )}\n              </div>\n              <p className=\"text-neutral-300 font-black uppercase tracking-wider text-sm mb-2\">{media.alt}</p>\n              {media.caption && (\n                <p className=\"text-neutral-600 text-xs\">{media.caption}</p>\n              )}\n            </div>\n          </div>\n        </div>\n      </figure>\n    );\n  }\n\n  return (\n    <figure className={`my-10 ${placementClasses[media.placement || 'inline']}`}>\n      <div className=\"relative rounded-2xl overflow-hidden bg-neutral-900/40 border border-white/5\">\n        {/* Loading skeleton */}\n        {isLoading && (\n          <div className=\"absolute inset-0 bg-neutral-900/40 animate-pulse flex items-center justify-center\">\n            <div className=\"w-8 h-8 border-2 border-cyan-500 border-t-transparent rounded-full animate-spin\" />\n          </div>\n        )}\n\n        {isGif ? (\n          // Use img for GIFs to preserve animation\n          // eslint-disable-next-line @next/next/no-img-element\n          <img\n            src={media.url}\n            alt={media.alt}\n            className={`w-full h-auto max-h-[400px] object-contain transition-opacity duration-300 ${isLoading ? 'opacity-0' : 'opacity-100'}`}\n            loading=\"lazy\"\n            onError={handleError}\n            onLoad={handleLoad}\n          />\n        ) : (\n          <Image\n            src={media.url}\n            alt={media.alt}\n            width={media.width || 800}\n            height={media.height || 450}\n            className={`w-full h-auto max-h-[400px] object-contain transition-opacity duration-300 ${isLoading ? 'opacity-0' : 'opacity-100'}`}\n            onError={handleError}\n            onLoad={handleLoad}\n          />\n        )}\n      </div>\n      {media.caption && (\n        <figcaption className=\"mt-4 text-center text-[10px] font-black uppercase tracking-widest text-neutral-600\">\n          {media.caption}\n        </figcaption>\n      )}\n    </figure>\n  );\n}\n\n// ============================================\n// PRODUCT CALLOUT (CONVERSION OPTIMIZED)\n// ============================================\n\ninterface ProductCalloutProps {\n  productId: string;\n}\n\nfunction ProductCallout({ productId }: ProductCalloutProps) {\n  const { getLink } = useRegion();\n  const product = getGuideProductById(productId);\n  const [hasError, setHasError] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n\n  if (!product) return null;\n\n  const link = getLink(product.regionLinks, product.directLink);\n\n  return (\n    <div className=\"my-6 p-5 rounded-2xl bg-neutral-900/40 border border-white/5 hover:border-cyan-500/20 transition-all\">\n      <div className=\"flex items-center gap-4\">\n        {/* Product Image */}\n        <div className=\"w-16 h-16 rounded-xl bg-neutral-900 border border-white/10 overflow-hidden flex-shrink-0 relative\">\n          {isLoading && !hasError && product.imageUrl && (\n            <div className=\"absolute inset-0 bg-neutral-900/60 animate-pulse flex items-center justify-center z-10\">\n              <div className=\"w-4 h-4 border-2 border-cyan-500 border-t-transparent rounded-full animate-spin\" />\n            </div>\n          )}\n          {hasError || !product.imageUrl ? (\n            <div className=\"w-full h-full flex items-center justify-center bg-neutral-900\">\n              <ShoppingCart size={20} className=\"text-neutral-600\" />\n            </div>\n          ) : (\n            <Image\n              src={product.imageUrl}\n              alt={product.name}\n              width={64}\n              height={64}\n              className={`w-full h-full object-cover transition-opacity ${isLoading ? 'opacity-0' : 'opacity-100'}`}\n              onLoad={() => setIsLoading(false)}\n              onError={() => { setHasError(true); setIsLoading(false); }}\n              unoptimized\n            />\n          )}\n        </div>\n\n        {/* Product Info */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h4 className=\"font-black uppercase tracking-wide text-white truncate\">{product.name}</h4>\n            {product.brand && (\n              <span className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600\">{product.brand}</span>\n            )}\n          </div>\n          <p className=\"text-sm text-cyan-400 italic\">&ldquo;{product.tagline}&rdquo;</p>\n        </div>\n\n        {/* CTA Button */}\n        <a\n          href={link}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"flex-shrink-0 flex items-center gap-2 px-5 py-2.5 rounded-xl bg-cyan-500 hover:bg-cyan-400 text-black font-black uppercase tracking-wider text-xs transition-colors\"\n        >\n          <ShoppingCart size={14} />\n          <span className=\"hidden sm:inline\">BUY</span>\n        </a>\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// FORUM DISCUSSION LINK\n// ============================================\n\ninterface ForumDiscussionLinkProps {\n  forumCategory?: string;\n  guideTitle: string;\n}\n\nfunction ForumDiscussionLink({ forumCategory, guideTitle }: ForumDiscussionLinkProps) {\n  if (!forumCategory) return null;\n\n  return (\n    <div className=\"mt-8 p-6 rounded-2xl bg-neutral-900/40 border border-white/5\">\n      <div className=\"flex items-center gap-3 mb-4\">\n        <div className=\"w-10 h-10 rounded-xl bg-purple-500/10 border border-purple-500/20 flex items-center justify-center\">\n          <MessageSquare size={20} className=\"text-purple-400\" />\n        </div>\n        <div>\n          <h3 className=\"font-black uppercase tracking-wide text-white\">DISCUSS THIS GUIDE</h3>\n          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600\">Join the community conversation</p>\n        </div>\n      </div>\n\n      <p className=\"text-sm text-neutral-400 mb-5\">\n        Have questions about {guideTitle.toLowerCase()}? Want to share your experience?\n        Join the discussion in our community forum.\n      </p>\n\n      <Link\n        href={`/forum/${forumCategory}`}\n        className=\"inline-flex items-center gap-2 px-5 py-2.5 rounded-xl bg-neutral-900/50 border border-white/5 hover:border-purple-500/30 text-purple-400 font-black uppercase tracking-wider text-xs transition-all\"\n      >\n        <MessageSquare size={14} />\n        GO TO FORUM\n        <ExternalLink size={12} />\n      </Link>\n    </div>\n  );\n}\n\n// ============================================\n// GUIDE STATS CARD\n// ============================================\n\nfunction GuideStatsCard() {\n  const totalGuides = getTotalGuideCount();\n  const totalMinutes = getTotalReadTime();\n\n  return (\n    <motion.div\n      className=\"rounded-[2rem] bg-neutral-900/40 border border-white/5 p-6 mb-8\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-center gap-4 mb-6\">\n        <div className=\"w-12 h-12 rounded-xl bg-neutral-900 border border-white/10 flex items-center justify-center\">\n          <BookOpen size={22} className=\"text-cyan-400\" />\n        </div>\n        <div>\n          <h2 className=\"text-xl font-black italic uppercase tracking-tight text-white\">PRODUCT <span className=\"text-cyan-400\">GUIDES</span></h2>\n          <p className=\"text-[10px] font-black uppercase tracking-[0.2em] text-neutral-600\">EVIDENCE-BASED LOOKSMAXXING RESOURCES</p>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div className=\"rounded-xl bg-neutral-900/50 border border-white/5 p-4\">\n          <div className=\"text-3xl font-black text-white mb-1\">{totalGuides}</div>\n          <div className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600\">TOTAL GUIDES</div>\n        </div>\n        <div className=\"rounded-xl bg-neutral-900/50 border border-white/5 p-4\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <Clock size={18} className=\"text-cyan-400\" />\n            <div className=\"text-3xl font-black text-white\">{totalMinutes}</div>\n          </div>\n          <div className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600\">MINUTES OF CONTENT</div>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// GUIDE VIEWER MODAL\n// ============================================\n\ninterface GuideViewerProps {\n  guide: Guide;\n  onClose: () => void;\n  onSwitchGuide: (guide: Guide) => void;\n  allGuides: Guide[];\n  gender: 'male' | 'female';\n}\n\nfunction GuideViewer({ guide, onClose, onSwitchGuide, allGuides, gender }: GuideViewerProps) {\n  const [currentSection, setCurrentSection] = useState(0);\n  const [isSidebarOpen, setIsSidebarOpen] = useState(false);\n  const [expandedCategories, setExpandedCategories] = useState<string[]>(() => {\n    // Find the category of the current guide and expand it by default\n    const currentCategory = GUIDE_CATEGORIES.find(c => c.guideIds.includes(guide.id));\n    return currentCategory ? [currentCategory.id] : [];\n  });\n\n  const section = guide.sections[currentSection];\n\n  if (!section) return null;\n\n  // Calculate reading progress (0% at start, 100% at last section)\n  const progress = guide.sections.length > 1\n    ? (currentSection / (guide.sections.length - 1)) * 100\n    : 100;\n\n  const toggleCategory = (categoryId: string) => {\n    setExpandedCategories(prev =>\n      prev.includes(categoryId)\n        ? prev.filter(id => id !== categoryId)\n        : [...prev, categoryId]\n    );\n  };\n\n  // Filter categories by gender\n  const filteredCategories = GUIDE_CATEGORIES.filter(cat => {\n    if (cat.id === 'male' && gender === 'female') return false;\n    if (cat.id === 'female' && gender === 'male') return false;\n    return true;\n  });\n\n  const colorClasses: Record<string, { text: string; bg: string; border: string }> = {\n    blue: { text: 'text-cyan-400', bg: 'bg-cyan-500/10', border: 'border-cyan-500/20' },\n    purple: { text: 'text-purple-400', bg: 'bg-purple-500/10', border: 'border-purple-500/20' },\n    amber: { text: 'text-amber-400', bg: 'bg-amber-500/10', border: 'border-amber-500/20' },\n    pink: { text: 'text-pink-400', bg: 'bg-pink-500/10', border: 'border-pink-500/20' },\n    emerald: { text: 'text-emerald-400', bg: 'bg-emerald-500/10', border: 'border-emerald-500/20' },\n    red: { text: 'text-red-400', bg: 'bg-red-500/10', border: 'border-red-500/20' },\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      exit={{ opacity: 0 }}\n      className=\"fixed inset-0 z-50 bg-black\"\n    >\n      {/* Header */}\n      <div className=\"sticky top-0 z-20 bg-black/95 backdrop-blur-md border-b border-neutral-900\">\n        <div className=\"flex items-center justify-between px-4 lg:px-8 py-3\">\n          <button\n            onClick={onClose}\n            className=\"flex items-center gap-2 text-neutral-500 hover:text-cyan-400 text-xs font-black uppercase tracking-widest transition-colors\"\n          >\n            <ArrowLeft size={14} />\n            <span className=\"hidden sm:inline\">BACK TO GUIDES</span>\n          </button>\n\n          {/* Progress bar */}\n          <div className=\"hidden md:flex items-center gap-4 flex-1 max-w-md mx-8\">\n            <div className=\"flex-1 h-1 bg-neutral-900 rounded-full overflow-hidden\">\n              <motion.div\n                className=\"h-full bg-gradient-to-r from-cyan-500 to-cyan-400\"\n                initial={{ width: 0 }}\n                animate={{ width: `${progress}%` }}\n                transition={{ duration: 0.3 }}\n              />\n            </div>\n            <span className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600 whitespace-nowrap\">\n              {currentSection + 1} / {guide.sections.length}\n            </span>\n          </div>\n\n          <div className=\"flex items-center gap-3\">\n            {/* Mobile menu button */}\n            <button\n              onClick={() => setIsSidebarOpen(!isSidebarOpen)}\n              className=\"lg:hidden p-2 rounded-xl bg-neutral-900/50 border border-white/5 hover:border-white/10 transition-colors\"\n            >\n              <BookOpen size={18} className=\"text-neutral-400\" />\n            </button>\n            <button\n              onClick={onClose}\n              className=\"p-2 rounded-xl bg-neutral-900/50 border border-white/5 hover:border-white/10 transition-colors\"\n            >\n              <X size={18} className=\"text-neutral-400\" />\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Layout: Sidebar + Content */}\n      <div className=\"flex h-[calc(100vh-57px)]\">\n        {/* Sidebar Navigation */}\n        <aside\n          className={`\n            fixed lg:relative inset-y-0 left-0 z-30 lg:z-0\n            w-72 lg:w-80 bg-black lg:bg-neutral-950/50\n            border-r border-neutral-900\n            transform transition-transform duration-300 ease-in-out\n            ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}\n            flex flex-col\n          `}\n        >\n          {/* Sidebar Header */}\n          <div className=\"p-4 border-b border-neutral-900\">\n            <div className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-2\">\n              ALL GUIDES\n            </div>\n            <p className=\"text-xs text-neutral-500\">Select a lesson below</p>\n          </div>\n\n          {/* Categories & Guides List */}\n          <nav className=\"flex-1 overflow-y-auto p-3\">\n            {filteredCategories.map(category => {\n              const categoryGuides = allGuides.filter(g => category.guideIds.includes(g.id));\n              if (categoryGuides.length === 0) return null;\n\n              const isExpanded = expandedCategories.includes(category.id);\n              const styles = colorClasses[category.color] || colorClasses.blue;\n              const hasCurrentGuide = categoryGuides.some(g => g.id === guide.id);\n\n              return (\n                <div key={category.id} className=\"mb-2\">\n                  {/* Category Header */}\n                  <button\n                    onClick={() => toggleCategory(category.id)}\n                    className={`\n                      w-full text-left px-3 py-3 rounded-xl transition-all\n                      flex items-center gap-3 group\n                      ${hasCurrentGuide ? `${styles.bg} border ${styles.border}` : 'hover:bg-neutral-900/50 border border-transparent'}\n                    `}\n                  >\n                    <div className={`w-8 h-8 rounded-xl ${styles.bg} border ${styles.border} flex items-center justify-center ${styles.text} flex-shrink-0`}>\n                      {getIconComponent(category.icon, 16)}\n                    </div>\n                    <div className=\"flex-1 min-w-0\">\n                      <span className={`text-xs font-black uppercase tracking-wide block ${hasCurrentGuide ? 'text-white' : 'text-neutral-400 group-hover:text-white'}`}>\n                        {category.name}\n                      </span>\n                      <span className=\"text-[10px] text-neutral-600\">\n                        {categoryGuides.length} guide{categoryGuides.length !== 1 ? 's' : ''}\n                      </span>\n                    </div>\n                    <ChevronRight\n                      size={14}\n                      className={`${styles.text} transition-transform ${isExpanded ? 'rotate-90' : ''}`}\n                    />\n                  </button>\n\n                  {/* Guides List (collapsible) */}\n                  <AnimatePresence>\n                    {isExpanded && (\n                      <motion.ul\n                        initial={{ height: 0, opacity: 0 }}\n                        animate={{ height: 'auto', opacity: 1 }}\n                        exit={{ height: 0, opacity: 0 }}\n                        transition={{ duration: 0.2 }}\n                        className=\"overflow-hidden ml-4 mt-1 space-y-0.5\"\n                      >\n                        {categoryGuides.map(g => {\n                          const isCurrentGuide = g.id === guide.id;\n                          return (\n                            <li key={g.id}>\n                              <button\n                                onClick={() => {\n                                  if (isCurrentGuide) {\n                                    // Already on this guide, just close sidebar on mobile\n                                    setIsSidebarOpen(false);\n                                  } else {\n                                    onSwitchGuide(g);\n                                    setIsSidebarOpen(false);\n                                  }\n                                }}\n                                className={`\n                                  w-full text-left px-3 py-2 rounded-lg transition-all\n                                  flex items-center gap-2 group\n                                  ${isCurrentGuide\n                                    ? `${styles.bg} border ${styles.border}`\n                                    : 'hover:bg-neutral-900/30 border border-transparent'\n                                  }\n                                `}\n                              >\n                                <span className={`w-1.5 h-1.5 rounded-full flex-shrink-0 ${isCurrentGuide ? styles.text.replace('text-', 'bg-') : 'bg-neutral-700'}`} />\n                                <span className={`text-xs font-medium truncate ${isCurrentGuide ? 'text-white' : 'text-neutral-500 group-hover:text-neutral-300'}`}>\n                                  {g.title}\n                                </span>\n                                {isCurrentGuide && (\n                                  <span className=\"ml-auto text-[8px] font-black uppercase tracking-wider text-neutral-600\">\n                                    VIEWING\n                                  </span>\n                                )}\n                              </button>\n                            </li>\n                          );\n                        })}\n                      </motion.ul>\n                    )}\n                  </AnimatePresence>\n                </div>\n              );\n            })}\n          </nav>\n\n          {/* Current Guide Sections */}\n          <div className=\"border-t border-neutral-900\">\n            <div className=\"p-3\">\n              <div className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-3 px-2 flex items-center gap-2\">\n                <BookOpen size={10} />\n                SECTIONS\n              </div>\n              <ul className=\"space-y-0.5 max-h-48 overflow-y-auto\">\n                {guide.sections.map((s, idx) => (\n                  <li key={s.id}>\n                    <button\n                      onClick={() => {\n                        setCurrentSection(idx);\n                        setIsSidebarOpen(false);\n                      }}\n                      className={`\n                        w-full text-left px-3 py-2 rounded-lg transition-all\n                        flex items-center gap-2 group\n                        ${currentSection === idx\n                          ? 'bg-cyan-500/10 border border-cyan-500/20'\n                          : 'hover:bg-neutral-900/30 border border-transparent'\n                        }\n                      `}\n                    >\n                      <span\n                        className={`\n                          flex-shrink-0 w-5 h-5 rounded text-[9px] font-black\n                          flex items-center justify-center transition-colors\n                          ${currentSection === idx\n                            ? 'bg-cyan-500 text-black'\n                            : idx < currentSection\n                              ? 'bg-green-500/20 text-green-400'\n                              : 'bg-neutral-900 border border-white/10 text-neutral-600'\n                          }\n                        `}\n                      >\n                        {idx < currentSection ? <CheckCircle2 size={10} /> : idx + 1}\n                      </span>\n                      <span className={`text-[10px] font-bold uppercase tracking-wide truncate ${currentSection === idx ? 'text-white' : 'text-neutral-500'}`}>\n                        {s.title}\n                      </span>\n                    </button>\n                  </li>\n                ))}\n              </ul>\n            </div>\n          </div>\n\n          {/* Sidebar Footer */}\n          <div className=\"p-4 border-t border-neutral-900\">\n            <div className=\"flex items-center justify-between text-[10px] font-black uppercase tracking-widest text-neutral-600 mb-2\">\n              <span>PROGRESS</span>\n              <span>{Math.round(progress)}%</span>\n            </div>\n            <div className=\"h-1.5 bg-neutral-900 rounded-full overflow-hidden\">\n              <motion.div\n                className=\"h-full bg-gradient-to-r from-cyan-500 to-green-500\"\n                animate={{ width: `${progress}%` }}\n              />\n            </div>\n          </div>\n        </aside>\n\n        {/* Mobile sidebar overlay */}\n        {isSidebarOpen && (\n          <div\n            className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-20 lg:hidden\"\n            onClick={() => setIsSidebarOpen(false)}\n          />\n        )}\n\n        {/* Main Content Area */}\n        <main className=\"flex-1 overflow-y-auto\">\n          <article className=\"max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-10 lg:py-16\">\n            {/* Hero Media (only on first section) */}\n            {guide.heroMedia && currentSection === 0 && (\n              <div className=\"mb-10\">\n                <MediaRenderer media={guide.heroMedia} />\n              </div>\n            )}\n\n            {/* Article Header (only on first section) */}\n            {currentSection === 0 && (\n              <header className=\"mb-12\">\n                <div className=\"inline-flex items-center gap-2 px-3 py-1.5 rounded-lg bg-cyan-500/10 border border-cyan-500/20 text-[10px] font-black uppercase tracking-widest text-cyan-400 mb-6\">\n                  {getIconComponent(guide.icon, 12)}\n                  <span>GUIDE</span>\n                </div>\n\n                <h1 className=\"text-3xl md:text-4xl font-black tracking-tighter italic uppercase text-white mb-4 leading-tight\">\n                  {guide.title.split(' ').slice(0, -1).join(' ')} <span className=\"text-cyan-400\">{guide.title.split(' ').slice(-1)}</span>\n                </h1>\n\n                <p className=\"text-neutral-400 text-base leading-relaxed\">\n                  {guide.description}\n                </p>\n              </header>\n            )}\n\n            {/* Section Content */}\n            <AnimatePresence mode=\"wait\">\n              <motion.section\n                key={section.id}\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                exit={{ opacity: 0, x: -20 }}\n                transition={{ duration: 0.3 }}\n              >\n                {/* Section Title - Largest heading in section content */}\n                <h2 className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-8 flex items-center gap-4\">\n                  {section.title}\n                  <div className=\"flex-1 h-px bg-neutral-800\" />\n                </h2>\n\n                {/* Tips Callout */}\n                {section.tips && section.tips.length > 0 && (\n                  <aside className=\"mb-10 p-6 rounded-2xl bg-cyan-500/5 border border-cyan-500/10\">\n                    <h4 className=\"text-[10px] font-black uppercase tracking-[0.3em] text-cyan-400 mb-4\">\n                      QUICK TIPS\n                    </h4>\n                    <ul className=\"space-y-3\">\n                      {section.tips.map((tip, i) => (\n                        <li key={i} className=\"flex items-start gap-3 text-neutral-300\">\n                          <span className=\"flex-shrink-0 w-5 h-5 bg-cyan-500/20 rounded-lg flex items-center justify-center mt-0.5\">\n                            <span className=\"text-cyan-400 text-[10px] font-black\">{i + 1}</span>\n                          </span>\n                          <span className=\"leading-relaxed text-sm\">{tip}</span>\n                        </li>\n                      ))}\n                    </ul>\n                  </aside>\n                )}\n\n                {/* Warnings Callout */}\n                {section.warnings && section.warnings.length > 0 && (\n                  <aside className=\"mb-10 p-6 rounded-2xl bg-amber-500/5 border border-amber-500/10\">\n                    <h4 className=\"text-[10px] font-black uppercase tracking-[0.3em] text-amber-400 mb-4\">\n                      IMPORTANT\n                    </h4>\n                    <ul className=\"space-y-3\">\n                      {section.warnings.map((warning, i) => (\n                        <li key={i} className=\"flex items-start gap-3 text-neutral-300\">\n                          <span className=\"text-amber-400 mt-1\">*</span>\n                          <span className=\"leading-relaxed text-sm\">{warning}</span>\n                        </li>\n                      ))}\n                    </ul>\n                  </aside>\n                )}\n\n                {/* Hero Media for Section */}\n                {section.media && section.media.filter(m => m.placement === 'hero').map(media => (\n                  <div key={media.id} className=\"mb-10\">\n                    <MediaRenderer media={media} />\n                  </div>\n                ))}\n\n                {/* Article Body - Custom Markdown Rendering */}\n                <div className=\"article-content\">\n                  <ReactMarkdown\n                    remarkPlugins={[remarkGfm]}\n                    components={{\n                      // Paragraphs with generous spacing\n                      p: ({ children }) => (\n                        <p className=\"text-neutral-400 text-base leading-[1.8] mb-6 font-medium\">\n                          {children}\n                        </p>\n                      ),\n                      // Headers with clear hierarchy (smaller than section title)\n                      h1: ({ children }) => (\n                        <h3 className=\"text-xl font-black italic uppercase text-white mt-12 mb-6 tracking-tight flex items-center gap-3\">\n                          <span className=\"w-1.5 h-8 bg-cyan-500 rounded-full\" />\n                          {children}\n                        </h3>\n                      ),\n                      h2: ({ children }) => (\n                        <div className=\"mt-10 mb-6 p-4 rounded-xl bg-neutral-900/60 border border-white/5\">\n                          <h4 className=\"text-base font-black uppercase text-cyan-400 tracking-wide flex items-center gap-2\">\n                            <span className=\"w-2 h-2 bg-cyan-400 rounded-full\" />\n                            {children}\n                          </h4>\n                        </div>\n                      ),\n                      h3: ({ children }) => (\n                        <h5 className=\"text-sm font-black uppercase text-white mt-8 mb-4 tracking-wide pl-4 border-l-2 border-purple-500/50\">\n                          {children}\n                        </h5>\n                      ),\n                      // Strong text\n                      strong: ({ children }) => (\n                        <strong className=\"font-black text-white\">\n                          {children}\n                        </strong>\n                      ),\n                      // Emphasis\n                      em: ({ children }) => (\n                        <em className=\"text-neutral-500 not-italic\">\n                          {children}\n                        </em>\n                      ),\n                      // Lists with proper spacing\n                      ul: ({ children }) => (\n                        <ul className=\"my-6 ml-0 space-y-3\">\n                          {children}\n                        </ul>\n                      ),\n                      ol: ({ children }) => (\n                        <ol className=\"my-6 ml-0 space-y-3 list-decimal list-inside\">\n                          {children}\n                        </ol>\n                      ),\n                      li: ({ children }) => (\n                        <li className=\"text-neutral-400 text-base leading-[1.8] flex items-start gap-3 font-medium\">\n                          <span className=\"text-cyan-500 mt-1.5 flex-shrink-0\">*</span>\n                          <span>{children}</span>\n                        </li>\n                      ),\n                      // Tables - styled beautifully\n                      table: ({ children }) => (\n                        <div className=\"my-8 overflow-x-auto rounded-2xl border border-white/5\">\n                          <table className=\"w-full text-left\">\n                            {children}\n                          </table>\n                        </div>\n                      ),\n                      thead: ({ children }) => (\n                        <thead className=\"bg-neutral-900/80 border-b border-white/5\">\n                          {children}\n                        </thead>\n                      ),\n                      tbody: ({ children }) => (\n                        <tbody className=\"divide-y divide-white/5\">\n                          {children}\n                        </tbody>\n                      ),\n                      tr: ({ children }) => (\n                        <tr className=\"hover:bg-neutral-900/50 transition-colors\">\n                          {children}\n                        </tr>\n                      ),\n                      th: ({ children }) => (\n                        <th className=\"px-4 py-3 text-[10px] font-black uppercase tracking-widest text-cyan-400\">\n                          {children}\n                        </th>\n                      ),\n                      td: ({ children }) => (\n                        <td className=\"px-4 py-3 text-neutral-400 text-sm font-medium\">\n                          {children}\n                        </td>\n                      ),\n                      // Blockquotes\n                      blockquote: ({ children }) => (\n                        <blockquote className=\"my-8 pl-6 border-l-2 border-cyan-500 bg-neutral-900/30 py-4 pr-6 rounded-r-xl\">\n                          {children}\n                        </blockquote>\n                      ),\n                      // Code\n                      code: ({ children }) => (\n                        <code className=\"text-cyan-400 bg-neutral-900 px-2 py-1 rounded-lg text-sm font-mono\">\n                          {children}\n                        </code>\n                      ),\n                      // Links\n                      a: ({ href, children }) => (\n                        <a\n                          href={href}\n                          className=\"text-cyan-400 hover:text-cyan-300 underline underline-offset-4 decoration-cyan-500/30 hover:decoration-cyan-400 transition-colors font-bold\"\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                        >\n                          {children}\n                        </a>\n                      ),\n                      // Horizontal rule\n                      hr: () => (\n                        <hr className=\"my-10 border-neutral-900\" />\n                      ),\n                    }}\n                  >\n                    {section.content}\n                  </ReactMarkdown>\n                </div>\n\n                {/* Inline Media */}\n                {section.media && section.media.filter(m => m.placement !== 'hero').map(media => (\n                  <div key={media.id} className=\"my-10\">\n                    <MediaRenderer media={media} />\n                  </div>\n                ))}\n\n                {/* Product Recommendations */}\n                {section.products && section.products.length > 0 && (\n                  <div className=\"mt-12 pt-8 border-t border-neutral-900\">\n                    <h4 className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 mb-6 flex items-center gap-4\">\n                      RECOMMENDED PRODUCTS\n                      <div className=\"flex-1 h-px bg-neutral-800\" />\n                    </h4>\n                    <div className=\"space-y-4\">\n                      {section.products.map(productId => (\n                        <ProductCallout key={productId} productId={productId} />\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* Section Navigation */}\n                <nav className=\"flex items-center justify-between mt-16 pt-8 border-t border-neutral-900\">\n                  <button\n                    onClick={() => setCurrentSection(Math.max(0, currentSection - 1))}\n                    disabled={currentSection === 0}\n                    className={`flex items-center gap-3 group transition-all ${currentSection === 0\n                      ? 'text-neutral-800 cursor-not-allowed'\n                      : 'text-neutral-500 hover:text-white'\n                      }`}\n                  >\n                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center transition-colors ${currentSection === 0 ? 'bg-neutral-900/30' : 'bg-neutral-900/50 border border-white/5 group-hover:border-white/10'\n                      }`}>\n                      <ArrowLeft size={18} />\n                    </div>\n                    <div className=\"hidden sm:block text-left\">\n                      <div className=\"text-[10px] font-black uppercase tracking-widest text-neutral-700 mb-1\">PREVIOUS</div>\n                      {currentSection > 0 && (\n                        <div className=\"text-xs font-bold uppercase tracking-wide text-neutral-400\">{guide.sections[currentSection - 1].title}</div>\n                      )}\n                    </div>\n                  </button>\n\n                  <button\n                    onClick={() => setCurrentSection(Math.min(guide.sections.length - 1, currentSection + 1))}\n                    disabled={currentSection === guide.sections.length - 1}\n                    className={`flex items-center gap-3 group transition-all ${currentSection === guide.sections.length - 1\n                      ? 'text-neutral-800 cursor-not-allowed'\n                      : 'text-neutral-500 hover:text-white'\n                      }`}\n                  >\n                    <div className=\"hidden sm:block text-right\">\n                      <div className=\"text-[10px] font-black uppercase tracking-widest text-neutral-700 mb-1\">NEXT</div>\n                      {currentSection < guide.sections.length - 1 && (\n                        <div className=\"text-xs font-bold uppercase tracking-wide text-neutral-400\">{guide.sections[currentSection + 1].title}</div>\n                      )}\n                    </div>\n                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center transition-colors ${currentSection === guide.sections.length - 1\n                      ? 'bg-neutral-900/30'\n                      : 'bg-cyan-500/10 border border-cyan-500/20 group-hover:bg-cyan-500/20'\n                      }`}>\n                      <ChevronRight size={18} className={currentSection === guide.sections.length - 1 ? '' : 'text-cyan-400'} />\n                    </div>\n                  </button>\n                </nav>\n              </motion.section>\n            </AnimatePresence>\n\n            {/* Forum Discussion Link (after last section) */}\n            {currentSection === guide.sections.length - 1 && (\n              <div className=\"mt-16\">\n                <ForumDiscussionLink\n                  forumCategory={guide.forumCategory}\n                  guideTitle={guide.title}\n                />\n              </div>\n            )}\n          </article>\n        </main>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// GUIDE CARD\n// ============================================\n\ninterface GuideCardProps {\n  guide: Guide;\n  index: number;\n  onOpen: (guide: Guide) => void;\n}\n\nfunction GuideCard({ guide, index, onOpen }: GuideCardProps) {\n  const getCategoryColor = (guideId: string) => {\n    const category = GUIDE_CATEGORIES.find(c => c.guideIds.includes(guideId));\n    if (!category) return 'cyan';\n    const colorMap: Record<string, string> = {\n      blue: 'cyan',\n      purple: 'purple',\n      amber: 'amber',\n      pink: 'pink',\n      emerald: 'emerald',\n      red: 'red',\n    };\n    return colorMap[category.color] || 'cyan';\n  };\n\n  const color = getCategoryColor(guide.id);\n\n  const colorClasses: Record<string, { bg: string; border: string; text: string; iconBg: string }> = {\n    cyan: {\n      bg: 'bg-neutral-900/40',\n      border: 'border-white/5 hover:border-cyan-500/20',\n      text: 'text-cyan-400',\n      iconBg: 'bg-neutral-900 border border-white/10',\n    },\n    purple: {\n      bg: 'bg-neutral-900/40',\n      border: 'border-white/5 hover:border-purple-500/20',\n      text: 'text-purple-400',\n      iconBg: 'bg-neutral-900 border border-white/10',\n    },\n    amber: {\n      bg: 'bg-neutral-900/40',\n      border: 'border-white/5 hover:border-amber-500/20',\n      text: 'text-amber-400',\n      iconBg: 'bg-neutral-900 border border-white/10',\n    },\n    pink: {\n      bg: 'bg-neutral-900/40',\n      border: 'border-white/5 hover:border-pink-500/20',\n      text: 'text-pink-400',\n      iconBg: 'bg-neutral-900 border border-white/10',\n    },\n    emerald: {\n      bg: 'bg-neutral-900/40',\n      border: 'border-white/5 hover:border-emerald-500/20',\n      text: 'text-emerald-400',\n      iconBg: 'bg-neutral-900 border border-white/10',\n    },\n    red: {\n      bg: 'bg-neutral-900/40',\n      border: 'border-white/5 hover:border-red-500/20',\n      text: 'text-red-400',\n      iconBg: 'bg-neutral-900 border border-white/10',\n    },\n  };\n\n  const styles = colorClasses[color] || colorClasses.cyan;\n\n  return (\n    <motion.div\n      onClick={() => onOpen(guide)}\n      className={`${styles.bg} ${styles.border} border rounded-2xl p-5 transition-all cursor-pointer group`}\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ delay: index * 0.05 }}\n      whileHover={{ y: -2 }}\n    >\n      <div className=\"flex items-start justify-between mb-4\">\n        <div className={`w-10 h-10 ${styles.iconBg} rounded-xl flex items-center justify-center ${styles.text}`}>\n          {getIconComponent(guide.icon)}\n        </div>\n        <div className=\"flex items-center gap-1.5 px-2 py-1 rounded-lg bg-neutral-900/50 border border-white/5\">\n          <Clock size={10} className=\"text-neutral-600\" />\n          <span className=\"text-[10px] font-black uppercase tracking-wider text-neutral-500\">{guide.estimatedReadTime} MIN</span>\n        </div>\n      </div>\n\n      <h3 className=\"font-black uppercase tracking-tight text-white mb-1 group-hover:text-cyan-400 transition-colors\">\n        {guide.title}\n      </h3>\n\n      {guide.subtitle && (\n        <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-600 mb-2\">{guide.subtitle}</p>\n      )}\n\n      <p className=\"text-sm text-neutral-500 mb-4 line-clamp-2 font-medium\">{guide.description}</p>\n\n      <div className=\"flex items-center justify-between pt-3 border-t border-white/5\">\n        <div className=\"flex items-center gap-2\">\n          <span className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600\">\n            {guide.sections.length} SECTIONS\n          </span>\n          {guide.productIds && guide.productIds.length > 0 && (\n            <>\n              <span className=\"w-1 h-1 rounded-full bg-neutral-800\" />\n              <span className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600\">\n                {guide.productIds.length} PRODUCTS\n              </span>\n            </>\n          )}\n        </div>\n        <ChevronRight size={16} className=\"text-neutral-700 group-hover:text-cyan-400 transition-colors\" />\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// CATEGORY SECTION\n// ============================================\n\ninterface CategorySectionProps {\n  category: GuideCategory;\n  onOpenGuide: (guide: Guide) => void;\n  gender: 'male' | 'female';\n}\n\nfunction CategorySection({ category, onOpenGuide, gender }: CategorySectionProps) {\n  // Skip gender-specific categories for the opposite gender\n  if (category.id === 'male' && gender === 'female') return null;\n  if (category.id === 'female' && gender === 'male') return null;\n\n  const guides = getGuidesByCategory(category.id);\n\n  if (guides.length === 0) return null;\n\n  const colorClasses: Record<string, { text: string; iconBg: string }> = {\n    blue: { text: 'text-cyan-400', iconBg: 'bg-neutral-900 border border-white/10' },\n    purple: { text: 'text-purple-400', iconBg: 'bg-neutral-900 border border-white/10' },\n    pink: { text: 'text-pink-400', iconBg: 'bg-neutral-900 border border-white/10' },\n    cyan: { text: 'text-cyan-400', iconBg: 'bg-neutral-900 border border-white/10' },\n    emerald: { text: 'text-emerald-400', iconBg: 'bg-neutral-900 border border-white/10' },\n    red: { text: 'text-red-400', iconBg: 'bg-neutral-900 border border-white/10' },\n    amber: { text: 'text-amber-400', iconBg: 'bg-neutral-900 border border-white/10' },\n  };\n\n  const styles = colorClasses[category.color] || colorClasses.cyan;\n\n  return (\n    <div className=\"mb-12\">\n      {/* Category Header */}\n      <div className=\"flex items-center gap-4 mb-6\">\n        <div className={`w-10 h-10 ${styles.iconBg} rounded-xl flex items-center justify-center ${styles.text}`}>\n          {getIconComponent(category.icon)}\n        </div>\n        <div className=\"flex-1\">\n          <h3 className=\"text-[10px] font-black uppercase tracking-[0.4em] text-neutral-600 flex items-center gap-4\">\n            {category.name}\n            <div className=\"flex-1 h-px bg-neutral-800\" />\n          </h3>\n          <p className=\"text-[10px] font-bold uppercase tracking-wider text-neutral-700 mt-1\">{category.description}</p>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        {guides.map((guide, idx) => (\n          <GuideCard key={guide.id} guide={guide} index={idx} onOpen={onOpenGuide} />\n        ))}\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// SEARCH BAR\n// ============================================\n\ninterface SearchBarProps {\n  query: string;\n  onQueryChange: (query: string) => void;\n}\n\nfunction SearchBar({ query, onQueryChange }: SearchBarProps) {\n  return (\n    <div className=\"relative mb-8\">\n      <Search size={16} className=\"absolute left-4 top-1/2 -translate-y-1/2 text-neutral-600\" />\n      <input\n        type=\"text\"\n        placeholder=\"SEARCH GUIDES...\"\n        value={query}\n        onChange={(e) => onQueryChange(e.target.value)}\n        className=\"w-full bg-neutral-900/40 border border-white/5 rounded-xl pl-11 pr-4 py-3.5 text-white placeholder:text-neutral-600 placeholder:font-black placeholder:uppercase placeholder:tracking-widest placeholder:text-xs focus:outline-none focus:border-cyan-500/30 transition-colors font-medium text-sm\"\n      />\n    </div>\n  );\n}\n\n// ============================================\n// MAIN TAB COMPONENT\n// ============================================\n\nexport function GuidesTab() {\n  const [searchQuery, setSearchQuery] = useState('');\n  const [selectedGuide, setSelectedGuide] = useState<Guide | null>(null);\n  const { gender } = useResults();\n\n  // Filter guides by gender (excludes opposite gender's specific guides)\n  const genderFilteredGuides = getGuidesByGender(gender);\n\n  const filteredGuides = searchQuery.trim()\n    ? genderFilteredGuides.filter(g =>\n        g.title.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        g.description.toLowerCase().includes(searchQuery.toLowerCase()) ||\n        (g.subtitle && g.subtitle.toLowerCase().includes(searchQuery.toLowerCase())) ||\n        (g.tags && g.tags.some(tag => tag.toLowerCase().includes(searchQuery.toLowerCase())))\n      )\n    : null;\n\n  const handleOpenGuide = (guide: Guide) => {\n    setSelectedGuide(guide);\n  };\n\n  const handleCloseGuide = () => {\n    setSelectedGuide(null);\n  };\n\n  const handleSwitchGuide = (guide: Guide) => {\n    setSelectedGuide(guide);\n  };\n\n  return (\n    <>\n      <TabContent\n        title=\"Product Guides\"\n        subtitle=\"Evidence-based guides for optimal results\"\n      >\n        <div className=\"max-w-5xl mx-auto\">\n          <GuideStatsCard />\n\n          <SearchBar query={searchQuery} onQueryChange={setSearchQuery} />\n\n          {filteredGuides ? (\n            // Search Results\n            <div>\n              <p className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600 mb-6\">\n                FOUND {filteredGuides.length} GUIDE{filteredGuides.length !== 1 ? 'S' : ''} MATCHING &ldquo;{searchQuery.toUpperCase()}&rdquo;\n              </p>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {filteredGuides.map((guide, idx) => (\n                  <GuideCard key={guide.id} guide={guide} index={idx} onOpen={handleOpenGuide} />\n                ))}\n              </div>\n              {filteredGuides.length === 0 && (\n                <div className=\"text-center py-16\">\n                  <div className=\"w-16 h-16 rounded-2xl bg-neutral-900 border border-white/10 flex items-center justify-center mx-auto mb-4\">\n                    <Search size={24} className=\"text-neutral-700\" />\n                  </div>\n                  <p className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600\">NO GUIDES FOUND MATCHING YOUR SEARCH</p>\n                </div>\n              )}\n            </div>\n          ) : (\n            // Category View\n            <div>\n              {GUIDE_CATEGORIES.map(category => (\n                <CategorySection key={category.id} category={category} onOpenGuide={handleOpenGuide} gender={gender} />\n              ))}\n            </div>\n          )}\n        </div>\n      </TabContent>\n\n      {/* Guide Viewer Modal */}\n      <AnimatePresence>\n        {selectedGuide && (\n          <GuideViewer\n            guide={selectedGuide}\n            onClose={handleCloseGuide}\n            onSwitchGuide={handleSwitchGuide}\n            allGuides={genderFilteredGuides}\n            gender={gender}\n          />\n        )}\n      </AnimatePresence>\n    </>\n  );\n}\n","numLines":1194,"startLine":1,"totalLines":1194}}}
{"parentUuid":"c8a5092d-87a3-4d42-8ecd-e060b5cb4bdf","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MMEifwFBmiBfdKVLng6Xpz","type":"tool_result","content":"No files found"}]},"uuid":"7b701ad3-16e1-4d38-b213-e192581406d2","timestamp":"2025-12-27T12:31:47.569Z","toolUseResult":{"filenames":[],"durationMs":434,"numFiles":0,"truncated":false}}
{"parentUuid":"7b701ad3-16e1-4d38-b213-e192581406d2","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01E6Ch4hDXmRN99J6mHzCu59","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/modals/UserProfileModal.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/modals/MetricDetailModal.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/modals/SurgeryConsentModal.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/modals/RatioDetailModal.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/modals/PricingModal.tsx"}]},"uuid":"6afafca7-2a8a-47fa-9b7a-9bf8f423ce6b","timestamp":"2025-12-27T12:31:47.719Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/modals/UserProfileModal.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/modals/MetricDetailModal.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/modals/SurgeryConsentModal.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/modals/RatioDetailModal.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/modals/PricingModal.tsx"],"durationMs":583,"numFiles":5,"truncated":false}}
{"parentUuid":"6afafca7-2a8a-47fa-9b7a-9bf8f423ce6b","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018DiVEfh7sDvbsHkRreqnZM","type":"tool_result","content":"No files found"}]},"uuid":"fc6cf131-bcd7-4a43-afc2-1272e446cd90","timestamp":"2025-12-27T12:31:47.855Z","toolUseResult":{"filenames":[],"durationMs":720,"numFiles":0,"truncated":false}}
{"parentUuid":"fc6cf131-bcd7-4a43-afc2-1272e446cd90","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01Dy6XGEDgWgFEsLVN4wnLtA","type":"message","role":"assistant","content":[{"type":"text","text":"Good! I found the GuidesTab.tsx file. Now let me check if there are any related context or provider files that might affect the modal state:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":238,"cache_creation_input_tokens":18548,"cache_read_input_tokens":36138,"cache_creation":{"ephemeral_5m_input_tokens":18548,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWXCLfhUs1cKTqAqEqqtF","type":"assistant","uuid":"e243d75c-70bd-4a6f-bcd6-f02b7930e854","timestamp":"2025-12-27T12:31:50.437Z"}
{"parentUuid":"e243d75c-70bd-4a6f-bcd6-f02b7930e854","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01Dy6XGEDgWgFEsLVN4wnLtA","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CiKeXE1oH4FGeUwy4UmxJk","name":"Grep","input":{"pattern":"selectedGuide|GuideViewer|setSelectedGuide","type":"tsx","head_limit":50}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":238,"cache_creation_input_tokens":18548,"cache_read_input_tokens":36138,"cache_creation":{"ephemeral_5m_input_tokens":18548,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWXCLfhUs1cKTqAqEqqtF","type":"assistant","uuid":"5a475b67-71af-4532-8839-5b58e91beb93","timestamp":"2025-12-27T12:31:51.718Z"}
{"parentUuid":"5a475b67-71af-4532-8839-5b58e91beb93","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01Dy6XGEDgWgFEsLVN4wnLtA","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_013DbKeKSJk8Wh5Za1xqKPwp","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":238,"cache_creation_input_tokens":18548,"cache_read_input_tokens":36138,"cache_creation":{"ephemeral_5m_input_tokens":18548,"ephemeral_1h_input_tokens":0},"output_tokens":198,"service_tier":"standard"}},"requestId":"req_011CWXCLfhUs1cKTqAqEqqtF","type":"assistant","uuid":"041163c3-224b-458b-8427-3c4ba270267c","timestamp":"2025-12-27T12:31:51.789Z"}
{"parentUuid":"041163c3-224b-458b-8427-3c4ba270267c","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_013DbKeKSJk8Wh5Za1xqKPwp","type":"tool_result","content":"     1→/* eslint-disable @typescript-eslint/no-unused-vars */\n     2→/* eslint-disable @typescript-eslint/no-explicit-any */\n     3→'use client';\n     4→\n     5→import React, { createContext, useContext, useState, useMemo, useCallback, useEffect, ReactNode } from 'react';\n     6→import { LandmarkPoint } from '@/lib/landmarks';\n     7→import {\n     8→  MetricScoreResult,\n     9→  METRIC_CONFIGS,\n    10→  Ethnicity,\n    11→  Gender,\n    12→} from '@/lib/harmony-scoring';\n    13→import {\n    14→  calculateHarmonyScore,\n    15→  getTopMetrics,\n    16→  getBottomMetrics,\n    17→  HarmonyScoreResult,\n    18→  RankedMetric,\n    19→} from '@/lib/looksmax-scoring';\n    20→import { harmonyToPSL } from '@/lib/recommendations/severity';\n    21→import {\n    22→  classifyInsights,\n    23→  convertToStrength,\n    24→  convertToFlaw,\n    25→  INSIGHTS_DEFINITIONS,\n    26→} from '@/lib/insights-engine';\n    27→import { useStreak } from '@/hooks/useStreak';\n    28→import { classifyMetric } from '@/lib/taxonomy';\n    29→import {\n    30→  Ratio,\n    31→  Strength,\n    32→  Flaw,\n    33→  Recommendation,\n    34→  ResultsTab,\n    35→  FullHarmonyAnalysis,\n    36→  ProfileAnalysis,\n    37→} from '@/types/results';\n    38→import { generateRecommendations } from '@/lib/results/analysis';\n    39→// Import types for the new data\n    40→import { PSLResult } from '@/types/psl';\n    41→import { ArchetypeClassification } from '@/lib/archetype-classifier';\n    42→import { ProductRecommendation } from '@/types/results';\n    43→import { generateProductRecommendations } from '@/lib/recommendations/products';\n    44→\n    45→// ============================================\n    46→// CONTEXT TYPES\n    47→// ============================================\n    48→\n    49→interface ResultsContextType {\n    50→  // Raw data\n    51→  frontLandmarks: LandmarkPoint[];\n    52→  sideLandmarks: LandmarkPoint[];\n    53→  gender: Gender;\n    54→  ethnicity: Ethnicity;\n    55→  frontPhoto: string;\n    56→  sidePhoto: string | null;\n    57→  isUnlocked: boolean;\n    58→\n    59→  // Computed results\n    60→  harmonyAnalysis: FullHarmonyAnalysis | null;\n    61→  frontRatios: Ratio[];\n    62→  sideRatios: Ratio[];\n    63→  strengths: Strength[];\n    64→  flaws: Flaw[];\n    65→  recommendations: Recommendation[];\n    66→  productRecommendations: ProductRecommendation[];\n    67→\n    68→  // Scores\n    69→  overallScore: number | string;\n    70→  frontScore: number | string;\n    71→  sideScore: number | string;\n    72→\n    73→  // Weighted Harmony Score\n    74→  harmonyScoreResult: HarmonyScoreResult | null;\n    75→  harmonyPercentage: number;  // 0-100% weighted harmony\n    76→\n    77→  // Top 3 strengths and bottom 3 areas to improve with advice\n    78→  topMetrics: RankedMetric[];\n    79→  bottomMetrics: RankedMetric[];\n    80→\n    81→  // Archetype Analysis\n    82→  archetype: ArchetypeClassification | null;\n    83→\n    84→  // PSL Rating (1-10 scale)\n    85→  pslRating: {\n    86→    psl: number;\n    87→    tier: string;\n    88→    percentile: number;\n    89→    description: string;\n    90→  };\n    91→\n    92→  // Vision Analysis\n    93→  vision: any | null;\n    94→\n    95→  // UI state\n    96→  activeTab: ResultsTab;\n    97→  setActiveTab: (tab: ResultsTab) => void;\n    98→  expandedMeasurementId: string | null;\n    99→  setExpandedMeasurementId: (id: string | null) => void;\n   100→  selectedVisualizationMetric: string | null;\n   101→  setSelectedVisualizationMetric: (id: string | null) => void;\n   102→  categoryFilter: string | null;\n   103→  setCategoryFilter: (category: string | null) => void;\n   104→  showLandmarkOverlay: boolean;\n   105→  setShowLandmarkOverlay: (show: boolean) => void;\n   106→  isLoading: boolean;\n   107→  error: string | null;\n   108→\n   109→  // Actions\n   110→  setResultsData: (data: ResultsInputData) => void;\n   111→  refetchAnalysis: () => Promise<void>;\n   112→}\n   113→\n   114→interface ResultsInputData {\n   115→  frontLandmarks: LandmarkPoint[];\n   116→  sideLandmarks: LandmarkPoint[];\n   117→  frontPhoto: string;\n   118→  sidePhoto?: string;\n   119→  gender: Gender;\n   120→  ethnicity?: Ethnicity;\n   121→  isUnlocked?: boolean;\n   122→}\n   123→\n   124→// ============================================\n   125→// ILLUSTRATION CONFIGURATION\n   126→// ============================================\n   127→\n   128→interface IllustrationConfig {\n   129→  points: string[];\n   130→  lines: Array<{\n   131→    from: string;\n   132→    to: string;\n   133→    label?: string;\n   134→    color?: string;\n   135→    labelPosition?: 'start' | 'middle' | 'end';\n   136→  }>;\n   137→}\n   138→\n   139→const ILLUSTRATION_CONFIGS: Record<string, IllustrationConfig> = {\n   140→  // FACE SHAPE / PROPORTIONS\n   141→  faceWidthToHeight: {\n   142→    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n   143→    lines: [\n   144→      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'middle' },\n   145→      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'end' },\n   146→    ],\n   147→  },\n   148→  totalFacialWidthToHeight: {\n   149→    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n   150→    lines: [\n   151→      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n   152→      { from: 'trichion', to: 'menton', label: 'Total Height', color: '#a78bfa' },\n   153→    ],\n   154→  },\n   155→  lowerThirdProportion: {\n   156→    points: ['subnasale', 'menton', 'trichion'],\n   157→    lines: [\n   158→      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'end' },\n   159→      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n   160→    ],\n   161→  },\n   162→  middleThirdProportion: {\n   163→    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n   164→    lines: [\n   165→      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'end' },\n   166→      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n   167→    ],\n   168→  },\n   169→  upperThirdProportion: {\n   170→    points: ['trichion', 'nasal_base', 'menton'],\n   171→    lines: [\n   172→      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'end' },\n   173→      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n   174→    ],\n   175→  },\n   176→  bitemporalWidth: {\n   177→    points: ['left_temporal', 'right_temporal', 'left_zygion', 'right_zygion'],\n   178→    lines: [\n   179→      { from: 'left_temporal', to: 'right_temporal', label: 'Temple', color: '#fbbf24' },\n   180→      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek', color: '#67e8f9' },\n   181→    ],\n   182→  },\n   183→  cheekboneHeight: {\n   184→    points: ['left_zygion', 'right_zygion', 'left_canthus_lateralis', 'right_canthus_lateralis', 'menton'],\n   185→    lines: [\n   186→      { from: 'left_zygion', to: 'right_zygion', label: 'Cheekbone', color: '#ec4899' },\n   187→      { from: 'left_canthus_lateralis', to: 'left_zygion', color: '#67e8f9' },\n   188→    ],\n   189→  },\n   190→  midfaceRatio: {\n   191→    points: ['left_zygion', 'right_zygion', 'left_canthus_medialis', 'right_canthus_medialis', 'subnasale'],\n   192→    lines: [\n   193→      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Midface Width', color: '#67e8f9' },\n   194→      { from: 'left_canthus_medialis', to: 'subnasale', label: 'Midface Height', color: '#a78bfa' },\n   195→    ],\n   196→  },\n   197→\n   198→  // JAW MEASUREMENTS\n   199→  jawSlope: {\n   200→    points: ['left_gonion_inferior', 'left_mentum_lateralis', 'menton', 'right_mentum_lateralis', 'right_gonion_inferior'],\n   201→    lines: [\n   202→      { from: 'left_gonion_inferior', to: 'left_mentum_lateralis', label: 'Jaw Slope', color: '#f97316' },\n   203→      { from: 'right_gonion_inferior', to: 'right_mentum_lateralis', color: '#f97316' },\n   204→    ],\n   205→  },\n   206→  jawFrontalAngle: {\n   207→    points: ['left_gonion_inferior', 'menton', 'right_gonion_inferior'],\n   208→    lines: [\n   209→      { from: 'left_gonion_inferior', to: 'menton', label: 'Jaw Angle', color: '#f97316' },\n   210→      { from: 'menton', to: 'right_gonion_inferior', color: '#f97316' },\n   211→    ],\n   212→  },\n   213→  bigonialWidth: {\n   214→    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n   215→    lines: [\n   216→      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw Width', color: '#f97316' },\n   217→      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n   218→    ],\n   219→  },\n   220→  jawWidthRatio: {\n   221→    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n   222→    lines: [\n   223→      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n   224→      { from: 'left_zygion', to: 'right_zygion', label: 'Face', color: '#67e8f9' },\n   225→    ],\n   226→  },\n   227→\n   228→  // EYE MEASUREMENTS\n   229→  lateralCanthalTilt: {\n   230→    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n   231→    lines: [\n   232→      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'end' },\n   233→      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n   234→    ],\n   235→  },\n   236→  eyeAspectRatio: {\n   237→    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'left_palpebra_superior', 'left_palpebra_inferior'],\n   238→    lines: [\n   239→      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Width', color: '#06b6d4' },\n   240→      { from: 'left_palpebra_superior', to: 'left_palpebra_inferior', label: 'Height', color: '#a78bfa' },\n   241→    ],\n   242→  },\n   243→  eyeSeparationRatio: {\n   244→    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_zygion', 'right_zygion'],\n   245→    lines: [\n   246→      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n   247→      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n   248→    ],\n   249→  },\n   250→  interpupillaryRatio: {\n   251→    points: ['left_pupila', 'right_pupila', 'left_zygion', 'right_zygion'],\n   252→    lines: [\n   253→      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n   254→      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n   255→    ],\n   256→  },\n   257→  interpupillaryMouthWidthRatio: {\n   258→    points: ['left_pupila', 'right_pupila', 'left_cheilion', 'right_cheilion'],\n   259→    lines: [\n   260→      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n   261→      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n   262→    ],\n   263→  },\n   264→  oneEyeApartTest: {\n   265→    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_canthus_lateralis'],\n   266→    lines: [\n   267→      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Between Eyes', color: '#06b6d4' },\n   268→      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Eye Width', color: '#a78bfa' },\n   269→    ],\n   270→  },\n   271→\n   272→  // EYEBROW MEASUREMENTS\n   273→  browLengthRatio: {\n   274→    points: ['left_supercilium_medialis', 'left_supercilium_lateralis', 'left_zygion', 'right_zygion'],\n   275→    lines: [\n   276→      { from: 'left_supercilium_medialis', to: 'left_supercilium_lateralis', label: 'Brow', color: '#84cc16' },\n   277→      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n   278→    ],\n   279→  },\n   280→  eyebrowTilt: {\n   281→    points: ['left_supercilium_medialis', 'left_supercilium_apex', 'left_supercilium_lateralis'],\n   282→    lines: [\n   283→      { from: 'left_supercilium_medialis', to: 'left_supercilium_apex', label: 'Tilt', color: '#84cc16' },\n   284→      { from: 'left_supercilium_apex', to: 'left_supercilium_lateralis', color: '#84cc16' },\n   285→    ],\n   286→  },\n   287→  eyebrowLowSetedness: {\n   288→    points: ['left_supercilium_medialis', 'left_palpebra_superior', 'left_canthus_medialis'],\n   289→    lines: [\n   290→      { from: 'left_supercilium_medialis', to: 'left_palpebra_superior', label: 'Brow-Eye Gap', color: '#84cc16' },\n   291→    ],\n   292→  },\n   293→\n   294→  // NOSE MEASUREMENTS (FRONT)\n   295→  nasalIndex: {\n   296→    points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n   297→    lines: [\n   298→      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Width', color: '#fbbf24' },\n   299→      { from: 'nasal_base', to: 'subnasale', label: 'Height', color: '#a78bfa' },\n   300→    ],\n   301→  },\n   302→  intercanthalNasalRatio: {\n   303→    points: ['left_ala_nasi', 'right_ala_nasi', 'left_canthus_medialis', 'right_canthus_medialis'],\n   304→    lines: [\n   305→      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose Width', color: '#fbbf24' },\n   306→      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n   307→    ],\n   308→  },\n   309→  noseBridgeWidth: {\n   310→    points: ['left_dorsum_nasi', 'right_dorsum_nasi', 'left_ala_nasi', 'right_ala_nasi'],\n   311→    lines: [\n   312→      { from: 'left_dorsum_nasi', to: 'right_dorsum_nasi', label: 'Bridge', color: '#fbbf24' },\n   313→      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Base', color: '#f97316' },\n   314→    ],\n   315→  },\n   316→  noseTipPosition: {\n   317→    points: ['subnasale', 'left_ala_nasi', 'right_ala_nasi'],\n   318→    lines: [\n   319→      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Tip Position', color: '#fbbf24' },\n   320→    ],\n   321→  },\n   322→\n   323→  // MOUTH/LIP MEASUREMENTS\n   324→  mouthNoseWidthRatio: {\n   325→    points: ['left_cheilion', 'right_cheilion', 'left_ala_nasi', 'right_ala_nasi'],\n   326→    lines: [\n   327→      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n   328→      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose', color: '#fbbf24' },\n   329→    ],\n   330→  },\n   331→  lowerUpperLipRatio: {\n   332→    points: ['labrale_superius', 'mouth_middle', 'labrale_inferius'],\n   333→    lines: [\n   334→      { from: 'labrale_superius', to: 'mouth_middle', label: 'Upper', color: '#ec4899' },\n   335→      { from: 'mouth_middle', to: 'labrale_inferius', label: 'Lower', color: '#f97316' },\n   336→    ],\n   337→  },\n   338→  chinPhiltrumRatio: {\n   339→    points: ['subnasale', 'labrale_superius', 'labrale_inferius', 'menton'],\n   340→    lines: [\n   341→      { from: 'subnasale', to: 'labrale_superius', label: 'Philtrum', color: '#ec4899' },\n   342→      { from: 'labrale_inferius', to: 'menton', label: 'Chin', color: '#ef4444' },\n   343→    ],\n   344→  },\n   345→  mouthWidth: {\n   346→    points: ['left_cheilion', 'right_cheilion'],\n   347→    lines: [{ from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth Width', color: '#ec4899' }],\n   348→  },\n   349→\n   350→  // CHIN MEASUREMENTS\n   351→  chinHeight: {\n   352→    points: ['labrale_inferius', 'menton'],\n   353→    lines: [{ from: 'labrale_inferius', to: 'menton', label: 'Chin Height', color: '#ef4444' }],\n   354→  },\n   355→\n   356→  // NECK MEASUREMENTS\n   357→  neckWidthRatio: {\n   358→    points: ['left_cervical_lateralis', 'right_cervical_lateralis', 'left_gonion_inferior', 'right_gonion_inferior'],\n   359→    lines: [\n   360→      { from: 'left_cervical_lateralis', to: 'right_cervical_lateralis', label: 'Neck', color: '#14b8a6' },\n   361→      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n   362→    ],\n   363→  },\n   364→\n   365→  // SIDE PROFILE MEASUREMENTS\n   366→  gonialAngle: {\n   367→    points: ['tragus', 'gonionBottom', 'menton'],\n   368→    lines: [\n   369→      { from: 'tragus', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n   370→      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n   371→    ],\n   372→  },\n   373→  nasofrontalAngle: {\n   374→    points: ['glabella', 'nasion', 'pronasale'],\n   375→    lines: [\n   376→      { from: 'glabella', to: 'nasion', label: 'Forehead', color: '#84cc16' },\n   377→      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n   378→    ],\n   379→  },\n   380→  nasofacialAngle: {\n   381→    points: ['nasion', 'pronasale', 'pogonion'],\n   382→    lines: [\n   383→      { from: 'nasion', to: 'pronasale', color: '#fbbf24' },\n   384→      { from: 'pronasale', to: 'pogonion', color: '#67e8f9' },\n   385→    ],\n   386→  },\n   387→  nasomentaAngle: {\n   388→    points: ['nasion', 'pronasale', 'pogonion'],\n   389→    lines: [\n   390→      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n   391→      { from: 'pronasale', to: 'pogonion', label: 'To Chin', color: '#ef4444' },\n   392→    ],\n   393→  },\n   394→  submentalCervicalAngle: {\n   395→    points: ['menton', 'cervicalPoint', 'neckPoint'],\n   396→    lines: [\n   397→      { from: 'menton', to: 'cervicalPoint', label: 'Submental', color: '#14b8a6' },\n   398→      { from: 'cervicalPoint', to: 'neckPoint', label: 'Cervical', color: '#06b6d4' },\n   399→    ],\n   400→  },\n   401→  facialDepthToHeight: {\n   402→    points: ['pronasale', 'tragus', 'nasion', 'menton'],\n   403→    lines: [\n   404→      { from: 'pronasale', to: 'tragus', label: 'Depth', color: '#67e8f9' },\n   405→      { from: 'nasion', to: 'menton', label: 'Height', color: '#a78bfa' },\n   406→    ],\n   407→  },\n   408→  anteriorFacialDepth: {\n   409→    points: ['glabella', 'pronasale', 'pogonion'],\n   410→    lines: [\n   411→      { from: 'glabella', to: 'pronasale', color: '#67e8f9' },\n   412→      { from: 'pronasale', to: 'pogonion', color: '#a78bfa' },\n   413→    ],\n   414→  },\n   415→  mandibularPlaneAngle: {\n   416→    points: ['gonionBottom', 'menton', 'orbitale', 'porion'],\n   417→    lines: [\n   418→      { from: 'gonionBottom', to: 'menton', label: 'Mandibular', color: '#f97316' },\n   419→      { from: 'orbitale', to: 'porion', label: 'Frankfort', color: '#67e8f9' },\n   420→    ],\n   421→  },\n   422→  ramusToMandibleRatio: {\n   423→    points: ['gonionTop', 'gonionBottom', 'menton'],\n   424→    lines: [\n   425→      { from: 'gonionTop', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n   426→      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n   427→    ],\n   428→  },\n   429→  orbitalVector: {\n   430→    points: ['cornealApex', 'orbitale', 'cheekbone'],\n   431→    lines: [\n   432→      { from: 'cornealApex', to: 'cheekbone', label: 'Orbital Vector', color: '#06b6d4' },\n   433→    ],\n   434→  },\n   435→  eLineLowerLip: {\n   436→    points: ['pronasale', 'pogonion', 'labraleInferius'],\n   437→    lines: [\n   438→      { from: 'pronasale', to: 'pogonion', label: 'E-Line', color: '#67e8f9' },\n   439→    ],\n   440→  },\n   441→  sLineLowerLip: {\n   442→    points: ['pronasale', 'pogonion', 'labraleInferius'],\n   443→    lines: [\n   444→      { from: 'pronasale', to: 'pogonion', label: 'S-Line', color: '#a78bfa' },\n   445→    ],\n   446→  },\n   447→  holdawayHLine: {\n   448→    points: ['pronasale', 'pogonion', 'labraleSuperius', 'labraleInferius'],\n   449→    lines: [\n   450→      { from: 'pronasale', to: 'pogonion', label: 'H-Line', color: '#ec4899' },\n   451→    ],\n   452→  },\n   453→  burstoneLowerLip: {\n   454→    points: ['subnasale', 'pogonion', 'labraleInferius'],\n   455→    lines: [\n   456→      { from: 'subnasale', to: 'pogonion', label: 'Burstone', color: '#fbbf24' },\n   457→    ],\n   458→  },\n   459→\n   460→  // ADDITIONAL FRONT PROFILE METRICS\n   461→  cupidsBowDepth: {\n   462→    points: ['labrale_superius', 'cupids_bow_left', 'cupids_bow_right', 'cupids_bow_center'],\n   463→    lines: [\n   464→      { from: 'cupids_bow_left', to: 'cupids_bow_center', label: 'Bow', color: '#ec4899' },\n   465→      { from: 'cupids_bow_center', to: 'cupids_bow_right', color: '#ec4899' },\n   466→    ],\n   467→  },\n   468→  mouthCornerPosition: {\n   469→    points: ['left_cheilion', 'right_cheilion', 'left_pupila', 'right_pupila'],\n   470→    lines: [\n   471→      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth Width', color: '#ec4899' },\n   472→      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4', labelPosition: 'start' },\n   473→    ],\n   474→  },\n   475→  iaaJfaDeviation: {\n   476→    points: ['left_ala_nasi', 'right_ala_nasi', 'left_gonion_inferior', 'menton', 'right_gonion_inferior'],\n   477→    lines: [\n   478→      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'IAA', color: '#fbbf24' },\n   479→      { from: 'left_gonion_inferior', to: 'menton', label: 'JFA', color: '#f97316' },\n   480→      { from: 'menton', to: 'right_gonion_inferior', color: '#f97316' },\n   481→    ],\n   482→  },\n   483→  ipsilateralAlarAngle: {\n   484→    points: ['left_ala_nasi', 'subnasale', 'right_ala_nasi'],\n   485→    lines: [\n   486→      { from: 'left_ala_nasi', to: 'subnasale', label: 'Alar Angle', color: '#fbbf24' },\n   487→      { from: 'subnasale', to: 'right_ala_nasi', color: '#fbbf24' },\n   488→    ],\n   489→  },\n   490→  earProtrusionAngle: {\n   491→    points: ['left_ear_helix', 'left_ear_attachment', 'left_tragus'],\n   492→    lines: [\n   493→      { from: 'left_ear_helix', to: 'left_ear_attachment', label: 'Protrusion', color: '#a78bfa' },\n   494→    ],\n   495→  },\n   496→  earProtrusionRatio: {\n   497→    points: ['left_ear_helix', 'left_ear_attachment', 'left_ear_lobule'],\n   498→    lines: [\n   499→      { from: 'left_ear_helix', to: 'left_ear_attachment', label: 'Distance', color: '#a78bfa' },\n   500→      { from: 'left_ear_attachment', to: 'left_ear_lobule', label: 'Length', color: '#67e8f9' },\n   501→    ],\n   502→  },\n   503→  mouthWidthToNoseRatio: {\n   504→    points: ['left_cheilion', 'right_cheilion', 'left_ala_nasi', 'right_ala_nasi'],\n   505→    lines: [\n   506→      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n   507→      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose', color: '#fbbf24' },\n   508→    ],\n   509→  },\n   510→  lowerToUpperLipRatio: {\n   511→    points: ['labrale_superius', 'mouth_middle', 'labrale_inferius'],\n   512→    lines: [\n   513→      { from: 'labrale_superius', to: 'mouth_middle', label: 'Upper', color: '#ec4899' },\n   514→      { from: 'mouth_middle', to: 'labrale_inferius', label: 'Lower', color: '#f97316' },\n   515→    ],\n   516→  },\n   517→  chinToPhiltrumRatio: {\n   518→    points: ['subnasale', 'labrale_superius', 'labrale_inferius', 'menton'],\n   519→    lines: [\n   520→      { from: 'subnasale', to: 'labrale_superius', label: 'Philtrum', color: '#ec4899' },\n   521→      { from: 'labrale_inferius', to: 'menton', label: 'Chin', color: '#ef4444' },\n   522→    ],\n   523→  },\n   524→\n   525→  // ADDITIONAL SIDE PROFILE METRICS\n   526→  nasolabialAngle: {\n   527→    points: ['columella', 'subnasale', 'labraleSuperius'],\n   528→    lines: [\n   529→      { from: 'columella', to: 'subnasale', label: 'Columella', color: '#fbbf24' },\n   530→      { from: 'subnasale', to: 'labraleSuperius', label: 'Upper Lip', color: '#ec4899' },\n   531→    ],\n   532→  },\n   533→  nasalTipAngle: {\n   534→    points: ['nasion', 'pronasale', 'columella'],\n   535→    lines: [\n   536→      { from: 'nasion', to: 'pronasale', label: 'Dorsum', color: '#fbbf24' },\n   537→      { from: 'pronasale', to: 'columella', label: 'Tip', color: '#f97316' },\n   538→    ],\n   539→  },\n   540→  nasalProjection: {\n   541→    points: ['alar_crease', 'pronasale', 'subnasale'],\n   542→    lines: [\n   543→      { from: 'alar_crease', to: 'pronasale', label: 'Projection', color: '#fbbf24' },\n   544→    ],\n   545→  },\n   546→  nasalWToHRatio: {\n   547→    points: ['alar_crease', 'pronasale', 'nasion', 'subnasale'],\n   548→    lines: [\n   549→      { from: 'alar_crease', to: 'pronasale', label: 'Width', color: '#fbbf24' },\n   550→      { from: 'nasion', to: 'subnasale', label: 'Height', color: '#a78bfa' },\n   551→    ],\n   552→  },\n   553→  noseTipRotationAngle: {\n   554→    points: ['columella', 'subnasale', 'labraleSuperius'],\n   555→    lines: [\n   556→      { from: 'columella', to: 'subnasale', label: 'Rotation', color: '#fbbf24' },\n   557→    ],\n   558→  },\n   559→  frankfortTipAngle: {\n   560→    points: ['porion', 'orbitale', 'pronasale'],\n   561→    lines: [\n   562→      { from: 'porion', to: 'orbitale', label: 'Frankfort', color: '#67e8f9' },\n   563→      { from: 'orbitale', to: 'pronasale', label: 'To Tip', color: '#fbbf24' },\n   564→    ],\n   565→  },\n   566→  mentolabialAngle: {\n   567→    points: ['labraleInferius', 'mentolabialSulcus', 'pogonion'],\n   568→    lines: [\n   569→      { from: 'labraleInferius', to: 'mentolabialSulcus', label: 'Lip', color: '#ec4899' },\n   570→      { from: 'mentolabialSulcus', to: 'pogonion', label: 'Chin', color: '#ef4444' },\n   571→    ],\n   572→  },\n   573→  zAngle: {\n   574→    points: ['pogonion', 'labraleSuperius', 'frankfortHorizontal'],\n   575→    lines: [\n   576→      { from: 'pogonion', to: 'labraleSuperius', label: 'Z-Line', color: '#a78bfa' },\n   577→    ],\n   578→  },\n   579→  facialConvexityGlabella: {\n   580→    points: ['glabella', 'subnasale', 'pogonion'],\n   581→    lines: [\n   582→      { from: 'glabella', to: 'subnasale', label: 'Upper', color: '#84cc16' },\n   583→      { from: 'subnasale', to: 'pogonion', label: 'Lower', color: '#ef4444' },\n   584→    ],\n   585→  },\n   586→  facialConvexityNasion: {\n   587→    points: ['nasion', 'subnasale', 'pogonion'],\n   588→    lines: [\n   589→      { from: 'nasion', to: 'subnasale', label: 'Midface', color: '#22c55e' },\n   590→      { from: 'subnasale', to: 'pogonion', label: 'Lower', color: '#ef4444' },\n   591→    ],\n   592→  },\n   593→  totalFacialConvexity: {\n   594→    points: ['glabella', 'pronasale', 'pogonion'],\n   595→    lines: [\n   596→      { from: 'glabella', to: 'pronasale', label: 'Upper', color: '#84cc16' },\n   597→      { from: 'pronasale', to: 'pogonion', label: 'Lower', color: '#ef4444' },\n   598→    ],\n   599→  },\n   600→  interiorMidfaceProjectionAngle: {\n   601→    points: ['orbitale', 'subnasale', 'pronasale'],\n   602→    lines: [\n   603→      { from: 'orbitale', to: 'subnasale', label: 'Orbital', color: '#06b6d4' },\n   604→      { from: 'subnasale', to: 'pronasale', label: 'Midface', color: '#67e8f9' },\n   605→    ],\n   606→  },\n   607→  recessionFromFrankfort: {\n   608→    points: ['porion', 'orbitale', 'pogonion'],\n   609→    lines: [\n   610→      { from: 'porion', to: 'orbitale', label: 'Frankfort', color: '#67e8f9' },\n   611→      { from: 'orbitale', to: 'pogonion', label: 'Recession', color: '#ef4444' },\n   612→    ],\n   613→  },\n   614→  gonionToMouthLine: {\n   615→    points: ['gonionBottom', 'cheilion', 'tragus'],\n   616→    lines: [\n   617→      { from: 'gonionBottom', to: 'cheilion', label: 'Gonion-Mouth', color: '#f97316' },\n   618→    ],\n   619→  },\n   620→  eLineUpperLip: {\n   621→    points: ['pronasale', 'pogonion', 'labraleSuperius'],\n   622→    lines: [\n   623→      { from: 'pronasale', to: 'pogonion', label: 'E-Line', color: '#67e8f9' },\n   624→    ],\n   625→  },\n   626→  sLineUpperLip: {\n   627→    points: ['pronasale', 'pogonion', 'labraleSuperius'],\n   628→    lines: [\n   629→      { from: 'pronasale', to: 'pogonion', label: 'S-Line', color: '#a78bfa' },\n   630→    ],\n   631→  },\n   632→  burstoneUpperLip: {\n   633→    points: ['subnasale', 'pogonion', 'labraleSuperius'],\n   634→    lines: [\n   635→      { from: 'subnasale', to: 'pogonion', label: 'Burstone', color: '#fbbf24' },\n   636→    ],\n   637→  },\n   638→  chinProjection: {\n   639→    points: ['subnasale', 'pogonion', 'menton', 'frankfortHorizontal'],\n   640→    lines: [\n   641→      { from: 'subnasale', to: 'pogonion', label: 'Chin Proj', color: '#ef4444' },\n   642→    ],\n   643→  },\n   644→  recessionRelativeToFrankfort: {\n   645→    points: ['porion', 'orbitale', 'pogonion', 'menton'],\n   646→    lines: [\n   647→      { from: 'porion', to: 'orbitale', label: 'Frankfort', color: '#67e8f9' },\n   648→      { from: 'pogonion', to: 'menton', label: 'Recession', color: '#ef4444' },\n   649→    ],\n   650→  },\n   651→  browridgeInclinationAngle: {\n   652→    points: ['glabella', 'trichion', 'nasion'],\n   653→    lines: [\n   654→      { from: 'glabella', to: 'trichion', label: 'Brow Ridge', color: '#84cc16' },\n   655→      { from: 'glabella', to: 'nasion', color: '#67e8f9' },\n   656→    ],\n   657→  },\n   658→  upperForeheadSlope: {\n   659→    points: ['trichion', 'glabella', 'frankfortHorizontal'],\n   660→    lines: [\n   661→      { from: 'trichion', to: 'glabella', label: 'Forehead', color: '#84cc16' },\n   662→    ],\n   663→  },\n   664→  midfaceProjectionAngle: {\n   665→    points: ['orbitale', 'subnasale', 'pronasale'],\n   666→    lines: [\n   667→      { from: 'orbitale', to: 'subnasale', color: '#67e8f9' },\n   668→      { from: 'subnasale', to: 'pronasale', label: 'Projection', color: '#22c55e' },\n   669→    ],\n   670→  },\n   671→};\n   672→\n   673→// ============================================\n   674→// HELPER FUNCTIONS\n   675→// ============================================\n   676→\n   677→function convertUnitToRatioUnit(unit: string): 'x' | 'mm' | '%' | '°' {\n   678→  switch (unit) {\n   679→    case 'ratio': return 'x';\n   680→    case 'percent': return '%';\n   681→    case 'degrees': return '°';\n   682→    case 'mm': return 'mm';\n   683→    default: return 'x';\n   684→  }\n   685→}\n   686→\n   687→function transformToRatio(result: MetricScoreResult, landmarks: LandmarkPoint[]): Ratio {\n   688→  const metricConfig = METRIC_CONFIGS[result.metricId];\n   689→\n   690→  // Generate illustration based on metric\n   691→  const illustration = generateIllustration(result.metricId, landmarks);\n   692→\n   693→  // Get flaw/strength mappings\n   694→  const { mayIndicateFlaws, mayIndicateStrengths } = getFlawStrengthMappings(result);\n   695→\n   696→  // Classify metric using Harmony taxonomy\n   697→  const taxonomyClassification = classifyMetric(result.name, result.category);\n   698→\n   699→  // Clamp scores to valid 0-10 range for display (defense-in-depth)\n   700→  const clampedScore = typeof result.standardizedScore === 'number'\n   701→    ? Math.max(0, Math.min(10, result.standardizedScore))\n   702→    : result.standardizedScore;\n   703→\n   704→  return {\n   705→    id: result.metricId,\n   706→    name: result.name,\n   707→    value: result.value,\n   708→    score: clampedScore,  // Use standardized 0-10 score for UI display\n   709→    standardizedScore: clampedScore,\n   710→    unit: convertUnitToRatioUnit(result.unit),\n   711→    idealMin: result.idealMin,\n   712→    idealMax: result.idealMax,\n   713→    rangeMin: metricConfig?.rangeMin || result.idealMin - 0.5,\n   714→    rangeMax: metricConfig?.rangeMax || result.idealMax + 0.5,\n   715→    description: metricConfig?.description || '',\n   716→    category: result.category,\n   717→    qualityLevel: result.qualityTier,\n   718→    severity: result.severity,\n   719→    illustration,\n   720→    mayIndicateFlaws,\n   721→    mayIndicateStrengths,\n   722→    usedLandmarks: getUsedLandmarks(result.metricId),\n   723→    scoringCurveConfig: metricConfig ? {\n   724→      decayRate: metricConfig.decayRate,\n   725→      maxScore: metricConfig.maxScore,\n   726→    } : undefined,\n   727→    taxonomyPrimary: taxonomyClassification?.primary,\n   728→    taxonomySecondary: taxonomyClassification?.secondary,\n   729→  };\n   730→}\n   731→\n   732→function generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n   733→  const landmarkMap: Record<string, LandmarkPoint> = {};\n   734→  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n   735→\n   736→  const config = ILLUSTRATION_CONFIGS[metricId];\n   737→  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n   738→  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: 'start' | 'middle' | 'end' }> = {};\n   739→\n   740→  if (config) {\n   741→    config.points.forEach((pointId, i) => {\n   742→      if (landmarkMap[pointId]) {\n   743→        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n   744→      }\n   745→    });\n   746→    config.lines.forEach((line, i) => {\n   747→      lines[`line_${i}`] = {\n   748→        from: line.from,\n   749→        to: line.to,\n   750→        color: line.color || '#67e8f9',\n   751→        label: line.label,\n   752→        labelPosition: line.labelPosition,\n   753→      };\n   754→    });\n   755→  }\n   756→\n   757→  return { points, lines };\n   758→}\n   759→\n   760→function getUsedLandmarks(metricId: string): string[] {\n   761→  const landmarkMappings: Record<string, string[]> = {\n   762→    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n   763→    lateralCanthalTilt: ['left_canthus_medialis', 'left_canthus_lateralis'],\n   764→    nasalIndex: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n   765→    ipd: ['left_pupila', 'right_pupila'],\n   766→    mouthWidth: ['left_cheilion', 'right_cheilion'],\n   767→    jawWidth: ['left_gonion_inferior', 'right_gonion_inferior'],\n   768→    chinHeight: ['labrale_inferius', 'menton'],\n   769→    gonialAngle: ['tragus', 'gonionBottom', 'menton'],\n   770→  };\n   771→  return landmarkMappings[metricId] || [];\n   772→}\n   773→\n   774→function getFlawStrengthMappings(result: MetricScoreResult): { mayIndicateFlaws: string[]; mayIndicateStrengths: string[] } {\n   775→  const flawMappings: Record<string, { low: string[]; high: string[] }> = {\n   776→    faceWidthToHeight: {\n   777→      low: ['Narrow face', 'Vertically elongated face'],\n   778→      high: ['Wide face', 'Horizontally expanded face'],\n   779→    },\n   780→    lowerThirdProportion: {\n   781→      low: ['Short lower third', 'Deficient mandible'],\n   782→      high: ['Long lower third', 'Mandibular excess'],\n   783→    },\n   784→    lateralCanthalTilt: {\n   785→      low: ['Negative canthal tilt', 'Drooping eyes'],\n   786→      high: ['Excessive positive canthal tilt'],\n   787→    },\n   788→    nasalIndex: {\n   789→      low: ['Narrow nose', 'Leptorrhine nose'],\n   790→      high: ['Wide nose', 'Platyrrhine nose'],\n   791→    },\n   792→    gonialAngle: {\n   793→      low: ['Steep mandibular plane'],\n   794→      high: ['Flat mandibular plane', 'Weak jaw definition'],\n   795→    },\n   796→  };\n   797→\n   798→  const strengthMappings: Record<string, { ideal: string[] }> = {\n   799→    faceWidthToHeight: { ideal: ['Balanced facial proportions', 'Harmonious face shape'] },\n   800→    lowerThirdProportion: { ideal: ['Ideal lower third height', 'Balanced facial thirds'] },\n   801→    lateralCanthalTilt: { ideal: ['Positive canthal tilt', 'Attractive eye tilt'] },\n   802→    nasalIndex: { ideal: ['Proportionate nose width', 'Harmonious nose shape'] },\n   803→    gonialAngle: { ideal: ['Masculine jaw angle', 'Defined jawline'] },\n   804→  };\n   805→\n   806→  const mayIndicateFlaws: string[] = [];\n   807→  const mayIndicateStrengths: string[] = [];\n   808→\n   809→  // Very basic mapping logic for now\n   810→  if (result.severity !== 'optimal' && result.severity !== 'minor') {\n   811→    if (flawMappings[result.metricId]) {\n   812→      if (result.deviationDirection === 'below') {\n   813→        mayIndicateFlaws.push(...flawMappings[result.metricId].low);\n   814→      } else {\n   815→        mayIndicateFlaws.push(...flawMappings[result.metricId].high);\n   816→      }\n   817→    }\n   818→  }\n   819→\n   820→  if (result.qualityTier === 'ideal' || result.qualityTier === 'excellent') {\n   821→    if (strengthMappings[result.metricId]) {\n   822→      mayIndicateStrengths.push(...strengthMappings[result.metricId].ideal);\n   823→    }\n   824→  }\n   825→\n   826→  return { mayIndicateFlaws, mayIndicateStrengths };\n   827→}\n   828→\n   829→// ============================================\n   830→// CONTEXT CREATION\n   831→// ============================================\n   832→\n   833→const ResultsContext = createContext<ResultsContextType | null>(null);\n   834→\n   835→export function useResults(): ResultsContextType {\n   836→  const context = useContext(ResultsContext);\n   837→  if (!context) {\n   838→    throw new Error('useResults must be used within a ResultsProvider');\n   839→  }\n   840→  return context;\n   841→}\n   842→\n   843→interface ResultsProviderProps {\n   844→  children: ReactNode;\n   845→  initialData?: ResultsInputData;\n   846→}\n   847→\n   848→export function ResultsProvider({ children, initialData }: ResultsProviderProps) {\n   849→  // Raw data state\n   850→  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>(initialData?.frontLandmarks || []);\n   851→  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>(initialData?.sideLandmarks || []);\n   852→  const [gender, setGender] = useState<Gender>(initialData?.gender || 'male');\n   853→  const [ethnicity, setEthnicity] = useState<Ethnicity>(initialData?.ethnicity || 'other');\n   854→  const [frontPhoto, setFrontPhoto] = useState<string>(initialData?.frontPhoto || '');\n   855→  const [sidePhoto, setSidePhoto] = useState<string | null>(initialData?.sidePhoto || null);\n   856→  const [isUnlocked, setIsUnlocked] = useState<boolean>(initialData?.isUnlocked || false);\n   857→\n   858→  // UI state\n   859→  const [activeTab, setActiveTab] = useState<ResultsTab>('overview');\n   860→  const [expandedMeasurementId, setExpandedMeasurementId] = useState<string | null>(null);\n   861→  const [selectedVisualizationMetric, setSelectedVisualizationMetric] = useState<string | null>(null);\n   862→  const [categoryFilter, setCategoryFilter] = useState<string | null>(null);\n   863→  const [showLandmarkOverlay, setShowLandmarkOverlay] = useState(true);\n   864→  const { updateStreak } = useStreak();\n   865→\n   866→  // API Fetch State\n   867→  const [isLoading, setIsLoading] = useState(false);\n   868→  const [error, setError] = useState<string | null>(null);\n   869→  const [analysisResults, setAnalysisResults] = useState<{\n   870→    frontAnalysis: { measurements: any[]; standardizedScore: number | string };\n   871→    sideAnalysis: { measurements: any[]; standardizedScore: number | string } | null;\n   872→    harmony: {\n   873→      measurements: any[];\n   874→      overallScore: number | string;\n   875→      frontScore: number | string;\n   876→      sideScore: number | string;\n   877→      standardizedScore: number | string;\n   878→    };\n   879→    psl?: PSLResult;\n   880→    archetype?: ArchetypeClassification;\n   881→    vision?: any;\n   882→    isObfuscated?: boolean;\n   883→  } | null>(null);\n   884→\n   885→\n   886→  // Fetch analysis from server\n   887→  const fetchAnalysis = useCallback(async () => {\n   888→    if (frontLandmarks.length === 0) return;\n   889→\n   890→    setIsLoading(true);\n   891→    setError(null);\n   892→    try {\n   893→      const response = await fetch('/api/analyze-face', {\n   894→        method: 'POST',\n   895→        headers: { 'Content-Type': 'application/json' },\n   896→        body: JSON.stringify({\n   897→          frontLandmarks,\n   898→          sideLandmarks,\n   899→          gender,\n   900→          ethnicity,\n   901→          frontPhoto,\n   902→          sidePhoto,\n   903→          isPaid: isUnlocked\n   904→        }),\n   905→      });\n   906→\n   907→      if (!response.ok) {\n   908→        throw new Error('Analysis failed');\n   909→      }\n   910→\n   911→      const data = await response.json();\n   912→      setAnalysisResults(data);\n   913→      updateStreak();\n   914→    } catch (err) {\n   915→      console.error('Fetch analysis error:', err);\n   916→      setError('Failed to load analysis. Please try again.');\n   917→    } finally {\n   918→      setIsLoading(false);\n   919→    }\n   920→  }, [frontLandmarks, sideLandmarks, gender, ethnicity, isUnlocked]);\n   921→\n   922→  // Trigger fetch when data changes\n   923→  useEffect(() => {\n   924→    if (frontLandmarks.length > 0) {\n   925→      fetchAnalysis();\n   926→    }\n   927→  }, [fetchAnalysis, frontLandmarks.length]); // Depend on fetchAnalysis which covers dependencies\n   928→\n   929→  // Transform to Ratio format\n   930→  const frontRatios = useMemo(() => {\n   931→    if (!analysisResults?.frontAnalysis) return [];\n   932→    return analysisResults.frontAnalysis.measurements.map((m: any) => transformToRatio(m, frontLandmarks));\n   933→  }, [analysisResults, frontLandmarks]);\n   934→\n   935→  const sideRatios = useMemo(() => {\n   936→    if (!analysisResults?.sideAnalysis) return [];\n   937→    return analysisResults.sideAnalysis.measurements.map((m: any) => transformToRatio(m, sideLandmarks));\n   938→  }, [analysisResults, sideLandmarks]);\n   939→\n   940→  // Generate strengths and flaws using INSIGHTS-BASED classification\n   941→  const { insightStrengths, insightFlaws } = useMemo(() => {\n   942→    if (!analysisResults?.harmony) {\n   943→      return { insightStrengths: [], insightFlaws: [] };\n   944→    }\n   945→\n   946→    try {\n   947→      // Classify using insights engine\n   948→      // Note: Cast to any for harmony.measurements because of potential obfuscated strings mismatching pure types\n   949→      const { strengths: classifiedStrengths, weaknesses: classifiedWeaknesses } =\n   950→        classifyInsights(analysisResults.harmony.measurements as any, INSIGHTS_DEFINITIONS);\n   951→\n   952→      // Convert to UI-compatible types\n   953→      const insightStrengths = classifiedStrengths.map((s) => convertToStrength(s));\n   954→\n   955→      let rollingLost = 0;\n   956→      const insightFlaws = classifiedWeaknesses.map((w, i) => {\n   957→        const flaw = convertToFlaw(w, i, rollingLost);\n   958→        rollingLost = flaw.rollingPointsDeducted || 0;\n   959→        return flaw;\n   960→      });\n   961→\n   962→      return { insightStrengths, insightFlaws };\n   963→    } catch (error) {\n   964→      console.error('[ResultsContext] Error in insights classification:', error);\n   965→      return { insightStrengths: [], insightFlaws: [] };\n   966→    }\n   967→  }, [analysisResults]);\n   968→\n   969→  // Generate grouping-based strengths/flaws (legacy approach -> we don't have this function imported anymore)\n   970→  // Assuming generating strengths purely from insights now to simplify.\n   971→  // Or I can re-implement generateStrengthsFromAnalysis if needed, but it was complex.\n   972→  // For now, I will stick to insights.\n   973→\n   974→  const strengths = insightStrengths;\n   975→  const flaws = useMemo(() => {\n   976→    let rollingLost = 0;\n   977→    return insightFlaws.map(f => {\n   978→      rollingLost += f.harmonyPercentageLost;\n   979→      return {\n   980→        ...f,\n   981→        rollingPointsDeducted: rollingLost,\n   982→        rollingHarmonyPercentageLost: rollingLost,\n   983→        rollingStandardizedImpact: rollingLost / 10,\n   984→      };\n   985→    });\n   986→  }, [insightFlaws]);\n   987→\n   988→\n   989→  // Generate recommendations\n   990→  const recommendations = useMemo(() => {\n   991→    return generateRecommendations(flaws, frontRatios, sideRatios, gender, ethnicity);\n   992→  }, [flaws, frontRatios, sideRatios, gender, ethnicity]);\n   993→\n   994→  // Generate product recommendations (Affiliates)\n   995→  const productRecommendations = useMemo(() => {\n   996→    return generateProductRecommendations(flaws, analysisResults?.vision);\n   997→  }, [flaws, analysisResults?.vision]);\n   998→\n   999→  // Build full harmony analysis\n  1000→  const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {\n  1001→    if (!analysisResults?.harmony) return null;\n  1002→\n  1003→    // We can just construct it from what we have\n  1004→    // analysisResults.harmony has { overallScore, frontScore, sideScore, measurements, flaws, strengths }\n  1005→    // But we computed distinct strengths/flaws here.\n  1006→    return {\n  1007→      standardizedScore: Number(analysisResults.harmony.standardizedScore) || 0,\n  1008→      front: {\n  1009→        standardizedScore: Number(analysisResults.harmony.frontScore) || 0,\n  1010→        ratios: frontRatios,\n  1011→      },\n  1012→      side: {\n  1013→        standardizedScore: Number(analysisResults.harmony.sideScore) || 0,\n  1014→        ratios: sideRatios,\n  1015→      },\n  1016→      strengths,\n  1017→      flaws,\n  1018→    };\n  1019→  }, [analysisResults, frontRatios, sideRatios, strengths, flaws]);\n  1020→\n  1021→\n  1022→  // Weighted Harmony Score logic (moved to server in analyzeHarmony?)\n  1023→  // Actually analyzeHarmony returns overallScore. \n  1024→  // looksmax-scoring `calculateHarmonyScore` is redundant if logic is on server.\n  1025→  // We can just use the score from the server.\n  1026→  // But ResultsContext type expects `harmonyScoreResult` object.\n  1027→  // I will mock it or adapt it.\n  1028→\n  1029→  const harmonyScoreResult = null; // Deprecated or handled by server\n  1030→\n  1031→  // Get top 3 and bottom 3 metrics\n  1032→  // Using the helper functions on the measurements\n  1033→  const topMetrics = useMemo((): RankedMetric[] => {\n  1034→    if (!analysisResults?.harmony) return [];\n  1035→    return getTopMetrics(analysisResults.harmony.measurements as any, 3);\n  1036→  }, [analysisResults]);\n  1037→\n  1038→  const bottomMetrics = useMemo((): RankedMetric[] => {\n  1039→    if (!analysisResults?.harmony) return [];\n  1040→    return getBottomMetrics(analysisResults.harmony.measurements as any, 3);\n  1041→  }, [analysisResults]);\n  1042→\n  1043→  // Scores\n  1044→  // Handle string or number\n  1045→  const harmonyPercentage = analysisResults?.harmony ? (Number(analysisResults.harmony.overallScore) * 10) : 0;\n  1046→  // Wait, overallScore is 0-10. HarmonyPercentage is usually 0-100.\n  1047→\n  1048→  const overallScore = analysisResults?.harmony?.overallScore || 0;\n  1049→  const frontScore = analysisResults?.harmony?.frontScore || 0;\n  1050→  const sideScore = analysisResults?.harmony?.sideScore || 0;\n  1051→\n  1052→  // Archetype\n  1053→  const archetype = analysisResults?.archetype || null;\n  1054→\n  1055→  // PSL Rating\n  1056→  const pslRating = useMemo(() => {\n  1057→    // Priority: Server-side PSL\n  1058→    if (analysisResults?.psl) {\n  1059→      return {\n  1060→        psl: analysisResults.psl.score,\n  1061→        tier: analysisResults.psl.tier,\n  1062→        percentile: analysisResults.psl.percentile,\n  1063→        description: `Your score places you in the ${analysisResults.psl.tier} tier.` // Simple fallback description or fetch via ID mapping if needed\n  1064→      };\n  1065→    }\n  1066→\n  1067→    // Fallback: Legacy client-side calc\n  1068→    // If obfuscated, we might not have a valid number.\n  1069→    const scoreNum = Number(overallScore) * 10;\n  1070→    return harmonyToPSL(isNaN(scoreNum) ? 0 : scoreNum);\n  1071→  }, [overallScore, analysisResults?.psl]);\n  1072→\n  1073→  // Action to set all results data\n  1074→  const setResultsData = useCallback((data: ResultsInputData) => {\n  1075→    setFrontLandmarks(data.frontLandmarks);\n  1076→    setSideLandmarks(data.sideLandmarks);\n  1077→    setFrontPhoto(data.frontPhoto);\n  1078→    setSidePhoto(data.sidePhoto || null);\n  1079→    setGender(data.gender);\n  1080→    setEthnicity(data.ethnicity || 'other');\n  1081→    if (data.isUnlocked !== undefined) setIsUnlocked(data.isUnlocked);\n  1082→  }, []);\n  1083→\n  1084→  const value = useMemo<ResultsContextType>(() => ({\n  1085→    frontLandmarks,\n  1086→    sideLandmarks,\n  1087→    gender,\n  1088→    ethnicity,\n  1089→    frontPhoto,\n  1090→    sidePhoto,\n  1091→    isUnlocked,\n  1092→    harmonyAnalysis,\n  1093→    frontRatios,\n  1094→    sideRatios,\n  1095→    strengths,\n  1096→    flaws,\n  1097→    recommendations,\n  1098→    productRecommendations,\n  1099→    archetype,\n  1100→    overallScore,\n  1101→    frontScore,\n  1102→    sideScore,\n  1103→    harmonyScoreResult,\n  1104→    harmonyPercentage: isNaN(harmonyPercentage) ? 0 : harmonyPercentage,\n  1105→    topMetrics,\n  1106→    bottomMetrics,\n  1107→    pslRating,\n  1108→    activeTab,\n  1109→    setActiveTab,\n  1110→    expandedMeasurementId,\n  1111→    setExpandedMeasurementId,\n  1112→    selectedVisualizationMetric,\n  1113→    setSelectedVisualizationMetric,\n  1114→    categoryFilter,\n  1115→    setCategoryFilter,\n  1116→    vision: analysisResults?.vision || null,\n  1117→    showLandmarkOverlay,\n  1118→    setShowLandmarkOverlay,\n  1119→    isLoading,\n  1120→    error,\n  1121→    setResultsData,\n  1122→    refetchAnalysis: fetchAnalysis,\n  1123→  }), [\n  1124→    frontLandmarks, sideLandmarks, gender, ethnicity, frontPhoto, sidePhoto, isUnlocked,\n  1125→    harmonyAnalysis, frontRatios, sideRatios, strengths, flaws, recommendations, archetype,\n  1126→    analysisResults?.vision,\n  1127→    showLandmarkOverlay, setShowLandmarkOverlay, isLoading, error, setResultsData, fetchAnalysis,\n  1128→    activeTab, setActiveTab,\n  1129→    expandedMeasurementId, setExpandedMeasurementId,\n  1130→    selectedVisualizationMetric, setSelectedVisualizationMetric,\n  1131→    categoryFilter, setCategoryFilter,\n  1132→    overallScore, frontScore, sideScore, harmonyScoreResult, harmonyPercentage, // Also added these just in case\n  1133→    topMetrics, bottomMetrics, pslRating\n  1134→  ]);\n  1135→\n  1136→  return (\n  1137→    <ResultsContext.Provider value={value}>\n  1138→      {children}\n  1139→    </ResultsContext.Provider>\n  1140→  );\n  1141→}\n  1142→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"9fbbdf7c-0f11-4f9c-ac14-cfe26f884689","timestamp":"2025-12-27T12:31:51.972Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/contexts/ResultsContext.tsx","content":"/* eslint-disable @typescript-eslint/no-unused-vars */\n/* eslint-disable @typescript-eslint/no-explicit-any */\n'use client';\n\nimport React, { createContext, useContext, useState, useMemo, useCallback, useEffect, ReactNode } from 'react';\nimport { LandmarkPoint } from '@/lib/landmarks';\nimport {\n  MetricScoreResult,\n  METRIC_CONFIGS,\n  Ethnicity,\n  Gender,\n} from '@/lib/harmony-scoring';\nimport {\n  calculateHarmonyScore,\n  getTopMetrics,\n  getBottomMetrics,\n  HarmonyScoreResult,\n  RankedMetric,\n} from '@/lib/looksmax-scoring';\nimport { harmonyToPSL } from '@/lib/recommendations/severity';\nimport {\n  classifyInsights,\n  convertToStrength,\n  convertToFlaw,\n  INSIGHTS_DEFINITIONS,\n} from '@/lib/insights-engine';\nimport { useStreak } from '@/hooks/useStreak';\nimport { classifyMetric } from '@/lib/taxonomy';\nimport {\n  Ratio,\n  Strength,\n  Flaw,\n  Recommendation,\n  ResultsTab,\n  FullHarmonyAnalysis,\n  ProfileAnalysis,\n} from '@/types/results';\nimport { generateRecommendations } from '@/lib/results/analysis';\n// Import types for the new data\nimport { PSLResult } from '@/types/psl';\nimport { ArchetypeClassification } from '@/lib/archetype-classifier';\nimport { ProductRecommendation } from '@/types/results';\nimport { generateProductRecommendations } from '@/lib/recommendations/products';\n\n// ============================================\n// CONTEXT TYPES\n// ============================================\n\ninterface ResultsContextType {\n  // Raw data\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  gender: Gender;\n  ethnicity: Ethnicity;\n  frontPhoto: string;\n  sidePhoto: string | null;\n  isUnlocked: boolean;\n\n  // Computed results\n  harmonyAnalysis: FullHarmonyAnalysis | null;\n  frontRatios: Ratio[];\n  sideRatios: Ratio[];\n  strengths: Strength[];\n  flaws: Flaw[];\n  recommendations: Recommendation[];\n  productRecommendations: ProductRecommendation[];\n\n  // Scores\n  overallScore: number | string;\n  frontScore: number | string;\n  sideScore: number | string;\n\n  // Weighted Harmony Score\n  harmonyScoreResult: HarmonyScoreResult | null;\n  harmonyPercentage: number;  // 0-100% weighted harmony\n\n  // Top 3 strengths and bottom 3 areas to improve with advice\n  topMetrics: RankedMetric[];\n  bottomMetrics: RankedMetric[];\n\n  // Archetype Analysis\n  archetype: ArchetypeClassification | null;\n\n  // PSL Rating (1-10 scale)\n  pslRating: {\n    psl: number;\n    tier: string;\n    percentile: number;\n    description: string;\n  };\n\n  // Vision Analysis\n  vision: any | null;\n\n  // UI state\n  activeTab: ResultsTab;\n  setActiveTab: (tab: ResultsTab) => void;\n  expandedMeasurementId: string | null;\n  setExpandedMeasurementId: (id: string | null) => void;\n  selectedVisualizationMetric: string | null;\n  setSelectedVisualizationMetric: (id: string | null) => void;\n  categoryFilter: string | null;\n  setCategoryFilter: (category: string | null) => void;\n  showLandmarkOverlay: boolean;\n  setShowLandmarkOverlay: (show: boolean) => void;\n  isLoading: boolean;\n  error: string | null;\n\n  // Actions\n  setResultsData: (data: ResultsInputData) => void;\n  refetchAnalysis: () => Promise<void>;\n}\n\ninterface ResultsInputData {\n  frontLandmarks: LandmarkPoint[];\n  sideLandmarks: LandmarkPoint[];\n  frontPhoto: string;\n  sidePhoto?: string;\n  gender: Gender;\n  ethnicity?: Ethnicity;\n  isUnlocked?: boolean;\n}\n\n// ============================================\n// ILLUSTRATION CONFIGURATION\n// ============================================\n\ninterface IllustrationConfig {\n  points: string[];\n  lines: Array<{\n    from: string;\n    to: string;\n    label?: string;\n    color?: string;\n    labelPosition?: 'start' | 'middle' | 'end';\n  }>;\n}\n\nconst ILLUSTRATION_CONFIGS: Record<string, IllustrationConfig> = {\n  // FACE SHAPE / PROPORTIONS\n  faceWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Width', color: '#67e8f9', labelPosition: 'middle' },\n      { from: 'trichion', to: 'menton', label: 'Height', color: '#a78bfa', labelPosition: 'end' },\n    ],\n  },\n  totalFacialWidthToHeight: {\n    points: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n      { from: 'trichion', to: 'menton', label: 'Total Height', color: '#a78bfa' },\n    ],\n  },\n  lowerThirdProportion: {\n    points: ['subnasale', 'menton', 'trichion'],\n    lines: [\n      { from: 'subnasale', to: 'menton', label: 'Lower Third', color: '#f97316', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },\n  middleThirdProportion: {\n    points: ['nasal_base', 'subnasale', 'trichion', 'menton'],\n    lines: [\n      { from: 'nasal_base', to: 'subnasale', label: 'Middle Third', color: '#22c55e', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },\n  upperThirdProportion: {\n    points: ['trichion', 'nasal_base', 'menton'],\n    lines: [\n      { from: 'trichion', to: 'nasal_base', label: 'Upper Third', color: '#fbbf24', labelPosition: 'end' },\n      { from: 'trichion', to: 'menton', label: 'Full Height', color: '#67e8f9', labelPosition: 'start' },\n    ],\n  },\n  bitemporalWidth: {\n    points: ['left_temporal', 'right_temporal', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_temporal', to: 'right_temporal', label: 'Temple', color: '#fbbf24' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek', color: '#67e8f9' },\n    ],\n  },\n  cheekboneHeight: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_lateralis', 'right_canthus_lateralis', 'menton'],\n    lines: [\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheekbone', color: '#ec4899' },\n      { from: 'left_canthus_lateralis', to: 'left_zygion', color: '#67e8f9' },\n    ],\n  },\n  midfaceRatio: {\n    points: ['left_zygion', 'right_zygion', 'left_canthus_medialis', 'right_canthus_medialis', 'subnasale'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Midface Width', color: '#67e8f9' },\n      { from: 'left_canthus_medialis', to: 'subnasale', label: 'Midface Height', color: '#a78bfa' },\n    ],\n  },\n\n  // JAW MEASUREMENTS\n  jawSlope: {\n    points: ['left_gonion_inferior', 'left_mentum_lateralis', 'menton', 'right_mentum_lateralis', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'left_mentum_lateralis', label: 'Jaw Slope', color: '#f97316' },\n      { from: 'right_gonion_inferior', to: 'right_mentum_lateralis', color: '#f97316' },\n    ],\n  },\n  jawFrontalAngle: {\n    points: ['left_gonion_inferior', 'menton', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'menton', label: 'Jaw Angle', color: '#f97316' },\n      { from: 'menton', to: 'right_gonion_inferior', color: '#f97316' },\n    ],\n  },\n  bigonialWidth: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw Width', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Cheek Width', color: '#67e8f9' },\n    ],\n  },\n  jawWidthRatio: {\n    points: ['left_gonion_inferior', 'right_gonion_inferior', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face', color: '#67e8f9' },\n    ],\n  },\n\n  // EYE MEASUREMENTS\n  lateralCanthalTilt: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'right_canthus_medialis', 'right_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Tilt', color: '#06b6d4', labelPosition: 'end' },\n      { from: 'right_canthus_medialis', to: 'right_canthus_lateralis', color: '#06b6d4' },\n    ],\n  },\n  eyeAspectRatio: {\n    points: ['left_canthus_medialis', 'left_canthus_lateralis', 'left_palpebra_superior', 'left_palpebra_inferior'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Width', color: '#06b6d4' },\n      { from: 'left_palpebra_superior', to: 'left_palpebra_inferior', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  eyeSeparationRatio: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  interpupillaryMouthWidthRatio: {\n    points: ['left_pupila', 'right_pupila', 'left_cheilion', 'right_cheilion'],\n    lines: [\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4' },\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n    ],\n  },\n  oneEyeApartTest: {\n    points: ['left_canthus_medialis', 'right_canthus_medialis', 'left_canthus_lateralis'],\n    lines: [\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Between Eyes', color: '#06b6d4' },\n      { from: 'left_canthus_medialis', to: 'left_canthus_lateralis', label: 'Eye Width', color: '#a78bfa' },\n    ],\n  },\n\n  // EYEBROW MEASUREMENTS\n  browLengthRatio: {\n    points: ['left_supercilium_medialis', 'left_supercilium_lateralis', 'left_zygion', 'right_zygion'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_lateralis', label: 'Brow', color: '#84cc16' },\n      { from: 'left_zygion', to: 'right_zygion', label: 'Face Width', color: '#67e8f9' },\n    ],\n  },\n  eyebrowTilt: {\n    points: ['left_supercilium_medialis', 'left_supercilium_apex', 'left_supercilium_lateralis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_supercilium_apex', label: 'Tilt', color: '#84cc16' },\n      { from: 'left_supercilium_apex', to: 'left_supercilium_lateralis', color: '#84cc16' },\n    ],\n  },\n  eyebrowLowSetedness: {\n    points: ['left_supercilium_medialis', 'left_palpebra_superior', 'left_canthus_medialis'],\n    lines: [\n      { from: 'left_supercilium_medialis', to: 'left_palpebra_superior', label: 'Brow-Eye Gap', color: '#84cc16' },\n    ],\n  },\n\n  // NOSE MEASUREMENTS (FRONT)\n  nasalIndex: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Width', color: '#fbbf24' },\n      { from: 'nasal_base', to: 'subnasale', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  intercanthalNasalRatio: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'left_canthus_medialis', 'right_canthus_medialis'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose Width', color: '#fbbf24' },\n      { from: 'left_canthus_medialis', to: 'right_canthus_medialis', label: 'Intercanthal', color: '#06b6d4' },\n    ],\n  },\n  noseBridgeWidth: {\n    points: ['left_dorsum_nasi', 'right_dorsum_nasi', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_dorsum_nasi', to: 'right_dorsum_nasi', label: 'Bridge', color: '#fbbf24' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Base', color: '#f97316' },\n    ],\n  },\n  noseTipPosition: {\n    points: ['subnasale', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Tip Position', color: '#fbbf24' },\n    ],\n  },\n\n  // MOUTH/LIP MEASUREMENTS\n  mouthNoseWidthRatio: {\n    points: ['left_cheilion', 'right_cheilion', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  lowerUpperLipRatio: {\n    points: ['labrale_superius', 'mouth_middle', 'labrale_inferius'],\n    lines: [\n      { from: 'labrale_superius', to: 'mouth_middle', label: 'Upper', color: '#ec4899' },\n      { from: 'mouth_middle', to: 'labrale_inferius', label: 'Lower', color: '#f97316' },\n    ],\n  },\n  chinPhiltrumRatio: {\n    points: ['subnasale', 'labrale_superius', 'labrale_inferius', 'menton'],\n    lines: [\n      { from: 'subnasale', to: 'labrale_superius', label: 'Philtrum', color: '#ec4899' },\n      { from: 'labrale_inferius', to: 'menton', label: 'Chin', color: '#ef4444' },\n    ],\n  },\n  mouthWidth: {\n    points: ['left_cheilion', 'right_cheilion'],\n    lines: [{ from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth Width', color: '#ec4899' }],\n  },\n\n  // CHIN MEASUREMENTS\n  chinHeight: {\n    points: ['labrale_inferius', 'menton'],\n    lines: [{ from: 'labrale_inferius', to: 'menton', label: 'Chin Height', color: '#ef4444' }],\n  },\n\n  // NECK MEASUREMENTS\n  neckWidthRatio: {\n    points: ['left_cervical_lateralis', 'right_cervical_lateralis', 'left_gonion_inferior', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_cervical_lateralis', to: 'right_cervical_lateralis', label: 'Neck', color: '#14b8a6' },\n      { from: 'left_gonion_inferior', to: 'right_gonion_inferior', label: 'Jaw', color: '#f97316' },\n    ],\n  },\n\n  // SIDE PROFILE MEASUREMENTS\n  gonialAngle: {\n    points: ['tragus', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'tragus', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  nasofrontalAngle: {\n    points: ['glabella', 'nasion', 'pronasale'],\n    lines: [\n      { from: 'glabella', to: 'nasion', label: 'Forehead', color: '#84cc16' },\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  nasofacialAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', color: '#67e8f9' },\n    ],\n  },\n  nasomentaAngle: {\n    points: ['nasion', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', label: 'Nose', color: '#fbbf24' },\n      { from: 'pronasale', to: 'pogonion', label: 'To Chin', color: '#ef4444' },\n    ],\n  },\n  submentalCervicalAngle: {\n    points: ['menton', 'cervicalPoint', 'neckPoint'],\n    lines: [\n      { from: 'menton', to: 'cervicalPoint', label: 'Submental', color: '#14b8a6' },\n      { from: 'cervicalPoint', to: 'neckPoint', label: 'Cervical', color: '#06b6d4' },\n    ],\n  },\n  facialDepthToHeight: {\n    points: ['pronasale', 'tragus', 'nasion', 'menton'],\n    lines: [\n      { from: 'pronasale', to: 'tragus', label: 'Depth', color: '#67e8f9' },\n      { from: 'nasion', to: 'menton', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  anteriorFacialDepth: {\n    points: ['glabella', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'glabella', to: 'pronasale', color: '#67e8f9' },\n      { from: 'pronasale', to: 'pogonion', color: '#a78bfa' },\n    ],\n  },\n  mandibularPlaneAngle: {\n    points: ['gonionBottom', 'menton', 'orbitale', 'porion'],\n    lines: [\n      { from: 'gonionBottom', to: 'menton', label: 'Mandibular', color: '#f97316' },\n      { from: 'orbitale', to: 'porion', label: 'Frankfort', color: '#67e8f9' },\n    ],\n  },\n  ramusToMandibleRatio: {\n    points: ['gonionTop', 'gonionBottom', 'menton'],\n    lines: [\n      { from: 'gonionTop', to: 'gonionBottom', label: 'Ramus', color: '#f97316' },\n      { from: 'gonionBottom', to: 'menton', label: 'Mandible', color: '#ef4444' },\n    ],\n  },\n  orbitalVector: {\n    points: ['cornealApex', 'orbitale', 'cheekbone'],\n    lines: [\n      { from: 'cornealApex', to: 'cheekbone', label: 'Orbital Vector', color: '#06b6d4' },\n    ],\n  },\n  eLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'E-Line', color: '#67e8f9' },\n    ],\n  },\n  sLineLowerLip: {\n    points: ['pronasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'S-Line', color: '#a78bfa' },\n    ],\n  },\n  holdawayHLine: {\n    points: ['pronasale', 'pogonion', 'labraleSuperius', 'labraleInferius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'H-Line', color: '#ec4899' },\n    ],\n  },\n  burstoneLowerLip: {\n    points: ['subnasale', 'pogonion', 'labraleInferius'],\n    lines: [\n      { from: 'subnasale', to: 'pogonion', label: 'Burstone', color: '#fbbf24' },\n    ],\n  },\n\n  // ADDITIONAL FRONT PROFILE METRICS\n  cupidsBowDepth: {\n    points: ['labrale_superius', 'cupids_bow_left', 'cupids_bow_right', 'cupids_bow_center'],\n    lines: [\n      { from: 'cupids_bow_left', to: 'cupids_bow_center', label: 'Bow', color: '#ec4899' },\n      { from: 'cupids_bow_center', to: 'cupids_bow_right', color: '#ec4899' },\n    ],\n  },\n  mouthCornerPosition: {\n    points: ['left_cheilion', 'right_cheilion', 'left_pupila', 'right_pupila'],\n    lines: [\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth Width', color: '#ec4899' },\n      { from: 'left_pupila', to: 'right_pupila', label: 'IPD', color: '#06b6d4', labelPosition: 'start' },\n    ],\n  },\n  iaaJfaDeviation: {\n    points: ['left_ala_nasi', 'right_ala_nasi', 'left_gonion_inferior', 'menton', 'right_gonion_inferior'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'IAA', color: '#fbbf24' },\n      { from: 'left_gonion_inferior', to: 'menton', label: 'JFA', color: '#f97316' },\n      { from: 'menton', to: 'right_gonion_inferior', color: '#f97316' },\n    ],\n  },\n  ipsilateralAlarAngle: {\n    points: ['left_ala_nasi', 'subnasale', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_ala_nasi', to: 'subnasale', label: 'Alar Angle', color: '#fbbf24' },\n      { from: 'subnasale', to: 'right_ala_nasi', color: '#fbbf24' },\n    ],\n  },\n  earProtrusionAngle: {\n    points: ['left_ear_helix', 'left_ear_attachment', 'left_tragus'],\n    lines: [\n      { from: 'left_ear_helix', to: 'left_ear_attachment', label: 'Protrusion', color: '#a78bfa' },\n    ],\n  },\n  earProtrusionRatio: {\n    points: ['left_ear_helix', 'left_ear_attachment', 'left_ear_lobule'],\n    lines: [\n      { from: 'left_ear_helix', to: 'left_ear_attachment', label: 'Distance', color: '#a78bfa' },\n      { from: 'left_ear_attachment', to: 'left_ear_lobule', label: 'Length', color: '#67e8f9' },\n    ],\n  },\n  mouthWidthToNoseRatio: {\n    points: ['left_cheilion', 'right_cheilion', 'left_ala_nasi', 'right_ala_nasi'],\n    lines: [\n      { from: 'left_cheilion', to: 'right_cheilion', label: 'Mouth', color: '#ec4899' },\n      { from: 'left_ala_nasi', to: 'right_ala_nasi', label: 'Nose', color: '#fbbf24' },\n    ],\n  },\n  lowerToUpperLipRatio: {\n    points: ['labrale_superius', 'mouth_middle', 'labrale_inferius'],\n    lines: [\n      { from: 'labrale_superius', to: 'mouth_middle', label: 'Upper', color: '#ec4899' },\n      { from: 'mouth_middle', to: 'labrale_inferius', label: 'Lower', color: '#f97316' },\n    ],\n  },\n  chinToPhiltrumRatio: {\n    points: ['subnasale', 'labrale_superius', 'labrale_inferius', 'menton'],\n    lines: [\n      { from: 'subnasale', to: 'labrale_superius', label: 'Philtrum', color: '#ec4899' },\n      { from: 'labrale_inferius', to: 'menton', label: 'Chin', color: '#ef4444' },\n    ],\n  },\n\n  // ADDITIONAL SIDE PROFILE METRICS\n  nasolabialAngle: {\n    points: ['columella', 'subnasale', 'labraleSuperius'],\n    lines: [\n      { from: 'columella', to: 'subnasale', label: 'Columella', color: '#fbbf24' },\n      { from: 'subnasale', to: 'labraleSuperius', label: 'Upper Lip', color: '#ec4899' },\n    ],\n  },\n  nasalTipAngle: {\n    points: ['nasion', 'pronasale', 'columella'],\n    lines: [\n      { from: 'nasion', to: 'pronasale', label: 'Dorsum', color: '#fbbf24' },\n      { from: 'pronasale', to: 'columella', label: 'Tip', color: '#f97316' },\n    ],\n  },\n  nasalProjection: {\n    points: ['alar_crease', 'pronasale', 'subnasale'],\n    lines: [\n      { from: 'alar_crease', to: 'pronasale', label: 'Projection', color: '#fbbf24' },\n    ],\n  },\n  nasalWToHRatio: {\n    points: ['alar_crease', 'pronasale', 'nasion', 'subnasale'],\n    lines: [\n      { from: 'alar_crease', to: 'pronasale', label: 'Width', color: '#fbbf24' },\n      { from: 'nasion', to: 'subnasale', label: 'Height', color: '#a78bfa' },\n    ],\n  },\n  noseTipRotationAngle: {\n    points: ['columella', 'subnasale', 'labraleSuperius'],\n    lines: [\n      { from: 'columella', to: 'subnasale', label: 'Rotation', color: '#fbbf24' },\n    ],\n  },\n  frankfortTipAngle: {\n    points: ['porion', 'orbitale', 'pronasale'],\n    lines: [\n      { from: 'porion', to: 'orbitale', label: 'Frankfort', color: '#67e8f9' },\n      { from: 'orbitale', to: 'pronasale', label: 'To Tip', color: '#fbbf24' },\n    ],\n  },\n  mentolabialAngle: {\n    points: ['labraleInferius', 'mentolabialSulcus', 'pogonion'],\n    lines: [\n      { from: 'labraleInferius', to: 'mentolabialSulcus', label: 'Lip', color: '#ec4899' },\n      { from: 'mentolabialSulcus', to: 'pogonion', label: 'Chin', color: '#ef4444' },\n    ],\n  },\n  zAngle: {\n    points: ['pogonion', 'labraleSuperius', 'frankfortHorizontal'],\n    lines: [\n      { from: 'pogonion', to: 'labraleSuperius', label: 'Z-Line', color: '#a78bfa' },\n    ],\n  },\n  facialConvexityGlabella: {\n    points: ['glabella', 'subnasale', 'pogonion'],\n    lines: [\n      { from: 'glabella', to: 'subnasale', label: 'Upper', color: '#84cc16' },\n      { from: 'subnasale', to: 'pogonion', label: 'Lower', color: '#ef4444' },\n    ],\n  },\n  facialConvexityNasion: {\n    points: ['nasion', 'subnasale', 'pogonion'],\n    lines: [\n      { from: 'nasion', to: 'subnasale', label: 'Midface', color: '#22c55e' },\n      { from: 'subnasale', to: 'pogonion', label: 'Lower', color: '#ef4444' },\n    ],\n  },\n  totalFacialConvexity: {\n    points: ['glabella', 'pronasale', 'pogonion'],\n    lines: [\n      { from: 'glabella', to: 'pronasale', label: 'Upper', color: '#84cc16' },\n      { from: 'pronasale', to: 'pogonion', label: 'Lower', color: '#ef4444' },\n    ],\n  },\n  interiorMidfaceProjectionAngle: {\n    points: ['orbitale', 'subnasale', 'pronasale'],\n    lines: [\n      { from: 'orbitale', to: 'subnasale', label: 'Orbital', color: '#06b6d4' },\n      { from: 'subnasale', to: 'pronasale', label: 'Midface', color: '#67e8f9' },\n    ],\n  },\n  recessionFromFrankfort: {\n    points: ['porion', 'orbitale', 'pogonion'],\n    lines: [\n      { from: 'porion', to: 'orbitale', label: 'Frankfort', color: '#67e8f9' },\n      { from: 'orbitale', to: 'pogonion', label: 'Recession', color: '#ef4444' },\n    ],\n  },\n  gonionToMouthLine: {\n    points: ['gonionBottom', 'cheilion', 'tragus'],\n    lines: [\n      { from: 'gonionBottom', to: 'cheilion', label: 'Gonion-Mouth', color: '#f97316' },\n    ],\n  },\n  eLineUpperLip: {\n    points: ['pronasale', 'pogonion', 'labraleSuperius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'E-Line', color: '#67e8f9' },\n    ],\n  },\n  sLineUpperLip: {\n    points: ['pronasale', 'pogonion', 'labraleSuperius'],\n    lines: [\n      { from: 'pronasale', to: 'pogonion', label: 'S-Line', color: '#a78bfa' },\n    ],\n  },\n  burstoneUpperLip: {\n    points: ['subnasale', 'pogonion', 'labraleSuperius'],\n    lines: [\n      { from: 'subnasale', to: 'pogonion', label: 'Burstone', color: '#fbbf24' },\n    ],\n  },\n  chinProjection: {\n    points: ['subnasale', 'pogonion', 'menton', 'frankfortHorizontal'],\n    lines: [\n      { from: 'subnasale', to: 'pogonion', label: 'Chin Proj', color: '#ef4444' },\n    ],\n  },\n  recessionRelativeToFrankfort: {\n    points: ['porion', 'orbitale', 'pogonion', 'menton'],\n    lines: [\n      { from: 'porion', to: 'orbitale', label: 'Frankfort', color: '#67e8f9' },\n      { from: 'pogonion', to: 'menton', label: 'Recession', color: '#ef4444' },\n    ],\n  },\n  browridgeInclinationAngle: {\n    points: ['glabella', 'trichion', 'nasion'],\n    lines: [\n      { from: 'glabella', to: 'trichion', label: 'Brow Ridge', color: '#84cc16' },\n      { from: 'glabella', to: 'nasion', color: '#67e8f9' },\n    ],\n  },\n  upperForeheadSlope: {\n    points: ['trichion', 'glabella', 'frankfortHorizontal'],\n    lines: [\n      { from: 'trichion', to: 'glabella', label: 'Forehead', color: '#84cc16' },\n    ],\n  },\n  midfaceProjectionAngle: {\n    points: ['orbitale', 'subnasale', 'pronasale'],\n    lines: [\n      { from: 'orbitale', to: 'subnasale', color: '#67e8f9' },\n      { from: 'subnasale', to: 'pronasale', label: 'Projection', color: '#22c55e' },\n    ],\n  },\n};\n\n// ============================================\n// HELPER FUNCTIONS\n// ============================================\n\nfunction convertUnitToRatioUnit(unit: string): 'x' | 'mm' | '%' | '°' {\n  switch (unit) {\n    case 'ratio': return 'x';\n    case 'percent': return '%';\n    case 'degrees': return '°';\n    case 'mm': return 'mm';\n    default: return 'x';\n  }\n}\n\nfunction transformToRatio(result: MetricScoreResult, landmarks: LandmarkPoint[]): Ratio {\n  const metricConfig = METRIC_CONFIGS[result.metricId];\n\n  // Generate illustration based on metric\n  const illustration = generateIllustration(result.metricId, landmarks);\n\n  // Get flaw/strength mappings\n  const { mayIndicateFlaws, mayIndicateStrengths } = getFlawStrengthMappings(result);\n\n  // Classify metric using Harmony taxonomy\n  const taxonomyClassification = classifyMetric(result.name, result.category);\n\n  // Clamp scores to valid 0-10 range for display (defense-in-depth)\n  const clampedScore = typeof result.standardizedScore === 'number'\n    ? Math.max(0, Math.min(10, result.standardizedScore))\n    : result.standardizedScore;\n\n  return {\n    id: result.metricId,\n    name: result.name,\n    value: result.value,\n    score: clampedScore,  // Use standardized 0-10 score for UI display\n    standardizedScore: clampedScore,\n    unit: convertUnitToRatioUnit(result.unit),\n    idealMin: result.idealMin,\n    idealMax: result.idealMax,\n    rangeMin: metricConfig?.rangeMin || result.idealMin - 0.5,\n    rangeMax: metricConfig?.rangeMax || result.idealMax + 0.5,\n    description: metricConfig?.description || '',\n    category: result.category,\n    qualityLevel: result.qualityTier,\n    severity: result.severity,\n    illustration,\n    mayIndicateFlaws,\n    mayIndicateStrengths,\n    usedLandmarks: getUsedLandmarks(result.metricId),\n    scoringCurveConfig: metricConfig ? {\n      decayRate: metricConfig.decayRate,\n      maxScore: metricConfig.maxScore,\n    } : undefined,\n    taxonomyPrimary: taxonomyClassification?.primary,\n    taxonomySecondary: taxonomyClassification?.secondary,\n  };\n}\n\nfunction generateIllustration(metricId: string, landmarks: LandmarkPoint[]): Ratio['illustration'] {\n  const landmarkMap: Record<string, LandmarkPoint> = {};\n  landmarks.forEach(l => { landmarkMap[l.id] = l; });\n\n  const config = ILLUSTRATION_CONFIGS[metricId];\n  const points: Record<string, { type: 'landmark'; landmarkId: string }> = {};\n  const lines: Record<string, { from: string; to: string; color: string; label?: string; labelPosition?: 'start' | 'middle' | 'end' }> = {};\n\n  if (config) {\n    config.points.forEach((pointId, i) => {\n      if (landmarkMap[pointId]) {\n        points[`point_${i}`] = { type: 'landmark', landmarkId: pointId };\n      }\n    });\n    config.lines.forEach((line, i) => {\n      lines[`line_${i}`] = {\n        from: line.from,\n        to: line.to,\n        color: line.color || '#67e8f9',\n        label: line.label,\n        labelPosition: line.labelPosition,\n      };\n    });\n  }\n\n  return { points, lines };\n}\n\nfunction getUsedLandmarks(metricId: string): string[] {\n  const landmarkMappings: Record<string, string[]> = {\n    faceWidthToHeight: ['left_zygion', 'right_zygion', 'trichion', 'menton'],\n    lateralCanthalTilt: ['left_canthus_medialis', 'left_canthus_lateralis'],\n    nasalIndex: ['left_ala_nasi', 'right_ala_nasi', 'nasal_base', 'subnasale'],\n    ipd: ['left_pupila', 'right_pupila'],\n    mouthWidth: ['left_cheilion', 'right_cheilion'],\n    jawWidth: ['left_gonion_inferior', 'right_gonion_inferior'],\n    chinHeight: ['labrale_inferius', 'menton'],\n    gonialAngle: ['tragus', 'gonionBottom', 'menton'],\n  };\n  return landmarkMappings[metricId] || [];\n}\n\nfunction getFlawStrengthMappings(result: MetricScoreResult): { mayIndicateFlaws: string[]; mayIndicateStrengths: string[] } {\n  const flawMappings: Record<string, { low: string[]; high: string[] }> = {\n    faceWidthToHeight: {\n      low: ['Narrow face', 'Vertically elongated face'],\n      high: ['Wide face', 'Horizontally expanded face'],\n    },\n    lowerThirdProportion: {\n      low: ['Short lower third', 'Deficient mandible'],\n      high: ['Long lower third', 'Mandibular excess'],\n    },\n    lateralCanthalTilt: {\n      low: ['Negative canthal tilt', 'Drooping eyes'],\n      high: ['Excessive positive canthal tilt'],\n    },\n    nasalIndex: {\n      low: ['Narrow nose', 'Leptorrhine nose'],\n      high: ['Wide nose', 'Platyrrhine nose'],\n    },\n    gonialAngle: {\n      low: ['Steep mandibular plane'],\n      high: ['Flat mandibular plane', 'Weak jaw definition'],\n    },\n  };\n\n  const strengthMappings: Record<string, { ideal: string[] }> = {\n    faceWidthToHeight: { ideal: ['Balanced facial proportions', 'Harmonious face shape'] },\n    lowerThirdProportion: { ideal: ['Ideal lower third height', 'Balanced facial thirds'] },\n    lateralCanthalTilt: { ideal: ['Positive canthal tilt', 'Attractive eye tilt'] },\n    nasalIndex: { ideal: ['Proportionate nose width', 'Harmonious nose shape'] },\n    gonialAngle: { ideal: ['Masculine jaw angle', 'Defined jawline'] },\n  };\n\n  const mayIndicateFlaws: string[] = [];\n  const mayIndicateStrengths: string[] = [];\n\n  // Very basic mapping logic for now\n  if (result.severity !== 'optimal' && result.severity !== 'minor') {\n    if (flawMappings[result.metricId]) {\n      if (result.deviationDirection === 'below') {\n        mayIndicateFlaws.push(...flawMappings[result.metricId].low);\n      } else {\n        mayIndicateFlaws.push(...flawMappings[result.metricId].high);\n      }\n    }\n  }\n\n  if (result.qualityTier === 'ideal' || result.qualityTier === 'excellent') {\n    if (strengthMappings[result.metricId]) {\n      mayIndicateStrengths.push(...strengthMappings[result.metricId].ideal);\n    }\n  }\n\n  return { mayIndicateFlaws, mayIndicateStrengths };\n}\n\n// ============================================\n// CONTEXT CREATION\n// ============================================\n\nconst ResultsContext = createContext<ResultsContextType | null>(null);\n\nexport function useResults(): ResultsContextType {\n  const context = useContext(ResultsContext);\n  if (!context) {\n    throw new Error('useResults must be used within a ResultsProvider');\n  }\n  return context;\n}\n\ninterface ResultsProviderProps {\n  children: ReactNode;\n  initialData?: ResultsInputData;\n}\n\nexport function ResultsProvider({ children, initialData }: ResultsProviderProps) {\n  // Raw data state\n  const [frontLandmarks, setFrontLandmarks] = useState<LandmarkPoint[]>(initialData?.frontLandmarks || []);\n  const [sideLandmarks, setSideLandmarks] = useState<LandmarkPoint[]>(initialData?.sideLandmarks || []);\n  const [gender, setGender] = useState<Gender>(initialData?.gender || 'male');\n  const [ethnicity, setEthnicity] = useState<Ethnicity>(initialData?.ethnicity || 'other');\n  const [frontPhoto, setFrontPhoto] = useState<string>(initialData?.frontPhoto || '');\n  const [sidePhoto, setSidePhoto] = useState<string | null>(initialData?.sidePhoto || null);\n  const [isUnlocked, setIsUnlocked] = useState<boolean>(initialData?.isUnlocked || false);\n\n  // UI state\n  const [activeTab, setActiveTab] = useState<ResultsTab>('overview');\n  const [expandedMeasurementId, setExpandedMeasurementId] = useState<string | null>(null);\n  const [selectedVisualizationMetric, setSelectedVisualizationMetric] = useState<string | null>(null);\n  const [categoryFilter, setCategoryFilter] = useState<string | null>(null);\n  const [showLandmarkOverlay, setShowLandmarkOverlay] = useState(true);\n  const { updateStreak } = useStreak();\n\n  // API Fetch State\n  const [isLoading, setIsLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [analysisResults, setAnalysisResults] = useState<{\n    frontAnalysis: { measurements: any[]; standardizedScore: number | string };\n    sideAnalysis: { measurements: any[]; standardizedScore: number | string } | null;\n    harmony: {\n      measurements: any[];\n      overallScore: number | string;\n      frontScore: number | string;\n      sideScore: number | string;\n      standardizedScore: number | string;\n    };\n    psl?: PSLResult;\n    archetype?: ArchetypeClassification;\n    vision?: any;\n    isObfuscated?: boolean;\n  } | null>(null);\n\n\n  // Fetch analysis from server\n  const fetchAnalysis = useCallback(async () => {\n    if (frontLandmarks.length === 0) return;\n\n    setIsLoading(true);\n    setError(null);\n    try {\n      const response = await fetch('/api/analyze-face', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({\n          frontLandmarks,\n          sideLandmarks,\n          gender,\n          ethnicity,\n          frontPhoto,\n          sidePhoto,\n          isPaid: isUnlocked\n        }),\n      });\n\n      if (!response.ok) {\n        throw new Error('Analysis failed');\n      }\n\n      const data = await response.json();\n      setAnalysisResults(data);\n      updateStreak();\n    } catch (err) {\n      console.error('Fetch analysis error:', err);\n      setError('Failed to load analysis. Please try again.');\n    } finally {\n      setIsLoading(false);\n    }\n  }, [frontLandmarks, sideLandmarks, gender, ethnicity, isUnlocked]);\n\n  // Trigger fetch when data changes\n  useEffect(() => {\n    if (frontLandmarks.length > 0) {\n      fetchAnalysis();\n    }\n  }, [fetchAnalysis, frontLandmarks.length]); // Depend on fetchAnalysis which covers dependencies\n\n  // Transform to Ratio format\n  const frontRatios = useMemo(() => {\n    if (!analysisResults?.frontAnalysis) return [];\n    return analysisResults.frontAnalysis.measurements.map((m: any) => transformToRatio(m, frontLandmarks));\n  }, [analysisResults, frontLandmarks]);\n\n  const sideRatios = useMemo(() => {\n    if (!analysisResults?.sideAnalysis) return [];\n    return analysisResults.sideAnalysis.measurements.map((m: any) => transformToRatio(m, sideLandmarks));\n  }, [analysisResults, sideLandmarks]);\n\n  // Generate strengths and flaws using INSIGHTS-BASED classification\n  const { insightStrengths, insightFlaws } = useMemo(() => {\n    if (!analysisResults?.harmony) {\n      return { insightStrengths: [], insightFlaws: [] };\n    }\n\n    try {\n      // Classify using insights engine\n      // Note: Cast to any for harmony.measurements because of potential obfuscated strings mismatching pure types\n      const { strengths: classifiedStrengths, weaknesses: classifiedWeaknesses } =\n        classifyInsights(analysisResults.harmony.measurements as any, INSIGHTS_DEFINITIONS);\n\n      // Convert to UI-compatible types\n      const insightStrengths = classifiedStrengths.map((s) => convertToStrength(s));\n\n      let rollingLost = 0;\n      const insightFlaws = classifiedWeaknesses.map((w, i) => {\n        const flaw = convertToFlaw(w, i, rollingLost);\n        rollingLost = flaw.rollingPointsDeducted || 0;\n        return flaw;\n      });\n\n      return { insightStrengths, insightFlaws };\n    } catch (error) {\n      console.error('[ResultsContext] Error in insights classification:', error);\n      return { insightStrengths: [], insightFlaws: [] };\n    }\n  }, [analysisResults]);\n\n  // Generate grouping-based strengths/flaws (legacy approach -> we don't have this function imported anymore)\n  // Assuming generating strengths purely from insights now to simplify.\n  // Or I can re-implement generateStrengthsFromAnalysis if needed, but it was complex.\n  // For now, I will stick to insights.\n\n  const strengths = insightStrengths;\n  const flaws = useMemo(() => {\n    let rollingLost = 0;\n    return insightFlaws.map(f => {\n      rollingLost += f.harmonyPercentageLost;\n      return {\n        ...f,\n        rollingPointsDeducted: rollingLost,\n        rollingHarmonyPercentageLost: rollingLost,\n        rollingStandardizedImpact: rollingLost / 10,\n      };\n    });\n  }, [insightFlaws]);\n\n\n  // Generate recommendations\n  const recommendations = useMemo(() => {\n    return generateRecommendations(flaws, frontRatios, sideRatios, gender, ethnicity);\n  }, [flaws, frontRatios, sideRatios, gender, ethnicity]);\n\n  // Generate product recommendations (Affiliates)\n  const productRecommendations = useMemo(() => {\n    return generateProductRecommendations(flaws, analysisResults?.vision);\n  }, [flaws, analysisResults?.vision]);\n\n  // Build full harmony analysis\n  const harmonyAnalysis = useMemo((): FullHarmonyAnalysis | null => {\n    if (!analysisResults?.harmony) return null;\n\n    // We can just construct it from what we have\n    // analysisResults.harmony has { overallScore, frontScore, sideScore, measurements, flaws, strengths }\n    // But we computed distinct strengths/flaws here.\n    return {\n      standardizedScore: Number(analysisResults.harmony.standardizedScore) || 0,\n      front: {\n        standardizedScore: Number(analysisResults.harmony.frontScore) || 0,\n        ratios: frontRatios,\n      },\n      side: {\n        standardizedScore: Number(analysisResults.harmony.sideScore) || 0,\n        ratios: sideRatios,\n      },\n      strengths,\n      flaws,\n    };\n  }, [analysisResults, frontRatios, sideRatios, strengths, flaws]);\n\n\n  // Weighted Harmony Score logic (moved to server in analyzeHarmony?)\n  // Actually analyzeHarmony returns overallScore. \n  // looksmax-scoring `calculateHarmonyScore` is redundant if logic is on server.\n  // We can just use the score from the server.\n  // But ResultsContext type expects `harmonyScoreResult` object.\n  // I will mock it or adapt it.\n\n  const harmonyScoreResult = null; // Deprecated or handled by server\n\n  // Get top 3 and bottom 3 metrics\n  // Using the helper functions on the measurements\n  const topMetrics = useMemo((): RankedMetric[] => {\n    if (!analysisResults?.harmony) return [];\n    return getTopMetrics(analysisResults.harmony.measurements as any, 3);\n  }, [analysisResults]);\n\n  const bottomMetrics = useMemo((): RankedMetric[] => {\n    if (!analysisResults?.harmony) return [];\n    return getBottomMetrics(analysisResults.harmony.measurements as any, 3);\n  }, [analysisResults]);\n\n  // Scores\n  // Handle string or number\n  const harmonyPercentage = analysisResults?.harmony ? (Number(analysisResults.harmony.overallScore) * 10) : 0;\n  // Wait, overallScore is 0-10. HarmonyPercentage is usually 0-100.\n\n  const overallScore = analysisResults?.harmony?.overallScore || 0;\n  const frontScore = analysisResults?.harmony?.frontScore || 0;\n  const sideScore = analysisResults?.harmony?.sideScore || 0;\n\n  // Archetype\n  const archetype = analysisResults?.archetype || null;\n\n  // PSL Rating\n  const pslRating = useMemo(() => {\n    // Priority: Server-side PSL\n    if (analysisResults?.psl) {\n      return {\n        psl: analysisResults.psl.score,\n        tier: analysisResults.psl.tier,\n        percentile: analysisResults.psl.percentile,\n        description: `Your score places you in the ${analysisResults.psl.tier} tier.` // Simple fallback description or fetch via ID mapping if needed\n      };\n    }\n\n    // Fallback: Legacy client-side calc\n    // If obfuscated, we might not have a valid number.\n    const scoreNum = Number(overallScore) * 10;\n    return harmonyToPSL(isNaN(scoreNum) ? 0 : scoreNum);\n  }, [overallScore, analysisResults?.psl]);\n\n  // Action to set all results data\n  const setResultsData = useCallback((data: ResultsInputData) => {\n    setFrontLandmarks(data.frontLandmarks);\n    setSideLandmarks(data.sideLandmarks);\n    setFrontPhoto(data.frontPhoto);\n    setSidePhoto(data.sidePhoto || null);\n    setGender(data.gender);\n    setEthnicity(data.ethnicity || 'other');\n    if (data.isUnlocked !== undefined) setIsUnlocked(data.isUnlocked);\n  }, []);\n\n  const value = useMemo<ResultsContextType>(() => ({\n    frontLandmarks,\n    sideLandmarks,\n    gender,\n    ethnicity,\n    frontPhoto,\n    sidePhoto,\n    isUnlocked,\n    harmonyAnalysis,\n    frontRatios,\n    sideRatios,\n    strengths,\n    flaws,\n    recommendations,\n    productRecommendations,\n    archetype,\n    overallScore,\n    frontScore,\n    sideScore,\n    harmonyScoreResult,\n    harmonyPercentage: isNaN(harmonyPercentage) ? 0 : harmonyPercentage,\n    topMetrics,\n    bottomMetrics,\n    pslRating,\n    activeTab,\n    setActiveTab,\n    expandedMeasurementId,\n    setExpandedMeasurementId,\n    selectedVisualizationMetric,\n    setSelectedVisualizationMetric,\n    categoryFilter,\n    setCategoryFilter,\n    vision: analysisResults?.vision || null,\n    showLandmarkOverlay,\n    setShowLandmarkOverlay,\n    isLoading,\n    error,\n    setResultsData,\n    refetchAnalysis: fetchAnalysis,\n  }), [\n    frontLandmarks, sideLandmarks, gender, ethnicity, frontPhoto, sidePhoto, isUnlocked,\n    harmonyAnalysis, frontRatios, sideRatios, strengths, flaws, recommendations, archetype,\n    analysisResults?.vision,\n    showLandmarkOverlay, setShowLandmarkOverlay, isLoading, error, setResultsData, fetchAnalysis,\n    activeTab, setActiveTab,\n    expandedMeasurementId, setExpandedMeasurementId,\n    selectedVisualizationMetric, setSelectedVisualizationMetric,\n    categoryFilter, setCategoryFilter,\n    overallScore, frontScore, sideScore, harmonyScoreResult, harmonyPercentage, // Also added these just in case\n    topMetrics, bottomMetrics, pslRating\n  ]);\n\n  return (\n    <ResultsContext.Provider value={value}>\n      {children}\n    </ResultsContext.Provider>\n  );\n}\n","numLines":1142,"startLine":1,"totalLines":1142}}}
{"parentUuid":"9fbbdf7c-0f11-4f9c-ac14-cfe26f884689","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CiKeXE1oH4FGeUwy4UmxJk","type":"tool_result","content":"No files found"}]},"uuid":"e7aa066b-c522-4916-ad29-727af6e18983","timestamp":"2025-12-27T12:31:52.157Z","toolUseResult":{"mode":"files_with_matches","filenames":[],"numFiles":0,"appliedLimit":50}}
{"parentUuid":"e7aa066b-c522-4916-ad29-727af6e18983","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01QxeNCVsUH7mLZZqfc8GJZ7","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect! Now let me check the Results page to see how it handles the modal state:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":19332,"cache_creation_input_tokens":608,"cache_read_input_tokens":54686,"cache_creation":{"ephemeral_5m_input_tokens":608,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWXCLz81GTuVhoUsdj1gr","type":"assistant","uuid":"6092c3ee-8510-445a-84a8-846fbe32aa8f","timestamp":"2025-12-27T12:31:56.653Z"}
{"parentUuid":"6092c3ee-8510-445a-84a8-846fbe32aa8f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01QxeNCVsUH7mLZZqfc8GJZ7","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_019mqCxJb4wQh8HLfwdiRcYU","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/results/page.tsx","limit":100}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":19332,"cache_creation_input_tokens":608,"cache_read_input_tokens":54686,"cache_creation":{"ephemeral_5m_input_tokens":608,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWXCLz81GTuVhoUsdj1gr","type":"assistant","uuid":"743b4d08-e6ae-49a6-82b1-19d6ab63952d","timestamp":"2025-12-27T12:31:57.304Z"}
{"parentUuid":"743b4d08-e6ae-49a6-82b1-19d6ab63952d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01QxeNCVsUH7mLZZqfc8GJZ7","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VRAyc2eQnfABgj7Fyg1ndW","name":"Bash","input":{"command":"grep -n \"GuidesTab\\|selectedGuide\\|AnimatePresence\" /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/results/page.tsx | head -20","description":"Check Results page integration with GuidesTab"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":19332,"cache_creation_input_tokens":608,"cache_read_input_tokens":54686,"cache_creation":{"ephemeral_5m_input_tokens":608,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWXCLz81GTuVhoUsdj1gr","type":"assistant","uuid":"6d5c0634-6c4e-4315-bc31-8497b1264de9","timestamp":"2025-12-27T12:31:57.999Z"}
{"parentUuid":"6d5c0634-6c4e-4315-bc31-8497b1264de9","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_019mqCxJb4wQh8HLfwdiRcYU","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useEffect, useState, Component, ReactNode } from 'react';\n     4→import { ResultsProvider } from '@/contexts/ResultsContext';\n     5→import { Results } from '@/components/results/Results';\n     6→import { LandmarkPoint, FRONT_PROFILE_LANDMARKS, SIDE_PROFILE_LANDMARKS } from '@/lib/landmarks';\n     7→import { Ethnicity, Gender } from '@/lib/harmony-scoring';\n     8→import {\n     9→  generateSampleData,\n    10→  isSampleMode,\n    11→  getSampleConfigFromURL,\n    12→} from '@/lib/sample-data';\n    13→\n    14→// Error Boundary for catching render errors\n    15→class ResultsErrorBoundary extends Component<\n    16→  { children: ReactNode },\n    17→  { hasError: boolean; error: Error | null }\n    18→> {\n    19→  constructor(props: { children: ReactNode }) {\n    20→    super(props);\n    21→    this.state = { hasError: false, error: null };\n    22→  }\n    23→\n    24→  static getDerivedStateFromError(error: Error) {\n    25→    return { hasError: true, error };\n    26→  }\n    27→\n    28→  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n    29→    console.error('[Results] Error caught by boundary:', error, errorInfo);\n    30→  }\n    31→\n    32→  render() {\n    33→    if (this.state.hasError) {\n    34→      return (\n    35→        <div className=\"min-h-screen bg-black flex items-center justify-center p-4\">\n    36→          <div className=\"text-center max-w-md\">\n    37→            <div className=\"w-12 h-12 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n    38→              <svg className=\"w-6 h-6 text-red-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n    39→                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n    40→              </svg>\n    41→            </div>\n    42→            <h2 className=\"text-xl font-semibold text-white mb-2\">Analysis Error</h2>\n    43→            <p className=\"text-neutral-400 mb-4\">\n    44→              {this.state.error?.message || 'Something went wrong while loading your results.'}\n    45→            </p>\n    46→            <button\n    47→              onClick={() => window.location.reload()}\n    48→              className=\"px-4 py-2 bg-cyan-500 text-black font-medium rounded-lg hover:bg-cyan-400 transition-colors\"\n    49→            >\n    50→              Try Again\n    51→            </button>\n    52→          </div>\n    53→        </div>\n    54→      );\n    55→    }\n    56→\n    57→    return this.props.children;\n    58→  }\n    59→}\n    60→\n    61→// Note: Metadata cannot be exported from client components\n    62→// The page title is set in the root layout\n    63→\n    64→// Demo data for testing - in production this would come from the analysis flow\n    65→const generateDemoLandmarks = (baseLandmarks: LandmarkPoint[]): LandmarkPoint[] => {\n    66→  return baseLandmarks.map(landmark => ({\n    67→    ...landmark,\n    68→    // Add slight randomization to simulate real placement\n    69→    x: landmark.x + (Math.random() - 0.5) * 0.02,\n    70→    y: landmark.y + (Math.random() - 0.5) * 0.02,\n    71→  }));\n    72→};\n    73→\n    74→// Placeholder image as data URI (1x1 transparent pixel - actual images come from analysis)\n    75→const PLACEHOLDER_IMAGE = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n    76→\n    77→// Generate demo data outside component to avoid closure issues\n    78→const createDemoData = () => ({\n    79→  frontLandmarks: generateDemoLandmarks(FRONT_PROFILE_LANDMARKS),\n    80→  sideLandmarks: generateDemoLandmarks(SIDE_PROFILE_LANDMARKS),\n    81→  frontPhoto: PLACEHOLDER_IMAGE,\n    82→  sidePhoto: PLACEHOLDER_IMAGE,\n    83→  gender: 'male' as Gender,\n    84→  ethnicity: 'white' as Ethnicity,\n    85→});\n    86→\n    87→export default function ResultsPage() {\n    88→  const [mounted, setMounted] = useState(false);\n    89→  const [isSample, setIsSample] = useState(false);\n    90→  const [initialData, setInitialData] = useState<{\n    91→    frontLandmarks: LandmarkPoint[];\n    92→    sideLandmarks: LandmarkPoint[];\n    93→    frontPhoto: string;\n    94→    sidePhoto?: string;\n    95→    gender: Gender;\n    96→    ethnicity?: Ethnicity;\n    97→    isUnlocked?: boolean;\n    98→  } | null>(null);\n    99→\n   100→  useEffect(() => {\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"6979928f-2564-48c2-aa74-062329508f36","timestamp":"2025-12-27T12:31:58.052Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/app/results/page.tsx","content":"'use client';\n\nimport { useEffect, useState, Component, ReactNode } from 'react';\nimport { ResultsProvider } from '@/contexts/ResultsContext';\nimport { Results } from '@/components/results/Results';\nimport { LandmarkPoint, FRONT_PROFILE_LANDMARKS, SIDE_PROFILE_LANDMARKS } from '@/lib/landmarks';\nimport { Ethnicity, Gender } from '@/lib/harmony-scoring';\nimport {\n  generateSampleData,\n  isSampleMode,\n  getSampleConfigFromURL,\n} from '@/lib/sample-data';\n\n// Error Boundary for catching render errors\nclass ResultsErrorBoundary extends Component<\n  { children: ReactNode },\n  { hasError: boolean; error: Error | null }\n> {\n  constructor(props: { children: ReactNode }) {\n    super(props);\n    this.state = { hasError: false, error: null };\n  }\n\n  static getDerivedStateFromError(error: Error) {\n    return { hasError: true, error };\n  }\n\n  componentDidCatch(error: Error, errorInfo: React.ErrorInfo) {\n    console.error('[Results] Error caught by boundary:', error, errorInfo);\n  }\n\n  render() {\n    if (this.state.hasError) {\n      return (\n        <div className=\"min-h-screen bg-black flex items-center justify-center p-4\">\n          <div className=\"text-center max-w-md\">\n            <div className=\"w-12 h-12 bg-red-500/20 rounded-full flex items-center justify-center mx-auto mb-4\">\n              <svg className=\"w-6 h-6 text-red-500\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path strokeLinecap=\"round\" strokeLinejoin=\"round\" strokeWidth={2} d=\"M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z\" />\n              </svg>\n            </div>\n            <h2 className=\"text-xl font-semibold text-white mb-2\">Analysis Error</h2>\n            <p className=\"text-neutral-400 mb-4\">\n              {this.state.error?.message || 'Something went wrong while loading your results.'}\n            </p>\n            <button\n              onClick={() => window.location.reload()}\n              className=\"px-4 py-2 bg-cyan-500 text-black font-medium rounded-lg hover:bg-cyan-400 transition-colors\"\n            >\n              Try Again\n            </button>\n          </div>\n        </div>\n      );\n    }\n\n    return this.props.children;\n  }\n}\n\n// Note: Metadata cannot be exported from client components\n// The page title is set in the root layout\n\n// Demo data for testing - in production this would come from the analysis flow\nconst generateDemoLandmarks = (baseLandmarks: LandmarkPoint[]): LandmarkPoint[] => {\n  return baseLandmarks.map(landmark => ({\n    ...landmark,\n    // Add slight randomization to simulate real placement\n    x: landmark.x + (Math.random() - 0.5) * 0.02,\n    y: landmark.y + (Math.random() - 0.5) * 0.02,\n  }));\n};\n\n// Placeholder image as data URI (1x1 transparent pixel - actual images come from analysis)\nconst PLACEHOLDER_IMAGE = 'data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7';\n\n// Generate demo data outside component to avoid closure issues\nconst createDemoData = () => ({\n  frontLandmarks: generateDemoLandmarks(FRONT_PROFILE_LANDMARKS),\n  sideLandmarks: generateDemoLandmarks(SIDE_PROFILE_LANDMARKS),\n  frontPhoto: PLACEHOLDER_IMAGE,\n  sidePhoto: PLACEHOLDER_IMAGE,\n  gender: 'male' as Gender,\n  ethnicity: 'white' as Ethnicity,\n});\n\nexport default function ResultsPage() {\n  const [mounted, setMounted] = useState(false);\n  const [isSample, setIsSample] = useState(false);\n  const [initialData, setInitialData] = useState<{\n    frontLandmarks: LandmarkPoint[];\n    sideLandmarks: LandmarkPoint[];\n    frontPhoto: string;\n    sidePhoto?: string;\n    gender: Gender;\n    ethnicity?: Ethnicity;\n    isUnlocked?: boolean;\n  } | null>(null);\n\n  useEffect(() => {","numLines":100,"startLine":1,"totalLines":192}}}
{"parentUuid":"6979928f-2564-48c2-aa74-062329508f36","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VRAyc2eQnfABgj7Fyg1ndW","type":"tool_result","content":"","is_error":false}]},"uuid":"2ed63688-963c-4b21-863c-e3cb334b721d","timestamp":"2025-12-27T12:31:58.123Z","toolUseResult":{"stdout":"","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"2ed63688-963c-4b21-863c-e3cb334b721d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01WPdtsTAXowx5S5c5yjPAMB","type":"message","role":"assistant","content":[{"type":"text","text":"Let me check how the Results component renders the tabs:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":21354,"cache_read_input_tokens":55294,"cache_creation":{"ephemeral_5m_input_tokens":21354,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWXCMRdvH2GLmu9fGZ9VZ","type":"assistant","uuid":"b78a9eec-7379-4fc6-9f91-bda815a84183","timestamp":"2025-12-27T12:32:00.453Z"}
{"parentUuid":"b78a9eec-7379-4fc6-9f91-bda815a84183","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01WPdtsTAXowx5S5c5yjPAMB","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WP4DeeNW9LBXRS1HWNbRtj","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/Results.tsx","limit":150}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":7,"cache_creation_input_tokens":21354,"cache_read_input_tokens":55294,"cache_creation":{"ephemeral_5m_input_tokens":21354,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWXCMRdvH2GLmu9fGZ9VZ","type":"assistant","uuid":"affa04d1-8586-47b2-b931-d788b295b972","timestamp":"2025-12-27T12:32:00.951Z"}
{"parentUuid":"affa04d1-8586-47b2-b931-d788b295b972","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01WP4DeeNW9LBXRS1HWNbRtj","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useEffect, useRef } from 'react';\n     4→import { useResults } from '@/contexts/ResultsContext';\n     5→import { useLeaderboardOptional } from '@/contexts/LeaderboardContext';\n     6→import { ResultsLayout } from './ResultsLayout';\n     7→import { OverviewTab } from './tabs/OverviewTab';\n     8→import { FrontRatiosTab, SideRatiosTab } from './tabs/RatiosTab';\n     9→import { PlanTab } from './tabs/PlanTab';\n    10→import { GuidesTab } from './tabs/GuidesTab';\n    11→import { ShopTab } from './tabs/ShopTab';\n    12→import { OptionsTab } from './tabs/OptionsTab';\n    13→import { SupportTab } from './tabs/SupportTab';\n    14→import { LeaderboardTab } from './tabs/LeaderboardTab';\n    15→import { CommunityTab } from './tabs/CommunityTab';\n    16→import { ReferralsTab } from './tabs/ReferralsTab';\n    17→import { PSLTab } from './tabs/PSLTab';\n    18→import { ArchetypeTab } from './tabs/ArchetypeTab';\n    19→import { api } from '@/lib/api';\n    20→\n    21→export function Results() {\n    22→  const { activeTab, overallScore, gender, ethnicity, frontPhoto, strengths, flaws } = useResults();\n    23→  const leaderboard = useLeaderboardOptional();\n    24→  const hasSubmittedRef = useRef(false);\n    25→\n    26→  // Auto-submit score to leaderboard on first render when score is available\n    27→  useEffect(() => {\n    28→    // Only submit once, when we have a valid score and haven't submitted yet\n    29→    const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n    30→    if (hasSubmittedRef.current || numericScore <= 0 || !leaderboard) return;\n    31→\n    32→    // Check if user is authenticated\n    33→    const token = api.getToken();\n    34→    if (!token) return;\n    35→\n    36→    // Mark as submitted to prevent duplicate submissions\n    37→    hasSubmittedRef.current = true;\n    38→\n    39→    // Extract top 3 strengths and improvements\n    40→    const topStrengths = strengths.slice(0, 3).map(s => s.strengthName);\n    41→    const topImprovements = flaws.slice(0, 3).map(f => f.flawName);\n    42→\n    43→    // Submit to leaderboard\n    44→    leaderboard.submitScore(numericScore, gender, {\n    45→      ethnicity,\n    46→      facePhotoUrl: frontPhoto,\n    47→      topStrengths,\n    48→      topImprovements,\n    49→    }).catch(err => {\n    50→      // Reset flag on error so user can retry\n    51→      hasSubmittedRef.current = false;\n    52→      console.error('[Leaderboard] Auto-submit failed:', err);\n    53→    });\n    54→  }, [overallScore, gender, ethnicity, frontPhoto, strengths, flaws, leaderboard]);\n    55→\n    56→  const renderTabContent = () => {\n    57→    switch (activeTab) {\n    58→      case 'overview':\n    59→        return <OverviewTab />;\n    60→      case 'front-ratios':\n    61→        return <FrontRatiosTab />;\n    62→      case 'side-ratios':\n    63→        return <SideRatiosTab />;\n    64→      case 'leaderboard':\n    65→        return <LeaderboardTab />;\n    66→      case 'psl':\n    67→        return <PSLTab />;\n    68→      case 'archetype':\n    69→        return <ArchetypeTab />;\n    70→      case 'plan':\n    71→        return <PlanTab />;\n    72→      case 'guides':\n    73→        return <GuidesTab />;\n    74→      case 'shop':\n    75→        return <ShopTab />;\n    76→      case 'community':\n    77→        return <CommunityTab />;\n    78→      case 'referrals':\n    79→        return <ReferralsTab />;\n    80→      case 'options':\n    81→        return <OptionsTab />;\n    82→      case 'support':\n    83→        return <SupportTab />;\n    84→      default:\n    85→        return <OverviewTab />;\n    86→    }\n    87→  };\n    88→\n    89→  return (\n    90→    <ResultsLayout>\n    91→      {renderTabContent()}\n    92→    </ResultsLayout>\n    93→  );\n    94→}\n    95→\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"f148805e-11ce-4b12-9c77-5770fc1eafcc","timestamp":"2025-12-27T12:32:01.010Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/Results.tsx","content":"'use client';\n\nimport { useEffect, useRef } from 'react';\nimport { useResults } from '@/contexts/ResultsContext';\nimport { useLeaderboardOptional } from '@/contexts/LeaderboardContext';\nimport { ResultsLayout } from './ResultsLayout';\nimport { OverviewTab } from './tabs/OverviewTab';\nimport { FrontRatiosTab, SideRatiosTab } from './tabs/RatiosTab';\nimport { PlanTab } from './tabs/PlanTab';\nimport { GuidesTab } from './tabs/GuidesTab';\nimport { ShopTab } from './tabs/ShopTab';\nimport { OptionsTab } from './tabs/OptionsTab';\nimport { SupportTab } from './tabs/SupportTab';\nimport { LeaderboardTab } from './tabs/LeaderboardTab';\nimport { CommunityTab } from './tabs/CommunityTab';\nimport { ReferralsTab } from './tabs/ReferralsTab';\nimport { PSLTab } from './tabs/PSLTab';\nimport { ArchetypeTab } from './tabs/ArchetypeTab';\nimport { api } from '@/lib/api';\n\nexport function Results() {\n  const { activeTab, overallScore, gender, ethnicity, frontPhoto, strengths, flaws } = useResults();\n  const leaderboard = useLeaderboardOptional();\n  const hasSubmittedRef = useRef(false);\n\n  // Auto-submit score to leaderboard on first render when score is available\n  useEffect(() => {\n    // Only submit once, when we have a valid score and haven't submitted yet\n    const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n    if (hasSubmittedRef.current || numericScore <= 0 || !leaderboard) return;\n\n    // Check if user is authenticated\n    const token = api.getToken();\n    if (!token) return;\n\n    // Mark as submitted to prevent duplicate submissions\n    hasSubmittedRef.current = true;\n\n    // Extract top 3 strengths and improvements\n    const topStrengths = strengths.slice(0, 3).map(s => s.strengthName);\n    const topImprovements = flaws.slice(0, 3).map(f => f.flawName);\n\n    // Submit to leaderboard\n    leaderboard.submitScore(numericScore, gender, {\n      ethnicity,\n      facePhotoUrl: frontPhoto,\n      topStrengths,\n      topImprovements,\n    }).catch(err => {\n      // Reset flag on error so user can retry\n      hasSubmittedRef.current = false;\n      console.error('[Leaderboard] Auto-submit failed:', err);\n    });\n  }, [overallScore, gender, ethnicity, frontPhoto, strengths, flaws, leaderboard]);\n\n  const renderTabContent = () => {\n    switch (activeTab) {\n      case 'overview':\n        return <OverviewTab />;\n      case 'front-ratios':\n        return <FrontRatiosTab />;\n      case 'side-ratios':\n        return <SideRatiosTab />;\n      case 'leaderboard':\n        return <LeaderboardTab />;\n      case 'psl':\n        return <PSLTab />;\n      case 'archetype':\n        return <ArchetypeTab />;\n      case 'plan':\n        return <PlanTab />;\n      case 'guides':\n        return <GuidesTab />;\n      case 'shop':\n        return <ShopTab />;\n      case 'community':\n        return <CommunityTab />;\n      case 'referrals':\n        return <ReferralsTab />;\n      case 'options':\n        return <OptionsTab />;\n      case 'support':\n        return <SupportTab />;\n      default:\n        return <OverviewTab />;\n    }\n  };\n\n  return (\n    <ResultsLayout>\n      {renderTabContent()}\n    </ResultsLayout>\n  );\n}\n","numLines":95,"startLine":1,"totalLines":95}}}
{"parentUuid":"f148805e-11ce-4b12-9c77-5770fc1eafcc","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01Pai4PeS3ieVQX9aqJmxMLC","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me check the ResultsLayout to see how tabs are rendered:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":1525,"cache_read_input_tokens":76648,"cache_creation":{"ephemeral_5m_input_tokens":1525,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWXCMdyLEkBs1m93GgnWf","type":"assistant","uuid":"6004c47e-f3bd-4836-9f41-782b1c272a51","timestamp":"2025-12-27T12:32:03.738Z"}
{"parentUuid":"6004c47e-f3bd-4836-9f41-782b1c272a51","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01Pai4PeS3ieVQX9aqJmxMLC","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01SdnUzny24X3CEm7viF3Ncj","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/ResultsLayout.tsx","limit":200}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":5,"cache_creation_input_tokens":1525,"cache_read_input_tokens":76648,"cache_creation":{"ephemeral_5m_input_tokens":1525,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWXCMdyLEkBs1m93GgnWf","type":"assistant","uuid":"739e6de2-9e3f-4b75-96f7-da3f60b4710c","timestamp":"2025-12-27T12:32:04.281Z"}
{"parentUuid":"739e6de2-9e3f-4b75-96f7-da3f60b4710c","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01SdnUzny24X3CEm7viF3Ncj","type":"tool_result","content":"     1→'use client';\n     2→\n     3→import { useState, useEffect, useCallback } from 'react';\n     4→import { motion, AnimatePresence } from 'framer-motion';\n     5→import Image from 'next/image';\n     6→import Link from 'next/link';\n     7→import {\n     8→  LayoutDashboard,\n     9→  User,\n    10→  ScanFace,\n    11→  Sparkles,\n    12→  Settings,\n    13→  HelpCircle,\n    14→  Menu,\n    15→  X,\n    16→  ChevronRight,\n    17→  Trophy,\n    18→  Users,\n    19→  Gauge,\n    20→  Shapes,\n    21→  BookOpen,\n    22→  Gift,\n    23→  Share2,\n    24→  Download,\n    25→  ShieldCheck,\n    26→  ShoppingBag,\n    27→  CheckCircle,\n    28→  Loader2,\n    29→} from 'lucide-react';\n    30→import { useResults } from '@/contexts/ResultsContext';\n    31→import { useLeaderboardOptional } from '@/contexts/LeaderboardContext';\n    32→import { ResultsTab } from '@/types/results';\n    33→import { ScoreCircle, RankBadge } from './shared';\n    34→import { api } from '@/lib/api';\n    35→import { exportToPDF } from '@/lib/exportReport';\n    36→import { AnalysisReport } from './reports/AnalysisReport';\n    37→import { useQuota } from '@/hooks/useQuota';\n    38→\n    39→// ============================================\n    40→// TAB NAVIGATION\n    41→// ============================================\n    42→\n    43→interface TabConfig {\n    44→  id: ResultsTab;\n    45→  label: string;\n    46→  icon: React.ReactNode;\n    47→}\n    48→\n    49→const TABS: TabConfig[] = [\n    50→  { id: 'overview', label: 'Overview', icon: <LayoutDashboard size={16} /> },\n    51→  { id: 'front-ratios', label: 'Front Ratios', icon: <User size={16} /> },\n    52→  { id: 'side-ratios', label: 'Side Ratios', icon: <ScanFace size={16} /> },\n    53→  { id: 'leaderboard', label: 'Leaderboard', icon: <Trophy size={16} /> },\n    54→  { id: 'psl', label: 'PSL Rating', icon: <Gauge size={16} /> },\n    55→  { id: 'archetype', label: 'Archetype', icon: <Shapes size={16} /> },\n    56→  { id: 'plan', label: 'Your Plan', icon: <Sparkles size={16} /> },\n    57→  { id: 'guides', label: 'Guides', icon: <BookOpen size={16} /> },\n    58→  { id: 'shop', label: 'Shop', icon: <ShoppingBag size={16} /> },\n    59→  { id: 'community', label: 'Community', icon: <Users size={16} /> },\n    60→  { id: 'referrals', label: 'Referrals', icon: <Gift size={16} /> },\n    61→  { id: 'options', label: 'Options', icon: <Settings size={16} /> },\n    62→  { id: 'support', label: 'Support', icon: <HelpCircle size={16} /> },\n    63→];\n    64→\n    65→// ============================================\n    66→// SIDEBAR\n    67→// ============================================\n    68→\n    69→interface SidebarProps {\n    70→  onClose?: () => void;\n    71→}\n    72→\n    73→function Sidebar({ onClose }: SidebarProps) {\n    74→  const { activeTab, setActiveTab, overallScore, frontPhoto, pslRating } = useResults();\n    75→\n    76→  return (\n    77→    <div className=\"flex flex-col h-full bg-black border-r border-white/5\">\n    78→      {/* Header */}\n    79→      <div className=\"flex items-center justify-between p-5 border-b border-white/5\">\n    80→        <Link href=\"/\" className=\"flex items-center gap-3\">\n    81→          <div className=\"w-8 h-8 rounded-xl bg-gradient-to-br from-cyan-400 to-blue-600 flex items-center justify-center shadow-lg shadow-cyan-500/20\">\n    82→            <ShieldCheck size={16} className=\"text-white\" />\n    83→          </div>\n    84→          <span className=\"text-xs font-black uppercase tracking-widest text-white\">LOOKSMAXX</span>\n    85→        </Link>\n    86→        {onClose && (\n    87→          <button\n    88→            onClick={onClose}\n    89→            className=\"p-2 hover:bg-white/5 rounded-xl transition-colors md:hidden\"\n    90→          >\n    91→            <X size={18} className=\"text-neutral-500\" />\n    92→          </button>\n    93→        )}\n    94→      </div>\n    95→\n    96→      {/* Profile Photo & Score */}\n    97→      <div className=\"p-5 border-b border-white/5\">\n    98→        <div className=\"relative aspect-square rounded-2xl overflow-hidden bg-neutral-900/50 border border-white/5 mb-5\">\n    99→          {frontPhoto ? (\n   100→            <Image\n   101→              src={frontPhoto}\n   102→              alt=\"Your face\"\n   103→              fill\n   104→              className=\"object-cover\"\n   105→              unoptimized\n   106→            />\n   107→          ) : (\n   108→            <div className=\"w-full h-full flex items-center justify-center\">\n   109→              <User size={48} className=\"text-neutral-800\" />\n   110→            </div>\n   111→          )}\n   112→          {/* Score badge */}\n   113→          <div className=\"absolute bottom-3 right-3\">\n   114→            <ScoreCircle score={overallScore} size=\"sm\" animate={false} />\n   115→          </div>\n   116→        </div>\n   117→\n   118→        <div className=\"grid grid-cols-2 gap-3 mb-4\">\n   119→          <div className=\"text-center p-3 rounded-xl bg-neutral-900/30 border border-white/5\">\n   120→            <p className=\"text-[9px] font-black uppercase tracking-widest text-neutral-600 mb-1\">Harmony</p>\n   121→            <p className=\"text-xl font-black italic text-white\">\n   122→              {typeof overallScore === 'number' ? overallScore.toFixed(1) : overallScore}\n   123→            </p>\n   124→          </div>\n   125→          <div className=\"text-center p-3 rounded-xl bg-neutral-900/30 border border-white/5\">\n   126→            <p className=\"text-[9px] font-black uppercase tracking-widest text-neutral-600 mb-1\">PSL</p>\n   127→            <p className=\"text-xl font-black italic text-cyan-400\">\n   128→              {pslRating?.psl ? Number(pslRating.psl).toFixed(1) : '-'}\n   129→            </p>\n   130→          </div>\n   131→        </div>\n   132→\n   133→        <div className=\"text-center\">\n   134→          <RankBadge size=\"md\" alwaysShow showPercentile />\n   135→        </div>\n   136→      </div>\n   137→\n   138→      {/* Navigation */}\n   139→      <nav className=\"flex-1 p-3 overflow-y-auto\">\n   140→        <div className=\"space-y-1\">\n   141→          {TABS.map((tab) => (\n   142→            <button\n   143→              key={tab.id}\n   144→              onClick={() => {\n   145→                setActiveTab(tab.id);\n   146→                onClose?.();\n   147→              }}\n   148→              className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${\n   149→                activeTab === tab.id\n   150→                  ? 'bg-cyan-500/10 text-cyan-400 border border-cyan-500/20'\n   151→                  : 'text-neutral-500 hover:bg-white/5 hover:text-white border border-transparent'\n   152→              }`}\n   153→            >\n   154→              {tab.icon}\n   155→              <span className=\"text-xs font-black uppercase tracking-widest\">{tab.label}</span>\n   156→              {activeTab === tab.id && (\n   157→                <ChevronRight size={14} className=\"ml-auto\" />\n   158→              )}\n   159→            </button>\n   160→          ))}\n   161→        </div>\n   162→      </nav>\n   163→\n   164→      {/* Footer */}\n   165→      <div className=\"p-4 border-t border-white/5\">\n   166→        <button\n   167→          onClick={() => window.location.href = '/gender'}\n   168→          className=\"w-full py-3 px-4 bg-cyan-500 text-black text-[10px] font-black uppercase tracking-widest rounded-xl hover:bg-cyan-400 transition-all shadow-lg shadow-cyan-500/20\"\n   169→        >\n   170→          New Analysis\n   171→        </button>\n   172→      </div>\n   173→    </div>\n   174→  );\n   175→}\n   176→\n   177→// ============================================\n   178→// FLOATING RANK CARD (Desktop)\n   179→// ============================================\n   180→\n   181→function FloatingRankCard() {\n   182→  const { setActiveTab } = useResults();\n   183→  const leaderboard = useLeaderboardOptional();\n   184→  const userRank = leaderboard?.userRank;\n   185→  const isAuthenticated = !!api.getToken();\n   186→\n   187→  // Auto-fetch user's rank on mount if authenticated\n   188→  useEffect(() => {\n   189→    if (isAuthenticated && !userRank && leaderboard?.fetchMyRank) {\n   190→      leaderboard.fetchMyRank();\n   191→    }\n   192→  }, [isAuthenticated, userRank, leaderboard]);\n   193→\n   194→  return (\n   195→    <motion.button\n   196→      initial={{ opacity: 0, y: -20 }}\n   197→      animate={{ opacity: 1, y: 0 }}\n   198→      onClick={() => setActiveTab('leaderboard')}\n   199→      className=\"flex items-center gap-4 px-5 py-4 bg-neutral-900/90 backdrop-blur-xl border border-white/5 rounded-2xl shadow-2xl hover:border-yellow-500/30 transition-all group\"\n   200→    >\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"ac585dec-63a5-4623-b7b2-7df5cb441bad","timestamp":"2025-12-27T12:32:04.371Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/ResultsLayout.tsx","content":"'use client';\n\nimport { useState, useEffect, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport Image from 'next/image';\nimport Link from 'next/link';\nimport {\n  LayoutDashboard,\n  User,\n  ScanFace,\n  Sparkles,\n  Settings,\n  HelpCircle,\n  Menu,\n  X,\n  ChevronRight,\n  Trophy,\n  Users,\n  Gauge,\n  Shapes,\n  BookOpen,\n  Gift,\n  Share2,\n  Download,\n  ShieldCheck,\n  ShoppingBag,\n  CheckCircle,\n  Loader2,\n} from 'lucide-react';\nimport { useResults } from '@/contexts/ResultsContext';\nimport { useLeaderboardOptional } from '@/contexts/LeaderboardContext';\nimport { ResultsTab } from '@/types/results';\nimport { ScoreCircle, RankBadge } from './shared';\nimport { api } from '@/lib/api';\nimport { exportToPDF } from '@/lib/exportReport';\nimport { AnalysisReport } from './reports/AnalysisReport';\nimport { useQuota } from '@/hooks/useQuota';\n\n// ============================================\n// TAB NAVIGATION\n// ============================================\n\ninterface TabConfig {\n  id: ResultsTab;\n  label: string;\n  icon: React.ReactNode;\n}\n\nconst TABS: TabConfig[] = [\n  { id: 'overview', label: 'Overview', icon: <LayoutDashboard size={16} /> },\n  { id: 'front-ratios', label: 'Front Ratios', icon: <User size={16} /> },\n  { id: 'side-ratios', label: 'Side Ratios', icon: <ScanFace size={16} /> },\n  { id: 'leaderboard', label: 'Leaderboard', icon: <Trophy size={16} /> },\n  { id: 'psl', label: 'PSL Rating', icon: <Gauge size={16} /> },\n  { id: 'archetype', label: 'Archetype', icon: <Shapes size={16} /> },\n  { id: 'plan', label: 'Your Plan', icon: <Sparkles size={16} /> },\n  { id: 'guides', label: 'Guides', icon: <BookOpen size={16} /> },\n  { id: 'shop', label: 'Shop', icon: <ShoppingBag size={16} /> },\n  { id: 'community', label: 'Community', icon: <Users size={16} /> },\n  { id: 'referrals', label: 'Referrals', icon: <Gift size={16} /> },\n  { id: 'options', label: 'Options', icon: <Settings size={16} /> },\n  { id: 'support', label: 'Support', icon: <HelpCircle size={16} /> },\n];\n\n// ============================================\n// SIDEBAR\n// ============================================\n\ninterface SidebarProps {\n  onClose?: () => void;\n}\n\nfunction Sidebar({ onClose }: SidebarProps) {\n  const { activeTab, setActiveTab, overallScore, frontPhoto, pslRating } = useResults();\n\n  return (\n    <div className=\"flex flex-col h-full bg-black border-r border-white/5\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between p-5 border-b border-white/5\">\n        <Link href=\"/\" className=\"flex items-center gap-3\">\n          <div className=\"w-8 h-8 rounded-xl bg-gradient-to-br from-cyan-400 to-blue-600 flex items-center justify-center shadow-lg shadow-cyan-500/20\">\n            <ShieldCheck size={16} className=\"text-white\" />\n          </div>\n          <span className=\"text-xs font-black uppercase tracking-widest text-white\">LOOKSMAXX</span>\n        </Link>\n        {onClose && (\n          <button\n            onClick={onClose}\n            className=\"p-2 hover:bg-white/5 rounded-xl transition-colors md:hidden\"\n          >\n            <X size={18} className=\"text-neutral-500\" />\n          </button>\n        )}\n      </div>\n\n      {/* Profile Photo & Score */}\n      <div className=\"p-5 border-b border-white/5\">\n        <div className=\"relative aspect-square rounded-2xl overflow-hidden bg-neutral-900/50 border border-white/5 mb-5\">\n          {frontPhoto ? (\n            <Image\n              src={frontPhoto}\n              alt=\"Your face\"\n              fill\n              className=\"object-cover\"\n              unoptimized\n            />\n          ) : (\n            <div className=\"w-full h-full flex items-center justify-center\">\n              <User size={48} className=\"text-neutral-800\" />\n            </div>\n          )}\n          {/* Score badge */}\n          <div className=\"absolute bottom-3 right-3\">\n            <ScoreCircle score={overallScore} size=\"sm\" animate={false} />\n          </div>\n        </div>\n\n        <div className=\"grid grid-cols-2 gap-3 mb-4\">\n          <div className=\"text-center p-3 rounded-xl bg-neutral-900/30 border border-white/5\">\n            <p className=\"text-[9px] font-black uppercase tracking-widest text-neutral-600 mb-1\">Harmony</p>\n            <p className=\"text-xl font-black italic text-white\">\n              {typeof overallScore === 'number' ? overallScore.toFixed(1) : overallScore}\n            </p>\n          </div>\n          <div className=\"text-center p-3 rounded-xl bg-neutral-900/30 border border-white/5\">\n            <p className=\"text-[9px] font-black uppercase tracking-widest text-neutral-600 mb-1\">PSL</p>\n            <p className=\"text-xl font-black italic text-cyan-400\">\n              {pslRating?.psl ? Number(pslRating.psl).toFixed(1) : '-'}\n            </p>\n          </div>\n        </div>\n\n        <div className=\"text-center\">\n          <RankBadge size=\"md\" alwaysShow showPercentile />\n        </div>\n      </div>\n\n      {/* Navigation */}\n      <nav className=\"flex-1 p-3 overflow-y-auto\">\n        <div className=\"space-y-1\">\n          {TABS.map((tab) => (\n            <button\n              key={tab.id}\n              onClick={() => {\n                setActiveTab(tab.id);\n                onClose?.();\n              }}\n              className={`w-full flex items-center gap-3 px-4 py-3 rounded-xl transition-all ${\n                activeTab === tab.id\n                  ? 'bg-cyan-500/10 text-cyan-400 border border-cyan-500/20'\n                  : 'text-neutral-500 hover:bg-white/5 hover:text-white border border-transparent'\n              }`}\n            >\n              {tab.icon}\n              <span className=\"text-xs font-black uppercase tracking-widest\">{tab.label}</span>\n              {activeTab === tab.id && (\n                <ChevronRight size={14} className=\"ml-auto\" />\n              )}\n            </button>\n          ))}\n        </div>\n      </nav>\n\n      {/* Footer */}\n      <div className=\"p-4 border-t border-white/5\">\n        <button\n          onClick={() => window.location.href = '/gender'}\n          className=\"w-full py-3 px-4 bg-cyan-500 text-black text-[10px] font-black uppercase tracking-widest rounded-xl hover:bg-cyan-400 transition-all shadow-lg shadow-cyan-500/20\"\n        >\n          New Analysis\n        </button>\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// FLOATING RANK CARD (Desktop)\n// ============================================\n\nfunction FloatingRankCard() {\n  const { setActiveTab } = useResults();\n  const leaderboard = useLeaderboardOptional();\n  const userRank = leaderboard?.userRank;\n  const isAuthenticated = !!api.getToken();\n\n  // Auto-fetch user's rank on mount if authenticated\n  useEffect(() => {\n    if (isAuthenticated && !userRank && leaderboard?.fetchMyRank) {\n      leaderboard.fetchMyRank();\n    }\n  }, [isAuthenticated, userRank, leaderboard]);\n\n  return (\n    <motion.button\n      initial={{ opacity: 0, y: -20 }}\n      animate={{ opacity: 1, y: 0 }}\n      onClick={() => setActiveTab('leaderboard')}\n      className=\"flex items-center gap-4 px-5 py-4 bg-neutral-900/90 backdrop-blur-xl border border-white/5 rounded-2xl shadow-2xl hover:border-yellow-500/30 transition-all group\"\n    >","numLines":200,"startLine":1,"totalLines":529}}}
{"parentUuid":"ac585dec-63a5-4623-b7b2-7df5cb441bad","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_013sAMTLRjRpGtk7MwgKSXeb","type":"message","role":"assistant","content":[{"type":"text","text":"Let me continue reading ResultsLayout to see the main content area:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":3262,"cache_read_input_tokens":78173,"cache_creation":{"ephemeral_5m_input_tokens":3262,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWXCMtNWfVVKKjGu37hGE","type":"assistant","uuid":"fae2572e-e543-401c-a109-3d99038cf46e","timestamp":"2025-12-27T12:32:06.735Z"}
{"parentUuid":"fae2572e-e543-401c-a109-3d99038cf46e","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_013sAMTLRjRpGtk7MwgKSXeb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01VQeyKnae8gyJ6fkf2F49Ty","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/ResultsLayout.tsx","offset":200,"limit":250}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4,"cache_creation_input_tokens":3262,"cache_read_input_tokens":78173,"cache_creation":{"ephemeral_5m_input_tokens":3262,"ephemeral_1h_input_tokens":0},"output_tokens":3,"service_tier":"standard"}},"requestId":"req_011CWXCMtNWfVVKKjGu37hGE","type":"assistant","uuid":"b5b5b476-1b36-48e0-89d8-84a377e58a45","timestamp":"2025-12-27T12:32:07.331Z"}
{"parentUuid":"b5b5b476-1b36-48e0-89d8-84a377e58a45","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01VQeyKnae8gyJ6fkf2F49Ty","type":"tool_result","content":"   200→    >\n   201→      {userRank ? (\n   202→        <>\n   203→          <div className=\"flex items-center justify-center w-11 h-11 rounded-xl bg-gradient-to-br from-yellow-500/20 to-amber-500/20 border border-yellow-500/30\">\n   204→            <Trophy size={20} className=\"text-yellow-400\" />\n   205→          </div>\n   206→          <div className=\"text-left\">\n   207→            <p className=\"text-[9px] font-black uppercase tracking-widest text-neutral-600\">Your Rank</p>\n   208→            <div className=\"flex items-baseline gap-2\">\n   209→              <span className=\"text-2xl font-black italic text-yellow-400\">#{userRank.genderRank}</span>\n   210→              <span className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600\">Top {userRank.percentile.toFixed(1)}%</span>\n   211→            </div>\n   212→          </div>\n   213→          <ChevronRight size={16} className=\"text-neutral-700 group-hover:text-yellow-400 transition-colors ml-1\" />\n   214→        </>\n   215→      ) : (\n   216→        <>\n   217→          <div className=\"flex items-center justify-center w-11 h-11 rounded-xl bg-neutral-900 border border-white/10\">\n   218→            <Trophy size={20} className=\"text-neutral-600\" />\n   219→          </div>\n   220→          <div className=\"text-left\">\n   221→            <p className=\"text-[9px] font-black uppercase tracking-widest text-neutral-600\">Your Rank</p>\n   222→            <span className=\"text-xs font-medium text-neutral-500\">\n   223→              {isAuthenticated ? 'Not ranked yet' : 'Sign in to rank'}\n   224→            </span>\n   225→          </div>\n   226→          <ChevronRight size={16} className=\"text-neutral-700 group-hover:text-neutral-500 transition-colors ml-1\" />\n   227→        </>\n   228→      )}\n   229→    </motion.button>\n   230→  );\n   231→}\n   232→\n   233→// ============================================\n   234→// MOBILE HEADER\n   235→// ============================================\n   236→\n   237→interface MobileHeaderProps {\n   238→  onMenuClick: () => void;\n   239→}\n   240→\n   241→function MobileHeader({ onMenuClick }: MobileHeaderProps) {\n   242→  const { activeTab, overallScore } = useResults();\n   243→  const currentTab = TABS.find((t) => t.id === activeTab);\n   244→\n   245→  return (\n   246→    <header className=\"flex items-center justify-between px-4 py-4 bg-black border-b border-white/5\">\n   247→      <button\n   248→        onClick={onMenuClick}\n   249→        className=\"p-2 hover:bg-white/5 rounded-xl transition-colors\"\n   250→      >\n   251→        <Menu size={18} className=\"text-neutral-500\" />\n   252→      </button>\n   253→      <div className=\"flex items-center gap-2\">\n   254→        {currentTab?.icon}\n   255→        <span className=\"text-xs font-black uppercase tracking-widest text-white\">{currentTab?.label}</span>\n   256→      </div>\n   257→      <div className=\"flex items-center gap-2\">\n   258→        <RankBadge size=\"sm\" alwaysShow />\n   259→        <div className=\"w-7 h-7 rounded-lg bg-cyan-500/20 flex items-center justify-center\">\n   260→          <span className=\"text-[10px] text-cyan-400 font-black\">{typeof overallScore === 'number' ? Math.round(overallScore) : overallScore}</span>\n   261→        </div>\n   262→      </div>\n   263→    </header>\n   264→  );\n   265→}\n   266→\n   267→// ============================================\n   268→// MAIN LAYOUT\n   269→// ============================================\n   270→\n   271→interface ResultsLayoutProps {\n   272→  children: React.ReactNode;\n   273→}\n   274→\n   275→export function ResultsLayout({ children }: ResultsLayoutProps) {\n   276→  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n   277→  const { activeTab } = useResults();\n   278→\n   279→  return (\n   280→    <div className=\"flex min-h-screen bg-black\">\n   281→      {/* Desktop Sidebar */}\n   282→      <aside className=\"hidden md:flex md:w-[280px] md:flex-col md:fixed md:inset-y-0 z-40\">\n   283→        <Sidebar />\n   284→      </aside>\n   285→\n   286→      {/* Mobile Menu Overlay */}\n   287→      <AnimatePresence>\n   288→        {mobileMenuOpen && (\n   289→          <>\n   290→            <motion.div\n   291→              initial={{ opacity: 0 }}\n   292→              animate={{ opacity: 1 }}\n   293→              exit={{ opacity: 0 }}\n   294→              onClick={() => setMobileMenuOpen(false)}\n   295→              className=\"fixed inset-0 bg-black/80 backdrop-blur-sm z-40 md:hidden\"\n   296→            />\n   297→            <motion.aside\n   298→              initial={{ x: -280 }}\n   299→              animate={{ x: 0 }}\n   300→              exit={{ x: -280 }}\n   301→              transition={{ type: 'spring', damping: 25, stiffness: 200 }}\n   302→              className=\"fixed inset-y-0 left-0 w-[280px] z-50 md:hidden\"\n   303→            >\n   304→              <Sidebar onClose={() => setMobileMenuOpen(false)} />\n   305→            </motion.aside>\n   306→          </>\n   307→        )}\n   308→      </AnimatePresence>\n   309→\n   310→      {/* Main Content */}\n   311→      <div className=\"flex-1 md:pl-[280px] flex flex-col min-h-screen\">\n   312→        {/* Mobile Header */}\n   313→        <div className=\"md:hidden\">\n   314→          <MobileHeader onMenuClick={() => setMobileMenuOpen(true)} />\n   315→        </div>\n   316→\n   317→        {/* Desktop Floating Rank Indicator */}\n   318→        <div className=\"hidden md:block fixed top-5 right-5 z-30\">\n   319→          <FloatingRankCard />\n   320→        </div>\n   321→\n   322→        {/* Content Area - no overflow so sticky works */}\n   323→        <main className=\"flex-1\">\n   324→          <AnimatePresence mode=\"wait\">\n   325→            <motion.div\n   326→              key={activeTab}\n   327→              initial={{ opacity: 0, y: 10 }}\n   328→              animate={{ opacity: 1, y: 0 }}\n   329→              exit={{ opacity: 0, y: -10 }}\n   330→              transition={{ duration: 0.2 }}\n   331→            >\n   332→              {children}\n   333→            </motion.div>\n   334→          </AnimatePresence>\n   335→        </main>\n   336→      </div>\n   337→    </div>\n   338→  );\n   339→}\n   340→\n   341→// ============================================\n   342→// TAB CONTENT WRAPPER\n   343→// ============================================\n   344→\n   345→interface TabContentProps {\n   346→  title: string | React.ReactNode;\n   347→  subtitle?: string;\n   348→  children: React.ReactNode;\n   349→  rightContent?: React.ReactNode;\n   350→  actions?: React.ReactNode;\n   351→}\n   352→\n   353→export function TabContent({ title, subtitle, children, rightContent, actions }: TabContentProps) {\n   354→  const { frontRatios, sideRatios, overallScore, pslRating } = useResults();\n   355→  const { plan } = useQuota();\n   356→  const [isExporting, setIsExporting] = useState(false);\n   357→  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null);\n   358→\n   359→  const showToast = useCallback((message: string, type: 'success' | 'error' = 'success') => {\n   360→    setToast({ message, type });\n   361→    setTimeout(() => setToast(null), 3000);\n   362→  }, []);\n   363→\n   364→  const handleExport = useCallback(async () => {\n   365→    setIsExporting(true);\n   366→    try {\n   367→      const result = await exportToPDF('pdf-report-container-layout', {\n   368→        filename: `LooksmaxxLabs_Report_${new Date().toISOString().split('T')[0]}`,\n   369→        scale: 2,\n   370→        pageFormat: 'a4',\n   371→        margins: 10\n   372→      });\n   373→\n   374→      if (result.success) {\n   375→        showToast('PDF exported successfully!');\n   376→      } else {\n   377→        showToast('Failed to generate PDF', 'error');\n   378→      }\n   379→    } catch {\n   380→      showToast('Export failed', 'error');\n   381→    } finally {\n   382→      setIsExporting(false);\n   383→    }\n   384→  }, [showToast]);\n   385→\n   386→  const handleShare = useCallback(async () => {\n   387→    // Share URL with results\n   388→    const url = window.location.href;\n   389→    if (navigator.share) {\n   390→      try {\n   391→        await navigator.share({ title: 'My Looksmaxx Results', url });\n   392→        showToast('Shared successfully!');\n   393→      } catch {\n   394→        // User cancelled or share failed\n   395→      }\n   396→    } else {\n   397→      navigator.clipboard.writeText(url);\n   398→      showToast('Link copied to clipboard!');\n   399→    }\n   400→  }, [showToast]);\n   401→\n   402→  // Handle both string titles (auto-highlight last word) and ReactNode titles (custom styling)\n   403→  const renderTitle = () => {\n   404→    if (typeof title === 'string') {\n   405→      const titleWords = title.split(' ');\n   406→      const lastWord = titleWords.pop();\n   407→      const firstWords = titleWords.join(' ');\n   408→      return <>{firstWords} <span className=\"text-cyan-400\">{lastWord}</span></>;\n   409→    }\n   410→    return title;\n   411→  };\n   412→\n   413→  return (\n   414→    <div className=\"p-6 md:p-10 lg:p-12 max-w-6xl mx-auto\">\n   415→      {/* Toast notification */}\n   416→      <AnimatePresence>\n   417→        {toast && (\n   418→          <motion.div\n   419→            initial={{ opacity: 0, y: -20 }}\n   420→            animate={{ opacity: 1, y: 0 }}\n   421→            exit={{ opacity: 0, y: -20 }}\n   422→            className={`fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg flex items-center gap-2 ${\n   423→              toast.type === 'success'\n   424→                ? 'bg-neutral-800 border border-neutral-700'\n   425→                : 'bg-red-900/80 border border-red-700'\n   426→            }`}\n   427→          >\n   428→            <CheckCircle size={16} className={toast.type === 'success' ? 'text-cyan-400' : 'text-red-400'} />\n   429→            <span className=\"text-sm text-white\">{toast.message}</span>\n   430→          </motion.div>\n   431→        )}\n   432→      </AnimatePresence>\n   433→\n   434→      {/* Header - pr-[180px] on desktop to prevent overlap with fixed FloatingRankCard */}\n   435→      <div className=\"flex flex-col md:flex-row md:items-start md:justify-between mb-10 md:mb-14 md:pr-[180px]\">\n   436→        <div>\n   437→          <h1 className=\"text-4xl md:text-5xl font-black tracking-tighter italic uppercase mb-3\">\n   438→            {renderTitle()}\n   439→          </h1>\n   440→          {subtitle && (\n   441→            <p className=\"text-neutral-500 font-medium uppercase text-xs tracking-[0.2em] max-w-lg\">\n   442→              {subtitle}\n   443→            </p>\n   444→          )}\n   445→        </div>\n   446→        {(rightContent || actions) && (\n   447→          <div className=\"mt-6 md:mt-0 flex items-center gap-3\">\n   448→            {actions && (\n   449→              <div className=\"flex items-center gap-2\">\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"a0461d2f-8a50-4e82-a2a8-5b01de2810e3","timestamp":"2025-12-27T12:32:07.387Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/ResultsLayout.tsx","content":"    >\n      {userRank ? (\n        <>\n          <div className=\"flex items-center justify-center w-11 h-11 rounded-xl bg-gradient-to-br from-yellow-500/20 to-amber-500/20 border border-yellow-500/30\">\n            <Trophy size={20} className=\"text-yellow-400\" />\n          </div>\n          <div className=\"text-left\">\n            <p className=\"text-[9px] font-black uppercase tracking-widest text-neutral-600\">Your Rank</p>\n            <div className=\"flex items-baseline gap-2\">\n              <span className=\"text-2xl font-black italic text-yellow-400\">#{userRank.genderRank}</span>\n              <span className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600\">Top {userRank.percentile.toFixed(1)}%</span>\n            </div>\n          </div>\n          <ChevronRight size={16} className=\"text-neutral-700 group-hover:text-yellow-400 transition-colors ml-1\" />\n        </>\n      ) : (\n        <>\n          <div className=\"flex items-center justify-center w-11 h-11 rounded-xl bg-neutral-900 border border-white/10\">\n            <Trophy size={20} className=\"text-neutral-600\" />\n          </div>\n          <div className=\"text-left\">\n            <p className=\"text-[9px] font-black uppercase tracking-widest text-neutral-600\">Your Rank</p>\n            <span className=\"text-xs font-medium text-neutral-500\">\n              {isAuthenticated ? 'Not ranked yet' : 'Sign in to rank'}\n            </span>\n          </div>\n          <ChevronRight size={16} className=\"text-neutral-700 group-hover:text-neutral-500 transition-colors ml-1\" />\n        </>\n      )}\n    </motion.button>\n  );\n}\n\n// ============================================\n// MOBILE HEADER\n// ============================================\n\ninterface MobileHeaderProps {\n  onMenuClick: () => void;\n}\n\nfunction MobileHeader({ onMenuClick }: MobileHeaderProps) {\n  const { activeTab, overallScore } = useResults();\n  const currentTab = TABS.find((t) => t.id === activeTab);\n\n  return (\n    <header className=\"flex items-center justify-between px-4 py-4 bg-black border-b border-white/5\">\n      <button\n        onClick={onMenuClick}\n        className=\"p-2 hover:bg-white/5 rounded-xl transition-colors\"\n      >\n        <Menu size={18} className=\"text-neutral-500\" />\n      </button>\n      <div className=\"flex items-center gap-2\">\n        {currentTab?.icon}\n        <span className=\"text-xs font-black uppercase tracking-widest text-white\">{currentTab?.label}</span>\n      </div>\n      <div className=\"flex items-center gap-2\">\n        <RankBadge size=\"sm\" alwaysShow />\n        <div className=\"w-7 h-7 rounded-lg bg-cyan-500/20 flex items-center justify-center\">\n          <span className=\"text-[10px] text-cyan-400 font-black\">{typeof overallScore === 'number' ? Math.round(overallScore) : overallScore}</span>\n        </div>\n      </div>\n    </header>\n  );\n}\n\n// ============================================\n// MAIN LAYOUT\n// ============================================\n\ninterface ResultsLayoutProps {\n  children: React.ReactNode;\n}\n\nexport function ResultsLayout({ children }: ResultsLayoutProps) {\n  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);\n  const { activeTab } = useResults();\n\n  return (\n    <div className=\"flex min-h-screen bg-black\">\n      {/* Desktop Sidebar */}\n      <aside className=\"hidden md:flex md:w-[280px] md:flex-col md:fixed md:inset-y-0 z-40\">\n        <Sidebar />\n      </aside>\n\n      {/* Mobile Menu Overlay */}\n      <AnimatePresence>\n        {mobileMenuOpen && (\n          <>\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              exit={{ opacity: 0 }}\n              onClick={() => setMobileMenuOpen(false)}\n              className=\"fixed inset-0 bg-black/80 backdrop-blur-sm z-40 md:hidden\"\n            />\n            <motion.aside\n              initial={{ x: -280 }}\n              animate={{ x: 0 }}\n              exit={{ x: -280 }}\n              transition={{ type: 'spring', damping: 25, stiffness: 200 }}\n              className=\"fixed inset-y-0 left-0 w-[280px] z-50 md:hidden\"\n            >\n              <Sidebar onClose={() => setMobileMenuOpen(false)} />\n            </motion.aside>\n          </>\n        )}\n      </AnimatePresence>\n\n      {/* Main Content */}\n      <div className=\"flex-1 md:pl-[280px] flex flex-col min-h-screen\">\n        {/* Mobile Header */}\n        <div className=\"md:hidden\">\n          <MobileHeader onMenuClick={() => setMobileMenuOpen(true)} />\n        </div>\n\n        {/* Desktop Floating Rank Indicator */}\n        <div className=\"hidden md:block fixed top-5 right-5 z-30\">\n          <FloatingRankCard />\n        </div>\n\n        {/* Content Area - no overflow so sticky works */}\n        <main className=\"flex-1\">\n          <AnimatePresence mode=\"wait\">\n            <motion.div\n              key={activeTab}\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              exit={{ opacity: 0, y: -10 }}\n              transition={{ duration: 0.2 }}\n            >\n              {children}\n            </motion.div>\n          </AnimatePresence>\n        </main>\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// TAB CONTENT WRAPPER\n// ============================================\n\ninterface TabContentProps {\n  title: string | React.ReactNode;\n  subtitle?: string;\n  children: React.ReactNode;\n  rightContent?: React.ReactNode;\n  actions?: React.ReactNode;\n}\n\nexport function TabContent({ title, subtitle, children, rightContent, actions }: TabContentProps) {\n  const { frontRatios, sideRatios, overallScore, pslRating } = useResults();\n  const { plan } = useQuota();\n  const [isExporting, setIsExporting] = useState(false);\n  const [toast, setToast] = useState<{ message: string; type: 'success' | 'error' } | null>(null);\n\n  const showToast = useCallback((message: string, type: 'success' | 'error' = 'success') => {\n    setToast({ message, type });\n    setTimeout(() => setToast(null), 3000);\n  }, []);\n\n  const handleExport = useCallback(async () => {\n    setIsExporting(true);\n    try {\n      const result = await exportToPDF('pdf-report-container-layout', {\n        filename: `LooksmaxxLabs_Report_${new Date().toISOString().split('T')[0]}`,\n        scale: 2,\n        pageFormat: 'a4',\n        margins: 10\n      });\n\n      if (result.success) {\n        showToast('PDF exported successfully!');\n      } else {\n        showToast('Failed to generate PDF', 'error');\n      }\n    } catch {\n      showToast('Export failed', 'error');\n    } finally {\n      setIsExporting(false);\n    }\n  }, [showToast]);\n\n  const handleShare = useCallback(async () => {\n    // Share URL with results\n    const url = window.location.href;\n    if (navigator.share) {\n      try {\n        await navigator.share({ title: 'My Looksmaxx Results', url });\n        showToast('Shared successfully!');\n      } catch {\n        // User cancelled or share failed\n      }\n    } else {\n      navigator.clipboard.writeText(url);\n      showToast('Link copied to clipboard!');\n    }\n  }, [showToast]);\n\n  // Handle both string titles (auto-highlight last word) and ReactNode titles (custom styling)\n  const renderTitle = () => {\n    if (typeof title === 'string') {\n      const titleWords = title.split(' ');\n      const lastWord = titleWords.pop();\n      const firstWords = titleWords.join(' ');\n      return <>{firstWords} <span className=\"text-cyan-400\">{lastWord}</span></>;\n    }\n    return title;\n  };\n\n  return (\n    <div className=\"p-6 md:p-10 lg:p-12 max-w-6xl mx-auto\">\n      {/* Toast notification */}\n      <AnimatePresence>\n        {toast && (\n          <motion.div\n            initial={{ opacity: 0, y: -20 }}\n            animate={{ opacity: 1, y: 0 }}\n            exit={{ opacity: 0, y: -20 }}\n            className={`fixed top-4 right-4 z-50 px-4 py-3 rounded-lg shadow-lg flex items-center gap-2 ${\n              toast.type === 'success'\n                ? 'bg-neutral-800 border border-neutral-700'\n                : 'bg-red-900/80 border border-red-700'\n            }`}\n          >\n            <CheckCircle size={16} className={toast.type === 'success' ? 'text-cyan-400' : 'text-red-400'} />\n            <span className=\"text-sm text-white\">{toast.message}</span>\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Header - pr-[180px] on desktop to prevent overlap with fixed FloatingRankCard */}\n      <div className=\"flex flex-col md:flex-row md:items-start md:justify-between mb-10 md:mb-14 md:pr-[180px]\">\n        <div>\n          <h1 className=\"text-4xl md:text-5xl font-black tracking-tighter italic uppercase mb-3\">\n            {renderTitle()}\n          </h1>\n          {subtitle && (\n            <p className=\"text-neutral-500 font-medium uppercase text-xs tracking-[0.2em] max-w-lg\">\n              {subtitle}\n            </p>\n          )}\n        </div>\n        {(rightContent || actions) && (\n          <div className=\"mt-6 md:mt-0 flex items-center gap-3\">\n            {actions && (\n              <div className=\"flex items-center gap-2\">","numLines":250,"startLine":200,"totalLines":529}}}
{"parentUuid":"a0461d2f-8a50-4e82-a2a8-5b01de2810e3","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_015RDsguasqFDtnVNoQiK8Sb","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect! Now let me review the guide data to understand the structure better:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":3769,"cache_read_input_tokens":81435,"cache_creation":{"ephemeral_5m_input_tokens":3769,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWXCN7SZpwxpKXz2sgFph","type":"assistant","uuid":"1cb0dd74-da38-4e01-82a1-21f99089ebdf","timestamp":"2025-12-27T12:32:09.192Z"}
{"parentUuid":"1cb0dd74-da38-4e01-82a1-21f99089ebdf","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_015RDsguasqFDtnVNoQiK8Sb","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01D2rreBM9fghu9g145K73NC","name":"Bash","input":{"command":"find /Users/imorgado/LOOKSMAXX/looksmaxx-app/src/data/guides -type f -name \"*.ts\" | head -5","description":"Find guide data files"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":3769,"cache_read_input_tokens":81435,"cache_creation":{"ephemeral_5m_input_tokens":3769,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWXCN7SZpwxpKXz2sgFph","type":"assistant","uuid":"796b6f0b-30b3-424e-a080-6a6ad8fd0d2b","timestamp":"2025-12-27T12:32:09.890Z"}
{"parentUuid":"796b6f0b-30b3-424e-a080-6a6ad8fd0d2b","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01D2rreBM9fghu9g145K73NC","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/data/guides/postpartum-recovery.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/data/guides/feminine-features.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/data/guides/beard-growth.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/data/guides/recovery-modalities.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/data/guides/ppl-split.ts","is_error":false}]},"uuid":"6c02ac16-f189-4e54-9b98-abcdaa3b09b3","timestamp":"2025-12-27T12:32:10.033Z","toolUseResult":{"stdout":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/data/guides/postpartum-recovery.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/data/guides/feminine-features.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/data/guides/beard-growth.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/data/guides/recovery-modalities.ts\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/data/guides/ppl-split.ts","stderr":"","interrupted":false,"isImage":false}}
{"parentUuid":"6c02ac16-f189-4e54-9b98-abcdaa3b09b3","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01F7EfGfVPDhz647wTRtz3As","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me create a comprehensive analysis document. Let me re-examine a couple of critical sections to finalize the report:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":440,"cache_read_input_tokens":85204,"cache_creation":{"ephemeral_5m_input_tokens":440,"ephemeral_1h_input_tokens":0},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CWXCNJycDT6eKoB1T7y94","type":"assistant","uuid":"c347c1e5-5863-43df-adc5-4375c8f69d3a","timestamp":"2025-12-27T12:32:11.662Z"}
{"parentUuid":"c347c1e5-5863-43df-adc5-4375c8f69d3a","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_01F7EfGfVPDhz647wTRtz3As","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01CexWBYybkAxw9SXswh3nYC","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/GuidesTab.tsx","offset":322,"limit":100}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":2,"cache_creation_input_tokens":440,"cache_read_input_tokens":85204,"cache_creation":{"ephemeral_5m_input_tokens":440,"ephemeral_1h_input_tokens":0},"output_tokens":7,"service_tier":"standard"}},"requestId":"req_011CWXCNJycDT6eKoB1T7y94","type":"assistant","uuid":"39493577-7571-4395-ae7b-1f78065a6ada","timestamp":"2025-12-27T12:32:12.127Z"}
{"parentUuid":"39493577-7571-4395-ae7b-1f78065a6ada","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01CexWBYybkAxw9SXswh3nYC","type":"tool_result","content":"   322→// GUIDE VIEWER MODAL\n   323→// ============================================\n   324→\n   325→interface GuideViewerProps {\n   326→  guide: Guide;\n   327→  onClose: () => void;\n   328→  onSwitchGuide: (guide: Guide) => void;\n   329→  allGuides: Guide[];\n   330→  gender: 'male' | 'female';\n   331→}\n   332→\n   333→function GuideViewer({ guide, onClose, onSwitchGuide, allGuides, gender }: GuideViewerProps) {\n   334→  const [currentSection, setCurrentSection] = useState(0);\n   335→  const [isSidebarOpen, setIsSidebarOpen] = useState(false);\n   336→  const [expandedCategories, setExpandedCategories] = useState<string[]>(() => {\n   337→    // Find the category of the current guide and expand it by default\n   338→    const currentCategory = GUIDE_CATEGORIES.find(c => c.guideIds.includes(guide.id));\n   339→    return currentCategory ? [currentCategory.id] : [];\n   340→  });\n   341→\n   342→  const section = guide.sections[currentSection];\n   343→\n   344→  if (!section) return null;\n   345→\n   346→  // Calculate reading progress (0% at start, 100% at last section)\n   347→  const progress = guide.sections.length > 1\n   348→    ? (currentSection / (guide.sections.length - 1)) * 100\n   349→    : 100;\n   350→\n   351→  const toggleCategory = (categoryId: string) => {\n   352→    setExpandedCategories(prev =>\n   353→      prev.includes(categoryId)\n   354→        ? prev.filter(id => id !== categoryId)\n   355→        : [...prev, categoryId]\n   356→    );\n   357→  };\n   358→\n   359→  // Filter categories by gender\n   360→  const filteredCategories = GUIDE_CATEGORIES.filter(cat => {\n   361→    if (cat.id === 'male' && gender === 'female') return false;\n   362→    if (cat.id === 'female' && gender === 'male') return false;\n   363→    return true;\n   364→  });\n   365→\n   366→  const colorClasses: Record<string, { text: string; bg: string; border: string }> = {\n   367→    blue: { text: 'text-cyan-400', bg: 'bg-cyan-500/10', border: 'border-cyan-500/20' },\n   368→    purple: { text: 'text-purple-400', bg: 'bg-purple-500/10', border: 'border-purple-500/20' },\n   369→    amber: { text: 'text-amber-400', bg: 'bg-amber-500/10', border: 'border-amber-500/20' },\n   370→    pink: { text: 'text-pink-400', bg: 'bg-pink-500/10', border: 'border-pink-500/20' },\n   371→    emerald: { text: 'text-emerald-400', bg: 'bg-emerald-500/10', border: 'border-emerald-500/20' },\n   372→    red: { text: 'text-red-400', bg: 'bg-red-500/10', border: 'border-red-500/20' },\n   373→  };\n   374→\n   375→  return (\n   376→    <motion.div\n   377→      initial={{ opacity: 0 }}\n   378→      animate={{ opacity: 1 }}\n   379→      exit={{ opacity: 0 }}\n   380→      className=\"fixed inset-0 z-50 bg-black\"\n   381→    >\n   382→      {/* Header */}\n   383→      <div className=\"sticky top-0 z-20 bg-black/95 backdrop-blur-md border-b border-neutral-900\">\n   384→        <div className=\"flex items-center justify-between px-4 lg:px-8 py-3\">\n   385→          <button\n   386→            onClick={onClose}\n   387→            className=\"flex items-center gap-2 text-neutral-500 hover:text-cyan-400 text-xs font-black uppercase tracking-widest transition-colors\"\n   388→          >\n   389→            <ArrowLeft size={14} />\n   390→            <span className=\"hidden sm:inline\">BACK TO GUIDES</span>\n   391→          </button>\n   392→\n   393→          {/* Progress bar */}\n   394→          <div className=\"hidden md:flex items-center gap-4 flex-1 max-w-md mx-8\">\n   395→            <div className=\"flex-1 h-1 bg-neutral-900 rounded-full overflow-hidden\">\n   396→              <motion.div\n   397→                className=\"h-full bg-gradient-to-r from-cyan-500 to-cyan-400\"\n   398→                initial={{ width: 0 }}\n   399→                animate={{ width: `${progress}%` }}\n   400→                transition={{ duration: 0.3 }}\n   401→              />\n   402→            </div>\n   403→            <span className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600 whitespace-nowrap\">\n   404→              {currentSection + 1} / {guide.sections.length}\n   405→            </span>\n   406→          </div>\n   407→\n   408→          <div className=\"flex items-center gap-3\">\n   409→            {/* Mobile menu button */}\n   410→            <button\n   411→              onClick={() => setIsSidebarOpen(!isSidebarOpen)}\n   412→              className=\"lg:hidden p-2 rounded-xl bg-neutral-900/50 border border-white/5 hover:border-white/10 transition-colors\"\n   413→            >\n   414→              <BookOpen size={18} className=\"text-neutral-400\" />\n   415→            </button>\n   416→            <button\n   417→              onClick={onClose}\n   418→              className=\"p-2 rounded-xl bg-neutral-900/50 border border-white/5 hover:border-white/10 transition-colors\"\n   419→            >\n   420→              <X size={18} className=\"text-neutral-400\" />\n   421→            </button>\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"0303ebce-e093-4c08-9c53-3b7563404a3d","timestamp":"2025-12-27T12:32:12.177Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/GuidesTab.tsx","content":"// GUIDE VIEWER MODAL\n// ============================================\n\ninterface GuideViewerProps {\n  guide: Guide;\n  onClose: () => void;\n  onSwitchGuide: (guide: Guide) => void;\n  allGuides: Guide[];\n  gender: 'male' | 'female';\n}\n\nfunction GuideViewer({ guide, onClose, onSwitchGuide, allGuides, gender }: GuideViewerProps) {\n  const [currentSection, setCurrentSection] = useState(0);\n  const [isSidebarOpen, setIsSidebarOpen] = useState(false);\n  const [expandedCategories, setExpandedCategories] = useState<string[]>(() => {\n    // Find the category of the current guide and expand it by default\n    const currentCategory = GUIDE_CATEGORIES.find(c => c.guideIds.includes(guide.id));\n    return currentCategory ? [currentCategory.id] : [];\n  });\n\n  const section = guide.sections[currentSection];\n\n  if (!section) return null;\n\n  // Calculate reading progress (0% at start, 100% at last section)\n  const progress = guide.sections.length > 1\n    ? (currentSection / (guide.sections.length - 1)) * 100\n    : 100;\n\n  const toggleCategory = (categoryId: string) => {\n    setExpandedCategories(prev =>\n      prev.includes(categoryId)\n        ? prev.filter(id => id !== categoryId)\n        : [...prev, categoryId]\n    );\n  };\n\n  // Filter categories by gender\n  const filteredCategories = GUIDE_CATEGORIES.filter(cat => {\n    if (cat.id === 'male' && gender === 'female') return false;\n    if (cat.id === 'female' && gender === 'male') return false;\n    return true;\n  });\n\n  const colorClasses: Record<string, { text: string; bg: string; border: string }> = {\n    blue: { text: 'text-cyan-400', bg: 'bg-cyan-500/10', border: 'border-cyan-500/20' },\n    purple: { text: 'text-purple-400', bg: 'bg-purple-500/10', border: 'border-purple-500/20' },\n    amber: { text: 'text-amber-400', bg: 'bg-amber-500/10', border: 'border-amber-500/20' },\n    pink: { text: 'text-pink-400', bg: 'bg-pink-500/10', border: 'border-pink-500/20' },\n    emerald: { text: 'text-emerald-400', bg: 'bg-emerald-500/10', border: 'border-emerald-500/20' },\n    red: { text: 'text-red-400', bg: 'bg-red-500/10', border: 'border-red-500/20' },\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      exit={{ opacity: 0 }}\n      className=\"fixed inset-0 z-50 bg-black\"\n    >\n      {/* Header */}\n      <div className=\"sticky top-0 z-20 bg-black/95 backdrop-blur-md border-b border-neutral-900\">\n        <div className=\"flex items-center justify-between px-4 lg:px-8 py-3\">\n          <button\n            onClick={onClose}\n            className=\"flex items-center gap-2 text-neutral-500 hover:text-cyan-400 text-xs font-black uppercase tracking-widest transition-colors\"\n          >\n            <ArrowLeft size={14} />\n            <span className=\"hidden sm:inline\">BACK TO GUIDES</span>\n          </button>\n\n          {/* Progress bar */}\n          <div className=\"hidden md:flex items-center gap-4 flex-1 max-w-md mx-8\">\n            <div className=\"flex-1 h-1 bg-neutral-900 rounded-full overflow-hidden\">\n              <motion.div\n                className=\"h-full bg-gradient-to-r from-cyan-500 to-cyan-400\"\n                initial={{ width: 0 }}\n                animate={{ width: `${progress}%` }}\n                transition={{ duration: 0.3 }}\n              />\n            </div>\n            <span className=\"text-[10px] font-black uppercase tracking-widest text-neutral-600 whitespace-nowrap\">\n              {currentSection + 1} / {guide.sections.length}\n            </span>\n          </div>\n\n          <div className=\"flex items-center gap-3\">\n            {/* Mobile menu button */}\n            <button\n              onClick={() => setIsSidebarOpen(!isSidebarOpen)}\n              className=\"lg:hidden p-2 rounded-xl bg-neutral-900/50 border border-white/5 hover:border-white/10 transition-colors\"\n            >\n              <BookOpen size={18} className=\"text-neutral-400\" />\n            </button>\n            <button\n              onClick={onClose}\n              className=\"p-2 rounded-xl bg-neutral-900/50 border border-white/5 hover:border-white/10 transition-colors\"\n            >\n              <X size={18} className=\"text-neutral-400\" />\n            </button>","numLines":100,"startLine":322,"totalLines":1194}}}
{"parentUuid":"0303ebce-e093-4c08-9c53-3b7563404a3d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"3681bc85-c4b7-4fe9-bf4f-804821805d3e","version":"2.0.76","gitBranch":"main","agentId":"aca300a","slug":"validated-scribbling-hedgehog","message":{"model":"claude-haiku-4-5-20251001","id":"msg_0176rrod6DciEReUtL5h2tGK","type":"message","role":"assistant","content":[{"type":"text","text":"Perfect! Now I have a comprehensive understanding. Let me create the detailed analysis report:\n\n## Guide Viewer Modal Architecture Analysis\n\nBased on my thorough exploration of the LOOKSMAXX codebase, here's a detailed breakdown of how the guide viewer/reader modal works:\n\n### 1. **Modal State Management**\n\nThe guide viewer modal uses **local component state** in `GuidesTab.tsx`:\n\n```tsx\n// Main tab state (lines 1109-1111)\nexport function GuidesTab() {\n  const [searchQuery, setSearchQuery] = useState('');\n  const [selectedGuide, setSelectedGuide] = useState<Guide | null>(null);\n  const { gender } = useResults();\n```\n\n- `selectedGuide`: Single source of truth for which guide is currently being viewed\n- When `null`, the modal is hidden\n- When a `Guide` object, the modal renders\n\n### 2. **How the Modal Opens and Closes**\n\n**Opening (lines 1125-1127):**\n```tsx\nconst handleOpenGuide = (guide: Guide) => {\n  setSelectedGuide(guide);\n};\n```\n\n**Closing (lines 1129-1131):**\n```tsx\nconst handleCloseGuide = () => {\n  setSelectedGuide(null);\n};\n```\n\n**Switching Guides (lines 1133-1135):**\n```tsx\nconst handleSwitchGuide = (guide: Guide) => {\n  setSelectedGuide(guide);\n};\n```\n\n### 3. **Modal Rendering Structure (lines 1180-1190)**\n\nThe modal is conditionally rendered using `AnimatePresence` from Framer Motion:\n\n```tsx\n<AnimatePresence>\n  {selectedGuide && (\n    <GuideViewer\n      guide={selectedGuide}\n      onClose={handleCloseGuide}\n      onSwitchGuide={handleSwitchGuide}\n      allGuides={genderFilteredGuides}\n      gender={gender}\n    />\n  )}\n</AnimatePresence>\n```\n\nThis ensures proper animation when the modal enters/exits.\n\n### 4. **GuideViewer Component Structure**\n\nThe `GuideViewer` component (lines 333-905) manages:\n\n**Internal State:**\n- `currentSection`: Tracks which section of the guide is being read (0-based index, line 334)\n- `isSidebarOpen`: Controls mobile sidebar visibility (line 335)\n- `expandedCategories`: Tracks which guide categories are expanded in the sidebar (lines 336-340)\n\n**Early Return Condition (lines 342-344):**\n```tsx\nconst section = guide.sections[currentSection];\n\nif (!section) return null;\n```\n\nThis could potentially close the modal if `currentSection` exceeds the number of sections, though this shouldn't happen in normal operation.\n\n### 5. **Modal Architecture (lines 375-903)**\n\nThe GuideViewer renders as a **full-screen modal** with three main areas:\n\n**A. Sticky Header (lines 382-423)**\n- Two close buttons: text button (line 385) and X icon button (line 416)\n- Both call `onClose()` from props\n- Reading progress bar showing current section\n- Mobile menu toggle button\n\n**B. Sidebar Navigation (lines 428-600)**\n- **Fixed/Relative positioning**: `fixed lg:relative` (line 431)\n- Lists all categories and guides\n- Categories can be expanded/collapsed\n- Clicking a guide calls `onSwitchGuide()` (lines 500-507)\n- Sidebar sections list (lines 546-584)\n\n**Key interaction (lines 500-507):**\n```tsx\nonClick={() => {\n  if (isCurrentGuide) {\n    setIsSidebarOpen(false);\n  } else {\n    onSwitchGuide(g);\n    setIsSidebarOpen(false);\n  }\n}}\n```\n\n**C. Main Content Area (lines 611-901)**\n- Displays current section's content\n- Section navigation buttons at bottom (lines 845-887)\n- Forum discussion link on last section (lines 891-899)\n\n### 6. **Critical State Management Issues - Potential Problems**\n\n**No issues detected with modal unexpected closure**, but here are things to watch:\n\n1. **Section Index Out of Bounds (line 342-344):**\n   ```tsx\n   const section = guide.sections[currentSection];\n   if (!section) return null;\n   ```\n   - If `currentSection` somehow exceeds guide sections, this returns `null`\n   - However, navigation buttons prevent this (lines 847, 867):\n     ```tsx\n     onClick={() => setCurrentSection(Math.max(0, currentSection - 1))}  // Prev\n     onClick={() => setCurrentSection(Math.min(guide.sections.length - 1, currentSection + 1))}  // Next\n     ```\n\n2. **Guide Data Dependency:**\n   - If `guide` object becomes null or undefined at any point, the entire component would render `null`\n   - However, this is prevented by the parent `AnimatePresence` check: `{selectedGuide && ...}`\n\n3. **Sidebar Mobile Overlay (lines 603-608):**\n   ```tsx\n   {isSidebarOpen && (\n     <div\n       className=\"fixed inset-0 bg-black/60 backdrop-blur-sm z-20 lg:hidden\"\n       onClick={() => setIsSidebarOpen(false)}\n     />\n   )}\n   ```\n   - Clicking the overlay closes the sidebar but NOT the modal itself\n\n### 7. **Gender Filtering**\n\nThe modal correctly filters guides by gender (lines 359-364):\n```tsx\nconst filteredCategories = GUIDE_CATEGORIES.filter(cat => {\n  if (cat.id === 'male' && gender === 'female') return false;\n  if (cat.id === 'female' && gender === 'male') return false;\n  return true;\n});\n```\n\nThis applies to the **sidebar guide list** but the currently viewing guide is unaffected.\n\n### 8. **Animation Behavior**\n\nThe GuideViewer uses Framer Motion for smooth transitions:\n\n**Modal Entry/Exit (lines 376-380):**\n```tsx\n<motion.div\n  initial={{ opacity: 0 }}\n  animate={{ opacity: 1 }}\n  exit={{ opacity: 0 }}\n  className=\"fixed inset-0 z-50 bg-black\"\n>\n```\n\n**Section Content Transitions (lines 639-645):**\n```tsx\n<AnimatePresence mode=\"wait\">\n  <motion.section\n    key={section.id}\n    initial={{ opacity: 0, x: 20 }}\n    animate={{ opacity: 1, x: 0 }}\n    exit={{ opacity: 0, x: -20 }}\n    transition={{ duration: 0.3 }}\n  >\n```\n\nThis ensures smooth transitions when switching sections or guides.\n\n### 9. **Data Flow from Results Context**\n\nThe component accesses gender from `ResultsContext`:\n```tsx\nconst { gender } = useResults();\n```\n\nThis is used for gender-specific guide filtering in the sidebar.\n\n### 10. **Key Files Summary**\n\n| File | Purpose | Lines |\n|------|---------|-------|\n| `GuidesTab.tsx` | Main tab, modal state, modal rendering | 1108-1193 |\n| `GuideViewer` (in GuidesTab.tsx) | Modal component, section navigation, sidebar | 333-905 |\n| `MediaRenderer` (in GuidesTab.tsx) | Renders guide images/GIFs | 79-165 |\n| `ProductCallout` (in GuidesTab.tsx) | Affiliate product links | 175-237 |\n| `ForumDiscussionLink` (in GuidesTab.tsx) | Forum category link | 248-278 |\n| `Results.tsx` | Routes to GuidesTab based on activeTab | 72-73 |\n| `ResultsLayout.tsx` | Handles tab switching, not modal | - |\n| `ResultsContext.tsx` | Provides gender and other shared state | - |\n\n### 11. **State Reset Mechanisms**\n\nThe modal state is **NOT automatically reset** by:\n- Tab switching (handled by Results.tsx routing)\n- Window navigation\n- Re-rendering\n\nTo reset the modal state when leaving the Guides tab, would require a cleanup effect or explicit handling in the parent component (Results.tsx).\n\n### **Conclusion**\n\nThe guide viewer modal is **well-architected** with:\n- Clear state management (single `selectedGuide` state)\n- Proper animation handling (AnimatePresence + Framer Motion)\n- Safe section navigation (bounds checking)\n- Gender-aware filtering\n- Multiple close mechanisms (back button, X button, sidebar overlay)\n\nThere are **no obvious bugs causing unexpected modal closure**, but the modal state persists even when switching tabs, which could be intentional or worth reviewing depending on UX requirements."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":1,"cache_creation_input_tokens":1911,"cache_read_input_tokens":85644,"cache_creation":{"ephemeral_5m_input_tokens":1911,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWXCNTmCNT34fW6kqGcAF","type":"assistant","uuid":"b822481d-9c77-4fc3-9ac0-1c9d89a9a324","timestamp":"2025-12-27T12:32:31.056Z"}
