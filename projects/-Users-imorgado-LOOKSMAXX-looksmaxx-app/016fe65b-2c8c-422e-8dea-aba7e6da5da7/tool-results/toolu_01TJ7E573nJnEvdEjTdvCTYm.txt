     1→/**
     2→ * FFMI (Fat-Free Mass Index) Calculator
     3→ *
     4→ * FFMI is a measure of lean body mass relative to height, commonly used
     5→ * to assess muscularity independent of body fat.
     6→ *
     7→ * Formula:
     8→ * - Lean Mass = weight × (1 - bodyFat/100)
     9→ * - FFMI = leanMass / height²  (height in meters)
    10→ * - Normalized FFMI = FFMI + 6.1 × (1.8 - height)
    11→ */
    12→
    13→export interface FFMIResult {
    14→  ffmi: number;           // Raw FFMI value
    15→  normalizedFFMI: number; // Adjusted for height
    16→  leanMassKg: number;     // Weight × (1 - bodyFat/100)
    17→  rating: number;         // 0-10 scale
    18→  category: FFMICategory;
    19→}
    20→
    21→export type FFMICategory =
    22→  | 'Below Average'
    23→  | 'Average'
    24→  | 'Above Average'
    25→  | 'Excellent'
    26→  | 'Elite';
    27→
    28→export type Gender = 'male' | 'female';
    29→
    30→/**
    31→ * FFMI thresholds for males
    32→ * Based on natural bodybuilding research
    33→ */
    34→const MALE_THRESHOLDS = {
    35→  belowAverage: 18,   // < 18: Below Average
    36→  average: 20,        // 18-20: Average
    37→  aboveAverage: 22,   // 20-22: Above Average
    38→  excellent: 25,      // 22-25: Excellent
    39→  elite: 25,          // 25+: Elite (near natural limit ~25-26)
    40→} as const;
    41→
    42→/**
    43→ * FFMI thresholds for females (~2-3 points lower)
    44→ * Women naturally carry less muscle mass
    45→ */
    46→const FEMALE_THRESHOLDS = {
    47→  belowAverage: 15,   // < 15: Below Average
    48→  average: 17,        // 15-17: Average
    49→  aboveAverage: 19,   // 17-19: Above Average
    50→  excellent: 22,      // 19-22: Excellent
    51→  elite: 22,          // 22+: Elite (near natural limit)
    52→} as const;
    53→
    54→/**
    55→ * Calculate FFMI and return detailed results
    56→ *
    57→ * @param heightCm - Height in centimeters
    58→ * @param weightKg - Weight in kilograms
    59→ * @param bodyFatPercent - Body fat percentage (0-100)
    60→ * @param gender - 'male' or 'female' for appropriate thresholds
    61→ * @returns FFMIResult with FFMI, normalized FFMI, lean mass, rating, and category
    62→ */
    63→export function calculateFFMI(
    64→  heightCm: number,
    65→  weightKg: number,
    66→  bodyFatPercent: number,
    67→  gender: Gender = 'male'
    68→): FFMIResult {
    69→  // Input validation
    70→  if (heightCm <= 0 || weightKg <= 0) {
    71→    throw new Error('Height and weight must be positive values');
    72→  }
    73→
    74→  // Clamp body fat to reasonable range (0-100)
    75→  const clampedBodyFat = Math.max(0, Math.min(100, bodyFatPercent));
    76→
    77→  // Convert height to meters
    78→  const heightM = heightCm / 100;
    79→
    80→  // Calculate lean mass
    81→  const leanMassKg = weightKg * (1 - clampedBodyFat / 100);
    82→
    83→  // Calculate raw FFMI
    84→  const ffmi = leanMassKg / (heightM * heightM);
    85→
    86→  // Calculate normalized FFMI (adjusts for height variance)
    87→  // This formula corrects for the fact that taller people have naturally lower FFMI
    88→  const normalizedFFMI = ffmi + 6.1 * (1.8 - heightM);
    89→
    90→  // Get rating and category based on gender
    91→  const { rating, category } = getRatingAndCategory(normalizedFFMI, gender);
    92→
    93→  return {
    94→    ffmi: roundTo2(ffmi),
    95→    normalizedFFMI: roundTo2(normalizedFFMI),
    96→    leanMassKg: roundTo2(leanMassKg),
    97→    rating,
    98→    category,
    99→  };
   100→}
   101→
   102→/**
   103→ * Get rating (0-10) and category based on normalized FFMI and gender
   104→ */
   105→function getRatingAndCategory(
   106→  normalizedFFMI: number,
   107→  gender: Gender
   108→): { rating: number; category: FFMICategory } {
   109→  const thresholds = gender === 'male' ? MALE_THRESHOLDS : FEMALE_THRESHOLDS;
   110→
   111→  let category: FFMICategory;
   112→  let rating: number;
   113→
   114→  if (normalizedFFMI < thresholds.belowAverage) {
   115→    // Below Average: 0-3 rating
   116→    category = 'Below Average';
   117→    // Linear interpolation from 0 (FFMI=10) to 3 (FFMI=threshold)
   118→    const minFFMI = gender === 'male' ? 10 : 8;
   119→    rating = interpolate(normalizedFFMI, minFFMI, thresholds.belowAverage, 0, 3);
   120→  } else if (normalizedFFMI < thresholds.average) {
   121→    // Average: 4-5 rating
   122→    category = 'Average';
   123→    rating = interpolate(
   124→      normalizedFFMI,
   125→      thresholds.belowAverage,
   126→      thresholds.average,
   127→      4,
   128→      5
   129→    );
   130→  } else if (normalizedFFMI < thresholds.aboveAverage) {
   131→    // Above Average: 6-7 rating
   132→    category = 'Above Average';
   133→    rating = interpolate(
   134→      normalizedFFMI,
   135→      thresholds.average,
   136→      thresholds.aboveAverage,
   137→      6,
   138→      7
   139→    );
   140→  } else if (normalizedFFMI < thresholds.excellent) {
   141→    // Excellent: 8-9 rating
   142→    category = 'Excellent';
   143→    rating = interpolate(
   144→      normalizedFFMI,
   145→      thresholds.aboveAverage,
   146→      thresholds.excellent,
   147→      8,
   148→      9
   149→    );
   150→  } else {
   151→    // Elite: 10 rating
   152→    category = 'Elite';
   153→    rating = 10;
   154→  }
   155→
   156→  // Clamp rating to 0-10
   157→  return {
   158→    rating: Math.max(0, Math.min(10, roundTo1(rating))),
   159→    category,
   160→  };
   161→}
   162→
   163→/**
   164→ * Linear interpolation between two ranges
   165→ */
   166→function interpolate(
   167→  value: number,
   168→  inMin: number,
   169→  inMax: number,
   170→  outMin: number,
   171→  outMax: number
   172→): number {
   173→  const ratio = (value - inMin) / (inMax - inMin);
   174→  return outMin + ratio * (outMax - outMin);
   175→}
   176→
   177→/**
   178→ * Round to 2 decimal places
   179→ */
   180→function roundTo2(num: number): number {
   181→  return Math.round(num * 100) / 100;
   182→}
   183→
   184→/**
   185→ * Round to 1 decimal place
   186→ */
   187→function roundTo1(num: number): number {
   188→  return Math.round(num * 10) / 10;
   189→}
   190→
   191→/**
   192→ * Get descriptive text for an FFMI category
   193→ */
   194→export function getFFMICategoryDescription(category: FFMICategory, gender: Gender): string {
   195→  const descriptions: Record<FFMICategory, { male: string; female: string }> = {
   196→    'Below Average': {
   197→      male: 'Lower than average muscle mass. Consider strength training and adequate protein intake.',
   198→      female: 'Lower than average muscle mass. Consider resistance training and adequate nutrition.',
   199→    },
   200→    'Average': {
   201→      male: 'Average muscle development for a man. Room for improvement with consistent training.',
   202→      female: 'Average muscle development for a woman. Room for growth with progressive overload.',
   203→    },
   204→    'Above Average': {
   205→      male: 'Above average muscularity. Good progress with training.',
   206→      female: 'Above average muscularity. Excellent progress for natural training.',
   207→    },
   208→    'Excellent': {
   209→      male: 'Excellent muscle development. Approaching upper limits for natural athletes.',
   210→      female: 'Exceptional muscle development. Near the top for natural female athletes.',
   211→    },
   212→    'Elite': {
   213→      male: 'Elite level muscularity. At or near the natural limit (~25-26 FFMI for men).',
   214→      female: 'Elite level muscularity. At or near the natural limit for women.',
   215→    },
   216→  };
   217→
   218→  return descriptions[category][gender];
   219→}
   220→
   221→/**
   222→ * Get color associated with FFMI category for UI
   223→ */
   224→export function getFFMICategoryColor(category: FFMICategory): string {
   225→  const colors: Record<FFMICategory, string> = {
   226→    'Below Average': '#EF4444', // red-500
   227→    'Average': '#F59E0B',       // amber-500
   228→    'Above Average': '#3B82F6', // blue-500
   229→    'Excellent': '#10B981',     // emerald-500
   230→    'Elite': '#8B5CF6',         // violet-500
   231→  };
   232→
   233→  return colors[category];
   234→}
   235→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
