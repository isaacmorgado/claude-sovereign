     1→'use client';
     2→
     3→import React, { createContext, useContext, useState, useEffect, useCallback, ReactNode } from 'react';
     4→
     5→export interface PhysiqueImage {
     6→  file: File;
     7→  preview: string;
     8→}
     9→
    10→export type PhysiqueAngle = 'front' | 'side' | 'back';
    11→
    12→export interface PhysiqueAnalysisResult {
    13→  bodyFatPercent: number;
    14→  muscleMass: string;  // low|medium|medium-high|high|very-high
    15→  frameSize: string;   // small|medium|large|very-large
    16→  shoulderWidth: string;  // narrow|average|broad|very-broad
    17→  waistDefinition: string;  // undefined|slight|defined|very-defined
    18→  posture: string;  // poor|fair|good|excellent
    19→  confidence: number;
    20→  notes?: string;
    21→}
    22→
    23→interface PhysiqueContextType {
    24→  frontPhoto: PhysiqueImage | null;
    25→  sidePhoto: PhysiqueImage | null;
    26→  backPhoto: PhysiqueImage | null;
    27→  setFrontPhoto: (image: PhysiqueImage | null) => void;
    28→  setSidePhoto: (image: PhysiqueImage | null) => void;
    29→  setBackPhoto: (image: PhysiqueImage | null) => void;
    30→  skipped: boolean;
    31→  setSkipped: (skipped: boolean) => void;
    32→  clearAll: () => void;
    33→  hasAnyPhotos: boolean;
    34→  // Analysis results
    35→  physiqueAnalysis: PhysiqueAnalysisResult | null;
    36→  setPhysiqueAnalysis: (result: PhysiqueAnalysisResult | null) => void;
    37→  isAnalyzing: boolean;
    38→  setIsAnalyzing: (analyzing: boolean) => void;
    39→}
    40→
    41→const PhysiqueContext = createContext<PhysiqueContextType | undefined>(undefined);
    42→
    43→const STORAGE_KEY = 'looksmaxx_physique_analysis';
    44→
    45→export function PhysiqueProvider({ children }: { children: ReactNode }) {
    46→  const [frontPhoto, setFrontPhoto] = useState<PhysiqueImage | null>(null);
    47→  const [sidePhoto, setSidePhoto] = useState<PhysiqueImage | null>(null);
    48→  const [backPhoto, setBackPhoto] = useState<PhysiqueImage | null>(null);
    49→  const [skipped, setSkipped] = useState<boolean>(false);
    50→  const [physiqueAnalysis, setPhysiqueAnalysisState] = useState<PhysiqueAnalysisResult | null>(null);
    51→  const [isAnalyzing, setIsAnalyzing] = useState<boolean>(false);
    52→  const [isHydrated, setIsHydrated] = useState(false);
    53→
    54→  // Load analysis from localStorage on mount (photos are not persisted - they're blobs)
    55→  useEffect(() => {
    56→    if (typeof window !== 'undefined') {
    57→      try {
    58→        const stored = localStorage.getItem(STORAGE_KEY);
    59→        if (stored) {
    60→          const parsed = JSON.parse(stored);
    61→          if (parsed.physiqueAnalysis) {
    62→            setPhysiqueAnalysisState(parsed.physiqueAnalysis);
    63→          }
    64→          if (typeof parsed.skipped === 'boolean') {
    65→            setSkipped(parsed.skipped);
    66→          }
    67→        }
    68→      } catch (e) {
    69→        console.error('Failed to load physique analysis from storage:', e);
    70→      }
    71→      setIsHydrated(true);
    72→    }
    73→  }, []);
    74→
    75→  // Persist analysis to localStorage when it changes
    76→  useEffect(() => {
    77→    if (isHydrated && typeof window !== 'undefined') {
    78→      const data = { physiqueAnalysis, skipped };
    79→      localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
    80→    }
    81→  }, [physiqueAnalysis, skipped, isHydrated]);
    82→
    83→  // Wrapped setter to update state
    84→  const setPhysiqueAnalysis = useCallback((result: PhysiqueAnalysisResult | null) => {
    85→    setPhysiqueAnalysisState(result);
    86→  }, []);
    87→
    88→  const clearAll = useCallback(() => {
    89→    if (frontPhoto?.preview) URL.revokeObjectURL(frontPhoto.preview);
    90→    if (sidePhoto?.preview) URL.revokeObjectURL(sidePhoto.preview);
    91→    if (backPhoto?.preview) URL.revokeObjectURL(backPhoto.preview);
    92→    setFrontPhoto(null);
    93→    setSidePhoto(null);
    94→    setBackPhoto(null);
    95→    setSkipped(false);
    96→    setPhysiqueAnalysisState(null);
    97→    setIsAnalyzing(false);
    98→    // Clear from localStorage
    99→    if (typeof window !== 'undefined') {
   100→      localStorage.removeItem(STORAGE_KEY);
   101→    }
   102→  }, [frontPhoto, sidePhoto, backPhoto]);
   103→
   104→  const hasAnyPhotos = !!(frontPhoto || sidePhoto || backPhoto);
   105→
   106→  return (
   107→    <PhysiqueContext.Provider
   108→      value={{
   109→        frontPhoto,
   110→        sidePhoto,
   111→        backPhoto,
   112→        setFrontPhoto,
   113→        setSidePhoto,
   114→        setBackPhoto,
   115→        skipped,
   116→        setSkipped,
   117→        clearAll,
   118→        hasAnyPhotos,
   119→        physiqueAnalysis,
   120→        setPhysiqueAnalysis,
   121→        isAnalyzing,
   122→        setIsAnalyzing,
   123→      }}
   124→    >
   125→      {children}
   126→    </PhysiqueContext.Provider>
   127→  );
   128→}
   129→
   130→export function usePhysique() {
   131→  const context = useContext(PhysiqueContext);
   132→  if (context === undefined) {
   133→    throw new Error('usePhysique must be used within a PhysiqueProvider');
   134→  }
   135→  return context;
   136→}
   137→
   138→// Optional hook for components that might not be in the provider
   139→export function usePhysiqueOptional() {
   140→  return useContext(PhysiqueContext);
   141→}
   142→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
