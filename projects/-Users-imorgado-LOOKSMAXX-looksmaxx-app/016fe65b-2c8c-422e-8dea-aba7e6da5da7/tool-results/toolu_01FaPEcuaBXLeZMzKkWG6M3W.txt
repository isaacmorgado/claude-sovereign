     1→/**
     2→ * Daily Stack Generator
     3→ * Generates universal supplement stack shown to ALL users
     4→ */
     5→
     6→import { DailyStack } from '@/types/results';
     7→import { getBaseStackProducts, getProductById } from './product_db';
     8→import { SUPPLEMENTS } from './recommendations/supplements';
     9→
    10→export function generateDailyStack(
    11→  gender: 'male' | 'female',
    12→  age?: number
    13→): DailyStack {
    14→  // Get base 6 products that everyone needs
    15→  let stackProducts = getBaseStackProducts();
    16→
    17→  // Add gender-specific boosters
    18→  if (gender === 'male') {
    19→    const ashwagandha = getProductById('ashwagandha_now');
    20→    if (ashwagandha) {
    21→      stackProducts = [...stackProducts, ashwagandha];
    22→    }
    23→  }
    24→
    25→  // Add age-specific boosters (30+)
    26→  if (age && age >= 30) {
    27→    const nmn = getProductById('nmn_prohealth');
    28→    if (nmn) {
    29→      stackProducts = [...stackProducts, nmn];
    30→    }
    31→  }
    32→
    33→  // Calculate total cost
    34→  const totalCostMin = stackProducts.reduce((sum, product) => {
    35→    const supplement = SUPPLEMENTS.find(s => s.id === product.supplementId);
    36→    return sum + (supplement?.costPerMonth.min || 0);
    37→  }, 0);
    38→
    39→  const totalCostMax = stackProducts.reduce((sum, product) => {
    40→    const supplement = SUPPLEMENTS.find(s => s.id === product.supplementId);
    41→    return sum + (supplement?.costPerMonth.max || 0);
    42→  }, 0);
    43→
    44→  // Organize by timing
    45→  const morningIds = ['vitamin_c_now', 'd3_k2_sports_research', 'creatine_optimum', 'ashwagandha_now', 'nmn_prohealth'];
    46→  const eveningIds = ['magnesium_doctors_best', 'omega3_nordic'];
    47→
    48→  const timing = {
    49→    morning: stackProducts.filter(p => morningIds.includes(p.id)),
    50→    evening: stackProducts.filter(p => eveningIds.includes(p.id)),
    51→    anytime: stackProducts.filter(p =>
    52→      !morningIds.includes(p.id) && !eveningIds.includes(p.id)
    53→    ),
    54→  };
    55→
    56→  // Rationale message
    57→  const rationale = gender === 'male'
    58→    ? "This foundation stack supports skin elasticity, bone structure, hormonal balance, and inflammation control - the pillars of facial aesthetics and long-term appearance preservation."
    59→    : "This foundation stack supports collagen production, bone density, skin health, and hormonal balance - essential for maintaining facial aesthetics and preventing age-related changes.";
    60→
    61→  return {
    62→    products: stackProducts,
    63→    totalCostPerMonth: {
    64→      min: Math.round(totalCostMin),
    65→      max: Math.round(totalCostMax),
    66→    },
    67→    timing,
    68→    rationale,
    69→  };
    70→}
    71→
    72→// Helper to get supplement details for a product
    73→export function getSupplementDetails(supplementId: string) {
    74→  return SUPPLEMENTS.find(s => s.id === supplementId);
    75→}
    76→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
