{"parentUuid":null,"isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","type":"user","message":{"role":"user","content":"Research task - DO NOT write any code, only report findings.\n\n1. Use WebFetch to analyze https://nicelydone.club/n/pages - page design patterns and components\n\n2. Read our results/dashboard pages:\n   - src/components/results/tabs/PSLTab.tsx\n   - src/components/results/tabs/ArchetypeTab.tsx\n   - src/components/results/tabs/LeaderboardTab.tsx\n   - src/components/results/tabs/GuidesTab.tsx\n   - src/components/results/cards/ (all card components)\n\n3. Report specific UX improvements for our dashboard and data visualization:\n   - Card design patterns\n   - Data presentation\n   - Tab navigation\n   - Leaderboard/ranking UI\n   - Stats and metrics display\n   - Achievement/badge systems\n   - Gamification elements"},"uuid":"a675f784-eec9-4b33-bf75-f36d0c986f1f","timestamp":"2025-12-26T13:41:28.903Z"}
{"parentUuid":"a675f784-eec9-4b33-bf75-f36d0c986f1f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","message":{"model":"claude-opus-4-5-20251101","id":"msg_014FZpc8oC5FrxrTCGdVy769","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01JH7a4izdnXmujW7GdaMibR","name":"WebFetch","input":{"url":"https://nicelydone.club/n/pages","prompt":"Analyze the page design patterns and components shown. Focus on:\n1. Card design patterns - layouts, shadows, borders, spacing\n2. Data visualization techniques\n3. Dashboard layouts and tab navigation\n4. Leaderboard and ranking UI patterns\n5. Stats, metrics, and KPI display patterns\n6. Achievement/badge systems\n7. Gamification elements\n8. Progress indicators and status displays\n9. List and grid layouts\n10. Interactive elements and hover states\n\nProvide specific, actionable design patterns with examples."}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":24051,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":24051,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWVPqxYqVpwhajApEhLnY","type":"assistant","uuid":"1647ce44-8b9b-430e-a4b1-f85ed2249e80","timestamp":"2025-12-26T13:41:36.199Z"}
{"parentUuid":"1647ce44-8b9b-430e-a4b1-f85ed2249e80","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","message":{"model":"claude-opus-4-5-20251101","id":"msg_014FZpc8oC5FrxrTCGdVy769","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_011zNCgfvucsg9vb4ayP92fp","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/PSLTab.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":24051,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":24051,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWVPqxYqVpwhajApEhLnY","type":"assistant","uuid":"8199d7b1-3527-4546-aa04-2da44774b311","timestamp":"2025-12-26T13:41:37.307Z"}
{"parentUuid":"8199d7b1-3527-4546-aa04-2da44774b311","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","message":{"model":"claude-opus-4-5-20251101","id":"msg_014FZpc8oC5FrxrTCGdVy769","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01At5n5Vqgqmsyu84MVbn1ww","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/ArchetypeTab.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":24051,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":24051,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWVPqxYqVpwhajApEhLnY","type":"assistant","uuid":"78d95b1f-a11a-45a7-9617-56b5909ad3bb","timestamp":"2025-12-26T13:41:38.036Z"}
{"parentUuid":"78d95b1f-a11a-45a7-9617-56b5909ad3bb","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_014FZpc8oC5FrxrTCGdVy769","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015dycnwS9JnXL1SPdQBV2FG","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/LeaderboardTab.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":24051,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":24051,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWVPqxYqVpwhajApEhLnY","type":"assistant","uuid":"6884ebf0-1067-4292-8673-9cecf62b2687","timestamp":"2025-12-26T13:41:38.770Z"}
{"parentUuid":"6884ebf0-1067-4292-8673-9cecf62b2687","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_014FZpc8oC5FrxrTCGdVy769","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PWKmpobdk2BrrjfLMhQ4kh","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/GuidesTab.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":24051,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":24051,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWVPqxYqVpwhajApEhLnY","type":"assistant","uuid":"e203ba26-6e8f-4ff2-b284-8946d7375207","timestamp":"2025-12-26T13:41:39.567Z"}
{"parentUuid":"e203ba26-6e8f-4ff2-b284-8946d7375207","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_014FZpc8oC5FrxrTCGdVy769","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01WxC4Pn8GEcUfgrH43PMGC3","name":"Glob","input":{"pattern":"src/components/results/cards/*.tsx","path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":3,"cache_creation_input_tokens":24051,"cache_read_input_tokens":0,"cache_creation":{"ephemeral_5m_input_tokens":24051,"ephemeral_1h_input_tokens":0},"output_tokens":5,"service_tier":"standard"}},"requestId":"req_011CWVPqxYqVpwhajApEhLnY","type":"assistant","uuid":"f009603b-cab3-4334-9938-527ee5231829","timestamp":"2025-12-26T13:41:40.481Z"}
{"parentUuid":"f009603b-cab3-4334-9938-527ee5231829","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01At5n5Vqgqmsyu84MVbn1ww","type":"tool_result","content":"     1â†’'use client';\n     2â†’\n     3â†’import { useMemo, useEffect, useState } from 'react';\n     4â†’import { motion } from 'framer-motion';\n     5â†’import Link from 'next/link';\n     6â†’import {\n     7â†’  Info,\n     8â†’  Target,\n     9â†’  Palette,\n    10â†’  TrendingUp,\n    11â†’  Users,\n    12â†’  ArrowRight,\n    13â†’  BookOpen,\n    14â†’  Clock,\n    15â†’  Brain,\n    16â†’  Wrench,\n    17â†’  TrendingDown,\n    18â†’  Dumbbell,\n    19â†’  Calendar,\n    20â†’  Heart,\n    21â†’  Utensils,\n    22â†’  Droplet,\n    23â†’} from 'lucide-react';\n    24â†’import { useResults } from '@/contexts/ResultsContext';\n    25â†’import { Guide } from '@/types/guides';\n    26â†’import { getGuideById } from '@/data/guides';\n    27â†’import { TabContent } from '../ResultsLayout';\n    28â†’import { ArchetypeCard } from '@/components/psl/archetype/ArchetypeCard';\n    29â†’import {\n    30â†’  ARCHETYPE_COLORS,\n    31â†’  ConfidenceBar,\n    32â†’} from '@/components/psl/archetype/ArchetypeTraits';\n    33â†’import {\n    34â†’  classifyFromRatios,\n    35â†’  ArchetypeClassification,\n    36â†’  ArchetypeCategory,\n    37â†’} from '@/lib/archetype-classifier';\n    38â†’import { api, ArchetypeForumRecommendation } from '@/lib/api';\n    39â†’\n    40â†’// ============================================\n    41â†’// ALL SCORES BREAKDOWN\n    42â†’// ============================================\n    43â†’\n    44â†’function AllArchetypeScores({\n    45â†’  classification,\n    46â†’}: {\n    47â†’  classification: ArchetypeClassification;\n    48â†’}) {\n    49â†’  const sortedScores = [...classification.allScores].sort((a, b) => b.score - a.score);\n    50â†’\n    51â†’  return (\n    52â†’    <motion.div\n    53â†’      initial={{ opacity: 0 }}\n    54â†’      animate={{ opacity: 1 }}\n    55â†’      transition={{ delay: 0.2 }}\n    56â†’      className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n    57â†’    >\n    58â†’      <div className=\"flex items-center gap-2 mb-4\">\n    59â†’        <Target className=\"w-5 h-5 text-cyan-400\" />\n    60â†’        <h3 className=\"font-semibold text-white\">All Category Scores</h3>\n    61â†’      </div>\n    62â†’\n    63â†’      <p className=\"text-sm text-neutral-400 mb-4\">\n    64â†’        Your match percentage across all archetype categories\n    65â†’      </p>\n    66â†’\n    67â†’      <div className=\"space-y-4\">\n    68â†’        {sortedScores.map((score, index) => {\n    69â†’          const colors = ARCHETYPE_COLORS[score.category as ArchetypeCategory];\n    70â†’          const isPrimary = index === 0;\n    71â†’\n    72â†’          return (\n    73â†’            <div key={score.category} className=\"space-y-2\">\n    74â†’              <div className=\"flex items-center justify-between\">\n    75â†’                <div className=\"flex items-center gap-2\">\n    76â†’                  {isPrimary && (\n    77â†’                    <span className=\"text-xs px-2 py-0.5 rounded bg-cyan-500/20 text-cyan-400 border border-cyan-500/30\">\n    78â†’                      Primary\n    79â†’                    </span>\n    80â†’                  )}\n    81â†’                  <span className={`font-medium ${isPrimary ? 'text-white' : 'text-neutral-400'}`}>\n    82â†’                    {score.category}\n    83â†’                  </span>\n    84â†’                </div>\n    85â†’                <span\n    86â†’                  className=\"text-sm font-medium\"\n    87â†’                  style={{ color: colors?.primary || '#6b7280' }}\n    88â†’                >\n    89â†’                  {score.score}%\n    90â†’                </span>\n    91â†’              </div>\n    92â†’              <ConfidenceBar\n    93â†’                confidence={score.confidence}\n    94â†’                color={colors?.primary}\n    95â†’              />\n    96â†’            </div>\n    97â†’          );\n    98â†’        })}\n    99â†’      </div>\n   100â†’    </motion.div>\n   101â†’  );\n   102â†’}\n   103â†’\n   104â†’// ============================================\n   105â†’// STYLE RECOMMENDATIONS\n   106â†’// ============================================\n   107â†’\n   108â†’function StyleRecommendations({\n   109â†’  classification,\n   110â†’}: {\n   111â†’  classification: ArchetypeClassification;\n   112â†’}) {\n   113â†’  const { styleGuide, primary } = classification;\n   114â†’  const colors = ARCHETYPE_COLORS[primary.category];\n   115â†’\n   116â†’  return (\n   117â†’    <motion.div\n   118â†’      initial={{ opacity: 0 }}\n   119â†’      animate={{ opacity: 1 }}\n   120â†’      transition={{ delay: 0.3 }}\n   121â†’      className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n   122â†’    >\n   123â†’      <div className=\"flex items-center gap-2 mb-4\">\n   124â†’        <Palette className=\"w-5 h-5 text-purple-400\" />\n   125â†’        <h3 className=\"font-semibold text-white\">{primary.subArchetype} Style Guide</h3>\n   126â†’      </div>\n   127â†’\n   128â†’      <p className=\"text-sm text-neutral-400 mb-6\">\n   129â†’        Recommended style elements based on your archetype classification\n   130â†’      </p>\n   131â†’\n   132â†’      <div className=\"grid md:grid-cols-3 gap-6\">\n   133â†’        {/* Clothing */}\n   134â†’        <div>\n   135â†’          <h4\n   136â†’            className=\"text-sm font-medium mb-3 flex items-center gap-2\"\n   137â†’            style={{ color: colors.primary }}\n   138â†’          >\n   139â†’            <span className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: colors.primary }} />\n   140â†’            Clothing\n   141â†’          </h4>\n   142â†’          <ul className=\"space-y-2\">\n   143â†’            {styleGuide.clothing.map((item) => (\n   144â†’              <li key={item} className=\"text-sm text-neutral-300 flex items-start gap-2\">\n   145â†’                <span className=\"text-neutral-600 mt-1\">-</span>\n   146â†’                {item}\n   147â†’              </li>\n   148â†’            ))}\n   149â†’          </ul>\n   150â†’        </div>\n   151â†’\n   152â†’        {/* Hair */}\n   153â†’        <div>\n   154â†’          <h4\n   155â†’            className=\"text-sm font-medium mb-3 flex items-center gap-2\"\n   156â†’            style={{ color: colors.primary }}\n   157â†’          >\n   158â†’            <span className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: colors.primary }} />\n   159â†’            Hair\n   160â†’          </h4>\n   161â†’          <ul className=\"space-y-2\">\n   162â†’            {styleGuide.hair.map((item) => (\n   163â†’              <li key={item} className=\"text-sm text-neutral-300 flex items-start gap-2\">\n   164â†’                <span className=\"text-neutral-600 mt-1\">-</span>\n   165â†’                {item}\n   166â†’              </li>\n   167â†’            ))}\n   168â†’          </ul>\n   169â†’        </div>\n   170â†’\n   171â†’        {/* Colors */}\n   172â†’        <div>\n   173â†’          <h4\n   174â†’            className=\"text-sm font-medium mb-3 flex items-center gap-2\"\n   175â†’            style={{ color: colors.primary }}\n   176â†’          >\n   177â†’            <span className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: colors.primary }} />\n   178â†’            Color Palette\n   179â†’          </h4>\n   180â†’          <div className=\"flex flex-wrap gap-2\">\n   181â†’            {styleGuide.colors.map((color) => (\n   182â†’              <span\n   183â†’                key={color}\n   184â†’                className=\"px-3 py-1 rounded-full bg-neutral-800 text-neutral-300 text-sm border border-neutral-700\"\n   185â†’              >\n   186â†’                {color}\n   187â†’              </span>\n   188â†’            ))}\n   189â†’          </div>\n   190â†’        </div>\n   191â†’      </div>\n   192â†’    </motion.div>\n   193â†’  );\n   194â†’}\n   195â†’\n   196â†’// ============================================\n   197â†’// TRANSITION OPPORTUNITIES\n   198â†’// ============================================\n   199â†’\n   200â†’function TransitionOpportunities({\n   201â†’  classification,\n   202â†’}: {\n   203â†’  classification: ArchetypeClassification;\n   204â†’}) {\n   205â†’  const { transitionPath, primary, allScores } = classification;\n   206â†’\n   207â†’  if (!transitionPath) return null;\n   208â†’\n   209â†’  // Find the target score\n   210â†’  const targetScore = allScores.find((s) => s.category === transitionPath.target);\n   211â†’  const primaryColors = ARCHETYPE_COLORS[primary.category];\n   212â†’  const targetColors = ARCHETYPE_COLORS[transitionPath.target as ArchetypeCategory];\n   213â†’\n   214â†’  return (\n   215â†’    <motion.div\n   216â†’      initial={{ opacity: 0 }}\n   217â†’      animate={{ opacity: 1 }}\n   218â†’      transition={{ delay: 0.4 }}\n   219â†’      className=\"bg-gradient-to-r from-cyan-500/10 to-purple-500/10 rounded-xl p-6 border border-cyan-500/20\"\n   220â†’    >\n   221â†’      <div className=\"flex items-center gap-2 mb-4\">\n   222â†’        <TrendingUp className=\"w-5 h-5 text-green-400\" />\n   223â†’        <h3 className=\"font-semibold text-white\">Archetype Transition Potential</h3>\n   224â†’      </div>\n   225â†’\n   226â†’      <div className=\"grid md:grid-cols-2 gap-6\">\n   227â†’        {/* Current */}\n   228â†’        <div className=\"bg-neutral-900/50 rounded-lg p-4\">\n   229â†’          <p className=\"text-xs text-neutral-500 mb-2\">Current Archetype</p>\n   230â†’          <p\n   231â†’            className=\"text-xl font-bold mb-1\"\n   232â†’            style={{ color: primaryColors.primary }}\n   233â†’          >\n   234â†’            {primary.subArchetype}\n   235â†’          </p>\n   236â†’          <p className=\"text-sm text-neutral-400\">{primary.category}</p>\n   237â†’          <div className=\"mt-3\">\n   238â†’            <ConfidenceBar\n   239â†’              confidence={primary.confidence}\n   240â†’              label=\"Match\"\n   241â†’              color={primaryColors.primary}\n   242â†’            />\n   243â†’          </div>\n   244â†’        </div>\n   245â†’\n   246â†’        {/* Target */}\n   247â†’        <div className=\"bg-neutral-900/50 rounded-lg p-4\">\n   248â†’          <p className=\"text-xs text-neutral-500 mb-2\">Transition Target</p>\n   249â†’          <p\n   250â†’            className=\"text-xl font-bold mb-1\"\n   251â†’            style={{ color: targetColors?.primary || '#67e8f9' }}\n   252â†’          >\n   253â†’            {transitionPath.target}\n   254â†’          </p>\n   255â†’          <p className=\"text-sm text-neutral-400\">\n   256â†’            {targetScore ? `${targetScore.score}% current match` : 'New category'}\n   257â†’          </p>\n   258â†’          {targetScore && (\n   259â†’            <div className=\"mt-3\">\n   260â†’              <ConfidenceBar\n   261â†’                confidence={targetScore.confidence}\n   262â†’                label=\"Current Match\"\n   263â†’                color={targetColors?.primary}\n   264â†’              />\n   265â†’            </div>\n   266â†’          )}\n   267â†’        </div>\n   268â†’      </div>\n   269â†’\n   270â†’      {/* Requirements */}\n   271â†’      <div className=\"mt-6\">\n   272â†’        <p className=\"text-sm text-neutral-400 mb-3\">To achieve this transition:</p>\n   273â†’        <ul className=\"grid md:grid-cols-2 gap-2\">\n   274â†’          {transitionPath.requirements.map((req, i) => (\n   275â†’            <li\n   276â†’              key={i}\n   277â†’              className=\"flex items-center gap-2 p-3 bg-neutral-900/50 rounded-lg text-sm text-neutral-300\"\n   278â†’            >\n   279â†’              <span className=\"w-5 h-5 rounded-full bg-cyan-500/20 text-cyan-400 flex items-center justify-center text-xs\">\n   280â†’                {i + 1}\n   281â†’              </span>\n   282â†’              {req}\n   283â†’            </li>\n   284â†’          ))}\n   285â†’        </ul>\n   286â†’      </div>\n   287â†’    </motion.div>\n   288â†’  );\n   289â†’}\n   290â†’\n   291â†’// ============================================\n   292â†’// RECOMMENDED FORUMS SECTION\n   293â†’// ============================================\n   294â†’\n   295â†’function RecommendedForumsSection({\n   296â†’  classification,\n   297â†’}: {\n   298â†’  classification: ArchetypeClassification;\n   299â†’}) {\n   300â†’  const [forums, setForums] = useState<ArchetypeForumRecommendation[]>([]);\n   301â†’  const [isLoading, setIsLoading] = useState(true);\n   302â†’\n   303â†’  const archetype = classification.primary.category;\n   304â†’  const colors = ARCHETYPE_COLORS[archetype];\n   305â†’\n   306â†’  useEffect(() => {\n   307â†’    let isMounted = true;\n   308â†’\n   309â†’    async function fetchForums() {\n   310â†’      setIsLoading(true);\n   311â†’      try {\n   312â†’        const recommendations = await api.getArchetypeForumRecommendations(archetype);\n   313â†’        if (isMounted) {\n   314â†’          setForums(recommendations.slice(0, 3)); // Show top 3\n   315â†’        }\n   316â†’      } catch (error) {\n   317â†’        if (isMounted) {\n   318â†’          console.error('[ArchetypeTab] Failed to fetch forum recommendations:', error);\n   319â†’        }\n   320â†’      } finally {\n   321â†’        if (isMounted) {\n   322â†’          setIsLoading(false);\n   323â†’        }\n   324â†’      }\n   325â†’    }\n   326â†’\n   327â†’    fetchForums();\n   328â†’\n   329â†’    return () => {\n   330â†’      isMounted = false;\n   331â†’    };\n   332â†’  }, [archetype]);\n   333â†’\n   334â†’  if (isLoading) {\n   335â†’    return (\n   336â†’      <motion.div\n   337â†’        initial={{ opacity: 0 }}\n   338â†’        animate={{ opacity: 1 }}\n   339â†’        transition={{ delay: 0.35 }}\n   340â†’        className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n   341â†’      >\n   342â†’        <div className=\"flex items-center gap-2 mb-4\">\n   343â†’          <Users className=\"w-5 h-5 text-amber-400\" />\n   344â†’          <h3 className=\"font-semibold text-white\">Recommended Forums</h3>\n   345â†’        </div>\n   346â†’        <div className=\"grid gap-3 md:grid-cols-3\">\n   347â†’          {[1, 2, 3].map((i) => (\n   348â†’            <div key={i} className=\"animate-pulse bg-neutral-800 rounded-lg h-24\" />\n   349â†’          ))}\n   350â†’        </div>\n   351â†’      </motion.div>\n   352â†’    );\n   353â†’  }\n   354â†’\n   355â†’  if (forums.length === 0) return null;\n   356â†’\n   357â†’  return (\n   358â†’    <motion.div\n   359â†’      initial={{ opacity: 0 }}\n   360â†’      animate={{ opacity: 1 }}\n   361â†’      transition={{ delay: 0.35 }}\n   362â†’      className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n   363â†’    >\n   364â†’      <div className=\"flex items-center gap-2 mb-4\">\n   365â†’        <Users className=\"w-5 h-5 text-amber-400\" />\n   366â†’        <h3 className=\"font-semibold text-white\">Recommended Forums</h3>\n   367â†’        <span\n   368â†’          className=\"px-2 py-0.5 text-xs font-medium rounded border\"\n   369â†’          style={{\n   370â†’            backgroundColor: `${colors.primary}20`,\n   371â†’            color: colors.primary,\n   372â†’            borderColor: `${colors.primary}40`,\n   373â†’          }}\n   374â†’        >\n   375â†’          {archetype}\n   376â†’        </span>\n   377â†’      </div>\n   378â†’\n   379â†’      <p className=\"text-sm text-neutral-400 mb-4\">\n   380â†’        Forums tailored to your archetype to help you maximize your aesthetic potential\n   381â†’      </p>\n   382â†’\n   383â†’      <div className=\"grid gap-3 md:grid-cols-3\">\n   384â†’        {forums.map((forum) => (\n   385â†’          <Link key={forum.category.id} href={`/forum/${forum.category.slug}`}>\n   386â†’            <div className=\"group bg-neutral-800/50 hover:bg-neutral-800 rounded-lg p-4 border border-neutral-700 hover:border-amber-500/30 transition-all cursor-pointer\">\n   387â†’              <div className=\"flex items-center gap-3 mb-2\">\n   388â†’                <div className=\"w-10 h-10 rounded-lg bg-gradient-to-br from-amber-500/20 to-orange-500/20 flex items-center justify-center text-xl flex-shrink-0\">\n   389â†’                  {forum.category.icon || 'ðŸ’¬'}\n   390â†’                </div>\n   391â†’                <h4 className=\"font-medium text-white group-hover:text-amber-400 transition-colors text-sm line-clamp-1\">\n   392â†’                  {forum.category.name}\n   393â†’                </h4>\n   394â†’              </div>\n   395â†’              <p className=\"text-xs text-neutral-400 line-clamp-2 mb-2\">\n   396â†’                {forum.reason || forum.category.description}\n   397â†’              </p>\n   398â†’              <div className=\"flex items-center justify-end\">\n   399â†’                <span className=\"text-xs text-amber-400 opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1\">\n   400â†’                  Visit\n   401â†’                  <ArrowRight className=\"w-3 h-3\" />\n   402â†’                </span>\n   403â†’              </div>\n   404â†’            </div>\n   405â†’          </Link>\n   406â†’        ))}\n   407â†’      </div>\n   408â†’\n   409â†’      <Link href=\"/forum\" className=\"block mt-4\">\n   410â†’        <div className=\"flex items-center justify-center gap-2 py-2 text-sm text-neutral-400 hover:text-white transition-colors\">\n   411â†’          <span>Explore all forums</span>\n   412â†’          <ArrowRight className=\"w-4 h-4\" />\n   413â†’        </div>\n   414â†’      </Link>\n   415â†’    </motion.div>\n   416â†’  );\n   417â†’}\n   418â†’\n   419â†’// ============================================\n   420â†’// RECOMMENDED GUIDES SECTION\n   421â†’// ============================================\n   422â†’\n   423â†’// Icon mapping for guides\n   424â†’const GUIDE_ICON_MAP: Record<string, React.ReactNode> = {\n   425â†’  BookOpen: <BookOpen size={18} />,\n   426â†’  Dumbbell: <Dumbbell size={18} />,\n   427â†’  Brain: <Brain size={18} />,\n   428â†’  Wrench: <Wrench size={18} />,\n   429â†’  TrendingDown: <TrendingDown size={18} />,\n   430â†’  Calendar: <Calendar size={18} />,\n   431â†’  Target: <Target size={18} />,\n   432â†’  Heart: <Heart size={18} />,\n   433â†’  Utensils: <Utensils size={18} />,\n   434â†’  Droplet: <Droplet size={18} />,\n   435â†’};\n   436â†’\n   437â†’// Map archetypes to recommended guides\n   438â†’const ARCHETYPE_GUIDES: Record<string, string[]> = {\n   439â†’  Softboy: ['skincare', 'mindset', 'diet', 'maintenance'],\n   440â†’  Prettyboy: ['skincare', 'maintenance', 'diet', 'body-fat'],\n   441â†’  RobustPrettyboy: ['v-taper', 'training', 'skincare', 'diet'],\n   442â†’  Chad: ['v-taper', 'training', 'core-neck', 'body-fat'],\n   443â†’  Hypermasculine: ['v-taper', 'training', 'core-neck', 'cardio'],\n   444â†’  Exotic: ['skincare', 'mindset', 'maintenance', 'diet'],\n   445â†’};\n   446â†’\n   447â†’function RecommendedGuidesSection({\n   448â†’  classification,\n   449â†’  onOpenGuide,\n   450â†’}: {\n   451â†’  classification: ArchetypeClassification;\n   452â†’  onOpenGuide: (guide: Guide) => void;\n   453â†’}) {\n   454â†’  const archetype = classification.primary.category;\n   455â†’  const colors = ARCHETYPE_COLORS[archetype];\n   456â†’  const guideIds = ARCHETYPE_GUIDES[archetype] || ARCHETYPE_GUIDES.Softboy;\n   457â†’\n   458â†’  const guides = guideIds\n   459â†’    .map((id) => getGuideById(id))\n   460â†’    .filter((g): g is Guide => g !== undefined)\n   461â†’    .slice(0, 3);\n   462â†’\n   463â†’  if (guides.length === 0) return null;\n   464â†’\n   465â†’  return (\n   466â†’    <motion.div\n   467â†’      initial={{ opacity: 0 }}\n   468â†’      animate={{ opacity: 1 }}\n   469â†’      transition={{ delay: 0.35 }}\n   470â†’      className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n   471â†’    >\n   472â†’      <div className=\"flex items-center gap-2 mb-4\">\n   473â†’        <BookOpen className=\"w-5 h-5 text-cyan-400\" />\n   474â†’        <h3 className=\"font-semibold text-white\">Recommended Guides</h3>\n   475â†’        <span\n   476â†’          className=\"px-2 py-0.5 text-xs font-medium rounded border\"\n   477â†’          style={{\n   478â†’            backgroundColor: `${colors.primary}20`,\n   479â†’            color: colors.primary,\n   480â†’            borderColor: `${colors.primary}40`,\n   481â†’          }}\n   482â†’        >\n   483â†’          {archetype}\n   484â†’        </span>\n   485â†’      </div>\n   486â†’\n   487â†’      <p className=\"text-sm text-neutral-400 mb-4\">\n   488â†’        Guides tailored to your archetype for maximizing your aesthetic potential\n   489â†’      </p>\n   490â†’\n   491â†’      <div className=\"grid gap-3 md:grid-cols-3\">\n   492â†’        {guides.map((guide) => (\n   493â†’          <div\n   494â†’            key={guide.id}\n   495â†’            onClick={() => onOpenGuide(guide)}\n   496â†’            className=\"group bg-neutral-800/50 hover:bg-neutral-800 rounded-lg p-4 border border-neutral-700 hover:border-cyan-500/30 transition-all cursor-pointer\"\n   497â†’          >\n   498â†’            <div className=\"flex items-center gap-3 mb-2\">\n   499â†’              <div className=\"w-10 h-10 rounded-lg bg-gradient-to-br from-cyan-500/20 to-blue-500/20 flex items-center justify-center text-cyan-400 flex-shrink-0\">\n   500â†’                {GUIDE_ICON_MAP[guide.icon] || <BookOpen size={18} />}\n   501â†’              </div>\n   502â†’              <h4 className=\"font-medium text-white group-hover:text-cyan-400 transition-colors text-sm line-clamp-1\">\n   503â†’                {guide.title}\n   504â†’              </h4>\n   505â†’            </div>\n   506â†’            <p className=\"text-xs text-neutral-400 line-clamp-2 mb-2\">\n   507â†’              {guide.description}\n   508â†’            </p>\n   509â†’            <div className=\"flex items-center justify-between\">\n   510â†’              <div className=\"flex items-center gap-1 text-xs text-neutral-500\">\n   511â†’                <Clock size={12} />\n   512â†’                <span>{guide.estimatedReadTime} min</span>\n   513â†’              </div>\n   514â†’              <span className=\"text-xs text-cyan-400 opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1\">\n   515â†’                Read\n   516â†’                <ArrowRight className=\"w-3 h-3\" />\n   517â†’              </span>\n   518â†’            </div>\n   519â†’          </div>\n   520â†’        ))}\n   521â†’      </div>\n   522â†’\n   523â†’      <Link href=\"/results?tab=guides\" className=\"block mt-4\">\n   524â†’        <div className=\"flex items-center justify-center gap-2 py-2 text-sm text-neutral-400 hover:text-white transition-colors\">\n   525â†’          <span>View all guides</span>\n   526â†’          <ArrowRight className=\"w-4 h-4\" />\n   527â†’        </div>\n   528â†’      </Link>\n   529â†’    </motion.div>\n   530â†’  );\n   531â†’}\n   532â†’\n   533â†’// ============================================\n   534â†’// MAIN ARCHETYPE TAB\n   535â†’// ============================================\n   536â†’\n   537â†’export function ArchetypeTab() {\n   538â†’  const { frontRatios, sideRatios, gender, ethnicity, setActiveTab } = useResults();\n   539â†’\n   540â†’  // Classify archetype from ratios\n   541â†’  const classification = useMemo((): ArchetypeClassification | null => {\n   542â†’    if (!frontRatios || frontRatios.length === 0) return null;\n   543â†’\n   544â†’    try {\n   545â†’      return classifyFromRatios(frontRatios, sideRatios || [], gender, ethnicity);\n   546â†’    } catch (error) {\n   547â†’      console.error('[ArchetypeTab] Classification error:', error);\n   548â†’      return null;\n   549â†’    }\n   550â†’  }, [frontRatios, sideRatios, gender, ethnicity]);\n   551â†’\n   552â†’  // Handle guide opening - navigate to guides tab\n   553â†’  const handleOpenGuide = () => {\n   554â†’    setActiveTab('guides');\n   555â†’  };\n   556â†’\n   557â†’  if (!classification) {\n   558â†’    return (\n   559â†’      <TabContent\n   560â†’        title=\"Archetype Classification\"\n   561â†’        subtitle=\"Determining your facial archetype based on your metrics\"\n   562â†’      >\n   563â†’        <div className=\"bg-neutral-900 rounded-xl p-8 border border-neutral-800 text-center\">\n   564â†’          <p className=\"text-neutral-400\">\n   565â†’            Unable to classify archetype. Please ensure your analysis is complete.\n   566â†’          </p>\n   567â†’        </div>\n   568â†’      </TabContent>\n   569â†’    );\n   570â†’  }\n   571â†’\n   572â†’  return (\n   573â†’    <TabContent\n   574â†’      title=\"Archetype Classification\"\n   575â†’      subtitle=\"Your facial aesthetic archetype based on bone structure and proportions\"\n   576â†’    >\n   577â†’      <div className=\"space-y-6\">\n   578â†’        {/* Main Archetype Card */}\n   579â†’        <ArchetypeCard\n   580â†’          classification={classification}\n   581â†’          showSecondary\n   582â†’          showTransition={false}\n   583â†’        />\n   584â†’\n   585â†’        {/* All Scores Breakdown */}\n   586â†’        <AllArchetypeScores classification={classification} />\n   587â†’\n   588â†’        {/* Style Recommendations */}\n   589â†’        <StyleRecommendations classification={classification} />\n   590â†’\n   591â†’        {/* Recommended Guides */}\n   592â†’        <RecommendedGuidesSection\n   593â†’          classification={classification}\n   594â†’          onOpenGuide={handleOpenGuide}\n   595â†’        />\n   596â†’\n   597â†’        {/* Recommended Forums */}\n   598â†’        <RecommendedForumsSection classification={classification} />\n   599â†’\n   600â†’        {/* Transition Opportunities */}\n   601â†’        <TransitionOpportunities classification={classification} />\n   602â†’\n   603â†’        {/* Info footer */}\n   604â†’        <motion.div\n   605â†’          initial={{ opacity: 0 }}\n   606â†’          animate={{ opacity: 1 }}\n   607â†’          transition={{ delay: 0.5 }}\n   608â†’          className=\"p-4 bg-neutral-900/50 rounded-lg border border-neutral-800\"\n   609â†’        >\n   610â†’          <div className=\"flex items-start gap-2\">\n   611â†’            <Info className=\"w-4 h-4 text-neutral-500 flex-shrink-0 mt-0.5\" />\n   612â†’            <p className=\"text-xs text-neutral-500\">\n   613â†’              Archetype classification analyzes your facial structure including gonial angle,\n   614â†’              face width-height ratio, canthal tilt, and cheekbone position. Your primary archetype\n   615â†’              represents your dominant aesthetic, while your secondary shows traits you also exhibit.\n   616â†’              Style recommendations are tailored to complement your natural features.\n   617â†’            </p>\n   618â†’          </div>\n   619â†’        </motion.div>\n   620â†’      </div>\n   621â†’    </TabContent>\n   622â†’  );\n   623â†’}\n   624â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"4ad4d234-20f5-4f2e-99c7-434f8414fe85","timestamp":"2025-12-26T13:41:40.541Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/ArchetypeTab.tsx","content":"'use client';\n\nimport { useMemo, useEffect, useState } from 'react';\nimport { motion } from 'framer-motion';\nimport Link from 'next/link';\nimport {\n  Info,\n  Target,\n  Palette,\n  TrendingUp,\n  Users,\n  ArrowRight,\n  BookOpen,\n  Clock,\n  Brain,\n  Wrench,\n  TrendingDown,\n  Dumbbell,\n  Calendar,\n  Heart,\n  Utensils,\n  Droplet,\n} from 'lucide-react';\nimport { useResults } from '@/contexts/ResultsContext';\nimport { Guide } from '@/types/guides';\nimport { getGuideById } from '@/data/guides';\nimport { TabContent } from '../ResultsLayout';\nimport { ArchetypeCard } from '@/components/psl/archetype/ArchetypeCard';\nimport {\n  ARCHETYPE_COLORS,\n  ConfidenceBar,\n} from '@/components/psl/archetype/ArchetypeTraits';\nimport {\n  classifyFromRatios,\n  ArchetypeClassification,\n  ArchetypeCategory,\n} from '@/lib/archetype-classifier';\nimport { api, ArchetypeForumRecommendation } from '@/lib/api';\n\n// ============================================\n// ALL SCORES BREAKDOWN\n// ============================================\n\nfunction AllArchetypeScores({\n  classification,\n}: {\n  classification: ArchetypeClassification;\n}) {\n  const sortedScores = [...classification.allScores].sort((a, b) => b.score - a.score);\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      transition={{ delay: 0.2 }}\n      className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n    >\n      <div className=\"flex items-center gap-2 mb-4\">\n        <Target className=\"w-5 h-5 text-cyan-400\" />\n        <h3 className=\"font-semibold text-white\">All Category Scores</h3>\n      </div>\n\n      <p className=\"text-sm text-neutral-400 mb-4\">\n        Your match percentage across all archetype categories\n      </p>\n\n      <div className=\"space-y-4\">\n        {sortedScores.map((score, index) => {\n          const colors = ARCHETYPE_COLORS[score.category as ArchetypeCategory];\n          const isPrimary = index === 0;\n\n          return (\n            <div key={score.category} className=\"space-y-2\">\n              <div className=\"flex items-center justify-between\">\n                <div className=\"flex items-center gap-2\">\n                  {isPrimary && (\n                    <span className=\"text-xs px-2 py-0.5 rounded bg-cyan-500/20 text-cyan-400 border border-cyan-500/30\">\n                      Primary\n                    </span>\n                  )}\n                  <span className={`font-medium ${isPrimary ? 'text-white' : 'text-neutral-400'}`}>\n                    {score.category}\n                  </span>\n                </div>\n                <span\n                  className=\"text-sm font-medium\"\n                  style={{ color: colors?.primary || '#6b7280' }}\n                >\n                  {score.score}%\n                </span>\n              </div>\n              <ConfidenceBar\n                confidence={score.confidence}\n                color={colors?.primary}\n              />\n            </div>\n          );\n        })}\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// STYLE RECOMMENDATIONS\n// ============================================\n\nfunction StyleRecommendations({\n  classification,\n}: {\n  classification: ArchetypeClassification;\n}) {\n  const { styleGuide, primary } = classification;\n  const colors = ARCHETYPE_COLORS[primary.category];\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      transition={{ delay: 0.3 }}\n      className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n    >\n      <div className=\"flex items-center gap-2 mb-4\">\n        <Palette className=\"w-5 h-5 text-purple-400\" />\n        <h3 className=\"font-semibold text-white\">{primary.subArchetype} Style Guide</h3>\n      </div>\n\n      <p className=\"text-sm text-neutral-400 mb-6\">\n        Recommended style elements based on your archetype classification\n      </p>\n\n      <div className=\"grid md:grid-cols-3 gap-6\">\n        {/* Clothing */}\n        <div>\n          <h4\n            className=\"text-sm font-medium mb-3 flex items-center gap-2\"\n            style={{ color: colors.primary }}\n          >\n            <span className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: colors.primary }} />\n            Clothing\n          </h4>\n          <ul className=\"space-y-2\">\n            {styleGuide.clothing.map((item) => (\n              <li key={item} className=\"text-sm text-neutral-300 flex items-start gap-2\">\n                <span className=\"text-neutral-600 mt-1\">-</span>\n                {item}\n              </li>\n            ))}\n          </ul>\n        </div>\n\n        {/* Hair */}\n        <div>\n          <h4\n            className=\"text-sm font-medium mb-3 flex items-center gap-2\"\n            style={{ color: colors.primary }}\n          >\n            <span className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: colors.primary }} />\n            Hair\n          </h4>\n          <ul className=\"space-y-2\">\n            {styleGuide.hair.map((item) => (\n              <li key={item} className=\"text-sm text-neutral-300 flex items-start gap-2\">\n                <span className=\"text-neutral-600 mt-1\">-</span>\n                {item}\n              </li>\n            ))}\n          </ul>\n        </div>\n\n        {/* Colors */}\n        <div>\n          <h4\n            className=\"text-sm font-medium mb-3 flex items-center gap-2\"\n            style={{ color: colors.primary }}\n          >\n            <span className=\"w-2 h-2 rounded-full\" style={{ backgroundColor: colors.primary }} />\n            Color Palette\n          </h4>\n          <div className=\"flex flex-wrap gap-2\">\n            {styleGuide.colors.map((color) => (\n              <span\n                key={color}\n                className=\"px-3 py-1 rounded-full bg-neutral-800 text-neutral-300 text-sm border border-neutral-700\"\n              >\n                {color}\n              </span>\n            ))}\n          </div>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// TRANSITION OPPORTUNITIES\n// ============================================\n\nfunction TransitionOpportunities({\n  classification,\n}: {\n  classification: ArchetypeClassification;\n}) {\n  const { transitionPath, primary, allScores } = classification;\n\n  if (!transitionPath) return null;\n\n  // Find the target score\n  const targetScore = allScores.find((s) => s.category === transitionPath.target);\n  const primaryColors = ARCHETYPE_COLORS[primary.category];\n  const targetColors = ARCHETYPE_COLORS[transitionPath.target as ArchetypeCategory];\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      transition={{ delay: 0.4 }}\n      className=\"bg-gradient-to-r from-cyan-500/10 to-purple-500/10 rounded-xl p-6 border border-cyan-500/20\"\n    >\n      <div className=\"flex items-center gap-2 mb-4\">\n        <TrendingUp className=\"w-5 h-5 text-green-400\" />\n        <h3 className=\"font-semibold text-white\">Archetype Transition Potential</h3>\n      </div>\n\n      <div className=\"grid md:grid-cols-2 gap-6\">\n        {/* Current */}\n        <div className=\"bg-neutral-900/50 rounded-lg p-4\">\n          <p className=\"text-xs text-neutral-500 mb-2\">Current Archetype</p>\n          <p\n            className=\"text-xl font-bold mb-1\"\n            style={{ color: primaryColors.primary }}\n          >\n            {primary.subArchetype}\n          </p>\n          <p className=\"text-sm text-neutral-400\">{primary.category}</p>\n          <div className=\"mt-3\">\n            <ConfidenceBar\n              confidence={primary.confidence}\n              label=\"Match\"\n              color={primaryColors.primary}\n            />\n          </div>\n        </div>\n\n        {/* Target */}\n        <div className=\"bg-neutral-900/50 rounded-lg p-4\">\n          <p className=\"text-xs text-neutral-500 mb-2\">Transition Target</p>\n          <p\n            className=\"text-xl font-bold mb-1\"\n            style={{ color: targetColors?.primary || '#67e8f9' }}\n          >\n            {transitionPath.target}\n          </p>\n          <p className=\"text-sm text-neutral-400\">\n            {targetScore ? `${targetScore.score}% current match` : 'New category'}\n          </p>\n          {targetScore && (\n            <div className=\"mt-3\">\n              <ConfidenceBar\n                confidence={targetScore.confidence}\n                label=\"Current Match\"\n                color={targetColors?.primary}\n              />\n            </div>\n          )}\n        </div>\n      </div>\n\n      {/* Requirements */}\n      <div className=\"mt-6\">\n        <p className=\"text-sm text-neutral-400 mb-3\">To achieve this transition:</p>\n        <ul className=\"grid md:grid-cols-2 gap-2\">\n          {transitionPath.requirements.map((req, i) => (\n            <li\n              key={i}\n              className=\"flex items-center gap-2 p-3 bg-neutral-900/50 rounded-lg text-sm text-neutral-300\"\n            >\n              <span className=\"w-5 h-5 rounded-full bg-cyan-500/20 text-cyan-400 flex items-center justify-center text-xs\">\n                {i + 1}\n              </span>\n              {req}\n            </li>\n          ))}\n        </ul>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// RECOMMENDED FORUMS SECTION\n// ============================================\n\nfunction RecommendedForumsSection({\n  classification,\n}: {\n  classification: ArchetypeClassification;\n}) {\n  const [forums, setForums] = useState<ArchetypeForumRecommendation[]>([]);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const archetype = classification.primary.category;\n  const colors = ARCHETYPE_COLORS[archetype];\n\n  useEffect(() => {\n    let isMounted = true;\n\n    async function fetchForums() {\n      setIsLoading(true);\n      try {\n        const recommendations = await api.getArchetypeForumRecommendations(archetype);\n        if (isMounted) {\n          setForums(recommendations.slice(0, 3)); // Show top 3\n        }\n      } catch (error) {\n        if (isMounted) {\n          console.error('[ArchetypeTab] Failed to fetch forum recommendations:', error);\n        }\n      } finally {\n        if (isMounted) {\n          setIsLoading(false);\n        }\n      }\n    }\n\n    fetchForums();\n\n    return () => {\n      isMounted = false;\n    };\n  }, [archetype]);\n\n  if (isLoading) {\n    return (\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        transition={{ delay: 0.35 }}\n        className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n      >\n        <div className=\"flex items-center gap-2 mb-4\">\n          <Users className=\"w-5 h-5 text-amber-400\" />\n          <h3 className=\"font-semibold text-white\">Recommended Forums</h3>\n        </div>\n        <div className=\"grid gap-3 md:grid-cols-3\">\n          {[1, 2, 3].map((i) => (\n            <div key={i} className=\"animate-pulse bg-neutral-800 rounded-lg h-24\" />\n          ))}\n        </div>\n      </motion.div>\n    );\n  }\n\n  if (forums.length === 0) return null;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      transition={{ delay: 0.35 }}\n      className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n    >\n      <div className=\"flex items-center gap-2 mb-4\">\n        <Users className=\"w-5 h-5 text-amber-400\" />\n        <h3 className=\"font-semibold text-white\">Recommended Forums</h3>\n        <span\n          className=\"px-2 py-0.5 text-xs font-medium rounded border\"\n          style={{\n            backgroundColor: `${colors.primary}20`,\n            color: colors.primary,\n            borderColor: `${colors.primary}40`,\n          }}\n        >\n          {archetype}\n        </span>\n      </div>\n\n      <p className=\"text-sm text-neutral-400 mb-4\">\n        Forums tailored to your archetype to help you maximize your aesthetic potential\n      </p>\n\n      <div className=\"grid gap-3 md:grid-cols-3\">\n        {forums.map((forum) => (\n          <Link key={forum.category.id} href={`/forum/${forum.category.slug}`}>\n            <div className=\"group bg-neutral-800/50 hover:bg-neutral-800 rounded-lg p-4 border border-neutral-700 hover:border-amber-500/30 transition-all cursor-pointer\">\n              <div className=\"flex items-center gap-3 mb-2\">\n                <div className=\"w-10 h-10 rounded-lg bg-gradient-to-br from-amber-500/20 to-orange-500/20 flex items-center justify-center text-xl flex-shrink-0\">\n                  {forum.category.icon || 'ðŸ’¬'}\n                </div>\n                <h4 className=\"font-medium text-white group-hover:text-amber-400 transition-colors text-sm line-clamp-1\">\n                  {forum.category.name}\n                </h4>\n              </div>\n              <p className=\"text-xs text-neutral-400 line-clamp-2 mb-2\">\n                {forum.reason || forum.category.description}\n              </p>\n              <div className=\"flex items-center justify-end\">\n                <span className=\"text-xs text-amber-400 opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1\">\n                  Visit\n                  <ArrowRight className=\"w-3 h-3\" />\n                </span>\n              </div>\n            </div>\n          </Link>\n        ))}\n      </div>\n\n      <Link href=\"/forum\" className=\"block mt-4\">\n        <div className=\"flex items-center justify-center gap-2 py-2 text-sm text-neutral-400 hover:text-white transition-colors\">\n          <span>Explore all forums</span>\n          <ArrowRight className=\"w-4 h-4\" />\n        </div>\n      </Link>\n    </motion.div>\n  );\n}\n\n// ============================================\n// RECOMMENDED GUIDES SECTION\n// ============================================\n\n// Icon mapping for guides\nconst GUIDE_ICON_MAP: Record<string, React.ReactNode> = {\n  BookOpen: <BookOpen size={18} />,\n  Dumbbell: <Dumbbell size={18} />,\n  Brain: <Brain size={18} />,\n  Wrench: <Wrench size={18} />,\n  TrendingDown: <TrendingDown size={18} />,\n  Calendar: <Calendar size={18} />,\n  Target: <Target size={18} />,\n  Heart: <Heart size={18} />,\n  Utensils: <Utensils size={18} />,\n  Droplet: <Droplet size={18} />,\n};\n\n// Map archetypes to recommended guides\nconst ARCHETYPE_GUIDES: Record<string, string[]> = {\n  Softboy: ['skincare', 'mindset', 'diet', 'maintenance'],\n  Prettyboy: ['skincare', 'maintenance', 'diet', 'body-fat'],\n  RobustPrettyboy: ['v-taper', 'training', 'skincare', 'diet'],\n  Chad: ['v-taper', 'training', 'core-neck', 'body-fat'],\n  Hypermasculine: ['v-taper', 'training', 'core-neck', 'cardio'],\n  Exotic: ['skincare', 'mindset', 'maintenance', 'diet'],\n};\n\nfunction RecommendedGuidesSection({\n  classification,\n  onOpenGuide,\n}: {\n  classification: ArchetypeClassification;\n  onOpenGuide: (guide: Guide) => void;\n}) {\n  const archetype = classification.primary.category;\n  const colors = ARCHETYPE_COLORS[archetype];\n  const guideIds = ARCHETYPE_GUIDES[archetype] || ARCHETYPE_GUIDES.Softboy;\n\n  const guides = guideIds\n    .map((id) => getGuideById(id))\n    .filter((g): g is Guide => g !== undefined)\n    .slice(0, 3);\n\n  if (guides.length === 0) return null;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      transition={{ delay: 0.35 }}\n      className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n    >\n      <div className=\"flex items-center gap-2 mb-4\">\n        <BookOpen className=\"w-5 h-5 text-cyan-400\" />\n        <h3 className=\"font-semibold text-white\">Recommended Guides</h3>\n        <span\n          className=\"px-2 py-0.5 text-xs font-medium rounded border\"\n          style={{\n            backgroundColor: `${colors.primary}20`,\n            color: colors.primary,\n            borderColor: `${colors.primary}40`,\n          }}\n        >\n          {archetype}\n        </span>\n      </div>\n\n      <p className=\"text-sm text-neutral-400 mb-4\">\n        Guides tailored to your archetype for maximizing your aesthetic potential\n      </p>\n\n      <div className=\"grid gap-3 md:grid-cols-3\">\n        {guides.map((guide) => (\n          <div\n            key={guide.id}\n            onClick={() => onOpenGuide(guide)}\n            className=\"group bg-neutral-800/50 hover:bg-neutral-800 rounded-lg p-4 border border-neutral-700 hover:border-cyan-500/30 transition-all cursor-pointer\"\n          >\n            <div className=\"flex items-center gap-3 mb-2\">\n              <div className=\"w-10 h-10 rounded-lg bg-gradient-to-br from-cyan-500/20 to-blue-500/20 flex items-center justify-center text-cyan-400 flex-shrink-0\">\n                {GUIDE_ICON_MAP[guide.icon] || <BookOpen size={18} />}\n              </div>\n              <h4 className=\"font-medium text-white group-hover:text-cyan-400 transition-colors text-sm line-clamp-1\">\n                {guide.title}\n              </h4>\n            </div>\n            <p className=\"text-xs text-neutral-400 line-clamp-2 mb-2\">\n              {guide.description}\n            </p>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-1 text-xs text-neutral-500\">\n                <Clock size={12} />\n                <span>{guide.estimatedReadTime} min</span>\n              </div>\n              <span className=\"text-xs text-cyan-400 opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1\">\n                Read\n                <ArrowRight className=\"w-3 h-3\" />\n              </span>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      <Link href=\"/results?tab=guides\" className=\"block mt-4\">\n        <div className=\"flex items-center justify-center gap-2 py-2 text-sm text-neutral-400 hover:text-white transition-colors\">\n          <span>View all guides</span>\n          <ArrowRight className=\"w-4 h-4\" />\n        </div>\n      </Link>\n    </motion.div>\n  );\n}\n\n// ============================================\n// MAIN ARCHETYPE TAB\n// ============================================\n\nexport function ArchetypeTab() {\n  const { frontRatios, sideRatios, gender, ethnicity, setActiveTab } = useResults();\n\n  // Classify archetype from ratios\n  const classification = useMemo((): ArchetypeClassification | null => {\n    if (!frontRatios || frontRatios.length === 0) return null;\n\n    try {\n      return classifyFromRatios(frontRatios, sideRatios || [], gender, ethnicity);\n    } catch (error) {\n      console.error('[ArchetypeTab] Classification error:', error);\n      return null;\n    }\n  }, [frontRatios, sideRatios, gender, ethnicity]);\n\n  // Handle guide opening - navigate to guides tab\n  const handleOpenGuide = () => {\n    setActiveTab('guides');\n  };\n\n  if (!classification) {\n    return (\n      <TabContent\n        title=\"Archetype Classification\"\n        subtitle=\"Determining your facial archetype based on your metrics\"\n      >\n        <div className=\"bg-neutral-900 rounded-xl p-8 border border-neutral-800 text-center\">\n          <p className=\"text-neutral-400\">\n            Unable to classify archetype. Please ensure your analysis is complete.\n          </p>\n        </div>\n      </TabContent>\n    );\n  }\n\n  return (\n    <TabContent\n      title=\"Archetype Classification\"\n      subtitle=\"Your facial aesthetic archetype based on bone structure and proportions\"\n    >\n      <div className=\"space-y-6\">\n        {/* Main Archetype Card */}\n        <ArchetypeCard\n          classification={classification}\n          showSecondary\n          showTransition={false}\n        />\n\n        {/* All Scores Breakdown */}\n        <AllArchetypeScores classification={classification} />\n\n        {/* Style Recommendations */}\n        <StyleRecommendations classification={classification} />\n\n        {/* Recommended Guides */}\n        <RecommendedGuidesSection\n          classification={classification}\n          onOpenGuide={handleOpenGuide}\n        />\n\n        {/* Recommended Forums */}\n        <RecommendedForumsSection classification={classification} />\n\n        {/* Transition Opportunities */}\n        <TransitionOpportunities classification={classification} />\n\n        {/* Info footer */}\n        <motion.div\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          transition={{ delay: 0.5 }}\n          className=\"p-4 bg-neutral-900/50 rounded-lg border border-neutral-800\"\n        >\n          <div className=\"flex items-start gap-2\">\n            <Info className=\"w-4 h-4 text-neutral-500 flex-shrink-0 mt-0.5\" />\n            <p className=\"text-xs text-neutral-500\">\n              Archetype classification analyzes your facial structure including gonial angle,\n              face width-height ratio, canthal tilt, and cheekbone position. Your primary archetype\n              represents your dominant aesthetic, while your secondary shows traits you also exhibit.\n              Style recommendations are tailored to complement your natural features.\n            </p>\n          </div>\n        </motion.div>\n      </div>\n    </TabContent>\n  );\n}\n","numLines":624,"startLine":1,"totalLines":624}}}
{"parentUuid":"4ad4d234-20f5-4f2e-99c7-434f8414fe85","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015dycnwS9JnXL1SPdQBV2FG","type":"tool_result","content":"     1â†’'use client';\n     2â†’\n     3â†’import { useEffect, useState } from 'react';\n     4â†’import { motion } from 'framer-motion';\n     5â†’import {\n     6â†’  Trophy,\n     7â†’  Medal,\n     8â†’  Crown,\n     9â†’  User as UserIcon,\n    10â†’  TrendingUp,\n    11â†’  TrendingDown,\n    12â†’} from 'lucide-react';\n    13â†’import { TabContent } from '../ResultsLayout';\n    14â†’import { useLeaderboard } from '@/contexts/LeaderboardContext';\n    15â†’import { useResults } from '@/contexts/ResultsContext';\n    16â†’import { ScoreCircle } from '../shared';\n    17â†’import { getScoreColor } from '@/types/results';\n    18â†’import { UserProfileModal } from '../modals/UserProfileModal';\n    19â†’import { api } from '@/lib/api';\n    20â†’\n    21â†’// ============================================\n    22â†’// RANK DISPLAY HELPERS\n    23â†’// ============================================\n    24â†’\n    25â†’function getRankIcon(rank: number) {\n    26â†’  if (rank === 1) return <Crown size={20} className=\"text-yellow-400\" />;\n    27â†’  if (rank === 2) return <Medal size={20} className=\"text-gray-300\" />;\n    28â†’  if (rank === 3) return <Medal size={20} className=\"text-amber-600\" />;\n    29â†’  return null;\n    30â†’}\n    31â†’\n    32â†’function getRankBgClass(rank: number, isCurrentUser: boolean) {\n    33â†’  if (isCurrentUser) return 'bg-cyan-500/20 border-cyan-500/40';\n    34â†’  if (rank === 1) return 'bg-yellow-500/10 border-yellow-500/30';\n    35â†’  if (rank === 2) return 'bg-gray-500/10 border-gray-500/30';\n    36â†’  if (rank === 3) return 'bg-amber-500/10 border-amber-500/30';\n    37â†’  return 'bg-neutral-900/60 border-neutral-800';\n    38â†’}\n    39â†’\n    40â†’// ============================================\n    41â†’// LEADERBOARD TAB\n    42â†’// ============================================\n    43â†’\n    44â†’export function LeaderboardTab() {\n    45â†’  const {\n    46â†’    userRank,\n    47â†’    leaderboard,\n    48â†’    totalCount,\n    49â†’    isLoading,\n    50â†’    error,\n    51â†’    setGenderFilter,\n    52â†’    fetchLeaderboard,\n    53â†’    hasMore,\n    54â†’    loadMore,\n    55â†’    setSelectedUserId,\n    56â†’  } = useLeaderboard();\n    57â†’\n    58â†’  const { gender } = useResults();\n    59â†’  const [isModalOpen, setIsModalOpen] = useState(false);\n    60â†’  const isAuthenticated = !!api.getToken();\n    61â†’\n    62â†’  // Auto-set gender filter to user's gender (males see male leaderboard, females see female)\n    63â†’  useEffect(() => {\n    64â†’    setGenderFilter(gender);\n    65â†’  }, [gender, setGenderFilter]);\n    66â†’\n    67â†’  // Fetch leaderboard if empty (first visit or after gender filter is set)\n    68â†’  // Only fetch if user is authenticated (API requires auth)\n    69â†’  useEffect(() => {\n    70â†’    const token = api.getToken();\n    71â†’    if (leaderboard.length === 0 && !isLoading && !error && token) {\n    72â†’      fetchLeaderboard(0);\n    73â†’    }\n    74â†’  }, [leaderboard.length, isLoading, error, fetchLeaderboard]);\n    75â†’\n    76â†’  const handleUserClick = (entry: { userId: string }) => {\n    77â†’    setSelectedUserId(entry.userId);\n    78â†’    setIsModalOpen(true);\n    79â†’  };\n    80â†’\n    81â†’  const genderLabel = gender === 'male' ? 'Males' : 'Females';\n    82â†’\n    83â†’  return (\n    84â†’    <>\n    85â†’      <TabContent\n    86â†’        title={`${genderLabel} Leaderboard`}\n    87â†’        subtitle={`See how you compare among ${genderLabel.toLowerCase()}`}\n    88â†’      >\n    89â†’        <div className=\"space-y-6\">\n    90â†’          {/* Your Rank Card */}\n    91â†’          {userRank && (\n    92â†’            <motion.div\n    93â†’              initial={{ opacity: 0, y: 20 }}\n    94â†’              animate={{ opacity: 1, y: 0 }}\n    95â†’              className=\"bg-gradient-to-r from-cyan-500/20 to-blue-600/20 border border-cyan-500/30 rounded-xl p-6\"\n    96â†’            >\n    97â†’              <div className=\"flex items-center justify-between\">\n    98â†’                <div>\n    99â†’                  <p className=\"text-sm text-neutral-400 mb-1\">Your Rank ({genderLabel})</p>\n   100â†’                  <div className=\"flex items-center gap-3\">\n   101â†’                    <span className=\"text-4xl font-bold text-white\">#{userRank.genderRank}</span>\n   102â†’                    <div className=\"text-sm text-neutral-400\">\n   103â†’                      <p>Top {userRank.percentile.toFixed(1)}%</p>\n   104â†’                      <p>of {userRank.genderTotal.toLocaleString()} {genderLabel.toLowerCase()}</p>\n   105â†’                    </div>\n   106â†’                  </div>\n   107â†’                </div>\n   108â†’                <ScoreCircle score={userRank.score} size=\"lg\" animate={false} />\n   109â†’              </div>\n   110â†’            </motion.div>\n   111â†’          )}\n   112â†’\n   113â†’          {/* Leaderboard List */}\n   114â†’          <div className=\"bg-neutral-900/60 border border-neutral-800 rounded-xl overflow-hidden\">\n   115â†’            <div className=\"p-4 border-b border-neutral-800 flex items-center justify-between\">\n   116â†’              <div className=\"flex items-center gap-2\">\n   117â†’                <Trophy size={20} className=\"text-cyan-400\" />\n   118â†’                <h3 className=\"font-semibold text-white\">Top {genderLabel}</h3>\n   119â†’              </div>\n   120â†’              <span className=\"text-sm text-neutral-400\">{totalCount.toLocaleString()} {genderLabel.toLowerCase()}</span>\n   121â†’            </div>\n   122â†’\n   123â†’            {isLoading && leaderboard.length === 0 ? (\n   124â†’              <div className=\"p-8 text-center\">\n   125â†’                <div className=\"animate-spin w-8 h-8 border-2 border-cyan-500 border-t-transparent rounded-full mx-auto\" />\n   126â†’                <p className=\"mt-4 text-neutral-400\">Loading leaderboard...</p>\n   127â†’              </div>\n   128â†’            ) : error ? (\n   129â†’              <div className=\"p-8 text-center text-red-400\">{error}</div>\n   130â†’            ) : leaderboard.length === 0 ? (\n   131â†’              <div className=\"p-8 text-center\">\n   132â†’                <Trophy size={48} className=\"mx-auto text-neutral-600 mb-4\" />\n   133â†’                {isAuthenticated ? (\n   134â†’                  <p className=\"text-neutral-400\">No entries yet. Be the first!</p>\n   135â†’                ) : (\n   136â†’                  <>\n   137â†’                    <p className=\"text-neutral-400 mb-4\">Sign in to view the leaderboard and compete with others</p>\n   138â†’                    <a\n   139â†’                      href=\"/login\"\n   140â†’                      className=\"inline-flex items-center gap-2 px-4 py-2 bg-cyan-500 hover:bg-cyan-400 text-black font-medium rounded-lg transition-colors\"\n   141â†’                    >\n   142â†’                      Sign In\n   143â†’                    </a>\n   144â†’                  </>\n   145â†’                )}\n   146â†’              </div>\n   147â†’            ) : (\n   148â†’              <div className=\"divide-y divide-neutral-800\">\n   149â†’                {leaderboard.map((entry, index) => (\n   150â†’                  <motion.div\n   151â†’                    key={`${entry.rank}-${index}`}\n   152â†’                    initial={{ opacity: 0, x: -20 }}\n   153â†’                    animate={{ opacity: 1, x: 0 }}\n   154â†’                    transition={{ delay: index * 0.03 }}\n   155â†’                    className={`${getRankBgClass(entry.rank, entry.isCurrentUser)} border-l-2 ${\n   156â†’                      entry.isCurrentUser ? 'border-l-cyan-500' : 'border-l-transparent'\n   157â†’                    }`}\n   158â†’                  >\n   159â†’                    <button\n   160â†’                      onClick={() => !entry.isCurrentUser && handleUserClick(entry)}\n   161â†’                      className=\"w-full p-4 hover:bg-neutral-800/50 transition-colors text-left\"\n   162â†’                      disabled={entry.isCurrentUser}\n   163â†’                    >\n   164â†’                      <div className=\"flex items-start gap-4\">\n   165â†’                        {/* Rank */}\n   166â†’                        <div className=\"w-12 flex items-center justify-center pt-1\">\n   167â†’                          {getRankIcon(entry.rank) || (\n   168â†’                            <span className=\"text-lg font-bold text-neutral-400\">#{entry.rank}</span>\n   169â†’                          )}\n   170â†’                        </div>\n   171â†’\n   172â†’                        {/* Photo - larger for leaderboard */}\n   173â†’                        <div className=\"w-16 h-16 rounded-xl overflow-hidden bg-neutral-800 flex items-center justify-center flex-shrink-0 border border-neutral-700\">\n   174â†’                          {entry.facePhotoUrl ? (\n   175â†’                            <img\n   176â†’                              src={entry.facePhotoUrl}\n   177â†’                              alt={entry.anonymousName}\n   178â†’                              className=\"w-full h-full object-cover\"\n   179â†’                            />\n   180â†’                          ) : (\n   181â†’                            <UserIcon size={28} className=\"text-neutral-500\" />\n   182â†’                          )}\n   183â†’                        </div>\n   184â†’\n   185â†’                        {/* User info + Strengths/Improvements */}\n   186â†’                        <div className=\"flex-1 min-w-0\">\n   187â†’                          <div className=\"flex items-center gap-2 mb-1\">\n   188â†’                            <p className={`font-semibold ${entry.isCurrentUser ? 'text-cyan-400' : 'text-white'}`}>\n   189â†’                              {entry.isCurrentUser ? 'You' : entry.anonymousName}\n   190â†’                            </p>\n   191â†’                            <span\n   192â†’                              className=\"text-lg font-bold\"\n   193â†’                              style={{ color: getScoreColor(entry.score) }}\n   194â†’                            >\n   195â†’                              {entry.score.toFixed(2)}\n   196â†’                            </span>\n   197â†’                          </div>\n   198â†’\n   199â†’                          {/* Strengths */}\n   200â†’                          {entry.topStrengths && entry.topStrengths.length > 0 && (\n   201â†’                            <div className=\"flex items-center gap-1.5 mb-1\">\n   202â†’                              <TrendingUp size={12} className=\"text-green-400 flex-shrink-0\" />\n   203â†’                              <div className=\"flex flex-wrap gap-1\">\n   204â†’                                {entry.topStrengths.slice(0, 3).map((strength, i) => (\n   205â†’                                  <span\n   206â†’                                    key={i}\n   207â†’                                    className=\"text-xs px-1.5 py-0.5 bg-green-500/10 text-green-400 rounded border border-green-500/20\"\n   208â†’                                  >\n   209â†’                                    {strength}\n   210â†’                                  </span>\n   211â†’                                ))}\n   212â†’                              </div>\n   213â†’                            </div>\n   214â†’                          )}\n   215â†’\n   216â†’                          {/* Improvements */}\n   217â†’                          {entry.topImprovements && entry.topImprovements.length > 0 && (\n   218â†’                            <div className=\"flex items-center gap-1.5\">\n   219â†’                              <TrendingDown size={12} className=\"text-amber-400 flex-shrink-0\" />\n   220â†’                              <div className=\"flex flex-wrap gap-1\">\n   221â†’                                {entry.topImprovements.slice(0, 3).map((improvement, i) => (\n   222â†’                                  <span\n   223â†’                                    key={i}\n   224â†’                                    className=\"text-xs px-1.5 py-0.5 bg-amber-500/10 text-amber-400 rounded border border-amber-500/20\"\n   225â†’                                  >\n   226â†’                                    {improvement}\n   227â†’                                  </span>\n   228â†’                                ))}\n   229â†’                              </div>\n   230â†’                            </div>\n   231â†’                          )}\n   232â†’\n   233â†’                          {/* Show placeholder if no data */}\n   234â†’                          {(!entry.topStrengths || entry.topStrengths.length === 0) &&\n   235â†’                           (!entry.topImprovements || entry.topImprovements.length === 0) && (\n   236â†’                            <p className=\"text-xs text-neutral-500 capitalize\">{entry.gender}</p>\n   237â†’                          )}\n   238â†’                        </div>\n   239â†’                      </div>\n   240â†’                    </button>\n   241â†’                  </motion.div>\n   242â†’                ))}\n   243â†’              </div>\n   244â†’            )}\n   245â†’\n   246â†’            {/* Load More */}\n   247â†’            {hasMore && leaderboard.length > 0 && (\n   248â†’              <button\n   249â†’                onClick={loadMore}\n   250â†’                disabled={isLoading}\n   251â†’                className=\"w-full p-4 text-center text-cyan-400 hover:bg-neutral-800/50 transition-colors disabled:opacity-50 border-t border-neutral-800\"\n   252â†’              >\n   253â†’                {isLoading ? 'Loading...' : 'Load More'}\n   254â†’              </button>\n   255â†’            )}\n   256â†’          </div>\n   257â†’        </div>\n   258â†’      </TabContent>\n   259â†’\n   260â†’      {/* User Profile Modal */}\n   261â†’      <UserProfileModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} />\n   262â†’    </>\n   263â†’  );\n   264â†’}\n   265â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"26e14e2d-03bb-449c-8e57-33804ce2d39c","timestamp":"2025-12-26T13:41:40.541Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/LeaderboardTab.tsx","content":"'use client';\n\nimport { useEffect, useState } from 'react';\nimport { motion } from 'framer-motion';\nimport {\n  Trophy,\n  Medal,\n  Crown,\n  User as UserIcon,\n  TrendingUp,\n  TrendingDown,\n} from 'lucide-react';\nimport { TabContent } from '../ResultsLayout';\nimport { useLeaderboard } from '@/contexts/LeaderboardContext';\nimport { useResults } from '@/contexts/ResultsContext';\nimport { ScoreCircle } from '../shared';\nimport { getScoreColor } from '@/types/results';\nimport { UserProfileModal } from '../modals/UserProfileModal';\nimport { api } from '@/lib/api';\n\n// ============================================\n// RANK DISPLAY HELPERS\n// ============================================\n\nfunction getRankIcon(rank: number) {\n  if (rank === 1) return <Crown size={20} className=\"text-yellow-400\" />;\n  if (rank === 2) return <Medal size={20} className=\"text-gray-300\" />;\n  if (rank === 3) return <Medal size={20} className=\"text-amber-600\" />;\n  return null;\n}\n\nfunction getRankBgClass(rank: number, isCurrentUser: boolean) {\n  if (isCurrentUser) return 'bg-cyan-500/20 border-cyan-500/40';\n  if (rank === 1) return 'bg-yellow-500/10 border-yellow-500/30';\n  if (rank === 2) return 'bg-gray-500/10 border-gray-500/30';\n  if (rank === 3) return 'bg-amber-500/10 border-amber-500/30';\n  return 'bg-neutral-900/60 border-neutral-800';\n}\n\n// ============================================\n// LEADERBOARD TAB\n// ============================================\n\nexport function LeaderboardTab() {\n  const {\n    userRank,\n    leaderboard,\n    totalCount,\n    isLoading,\n    error,\n    setGenderFilter,\n    fetchLeaderboard,\n    hasMore,\n    loadMore,\n    setSelectedUserId,\n  } = useLeaderboard();\n\n  const { gender } = useResults();\n  const [isModalOpen, setIsModalOpen] = useState(false);\n  const isAuthenticated = !!api.getToken();\n\n  // Auto-set gender filter to user's gender (males see male leaderboard, females see female)\n  useEffect(() => {\n    setGenderFilter(gender);\n  }, [gender, setGenderFilter]);\n\n  // Fetch leaderboard if empty (first visit or after gender filter is set)\n  // Only fetch if user is authenticated (API requires auth)\n  useEffect(() => {\n    const token = api.getToken();\n    if (leaderboard.length === 0 && !isLoading && !error && token) {\n      fetchLeaderboard(0);\n    }\n  }, [leaderboard.length, isLoading, error, fetchLeaderboard]);\n\n  const handleUserClick = (entry: { userId: string }) => {\n    setSelectedUserId(entry.userId);\n    setIsModalOpen(true);\n  };\n\n  const genderLabel = gender === 'male' ? 'Males' : 'Females';\n\n  return (\n    <>\n      <TabContent\n        title={`${genderLabel} Leaderboard`}\n        subtitle={`See how you compare among ${genderLabel.toLowerCase()}`}\n      >\n        <div className=\"space-y-6\">\n          {/* Your Rank Card */}\n          {userRank && (\n            <motion.div\n              initial={{ opacity: 0, y: 20 }}\n              animate={{ opacity: 1, y: 0 }}\n              className=\"bg-gradient-to-r from-cyan-500/20 to-blue-600/20 border border-cyan-500/30 rounded-xl p-6\"\n            >\n              <div className=\"flex items-center justify-between\">\n                <div>\n                  <p className=\"text-sm text-neutral-400 mb-1\">Your Rank ({genderLabel})</p>\n                  <div className=\"flex items-center gap-3\">\n                    <span className=\"text-4xl font-bold text-white\">#{userRank.genderRank}</span>\n                    <div className=\"text-sm text-neutral-400\">\n                      <p>Top {userRank.percentile.toFixed(1)}%</p>\n                      <p>of {userRank.genderTotal.toLocaleString()} {genderLabel.toLowerCase()}</p>\n                    </div>\n                  </div>\n                </div>\n                <ScoreCircle score={userRank.score} size=\"lg\" animate={false} />\n              </div>\n            </motion.div>\n          )}\n\n          {/* Leaderboard List */}\n          <div className=\"bg-neutral-900/60 border border-neutral-800 rounded-xl overflow-hidden\">\n            <div className=\"p-4 border-b border-neutral-800 flex items-center justify-between\">\n              <div className=\"flex items-center gap-2\">\n                <Trophy size={20} className=\"text-cyan-400\" />\n                <h3 className=\"font-semibold text-white\">Top {genderLabel}</h3>\n              </div>\n              <span className=\"text-sm text-neutral-400\">{totalCount.toLocaleString()} {genderLabel.toLowerCase()}</span>\n            </div>\n\n            {isLoading && leaderboard.length === 0 ? (\n              <div className=\"p-8 text-center\">\n                <div className=\"animate-spin w-8 h-8 border-2 border-cyan-500 border-t-transparent rounded-full mx-auto\" />\n                <p className=\"mt-4 text-neutral-400\">Loading leaderboard...</p>\n              </div>\n            ) : error ? (\n              <div className=\"p-8 text-center text-red-400\">{error}</div>\n            ) : leaderboard.length === 0 ? (\n              <div className=\"p-8 text-center\">\n                <Trophy size={48} className=\"mx-auto text-neutral-600 mb-4\" />\n                {isAuthenticated ? (\n                  <p className=\"text-neutral-400\">No entries yet. Be the first!</p>\n                ) : (\n                  <>\n                    <p className=\"text-neutral-400 mb-4\">Sign in to view the leaderboard and compete with others</p>\n                    <a\n                      href=\"/login\"\n                      className=\"inline-flex items-center gap-2 px-4 py-2 bg-cyan-500 hover:bg-cyan-400 text-black font-medium rounded-lg transition-colors\"\n                    >\n                      Sign In\n                    </a>\n                  </>\n                )}\n              </div>\n            ) : (\n              <div className=\"divide-y divide-neutral-800\">\n                {leaderboard.map((entry, index) => (\n                  <motion.div\n                    key={`${entry.rank}-${index}`}\n                    initial={{ opacity: 0, x: -20 }}\n                    animate={{ opacity: 1, x: 0 }}\n                    transition={{ delay: index * 0.03 }}\n                    className={`${getRankBgClass(entry.rank, entry.isCurrentUser)} border-l-2 ${\n                      entry.isCurrentUser ? 'border-l-cyan-500' : 'border-l-transparent'\n                    }`}\n                  >\n                    <button\n                      onClick={() => !entry.isCurrentUser && handleUserClick(entry)}\n                      className=\"w-full p-4 hover:bg-neutral-800/50 transition-colors text-left\"\n                      disabled={entry.isCurrentUser}\n                    >\n                      <div className=\"flex items-start gap-4\">\n                        {/* Rank */}\n                        <div className=\"w-12 flex items-center justify-center pt-1\">\n                          {getRankIcon(entry.rank) || (\n                            <span className=\"text-lg font-bold text-neutral-400\">#{entry.rank}</span>\n                          )}\n                        </div>\n\n                        {/* Photo - larger for leaderboard */}\n                        <div className=\"w-16 h-16 rounded-xl overflow-hidden bg-neutral-800 flex items-center justify-center flex-shrink-0 border border-neutral-700\">\n                          {entry.facePhotoUrl ? (\n                            <img\n                              src={entry.facePhotoUrl}\n                              alt={entry.anonymousName}\n                              className=\"w-full h-full object-cover\"\n                            />\n                          ) : (\n                            <UserIcon size={28} className=\"text-neutral-500\" />\n                          )}\n                        </div>\n\n                        {/* User info + Strengths/Improvements */}\n                        <div className=\"flex-1 min-w-0\">\n                          <div className=\"flex items-center gap-2 mb-1\">\n                            <p className={`font-semibold ${entry.isCurrentUser ? 'text-cyan-400' : 'text-white'}`}>\n                              {entry.isCurrentUser ? 'You' : entry.anonymousName}\n                            </p>\n                            <span\n                              className=\"text-lg font-bold\"\n                              style={{ color: getScoreColor(entry.score) }}\n                            >\n                              {entry.score.toFixed(2)}\n                            </span>\n                          </div>\n\n                          {/* Strengths */}\n                          {entry.topStrengths && entry.topStrengths.length > 0 && (\n                            <div className=\"flex items-center gap-1.5 mb-1\">\n                              <TrendingUp size={12} className=\"text-green-400 flex-shrink-0\" />\n                              <div className=\"flex flex-wrap gap-1\">\n                                {entry.topStrengths.slice(0, 3).map((strength, i) => (\n                                  <span\n                                    key={i}\n                                    className=\"text-xs px-1.5 py-0.5 bg-green-500/10 text-green-400 rounded border border-green-500/20\"\n                                  >\n                                    {strength}\n                                  </span>\n                                ))}\n                              </div>\n                            </div>\n                          )}\n\n                          {/* Improvements */}\n                          {entry.topImprovements && entry.topImprovements.length > 0 && (\n                            <div className=\"flex items-center gap-1.5\">\n                              <TrendingDown size={12} className=\"text-amber-400 flex-shrink-0\" />\n                              <div className=\"flex flex-wrap gap-1\">\n                                {entry.topImprovements.slice(0, 3).map((improvement, i) => (\n                                  <span\n                                    key={i}\n                                    className=\"text-xs px-1.5 py-0.5 bg-amber-500/10 text-amber-400 rounded border border-amber-500/20\"\n                                  >\n                                    {improvement}\n                                  </span>\n                                ))}\n                              </div>\n                            </div>\n                          )}\n\n                          {/* Show placeholder if no data */}\n                          {(!entry.topStrengths || entry.topStrengths.length === 0) &&\n                           (!entry.topImprovements || entry.topImprovements.length === 0) && (\n                            <p className=\"text-xs text-neutral-500 capitalize\">{entry.gender}</p>\n                          )}\n                        </div>\n                      </div>\n                    </button>\n                  </motion.div>\n                ))}\n              </div>\n            )}\n\n            {/* Load More */}\n            {hasMore && leaderboard.length > 0 && (\n              <button\n                onClick={loadMore}\n                disabled={isLoading}\n                className=\"w-full p-4 text-center text-cyan-400 hover:bg-neutral-800/50 transition-colors disabled:opacity-50 border-t border-neutral-800\"\n              >\n                {isLoading ? 'Loading...' : 'Load More'}\n              </button>\n            )}\n          </div>\n        </div>\n      </TabContent>\n\n      {/* User Profile Modal */}\n      <UserProfileModal isOpen={isModalOpen} onClose={() => setIsModalOpen(false)} />\n    </>\n  );\n}\n","numLines":265,"startLine":1,"totalLines":265}}}
{"parentUuid":"26e14e2d-03bb-449c-8e57-33804ce2d39c","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PWKmpobdk2BrrjfLMhQ4kh","type":"tool_result","content":"     1â†’'use client';\n     2â†’\n     3â†’import { useState, useCallback } from 'react';\n     4â†’import { motion, AnimatePresence } from 'framer-motion';\n     5â†’import {\n     6â†’  BookOpen,\n     7â†’  Dumbbell,\n     8â†’  Sparkles,\n     9â†’  Clock,\n    10â†’  ChevronRight,\n    11â†’  Search,\n    12â†’  Brain,\n    13â†’  Wrench,\n    14â†’  TrendingDown,\n    15â†’  Calendar,\n    16â†’  Target,\n    17â†’  Heart,\n    18â†’  Utensils,\n    19â†’  Droplet,\n    20â†’  X,\n    21â†’  ArrowLeft,\n    22â†’  MessageSquare,\n    23â†’  ExternalLink,\n    24â†’  ShoppingCart,\n    25â†’  CheckCircle2,\n    26â†’} from 'lucide-react';\n    27â†’import Image from 'next/image';\n    28â†’import Link from 'next/link';\n    29â†’import { TabContent } from '../ResultsLayout';\n    30â†’import {\n    31â†’  GUIDE_CATEGORIES,\n    32â†’  getGuidesByCategory,\n    33â†’  getTotalGuideCount,\n    34â†’  getTotalReadTime,\n    35â†’  searchGuides,\n    36â†’  getGuideProductById,\n    37â†’} from '@/data/guides';\n    38â†’import { Guide, GuideCategory, GuideMedia } from '@/types/guides';\n    39â†’import { useRegion } from '@/contexts/RegionContext';\n    40â†’import ReactMarkdown from 'react-markdown';\n    41â†’import remarkGfm from 'remark-gfm';\n    42â†’\n    43â†’// ============================================\n    44â†’// ICON MAPPING\n    45â†’// ============================================\n    46â†’\n    47â†’const ICON_MAP: Record<string, React.ReactNode> = {\n    48â†’  BookOpen: <BookOpen size={20} />,\n    49â†’  Dumbbell: <Dumbbell size={20} />,\n    50â†’  Sparkles: <Sparkles size={20} />,\n    51â†’  Brain: <Brain size={20} />,\n    52â†’  Wrench: <Wrench size={20} />,\n    53â†’  TrendingDown: <TrendingDown size={20} />,\n    54â†’  Calendar: <Calendar size={20} />,\n    55â†’  Target: <Target size={20} />,\n    56â†’  Heart: <Heart size={20} />,\n    57â†’  Utensils: <Utensils size={20} />,\n    58â†’  Droplet: <Droplet size={20} />,\n    59â†’};\n    60â†’\n    61â†’function getIconComponent(iconName: string, size = 20): React.ReactNode {\n    62â†’  // Check icon map first\n    63â†’  const mappedIcon = ICON_MAP[iconName];\n    64â†’  if (mappedIcon) return mappedIcon;\n    65â†’\n    66â†’  // Fallback to BookOpen\n    67â†’  return <BookOpen size={size} />;\n    68â†’}\n    69â†’\n    70â†’// ============================================\n    71â†’// MEDIA RENDERER\n    72â†’// ============================================\n    73â†’\n    74â†’interface MediaRendererProps {\n    75â†’  media: GuideMedia;\n    76â†’}\n    77â†’\n    78â†’function MediaRenderer({ media }: MediaRendererProps) {\n    79â†’  const [hasError, setHasError] = useState(false);\n    80â†’  const [isLoading, setIsLoading] = useState(true);\n    81â†’\n    82â†’  const handleError = useCallback(() => {\n    83â†’    setHasError(true);\n    84â†’    setIsLoading(false);\n    85â†’  }, []);\n    86â†’\n    87â†’  const handleLoad = useCallback(() => {\n    88â†’    setIsLoading(false);\n    89â†’  }, []);\n    90â†’\n    91â†’  const placementClasses = {\n    92â†’    inline: 'max-w-lg mx-auto',\n    93â†’    hero: 'w-full',\n    94â†’    'full-width': 'w-full',\n    95â†’  };\n    96â†’\n    97â†’  const isGif = media.type === 'gif' || media.url.endsWith('.gif');\n    98â†’\n    99â†’  // Show styled placeholder if image failed to load or doesn't exist\n   100â†’  if (hasError) {\n   101â†’    return (\n   102â†’      <figure className={`my-10 ${placementClasses[media.placement || 'inline']}`}>\n   103â†’        <div className=\"relative rounded-2xl overflow-hidden bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800\">\n   104â†’          <div className=\"aspect-video flex items-center justify-center p-8\">\n   105â†’            <div className=\"text-center max-w-sm\">\n   106â†’              <div className=\"w-16 h-16 bg-gradient-to-br from-cyan-500/20 to-blue-500/20 rounded-2xl flex items-center justify-center mx-auto mb-4 border border-cyan-500/20\">\n   107â†’                {isGif ? (\n   108â†’                  <div className=\"w-6 h-6 border-2 border-cyan-400 border-t-transparent rounded-full animate-spin\" />\n   109â†’                ) : (\n   110â†’                  <Sparkles size={28} className=\"text-cyan-400\" />\n   111â†’                )}\n   112â†’              </div>\n   113â†’              <p className=\"text-neutral-300 font-medium mb-2\">{media.alt}</p>\n   114â†’              {media.caption && (\n   115â†’                <p className=\"text-neutral-500 text-sm\">{media.caption}</p>\n   116â†’              )}\n   117â†’            </div>\n   118â†’          </div>\n   119â†’        </div>\n   120â†’      </figure>\n   121â†’    );\n   122â†’  }\n   123â†’\n   124â†’  return (\n   125â†’    <figure className={`my-10 ${placementClasses[media.placement || 'inline']}`}>\n   126â†’      <div className=\"relative rounded-2xl overflow-hidden bg-neutral-900 border border-neutral-800\">\n   127â†’        {/* Loading skeleton */}\n   128â†’        {isLoading && (\n   129â†’          <div className=\"absolute inset-0 bg-neutral-900 animate-pulse flex items-center justify-center\">\n   130â†’            <div className=\"w-8 h-8 border-2 border-cyan-500 border-t-transparent rounded-full animate-spin\" />\n   131â†’          </div>\n   132â†’        )}\n   133â†’\n   134â†’        {isGif ? (\n   135â†’          // Use img for GIFs to preserve animation\n   136â†’          // eslint-disable-next-line @next/next/no-img-element\n   137â†’          <img\n   138â†’            src={media.url}\n   139â†’            alt={media.alt}\n   140â†’            className={`w-full h-auto transition-opacity duration-300 ${isLoading ? 'opacity-0' : 'opacity-100'}`}\n   141â†’            loading=\"lazy\"\n   142â†’            onError={handleError}\n   143â†’            onLoad={handleLoad}\n   144â†’          />\n   145â†’        ) : (\n   146â†’          <Image\n   147â†’            src={media.url}\n   148â†’            alt={media.alt}\n   149â†’            width={media.width || 800}\n   150â†’            height={media.height || 450}\n   151â†’            className={`w-full h-auto transition-opacity duration-300 ${isLoading ? 'opacity-0' : 'opacity-100'}`}\n   152â†’            onError={handleError}\n   153â†’            onLoad={handleLoad}\n   154â†’          />\n   155â†’        )}\n   156â†’      </div>\n   157â†’      {media.caption && (\n   158â†’        <figcaption className=\"mt-4 text-center text-sm text-neutral-500 italic\">\n   159â†’          {media.caption}\n   160â†’        </figcaption>\n   161â†’      )}\n   162â†’    </figure>\n   163â†’  );\n   164â†’}\n   165â†’\n   166â†’// ============================================\n   167â†’// PRODUCT CALLOUT (CONVERSION OPTIMIZED)\n   168â†’// ============================================\n   169â†’\n   170â†’interface ProductCalloutProps {\n   171â†’  productId: string;\n   172â†’}\n   173â†’\n   174â†’function ProductCallout({ productId }: ProductCalloutProps) {\n   175â†’  const { getLink } = useRegion();\n   176â†’  const product = getGuideProductById(productId);\n   177â†’\n   178â†’  if (!product) return null;\n   179â†’\n   180â†’  const link = getLink(product.regionLinks, product.directLink);\n   181â†’\n   182â†’  return (\n   183â†’    <div className=\"my-6 p-4 bg-gradient-to-r from-cyan-500/10 to-blue-500/10 border border-cyan-500/20 rounded-xl\">\n   184â†’      <div className=\"flex items-center gap-4\">\n   185â†’        {/* Product Image */}\n   186â†’        {product.imageUrl && (\n   187â†’          <div className=\"w-16 h-16 bg-neutral-800 rounded-lg overflow-hidden flex-shrink-0\">\n   188â†’            <Image\n   189â†’              src={product.imageUrl}\n   190â†’              alt={product.name}\n   191â†’              width={64}\n   192â†’              height={64}\n   193â†’              className=\"w-full h-full object-cover\"\n   194â†’            />\n   195â†’          </div>\n   196â†’        )}\n   197â†’\n   198â†’        {/* Product Info */}\n   199â†’        <div className=\"flex-1 min-w-0\">\n   200â†’          <div className=\"flex items-center gap-2\">\n   201â†’            <h4 className=\"font-semibold text-white truncate\">{product.name}</h4>\n   202â†’            {product.brand && (\n   203â†’              <span className=\"text-xs text-neutral-500\">{product.brand}</span>\n   204â†’            )}\n   205â†’          </div>\n   206â†’          <p className=\"text-sm text-cyan-300 italic\">&ldquo;{product.tagline}&rdquo;</p>\n   207â†’        </div>\n   208â†’\n   209â†’        {/* CTA Button */}\n   210â†’        <a\n   211â†’          href={link}\n   212â†’          target=\"_blank\"\n   213â†’          rel=\"noopener noreferrer\"\n   214â†’          className=\"flex-shrink-0 flex items-center gap-2 px-4 py-2 bg-cyan-500 hover:bg-cyan-400 text-black font-medium rounded-lg transition-colors\"\n   215â†’        >\n   216â†’          <ShoppingCart size={16} />\n   217â†’          <span className=\"hidden sm:inline\">Buy Now</span>\n   218â†’        </a>\n   219â†’      </div>\n   220â†’    </div>\n   221â†’  );\n   222â†’}\n   223â†’\n   224â†’// ============================================\n   225â†’// FORUM DISCUSSION LINK\n   226â†’// ============================================\n   227â†’\n   228â†’interface ForumDiscussionLinkProps {\n   229â†’  forumCategory?: string;\n   230â†’  guideTitle: string;\n   231â†’}\n   232â†’\n   233â†’function ForumDiscussionLink({ forumCategory, guideTitle }: ForumDiscussionLinkProps) {\n   234â†’  if (!forumCategory) return null;\n   235â†’\n   236â†’  return (\n   237â†’    <div className=\"mt-8 p-6 bg-neutral-900/50 border border-neutral-800 rounded-xl\">\n   238â†’      <div className=\"flex items-center gap-3 mb-3\">\n   239â†’        <div className=\"w-10 h-10 bg-purple-500/10 rounded-xl flex items-center justify-center\">\n   240â†’          <MessageSquare size={20} className=\"text-purple-400\" />\n   241â†’        </div>\n   242â†’        <div>\n   243â†’          <h3 className=\"font-semibold text-white\">Discuss This Guide</h3>\n   244â†’          <p className=\"text-sm text-neutral-400\">Join the community conversation</p>\n   245â†’        </div>\n   246â†’      </div>\n   247â†’\n   248â†’      <p className=\"text-sm text-neutral-400 mb-4\">\n   249â†’        Have questions about {guideTitle.toLowerCase()}? Want to share your experience?\n   250â†’        Join the discussion in our community forum.\n   251â†’      </p>\n   252â†’\n   253â†’      <Link\n   254â†’        href={`/forum/${forumCategory}`}\n   255â†’        className=\"inline-flex items-center gap-2 px-4 py-2 bg-purple-500/10 hover:bg-purple-500/20 text-purple-400 border border-purple-500/30 rounded-lg transition-colors\"\n   256â†’      >\n   257â†’        <MessageSquare size={16} />\n   258â†’        Go to Forum\n   259â†’        <ExternalLink size={14} />\n   260â†’      </Link>\n   261â†’    </div>\n   262â†’  );\n   263â†’}\n   264â†’\n   265â†’// ============================================\n   266â†’// GUIDE STATS CARD\n   267â†’// ============================================\n   268â†’\n   269â†’function GuideStatsCard() {\n   270â†’  const totalGuides = getTotalGuideCount();\n   271â†’  const totalMinutes = getTotalReadTime();\n   272â†’\n   273â†’  return (\n   274â†’    <motion.div\n   275â†’      className=\"bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-2xl p-6 mb-6\"\n   276â†’      initial={{ opacity: 0, y: 20 }}\n   277â†’      animate={{ opacity: 1, y: 0 }}\n   278â†’    >\n   279â†’      <div className=\"flex items-center gap-3 mb-4\">\n   280â†’        <div className=\"w-10 h-10 bg-cyan-500/10 rounded-xl flex items-center justify-center\">\n   281â†’          <BookOpen size={20} className=\"text-cyan-400\" />\n   282â†’        </div>\n   283â†’        <div>\n   284â†’          <h2 className=\"font-semibold text-white\">Product Guides</h2>\n   285â†’          <p className=\"text-sm text-neutral-400\">Evidence-based looksmaxxing resources</p>\n   286â†’        </div>\n   287â†’      </div>\n   288â†’\n   289â†’      <div className=\"grid grid-cols-2 gap-4\">\n   290â†’        <div className=\"bg-neutral-900/50 rounded-xl p-4\">\n   291â†’          <div className=\"text-2xl font-bold text-white mb-1\">{totalGuides}</div>\n   292â†’          <div className=\"text-xs text-neutral-500\">Total Guides</div>\n   293â†’        </div>\n   294â†’        <div className=\"bg-neutral-900/50 rounded-xl p-4\">\n   295â†’          <div className=\"flex items-center gap-1.5 mb-1\">\n   296â†’            <Clock size={16} className=\"text-cyan-400\" />\n   297â†’            <div className=\"text-2xl font-bold text-white\">{totalMinutes}</div>\n   298â†’          </div>\n   299â†’          <div className=\"text-xs text-neutral-500\">Minutes of Content</div>\n   300â†’        </div>\n   301â†’      </div>\n   302â†’    </motion.div>\n   303â†’  );\n   304â†’}\n   305â†’\n   306â†’// ============================================\n   307â†’// GUIDE VIEWER MODAL\n   308â†’// ============================================\n   309â†’\n   310â†’interface GuideViewerProps {\n   311â†’  guide: Guide;\n   312â†’  onClose: () => void;\n   313â†’}\n   314â†’\n   315â†’function GuideViewer({ guide, onClose }: GuideViewerProps) {\n   316â†’  const [currentSection, setCurrentSection] = useState(0);\n   317â†’  const [isSidebarOpen, setIsSidebarOpen] = useState(false);\n   318â†’\n   319â†’  const section = guide.sections[currentSection];\n   320â†’\n   321â†’  if (!section) return null;\n   322â†’\n   323â†’  // Calculate reading progress\n   324â†’  const progress = ((currentSection + 1) / guide.sections.length) * 100;\n   325â†’\n   326â†’  return (\n   327â†’    <motion.div\n   328â†’      initial={{ opacity: 0 }}\n   329â†’      animate={{ opacity: 1 }}\n   330â†’      exit={{ opacity: 0 }}\n   331â†’      className=\"fixed inset-0 z-50 bg-neutral-950\"\n   332â†’    >\n   333â†’      {/* Header */}\n   334â†’      <div className=\"sticky top-0 z-20 bg-neutral-950/95 backdrop-blur-md border-b border-neutral-900\">\n   335â†’        <div className=\"flex items-center justify-between px-4 lg:px-8 py-3\">\n   336â†’          <button\n   337â†’            onClick={onClose}\n   338â†’            className=\"flex items-center gap-2 text-neutral-400 hover:text-white transition-colors\"\n   339â†’          >\n   340â†’            <ArrowLeft size={20} />\n   341â†’            <span className=\"hidden sm:inline text-sm\">Back to Guides</span>\n   342â†’          </button>\n   343â†’\n   344â†’          {/* Progress bar */}\n   345â†’          <div className=\"hidden md:flex items-center gap-4 flex-1 max-w-md mx-8\">\n   346â†’            <div className=\"flex-1 h-1 bg-neutral-800 rounded-full overflow-hidden\">\n   347â†’              <motion.div\n   348â†’                className=\"h-full bg-gradient-to-r from-cyan-500 to-blue-500\"\n   349â†’                initial={{ width: 0 }}\n   350â†’                animate={{ width: `${progress}%` }}\n   351â†’                transition={{ duration: 0.3 }}\n   352â†’              />\n   353â†’            </div>\n   354â†’            <span className=\"text-xs text-neutral-500 whitespace-nowrap\">\n   355â†’              {currentSection + 1} / {guide.sections.length}\n   356â†’            </span>\n   357â†’          </div>\n   358â†’\n   359â†’          <div className=\"flex items-center gap-3\">\n   360â†’            {/* Mobile menu button */}\n   361â†’            <button\n   362â†’              onClick={() => setIsSidebarOpen(!isSidebarOpen)}\n   363â†’              className=\"lg:hidden p-2 hover:bg-neutral-900 rounded-lg transition-colors\"\n   364â†’            >\n   365â†’              <BookOpen size={20} className=\"text-neutral-400\" />\n   366â†’            </button>\n   367â†’            <button\n   368â†’              onClick={onClose}\n   369â†’              className=\"p-2 hover:bg-neutral-900 rounded-lg transition-colors\"\n   370â†’            >\n   371â†’              <X size={20} className=\"text-neutral-400\" />\n   372â†’            </button>\n   373â†’          </div>\n   374â†’        </div>\n   375â†’      </div>\n   376â†’\n   377â†’      {/* Main Layout: Sidebar + Content */}\n   378â†’      <div className=\"flex h-[calc(100vh-57px)]\">\n   379â†’        {/* Sidebar Navigation */}\n   380â†’        <aside\n   381â†’          className={`\n   382â†’            fixed lg:relative inset-y-0 left-0 z-30 lg:z-0\n   383â†’            w-72 lg:w-80 bg-neutral-950 lg:bg-neutral-950/50\n   384â†’            border-r border-neutral-900\n   385â†’            transform transition-transform duration-300 ease-in-out\n   386â†’            ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}\n   387â†’            lg:flex lg:flex-col\n   388â†’            overflow-hidden\n   389â†’          `}\n   390â†’        >\n   391â†’          {/* Sidebar Header */}\n   392â†’          <div className=\"p-6 border-b border-neutral-900\">\n   393â†’            <div className=\"flex items-center gap-3 mb-3\">\n   394â†’              <div className=\"w-10 h-10 bg-gradient-to-br from-cyan-500/20 to-blue-500/20 rounded-xl flex items-center justify-center text-cyan-400\">\n   395â†’                {getIconComponent(guide.icon, 20)}\n   396â†’              </div>\n   397â†’              <div className=\"flex-1 min-w-0\">\n   398â†’                <h2 className=\"font-semibold text-white truncate\">{guide.title}</h2>\n   399â†’                <div className=\"flex items-center gap-2 text-xs text-neutral-500\">\n   400â†’                  <Clock size={12} />\n   401â†’                  <span>{guide.estimatedReadTime} min</span>\n   402â†’                </div>\n   403â†’              </div>\n   404â†’            </div>\n   405â†’            {guide.subtitle && (\n   406â†’              <p className=\"text-sm text-neutral-500 italic\">{guide.subtitle}</p>\n   407â†’            )}\n   408â†’          </div>\n   409â†’\n   410â†’          {/* Section List */}\n   411â†’          <nav className=\"flex-1 overflow-y-auto p-4\">\n   412â†’            <div className=\"text-xs font-semibold text-neutral-600 uppercase tracking-wider mb-3 px-2\">\n   413â†’              Sections\n   414â†’            </div>\n   415â†’            <ul className=\"space-y-1\">\n   416â†’              {guide.sections.map((s, idx) => (\n   417â†’                <li key={s.id}>\n   418â†’                  <button\n   419â†’                    onClick={() => {\n   420â†’                      setCurrentSection(idx);\n   421â†’                      setIsSidebarOpen(false);\n   422â†’                    }}\n   423â†’                    className={`\n   424â†’                      w-full text-left px-3 py-3 rounded-xl transition-all\n   425â†’                      flex items-start gap-3 group\n   426â†’                      ${currentSection === idx\n   427â†’                        ? 'bg-gradient-to-r from-cyan-500/10 to-blue-500/10 border border-cyan-500/20'\n   428â†’                        : 'hover:bg-neutral-900 border border-transparent'\n   429â†’                      }\n   430â†’                    `}\n   431â†’                  >\n   432â†’                    {/* Section number */}\n   433â†’                    <span\n   434â†’                      className={`\n   435â†’                        flex-shrink-0 w-6 h-6 rounded-lg text-xs font-bold\n   436â†’                        flex items-center justify-center transition-colors\n   437â†’                        ${currentSection === idx\n   438â†’                          ? 'bg-cyan-500 text-black'\n   439â†’                          : idx < currentSection\n   440â†’                            ? 'bg-green-500/20 text-green-400'\n   441â†’                            : 'bg-neutral-800 text-neutral-500 group-hover:bg-neutral-700'\n   442â†’                        }\n   443â†’                      `}\n   444â†’                    >\n   445â†’                      {idx < currentSection ? (\n   446â†’                        <CheckCircle2 size={14} />\n   447â†’                      ) : (\n   448â†’                        idx + 1\n   449â†’                      )}\n   450â†’                    </span>\n   451â†’\n   452â†’                    {/* Section info */}\n   453â†’                    <div className=\"flex-1 min-w-0\">\n   454â†’                      <p\n   455â†’                        className={`text-sm font-medium truncate ${currentSection === idx ? 'text-white' : 'text-neutral-400 group-hover:text-neutral-200'\n   456â†’                          }`}\n   457â†’                      >\n   458â†’                        {s.title}\n   459â†’                      </p>\n   460â†’                      {/* Show media indicator if section has media */}\n   461â†’                      {s.media && s.media.length > 0 && (\n   462â†’                        <div className=\"flex items-center gap-1 mt-1\">\n   463â†’                          <Sparkles size={10} className=\"text-amber-400\" />\n   464â†’                          <span className=\"text-xs text-neutral-600\">\n   465â†’                            {s.media.length} visual{s.media.length > 1 ? 's' : ''}\n   466â†’                          </span>\n   467â†’                        </div>\n   468â†’                      )}\n   469â†’                    </div>\n   470â†’                  </button>\n   471â†’                </li>\n   472â†’              ))}\n   473â†’            </ul>\n   474â†’          </nav>\n   475â†’\n   476â†’          {/* Sidebar Footer */}\n   477â†’          <div className=\"p-4 border-t border-neutral-900\">\n   478â†’            <div className=\"flex items-center justify-between text-xs text-neutral-600 mb-2\">\n   479â†’              <span>Progress</span>\n   480â†’              <span>{Math.round(progress)}%</span>\n   481â†’            </div>\n   482â†’            <div className=\"h-1.5 bg-neutral-800 rounded-full overflow-hidden\">\n   483â†’              <motion.div\n   484â†’                className=\"h-full bg-gradient-to-r from-cyan-500 to-green-500\"\n   485â†’                animate={{ width: `${progress}%` }}\n   486â†’              />\n   487â†’            </div>\n   488â†’          </div>\n   489â†’        </aside>\n   490â†’\n   491â†’        {/* Mobile sidebar overlay */}\n   492â†’        {isSidebarOpen && (\n   493â†’          <div\n   494â†’            className=\"fixed inset-0 bg-black/60 z-20 lg:hidden\"\n   495â†’            onClick={() => setIsSidebarOpen(false)}\n   496â†’          />\n   497â†’        )}\n   498â†’\n   499â†’        {/* Main Content Area */}\n   500â†’        <main className=\"flex-1 overflow-y-auto\">\n   501â†’          <article className=\"max-w-3xl mx-auto px-6 py-10 lg:py-16\">\n   502â†’            {/* Hero Media (only on first section) */}\n   503â†’            {guide.heroMedia && currentSection === 0 && (\n   504â†’              <div className=\"mb-10\">\n   505â†’                <MediaRenderer media={guide.heroMedia} />\n   506â†’              </div>\n   507â†’            )}\n   508â†’\n   509â†’            {/* Article Header (only on first section) */}\n   510â†’            {currentSection === 0 && (\n   511â†’              <header className=\"mb-12\">\n   512â†’                <div className=\"inline-flex items-center gap-2 px-3 py-1.5 bg-cyan-500/10 text-cyan-400 rounded-full text-xs font-medium mb-4\">\n   513â†’                  {getIconComponent(guide.icon, 14)}\n   514â†’                  <span className=\"uppercase tracking-wider\">Guide</span>\n   515â†’                </div>\n   516â†’\n   517â†’                <h1 className=\"text-3xl md:text-4xl font-bold text-white mb-4 leading-tight\">\n   518â†’                  {guide.title}\n   519â†’                </h1>\n   520â†’\n   521â†’                <p className=\"text-neutral-300 text-lg leading-relaxed\">\n   522â†’                  {guide.description}\n   523â†’                </p>\n   524â†’              </header>\n   525â†’            )}\n   526â†’\n   527â†’            {/* Section Content */}\n   528â†’            <AnimatePresence mode=\"wait\">\n   529â†’              <motion.section\n   530â†’                key={section.id}\n   531â†’                initial={{ opacity: 0, x: 20 }}\n   532â†’                animate={{ opacity: 1, x: 0 }}\n   533â†’                exit={{ opacity: 0, x: -20 }}\n   534â†’                transition={{ duration: 0.3 }}\n   535â†’              >\n   536â†’                {/* Section Title */}\n   537â†’                <h2 className=\"text-2xl md:text-3xl font-bold text-white mb-8 pb-4 border-b border-neutral-900\">\n   538â†’                  {section.title}\n   539â†’                </h2>\n   540â†’\n   541â†’                {/* Tips Callout */}\n   542â†’                {section.tips && section.tips.length > 0 && (\n   543â†’                  <aside className=\"mb-10 p-6 bg-gradient-to-br from-cyan-500/5 to-cyan-600/5 border-l-4 border-cyan-500 rounded-r-xl\">\n   544â†’                    <h4 className=\"text-sm font-semibold text-cyan-400 uppercase tracking-wider mb-4\">\n   545â†’                      Quick Tips\n   546â†’                    </h4>\n   547â†’                    <ul className=\"space-y-3\">\n   548â†’                      {section.tips.map((tip, i) => (\n   549â†’                        <li key={i} className=\"flex items-start gap-3 text-neutral-300\">\n   550â†’                          <span className=\"flex-shrink-0 w-5 h-5 bg-cyan-500/20 rounded-full flex items-center justify-center mt-0.5\">\n   551â†’                            <span className=\"text-cyan-400 text-xs font-bold\">{i + 1}</span>\n   552â†’                          </span>\n   553â†’                          <span className=\"leading-relaxed\">{tip}</span>\n   554â†’                        </li>\n   555â†’                      ))}\n   556â†’                    </ul>\n   557â†’                  </aside>\n   558â†’                )}\n   559â†’\n   560â†’                {/* Warnings Callout */}\n   561â†’                {section.warnings && section.warnings.length > 0 && (\n   562â†’                  <aside className=\"mb-10 p-6 bg-gradient-to-br from-amber-500/5 to-amber-600/5 border-l-4 border-amber-500 rounded-r-xl\">\n   563â†’                    <h4 className=\"text-sm font-semibold text-amber-400 uppercase tracking-wider mb-4\">\n   564â†’                      âš ï¸ Important\n   565â†’                    </h4>\n   566â†’                    <ul className=\"space-y-3\">\n   567â†’                      {section.warnings.map((warning, i) => (\n   568â†’                        <li key={i} className=\"flex items-start gap-3 text-neutral-300\">\n   569â†’                          <span className=\"text-amber-400 mt-1\">â€¢</span>\n   570â†’                          <span className=\"leading-relaxed\">{warning}</span>\n   571â†’                        </li>\n   572â†’                      ))}\n   573â†’                    </ul>\n   574â†’                  </aside>\n   575â†’                )}\n   576â†’\n   577â†’                {/* Hero Media for Section */}\n   578â†’                {section.media && section.media.filter(m => m.placement === 'hero').map(media => (\n   579â†’                  <div key={media.id} className=\"mb-10\">\n   580â†’                    <MediaRenderer media={media} />\n   581â†’                  </div>\n   582â†’                ))}\n   583â†’\n   584â†’                {/* Article Body - Custom Markdown Rendering */}\n   585â†’                <div className=\"article-content\">\n   586â†’                  <ReactMarkdown\n   587â†’                    remarkPlugins={[remarkGfm]}\n   588â†’                    components={{\n   589â†’                      // Paragraphs with generous spacing\n   590â†’                      p: ({ children }) => (\n   591â†’                        <p className=\"text-neutral-300 text-lg leading-[1.8] mb-6\">\n   592â†’                          {children}\n   593â†’                        </p>\n   594â†’                      ),\n   595â†’                      // Headers with clear hierarchy\n   596â†’                      h1: ({ children }) => (\n   597â†’                        <h1 className=\"text-2xl font-bold text-white mt-12 mb-6\">\n   598â†’                          {children}\n   599â†’                        </h1>\n   600â†’                      ),\n   601â†’                      h2: ({ children }) => (\n   602â†’                        <h2 className=\"text-xl font-bold text-white mt-10 mb-5 pb-3 border-b border-neutral-800\">\n   603â†’                          {children}\n   604â†’                        </h2>\n   605â†’                      ),\n   606â†’                      h3: ({ children }) => (\n   607â†’                        <h3 className=\"text-lg font-semibold text-white mt-8 mb-4\">\n   608â†’                          {children}\n   609â†’                        </h3>\n   610â†’                      ),\n   611â†’                      // Strong text\n   612â†’                      strong: ({ children }) => (\n   613â†’                        <strong className=\"font-semibold text-white\">\n   614â†’                          {children}\n   615â†’                        </strong>\n   616â†’                      ),\n   617â†’                      // Emphasis\n   618â†’                      em: ({ children }) => (\n   619â†’                        <em className=\"text-neutral-400 not-italic\">\n   620â†’                          {children}\n   621â†’                        </em>\n   622â†’                      ),\n   623â†’                      // Lists with proper spacing\n   624â†’                      ul: ({ children }) => (\n   625â†’                        <ul className=\"my-6 ml-0 space-y-3\">\n   626â†’                          {children}\n   627â†’                        </ul>\n   628â†’                      ),\n   629â†’                      ol: ({ children }) => (\n   630â†’                        <ol className=\"my-6 ml-0 space-y-3 list-decimal list-inside\">\n   631â†’                          {children}\n   632â†’                        </ol>\n   633â†’                      ),\n   634â†’                      li: ({ children }) => (\n   635â†’                        <li className=\"text-neutral-300 text-lg leading-[1.8] flex items-start gap-3\">\n   636â†’                          <span className=\"text-cyan-500 mt-1.5 flex-shrink-0\">â€¢</span>\n   637â†’                          <span>{children}</span>\n   638â†’                        </li>\n   639â†’                      ),\n   640â†’                      // Tables - styled beautifully\n   641â†’                      table: ({ children }) => (\n   642â†’                        <div className=\"my-8 overflow-x-auto rounded-xl border border-neutral-800\">\n   643â†’                          <table className=\"w-full text-left\">\n   644â†’                            {children}\n   645â†’                          </table>\n   646â†’                        </div>\n   647â†’                      ),\n   648â†’                      thead: ({ children }) => (\n   649â†’                        <thead className=\"bg-neutral-900/80 border-b border-neutral-800\">\n   650â†’                          {children}\n   651â†’                        </thead>\n   652â†’                      ),\n   653â†’                      tbody: ({ children }) => (\n   654â†’                        <tbody className=\"divide-y divide-neutral-800/50\">\n   655â†’                          {children}\n   656â†’                        </tbody>\n   657â†’                      ),\n   658â†’                      tr: ({ children }) => (\n   659â†’                        <tr className=\"hover:bg-neutral-900/50 transition-colors\">\n   660â†’                          {children}\n   661â†’                        </tr>\n   662â†’                      ),\n   663â†’                      th: ({ children }) => (\n   664â†’                        <th className=\"px-4 py-3 text-sm font-semibold text-cyan-400 uppercase tracking-wider\">\n   665â†’                          {children}\n   666â†’                        </th>\n   667â†’                      ),\n   668â†’                      td: ({ children }) => (\n   669â†’                        <td className=\"px-4 py-3 text-neutral-300\">\n   670â†’                          {children}\n   671â†’                        </td>\n   672â†’                      ),\n   673â†’                      // Blockquotes\n   674â†’                      blockquote: ({ children }) => (\n   675â†’                        <blockquote className=\"my-8 pl-6 border-l-4 border-cyan-500 bg-neutral-900/50 py-4 pr-6 rounded-r-lg\">\n   676â†’                          {children}\n   677â†’                        </blockquote>\n   678â†’                      ),\n   679â†’                      // Code\n   680â†’                      code: ({ children }) => (\n   681â†’                        <code className=\"text-cyan-400 bg-neutral-900 px-2 py-1 rounded text-base\">\n   682â†’                          {children}\n   683â†’                        </code>\n   684â†’                      ),\n   685â†’                      // Links\n   686â†’                      a: ({ href, children }) => (\n   687â†’                        <a\n   688â†’                          href={href}\n   689â†’                          className=\"text-cyan-400 hover:text-cyan-300 underline underline-offset-4 decoration-cyan-500/30 hover:decoration-cyan-400 transition-colors\"\n   690â†’                          target=\"_blank\"\n   691â†’                          rel=\"noopener noreferrer\"\n   692â†’                        >\n   693â†’                          {children}\n   694â†’                        </a>\n   695â†’                      ),\n   696â†’                      // Horizontal rule\n   697â†’                      hr: () => (\n   698â†’                        <hr className=\"my-10 border-neutral-800\" />\n   699â†’                      ),\n   700â†’                    }}\n   701â†’                  >\n   702â†’                    {section.content}\n   703â†’                  </ReactMarkdown>\n   704â†’                </div>\n   705â†’\n   706â†’                {/* Inline Media */}\n   707â†’                {section.media && section.media.filter(m => m.placement !== 'hero').map(media => (\n   708â†’                  <div key={media.id} className=\"my-10\">\n   709â†’                    <MediaRenderer media={media} />\n   710â†’                  </div>\n   711â†’                ))}\n   712â†’\n   713â†’                {/* Product Recommendations */}\n   714â†’                {section.products && section.products.length > 0 && (\n   715â†’                  <div className=\"mt-12 pt-8 border-t border-neutral-900\">\n   716â†’                    <h4 className=\"text-sm font-semibold text-neutral-400 uppercase tracking-wider mb-6\">\n   717â†’                      Recommended Products\n   718â†’                    </h4>\n   719â†’                    <div className=\"space-y-4\">\n   720â†’                      {section.products.map(productId => (\n   721â†’                        <ProductCallout key={productId} productId={productId} />\n   722â†’                      ))}\n   723â†’                    </div>\n   724â†’                  </div>\n   725â†’                )}\n   726â†’\n   727â†’                {/* Section Navigation */}\n   728â†’                <nav className=\"flex items-center justify-between mt-16 pt-8 border-t border-neutral-900\">\n   729â†’                  <button\n   730â†’                    onClick={() => setCurrentSection(Math.max(0, currentSection - 1))}\n   731â†’                    disabled={currentSection === 0}\n   732â†’                    className={`flex items-center gap-3 group transition-all ${currentSection === 0\n   733â†’                      ? 'text-neutral-700 cursor-not-allowed'\n   734â†’                      : 'text-neutral-400 hover:text-white'\n   735â†’                      }`}\n   736â†’                  >\n   737â†’                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center transition-colors ${currentSection === 0 ? 'bg-neutral-900' : 'bg-neutral-900 group-hover:bg-neutral-800'\n   738â†’                      }`}>\n   739â†’                      <ArrowLeft size={20} />\n   740â†’                    </div>\n   741â†’                    <div className=\"hidden sm:block text-left\">\n   742â†’                      <div className=\"text-xs text-neutral-600 uppercase tracking-wider mb-1\">Previous</div>\n   743â†’                      {currentSection > 0 && (\n   744â†’                        <div className=\"text-sm font-medium text-neutral-300\">{guide.sections[currentSection - 1].title}</div>\n   745â†’                      )}\n   746â†’                    </div>\n   747â†’                  </button>\n   748â†’\n   749â†’                  <button\n   750â†’                    onClick={() => setCurrentSection(Math.min(guide.sections.length - 1, currentSection + 1))}\n   751â†’                    disabled={currentSection === guide.sections.length - 1}\n   752â†’                    className={`flex items-center gap-3 group transition-all ${currentSection === guide.sections.length - 1\n   753â†’                      ? 'text-neutral-700 cursor-not-allowed'\n   754â†’                      : 'text-neutral-400 hover:text-white'\n   755â†’                      }`}\n   756â†’                  >\n   757â†’                    <div className=\"hidden sm:block text-right\">\n   758â†’                      <div className=\"text-xs text-neutral-600 uppercase tracking-wider mb-1\">Next</div>\n   759â†’                      {currentSection < guide.sections.length - 1 && (\n   760â†’                        <div className=\"text-sm font-medium text-neutral-300\">{guide.sections[currentSection + 1].title}</div>\n   761â†’                      )}\n   762â†’                    </div>\n   763â†’                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center transition-colors ${currentSection === guide.sections.length - 1\n   764â†’                      ? 'bg-neutral-900'\n   765â†’                      : 'bg-gradient-to-r from-cyan-500/20 to-blue-500/20 group-hover:from-cyan-500/30 group-hover:to-blue-500/30'\n   766â†’                      }`}>\n   767â†’                      <ChevronRight size={20} className={currentSection === guide.sections.length - 1 ? '' : 'text-cyan-400'} />\n   768â†’                    </div>\n   769â†’                  </button>\n   770â†’                </nav>\n   771â†’              </motion.section>\n   772â†’            </AnimatePresence>\n   773â†’\n   774â†’            {/* Forum Discussion Link (after last section) */}\n   775â†’            {currentSection === guide.sections.length - 1 && (\n   776â†’              <div className=\"mt-16\">\n   777â†’                <ForumDiscussionLink\n   778â†’                  forumCategory={guide.forumCategory}\n   779â†’                  guideTitle={guide.title}\n   780â†’                />\n   781â†’              </div>\n   782â†’            )}\n   783â†’          </article>\n   784â†’        </main>\n   785â†’      </div>\n   786â†’    </motion.div>\n   787â†’  );\n   788â†’}\n   789â†’\n   790â†’// ============================================\n   791â†’// GUIDE CARD\n   792â†’// ============================================\n   793â†’\n   794â†’interface GuideCardProps {\n   795â†’  guide: Guide;\n   796â†’  index: number;\n   797â†’  onOpen: (guide: Guide) => void;\n   798â†’}\n   799â†’\n   800â†’function GuideCard({ guide, index, onOpen }: GuideCardProps) {\n   801â†’  const getCategoryColor = (guideId: string) => {\n   802â†’    const category = GUIDE_CATEGORIES.find(c => c.guideIds.includes(guideId));\n   803â†’    if (!category) return 'cyan';\n   804â†’    const colorMap: Record<string, string> = {\n   805â†’      blue: 'cyan',\n   806â†’      purple: 'purple',\n   807â†’      amber: 'amber',\n   808â†’    };\n   809â†’    return colorMap[category.color] || 'cyan';\n   810â†’  };\n   811â†’\n   812â†’  const color = getCategoryColor(guide.id);\n   813â†’\n   814â†’  const colorClasses = {\n   815â†’    cyan: 'from-cyan-500/10 to-cyan-600/10 border-cyan-500/20 text-cyan-400',\n   816â†’    purple: 'from-purple-500/10 to-purple-600/10 border-purple-500/20 text-purple-400',\n   817â†’    amber: 'from-amber-500/10 to-amber-600/10 border-amber-500/20 text-amber-400',\n   818â†’  };\n   819â†’\n   820â†’  const iconColorClasses = {\n   821â†’    cyan: 'bg-cyan-500/10 text-cyan-400',\n   822â†’    purple: 'bg-purple-500/10 text-purple-400',\n   823â†’    amber: 'bg-amber-500/10 text-amber-400',\n   824â†’  };\n   825â†’\n   826â†’  return (\n   827â†’    <motion.div\n   828â†’      onClick={() => onOpen(guide)}\n   829â†’      className={`bg-gradient-to-br ${colorClasses[color as keyof typeof colorClasses]} border rounded-xl p-5 hover:border-opacity-50 transition-all cursor-pointer group`}\n   830â†’      initial={{ opacity: 0, y: 20 }}\n   831â†’      animate={{ opacity: 1, y: 0 }}\n   832â†’      transition={{ delay: index * 0.05 }}\n   833â†’      whileHover={{ y: -2 }}\n   834â†’    >\n   835â†’      <div className=\"flex items-start justify-between mb-3\">\n   836â†’        <div className={`w-10 h-10 ${iconColorClasses[color as keyof typeof iconColorClasses]} rounded-xl flex items-center justify-center`}>\n   837â†’          {getIconComponent(guide.icon)}\n   838â†’        </div>\n   839â†’        <div className=\"flex items-center gap-1 text-neutral-500 text-xs\">\n   840â†’          <Clock size={12} />\n   841â†’          <span>{guide.estimatedReadTime} min</span>\n   842â†’        </div>\n   843â†’      </div>\n   844â†’\n   845â†’      <h3 className=\"font-semibold text-white mb-1 group-hover:text-cyan-300 transition-colors\">\n   846â†’        {guide.title}\n   847â†’      </h3>\n   848â†’\n   849â†’      {guide.subtitle && (\n   850â†’        <p className=\"text-xs text-neutral-400 mb-2 italic\">{guide.subtitle}</p>\n   851â†’      )}\n   852â†’\n   853â†’      <p className=\"text-sm text-neutral-400 mb-3 line-clamp-2\">{guide.description}</p>\n   854â†’\n   855â†’      <div className=\"flex items-center justify-between\">\n   856â†’        <div className=\"flex items-center gap-1 text-xs text-neutral-500\">\n   857â†’          <span>{guide.sections.length} sections</span>\n   858â†’          {guide.productIds && guide.productIds.length > 0 && (\n   859â†’            <>\n   860â†’              <span>-</span>\n   861â†’              <span>{guide.productIds.length} products</span>\n   862â†’            </>\n   863â†’          )}\n   864â†’        </div>\n   865â†’        <ChevronRight size={16} className=\"text-neutral-600 group-hover:text-cyan-400 transition-colors\" />\n   866â†’      </div>\n   867â†’    </motion.div>\n   868â†’  );\n   869â†’}\n   870â†’\n   871â†’// ============================================\n   872â†’// CATEGORY SECTION\n   873â†’// ============================================\n   874â†’\n   875â†’interface CategorySectionProps {\n   876â†’  category: GuideCategory;\n   877â†’  onOpenGuide: (guide: Guide) => void;\n   878â†’}\n   879â†’\n   880â†’function CategorySection({ category, onOpenGuide }: CategorySectionProps) {\n   881â†’  const guides = getGuidesByCategory(category.id);\n   882â†’\n   883â†’  if (guides.length === 0) return null;\n   884â†’\n   885â†’  const colorClasses = {\n   886â†’    blue: 'text-cyan-400 bg-cyan-500/10',\n   887â†’    purple: 'text-purple-400 bg-purple-500/10',\n   888â†’    amber: 'text-amber-400 bg-amber-500/10',\n   889â†’  };\n   890â†’\n   891â†’  return (\n   892â†’    <div className=\"mb-8\">\n   893â†’      <div className=\"flex items-center gap-3 mb-4\">\n   894â†’        <div className={`w-8 h-8 ${colorClasses[category.color as keyof typeof colorClasses]} rounded-lg flex items-center justify-center`}>\n   895â†’          {getIconComponent(category.icon)}\n   896â†’        </div>\n   897â†’        <div>\n   898â†’          <h3 className=\"font-semibold text-white\">{category.name}</h3>\n   899â†’          <p className=\"text-xs text-neutral-500\">{category.description}</p>\n   900â†’        </div>\n   901â†’      </div>\n   902â†’\n   903â†’      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n   904â†’        {guides.map((guide, idx) => (\n   905â†’          <GuideCard key={guide.id} guide={guide} index={idx} onOpen={onOpenGuide} />\n   906â†’        ))}\n   907â†’      </div>\n   908â†’    </div>\n   909â†’  );\n   910â†’}\n   911â†’\n   912â†’// ============================================\n   913â†’// SEARCH BAR\n   914â†’// ============================================\n   915â†’\n   916â†’interface SearchBarProps {\n   917â†’  query: string;\n   918â†’  onQueryChange: (query: string) => void;\n   919â†’}\n   920â†’\n   921â†’function SearchBar({ query, onQueryChange }: SearchBarProps) {\n   922â†’  return (\n   923â†’    <div className=\"relative mb-6\">\n   924â†’      <Search size={18} className=\"absolute left-4 top-1/2 -translate-y-1/2 text-neutral-500\" />\n   925â†’      <input\n   926â†’        type=\"text\"\n   927â†’        placeholder=\"Search guides...\"\n   928â†’        value={query}\n   929â†’        onChange={(e) => onQueryChange(e.target.value)}\n   930â†’        className=\"w-full bg-neutral-900 border border-neutral-800 rounded-xl pl-11 pr-4 py-3 text-white placeholder:text-neutral-500 focus:outline-none focus:border-cyan-500/50 transition-colors\"\n   931â†’      />\n   932â†’    </div>\n   933â†’  );\n   934â†’}\n   935â†’\n   936â†’// ============================================\n   937â†’// MAIN TAB COMPONENT\n   938â†’// ============================================\n   939â†’\n   940â†’export function GuidesTab() {\n   941â†’  const [searchQuery, setSearchQuery] = useState('');\n   942â†’  const [selectedGuide, setSelectedGuide] = useState<Guide | null>(null);\n   943â†’\n   944â†’  const filteredGuides = searchQuery.trim()\n   945â†’    ? searchGuides(searchQuery)\n   946â†’    : null;\n   947â†’\n   948â†’  const handleOpenGuide = (guide: Guide) => {\n   949â†’    setSelectedGuide(guide);\n   950â†’  };\n   951â†’\n   952â†’  const handleCloseGuide = () => {\n   953â†’    setSelectedGuide(null);\n   954â†’  };\n   955â†’\n   956â†’  return (\n   957â†’    <>\n   958â†’      <TabContent\n   959â†’        title=\"Product Guides\"\n   960â†’        subtitle=\"Evidence-based guides for optimal results\"\n   961â†’      >\n   962â†’        <div className=\"max-w-5xl mx-auto\">\n   963â†’          <GuideStatsCard />\n   964â†’\n   965â†’          <SearchBar query={searchQuery} onQueryChange={setSearchQuery} />\n   966â†’\n   967â†’          {filteredGuides ? (\n   968â†’            // Search Results\n   969â†’            <div>\n   970â†’              <p className=\"text-sm text-neutral-400 mb-4\">\n   971â†’                Found {filteredGuides.length} guide{filteredGuides.length !== 1 ? 's' : ''} matching &ldquo;{searchQuery}&rdquo;\n   972â†’              </p>\n   973â†’              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n   974â†’                {filteredGuides.map((guide, idx) => (\n   975â†’                  <GuideCard key={guide.id} guide={guide} index={idx} onOpen={handleOpenGuide} />\n   976â†’                ))}\n   977â†’              </div>\n   978â†’              {filteredGuides.length === 0 && (\n   979â†’                <div className=\"text-center py-12\">\n   980â†’                  <div className=\"w-16 h-16 bg-neutral-900 rounded-full flex items-center justify-center mx-auto mb-4\">\n   981â†’                    <Search size={24} className=\"text-neutral-600\" />\n   982â†’                  </div>\n   983â†’                  <p className=\"text-neutral-500\">No guides found matching your search</p>\n   984â†’                </div>\n   985â†’              )}\n   986â†’            </div>\n   987â†’          ) : (\n   988â†’            // Category View\n   989â†’            <div>\n   990â†’              {GUIDE_CATEGORIES.map(category => (\n   991â†’                <CategorySection key={category.id} category={category} onOpenGuide={handleOpenGuide} />\n   992â†’              ))}\n   993â†’            </div>\n   994â†’          )}\n   995â†’        </div>\n   996â†’      </TabContent>\n   997â†’\n   998â†’      {/* Guide Viewer Modal */}\n   999â†’      <AnimatePresence>\n  1000â†’        {selectedGuide && (\n  1001â†’          <GuideViewer guide={selectedGuide} onClose={handleCloseGuide} />\n  1002â†’        )}\n  1003â†’      </AnimatePresence>\n  1004â†’    </>\n  1005â†’  );\n  1006â†’}\n  1007â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"15a87c1b-ac91-4f6d-b5a1-6a9fd0f3225f","timestamp":"2025-12-26T13:41:40.690Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/GuidesTab.tsx","content":"'use client';\n\nimport { useState, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  BookOpen,\n  Dumbbell,\n  Sparkles,\n  Clock,\n  ChevronRight,\n  Search,\n  Brain,\n  Wrench,\n  TrendingDown,\n  Calendar,\n  Target,\n  Heart,\n  Utensils,\n  Droplet,\n  X,\n  ArrowLeft,\n  MessageSquare,\n  ExternalLink,\n  ShoppingCart,\n  CheckCircle2,\n} from 'lucide-react';\nimport Image from 'next/image';\nimport Link from 'next/link';\nimport { TabContent } from '../ResultsLayout';\nimport {\n  GUIDE_CATEGORIES,\n  getGuidesByCategory,\n  getTotalGuideCount,\n  getTotalReadTime,\n  searchGuides,\n  getGuideProductById,\n} from '@/data/guides';\nimport { Guide, GuideCategory, GuideMedia } from '@/types/guides';\nimport { useRegion } from '@/contexts/RegionContext';\nimport ReactMarkdown from 'react-markdown';\nimport remarkGfm from 'remark-gfm';\n\n// ============================================\n// ICON MAPPING\n// ============================================\n\nconst ICON_MAP: Record<string, React.ReactNode> = {\n  BookOpen: <BookOpen size={20} />,\n  Dumbbell: <Dumbbell size={20} />,\n  Sparkles: <Sparkles size={20} />,\n  Brain: <Brain size={20} />,\n  Wrench: <Wrench size={20} />,\n  TrendingDown: <TrendingDown size={20} />,\n  Calendar: <Calendar size={20} />,\n  Target: <Target size={20} />,\n  Heart: <Heart size={20} />,\n  Utensils: <Utensils size={20} />,\n  Droplet: <Droplet size={20} />,\n};\n\nfunction getIconComponent(iconName: string, size = 20): React.ReactNode {\n  // Check icon map first\n  const mappedIcon = ICON_MAP[iconName];\n  if (mappedIcon) return mappedIcon;\n\n  // Fallback to BookOpen\n  return <BookOpen size={size} />;\n}\n\n// ============================================\n// MEDIA RENDERER\n// ============================================\n\ninterface MediaRendererProps {\n  media: GuideMedia;\n}\n\nfunction MediaRenderer({ media }: MediaRendererProps) {\n  const [hasError, setHasError] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n\n  const handleError = useCallback(() => {\n    setHasError(true);\n    setIsLoading(false);\n  }, []);\n\n  const handleLoad = useCallback(() => {\n    setIsLoading(false);\n  }, []);\n\n  const placementClasses = {\n    inline: 'max-w-lg mx-auto',\n    hero: 'w-full',\n    'full-width': 'w-full',\n  };\n\n  const isGif = media.type === 'gif' || media.url.endsWith('.gif');\n\n  // Show styled placeholder if image failed to load or doesn't exist\n  if (hasError) {\n    return (\n      <figure className={`my-10 ${placementClasses[media.placement || 'inline']}`}>\n        <div className=\"relative rounded-2xl overflow-hidden bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800\">\n          <div className=\"aspect-video flex items-center justify-center p-8\">\n            <div className=\"text-center max-w-sm\">\n              <div className=\"w-16 h-16 bg-gradient-to-br from-cyan-500/20 to-blue-500/20 rounded-2xl flex items-center justify-center mx-auto mb-4 border border-cyan-500/20\">\n                {isGif ? (\n                  <div className=\"w-6 h-6 border-2 border-cyan-400 border-t-transparent rounded-full animate-spin\" />\n                ) : (\n                  <Sparkles size={28} className=\"text-cyan-400\" />\n                )}\n              </div>\n              <p className=\"text-neutral-300 font-medium mb-2\">{media.alt}</p>\n              {media.caption && (\n                <p className=\"text-neutral-500 text-sm\">{media.caption}</p>\n              )}\n            </div>\n          </div>\n        </div>\n      </figure>\n    );\n  }\n\n  return (\n    <figure className={`my-10 ${placementClasses[media.placement || 'inline']}`}>\n      <div className=\"relative rounded-2xl overflow-hidden bg-neutral-900 border border-neutral-800\">\n        {/* Loading skeleton */}\n        {isLoading && (\n          <div className=\"absolute inset-0 bg-neutral-900 animate-pulse flex items-center justify-center\">\n            <div className=\"w-8 h-8 border-2 border-cyan-500 border-t-transparent rounded-full animate-spin\" />\n          </div>\n        )}\n\n        {isGif ? (\n          // Use img for GIFs to preserve animation\n          // eslint-disable-next-line @next/next/no-img-element\n          <img\n            src={media.url}\n            alt={media.alt}\n            className={`w-full h-auto transition-opacity duration-300 ${isLoading ? 'opacity-0' : 'opacity-100'}`}\n            loading=\"lazy\"\n            onError={handleError}\n            onLoad={handleLoad}\n          />\n        ) : (\n          <Image\n            src={media.url}\n            alt={media.alt}\n            width={media.width || 800}\n            height={media.height || 450}\n            className={`w-full h-auto transition-opacity duration-300 ${isLoading ? 'opacity-0' : 'opacity-100'}`}\n            onError={handleError}\n            onLoad={handleLoad}\n          />\n        )}\n      </div>\n      {media.caption && (\n        <figcaption className=\"mt-4 text-center text-sm text-neutral-500 italic\">\n          {media.caption}\n        </figcaption>\n      )}\n    </figure>\n  );\n}\n\n// ============================================\n// PRODUCT CALLOUT (CONVERSION OPTIMIZED)\n// ============================================\n\ninterface ProductCalloutProps {\n  productId: string;\n}\n\nfunction ProductCallout({ productId }: ProductCalloutProps) {\n  const { getLink } = useRegion();\n  const product = getGuideProductById(productId);\n\n  if (!product) return null;\n\n  const link = getLink(product.regionLinks, product.directLink);\n\n  return (\n    <div className=\"my-6 p-4 bg-gradient-to-r from-cyan-500/10 to-blue-500/10 border border-cyan-500/20 rounded-xl\">\n      <div className=\"flex items-center gap-4\">\n        {/* Product Image */}\n        {product.imageUrl && (\n          <div className=\"w-16 h-16 bg-neutral-800 rounded-lg overflow-hidden flex-shrink-0\">\n            <Image\n              src={product.imageUrl}\n              alt={product.name}\n              width={64}\n              height={64}\n              className=\"w-full h-full object-cover\"\n            />\n          </div>\n        )}\n\n        {/* Product Info */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2\">\n            <h4 className=\"font-semibold text-white truncate\">{product.name}</h4>\n            {product.brand && (\n              <span className=\"text-xs text-neutral-500\">{product.brand}</span>\n            )}\n          </div>\n          <p className=\"text-sm text-cyan-300 italic\">&ldquo;{product.tagline}&rdquo;</p>\n        </div>\n\n        {/* CTA Button */}\n        <a\n          href={link}\n          target=\"_blank\"\n          rel=\"noopener noreferrer\"\n          className=\"flex-shrink-0 flex items-center gap-2 px-4 py-2 bg-cyan-500 hover:bg-cyan-400 text-black font-medium rounded-lg transition-colors\"\n        >\n          <ShoppingCart size={16} />\n          <span className=\"hidden sm:inline\">Buy Now</span>\n        </a>\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// FORUM DISCUSSION LINK\n// ============================================\n\ninterface ForumDiscussionLinkProps {\n  forumCategory?: string;\n  guideTitle: string;\n}\n\nfunction ForumDiscussionLink({ forumCategory, guideTitle }: ForumDiscussionLinkProps) {\n  if (!forumCategory) return null;\n\n  return (\n    <div className=\"mt-8 p-6 bg-neutral-900/50 border border-neutral-800 rounded-xl\">\n      <div className=\"flex items-center gap-3 mb-3\">\n        <div className=\"w-10 h-10 bg-purple-500/10 rounded-xl flex items-center justify-center\">\n          <MessageSquare size={20} className=\"text-purple-400\" />\n        </div>\n        <div>\n          <h3 className=\"font-semibold text-white\">Discuss This Guide</h3>\n          <p className=\"text-sm text-neutral-400\">Join the community conversation</p>\n        </div>\n      </div>\n\n      <p className=\"text-sm text-neutral-400 mb-4\">\n        Have questions about {guideTitle.toLowerCase()}? Want to share your experience?\n        Join the discussion in our community forum.\n      </p>\n\n      <Link\n        href={`/forum/${forumCategory}`}\n        className=\"inline-flex items-center gap-2 px-4 py-2 bg-purple-500/10 hover:bg-purple-500/20 text-purple-400 border border-purple-500/30 rounded-lg transition-colors\"\n      >\n        <MessageSquare size={16} />\n        Go to Forum\n        <ExternalLink size={14} />\n      </Link>\n    </div>\n  );\n}\n\n// ============================================\n// GUIDE STATS CARD\n// ============================================\n\nfunction GuideStatsCard() {\n  const totalGuides = getTotalGuideCount();\n  const totalMinutes = getTotalReadTime();\n\n  return (\n    <motion.div\n      className=\"bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-2xl p-6 mb-6\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-center gap-3 mb-4\">\n        <div className=\"w-10 h-10 bg-cyan-500/10 rounded-xl flex items-center justify-center\">\n          <BookOpen size={20} className=\"text-cyan-400\" />\n        </div>\n        <div>\n          <h2 className=\"font-semibold text-white\">Product Guides</h2>\n          <p className=\"text-sm text-neutral-400\">Evidence-based looksmaxxing resources</p>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4\">\n        <div className=\"bg-neutral-900/50 rounded-xl p-4\">\n          <div className=\"text-2xl font-bold text-white mb-1\">{totalGuides}</div>\n          <div className=\"text-xs text-neutral-500\">Total Guides</div>\n        </div>\n        <div className=\"bg-neutral-900/50 rounded-xl p-4\">\n          <div className=\"flex items-center gap-1.5 mb-1\">\n            <Clock size={16} className=\"text-cyan-400\" />\n            <div className=\"text-2xl font-bold text-white\">{totalMinutes}</div>\n          </div>\n          <div className=\"text-xs text-neutral-500\">Minutes of Content</div>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// GUIDE VIEWER MODAL\n// ============================================\n\ninterface GuideViewerProps {\n  guide: Guide;\n  onClose: () => void;\n}\n\nfunction GuideViewer({ guide, onClose }: GuideViewerProps) {\n  const [currentSection, setCurrentSection] = useState(0);\n  const [isSidebarOpen, setIsSidebarOpen] = useState(false);\n\n  const section = guide.sections[currentSection];\n\n  if (!section) return null;\n\n  // Calculate reading progress\n  const progress = ((currentSection + 1) / guide.sections.length) * 100;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      exit={{ opacity: 0 }}\n      className=\"fixed inset-0 z-50 bg-neutral-950\"\n    >\n      {/* Header */}\n      <div className=\"sticky top-0 z-20 bg-neutral-950/95 backdrop-blur-md border-b border-neutral-900\">\n        <div className=\"flex items-center justify-between px-4 lg:px-8 py-3\">\n          <button\n            onClick={onClose}\n            className=\"flex items-center gap-2 text-neutral-400 hover:text-white transition-colors\"\n          >\n            <ArrowLeft size={20} />\n            <span className=\"hidden sm:inline text-sm\">Back to Guides</span>\n          </button>\n\n          {/* Progress bar */}\n          <div className=\"hidden md:flex items-center gap-4 flex-1 max-w-md mx-8\">\n            <div className=\"flex-1 h-1 bg-neutral-800 rounded-full overflow-hidden\">\n              <motion.div\n                className=\"h-full bg-gradient-to-r from-cyan-500 to-blue-500\"\n                initial={{ width: 0 }}\n                animate={{ width: `${progress}%` }}\n                transition={{ duration: 0.3 }}\n              />\n            </div>\n            <span className=\"text-xs text-neutral-500 whitespace-nowrap\">\n              {currentSection + 1} / {guide.sections.length}\n            </span>\n          </div>\n\n          <div className=\"flex items-center gap-3\">\n            {/* Mobile menu button */}\n            <button\n              onClick={() => setIsSidebarOpen(!isSidebarOpen)}\n              className=\"lg:hidden p-2 hover:bg-neutral-900 rounded-lg transition-colors\"\n            >\n              <BookOpen size={20} className=\"text-neutral-400\" />\n            </button>\n            <button\n              onClick={onClose}\n              className=\"p-2 hover:bg-neutral-900 rounded-lg transition-colors\"\n            >\n              <X size={20} className=\"text-neutral-400\" />\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Main Layout: Sidebar + Content */}\n      <div className=\"flex h-[calc(100vh-57px)]\">\n        {/* Sidebar Navigation */}\n        <aside\n          className={`\n            fixed lg:relative inset-y-0 left-0 z-30 lg:z-0\n            w-72 lg:w-80 bg-neutral-950 lg:bg-neutral-950/50\n            border-r border-neutral-900\n            transform transition-transform duration-300 ease-in-out\n            ${isSidebarOpen ? 'translate-x-0' : '-translate-x-full lg:translate-x-0'}\n            lg:flex lg:flex-col\n            overflow-hidden\n          `}\n        >\n          {/* Sidebar Header */}\n          <div className=\"p-6 border-b border-neutral-900\">\n            <div className=\"flex items-center gap-3 mb-3\">\n              <div className=\"w-10 h-10 bg-gradient-to-br from-cyan-500/20 to-blue-500/20 rounded-xl flex items-center justify-center text-cyan-400\">\n                {getIconComponent(guide.icon, 20)}\n              </div>\n              <div className=\"flex-1 min-w-0\">\n                <h2 className=\"font-semibold text-white truncate\">{guide.title}</h2>\n                <div className=\"flex items-center gap-2 text-xs text-neutral-500\">\n                  <Clock size={12} />\n                  <span>{guide.estimatedReadTime} min</span>\n                </div>\n              </div>\n            </div>\n            {guide.subtitle && (\n              <p className=\"text-sm text-neutral-500 italic\">{guide.subtitle}</p>\n            )}\n          </div>\n\n          {/* Section List */}\n          <nav className=\"flex-1 overflow-y-auto p-4\">\n            <div className=\"text-xs font-semibold text-neutral-600 uppercase tracking-wider mb-3 px-2\">\n              Sections\n            </div>\n            <ul className=\"space-y-1\">\n              {guide.sections.map((s, idx) => (\n                <li key={s.id}>\n                  <button\n                    onClick={() => {\n                      setCurrentSection(idx);\n                      setIsSidebarOpen(false);\n                    }}\n                    className={`\n                      w-full text-left px-3 py-3 rounded-xl transition-all\n                      flex items-start gap-3 group\n                      ${currentSection === idx\n                        ? 'bg-gradient-to-r from-cyan-500/10 to-blue-500/10 border border-cyan-500/20'\n                        : 'hover:bg-neutral-900 border border-transparent'\n                      }\n                    `}\n                  >\n                    {/* Section number */}\n                    <span\n                      className={`\n                        flex-shrink-0 w-6 h-6 rounded-lg text-xs font-bold\n                        flex items-center justify-center transition-colors\n                        ${currentSection === idx\n                          ? 'bg-cyan-500 text-black'\n                          : idx < currentSection\n                            ? 'bg-green-500/20 text-green-400'\n                            : 'bg-neutral-800 text-neutral-500 group-hover:bg-neutral-700'\n                        }\n                      `}\n                    >\n                      {idx < currentSection ? (\n                        <CheckCircle2 size={14} />\n                      ) : (\n                        idx + 1\n                      )}\n                    </span>\n\n                    {/* Section info */}\n                    <div className=\"flex-1 min-w-0\">\n                      <p\n                        className={`text-sm font-medium truncate ${currentSection === idx ? 'text-white' : 'text-neutral-400 group-hover:text-neutral-200'\n                          }`}\n                      >\n                        {s.title}\n                      </p>\n                      {/* Show media indicator if section has media */}\n                      {s.media && s.media.length > 0 && (\n                        <div className=\"flex items-center gap-1 mt-1\">\n                          <Sparkles size={10} className=\"text-amber-400\" />\n                          <span className=\"text-xs text-neutral-600\">\n                            {s.media.length} visual{s.media.length > 1 ? 's' : ''}\n                          </span>\n                        </div>\n                      )}\n                    </div>\n                  </button>\n                </li>\n              ))}\n            </ul>\n          </nav>\n\n          {/* Sidebar Footer */}\n          <div className=\"p-4 border-t border-neutral-900\">\n            <div className=\"flex items-center justify-between text-xs text-neutral-600 mb-2\">\n              <span>Progress</span>\n              <span>{Math.round(progress)}%</span>\n            </div>\n            <div className=\"h-1.5 bg-neutral-800 rounded-full overflow-hidden\">\n              <motion.div\n                className=\"h-full bg-gradient-to-r from-cyan-500 to-green-500\"\n                animate={{ width: `${progress}%` }}\n              />\n            </div>\n          </div>\n        </aside>\n\n        {/* Mobile sidebar overlay */}\n        {isSidebarOpen && (\n          <div\n            className=\"fixed inset-0 bg-black/60 z-20 lg:hidden\"\n            onClick={() => setIsSidebarOpen(false)}\n          />\n        )}\n\n        {/* Main Content Area */}\n        <main className=\"flex-1 overflow-y-auto\">\n          <article className=\"max-w-3xl mx-auto px-6 py-10 lg:py-16\">\n            {/* Hero Media (only on first section) */}\n            {guide.heroMedia && currentSection === 0 && (\n              <div className=\"mb-10\">\n                <MediaRenderer media={guide.heroMedia} />\n              </div>\n            )}\n\n            {/* Article Header (only on first section) */}\n            {currentSection === 0 && (\n              <header className=\"mb-12\">\n                <div className=\"inline-flex items-center gap-2 px-3 py-1.5 bg-cyan-500/10 text-cyan-400 rounded-full text-xs font-medium mb-4\">\n                  {getIconComponent(guide.icon, 14)}\n                  <span className=\"uppercase tracking-wider\">Guide</span>\n                </div>\n\n                <h1 className=\"text-3xl md:text-4xl font-bold text-white mb-4 leading-tight\">\n                  {guide.title}\n                </h1>\n\n                <p className=\"text-neutral-300 text-lg leading-relaxed\">\n                  {guide.description}\n                </p>\n              </header>\n            )}\n\n            {/* Section Content */}\n            <AnimatePresence mode=\"wait\">\n              <motion.section\n                key={section.id}\n                initial={{ opacity: 0, x: 20 }}\n                animate={{ opacity: 1, x: 0 }}\n                exit={{ opacity: 0, x: -20 }}\n                transition={{ duration: 0.3 }}\n              >\n                {/* Section Title */}\n                <h2 className=\"text-2xl md:text-3xl font-bold text-white mb-8 pb-4 border-b border-neutral-900\">\n                  {section.title}\n                </h2>\n\n                {/* Tips Callout */}\n                {section.tips && section.tips.length > 0 && (\n                  <aside className=\"mb-10 p-6 bg-gradient-to-br from-cyan-500/5 to-cyan-600/5 border-l-4 border-cyan-500 rounded-r-xl\">\n                    <h4 className=\"text-sm font-semibold text-cyan-400 uppercase tracking-wider mb-4\">\n                      Quick Tips\n                    </h4>\n                    <ul className=\"space-y-3\">\n                      {section.tips.map((tip, i) => (\n                        <li key={i} className=\"flex items-start gap-3 text-neutral-300\">\n                          <span className=\"flex-shrink-0 w-5 h-5 bg-cyan-500/20 rounded-full flex items-center justify-center mt-0.5\">\n                            <span className=\"text-cyan-400 text-xs font-bold\">{i + 1}</span>\n                          </span>\n                          <span className=\"leading-relaxed\">{tip}</span>\n                        </li>\n                      ))}\n                    </ul>\n                  </aside>\n                )}\n\n                {/* Warnings Callout */}\n                {section.warnings && section.warnings.length > 0 && (\n                  <aside className=\"mb-10 p-6 bg-gradient-to-br from-amber-500/5 to-amber-600/5 border-l-4 border-amber-500 rounded-r-xl\">\n                    <h4 className=\"text-sm font-semibold text-amber-400 uppercase tracking-wider mb-4\">\n                      âš ï¸ Important\n                    </h4>\n                    <ul className=\"space-y-3\">\n                      {section.warnings.map((warning, i) => (\n                        <li key={i} className=\"flex items-start gap-3 text-neutral-300\">\n                          <span className=\"text-amber-400 mt-1\">â€¢</span>\n                          <span className=\"leading-relaxed\">{warning}</span>\n                        </li>\n                      ))}\n                    </ul>\n                  </aside>\n                )}\n\n                {/* Hero Media for Section */}\n                {section.media && section.media.filter(m => m.placement === 'hero').map(media => (\n                  <div key={media.id} className=\"mb-10\">\n                    <MediaRenderer media={media} />\n                  </div>\n                ))}\n\n                {/* Article Body - Custom Markdown Rendering */}\n                <div className=\"article-content\">\n                  <ReactMarkdown\n                    remarkPlugins={[remarkGfm]}\n                    components={{\n                      // Paragraphs with generous spacing\n                      p: ({ children }) => (\n                        <p className=\"text-neutral-300 text-lg leading-[1.8] mb-6\">\n                          {children}\n                        </p>\n                      ),\n                      // Headers with clear hierarchy\n                      h1: ({ children }) => (\n                        <h1 className=\"text-2xl font-bold text-white mt-12 mb-6\">\n                          {children}\n                        </h1>\n                      ),\n                      h2: ({ children }) => (\n                        <h2 className=\"text-xl font-bold text-white mt-10 mb-5 pb-3 border-b border-neutral-800\">\n                          {children}\n                        </h2>\n                      ),\n                      h3: ({ children }) => (\n                        <h3 className=\"text-lg font-semibold text-white mt-8 mb-4\">\n                          {children}\n                        </h3>\n                      ),\n                      // Strong text\n                      strong: ({ children }) => (\n                        <strong className=\"font-semibold text-white\">\n                          {children}\n                        </strong>\n                      ),\n                      // Emphasis\n                      em: ({ children }) => (\n                        <em className=\"text-neutral-400 not-italic\">\n                          {children}\n                        </em>\n                      ),\n                      // Lists with proper spacing\n                      ul: ({ children }) => (\n                        <ul className=\"my-6 ml-0 space-y-3\">\n                          {children}\n                        </ul>\n                      ),\n                      ol: ({ children }) => (\n                        <ol className=\"my-6 ml-0 space-y-3 list-decimal list-inside\">\n                          {children}\n                        </ol>\n                      ),\n                      li: ({ children }) => (\n                        <li className=\"text-neutral-300 text-lg leading-[1.8] flex items-start gap-3\">\n                          <span className=\"text-cyan-500 mt-1.5 flex-shrink-0\">â€¢</span>\n                          <span>{children}</span>\n                        </li>\n                      ),\n                      // Tables - styled beautifully\n                      table: ({ children }) => (\n                        <div className=\"my-8 overflow-x-auto rounded-xl border border-neutral-800\">\n                          <table className=\"w-full text-left\">\n                            {children}\n                          </table>\n                        </div>\n                      ),\n                      thead: ({ children }) => (\n                        <thead className=\"bg-neutral-900/80 border-b border-neutral-800\">\n                          {children}\n                        </thead>\n                      ),\n                      tbody: ({ children }) => (\n                        <tbody className=\"divide-y divide-neutral-800/50\">\n                          {children}\n                        </tbody>\n                      ),\n                      tr: ({ children }) => (\n                        <tr className=\"hover:bg-neutral-900/50 transition-colors\">\n                          {children}\n                        </tr>\n                      ),\n                      th: ({ children }) => (\n                        <th className=\"px-4 py-3 text-sm font-semibold text-cyan-400 uppercase tracking-wider\">\n                          {children}\n                        </th>\n                      ),\n                      td: ({ children }) => (\n                        <td className=\"px-4 py-3 text-neutral-300\">\n                          {children}\n                        </td>\n                      ),\n                      // Blockquotes\n                      blockquote: ({ children }) => (\n                        <blockquote className=\"my-8 pl-6 border-l-4 border-cyan-500 bg-neutral-900/50 py-4 pr-6 rounded-r-lg\">\n                          {children}\n                        </blockquote>\n                      ),\n                      // Code\n                      code: ({ children }) => (\n                        <code className=\"text-cyan-400 bg-neutral-900 px-2 py-1 rounded text-base\">\n                          {children}\n                        </code>\n                      ),\n                      // Links\n                      a: ({ href, children }) => (\n                        <a\n                          href={href}\n                          className=\"text-cyan-400 hover:text-cyan-300 underline underline-offset-4 decoration-cyan-500/30 hover:decoration-cyan-400 transition-colors\"\n                          target=\"_blank\"\n                          rel=\"noopener noreferrer\"\n                        >\n                          {children}\n                        </a>\n                      ),\n                      // Horizontal rule\n                      hr: () => (\n                        <hr className=\"my-10 border-neutral-800\" />\n                      ),\n                    }}\n                  >\n                    {section.content}\n                  </ReactMarkdown>\n                </div>\n\n                {/* Inline Media */}\n                {section.media && section.media.filter(m => m.placement !== 'hero').map(media => (\n                  <div key={media.id} className=\"my-10\">\n                    <MediaRenderer media={media} />\n                  </div>\n                ))}\n\n                {/* Product Recommendations */}\n                {section.products && section.products.length > 0 && (\n                  <div className=\"mt-12 pt-8 border-t border-neutral-900\">\n                    <h4 className=\"text-sm font-semibold text-neutral-400 uppercase tracking-wider mb-6\">\n                      Recommended Products\n                    </h4>\n                    <div className=\"space-y-4\">\n                      {section.products.map(productId => (\n                        <ProductCallout key={productId} productId={productId} />\n                      ))}\n                    </div>\n                  </div>\n                )}\n\n                {/* Section Navigation */}\n                <nav className=\"flex items-center justify-between mt-16 pt-8 border-t border-neutral-900\">\n                  <button\n                    onClick={() => setCurrentSection(Math.max(0, currentSection - 1))}\n                    disabled={currentSection === 0}\n                    className={`flex items-center gap-3 group transition-all ${currentSection === 0\n                      ? 'text-neutral-700 cursor-not-allowed'\n                      : 'text-neutral-400 hover:text-white'\n                      }`}\n                  >\n                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center transition-colors ${currentSection === 0 ? 'bg-neutral-900' : 'bg-neutral-900 group-hover:bg-neutral-800'\n                      }`}>\n                      <ArrowLeft size={20} />\n                    </div>\n                    <div className=\"hidden sm:block text-left\">\n                      <div className=\"text-xs text-neutral-600 uppercase tracking-wider mb-1\">Previous</div>\n                      {currentSection > 0 && (\n                        <div className=\"text-sm font-medium text-neutral-300\">{guide.sections[currentSection - 1].title}</div>\n                      )}\n                    </div>\n                  </button>\n\n                  <button\n                    onClick={() => setCurrentSection(Math.min(guide.sections.length - 1, currentSection + 1))}\n                    disabled={currentSection === guide.sections.length - 1}\n                    className={`flex items-center gap-3 group transition-all ${currentSection === guide.sections.length - 1\n                      ? 'text-neutral-700 cursor-not-allowed'\n                      : 'text-neutral-400 hover:text-white'\n                      }`}\n                  >\n                    <div className=\"hidden sm:block text-right\">\n                      <div className=\"text-xs text-neutral-600 uppercase tracking-wider mb-1\">Next</div>\n                      {currentSection < guide.sections.length - 1 && (\n                        <div className=\"text-sm font-medium text-neutral-300\">{guide.sections[currentSection + 1].title}</div>\n                      )}\n                    </div>\n                    <div className={`w-12 h-12 rounded-xl flex items-center justify-center transition-colors ${currentSection === guide.sections.length - 1\n                      ? 'bg-neutral-900'\n                      : 'bg-gradient-to-r from-cyan-500/20 to-blue-500/20 group-hover:from-cyan-500/30 group-hover:to-blue-500/30'\n                      }`}>\n                      <ChevronRight size={20} className={currentSection === guide.sections.length - 1 ? '' : 'text-cyan-400'} />\n                    </div>\n                  </button>\n                </nav>\n              </motion.section>\n            </AnimatePresence>\n\n            {/* Forum Discussion Link (after last section) */}\n            {currentSection === guide.sections.length - 1 && (\n              <div className=\"mt-16\">\n                <ForumDiscussionLink\n                  forumCategory={guide.forumCategory}\n                  guideTitle={guide.title}\n                />\n              </div>\n            )}\n          </article>\n        </main>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// GUIDE CARD\n// ============================================\n\ninterface GuideCardProps {\n  guide: Guide;\n  index: number;\n  onOpen: (guide: Guide) => void;\n}\n\nfunction GuideCard({ guide, index, onOpen }: GuideCardProps) {\n  const getCategoryColor = (guideId: string) => {\n    const category = GUIDE_CATEGORIES.find(c => c.guideIds.includes(guideId));\n    if (!category) return 'cyan';\n    const colorMap: Record<string, string> = {\n      blue: 'cyan',\n      purple: 'purple',\n      amber: 'amber',\n    };\n    return colorMap[category.color] || 'cyan';\n  };\n\n  const color = getCategoryColor(guide.id);\n\n  const colorClasses = {\n    cyan: 'from-cyan-500/10 to-cyan-600/10 border-cyan-500/20 text-cyan-400',\n    purple: 'from-purple-500/10 to-purple-600/10 border-purple-500/20 text-purple-400',\n    amber: 'from-amber-500/10 to-amber-600/10 border-amber-500/20 text-amber-400',\n  };\n\n  const iconColorClasses = {\n    cyan: 'bg-cyan-500/10 text-cyan-400',\n    purple: 'bg-purple-500/10 text-purple-400',\n    amber: 'bg-amber-500/10 text-amber-400',\n  };\n\n  return (\n    <motion.div\n      onClick={() => onOpen(guide)}\n      className={`bg-gradient-to-br ${colorClasses[color as keyof typeof colorClasses]} border rounded-xl p-5 hover:border-opacity-50 transition-all cursor-pointer group`}\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ delay: index * 0.05 }}\n      whileHover={{ y: -2 }}\n    >\n      <div className=\"flex items-start justify-between mb-3\">\n        <div className={`w-10 h-10 ${iconColorClasses[color as keyof typeof iconColorClasses]} rounded-xl flex items-center justify-center`}>\n          {getIconComponent(guide.icon)}\n        </div>\n        <div className=\"flex items-center gap-1 text-neutral-500 text-xs\">\n          <Clock size={12} />\n          <span>{guide.estimatedReadTime} min</span>\n        </div>\n      </div>\n\n      <h3 className=\"font-semibold text-white mb-1 group-hover:text-cyan-300 transition-colors\">\n        {guide.title}\n      </h3>\n\n      {guide.subtitle && (\n        <p className=\"text-xs text-neutral-400 mb-2 italic\">{guide.subtitle}</p>\n      )}\n\n      <p className=\"text-sm text-neutral-400 mb-3 line-clamp-2\">{guide.description}</p>\n\n      <div className=\"flex items-center justify-between\">\n        <div className=\"flex items-center gap-1 text-xs text-neutral-500\">\n          <span>{guide.sections.length} sections</span>\n          {guide.productIds && guide.productIds.length > 0 && (\n            <>\n              <span>-</span>\n              <span>{guide.productIds.length} products</span>\n            </>\n          )}\n        </div>\n        <ChevronRight size={16} className=\"text-neutral-600 group-hover:text-cyan-400 transition-colors\" />\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// CATEGORY SECTION\n// ============================================\n\ninterface CategorySectionProps {\n  category: GuideCategory;\n  onOpenGuide: (guide: Guide) => void;\n}\n\nfunction CategorySection({ category, onOpenGuide }: CategorySectionProps) {\n  const guides = getGuidesByCategory(category.id);\n\n  if (guides.length === 0) return null;\n\n  const colorClasses = {\n    blue: 'text-cyan-400 bg-cyan-500/10',\n    purple: 'text-purple-400 bg-purple-500/10',\n    amber: 'text-amber-400 bg-amber-500/10',\n  };\n\n  return (\n    <div className=\"mb-8\">\n      <div className=\"flex items-center gap-3 mb-4\">\n        <div className={`w-8 h-8 ${colorClasses[category.color as keyof typeof colorClasses]} rounded-lg flex items-center justify-center`}>\n          {getIconComponent(category.icon)}\n        </div>\n        <div>\n          <h3 className=\"font-semibold text-white\">{category.name}</h3>\n          <p className=\"text-xs text-neutral-500\">{category.description}</p>\n        </div>\n      </div>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        {guides.map((guide, idx) => (\n          <GuideCard key={guide.id} guide={guide} index={idx} onOpen={onOpenGuide} />\n        ))}\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// SEARCH BAR\n// ============================================\n\ninterface SearchBarProps {\n  query: string;\n  onQueryChange: (query: string) => void;\n}\n\nfunction SearchBar({ query, onQueryChange }: SearchBarProps) {\n  return (\n    <div className=\"relative mb-6\">\n      <Search size={18} className=\"absolute left-4 top-1/2 -translate-y-1/2 text-neutral-500\" />\n      <input\n        type=\"text\"\n        placeholder=\"Search guides...\"\n        value={query}\n        onChange={(e) => onQueryChange(e.target.value)}\n        className=\"w-full bg-neutral-900 border border-neutral-800 rounded-xl pl-11 pr-4 py-3 text-white placeholder:text-neutral-500 focus:outline-none focus:border-cyan-500/50 transition-colors\"\n      />\n    </div>\n  );\n}\n\n// ============================================\n// MAIN TAB COMPONENT\n// ============================================\n\nexport function GuidesTab() {\n  const [searchQuery, setSearchQuery] = useState('');\n  const [selectedGuide, setSelectedGuide] = useState<Guide | null>(null);\n\n  const filteredGuides = searchQuery.trim()\n    ? searchGuides(searchQuery)\n    : null;\n\n  const handleOpenGuide = (guide: Guide) => {\n    setSelectedGuide(guide);\n  };\n\n  const handleCloseGuide = () => {\n    setSelectedGuide(null);\n  };\n\n  return (\n    <>\n      <TabContent\n        title=\"Product Guides\"\n        subtitle=\"Evidence-based guides for optimal results\"\n      >\n        <div className=\"max-w-5xl mx-auto\">\n          <GuideStatsCard />\n\n          <SearchBar query={searchQuery} onQueryChange={setSearchQuery} />\n\n          {filteredGuides ? (\n            // Search Results\n            <div>\n              <p className=\"text-sm text-neutral-400 mb-4\">\n                Found {filteredGuides.length} guide{filteredGuides.length !== 1 ? 's' : ''} matching &ldquo;{searchQuery}&rdquo;\n              </p>\n              <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {filteredGuides.map((guide, idx) => (\n                  <GuideCard key={guide.id} guide={guide} index={idx} onOpen={handleOpenGuide} />\n                ))}\n              </div>\n              {filteredGuides.length === 0 && (\n                <div className=\"text-center py-12\">\n                  <div className=\"w-16 h-16 bg-neutral-900 rounded-full flex items-center justify-center mx-auto mb-4\">\n                    <Search size={24} className=\"text-neutral-600\" />\n                  </div>\n                  <p className=\"text-neutral-500\">No guides found matching your search</p>\n                </div>\n              )}\n            </div>\n          ) : (\n            // Category View\n            <div>\n              {GUIDE_CATEGORIES.map(category => (\n                <CategorySection key={category.id} category={category} onOpenGuide={handleOpenGuide} />\n              ))}\n            </div>\n          )}\n        </div>\n      </TabContent>\n\n      {/* Guide Viewer Modal */}\n      <AnimatePresence>\n        {selectedGuide && (\n          <GuideViewer guide={selectedGuide} onClose={handleCloseGuide} />\n        )}\n      </AnimatePresence>\n    </>\n  );\n}\n","numLines":1007,"startLine":1,"totalLines":1007}}}
{"parentUuid":"15a87c1b-ac91-4f6d-b5a1-6a9fd0f3225f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_011zNCgfvucsg9vb4ayP92fp","type":"tool_result","content":"     1â†’'use client';\n     2â†’\n     3â†’import { useMemo, useState } from 'react';\n     4â†’import { motion } from 'framer-motion';\n     5â†’import {\n     6â†’  Ruler,\n     7â†’  Scale,\n     8â†’  Info,\n     9â†’  TrendingUp,\n    10â†’  Calculator,\n    11â†’  AlertCircle,\n    12â†’  Dumbbell,\n    13â†’  Camera,\n    14â†’  Percent,\n    15â†’  BookOpen,\n    16â†’  Clock,\n    17â†’  ArrowRight,\n    18â†’  Brain,\n    19â†’  Wrench,\n    20â†’  TrendingDown,\n    21â†’  Calendar,\n    22â†’  Target,\n    23â†’  Heart,\n    24â†’  Utensils,\n    25â†’  Droplet,\n    26â†’} from 'lucide-react';\n    27â†’import { useResults } from '@/contexts/ResultsContext';\n    28â†’import { Guide } from '@/types/guides';\n    29â†’import { getGuideById } from '@/data/guides';\n    30â†’import { useHeightOptional } from '@/contexts/HeightContext';\n    31â†’import { useWeightOptional } from '@/contexts/WeightContext';\n    32â†’import { usePhysiqueOptional } from '@/contexts/PhysiqueContext';\n    33â†’import { TabContent } from '../ResultsLayout';\n    34â†’import { PSLScoreCard } from '@/components/psl/PSLScoreCard';\n    35â†’import { PSLTierBadge } from '@/components/psl/PSLTierBadge';\n    36â†’import { calculatePSL, getHeightRating, cmToFeetInches } from '@/lib/psl-calculator';\n    37â†’import { getFFMICategoryColor, getFFMICategoryDescription } from '@/lib/ffmi-calculator';\n    38â†’import { TIER_DEFINITIONS, PSLResult, MuscleLevel, FFMIData } from '@/types/psl';\n    39â†’import Link from 'next/link';\n    40â†’\n    41â†’// Height input form for users who skipped height entry\n    42â†’function HeightInputPrompt({ onHeightSet }: { onHeightSet: (cm: number) => void }) {\n    43â†’  const [feet, setFeet] = useState(5);\n    44â†’  const [inches, setInches] = useState(9);\n    45â†’\n    46â†’  const handleSubmit = () => {\n    47â†’    const totalInches = feet * 12 + inches;\n    48â†’    const cm = Math.round(totalInches * 2.54);\n    49â†’    onHeightSet(cm);\n    50â†’  };\n    51â†’\n    52â†’  return (\n    53â†’    <motion.div\n    54â†’      initial={{ opacity: 0, y: 20 }}\n    55â†’      animate={{ opacity: 1, y: 0 }}\n    56â†’      className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n    57â†’    >\n    58â†’      <div className=\"flex items-center gap-3 mb-4\">\n    59â†’        <div className=\"w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center\">\n    60â†’          <Ruler className=\"w-5 h-5 text-cyan-400\" />\n    61â†’        </div>\n    62â†’        <div>\n    63â†’          <h3 className=\"font-semibold text-white\">Enter Your Height</h3>\n    64â†’          <p className=\"text-sm text-neutral-400\">Required for PSL calculation</p>\n    65â†’        </div>\n    66â†’      </div>\n    67â†’\n    68â†’      <div className=\"flex items-center gap-4 mb-4\">\n    69â†’        <div className=\"flex-1\">\n    70â†’          <label className=\"text-xs text-neutral-500 mb-1 block\">Feet</label>\n    71â†’          <select\n    72â†’            value={feet}\n    73â†’            onChange={(e) => setFeet(Number(e.target.value))}\n    74â†’            className=\"w-full bg-neutral-800 border border-neutral-700 rounded-lg px-3 py-2 text-white\"\n    75â†’          >\n    76â†’            {[4, 5, 6, 7].map((f) => (\n    77â†’              <option key={f} value={f}>{f}&apos;</option>\n    78â†’            ))}\n    79â†’          </select>\n    80â†’        </div>\n    81â†’        <div className=\"flex-1\">\n    82â†’          <label className=\"text-xs text-neutral-500 mb-1 block\">Inches</label>\n    83â†’          <select\n    84â†’            value={inches}\n    85â†’            onChange={(e) => setInches(Number(e.target.value))}\n    86â†’            className=\"w-full bg-neutral-800 border border-neutral-700 rounded-lg px-3 py-2 text-white\"\n    87â†’          >\n    88â†’            {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11].map((i) => (\n    89â†’              <option key={i} value={i}>{i}&quot;</option>\n    90â†’            ))}\n    91â†’          </select>\n    92â†’        </div>\n    93â†’      </div>\n    94â†’\n    95â†’      <button\n    96â†’        onClick={handleSubmit}\n    97â†’        className=\"w-full py-2.5 bg-cyan-500 text-black font-medium rounded-lg hover:bg-cyan-400 transition-colors\"\n    98â†’      >\n    99â†’        Calculate PSL\n   100â†’      </button>\n   101â†’    </motion.div>\n   102â†’  );\n   103â†’}\n   104â†’\n   105â†’// Tier comparison visualization\n   106â†’function TierComparisonChart({ currentTier, currentScore }: { currentTier: string; currentScore: number }) {\n   107â†’  return (\n   108â†’    <motion.div\n   109â†’      initial={{ opacity: 0 }}\n   110â†’      animate={{ opacity: 1 }}\n   111â†’      transition={{ delay: 0.2 }}\n   112â†’      className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n   113â†’    >\n   114â†’      <h3 className=\"font-semibold text-white mb-4\">Tier Distribution</h3>\n   115â†’\n   116â†’      <div className=\"space-y-3\">\n   117â†’        {TIER_DEFINITIONS.slice().reverse().map((tier) => {\n   118â†’          const isCurrentTier = tier.name === currentTier;\n   119â†’          const isPassed = currentScore >= tier.minScore;\n   120â†’\n   121â†’          return (\n   122â†’            <div key={tier.name} className=\"flex items-center gap-3\">\n   123â†’              <div\n   124â†’                className={`w-24 text-xs font-medium truncate ${\n   125â†’                  isCurrentTier ? 'text-white' : 'text-neutral-500'\n   126â†’                }`}\n   127â†’              >\n   128â†’                {tier.name}\n   129â†’              </div>\n   130â†’\n   131â†’              <div className=\"flex-1 h-3 bg-neutral-800 rounded-full overflow-hidden relative\">\n   132â†’                {/* Tier range */}\n   133â†’                <div\n   134â†’                  className=\"absolute inset-y-0 rounded-full transition-all\"\n   135â†’                  style={{\n   136â†’                    left: `${(tier.minScore / 10) * 100}%`,\n   137â†’                    right: `${100 - (tier.maxScore / 10) * 100}%`,\n   138â†’                    backgroundColor: isPassed ? tier.color : `${tier.color}40`,\n   139â†’                  }}\n   140â†’                />\n   141â†’\n   142â†’                {/* Current score marker */}\n   143â†’                {isCurrentTier && (\n   144â†’                  <motion.div\n   145â†’                    initial={{ scale: 0 }}\n   146â†’                    animate={{ scale: 1 }}\n   147â†’                    className=\"absolute top-1/2 -translate-y-1/2 w-4 h-4 rounded-full bg-white border-2 shadow-lg\"\n   148â†’                    style={{\n   149â†’                      left: `${(currentScore / 10) * 100}%`,\n   150â†’                      borderColor: tier.color,\n   151â†’                      transform: 'translateX(-50%) translateY(-50%)',\n   152â†’                    }}\n   153â†’                  />\n   154â†’                )}\n   155â†’              </div>\n   156â†’\n   157â†’              <div className={`w-16 text-right text-xs ${\n   158â†’                isCurrentTier ? 'text-white font-semibold' : 'text-neutral-500'\n   159â†’              }`}>\n   160â†’                {tier.minScore.toFixed(1)} - {tier.maxScore.toFixed(1)}\n   161â†’              </div>\n   162â†’            </div>\n   163â†’          );\n   164â†’        })}\n   165â†’      </div>\n   166â†’\n   167â†’      {/* Score scale */}\n   168â†’      <div className=\"flex justify-between mt-4 text-xs text-neutral-500\">\n   169â†’        <span>0</span>\n   170â†’        <span>2</span>\n   171â†’        <span>4</span>\n   172â†’        <span>6</span>\n   173â†’        <span>8</span>\n   174â†’        <span>10</span>\n   175â†’      </div>\n   176â†’    </motion.div>\n   177â†’  );\n   178â†’}\n   179â†’\n   180â†’// PSL Formula explanation\n   181â†’function PSLFormulaExplainer({ bodyMethod }: { bodyMethod?: 'ffmi' | 'table' | 'default' }) {\n   182â†’  const bodyDescription = bodyMethod === 'ffmi'\n   183â†’    ? 'Body composition via FFMI (5% weight) - calculated from your height, weight, and body fat'\n   184â†’    : bodyMethod === 'table'\n   185â†’    ? 'Body composition (5% weight) - based on body fat % and muscle level'\n   186â†’    : 'Body composition (5% weight) - defaults to 5/10 without physique data';\n   187â†’\n   188â†’  return (\n   189â†’    <motion.div\n   190â†’      initial={{ opacity: 0 }}\n   191â†’      animate={{ opacity: 1 }}\n   192â†’      transition={{ delay: 0.3 }}\n   193â†’      className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n   194â†’    >\n   195â†’      <div className=\"flex items-center gap-2 mb-4\">\n   196â†’        <Calculator className=\"w-5 h-5 text-cyan-400\" />\n   197â†’        <h3 className=\"font-semibold text-white\">How PSL is Calculated</h3>\n   198â†’      </div>\n   199â†’\n   200â†’      <div className=\"bg-neutral-800/50 rounded-lg p-4 mb-4 font-mono text-sm\">\n   201â†’        <span className=\"text-cyan-400\">PSL</span>\n   202â†’        <span className=\"text-neutral-400\"> = </span>\n   203â†’        <span className=\"text-purple-400\">(Face Ã— 0.75)</span>\n   204â†’        <span className=\"text-neutral-400\"> + </span>\n   205â†’        <span className=\"text-green-400\">(Height Ã— 0.20)</span>\n   206â†’        <span className=\"text-neutral-400\"> + </span>\n   207â†’        <span className=\"text-orange-400\">(Body Ã— 0.05)</span>\n   208â†’        <span className=\"text-neutral-400\"> + </span>\n   209â†’        <span className=\"text-yellow-400\">Bonuses</span>\n   210â†’      </div>\n   211â†’\n   212â†’      <div className=\"space-y-3 text-sm\">\n   213â†’        <div className=\"flex items-start gap-2\">\n   214â†’          <span className=\"text-purple-400 font-semibold w-16\">Face</span>\n   215â†’          <span className=\"text-neutral-400\">\n   216â†’            Your facial harmony score (75% weight) - the primary driver of attractiveness\n   217â†’          </span>\n   218â†’        </div>\n   219â†’        <div className=\"flex items-start gap-2\">\n   220â†’          <span className=\"text-green-400 font-semibold w-16\">Height</span>\n   221â†’          <span className=\"text-neutral-400\">\n   222â†’            Your height rating (20% weight) - varies by gender\n   223â†’          </span>\n   224â†’        </div>\n   225â†’        <div className=\"flex items-start gap-2\">\n   226â†’          <span className=\"text-orange-400 font-semibold w-16\">Body</span>\n   227â†’          <span className=\"text-neutral-400\">\n   228â†’            {bodyDescription}\n   229â†’          </span>\n   230â†’        </div>\n   231â†’        <div className=\"flex items-start gap-2\">\n   232â†’          <span className=\"text-yellow-400 font-semibold w-16\">Bonuses</span>\n   233â†’          <span className=\"text-neutral-400\">\n   234â†’            Threshold (+0.1-0.3) and synergy (+0.05-0.35) bonuses for elite scores (â‰¥8.5)\n   235â†’          </span>\n   236â†’        </div>\n   237â†’      </div>\n   238â†’\n   239â†’      <div className=\"mt-4 p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg flex items-start gap-2\">\n   240â†’        <AlertCircle className=\"w-4 h-4 text-amber-400 flex-shrink-0 mt-0.5\" />\n   241â†’        <p className=\"text-xs text-amber-200\">\n   242â†’          Height â‰¥8.0 rating is required to reach Gigachad tier. Major facial flaws cap your tier regardless of score.\n   243â†’        </p>\n   244â†’      </div>\n   245â†’    </motion.div>\n   246â†’  );\n   247â†’}\n   248â†’\n   249â†’// BMI category helper\n   250â†’function getBMIInfo(bmi: number): { category: string; color: string } {\n   251â†’  if (bmi < 18.5) return { category: 'Underweight', color: 'text-yellow-400' };\n   252â†’  if (bmi < 25) return { category: 'Normal', color: 'text-green-400' };\n   253â†’  if (bmi < 30) return { category: 'Overweight', color: 'text-orange-400' };\n   254â†’  return { category: 'Obese', color: 'text-red-400' };\n   255â†’}\n   256â†’\n   257â†’// Body Composition Card - shows FFMI, body fat %, and muscle level\n   258â†’function BodyCompositionCard({\n   259â†’  ffmiData,\n   260â†’  bodyFatPercent,\n   261â†’  muscleLevel,\n   262â†’  bodyScoreMethod,\n   263â†’  bodyRating,\n   264â†’  gender,\n   265â†’  weightInputMode = 'imperial',\n   266â†’}: {\n   267â†’  ffmiData?: FFMIData;\n   268â†’  bodyFatPercent?: number;\n   269â†’  muscleLevel?: string;\n   270â†’  bodyScoreMethod: 'ffmi' | 'table' | 'default';\n   271â†’  bodyRating: number;\n   272â†’  gender: 'male' | 'female';\n   273â†’  weightInputMode?: 'metric' | 'imperial';\n   274â†’}) {\n   275â†’  if (bodyScoreMethod === 'default') return null;\n   276â†’\n   277â†’  return (\n   278â†’    <motion.div\n   279â†’      initial={{ opacity: 0, y: 10 }}\n   280â†’      animate={{ opacity: 1, y: 0 }}\n   281â†’      transition={{ delay: 0.15 }}\n   282â†’      className=\"bg-neutral-900 rounded-xl p-4 border border-neutral-800\"\n   283â†’    >\n   284â†’      <div className=\"flex items-center gap-2 mb-4\">\n   285â†’        <Dumbbell className=\"w-5 h-5 text-orange-400\" />\n   286â†’        <h3 className=\"font-semibold text-white\">Body Composition</h3>\n   287â†’        {bodyScoreMethod === 'ffmi' && (\n   288â†’          <span className=\"ml-auto text-xs bg-orange-500/20 text-orange-400 px-2 py-0.5 rounded-full\">\n   289â†’            FFMI\n   290â†’          </span>\n   291â†’        )}\n   292â†’      </div>\n   293â†’\n   294â†’      <div className=\"grid grid-cols-2 gap-4\">\n   295â†’        {/* Body Score */}\n   296â†’        <div className=\"bg-neutral-800/50 rounded-lg p-3 text-center\">\n   297â†’          <p className=\"text-xs text-neutral-400 mb-1\">Body Score</p>\n   298â†’          <p className=\"text-xl font-bold text-orange-400\">{bodyRating.toFixed(1)}/10</p>\n   299â†’          <p className=\"text-xs text-neutral-500 mt-1\">5% of PSL</p>\n   300â†’        </div>\n   301â†’\n   302â†’        {/* FFMI */}\n   303â†’        {ffmiData && (\n   304â†’          <div className=\"bg-neutral-800/50 rounded-lg p-3 text-center\">\n   305â†’            <p className=\"text-xs text-neutral-400 mb-1\">FFMI</p>\n   306â†’            <p className=\"text-xl font-bold\" style={{ color: getFFMICategoryColor(ffmiData.category as 'Below Average' | 'Average' | 'Above Average' | 'Excellent' | 'Elite') }}>\n   307â†’              {ffmiData.normalizedFFMI.toFixed(1)}\n   308â†’            </p>\n   309â†’            <p className=\"text-xs\" style={{ color: getFFMICategoryColor(ffmiData.category as 'Below Average' | 'Average' | 'Above Average' | 'Excellent' | 'Elite') }}>\n   310â†’              {ffmiData.category}\n   311â†’            </p>\n   312â†’          </div>\n   313â†’        )}\n   314â†’\n   315â†’        {/* Body Fat */}\n   316â†’        {bodyFatPercent !== undefined && (\n   317â†’          <div className=\"bg-neutral-800/50 rounded-lg p-3 text-center\">\n   318â†’            <p className=\"text-xs text-neutral-400 mb-1\">Body Fat</p>\n   319â†’            <p className=\"text-xl font-bold text-cyan-400\">{bodyFatPercent}%</p>\n   320â†’            <p className=\"text-xs text-neutral-500 mt-1\">\n   321â†’              {bodyFatPercent < 10 ? 'Very Lean' :\n   322â†’               bodyFatPercent < 15 ? 'Lean' :\n   323â†’               bodyFatPercent < 20 ? 'Athletic' :\n   324â†’               bodyFatPercent < 25 ? 'Average' : 'Above Average'}\n   325â†’            </p>\n   326â†’          </div>\n   327â†’        )}\n   328â†’\n   329â†’        {/* Lean Mass */}\n   330â†’        {ffmiData && (\n   331â†’          <div className=\"bg-neutral-800/50 rounded-lg p-3 text-center\">\n   332â†’            <p className=\"text-xs text-neutral-400 mb-1\">Lean Mass</p>\n   333â†’            <p className=\"text-xl font-bold text-green-400\">\n   334â†’              {weightInputMode === 'imperial'\n   335â†’                ? `${Math.round(ffmiData.leanMassKg * 2.20462)} lbs`\n   336â†’                : `${ffmiData.leanMassKg.toFixed(1)} kg`}\n   337â†’            </p>\n   338â†’            <p className=\"text-xs text-neutral-500 mt-1\">\n   339â†’              {weightInputMode === 'imperial'\n   340â†’                ? `${ffmiData.leanMassKg.toFixed(1)} kg`\n   341â†’                : `${Math.round(ffmiData.leanMassKg * 2.20462)} lbs`}\n   342â†’            </p>\n   343â†’          </div>\n   344â†’        )}\n   345â†’\n   346â†’        {/* Muscle Level (if no FFMI) */}\n   347â†’        {!ffmiData && muscleLevel && (\n   348â†’          <div className=\"bg-neutral-800/50 rounded-lg p-3 text-center\">\n   349â†’            <p className=\"text-xs text-neutral-400 mb-1\">Muscle Level</p>\n   350â†’            <p className=\"text-lg font-bold text-purple-400 capitalize\">{muscleLevel}</p>\n   351â†’          </div>\n   352â†’        )}\n   353â†’      </div>\n   354â†’\n   355â†’      {/* FFMI Description */}\n   356â†’      {ffmiData && (\n   357â†’        <p className=\"mt-3 text-xs text-neutral-400\">\n   358â†’          {getFFMICategoryDescription(ffmiData.category as 'Below Average' | 'Average' | 'Above Average' | 'Excellent' | 'Elite', gender)}\n   359â†’        </p>\n   360â†’      )}\n   361â†’    </motion.div>\n   362â†’  );\n   363â†’}\n   364â†’\n   365â†’// Prompt to add physique photos\n   366â†’function AddPhysiquePrompt() {\n   367â†’  return (\n   368â†’    <motion.div\n   369â†’      initial={{ opacity: 0, y: 10 }}\n   370â†’      animate={{ opacity: 1, y: 0 }}\n   371â†’      transition={{ delay: 0.15 }}\n   372â†’      className=\"bg-neutral-900 rounded-xl p-4 border border-neutral-800 border-dashed\"\n   373â†’    >\n   374â†’      <div className=\"flex items-center gap-3\">\n   375â†’        <div className=\"w-10 h-10 rounded-lg bg-orange-500/20 flex items-center justify-center\">\n   376â†’          <Camera className=\"w-5 h-5 text-orange-400\" />\n   377â†’        </div>\n   378â†’        <div className=\"flex-1\">\n   379â†’          <h3 className=\"font-semibold text-white\">Add Body Photos</h3>\n   380â†’          <p className=\"text-sm text-neutral-400\">\n   381â†’            Get accurate FFMI-based body scoring with physique photos\n   382â†’          </p>\n   383â†’        </div>\n   384â†’        <Link\n   385â†’          href=\"/physique\"\n   386â†’          className=\"px-4 py-2 bg-orange-500/20 text-orange-400 rounded-lg text-sm font-medium hover:bg-orange-500/30 transition-colors\"\n   387â†’        >\n   388â†’          Add Photos\n   389â†’        </Link>\n   390â†’      </div>\n   391â†’      <div className=\"mt-3 flex items-center gap-2 text-xs text-neutral-500\">\n   392â†’        <Percent className=\"w-3 h-3\" />\n   393â†’        <span>Currently using default body score (5.0/10)</span>\n   394â†’      </div>\n   395â†’    </motion.div>\n   396â†’  );\n   397â†’}\n   398â†’\n   399â†’// ============================================\n   400â†’// RECOMMENDED GUIDES SECTION (PSL-specific)\n   401â†’// ============================================\n   402â†’\n   403â†’// Icon mapping for guides\n   404â†’const GUIDE_ICON_MAP: Record<string, React.ReactNode> = {\n   405â†’  BookOpen: <BookOpen size={18} />,\n   406â†’  Dumbbell: <Dumbbell size={18} />,\n   407â†’  Brain: <Brain size={18} />,\n   408â†’  Wrench: <Wrench size={18} />,\n   409â†’  TrendingDown: <TrendingDown size={18} />,\n   410â†’  Calendar: <Calendar size={18} />,\n   411â†’  Target: <Target size={18} />,\n   412â†’  Heart: <Heart size={18} />,\n   413â†’  Utensils: <Utensils size={18} />,\n   414â†’  Droplet: <Droplet size={18} />,\n   415â†’};\n   416â†’\n   417â†’// PSL improvement guides - focused on body composition and physique\n   418â†’const PSL_GUIDE_IDS = ['body-fat', 'v-taper', 'training', 'diet', 'cardio', 'skincare'];\n   419â†’\n   420â†’function PSLRecommendedGuides({ onOpenGuide }: { onOpenGuide: () => void }) {\n   421â†’  const guides = PSL_GUIDE_IDS\n   422â†’    .map((id) => getGuideById(id))\n   423â†’    .filter((g): g is Guide => g !== undefined)\n   424â†’    .slice(0, 3);\n   425â†’\n   426â†’  if (guides.length === 0) return null;\n   427â†’\n   428â†’  return (\n   429â†’    <motion.div\n   430â†’      initial={{ opacity: 0 }}\n   431â†’      animate={{ opacity: 1 }}\n   432â†’      transition={{ delay: 0.35 }}\n   433â†’      className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n   434â†’    >\n   435â†’      <div className=\"flex items-center gap-2 mb-4\">\n   436â†’        <BookOpen className=\"w-5 h-5 text-cyan-400\" />\n   437â†’        <h3 className=\"font-semibold text-white\">Improvement Guides</h3>\n   438â†’        <span className=\"px-2 py-0.5 text-xs font-medium rounded border bg-green-500/20 text-green-400 border-green-500/40\">\n   439â†’          PSL Boost\n   440â†’        </span>\n   441â†’      </div>\n   442â†’\n   443â†’      <p className=\"text-sm text-neutral-400 mb-4\">\n   444â†’        Optimize your body composition and physique to maximize your PSL score\n   445â†’      </p>\n   446â†’\n   447â†’      <div className=\"grid gap-3 md:grid-cols-3\">\n   448â†’        {guides.map((guide) => (\n   449â†’          <div\n   450â†’            key={guide.id}\n   451â†’            onClick={onOpenGuide}\n   452â†’            className=\"group bg-neutral-800/50 hover:bg-neutral-800 rounded-lg p-4 border border-neutral-700 hover:border-green-500/30 transition-all cursor-pointer\"\n   453â†’          >\n   454â†’            <div className=\"flex items-center gap-3 mb-2\">\n   455â†’              <div className=\"w-10 h-10 rounded-lg bg-gradient-to-br from-green-500/20 to-cyan-500/20 flex items-center justify-center text-green-400 flex-shrink-0\">\n   456â†’                {GUIDE_ICON_MAP[guide.icon] || <BookOpen size={18} />}\n   457â†’              </div>\n   458â†’              <h4 className=\"font-medium text-white group-hover:text-green-400 transition-colors text-sm line-clamp-1\">\n   459â†’                {guide.title}\n   460â†’              </h4>\n   461â†’            </div>\n   462â†’            <p className=\"text-xs text-neutral-400 line-clamp-2 mb-2\">\n   463â†’              {guide.description}\n   464â†’            </p>\n   465â†’            <div className=\"flex items-center justify-between\">\n   466â†’              <div className=\"flex items-center gap-1 text-xs text-neutral-500\">\n   467â†’                <Clock size={12} />\n   468â†’                <span>{guide.estimatedReadTime} min</span>\n   469â†’              </div>\n   470â†’              <span className=\"text-xs text-green-400 opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1\">\n   471â†’                Read\n   472â†’                <ArrowRight className=\"w-3 h-3\" />\n   473â†’              </span>\n   474â†’            </div>\n   475â†’          </div>\n   476â†’        ))}\n   477â†’      </div>\n   478â†’\n   479â†’      <button\n   480â†’        onClick={onOpenGuide}\n   481â†’        className=\"w-full mt-4 flex items-center justify-center gap-2 py-2 text-sm text-neutral-400 hover:text-white transition-colors\"\n   482â†’      >\n   483â†’        <span>View all guides</span>\n   484â†’        <ArrowRight className=\"w-4 h-4\" />\n   485â†’      </button>\n   486â†’    </motion.div>\n   487â†’  );\n   488â†’}\n   489â†’\n   490â†’// Map physique muscle mass string to MuscleLevel type\n   491â†’function mapMuscleLevel(muscleMass: string | undefined): MuscleLevel | undefined {\n   492â†’  if (!muscleMass) return undefined;\n   493â†’  const mapping: Record<string, MuscleLevel> = {\n   494â†’    'low': 'low',\n   495â†’    'medium': 'medium',\n   496â†’    'medium-high': 'medium-high',\n   497â†’    'high': 'high',\n   498â†’    'very-high': 'very-high',\n   499â†’    'extreme': 'extreme',\n   500â†’  };\n   501â†’  return mapping[muscleMass] || 'medium';\n   502â†’}\n   503â†’\n   504â†’// Main PSL Tab component\n   505â†’export function PSLTab() {\n   506â†’  const { overallScore, gender, setActiveTab } = useResults();\n   507â†’  const heightContext = useHeightOptional();\n   508â†’  const weightContext = useWeightOptional();\n   509â†’  const physiqueContext = usePhysiqueOptional();\n   510â†’\n   511â†’  // Local state for height if context not available\n   512â†’  const [localHeightCm, setLocalHeightCm] = useState<number | null>(null);\n   513â†’\n   514â†’  // Handle guide opening - navigate to guides tab\n   515â†’  const handleOpenGuide = () => {\n   516â†’    setActiveTab('guides');\n   517â†’  };\n   518â†’\n   519â†’  // Get height and weight from context or local state\n   520â†’  const heightCm = heightContext?.heightCm ?? localHeightCm;\n   521â†’  const setHeightCm = heightContext?.setHeightCm ?? setLocalHeightCm;\n   522â†’  const heightInputMode = heightContext?.inputMode ?? 'imperial';\n   523â†’  const weightKg = weightContext?.weightKg ?? null;\n   524â†’  const weightInputMode = weightContext?.inputMode ?? 'imperial';\n   525â†’  const bmi = weightContext?.bmi ?? null;\n   526â†’\n   527â†’  // Get physique analysis from context\n   528â†’  const physiqueAnalysis = physiqueContext?.physiqueAnalysis ?? null;\n   529â†’\n   530â†’  // Calculate PSL using the face score, height, and body analysis\n   531â†’  const pslResult: PSLResult | null = useMemo(() => {\n   532â†’    if (!heightCm || !overallScore) return null;\n   533â†’\n   534â†’    // Use the overall harmony score as the face score\n   535â†’    const faceScore = typeof overallScore === 'number' ? overallScore : 0;\n   536â†’    const currentGender = gender || 'male';\n   537â†’\n   538â†’    // Build body analysis if physique data is available\n   539â†’    const bodyAnalysis = physiqueAnalysis ? {\n   540â†’      bodyFatPercent: physiqueAnalysis.bodyFatPercent,\n   541â†’      muscleLevel: mapMuscleLevel(physiqueAnalysis.muscleMass) || 'medium',\n   542â†’      weightKg: weightKg ?? undefined,\n   543â†’    } : undefined;\n   544â†’\n   545â†’    return calculatePSL({\n   546â†’      faceScore,\n   547â†’      heightCm,\n   548â†’      gender: currentGender,\n   549â†’      bodyAnalysis,\n   550â†’      weightKg: weightKg ?? undefined, // Pass weight for FFMI calculation\n   551â†’    });\n   552â†’  }, [heightCm, overallScore, gender, physiqueAnalysis, weightKg]);\n   553â†’\n   554â†’  // Get height rating for display\n   555â†’  const heightRating = heightCm ? getHeightRating(heightCm, gender || 'male') : null;\n   556â†’  const heightDisplay = heightCm ? cmToFeetInches(heightCm) : null;\n   557â†’\n   558â†’  // Format inches for display (show .5 for half inches, otherwise whole number)\n   559â†’  const formatInches = (inches: number): string => {\n   560â†’    return Number.isInteger(inches) ? inches.toString() : inches.toFixed(1);\n   561â†’  };\n   562â†’\n   563â†’  return (\n   564â†’    <TabContent\n   565â†’      title=\"PSL Rating\"\n   566â†’      subtitle=\"Your Pretty Scale Level score based on face, height, and body\"\n   567â†’    >\n   568â†’      {/* Height prompt if not set */}\n   569â†’      {!heightCm && (\n   570â†’        <div className=\"mb-6\">\n   571â†’          <HeightInputPrompt onHeightSet={setHeightCm} />\n   572â†’        </div>\n   573â†’      )}\n   574â†’\n   575â†’      {/* PSL Results */}\n   576â†’      {pslResult && (\n   577â†’        <div className=\"space-y-6\">\n   578â†’          {/* Main score card */}\n   579â†’          <PSLScoreCard psl={pslResult} showBreakdown showPotential />\n   580â†’\n   581â†’          {/* Height & Weight info */}\n   582â†’          {(heightDisplay || weightKg) && (\n   583â†’            <motion.div\n   584â†’              initial={{ opacity: 0, y: 10 }}\n   585â†’              animate={{ opacity: 1, y: 0 }}\n   586â†’              className=\"bg-neutral-900 rounded-xl p-4 border border-neutral-800 space-y-4\"\n   587â†’            >\n   588â†’              {/* Height */}\n   589â†’              {heightDisplay && (\n   590â†’                <div className=\"flex items-center justify-between\">\n   591â†’                  <div className=\"flex items-center gap-3\">\n   592â†’                    <div className=\"w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center\">\n   593â†’                      <Ruler className=\"w-5 h-5 text-green-400\" />\n   594â†’                    </div>\n   595â†’                    <div>\n   596â†’                      <p className=\"text-sm text-neutral-400\">Your Height</p>\n   597â†’                      <p className=\"text-lg font-semibold text-white\">\n   598â†’                        {heightInputMode === 'imperial'\n   599â†’                          ? `${heightDisplay.feet}'${formatInches(heightDisplay.inches)}\" (${heightCm}cm)`\n   600â†’                          : `${heightCm}cm (${heightDisplay.feet}'${formatInches(heightDisplay.inches)}\")`}\n   601â†’                      </p>\n   602â†’                    </div>\n   603â†’                  </div>\n   604â†’                  <div className=\"text-right\">\n   605â†’                    <p className=\"text-sm text-neutral-400\">Height Rating</p>\n   606â†’                    <p className=\"text-lg font-bold text-green-400\">\n   607â†’                      {heightRating?.toFixed(1)}/10\n   608â†’                    </p>\n   609â†’                  </div>\n   610â†’                </div>\n   611â†’              )}\n   612â†’\n   613â†’              {/* Divider */}\n   614â†’              {heightDisplay && weightKg && (\n   615â†’                <div className=\"border-t border-neutral-800\" />\n   616â†’              )}\n   617â†’\n   618â†’              {/* Weight & BMI */}\n   619â†’              {weightKg && (\n   620â†’                <div className=\"flex items-center justify-between\">\n   621â†’                  <div className=\"flex items-center gap-3\">\n   622â†’                    <div className=\"w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center\">\n   623â†’                      <Scale className=\"w-5 h-5 text-purple-400\" />\n   624â†’                    </div>\n   625â†’                    <div>\n   626â†’                      <p className=\"text-sm text-neutral-400\">Your Weight</p>\n   627â†’                      <p className=\"text-lg font-semibold text-white\">\n   628â†’                        {weightInputMode === 'imperial'\n   629â†’                          ? `${Math.round(weightKg * 2.20462)} lbs (${weightKg} kg)`\n   630â†’                          : `${weightKg} kg (${Math.round(weightKg * 2.20462)} lbs)`}\n   631â†’                      </p>\n   632â†’                    </div>\n   633â†’                  </div>\n   634â†’                  {bmi && (\n   635â†’                    <div className=\"text-right\">\n   636â†’                      <p className=\"text-sm text-neutral-400\">BMI</p>\n   637â†’                      <p className={`text-lg font-bold ${getBMIInfo(bmi).color}`}>\n   638â†’                        {bmi.toFixed(1)}\n   639â†’                      </p>\n   640â†’                      <p className={`text-xs ${getBMIInfo(bmi).color}`}>\n   641â†’                        {getBMIInfo(bmi).category}\n   642â†’                      </p>\n   643â†’                    </div>\n   644â†’                  )}\n   645â†’                </div>\n   646â†’              )}\n   647â†’            </motion.div>\n   648â†’          )}\n   649â†’\n   650â†’          {/* Body Composition - FFMI based scoring */}\n   651â†’          {pslResult.breakdown.bodyInfo?.method !== 'default' ? (\n   652â†’            <BodyCompositionCard\n   653â†’              ffmiData={pslResult.breakdown.bodyInfo?.ffmiData}\n   654â†’              bodyFatPercent={physiqueAnalysis?.bodyFatPercent}\n   655â†’              muscleLevel={physiqueAnalysis?.muscleMass}\n   656â†’              bodyScoreMethod={pslResult.breakdown.bodyInfo?.method || 'default'}\n   657â†’              bodyRating={pslResult.breakdown.body.raw}\n   658â†’              gender={gender || 'male'}\n   659â†’              weightInputMode={weightInputMode}\n   660â†’            />\n   661â†’          ) : (\n   662â†’            <AddPhysiquePrompt />\n   663â†’          )}\n   664â†’\n   665â†’          {/* Recommended Guides for PSL improvement */}\n   666â†’          <PSLRecommendedGuides onOpenGuide={handleOpenGuide} />\n   667â†’\n   668â†’          {/* Tier comparison */}\n   669â†’          <TierComparisonChart\n   670â†’            currentTier={pslResult.tier}\n   671â†’            currentScore={pslResult.score}\n   672â†’          />\n   673â†’\n   674â†’          {/* Formula explainer */}\n   675â†’          <PSLFormulaExplainer bodyMethod={pslResult.breakdown.bodyInfo?.method} />\n   676â†’\n   677â†’          {/* Potential improvements */}\n   678â†’          {pslResult.potential > pslResult.score && (\n   679â†’            <motion.div\n   680â†’              initial={{ opacity: 0 }}\n   681â†’              animate={{ opacity: 1 }}\n   682â†’              transition={{ delay: 0.4 }}\n   683â†’              className=\"bg-gradient-to-r from-green-500/10 to-cyan-500/10 rounded-xl p-6 border border-green-500/20\"\n   684â†’            >\n   685â†’              <div className=\"flex items-center gap-3 mb-4\">\n   686â†’                <TrendingUp className=\"w-6 h-6 text-green-400\" />\n   687â†’                <h3 className=\"font-semibold text-white\">Improvement Potential</h3>\n   688â†’              </div>\n   689â†’\n   690â†’              <div className=\"grid grid-cols-2 gap-4 mb-4\">\n   691â†’                <div className=\"bg-neutral-900/50 rounded-lg p-4 text-center\">\n   692â†’                  <p className=\"text-sm text-neutral-400 mb-1\">Current</p>\n   693â†’                  <p className=\"text-2xl font-bold text-white\">{pslResult.score.toFixed(2)}</p>\n   694â†’                  <PSLTierBadge tier={pslResult.tier} size=\"sm\" />\n   695â†’                </div>\n   696â†’                <div className=\"bg-neutral-900/50 rounded-lg p-4 text-center\">\n   697â†’                  <p className=\"text-sm text-neutral-400 mb-1\">Potential</p>\n   698â†’                  <p className=\"text-2xl font-bold text-green-400\">{pslResult.potential.toFixed(2)}</p>\n   699â†’                  <p className=\"text-xs text-green-400 mt-1\">\n   700â†’                    +{(pslResult.potential - pslResult.score).toFixed(2)} gain\n   701â†’                  </p>\n   702â†’                </div>\n   703â†’              </div>\n   704â†’\n   705â†’              <div className=\"space-y-2 text-sm text-neutral-400\">\n   706â†’                <p>To reach your potential:</p>\n   707â†’                <ul className=\"list-disc list-inside space-y-1 text-neutral-300\">\n   708â†’                  <li>Optimize body composition (target 12-15% body fat)</li>\n   709â†’                  <li>Follow personalized skincare and grooming</li>\n   710â†’                  <li>Address soft tissue improvements from your plan</li>\n   711â†’                </ul>\n   712â†’              </div>\n   713â†’            </motion.div>\n   714â†’          )}\n   715â†’        </div>\n   716â†’      )}\n   717â†’\n   718â†’      {/* Info section */}\n   719â†’      <motion.div\n   720â†’        initial={{ opacity: 0 }}\n   721â†’        animate={{ opacity: 1 }}\n   722â†’        transition={{ delay: 0.5 }}\n   723â†’        className=\"mt-6 p-4 bg-neutral-900/50 rounded-lg border border-neutral-800\"\n   724â†’      >\n   725â†’        <div className=\"flex items-start gap-2\">\n   726â†’          <Info className=\"w-4 h-4 text-neutral-500 flex-shrink-0 mt-0.5\" />\n   727â†’          <p className=\"text-xs text-neutral-500\">\n   728â†’            PSL (Pretty Scale Level) is a comprehensive attractiveness rating that combines\n   729â†’            facial harmony (75%), height (20%), and body composition (5%). Bonuses are applied\n   730â†’            for exceptional scores (â‰¥8.5) in any category, with synergy bonuses for multiple\n   731â†’            high-scoring areas.\n   732â†’          </p>\n   733â†’        </div>\n   734â†’      </motion.div>\n   735â†’    </TabContent>\n   736â†’  );\n   737â†’}\n   738â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"6ff5729d-bcbb-48c9-857f-57ee45c906bd","timestamp":"2025-12-26T13:41:40.715Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/PSLTab.tsx","content":"'use client';\n\nimport { useMemo, useState } from 'react';\nimport { motion } from 'framer-motion';\nimport {\n  Ruler,\n  Scale,\n  Info,\n  TrendingUp,\n  Calculator,\n  AlertCircle,\n  Dumbbell,\n  Camera,\n  Percent,\n  BookOpen,\n  Clock,\n  ArrowRight,\n  Brain,\n  Wrench,\n  TrendingDown,\n  Calendar,\n  Target,\n  Heart,\n  Utensils,\n  Droplet,\n} from 'lucide-react';\nimport { useResults } from '@/contexts/ResultsContext';\nimport { Guide } from '@/types/guides';\nimport { getGuideById } from '@/data/guides';\nimport { useHeightOptional } from '@/contexts/HeightContext';\nimport { useWeightOptional } from '@/contexts/WeightContext';\nimport { usePhysiqueOptional } from '@/contexts/PhysiqueContext';\nimport { TabContent } from '../ResultsLayout';\nimport { PSLScoreCard } from '@/components/psl/PSLScoreCard';\nimport { PSLTierBadge } from '@/components/psl/PSLTierBadge';\nimport { calculatePSL, getHeightRating, cmToFeetInches } from '@/lib/psl-calculator';\nimport { getFFMICategoryColor, getFFMICategoryDescription } from '@/lib/ffmi-calculator';\nimport { TIER_DEFINITIONS, PSLResult, MuscleLevel, FFMIData } from '@/types/psl';\nimport Link from 'next/link';\n\n// Height input form for users who skipped height entry\nfunction HeightInputPrompt({ onHeightSet }: { onHeightSet: (cm: number) => void }) {\n  const [feet, setFeet] = useState(5);\n  const [inches, setInches] = useState(9);\n\n  const handleSubmit = () => {\n    const totalInches = feet * 12 + inches;\n    const cm = Math.round(totalInches * 2.54);\n    onHeightSet(cm);\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n    >\n      <div className=\"flex items-center gap-3 mb-4\">\n        <div className=\"w-10 h-10 rounded-lg bg-cyan-500/20 flex items-center justify-center\">\n          <Ruler className=\"w-5 h-5 text-cyan-400\" />\n        </div>\n        <div>\n          <h3 className=\"font-semibold text-white\">Enter Your Height</h3>\n          <p className=\"text-sm text-neutral-400\">Required for PSL calculation</p>\n        </div>\n      </div>\n\n      <div className=\"flex items-center gap-4 mb-4\">\n        <div className=\"flex-1\">\n          <label className=\"text-xs text-neutral-500 mb-1 block\">Feet</label>\n          <select\n            value={feet}\n            onChange={(e) => setFeet(Number(e.target.value))}\n            className=\"w-full bg-neutral-800 border border-neutral-700 rounded-lg px-3 py-2 text-white\"\n          >\n            {[4, 5, 6, 7].map((f) => (\n              <option key={f} value={f}>{f}&apos;</option>\n            ))}\n          </select>\n        </div>\n        <div className=\"flex-1\">\n          <label className=\"text-xs text-neutral-500 mb-1 block\">Inches</label>\n          <select\n            value={inches}\n            onChange={(e) => setInches(Number(e.target.value))}\n            className=\"w-full bg-neutral-800 border border-neutral-700 rounded-lg px-3 py-2 text-white\"\n          >\n            {[0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11].map((i) => (\n              <option key={i} value={i}>{i}&quot;</option>\n            ))}\n          </select>\n        </div>\n      </div>\n\n      <button\n        onClick={handleSubmit}\n        className=\"w-full py-2.5 bg-cyan-500 text-black font-medium rounded-lg hover:bg-cyan-400 transition-colors\"\n      >\n        Calculate PSL\n      </button>\n    </motion.div>\n  );\n}\n\n// Tier comparison visualization\nfunction TierComparisonChart({ currentTier, currentScore }: { currentTier: string; currentScore: number }) {\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      transition={{ delay: 0.2 }}\n      className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n    >\n      <h3 className=\"font-semibold text-white mb-4\">Tier Distribution</h3>\n\n      <div className=\"space-y-3\">\n        {TIER_DEFINITIONS.slice().reverse().map((tier) => {\n          const isCurrentTier = tier.name === currentTier;\n          const isPassed = currentScore >= tier.minScore;\n\n          return (\n            <div key={tier.name} className=\"flex items-center gap-3\">\n              <div\n                className={`w-24 text-xs font-medium truncate ${\n                  isCurrentTier ? 'text-white' : 'text-neutral-500'\n                }`}\n              >\n                {tier.name}\n              </div>\n\n              <div className=\"flex-1 h-3 bg-neutral-800 rounded-full overflow-hidden relative\">\n                {/* Tier range */}\n                <div\n                  className=\"absolute inset-y-0 rounded-full transition-all\"\n                  style={{\n                    left: `${(tier.minScore / 10) * 100}%`,\n                    right: `${100 - (tier.maxScore / 10) * 100}%`,\n                    backgroundColor: isPassed ? tier.color : `${tier.color}40`,\n                  }}\n                />\n\n                {/* Current score marker */}\n                {isCurrentTier && (\n                  <motion.div\n                    initial={{ scale: 0 }}\n                    animate={{ scale: 1 }}\n                    className=\"absolute top-1/2 -translate-y-1/2 w-4 h-4 rounded-full bg-white border-2 shadow-lg\"\n                    style={{\n                      left: `${(currentScore / 10) * 100}%`,\n                      borderColor: tier.color,\n                      transform: 'translateX(-50%) translateY(-50%)',\n                    }}\n                  />\n                )}\n              </div>\n\n              <div className={`w-16 text-right text-xs ${\n                isCurrentTier ? 'text-white font-semibold' : 'text-neutral-500'\n              }`}>\n                {tier.minScore.toFixed(1)} - {tier.maxScore.toFixed(1)}\n              </div>\n            </div>\n          );\n        })}\n      </div>\n\n      {/* Score scale */}\n      <div className=\"flex justify-between mt-4 text-xs text-neutral-500\">\n        <span>0</span>\n        <span>2</span>\n        <span>4</span>\n        <span>6</span>\n        <span>8</span>\n        <span>10</span>\n      </div>\n    </motion.div>\n  );\n}\n\n// PSL Formula explanation\nfunction PSLFormulaExplainer({ bodyMethod }: { bodyMethod?: 'ffmi' | 'table' | 'default' }) {\n  const bodyDescription = bodyMethod === 'ffmi'\n    ? 'Body composition via FFMI (5% weight) - calculated from your height, weight, and body fat'\n    : bodyMethod === 'table'\n    ? 'Body composition (5% weight) - based on body fat % and muscle level'\n    : 'Body composition (5% weight) - defaults to 5/10 without physique data';\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      transition={{ delay: 0.3 }}\n      className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n    >\n      <div className=\"flex items-center gap-2 mb-4\">\n        <Calculator className=\"w-5 h-5 text-cyan-400\" />\n        <h3 className=\"font-semibold text-white\">How PSL is Calculated</h3>\n      </div>\n\n      <div className=\"bg-neutral-800/50 rounded-lg p-4 mb-4 font-mono text-sm\">\n        <span className=\"text-cyan-400\">PSL</span>\n        <span className=\"text-neutral-400\"> = </span>\n        <span className=\"text-purple-400\">(Face Ã— 0.75)</span>\n        <span className=\"text-neutral-400\"> + </span>\n        <span className=\"text-green-400\">(Height Ã— 0.20)</span>\n        <span className=\"text-neutral-400\"> + </span>\n        <span className=\"text-orange-400\">(Body Ã— 0.05)</span>\n        <span className=\"text-neutral-400\"> + </span>\n        <span className=\"text-yellow-400\">Bonuses</span>\n      </div>\n\n      <div className=\"space-y-3 text-sm\">\n        <div className=\"flex items-start gap-2\">\n          <span className=\"text-purple-400 font-semibold w-16\">Face</span>\n          <span className=\"text-neutral-400\">\n            Your facial harmony score (75% weight) - the primary driver of attractiveness\n          </span>\n        </div>\n        <div className=\"flex items-start gap-2\">\n          <span className=\"text-green-400 font-semibold w-16\">Height</span>\n          <span className=\"text-neutral-400\">\n            Your height rating (20% weight) - varies by gender\n          </span>\n        </div>\n        <div className=\"flex items-start gap-2\">\n          <span className=\"text-orange-400 font-semibold w-16\">Body</span>\n          <span className=\"text-neutral-400\">\n            {bodyDescription}\n          </span>\n        </div>\n        <div className=\"flex items-start gap-2\">\n          <span className=\"text-yellow-400 font-semibold w-16\">Bonuses</span>\n          <span className=\"text-neutral-400\">\n            Threshold (+0.1-0.3) and synergy (+0.05-0.35) bonuses for elite scores (â‰¥8.5)\n          </span>\n        </div>\n      </div>\n\n      <div className=\"mt-4 p-3 bg-amber-500/10 border border-amber-500/30 rounded-lg flex items-start gap-2\">\n        <AlertCircle className=\"w-4 h-4 text-amber-400 flex-shrink-0 mt-0.5\" />\n        <p className=\"text-xs text-amber-200\">\n          Height â‰¥8.0 rating is required to reach Gigachad tier. Major facial flaws cap your tier regardless of score.\n        </p>\n      </div>\n    </motion.div>\n  );\n}\n\n// BMI category helper\nfunction getBMIInfo(bmi: number): { category: string; color: string } {\n  if (bmi < 18.5) return { category: 'Underweight', color: 'text-yellow-400' };\n  if (bmi < 25) return { category: 'Normal', color: 'text-green-400' };\n  if (bmi < 30) return { category: 'Overweight', color: 'text-orange-400' };\n  return { category: 'Obese', color: 'text-red-400' };\n}\n\n// Body Composition Card - shows FFMI, body fat %, and muscle level\nfunction BodyCompositionCard({\n  ffmiData,\n  bodyFatPercent,\n  muscleLevel,\n  bodyScoreMethod,\n  bodyRating,\n  gender,\n  weightInputMode = 'imperial',\n}: {\n  ffmiData?: FFMIData;\n  bodyFatPercent?: number;\n  muscleLevel?: string;\n  bodyScoreMethod: 'ffmi' | 'table' | 'default';\n  bodyRating: number;\n  gender: 'male' | 'female';\n  weightInputMode?: 'metric' | 'imperial';\n}) {\n  if (bodyScoreMethod === 'default') return null;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ delay: 0.15 }}\n      className=\"bg-neutral-900 rounded-xl p-4 border border-neutral-800\"\n    >\n      <div className=\"flex items-center gap-2 mb-4\">\n        <Dumbbell className=\"w-5 h-5 text-orange-400\" />\n        <h3 className=\"font-semibold text-white\">Body Composition</h3>\n        {bodyScoreMethod === 'ffmi' && (\n          <span className=\"ml-auto text-xs bg-orange-500/20 text-orange-400 px-2 py-0.5 rounded-full\">\n            FFMI\n          </span>\n        )}\n      </div>\n\n      <div className=\"grid grid-cols-2 gap-4\">\n        {/* Body Score */}\n        <div className=\"bg-neutral-800/50 rounded-lg p-3 text-center\">\n          <p className=\"text-xs text-neutral-400 mb-1\">Body Score</p>\n          <p className=\"text-xl font-bold text-orange-400\">{bodyRating.toFixed(1)}/10</p>\n          <p className=\"text-xs text-neutral-500 mt-1\">5% of PSL</p>\n        </div>\n\n        {/* FFMI */}\n        {ffmiData && (\n          <div className=\"bg-neutral-800/50 rounded-lg p-3 text-center\">\n            <p className=\"text-xs text-neutral-400 mb-1\">FFMI</p>\n            <p className=\"text-xl font-bold\" style={{ color: getFFMICategoryColor(ffmiData.category as 'Below Average' | 'Average' | 'Above Average' | 'Excellent' | 'Elite') }}>\n              {ffmiData.normalizedFFMI.toFixed(1)}\n            </p>\n            <p className=\"text-xs\" style={{ color: getFFMICategoryColor(ffmiData.category as 'Below Average' | 'Average' | 'Above Average' | 'Excellent' | 'Elite') }}>\n              {ffmiData.category}\n            </p>\n          </div>\n        )}\n\n        {/* Body Fat */}\n        {bodyFatPercent !== undefined && (\n          <div className=\"bg-neutral-800/50 rounded-lg p-3 text-center\">\n            <p className=\"text-xs text-neutral-400 mb-1\">Body Fat</p>\n            <p className=\"text-xl font-bold text-cyan-400\">{bodyFatPercent}%</p>\n            <p className=\"text-xs text-neutral-500 mt-1\">\n              {bodyFatPercent < 10 ? 'Very Lean' :\n               bodyFatPercent < 15 ? 'Lean' :\n               bodyFatPercent < 20 ? 'Athletic' :\n               bodyFatPercent < 25 ? 'Average' : 'Above Average'}\n            </p>\n          </div>\n        )}\n\n        {/* Lean Mass */}\n        {ffmiData && (\n          <div className=\"bg-neutral-800/50 rounded-lg p-3 text-center\">\n            <p className=\"text-xs text-neutral-400 mb-1\">Lean Mass</p>\n            <p className=\"text-xl font-bold text-green-400\">\n              {weightInputMode === 'imperial'\n                ? `${Math.round(ffmiData.leanMassKg * 2.20462)} lbs`\n                : `${ffmiData.leanMassKg.toFixed(1)} kg`}\n            </p>\n            <p className=\"text-xs text-neutral-500 mt-1\">\n              {weightInputMode === 'imperial'\n                ? `${ffmiData.leanMassKg.toFixed(1)} kg`\n                : `${Math.round(ffmiData.leanMassKg * 2.20462)} lbs`}\n            </p>\n          </div>\n        )}\n\n        {/* Muscle Level (if no FFMI) */}\n        {!ffmiData && muscleLevel && (\n          <div className=\"bg-neutral-800/50 rounded-lg p-3 text-center\">\n            <p className=\"text-xs text-neutral-400 mb-1\">Muscle Level</p>\n            <p className=\"text-lg font-bold text-purple-400 capitalize\">{muscleLevel}</p>\n          </div>\n        )}\n      </div>\n\n      {/* FFMI Description */}\n      {ffmiData && (\n        <p className=\"mt-3 text-xs text-neutral-400\">\n          {getFFMICategoryDescription(ffmiData.category as 'Below Average' | 'Average' | 'Above Average' | 'Excellent' | 'Elite', gender)}\n        </p>\n      )}\n    </motion.div>\n  );\n}\n\n// Prompt to add physique photos\nfunction AddPhysiquePrompt() {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ delay: 0.15 }}\n      className=\"bg-neutral-900 rounded-xl p-4 border border-neutral-800 border-dashed\"\n    >\n      <div className=\"flex items-center gap-3\">\n        <div className=\"w-10 h-10 rounded-lg bg-orange-500/20 flex items-center justify-center\">\n          <Camera className=\"w-5 h-5 text-orange-400\" />\n        </div>\n        <div className=\"flex-1\">\n          <h3 className=\"font-semibold text-white\">Add Body Photos</h3>\n          <p className=\"text-sm text-neutral-400\">\n            Get accurate FFMI-based body scoring with physique photos\n          </p>\n        </div>\n        <Link\n          href=\"/physique\"\n          className=\"px-4 py-2 bg-orange-500/20 text-orange-400 rounded-lg text-sm font-medium hover:bg-orange-500/30 transition-colors\"\n        >\n          Add Photos\n        </Link>\n      </div>\n      <div className=\"mt-3 flex items-center gap-2 text-xs text-neutral-500\">\n        <Percent className=\"w-3 h-3\" />\n        <span>Currently using default body score (5.0/10)</span>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// RECOMMENDED GUIDES SECTION (PSL-specific)\n// ============================================\n\n// Icon mapping for guides\nconst GUIDE_ICON_MAP: Record<string, React.ReactNode> = {\n  BookOpen: <BookOpen size={18} />,\n  Dumbbell: <Dumbbell size={18} />,\n  Brain: <Brain size={18} />,\n  Wrench: <Wrench size={18} />,\n  TrendingDown: <TrendingDown size={18} />,\n  Calendar: <Calendar size={18} />,\n  Target: <Target size={18} />,\n  Heart: <Heart size={18} />,\n  Utensils: <Utensils size={18} />,\n  Droplet: <Droplet size={18} />,\n};\n\n// PSL improvement guides - focused on body composition and physique\nconst PSL_GUIDE_IDS = ['body-fat', 'v-taper', 'training', 'diet', 'cardio', 'skincare'];\n\nfunction PSLRecommendedGuides({ onOpenGuide }: { onOpenGuide: () => void }) {\n  const guides = PSL_GUIDE_IDS\n    .map((id) => getGuideById(id))\n    .filter((g): g is Guide => g !== undefined)\n    .slice(0, 3);\n\n  if (guides.length === 0) return null;\n\n  return (\n    <motion.div\n      initial={{ opacity: 0 }}\n      animate={{ opacity: 1 }}\n      transition={{ delay: 0.35 }}\n      className=\"bg-neutral-900 rounded-xl p-6 border border-neutral-800\"\n    >\n      <div className=\"flex items-center gap-2 mb-4\">\n        <BookOpen className=\"w-5 h-5 text-cyan-400\" />\n        <h3 className=\"font-semibold text-white\">Improvement Guides</h3>\n        <span className=\"px-2 py-0.5 text-xs font-medium rounded border bg-green-500/20 text-green-400 border-green-500/40\">\n          PSL Boost\n        </span>\n      </div>\n\n      <p className=\"text-sm text-neutral-400 mb-4\">\n        Optimize your body composition and physique to maximize your PSL score\n      </p>\n\n      <div className=\"grid gap-3 md:grid-cols-3\">\n        {guides.map((guide) => (\n          <div\n            key={guide.id}\n            onClick={onOpenGuide}\n            className=\"group bg-neutral-800/50 hover:bg-neutral-800 rounded-lg p-4 border border-neutral-700 hover:border-green-500/30 transition-all cursor-pointer\"\n          >\n            <div className=\"flex items-center gap-3 mb-2\">\n              <div className=\"w-10 h-10 rounded-lg bg-gradient-to-br from-green-500/20 to-cyan-500/20 flex items-center justify-center text-green-400 flex-shrink-0\">\n                {GUIDE_ICON_MAP[guide.icon] || <BookOpen size={18} />}\n              </div>\n              <h4 className=\"font-medium text-white group-hover:text-green-400 transition-colors text-sm line-clamp-1\">\n                {guide.title}\n              </h4>\n            </div>\n            <p className=\"text-xs text-neutral-400 line-clamp-2 mb-2\">\n              {guide.description}\n            </p>\n            <div className=\"flex items-center justify-between\">\n              <div className=\"flex items-center gap-1 text-xs text-neutral-500\">\n                <Clock size={12} />\n                <span>{guide.estimatedReadTime} min</span>\n              </div>\n              <span className=\"text-xs text-green-400 opacity-0 group-hover:opacity-100 transition-opacity flex items-center gap-1\">\n                Read\n                <ArrowRight className=\"w-3 h-3\" />\n              </span>\n            </div>\n          </div>\n        ))}\n      </div>\n\n      <button\n        onClick={onOpenGuide}\n        className=\"w-full mt-4 flex items-center justify-center gap-2 py-2 text-sm text-neutral-400 hover:text-white transition-colors\"\n      >\n        <span>View all guides</span>\n        <ArrowRight className=\"w-4 h-4\" />\n      </button>\n    </motion.div>\n  );\n}\n\n// Map physique muscle mass string to MuscleLevel type\nfunction mapMuscleLevel(muscleMass: string | undefined): MuscleLevel | undefined {\n  if (!muscleMass) return undefined;\n  const mapping: Record<string, MuscleLevel> = {\n    'low': 'low',\n    'medium': 'medium',\n    'medium-high': 'medium-high',\n    'high': 'high',\n    'very-high': 'very-high',\n    'extreme': 'extreme',\n  };\n  return mapping[muscleMass] || 'medium';\n}\n\n// Main PSL Tab component\nexport function PSLTab() {\n  const { overallScore, gender, setActiveTab } = useResults();\n  const heightContext = useHeightOptional();\n  const weightContext = useWeightOptional();\n  const physiqueContext = usePhysiqueOptional();\n\n  // Local state for height if context not available\n  const [localHeightCm, setLocalHeightCm] = useState<number | null>(null);\n\n  // Handle guide opening - navigate to guides tab\n  const handleOpenGuide = () => {\n    setActiveTab('guides');\n  };\n\n  // Get height and weight from context or local state\n  const heightCm = heightContext?.heightCm ?? localHeightCm;\n  const setHeightCm = heightContext?.setHeightCm ?? setLocalHeightCm;\n  const heightInputMode = heightContext?.inputMode ?? 'imperial';\n  const weightKg = weightContext?.weightKg ?? null;\n  const weightInputMode = weightContext?.inputMode ?? 'imperial';\n  const bmi = weightContext?.bmi ?? null;\n\n  // Get physique analysis from context\n  const physiqueAnalysis = physiqueContext?.physiqueAnalysis ?? null;\n\n  // Calculate PSL using the face score, height, and body analysis\n  const pslResult: PSLResult | null = useMemo(() => {\n    if (!heightCm || !overallScore) return null;\n\n    // Use the overall harmony score as the face score\n    const faceScore = typeof overallScore === 'number' ? overallScore : 0;\n    const currentGender = gender || 'male';\n\n    // Build body analysis if physique data is available\n    const bodyAnalysis = physiqueAnalysis ? {\n      bodyFatPercent: physiqueAnalysis.bodyFatPercent,\n      muscleLevel: mapMuscleLevel(physiqueAnalysis.muscleMass) || 'medium',\n      weightKg: weightKg ?? undefined,\n    } : undefined;\n\n    return calculatePSL({\n      faceScore,\n      heightCm,\n      gender: currentGender,\n      bodyAnalysis,\n      weightKg: weightKg ?? undefined, // Pass weight for FFMI calculation\n    });\n  }, [heightCm, overallScore, gender, physiqueAnalysis, weightKg]);\n\n  // Get height rating for display\n  const heightRating = heightCm ? getHeightRating(heightCm, gender || 'male') : null;\n  const heightDisplay = heightCm ? cmToFeetInches(heightCm) : null;\n\n  // Format inches for display (show .5 for half inches, otherwise whole number)\n  const formatInches = (inches: number): string => {\n    return Number.isInteger(inches) ? inches.toString() : inches.toFixed(1);\n  };\n\n  return (\n    <TabContent\n      title=\"PSL Rating\"\n      subtitle=\"Your Pretty Scale Level score based on face, height, and body\"\n    >\n      {/* Height prompt if not set */}\n      {!heightCm && (\n        <div className=\"mb-6\">\n          <HeightInputPrompt onHeightSet={setHeightCm} />\n        </div>\n      )}\n\n      {/* PSL Results */}\n      {pslResult && (\n        <div className=\"space-y-6\">\n          {/* Main score card */}\n          <PSLScoreCard psl={pslResult} showBreakdown showPotential />\n\n          {/* Height & Weight info */}\n          {(heightDisplay || weightKg) && (\n            <motion.div\n              initial={{ opacity: 0, y: 10 }}\n              animate={{ opacity: 1, y: 0 }}\n              className=\"bg-neutral-900 rounded-xl p-4 border border-neutral-800 space-y-4\"\n            >\n              {/* Height */}\n              {heightDisplay && (\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-10 h-10 rounded-lg bg-green-500/20 flex items-center justify-center\">\n                      <Ruler className=\"w-5 h-5 text-green-400\" />\n                    </div>\n                    <div>\n                      <p className=\"text-sm text-neutral-400\">Your Height</p>\n                      <p className=\"text-lg font-semibold text-white\">\n                        {heightInputMode === 'imperial'\n                          ? `${heightDisplay.feet}'${formatInches(heightDisplay.inches)}\" (${heightCm}cm)`\n                          : `${heightCm}cm (${heightDisplay.feet}'${formatInches(heightDisplay.inches)}\")`}\n                      </p>\n                    </div>\n                  </div>\n                  <div className=\"text-right\">\n                    <p className=\"text-sm text-neutral-400\">Height Rating</p>\n                    <p className=\"text-lg font-bold text-green-400\">\n                      {heightRating?.toFixed(1)}/10\n                    </p>\n                  </div>\n                </div>\n              )}\n\n              {/* Divider */}\n              {heightDisplay && weightKg && (\n                <div className=\"border-t border-neutral-800\" />\n              )}\n\n              {/* Weight & BMI */}\n              {weightKg && (\n                <div className=\"flex items-center justify-between\">\n                  <div className=\"flex items-center gap-3\">\n                    <div className=\"w-10 h-10 rounded-lg bg-purple-500/20 flex items-center justify-center\">\n                      <Scale className=\"w-5 h-5 text-purple-400\" />\n                    </div>\n                    <div>\n                      <p className=\"text-sm text-neutral-400\">Your Weight</p>\n                      <p className=\"text-lg font-semibold text-white\">\n                        {weightInputMode === 'imperial'\n                          ? `${Math.round(weightKg * 2.20462)} lbs (${weightKg} kg)`\n                          : `${weightKg} kg (${Math.round(weightKg * 2.20462)} lbs)`}\n                      </p>\n                    </div>\n                  </div>\n                  {bmi && (\n                    <div className=\"text-right\">\n                      <p className=\"text-sm text-neutral-400\">BMI</p>\n                      <p className={`text-lg font-bold ${getBMIInfo(bmi).color}`}>\n                        {bmi.toFixed(1)}\n                      </p>\n                      <p className={`text-xs ${getBMIInfo(bmi).color}`}>\n                        {getBMIInfo(bmi).category}\n                      </p>\n                    </div>\n                  )}\n                </div>\n              )}\n            </motion.div>\n          )}\n\n          {/* Body Composition - FFMI based scoring */}\n          {pslResult.breakdown.bodyInfo?.method !== 'default' ? (\n            <BodyCompositionCard\n              ffmiData={pslResult.breakdown.bodyInfo?.ffmiData}\n              bodyFatPercent={physiqueAnalysis?.bodyFatPercent}\n              muscleLevel={physiqueAnalysis?.muscleMass}\n              bodyScoreMethod={pslResult.breakdown.bodyInfo?.method || 'default'}\n              bodyRating={pslResult.breakdown.body.raw}\n              gender={gender || 'male'}\n              weightInputMode={weightInputMode}\n            />\n          ) : (\n            <AddPhysiquePrompt />\n          )}\n\n          {/* Recommended Guides for PSL improvement */}\n          <PSLRecommendedGuides onOpenGuide={handleOpenGuide} />\n\n          {/* Tier comparison */}\n          <TierComparisonChart\n            currentTier={pslResult.tier}\n            currentScore={pslResult.score}\n          />\n\n          {/* Formula explainer */}\n          <PSLFormulaExplainer bodyMethod={pslResult.breakdown.bodyInfo?.method} />\n\n          {/* Potential improvements */}\n          {pslResult.potential > pslResult.score && (\n            <motion.div\n              initial={{ opacity: 0 }}\n              animate={{ opacity: 1 }}\n              transition={{ delay: 0.4 }}\n              className=\"bg-gradient-to-r from-green-500/10 to-cyan-500/10 rounded-xl p-6 border border-green-500/20\"\n            >\n              <div className=\"flex items-center gap-3 mb-4\">\n                <TrendingUp className=\"w-6 h-6 text-green-400\" />\n                <h3 className=\"font-semibold text-white\">Improvement Potential</h3>\n              </div>\n\n              <div className=\"grid grid-cols-2 gap-4 mb-4\">\n                <div className=\"bg-neutral-900/50 rounded-lg p-4 text-center\">\n                  <p className=\"text-sm text-neutral-400 mb-1\">Current</p>\n                  <p className=\"text-2xl font-bold text-white\">{pslResult.score.toFixed(2)}</p>\n                  <PSLTierBadge tier={pslResult.tier} size=\"sm\" />\n                </div>\n                <div className=\"bg-neutral-900/50 rounded-lg p-4 text-center\">\n                  <p className=\"text-sm text-neutral-400 mb-1\">Potential</p>\n                  <p className=\"text-2xl font-bold text-green-400\">{pslResult.potential.toFixed(2)}</p>\n                  <p className=\"text-xs text-green-400 mt-1\">\n                    +{(pslResult.potential - pslResult.score).toFixed(2)} gain\n                  </p>\n                </div>\n              </div>\n\n              <div className=\"space-y-2 text-sm text-neutral-400\">\n                <p>To reach your potential:</p>\n                <ul className=\"list-disc list-inside space-y-1 text-neutral-300\">\n                  <li>Optimize body composition (target 12-15% body fat)</li>\n                  <li>Follow personalized skincare and grooming</li>\n                  <li>Address soft tissue improvements from your plan</li>\n                </ul>\n              </div>\n            </motion.div>\n          )}\n        </div>\n      )}\n\n      {/* Info section */}\n      <motion.div\n        initial={{ opacity: 0 }}\n        animate={{ opacity: 1 }}\n        transition={{ delay: 0.5 }}\n        className=\"mt-6 p-4 bg-neutral-900/50 rounded-lg border border-neutral-800\"\n      >\n        <div className=\"flex items-start gap-2\">\n          <Info className=\"w-4 h-4 text-neutral-500 flex-shrink-0 mt-0.5\" />\n          <p className=\"text-xs text-neutral-500\">\n            PSL (Pretty Scale Level) is a comprehensive attractiveness rating that combines\n            facial harmony (75%), height (20%), and body composition (5%). Bonuses are applied\n            for exceptional scores (â‰¥8.5) in any category, with synergy bonuses for multiple\n            high-scoring areas.\n          </p>\n        </div>\n      </motion.div>\n    </TabContent>\n  );\n}\n","numLines":738,"startLine":1,"totalLines":738}}}
{"parentUuid":"6ff5729d-bcbb-48c9-857f-57ee45c906bd","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01WxC4Pn8GEcUfgrH43PMGC3","type":"tool_result","content":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/RecommendationCard.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/PlanActionCard.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/EnhancedRecommendationCard.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/DailyStackCard.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/ProgressComparisonCard.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/ProductCard.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/MeasurementCard.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StreakCard.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/VisionInsightsCard.tsx\n/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/MedicalPrescriptionCard.tsx"}]},"uuid":"ec85f33f-3eb4-4246-b1fa-18c23d98e773","timestamp":"2025-12-26T13:41:41.121Z","toolUseResult":{"filenames":["/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/RecommendationCard.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/PlanActionCard.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/EnhancedRecommendationCard.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/DailyStackCard.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/ProgressComparisonCard.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/ProductCard.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/MeasurementCard.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StreakCard.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/VisionInsightsCard.tsx","/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/MedicalPrescriptionCard.tsx"],"durationMs":590,"numFiles":13,"truncated":false}}
{"parentUuid":"ec85f33f-3eb4-4246-b1fa-18c23d98e773","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01JH7a4izdnXmujW7GdaMibR","type":"tool_result","content":"Prompt is too long"}]},"uuid":"2aabaea2-0352-43bb-82dd-b4c92b56d6f1","timestamp":"2025-12-26T13:41:42.160Z","toolUseResult":{"bytes":2916375,"code":200,"codeText":"OK","result":"Prompt is too long","durationMs":1630,"url":"https://nicelydone.club/n/pages"}}
{"parentUuid":"2aabaea2-0352-43bb-82dd-b4c92b56d6f1","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_01SPHN27V2BUk4xoS56a2Zu9","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me read the card components and fetch the nicelydone.club patterns with a simpler prompt:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":38456,"cache_creation_input_tokens":586,"cache_read_input_tokens":24051,"cache_creation":{"ephemeral_5m_input_tokens":586,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVPrvz6y6U5Xi63YoRvC","type":"assistant","uuid":"cbf954e9-7b30-46f8-87ba-614af5ab0ef2","timestamp":"2025-12-26T13:41:46.262Z"}
{"parentUuid":"cbf954e9-7b30-46f8-87ba-614af5ab0ef2","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_01SPHN27V2BUk4xoS56a2Zu9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_018wqjSCV6x7npKs1NNRwgYF","name":"WebFetch","input":{"url":"https://nicelydone.club/n/pages","prompt":"List the main UI component types and design patterns shown. Focus on cards, dashboards, stats, leaderboards, badges, progress indicators."}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":38456,"cache_creation_input_tokens":586,"cache_read_input_tokens":24051,"cache_creation":{"ephemeral_5m_input_tokens":586,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVPrvz6y6U5Xi63YoRvC","type":"assistant","uuid":"7ca146f0-3cc3-4004-87e4-ea7baceca43a","timestamp":"2025-12-26T13:41:48.017Z"}
{"parentUuid":"7ca146f0-3cc3-4004-87e4-ea7baceca43a","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_01SPHN27V2BUk4xoS56a2Zu9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01LYGR3EBfYHbzKUPgPywzgj","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/ProductCard.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":38456,"cache_creation_input_tokens":586,"cache_read_input_tokens":24051,"cache_creation":{"ephemeral_5m_input_tokens":586,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVPrvz6y6U5Xi63YoRvC","type":"assistant","uuid":"2f77f683-a908-4dba-a153-5d816315c2fb","timestamp":"2025-12-26T13:41:48.789Z"}
{"parentUuid":"2f77f683-a908-4dba-a153-5d816315c2fb","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_01SPHN27V2BUk4xoS56a2Zu9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PyzzisjiFcrMs4AgUAH2mo","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/MeasurementCard.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":38456,"cache_creation_input_tokens":586,"cache_read_input_tokens":24051,"cache_creation":{"ephemeral_5m_input_tokens":586,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVPrvz6y6U5Xi63YoRvC","type":"assistant","uuid":"a895c40e-3027-4ab8-b3f4-af8729dad7bf","timestamp":"2025-12-26T13:41:49.549Z"}
{"parentUuid":"a895c40e-3027-4ab8-b3f4-af8729dad7bf","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_01SPHN27V2BUk4xoS56a2Zu9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_0113RNsDTVHXs1oz9PiTqkav","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":38456,"cache_creation_input_tokens":586,"cache_read_input_tokens":24051,"cache_creation":{"ephemeral_5m_input_tokens":586,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVPrvz6y6U5Xi63YoRvC","type":"assistant","uuid":"3158645c-8df9-4e9e-a7bd-d43a919ddc2d","timestamp":"2025-12-26T13:41:50.318Z"}
{"parentUuid":"3158645c-8df9-4e9e-a7bd-d43a919ddc2d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_01SPHN27V2BUk4xoS56a2Zu9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01Uub7iyC2cSYEptrHd7xiHG","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":38456,"cache_creation_input_tokens":586,"cache_read_input_tokens":24051,"cache_creation":{"ephemeral_5m_input_tokens":586,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVPrvz6y6U5Xi63YoRvC","type":"assistant","uuid":"42c9be8b-7977-43ee-b6ac-300dcb50684b","timestamp":"2025-12-26T13:41:51.082Z"}
{"parentUuid":"42c9be8b-7977-43ee-b6ac-300dcb50684b","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_01SPHN27V2BUk4xoS56a2Zu9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01H8xrdTyUzQGewTEAhBqQV9","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":38456,"cache_creation_input_tokens":586,"cache_read_input_tokens":24051,"cache_creation":{"ephemeral_5m_input_tokens":586,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVPrvz6y6U5Xi63YoRvC","type":"assistant","uuid":"6c9d5daf-f272-4c3f-b86c-ff57bd9717df","timestamp":"2025-12-26T13:41:51.781Z"}
{"parentUuid":"6c9d5daf-f272-4c3f-b86c-ff57bd9717df","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_01SPHN27V2BUk4xoS56a2Zu9","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_014BnrS44omDXjpGjPcxaJSg","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/DailyStackCard.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":38456,"cache_creation_input_tokens":586,"cache_read_input_tokens":24051,"cache_creation":{"ephemeral_5m_input_tokens":586,"ephemeral_1h_input_tokens":0},"output_tokens":552,"service_tier":"standard"}},"requestId":"req_011CWVPrvz6y6U5Xi63YoRvC","type":"assistant","uuid":"e66b9ee2-16b1-463d-847c-eaea3444a40e","timestamp":"2025-12-26T13:41:52.568Z"}
{"parentUuid":"e66b9ee2-16b1-463d-847c-eaea3444a40e","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01LYGR3EBfYHbzKUPgPywzgj","type":"tool_result","content":"     1â†’'use client';\n     2â†’\n     3â†’import { motion } from 'framer-motion';\n     4â†’import { ProductRecommendation } from '@/types/results';\n     5â†’import { ExternalLink, TrendingUp, Shield, DollarSign, Clock } from 'lucide-react';\n     6â†’import { getSupplementDetails } from '@/lib/daily-stack';\n     7â†’\n     8â†’interface ProductCardProps {\n     9â†’  recommendation: ProductRecommendation;\n    10â†’  rank?: number;\n    11â†’  compact?: boolean;\n    12â†’}\n    13â†’\n    14â†’export function ProductCard({ recommendation, rank, compact = false }: ProductCardProps) {\n    15â†’  const { product, state, message } = recommendation;\n    16â†’  const supplement = getSupplementDetails(product.supplementId);\n    17â†’\n    18â†’  // State-based styling\n    19â†’  const isCorrectiveState = state === 'flaw';\n    20â†’  const stateBadgeColor = isCorrectiveState\n    21â†’    ? 'bg-red-500/20 text-red-400 border-red-500/30'\n    22â†’    : 'bg-green-500/20 text-green-400 border-green-500/30';\n    23â†’  const stateBadgeText = isCorrectiveState ? 'Corrective' : 'Maintenance';\n    24â†’  const StateIcon = isCorrectiveState ? TrendingUp : Shield;\n    25â†’\n    26â†’  // CTA text\n    27â†’  const ctaText = product.affiliateType === 'amazon' ? 'View on Amazon' : 'Shop Direct';\n    28â†’\n    29â†’  // Compact mode for embedded use in WeakPointCard\n    30â†’  if (compact) {\n    31â†’    return (\n    32â†’      <motion.a\n    33â†’        href={product.affiliateLink}\n    34â†’        target=\"_blank\"\n    35â†’        rel=\"noopener noreferrer\"\n    36â†’        className=\"flex items-center gap-3 p-3 bg-neutral-800/50 rounded-lg hover:bg-neutral-800 transition-colors group\"\n    37â†’        whileHover={{ scale: 1.02 }}\n    38â†’      >\n    39â†’        <div className=\"flex-1 min-w-0\">\n    40â†’          <div className=\"flex items-center gap-2\">\n    41â†’            <h4 className=\"text-sm font-medium text-white truncate\">{product.name}</h4>\n    42â†’            <div className={`px-1.5 py-0.5 rounded text-xs font-medium ${stateBadgeColor}`}>\n    43â†’              {isCorrectiveState ? 'Fix' : 'Protect'}\n    44â†’            </div>\n    45â†’          </div>\n    46â†’          <p className=\"text-xs text-neutral-400 truncate\">{product.brand}</p>\n    47â†’        </div>\n    48â†’        {supplement && (\n    49â†’          <div className=\"text-right flex-shrink-0\">\n    50â†’            <p className=\"text-sm font-medium text-white\">\n    51â†’              ${supplement.costPerMonth.min}/mo\n    52â†’            </p>\n    53â†’          </div>\n    54â†’        )}\n    55â†’        <ExternalLink size={14} className=\"text-neutral-500 group-hover:text-cyan-400 transition-colors flex-shrink-0\" />\n    56â†’      </motion.a>\n    57â†’    );\n    58â†’  }\n    59â†’\n    60â†’  return (\n    61â†’    <motion.div\n    62â†’      className=\"bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-xl p-5 hover:border-neutral-700 transition-all\"\n    63â†’      whileHover={{ y: -2 }}\n    64â†’    >\n    65â†’      {/* Header */}\n    66â†’      <div className=\"flex items-start justify-between mb-3\">\n    67â†’        <div className=\"flex-1\">\n    68â†’          <div className=\"flex items-center gap-2 mb-1\">\n    69â†’            {rank && (\n    70â†’              <div className=\"w-6 h-6 rounded-full bg-cyan-500/20 flex items-center justify-center flex-shrink-0\">\n    71â†’                <span className=\"text-xs font-bold text-cyan-400\">{rank}</span>\n    72â†’              </div>\n    73â†’            )}\n    74â†’            <h3 className=\"font-semibold text-white\">{product.name}</h3>\n    75â†’          </div>\n    76â†’          <p className=\"text-sm text-neutral-400\">{product.brand}</p>\n    77â†’        </div>\n    78â†’\n    79â†’        <div className={`px-2 py-1 rounded-lg border text-xs font-medium flex items-center gap-1 ${stateBadgeColor}`}>\n    80â†’          <StateIcon size={12} />\n    81â†’          {stateBadgeText}\n    82â†’        </div>\n    83â†’      </div>\n    84â†’\n    85â†’      {/* Message */}\n    86â†’      <div className=\"mb-4\">\n    87â†’        <p className=\"text-sm text-neutral-300\">{message}</p>\n    88â†’        <p className=\"text-xs text-neutral-500 mt-1\">\n    89â†’          Targets: {recommendation.matchedMetrics.slice(0, 3).join(', ')}\n    90â†’          {recommendation.matchedMetrics.length > 3 && ` +${recommendation.matchedMetrics.length - 3} more`}\n    91â†’        </p>\n    92â†’      </div>\n    93â†’\n    94â†’      {/* Quick Stats */}\n    95â†’      {supplement && (\n    96â†’        <div className=\"grid grid-cols-3 gap-3 mb-4\">\n    97â†’          <div className=\"bg-neutral-800/50 rounded-lg p-2\">\n    98â†’            <div className=\"flex items-center gap-1 text-neutral-400 mb-1\">\n    99â†’              <DollarSign size={12} />\n   100â†’              <span className=\"text-xs\">Cost</span>\n   101â†’            </div>\n   102â†’            <p className=\"text-sm font-medium text-white\">\n   103â†’              ${supplement.costPerMonth.min}-${supplement.costPerMonth.max}/mo\n   104â†’            </p>\n   105â†’          </div>\n   106â†’\n   107â†’          <div className=\"bg-neutral-800/50 rounded-lg p-2\">\n   108â†’            <div className=\"flex items-center gap-1 text-neutral-400 mb-1\">\n   109â†’              <Clock size={12} />\n   110â†’              <span className=\"text-xs\">Timeline</span>\n   111â†’            </div>\n   112â†’            <p className=\"text-sm font-medium text-white\">{supplement.timelineToResults}</p>\n   113â†’          </div>\n   114â†’\n   115â†’          <div className=\"bg-neutral-800/50 rounded-lg p-2\">\n   116â†’            <div className=\"text-neutral-400 mb-1 text-xs\">Dosage</div>\n   117â†’            <p className=\"text-sm font-medium text-white\">{supplement.dosage}</p>\n   118â†’          </div>\n   119â†’        </div>\n   120â†’      )}\n   121â†’\n   122â†’      {/* CTA Button */}\n   123â†’      <a\n   124â†’        href={product.affiliateLink}\n   125â†’        target=\"_blank\"\n   126â†’        rel=\"noopener noreferrer\"\n   127â†’        className=\"block w-full bg-cyan-500 hover:bg-cyan-400 text-black font-medium py-2.5 px-4 rounded-lg transition-colors text-center\"\n   128â†’      >\n   129â†’        <span className=\"flex items-center justify-center gap-2\">\n   130â†’          {ctaText}\n   131â†’          <ExternalLink size={16} />\n   132â†’        </span>\n   133â†’      </a>\n   134â†’\n   135â†’      {/* Affiliate Disclosure */}\n   136â†’      <p className=\"text-xs text-neutral-600 text-center mt-2\">\n   137â†’        We may earn a commission from purchases made through this link.\n   138â†’      </p>\n   139â†’    </motion.div>\n   140â†’  );\n   141â†’}\n   142â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"425974b7-5d5c-4855-833a-336a0eced736","timestamp":"2025-12-26T13:41:52.645Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/ProductCard.tsx","content":"'use client';\n\nimport { motion } from 'framer-motion';\nimport { ProductRecommendation } from '@/types/results';\nimport { ExternalLink, TrendingUp, Shield, DollarSign, Clock } from 'lucide-react';\nimport { getSupplementDetails } from '@/lib/daily-stack';\n\ninterface ProductCardProps {\n  recommendation: ProductRecommendation;\n  rank?: number;\n  compact?: boolean;\n}\n\nexport function ProductCard({ recommendation, rank, compact = false }: ProductCardProps) {\n  const { product, state, message } = recommendation;\n  const supplement = getSupplementDetails(product.supplementId);\n\n  // State-based styling\n  const isCorrectiveState = state === 'flaw';\n  const stateBadgeColor = isCorrectiveState\n    ? 'bg-red-500/20 text-red-400 border-red-500/30'\n    : 'bg-green-500/20 text-green-400 border-green-500/30';\n  const stateBadgeText = isCorrectiveState ? 'Corrective' : 'Maintenance';\n  const StateIcon = isCorrectiveState ? TrendingUp : Shield;\n\n  // CTA text\n  const ctaText = product.affiliateType === 'amazon' ? 'View on Amazon' : 'Shop Direct';\n\n  // Compact mode for embedded use in WeakPointCard\n  if (compact) {\n    return (\n      <motion.a\n        href={product.affiliateLink}\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        className=\"flex items-center gap-3 p-3 bg-neutral-800/50 rounded-lg hover:bg-neutral-800 transition-colors group\"\n        whileHover={{ scale: 1.02 }}\n      >\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2\">\n            <h4 className=\"text-sm font-medium text-white truncate\">{product.name}</h4>\n            <div className={`px-1.5 py-0.5 rounded text-xs font-medium ${stateBadgeColor}`}>\n              {isCorrectiveState ? 'Fix' : 'Protect'}\n            </div>\n          </div>\n          <p className=\"text-xs text-neutral-400 truncate\">{product.brand}</p>\n        </div>\n        {supplement && (\n          <div className=\"text-right flex-shrink-0\">\n            <p className=\"text-sm font-medium text-white\">\n              ${supplement.costPerMonth.min}/mo\n            </p>\n          </div>\n        )}\n        <ExternalLink size={14} className=\"text-neutral-500 group-hover:text-cyan-400 transition-colors flex-shrink-0\" />\n      </motion.a>\n    );\n  }\n\n  return (\n    <motion.div\n      className=\"bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-xl p-5 hover:border-neutral-700 transition-all\"\n      whileHover={{ y: -2 }}\n    >\n      {/* Header */}\n      <div className=\"flex items-start justify-between mb-3\">\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            {rank && (\n              <div className=\"w-6 h-6 rounded-full bg-cyan-500/20 flex items-center justify-center flex-shrink-0\">\n                <span className=\"text-xs font-bold text-cyan-400\">{rank}</span>\n              </div>\n            )}\n            <h3 className=\"font-semibold text-white\">{product.name}</h3>\n          </div>\n          <p className=\"text-sm text-neutral-400\">{product.brand}</p>\n        </div>\n\n        <div className={`px-2 py-1 rounded-lg border text-xs font-medium flex items-center gap-1 ${stateBadgeColor}`}>\n          <StateIcon size={12} />\n          {stateBadgeText}\n        </div>\n      </div>\n\n      {/* Message */}\n      <div className=\"mb-4\">\n        <p className=\"text-sm text-neutral-300\">{message}</p>\n        <p className=\"text-xs text-neutral-500 mt-1\">\n          Targets: {recommendation.matchedMetrics.slice(0, 3).join(', ')}\n          {recommendation.matchedMetrics.length > 3 && ` +${recommendation.matchedMetrics.length - 3} more`}\n        </p>\n      </div>\n\n      {/* Quick Stats */}\n      {supplement && (\n        <div className=\"grid grid-cols-3 gap-3 mb-4\">\n          <div className=\"bg-neutral-800/50 rounded-lg p-2\">\n            <div className=\"flex items-center gap-1 text-neutral-400 mb-1\">\n              <DollarSign size={12} />\n              <span className=\"text-xs\">Cost</span>\n            </div>\n            <p className=\"text-sm font-medium text-white\">\n              ${supplement.costPerMonth.min}-${supplement.costPerMonth.max}/mo\n            </p>\n          </div>\n\n          <div className=\"bg-neutral-800/50 rounded-lg p-2\">\n            <div className=\"flex items-center gap-1 text-neutral-400 mb-1\">\n              <Clock size={12} />\n              <span className=\"text-xs\">Timeline</span>\n            </div>\n            <p className=\"text-sm font-medium text-white\">{supplement.timelineToResults}</p>\n          </div>\n\n          <div className=\"bg-neutral-800/50 rounded-lg p-2\">\n            <div className=\"text-neutral-400 mb-1 text-xs\">Dosage</div>\n            <p className=\"text-sm font-medium text-white\">{supplement.dosage}</p>\n          </div>\n        </div>\n      )}\n\n      {/* CTA Button */}\n      <a\n        href={product.affiliateLink}\n        target=\"_blank\"\n        rel=\"noopener noreferrer\"\n        className=\"block w-full bg-cyan-500 hover:bg-cyan-400 text-black font-medium py-2.5 px-4 rounded-lg transition-colors text-center\"\n      >\n        <span className=\"flex items-center justify-center gap-2\">\n          {ctaText}\n          <ExternalLink size={16} />\n        </span>\n      </a>\n\n      {/* Affiliate Disclosure */}\n      <p className=\"text-xs text-neutral-600 text-center mt-2\">\n        We may earn a commission from purchases made through this link.\n      </p>\n    </motion.div>\n  );\n}\n","numLines":142,"startLine":1,"totalLines":142}}}
{"parentUuid":"425974b7-5d5c-4855-833a-336a0eced736","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PyzzisjiFcrMs4AgUAH2mo","type":"tool_result","content":"     1â†’'use client';\n     2â†’\n     3â†’import { motion } from 'framer-motion';\n     4â†’import { ChevronDown, AlertTriangle, CheckCircle } from 'lucide-react';\n     5â†’import { Ratio, getScoreColor, formatValue } from '@/types/results';\n     6â†’import { QualityBadge, SeverityBadge, CategoryTag, ExpandableSection } from '../shared';\n     7â†’import { IdealRangeBar, CompactIdealRangeBar } from '../visualization/IdealRangeBar';\n     8â†’import { SeverityLevel } from '@/lib/harmony-scoring';\n     9â†’\n    10â†’// Get severity indicator icon and color for header display\n    11â†’function getSeverityIndicator(severity: SeverityLevel): {\n    12â†’  icon: 'check' | 'alert' | 'warning';\n    13â†’  color: string;\n    14â†’  showBadge: boolean;\n    15â†’} {\n    16â†’  switch (severity) {\n    17â†’    case 'optimal':\n    18â†’      return { icon: 'check', color: '#67e8f9', showBadge: false };\n    19â†’    case 'minor':\n    20â†’      return { icon: 'check', color: '#22c55e', showBadge: false };\n    21â†’    case 'moderate':\n    22â†’      return { icon: 'warning', color: '#fbbf24', showBadge: true };\n    23â†’    case 'major':\n    24â†’      return { icon: 'warning', color: '#f97316', showBadge: true };\n    25â†’    case 'severe':\n    26â†’      return { icon: 'alert', color: '#ef4444', showBadge: true };\n    27â†’    case 'extremely_severe':\n    28â†’      return { icon: 'alert', color: '#dc2626', showBadge: true };\n    29â†’    default:\n    30â†’      return { icon: 'check', color: '#6b7280', showBadge: false };\n    31â†’  }\n    32â†’}\n    33â†’\n    34â†’interface MeasurementCardProps {\n    35â†’  ratio: Ratio;\n    36â†’  isExpanded?: boolean;\n    37â†’  onToggle?: () => void;\n    38â†’}\n    39â†’\n    40â†’export function MeasurementCard({\n    41â†’  ratio,\n    42â†’  isExpanded = false,\n    43â†’  onToggle,\n    44â†’}: MeasurementCardProps) {\n    45â†’  // Handle string values for obfuscated data\n    46â†’  const numericScore = typeof ratio.score === 'number' ? ratio.score : 0;\n    47â†’  const numericValue = typeof ratio.value === 'number' ? ratio.value : 0; // Default to 0 for visualizations if obfuscated\n    48â†’\n    49â†’  const scoreColor = getScoreColor(numericScore);\n    50â†’  const severityIndicator = getSeverityIndicator(ratio.severity);\n    51â†’\n    52â†’  return (\n    53â†’    <motion.div\n    54â†’      layout\n    55â†’      className={`bg-neutral-900/80 border rounded-xl overflow-hidden transition-all ${isExpanded ? 'border-cyan-500/50' : 'border-neutral-800 hover:border-neutral-700'\n    56â†’        }`}\n    57â†’    >\n    58â†’      {/* Collapsed Header */}\n    59â†’      <button\n    60â†’        onClick={onToggle}\n    61â†’        className=\"w-full p-4 flex items-center gap-4 text-left\"\n    62â†’      >\n    63â†’        {/* Score indicator with severity ring */}\n    64â†’        <div className=\"relative flex-shrink-0\">\n    65â†’          <div\n    66â†’            className=\"w-12 h-12 rounded-lg flex items-center justify-center font-bold text-lg\"\n    67â†’            style={{\n    68â†’              backgroundColor: typeof ratio.score === 'string' ? '#262626' : `${scoreColor}15`,\n    69â†’              color: typeof ratio.score === 'string' ? '#a3a3a3' : scoreColor,\n    70â†’              border: severityIndicator.showBadge ? `2px solid ${severityIndicator.color}40` : 'none',\n    71â†’            }}\n    72â†’          >\n    73â†’            {typeof ratio.score === 'number' ? ratio.score.toFixed(1) : ratio.score}\n    74â†’          </div>\n    75â†’          {/* Severity indicator dot for non-optimal metrics */}\n    76â†’          {severityIndicator.showBadge && (\n    77â†’            <div\n    78â†’              className=\"absolute -top-1 -right-1 w-3 h-3 rounded-full border-2 border-neutral-900\"\n    79â†’              style={{ backgroundColor: severityIndicator.color }}\n    80â†’              title={`${ratio.severity.replace('_', ' ')} issue`}\n    81â†’            />\n    82â†’          )}\n    83â†’        </div>\n    84â†’\n    85â†’        {/* Main info */}\n    86â†’        <div className=\"flex-1 min-w-0\">\n    87â†’          <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n    88â†’            <h3 className=\"font-semibold text-white truncate\">{ratio.name}</h3>\n    89â†’            <CategoryTag category={ratio.category} />\n    90â†’            {/* Show compact severity badge for moderate and above */}\n    91â†’            {severityIndicator.showBadge && (\n    92â†’              <SeverityBadge severity={ratio.severity} size=\"sm\" />\n    93â†’            )}\n    94â†’          </div>\n    95â†’          <div className=\"flex items-center gap-3\">\n    96â†’            <span className=\"text-lg font-medium text-white\">\n    97â†’              {typeof ratio.value === 'number' ? formatValue(ratio.value, ratio.unit) : ratio.value}\n    98â†’            </span>\n    99â†’            <span className=\"text-xs text-neutral-500\">\n   100â†’              Ideal: {formatValue(ratio.idealMin, ratio.unit)} - {formatValue(ratio.idealMax, ratio.unit)}\n   101â†’            </span>\n   102â†’          </div>\n   103â†’          {/* Compact range bar */}\n   104â†’          <div className=\"mt-2\">\n   105â†’            <CompactIdealRangeBar\n   106â†’              value={numericValue}\n   107â†’              idealMin={ratio.idealMin}\n   108â†’              idealMax={ratio.idealMax}\n   109â†’              rangeMin={ratio.rangeMin}\n   110â†’              rangeMax={ratio.rangeMax}\n   111â†’              score={numericScore}\n   112â†’            />\n   113â†’          </div>\n   114â†’        </div>\n   115â†’\n   116â†’        {/* Expand indicator */}\n   117â†’        <motion.div\n   118â†’          animate={{ rotate: isExpanded ? 180 : 0 }}\n   119â†’          transition={{ duration: 0.2 }}\n   120â†’          className=\"flex-shrink-0\"\n   121â†’        >\n   122â†’          <ChevronDown size={20} className=\"text-neutral-500\" />\n   123â†’        </motion.div>\n   124â†’      </button>\n   125â†’\n   126â†’      {/* Expanded Content */}\n   127â†’      <ExpandableSection isExpanded={isExpanded}>\n   128â†’        <div className=\"px-4 pb-4 space-y-4 border-t border-neutral-800 pt-4\">\n   129â†’          {/* Full range visualization */}\n   130â†’          <div className=\"bg-neutral-800/50 rounded-lg p-4\">\n   131â†’            <IdealRangeBar\n   132â†’              value={numericValue}\n   133â†’              idealMin={ratio.idealMin}\n   134â†’              idealMax={ratio.idealMax}\n   135â†’              rangeMin={ratio.rangeMin}\n   136â†’              rangeMax={ratio.rangeMax}\n   137â†’              score={numericScore}\n   138â†’              unit={ratio.unit}\n   139â†’            />\n   140â†’          </div>\n   141â†’\n   142â†’          {/* Quality and Severity badges */}\n   143â†’          <div className=\"flex items-center gap-2\">\n   144â†’            <QualityBadge quality={ratio.qualityLevel} />\n   145â†’            <SeverityBadge severity={ratio.severity} />\n   146â†’          </div>\n   147â†’\n   148â†’          {/* May indicate sections */}\n   149â†’          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n   150â†’            {/* Strengths */}\n   151â†’            {ratio.mayIndicateStrengths.length > 0 && (\n   152â†’              <div className=\"bg-green-500/10 border border-green-500/20 rounded-lg p-3\">\n   153â†’                <div className=\"flex items-center gap-2 mb-2\">\n   154â†’                  <CheckCircle size={14} className=\"text-green-400\" />\n   155â†’                  <span className=\"text-xs font-medium text-green-400\">May Indicate Strengths</span>\n   156â†’                </div>\n   157â†’                <ul className=\"space-y-1\">\n   158â†’                  {ratio.mayIndicateStrengths.map((strength, i) => (\n   159â†’                    <li key={i} className=\"text-sm text-neutral-300\">\n   160â†’                      {strength}\n   161â†’                    </li>\n   162â†’                  ))}\n   163â†’                </ul>\n   164â†’              </div>\n   165â†’            )}\n   166â†’\n   167â†’            {/* Flaws */}\n   168â†’            {ratio.mayIndicateFlaws.length > 0 && (\n   169â†’              <div className=\"bg-red-500/10 border border-red-500/20 rounded-lg p-3\">\n   170â†’                <div className=\"flex items-center gap-2 mb-2\">\n   171â†’                  <AlertTriangle size={14} className=\"text-red-400\" />\n   172â†’                  <span className=\"text-xs font-medium text-red-400\">May Indicate Flaws</span>\n   173â†’                </div>\n   174â†’                <ul className=\"space-y-1\">\n   175â†’                  {ratio.mayIndicateFlaws.map((flaw, i) => (\n   176â†’                    <li key={i} className=\"text-sm text-neutral-300\">\n   177â†’                      {flaw}\n   178â†’                    </li>\n   179â†’                  ))}\n   180â†’                </ul>\n   181â†’              </div>\n   182â†’            )}\n   183â†’          </div>\n   184â†’\n   185â†’        </div>\n   186â†’      </ExpandableSection>\n   187â†’    </motion.div>\n   188â†’  );\n   189â†’}\n   190â†’\n   191â†’// ============================================\n   192â†’// COMPACT MEASUREMENT CARD (for lists)\n   193â†’// ============================================\n   194â†’\n   195â†’interface CompactMeasurementCardProps {\n   196â†’  ratio: Ratio;\n   197â†’  onClick?: () => void;\n   198â†’  showSeverity?: boolean;\n   199â†’}\n   200â†’\n   201â†’export function CompactMeasurementCard({ ratio, onClick, showSeverity = true }: CompactMeasurementCardProps) {\n   202â†’  // Handle string values for obfuscated data\n   203â†’  const numericScore = typeof ratio.score === 'number' ? ratio.score : 0;\n   204â†’\n   205â†’  const scoreColor = getScoreColor(numericScore);\n   206â†’  const severityIndicator = getSeverityIndicator(ratio.severity);\n   207â†’\n   208â†’  return (\n   209â†’    <button\n   210â†’      onClick={onClick}\n   211â†’      className=\"w-full p-3 bg-neutral-900/60 border border-neutral-800 rounded-lg hover:border-neutral-700 transition-all text-left flex items-center gap-3\"\n   212â†’    >\n   213â†’      {/* Score with severity indicator */}\n   214â†’      <div className=\"relative flex-shrink-0\">\n   215â†’        <div\n   216â†’          className=\"w-10 h-10 rounded-lg flex items-center justify-center font-bold\"\n   217â†’          style={{\n   218â†’            backgroundColor: typeof ratio.score === 'string' ? '#262626' : `${scoreColor}15`,\n   219â†’            color: typeof ratio.score === 'string' ? '#a3a3a3' : scoreColor,\n   220â†’            border: severityIndicator.showBadge ? `1.5px solid ${severityIndicator.color}30` : 'none',\n   221â†’          }}\n   222â†’        >\n   223â†’          {typeof ratio.score === 'number' ? ratio.score.toFixed(1) : ratio.score}\n   224â†’        </div>\n   225â†’        {/* Severity dot */}\n   226â†’        {showSeverity && severityIndicator.showBadge && (\n   227â†’          <div\n   228â†’            className=\"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border border-neutral-900\"\n   229â†’            style={{ backgroundColor: severityIndicator.color }}\n   230â†’          />\n   231â†’        )}\n   232â†’      </div>\n   233â†’      <div className=\"flex-1 min-w-0\">\n   234â†’        <div className=\"flex items-center gap-1.5\">\n   235â†’          <h4 className=\"font-medium text-white truncate text-sm\">{ratio.name}</h4>\n   236â†’          {/* Compact severity badge for severe/extremely severe */}\n   237â†’          {showSeverity && (ratio.severity === 'severe' || ratio.severity === 'extremely_severe') && (\n   238â†’            <span\n   239â†’              className=\"px-1 py-0.5 text-[9px] font-medium rounded\"\n   240â†’              style={{\n   241â†’                color: severityIndicator.color,\n   242â†’                backgroundColor: `${severityIndicator.color}20`,\n   243â†’              }}\n   244â†’            >\n   245â†’              {ratio.severity === 'extremely_severe' ? 'Critical' : 'Severe'}\n   246â†’            </span>\n   247â†’          )}\n   248â†’        </div>\n   249â†’        <p className=\"text-xs text-neutral-500\">\n   250â†’          {typeof ratio.value === 'number' ? formatValue(ratio.value, ratio.unit) : ratio.value}\n   251â†’        </p>\n   252â†’      </div>\n   253â†’      <ChevronDown size={16} className=\"text-neutral-500 flex-shrink-0\" />\n   254â†’    </button>\n   255â†’  );\n   256â†’}\n   257â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"883080d4-5792-4ec9-9ee6-2dd105f59be8","timestamp":"2025-12-26T13:41:52.645Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/MeasurementCard.tsx","content":"'use client';\n\nimport { motion } from 'framer-motion';\nimport { ChevronDown, AlertTriangle, CheckCircle } from 'lucide-react';\nimport { Ratio, getScoreColor, formatValue } from '@/types/results';\nimport { QualityBadge, SeverityBadge, CategoryTag, ExpandableSection } from '../shared';\nimport { IdealRangeBar, CompactIdealRangeBar } from '../visualization/IdealRangeBar';\nimport { SeverityLevel } from '@/lib/harmony-scoring';\n\n// Get severity indicator icon and color for header display\nfunction getSeverityIndicator(severity: SeverityLevel): {\n  icon: 'check' | 'alert' | 'warning';\n  color: string;\n  showBadge: boolean;\n} {\n  switch (severity) {\n    case 'optimal':\n      return { icon: 'check', color: '#67e8f9', showBadge: false };\n    case 'minor':\n      return { icon: 'check', color: '#22c55e', showBadge: false };\n    case 'moderate':\n      return { icon: 'warning', color: '#fbbf24', showBadge: true };\n    case 'major':\n      return { icon: 'warning', color: '#f97316', showBadge: true };\n    case 'severe':\n      return { icon: 'alert', color: '#ef4444', showBadge: true };\n    case 'extremely_severe':\n      return { icon: 'alert', color: '#dc2626', showBadge: true };\n    default:\n      return { icon: 'check', color: '#6b7280', showBadge: false };\n  }\n}\n\ninterface MeasurementCardProps {\n  ratio: Ratio;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n}\n\nexport function MeasurementCard({\n  ratio,\n  isExpanded = false,\n  onToggle,\n}: MeasurementCardProps) {\n  // Handle string values for obfuscated data\n  const numericScore = typeof ratio.score === 'number' ? ratio.score : 0;\n  const numericValue = typeof ratio.value === 'number' ? ratio.value : 0; // Default to 0 for visualizations if obfuscated\n\n  const scoreColor = getScoreColor(numericScore);\n  const severityIndicator = getSeverityIndicator(ratio.severity);\n\n  return (\n    <motion.div\n      layout\n      className={`bg-neutral-900/80 border rounded-xl overflow-hidden transition-all ${isExpanded ? 'border-cyan-500/50' : 'border-neutral-800 hover:border-neutral-700'\n        }`}\n    >\n      {/* Collapsed Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 flex items-center gap-4 text-left\"\n      >\n        {/* Score indicator with severity ring */}\n        <div className=\"relative flex-shrink-0\">\n          <div\n            className=\"w-12 h-12 rounded-lg flex items-center justify-center font-bold text-lg\"\n            style={{\n              backgroundColor: typeof ratio.score === 'string' ? '#262626' : `${scoreColor}15`,\n              color: typeof ratio.score === 'string' ? '#a3a3a3' : scoreColor,\n              border: severityIndicator.showBadge ? `2px solid ${severityIndicator.color}40` : 'none',\n            }}\n          >\n            {typeof ratio.score === 'number' ? ratio.score.toFixed(1) : ratio.score}\n          </div>\n          {/* Severity indicator dot for non-optimal metrics */}\n          {severityIndicator.showBadge && (\n            <div\n              className=\"absolute -top-1 -right-1 w-3 h-3 rounded-full border-2 border-neutral-900\"\n              style={{ backgroundColor: severityIndicator.color }}\n              title={`${ratio.severity.replace('_', ' ')} issue`}\n            />\n          )}\n        </div>\n\n        {/* Main info */}\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1 flex-wrap\">\n            <h3 className=\"font-semibold text-white truncate\">{ratio.name}</h3>\n            <CategoryTag category={ratio.category} />\n            {/* Show compact severity badge for moderate and above */}\n            {severityIndicator.showBadge && (\n              <SeverityBadge severity={ratio.severity} size=\"sm\" />\n            )}\n          </div>\n          <div className=\"flex items-center gap-3\">\n            <span className=\"text-lg font-medium text-white\">\n              {typeof ratio.value === 'number' ? formatValue(ratio.value, ratio.unit) : ratio.value}\n            </span>\n            <span className=\"text-xs text-neutral-500\">\n              Ideal: {formatValue(ratio.idealMin, ratio.unit)} - {formatValue(ratio.idealMax, ratio.unit)}\n            </span>\n          </div>\n          {/* Compact range bar */}\n          <div className=\"mt-2\">\n            <CompactIdealRangeBar\n              value={numericValue}\n              idealMin={ratio.idealMin}\n              idealMax={ratio.idealMax}\n              rangeMin={ratio.rangeMin}\n              rangeMax={ratio.rangeMax}\n              score={numericScore}\n            />\n          </div>\n        </div>\n\n        {/* Expand indicator */}\n        <motion.div\n          animate={{ rotate: isExpanded ? 180 : 0 }}\n          transition={{ duration: 0.2 }}\n          className=\"flex-shrink-0\"\n        >\n          <ChevronDown size={20} className=\"text-neutral-500\" />\n        </motion.div>\n      </button>\n\n      {/* Expanded Content */}\n      <ExpandableSection isExpanded={isExpanded}>\n        <div className=\"px-4 pb-4 space-y-4 border-t border-neutral-800 pt-4\">\n          {/* Full range visualization */}\n          <div className=\"bg-neutral-800/50 rounded-lg p-4\">\n            <IdealRangeBar\n              value={numericValue}\n              idealMin={ratio.idealMin}\n              idealMax={ratio.idealMax}\n              rangeMin={ratio.rangeMin}\n              rangeMax={ratio.rangeMax}\n              score={numericScore}\n              unit={ratio.unit}\n            />\n          </div>\n\n          {/* Quality and Severity badges */}\n          <div className=\"flex items-center gap-2\">\n            <QualityBadge quality={ratio.qualityLevel} />\n            <SeverityBadge severity={ratio.severity} />\n          </div>\n\n          {/* May indicate sections */}\n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n            {/* Strengths */}\n            {ratio.mayIndicateStrengths.length > 0 && (\n              <div className=\"bg-green-500/10 border border-green-500/20 rounded-lg p-3\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <CheckCircle size={14} className=\"text-green-400\" />\n                  <span className=\"text-xs font-medium text-green-400\">May Indicate Strengths</span>\n                </div>\n                <ul className=\"space-y-1\">\n                  {ratio.mayIndicateStrengths.map((strength, i) => (\n                    <li key={i} className=\"text-sm text-neutral-300\">\n                      {strength}\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            )}\n\n            {/* Flaws */}\n            {ratio.mayIndicateFlaws.length > 0 && (\n              <div className=\"bg-red-500/10 border border-red-500/20 rounded-lg p-3\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <AlertTriangle size={14} className=\"text-red-400\" />\n                  <span className=\"text-xs font-medium text-red-400\">May Indicate Flaws</span>\n                </div>\n                <ul className=\"space-y-1\">\n                  {ratio.mayIndicateFlaws.map((flaw, i) => (\n                    <li key={i} className=\"text-sm text-neutral-300\">\n                      {flaw}\n                    </li>\n                  ))}\n                </ul>\n              </div>\n            )}\n          </div>\n\n        </div>\n      </ExpandableSection>\n    </motion.div>\n  );\n}\n\n// ============================================\n// COMPACT MEASUREMENT CARD (for lists)\n// ============================================\n\ninterface CompactMeasurementCardProps {\n  ratio: Ratio;\n  onClick?: () => void;\n  showSeverity?: boolean;\n}\n\nexport function CompactMeasurementCard({ ratio, onClick, showSeverity = true }: CompactMeasurementCardProps) {\n  // Handle string values for obfuscated data\n  const numericScore = typeof ratio.score === 'number' ? ratio.score : 0;\n\n  const scoreColor = getScoreColor(numericScore);\n  const severityIndicator = getSeverityIndicator(ratio.severity);\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"w-full p-3 bg-neutral-900/60 border border-neutral-800 rounded-lg hover:border-neutral-700 transition-all text-left flex items-center gap-3\"\n    >\n      {/* Score with severity indicator */}\n      <div className=\"relative flex-shrink-0\">\n        <div\n          className=\"w-10 h-10 rounded-lg flex items-center justify-center font-bold\"\n          style={{\n            backgroundColor: typeof ratio.score === 'string' ? '#262626' : `${scoreColor}15`,\n            color: typeof ratio.score === 'string' ? '#a3a3a3' : scoreColor,\n            border: severityIndicator.showBadge ? `1.5px solid ${severityIndicator.color}30` : 'none',\n          }}\n        >\n          {typeof ratio.score === 'number' ? ratio.score.toFixed(1) : ratio.score}\n        </div>\n        {/* Severity dot */}\n        {showSeverity && severityIndicator.showBadge && (\n          <div\n            className=\"absolute -top-0.5 -right-0.5 w-2.5 h-2.5 rounded-full border border-neutral-900\"\n            style={{ backgroundColor: severityIndicator.color }}\n          />\n        )}\n      </div>\n      <div className=\"flex-1 min-w-0\">\n        <div className=\"flex items-center gap-1.5\">\n          <h4 className=\"font-medium text-white truncate text-sm\">{ratio.name}</h4>\n          {/* Compact severity badge for severe/extremely severe */}\n          {showSeverity && (ratio.severity === 'severe' || ratio.severity === 'extremely_severe') && (\n            <span\n              className=\"px-1 py-0.5 text-[9px] font-medium rounded\"\n              style={{\n                color: severityIndicator.color,\n                backgroundColor: `${severityIndicator.color}20`,\n              }}\n            >\n              {ratio.severity === 'extremely_severe' ? 'Critical' : 'Severe'}\n            </span>\n          )}\n        </div>\n        <p className=\"text-xs text-neutral-500\">\n          {typeof ratio.value === 'number' ? formatValue(ratio.value, ratio.unit) : ratio.value}\n        </p>\n      </div>\n      <ChevronDown size={16} className=\"text-neutral-500 flex-shrink-0\" />\n    </button>\n  );\n}\n","numLines":257,"startLine":1,"totalLines":257}}}
{"parentUuid":"883080d4-5792-4ec9-9ee6-2dd105f59be8","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_0113RNsDTVHXs1oz9PiTqkav","type":"tool_result","content":"     1â†’'use client';\n     2â†’\n     3â†’import { useState, useMemo } from 'react';\n     4â†’import { motion, AnimatePresence } from 'framer-motion';\n     5â†’import { ChevronDown, Sparkles, AlertTriangle } from 'lucide-react';\n     6â†’import { Strength, Flaw, ResponsibleRatio, Recommendation, getScoreColor } from '@/types/results';\n     7â†’import { useResults } from '@/contexts/ResultsContext';\n     8â†’\n     9â†’// ============================================\n    10â†’// QUALITY BADGE COMPONENT (Light Theme)\n    11â†’// ============================================\n    12â†’\n    13â†’type QualityLevel = 'ideal' | 'excellent' | 'good' | 'below_average';\n    14â†’\n    15â†’interface QualityBadgeConfig {\n    16â†’  label: string;\n    17â†’  textColor: string;\n    18â†’  bgColor: string;\n    19â†’}\n    20â†’\n    21â†’const QUALITY_CONFIGS: Record<QualityLevel, QualityBadgeConfig> = {\n    22â†’  ideal: {\n    23â†’    label: 'Ideal',\n    24â†’    textColor: 'rgb(8, 145, 178)',    // cyan-600\n    25â†’    bgColor: 'rgb(207, 250, 254)',    // cyan-100\n    26â†’  },\n    27â†’  excellent: {\n    28â†’    label: 'Excellent',\n    29â†’    textColor: 'rgb(4, 120, 87)',     // emerald-700\n    30â†’    bgColor: 'rgb(209, 250, 229)',    // emerald-100\n    31â†’  },\n    32â†’  good: {\n    33â†’    label: 'Good',\n    34â†’    textColor: 'rgb(21, 128, 61)',    // green-700\n    35â†’    bgColor: 'rgb(220, 252, 231)',    // green-100\n    36â†’  },\n    37â†’  below_average: {\n    38â†’    label: 'Average',\n    39â†’    textColor: 'rgb(113, 113, 122)',  // gray-500\n    40â†’    bgColor: 'rgb(244, 244, 245)',    // gray-100\n    41â†’  },\n    42â†’};\n    43â†’\n    44â†’function QualityBadge({ quality }: { quality: QualityLevel }) {\n    45â†’  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n    46â†’\n    47â†’  return (\n    48â†’    <span\n    49â†’      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n    50â†’      style={{\n    51â†’        color: config.textColor,\n    52â†’        backgroundColor: config.bgColor,\n    53â†’      }}\n    54â†’    >\n    55â†’      {config.label}\n    56â†’    </span>\n    57â†’  );\n    58â†’}\n    59â†’\n    60â†’// ============================================\n    61â†’// SEVERITY BADGE COMPONENT (Harmony Style)\n    62â†’// ============================================\n    63â†’\n    64â†’type SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n    65â†’\n    66â†’interface SeverityBadgeConfig {\n    67â†’  label: string;\n    68â†’  textColor: string;\n    69â†’  bgColor: string;\n    70â†’  borderColor?: string;\n    71â†’}\n    72â†’\n    73â†’const SEVERITY_CONFIGS: Record<SeverityLevel, SeverityBadgeConfig> = {\n    74â†’  extremely_severe: {\n    75â†’    label: 'extremely severe',\n    76â†’    textColor: 'rgb(127, 29, 29)',     // red-900\n    77â†’    bgColor: 'rgb(254, 202, 202)',     // red-200\n    78â†’  },\n    79â†’  severe: {\n    80â†’    label: 'severe',\n    81â†’    textColor: 'rgb(185, 28, 28)',     // red-700\n    82â†’    bgColor: 'rgb(254, 226, 226)',     // red-50\n    83â†’    borderColor: 'rgb(254, 202, 202)', // red-200\n    84â†’  },\n    85â†’  moderate: {\n    86â†’    label: 'moderate',\n    87â†’    textColor: 'rgb(194, 65, 12)',     // orange-700\n    88â†’    bgColor: 'rgb(255, 237, 213)',     // orange-50\n    89â†’    borderColor: 'rgb(254, 215, 170)', // orange-200\n    90â†’  },\n    91â†’  minor: {\n    92â†’    label: 'minor',\n    93â†’    textColor: 'rgb(161, 98, 7)',      // yellow-700\n    94â†’    bgColor: 'rgb(254, 249, 195)',     // yellow-50\n    95â†’    borderColor: 'rgb(254, 240, 138)', // yellow-200\n    96â†’  },\n    97â†’};\n    98â†’\n    99â†’function getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n   100â†’  // Handle edge cases: NaN, Infinity, undefined, null, negative\n   101â†’  if (\n   102â†’    typeof harmonyLost !== 'number' ||\n   103â†’    !Number.isFinite(harmonyLost) ||\n   104â†’    Number.isNaN(harmonyLost) ||\n   105â†’    harmonyLost < 0\n   106â†’  ) {\n   107â†’    return 'minor'; // Default to least severe for invalid values\n   108â†’  }\n   109â†’  if (harmonyLost >= 0.8) return 'extremely_severe';\n   110â†’  if (harmonyLost >= 0.5) return 'severe';\n   111â†’  if (harmonyLost >= 0.3) return 'moderate';\n   112â†’  return 'minor';\n   113â†’}\n   114â†’\n   115â†’function SeverityBadge({ severity }: { severity: SeverityLevel }) {\n   116â†’  const config = SEVERITY_CONFIGS[severity] || SEVERITY_CONFIGS.moderate;\n   117â†’\n   118â†’  return (\n   119â†’    <span\n   120â†’      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n   121â†’      style={{\n   122â†’        color: config.textColor,\n   123â†’        backgroundColor: config.bgColor,\n   124â†’        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n   125â†’      }}\n   126â†’    >\n   127â†’      {config.label}\n   128â†’    </span>\n   129â†’  );\n   130â†’}\n   131â†’\n   132â†’// ============================================\n   133â†’// PROCEDURE PHASE BADGE\n   134â†’// ============================================\n   135â†’\n   136â†’type ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n   137â†’\n   138â†’interface PhaseConfig {\n   139â†’  textColor: string;\n   140â†’  bgColor: string;\n   141â†’}\n   142â†’\n   143â†’const PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n   144â†’  Foundational: {\n   145â†’    textColor: 'rgb(4, 120, 87)',     // emerald-700\n   146â†’    bgColor: 'rgb(209, 250, 229)',    // emerald-50\n   147â†’  },\n   148â†’  'Non-Invasive': {\n   149â†’    textColor: 'rgb(29, 78, 216)',    // blue-700\n   150â†’    bgColor: 'rgb(219, 234, 254)',    // blue-50\n   151â†’  },\n   152â†’  'Minimally Invasive': {\n   153â†’    textColor: 'rgb(109, 40, 217)',   // violet-700\n   154â†’    bgColor: 'rgb(237, 233, 254)',    // violet-50\n   155â†’  },\n   156â†’  Surgical: {\n   157â†’    textColor: 'rgb(126, 34, 206)',   // purple-700\n   158â†’    bgColor: 'rgb(243, 232, 255)',    // purple-50\n   159â†’  },\n   160â†’};\n   161â†’\n   162â†’function PhaseBadge({ phase }: { phase: ProcedurePhase }) {\n   163â†’  const config = PHASE_CONFIGS[phase] || PHASE_CONFIGS['Non-Invasive'];\n   164â†’\n   165â†’  return (\n   166â†’    <span\n   167â†’      className=\"px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium\"\n   168â†’      style={{\n   169â†’        color: config.textColor,\n   170â†’        backgroundColor: config.bgColor,\n   171â†’      }}\n   172â†’    >\n   173â†’      {phase}\n   174â†’    </span>\n   175â†’  );\n   176â†’}\n   177â†’\n   178â†’// ============================================\n   179â†’// CONTRIBUTING RATIO BUTTON (Harmony Style - Dark Theme)\n   180â†’// ============================================\n   181â†’\n   182â†’interface ContributingRatioButtonProps {\n   183â†’  ratioName: string;\n   184â†’  score: number | string;\n   185â†’  onClick: () => void;\n   186â†’  animationDelay?: number;\n   187â†’}\n   188â†’\n   189â†’function ContributingRatioButton({\n   190â†’  ratioName,\n   191â†’  score,\n   192â†’  onClick,\n   193â†’  animationDelay = 0,\n   194â†’}: ContributingRatioButtonProps) {\n   195â†’  const numericScore = typeof score === 'number' ? score : 0;\n   196â†’  const color = getScoreColor(numericScore);\n   197â†’\n   198â†’  return (\n   199â†’    <motion.button\n   200â†’      initial={{ opacity: 0, y: 10 }}\n   201â†’      animate={{ opacity: 1, y: 0 }}\n   202â†’      transition={{ duration: 0.2, delay: animationDelay }}\n   203â†’      onClick={onClick}\n   204â†’      className=\"w-full flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-lg border transition-all text-left cursor-pointer group bg-neutral-900/80 border-neutral-800 hover:border-neutral-700 hover:bg-neutral-800/50\"\n   205â†’    >\n   206â†’      <span className=\"text-xs sm:text-sm font-medium transition-colors text-neutral-200 group-hover:text-white\">\n   207â†’        {ratioName}\n   208â†’      </span>\n   209â†’      <div className=\"flex items-baseline gap-0.5 sm:gap-1\">\n   210â†’        <span className=\"text-xs sm:text-sm font-semibold\" style={{ color: typeof score === 'string' ? '#a3a3a3' : color }}>\n   211â†’          {typeof score === 'number' ? score.toFixed(1) : score}\n   212â†’        </span>\n   213â†’        <span className=\"text-[10px] sm:text-xs text-neutral-500\">/10</span>\n   214â†’      </div>\n   215â†’    </motion.button>\n   216â†’  );\n   217â†’}\n   218â†’\n   219â†’// ============================================\n   220â†’// PLAN ITEM (Recommendation in \"Your Plan\" section)\n   221â†’// ============================================\n   222â†’\n   223â†’interface PlanItemProps {\n   224â†’  name: string;\n   225â†’  phase: ProcedurePhase;\n   226â†’  animationDelay?: number;\n   227â†’}\n   228â†’\n   229â†’function PlanItem({ name, phase, animationDelay = 0 }: PlanItemProps) {\n   230â†’  return (\n   231â†’    <motion.div\n   232â†’      initial={{ opacity: 0, y: 10 }}\n   233â†’      animate={{ opacity: 1, y: 0 }}\n   234â†’      transition={{ duration: 0.2, delay: animationDelay }}\n   235â†’      className=\"flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-lg bg-neutral-900/80 border border-neutral-800\"\n   236â†’    >\n   237â†’      <span className=\"text-xs sm:text-sm text-neutral-200 font-medium\">{name}</span>\n   238â†’      <div className=\"flex items-center gap-2\">\n   239â†’        <span className=\"text-[9px] sm:text-[10px] px-1.5 py-0.5 rounded bg-emerald-500/20 text-emerald-400 font-medium\">\n   240â†’          In Plan\n   241â†’        </span>\n   242â†’        <PhaseBadge phase={phase} />\n   243â†’      </div>\n   244â†’    </motion.div>\n   245â†’  );\n   246â†’}\n   247â†’\n   248â†’// ============================================\n   249â†’// KEY STRENGTH CARD (Harmony Style)\n   250â†’// ============================================\n   251â†’\n   252â†’interface KeyStrengthCardProps {\n   253â†’  strength: Strength;\n   254â†’  isExpanded: boolean;\n   255â†’  onToggle: () => void;\n   256â†’  onRatioClick: (ratio: ResponsibleRatio) => void;\n   257â†’  animationDelay?: number;\n   258â†’}\n   259â†’\n   260â†’function KeyStrengthCard({\n   261â†’  strength,\n   262â†’  isExpanded,\n   263â†’  onToggle,\n   264â†’  onRatioClick,\n   265â†’  animationDelay = 0,\n   266â†’}: KeyStrengthCardProps) {\n   267â†’  const score = typeof strength.avgScore === 'number' ? strength.avgScore : 0;\n   268â†’  const color = getScoreColor(score);\n   269â†’\n   270â†’  return (\n   271â†’    <motion.div\n   272â†’      initial={{ opacity: 0, y: 10 }}\n   273â†’      animate={{ opacity: 1, y: 0 }}\n   274â†’      transition={{ duration: 0.3, delay: animationDelay }}\n   275â†’      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-cyan-500/30' : 'border-neutral-800 hover:border-neutral-700'\n   276â†’        }`}\n   277â†’    >\n   278â†’      {/* Header Button */}\n   279â†’      <button\n   280â†’        onClick={onToggle}\n   281â†’        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n   282â†’      >\n   283â†’        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n   284â†’          {/* Left: Badge + Content */}\n   285â†’          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n   286â†’            <QualityBadge quality={strength.qualityLevel} />\n   287â†’            <div className=\"flex-1 min-w-0\">\n   288â†’              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n   289â†’                {strength.strengthName}\n   290â†’              </h4>\n   291â†’              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n   292â†’                {strength.summary}\n   293â†’              </p>\n   294â†’            </div>\n   295â†’          </div>\n   296â†’\n   297â†’          {/* Right: Score + Chevron */}\n   298â†’          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n   299â†’            <div className=\"text-right\">\n   300â†’              <div\n   301â†’                className=\"text-lg sm:text-xl font-semibold tracking-tight\"\n   302â†’                style={{ color: typeof strength.avgScore === 'string' ? '#a3a3a3' : color }}\n   303â†’              >\n   304â†’                {typeof strength.avgScore === 'number' ? strength.avgScore.toFixed(2) : strength.avgScore}\n   305â†’              </div>\n   306â†’              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium mt-0.5\">avg /10</div>\n   307â†’            </div>\n   308â†’            <motion.div\n   309â†’              animate={{ rotate: isExpanded ? 180 : 0 }}\n   310â†’              transition={{ duration: 0.3 }}\n   311â†’            >\n   312â†’              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n   313â†’            </motion.div>\n   314â†’          </div>\n   315â†’        </div>\n   316â†’      </button>\n   317â†’\n   318â†’      {/* Expanded Content */}\n   319â†’      <AnimatePresence initial={false}>\n   320â†’        {isExpanded && (\n   321â†’          <motion.div\n   322â†’            initial={{ height: 0, opacity: 0 }}\n   323â†’            animate={{ height: 'auto', opacity: 1 }}\n   324â†’            exit={{ height: 0, opacity: 0 }}\n   325â†’            transition={{ duration: 0.3 }}\n   326â†’            className=\"overflow-hidden\"\n   327â†’          >\n   328â†’            <div className=\"border-t border-neutral-800 bg-neutral-800/30 px-4 sm:px-5 py-3 sm:py-4\">\n   329â†’              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n   330â†’                Contributing Ratios\n   331â†’              </div>\n   332â†’              <div className=\"space-y-2\">\n   333â†’                {strength.responsibleRatios.map((ratio, i) => (\n   334â†’                  <ContributingRatioButton\n   335â†’                    key={ratio.ratioId}\n   336â†’                    ratioName={ratio.ratioName}\n   337â†’                    score={ratio.score}\n   338â†’                    onClick={() => onRatioClick(ratio)}\n   339â†’                    animationDelay={i * 0.05}\n   340â†’                  />\n   341â†’                ))}\n   342â†’              </div>\n   343â†’            </div>\n   344â†’          </motion.div>\n   345â†’        )}\n   346â†’      </AnimatePresence>\n   347â†’    </motion.div>\n   348â†’  );\n   349â†’}\n   350â†’\n   351â†’// ============================================\n   352â†’// AREA OF IMPROVEMENT CARD (Harmony Style with Your Plan)\n   353â†’// ============================================\n   354â†’\n   355â†’interface AreaOfImprovementCardProps {\n   356â†’  flaw: Flaw;\n   357â†’  isExpanded: boolean;\n   358â†’  onToggle: () => void;\n   359â†’  onRatioClick: (ratio: ResponsibleRatio) => void;\n   360â†’  recommendations?: Recommendation[];\n   361â†’  animationDelay?: number;\n   362â†’}\n   363â†’\n   364â†’function AreaOfImprovementCard({\n   365â†’  flaw,\n   366â†’  isExpanded,\n   367â†’  onToggle,\n   368â†’  onRatioClick,\n   369â†’  recommendations = [],\n   370â†’  animationDelay = 0,\n   371â†’}: AreaOfImprovementCardProps) {\n   372â†’  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n   373â†’\n   374â†’  // Find matching recommendations for this flaw\n   375â†’  const matchedRecommendations = useMemo(() => {\n   376â†’    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n   377â†’    return recommendations.filter(rec =>\n   378â†’      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n   379â†’      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n   380â†’    ).slice(0, 3);\n   381â†’  }, [flaw, recommendations]);\n   382â†’\n   383â†’  // Map phase names\n   384â†’  const mapPhase = (phase: string): ProcedurePhase => {\n   385â†’    if (phase === 'Foundational') return 'Foundational';\n   386â†’    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n   387â†’    if (phase === 'Surgical') return 'Surgical';\n   388â†’    return 'Non-Invasive';\n   389â†’  };\n   390â†’\n   391â†’  return (\n   392â†’    <motion.div\n   393â†’      initial={{ opacity: 0, y: 10 }}\n   394â†’      animate={{ opacity: 1, y: 0 }}\n   395â†’      transition={{ duration: 0.3, delay: animationDelay }}\n   396â†’      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-red-500/30' : 'border-neutral-800 hover:border-neutral-700'\n   397â†’        }`}\n   398â†’    >\n   399â†’      {/* Header Button */}\n   400â†’      <button\n   401â†’        onClick={onToggle}\n   402â†’        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n   403â†’      >\n   404â†’        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n   405â†’          {/* Left: Badge + Content */}\n   406â†’          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n   407â†’            <SeverityBadge severity={severity} />\n   408â†’            <div className=\"flex-1 min-w-0\">\n   409â†’              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n   410â†’                {flaw.flawName}\n   411â†’              </h4>\n   412â†’              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n   413â†’                {flaw.summary}\n   414â†’              </p>\n   415â†’            </div>\n   416â†’          </div>\n   417â†’\n   418â†’          {/* Right: Points impact + Chevron */}\n   419â†’          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n   420â†’            <div className=\"text-right space-y-1\">\n   421â†’              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-500\">\n   422â†’                -{(typeof flaw.harmonyPercentageLost === 'number' && Number.isFinite(flaw.harmonyPercentageLost)\n   423â†’                  ? flaw.harmonyPercentageLost\n   424â†’                  : 0\n   425â†’                ).toFixed(2)}\n   426â†’              </div>\n   427â†’              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n   428â†’              {flaw.rollingHarmonyPercentageLost !== undefined &&\n   429â†’                typeof flaw.rollingHarmonyPercentageLost === 'number' &&\n   430â†’                Number.isFinite(flaw.rollingHarmonyPercentageLost) && (\n   431â†’                  <div className=\"text-[10px] text-neutral-600 font-medium pt-0.5 border-t border-neutral-700 mt-1\">\n   432â†’                    Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n   433â†’                  </div>\n   434â†’                )}\n   435â†’            </div>\n   436â†’            <motion.div\n   437â†’              animate={{ rotate: isExpanded ? 180 : 0 }}\n   438â†’              transition={{ duration: 0.3 }}\n   439â†’            >\n   440â†’              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n   441â†’            </motion.div>\n   442â†’          </div>\n   443â†’        </div>\n   444â†’      </button>\n   445â†’\n   446â†’      {/* Expanded Content */}\n   447â†’      <AnimatePresence initial={false}>\n   448â†’        {isExpanded && (\n   449â†’          <motion.div\n   450â†’            initial={{ height: 0, opacity: 0 }}\n   451â†’            animate={{ height: 'auto', opacity: 1 }}\n   452â†’            exit={{ height: 0, opacity: 0 }}\n   453â†’            transition={{ duration: 0.3 }}\n   454â†’            className=\"overflow-hidden\"\n   455â†’          >\n   456â†’            {/* Affected Ratios Section */}\n   457â†’            <div className=\"border-t border-neutral-800 bg-neutral-800/30 px-4 sm:px-5 py-3 sm:py-4\">\n   458â†’              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n   459â†’                Affected Ratios\n   460â†’              </div>\n   461â†’              <div className=\"space-y-2\">\n   462â†’                {flaw.responsibleRatios.map((ratio, i) => (\n   463â†’                  <ContributingRatioButton\n   464â†’                    key={ratio.ratioId}\n   465â†’                    ratioName={ratio.ratioName}\n   466â†’                    score={ratio.score}\n   467â†’                    onClick={() => onRatioClick(ratio)}\n   468â†’                    animationDelay={i * 0.05}\n   469â†’                  />\n   470â†’                ))}\n   471â†’              </div>\n   472â†’            </div>\n   473â†’\n   474â†’            {/* Your Plan Section (if there are matched recommendations) */}\n   475â†’            {matchedRecommendations.length > 0 && (\n   476â†’              <div className=\"border-t border-neutral-800 bg-emerald-900/10 px-4 sm:px-5 py-3 sm:py-4\">\n   477â†’                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n   478â†’                  <Sparkles className=\"w-3 h-3 text-emerald-400\" />\n   479â†’                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-400 uppercase tracking-wider\">\n   480â†’                    Your Plan\n   481â†’                  </span>\n   482â†’                </div>\n   483â†’                <div className=\"space-y-2\">\n   484â†’                  {matchedRecommendations.map((rec, i) => (\n   485â†’                    <PlanItem\n   486â†’                      key={rec.ref_id}\n   487â†’                      name={rec.name}\n   488â†’                      phase={mapPhase(rec.phase)}\n   489â†’                      animationDelay={i * 0.05}\n   490â†’                    />\n   491â†’                  ))}\n   492â†’                </div>\n   493â†’              </div>\n   494â†’            )}\n   495â†’          </motion.div>\n   496â†’        )}\n   497â†’      </AnimatePresence>\n   498â†’    </motion.div>\n   499â†’  );\n   500â†’}\n   501â†’\n   502â†’// ============================================\n   503â†’// KEY STRENGTHS SECTION (Harmony Style)\n   504â†’// ============================================\n   505â†’\n   506â†’interface KeyStrengthsSectionProps {\n   507â†’  strengths: Strength[];\n   508â†’  onRatioClick: (ratio: ResponsibleRatio, categoryName: string) => void;\n   509â†’  initialShowCount?: number;\n   510â†’}\n   511â†’\n   512â†’export function KeyStrengthsSection({\n   513â†’  strengths,\n   514â†’  onRatioClick,\n   515â†’  initialShowCount = 3,\n   516â†’}: KeyStrengthsSectionProps) {\n   517â†’  const [expandedId, setExpandedId] = useState<string | null>(null);\n   518â†’  const [showAll, setShowAll] = useState(false);\n   519â†’\n   520â†’  const displayedStrengths = showAll ? strengths : strengths.slice(0, initialShowCount);\n   521â†’  const remainingCount = Math.max(0, strengths.length - initialShowCount);\n   522â†’\n   523â†’  // Calculate average strength contribution (handle invalid values)\n   524â†’  const avgScore = useMemo(() => {\n   525â†’    if (!strengths || strengths.length === 0) return 0;\n   526â†’    const validScores = strengths.filter(\n   527â†’      (s) => typeof s.avgScore === 'number' && Number.isFinite(s.avgScore)\n   528â†’    );\n   529â†’    if (validScores.length === 0) return 0;\n   530â†’    return validScores.reduce((sum, s) => sum + (s.avgScore as number), 0) / validScores.length;\n   531â†’  }, [strengths]);\n   532â†’\n   533â†’  return (\n   534â†’    <div className=\"rounded-xl bg-neutral-900/50 border border-neutral-800 p-4 sm:p-6\">\n   535â†’      {/* Header */}\n   536â†’      <div className=\"flex items-center justify-between mb-4 sm:mb-5\">\n   537â†’        <div className=\"flex items-center gap-2\">\n   538â†’          <div className=\"w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center\">\n   539â†’            <Sparkles className=\"w-4 h-4 text-cyan-400\" />\n   540â†’          </div>\n   541â†’          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n   542â†’            Key Strengths\n   543â†’          </h3>\n   544â†’        </div>\n   545â†’        <div className=\"text-right\">\n   546â†’          <span className=\"text-sm text-neutral-500\">\n   547â†’            {strengths.length} total\n   548â†’          </span>\n   549â†’          {strengths.length > 0 && (\n   550â†’            <p className=\"text-xs text-green-400 font-medium\">\n   551â†’              Avg: {avgScore.toFixed(1)}/10\n   552â†’            </p>\n   553â†’          )}\n   554â†’        </div>\n   555â†’      </div>\n   556â†’\n   557â†’      {/* Cards */}\n   558â†’      <div className=\"space-y-3\">\n   559â†’        {displayedStrengths.length > 0 ? (\n   560â†’          displayedStrengths.map((strength, i) => (\n   561â†’            <KeyStrengthCard\n   562â†’              key={strength.id}\n   563â†’              strength={strength}\n   564â†’              isExpanded={expandedId === strength.id}\n   565â†’              onToggle={() => setExpandedId(expandedId === strength.id ? null : strength.id)}\n   566â†’              onRatioClick={(ratio) => onRatioClick(ratio, strength.categoryName)}\n   567â†’              animationDelay={i * 0.04}\n   568â†’            />\n   569â†’          ))\n   570â†’        ) : (\n   571â†’          <div className=\"rounded-xl bg-neutral-800/50 border border-neutral-700 p-6 text-center\">\n   572â†’            <p className=\"text-neutral-500\">No significant strengths detected</p>\n   573â†’          </div>\n   574â†’        )}\n   575â†’      </div>\n   576â†’\n   577â†’      {/* Show More Button */}\n   578â†’      {remainingCount > 0 && (\n   579â†’        <button\n   580â†’          onClick={() => setShowAll(!showAll)}\n   581â†’          className=\"w-full mt-4 py-3 rounded-lg bg-neutral-800/50 border border-neutral-700 hover:border-neutral-600 hover:bg-neutral-800 transition-all duration-200 text-sm font-medium text-white\"\n   582â†’        >\n   583â†’          <span className=\"flex items-center justify-center gap-2\">\n   584â†’            <span>{showAll ? 'Show Less' : `Show ${remainingCount} More`}</span>\n   585â†’            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n   586â†’              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n   587â†’            </motion.div>\n   588â†’          </span>\n   589â†’        </button>\n   590â†’      )}\n   591â†’    </div>\n   592â†’  );\n   593â†’}\n   594â†’\n   595â†’// ============================================\n   596â†’// AREAS OF IMPROVEMENT SECTION (Harmony Style with Your Plan)\n   597â†’// ============================================\n   598â†’\n   599â†’interface AreasOfImprovementSectionProps {\n   600â†’  flaws: Flaw[];\n   601â†’  onRatioClick: (ratio: ResponsibleRatio, categoryName: string) => void;\n   602â†’  initialShowCount?: number;\n   603â†’}\n   604â†’\n   605â†’export function AreasOfImprovementSection({\n   606â†’  flaws,\n   607â†’  onRatioClick,\n   608â†’  initialShowCount = 3,\n   609â†’}: AreasOfImprovementSectionProps) {\n   610â†’  const [expandedId, setExpandedId] = useState<string | null>(null);\n   611â†’  const [showAll, setShowAll] = useState(false);\n   612â†’\n   613â†’  // Get recommendations from context\n   614â†’  const { recommendations } = useResults();\n   615â†’\n   616â†’  const displayedFlaws = showAll ? flaws : flaws.slice(0, initialShowCount);\n   617â†’  const remainingCount = Math.max(0, flaws.length - initialShowCount);\n   618â†’\n   619â†’  // Calculate total impact from all flaws (handle invalid values)\n   620â†’  const totalImpact = flaws.reduce((sum, f) => {\n   621â†’    const impact = typeof f.harmonyPercentageLost === 'number' && Number.isFinite(f.harmonyPercentageLost)\n   622â†’      ? f.harmonyPercentageLost\n   623â†’      : 0;\n   624â†’    return sum + impact;\n   625â†’  }, 0);\n   626â†’\n   627â†’  return (\n   628â†’    <div className=\"rounded-xl bg-neutral-900/50 border border-neutral-800 p-4 sm:p-6\">\n   629â†’      {/* Header */}\n   630â†’      <div className=\"flex items-center justify-between mb-4 sm:mb-5\">\n   631â†’        <div className=\"flex items-center gap-2\">\n   632â†’          <div className=\"w-8 h-8 rounded-lg bg-amber-500/20 flex items-center justify-center\">\n   633â†’            <AlertTriangle className=\"w-4 h-4 text-amber-400\" />\n   634â†’          </div>\n   635â†’          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n   636â†’            Areas of Improvement\n   637â†’          </h3>\n   638â†’        </div>\n   639â†’        <div className=\"text-right\">\n   640â†’          <span className=\"text-sm text-neutral-500\">\n   641â†’            {flaws.length} total\n   642â†’          </span>\n   643â†’          {flaws.length > 0 && (\n   644â†’            <p className=\"text-xs text-red-400 font-medium\">\n   645â†’              Impact: -{totalImpact.toFixed(1)} pts\n   646â†’            </p>\n   647â†’          )}\n   648â†’        </div>\n   649â†’      </div>\n   650â†’\n   651â†’      {/* Cards */}\n   652â†’      <div className=\"space-y-3\">\n   653â†’        {displayedFlaws.length > 0 ? (\n   654â†’          displayedFlaws.map((flaw, i) => (\n   655â†’            <AreaOfImprovementCard\n   656â†’              key={flaw.id}\n   657â†’              flaw={flaw}\n   658â†’              isExpanded={expandedId === flaw.id}\n   659â†’              onToggle={() => setExpandedId(expandedId === flaw.id ? null : flaw.id)}\n   660â†’              onRatioClick={(ratio) => onRatioClick(ratio, flaw.categoryName)}\n   661â†’              recommendations={recommendations}\n   662â†’              animationDelay={i * 0.04}\n   663â†’            />\n   664â†’          ))\n   665â†’        ) : (\n   666â†’          <div className=\"rounded-xl bg-neutral-800/50 border border-neutral-700 p-6 text-center\">\n   667â†’            <p className=\"text-neutral-500\">No significant areas for improvement detected</p>\n   668â†’          </div>\n   669â†’        )}\n   670â†’      </div>\n   671â†’\n   672â†’      {/* Show More Button */}\n   673â†’      {remainingCount > 0 && (\n   674â†’        <button\n   675â†’          onClick={() => setShowAll(!showAll)}\n   676â†’          className=\"w-full mt-4 py-3 rounded-lg bg-neutral-800/50 border border-neutral-700 hover:border-neutral-600 hover:bg-neutral-800 transition-all duration-200 text-sm font-medium text-white\"\n   677â†’        >\n   678â†’          <span className=\"flex items-center justify-center gap-2\">\n   679â†’            <span>{showAll ? 'Show Less' : `Show ${remainingCount} More`}</span>\n   680â†’            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n   681â†’              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n   682â†’            </motion.div>\n   683â†’          </span>\n   684â†’        </button>\n   685â†’      )}\n   686â†’    </div>\n   687â†’  );\n   688â†’}\n   689â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"fbcfaf37-f413-44b6-a138-cf97ecde423b","timestamp":"2025-12-26T13:41:52.645Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/KeyStrengthsFlaws.tsx","content":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ChevronDown, Sparkles, AlertTriangle } from 'lucide-react';\nimport { Strength, Flaw, ResponsibleRatio, Recommendation, getScoreColor } from '@/types/results';\nimport { useResults } from '@/contexts/ResultsContext';\n\n// ============================================\n// QUALITY BADGE COMPONENT (Light Theme)\n// ============================================\n\ntype QualityLevel = 'ideal' | 'excellent' | 'good' | 'below_average';\n\ninterface QualityBadgeConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n}\n\nconst QUALITY_CONFIGS: Record<QualityLevel, QualityBadgeConfig> = {\n  ideal: {\n    label: 'Ideal',\n    textColor: 'rgb(8, 145, 178)',    // cyan-600\n    bgColor: 'rgb(207, 250, 254)',    // cyan-100\n  },\n  excellent: {\n    label: 'Excellent',\n    textColor: 'rgb(4, 120, 87)',     // emerald-700\n    bgColor: 'rgb(209, 250, 229)',    // emerald-100\n  },\n  good: {\n    label: 'Good',\n    textColor: 'rgb(21, 128, 61)',    // green-700\n    bgColor: 'rgb(220, 252, 231)',    // green-100\n  },\n  below_average: {\n    label: 'Average',\n    textColor: 'rgb(113, 113, 122)',  // gray-500\n    bgColor: 'rgb(244, 244, 245)',    // gray-100\n  },\n};\n\nfunction QualityBadge({ quality }: { quality: QualityLevel }) {\n  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n\n  return (\n    <span\n      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// SEVERITY BADGE COMPONENT (Harmony Style)\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n\ninterface SeverityBadgeConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor?: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityBadgeConfig> = {\n  extremely_severe: {\n    label: 'extremely severe',\n    textColor: 'rgb(127, 29, 29)',     // red-900\n    bgColor: 'rgb(254, 202, 202)',     // red-200\n  },\n  severe: {\n    label: 'severe',\n    textColor: 'rgb(185, 28, 28)',     // red-700\n    bgColor: 'rgb(254, 226, 226)',     // red-50\n    borderColor: 'rgb(254, 202, 202)', // red-200\n  },\n  moderate: {\n    label: 'moderate',\n    textColor: 'rgb(194, 65, 12)',     // orange-700\n    bgColor: 'rgb(255, 237, 213)',     // orange-50\n    borderColor: 'rgb(254, 215, 170)', // orange-200\n  },\n  minor: {\n    label: 'minor',\n    textColor: 'rgb(161, 98, 7)',      // yellow-700\n    bgColor: 'rgb(254, 249, 195)',     // yellow-50\n    borderColor: 'rgb(254, 240, 138)', // yellow-200\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  // Handle edge cases: NaN, Infinity, undefined, null, negative\n  if (\n    typeof harmonyLost !== 'number' ||\n    !Number.isFinite(harmonyLost) ||\n    Number.isNaN(harmonyLost) ||\n    harmonyLost < 0\n  ) {\n    return 'minor'; // Default to least severe for invalid values\n  }\n  if (harmonyLost >= 0.8) return 'extremely_severe';\n  if (harmonyLost >= 0.5) return 'severe';\n  if (harmonyLost >= 0.3) return 'moderate';\n  return 'minor';\n}\n\nfunction SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity] || SEVERITY_CONFIGS.moderate;\n\n  return (\n    <span\n      className=\"px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap flex-shrink-0\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================\n\ntype ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n\ninterface PhaseConfig {\n  textColor: string;\n  bgColor: string;\n}\n\nconst PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n  Foundational: {\n    textColor: 'rgb(4, 120, 87)',     // emerald-700\n    bgColor: 'rgb(209, 250, 229)',    // emerald-50\n  },\n  'Non-Invasive': {\n    textColor: 'rgb(29, 78, 216)',    // blue-700\n    bgColor: 'rgb(219, 234, 254)',    // blue-50\n  },\n  'Minimally Invasive': {\n    textColor: 'rgb(109, 40, 217)',   // violet-700\n    bgColor: 'rgb(237, 233, 254)',    // violet-50\n  },\n  Surgical: {\n    textColor: 'rgb(126, 34, 206)',   // purple-700\n    bgColor: 'rgb(243, 232, 255)',    // purple-50\n  },\n};\n\nfunction PhaseBadge({ phase }: { phase: ProcedurePhase }) {\n  const config = PHASE_CONFIGS[phase] || PHASE_CONFIGS['Non-Invasive'];\n\n  return (\n    <span\n      className=\"px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {phase}\n    </span>\n  );\n}\n\n// ============================================\n// CONTRIBUTING RATIO BUTTON (Harmony Style - Dark Theme)\n// ============================================\n\ninterface ContributingRatioButtonProps {\n  ratioName: string;\n  score: number | string;\n  onClick: () => void;\n  animationDelay?: number;\n}\n\nfunction ContributingRatioButton({\n  ratioName,\n  score,\n  onClick,\n  animationDelay = 0,\n}: ContributingRatioButtonProps) {\n  const numericScore = typeof score === 'number' ? score : 0;\n  const color = getScoreColor(numericScore);\n\n  return (\n    <motion.button\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.2, delay: animationDelay }}\n      onClick={onClick}\n      className=\"w-full flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-lg border transition-all text-left cursor-pointer group bg-neutral-900/80 border-neutral-800 hover:border-neutral-700 hover:bg-neutral-800/50\"\n    >\n      <span className=\"text-xs sm:text-sm font-medium transition-colors text-neutral-200 group-hover:text-white\">\n        {ratioName}\n      </span>\n      <div className=\"flex items-baseline gap-0.5 sm:gap-1\">\n        <span className=\"text-xs sm:text-sm font-semibold\" style={{ color: typeof score === 'string' ? '#a3a3a3' : color }}>\n          {typeof score === 'number' ? score.toFixed(1) : score}\n        </span>\n        <span className=\"text-[10px] sm:text-xs text-neutral-500\">/10</span>\n      </div>\n    </motion.button>\n  );\n}\n\n// ============================================\n// PLAN ITEM (Recommendation in \"Your Plan\" section)\n// ============================================\n\ninterface PlanItemProps {\n  name: string;\n  phase: ProcedurePhase;\n  animationDelay?: number;\n}\n\nfunction PlanItem({ name, phase, animationDelay = 0 }: PlanItemProps) {\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.2, delay: animationDelay }}\n      className=\"flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-lg bg-neutral-900/80 border border-neutral-800\"\n    >\n      <span className=\"text-xs sm:text-sm text-neutral-200 font-medium\">{name}</span>\n      <div className=\"flex items-center gap-2\">\n        <span className=\"text-[9px] sm:text-[10px] px-1.5 py-0.5 rounded bg-emerald-500/20 text-emerald-400 font-medium\">\n          In Plan\n        </span>\n        <PhaseBadge phase={phase} />\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// KEY STRENGTH CARD (Harmony Style)\n// ============================================\n\ninterface KeyStrengthCardProps {\n  strength: Strength;\n  isExpanded: boolean;\n  onToggle: () => void;\n  onRatioClick: (ratio: ResponsibleRatio) => void;\n  animationDelay?: number;\n}\n\nfunction KeyStrengthCard({\n  strength,\n  isExpanded,\n  onToggle,\n  onRatioClick,\n  animationDelay = 0,\n}: KeyStrengthCardProps) {\n  const score = typeof strength.avgScore === 'number' ? strength.avgScore : 0;\n  const color = getScoreColor(score);\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.3, delay: animationDelay }}\n      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-cyan-500/30' : 'border-neutral-800 hover:border-neutral-700'\n        }`}\n    >\n      {/* Header Button */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <QualityBadge quality={strength.qualityLevel} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {strength.strengthName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n                {strength.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Score + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right\">\n              <div\n                className=\"text-lg sm:text-xl font-semibold tracking-tight\"\n                style={{ color: typeof strength.avgScore === 'string' ? '#a3a3a3' : color }}\n              >\n                {typeof strength.avgScore === 'number' ? strength.avgScore.toFixed(2) : strength.avgScore}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium mt-0.5\">avg /10</div>\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3 }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"border-t border-neutral-800 bg-neutral-800/30 px-4 sm:px-5 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Contributing Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {strength.responsibleRatios.map((ratio, i) => (\n                  <ContributingRatioButton\n                    key={ratio.ratioId}\n                    ratioName={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick(ratio)}\n                    animationDelay={i * 0.05}\n                  />\n                ))}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n\n// ============================================\n// AREA OF IMPROVEMENT CARD (Harmony Style with Your Plan)\n// ============================================\n\ninterface AreaOfImprovementCardProps {\n  flaw: Flaw;\n  isExpanded: boolean;\n  onToggle: () => void;\n  onRatioClick: (ratio: ResponsibleRatio) => void;\n  recommendations?: Recommendation[];\n  animationDelay?: number;\n}\n\nfunction AreaOfImprovementCard({\n  flaw,\n  isExpanded,\n  onToggle,\n  onRatioClick,\n  recommendations = [],\n  animationDelay = 0,\n}: AreaOfImprovementCardProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n\n  // Find matching recommendations for this flaw\n  const matchedRecommendations = useMemo(() => {\n    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n    return recommendations.filter(rec =>\n      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n    ).slice(0, 3);\n  }, [flaw, recommendations]);\n\n  // Map phase names\n  const mapPhase = (phase: string): ProcedurePhase => {\n    if (phase === 'Foundational') return 'Foundational';\n    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n    if (phase === 'Surgical') return 'Surgical';\n    return 'Non-Invasive';\n  };\n\n  return (\n    <motion.div\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.3, delay: animationDelay }}\n      className={`rounded-xl bg-neutral-900/80 border overflow-hidden transition-all duration-200 ${isExpanded ? 'border-red-500/30' : 'border-neutral-800 hover:border-neutral-700'\n        }`}\n    >\n      {/* Header Button */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-5 hover:bg-neutral-800/30 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <SeverityBadge severity={severity} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-white mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed line-clamp-2\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-500\">\n                -{(typeof flaw.harmonyPercentageLost === 'number' && Number.isFinite(flaw.harmonyPercentageLost)\n                  ? flaw.harmonyPercentageLost\n                  : 0\n                ).toFixed(2)}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-neutral-500 font-medium\">points</div>\n              {flaw.rollingHarmonyPercentageLost !== undefined &&\n                typeof flaw.rollingHarmonyPercentageLost === 'number' &&\n                Number.isFinite(flaw.rollingHarmonyPercentageLost) && (\n                  <div className=\"text-[10px] text-neutral-600 font-medium pt-0.5 border-t border-neutral-700 mt-1\">\n                    Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n                  </div>\n                )}\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3 }}\n            className=\"overflow-hidden\"\n          >\n            {/* Affected Ratios Section */}\n            <div className=\"border-t border-neutral-800 bg-neutral-800/30 px-4 sm:px-5 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-neutral-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Affected Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {flaw.responsibleRatios.map((ratio, i) => (\n                  <ContributingRatioButton\n                    key={ratio.ratioId}\n                    ratioName={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick(ratio)}\n                    animationDelay={i * 0.05}\n                  />\n                ))}\n              </div>\n            </div>\n\n            {/* Your Plan Section (if there are matched recommendations) */}\n            {matchedRecommendations.length > 0 && (\n              <div className=\"border-t border-neutral-800 bg-emerald-900/10 px-4 sm:px-5 py-3 sm:py-4\">\n                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n                  <Sparkles className=\"w-3 h-3 text-emerald-400\" />\n                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-400 uppercase tracking-wider\">\n                    Your Plan\n                  </span>\n                </div>\n                <div className=\"space-y-2\">\n                  {matchedRecommendations.map((rec, i) => (\n                    <PlanItem\n                      key={rec.ref_id}\n                      name={rec.name}\n                      phase={mapPhase(rec.phase)}\n                      animationDelay={i * 0.05}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n\n// ============================================\n// KEY STRENGTHS SECTION (Harmony Style)\n// ============================================\n\ninterface KeyStrengthsSectionProps {\n  strengths: Strength[];\n  onRatioClick: (ratio: ResponsibleRatio, categoryName: string) => void;\n  initialShowCount?: number;\n}\n\nexport function KeyStrengthsSection({\n  strengths,\n  onRatioClick,\n  initialShowCount = 3,\n}: KeyStrengthsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const displayedStrengths = showAll ? strengths : strengths.slice(0, initialShowCount);\n  const remainingCount = Math.max(0, strengths.length - initialShowCount);\n\n  // Calculate average strength contribution (handle invalid values)\n  const avgScore = useMemo(() => {\n    if (!strengths || strengths.length === 0) return 0;\n    const validScores = strengths.filter(\n      (s) => typeof s.avgScore === 'number' && Number.isFinite(s.avgScore)\n    );\n    if (validScores.length === 0) return 0;\n    return validScores.reduce((sum, s) => sum + (s.avgScore as number), 0) / validScores.length;\n  }, [strengths]);\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/50 border border-neutral-800 p-4 sm:p-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-4 sm:mb-5\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-8 rounded-lg bg-cyan-500/20 flex items-center justify-center\">\n            <Sparkles className=\"w-4 h-4 text-cyan-400\" />\n          </div>\n          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n            Key Strengths\n          </h3>\n        </div>\n        <div className=\"text-right\">\n          <span className=\"text-sm text-neutral-500\">\n            {strengths.length} total\n          </span>\n          {strengths.length > 0 && (\n            <p className=\"text-xs text-green-400 font-medium\">\n              Avg: {avgScore.toFixed(1)}/10\n            </p>\n          )}\n        </div>\n      </div>\n\n      {/* Cards */}\n      <div className=\"space-y-3\">\n        {displayedStrengths.length > 0 ? (\n          displayedStrengths.map((strength, i) => (\n            <KeyStrengthCard\n              key={strength.id}\n              strength={strength}\n              isExpanded={expandedId === strength.id}\n              onToggle={() => setExpandedId(expandedId === strength.id ? null : strength.id)}\n              onRatioClick={(ratio) => onRatioClick(ratio, strength.categoryName)}\n              animationDelay={i * 0.04}\n            />\n          ))\n        ) : (\n          <div className=\"rounded-xl bg-neutral-800/50 border border-neutral-700 p-6 text-center\">\n            <p className=\"text-neutral-500\">No significant strengths detected</p>\n          </div>\n        )}\n      </div>\n\n      {/* Show More Button */}\n      {remainingCount > 0 && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-4 py-3 rounded-lg bg-neutral-800/50 border border-neutral-700 hover:border-neutral-600 hover:bg-neutral-800 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show ${remainingCount} More`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// AREAS OF IMPROVEMENT SECTION (Harmony Style with Your Plan)\n// ============================================\n\ninterface AreasOfImprovementSectionProps {\n  flaws: Flaw[];\n  onRatioClick: (ratio: ResponsibleRatio, categoryName: string) => void;\n  initialShowCount?: number;\n}\n\nexport function AreasOfImprovementSection({\n  flaws,\n  onRatioClick,\n  initialShowCount = 3,\n}: AreasOfImprovementSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  // Get recommendations from context\n  const { recommendations } = useResults();\n\n  const displayedFlaws = showAll ? flaws : flaws.slice(0, initialShowCount);\n  const remainingCount = Math.max(0, flaws.length - initialShowCount);\n\n  // Calculate total impact from all flaws (handle invalid values)\n  const totalImpact = flaws.reduce((sum, f) => {\n    const impact = typeof f.harmonyPercentageLost === 'number' && Number.isFinite(f.harmonyPercentageLost)\n      ? f.harmonyPercentageLost\n      : 0;\n    return sum + impact;\n  }, 0);\n\n  return (\n    <div className=\"rounded-xl bg-neutral-900/50 border border-neutral-800 p-4 sm:p-6\">\n      {/* Header */}\n      <div className=\"flex items-center justify-between mb-4 sm:mb-5\">\n        <div className=\"flex items-center gap-2\">\n          <div className=\"w-8 h-8 rounded-lg bg-amber-500/20 flex items-center justify-center\">\n            <AlertTriangle className=\"w-4 h-4 text-amber-400\" />\n          </div>\n          <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-white\">\n            Areas of Improvement\n          </h3>\n        </div>\n        <div className=\"text-right\">\n          <span className=\"text-sm text-neutral-500\">\n            {flaws.length} total\n          </span>\n          {flaws.length > 0 && (\n            <p className=\"text-xs text-red-400 font-medium\">\n              Impact: -{totalImpact.toFixed(1)} pts\n            </p>\n          )}\n        </div>\n      </div>\n\n      {/* Cards */}\n      <div className=\"space-y-3\">\n        {displayedFlaws.length > 0 ? (\n          displayedFlaws.map((flaw, i) => (\n            <AreaOfImprovementCard\n              key={flaw.id}\n              flaw={flaw}\n              isExpanded={expandedId === flaw.id}\n              onToggle={() => setExpandedId(expandedId === flaw.id ? null : flaw.id)}\n              onRatioClick={(ratio) => onRatioClick(ratio, flaw.categoryName)}\n              recommendations={recommendations}\n              animationDelay={i * 0.04}\n            />\n          ))\n        ) : (\n          <div className=\"rounded-xl bg-neutral-800/50 border border-neutral-700 p-6 text-center\">\n            <p className=\"text-neutral-500\">No significant areas for improvement detected</p>\n          </div>\n        )}\n      </div>\n\n      {/* Show More Button */}\n      {remainingCount > 0 && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-4 py-3 rounded-lg bg-neutral-800/50 border border-neutral-700 hover:border-neutral-600 hover:bg-neutral-800 transition-all duration-200 text-sm font-medium text-white\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show ${remainingCount} More`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-neutral-400\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n","numLines":689,"startLine":1,"totalLines":689}}}
{"parentUuid":"fbcfaf37-f413-44b6-a138-cf97ecde423b","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01Uub7iyC2cSYEptrHd7xiHG","type":"tool_result","content":"     1â†’'use client';\n     2â†’\n     3â†’import { useState, useMemo } from 'react';\n     4â†’import { motion, AnimatePresence } from 'framer-motion';\n     5â†’import { ChevronDown, AlertTriangle, CheckCircle, Sparkles } from 'lucide-react';\n     6â†’import { Strength, Flaw, Recommendation, getScoreColor } from '@/types/results';\n     7â†’\n     8â†’// ============================================\n     9â†’// QUALITY TIER BADGES (Harmony Style) - Strengths\n    10â†’// ============================================\n    11â†’\n    12â†’type QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\n    13â†’\n    14â†’interface QualityConfig {\n    15â†’  label: string;\n    16â†’  textColor: string;\n    17â†’  bgColor: string;\n    18â†’}\n    19â†’\n    20â†’const QUALITY_CONFIGS: Record<QualityTier, QualityConfig> = {\n    21â†’  ideal: {\n    22â†’    label: 'Ideal',\n    23â†’    textColor: 'rgb(8, 145, 178)',    // cyan-600\n    24â†’    bgColor: 'rgb(207, 250, 254)',    // cyan-100\n    25â†’  },\n    26â†’  excellent: {\n    27â†’    label: 'Excellent',\n    28â†’    textColor: 'rgb(4, 120, 87)',     // emerald-700\n    29â†’    bgColor: 'rgb(209, 250, 229)',    // emerald-100\n    30â†’  },\n    31â†’  good: {\n    32â†’    label: 'Good',\n    33â†’    textColor: 'rgb(21, 128, 61)',    // green-700\n    34â†’    bgColor: 'rgb(220, 252, 231)',    // green-100\n    35â†’  },\n    36â†’  below_average: {\n    37â†’    label: 'Average',\n    38â†’    textColor: 'rgb(113, 113, 122)',  // gray-500\n    39â†’    bgColor: 'rgb(244, 244, 245)',    // gray-100\n    40â†’  },\n    41â†’};\n    42â†’\n    43â†’function QualityBadge({ quality }: { quality: QualityTier }) {\n    44â†’  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n    45â†’\n    46â†’  return (\n    47â†’    <span\n    48â†’      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n    49â†’      style={{\n    50â†’        color: config.textColor,\n    51â†’        backgroundColor: config.bgColor,\n    52â†’      }}\n    53â†’    >\n    54â†’      {config.label}\n    55â†’    </span>\n    56â†’  );\n    57â†’}\n    58â†’\n    59â†’// ============================================\n    60â†’// SEVERITY BADGES (Harmony Style) - Flaws\n    61â†’// ============================================\n    62â†’\n    63â†’type SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n    64â†’\n    65â†’interface SeverityConfig {\n    66â†’  label: string;\n    67â†’  textColor: string;\n    68â†’  bgColor: string;\n    69â†’  borderColor?: string;\n    70â†’}\n    71â†’\n    72â†’const SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {\n    73â†’  extremely_severe: {\n    74â†’    label: 'extremely severe',\n    75â†’    textColor: 'rgb(127, 29, 29)',     // red-900\n    76â†’    bgColor: 'rgb(254, 202, 202)',     // red-200\n    77â†’  },\n    78â†’  severe: {\n    79â†’    label: 'severe',\n    80â†’    textColor: 'rgb(185, 28, 28)',     // red-700\n    81â†’    bgColor: 'rgb(254, 226, 226)',     // red-50\n    82â†’    borderColor: 'rgb(254, 202, 202)', // red-200\n    83â†’  },\n    84â†’  moderate: {\n    85â†’    label: 'moderate',\n    86â†’    textColor: 'rgb(194, 65, 12)',     // orange-700\n    87â†’    bgColor: 'rgb(255, 237, 213)',     // orange-50\n    88â†’    borderColor: 'rgb(254, 215, 170)', // orange-200\n    89â†’  },\n    90â†’  minor: {\n    91â†’    label: 'minor',\n    92â†’    textColor: 'rgb(161, 98, 7)',      // yellow-700\n    93â†’    bgColor: 'rgb(254, 249, 195)',     // yellow-50\n    94â†’    borderColor: 'rgb(254, 240, 138)', // yellow-200\n    95â†’  },\n    96â†’};\n    97â†’\n    98â†’function getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n    99â†’  if (harmonyLost >= 0.8) return 'extremely_severe';\n   100â†’  if (harmonyLost >= 0.5) return 'severe';\n   101â†’  if (harmonyLost >= 0.3) return 'moderate';\n   102â†’  return 'minor';\n   103â†’}\n   104â†’\n   105â†’function getSeverityFromScore(score: number): SeverityLevel {\n   106â†’  if (score <= 2) return 'extremely_severe';\n   107â†’  if (score <= 4) return 'severe';\n   108â†’  if (score <= 6) return 'moderate';\n   109â†’  return 'minor';\n   110â†’}\n   111â†’\n   112â†’function SeverityBadge({ severity }: { severity: SeverityLevel }) {\n   113â†’  const config = SEVERITY_CONFIGS[severity];\n   114â†’\n   115â†’  return (\n   116â†’    <span\n   117â†’      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n   118â†’      style={{\n   119â†’        color: config.textColor,\n   120â†’        backgroundColor: config.bgColor,\n   121â†’        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n   122â†’      }}\n   123â†’    >\n   124â†’      {config.label}\n   125â†’    </span>\n   126â†’  );\n   127â†’}\n   128â†’\n   129â†’// ============================================\n   130â†’// PROCEDURE PHASE BADGE\n   131â†’// ============================================\n   132â†’\n   133â†’type ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n   134â†’\n   135â†’interface PhaseConfig {\n   136â†’  textColor: string;\n   137â†’  bgColor: string;\n   138â†’}\n   139â†’\n   140â†’const PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n   141â†’  Foundational: {\n   142â†’    textColor: 'rgb(4, 120, 87)',     // emerald-700\n   143â†’    bgColor: 'rgb(209, 250, 229)',    // emerald-50\n   144â†’  },\n   145â†’  'Non-Invasive': {\n   146â†’    textColor: 'rgb(29, 78, 216)',    // blue-700\n   147â†’    bgColor: 'rgb(219, 234, 254)',    // blue-50\n   148â†’  },\n   149â†’  'Minimally Invasive': {\n   150â†’    textColor: 'rgb(109, 40, 217)',   // violet-700\n   151â†’    bgColor: 'rgb(237, 233, 254)',    // violet-50\n   152â†’  },\n   153â†’  Surgical: {\n   154â†’    textColor: 'rgb(126, 34, 206)',   // purple-700\n   155â†’    bgColor: 'rgb(243, 232, 255)',    // purple-50\n   156â†’  },\n   157â†’};\n   158â†’\n   159â†’function PhaseBadge({ phase }: { phase: ProcedurePhase }) {\n   160â†’  const config = PHASE_CONFIGS[phase] || PHASE_CONFIGS['Non-Invasive'];\n   161â†’\n   162â†’  return (\n   163â†’    <span\n   164â†’      className=\"inline-flex items-center px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium\"\n   165â†’      style={{\n   166â†’        color: config.textColor,\n   167â†’        backgroundColor: config.bgColor,\n   168â†’      }}\n   169â†’    >\n   170â†’      {phase}\n   171â†’    </span>\n   172â†’  );\n   173â†’}\n   174â†’\n   175â†’// ============================================\n   176â†’// CONTRIBUTING/AFFECTED RATIO ITEM\n   177â†’// ============================================\n   178â†’\n   179â†’interface RatioItemProps {\n   180â†’  name: string;\n   181â†’  score: number | string;\n   182â†’  onClick?: () => void;\n   183â†’  animationDelay?: number;\n   184â†’}\n   185â†’\n   186â†’function RatioItem({ name, score, onClick, animationDelay = 0 }: RatioItemProps) {\n   187â†’  const numericScore = typeof score === 'number' ? score : 0;\n   188â†’\n   189â†’  return (\n   190â†’    <button\n   191â†’      onClick={onClick}\n   192â†’      className=\"w-full flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-white border border-gray-200 transition-all duration-200 hover:border-gray-300 hover:shadow-sm text-left cursor-pointer animate-fade-in\"\n   193â†’      style={{\n   194â†’        animationDuration: '0.2s',\n   195â†’        animationDelay: `${animationDelay}s`,\n   196â†’      }}\n   197â†’    >\n   198â†’      <span className=\"text-xs sm:text-sm text-gray-700 font-medium\">{name}</span>\n   199â†’      <div className=\"flex items-baseline gap-0.5 sm:gap-1\">\n   200â†’        <span\n   201â†’          className=\"text-xs sm:text-sm font-semibold\"\n   202â†’          style={{ color: typeof score === 'string' ? '#a3a3a3' : getScoreColor(numericScore) }}\n   203â†’        >\n   204â†’          {typeof score === 'number' ? score.toFixed(1) : score}\n   205â†’        </span>\n   206â†’        <span className=\"text-[10px] sm:text-xs text-gray-500\">/10</span>\n   207â†’      </div>\n   208â†’    </button>\n   209â†’  );\n   210â†’}\n   211â†’\n   212â†’// ============================================\n   213â†’// PLAN ITEM (Recommendation)\n   214â†’// ============================================\n   215â†’\n   216â†’interface PlanItemProps {\n   217â†’  name: string;\n   218â†’  phase: ProcedurePhase;\n   219â†’  inPlan?: boolean;\n   220â†’  animationDelay?: number;\n   221â†’}\n   222â†’\n   223â†’function PlanItem({ name, phase, inPlan = true, animationDelay = 0 }: PlanItemProps) {\n   224â†’  return (\n   225â†’    <div\n   226â†’      className=\"flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-white border border-gray-200 animate-fade-in\"\n   227â†’      style={{\n   228â†’        animationDuration: '0.2s',\n   229â†’        animationDelay: `${animationDelay}s`,\n   230â†’      }}\n   231â†’    >\n   232â†’      <span className=\"text-xs sm:text-sm text-gray-700 font-medium\">{name}</span>\n   233â†’      <div className=\"flex items-center gap-2\">\n   234â†’        {inPlan && (\n   235â†’          <span className=\"text-[9px] sm:text-[10px] px-1.5 py-0.5 rounded bg-emerald-100 text-emerald-700 font-medium\">\n   236â†’            In Plan\n   237â†’          </span>\n   238â†’        )}\n   239â†’        <PhaseBadge phase={phase} />\n   240â†’      </div>\n   241â†’    </div>\n   242â†’  );\n   243â†’}\n   244â†’\n   245â†’// ============================================\n   246â†’// STRENGTH CARD (Harmony Style)\n   247â†’// ============================================\n   248â†’\n   249â†’interface StrengthCardProps {\n   250â†’  strength: Strength;\n   251â†’  isExpanded?: boolean;\n   252â†’  onToggle?: () => void;\n   253â†’  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n   254â†’  animationDelay?: number;\n   255â†’}\n   256â†’\n   257â†’export function StrengthCard({\n   258â†’  strength,\n   259â†’  isExpanded = false,\n   260â†’  onToggle,\n   261â†’  onRatioClick,\n   262â†’  animationDelay = 0,\n   263â†’}: StrengthCardProps) {\n   264â†’  // Get score color for the average score\n   265â†’  const numericScore = typeof strength.avgScore === 'number' ? strength.avgScore : 0;\n   266â†’  const scoreColor = getScoreColor(numericScore);\n   267â†’\n   268â†’  return (\n   269â†’    <div\n   270â†’      className=\"rounded-lg bg-white border border-gray-200 overflow-hidden transition-all duration-200 hover:border-gray-300 hover:shadow-sm animate-fade-in\"\n   271â†’      style={{ animationDelay: `${animationDelay}s` }}\n   272â†’    >\n   273â†’      {/* Header */}\n   274â†’      <button\n   275â†’        onClick={onToggle}\n   276â†’        className=\"w-full p-4 sm:p-6 hover:bg-gray-50/50 transition-colors duration-200 text-left\"\n   277â†’      >\n   278â†’        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n   279â†’          {/* Left: Badge + Content */}\n   280â†’          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n   281â†’            <QualityBadge quality={strength.qualityLevel} />\n   282â†’            <div className=\"flex-1 min-w-0\">\n   283â†’              <h4 className=\"text-sm sm:text-base font-semibold text-gray-900 mb-1 sm:mb-1.5 leading-snug\">\n   284â†’                {strength.strengthName}\n   285â†’              </h4>\n   286â†’              <p className=\"text-xs sm:text-sm text-gray-600 leading-relaxed\">\n   287â†’                {strength.summary}\n   288â†’              </p>\n   289â†’            </div>\n   290â†’          </div>\n   291â†’\n   292â†’          {/* Right: Score + Chevron */}\n   293â†’          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n   294â†’            <div className=\"text-right\">\n   295â†’              <div\n   296â†’                className=\"text-lg sm:text-xl font-semibold tracking-tight transition-colors duration-200\"\n   297â†’                style={{ color: scoreColor }}\n   298â†’              >\n   299â†’                {typeof strength.avgScore === 'number' ? strength.avgScore.toFixed(2) : strength.avgScore}\n   300â†’              </div>\n   301â†’              <div className=\"text-[10px] sm:text-xs text-gray-500 font-medium mt-0.5\">avg /10</div>\n   302â†’            </div>\n   303â†’            <motion.div\n   304â†’              animate={{ rotate: isExpanded ? 180 : 0 }}\n   305â†’              transition={{ duration: 0.3 }}\n   306â†’            >\n   307â†’              <ChevronDown className=\"w-4 h-4 text-gray-400\" />\n   308â†’            </motion.div>\n   309â†’          </div>\n   310â†’        </div>\n   311â†’      </button>\n   312â†’\n   313â†’      {/* Expanded Content */}\n   314â†’      <AnimatePresence initial={false}>\n   315â†’        {isExpanded && (\n   316â†’          <motion.div\n   317â†’            initial={{ height: 0, opacity: 0 }}\n   318â†’            animate={{ height: 'auto', opacity: 1 }}\n   319â†’            exit={{ height: 0, opacity: 0 }}\n   320â†’            transition={{ duration: 0.3, ease: 'easeInOut' }}\n   321â†’            className=\"overflow-hidden\"\n   322â†’          >\n   323â†’            <div className=\"border-t border-gray-200 bg-gray-50/50 px-4 sm:px-6 py-3 sm:py-4\">\n   324â†’              <div className=\"text-[10px] sm:text-xs font-medium text-gray-500 uppercase tracking-wider mb-2 sm:mb-3\">\n   325â†’                Contributing Ratios\n   326â†’              </div>\n   327â†’              <div className=\"space-y-2\">\n   328â†’                {strength.responsibleRatios.map((ratio, i) => (\n   329â†’                  <RatioItem\n   330â†’                    key={ratio.ratioId}\n   331â†’                    name={ratio.ratioName}\n   332â†’                    score={ratio.score}\n   333â†’                    onClick={() => onRatioClick?.(ratio)}\n   334â†’                    animationDelay={i * 0.03}\n   335â†’                  />\n   336â†’                ))}\n   337â†’              </div>\n   338â†’            </div>\n   339â†’          </motion.div>\n   340â†’        )}\n   341â†’      </AnimatePresence>\n   342â†’    </div>\n   343â†’  );\n   344â†’}\n   345â†’\n   346â†’// ============================================\n   347â†’// FLAW CARD (Harmony Style - Areas of Improvement)\n   348â†’// ============================================\n   349â†’\n   350â†’interface FlawCardProps {\n   351â†’  flaw: Flaw;\n   352â†’  isExpanded?: boolean;\n   353â†’  onToggle?: () => void;\n   354â†’  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n   355â†’  recommendations?: Recommendation[];\n   356â†’  animationDelay?: number;\n   357â†’}\n   358â†’\n   359â†’export function FlawCard({\n   360â†’  flaw,\n   361â†’  isExpanded = false,\n   362â†’  onToggle,\n   363â†’  onRatioClick,\n   364â†’  recommendations = [],\n   365â†’  animationDelay = 0,\n   366â†’}: FlawCardProps) {\n   367â†’  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n   368â†’\n   369â†’  // Find matching recommendations for this flaw\n   370â†’  const matchedRecommendations = useMemo(() => {\n   371â†’    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n   372â†’    return recommendations.filter(rec =>\n   373â†’      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n   374â†’      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n   375â†’    ).slice(0, 3); // Limit to 3 recommendations\n   376â†’  }, [flaw, recommendations]);\n   377â†’\n   378â†’  // Map phase names\n   379â†’  const mapPhase = (phase: string): ProcedurePhase => {\n   380â†’    if (phase === 'Foundational') return 'Foundational';\n   381â†’    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n   382â†’    if (phase === 'Surgical') return 'Surgical';\n   383â†’    return 'Non-Invasive';\n   384â†’  };\n   385â†’\n   386â†’  return (\n   387â†’    <div\n   388â†’      className=\"rounded-lg bg-white border border-gray-200 overflow-hidden transition-all duration-200 hover:border-gray-300 hover:shadow-sm animate-fade-in\"\n   389â†’      style={{ animationDelay: `${animationDelay}s` }}\n   390â†’    >\n   391â†’      {/* Header */}\n   392â†’      <button\n   393â†’        onClick={onToggle}\n   394â†’        className=\"w-full p-4 sm:p-6 hover:bg-gray-50/50 transition-colors duration-200 text-left\"\n   395â†’      >\n   396â†’        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n   397â†’          {/* Left: Badge + Content */}\n   398â†’          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n   399â†’            <SeverityBadge severity={severity} />\n   400â†’            <div className=\"flex-1 min-w-0\">\n   401â†’              <h4 className=\"text-sm sm:text-base font-semibold text-gray-900 mb-1 sm:mb-1.5 leading-snug\">\n   402â†’                {flaw.flawName}\n   403â†’              </h4>\n   404â†’              <p className=\"text-xs sm:text-sm text-gray-600 leading-relaxed\">\n   405â†’                {flaw.summary}\n   406â†’              </p>\n   407â†’            </div>\n   408â†’          </div>\n   409â†’\n   410â†’          {/* Right: Points impact + Chevron */}\n   411â†’          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n   412â†’            <div className=\"text-right space-y-1\">\n   413â†’              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-600\">\n   414â†’                -{flaw.harmonyPercentageLost.toFixed(2)}\n   415â†’              </div>\n   416â†’              <div className=\"text-[10px] sm:text-xs text-gray-500 font-medium\">points</div>\n   417â†’              {flaw.rollingHarmonyPercentageLost !== undefined && (\n   418â†’                <div className=\"text-[10px] text-gray-400 font-medium pt-0.5 border-t border-gray-200 mt-1 pt-1\">\n   419â†’                  Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n   420â†’                </div>\n   421â†’              )}\n   422â†’            </div>\n   423â†’            <motion.div\n   424â†’              animate={{ rotate: isExpanded ? 180 : 0 }}\n   425â†’              transition={{ duration: 0.3 }}\n   426â†’            >\n   427â†’              <ChevronDown className=\"w-4 h-4 text-gray-400\" />\n   428â†’            </motion.div>\n   429â†’          </div>\n   430â†’        </div>\n   431â†’      </button>\n   432â†’\n   433â†’      {/* Expanded Content */}\n   434â†’      <AnimatePresence initial={false}>\n   435â†’        {isExpanded && (\n   436â†’          <motion.div\n   437â†’            initial={{ height: 0, opacity: 0 }}\n   438â†’            animate={{ height: 'auto', opacity: 1 }}\n   439â†’            exit={{ height: 0, opacity: 0 }}\n   440â†’            transition={{ duration: 0.3, ease: 'easeInOut' }}\n   441â†’            className=\"overflow-hidden\"\n   442â†’          >\n   443â†’            {/* Affected Ratios Section */}\n   444â†’            <div className=\"border-t border-gray-200 bg-gray-50/50 px-4 sm:px-6 py-3 sm:py-4\">\n   445â†’              <div className=\"text-[10px] sm:text-xs font-medium text-gray-500 uppercase tracking-wider mb-2 sm:mb-3\">\n   446â†’                Affected Ratios\n   447â†’              </div>\n   448â†’              <div className=\"space-y-2\">\n   449â†’                {flaw.responsibleRatios.map((ratio, i) => (\n   450â†’                  <RatioItem\n   451â†’                    key={ratio.ratioId}\n   452â†’                    name={ratio.ratioName}\n   453â†’                    score={ratio.score}\n   454â†’                    onClick={() => onRatioClick?.(ratio)}\n   455â†’                    animationDelay={i * 0.03}\n   456â†’                  />\n   457â†’                ))}\n   458â†’              </div>\n   459â†’            </div>\n   460â†’\n   461â†’            {/* Your Plan Section (if there are matched recommendations) */}\n   462â†’            {matchedRecommendations.length > 0 && (\n   463â†’              <div className=\"border-t border-gray-200 bg-emerald-50/30 px-4 sm:px-6 py-3 sm:py-4\">\n   464â†’                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n   465â†’                  <Sparkles className=\"w-3 h-3 text-emerald-600\" />\n   466â†’                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-700 uppercase tracking-wider\">\n   467â†’                    Your Plan\n   468â†’                  </span>\n   469â†’                </div>\n   470â†’                <div className=\"space-y-2\">\n   471â†’                  {matchedRecommendations.map((rec, i) => (\n   472â†’                    <PlanItem\n   473â†’                      key={rec.ref_id}\n   474â†’                      name={rec.name}\n   475â†’                      phase={mapPhase(rec.phase)}\n   476â†’                      inPlan={true}\n   477â†’                      animationDelay={i * 0.03}\n   478â†’                    />\n   479â†’                  ))}\n   480â†’                </div>\n   481â†’              </div>\n   482â†’            )}\n   483â†’          </motion.div>\n   484â†’        )}\n   485â†’      </AnimatePresence>\n   486â†’    </div>\n   487â†’  );\n   488â†’}\n   489â†’\n   490â†’// ============================================\n   491â†’// STRENGTHS SECTION (Container)\n   492â†’// ============================================\n   493â†’\n   494â†’interface StrengthsSectionProps {\n   495â†’  strengths: Strength[];\n   496â†’  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n   497â†’  maxVisible?: number;\n   498â†’}\n   499â†’\n   500â†’export function StrengthsSection({\n   501â†’  strengths,\n   502â†’  onRatioClick,\n   503â†’  maxVisible = 5,\n   504â†’}: StrengthsSectionProps) {\n   505â†’  const [expandedId, setExpandedId] = useState<string | null>(null);\n   506â†’  const [showAll, setShowAll] = useState(false);\n   507â†’\n   508â†’  const visibleStrengths = showAll ? strengths : strengths.slice(0, maxVisible);\n   509â†’  const hasMore = strengths.length > maxVisible;\n   510â†’\n   511â†’  return (\n   512â†’    <div className=\"rounded-lg bg-white border border-gray-200 p-4 sm:p-6 lg:p-8\">\n   513â†’      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n   514â†’        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-gray-900\">\n   515â†’          Key Strengths\n   516â†’        </h3>\n   517â†’      </div>\n   518â†’\n   519â†’      <div className=\"space-y-3\">\n   520â†’        {visibleStrengths.map((strength, i) => (\n   521â†’          <StrengthCard\n   522â†’            key={strength.id}\n   523â†’            strength={strength}\n   524â†’            isExpanded={expandedId === strength.id}\n   525â†’            onToggle={() => setExpandedId(expandedId === strength.id ? null : strength.id)}\n   526â†’            onRatioClick={onRatioClick}\n   527â†’            animationDelay={i * 0.04}\n   528â†’          />\n   529â†’        ))}\n   530â†’      </div>\n   531â†’\n   532â†’      {hasMore && (\n   533â†’        <button\n   534â†’          onClick={() => setShowAll(!showAll)}\n   535â†’          className=\"w-full mt-6 py-3 rounded-lg bg-white border border-gray-200 hover:border-gray-300 hover:shadow-sm transition-all duration-200 text-sm font-medium text-gray-900\"\n   536â†’        >\n   537â†’          <span className=\"flex items-center justify-center gap-2\">\n   538â†’            <span>{showAll ? 'Show Less' : `Show All ${strengths.length} Strengths`}</span>\n   539â†’            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n   540â†’              <ChevronDown className=\"w-4 h-4 text-gray-500\" />\n   541â†’            </motion.div>\n   542â†’          </span>\n   543â†’        </button>\n   544â†’      )}\n   545â†’    </div>\n   546â†’  );\n   547â†’}\n   548â†’\n   549â†’// ============================================\n   550â†’// FLAWS SECTION (Areas of Improvement Container)\n   551â†’// ============================================\n   552â†’\n   553â†’interface FlawsSectionProps {\n   554â†’  flaws: Flaw[];\n   555â†’  recommendations?: Recommendation[];\n   556â†’  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n   557â†’  maxVisible?: number;\n   558â†’}\n   559â†’\n   560â†’export function FlawsSection({\n   561â†’  flaws,\n   562â†’  recommendations = [],\n   563â†’  onRatioClick,\n   564â†’  maxVisible = 5,\n   565â†’}: FlawsSectionProps) {\n   566â†’  const [expandedId, setExpandedId] = useState<string | null>(null);\n   567â†’  const [showAll, setShowAll] = useState(false);\n   568â†’\n   569â†’  const visibleFlaws = showAll ? flaws : flaws.slice(0, maxVisible);\n   570â†’  const hasMore = flaws.length > maxVisible;\n   571â†’\n   572â†’  return (\n   573â†’    <div className=\"rounded-lg bg-white border border-gray-200 p-4 sm:p-6 lg:p-8\">\n   574â†’      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n   575â†’        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-gray-900\">\n   576â†’          Areas of Improvement\n   577â†’        </h3>\n   578â†’      </div>\n   579â†’\n   580â†’      <div className=\"space-y-3\">\n   581â†’        {visibleFlaws.map((flaw, i) => (\n   582â†’          <FlawCard\n   583â†’            key={flaw.id}\n   584â†’            flaw={flaw}\n   585â†’            isExpanded={expandedId === flaw.id}\n   586â†’            onToggle={() => setExpandedId(expandedId === flaw.id ? null : flaw.id)}\n   587â†’            onRatioClick={onRatioClick}\n   588â†’            recommendations={recommendations}\n   589â†’            animationDelay={i * 0.04}\n   590â†’          />\n   591â†’        ))}\n   592â†’      </div>\n   593â†’\n   594â†’      {hasMore && (\n   595â†’        <button\n   596â†’          onClick={() => setShowAll(!showAll)}\n   597â†’          className=\"w-full mt-6 py-3 rounded-lg bg-white border border-gray-200 hover:border-gray-300 hover:shadow-sm transition-all duration-200 text-sm font-medium text-gray-900\"\n   598â†’        >\n   599â†’          <span className=\"flex items-center justify-center gap-2\">\n   600â†’            <span>{showAll ? 'Show Less' : `Show All ${flaws.length} Areas`}</span>\n   601â†’            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n   602â†’              <ChevronDown className=\"w-4 h-4 text-gray-500\" />\n   603â†’            </motion.div>\n   604â†’          </span>\n   605â†’        </button>\n   606â†’      )}\n   607â†’    </div>\n   608â†’  );\n   609â†’}\n   610â†’\n   611â†’// ============================================\n   612â†’// COMPACT BADGES (for use elsewhere)\n   613â†’// ============================================\n   614â†’\n   615â†’interface CompactStrengthBadgeProps {\n   616â†’  strength: Strength;\n   617â†’  onClick?: () => void;\n   618â†’}\n   619â†’\n   620â†’export function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {\n   621â†’  return (\n   622â†’    <button\n   623â†’      onClick={onClick}\n   624â†’      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 transition-colors\"\n   625â†’    >\n   626â†’      <CheckCircle size={12} className=\"text-green-600\" />\n   627â†’      <span className=\"text-xs text-green-700\">{strength.strengthName}</span>\n   628â†’    </button>\n   629â†’  );\n   630â†’}\n   631â†’\n   632â†’interface CompactFlawBadgeProps {\n   633â†’  flaw: Flaw;\n   634â†’  onClick?: () => void;\n   635â†’}\n   636â†’\n   637â†’export function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n   638â†’  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n   639â†’  const config = SEVERITY_CONFIGS[severity];\n   640â†’\n   641â†’  return (\n   642â†’    <button\n   643â†’      onClick={onClick}\n   644â†’      className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-lg hover:opacity-80 transition-all\"\n   645â†’      style={{\n   646â†’        backgroundColor: config.bgColor,\n   647â†’        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n   648â†’      }}\n   649â†’    >\n   650â†’      <AlertTriangle size={12} style={{ color: config.textColor }} />\n   651â†’      <span className=\"text-xs\" style={{ color: config.textColor }}>{flaw.flawName}</span>\n   652â†’    </button>\n   653â†’  );\n   654â†’}\n   655â†’\n   656â†’// Export utility functions\n   657â†’export { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\n   658â†’export { SeverityBadge };\n   659â†’export type { SeverityLevel };\n   660â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"66bdddcd-23f4-45ee-ab08-f24b1d1216a9","timestamp":"2025-12-26T13:41:52.645Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StrengthFlawCards.tsx","content":"'use client';\n\nimport { useState, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { ChevronDown, AlertTriangle, CheckCircle, Sparkles } from 'lucide-react';\nimport { Strength, Flaw, Recommendation, getScoreColor } from '@/types/results';\n\n// ============================================\n// QUALITY TIER BADGES (Harmony Style) - Strengths\n// ============================================\n\ntype QualityTier = 'ideal' | 'excellent' | 'good' | 'below_average';\n\ninterface QualityConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n}\n\nconst QUALITY_CONFIGS: Record<QualityTier, QualityConfig> = {\n  ideal: {\n    label: 'Ideal',\n    textColor: 'rgb(8, 145, 178)',    // cyan-600\n    bgColor: 'rgb(207, 250, 254)',    // cyan-100\n  },\n  excellent: {\n    label: 'Excellent',\n    textColor: 'rgb(4, 120, 87)',     // emerald-700\n    bgColor: 'rgb(209, 250, 229)',    // emerald-100\n  },\n  good: {\n    label: 'Good',\n    textColor: 'rgb(21, 128, 61)',    // green-700\n    bgColor: 'rgb(220, 252, 231)',    // green-100\n  },\n  below_average: {\n    label: 'Average',\n    textColor: 'rgb(113, 113, 122)',  // gray-500\n    bgColor: 'rgb(244, 244, 245)',    // gray-100\n  },\n};\n\nfunction QualityBadge({ quality }: { quality: QualityTier }) {\n  const config = QUALITY_CONFIGS[quality] || QUALITY_CONFIGS.good;\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// SEVERITY BADGES (Harmony Style) - Flaws\n// ============================================\n\ntype SeverityLevel = 'extremely_severe' | 'severe' | 'moderate' | 'minor';\n\ninterface SeverityConfig {\n  label: string;\n  textColor: string;\n  bgColor: string;\n  borderColor?: string;\n}\n\nconst SEVERITY_CONFIGS: Record<SeverityLevel, SeverityConfig> = {\n  extremely_severe: {\n    label: 'extremely severe',\n    textColor: 'rgb(127, 29, 29)',     // red-900\n    bgColor: 'rgb(254, 202, 202)',     // red-200\n  },\n  severe: {\n    label: 'severe',\n    textColor: 'rgb(185, 28, 28)',     // red-700\n    bgColor: 'rgb(254, 226, 226)',     // red-50\n    borderColor: 'rgb(254, 202, 202)', // red-200\n  },\n  moderate: {\n    label: 'moderate',\n    textColor: 'rgb(194, 65, 12)',     // orange-700\n    bgColor: 'rgb(255, 237, 213)',     // orange-50\n    borderColor: 'rgb(254, 215, 170)', // orange-200\n  },\n  minor: {\n    label: 'minor',\n    textColor: 'rgb(161, 98, 7)',      // yellow-700\n    bgColor: 'rgb(254, 249, 195)',     // yellow-50\n    borderColor: 'rgb(254, 240, 138)', // yellow-200\n  },\n};\n\nfunction getSeverityFromImpact(harmonyLost: number): SeverityLevel {\n  if (harmonyLost >= 0.8) return 'extremely_severe';\n  if (harmonyLost >= 0.5) return 'severe';\n  if (harmonyLost >= 0.3) return 'moderate';\n  return 'minor';\n}\n\nfunction getSeverityFromScore(score: number): SeverityLevel {\n  if (score <= 2) return 'extremely_severe';\n  if (score <= 4) return 'severe';\n  if (score <= 6) return 'moderate';\n  return 'minor';\n}\n\nfunction SeverityBadge({ severity }: { severity: SeverityLevel }) {\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-2 py-0.5 sm:px-2.5 sm:py-1 rounded-md text-[10px] sm:text-xs font-medium tracking-wide whitespace-nowrap\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      {config.label}\n    </span>\n  );\n}\n\n// ============================================\n// PROCEDURE PHASE BADGE\n// ============================================\n\ntype ProcedurePhase = 'Foundational' | 'Non-Invasive' | 'Minimally Invasive' | 'Surgical';\n\ninterface PhaseConfig {\n  textColor: string;\n  bgColor: string;\n}\n\nconst PHASE_CONFIGS: Record<ProcedurePhase, PhaseConfig> = {\n  Foundational: {\n    textColor: 'rgb(4, 120, 87)',     // emerald-700\n    bgColor: 'rgb(209, 250, 229)',    // emerald-50\n  },\n  'Non-Invasive': {\n    textColor: 'rgb(29, 78, 216)',    // blue-700\n    bgColor: 'rgb(219, 234, 254)',    // blue-50\n  },\n  'Minimally Invasive': {\n    textColor: 'rgb(109, 40, 217)',   // violet-700\n    bgColor: 'rgb(237, 233, 254)',    // violet-50\n  },\n  Surgical: {\n    textColor: 'rgb(126, 34, 206)',   // purple-700\n    bgColor: 'rgb(243, 232, 255)',    // purple-50\n  },\n};\n\nfunction PhaseBadge({ phase }: { phase: ProcedurePhase }) {\n  const config = PHASE_CONFIGS[phase] || PHASE_CONFIGS['Non-Invasive'];\n\n  return (\n    <span\n      className=\"inline-flex items-center px-1.5 py-0.5 rounded text-[9px] sm:text-[10px] font-medium\"\n      style={{\n        color: config.textColor,\n        backgroundColor: config.bgColor,\n      }}\n    >\n      {phase}\n    </span>\n  );\n}\n\n// ============================================\n// CONTRIBUTING/AFFECTED RATIO ITEM\n// ============================================\n\ninterface RatioItemProps {\n  name: string;\n  score: number | string;\n  onClick?: () => void;\n  animationDelay?: number;\n}\n\nfunction RatioItem({ name, score, onClick, animationDelay = 0 }: RatioItemProps) {\n  const numericScore = typeof score === 'number' ? score : 0;\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"w-full flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-white border border-gray-200 transition-all duration-200 hover:border-gray-300 hover:shadow-sm text-left cursor-pointer animate-fade-in\"\n      style={{\n        animationDuration: '0.2s',\n        animationDelay: `${animationDelay}s`,\n      }}\n    >\n      <span className=\"text-xs sm:text-sm text-gray-700 font-medium\">{name}</span>\n      <div className=\"flex items-baseline gap-0.5 sm:gap-1\">\n        <span\n          className=\"text-xs sm:text-sm font-semibold\"\n          style={{ color: typeof score === 'string' ? '#a3a3a3' : getScoreColor(numericScore) }}\n        >\n          {typeof score === 'number' ? score.toFixed(1) : score}\n        </span>\n        <span className=\"text-[10px] sm:text-xs text-gray-500\">/10</span>\n      </div>\n    </button>\n  );\n}\n\n// ============================================\n// PLAN ITEM (Recommendation)\n// ============================================\n\ninterface PlanItemProps {\n  name: string;\n  phase: ProcedurePhase;\n  inPlan?: boolean;\n  animationDelay?: number;\n}\n\nfunction PlanItem({ name, phase, inPlan = true, animationDelay = 0 }: PlanItemProps) {\n  return (\n    <div\n      className=\"flex items-center justify-between py-2 sm:py-2.5 px-2.5 sm:px-3 rounded-md bg-white border border-gray-200 animate-fade-in\"\n      style={{\n        animationDuration: '0.2s',\n        animationDelay: `${animationDelay}s`,\n      }}\n    >\n      <span className=\"text-xs sm:text-sm text-gray-700 font-medium\">{name}</span>\n      <div className=\"flex items-center gap-2\">\n        {inPlan && (\n          <span className=\"text-[9px] sm:text-[10px] px-1.5 py-0.5 rounded bg-emerald-100 text-emerald-700 font-medium\">\n            In Plan\n          </span>\n        )}\n        <PhaseBadge phase={phase} />\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// STRENGTH CARD (Harmony Style)\n// ============================================\n\ninterface StrengthCardProps {\n  strength: Strength;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n  animationDelay?: number;\n}\n\nexport function StrengthCard({\n  strength,\n  isExpanded = false,\n  onToggle,\n  onRatioClick,\n  animationDelay = 0,\n}: StrengthCardProps) {\n  // Get score color for the average score\n  const numericScore = typeof strength.avgScore === 'number' ? strength.avgScore : 0;\n  const scoreColor = getScoreColor(numericScore);\n\n  return (\n    <div\n      className=\"rounded-lg bg-white border border-gray-200 overflow-hidden transition-all duration-200 hover:border-gray-300 hover:shadow-sm animate-fade-in\"\n      style={{ animationDelay: `${animationDelay}s` }}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-6 hover:bg-gray-50/50 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <QualityBadge quality={strength.qualityLevel} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-gray-900 mb-1 sm:mb-1.5 leading-snug\">\n                {strength.strengthName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-gray-600 leading-relaxed\">\n                {strength.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Score + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right\">\n              <div\n                className=\"text-lg sm:text-xl font-semibold tracking-tight transition-colors duration-200\"\n                style={{ color: scoreColor }}\n              >\n                {typeof strength.avgScore === 'number' ? strength.avgScore.toFixed(2) : strength.avgScore}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-gray-500 font-medium mt-0.5\">avg /10</div>\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-gray-400\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: 'easeInOut' }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"border-t border-gray-200 bg-gray-50/50 px-4 sm:px-6 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-gray-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Contributing Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {strength.responsibleRatios.map((ratio, i) => (\n                  <RatioItem\n                    key={ratio.ratioId}\n                    name={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick?.(ratio)}\n                    animationDelay={i * 0.03}\n                  />\n                ))}\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// FLAW CARD (Harmony Style - Areas of Improvement)\n// ============================================\n\ninterface FlawCardProps {\n  flaw: Flaw;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n  recommendations?: Recommendation[];\n  animationDelay?: number;\n}\n\nexport function FlawCard({\n  flaw,\n  isExpanded = false,\n  onToggle,\n  onRatioClick,\n  recommendations = [],\n  animationDelay = 0,\n}: FlawCardProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n\n  // Find matching recommendations for this flaw\n  const matchedRecommendations = useMemo(() => {\n    const flawRatioIds = new Set(flaw.responsibleRatios.map(r => r.ratioId));\n    return recommendations.filter(rec =>\n      rec.matchedFlaws?.some(f => f.toLowerCase().includes(flaw.flawName.toLowerCase())) ||\n      rec.matchedRatios?.some(r => flawRatioIds.has(r))\n    ).slice(0, 3); // Limit to 3 recommendations\n  }, [flaw, recommendations]);\n\n  // Map phase names\n  const mapPhase = (phase: string): ProcedurePhase => {\n    if (phase === 'Foundational') return 'Foundational';\n    if (phase === 'Non-Invasive' || phase === 'Minimally Invasive') return phase as ProcedurePhase;\n    if (phase === 'Surgical') return 'Surgical';\n    return 'Non-Invasive';\n  };\n\n  return (\n    <div\n      className=\"rounded-lg bg-white border border-gray-200 overflow-hidden transition-all duration-200 hover:border-gray-300 hover:shadow-sm animate-fade-in\"\n      style={{ animationDelay: `${animationDelay}s` }}\n    >\n      {/* Header */}\n      <button\n        onClick={onToggle}\n        className=\"w-full p-4 sm:p-6 hover:bg-gray-50/50 transition-colors duration-200 text-left\"\n      >\n        <div className=\"flex flex-col sm:flex-row sm:items-start sm:justify-between gap-3 sm:gap-4\">\n          {/* Left: Badge + Content */}\n          <div className=\"flex items-start gap-2 sm:gap-3 flex-1 min-w-0\">\n            <SeverityBadge severity={severity} />\n            <div className=\"flex-1 min-w-0\">\n              <h4 className=\"text-sm sm:text-base font-semibold text-gray-900 mb-1 sm:mb-1.5 leading-snug\">\n                {flaw.flawName}\n              </h4>\n              <p className=\"text-xs sm:text-sm text-gray-600 leading-relaxed\">\n                {flaw.summary}\n              </p>\n            </div>\n          </div>\n\n          {/* Right: Points impact + Chevron */}\n          <div className=\"flex items-center justify-between sm:justify-end gap-3 sm:gap-4 flex-shrink-0 sm:flex-col sm:items-end sm:gap-1.5\">\n            <div className=\"text-right space-y-1\">\n              <div className=\"text-lg sm:text-xl font-semibold tracking-tight text-red-600\">\n                -{flaw.harmonyPercentageLost.toFixed(2)}\n              </div>\n              <div className=\"text-[10px] sm:text-xs text-gray-500 font-medium\">points</div>\n              {flaw.rollingHarmonyPercentageLost !== undefined && (\n                <div className=\"text-[10px] text-gray-400 font-medium pt-0.5 border-t border-gray-200 mt-1 pt-1\">\n                  Rolling: -{flaw.rollingHarmonyPercentageLost.toFixed(2)}\n                </div>\n              )}\n            </div>\n            <motion.div\n              animate={{ rotate: isExpanded ? 180 : 0 }}\n              transition={{ duration: 0.3 }}\n            >\n              <ChevronDown className=\"w-4 h-4 text-gray-400\" />\n            </motion.div>\n          </div>\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3, ease: 'easeInOut' }}\n            className=\"overflow-hidden\"\n          >\n            {/* Affected Ratios Section */}\n            <div className=\"border-t border-gray-200 bg-gray-50/50 px-4 sm:px-6 py-3 sm:py-4\">\n              <div className=\"text-[10px] sm:text-xs font-medium text-gray-500 uppercase tracking-wider mb-2 sm:mb-3\">\n                Affected Ratios\n              </div>\n              <div className=\"space-y-2\">\n                {flaw.responsibleRatios.map((ratio, i) => (\n                  <RatioItem\n                    key={ratio.ratioId}\n                    name={ratio.ratioName}\n                    score={ratio.score}\n                    onClick={() => onRatioClick?.(ratio)}\n                    animationDelay={i * 0.03}\n                  />\n                ))}\n              </div>\n            </div>\n\n            {/* Your Plan Section (if there are matched recommendations) */}\n            {matchedRecommendations.length > 0 && (\n              <div className=\"border-t border-gray-200 bg-emerald-50/30 px-4 sm:px-6 py-3 sm:py-4\">\n                <div className=\"flex items-center gap-1.5 mb-2 sm:mb-3\">\n                  <Sparkles className=\"w-3 h-3 text-emerald-600\" />\n                  <span className=\"text-[10px] sm:text-xs font-medium text-emerald-700 uppercase tracking-wider\">\n                    Your Plan\n                  </span>\n                </div>\n                <div className=\"space-y-2\">\n                  {matchedRecommendations.map((rec, i) => (\n                    <PlanItem\n                      key={rec.ref_id}\n                      name={rec.name}\n                      phase={mapPhase(rec.phase)}\n                      inPlan={true}\n                      animationDelay={i * 0.03}\n                    />\n                  ))}\n                </div>\n              </div>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </div>\n  );\n}\n\n// ============================================\n// STRENGTHS SECTION (Container)\n// ============================================\n\ninterface StrengthsSectionProps {\n  strengths: Strength[];\n  onRatioClick?: (ratio: Strength['responsibleRatios'][0]) => void;\n  maxVisible?: number;\n}\n\nexport function StrengthsSection({\n  strengths,\n  onRatioClick,\n  maxVisible = 5,\n}: StrengthsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const visibleStrengths = showAll ? strengths : strengths.slice(0, maxVisible);\n  const hasMore = strengths.length > maxVisible;\n\n  return (\n    <div className=\"rounded-lg bg-white border border-gray-200 p-4 sm:p-6 lg:p-8\">\n      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-gray-900\">\n          Key Strengths\n        </h3>\n      </div>\n\n      <div className=\"space-y-3\">\n        {visibleStrengths.map((strength, i) => (\n          <StrengthCard\n            key={strength.id}\n            strength={strength}\n            isExpanded={expandedId === strength.id}\n            onToggle={() => setExpandedId(expandedId === strength.id ? null : strength.id)}\n            onRatioClick={onRatioClick}\n            animationDelay={i * 0.04}\n          />\n        ))}\n      </div>\n\n      {hasMore && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-6 py-3 rounded-lg bg-white border border-gray-200 hover:border-gray-300 hover:shadow-sm transition-all duration-200 text-sm font-medium text-gray-900\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show All ${strengths.length} Strengths`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-gray-500\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// FLAWS SECTION (Areas of Improvement Container)\n// ============================================\n\ninterface FlawsSectionProps {\n  flaws: Flaw[];\n  recommendations?: Recommendation[];\n  onRatioClick?: (ratio: Flaw['responsibleRatios'][0]) => void;\n  maxVisible?: number;\n}\n\nexport function FlawsSection({\n  flaws,\n  recommendations = [],\n  onRatioClick,\n  maxVisible = 5,\n}: FlawsSectionProps) {\n  const [expandedId, setExpandedId] = useState<string | null>(null);\n  const [showAll, setShowAll] = useState(false);\n\n  const visibleFlaws = showAll ? flaws : flaws.slice(0, maxVisible);\n  const hasMore = flaws.length > maxVisible;\n\n  return (\n    <div className=\"rounded-lg bg-white border border-gray-200 p-4 sm:p-6 lg:p-8\">\n      <div className=\"flex items-center justify-between mb-4 sm:mb-6\">\n        <h3 className=\"text-base sm:text-lg font-semibold tracking-tight text-gray-900\">\n          Areas of Improvement\n        </h3>\n      </div>\n\n      <div className=\"space-y-3\">\n        {visibleFlaws.map((flaw, i) => (\n          <FlawCard\n            key={flaw.id}\n            flaw={flaw}\n            isExpanded={expandedId === flaw.id}\n            onToggle={() => setExpandedId(expandedId === flaw.id ? null : flaw.id)}\n            onRatioClick={onRatioClick}\n            recommendations={recommendations}\n            animationDelay={i * 0.04}\n          />\n        ))}\n      </div>\n\n      {hasMore && (\n        <button\n          onClick={() => setShowAll(!showAll)}\n          className=\"w-full mt-6 py-3 rounded-lg bg-white border border-gray-200 hover:border-gray-300 hover:shadow-sm transition-all duration-200 text-sm font-medium text-gray-900\"\n        >\n          <span className=\"flex items-center justify-center gap-2\">\n            <span>{showAll ? 'Show Less' : `Show All ${flaws.length} Areas`}</span>\n            <motion.div animate={{ rotate: showAll ? 180 : 0 }} transition={{ duration: 0.2 }}>\n              <ChevronDown className=\"w-4 h-4 text-gray-500\" />\n            </motion.div>\n          </span>\n        </button>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// COMPACT BADGES (for use elsewhere)\n// ============================================\n\ninterface CompactStrengthBadgeProps {\n  strength: Strength;\n  onClick?: () => void;\n}\n\nexport function CompactStrengthBadge({ strength, onClick }: CompactStrengthBadgeProps) {\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 bg-green-50 border border-green-200 rounded-lg hover:bg-green-100 transition-colors\"\n    >\n      <CheckCircle size={12} className=\"text-green-600\" />\n      <span className=\"text-xs text-green-700\">{strength.strengthName}</span>\n    </button>\n  );\n}\n\ninterface CompactFlawBadgeProps {\n  flaw: Flaw;\n  onClick?: () => void;\n}\n\nexport function CompactFlawBadge({ flaw, onClick }: CompactFlawBadgeProps) {\n  const severity = getSeverityFromImpact(flaw.harmonyPercentageLost);\n  const config = SEVERITY_CONFIGS[severity];\n\n  return (\n    <button\n      onClick={onClick}\n      className=\"inline-flex items-center gap-1.5 px-2 py-1 rounded-lg hover:opacity-80 transition-all\"\n      style={{\n        backgroundColor: config.bgColor,\n        border: config.borderColor ? `1px solid ${config.borderColor}` : undefined,\n      }}\n    >\n      <AlertTriangle size={12} style={{ color: config.textColor }} />\n      <span className=\"text-xs\" style={{ color: config.textColor }}>{flaw.flawName}</span>\n    </button>\n  );\n}\n\n// Export utility functions\nexport { getSeverityFromImpact, getSeverityFromScore, SEVERITY_CONFIGS };\nexport { SeverityBadge };\nexport type { SeverityLevel };\n","numLines":660,"startLine":1,"totalLines":660}}}
{"parentUuid":"66bdddcd-23f4-45ee-ab08-f24b1d1216a9","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01H8xrdTyUzQGewTEAhBqQV9","type":"tool_result","content":"     1â†’'use client';\n     2â†’\n     3â†’import { useState } from 'react';\n     4â†’import { motion, AnimatePresence } from 'framer-motion';\n     5â†’import {\n     6â†’  ChevronDown,\n     7â†’  ChevronUp,\n     8â†’  ShoppingCart,\n     9â†’  Zap,\n    10â†’  ArrowRight,\n    11â†’  Package,\n    12â†’} from 'lucide-react';\n    13â†’import { Flaw, ProductRecommendation, Recommendation } from '@/types/results';\n    14â†’import { ProductCard } from './ProductCard';\n    15â†’\n    16â†’interface WeakPointCardProps {\n    17â†’  flaw: Flaw;\n    18â†’  rank: number;\n    19â†’  products: ProductRecommendation[];\n    20â†’  treatments: Recommendation[];\n    21â†’  onViewTreatment?: (treatment: Recommendation) => void;\n    22â†’}\n    23â†’\n    24â†’export function WeakPointCard({\n    25â†’  flaw,\n    26â†’  rank,\n    27â†’  products,\n    28â†’  treatments,\n    29â†’  onViewTreatment,\n    30â†’}: WeakPointCardProps) {\n    31â†’  const [isExpanded, setIsExpanded] = useState(false);\n    32â†’\n    33â†’  // Severity colors\n    34â†’  const getSeverityColor = (impact: number) => {\n    35â†’    if (impact >= 5) return { bg: 'bg-red-500/20', border: 'border-red-500/30', text: 'text-red-400' };\n    36â†’    if (impact >= 3) return { bg: 'bg-orange-500/20', border: 'border-orange-500/30', text: 'text-orange-400' };\n    37â†’    return { bg: 'bg-yellow-500/20', border: 'border-yellow-500/30', text: 'text-yellow-400' };\n    38â†’  };\n    39â†’\n    40â†’  const colors = getSeverityColor(flaw.harmonyPercentageLost);\n    41â†’\n    42â†’  return (\n    43â†’    <motion.div\n    44â†’      className={`${colors.bg} border ${colors.border} rounded-xl overflow-hidden`}\n    45â†’      initial={{ opacity: 0, y: 10 }}\n    46â†’      animate={{ opacity: 1, y: 0 }}\n    47â†’      transition={{ delay: rank * 0.05 }}\n    48â†’    >\n    49â†’      {/* Header */}\n    50â†’      <button\n    51â†’        onClick={() => setIsExpanded(!isExpanded)}\n    52â†’        className=\"w-full p-4 flex items-center justify-between hover:bg-white/5 transition-colors\"\n    53â†’      >\n    54â†’        <div className=\"flex items-center gap-3\">\n    55â†’          <div className={`w-8 h-8 rounded-lg ${colors.bg} flex items-center justify-center`}>\n    56â†’            <span className={`text-sm font-bold ${colors.text}`}>#{rank}</span>\n    57â†’          </div>\n    58â†’          <div className=\"text-left\">\n    59â†’            <h4 className=\"font-medium text-white\">{flaw.flawName}</h4>\n    60â†’            <p className=\"text-xs text-neutral-400\">{flaw.categoryName}</p>\n    61â†’          </div>\n    62â†’        </div>\n    63â†’\n    64â†’        <div className=\"flex items-center gap-4\">\n    65â†’          <div className=\"text-right\">\n    66â†’            <span className={`text-sm font-semibold ${colors.text}`}>\n    67â†’              -{flaw.harmonyPercentageLost.toFixed(1)}%\n    68â†’            </span>\n    69â†’            <p className=\"text-xs text-neutral-500\">harmony lost</p>\n    70â†’          </div>\n    71â†’          {isExpanded ? (\n    72â†’            <ChevronUp size={20} className=\"text-neutral-400\" />\n    73â†’          ) : (\n    74â†’            <ChevronDown size={20} className=\"text-neutral-400\" />\n    75â†’          )}\n    76â†’        </div>\n    77â†’      </button>\n    78â†’\n    79â†’      {/* Expanded Content */}\n    80â†’      <AnimatePresence>\n    81â†’        {isExpanded && (\n    82â†’          <motion.div\n    83â†’            initial={{ height: 0, opacity: 0 }}\n    84â†’            animate={{ height: 'auto', opacity: 1 }}\n    85â†’            exit={{ height: 0, opacity: 0 }}\n    86â†’            transition={{ duration: 0.2 }}\n    87â†’            className=\"overflow-hidden\"\n    88â†’          >\n    89â†’            <div className=\"px-4 pb-4 space-y-4\">\n    90â†’              {/* Summary */}\n    91â†’              <p className=\"text-sm text-neutral-300\">{flaw.summary}</p>\n    92â†’\n    93â†’              {/* Contributing Ratios */}\n    94â†’              {flaw.responsibleRatios.length > 0 && (\n    95â†’                <div className=\"space-y-2\">\n    96â†’                  <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n    97â†’                    Contributing Metrics\n    98â†’                  </h5>\n    99â†’                  <div className=\"flex flex-wrap gap-2\">\n   100â†’                    {flaw.responsibleRatios.slice(0, 3).map((ratio) => (\n   101â†’                      <div\n   102â†’                        key={ratio.ratioId}\n   103â†’                        className=\"px-2 py-1 bg-neutral-800/50 rounded-lg text-xs\"\n   104â†’                      >\n   105â†’                        <span className=\"text-neutral-300\">{ratio.ratioName}</span>\n   106â†’                        <span className=\"text-neutral-500 ml-1\">\n   107â†’                          ({typeof ratio.score === 'number' ? ratio.score.toFixed(1) : ratio.score}/10)\n   108â†’                        </span>\n   109â†’                      </div>\n   110â†’                    ))}\n   111â†’                  </div>\n   112â†’                </div>\n   113â†’              )}\n   114â†’\n   115â†’              {/* Products to Fix */}\n   116â†’              {products.length > 0 && (\n   117â†’                <div className=\"space-y-3\">\n   118â†’                  <div className=\"flex items-center gap-2\">\n   119â†’                    <Package size={14} className=\"text-cyan-400\" />\n   120â†’                    <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n   121â†’                      Products to Help\n   122â†’                    </h5>\n   123â†’                  </div>\n   124â†’                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n   125â†’                    {products.slice(0, 2).map((rec) => (\n   126â†’                      <ProductCard key={rec.product.id} recommendation={rec} compact />\n   127â†’                    ))}\n   128â†’                  </div>\n   129â†’                  {products.length > 2 && (\n   130â†’                    <p className=\"text-xs text-neutral-500 text-center\">\n   131â†’                      +{products.length - 2} more products\n   132â†’                    </p>\n   133â†’                  )}\n   134â†’                </div>\n   135â†’              )}\n   136â†’\n   137â†’              {/* Treatments */}\n   138â†’              {treatments.length > 0 && (\n   139â†’                <div className=\"space-y-3\">\n   140â†’                  <div className=\"flex items-center gap-2\">\n   141â†’                    <Zap size={14} className=\"text-purple-400\" />\n   142â†’                    <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n   143â†’                      Recommended Treatments\n   144â†’                    </h5>\n   145â†’                  </div>\n   146â†’                  <div className=\"space-y-2\">\n   147â†’                    {treatments.slice(0, 3).map((treatment) => (\n   148â†’                      <button\n   149â†’                        key={treatment.ref_id}\n   150â†’                        onClick={() => onViewTreatment?.(treatment)}\n   151â†’                        className=\"w-full flex items-center justify-between p-3 bg-neutral-800/50 rounded-lg hover:bg-neutral-800 transition-colors group\"\n   152â†’                      >\n   153â†’                        <div className=\"flex items-center gap-3\">\n   154â†’                          <div className={`px-2 py-0.5 rounded text-xs font-medium ${\n   155â†’                            treatment.phase === 'Foundational'\n   156â†’                              ? 'bg-green-500/20 text-green-400'\n   157â†’                              : treatment.phase === 'Minimally Invasive'\n   158â†’                                ? 'bg-yellow-500/20 text-yellow-400'\n   159â†’                                : 'bg-red-500/20 text-red-400'\n   160â†’                          }`}>\n   161â†’                            {treatment.phase}\n   162â†’                          </div>\n   163â†’                          <span className=\"text-sm text-white\">{treatment.name}</span>\n   164â†’                        </div>\n   165â†’                        <div className=\"flex items-center gap-2\">\n   166â†’                          <span className=\"text-xs text-green-400\">\n   167â†’                            +{(treatment.impact * 100).toFixed(0)}% improvement\n   168â†’                          </span>\n   169â†’                          <ArrowRight size={14} className=\"text-neutral-500 group-hover:text-cyan-400 transition-colors\" />\n   170â†’                        </div>\n   171â†’                      </button>\n   172â†’                    ))}\n   173â†’                  </div>\n   174â†’                </div>\n   175â†’              )}\n   176â†’\n   177â†’              {/* CTA */}\n   178â†’              <div className=\"pt-2 border-t border-neutral-800\">\n   179â†’                <a\n   180â†’                  href=\"#plan\"\n   181â†’                  className=\"flex items-center justify-center gap-2 w-full py-2.5 bg-gradient-to-r from-cyan-500 to-blue-600 text-black text-sm font-medium rounded-lg hover:opacity-90 transition-opacity\"\n   182â†’                >\n   183â†’                  <ShoppingCart size={16} />\n   184â†’                  View Full Fix Plan\n   185â†’                </a>\n   186â†’              </div>\n   187â†’            </div>\n   188â†’          </motion.div>\n   189â†’        )}\n   190â†’      </AnimatePresence>\n   191â†’    </motion.div>\n   192â†’  );\n   193â†’}\n   194â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"fca225c8-0566-4df8-96ac-a0277af4e3ee","timestamp":"2025-12-26T13:41:52.645Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/WeakPointCard.tsx","content":"'use client';\n\nimport { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  ChevronDown,\n  ChevronUp,\n  ShoppingCart,\n  Zap,\n  ArrowRight,\n  Package,\n} from 'lucide-react';\nimport { Flaw, ProductRecommendation, Recommendation } from '@/types/results';\nimport { ProductCard } from './ProductCard';\n\ninterface WeakPointCardProps {\n  flaw: Flaw;\n  rank: number;\n  products: ProductRecommendation[];\n  treatments: Recommendation[];\n  onViewTreatment?: (treatment: Recommendation) => void;\n}\n\nexport function WeakPointCard({\n  flaw,\n  rank,\n  products,\n  treatments,\n  onViewTreatment,\n}: WeakPointCardProps) {\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  // Severity colors\n  const getSeverityColor = (impact: number) => {\n    if (impact >= 5) return { bg: 'bg-red-500/20', border: 'border-red-500/30', text: 'text-red-400' };\n    if (impact >= 3) return { bg: 'bg-orange-500/20', border: 'border-orange-500/30', text: 'text-orange-400' };\n    return { bg: 'bg-yellow-500/20', border: 'border-yellow-500/30', text: 'text-yellow-400' };\n  };\n\n  const colors = getSeverityColor(flaw.harmonyPercentageLost);\n\n  return (\n    <motion.div\n      className={`${colors.bg} border ${colors.border} rounded-xl overflow-hidden`}\n      initial={{ opacity: 0, y: 10 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ delay: rank * 0.05 }}\n    >\n      {/* Header */}\n      <button\n        onClick={() => setIsExpanded(!isExpanded)}\n        className=\"w-full p-4 flex items-center justify-between hover:bg-white/5 transition-colors\"\n      >\n        <div className=\"flex items-center gap-3\">\n          <div className={`w-8 h-8 rounded-lg ${colors.bg} flex items-center justify-center`}>\n            <span className={`text-sm font-bold ${colors.text}`}>#{rank}</span>\n          </div>\n          <div className=\"text-left\">\n            <h4 className=\"font-medium text-white\">{flaw.flawName}</h4>\n            <p className=\"text-xs text-neutral-400\">{flaw.categoryName}</p>\n          </div>\n        </div>\n\n        <div className=\"flex items-center gap-4\">\n          <div className=\"text-right\">\n            <span className={`text-sm font-semibold ${colors.text}`}>\n              -{flaw.harmonyPercentageLost.toFixed(1)}%\n            </span>\n            <p className=\"text-xs text-neutral-500\">harmony lost</p>\n          </div>\n          {isExpanded ? (\n            <ChevronUp size={20} className=\"text-neutral-400\" />\n          ) : (\n            <ChevronDown size={20} className=\"text-neutral-400\" />\n          )}\n        </div>\n      </button>\n\n      {/* Expanded Content */}\n      <AnimatePresence>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.2 }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"px-4 pb-4 space-y-4\">\n              {/* Summary */}\n              <p className=\"text-sm text-neutral-300\">{flaw.summary}</p>\n\n              {/* Contributing Ratios */}\n              {flaw.responsibleRatios.length > 0 && (\n                <div className=\"space-y-2\">\n                  <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n                    Contributing Metrics\n                  </h5>\n                  <div className=\"flex flex-wrap gap-2\">\n                    {flaw.responsibleRatios.slice(0, 3).map((ratio) => (\n                      <div\n                        key={ratio.ratioId}\n                        className=\"px-2 py-1 bg-neutral-800/50 rounded-lg text-xs\"\n                      >\n                        <span className=\"text-neutral-300\">{ratio.ratioName}</span>\n                        <span className=\"text-neutral-500 ml-1\">\n                          ({typeof ratio.score === 'number' ? ratio.score.toFixed(1) : ratio.score}/10)\n                        </span>\n                      </div>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* Products to Fix */}\n              {products.length > 0 && (\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Package size={14} className=\"text-cyan-400\" />\n                    <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n                      Products to Help\n                    </h5>\n                  </div>\n                  <div className=\"grid grid-cols-1 md:grid-cols-2 gap-3\">\n                    {products.slice(0, 2).map((rec) => (\n                      <ProductCard key={rec.product.id} recommendation={rec} compact />\n                    ))}\n                  </div>\n                  {products.length > 2 && (\n                    <p className=\"text-xs text-neutral-500 text-center\">\n                      +{products.length - 2} more products\n                    </p>\n                  )}\n                </div>\n              )}\n\n              {/* Treatments */}\n              {treatments.length > 0 && (\n                <div className=\"space-y-3\">\n                  <div className=\"flex items-center gap-2\">\n                    <Zap size={14} className=\"text-purple-400\" />\n                    <h5 className=\"text-xs font-medium text-neutral-400 uppercase tracking-wide\">\n                      Recommended Treatments\n                    </h5>\n                  </div>\n                  <div className=\"space-y-2\">\n                    {treatments.slice(0, 3).map((treatment) => (\n                      <button\n                        key={treatment.ref_id}\n                        onClick={() => onViewTreatment?.(treatment)}\n                        className=\"w-full flex items-center justify-between p-3 bg-neutral-800/50 rounded-lg hover:bg-neutral-800 transition-colors group\"\n                      >\n                        <div className=\"flex items-center gap-3\">\n                          <div className={`px-2 py-0.5 rounded text-xs font-medium ${\n                            treatment.phase === 'Foundational'\n                              ? 'bg-green-500/20 text-green-400'\n                              : treatment.phase === 'Minimally Invasive'\n                                ? 'bg-yellow-500/20 text-yellow-400'\n                                : 'bg-red-500/20 text-red-400'\n                          }`}>\n                            {treatment.phase}\n                          </div>\n                          <span className=\"text-sm text-white\">{treatment.name}</span>\n                        </div>\n                        <div className=\"flex items-center gap-2\">\n                          <span className=\"text-xs text-green-400\">\n                            +{(treatment.impact * 100).toFixed(0)}% improvement\n                          </span>\n                          <ArrowRight size={14} className=\"text-neutral-500 group-hover:text-cyan-400 transition-colors\" />\n                        </div>\n                      </button>\n                    ))}\n                  </div>\n                </div>\n              )}\n\n              {/* CTA */}\n              <div className=\"pt-2 border-t border-neutral-800\">\n                <a\n                  href=\"#plan\"\n                  className=\"flex items-center justify-center gap-2 w-full py-2.5 bg-gradient-to-r from-cyan-500 to-blue-600 text-black text-sm font-medium rounded-lg hover:opacity-90 transition-opacity\"\n                >\n                  <ShoppingCart size={16} />\n                  View Full Fix Plan\n                </a>\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n","numLines":194,"startLine":1,"totalLines":194}}}
{"parentUuid":"fca225c8-0566-4df8-96ac-a0277af4e3ee","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_014BnrS44omDXjpGjPcxaJSg","type":"tool_result","content":"     1â†’'use client';\n     2â†’\n     3â†’import { useState } from 'react';\n     4â†’import { motion, AnimatePresence } from 'framer-motion';\n     5â†’import { DailyStack } from '@/types/results';\n     6â†’import { Sparkles, ChevronDown, ChevronUp, Sun, Moon, Clock } from 'lucide-react';\n     7â†’import { getSupplementDetails } from '@/lib/daily-stack';\n     8â†’\n     9â†’interface DailyStackCardProps {\n    10â†’  dailyStack: DailyStack;\n    11â†’}\n    12â†’\n    13â†’export function DailyStackCard({ dailyStack }: DailyStackCardProps) {\n    14â†’  const [isExpanded, setIsExpanded] = useState(false);\n    15â†’\n    16â†’  return (\n    17â†’    <motion.div\n    18â†’      className=\"bg-gradient-to-br from-cyan-600 to-blue-700 rounded-2xl p-6 shadow-xl\"\n    19â†’      initial={{ opacity: 0, y: 20 }}\n    20â†’      animate={{ opacity: 1, y: 0 }}\n    21â†’    >\n    22â†’      {/* Header */}\n    23â†’      <div className=\"flex items-center gap-3 mb-4\">\n    24â†’        <div className=\"w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center\">\n    25â†’          <Sparkles size={24} className=\"text-white\" />\n    26â†’        </div>\n    27â†’        <div className=\"flex-1\">\n    28â†’          <h2 className=\"text-xl font-bold text-white\">Your Foundation Stack</h2>\n    29â†’          <p className=\"text-cyan-100 text-sm\">\n    30â†’            ${dailyStack.totalCostPerMonth.min}-${dailyStack.totalCostPerMonth.max}/month\n    31â†’          </p>\n    32â†’        </div>\n    33â†’      </div>\n    34â†’\n    35â†’      {/* Rationale */}\n    36â†’      <p className=\"text-white/90 text-sm mb-4 leading-relaxed\">\n    37â†’        {dailyStack.rationale}\n    38â†’      </p>\n    39â†’\n    40â†’      {/* Product Pills */}\n    41â†’      <div className=\"flex flex-wrap gap-2 mb-4\">\n    42â†’        {dailyStack.products.slice(0, 6).map(product => (\n    43â†’          <div\n    44â†’            key={product.id}\n    45â†’            className=\"px-3 py-1.5 bg-white/20 rounded-full text-white text-sm font-medium\"\n    46â†’          >\n    47â†’            {product.name}\n    48â†’          </div>\n    49â†’        ))}\n    50â†’      </div>\n    51â†’\n    52â†’      {/* Expand/Collapse Button */}\n    53â†’      <button\n    54â†’        onClick={() => setIsExpanded(!isExpanded)}\n    55â†’        className=\"w-full bg-white/20 hover:bg-white/30 text-white font-medium py-2.5 px-4 rounded-lg transition-colors flex items-center justify-center gap-2\"\n    56â†’      >\n    57â†’        {isExpanded ? 'Hide Details' : 'View Complete Stack'}\n    58â†’        {isExpanded ? <ChevronUp size={16} /> : <ChevronDown size={16} />}\n    59â†’      </button>\n    60â†’\n    61â†’      {/* Expanded Details */}\n    62â†’      <AnimatePresence>\n    63â†’        {isExpanded && (\n    64â†’          <motion.div\n    65â†’            initial={{ height: 0, opacity: 0 }}\n    66â†’            animate={{ height: 'auto', opacity: 1 }}\n    67â†’            exit={{ height: 0, opacity: 0 }}\n    68â†’            className=\"mt-4 space-y-4 overflow-hidden\"\n    69â†’          >\n    70â†’            {/* Morning */}\n    71â†’            {dailyStack.timing.morning.length > 0 && (\n    72â†’              <div className=\"bg-white/10 rounded-xl p-4\">\n    73â†’                <div className=\"flex items-center gap-2 text-white font-medium mb-3\">\n    74â†’                  <Sun size={18} />\n    75â†’                  <span>Morning</span>\n    76â†’                </div>\n    77â†’                <div className=\"space-y-2\">\n    78â†’                  {dailyStack.timing.morning.map(product => {\n    79â†’                    const supplement = getSupplementDetails(product.supplementId);\n    80â†’                    return (\n    81â†’                      <div key={product.id} className=\"flex items-center justify-between text-sm\">\n    82â†’                        <span className=\"text-white\">{product.name}</span>\n    83â†’                        <span className=\"text-cyan-100\">{supplement?.dosage}</span>\n    84â†’                      </div>\n    85â†’                    );\n    86â†’                  })}\n    87â†’                </div>\n    88â†’              </div>\n    89â†’            )}\n    90â†’\n    91â†’            {/* Evening */}\n    92â†’            {dailyStack.timing.evening.length > 0 && (\n    93â†’              <div className=\"bg-white/10 rounded-xl p-4\">\n    94â†’                <div className=\"flex items-center gap-2 text-white font-medium mb-3\">\n    95â†’                  <Moon size={18} />\n    96â†’                  <span>Evening</span>\n    97â†’                </div>\n    98â†’                <div className=\"space-y-2\">\n    99â†’                  {dailyStack.timing.evening.map(product => {\n   100â†’                    const supplement = getSupplementDetails(product.supplementId);\n   101â†’                    return (\n   102â†’                      <div key={product.id} className=\"flex items-center justify-between text-sm\">\n   103â†’                        <span className=\"text-white\">{product.name}</span>\n   104â†’                        <span className=\"text-cyan-100\">{supplement?.dosage}</span>\n   105â†’                      </div>\n   106â†’                    );\n   107â†’                  })}\n   108â†’                </div>\n   109â†’              </div>\n   110â†’            )}\n   111â†’\n   112â†’            {/* Anytime */}\n   113â†’            {dailyStack.timing.anytime.length > 0 && (\n   114â†’              <div className=\"bg-white/10 rounded-xl p-4\">\n   115â†’                <div className=\"flex items-center gap-2 text-white font-medium mb-3\">\n   116â†’                  <Clock size={18} />\n   117â†’                  <span>Anytime</span>\n   118â†’                </div>\n   119â†’                <div className=\"space-y-2\">\n   120â†’                  {dailyStack.timing.anytime.map(product => {\n   121â†’                    const supplement = getSupplementDetails(product.supplementId);\n   122â†’                    return (\n   123â†’                      <div key={product.id} className=\"flex items-center justify-between text-sm\">\n   124â†’                        <span className=\"text-white\">{product.name}</span>\n   125â†’                        <span className=\"text-cyan-100\">{supplement?.dosage}</span>\n   126â†’                      </div>\n   127â†’                    );\n   128â†’                  })}\n   129â†’                </div>\n   130â†’              </div>\n   131â†’            )}\n   132â†’          </motion.div>\n   133â†’        )}\n   134â†’      </AnimatePresence>\n   135â†’    </motion.div>\n   136â†’  );\n   137â†’}\n   138â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"2a074196-6cd3-4f76-a16e-89118821770f","timestamp":"2025-12-26T13:41:52.645Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/DailyStackCard.tsx","content":"'use client';\n\nimport { useState } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport { DailyStack } from '@/types/results';\nimport { Sparkles, ChevronDown, ChevronUp, Sun, Moon, Clock } from 'lucide-react';\nimport { getSupplementDetails } from '@/lib/daily-stack';\n\ninterface DailyStackCardProps {\n  dailyStack: DailyStack;\n}\n\nexport function DailyStackCard({ dailyStack }: DailyStackCardProps) {\n  const [isExpanded, setIsExpanded] = useState(false);\n\n  return (\n    <motion.div\n      className=\"bg-gradient-to-br from-cyan-600 to-blue-700 rounded-2xl p-6 shadow-xl\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      {/* Header */}\n      <div className=\"flex items-center gap-3 mb-4\">\n        <div className=\"w-12 h-12 rounded-xl bg-white/20 flex items-center justify-center\">\n          <Sparkles size={24} className=\"text-white\" />\n        </div>\n        <div className=\"flex-1\">\n          <h2 className=\"text-xl font-bold text-white\">Your Foundation Stack</h2>\n          <p className=\"text-cyan-100 text-sm\">\n            ${dailyStack.totalCostPerMonth.min}-${dailyStack.totalCostPerMonth.max}/month\n          </p>\n        </div>\n      </div>\n\n      {/* Rationale */}\n      <p className=\"text-white/90 text-sm mb-4 leading-relaxed\">\n        {dailyStack.rationale}\n      </p>\n\n      {/* Product Pills */}\n      <div className=\"flex flex-wrap gap-2 mb-4\">\n        {dailyStack.products.slice(0, 6).map(product => (\n          <div\n            key={product.id}\n            className=\"px-3 py-1.5 bg-white/20 rounded-full text-white text-sm font-medium\"\n          >\n            {product.name}\n          </div>\n        ))}\n      </div>\n\n      {/* Expand/Collapse Button */}\n      <button\n        onClick={() => setIsExpanded(!isExpanded)}\n        className=\"w-full bg-white/20 hover:bg-white/30 text-white font-medium py-2.5 px-4 rounded-lg transition-colors flex items-center justify-center gap-2\"\n      >\n        {isExpanded ? 'Hide Details' : 'View Complete Stack'}\n        {isExpanded ? <ChevronUp size={16} /> : <ChevronDown size={16} />}\n      </button>\n\n      {/* Expanded Details */}\n      <AnimatePresence>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            className=\"mt-4 space-y-4 overflow-hidden\"\n          >\n            {/* Morning */}\n            {dailyStack.timing.morning.length > 0 && (\n              <div className=\"bg-white/10 rounded-xl p-4\">\n                <div className=\"flex items-center gap-2 text-white font-medium mb-3\">\n                  <Sun size={18} />\n                  <span>Morning</span>\n                </div>\n                <div className=\"space-y-2\">\n                  {dailyStack.timing.morning.map(product => {\n                    const supplement = getSupplementDetails(product.supplementId);\n                    return (\n                      <div key={product.id} className=\"flex items-center justify-between text-sm\">\n                        <span className=\"text-white\">{product.name}</span>\n                        <span className=\"text-cyan-100\">{supplement?.dosage}</span>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            )}\n\n            {/* Evening */}\n            {dailyStack.timing.evening.length > 0 && (\n              <div className=\"bg-white/10 rounded-xl p-4\">\n                <div className=\"flex items-center gap-2 text-white font-medium mb-3\">\n                  <Moon size={18} />\n                  <span>Evening</span>\n                </div>\n                <div className=\"space-y-2\">\n                  {dailyStack.timing.evening.map(product => {\n                    const supplement = getSupplementDetails(product.supplementId);\n                    return (\n                      <div key={product.id} className=\"flex items-center justify-between text-sm\">\n                        <span className=\"text-white\">{product.name}</span>\n                        <span className=\"text-cyan-100\">{supplement?.dosage}</span>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            )}\n\n            {/* Anytime */}\n            {dailyStack.timing.anytime.length > 0 && (\n              <div className=\"bg-white/10 rounded-xl p-4\">\n                <div className=\"flex items-center gap-2 text-white font-medium mb-3\">\n                  <Clock size={18} />\n                  <span>Anytime</span>\n                </div>\n                <div className=\"space-y-2\">\n                  {dailyStack.timing.anytime.map(product => {\n                    const supplement = getSupplementDetails(product.supplementId);\n                    return (\n                      <div key={product.id} className=\"flex items-center justify-between text-sm\">\n                        <span className=\"text-white\">{product.name}</span>\n                        <span className=\"text-cyan-100\">{supplement?.dosage}</span>\n                      </div>\n                    );\n                  })}\n                </div>\n              </div>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n","numLines":138,"startLine":1,"totalLines":138}}}
{"parentUuid":"2a074196-6cd3-4f76-a16e-89118821770f","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_018wqjSCV6x7npKs1NNRwgYF","type":"tool_result","content":"Prompt is too long"}]},"uuid":"0f19f2dc-893b-4f99-b019-0fada0fe006d","timestamp":"2025-12-26T13:41:53.534Z","toolUseResult":{"bytes":2916375,"code":200,"codeText":"OK","result":"Prompt is too long","durationMs":906,"url":"https://nicelydone.club/n/pages"}}
{"parentUuid":"0f19f2dc-893b-4f99-b019-0fada0fe006d","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_0192chob69MGwJbofbV6c1nf","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me read the remaining card components and try the web fetch with an even simpler prompt:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":31002,"cache_creation_input_tokens":39147,"cache_read_input_tokens":24637,"cache_creation":{"ephemeral_5m_input_tokens":39147,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVPsmj29QdbbVTgJHq5J","type":"assistant","uuid":"368a75af-dd01-4347-b3ad-54552e8d6903","timestamp":"2025-12-26T13:41:57.459Z"}
{"parentUuid":"368a75af-dd01-4347-b3ad-54552e8d6903","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_0192chob69MGwJbofbV6c1nf","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NMhbVkESCKmEZwrbdw8JRY","name":"WebFetch","input":{"url":"https://nicelydone.club/n/pages","prompt":"What UI patterns are shown?"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":31002,"cache_creation_input_tokens":39147,"cache_read_input_tokens":24637,"cache_creation":{"ephemeral_5m_input_tokens":39147,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVPsmj29QdbbVTgJHq5J","type":"assistant","uuid":"b6549207-6d48-4195-8f21-b962473e7879","timestamp":"2025-12-26T13:41:58.748Z"}
{"parentUuid":"b6549207-6d48-4195-8f21-b962473e7879","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_0192chob69MGwJbofbV6c1nf","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01NBwxfYVdxW8nKHp6ERLLRB","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StreakCard.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":31002,"cache_creation_input_tokens":39147,"cache_read_input_tokens":24637,"cache_creation":{"ephemeral_5m_input_tokens":39147,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVPsmj29QdbbVTgJHq5J","type":"assistant","uuid":"cdddd019-ee02-4a88-8fe7-1a53a5b45694","timestamp":"2025-12-26T13:42:00.104Z"}
{"parentUuid":"cdddd019-ee02-4a88-8fe7-1a53a5b45694","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_0192chob69MGwJbofbV6c1nf","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_015t8KFHFBtAP32iXmRzmuuz","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/ProgressComparisonCard.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":31002,"cache_creation_input_tokens":39147,"cache_read_input_tokens":24637,"cache_creation":{"ephemeral_5m_input_tokens":39147,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVPsmj29QdbbVTgJHq5J","type":"assistant","uuid":"2e8a54ce-6880-4fcf-81ef-c96c80eccc26","timestamp":"2025-12-26T13:42:00.861Z"}
{"parentUuid":"2e8a54ce-6880-4fcf-81ef-c96c80eccc26","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_0192chob69MGwJbofbV6c1nf","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_016BMarcQ2MWd3VHCq6iE2vV","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/VisionInsightsCard.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":31002,"cache_creation_input_tokens":39147,"cache_read_input_tokens":24637,"cache_creation":{"ephemeral_5m_input_tokens":39147,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVPsmj29QdbbVTgJHq5J","type":"assistant","uuid":"c6c16b1a-5361-4fed-bb53-aa11834c3069","timestamp":"2025-12-26T13:42:01.720Z"}
{"parentUuid":"c6c16b1a-5361-4fed-bb53-aa11834c3069","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_0192chob69MGwJbofbV6c1nf","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_012btPeDHzPmJSDUrvU3HYtr","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/EnhancedRecommendationCard.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":31002,"cache_creation_input_tokens":39147,"cache_read_input_tokens":24637,"cache_creation":{"ephemeral_5m_input_tokens":39147,"ephemeral_1h_input_tokens":0},"output_tokens":392,"service_tier":"standard"}},"requestId":"req_011CWVPsmj29QdbbVTgJHq5J","type":"assistant","uuid":"298fe71e-9152-4550-b07c-6c5362d92a43","timestamp":"2025-12-26T13:42:02.840Z"}
{"parentUuid":"298fe71e-9152-4550-b07c-6c5362d92a43","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NBwxfYVdxW8nKHp6ERLLRB","type":"tool_result","content":"     1â†’'use client';\n     2â†’\n     3â†’import React from 'react';\n     4â†’import { useStreak } from '@/hooks/useStreak';\n     5â†’import { Flame, AlertCircle, Info, Calendar } from 'lucide-react';\n     6â†’import { motion } from 'framer-motion';\n     7â†’\n     8â†’const StreakCard: React.FC = () => {\n     9â†’    const { streakCount, maxStreak, isStreakAtRisk } = useStreak();\n    10â†’\n    11â†’    return (\n    12â†’        <motion.div\n    13â†’            initial={{ opacity: 0, scale: 0.95 }}\n    14â†’            animate={{ opacity: 1, scale: 1 }}\n    15â†’            className={`relative overflow-hidden rounded-2xl border p-4 transition-all duration-300 ${isStreakAtRisk\n    16â†’                    ? 'bg-orange-500/10 border-orange-500/30'\n    17â†’                    : 'bg-neutral-900 border-neutral-800'\n    18â†’                }`}\n    19â†’        >\n    20â†’            <div className=\"flex items-center justify-between gap-4\">\n    21â†’                <div className=\"flex items-center gap-4\">\n    22â†’                    <div className={`p-3 rounded-xl ${streakCount > 0 ? 'bg-orange-500/20 text-orange-500' : 'bg-neutral-800 text-neutral-500'\n    23â†’                        }`}>\n    24â†’                        <Flame size={32} className={streakCount > 0 ? 'animate-pulse' : ''} />\n    25â†’                    </div>\n    26â†’\n    27â†’                    <div>\n    28â†’                        <h3 className=\"text-xl font-black text-white leading-none\">\n    29â†’                            {streakCount} DAY <span className=\"text-orange-500\">STREAK</span>\n    30â†’                        </h3>\n    31â†’                        <div className=\"flex items-center gap-2 mt-1\">\n    32â†’                            <Calendar size={12} className=\"text-neutral-500\" />\n    33â†’                            <p className=\"text-[10px] font-bold text-neutral-500 uppercase tracking-widest\">\n    34â†’                                Personal Best: {maxStreak} Days\n    35â†’                            </p>\n    36â†’                        </div>\n    37â†’                    </div>\n    38â†’                </div>\n    39â†’\n    40â†’                {isStreakAtRisk && (\n    41â†’                    <div className=\"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-orange-500/20 border border-orange-500/30 text-orange-500\">\n    42â†’                        <AlertCircle size={14} />\n    43â†’                        <span className=\"text-[10px] font-black uppercase\">Streak At Risk!</span>\n    44â†’                    </div>\n    45â†’                )}\n    46â†’            </div>\n    47â†’\n    48â†’            {streakCount === 0 ? (\n    49â†’                <div className=\"mt-4 p-3 rounded-lg bg-white/5 border border-white/10 flex items-start gap-3\">\n    50â†’                    <Info size={16} className=\"text-blue-400 mt-0.5\" />\n    51â†’                    <p className=\"text-xs text-white/60 leading-tight\">\n    52â†’                        Perform your first <span className=\"text-white font-bold\">Glow Up Scan</span> today to start your streak and track your progress!\n    53â†’                    </p>\n    54â†’                </div>\n    55â†’            ) : (\n    56â†’                <div className=\"mt-4 flex gap-1.5\">\n    57â†’                    {[...Array(7)].map((_, i) => (\n    58â†’                        <div\n    59â†’                            key={i}\n    60â†’                            className={`h-1.5 flex-1 rounded-full ${i < (streakCount % 7 || 7) ? 'bg-orange-500' : 'bg-neutral-800'\n    61â†’                                }`}\n    62â†’                        />\n    63â†’                    ))}\n    64â†’                </div>\n    65â†’            )}\n    66â†’        </motion.div>\n    67â†’    );\n    68â†’};\n    69â†’\n    70â†’export default StreakCard;\n    71â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"e7230f54-592f-46c6-8fa8-2c4f7ca17f2a","timestamp":"2025-12-26T13:42:02.901Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/StreakCard.tsx","content":"'use client';\n\nimport React from 'react';\nimport { useStreak } from '@/hooks/useStreak';\nimport { Flame, AlertCircle, Info, Calendar } from 'lucide-react';\nimport { motion } from 'framer-motion';\n\nconst StreakCard: React.FC = () => {\n    const { streakCount, maxStreak, isStreakAtRisk } = useStreak();\n\n    return (\n        <motion.div\n            initial={{ opacity: 0, scale: 0.95 }}\n            animate={{ opacity: 1, scale: 1 }}\n            className={`relative overflow-hidden rounded-2xl border p-4 transition-all duration-300 ${isStreakAtRisk\n                    ? 'bg-orange-500/10 border-orange-500/30'\n                    : 'bg-neutral-900 border-neutral-800'\n                }`}\n        >\n            <div className=\"flex items-center justify-between gap-4\">\n                <div className=\"flex items-center gap-4\">\n                    <div className={`p-3 rounded-xl ${streakCount > 0 ? 'bg-orange-500/20 text-orange-500' : 'bg-neutral-800 text-neutral-500'\n                        }`}>\n                        <Flame size={32} className={streakCount > 0 ? 'animate-pulse' : ''} />\n                    </div>\n\n                    <div>\n                        <h3 className=\"text-xl font-black text-white leading-none\">\n                            {streakCount} DAY <span className=\"text-orange-500\">STREAK</span>\n                        </h3>\n                        <div className=\"flex items-center gap-2 mt-1\">\n                            <Calendar size={12} className=\"text-neutral-500\" />\n                            <p className=\"text-[10px] font-bold text-neutral-500 uppercase tracking-widest\">\n                                Personal Best: {maxStreak} Days\n                            </p>\n                        </div>\n                    </div>\n                </div>\n\n                {isStreakAtRisk && (\n                    <div className=\"flex items-center gap-2 px-3 py-1.5 rounded-lg bg-orange-500/20 border border-orange-500/30 text-orange-500\">\n                        <AlertCircle size={14} />\n                        <span className=\"text-[10px] font-black uppercase\">Streak At Risk!</span>\n                    </div>\n                )}\n            </div>\n\n            {streakCount === 0 ? (\n                <div className=\"mt-4 p-3 rounded-lg bg-white/5 border border-white/10 flex items-start gap-3\">\n                    <Info size={16} className=\"text-blue-400 mt-0.5\" />\n                    <p className=\"text-xs text-white/60 leading-tight\">\n                        Perform your first <span className=\"text-white font-bold\">Glow Up Scan</span> today to start your streak and track your progress!\n                    </p>\n                </div>\n            ) : (\n                <div className=\"mt-4 flex gap-1.5\">\n                    {[...Array(7)].map((_, i) => (\n                        <div\n                            key={i}\n                            className={`h-1.5 flex-1 rounded-full ${i < (streakCount % 7 || 7) ? 'bg-orange-500' : 'bg-neutral-800'\n                                }`}\n                        />\n                    ))}\n                </div>\n            )}\n        </motion.div>\n    );\n};\n\nexport default StreakCard;\n","numLines":71,"startLine":1,"totalLines":71}}}
{"parentUuid":"e7230f54-592f-46c6-8fa8-2c4f7ca17f2a","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_015t8KFHFBtAP32iXmRzmuuz","type":"tool_result","content":"     1â†’'use client';\n     2â†’\n     3â†’import { useState, useRef, useCallback } from 'react';\n     4â†’import { motion, AnimatePresence } from 'framer-motion';\n     5â†’import {\n     6â†’  Camera,\n     7â†’  Upload,\n     8â†’  TrendingUp,\n     9â†’  TrendingDown,\n    10â†’  Minus,\n    11â†’  RefreshCw,\n    12â†’  X,\n    13â†’  CheckCircle,\n    14â†’  ArrowRight,\n    15â†’} from 'lucide-react';\n    16â†’import Image from 'next/image';\n    17â†’\n    18â†’interface ProgressAnalysis {\n    19â†’  date: string;\n    20â†’  overallScore: number;\n    21â†’  bodyFatPercent?: number;\n    22â†’  frontPhotoUrl?: string;\n    23â†’}\n    24â†’\n    25â†’interface ProgressComparisonCardProps {\n    26â†’  currentAnalysis: ProgressAnalysis;\n    27â†’  previousAnalysis?: ProgressAnalysis | null;\n    28â†’  onUploadNewPhoto: (file: File) => Promise<void>;\n    29â†’  isAnalyzing?: boolean;\n    30â†’}\n    31â†’\n    32â†’export function ProgressComparisonCard({\n    33â†’  currentAnalysis,\n    34â†’  previousAnalysis,\n    35â†’  onUploadNewPhoto,\n    36â†’  isAnalyzing = false,\n    37â†’}: ProgressComparisonCardProps) {\n    38â†’  const [showUpload, setShowUpload] = useState(false);\n    39â†’  const [uploadPreview, setUploadPreview] = useState<string | null>(null);\n    40â†’  const [uploadFile, setUploadFile] = useState<File | null>(null);\n    41â†’  const [isUploading, setIsUploading] = useState(false);\n    42â†’  const fileInputRef = useRef<HTMLInputElement>(null);\n    43â†’\n    44â†’  const handleFileSelect = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    45â†’    const file = e.target.files?.[0];\n    46â†’    if (file) {\n    47â†’      setUploadFile(file);\n    48â†’      const reader = new FileReader();\n    49â†’      reader.onload = () => {\n    50â†’        setUploadPreview(reader.result as string);\n    51â†’      };\n    52â†’      reader.readAsDataURL(file);\n    53â†’    }\n    54â†’  }, []);\n    55â†’\n    56â†’  const handleUpload = async () => {\n    57â†’    if (!uploadFile) return;\n    58â†’\n    59â†’    setIsUploading(true);\n    60â†’    try {\n    61â†’      await onUploadNewPhoto(uploadFile);\n    62â†’      setShowUpload(false);\n    63â†’      setUploadPreview(null);\n    64â†’      setUploadFile(null);\n    65â†’    } catch (error) {\n    66â†’      console.error('Upload failed:', error);\n    67â†’    } finally {\n    68â†’      setIsUploading(false);\n    69â†’    }\n    70â†’  };\n    71â†’\n    72â†’  const cancelUpload = () => {\n    73â†’    setShowUpload(false);\n    74â†’    setUploadPreview(null);\n    75â†’    setUploadFile(null);\n    76â†’  };\n    77â†’\n    78â†’  // Calculate improvement\n    79â†’  const scoreDiff = previousAnalysis\n    80â†’    ? currentAnalysis.overallScore - previousAnalysis.overallScore\n    81â†’    : 0;\n    82â†’\n    83â†’  const bodyFatDiff = previousAnalysis?.bodyFatPercent && currentAnalysis.bodyFatPercent\n    84â†’    ? currentAnalysis.bodyFatPercent - previousAnalysis.bodyFatPercent\n    85â†’    : 0;\n    86â†’\n    87â†’  const hasImproved = scoreDiff > 0;\n    88â†’  const hasDeclined = scoreDiff < 0;\n    89â†’\n    90â†’  return (\n    91â†’    <motion.div\n    92â†’      className=\"bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-2xl p-6 overflow-hidden\"\n    93â†’      initial={{ opacity: 0, y: 20 }}\n    94â†’      animate={{ opacity: 1, y: 0 }}\n    95â†’    >\n    96â†’      <div className=\"flex items-center justify-between mb-4\">\n    97â†’        <div className=\"flex items-center gap-2\">\n    98â†’          <Camera size={20} className=\"text-cyan-400\" />\n    99â†’          <h3 className=\"font-semibold text-white\">Track Your Progress</h3>\n   100â†’        </div>\n   101â†’        {!showUpload && (\n   102â†’          <button\n   103â†’            onClick={() => setShowUpload(true)}\n   104â†’            className=\"flex items-center gap-1.5 px-3 py-1.5 bg-cyan-500/10 text-cyan-400 text-sm font-medium rounded-lg hover:bg-cyan-500/20 transition-colors\"\n   105â†’          >\n   106â†’            <Upload size={14} />\n   107â†’            New Photo\n   108â†’          </button>\n   109â†’        )}\n   110â†’      </div>\n   111â†’\n   112â†’      {/* Upload Mode */}\n   113â†’      <AnimatePresence>\n   114â†’        {showUpload && (\n   115â†’          <motion.div\n   116â†’            initial={{ opacity: 0, height: 0 }}\n   117â†’            animate={{ opacity: 1, height: 'auto' }}\n   118â†’            exit={{ opacity: 0, height: 0 }}\n   119â†’            className=\"space-y-4\"\n   120â†’          >\n   121â†’            {!uploadPreview ? (\n   122â†’              <div\n   123â†’                onClick={() => fileInputRef.current?.click()}\n   124â†’                className=\"border-2 border-dashed border-neutral-700 rounded-xl p-8 text-center cursor-pointer hover:border-cyan-500/50 transition-colors\"\n   125â†’              >\n   126â†’                <Camera size={32} className=\"mx-auto text-neutral-500 mb-3\" />\n   127â†’                <p className=\"text-neutral-400 text-sm mb-1\">\n   128â†’                  Upload a new photo to compare\n   129â†’                </p>\n   130â†’                <p className=\"text-neutral-600 text-xs\">\n   131â†’                  JPG, PNG or HEIC - Max 10MB\n   132â†’                </p>\n   133â†’                <input\n   134â†’                  ref={fileInputRef}\n   135â†’                  type=\"file\"\n   136â†’                  accept=\"image/*\"\n   137â†’                  onChange={handleFileSelect}\n   138â†’                  className=\"hidden\"\n   139â†’                />\n   140â†’              </div>\n   141â†’            ) : (\n   142â†’              <div className=\"space-y-4\">\n   143â†’                <div className=\"relative aspect-square max-w-[200px] mx-auto rounded-xl overflow-hidden\">\n   144â†’                  <Image\n   145â†’                    src={uploadPreview}\n   146â†’                    alt=\"Upload preview\"\n   147â†’                    fill\n   148â†’                    className=\"object-cover\"\n   149â†’                  />\n   150â†’                  <button\n   151â†’                    onClick={cancelUpload}\n   152â†’                    className=\"absolute top-2 right-2 p-1.5 bg-black/50 rounded-full hover:bg-black/70 transition-colors\"\n   153â†’                  >\n   154â†’                    <X size={14} className=\"text-white\" />\n   155â†’                  </button>\n   156â†’                </div>\n   157â†’                <div className=\"flex gap-2\">\n   158â†’                  <button\n   159â†’                    onClick={cancelUpload}\n   160â†’                    className=\"flex-1 py-2.5 bg-neutral-800 text-neutral-300 text-sm font-medium rounded-lg hover:bg-neutral-700 transition-colors\"\n   161â†’                  >\n   162â†’                    Cancel\n   163â†’                  </button>\n   164â†’                  <button\n   165â†’                    onClick={handleUpload}\n   166â†’                    disabled={isUploading}\n   167â†’                    className=\"flex-1 flex items-center justify-center gap-2 py-2.5 bg-cyan-500 text-black text-sm font-medium rounded-lg hover:bg-cyan-400 transition-colors disabled:opacity-50\"\n   168â†’                  >\n   169â†’                    {isUploading ? (\n   170â†’                      <>\n   171â†’                        <RefreshCw size={14} className=\"animate-spin\" />\n   172â†’                        Analyzing...\n   173â†’                      </>\n   174â†’                    ) : (\n   175â†’                      <>\n   176â†’                        <CheckCircle size={14} />\n   177â†’                        Analyze\n   178â†’                      </>\n   179â†’                    )}\n   180â†’                  </button>\n   181â†’                </div>\n   182â†’              </div>\n   183â†’            )}\n   184â†’          </motion.div>\n   185â†’        )}\n   186â†’      </AnimatePresence>\n   187â†’\n   188â†’      {/* Comparison View */}\n   189â†’      {!showUpload && (\n   190â†’        <div className=\"space-y-4\">\n   191â†’          {previousAnalysis ? (\n   192â†’            <>\n   193â†’              {/* Side by Side Photos */}\n   194â†’              <div className=\"grid grid-cols-2 gap-4\">\n   195â†’                {/* Previous */}\n   196â†’                <div className=\"space-y-2\">\n   197â†’                  <p className=\"text-xs text-neutral-500 text-center\">Previous</p>\n   198â†’                  <div className=\"relative aspect-square rounded-xl overflow-hidden bg-neutral-800\">\n   199â†’                    {previousAnalysis.frontPhotoUrl ? (\n   200â†’                      <Image\n   201â†’                        src={previousAnalysis.frontPhotoUrl}\n   202â†’                        alt=\"Previous analysis\"\n   203â†’                        fill\n   204â†’                        className=\"object-cover opacity-80\"\n   205â†’                      />\n   206â†’                    ) : (\n   207â†’                      <div className=\"w-full h-full flex items-center justify-center\">\n   208â†’                        <Camera size={24} className=\"text-neutral-600\" />\n   209â†’                      </div>\n   210â†’                    )}\n   211â†’                    <div className=\"absolute bottom-2 left-1/2 -translate-x-1/2 px-2 py-1 bg-black/70 rounded-lg\">\n   212â†’                      <span className=\"text-sm font-semibold text-white\">\n   213â†’                        {previousAnalysis.overallScore.toFixed(1)}\n   214â†’                      </span>\n   215â†’                    </div>\n   216â†’                  </div>\n   217â†’                  <p className=\"text-xs text-neutral-500 text-center\">\n   218â†’                    {new Date(previousAnalysis.date).toLocaleDateString()}\n   219â†’                  </p>\n   220â†’                </div>\n   221â†’\n   222â†’                {/* Current */}\n   223â†’                <div className=\"space-y-2\">\n   224â†’                  <p className=\"text-xs text-neutral-500 text-center\">Current</p>\n   225â†’                  <div className=\"relative aspect-square rounded-xl overflow-hidden bg-neutral-800 ring-2 ring-cyan-500/50\">\n   226â†’                    {currentAnalysis.frontPhotoUrl ? (\n   227â†’                      <Image\n   228â†’                        src={currentAnalysis.frontPhotoUrl}\n   229â†’                        alt=\"Current analysis\"\n   230â†’                        fill\n   231â†’                        className=\"object-cover\"\n   232â†’                      />\n   233â†’                    ) : (\n   234â†’                      <div className=\"w-full h-full flex items-center justify-center\">\n   235â†’                        <Camera size={24} className=\"text-neutral-600\" />\n   236â†’                      </div>\n   237â†’                    )}\n   238â†’                    <div className=\"absolute bottom-2 left-1/2 -translate-x-1/2 px-2 py-1 bg-cyan-500/90 rounded-lg\">\n   239â†’                      <span className=\"text-sm font-semibold text-black\">\n   240â†’                        {currentAnalysis.overallScore.toFixed(1)}\n   241â†’                      </span>\n   242â†’                    </div>\n   243â†’                  </div>\n   244â†’                  <p className=\"text-xs text-neutral-500 text-center\">\n   245â†’                    {new Date(currentAnalysis.date).toLocaleDateString()}\n   246â†’                  </p>\n   247â†’                </div>\n   248â†’              </div>\n   249â†’\n   250â†’              {/* Improvement Stats */}\n   251â†’              <div className=\"grid grid-cols-2 gap-3 pt-2 border-t border-neutral-800\">\n   252â†’                {/* Score Change */}\n   253â†’                <div className={`p-3 rounded-lg ${\n   254â†’                  hasImproved\n   255â†’                    ? 'bg-green-500/10 border border-green-500/20'\n   256â†’                    : hasDeclined\n   257â†’                      ? 'bg-red-500/10 border border-red-500/20'\n   258â†’                      : 'bg-neutral-800/50'\n   259â†’                }`}>\n   260â†’                  <div className=\"flex items-center gap-1.5 mb-1\">\n   261â†’                    {hasImproved ? (\n   262â†’                      <TrendingUp size={14} className=\"text-green-400\" />\n   263â†’                    ) : hasDeclined ? (\n   264â†’                      <TrendingDown size={14} className=\"text-red-400\" />\n   265â†’                    ) : (\n   266â†’                      <Minus size={14} className=\"text-neutral-400\" />\n   267â†’                    )}\n   268â†’                    <span className=\"text-xs text-neutral-400\">Score</span>\n   269â†’                  </div>\n   270â†’                  <span className={`text-lg font-bold ${\n   271â†’                    hasImproved\n   272â†’                      ? 'text-green-400'\n   273â†’                      : hasDeclined\n   274â†’                        ? 'text-red-400'\n   275â†’                        : 'text-neutral-400'\n   276â†’                  }`}>\n   277â†’                    {scoreDiff > 0 ? '+' : ''}{scoreDiff.toFixed(1)}\n   278â†’                  </span>\n   279â†’                </div>\n   280â†’\n   281â†’                {/* Body Fat Change */}\n   282â†’                {currentAnalysis.bodyFatPercent && (\n   283â†’                  <div className={`p-3 rounded-lg ${\n   284â†’                    bodyFatDiff < 0\n   285â†’                      ? 'bg-green-500/10 border border-green-500/20'\n   286â†’                      : bodyFatDiff > 0\n   287â†’                        ? 'bg-red-500/10 border border-red-500/20'\n   288â†’                        : 'bg-neutral-800/50'\n   289â†’                  }`}>\n   290â†’                    <div className=\"flex items-center gap-1.5 mb-1\">\n   291â†’                      {bodyFatDiff < 0 ? (\n   292â†’                        <TrendingDown size={14} className=\"text-green-400\" />\n   293â†’                      ) : bodyFatDiff > 0 ? (\n   294â†’                        <TrendingUp size={14} className=\"text-red-400\" />\n   295â†’                      ) : (\n   296â†’                        <Minus size={14} className=\"text-neutral-400\" />\n   297â†’                      )}\n   298â†’                      <span className=\"text-xs text-neutral-400\">Body Fat</span>\n   299â†’                    </div>\n   300â†’                    <span className={`text-lg font-bold ${\n   301â†’                      bodyFatDiff < 0\n   302â†’                        ? 'text-green-400'\n   303â†’                        : bodyFatDiff > 0\n   304â†’                          ? 'text-red-400'\n   305â†’                          : 'text-neutral-400'\n   306â†’                    }`}>\n   307â†’                      {bodyFatDiff > 0 ? '+' : ''}{bodyFatDiff.toFixed(1)}%\n   308â†’                    </span>\n   309â†’                  </div>\n   310â†’                )}\n   311â†’              </div>\n   312â†’\n   313â†’              {/* Improvement Message */}\n   314â†’              {hasImproved && (\n   315â†’                <div className=\"p-3 bg-green-500/10 border border-green-500/20 rounded-lg\">\n   316â†’                  <p className=\"text-sm text-green-400 text-center\">\n   317â†’                    {scoreDiff >= 0.5\n   318â†’                      ? 'Great progress! Your efforts are paying off.'\n   319â†’                      : 'Small but steady improvement. Keep going!'}\n   320â†’                  </p>\n   321â†’                </div>\n   322â†’              )}\n   323â†’            </>\n   324â†’          ) : (\n   325â†’            /* No Previous Analysis */\n   326â†’            <div className=\"text-center py-6\">\n   327â†’              <div className=\"w-16 h-16 mx-auto mb-4 rounded-2xl bg-neutral-800/50 flex items-center justify-center\">\n   328â†’                <Camera size={28} className=\"text-neutral-500\" />\n   329â†’              </div>\n   330â†’              <h4 className=\"text-white font-medium mb-1\">Start Tracking Progress</h4>\n   331â†’              <p className=\"text-sm text-neutral-400 mb-4\">\n   332â†’                Upload a new photo after making changes to see your improvement over time.\n   333â†’              </p>\n   334â†’              <button\n   335â†’                onClick={() => setShowUpload(true)}\n   336â†’                className=\"inline-flex items-center gap-2 px-4 py-2 bg-cyan-500 text-black text-sm font-medium rounded-lg hover:bg-cyan-400 transition-colors\"\n   337â†’              >\n   338â†’                <Upload size={16} />\n   339â†’                Upload Progress Photo\n   340â†’              </button>\n   341â†’            </div>\n   342â†’          )}\n   343â†’\n   344â†’          {/* Tips */}\n   345â†’          {previousAnalysis && (\n   346â†’            <div className=\"pt-3 border-t border-neutral-800\">\n   347â†’              <p className=\"text-xs text-neutral-500 flex items-center gap-1.5\">\n   348â†’                <ArrowRight size={12} />\n   349â†’                Tip: Take photos in the same lighting and angle for accurate comparisons\n   350â†’              </p>\n   351â†’            </div>\n   352â†’          )}\n   353â†’        </div>\n   354â†’      )}\n   355â†’\n   356â†’      {/* Loading Overlay */}\n   357â†’      <AnimatePresence>\n   358â†’        {isAnalyzing && (\n   359â†’          <motion.div\n   360â†’            initial={{ opacity: 0 }}\n   361â†’            animate={{ opacity: 1 }}\n   362â†’            exit={{ opacity: 0 }}\n   363â†’            className=\"absolute inset-0 bg-neutral-900/90 flex items-center justify-center\"\n   364â†’          >\n   365â†’            <div className=\"text-center\">\n   366â†’              <RefreshCw size={32} className=\"mx-auto text-cyan-400 animate-spin mb-3\" />\n   367â†’              <p className=\"text-white font-medium\">Analyzing your progress...</p>\n   368â†’              <p className=\"text-sm text-neutral-400\">This may take a moment</p>\n   369â†’            </div>\n   370â†’          </motion.div>\n   371â†’        )}\n   372â†’      </AnimatePresence>\n   373â†’    </motion.div>\n   374â†’  );\n   375â†’}\n   376â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"c1ec03ef-1851-484c-baa1-904b54b9c1a2","timestamp":"2025-12-26T13:42:02.901Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/ProgressComparisonCard.tsx","content":"'use client';\n\nimport { useState, useRef, useCallback } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  Camera,\n  Upload,\n  TrendingUp,\n  TrendingDown,\n  Minus,\n  RefreshCw,\n  X,\n  CheckCircle,\n  ArrowRight,\n} from 'lucide-react';\nimport Image from 'next/image';\n\ninterface ProgressAnalysis {\n  date: string;\n  overallScore: number;\n  bodyFatPercent?: number;\n  frontPhotoUrl?: string;\n}\n\ninterface ProgressComparisonCardProps {\n  currentAnalysis: ProgressAnalysis;\n  previousAnalysis?: ProgressAnalysis | null;\n  onUploadNewPhoto: (file: File) => Promise<void>;\n  isAnalyzing?: boolean;\n}\n\nexport function ProgressComparisonCard({\n  currentAnalysis,\n  previousAnalysis,\n  onUploadNewPhoto,\n  isAnalyzing = false,\n}: ProgressComparisonCardProps) {\n  const [showUpload, setShowUpload] = useState(false);\n  const [uploadPreview, setUploadPreview] = useState<string | null>(null);\n  const [uploadFile, setUploadFile] = useState<File | null>(null);\n  const [isUploading, setIsUploading] = useState(false);\n  const fileInputRef = useRef<HTMLInputElement>(null);\n\n  const handleFileSelect = useCallback((e: React.ChangeEvent<HTMLInputElement>) => {\n    const file = e.target.files?.[0];\n    if (file) {\n      setUploadFile(file);\n      const reader = new FileReader();\n      reader.onload = () => {\n        setUploadPreview(reader.result as string);\n      };\n      reader.readAsDataURL(file);\n    }\n  }, []);\n\n  const handleUpload = async () => {\n    if (!uploadFile) return;\n\n    setIsUploading(true);\n    try {\n      await onUploadNewPhoto(uploadFile);\n      setShowUpload(false);\n      setUploadPreview(null);\n      setUploadFile(null);\n    } catch (error) {\n      console.error('Upload failed:', error);\n    } finally {\n      setIsUploading(false);\n    }\n  };\n\n  const cancelUpload = () => {\n    setShowUpload(false);\n    setUploadPreview(null);\n    setUploadFile(null);\n  };\n\n  // Calculate improvement\n  const scoreDiff = previousAnalysis\n    ? currentAnalysis.overallScore - previousAnalysis.overallScore\n    : 0;\n\n  const bodyFatDiff = previousAnalysis?.bodyFatPercent && currentAnalysis.bodyFatPercent\n    ? currentAnalysis.bodyFatPercent - previousAnalysis.bodyFatPercent\n    : 0;\n\n  const hasImproved = scoreDiff > 0;\n  const hasDeclined = scoreDiff < 0;\n\n  return (\n    <motion.div\n      className=\"bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-2xl p-6 overflow-hidden\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n    >\n      <div className=\"flex items-center justify-between mb-4\">\n        <div className=\"flex items-center gap-2\">\n          <Camera size={20} className=\"text-cyan-400\" />\n          <h3 className=\"font-semibold text-white\">Track Your Progress</h3>\n        </div>\n        {!showUpload && (\n          <button\n            onClick={() => setShowUpload(true)}\n            className=\"flex items-center gap-1.5 px-3 py-1.5 bg-cyan-500/10 text-cyan-400 text-sm font-medium rounded-lg hover:bg-cyan-500/20 transition-colors\"\n          >\n            <Upload size={14} />\n            New Photo\n          </button>\n        )}\n      </div>\n\n      {/* Upload Mode */}\n      <AnimatePresence>\n        {showUpload && (\n          <motion.div\n            initial={{ opacity: 0, height: 0 }}\n            animate={{ opacity: 1, height: 'auto' }}\n            exit={{ opacity: 0, height: 0 }}\n            className=\"space-y-4\"\n          >\n            {!uploadPreview ? (\n              <div\n                onClick={() => fileInputRef.current?.click()}\n                className=\"border-2 border-dashed border-neutral-700 rounded-xl p-8 text-center cursor-pointer hover:border-cyan-500/50 transition-colors\"\n              >\n                <Camera size={32} className=\"mx-auto text-neutral-500 mb-3\" />\n                <p className=\"text-neutral-400 text-sm mb-1\">\n                  Upload a new photo to compare\n                </p>\n                <p className=\"text-neutral-600 text-xs\">\n                  JPG, PNG or HEIC - Max 10MB\n                </p>\n                <input\n                  ref={fileInputRef}\n                  type=\"file\"\n                  accept=\"image/*\"\n                  onChange={handleFileSelect}\n                  className=\"hidden\"\n                />\n              </div>\n            ) : (\n              <div className=\"space-y-4\">\n                <div className=\"relative aspect-square max-w-[200px] mx-auto rounded-xl overflow-hidden\">\n                  <Image\n                    src={uploadPreview}\n                    alt=\"Upload preview\"\n                    fill\n                    className=\"object-cover\"\n                  />\n                  <button\n                    onClick={cancelUpload}\n                    className=\"absolute top-2 right-2 p-1.5 bg-black/50 rounded-full hover:bg-black/70 transition-colors\"\n                  >\n                    <X size={14} className=\"text-white\" />\n                  </button>\n                </div>\n                <div className=\"flex gap-2\">\n                  <button\n                    onClick={cancelUpload}\n                    className=\"flex-1 py-2.5 bg-neutral-800 text-neutral-300 text-sm font-medium rounded-lg hover:bg-neutral-700 transition-colors\"\n                  >\n                    Cancel\n                  </button>\n                  <button\n                    onClick={handleUpload}\n                    disabled={isUploading}\n                    className=\"flex-1 flex items-center justify-center gap-2 py-2.5 bg-cyan-500 text-black text-sm font-medium rounded-lg hover:bg-cyan-400 transition-colors disabled:opacity-50\"\n                  >\n                    {isUploading ? (\n                      <>\n                        <RefreshCw size={14} className=\"animate-spin\" />\n                        Analyzing...\n                      </>\n                    ) : (\n                      <>\n                        <CheckCircle size={14} />\n                        Analyze\n                      </>\n                    )}\n                  </button>\n                </div>\n              </div>\n            )}\n          </motion.div>\n        )}\n      </AnimatePresence>\n\n      {/* Comparison View */}\n      {!showUpload && (\n        <div className=\"space-y-4\">\n          {previousAnalysis ? (\n            <>\n              {/* Side by Side Photos */}\n              <div className=\"grid grid-cols-2 gap-4\">\n                {/* Previous */}\n                <div className=\"space-y-2\">\n                  <p className=\"text-xs text-neutral-500 text-center\">Previous</p>\n                  <div className=\"relative aspect-square rounded-xl overflow-hidden bg-neutral-800\">\n                    {previousAnalysis.frontPhotoUrl ? (\n                      <Image\n                        src={previousAnalysis.frontPhotoUrl}\n                        alt=\"Previous analysis\"\n                        fill\n                        className=\"object-cover opacity-80\"\n                      />\n                    ) : (\n                      <div className=\"w-full h-full flex items-center justify-center\">\n                        <Camera size={24} className=\"text-neutral-600\" />\n                      </div>\n                    )}\n                    <div className=\"absolute bottom-2 left-1/2 -translate-x-1/2 px-2 py-1 bg-black/70 rounded-lg\">\n                      <span className=\"text-sm font-semibold text-white\">\n                        {previousAnalysis.overallScore.toFixed(1)}\n                      </span>\n                    </div>\n                  </div>\n                  <p className=\"text-xs text-neutral-500 text-center\">\n                    {new Date(previousAnalysis.date).toLocaleDateString()}\n                  </p>\n                </div>\n\n                {/* Current */}\n                <div className=\"space-y-2\">\n                  <p className=\"text-xs text-neutral-500 text-center\">Current</p>\n                  <div className=\"relative aspect-square rounded-xl overflow-hidden bg-neutral-800 ring-2 ring-cyan-500/50\">\n                    {currentAnalysis.frontPhotoUrl ? (\n                      <Image\n                        src={currentAnalysis.frontPhotoUrl}\n                        alt=\"Current analysis\"\n                        fill\n                        className=\"object-cover\"\n                      />\n                    ) : (\n                      <div className=\"w-full h-full flex items-center justify-center\">\n                        <Camera size={24} className=\"text-neutral-600\" />\n                      </div>\n                    )}\n                    <div className=\"absolute bottom-2 left-1/2 -translate-x-1/2 px-2 py-1 bg-cyan-500/90 rounded-lg\">\n                      <span className=\"text-sm font-semibold text-black\">\n                        {currentAnalysis.overallScore.toFixed(1)}\n                      </span>\n                    </div>\n                  </div>\n                  <p className=\"text-xs text-neutral-500 text-center\">\n                    {new Date(currentAnalysis.date).toLocaleDateString()}\n                  </p>\n                </div>\n              </div>\n\n              {/* Improvement Stats */}\n              <div className=\"grid grid-cols-2 gap-3 pt-2 border-t border-neutral-800\">\n                {/* Score Change */}\n                <div className={`p-3 rounded-lg ${\n                  hasImproved\n                    ? 'bg-green-500/10 border border-green-500/20'\n                    : hasDeclined\n                      ? 'bg-red-500/10 border border-red-500/20'\n                      : 'bg-neutral-800/50'\n                }`}>\n                  <div className=\"flex items-center gap-1.5 mb-1\">\n                    {hasImproved ? (\n                      <TrendingUp size={14} className=\"text-green-400\" />\n                    ) : hasDeclined ? (\n                      <TrendingDown size={14} className=\"text-red-400\" />\n                    ) : (\n                      <Minus size={14} className=\"text-neutral-400\" />\n                    )}\n                    <span className=\"text-xs text-neutral-400\">Score</span>\n                  </div>\n                  <span className={`text-lg font-bold ${\n                    hasImproved\n                      ? 'text-green-400'\n                      : hasDeclined\n                        ? 'text-red-400'\n                        : 'text-neutral-400'\n                  }`}>\n                    {scoreDiff > 0 ? '+' : ''}{scoreDiff.toFixed(1)}\n                  </span>\n                </div>\n\n                {/* Body Fat Change */}\n                {currentAnalysis.bodyFatPercent && (\n                  <div className={`p-3 rounded-lg ${\n                    bodyFatDiff < 0\n                      ? 'bg-green-500/10 border border-green-500/20'\n                      : bodyFatDiff > 0\n                        ? 'bg-red-500/10 border border-red-500/20'\n                        : 'bg-neutral-800/50'\n                  }`}>\n                    <div className=\"flex items-center gap-1.5 mb-1\">\n                      {bodyFatDiff < 0 ? (\n                        <TrendingDown size={14} className=\"text-green-400\" />\n                      ) : bodyFatDiff > 0 ? (\n                        <TrendingUp size={14} className=\"text-red-400\" />\n                      ) : (\n                        <Minus size={14} className=\"text-neutral-400\" />\n                      )}\n                      <span className=\"text-xs text-neutral-400\">Body Fat</span>\n                    </div>\n                    <span className={`text-lg font-bold ${\n                      bodyFatDiff < 0\n                        ? 'text-green-400'\n                        : bodyFatDiff > 0\n                          ? 'text-red-400'\n                          : 'text-neutral-400'\n                    }`}>\n                      {bodyFatDiff > 0 ? '+' : ''}{bodyFatDiff.toFixed(1)}%\n                    </span>\n                  </div>\n                )}\n              </div>\n\n              {/* Improvement Message */}\n              {hasImproved && (\n                <div className=\"p-3 bg-green-500/10 border border-green-500/20 rounded-lg\">\n                  <p className=\"text-sm text-green-400 text-center\">\n                    {scoreDiff >= 0.5\n                      ? 'Great progress! Your efforts are paying off.'\n                      : 'Small but steady improvement. Keep going!'}\n                  </p>\n                </div>\n              )}\n            </>\n          ) : (\n            /* No Previous Analysis */\n            <div className=\"text-center py-6\">\n              <div className=\"w-16 h-16 mx-auto mb-4 rounded-2xl bg-neutral-800/50 flex items-center justify-center\">\n                <Camera size={28} className=\"text-neutral-500\" />\n              </div>\n              <h4 className=\"text-white font-medium mb-1\">Start Tracking Progress</h4>\n              <p className=\"text-sm text-neutral-400 mb-4\">\n                Upload a new photo after making changes to see your improvement over time.\n              </p>\n              <button\n                onClick={() => setShowUpload(true)}\n                className=\"inline-flex items-center gap-2 px-4 py-2 bg-cyan-500 text-black text-sm font-medium rounded-lg hover:bg-cyan-400 transition-colors\"\n              >\n                <Upload size={16} />\n                Upload Progress Photo\n              </button>\n            </div>\n          )}\n\n          {/* Tips */}\n          {previousAnalysis && (\n            <div className=\"pt-3 border-t border-neutral-800\">\n              <p className=\"text-xs text-neutral-500 flex items-center gap-1.5\">\n                <ArrowRight size={12} />\n                Tip: Take photos in the same lighting and angle for accurate comparisons\n              </p>\n            </div>\n          )}\n        </div>\n      )}\n\n      {/* Loading Overlay */}\n      <AnimatePresence>\n        {isAnalyzing && (\n          <motion.div\n            initial={{ opacity: 0 }}\n            animate={{ opacity: 1 }}\n            exit={{ opacity: 0 }}\n            className=\"absolute inset-0 bg-neutral-900/90 flex items-center justify-center\"\n          >\n            <div className=\"text-center\">\n              <RefreshCw size={32} className=\"mx-auto text-cyan-400 animate-spin mb-3\" />\n              <p className=\"text-white font-medium\">Analyzing your progress...</p>\n              <p className=\"text-sm text-neutral-400\">This may take a moment</p>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n","numLines":376,"startLine":1,"totalLines":376}}}
{"parentUuid":"c1ec03ef-1851-484c-baa1-904b54b9c1a2","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_016BMarcQ2MWd3VHCq6iE2vV","type":"tool_result","content":"     1â†’'use client';\n     2â†’\n     3â†’import React from 'react';\n     4â†’import { useResults } from '@/contexts/ResultsContext';\n     5â†’import { usePricing } from '@/contexts/PricingContext';\n     6â†’import { Sparkles, Lock, ShieldCheck, Zap, Info } from 'lucide-react';\n     7â†’\n     8â†’const VisionInsightsCard: React.FC = () => {\n     9â†’    const { vision, isUnlocked } = useResults();\n    10â†’    const { openPricingModal } = usePricing();\n    11â†’\n    12â†’    if (!vision) return null;\n    13â†’\n    14â†’    const sections = [\n    15â†’        { title: 'Skin Analysis', data: vision.skin, icon: 'âœ¨' },\n    16â†’        { title: 'Hair & Scalp', data: vision.hair, icon: 'ðŸ’‡â€â™‚ï¸' },\n    17â†’        { title: 'Eye Health', data: vision.eyes, icon: 'ðŸ‘ï¸' },\n    18â†’        { title: 'Dental Harmony', data: vision.teeth, icon: 'ðŸ¦·' }\n    19â†’    ];\n    20â†’\n    21â†’    return (\n    22â†’        <div className=\"relative overflow-hidden bg-[#111] border border-white/10 rounded-2xl p-6 shadow-xl\">\n    23â†’            <div className=\"flex items-center justify-between mb-6\">\n    24â†’                <div className=\"flex items-center gap-3\">\n    25â†’                    <div className=\"p-2 rounded-lg bg-blue-500/20 text-blue-400\">\n    26â†’                        <Sparkles size={20} />\n    27â†’                    </div>\n    28â†’                    <div>\n    29â†’                        <h3 className=\"text-lg font-bold text-white uppercase tracking-wider\">AI Qualitative Insights</h3>\n    30â†’                        <p className=\"text-xs text-white/40 uppercase font-bold tracking-widest\">Powered by Claude 3.5 Sonnet</p>\n    31â†’                    </div>\n    32â†’                </div>\n    33â†’                {isUnlocked && (\n    34â†’                    <div className=\"flex items-center gap-1.5 px-3 py-1 rounded-full bg-green-500/10 border border-green-500/20 text-green-400 text-[10px] font-black uppercase\">\n    35â†’                        <ShieldCheck size={12} />\n    36â†’                        Pro Verified\n    37â†’                    </div>\n    38â†’                )}\n    39â†’            </div>\n    40â†’\n    41â†’            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n    42â†’                {sections.map((section, idx) => (\n    43â†’                    <div key={idx} className=\"p-4 rounded-xl bg-white/[0.03] border border-white/5\">\n    44â†’                        <div className=\"flex items-center gap-2 mb-3\">\n    45â†’                            <span className=\"text-xl\">{section.icon}</span>\n    46â†’                            <h4 className=\"text-sm font-bold text-white/70 uppercase tracking-widest\">{section.title}</h4>\n    47â†’                        </div>\n    48â†’\n    49â†’                        <div className=\"space-y-2\">\n    50â†’                            {Object.entries(section.data || {} as Record<string, string | number | string[]>).map(([key, value]) => {\n    51â†’                                // Skip confidence and visibility flags\n    52â†’                                if (key === 'confidence' || key === 'visible_in_photo') return null;\n    53â†’\n    54â†’                                const displayValue = value as string | number | string[];\n    55â†’                                return (\n    56â†’                                    <div key={key} className=\"flex justify-between items-center text-xs\">\n    57â†’                                        <span className=\"text-white/40 capitalize\">{key.replace(/_/g, ' ')}</span>\n    58â†’                                        <span className={`font-medium ${displayValue === 'Locked' ? 'text-blue-400 font-bold' : 'text-white'}`}>\n    59â†’                                            {Array.isArray(displayValue) ? displayValue.join(', ') || 'None' : String(displayValue)}\n    60â†’                                        </span>\n    61â†’                                    </div>\n    62â†’                                );\n    63â†’                            })}\n    64â†’                        </div>\n    65â†’                    </div>\n    66â†’                ))}\n    67â†’            </div>\n    68â†’\n    69â†’            {/* Premium Lock Overlay */}\n    70â†’            {!isUnlocked && (\n    71â†’                <div\n    72â†’                    className=\"absolute inset-0 z-10 flex flex-col items-center justify-center p-6 bg-black/40 backdrop-blur-md cursor-pointer group\"\n    73â†’                    onClick={() => openPricingModal('vision_insights')}\n    74â†’                >\n    75â†’                    <div className=\"p-4 rounded-full bg-blue-500/20 border border-blue-500/30 text-blue-400 mb-4 group-hover:scale-110 transition-transform\">\n    76â†’                        <Lock size={32} />\n    77â†’                    </div>\n    78â†’                    <h3 className=\"text-xl font-black text-white mb-2 text-center uppercase tracking-tighter\">\n    79â†’                        Unlock Qualitative <br />\n    80â†’                        <span className=\"text-blue-400\">Detailed Analysis</span>\n    81â†’                    </h3>\n    82â†’                    <p className=\"text-white/60 text-sm text-center max-w-xs mb-6\">\n    83â†’                        Reveal detailed insights about skin clarity, hair health, and dental alignment powered by medical-grade AI.\n    84â†’                    </p>\n    85â†’                    <button className=\"flex items-center gap-2 px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white text-xs font-black rounded-full transition-all shadow-[0_0_20px_rgba(59,130,246,0.3)]\">\n    86â†’                        UPGRADE TO PRO\n    87â†’                        <Zap size={14} className=\"fill-current\" />\n    88â†’                    </button>\n    89â†’\n    90â†’                    <div className=\"mt-8 flex items-center gap-4 text-white/30\">\n    91â†’                        <div className=\"flex items-center gap-1\">\n    92â†’                            <Info size={12} />\n    93â†’                            <span className=\"text-[10px] font-bold uppercase\">Claude 3.5 Sonnet Analysis</span>\n    94â†’                        </div>\n    95â†’                    </div>\n    96â†’                </div>\n    97â†’            )}\n    98â†’        </div>\n    99â†’    );\n   100â†’};\n   101â†’\n   102â†’export default VisionInsightsCard;\n   103â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"1ab34d96-9d40-4b35-8303-81acec104535","timestamp":"2025-12-26T13:42:02.901Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/VisionInsightsCard.tsx","content":"'use client';\n\nimport React from 'react';\nimport { useResults } from '@/contexts/ResultsContext';\nimport { usePricing } from '@/contexts/PricingContext';\nimport { Sparkles, Lock, ShieldCheck, Zap, Info } from 'lucide-react';\n\nconst VisionInsightsCard: React.FC = () => {\n    const { vision, isUnlocked } = useResults();\n    const { openPricingModal } = usePricing();\n\n    if (!vision) return null;\n\n    const sections = [\n        { title: 'Skin Analysis', data: vision.skin, icon: 'âœ¨' },\n        { title: 'Hair & Scalp', data: vision.hair, icon: 'ðŸ’‡â€â™‚ï¸' },\n        { title: 'Eye Health', data: vision.eyes, icon: 'ðŸ‘ï¸' },\n        { title: 'Dental Harmony', data: vision.teeth, icon: 'ðŸ¦·' }\n    ];\n\n    return (\n        <div className=\"relative overflow-hidden bg-[#111] border border-white/10 rounded-2xl p-6 shadow-xl\">\n            <div className=\"flex items-center justify-between mb-6\">\n                <div className=\"flex items-center gap-3\">\n                    <div className=\"p-2 rounded-lg bg-blue-500/20 text-blue-400\">\n                        <Sparkles size={20} />\n                    </div>\n                    <div>\n                        <h3 className=\"text-lg font-bold text-white uppercase tracking-wider\">AI Qualitative Insights</h3>\n                        <p className=\"text-xs text-white/40 uppercase font-bold tracking-widest\">Powered by Claude 3.5 Sonnet</p>\n                    </div>\n                </div>\n                {isUnlocked && (\n                    <div className=\"flex items-center gap-1.5 px-3 py-1 rounded-full bg-green-500/10 border border-green-500/20 text-green-400 text-[10px] font-black uppercase\">\n                        <ShieldCheck size={12} />\n                        Pro Verified\n                    </div>\n                )}\n            </div>\n\n            <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n                {sections.map((section, idx) => (\n                    <div key={idx} className=\"p-4 rounded-xl bg-white/[0.03] border border-white/5\">\n                        <div className=\"flex items-center gap-2 mb-3\">\n                            <span className=\"text-xl\">{section.icon}</span>\n                            <h4 className=\"text-sm font-bold text-white/70 uppercase tracking-widest\">{section.title}</h4>\n                        </div>\n\n                        <div className=\"space-y-2\">\n                            {Object.entries(section.data || {} as Record<string, string | number | string[]>).map(([key, value]) => {\n                                // Skip confidence and visibility flags\n                                if (key === 'confidence' || key === 'visible_in_photo') return null;\n\n                                const displayValue = value as string | number | string[];\n                                return (\n                                    <div key={key} className=\"flex justify-between items-center text-xs\">\n                                        <span className=\"text-white/40 capitalize\">{key.replace(/_/g, ' ')}</span>\n                                        <span className={`font-medium ${displayValue === 'Locked' ? 'text-blue-400 font-bold' : 'text-white'}`}>\n                                            {Array.isArray(displayValue) ? displayValue.join(', ') || 'None' : String(displayValue)}\n                                        </span>\n                                    </div>\n                                );\n                            })}\n                        </div>\n                    </div>\n                ))}\n            </div>\n\n            {/* Premium Lock Overlay */}\n            {!isUnlocked && (\n                <div\n                    className=\"absolute inset-0 z-10 flex flex-col items-center justify-center p-6 bg-black/40 backdrop-blur-md cursor-pointer group\"\n                    onClick={() => openPricingModal('vision_insights')}\n                >\n                    <div className=\"p-4 rounded-full bg-blue-500/20 border border-blue-500/30 text-blue-400 mb-4 group-hover:scale-110 transition-transform\">\n                        <Lock size={32} />\n                    </div>\n                    <h3 className=\"text-xl font-black text-white mb-2 text-center uppercase tracking-tighter\">\n                        Unlock Qualitative <br />\n                        <span className=\"text-blue-400\">Detailed Analysis</span>\n                    </h3>\n                    <p className=\"text-white/60 text-sm text-center max-w-xs mb-6\">\n                        Reveal detailed insights about skin clarity, hair health, and dental alignment powered by medical-grade AI.\n                    </p>\n                    <button className=\"flex items-center gap-2 px-6 py-3 bg-blue-500 hover:bg-blue-600 text-white text-xs font-black rounded-full transition-all shadow-[0_0_20px_rgba(59,130,246,0.3)]\">\n                        UPGRADE TO PRO\n                        <Zap size={14} className=\"fill-current\" />\n                    </button>\n\n                    <div className=\"mt-8 flex items-center gap-4 text-white/30\">\n                        <div className=\"flex items-center gap-1\">\n                            <Info size={12} />\n                            <span className=\"text-[10px] font-bold uppercase\">Claude 3.5 Sonnet Analysis</span>\n                        </div>\n                    </div>\n                </div>\n            )}\n        </div>\n    );\n};\n\nexport default VisionInsightsCard;\n","numLines":103,"startLine":1,"totalLines":103}}}
{"parentUuid":"1ab34d96-9d40-4b35-8303-81acec104535","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_012btPeDHzPmJSDUrvU3HYtr","type":"tool_result","content":"     1â†’'use client';\n     2â†’\n     3â†’import { useState, useCallback, useMemo } from 'react';\n     4â†’import { motion, AnimatePresence } from 'framer-motion';\n     5â†’import {\n     6â†’  ChevronDown,\n     7â†’  Clock,\n     8â†’  DollarSign,\n     9â†’  AlertTriangle,\n    10â†’  Target,\n    11â†’  Info,\n    12â†’  BookOpen,\n    13â†’  CheckCircle,\n    14â†’  Trash2,\n    15â†’  Plus,\n    16â†’  Sparkles,\n    17â†’  ExternalLink,\n    18â†’} from 'lucide-react';\n    19â†’import { Recommendation } from '@/types/results';\n    20â†’import { Gender, Ethnicity } from '@/lib/harmony-scoring';\n    21â†’\n    22â†’// ============================================\n    23â†’// TYPES\n    24â†’// ============================================\n    25â†’\n    26â†’interface EnhancedRecommendationCardProps {\n    27â†’  recommendation: Recommendation;\n    28â†’  isExpanded?: boolean;\n    29â†’  onToggle?: () => void;\n    30â†’  rank?: number;\n    31â†’  onMarkComplete?: (id: string) => void;\n    32â†’  onRemove?: (id: string) => void;\n    33â†’  isCompleted?: boolean;\n    34â†’  gender?: Gender;\n    35â†’  ethnicity?: Ethnicity;\n    36â†’}\n    37â†’\n    38â†’// ============================================\n    39â†’// RESEARCH CITATIONS DATABASE\n    40â†’// ============================================\n    41â†’\n    42â†’interface ResearchCitation {\n    43â†’  title: string;\n    44â†’  authors: string;\n    45â†’  journal: string;\n    46â†’  year: number;\n    47â†’  doi?: string;\n    48â†’  summary: string;\n    49â†’  procedureRefs: string[];  // Matches recommendation ref_id\n    50â†’  genderRelevance?: 'male' | 'female' | 'both';\n    51â†’  ethnicityRelevance?: Ethnicity[];\n    52â†’}\n    53â†’\n    54â†’const RESEARCH_CITATIONS: ResearchCitation[] = [\n    55â†’  // Rhinoplasty Research\n    56â†’  {\n    57â†’    title: 'Ethnic Considerations in Rhinoplasty',\n    58â†’    authors: 'Rohrich RJ, Bolden K',\n    59â†’    journal: 'Plastic and Reconstructive Surgery',\n    60â†’    year: 2010,\n    61â†’    doi: '10.1097/PRS.0b013e3181c6b2b7',\n    62â†’    summary: 'Discusses the importance of preserving ethnic identity while achieving aesthetic goals in rhinoplasty across different ethnicities.',\n    63â†’    procedureRefs: ['SUR-02', 'MIN-04'],\n    64â†’    genderRelevance: 'both',\n    65â†’    ethnicityRelevance: ['black', 'east_asian', 'south_asian', 'middle_eastern', 'hispanic'],\n    66â†’  },\n    67â†’  {\n    68â†’    title: 'The Male Rhinoplasty',\n    69â†’    authors: 'Foda HM',\n    70â†’    journal: 'Facial Plastic Surgery',\n    71â†’    year: 2008,\n    72â†’    summary: 'Examines unique considerations for male rhinoplasty including maintaining masculine features and avoiding feminization.',\n    73â†’    procedureRefs: ['SUR-02', 'MIN-04'],\n    74â†’    genderRelevance: 'male',\n    75â†’  },\n    76â†’  // Jaw/Chin Research\n    77â†’  {\n    78â†’    title: 'Sliding Genioplasty: A Systematic Review',\n    79â†’    authors: 'Park JH, Tae-Hoon K',\n    80â†’    journal: 'Journal of Oral and Maxillofacial Surgery',\n    81â†’    year: 2018,\n    82â†’    summary: 'Comprehensive analysis of chin advancement outcomes and patient satisfaction rates across demographics.',\n    83â†’    procedureRefs: ['SUR-01', 'MIN-02'],\n    84â†’    genderRelevance: 'both',\n    85â†’  },\n    86â†’  {\n    87â†’    title: 'Gender Differences in Jaw Angle Aesthetics',\n    88â†’    authors: 'Kim YH, Cho J',\n    89â†’    journal: 'Aesthetic Plastic Surgery',\n    90â†’    year: 2020,\n    91â†’    summary: 'Research on ideal jaw angle parameters for males (90-110Â°) versus females (110-120Â°).',\n    92â†’    procedureRefs: ['SUR-03', 'MIN-03'],\n    93â†’    genderRelevance: 'both',\n    94â†’  },\n    95â†’  {\n    96â†’    title: 'Mandibular Angle Augmentation in Asian Patients',\n    97â†’    authors: 'Lee YJ, Park KS',\n    98â†’    journal: 'Asian Journal of Beauty and Cosmetology',\n    99â†’    year: 2019,\n   100â†’    summary: 'Study on jaw angle enhancement specific to East Asian facial structure and aesthetic preferences.',\n   101â†’    procedureRefs: ['SUR-03', 'MIN-03'],\n   102â†’    genderRelevance: 'both',\n   103â†’    ethnicityRelevance: ['east_asian', 'south_asian'],\n   104â†’  },\n   105â†’  // Lip Research\n   106â†’  {\n   107â†’    title: 'Ideal Lip Proportions Across Ethnicities',\n   108â†’    authors: 'Farkas LG, Katic MJ',\n   109â†’    journal: 'Aesthetic Surgery Journal',\n   110â†’    year: 2003,\n   111â†’    summary: 'Anthropometric study establishing ethnic-specific ideal lip ratios and proportions.',\n   112â†’    procedureRefs: ['MIN-01', 'FND-01'],\n   113â†’    genderRelevance: 'both',\n   114â†’    ethnicityRelevance: ['white', 'black', 'east_asian', 'hispanic'],\n   115â†’  },\n   116â†’  {\n   117â†’    title: 'Lip Enhancement in African American Patients',\n   118â†’    authors: 'Mack WP',\n   119â†’    journal: 'Facial Plastic Surgery Clinics',\n   120â†’    year: 2014,\n   121â†’    summary: 'Guidelines for maintaining ethnic characteristics while enhancing lip aesthetics.',\n   122â†’    procedureRefs: ['MIN-01'],\n   123â†’    genderRelevance: 'both',\n   124â†’    ethnicityRelevance: ['black'],\n   125â†’  },\n   126â†’  // Eye/Canthal Research\n   127â†’  {\n   128â†’    title: 'Canthal Tilt and Facial Attractiveness',\n   129â†’    authors: 'Rhee SC, et al.',\n   130â†’    journal: 'Plastic and Reconstructive Surgery',\n   131â†’    year: 2017,\n   132â†’    summary: 'Demonstrates the importance of positive canthal tilt in perceived attractiveness across cultures.',\n   133â†’    procedureRefs: ['SUR-05', 'MIN-04'],\n   134â†’    genderRelevance: 'both',\n   135â†’  },\n   136â†’  {\n   137â†’    title: 'Asian Blepharoplasty and Canthopexy',\n   138â†’    authors: 'Chen WP',\n   139â†’    journal: 'Ophthalmic Plastic Surgery',\n   140â†’    year: 2016,\n   141â†’    summary: 'Specific techniques for Asian eyelid surgery that preserve ethnic identity while enhancing eye shape.',\n   142â†’    procedureRefs: ['SUR-05'],\n   143â†’    genderRelevance: 'both',\n   144â†’    ethnicityRelevance: ['east_asian', 'south_asian'],\n   145â†’  },\n   146â†’  // Midface/Cheek Research\n   147â†’  {\n   148â†’    title: 'Cheekbone Enhancement for Facial Harmony',\n   149â†’    authors: 'Mendelson B, Wong CH',\n   150â†’    journal: 'Clinics in Plastic Surgery',\n   151â†’    year: 2015,\n   152â†’    summary: 'Analysis of malar augmentation effects on overall facial harmony and perceived attractiveness.',\n   153â†’    procedureRefs: ['SUR-06', 'MIN-05'],\n   154â†’    genderRelevance: 'both',\n   155â†’  },\n   156â†’  {\n   157â†’    title: 'Midface Aesthetics in Middle Eastern Populations',\n   158â†’    authors: 'Rohrich RJ, et al.',\n   159â†’    journal: 'Aesthetic Surgery Journal',\n   160â†’    year: 2021,\n   161â†’    summary: 'Ethnic considerations for midface enhancement in Middle Eastern patients.',\n   162â†’    procedureRefs: ['SUR-06', 'MIN-05'],\n   163â†’    genderRelevance: 'both',\n   164â†’    ethnicityRelevance: ['middle_eastern'],\n   165â†’  },\n   166â†’  // Foundational/Non-Surgical Research\n   167â†’  {\n   168â†’    title: 'Mewing and Orthotropic Treatment',\n   169â†’    authors: 'Mew J, Mew M',\n   170â†’    journal: 'International Journal of Orthodontics',\n   171â†’    year: 2014,\n   172â†’    summary: 'Research on proper tongue posture and its effects on facial development and structure.',\n   173â†’    procedureRefs: ['FND-02', 'FND-03'],\n   174â†’    genderRelevance: 'both',\n   175â†’  },\n   176â†’  {\n   177â†’    title: 'Effects of Body Composition on Facial Aesthetics',\n   178â†’    authors: 'Morrison CS, et al.',\n   179â†’    journal: 'Aesthetic Surgery Journal',\n   180â†’    year: 2017,\n   181â†’    summary: 'Study on how body fat percentage affects facial definition and perceived attractiveness.',\n   182â†’    procedureRefs: ['FND-04', 'FND-05'],\n   183â†’    genderRelevance: 'both',\n   184â†’  },\n   185â†’  {\n   186â†’    title: 'Grooming and First Impressions',\n   187â†’    authors: 'Phelan C, Etcoff N',\n   188â†’    journal: 'Journal of Applied Social Psychology',\n   189â†’    year: 2011,\n   190â†’    summary: 'Research on how grooming affects perceived competence and attractiveness.',\n   191â†’    procedureRefs: ['FND-04', 'FND-05'],\n   192â†’    genderRelevance: 'both',\n   193â†’  },\n   194â†’  // Orthognathic Research\n   195â†’  {\n   196â†’    title: 'Bimaxillary Surgery Outcomes',\n   197â†’    authors: 'Rustemeyer J, et al.',\n   198â†’    journal: 'Journal of Cranio-Maxillofacial Surgery',\n   199â†’    year: 2019,\n   200â†’    summary: 'Long-term outcomes and patient satisfaction following double jaw surgery.',\n   201â†’    procedureRefs: ['SUR-04'],\n   202â†’    genderRelevance: 'both',\n   203â†’  },\n   204â†’  // General Attractiveness Research\n   205â†’  {\n   206â†’    title: 'Cross-Cultural Facial Attractiveness',\n   207â†’    authors: 'Perrett DI, et al.',\n   208â†’    journal: 'Nature',\n   209â†’    year: 1998,\n   210â†’    summary: 'Landmark study on universal vs. culture-specific aspects of facial attractiveness.',\n   211â†’    procedureRefs: ['SUR-01', 'SUR-02', 'SUR-03', 'SUR-04', 'SUR-05', 'SUR-06'],\n   212â†’    genderRelevance: 'both',\n   213â†’  },\n   214â†’  {\n   215â†’    title: 'Golden Ratios in Facial Beauty',\n   216â†’    authors: 'Marquardt SR',\n   217â†’    journal: 'International Journal of Cosmetic Surgery',\n   218â†’    year: 2002,\n   219â†’    summary: 'Analysis of mathematical proportions and their relationship to perceived facial beauty.',\n   220â†’    procedureRefs: ['SUR-01', 'SUR-02', 'SUR-03', 'SUR-04', 'SUR-05', 'SUR-06', 'MIN-01', 'MIN-02'],\n   221â†’    genderRelevance: 'both',\n   222â†’  },\n   223â†’];\n   224â†’\n   225â†’function getRelevantCitations(\n   226â†’  procedureRefId: string,\n   227â†’  gender?: Gender,\n   228â†’  ethnicity?: Ethnicity\n   229â†’): ResearchCitation[] {\n   230â†’  // Calculate relevance score for sorting\n   231â†’  function calculateRelevance(citation: ResearchCitation): number {\n   232â†’    let score = 0;\n   233â†’\n   234â†’    // Base score: procedure is in the list\n   235â†’    if (!citation.procedureRefs.includes(procedureRefId)) return -1;\n   236â†’\n   237â†’    // Procedure specificity: fewer refs = more specific to this procedure (+20 max)\n   238â†’    score += Math.max(0, 20 - (citation.procedureRefs.length * 3));\n   239â†’\n   240â†’    // Gender relevance scoring\n   241â†’    if (gender && citation.genderRelevance) {\n   242â†’      if (citation.genderRelevance === gender) {\n   243â†’        // Exact gender match - highest priority (+30)\n   244â†’        score += 30;\n   245â†’      } else if (citation.genderRelevance === 'both') {\n   246â†’        // General/both - neutral (+10)\n   247â†’        score += 10;\n   248â†’      } else {\n   249â†’        // Wrong gender - exclude\n   250â†’        return -1;\n   251â†’      }\n   252â†’    } else {\n   253â†’      // No gender specified or citation has no gender preference\n   254â†’      score += 10;\n   255â†’    }\n   256â†’\n   257â†’    // Ethnicity relevance scoring\n   258â†’    if (ethnicity && ethnicity !== 'other' && citation.ethnicityRelevance) {\n   259â†’      if (citation.ethnicityRelevance.includes(ethnicity)) {\n   260â†’        // Exact ethnicity match - high priority (+25)\n   261â†’        score += 25;\n   262â†’        // Bonus for ethnicity-specific studies (fewer ethnicities = more focused)\n   263â†’        score += Math.max(0, 15 - (citation.ethnicityRelevance.length * 2));\n   264â†’      } else {\n   265â†’        // Citation is ethnicity-specific but doesn't match user - lower priority\n   266â†’        // Still include unless very specific (1-2 ethnicities)\n   267â†’        if (citation.ethnicityRelevance.length <= 2) {\n   268â†’          return -1; // Too specific for different ethnicity\n   269â†’        }\n   270â†’        score += 5; // General enough to still be useful\n   271â†’      }\n   272â†’    } else {\n   273â†’      // No ethnicity filter or citation applies to all\n   274â†’      score += 10;\n   275â†’    }\n   276â†’\n   277â†’    // Recency bonus: newer studies slightly preferred\n   278â†’    const yearBonus = Math.max(0, (citation.year - 2000) * 0.5);\n   279â†’    score += yearBonus;\n   280â†’\n   281â†’    return score;\n   282â†’  }\n   283â†’\n   284â†’  // Filter, score, sort, and take top 3\n   285â†’  return RESEARCH_CITATIONS\n   286â†’    .map(citation => ({ citation, relevance: calculateRelevance(citation) }))\n   287â†’    .filter(item => item.relevance >= 0)\n   288â†’    .sort((a, b) => b.relevance - a.relevance)\n   289â†’    .slice(0, 3)\n   290â†’    .map(item => item.citation);\n   291â†’}\n   292â†’\n   293â†’interface TrackerState {\n   294â†’  notes: string;\n   295â†’  checklist: Array<{ id: string; text: string; completed: boolean }>;\n   296â†’}\n   297â†’\n   298â†’// ============================================\n   299â†’// PHASE BADGE (Dark Theme)\n   300â†’// ============================================\n   301â†’\n   302â†’function PhaseBadge({ phase }: { phase: string }) {\n   303â†’  const getPhaseConfig = () => {\n   304â†’    switch (phase) {\n   305â†’      case 'Foundational':\n   306â†’        return {\n   307â†’          bg: 'bg-emerald-500/20',\n   308â†’          text: 'text-emerald-400',\n   309â†’          border: 'border-emerald-500/30',\n   310â†’        };\n   311â†’      case 'Minimally Invasive':\n   312â†’        return {\n   313â†’          bg: 'bg-blue-500/20',\n   314â†’          text: 'text-blue-400',\n   315â†’          border: 'border-blue-500/30',\n   316â†’        };\n   317â†’      case 'Surgical':\n   318â†’        return {\n   319â†’          bg: 'bg-purple-500/20',\n   320â†’          text: 'text-purple-400',\n   321â†’          border: 'border-purple-500/30',\n   322â†’        };\n   323â†’      default:\n   324â†’        return {\n   325â†’          bg: 'bg-neutral-500/20',\n   326â†’          text: 'text-neutral-400',\n   327â†’          border: 'border-neutral-500/30',\n   328â†’        };\n   329â†’    }\n   330â†’  };\n   331â†’\n   332â†’  const config = getPhaseConfig();\n   333â†’\n   334â†’  return (\n   335â†’    <span\n   336â†’      className={`text-[9px] sm:text-[10px] uppercase tracking-wide font-semibold px-1.5 sm:px-2 py-0.5 rounded-md border flex-shrink-0 ${config.bg} ${config.text} ${config.border}`}\n   337â†’    >\n   338â†’      {phase === 'Minimally Invasive' ? 'Non-Invasive' : phase}\n   339â†’    </span>\n   340â†’  );\n   341â†’}\n   342â†’\n   343â†’// ============================================\n   344â†’// IMPACT BADGE\n   345â†’// ============================================\n   346â†’\n   347â†’function ImpactBadge({ impact, frontImpact, sideImpact }: { impact: number; frontImpact?: number; sideImpact?: number }) {\n   348â†’  const formattedImpact = impact >= 0 ? `+${impact.toFixed(2)}` : impact.toFixed(2);\n   349â†’\n   350â†’  return (\n   351â†’    <div className=\"flex items-center gap-1.5 sm:gap-2 flex-wrap\">\n   352â†’      <span className=\"flex items-center gap-1 text-[9px] sm:text-[10px] font-semibold text-emerald-400 bg-emerald-500/20 px-1.5 sm:px-2 py-0.5 rounded-md border border-emerald-500/30 flex-shrink-0\">\n   353â†’        <Sparkles className=\"w-2.5 h-2.5 sm:w-3 sm:h-3\" />\n   354â†’        {formattedImpact}\n   355â†’      </span>\n   356â†’      {(frontImpact !== undefined || sideImpact !== undefined) && (\n   357â†’        <span className=\"hidden sm:flex items-center gap-1.5 text-[9px] text-neutral-500 flex-shrink-0\">\n   358â†’          <span className={`font-medium ${(frontImpact || 0) > 0 ? 'text-emerald-400' : 'text-neutral-500'}`}>\n   359â†’            F {(frontImpact || 0) >= 0 ? '+' : ''}{(frontImpact || 0).toFixed(2)}\n   360â†’          </span>\n   361â†’          <span className=\"text-neutral-600\">|</span>\n   362â†’          <span className={`font-medium ${(sideImpact || 0) > 0 ? 'text-emerald-400' : 'text-neutral-500'}`}>\n   363â†’            S {(sideImpact || 0) >= 0 ? '+' : ''}{(sideImpact || 0).toFixed(2)}\n   364â†’          </span>\n   365â†’        </span>\n   366â†’      )}\n   367â†’    </div>\n   368â†’  );\n   369â†’}\n   370â†’\n   371â†’// ============================================\n   372â†’// IMPROVEMENT TAG\n   373â†’// ============================================\n   374â†’\n   375â†’function ImprovementTag({ text }: { text: string }) {\n   376â†’  return (\n   377â†’    <div className=\"inline-flex items-center gap-1 sm:gap-1.5 px-2 sm:px-2.5 py-0.5 sm:py-1 bg-neutral-800 border border-neutral-700 rounded-md text-[11px] sm:text-xs font-medium text-neutral-300 shadow-sm\">\n   378â†’      <CheckCircle className=\"w-2.5 h-2.5 sm:w-3 sm:h-3 text-emerald-400 flex-shrink-0\" />\n   379â†’      <span className=\"truncate\">{text}</span>\n   380â†’    </div>\n   381â†’  );\n   382â†’}\n   383â†’\n   384â†’// ============================================\n   385â†’// SECTION HEADER\n   386â†’// ============================================\n   387â†’\n   388â†’function SectionHeader({ icon: Icon, title }: { icon: React.ElementType; title: string }) {\n   389â†’  return (\n   390â†’    <h4 className=\"flex items-center gap-1.5 sm:gap-2 text-[11px] sm:text-xs font-semibold text-white uppercase tracking-wide mb-2 sm:mb-3\">\n   391â†’      <Icon className=\"w-3 h-3 sm:w-3.5 sm:h-3.5 text-neutral-400\" />\n   392â†’      {title}\n   393â†’    </h4>\n   394â†’  );\n   395â†’}\n   396â†’\n   397â†’// ============================================\n   398â†’// MY TRACKER SECTION\n   399â†’// ============================================\n   400â†’\n   401â†’function MyTracker({\n   402â†’  tracker,\n   403â†’  onNotesChange,\n   404â†’  onAddChecklistItem,\n   405â†’  onToggleChecklistItem,\n   406â†’  onRemoveChecklistItem\n   407â†’}: {\n   408â†’  tracker: TrackerState;\n   409â†’  onNotesChange: (notes: string) => void;\n   410â†’  onAddChecklistItem: () => void;\n   411â†’  onToggleChecklistItem: (id: string) => void;\n   412â†’  onRemoveChecklistItem: (id: string) => void;\n   413â†’}) {\n   414â†’  return (\n   415â†’    <div className=\"md:col-span-5 lg:col-span-4 p-4 sm:p-6 bg-neutral-900/50 md:bg-neutral-800/30 h-full\">\n   416â†’      <h4 className=\"flex items-center gap-1.5 sm:gap-2 text-[11px] sm:text-xs font-semibold text-white uppercase tracking-wide mb-3 sm:mb-4\">\n   417â†’        <BookOpen className=\"w-3 h-3 sm:w-3.5 sm:h-3.5 text-neutral-400\" />\n   418â†’        My Tracker\n   419â†’      </h4>\n   420â†’      <div className=\"space-y-3 sm:space-y-4\">\n   421â†’        {/* Personal Notes */}\n   422â†’        <div className=\"space-y-1 sm:space-y-1.5\">\n   423â†’          <label className=\"text-[11px] sm:text-xs font-medium text-neutral-400\">Personal Notes</label>\n   424â†’          <textarea\n   425â†’            value={tracker.notes}\n   426â†’            onChange={(e) => onNotesChange(e.target.value)}\n   427â†’            className=\"w-full text-xs sm:text-sm p-2.5 sm:p-3 border border-neutral-700 rounded-lg focus:ring-1 focus:ring-cyan-500 focus:border-cyan-500 bg-neutral-900 text-white min-h-[80px] sm:min-h-[100px] resize-none placeholder:text-neutral-600 shadow-sm transition-all\"\n   428â†’            placeholder=\"Track progress, questions, dates...\"\n   429â†’          />\n   430â†’        </div>\n   431â†’\n   432â†’        {/* Checklist */}\n   433â†’        <div className=\"space-y-1.5 sm:space-y-2 pt-1 sm:pt-2\">\n   434â†’          <label className=\"text-[11px] sm:text-xs font-medium text-neutral-400 flex justify-between items-center\">\n   435â†’            <span>Checklist</span>\n   436â†’            <button\n   437â†’              onClick={onAddChecklistItem}\n   438â†’              className=\"text-cyan-400 hover:text-cyan-300 text-[9px] sm:text-[10px] font-bold uppercase tracking-wide flex items-center gap-0.5 sm:gap-1 bg-cyan-500/20 px-1.5 sm:px-2 py-0.5 rounded-md border border-cyan-500/30 hover:bg-cyan-500/30 transition-colors\"\n   439â†’            >\n   440â†’              <Plus className=\"w-2.5 h-2.5 sm:w-3 sm:h-3\" />\n   441â†’              Add\n   442â†’            </button>\n   443â†’          </label>\n   444â†’          <div className=\"space-y-1.5 sm:space-y-2\">\n   445â†’            {tracker.checklist.length === 0 ? (\n   446â†’              <div className=\"text-[11px] sm:text-xs text-neutral-500 text-center py-3 sm:py-4 border border-dashed border-neutral-700 rounded-lg bg-neutral-900/50\">\n   447â†’                No tasks yet\n   448â†’              </div>\n   449â†’            ) : (\n   450â†’              tracker.checklist.map((item) => (\n   451â†’                <div\n   452â†’                  key={item.id}\n   453â†’                  className=\"flex items-center gap-2 p-2 bg-neutral-900 border border-neutral-700 rounded-lg\"\n   454â†’                >\n   455â†’                  <button\n   456â†’                    onClick={() => onToggleChecklistItem(item.id)}\n   457â†’                    className={`w-4 h-4 rounded border flex items-center justify-center flex-shrink-0 transition-colors ${\n   458â†’                      item.completed\n   459â†’                        ? 'bg-emerald-500 border-emerald-500'\n   460â†’                        : 'border-neutral-600 hover:border-neutral-500'\n   461â†’                    }`}\n   462â†’                  >\n   463â†’                    {item.completed && <CheckCircle className=\"w-3 h-3 text-black\" />}\n   464â†’                  </button>\n   465â†’                  <span className={`text-xs flex-1 ${item.completed ? 'text-neutral-500 line-through' : 'text-neutral-300'}`}>\n   466â†’                    {item.text}\n   467â†’                  </span>\n   468â†’                  <button\n   469â†’                    onClick={() => onRemoveChecklistItem(item.id)}\n   470â†’                    className=\"text-neutral-600 hover:text-red-400 transition-colors\"\n   471â†’                  >\n   472â†’                    <Trash2 className=\"w-3 h-3\" />\n   473â†’                  </button>\n   474â†’                </div>\n   475â†’              ))\n   476â†’            )}\n   477â†’          </div>\n   478â†’        </div>\n   479â†’      </div>\n   480â†’    </div>\n   481â†’  );\n   482â†’}\n   483â†’\n   484â†’// ============================================\n   485â†’// MAIN ENHANCED RECOMMENDATION CARD\n   486â†’// ============================================\n   487â†’\n   488â†’export function EnhancedRecommendationCard({\n   489â†’  recommendation,\n   490â†’  isExpanded = false,\n   491â†’  onToggle,\n   492â†’  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n   493â†’  rank,\n   494â†’  onMarkComplete,\n   495â†’  onRemove,\n   496â†’  isCompleted = false,\n   497â†’  gender,\n   498â†’  ethnicity,\n   499â†’}: EnhancedRecommendationCardProps) {\n   500â†’  // Tracker state (would be persisted in real app)\n   501â†’  const [tracker, setTracker] = useState<TrackerState>({\n   502â†’    notes: '',\n   503â†’    checklist: [],\n   504â†’  });\n   505â†’\n   506â†’  // Get relevant research citations based on procedure, gender, and ethnicity\n   507â†’  const citations = useMemo(() => {\n   508â†’    return getRelevantCitations(recommendation.ref_id, gender, ethnicity);\n   509â†’  }, [recommendation.ref_id, gender, ethnicity]);\n   510â†’\n   511â†’  const handleNotesChange = useCallback((notes: string) => {\n   512â†’    setTracker(prev => ({ ...prev, notes }));\n   513â†’  }, []);\n   514â†’\n   515â†’  const handleAddChecklistItem = useCallback(() => {\n   516â†’    const text = window.prompt('Enter task:');\n   517â†’    if (text) {\n   518â†’      setTracker(prev => ({\n   519â†’        ...prev,\n   520â†’        checklist: [...prev.checklist, { id: Date.now().toString(), text, completed: false }],\n   521â†’      }));\n   522â†’    }\n   523â†’  }, []);\n   524â†’\n   525â†’  const handleToggleChecklistItem = useCallback((id: string) => {\n   526â†’    setTracker(prev => ({\n   527â†’      ...prev,\n   528â†’      checklist: prev.checklist.map(item =>\n   529â†’        item.id === id ? { ...item, completed: !item.completed } : item\n   530â†’      ),\n   531â†’    }));\n   532â†’  }, []);\n   533â†’\n   534â†’  const handleRemoveChecklistItem = useCallback((id: string) => {\n   535â†’    setTracker(prev => ({\n   536â†’      ...prev,\n   537â†’      checklist: prev.checklist.filter(item => item.id !== id),\n   538â†’    }));\n   539â†’  }, []);\n   540â†’\n   541â†’  // Format cost\n   542â†’  const formatCost = () => {\n   543â†’    const { min, max, type } = recommendation.cost;\n   544â†’    const typeLabel = type === 'per_session' ? 'session' : type === 'per_month' ? '/mo' : '';\n   545â†’    if (min === max) {\n   546â†’      return `$${min.toLocaleString()}${typeLabel ? ` ${typeLabel}` : ''}`;\n   547â†’    }\n   548â†’    return `$${min.toLocaleString()} - $${max.toLocaleString()}${typeLabel ? ` ${typeLabel}` : ''}`;\n   549â†’  };\n   550â†’\n   551â†’  // Format timeline\n   552â†’  const formatTimeline = () => {\n   553â†’    const { full_results_weeks, full_results_weeks_max } = recommendation.timeline;\n   554â†’    if (full_results_weeks_max) {\n   555â†’      return `${full_results_weeks}-${full_results_weeks_max} weeks`;\n   556â†’    }\n   557â†’    if (full_results_weeks >= 52) {\n   558â†’      const months = Math.round(full_results_weeks / 4);\n   559â†’      return `${months} months`;\n   560â†’    }\n   561â†’    return `${full_results_weeks} weeks`;\n   562â†’  };\n   563â†’\n   564â†’  // Get effectiveness level\n   565â†’  const getEffectiveness = () => {\n   566â†’    if (recommendation.impact >= 0.7) return 'high';\n   567â†’    if (recommendation.impact >= 0.4) return 'moderate';\n   568â†’    return 'low';\n   569â†’  };\n   570â†’\n   571â†’  return (\n   572â†’    <motion.div\n   573â†’      layout\n   574â†’      className={`bg-neutral-900/80 rounded-xl border group relative transition-all duration-150 ${\n   575â†’        isExpanded\n   576â†’          ? 'border-cyan-500/40 ring-1 ring-cyan-500/20'\n   577â†’          : 'border-neutral-800 hover:border-neutral-700'\n   578â†’      } ${isCompleted ? 'opacity-60' : ''}`}\n   579â†’    >\n   580â†’      {/* Header - Clickable */}\n   581â†’      <div className=\"p-3.5 sm:p-5 cursor-pointer\" onClick={onToggle}>\n   582â†’        <div className=\"space-y-3 sm:space-y-4\">\n   583â†’          <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-3 sm:gap-4\">\n   584â†’            <div className=\"flex-1 min-w-0\">\n   585â†’              <div className=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 mb-2\">\n   586â†’                <h3 className=\"text-sm sm:text-base font-semibold transition-colors line-clamp-2 sm:truncate text-white\">\n   587â†’                  {recommendation.name}\n   588â†’                </h3>\n   589â†’                <div className=\"flex items-center gap-1.5 sm:gap-2 flex-wrap\">\n   590â†’                  <PhaseBadge phase={recommendation.phase} />\n   591â†’                  <ImpactBadge impact={recommendation.impact} />\n   592â†’                </div>\n   593â†’              </div>\n   594â†’              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed max-w-2xl line-clamp-2 sm:line-clamp-none\">\n   595â†’                {recommendation.description}\n   596â†’              </p>\n   597â†’            </div>\n   598â†’\n   599â†’            {/* Action buttons */}\n   600â†’            <div className=\"flex items-center gap-1.5 sm:ml-4 absolute right-3 top-3 sm:relative sm:right-auto sm:top-auto\">\n   601â†’              {onMarkComplete && (\n   602â†’                <button\n   603â†’                  onClick={(e) => {\n   604â†’                    e.stopPropagation();\n   605â†’                    onMarkComplete(recommendation.ref_id);\n   606â†’                  }}\n   607â†’                  className={`p-1.5 sm:p-1.5 rounded-md border transition-colors ${\n   608â†’                    isCompleted\n   609â†’                      ? 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30'\n   610â†’                      : 'bg-neutral-900 text-neutral-500 border-neutral-700 hover:border-neutral-500 hover:text-white'\n   611â†’                  }`}\n   612â†’                  title=\"Mark as complete\"\n   613â†’                >\n   614â†’                  <CheckCircle className=\"w-4 h-4\" />\n   615â†’                </button>\n   616â†’              )}\n   617â†’              {onRemove && (\n   618â†’                <button\n   619â†’                  onClick={(e) => {\n   620â†’                    e.stopPropagation();\n   621â†’                    onRemove(recommendation.ref_id);\n   622â†’                  }}\n   623â†’                  className=\"p-1.5 sm:p-1.5 rounded-md border transition-all duration-200 border-neutral-700 bg-neutral-900 text-neutral-500 hover:border-red-500/50 hover:text-red-400 hover:bg-red-500/10\"\n   624â†’                  title=\"Remove action\"\n   625â†’                >\n   626â†’                  <Trash2 className=\"w-4 h-4\" />\n   627â†’                </button>\n   628â†’              )}\n   629â†’            </div>\n   630â†’          </div>\n   631â†’\n   632â†’          {/* Quick stats row */}\n   633â†’          <div className=\"flex flex-wrap items-center justify-between gap-x-4 sm:gap-x-6 gap-y-2 text-[11px] sm:text-xs text-neutral-400\">\n   634â†’            <div className=\"flex flex-wrap items-center gap-x-3 sm:gap-x-6 gap-y-1.5\">\n   635â†’              <div className=\"flex items-center gap-1 sm:gap-1.5\" title=\"Estimated Cost\">\n   636â†’                <DollarSign className=\"w-3 h-3 sm:w-3.5 sm:h-3.5 text-neutral-500\" />\n   637â†’                <span className=\"font-medium text-neutral-300\">{formatCost()}</span>\n   638â†’              </div>\n   639â†’              {recommendation.timeline.full_results_weeks > 0 && (\n   640â†’                <div className=\"flex items-center gap-1 sm:gap-1.5\">\n   641â†’                  <Clock className=\"w-3 h-3 sm:w-3.5 sm:h-3.5 text-neutral-500\" />\n   642â†’                  <span className=\"font-medium text-neutral-300\">{formatTimeline()}</span>\n   643â†’                </div>\n   644â†’              )}\n   645â†’            </div>\n   646â†’            <button\n   647â†’              className=\"flex items-center gap-1 text-[11px] sm:text-xs font-medium transition-colors px-1.5 sm:px-2 py-1 rounded-md hover:bg-neutral-800 text-white\"\n   648â†’            >\n   649â†’              {isExpanded ? 'Less' : 'More'}\n   650â†’              <ChevronDown\n   651â†’                className={`w-3 h-3 sm:w-3.5 sm:h-3.5 transition-transform ${isExpanded ? 'rotate-180' : ''}`}\n   652â†’              />\n   653â†’            </button>\n   654â†’          </div>\n   655â†’        </div>\n   656â†’      </div>\n   657â†’\n   658â†’      {/* Expanded Content */}\n   659â†’      <AnimatePresence initial={false}>\n   660â†’        {isExpanded && (\n   661â†’          <motion.div\n   662â†’            initial={{ height: 0, opacity: 0 }}\n   663â†’            animate={{ height: 'auto', opacity: 1 }}\n   664â†’            exit={{ height: 0, opacity: 0 }}\n   665â†’            transition={{ duration: 0.3 }}\n   666â†’            className=\"overflow-hidden\"\n   667â†’          >\n   668â†’            <div className=\"border-t border-neutral-800 bg-neutral-900/50\">\n   669â†’              <div className=\"grid md:grid-cols-12 divide-y md:divide-y-0 md:divide-x divide-neutral-800\">\n   670â†’                {/* Main Content */}\n   671â†’                <div className=\"md:col-span-7 lg:col-span-8 p-4 sm:p-6 space-y-4 sm:space-y-6\">\n   672â†’                  {/* Improvements */}\n   673â†’                  <div>\n   674â†’                    <SectionHeader icon={Target} title=\"Improvements\" />\n   675â†’                    <div className=\"space-y-2 sm:space-y-3\">\n   676â†’                      <div className=\"flex flex-wrap gap-1.5 sm:gap-2\">\n   677â†’                        {recommendation.matchedFlaws.map((flaw, i) => (\n   678â†’                          <ImprovementTag key={i} text={flaw} />\n   679â†’                        ))}\n   680â†’                        {recommendation.matchedFlaws.length === 0 && recommendation.matchedRatios.slice(0, 3).map((ratio, i) => (\n   681â†’                          <ImprovementTag key={i} text={ratio} />\n   682â†’                        ))}\n   683â†’                      </div>\n   684â†’                      <div className=\"bg-neutral-800/50 p-2.5 sm:p-3.5 rounded-lg border border-neutral-700 text-sm shadow-sm\">\n   685â†’                        <div className=\"flex items-center gap-2 mb-1.5 sm:mb-2\">\n   686â†’                          <div className=\"text-[10px] sm:text-xs font-semibold text-neutral-500 uppercase\">Effectiveness</div>\n   687â†’                          <div className=\"h-1 w-1 rounded-full bg-neutral-600\" />\n   688â†’                          <div className=\"font-medium text-white capitalize text-xs sm:text-sm\">{getEffectiveness()}</div>\n   689â†’                        </div>\n   690â†’                      </div>\n   691â†’                    </div>\n   692â†’                  </div>\n   693â†’\n   694â†’                  {/* How It Helps */}\n   695â†’                  <div>\n   696â†’                    <SectionHeader icon={Info} title=\"How It Helps\" />\n   697â†’                    <div className=\"space-y-1.5 sm:space-y-2\">\n   698â†’                      <div className=\"bg-neutral-800/50 p-2.5 sm:p-3.5 rounded-lg border border-neutral-700 text-sm shadow-sm\">\n   699â†’                        <p className=\"text-neutral-300 text-[11px] sm:text-xs leading-relaxed\">\n   700â†’                          {recommendation.description}\n   701â†’                        </p>\n   702â†’                      </div>\n   703â†’                      {recommendation.ratios_impacted.length > 0 && (\n   704â†’                        <div className=\"bg-neutral-800/50 p-2.5 sm:p-3.5 rounded-lg border border-neutral-700 text-sm shadow-sm\">\n   705â†’                          <p className=\"text-neutral-300 text-[11px] sm:text-xs leading-relaxed\">\n   706â†’                            This treatment can {recommendation.ratios_impacted[0].direction === 'increase' ? 'increase' : 'improve'}{' '}\n   707â†’                            {recommendation.ratios_impacted.slice(0, 3).map(r => r.ratioName).join(', ')}.\n   708â†’                          </p>\n   709â†’                        </div>\n   710â†’                      )}\n   711â†’                    </div>\n   712â†’                  </div>\n   713â†’\n   714â†’                  {/* Logistics & Timeline */}\n   715â†’                  {recommendation.timeline.full_results_weeks > 0 && (\n   716â†’                    <div>\n   717â†’                      <SectionHeader icon={Clock} title=\"Logistics & Timeline\" />\n   718â†’                      <div className=\"grid grid-cols-2 gap-2 sm:gap-3\">\n   719â†’                        <div className=\"bg-neutral-800/50 p-2 sm:p-3 rounded-lg border border-neutral-700\">\n   720â†’                          <span className=\"text-[9px] sm:text-[10px] font-semibold text-neutral-500 uppercase block mb-0.5 sm:mb-1\">\n   721â†’                            Effect Starts\n   722â†’                          </span>\n   723â†’                          <span className=\"text-xs sm:text-sm font-medium text-white capitalize\">\n   724â†’                            {recommendation.timeline.effect_start}\n   725â†’                          </span>\n   726â†’                        </div>\n   727â†’                        <div className=\"bg-neutral-800/50 p-2 sm:p-3 rounded-lg border border-neutral-700\">\n   728â†’                          <span className=\"text-[9px] sm:text-[10px] font-semibold text-neutral-500 uppercase block mb-0.5 sm:mb-1\">\n   729â†’                            Full Results\n   730â†’                          </span>\n   731â†’                          <span className=\"text-xs sm:text-sm font-medium text-white\">\n   732â†’                            {formatTimeline()}\n   733â†’                          </span>\n   734â†’                        </div>\n   735â†’                      </div>\n   736â†’                    </div>\n   737â†’                  )}\n   738â†’\n   739â†’                  {/* Considerations */}\n   740â†’                  <div>\n   741â†’                    <SectionHeader icon={AlertTriangle} title=\"Considerations\" />\n   742â†’                    <div className=\"space-y-2 sm:space-y-3\">\n   743â†’                      {/* Prerequisites */}\n   744â†’                      {recommendation.warnings.length > 0 && (\n   745â†’                        <div className=\"bg-blue-500/10 p-2.5 sm:p-3.5 rounded-lg border border-blue-500/30 text-sm\">\n   746â†’                          <span className=\"font-semibold text-blue-400 block mb-0.5 sm:mb-1 text-xs sm:text-sm\">Prerequisites</span>\n   747â†’                          <p className=\"text-blue-300/80 text-[11px] sm:text-xs leading-relaxed\">\n   748â†’                            {recommendation.warnings[0]}\n   749â†’                          </p>\n   750â†’                        </div>\n   751â†’                      )}\n   752â†’\n   753â†’                      {/* Risks & Side Effects */}\n   754â†’                      {recommendation.risks_side_effects && (\n   755â†’                        <div className=\"bg-amber-500/10 p-2.5 sm:p-3.5 rounded-lg border border-amber-500/30 text-sm\">\n   756â†’                          <span className=\"font-semibold text-amber-400 block mb-0.5 sm:mb-1 text-xs sm:text-sm\">\n   757â†’                            Risks & Side Effects\n   758â†’                          </span>\n   759â†’                          <p className=\"text-amber-300/80 text-[11px] sm:text-xs leading-relaxed\">\n   760â†’                            {recommendation.risks_side_effects}\n   761â†’                          </p>\n   762â†’                        </div>\n   763â†’                      )}\n   764â†’                    </div>\n   765â†’                  </div>\n   766â†’\n   767â†’                  {/* Notes & Warnings */}\n   768â†’                  {recommendation.warnings.length > 1 && (\n   769â†’                    <div className=\"text-[11px] sm:text-xs text-neutral-400 bg-neutral-800/50 p-2.5 sm:p-3 rounded-lg border border-neutral-700 italic\">\n   770â†’                      {recommendation.warnings.slice(1).join(' ')}\n   771â†’                    </div>\n   772â†’                  )}\n   773â†’\n   774â†’                  {/* Research Citations */}\n   775â†’                  <div className=\"bg-cyan-500/10 p-3 sm:p-4 rounded-lg border border-cyan-500/30\">\n   776â†’                    <div className=\"flex items-center gap-2 mb-3\">\n   777â†’                      <BookOpen size={14} className=\"text-cyan-400\" />\n   778â†’                      <span className=\"font-semibold text-cyan-400 text-xs sm:text-sm\">Research & Evidence</span>\n   779â†’                      {ethnicity && ethnicity !== 'other' && (\n   780â†’                        <span className=\"text-[9px] px-1.5 py-0.5 bg-cyan-500/20 rounded text-cyan-300 capitalize\">\n   781â†’                          {ethnicity.replace('_', ' ')} focus\n   782â†’                        </span>\n   783â†’                      )}\n   784â†’                    </div>\n   785â†’                    {citations.length > 0 ? (\n   786â†’                      <div className=\"space-y-2.5\">\n   787â†’                        {citations.map((citation, idx) => (\n   788â†’                          <div key={idx} className=\"text-[11px] sm:text-xs bg-neutral-900/50 p-2.5 rounded-lg border border-neutral-700/50\">\n   789â†’                            <div className=\"flex items-start justify-between gap-2\">\n   790â†’                              <div className=\"flex-1\">\n   791â†’                                <div className=\"font-medium text-cyan-300 mb-0.5 line-clamp-2\">\n   792â†’                                  {citation.title}\n   793â†’                                </div>\n   794â†’                                <div className=\"text-neutral-500 text-[10px] mb-1\">\n   795â†’                                  {citation.authors} â€¢ {citation.journal} ({citation.year})\n   796â†’                                </div>\n   797â†’                                <div className=\"text-neutral-400 leading-relaxed\">\n   798â†’                                  {citation.summary}\n   799â†’                                </div>\n   800â†’                              </div>\n   801â†’                              {citation.doi && (\n   802â†’                                <a\n   803â†’                                  href={`https://doi.org/${citation.doi}`}\n   804â†’                                  target=\"_blank\"\n   805â†’                                  rel=\"noopener noreferrer\"\n   806â†’                                  className=\"flex-shrink-0 p-1 text-cyan-400 hover:text-cyan-300 transition-colors\"\n   807â†’                                  title=\"View full paper\"\n   808â†’                                >\n   809â†’                                  <ExternalLink size={12} />\n   810â†’                                </a>\n   811â†’                              )}\n   812â†’                            </div>\n   813â†’                          </div>\n   814â†’                        ))}\n   815â†’                      </div>\n   816â†’                    ) : (\n   817â†’                      <div className=\"text-[11px] sm:text-xs text-cyan-300/70\">\n   818â†’                        {recommendation.matchedFlaws.length > 0\n   819â†’                          ? 'Based on facial analysis and established aesthetic research. More specific citations coming soon.'\n   820â†’                          : 'No specific research citations available for this recommendation.'}\n   821â†’                      </div>\n   822â†’                    )}\n   823â†’                  </div>\n   824â†’                </div>\n   825â†’\n   826â†’                {/* My Tracker Sidebar */}\n   827â†’                <MyTracker\n   828â†’                  tracker={tracker}\n   829â†’                  onNotesChange={handleNotesChange}\n   830â†’                  onAddChecklistItem={handleAddChecklistItem}\n   831â†’                  onToggleChecklistItem={handleToggleChecklistItem}\n   832â†’                  onRemoveChecklistItem={handleRemoveChecklistItem}\n   833â†’                />\n   834â†’              </div>\n   835â†’            </div>\n   836â†’          </motion.div>\n   837â†’        )}\n   838â†’      </AnimatePresence>\n   839â†’    </motion.div>\n   840â†’  );\n   841â†’}\n   842â†’\n   843â†’export default EnhancedRecommendationCard;\n   844â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"58136dba-0f9d-4dae-bb0c-c2c8fca5a581","timestamp":"2025-12-26T13:42:03.084Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/cards/EnhancedRecommendationCard.tsx","content":"'use client';\n\nimport { useState, useCallback, useMemo } from 'react';\nimport { motion, AnimatePresence } from 'framer-motion';\nimport {\n  ChevronDown,\n  Clock,\n  DollarSign,\n  AlertTriangle,\n  Target,\n  Info,\n  BookOpen,\n  CheckCircle,\n  Trash2,\n  Plus,\n  Sparkles,\n  ExternalLink,\n} from 'lucide-react';\nimport { Recommendation } from '@/types/results';\nimport { Gender, Ethnicity } from '@/lib/harmony-scoring';\n\n// ============================================\n// TYPES\n// ============================================\n\ninterface EnhancedRecommendationCardProps {\n  recommendation: Recommendation;\n  isExpanded?: boolean;\n  onToggle?: () => void;\n  rank?: number;\n  onMarkComplete?: (id: string) => void;\n  onRemove?: (id: string) => void;\n  isCompleted?: boolean;\n  gender?: Gender;\n  ethnicity?: Ethnicity;\n}\n\n// ============================================\n// RESEARCH CITATIONS DATABASE\n// ============================================\n\ninterface ResearchCitation {\n  title: string;\n  authors: string;\n  journal: string;\n  year: number;\n  doi?: string;\n  summary: string;\n  procedureRefs: string[];  // Matches recommendation ref_id\n  genderRelevance?: 'male' | 'female' | 'both';\n  ethnicityRelevance?: Ethnicity[];\n}\n\nconst RESEARCH_CITATIONS: ResearchCitation[] = [\n  // Rhinoplasty Research\n  {\n    title: 'Ethnic Considerations in Rhinoplasty',\n    authors: 'Rohrich RJ, Bolden K',\n    journal: 'Plastic and Reconstructive Surgery',\n    year: 2010,\n    doi: '10.1097/PRS.0b013e3181c6b2b7',\n    summary: 'Discusses the importance of preserving ethnic identity while achieving aesthetic goals in rhinoplasty across different ethnicities.',\n    procedureRefs: ['SUR-02', 'MIN-04'],\n    genderRelevance: 'both',\n    ethnicityRelevance: ['black', 'east_asian', 'south_asian', 'middle_eastern', 'hispanic'],\n  },\n  {\n    title: 'The Male Rhinoplasty',\n    authors: 'Foda HM',\n    journal: 'Facial Plastic Surgery',\n    year: 2008,\n    summary: 'Examines unique considerations for male rhinoplasty including maintaining masculine features and avoiding feminization.',\n    procedureRefs: ['SUR-02', 'MIN-04'],\n    genderRelevance: 'male',\n  },\n  // Jaw/Chin Research\n  {\n    title: 'Sliding Genioplasty: A Systematic Review',\n    authors: 'Park JH, Tae-Hoon K',\n    journal: 'Journal of Oral and Maxillofacial Surgery',\n    year: 2018,\n    summary: 'Comprehensive analysis of chin advancement outcomes and patient satisfaction rates across demographics.',\n    procedureRefs: ['SUR-01', 'MIN-02'],\n    genderRelevance: 'both',\n  },\n  {\n    title: 'Gender Differences in Jaw Angle Aesthetics',\n    authors: 'Kim YH, Cho J',\n    journal: 'Aesthetic Plastic Surgery',\n    year: 2020,\n    summary: 'Research on ideal jaw angle parameters for males (90-110Â°) versus females (110-120Â°).',\n    procedureRefs: ['SUR-03', 'MIN-03'],\n    genderRelevance: 'both',\n  },\n  {\n    title: 'Mandibular Angle Augmentation in Asian Patients',\n    authors: 'Lee YJ, Park KS',\n    journal: 'Asian Journal of Beauty and Cosmetology',\n    year: 2019,\n    summary: 'Study on jaw angle enhancement specific to East Asian facial structure and aesthetic preferences.',\n    procedureRefs: ['SUR-03', 'MIN-03'],\n    genderRelevance: 'both',\n    ethnicityRelevance: ['east_asian', 'south_asian'],\n  },\n  // Lip Research\n  {\n    title: 'Ideal Lip Proportions Across Ethnicities',\n    authors: 'Farkas LG, Katic MJ',\n    journal: 'Aesthetic Surgery Journal',\n    year: 2003,\n    summary: 'Anthropometric study establishing ethnic-specific ideal lip ratios and proportions.',\n    procedureRefs: ['MIN-01', 'FND-01'],\n    genderRelevance: 'both',\n    ethnicityRelevance: ['white', 'black', 'east_asian', 'hispanic'],\n  },\n  {\n    title: 'Lip Enhancement in African American Patients',\n    authors: 'Mack WP',\n    journal: 'Facial Plastic Surgery Clinics',\n    year: 2014,\n    summary: 'Guidelines for maintaining ethnic characteristics while enhancing lip aesthetics.',\n    procedureRefs: ['MIN-01'],\n    genderRelevance: 'both',\n    ethnicityRelevance: ['black'],\n  },\n  // Eye/Canthal Research\n  {\n    title: 'Canthal Tilt and Facial Attractiveness',\n    authors: 'Rhee SC, et al.',\n    journal: 'Plastic and Reconstructive Surgery',\n    year: 2017,\n    summary: 'Demonstrates the importance of positive canthal tilt in perceived attractiveness across cultures.',\n    procedureRefs: ['SUR-05', 'MIN-04'],\n    genderRelevance: 'both',\n  },\n  {\n    title: 'Asian Blepharoplasty and Canthopexy',\n    authors: 'Chen WP',\n    journal: 'Ophthalmic Plastic Surgery',\n    year: 2016,\n    summary: 'Specific techniques for Asian eyelid surgery that preserve ethnic identity while enhancing eye shape.',\n    procedureRefs: ['SUR-05'],\n    genderRelevance: 'both',\n    ethnicityRelevance: ['east_asian', 'south_asian'],\n  },\n  // Midface/Cheek Research\n  {\n    title: 'Cheekbone Enhancement for Facial Harmony',\n    authors: 'Mendelson B, Wong CH',\n    journal: 'Clinics in Plastic Surgery',\n    year: 2015,\n    summary: 'Analysis of malar augmentation effects on overall facial harmony and perceived attractiveness.',\n    procedureRefs: ['SUR-06', 'MIN-05'],\n    genderRelevance: 'both',\n  },\n  {\n    title: 'Midface Aesthetics in Middle Eastern Populations',\n    authors: 'Rohrich RJ, et al.',\n    journal: 'Aesthetic Surgery Journal',\n    year: 2021,\n    summary: 'Ethnic considerations for midface enhancement in Middle Eastern patients.',\n    procedureRefs: ['SUR-06', 'MIN-05'],\n    genderRelevance: 'both',\n    ethnicityRelevance: ['middle_eastern'],\n  },\n  // Foundational/Non-Surgical Research\n  {\n    title: 'Mewing and Orthotropic Treatment',\n    authors: 'Mew J, Mew M',\n    journal: 'International Journal of Orthodontics',\n    year: 2014,\n    summary: 'Research on proper tongue posture and its effects on facial development and structure.',\n    procedureRefs: ['FND-02', 'FND-03'],\n    genderRelevance: 'both',\n  },\n  {\n    title: 'Effects of Body Composition on Facial Aesthetics',\n    authors: 'Morrison CS, et al.',\n    journal: 'Aesthetic Surgery Journal',\n    year: 2017,\n    summary: 'Study on how body fat percentage affects facial definition and perceived attractiveness.',\n    procedureRefs: ['FND-04', 'FND-05'],\n    genderRelevance: 'both',\n  },\n  {\n    title: 'Grooming and First Impressions',\n    authors: 'Phelan C, Etcoff N',\n    journal: 'Journal of Applied Social Psychology',\n    year: 2011,\n    summary: 'Research on how grooming affects perceived competence and attractiveness.',\n    procedureRefs: ['FND-04', 'FND-05'],\n    genderRelevance: 'both',\n  },\n  // Orthognathic Research\n  {\n    title: 'Bimaxillary Surgery Outcomes',\n    authors: 'Rustemeyer J, et al.',\n    journal: 'Journal of Cranio-Maxillofacial Surgery',\n    year: 2019,\n    summary: 'Long-term outcomes and patient satisfaction following double jaw surgery.',\n    procedureRefs: ['SUR-04'],\n    genderRelevance: 'both',\n  },\n  // General Attractiveness Research\n  {\n    title: 'Cross-Cultural Facial Attractiveness',\n    authors: 'Perrett DI, et al.',\n    journal: 'Nature',\n    year: 1998,\n    summary: 'Landmark study on universal vs. culture-specific aspects of facial attractiveness.',\n    procedureRefs: ['SUR-01', 'SUR-02', 'SUR-03', 'SUR-04', 'SUR-05', 'SUR-06'],\n    genderRelevance: 'both',\n  },\n  {\n    title: 'Golden Ratios in Facial Beauty',\n    authors: 'Marquardt SR',\n    journal: 'International Journal of Cosmetic Surgery',\n    year: 2002,\n    summary: 'Analysis of mathematical proportions and their relationship to perceived facial beauty.',\n    procedureRefs: ['SUR-01', 'SUR-02', 'SUR-03', 'SUR-04', 'SUR-05', 'SUR-06', 'MIN-01', 'MIN-02'],\n    genderRelevance: 'both',\n  },\n];\n\nfunction getRelevantCitations(\n  procedureRefId: string,\n  gender?: Gender,\n  ethnicity?: Ethnicity\n): ResearchCitation[] {\n  // Calculate relevance score for sorting\n  function calculateRelevance(citation: ResearchCitation): number {\n    let score = 0;\n\n    // Base score: procedure is in the list\n    if (!citation.procedureRefs.includes(procedureRefId)) return -1;\n\n    // Procedure specificity: fewer refs = more specific to this procedure (+20 max)\n    score += Math.max(0, 20 - (citation.procedureRefs.length * 3));\n\n    // Gender relevance scoring\n    if (gender && citation.genderRelevance) {\n      if (citation.genderRelevance === gender) {\n        // Exact gender match - highest priority (+30)\n        score += 30;\n      } else if (citation.genderRelevance === 'both') {\n        // General/both - neutral (+10)\n        score += 10;\n      } else {\n        // Wrong gender - exclude\n        return -1;\n      }\n    } else {\n      // No gender specified or citation has no gender preference\n      score += 10;\n    }\n\n    // Ethnicity relevance scoring\n    if (ethnicity && ethnicity !== 'other' && citation.ethnicityRelevance) {\n      if (citation.ethnicityRelevance.includes(ethnicity)) {\n        // Exact ethnicity match - high priority (+25)\n        score += 25;\n        // Bonus for ethnicity-specific studies (fewer ethnicities = more focused)\n        score += Math.max(0, 15 - (citation.ethnicityRelevance.length * 2));\n      } else {\n        // Citation is ethnicity-specific but doesn't match user - lower priority\n        // Still include unless very specific (1-2 ethnicities)\n        if (citation.ethnicityRelevance.length <= 2) {\n          return -1; // Too specific for different ethnicity\n        }\n        score += 5; // General enough to still be useful\n      }\n    } else {\n      // No ethnicity filter or citation applies to all\n      score += 10;\n    }\n\n    // Recency bonus: newer studies slightly preferred\n    const yearBonus = Math.max(0, (citation.year - 2000) * 0.5);\n    score += yearBonus;\n\n    return score;\n  }\n\n  // Filter, score, sort, and take top 3\n  return RESEARCH_CITATIONS\n    .map(citation => ({ citation, relevance: calculateRelevance(citation) }))\n    .filter(item => item.relevance >= 0)\n    .sort((a, b) => b.relevance - a.relevance)\n    .slice(0, 3)\n    .map(item => item.citation);\n}\n\ninterface TrackerState {\n  notes: string;\n  checklist: Array<{ id: string; text: string; completed: boolean }>;\n}\n\n// ============================================\n// PHASE BADGE (Dark Theme)\n// ============================================\n\nfunction PhaseBadge({ phase }: { phase: string }) {\n  const getPhaseConfig = () => {\n    switch (phase) {\n      case 'Foundational':\n        return {\n          bg: 'bg-emerald-500/20',\n          text: 'text-emerald-400',\n          border: 'border-emerald-500/30',\n        };\n      case 'Minimally Invasive':\n        return {\n          bg: 'bg-blue-500/20',\n          text: 'text-blue-400',\n          border: 'border-blue-500/30',\n        };\n      case 'Surgical':\n        return {\n          bg: 'bg-purple-500/20',\n          text: 'text-purple-400',\n          border: 'border-purple-500/30',\n        };\n      default:\n        return {\n          bg: 'bg-neutral-500/20',\n          text: 'text-neutral-400',\n          border: 'border-neutral-500/30',\n        };\n    }\n  };\n\n  const config = getPhaseConfig();\n\n  return (\n    <span\n      className={`text-[9px] sm:text-[10px] uppercase tracking-wide font-semibold px-1.5 sm:px-2 py-0.5 rounded-md border flex-shrink-0 ${config.bg} ${config.text} ${config.border}`}\n    >\n      {phase === 'Minimally Invasive' ? 'Non-Invasive' : phase}\n    </span>\n  );\n}\n\n// ============================================\n// IMPACT BADGE\n// ============================================\n\nfunction ImpactBadge({ impact, frontImpact, sideImpact }: { impact: number; frontImpact?: number; sideImpact?: number }) {\n  const formattedImpact = impact >= 0 ? `+${impact.toFixed(2)}` : impact.toFixed(2);\n\n  return (\n    <div className=\"flex items-center gap-1.5 sm:gap-2 flex-wrap\">\n      <span className=\"flex items-center gap-1 text-[9px] sm:text-[10px] font-semibold text-emerald-400 bg-emerald-500/20 px-1.5 sm:px-2 py-0.5 rounded-md border border-emerald-500/30 flex-shrink-0\">\n        <Sparkles className=\"w-2.5 h-2.5 sm:w-3 sm:h-3\" />\n        {formattedImpact}\n      </span>\n      {(frontImpact !== undefined || sideImpact !== undefined) && (\n        <span className=\"hidden sm:flex items-center gap-1.5 text-[9px] text-neutral-500 flex-shrink-0\">\n          <span className={`font-medium ${(frontImpact || 0) > 0 ? 'text-emerald-400' : 'text-neutral-500'}`}>\n            F {(frontImpact || 0) >= 0 ? '+' : ''}{(frontImpact || 0).toFixed(2)}\n          </span>\n          <span className=\"text-neutral-600\">|</span>\n          <span className={`font-medium ${(sideImpact || 0) > 0 ? 'text-emerald-400' : 'text-neutral-500'}`}>\n            S {(sideImpact || 0) >= 0 ? '+' : ''}{(sideImpact || 0).toFixed(2)}\n          </span>\n        </span>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// IMPROVEMENT TAG\n// ============================================\n\nfunction ImprovementTag({ text }: { text: string }) {\n  return (\n    <div className=\"inline-flex items-center gap-1 sm:gap-1.5 px-2 sm:px-2.5 py-0.5 sm:py-1 bg-neutral-800 border border-neutral-700 rounded-md text-[11px] sm:text-xs font-medium text-neutral-300 shadow-sm\">\n      <CheckCircle className=\"w-2.5 h-2.5 sm:w-3 sm:h-3 text-emerald-400 flex-shrink-0\" />\n      <span className=\"truncate\">{text}</span>\n    </div>\n  );\n}\n\n// ============================================\n// SECTION HEADER\n// ============================================\n\nfunction SectionHeader({ icon: Icon, title }: { icon: React.ElementType; title: string }) {\n  return (\n    <h4 className=\"flex items-center gap-1.5 sm:gap-2 text-[11px] sm:text-xs font-semibold text-white uppercase tracking-wide mb-2 sm:mb-3\">\n      <Icon className=\"w-3 h-3 sm:w-3.5 sm:h-3.5 text-neutral-400\" />\n      {title}\n    </h4>\n  );\n}\n\n// ============================================\n// MY TRACKER SECTION\n// ============================================\n\nfunction MyTracker({\n  tracker,\n  onNotesChange,\n  onAddChecklistItem,\n  onToggleChecklistItem,\n  onRemoveChecklistItem\n}: {\n  tracker: TrackerState;\n  onNotesChange: (notes: string) => void;\n  onAddChecklistItem: () => void;\n  onToggleChecklistItem: (id: string) => void;\n  onRemoveChecklistItem: (id: string) => void;\n}) {\n  return (\n    <div className=\"md:col-span-5 lg:col-span-4 p-4 sm:p-6 bg-neutral-900/50 md:bg-neutral-800/30 h-full\">\n      <h4 className=\"flex items-center gap-1.5 sm:gap-2 text-[11px] sm:text-xs font-semibold text-white uppercase tracking-wide mb-3 sm:mb-4\">\n        <BookOpen className=\"w-3 h-3 sm:w-3.5 sm:h-3.5 text-neutral-400\" />\n        My Tracker\n      </h4>\n      <div className=\"space-y-3 sm:space-y-4\">\n        {/* Personal Notes */}\n        <div className=\"space-y-1 sm:space-y-1.5\">\n          <label className=\"text-[11px] sm:text-xs font-medium text-neutral-400\">Personal Notes</label>\n          <textarea\n            value={tracker.notes}\n            onChange={(e) => onNotesChange(e.target.value)}\n            className=\"w-full text-xs sm:text-sm p-2.5 sm:p-3 border border-neutral-700 rounded-lg focus:ring-1 focus:ring-cyan-500 focus:border-cyan-500 bg-neutral-900 text-white min-h-[80px] sm:min-h-[100px] resize-none placeholder:text-neutral-600 shadow-sm transition-all\"\n            placeholder=\"Track progress, questions, dates...\"\n          />\n        </div>\n\n        {/* Checklist */}\n        <div className=\"space-y-1.5 sm:space-y-2 pt-1 sm:pt-2\">\n          <label className=\"text-[11px] sm:text-xs font-medium text-neutral-400 flex justify-between items-center\">\n            <span>Checklist</span>\n            <button\n              onClick={onAddChecklistItem}\n              className=\"text-cyan-400 hover:text-cyan-300 text-[9px] sm:text-[10px] font-bold uppercase tracking-wide flex items-center gap-0.5 sm:gap-1 bg-cyan-500/20 px-1.5 sm:px-2 py-0.5 rounded-md border border-cyan-500/30 hover:bg-cyan-500/30 transition-colors\"\n            >\n              <Plus className=\"w-2.5 h-2.5 sm:w-3 sm:h-3\" />\n              Add\n            </button>\n          </label>\n          <div className=\"space-y-1.5 sm:space-y-2\">\n            {tracker.checklist.length === 0 ? (\n              <div className=\"text-[11px] sm:text-xs text-neutral-500 text-center py-3 sm:py-4 border border-dashed border-neutral-700 rounded-lg bg-neutral-900/50\">\n                No tasks yet\n              </div>\n            ) : (\n              tracker.checklist.map((item) => (\n                <div\n                  key={item.id}\n                  className=\"flex items-center gap-2 p-2 bg-neutral-900 border border-neutral-700 rounded-lg\"\n                >\n                  <button\n                    onClick={() => onToggleChecklistItem(item.id)}\n                    className={`w-4 h-4 rounded border flex items-center justify-center flex-shrink-0 transition-colors ${\n                      item.completed\n                        ? 'bg-emerald-500 border-emerald-500'\n                        : 'border-neutral-600 hover:border-neutral-500'\n                    }`}\n                  >\n                    {item.completed && <CheckCircle className=\"w-3 h-3 text-black\" />}\n                  </button>\n                  <span className={`text-xs flex-1 ${item.completed ? 'text-neutral-500 line-through' : 'text-neutral-300'}`}>\n                    {item.text}\n                  </span>\n                  <button\n                    onClick={() => onRemoveChecklistItem(item.id)}\n                    className=\"text-neutral-600 hover:text-red-400 transition-colors\"\n                  >\n                    <Trash2 className=\"w-3 h-3\" />\n                  </button>\n                </div>\n              ))\n            )}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// MAIN ENHANCED RECOMMENDATION CARD\n// ============================================\n\nexport function EnhancedRecommendationCard({\n  recommendation,\n  isExpanded = false,\n  onToggle,\n  // eslint-disable-next-line @typescript-eslint/no-unused-vars\n  rank,\n  onMarkComplete,\n  onRemove,\n  isCompleted = false,\n  gender,\n  ethnicity,\n}: EnhancedRecommendationCardProps) {\n  // Tracker state (would be persisted in real app)\n  const [tracker, setTracker] = useState<TrackerState>({\n    notes: '',\n    checklist: [],\n  });\n\n  // Get relevant research citations based on procedure, gender, and ethnicity\n  const citations = useMemo(() => {\n    return getRelevantCitations(recommendation.ref_id, gender, ethnicity);\n  }, [recommendation.ref_id, gender, ethnicity]);\n\n  const handleNotesChange = useCallback((notes: string) => {\n    setTracker(prev => ({ ...prev, notes }));\n  }, []);\n\n  const handleAddChecklistItem = useCallback(() => {\n    const text = window.prompt('Enter task:');\n    if (text) {\n      setTracker(prev => ({\n        ...prev,\n        checklist: [...prev.checklist, { id: Date.now().toString(), text, completed: false }],\n      }));\n    }\n  }, []);\n\n  const handleToggleChecklistItem = useCallback((id: string) => {\n    setTracker(prev => ({\n      ...prev,\n      checklist: prev.checklist.map(item =>\n        item.id === id ? { ...item, completed: !item.completed } : item\n      ),\n    }));\n  }, []);\n\n  const handleRemoveChecklistItem = useCallback((id: string) => {\n    setTracker(prev => ({\n      ...prev,\n      checklist: prev.checklist.filter(item => item.id !== id),\n    }));\n  }, []);\n\n  // Format cost\n  const formatCost = () => {\n    const { min, max, type } = recommendation.cost;\n    const typeLabel = type === 'per_session' ? 'session' : type === 'per_month' ? '/mo' : '';\n    if (min === max) {\n      return `$${min.toLocaleString()}${typeLabel ? ` ${typeLabel}` : ''}`;\n    }\n    return `$${min.toLocaleString()} - $${max.toLocaleString()}${typeLabel ? ` ${typeLabel}` : ''}`;\n  };\n\n  // Format timeline\n  const formatTimeline = () => {\n    const { full_results_weeks, full_results_weeks_max } = recommendation.timeline;\n    if (full_results_weeks_max) {\n      return `${full_results_weeks}-${full_results_weeks_max} weeks`;\n    }\n    if (full_results_weeks >= 52) {\n      const months = Math.round(full_results_weeks / 4);\n      return `${months} months`;\n    }\n    return `${full_results_weeks} weeks`;\n  };\n\n  // Get effectiveness level\n  const getEffectiveness = () => {\n    if (recommendation.impact >= 0.7) return 'high';\n    if (recommendation.impact >= 0.4) return 'moderate';\n    return 'low';\n  };\n\n  return (\n    <motion.div\n      layout\n      className={`bg-neutral-900/80 rounded-xl border group relative transition-all duration-150 ${\n        isExpanded\n          ? 'border-cyan-500/40 ring-1 ring-cyan-500/20'\n          : 'border-neutral-800 hover:border-neutral-700'\n      } ${isCompleted ? 'opacity-60' : ''}`}\n    >\n      {/* Header - Clickable */}\n      <div className=\"p-3.5 sm:p-5 cursor-pointer\" onClick={onToggle}>\n        <div className=\"space-y-3 sm:space-y-4\">\n          <div className=\"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-3 sm:gap-4\">\n            <div className=\"flex-1 min-w-0\">\n              <div className=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-3 mb-2\">\n                <h3 className=\"text-sm sm:text-base font-semibold transition-colors line-clamp-2 sm:truncate text-white\">\n                  {recommendation.name}\n                </h3>\n                <div className=\"flex items-center gap-1.5 sm:gap-2 flex-wrap\">\n                  <PhaseBadge phase={recommendation.phase} />\n                  <ImpactBadge impact={recommendation.impact} />\n                </div>\n              </div>\n              <p className=\"text-xs sm:text-sm text-neutral-400 leading-relaxed max-w-2xl line-clamp-2 sm:line-clamp-none\">\n                {recommendation.description}\n              </p>\n            </div>\n\n            {/* Action buttons */}\n            <div className=\"flex items-center gap-1.5 sm:ml-4 absolute right-3 top-3 sm:relative sm:right-auto sm:top-auto\">\n              {onMarkComplete && (\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    onMarkComplete(recommendation.ref_id);\n                  }}\n                  className={`p-1.5 sm:p-1.5 rounded-md border transition-colors ${\n                    isCompleted\n                      ? 'bg-emerald-500/20 text-emerald-400 border-emerald-500/30'\n                      : 'bg-neutral-900 text-neutral-500 border-neutral-700 hover:border-neutral-500 hover:text-white'\n                  }`}\n                  title=\"Mark as complete\"\n                >\n                  <CheckCircle className=\"w-4 h-4\" />\n                </button>\n              )}\n              {onRemove && (\n                <button\n                  onClick={(e) => {\n                    e.stopPropagation();\n                    onRemove(recommendation.ref_id);\n                  }}\n                  className=\"p-1.5 sm:p-1.5 rounded-md border transition-all duration-200 border-neutral-700 bg-neutral-900 text-neutral-500 hover:border-red-500/50 hover:text-red-400 hover:bg-red-500/10\"\n                  title=\"Remove action\"\n                >\n                  <Trash2 className=\"w-4 h-4\" />\n                </button>\n              )}\n            </div>\n          </div>\n\n          {/* Quick stats row */}\n          <div className=\"flex flex-wrap items-center justify-between gap-x-4 sm:gap-x-6 gap-y-2 text-[11px] sm:text-xs text-neutral-400\">\n            <div className=\"flex flex-wrap items-center gap-x-3 sm:gap-x-6 gap-y-1.5\">\n              <div className=\"flex items-center gap-1 sm:gap-1.5\" title=\"Estimated Cost\">\n                <DollarSign className=\"w-3 h-3 sm:w-3.5 sm:h-3.5 text-neutral-500\" />\n                <span className=\"font-medium text-neutral-300\">{formatCost()}</span>\n              </div>\n              {recommendation.timeline.full_results_weeks > 0 && (\n                <div className=\"flex items-center gap-1 sm:gap-1.5\">\n                  <Clock className=\"w-3 h-3 sm:w-3.5 sm:h-3.5 text-neutral-500\" />\n                  <span className=\"font-medium text-neutral-300\">{formatTimeline()}</span>\n                </div>\n              )}\n            </div>\n            <button\n              className=\"flex items-center gap-1 text-[11px] sm:text-xs font-medium transition-colors px-1.5 sm:px-2 py-1 rounded-md hover:bg-neutral-800 text-white\"\n            >\n              {isExpanded ? 'Less' : 'More'}\n              <ChevronDown\n                className={`w-3 h-3 sm:w-3.5 sm:h-3.5 transition-transform ${isExpanded ? 'rotate-180' : ''}`}\n              />\n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/* Expanded Content */}\n      <AnimatePresence initial={false}>\n        {isExpanded && (\n          <motion.div\n            initial={{ height: 0, opacity: 0 }}\n            animate={{ height: 'auto', opacity: 1 }}\n            exit={{ height: 0, opacity: 0 }}\n            transition={{ duration: 0.3 }}\n            className=\"overflow-hidden\"\n          >\n            <div className=\"border-t border-neutral-800 bg-neutral-900/50\">\n              <div className=\"grid md:grid-cols-12 divide-y md:divide-y-0 md:divide-x divide-neutral-800\">\n                {/* Main Content */}\n                <div className=\"md:col-span-7 lg:col-span-8 p-4 sm:p-6 space-y-4 sm:space-y-6\">\n                  {/* Improvements */}\n                  <div>\n                    <SectionHeader icon={Target} title=\"Improvements\" />\n                    <div className=\"space-y-2 sm:space-y-3\">\n                      <div className=\"flex flex-wrap gap-1.5 sm:gap-2\">\n                        {recommendation.matchedFlaws.map((flaw, i) => (\n                          <ImprovementTag key={i} text={flaw} />\n                        ))}\n                        {recommendation.matchedFlaws.length === 0 && recommendation.matchedRatios.slice(0, 3).map((ratio, i) => (\n                          <ImprovementTag key={i} text={ratio} />\n                        ))}\n                      </div>\n                      <div className=\"bg-neutral-800/50 p-2.5 sm:p-3.5 rounded-lg border border-neutral-700 text-sm shadow-sm\">\n                        <div className=\"flex items-center gap-2 mb-1.5 sm:mb-2\">\n                          <div className=\"text-[10px] sm:text-xs font-semibold text-neutral-500 uppercase\">Effectiveness</div>\n                          <div className=\"h-1 w-1 rounded-full bg-neutral-600\" />\n                          <div className=\"font-medium text-white capitalize text-xs sm:text-sm\">{getEffectiveness()}</div>\n                        </div>\n                      </div>\n                    </div>\n                  </div>\n\n                  {/* How It Helps */}\n                  <div>\n                    <SectionHeader icon={Info} title=\"How It Helps\" />\n                    <div className=\"space-y-1.5 sm:space-y-2\">\n                      <div className=\"bg-neutral-800/50 p-2.5 sm:p-3.5 rounded-lg border border-neutral-700 text-sm shadow-sm\">\n                        <p className=\"text-neutral-300 text-[11px] sm:text-xs leading-relaxed\">\n                          {recommendation.description}\n                        </p>\n                      </div>\n                      {recommendation.ratios_impacted.length > 0 && (\n                        <div className=\"bg-neutral-800/50 p-2.5 sm:p-3.5 rounded-lg border border-neutral-700 text-sm shadow-sm\">\n                          <p className=\"text-neutral-300 text-[11px] sm:text-xs leading-relaxed\">\n                            This treatment can {recommendation.ratios_impacted[0].direction === 'increase' ? 'increase' : 'improve'}{' '}\n                            {recommendation.ratios_impacted.slice(0, 3).map(r => r.ratioName).join(', ')}.\n                          </p>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Logistics & Timeline */}\n                  {recommendation.timeline.full_results_weeks > 0 && (\n                    <div>\n                      <SectionHeader icon={Clock} title=\"Logistics & Timeline\" />\n                      <div className=\"grid grid-cols-2 gap-2 sm:gap-3\">\n                        <div className=\"bg-neutral-800/50 p-2 sm:p-3 rounded-lg border border-neutral-700\">\n                          <span className=\"text-[9px] sm:text-[10px] font-semibold text-neutral-500 uppercase block mb-0.5 sm:mb-1\">\n                            Effect Starts\n                          </span>\n                          <span className=\"text-xs sm:text-sm font-medium text-white capitalize\">\n                            {recommendation.timeline.effect_start}\n                          </span>\n                        </div>\n                        <div className=\"bg-neutral-800/50 p-2 sm:p-3 rounded-lg border border-neutral-700\">\n                          <span className=\"text-[9px] sm:text-[10px] font-semibold text-neutral-500 uppercase block mb-0.5 sm:mb-1\">\n                            Full Results\n                          </span>\n                          <span className=\"text-xs sm:text-sm font-medium text-white\">\n                            {formatTimeline()}\n                          </span>\n                        </div>\n                      </div>\n                    </div>\n                  )}\n\n                  {/* Considerations */}\n                  <div>\n                    <SectionHeader icon={AlertTriangle} title=\"Considerations\" />\n                    <div className=\"space-y-2 sm:space-y-3\">\n                      {/* Prerequisites */}\n                      {recommendation.warnings.length > 0 && (\n                        <div className=\"bg-blue-500/10 p-2.5 sm:p-3.5 rounded-lg border border-blue-500/30 text-sm\">\n                          <span className=\"font-semibold text-blue-400 block mb-0.5 sm:mb-1 text-xs sm:text-sm\">Prerequisites</span>\n                          <p className=\"text-blue-300/80 text-[11px] sm:text-xs leading-relaxed\">\n                            {recommendation.warnings[0]}\n                          </p>\n                        </div>\n                      )}\n\n                      {/* Risks & Side Effects */}\n                      {recommendation.risks_side_effects && (\n                        <div className=\"bg-amber-500/10 p-2.5 sm:p-3.5 rounded-lg border border-amber-500/30 text-sm\">\n                          <span className=\"font-semibold text-amber-400 block mb-0.5 sm:mb-1 text-xs sm:text-sm\">\n                            Risks & Side Effects\n                          </span>\n                          <p className=\"text-amber-300/80 text-[11px] sm:text-xs leading-relaxed\">\n                            {recommendation.risks_side_effects}\n                          </p>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n\n                  {/* Notes & Warnings */}\n                  {recommendation.warnings.length > 1 && (\n                    <div className=\"text-[11px] sm:text-xs text-neutral-400 bg-neutral-800/50 p-2.5 sm:p-3 rounded-lg border border-neutral-700 italic\">\n                      {recommendation.warnings.slice(1).join(' ')}\n                    </div>\n                  )}\n\n                  {/* Research Citations */}\n                  <div className=\"bg-cyan-500/10 p-3 sm:p-4 rounded-lg border border-cyan-500/30\">\n                    <div className=\"flex items-center gap-2 mb-3\">\n                      <BookOpen size={14} className=\"text-cyan-400\" />\n                      <span className=\"font-semibold text-cyan-400 text-xs sm:text-sm\">Research & Evidence</span>\n                      {ethnicity && ethnicity !== 'other' && (\n                        <span className=\"text-[9px] px-1.5 py-0.5 bg-cyan-500/20 rounded text-cyan-300 capitalize\">\n                          {ethnicity.replace('_', ' ')} focus\n                        </span>\n                      )}\n                    </div>\n                    {citations.length > 0 ? (\n                      <div className=\"space-y-2.5\">\n                        {citations.map((citation, idx) => (\n                          <div key={idx} className=\"text-[11px] sm:text-xs bg-neutral-900/50 p-2.5 rounded-lg border border-neutral-700/50\">\n                            <div className=\"flex items-start justify-between gap-2\">\n                              <div className=\"flex-1\">\n                                <div className=\"font-medium text-cyan-300 mb-0.5 line-clamp-2\">\n                                  {citation.title}\n                                </div>\n                                <div className=\"text-neutral-500 text-[10px] mb-1\">\n                                  {citation.authors} â€¢ {citation.journal} ({citation.year})\n                                </div>\n                                <div className=\"text-neutral-400 leading-relaxed\">\n                                  {citation.summary}\n                                </div>\n                              </div>\n                              {citation.doi && (\n                                <a\n                                  href={`https://doi.org/${citation.doi}`}\n                                  target=\"_blank\"\n                                  rel=\"noopener noreferrer\"\n                                  className=\"flex-shrink-0 p-1 text-cyan-400 hover:text-cyan-300 transition-colors\"\n                                  title=\"View full paper\"\n                                >\n                                  <ExternalLink size={12} />\n                                </a>\n                              )}\n                            </div>\n                          </div>\n                        ))}\n                      </div>\n                    ) : (\n                      <div className=\"text-[11px] sm:text-xs text-cyan-300/70\">\n                        {recommendation.matchedFlaws.length > 0\n                          ? 'Based on facial analysis and established aesthetic research. More specific citations coming soon.'\n                          : 'No specific research citations available for this recommendation.'}\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* My Tracker Sidebar */}\n                <MyTracker\n                  tracker={tracker}\n                  onNotesChange={handleNotesChange}\n                  onAddChecklistItem={handleAddChecklistItem}\n                  onToggleChecklistItem={handleToggleChecklistItem}\n                  onRemoveChecklistItem={handleRemoveChecklistItem}\n                />\n              </div>\n            </div>\n          </motion.div>\n        )}\n      </AnimatePresence>\n    </motion.div>\n  );\n}\n\nexport default EnhancedRecommendationCard;\n","numLines":844,"startLine":1,"totalLines":844}}}
{"parentUuid":"58136dba-0f9d-4dae-bb0c-c2c8fca5a581","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01NMhbVkESCKmEZwrbdw8JRY","type":"tool_result","content":"Prompt is too long"}]},"uuid":"43ab94e5-1dc6-4b8b-97c7-e1f7253c2650","timestamp":"2025-12-26T13:42:04.506Z","toolUseResult":{"bytes":2916375,"code":200,"codeText":"OK","result":"Prompt is too long","durationMs":1622,"url":"https://nicelydone.club/n/pages"}}
{"parentUuid":"43ab94e5-1dc6-4b8b-97c7-e1f7253c2650","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_018bx5wTWkpTYtZrfyDSYPdD","type":"message","role":"assistant","content":[{"type":"text","text":"Now let me read the OverviewTab and the shared components to get the full picture, then I can compile the UX improvement report:"}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":21859,"cache_creation_input_tokens":31533,"cache_read_input_tokens":63784,"cache_creation":{"ephemeral_5m_input_tokens":31533,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVPtaeHvKWEUqzpNbh23","type":"assistant","uuid":"b41068fc-9992-460f-9c46-cbf2f1c2e604","timestamp":"2025-12-26T13:42:09.055Z"}
{"parentUuid":"b41068fc-9992-460f-9c46-cbf2f1c2e604","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_018bx5wTWkpTYtZrfyDSYPdD","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01PC8DPLKGh2H852f9CGuTyy","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/OverviewTab.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":21859,"cache_creation_input_tokens":31533,"cache_read_input_tokens":63784,"cache_creation":{"ephemeral_5m_input_tokens":31533,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVPtaeHvKWEUqzpNbh23","type":"assistant","uuid":"4c3c5b11-45a2-4ef4-b8c6-e3c6b91d3195","timestamp":"2025-12-26T13:42:09.915Z"}
{"parentUuid":"4c3c5b11-45a2-4ef4-b8c6-e3c6b91d3195","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_018bx5wTWkpTYtZrfyDSYPdD","type":"message","role":"assistant","content":[{"type":"tool_use","id":"toolu_01MAKWxof2Eex13siCGz2UfV","name":"Read","input":{"file_path":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/shared/index.tsx"}}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":21859,"cache_creation_input_tokens":31533,"cache_read_input_tokens":63784,"cache_creation":{"ephemeral_5m_input_tokens":31533,"ephemeral_1h_input_tokens":0},"output_tokens":4,"service_tier":"standard"}},"requestId":"req_011CWVPtaeHvKWEUqzpNbh23","type":"assistant","uuid":"d8f7571c-edc7-4d35-bd2b-50a21656be44","timestamp":"2025-12-26T13:42:11.644Z"}
{"parentUuid":"d8f7571c-edc7-4d35-bd2b-50a21656be44","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01MAKWxof2Eex13siCGz2UfV","type":"tool_result","content":"     1â†’'use client';\n     2â†’\n     3â†’import { motion } from 'framer-motion';\n     4â†’import { QualityTier, SeverityLevel } from '@/lib/harmony-scoring';\n     5â†’import { RecommendationPhase, getScoreColor, getQualityColor, getSeverityColor } from '@/types/results';\n     6â†’\n     7â†’// Re-export new components\n     8â†’export { AnimatedScore } from './AnimatedScore';\n     9â†’export { ShareButton } from './ShareButton';\n    10â†’export { ExportButton } from './ExportButton';\n    11â†’export { RankBadge } from './RankBadge';\n    12â†’\n    13â†’// ============================================\n    14â†’// QUALITY BADGE\n    15â†’// ============================================\n    16â†’\n    17â†’interface QualityBadgeProps {\n    18â†’  quality: QualityTier;\n    19â†’  size?: 'sm' | 'md' | 'lg';\n    20â†’}\n    21â†’\n    22â†’export function QualityBadge({ quality, size = 'md' }: QualityBadgeProps) {\n    23â†’  const color = getQualityColor(quality);\n    24â†’  const sizeClasses = {\n    25â†’    sm: 'px-1.5 py-0.5 text-[10px]',\n    26â†’    md: 'px-2 py-1 text-xs',\n    27â†’    lg: 'px-3 py-1.5 text-sm',\n    28â†’  };\n    29â†’\n    30â†’  const labels: Record<QualityTier, string> = {\n    31â†’    ideal: 'Ideal',\n    32â†’    excellent: 'Excellent',\n    33â†’    good: 'Good',\n    34â†’    below_average: 'Below Avg',\n    35â†’  };\n    36â†’\n    37â†’  return (\n    38â†’    <span\n    39â†’      className={`inline-flex items-center font-medium rounded-full border ${sizeClasses[size]}`}\n    40â†’      style={{\n    41â†’        color,\n    42â†’        backgroundColor: `${color}15`,\n    43â†’        borderColor: `${color}30`,\n    44â†’      }}\n    45â†’    >\n    46â†’      {labels[quality]}\n    47â†’    </span>\n    48â†’  );\n    49â†’}\n    50â†’\n    51â†’// ============================================\n    52â†’// SEVERITY BADGE\n    53â†’// ============================================\n    54â†’\n    55â†’interface SeverityBadgeProps {\n    56â†’  severity: SeverityLevel;\n    57â†’  size?: 'sm' | 'md' | 'lg';\n    58â†’}\n    59â†’\n    60â†’export function SeverityBadge({ severity, size = 'md' }: SeverityBadgeProps) {\n    61â†’  const color = getSeverityColor(severity);\n    62â†’  const sizeClasses = {\n    63â†’    sm: 'px-1.5 py-0.5 text-[10px]',\n    64â†’    md: 'px-2 py-1 text-xs',\n    65â†’    lg: 'px-3 py-1.5 text-sm',\n    66â†’  };\n    67â†’\n    68â†’  const labels: Record<SeverityLevel, string> = {\n    69â†’    optimal: 'Optimal',\n    70â†’    minor: 'Minor',\n    71â†’    moderate: 'Moderate',\n    72â†’    major: 'Major',\n    73â†’    severe: 'Severe',\n    74â†’    extremely_severe: 'Critical',\n    75â†’  };\n    76â†’\n    77â†’  return (\n    78â†’    <span\n    79â†’      className={`inline-flex items-center font-medium rounded-full border ${sizeClasses[size]}`}\n    80â†’      style={{\n    81â†’        color,\n    82â†’        backgroundColor: `${color}15`,\n    83â†’        borderColor: `${color}30`,\n    84â†’      }}\n    85â†’    >\n    86â†’      {labels[severity]}\n    87â†’    </span>\n    88â†’  );\n    89â†’}\n    90â†’\n    91â†’// ============================================\n    92â†’// PHASE BADGE\n    93â†’// ============================================\n    94â†’\n    95â†’interface PhaseBadgeProps {\n    96â†’  phase: RecommendationPhase;\n    97â†’  size?: 'sm' | 'md' | 'lg';\n    98â†’}\n    99â†’\n   100â†’export function PhaseBadge({ phase, size = 'md' }: PhaseBadgeProps) {\n   101â†’  const configs: Record<RecommendationPhase, { color: string; bg: string; border: string }> = {\n   102â†’    'Surgical': { color: '#ef4444', bg: '#ef444420', border: '#ef444430' },\n   103â†’    'Minimally Invasive': { color: '#fbbf24', bg: '#fbbf2420', border: '#fbbf2430' },\n   104â†’    'Foundational': { color: '#22c55e', bg: '#22c55e20', border: '#22c55e30' },\n   105â†’  };\n   106â†’\n   107â†’  const config = configs[phase];\n   108â†’  const sizeClasses = {\n   109â†’    sm: 'px-1.5 py-0.5 text-[10px]',\n   110â†’    md: 'px-2 py-1 text-xs',\n   111â†’    lg: 'px-3 py-1.5 text-sm',\n   112â†’  };\n   113â†’\n   114â†’  return (\n   115â†’    <span\n   116â†’      className={`inline-flex items-center font-medium rounded-full border ${sizeClasses[size]}`}\n   117â†’      style={{\n   118â†’        color: config.color,\n   119â†’        backgroundColor: config.bg,\n   120â†’        borderColor: config.border,\n   121â†’      }}\n   122â†’    >\n   123â†’      {phase}\n   124â†’    </span>\n   125â†’  );\n   126â†’}\n   127â†’\n   128â†’// ============================================\n   129â†’// SCORE CIRCLE\n   130â†’// ============================================\n   131â†’\n   132â†’interface ScoreCircleProps {\n   133â†’  score: number | string;\n   134â†’  maxScore?: number;\n   135â†’  size?: 'sm' | 'md' | 'lg' | 'xl';\n   136â†’  showLabel?: boolean;\n   137â†’  animate?: boolean;\n   138â†’}\n   139â†’\n   140â†’export function ScoreCircle({\n   141â†’  score,\n   142â†’  maxScore = 10,\n   143â†’  size = 'md',\n   144â†’  showLabel = true,\n   145â†’  animate = true,\n   146â†’}: ScoreCircleProps) {\n   147â†’  const numericScore = typeof score === 'number' ? score : 0;\n   148â†’  const color = getScoreColor(numericScore);\n   149â†’  const percentage = (numericScore / maxScore) * 100;\n   150â†’\n   151â†’  const sizeConfigs = {\n   152â†’    sm: { size: 48, stroke: 4, fontSize: 'text-sm' },\n   153â†’    md: { size: 64, stroke: 5, fontSize: 'text-lg' },\n   154â†’    lg: { size: 96, stroke: 6, fontSize: 'text-2xl' },\n   155â†’    xl: { size: 140, stroke: 8, fontSize: 'text-4xl' },\n   156â†’  };\n   157â†’\n   158â†’  const config = sizeConfigs[size];\n   159â†’  const radius = (config.size - config.stroke) / 2;\n   160â†’  const circumference = radius * 2 * Math.PI;\n   161â†’  const offset = circumference - (percentage / 100) * circumference;\n   162â†’\n   163â†’  return (\n   164â†’    <div className=\"relative inline-flex items-center justify-center\">\n   165â†’      <svg\n   166â†’        width={config.size}\n   167â†’        height={config.size}\n   168â†’        className=\"transform -rotate-90\"\n   169â†’      >\n   170â†’        {/* Background circle */}\n   171â†’        <circle\n   172â†’          cx={config.size / 2}\n   173â†’          cy={config.size / 2}\n   174â†’          r={radius}\n   175â†’          fill=\"none\"\n   176â†’          stroke=\"currentColor\"\n   177â†’          strokeWidth={config.stroke}\n   178â†’          className=\"text-neutral-800\"\n   179â†’        />\n   180â†’        {/* Progress circle */}\n   181â†’        <motion.circle\n   182â†’          cx={config.size / 2}\n   183â†’          cy={config.size / 2}\n   184â†’          r={radius}\n   185â†’          fill=\"none\"\n   186â†’          stroke={color}\n   187â†’          strokeWidth={config.stroke}\n   188â†’          strokeLinecap=\"round\"\n   189â†’          strokeDasharray={circumference}\n   190â†’          initial={animate ? { strokeDashoffset: circumference } : { strokeDashoffset: offset }}\n   191â†’          animate={{ strokeDashoffset: offset }}\n   192â†’          transition={{ duration: 1, ease: 'easeOut' }}\n   193â†’        />\n   194â†’      </svg>\n   195â†’      {showLabel && (\n   196â†’        <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\n   197â†’          <motion.span\n   198â†’            className={`font-bold ${config.fontSize}`}\n   199â†’            style={{ color }}\n   200â†’            initial={animate ? { opacity: 0, scale: 0.5 } : { opacity: 1, scale: 1 }}\n   201â†’            animate={{ opacity: 1, scale: 1 }}\n   202â†’            transition={{ duration: 0.5, delay: 0.5 }}\n   203â†’          >\n   204â†’            {typeof score === 'number' ? score.toFixed(1) : score}\n   205â†’          </motion.span>\n   206â†’          {size !== 'sm' && (\n   207â†’            <span className=\"text-xs text-neutral-500\">/ {maxScore}</span>\n   208â†’          )}\n   209â†’        </div>\n   210â†’      )}\n   211â†’    </div>\n   212â†’  );\n   213â†’}\n   214â†’\n   215â†’// ============================================\n   216â†’// SCORE BAR\n   217â†’// ============================================\n   218â†’\n   219â†’interface ScoreBarProps {\n   220â†’  score: number;\n   221â†’  maxScore?: number;\n   222â†’  height?: number;\n   223â†’  showValue?: boolean;\n   224â†’  animate?: boolean;\n   225â†’}\n   226â†’\n   227â†’export function ScoreBar({\n   228â†’  score,\n   229â†’  maxScore = 10,\n   230â†’  height = 8,\n   231â†’  showValue = false,\n   232â†’  animate = true,\n   233â†’}: ScoreBarProps) {\n   234â†’  const color = getScoreColor(score);\n   235â†’  const percentage = (score / maxScore) * 100;\n   236â†’\n   237â†’  return (\n   238â†’    <div className=\"w-full\">\n   239â†’      <div\n   240â†’        className=\"w-full bg-neutral-800 rounded-full overflow-hidden\"\n   241â†’        style={{ height }}\n   242â†’      >\n   243â†’        <motion.div\n   244â†’          className=\"h-full rounded-full\"\n   245â†’          style={{ backgroundColor: color }}\n   246â†’          initial={animate ? { width: 0 } : { width: `${percentage}%` }}\n   247â†’          animate={{ width: `${percentage}%` }}\n   248â†’          transition={{ duration: 0.8, ease: 'easeOut' }}\n   249â†’        />\n   250â†’      </div>\n   251â†’      {showValue && (\n   252â†’        <div className=\"flex justify-between mt-1\">\n   253â†’          <span className=\"text-xs text-neutral-500\">0</span>\n   254â†’          <span className=\"text-xs font-medium\" style={{ color }}>\n   255â†’            {score.toFixed(2)}\n   256â†’          </span>\n   257â†’          <span className=\"text-xs text-neutral-500\">{maxScore}</span>\n   258â†’        </div>\n   259â†’      )}\n   260â†’    </div>\n   261â†’  );\n   262â†’}\n   263â†’\n   264â†’// ============================================\n   265â†’// EXPANDABLE SECTION\n   266â†’// ============================================\n   267â†’\n   268â†’interface ExpandableSectionProps {\n   269â†’  isExpanded: boolean;\n   270â†’  children: React.ReactNode;\n   271â†’}\n   272â†’\n   273â†’export function ExpandableSection({ isExpanded, children }: ExpandableSectionProps) {\n   274â†’  return (\n   275â†’    <motion.div\n   276â†’      initial={false}\n   277â†’      animate={{\n   278â†’        height: isExpanded ? 'auto' : 0,\n   279â†’        opacity: isExpanded ? 1 : 0,\n   280â†’      }}\n   281â†’      transition={{ duration: 0.3, ease: 'easeInOut' }}\n   282â†’      className=\"overflow-hidden\"\n   283â†’    >\n   284â†’      {children}\n   285â†’    </motion.div>\n   286â†’  );\n   287â†’}\n   288â†’\n   289â†’// ============================================\n   290â†’// CATEGORY TAG\n   291â†’// ============================================\n   292â†’\n   293â†’interface CategoryTagProps {\n   294â†’  category: string;\n   295â†’  color?: string;\n   296â†’  size?: 'sm' | 'md';\n   297â†’}\n   298â†’\n   299â†’export function CategoryTag({ category, color, size = 'sm' }: CategoryTagProps) {\n   300â†’  const categoryColors: Record<string, string> = {\n   301â†’    'Midface/Face Shape': '#67e8f9',\n   302â†’    'Occlusion/Jaw Growth': '#a78bfa',\n   303â†’    'Jaw Shape': '#f97316',\n   304â†’    'Upper Third': '#84cc16',\n   305â†’    'Eyes': '#06b6d4',\n   306â†’    'Nose': '#fbbf24',\n   307â†’    'Lips': '#ec4899',\n   308â†’    'Chin': '#ef4444',\n   309â†’    'Neck': '#14b8a6',\n   310â†’  };\n   311â†’\n   312â†’  const tagColor = color || categoryColors[category] || '#6b7280';\n   313â†’  const sizeClasses = size === 'sm' ? 'px-1.5 py-0.5 text-[10px]' : 'px-2 py-1 text-xs';\n   314â†’\n   315â†’  return (\n   316â†’    <span\n   317â†’      className={`inline-flex items-center font-medium rounded ${sizeClasses}`}\n   318â†’      style={{\n   319â†’        color: tagColor,\n   320â†’        backgroundColor: `${tagColor}15`,\n   321â†’      }}\n   322â†’    >\n   323â†’      {category}\n   324â†’    </span>\n   325â†’  );\n   326â†’}\n   327â†’\n   328â†’// ============================================\n   329â†’// METRIC VALUE DISPLAY\n   330â†’// ============================================\n   331â†’\n   332â†’interface MetricValueProps {\n   333â†’  value: number;\n   334â†’  unit: 'x' | 'mm' | '%' | 'Â°';\n   335â†’  size?: 'sm' | 'md' | 'lg';\n   336â†’}\n   337â†’\n   338â†’export function MetricValue({ value, unit, size = 'md' }: MetricValueProps) {\n   339â†’  const sizeClasses = {\n   340â†’    sm: 'text-sm',\n   341â†’    md: 'text-lg',\n   342â†’    lg: 'text-2xl',\n   343â†’  };\n   344â†’\n   345â†’  const formatValue = () => {\n   346â†’    if (unit === '%') return value.toFixed(1);\n   347â†’    if (unit === 'Â°') return value.toFixed(1);\n   348â†’    return value.toFixed(2);\n   349â†’  };\n   350â†’\n   351â†’  const unitSymbol = unit === 'x' ? '' : unit;\n   352â†’\n   353â†’  return (\n   354â†’    <span className={`font-semibold text-white ${sizeClasses[size]}`}>\n   355â†’      {formatValue()}\n   356â†’      <span className=\"text-neutral-400 ml-0.5\">{unitSymbol}</span>\n   357â†’    </span>\n   358â†’  );\n   359â†’}\n   360â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"e555f751-b33f-44d1-a4f9-83334331e14e","timestamp":"2025-12-26T13:42:11.729Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/shared/index.tsx","content":"'use client';\n\nimport { motion } from 'framer-motion';\nimport { QualityTier, SeverityLevel } from '@/lib/harmony-scoring';\nimport { RecommendationPhase, getScoreColor, getQualityColor, getSeverityColor } from '@/types/results';\n\n// Re-export new components\nexport { AnimatedScore } from './AnimatedScore';\nexport { ShareButton } from './ShareButton';\nexport { ExportButton } from './ExportButton';\nexport { RankBadge } from './RankBadge';\n\n// ============================================\n// QUALITY BADGE\n// ============================================\n\ninterface QualityBadgeProps {\n  quality: QualityTier;\n  size?: 'sm' | 'md' | 'lg';\n}\n\nexport function QualityBadge({ quality, size = 'md' }: QualityBadgeProps) {\n  const color = getQualityColor(quality);\n  const sizeClasses = {\n    sm: 'px-1.5 py-0.5 text-[10px]',\n    md: 'px-2 py-1 text-xs',\n    lg: 'px-3 py-1.5 text-sm',\n  };\n\n  const labels: Record<QualityTier, string> = {\n    ideal: 'Ideal',\n    excellent: 'Excellent',\n    good: 'Good',\n    below_average: 'Below Avg',\n  };\n\n  return (\n    <span\n      className={`inline-flex items-center font-medium rounded-full border ${sizeClasses[size]}`}\n      style={{\n        color,\n        backgroundColor: `${color}15`,\n        borderColor: `${color}30`,\n      }}\n    >\n      {labels[quality]}\n    </span>\n  );\n}\n\n// ============================================\n// SEVERITY BADGE\n// ============================================\n\ninterface SeverityBadgeProps {\n  severity: SeverityLevel;\n  size?: 'sm' | 'md' | 'lg';\n}\n\nexport function SeverityBadge({ severity, size = 'md' }: SeverityBadgeProps) {\n  const color = getSeverityColor(severity);\n  const sizeClasses = {\n    sm: 'px-1.5 py-0.5 text-[10px]',\n    md: 'px-2 py-1 text-xs',\n    lg: 'px-3 py-1.5 text-sm',\n  };\n\n  const labels: Record<SeverityLevel, string> = {\n    optimal: 'Optimal',\n    minor: 'Minor',\n    moderate: 'Moderate',\n    major: 'Major',\n    severe: 'Severe',\n    extremely_severe: 'Critical',\n  };\n\n  return (\n    <span\n      className={`inline-flex items-center font-medium rounded-full border ${sizeClasses[size]}`}\n      style={{\n        color,\n        backgroundColor: `${color}15`,\n        borderColor: `${color}30`,\n      }}\n    >\n      {labels[severity]}\n    </span>\n  );\n}\n\n// ============================================\n// PHASE BADGE\n// ============================================\n\ninterface PhaseBadgeProps {\n  phase: RecommendationPhase;\n  size?: 'sm' | 'md' | 'lg';\n}\n\nexport function PhaseBadge({ phase, size = 'md' }: PhaseBadgeProps) {\n  const configs: Record<RecommendationPhase, { color: string; bg: string; border: string }> = {\n    'Surgical': { color: '#ef4444', bg: '#ef444420', border: '#ef444430' },\n    'Minimally Invasive': { color: '#fbbf24', bg: '#fbbf2420', border: '#fbbf2430' },\n    'Foundational': { color: '#22c55e', bg: '#22c55e20', border: '#22c55e30' },\n  };\n\n  const config = configs[phase];\n  const sizeClasses = {\n    sm: 'px-1.5 py-0.5 text-[10px]',\n    md: 'px-2 py-1 text-xs',\n    lg: 'px-3 py-1.5 text-sm',\n  };\n\n  return (\n    <span\n      className={`inline-flex items-center font-medium rounded-full border ${sizeClasses[size]}`}\n      style={{\n        color: config.color,\n        backgroundColor: config.bg,\n        borderColor: config.border,\n      }}\n    >\n      {phase}\n    </span>\n  );\n}\n\n// ============================================\n// SCORE CIRCLE\n// ============================================\n\ninterface ScoreCircleProps {\n  score: number | string;\n  maxScore?: number;\n  size?: 'sm' | 'md' | 'lg' | 'xl';\n  showLabel?: boolean;\n  animate?: boolean;\n}\n\nexport function ScoreCircle({\n  score,\n  maxScore = 10,\n  size = 'md',\n  showLabel = true,\n  animate = true,\n}: ScoreCircleProps) {\n  const numericScore = typeof score === 'number' ? score : 0;\n  const color = getScoreColor(numericScore);\n  const percentage = (numericScore / maxScore) * 100;\n\n  const sizeConfigs = {\n    sm: { size: 48, stroke: 4, fontSize: 'text-sm' },\n    md: { size: 64, stroke: 5, fontSize: 'text-lg' },\n    lg: { size: 96, stroke: 6, fontSize: 'text-2xl' },\n    xl: { size: 140, stroke: 8, fontSize: 'text-4xl' },\n  };\n\n  const config = sizeConfigs[size];\n  const radius = (config.size - config.stroke) / 2;\n  const circumference = radius * 2 * Math.PI;\n  const offset = circumference - (percentage / 100) * circumference;\n\n  return (\n    <div className=\"relative inline-flex items-center justify-center\">\n      <svg\n        width={config.size}\n        height={config.size}\n        className=\"transform -rotate-90\"\n      >\n        {/* Background circle */}\n        <circle\n          cx={config.size / 2}\n          cy={config.size / 2}\n          r={radius}\n          fill=\"none\"\n          stroke=\"currentColor\"\n          strokeWidth={config.stroke}\n          className=\"text-neutral-800\"\n        />\n        {/* Progress circle */}\n        <motion.circle\n          cx={config.size / 2}\n          cy={config.size / 2}\n          r={radius}\n          fill=\"none\"\n          stroke={color}\n          strokeWidth={config.stroke}\n          strokeLinecap=\"round\"\n          strokeDasharray={circumference}\n          initial={animate ? { strokeDashoffset: circumference } : { strokeDashoffset: offset }}\n          animate={{ strokeDashoffset: offset }}\n          transition={{ duration: 1, ease: 'easeOut' }}\n        />\n      </svg>\n      {showLabel && (\n        <div className=\"absolute inset-0 flex flex-col items-center justify-center\">\n          <motion.span\n            className={`font-bold ${config.fontSize}`}\n            style={{ color }}\n            initial={animate ? { opacity: 0, scale: 0.5 } : { opacity: 1, scale: 1 }}\n            animate={{ opacity: 1, scale: 1 }}\n            transition={{ duration: 0.5, delay: 0.5 }}\n          >\n            {typeof score === 'number' ? score.toFixed(1) : score}\n          </motion.span>\n          {size !== 'sm' && (\n            <span className=\"text-xs text-neutral-500\">/ {maxScore}</span>\n          )}\n        </div>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// SCORE BAR\n// ============================================\n\ninterface ScoreBarProps {\n  score: number;\n  maxScore?: number;\n  height?: number;\n  showValue?: boolean;\n  animate?: boolean;\n}\n\nexport function ScoreBar({\n  score,\n  maxScore = 10,\n  height = 8,\n  showValue = false,\n  animate = true,\n}: ScoreBarProps) {\n  const color = getScoreColor(score);\n  const percentage = (score / maxScore) * 100;\n\n  return (\n    <div className=\"w-full\">\n      <div\n        className=\"w-full bg-neutral-800 rounded-full overflow-hidden\"\n        style={{ height }}\n      >\n        <motion.div\n          className=\"h-full rounded-full\"\n          style={{ backgroundColor: color }}\n          initial={animate ? { width: 0 } : { width: `${percentage}%` }}\n          animate={{ width: `${percentage}%` }}\n          transition={{ duration: 0.8, ease: 'easeOut' }}\n        />\n      </div>\n      {showValue && (\n        <div className=\"flex justify-between mt-1\">\n          <span className=\"text-xs text-neutral-500\">0</span>\n          <span className=\"text-xs font-medium\" style={{ color }}>\n            {score.toFixed(2)}\n          </span>\n          <span className=\"text-xs text-neutral-500\">{maxScore}</span>\n        </div>\n      )}\n    </div>\n  );\n}\n\n// ============================================\n// EXPANDABLE SECTION\n// ============================================\n\ninterface ExpandableSectionProps {\n  isExpanded: boolean;\n  children: React.ReactNode;\n}\n\nexport function ExpandableSection({ isExpanded, children }: ExpandableSectionProps) {\n  return (\n    <motion.div\n      initial={false}\n      animate={{\n        height: isExpanded ? 'auto' : 0,\n        opacity: isExpanded ? 1 : 0,\n      }}\n      transition={{ duration: 0.3, ease: 'easeInOut' }}\n      className=\"overflow-hidden\"\n    >\n      {children}\n    </motion.div>\n  );\n}\n\n// ============================================\n// CATEGORY TAG\n// ============================================\n\ninterface CategoryTagProps {\n  category: string;\n  color?: string;\n  size?: 'sm' | 'md';\n}\n\nexport function CategoryTag({ category, color, size = 'sm' }: CategoryTagProps) {\n  const categoryColors: Record<string, string> = {\n    'Midface/Face Shape': '#67e8f9',\n    'Occlusion/Jaw Growth': '#a78bfa',\n    'Jaw Shape': '#f97316',\n    'Upper Third': '#84cc16',\n    'Eyes': '#06b6d4',\n    'Nose': '#fbbf24',\n    'Lips': '#ec4899',\n    'Chin': '#ef4444',\n    'Neck': '#14b8a6',\n  };\n\n  const tagColor = color || categoryColors[category] || '#6b7280';\n  const sizeClasses = size === 'sm' ? 'px-1.5 py-0.5 text-[10px]' : 'px-2 py-1 text-xs';\n\n  return (\n    <span\n      className={`inline-flex items-center font-medium rounded ${sizeClasses}`}\n      style={{\n        color: tagColor,\n        backgroundColor: `${tagColor}15`,\n      }}\n    >\n      {category}\n    </span>\n  );\n}\n\n// ============================================\n// METRIC VALUE DISPLAY\n// ============================================\n\ninterface MetricValueProps {\n  value: number;\n  unit: 'x' | 'mm' | '%' | 'Â°';\n  size?: 'sm' | 'md' | 'lg';\n}\n\nexport function MetricValue({ value, unit, size = 'md' }: MetricValueProps) {\n  const sizeClasses = {\n    sm: 'text-sm',\n    md: 'text-lg',\n    lg: 'text-2xl',\n  };\n\n  const formatValue = () => {\n    if (unit === '%') return value.toFixed(1);\n    if (unit === 'Â°') return value.toFixed(1);\n    return value.toFixed(2);\n  };\n\n  const unitSymbol = unit === 'x' ? '' : unit;\n\n  return (\n    <span className={`font-semibold text-white ${sizeClasses[size]}`}>\n      {formatValue()}\n      <span className=\"text-neutral-400 ml-0.5\">{unitSymbol}</span>\n    </span>\n  );\n}\n","numLines":360,"startLine":1,"totalLines":360}}}
{"parentUuid":"e555f751-b33f-44d1-a4f9-83334331e14e","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","type":"user","message":{"role":"user","content":[{"tool_use_id":"toolu_01PC8DPLKGh2H852f9CGuTyy","type":"tool_result","content":"     1â†’'use client';\n     2â†’\n     3â†’import { motion } from 'framer-motion';\n     4â†’import Image from 'next/image';\n     5â†’import { User, ScanFace, Sparkles, ChevronRight, TrendingUp, TrendingDown, Lightbulb, Ruler } from 'lucide-react';\n     6â†’import { useResults } from '@/contexts/ResultsContext';\n     7â†’import { useHeightOptional } from '@/contexts/HeightContext';\n     8â†’import { TabContent } from '../ResultsLayout';\n     9â†’import { ScoreBar, AnimatedScore, ShareButton, ExportButton } from '../shared';\n    10â†’import { KeyStrengthsSection, AreasOfImprovementSection } from '../cards/KeyStrengthsFlaws';\n    11â†’import VisionInsightsCard from '../cards/VisionInsightsCard';\n    12â†’import { FacialRadarChart } from '../visualization/FacialRadarChart';\n    13â†’import { RatioDetailModal } from '../modals/RatioDetailModal';\n    14â†’import { getScoreColor, ResponsibleRatio, Ratio } from '@/types/results';\n    15â†’import { MetricScoreResult } from '@/lib/harmony-scoring';\n    16â†’import { RankedMetric, getWeightTierColor } from '@/lib/looksmax-scoring';\n    17â†’import { calculatePSL, getTierColor } from '@/lib/psl-calculator';\n    18â†’import { useState, useCallback, useMemo } from 'react';\n    19â†’import { usePricing } from '@/contexts/PricingContext';\n    20â†’\n    21â†’// ============================================\n    22â†’// SCORE SUMMARY CARDS\n    23â†’// ============================================\n    24â†’\n    25â†’interface ProfileScoreCardProps {\n    26â†’  title: string;\n    27â†’  score: number | string;\n    28â†’  icon: React.ReactNode;\n    29â†’  photo?: string;\n    30â†’  ratioCount: number;\n    31â†’  onClick?: () => void;\n    32â†’}\n    33â†’\n    34â†’function ProfileScoreCard({ title, score, icon, photo, ratioCount, onClick }: ProfileScoreCardProps) {\n    35â†’  const numericScore = typeof score === 'number' ? score : 0;\n    36â†’  const color = getScoreColor(numericScore);\n    37â†’\n    38â†’  return (\n    39â†’    <motion.button\n    40â†’      onClick={onClick}\n    41â†’      className=\"bg-neutral-900/80 border border-neutral-800 rounded-xl p-4 hover:border-neutral-700 transition-all text-left w-full\"\n    42â†’      whileHover={{ scale: 1.02 }}\n    43â†’      whileTap={{ scale: 0.98 }}\n    44â†’    >\n    45â†’      <div className=\"flex items-center gap-4\">\n    46â†’        {/* Photo or icon */}\n    47â†’        <div className=\"relative w-16 h-16 rounded-lg overflow-hidden bg-neutral-800 flex-shrink-0\">\n    48â†’          {photo ? (\n    49â†’            <Image\n    50â†’              src={photo}\n    51â†’              alt={title}\n    52â†’              width={64}\n    53â†’              height={64}\n    54â†’              className=\"object-cover\"\n    55â†’              unoptimized\n    56â†’            />\n    57â†’          ) : (\n    58â†’            <div className=\"w-full h-full flex items-center justify-center\">\n    59â†’              {icon}\n    60â†’            </div>\n    61â†’          )}\n    62â†’        </div>\n    63â†’\n    64â†’        {/* Info */}\n    65â†’        <div className=\"flex-1\">\n    66â†’          <h3 className=\"text-sm font-medium text-neutral-400 mb-1\">{title}</h3>\n    67â†’          <div className=\"flex items-baseline gap-2\">\n    68â†’            <span className=\"text-2xl font-bold\" style={{ color }}>\n    69â†’              {typeof score === 'number' ? score.toFixed(2) : score}\n    70â†’            </span>\n    71â†’            <span className=\"text-sm text-neutral-500\">/ 10</span>\n    72â†’          </div>\n    73â†’          <p className=\"text-xs text-neutral-500 mt-1\">{ratioCount} measurements</p>\n    74â†’        </div>\n    75â†’\n    76â†’        {/* Arrow */}\n    77â†’        <ChevronRight size={20} className=\"text-neutral-600\" />\n    78â†’      </div>\n    79â†’\n    80â†’      {/* Score bar */}\n    81â†’      <div className=\"mt-3\">\n    82â†’        <ScoreBar score={numericScore} height={6} />\n    83â†’      </div>\n    84â†’    </motion.button>\n    85â†’  );\n    86â†’}\n    87â†’\n    88â†’// ============================================\n    89â†’// PSL PREVIEW CARD\n    90â†’// ============================================\n    91â†’\n    92â†’interface PSLPreviewCardProps {\n    93â†’  score: number;\n    94â†’  tier: string;\n    95â†’  tierColor: string;\n    96â†’  hasHeight: boolean;\n    97â†’  onClick: () => void;\n    98â†’}\n    99â†’\n   100â†’function PSLPreviewCard({ score, tier, tierColor, hasHeight, onClick }: PSLPreviewCardProps) {\n   101â†’  if (!hasHeight) {\n   102â†’    // Prompt to enter height\n   103â†’    return (\n   104â†’      <motion.button\n   105â†’        onClick={onClick}\n   106â†’        className=\"bg-neutral-900/80 border border-dashed border-neutral-700 rounded-xl p-4 hover:border-cyan-500/50 transition-all text-left w-full\"\n   107â†’        whileHover={{ scale: 1.02 }}\n   108â†’        whileTap={{ scale: 0.98 }}\n   109â†’      >\n   110â†’        <div className=\"flex items-center gap-4\">\n   111â†’          <div className=\"w-14 h-14 rounded-lg bg-cyan-500/20 flex items-center justify-center flex-shrink-0\">\n   112â†’            <Ruler size={24} className=\"text-cyan-400\" />\n   113â†’          </div>\n   114â†’          <div className=\"flex-1\">\n   115â†’            <h3 className=\"text-sm font-medium text-white mb-1\">Get Your PSL Rating</h3>\n   116â†’            <p className=\"text-xs text-neutral-400\">Enter your height to calculate your Pretty Scale Level score</p>\n   117â†’          </div>\n   118â†’          <ChevronRight size={20} className=\"text-cyan-400\" />\n   119â†’        </div>\n   120â†’      </motion.button>\n   121â†’    );\n   122â†’  }\n   123â†’\n   124â†’  return (\n   125â†’    <motion.button\n   126â†’      onClick={onClick}\n   127â†’      className=\"bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-xl p-4 hover:border-cyan-500/30 transition-all text-left w-full\"\n   128â†’      whileHover={{ scale: 1.02 }}\n   129â†’      whileTap={{ scale: 0.98 }}\n   130â†’    >\n   131â†’      <div className=\"flex items-center gap-4\">\n   132â†’        {/* PSL Score */}\n   133â†’        <div className=\"w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0\" style={{ backgroundColor: `${tierColor}20` }}>\n   134â†’          <span className=\"text-2xl font-bold\" style={{ color: tierColor }}>\n   135â†’            {score.toFixed(1)}\n   136â†’          </span>\n   137â†’        </div>\n   138â†’\n   139â†’        {/* Info */}\n   140â†’        <div className=\"flex-1\">\n   141â†’          <div className=\"flex items-center gap-2 mb-1\">\n   142â†’            <h3 className=\"text-sm font-medium text-neutral-400\">PSL Rating</h3>\n   143â†’            <span className=\"text-xs px-2 py-0.5 rounded-full font-medium\" style={{ backgroundColor: `${tierColor}20`, color: tierColor }}>\n   144â†’              {tier}\n   145â†’            </span>\n   146â†’          </div>\n   147â†’          <p className=\"text-xs text-neutral-500\">Face (75%) + Height (20%) + Body (5%)</p>\n   148â†’        </div>\n   149â†’\n   150â†’        {/* Arrow */}\n   151â†’        <div className=\"flex flex-col items-end\">\n   152â†’          <span className=\"text-xs text-neutral-500 mb-1\">View Details</span>\n   153â†’          <ChevronRight size={20} className=\"text-neutral-600\" />\n   154â†’        </div>\n   155â†’      </div>\n   156â†’    </motion.button>\n   157â†’  );\n   158â†’}\n   159â†’\n   160â†’// ============================================\n   161â†’// QUICK INSIGHTS - TOP/BOTTOM METRICS WITH ADVICE\n   162â†’// ============================================\n   163â†’\n   164â†’interface MetricInsightCardProps {\n   165â†’  metric: RankedMetric;\n   166â†’  type: 'strength' | 'improvement';\n   167â†’  index: number;\n   168â†’}\n   169â†’\n   170â†’function MetricInsightCard({ metric, type, index }: MetricInsightCardProps) {\n   171â†’  const isStrength = type === 'strength';\n   172â†’  const color = getScoreColor(metric.score);\n   173â†’  const weightTierClass = getWeightTierColor(metric.weightTier);\n   174â†’\n   175â†’  return (\n   176â†’    <motion.div\n   177â†’      className={`bg-neutral-900/80 border rounded-xl p-4 ${isStrength ? 'border-green-500/30' : 'border-orange-500/30'\n   178â†’        }`}\n   179â†’      initial={{ opacity: 0, x: isStrength ? -20 : 20 }}\n   180â†’      animate={{ opacity: 1, x: 0 }}\n   181â†’      transition={{ delay: 0.1 * index }}\n   182â†’    >\n   183â†’      <div className=\"flex items-start gap-3\">\n   184â†’        <div className={`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${isStrength ? 'bg-green-500/20' : 'bg-orange-500/20'\n   185â†’          }`}>\n   186â†’          {isStrength ? (\n   187â†’            <TrendingUp size={16} className=\"text-green-400\" />\n   188â†’          ) : (\n   189â†’            <TrendingDown size={16} className=\"text-orange-400\" />\n   190â†’          )}\n   191â†’        </div>\n   192â†’\n   193â†’        <div className=\"flex-1 min-w-0\">\n   194â†’          <div className=\"flex items-center gap-2 mb-1\">\n   195â†’            <h4 className=\"font-medium text-white text-sm truncate\">{metric.name}</h4>\n   196â†’            <span className={`text-xs px-1.5 py-0.5 rounded border ${weightTierClass}`}>\n   197â†’              {metric.weightTier === 'high' ? '3x' : metric.weightTier === 'medium' ? '2x' : '1x'}\n   198â†’            </span>\n   199â†’          </div>\n   200â†’\n   201â†’          <div className=\"flex items-center gap-3 mb-2\">\n   202â†’            <span className=\"text-lg font-bold\" style={{ color }}>\n   203â†’              {typeof metric.score === 'number' ? metric.score.toFixed(1) : metric.score}\n   204â†’            </span>\n   205â†’            <span className=\"text-xs text-neutral-500\">\n   206â†’              Ideal: {typeof metric.idealMin === 'number' ? metric.idealMin.toFixed(1) : metric.idealMin} - {typeof metric.idealMax === 'number' ? metric.idealMax.toFixed(1) : metric.idealMax}\n   207â†’            </span>\n   208â†’          </div>\n   209â†’\n   210â†’          {/* Advice */}\n   211â†’          <div className=\"flex items-start gap-2 mt-2 p-2 bg-neutral-800/50 rounded-lg\">\n   212â†’            <Lightbulb size={14} className={isStrength ? 'text-green-400 mt-0.5' : 'text-orange-400 mt-0.5'} />\n   213â†’            <p className=\"text-xs text-neutral-300 leading-relaxed\">{metric.advice}</p>\n   214â†’          </div>\n   215â†’        </div>\n   216â†’      </div>\n   217â†’    </motion.div>\n   218â†’  );\n   219â†’}\n   220â†’\n   221â†’interface QuickInsightsSectionProps {\n   222â†’  topMetrics: RankedMetric[];\n   223â†’  bottomMetrics: RankedMetric[];\n   224â†’}\n   225â†’\n   226â†’function QuickInsightsSection({ topMetrics, bottomMetrics }: QuickInsightsSectionProps) {\n   227â†’  if (topMetrics.length === 0 && bottomMetrics.length === 0) return null;\n   228â†’\n   229â†’  return (\n   230â†’    <div className=\"mb-8\">\n   231â†’      <h3 className=\"text-lg font-semibold text-white mb-4 flex items-center gap-2\">\n   232â†’        <Lightbulb size={20} className=\"text-cyan-400\" />\n   233â†’        Quick Insights\n   234â†’      </h3>\n   235â†’\n   236â†’      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n   237â†’        {/* Top 3 Strengths */}\n   238â†’        <div>\n   239â†’          <h4 className=\"text-sm font-medium text-green-400 mb-3 flex items-center gap-2\">\n   240â†’            <TrendingUp size={14} />\n   241â†’            Top Strengths\n   242â†’          </h4>\n   243â†’          <div className=\"space-y-3\">\n   244â†’            {topMetrics.map((metric, index) => (\n   245â†’              <MetricInsightCard\n   246â†’                key={metric.metricId}\n   247â†’                metric={metric}\n   248â†’                type=\"strength\"\n   249â†’                index={index}\n   250â†’              />\n   251â†’            ))}\n   252â†’          </div>\n   253â†’        </div>\n   254â†’\n   255â†’        {/* Bottom 3 - Areas to Improve */}\n   256â†’        <div>\n   257â†’          <h4 className=\"text-sm font-medium text-orange-400 mb-3 flex items-center gap-2\">\n   258â†’            <TrendingDown size={14} />\n   259â†’            Areas to Improve\n   260â†’          </h4>\n   261â†’          <div className=\"space-y-3\">\n   262â†’            {bottomMetrics.map((metric, index) => (\n   263â†’              <MetricInsightCard\n   264â†’                key={metric.metricId}\n   265â†’                metric={metric}\n   266â†’                type=\"improvement\"\n   267â†’                index={index}\n   268â†’              />\n   269â†’            ))}\n   270â†’          </div>\n   271â†’        </div>\n   272â†’      </div>\n   273â†’    </div>\n   274â†’  );\n   275â†’}\n   276â†’\n   277â†’// ============================================\n   278â†’// HARMONY SCORE DISPLAY (with AnimatedScore and Radar Chart)\n   279â†’// ============================================\n   280â†’\n   281â†’function HarmonyScoreDisplay() {\n   282â†’  const { overallScore, frontScore, sideScore, harmonyPercentage, harmonyScoreResult, pslRating } = useResults();\n   283â†’  const [showRadar, setShowRadar] = useState(true);\n   284â†’\n   285â†’  // Get tier color based on PSL\n   286â†’  const getTierColor = (psl: number) => {\n   287â†’    // Handle invalid PSL values\n   288â†’    if (typeof psl !== 'number' || !Number.isFinite(psl)) {\n   289â†’      return 'text-orange-400';\n   290â†’    }\n   291â†’    if (psl >= 7.0) return 'text-purple-400';\n   292â†’    if (psl >= 6.0) return 'text-cyan-400';\n   293â†’    if (psl >= 5.0) return 'text-green-400';\n   294â†’    if (psl >= 4.0) return 'text-yellow-400';\n   295â†’    return 'text-orange-400';\n   296â†’  };\n   297â†’\n   298â†’  // Safe values for display with fallbacks\n   299â†’  const safePslRating = useMemo(() => ({\n   300â†’    psl: typeof pslRating?.psl === 'number' && Number.isFinite(pslRating.psl) ? pslRating.psl : 3.0,\n   301â†’    tier: pslRating?.tier || 'Unknown',\n   302â†’    percentile: typeof pslRating?.percentile === 'number' && Number.isFinite(pslRating.percentile) ? pslRating.percentile : 50,\n   303â†’    description: pslRating?.description || 'Analysis pending',\n   304â†’  }), [pslRating]);\n   305â†’\n   306â†’  const safeHarmonyPercentage = typeof harmonyPercentage === 'number' && Number.isFinite(harmonyPercentage)\n   307â†’    ? harmonyPercentage\n   308â†’    : 0;\n   309â†’\n   310â†’  const safeFrontScore = typeof frontScore === 'number' && Number.isFinite(frontScore) ? frontScore : 0;\n   311â†’  const safeSideScore = typeof sideScore === 'number' && Number.isFinite(sideScore) ? sideScore : 0;\n   312â†’  const safeOverallScore = typeof overallScore === 'number' && Number.isFinite(overallScore) ? overallScore : 0;\n   313â†’\n   314â†’  return (\n   315â†’    <motion.div\n   316â†’      className=\"bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-2xl p-6 md:p-8\"\n   317â†’      initial={{ opacity: 0, y: 20 }}\n   318â†’      animate={{ opacity: 1, y: 0 }}\n   319â†’      transition={{ duration: 0.5 }}\n   320â†’    >\n   321â†’      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n   322â†’        {/* Left: Score Display */}\n   323â†’        <div className=\"text-center flex flex-col justify-center\">\n   324â†’          <h2 className=\"text-lg font-medium text-neutral-400 mb-2\">Weighted Harmony Score</h2>\n   325â†’\n   326â†’          {/* PSL Rating Badge */}\n   327â†’          <motion.div\n   328â†’            className=\"flex justify-center mb-3\"\n   329â†’            initial={{ scale: 0 }}\n   330â†’            animate={{ scale: 1 }}\n   331â†’            transition={{ delay: 0.2, type: 'spring' }}\n   332â†’          >\n   333â†’            <div className=\"px-5 py-2 bg-gradient-to-r from-neutral-800 to-neutral-900 border border-neutral-700 rounded-xl\">\n   334â†’              <div className=\"flex items-center gap-3\">\n   335â†’                <div className=\"text-center\">\n   336â†’                  <span className={`text-3xl font-bold ${getTierColor(safePslRating.psl)}`}>\n   337â†’                    {safePslRating.psl.toFixed(1)}\n   338â†’                  </span>\n   339â†’                  <span className=\"text-sm text-neutral-500 ml-1\">PSL</span>\n   340â†’                </div>\n   341â†’                <div className=\"h-8 w-px bg-neutral-700\" />\n   342â†’                <div className=\"text-left\">\n   343â†’                  <p className={`text-sm font-semibold ${getTierColor(safePslRating.psl)}`}>\n   344â†’                    {safePslRating.tier}\n   345â†’                  </p>\n   346â†’                  <p className=\"text-xs text-neutral-500\">\n   347â†’                    Top {(100 - safePslRating.percentile).toFixed(1)}%\n   348â†’                  </p>\n   349â†’                </div>\n   350â†’              </div>\n   351â†’            </div>\n   352â†’          </motion.div>\n   353â†’\n   354â†’          {/* Harmony Percentage Badge */}\n   355â†’          <motion.div\n   356â†’            className=\"flex justify-center mb-4\"\n   357â†’            initial={{ scale: 0 }}\n   358â†’            animate={{ scale: 1 }}\n   359â†’            transition={{ delay: 0.3, type: 'spring' }}\n   360â†’          >\n   361â†’            <div className=\"px-4 py-1 bg-gradient-to-r from-purple-500/20 to-cyan-500/20 border border-purple-500/30 rounded-full\">\n   362â†’              <span className=\"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-cyan-400\">\n   363â†’                {safeHarmonyPercentage.toFixed(1)}%\n   364â†’              </span>\n   365â†’              <span className=\"text-xs text-neutral-500 ml-2\">Harmony</span>\n   366â†’            </div>\n   367â†’          </motion.div>\n   368â†’\n   369â†’          {/* Animated Score */}\n   370â†’          <div className=\"flex justify-center mb-4\">\n   371â†’            <AnimatedScore\n   372â†’              score={safeOverallScore}\n   373â†’              duration={2.5}\n   374â†’              delay={0.5}\n   375â†’              showConfetti={true}\n   376â†’              confettiThreshold={7.5}\n   377â†’            />\n   378â†’          </div>\n   379â†’\n   380â†’          {/* Profile Breakdowns */}\n   381â†’          <div className=\"flex justify-center gap-8 mb-4\">\n   382â†’            <div className=\"text-center\">\n   383â†’              <p className=\"text-xs text-neutral-500 mb-1\">Front Profile</p>\n   384â†’              <p className=\"text-xl font-bold\" style={{ color: getScoreColor(safeFrontScore) }}>\n   385â†’                {safeFrontScore.toFixed(2)}\n   386â†’              </p>\n   387â†’            </div>\n   388â†’            <div className=\"w-px bg-neutral-800\" />\n   389â†’            <div className=\"text-center\">\n   390â†’              <p className=\"text-xs text-neutral-500 mb-1\">Side Profile</p>\n   391â†’              <p className=\"text-xl font-bold\" style={{ color: getScoreColor(safeSideScore) }}>\n   392â†’                {safeSideScore.toFixed(2)}\n   393â†’              </p>\n   394â†’            </div>\n   395â†’          </div>\n   396â†’\n   397â†’          {/* Weight Distribution */}\n   398â†’          {harmonyScoreResult && (\n   399â†’            <div className=\"flex justify-center gap-3 mb-4 text-xs\">\n   400â†’              <span className=\"px-2 py-1 rounded bg-purple-500/20 text-purple-400 border border-purple-500/30\">\n   401â†’                High Impact: {harmonyScoreResult.weightDistribution.highImpact.count}\n   402â†’              </span>\n   403â†’              <span className=\"px-2 py-1 rounded bg-blue-500/20 text-blue-400 border border-blue-500/30\">\n   404â†’                Medium: {harmonyScoreResult.weightDistribution.mediumImpact.count}\n   405â†’              </span>\n   406â†’              <span className=\"px-2 py-1 rounded bg-gray-500/20 text-gray-400 border border-gray-500/30\">\n   407â†’                Standard: {harmonyScoreResult.weightDistribution.standard.count}\n   408â†’              </span>\n   409â†’            </div>\n   410â†’          )}\n   411â†’\n   412â†’          <p className=\"text-sm text-neutral-400 max-w-md mx-auto\">\n   413â†’            {safeHarmonyPercentage >= 80 ? 'Exceptional facial harmony. Your features are well-balanced and proportioned.' :\n   414â†’              safeHarmonyPercentage >= 60 ? 'Good facial harmony with some areas that could be optimized.' :\n   415â†’                safeHarmonyPercentage >= 40 ? 'Average facial harmony. Several areas have room for improvement.' :\n   416â†’                  'Below average facial harmony. Multiple areas could benefit from attention.'}\n   417â†’          </p>\n   418â†’        </div>\n   419â†’\n   420â†’        {/* Right: Radar Chart */}\n   421â†’        <div className=\"flex flex-col\">\n   422â†’          <div className=\"flex items-center justify-between mb-2\">\n   423â†’            <h3 className=\"text-sm font-medium text-neutral-400\">Category Breakdown</h3>\n   424â†’            <button\n   425â†’              onClick={() => setShowRadar(!showRadar)}\n   426â†’              className=\"text-xs text-cyan-400 hover:text-cyan-300 transition-colors\"\n   427â†’            >\n   428â†’              {showRadar ? 'Hide' : 'Show'}\n   429â†’            </button>\n   430â†’          </div>\n   431â†’          {showRadar && (\n   432â†’            <motion.div\n   433â†’              initial={{ opacity: 0, scale: 0.95 }}\n   434â†’              animate={{ opacity: 1, scale: 1 }}\n   435â†’              transition={{ duration: 0.5, delay: 0.3 }}\n   436â†’              className=\"flex-1 min-h-[280px]\"\n   437â†’            >\n   438â†’              <FacialRadarChart height={280} />\n   439â†’            </motion.div>\n   440â†’          )}\n   441â†’        </div>\n   442â†’      </div>\n   443â†’    </motion.div>\n   444â†’  );\n   445â†’}\n   446â†’\n   447â†’// ============================================\n   448â†’// OVERVIEW TAB\n   449â†’// ============================================\n   450â†’\n   451â†’export function OverviewTab() {\n   452â†’  const {\n   453â†’    overallScore,\n   454â†’    frontScore,\n   455â†’    sideScore,\n   456â†’    frontRatios,\n   457â†’    sideRatios,\n   458â†’    strengths,\n   459â†’    flaws,\n   460â†’    frontPhoto,\n   461â†’    sidePhoto,\n   462â†’    frontLandmarks,\n   463â†’    sideLandmarks,\n   464â†’    gender,\n   465â†’    ethnicity,\n   466â†’    setActiveTab,\n   467â†’    topMetrics,\n   468â†’    bottomMetrics,\n   469â†’    setSelectedVisualizationMetric,\n   470â†’    isUnlocked,\n   471â†’  } = useResults();\n   472â†’\n   473â†’  const { openPricingModal } = usePricing();\n   474â†’\n   475â†’  const heightContext = useHeightOptional();\n   476â†’  const [selectedRatio, setSelectedRatio] = useState<MetricScoreResult | null>(null);\n   477â†’  const [isModalOpen, setIsModalOpen] = useState(false);\n   478â†’\n   479â†’  // Calculate PSL for the preview card\n   480â†’  const pslPreviewData = useMemo(() => {\n   481â†’    const heightCm = heightContext?.heightCm;\n   482â†’    if (!heightCm || !overallScore) {\n   483â†’      return { hasHeight: false, score: 0, tier: 'Unknown', tierColor: '#6b7280' };\n   484â†’    }\n   485â†’\n   486â†’    const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n   487â†’    const pslResult = calculatePSL({\n   488â†’      faceScore: numericScore,\n   489â†’      heightCm,\n   490â†’      gender: gender || 'male',\n   491â†’    });\n   492â†’\n   493â†’    return {\n   494â†’      hasHeight: true,\n   495â†’      score: pslResult.score,\n   496â†’      tier: pslResult.tier,\n   497â†’      tierColor: getTierColor(pslResult.tier),\n   498â†’    };\n   499â†’  }, [heightContext?.heightCm, overallScore, gender]);\n   500â†’\n   501â†’  // All ratios combined for modal navigation\n   502â†’  const allRatios = useMemo(() => [...frontRatios, ...sideRatios], [frontRatios, sideRatios]);\n   503â†’\n   504â†’  // Current ratio index for navigation\n   505â†’  const currentRatioIndex = useMemo(() => {\n   506â†’    if (!selectedRatio) return -1;\n   507â†’    return allRatios.findIndex(r => r.id === selectedRatio.metricId);\n   508â†’  }, [selectedRatio, allRatios]);\n   509â†’\n   510â†’  // Convert Ratio to MetricScoreResult for modal\n   511â†’  const ratioToMetricResult = useCallback((ratio: Ratio): MetricScoreResult => {\n   512â†’    return {\n   513â†’      metricId: ratio.id,\n   514â†’      name: ratio.name,\n   515â†’      value: ratio.value,\n   516â†’      score: ratio.score,\n   517â†’      standardizedScore: ratio.standardizedScore,\n   518â†’      idealMin: ratio.idealMin,\n   519â†’      idealMax: ratio.idealMax,\n   520â†’      deviation: 0,\n   521â†’      deviationDirection: 'within',\n   522â†’      unit: ratio.unit === 'x' ? 'ratio' : ratio.unit === '%' ? 'percent' : ratio.unit === 'Â°' ? 'degrees' : ratio.unit,\n   523â†’      category: ratio.category,\n   524â†’      qualityTier: ratio.qualityLevel,\n   525â†’      severity: ratio.severity,\n   526â†’    } as MetricScoreResult;\n   527â†’  }, []);\n   528â†’\n   529â†’  // Handle ratio click from strengths/flaws sections\n   530â†’  const handleRatioClick = useCallback((ratio: ResponsibleRatio, categoryName: string) => {\n   531â†’    // Find the full ratio data from frontRatios or sideRatios\n   532â†’    const fullRatio = allRatios.find(\n   533â†’      (r) => r.name === ratio.ratioName || r.id === ratio.ratioId\n   534â†’    );\n   535â†’\n   536â†’    // Update the visualization first (shows on face image)\n   537â†’    if (fullRatio) {\n   538â†’      setSelectedVisualizationMetric(fullRatio.id);\n   539â†’      setSelectedRatio(ratioToMetricResult(fullRatio));\n   540â†’    } else {\n   541â†’      // Create a minimal MetricScoreResult from ResponsibleRatio\n   542â†’      setSelectedVisualizationMetric(ratio.ratioId);\n   543â†’      setSelectedRatio({\n   544â†’        metricId: ratio.ratioId,\n   545â†’        name: ratio.ratioName,\n   546â†’        value: ratio.value,\n   547â†’        score: ratio.score,\n   548â†’        standardizedScore: ratio.score,\n   549â†’        idealMin: ratio.idealMin,\n   550â†’        idealMax: ratio.idealMax,\n   551â†’        deviation: 0,\n   552â†’        deviationDirection: 'within',\n   553â†’        unit: (ratio.unit as 'ratio' | 'percent' | 'degrees' | 'mm' | 'none') || 'ratio',\n   554â†’        category: ratio.category || categoryName,\n   555â†’        qualityTier: (typeof ratio.score === 'number' ? ratio.score : 0) >= 8 ? 'ideal' : (typeof ratio.score === 'number' ? ratio.score : 0) >= 6 ? 'excellent' : (typeof ratio.score === 'number' ? ratio.score : 0) >= 4 ? 'good' : 'below_average',\n   556â†’        severity: 'optimal',\n   557â†’      } as MetricScoreResult);\n   558â†’    }\n   559â†’    setIsModalOpen(true);\n   560â†’  }, [allRatios, ratioToMetricResult, setSelectedVisualizationMetric]);\n   561â†’\n   562â†’  // Navigate to previous/next ratio in modal\n   563â†’  const handlePreviousRatio = useCallback(() => {\n   564â†’    if (currentRatioIndex > 0) {\n   565â†’      const prevRatio = allRatios[currentRatioIndex - 1];\n   566â†’      setSelectedRatio(ratioToMetricResult(prevRatio));\n   567â†’      setSelectedVisualizationMetric(prevRatio.id);\n   568â†’    }\n   569â†’  }, [currentRatioIndex, allRatios, ratioToMetricResult, setSelectedVisualizationMetric]);\n   570â†’\n   571â†’  const handleNextRatio = useCallback(() => {\n   572â†’    if (currentRatioIndex < allRatios.length - 1) {\n   573â†’      const nextRatio = allRatios[currentRatioIndex + 1];\n   574â†’      setSelectedRatio(ratioToMetricResult(nextRatio));\n   575â†’      setSelectedVisualizationMetric(nextRatio.id);\n   576â†’    }\n   577â†’  }, [currentRatioIndex, allRatios, ratioToMetricResult, setSelectedVisualizationMetric]);\n   578â†’\n   579â†’  // Determine if selected ratio is from side profile\n   580â†’  const isSideRatio = useMemo(() => {\n   581â†’    if (!selectedRatio) return false;\n   582â†’    const sideMetricIds = sideRatios.map(r => r.id);\n   583â†’    return sideMetricIds.includes(selectedRatio.metricId);\n   584â†’  }, [selectedRatio, sideRatios]);\n   585â†’\n   586â†’  // Memoized modal values (useMemo instead of useCallback for computed values)\n   587â†’  const modalPhoto = useMemo(() => {\n   588â†’    if (!selectedRatio) return frontPhoto;\n   589â†’    return isSideRatio ? (sidePhoto || frontPhoto) : frontPhoto;\n   590â†’  }, [selectedRatio, isSideRatio, frontPhoto, sidePhoto]);\n   591â†’\n   592â†’  const modalLandmarks = useMemo(() => {\n   593â†’    return isSideRatio ? (sideLandmarks || []) : (frontLandmarks || []);\n   594â†’  }, [isSideRatio, frontLandmarks, sideLandmarks]);\n   595â†’\n   596â†’  const modalProfileType = useMemo((): 'front' | 'side' => {\n   597â†’    return isSideRatio ? 'side' : 'front';\n   598â†’  }, [isSideRatio]);\n   599â†’\n   600â†’  return (\n   601â†’    <TabContent\n   602â†’      title=\"Overview\"\n   603â†’      subtitle=\"Your complete facial harmony analysis\"\n   604â†’      rightContent={\n   605â†’        <div className=\"flex items-center gap-2\">\n   606â†’          <ShareButton score={overallScore} frontScore={frontScore} sideScore={sideScore} />\n   607â†’          <ExportButton elementId=\"results-overview\" />\n   608â†’        </div>\n   609â†’      }\n   610â†’    >\n   611â†’      {/* Main content with ID for export */}\n   612â†’      <div id=\"results-overview\">\n   613â†’        {/* Harmony Score */}\n   614â†’        <div className=\"mb-8\">\n   615â†’          <HarmonyScoreDisplay />\n   616â†’        </div>\n   617â†’\n   618â†’        {/* Profile Scores */}\n   619â†’        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\n   620â†’          <ProfileScoreCard\n   621â†’            title=\"Front Profile\"\n   622â†’            score={frontScore}\n   623â†’            icon={<User size={24} className=\"text-neutral-600\" />}\n   624â†’            photo={frontPhoto}\n   625â†’            ratioCount={frontRatios.length}\n   626â†’            onClick={() => setActiveTab('front-ratios')}\n   627â†’          />\n   628â†’          <ProfileScoreCard\n   629â†’            title=\"Side Profile\"\n   630â†’            score={sideScore}\n   631â†’            icon={<ScanFace size={24} className=\"text-neutral-600\" />}\n   632â†’            photo={sidePhoto || undefined}\n   633â†’            ratioCount={sideRatios.length}\n   634â†’            onClick={() => setActiveTab('side-ratios')}\n   635â†’          />\n   636â†’        </div>\n   637â†’\n   638â†’        {/* PSL Preview Card */}\n   639â†’        <div className=\"mb-8\">\n   640â†’          <PSLPreviewCard\n   641â†’            score={pslPreviewData.score}\n   642â†’            tier={pslPreviewData.tier}\n   643â†’            tierColor={pslPreviewData.tierColor}\n   644â†’            hasHeight={pslPreviewData.hasHeight}\n   645â†’            onClick={() => setActiveTab('psl')}\n   646â†’          />\n   647â†’        </div>\n   648â†’\n   649â†’        {/* Quick Insights - Top/Bottom Metrics with Advice (from looksmax_engine.py) */}\n   650â†’        <QuickInsightsSection topMetrics={topMetrics} bottomMetrics={bottomMetrics} />\n   651â†’\n   652â†’        {/* AI Qualitative Insights Section */}\n   653â†’        <div className=\"mb-8\">\n   654â†’          <VisionInsightsCard />\n   655â†’        </div>\n   656â†’\n   657â†’        {/* Strengths & Flaws Grid - Harmony Style */}\n   658â†’        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\n   659â†’          {/* Key Strengths */}\n   660â†’          <KeyStrengthsSection\n   661â†’            strengths={strengths}\n   662â†’            onRatioClick={handleRatioClick}\n   663â†’            initialShowCount={3}\n   664â†’          />\n   665â†’\n   666â†’          {/* Areas of Improvement */}\n   667â†’          <AreasOfImprovementSection\n   668â†’            flaws={flaws}\n   669â†’            onRatioClick={handleRatioClick}\n   670â†’            initialShowCount={3}\n   671â†’          />\n   672â†’        </div>\n   673â†’\n   674â†’        {/* Call to Action */}\n   675â†’        <motion.div\n   676â†’          className=\"bg-gradient-to-r from-cyan-500/20 to-blue-600/20 border border-cyan-500/30 rounded-xl p-6 flex items-center justify-between\"\n   677â†’          initial={{ opacity: 0 }}\n   678â†’          animate={{ opacity: 1 }}\n   679â†’          transition={{ delay: 0.5 }}\n   680â†’        >\n   681â†’          <div className=\"flex items-center gap-4\">\n   682â†’            <div className=\"w-12 h-12 rounded-xl bg-cyan-500/20 flex items-center justify-center\">\n   683â†’              <Sparkles size={24} className=\"text-cyan-400\" />\n   684â†’            </div>\n   685â†’            <div>\n   686â†’              <h3 className=\"font-semibold text-white\">Unlock Your Potential</h3>\n   687â†’              <p className=\"text-sm text-neutral-400\">\n   688â†’                See personalized recommendations to improve your harmony score\n   689â†’              </p>\n   690â†’            </div>\n   691â†’          </div>\n   692â†’          <button\n   693â†’            onClick={() => {\n   694â†’              if (isUnlocked) {\n   695â†’                setActiveTab('plan');\n   696â†’              } else {\n   697â†’                openPricingModal('overview_cta');\n   698â†’              }\n   699â†’            }}\n   700â†’            className=\"px-4 py-2 bg-cyan-500 text-black font-medium rounded-lg hover:bg-cyan-400 transition-colors flex items-center gap-2\"\n   701â†’          >\n   702â†’            {isUnlocked ? 'View Plan' : 'Unlock Now'}\n   703â†’            <ChevronRight size={16} />\n   704â†’          </button>\n   705â†’        </motion.div>\n   706â†’      </div>{/* End of results-overview */}\n   707â†’\n   708â†’      {/* Ratio Detail Modal */}\n   709â†’      <RatioDetailModal\n   710â†’        isOpen={isModalOpen}\n   711â†’        onClose={() => setIsModalOpen(false)}\n   712â†’        ratio={selectedRatio}\n   713â†’        onPrevious={handlePreviousRatio}\n   714â†’        onNext={handleNextRatio}\n   715â†’        hasPrevious={currentRatioIndex > 0}\n   716â†’        hasNext={currentRatioIndex < allRatios.length - 1}\n   717â†’        facePhoto={modalPhoto}\n   718â†’        landmarks={modalLandmarks}\n   719â†’        allRatios={allRatios}\n   720â†’        profileType={modalProfileType}\n   721â†’        gender={gender}\n   722â†’        ethnicity={ethnicity}\n   723â†’      />\n   724â†’    </TabContent>\n   725â†’  );\n   726â†’}\n   727â†’\n\n<system-reminder>\nWhenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.\n</system-reminder>\n"}]},"uuid":"965f7684-850f-48b1-9222-a96bcc25f6b0","timestamp":"2025-12-26T13:42:11.872Z","toolUseResult":{"type":"text","file":{"filePath":"/Users/imorgado/LOOKSMAXX/looksmaxx-app/src/components/results/tabs/OverviewTab.tsx","content":"'use client';\n\nimport { motion } from 'framer-motion';\nimport Image from 'next/image';\nimport { User, ScanFace, Sparkles, ChevronRight, TrendingUp, TrendingDown, Lightbulb, Ruler } from 'lucide-react';\nimport { useResults } from '@/contexts/ResultsContext';\nimport { useHeightOptional } from '@/contexts/HeightContext';\nimport { TabContent } from '../ResultsLayout';\nimport { ScoreBar, AnimatedScore, ShareButton, ExportButton } from '../shared';\nimport { KeyStrengthsSection, AreasOfImprovementSection } from '../cards/KeyStrengthsFlaws';\nimport VisionInsightsCard from '../cards/VisionInsightsCard';\nimport { FacialRadarChart } from '../visualization/FacialRadarChart';\nimport { RatioDetailModal } from '../modals/RatioDetailModal';\nimport { getScoreColor, ResponsibleRatio, Ratio } from '@/types/results';\nimport { MetricScoreResult } from '@/lib/harmony-scoring';\nimport { RankedMetric, getWeightTierColor } from '@/lib/looksmax-scoring';\nimport { calculatePSL, getTierColor } from '@/lib/psl-calculator';\nimport { useState, useCallback, useMemo } from 'react';\nimport { usePricing } from '@/contexts/PricingContext';\n\n// ============================================\n// SCORE SUMMARY CARDS\n// ============================================\n\ninterface ProfileScoreCardProps {\n  title: string;\n  score: number | string;\n  icon: React.ReactNode;\n  photo?: string;\n  ratioCount: number;\n  onClick?: () => void;\n}\n\nfunction ProfileScoreCard({ title, score, icon, photo, ratioCount, onClick }: ProfileScoreCardProps) {\n  const numericScore = typeof score === 'number' ? score : 0;\n  const color = getScoreColor(numericScore);\n\n  return (\n    <motion.button\n      onClick={onClick}\n      className=\"bg-neutral-900/80 border border-neutral-800 rounded-xl p-4 hover:border-neutral-700 transition-all text-left w-full\"\n      whileHover={{ scale: 1.02 }}\n      whileTap={{ scale: 0.98 }}\n    >\n      <div className=\"flex items-center gap-4\">\n        {/* Photo or icon */}\n        <div className=\"relative w-16 h-16 rounded-lg overflow-hidden bg-neutral-800 flex-shrink-0\">\n          {photo ? (\n            <Image\n              src={photo}\n              alt={title}\n              width={64}\n              height={64}\n              className=\"object-cover\"\n              unoptimized\n            />\n          ) : (\n            <div className=\"w-full h-full flex items-center justify-center\">\n              {icon}\n            </div>\n          )}\n        </div>\n\n        {/* Info */}\n        <div className=\"flex-1\">\n          <h3 className=\"text-sm font-medium text-neutral-400 mb-1\">{title}</h3>\n          <div className=\"flex items-baseline gap-2\">\n            <span className=\"text-2xl font-bold\" style={{ color }}>\n              {typeof score === 'number' ? score.toFixed(2) : score}\n            </span>\n            <span className=\"text-sm text-neutral-500\">/ 10</span>\n          </div>\n          <p className=\"text-xs text-neutral-500 mt-1\">{ratioCount} measurements</p>\n        </div>\n\n        {/* Arrow */}\n        <ChevronRight size={20} className=\"text-neutral-600\" />\n      </div>\n\n      {/* Score bar */}\n      <div className=\"mt-3\">\n        <ScoreBar score={numericScore} height={6} />\n      </div>\n    </motion.button>\n  );\n}\n\n// ============================================\n// PSL PREVIEW CARD\n// ============================================\n\ninterface PSLPreviewCardProps {\n  score: number;\n  tier: string;\n  tierColor: string;\n  hasHeight: boolean;\n  onClick: () => void;\n}\n\nfunction PSLPreviewCard({ score, tier, tierColor, hasHeight, onClick }: PSLPreviewCardProps) {\n  if (!hasHeight) {\n    // Prompt to enter height\n    return (\n      <motion.button\n        onClick={onClick}\n        className=\"bg-neutral-900/80 border border-dashed border-neutral-700 rounded-xl p-4 hover:border-cyan-500/50 transition-all text-left w-full\"\n        whileHover={{ scale: 1.02 }}\n        whileTap={{ scale: 0.98 }}\n      >\n        <div className=\"flex items-center gap-4\">\n          <div className=\"w-14 h-14 rounded-lg bg-cyan-500/20 flex items-center justify-center flex-shrink-0\">\n            <Ruler size={24} className=\"text-cyan-400\" />\n          </div>\n          <div className=\"flex-1\">\n            <h3 className=\"text-sm font-medium text-white mb-1\">Get Your PSL Rating</h3>\n            <p className=\"text-xs text-neutral-400\">Enter your height to calculate your Pretty Scale Level score</p>\n          </div>\n          <ChevronRight size={20} className=\"text-cyan-400\" />\n        </div>\n      </motion.button>\n    );\n  }\n\n  return (\n    <motion.button\n      onClick={onClick}\n      className=\"bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-xl p-4 hover:border-cyan-500/30 transition-all text-left w-full\"\n      whileHover={{ scale: 1.02 }}\n      whileTap={{ scale: 0.98 }}\n    >\n      <div className=\"flex items-center gap-4\">\n        {/* PSL Score */}\n        <div className=\"w-14 h-14 rounded-xl flex items-center justify-center flex-shrink-0\" style={{ backgroundColor: `${tierColor}20` }}>\n          <span className=\"text-2xl font-bold\" style={{ color: tierColor }}>\n            {score.toFixed(1)}\n          </span>\n        </div>\n\n        {/* Info */}\n        <div className=\"flex-1\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h3 className=\"text-sm font-medium text-neutral-400\">PSL Rating</h3>\n            <span className=\"text-xs px-2 py-0.5 rounded-full font-medium\" style={{ backgroundColor: `${tierColor}20`, color: tierColor }}>\n              {tier}\n            </span>\n          </div>\n          <p className=\"text-xs text-neutral-500\">Face (75%) + Height (20%) + Body (5%)</p>\n        </div>\n\n        {/* Arrow */}\n        <div className=\"flex flex-col items-end\">\n          <span className=\"text-xs text-neutral-500 mb-1\">View Details</span>\n          <ChevronRight size={20} className=\"text-neutral-600\" />\n        </div>\n      </div>\n    </motion.button>\n  );\n}\n\n// ============================================\n// QUICK INSIGHTS - TOP/BOTTOM METRICS WITH ADVICE\n// ============================================\n\ninterface MetricInsightCardProps {\n  metric: RankedMetric;\n  type: 'strength' | 'improvement';\n  index: number;\n}\n\nfunction MetricInsightCard({ metric, type, index }: MetricInsightCardProps) {\n  const isStrength = type === 'strength';\n  const color = getScoreColor(metric.score);\n  const weightTierClass = getWeightTierColor(metric.weightTier);\n\n  return (\n    <motion.div\n      className={`bg-neutral-900/80 border rounded-xl p-4 ${isStrength ? 'border-green-500/30' : 'border-orange-500/30'\n        }`}\n      initial={{ opacity: 0, x: isStrength ? -20 : 20 }}\n      animate={{ opacity: 1, x: 0 }}\n      transition={{ delay: 0.1 * index }}\n    >\n      <div className=\"flex items-start gap-3\">\n        <div className={`w-8 h-8 rounded-lg flex items-center justify-center flex-shrink-0 ${isStrength ? 'bg-green-500/20' : 'bg-orange-500/20'\n          }`}>\n          {isStrength ? (\n            <TrendingUp size={16} className=\"text-green-400\" />\n          ) : (\n            <TrendingDown size={16} className=\"text-orange-400\" />\n          )}\n        </div>\n\n        <div className=\"flex-1 min-w-0\">\n          <div className=\"flex items-center gap-2 mb-1\">\n            <h4 className=\"font-medium text-white text-sm truncate\">{metric.name}</h4>\n            <span className={`text-xs px-1.5 py-0.5 rounded border ${weightTierClass}`}>\n              {metric.weightTier === 'high' ? '3x' : metric.weightTier === 'medium' ? '2x' : '1x'}\n            </span>\n          </div>\n\n          <div className=\"flex items-center gap-3 mb-2\">\n            <span className=\"text-lg font-bold\" style={{ color }}>\n              {typeof metric.score === 'number' ? metric.score.toFixed(1) : metric.score}\n            </span>\n            <span className=\"text-xs text-neutral-500\">\n              Ideal: {typeof metric.idealMin === 'number' ? metric.idealMin.toFixed(1) : metric.idealMin} - {typeof metric.idealMax === 'number' ? metric.idealMax.toFixed(1) : metric.idealMax}\n            </span>\n          </div>\n\n          {/* Advice */}\n          <div className=\"flex items-start gap-2 mt-2 p-2 bg-neutral-800/50 rounded-lg\">\n            <Lightbulb size={14} className={isStrength ? 'text-green-400 mt-0.5' : 'text-orange-400 mt-0.5'} />\n            <p className=\"text-xs text-neutral-300 leading-relaxed\">{metric.advice}</p>\n          </div>\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\ninterface QuickInsightsSectionProps {\n  topMetrics: RankedMetric[];\n  bottomMetrics: RankedMetric[];\n}\n\nfunction QuickInsightsSection({ topMetrics, bottomMetrics }: QuickInsightsSectionProps) {\n  if (topMetrics.length === 0 && bottomMetrics.length === 0) return null;\n\n  return (\n    <div className=\"mb-8\">\n      <h3 className=\"text-lg font-semibold text-white mb-4 flex items-center gap-2\">\n        <Lightbulb size={20} className=\"text-cyan-400\" />\n        Quick Insights\n      </h3>\n\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n        {/* Top 3 Strengths */}\n        <div>\n          <h4 className=\"text-sm font-medium text-green-400 mb-3 flex items-center gap-2\">\n            <TrendingUp size={14} />\n            Top Strengths\n          </h4>\n          <div className=\"space-y-3\">\n            {topMetrics.map((metric, index) => (\n              <MetricInsightCard\n                key={metric.metricId}\n                metric={metric}\n                type=\"strength\"\n                index={index}\n              />\n            ))}\n          </div>\n        </div>\n\n        {/* Bottom 3 - Areas to Improve */}\n        <div>\n          <h4 className=\"text-sm font-medium text-orange-400 mb-3 flex items-center gap-2\">\n            <TrendingDown size={14} />\n            Areas to Improve\n          </h4>\n          <div className=\"space-y-3\">\n            {bottomMetrics.map((metric, index) => (\n              <MetricInsightCard\n                key={metric.metricId}\n                metric={metric}\n                type=\"improvement\"\n                index={index}\n              />\n            ))}\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n}\n\n// ============================================\n// HARMONY SCORE DISPLAY (with AnimatedScore and Radar Chart)\n// ============================================\n\nfunction HarmonyScoreDisplay() {\n  const { overallScore, frontScore, sideScore, harmonyPercentage, harmonyScoreResult, pslRating } = useResults();\n  const [showRadar, setShowRadar] = useState(true);\n\n  // Get tier color based on PSL\n  const getTierColor = (psl: number) => {\n    // Handle invalid PSL values\n    if (typeof psl !== 'number' || !Number.isFinite(psl)) {\n      return 'text-orange-400';\n    }\n    if (psl >= 7.0) return 'text-purple-400';\n    if (psl >= 6.0) return 'text-cyan-400';\n    if (psl >= 5.0) return 'text-green-400';\n    if (psl >= 4.0) return 'text-yellow-400';\n    return 'text-orange-400';\n  };\n\n  // Safe values for display with fallbacks\n  const safePslRating = useMemo(() => ({\n    psl: typeof pslRating?.psl === 'number' && Number.isFinite(pslRating.psl) ? pslRating.psl : 3.0,\n    tier: pslRating?.tier || 'Unknown',\n    percentile: typeof pslRating?.percentile === 'number' && Number.isFinite(pslRating.percentile) ? pslRating.percentile : 50,\n    description: pslRating?.description || 'Analysis pending',\n  }), [pslRating]);\n\n  const safeHarmonyPercentage = typeof harmonyPercentage === 'number' && Number.isFinite(harmonyPercentage)\n    ? harmonyPercentage\n    : 0;\n\n  const safeFrontScore = typeof frontScore === 'number' && Number.isFinite(frontScore) ? frontScore : 0;\n  const safeSideScore = typeof sideScore === 'number' && Number.isFinite(sideScore) ? sideScore : 0;\n  const safeOverallScore = typeof overallScore === 'number' && Number.isFinite(overallScore) ? overallScore : 0;\n\n  return (\n    <motion.div\n      className=\"bg-gradient-to-br from-neutral-900 to-neutral-950 border border-neutral-800 rounded-2xl p-6 md:p-8\"\n      initial={{ opacity: 0, y: 20 }}\n      animate={{ opacity: 1, y: 0 }}\n      transition={{ duration: 0.5 }}\n    >\n      <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-8\">\n        {/* Left: Score Display */}\n        <div className=\"text-center flex flex-col justify-center\">\n          <h2 className=\"text-lg font-medium text-neutral-400 mb-2\">Weighted Harmony Score</h2>\n\n          {/* PSL Rating Badge */}\n          <motion.div\n            className=\"flex justify-center mb-3\"\n            initial={{ scale: 0 }}\n            animate={{ scale: 1 }}\n            transition={{ delay: 0.2, type: 'spring' }}\n          >\n            <div className=\"px-5 py-2 bg-gradient-to-r from-neutral-800 to-neutral-900 border border-neutral-700 rounded-xl\">\n              <div className=\"flex items-center gap-3\">\n                <div className=\"text-center\">\n                  <span className={`text-3xl font-bold ${getTierColor(safePslRating.psl)}`}>\n                    {safePslRating.psl.toFixed(1)}\n                  </span>\n                  <span className=\"text-sm text-neutral-500 ml-1\">PSL</span>\n                </div>\n                <div className=\"h-8 w-px bg-neutral-700\" />\n                <div className=\"text-left\">\n                  <p className={`text-sm font-semibold ${getTierColor(safePslRating.psl)}`}>\n                    {safePslRating.tier}\n                  </p>\n                  <p className=\"text-xs text-neutral-500\">\n                    Top {(100 - safePslRating.percentile).toFixed(1)}%\n                  </p>\n                </div>\n              </div>\n            </div>\n          </motion.div>\n\n          {/* Harmony Percentage Badge */}\n          <motion.div\n            className=\"flex justify-center mb-4\"\n            initial={{ scale: 0 }}\n            animate={{ scale: 1 }}\n            transition={{ delay: 0.3, type: 'spring' }}\n          >\n            <div className=\"px-4 py-1 bg-gradient-to-r from-purple-500/20 to-cyan-500/20 border border-purple-500/30 rounded-full\">\n              <span className=\"text-2xl font-bold text-transparent bg-clip-text bg-gradient-to-r from-purple-400 to-cyan-400\">\n                {safeHarmonyPercentage.toFixed(1)}%\n              </span>\n              <span className=\"text-xs text-neutral-500 ml-2\">Harmony</span>\n            </div>\n          </motion.div>\n\n          {/* Animated Score */}\n          <div className=\"flex justify-center mb-4\">\n            <AnimatedScore\n              score={safeOverallScore}\n              duration={2.5}\n              delay={0.5}\n              showConfetti={true}\n              confettiThreshold={7.5}\n            />\n          </div>\n\n          {/* Profile Breakdowns */}\n          <div className=\"flex justify-center gap-8 mb-4\">\n            <div className=\"text-center\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Front Profile</p>\n              <p className=\"text-xl font-bold\" style={{ color: getScoreColor(safeFrontScore) }}>\n                {safeFrontScore.toFixed(2)}\n              </p>\n            </div>\n            <div className=\"w-px bg-neutral-800\" />\n            <div className=\"text-center\">\n              <p className=\"text-xs text-neutral-500 mb-1\">Side Profile</p>\n              <p className=\"text-xl font-bold\" style={{ color: getScoreColor(safeSideScore) }}>\n                {safeSideScore.toFixed(2)}\n              </p>\n            </div>\n          </div>\n\n          {/* Weight Distribution */}\n          {harmonyScoreResult && (\n            <div className=\"flex justify-center gap-3 mb-4 text-xs\">\n              <span className=\"px-2 py-1 rounded bg-purple-500/20 text-purple-400 border border-purple-500/30\">\n                High Impact: {harmonyScoreResult.weightDistribution.highImpact.count}\n              </span>\n              <span className=\"px-2 py-1 rounded bg-blue-500/20 text-blue-400 border border-blue-500/30\">\n                Medium: {harmonyScoreResult.weightDistribution.mediumImpact.count}\n              </span>\n              <span className=\"px-2 py-1 rounded bg-gray-500/20 text-gray-400 border border-gray-500/30\">\n                Standard: {harmonyScoreResult.weightDistribution.standard.count}\n              </span>\n            </div>\n          )}\n\n          <p className=\"text-sm text-neutral-400 max-w-md mx-auto\">\n            {safeHarmonyPercentage >= 80 ? 'Exceptional facial harmony. Your features are well-balanced and proportioned.' :\n              safeHarmonyPercentage >= 60 ? 'Good facial harmony with some areas that could be optimized.' :\n                safeHarmonyPercentage >= 40 ? 'Average facial harmony. Several areas have room for improvement.' :\n                  'Below average facial harmony. Multiple areas could benefit from attention.'}\n          </p>\n        </div>\n\n        {/* Right: Radar Chart */}\n        <div className=\"flex flex-col\">\n          <div className=\"flex items-center justify-between mb-2\">\n            <h3 className=\"text-sm font-medium text-neutral-400\">Category Breakdown</h3>\n            <button\n              onClick={() => setShowRadar(!showRadar)}\n              className=\"text-xs text-cyan-400 hover:text-cyan-300 transition-colors\"\n            >\n              {showRadar ? 'Hide' : 'Show'}\n            </button>\n          </div>\n          {showRadar && (\n            <motion.div\n              initial={{ opacity: 0, scale: 0.95 }}\n              animate={{ opacity: 1, scale: 1 }}\n              transition={{ duration: 0.5, delay: 0.3 }}\n              className=\"flex-1 min-h-[280px]\"\n            >\n              <FacialRadarChart height={280} />\n            </motion.div>\n          )}\n        </div>\n      </div>\n    </motion.div>\n  );\n}\n\n// ============================================\n// OVERVIEW TAB\n// ============================================\n\nexport function OverviewTab() {\n  const {\n    overallScore,\n    frontScore,\n    sideScore,\n    frontRatios,\n    sideRatios,\n    strengths,\n    flaws,\n    frontPhoto,\n    sidePhoto,\n    frontLandmarks,\n    sideLandmarks,\n    gender,\n    ethnicity,\n    setActiveTab,\n    topMetrics,\n    bottomMetrics,\n    setSelectedVisualizationMetric,\n    isUnlocked,\n  } = useResults();\n\n  const { openPricingModal } = usePricing();\n\n  const heightContext = useHeightOptional();\n  const [selectedRatio, setSelectedRatio] = useState<MetricScoreResult | null>(null);\n  const [isModalOpen, setIsModalOpen] = useState(false);\n\n  // Calculate PSL for the preview card\n  const pslPreviewData = useMemo(() => {\n    const heightCm = heightContext?.heightCm;\n    if (!heightCm || !overallScore) {\n      return { hasHeight: false, score: 0, tier: 'Unknown', tierColor: '#6b7280' };\n    }\n\n    const numericScore = typeof overallScore === 'number' ? overallScore : 0;\n    const pslResult = calculatePSL({\n      faceScore: numericScore,\n      heightCm,\n      gender: gender || 'male',\n    });\n\n    return {\n      hasHeight: true,\n      score: pslResult.score,\n      tier: pslResult.tier,\n      tierColor: getTierColor(pslResult.tier),\n    };\n  }, [heightContext?.heightCm, overallScore, gender]);\n\n  // All ratios combined for modal navigation\n  const allRatios = useMemo(() => [...frontRatios, ...sideRatios], [frontRatios, sideRatios]);\n\n  // Current ratio index for navigation\n  const currentRatioIndex = useMemo(() => {\n    if (!selectedRatio) return -1;\n    return allRatios.findIndex(r => r.id === selectedRatio.metricId);\n  }, [selectedRatio, allRatios]);\n\n  // Convert Ratio to MetricScoreResult for modal\n  const ratioToMetricResult = useCallback((ratio: Ratio): MetricScoreResult => {\n    return {\n      metricId: ratio.id,\n      name: ratio.name,\n      value: ratio.value,\n      score: ratio.score,\n      standardizedScore: ratio.standardizedScore,\n      idealMin: ratio.idealMin,\n      idealMax: ratio.idealMax,\n      deviation: 0,\n      deviationDirection: 'within',\n      unit: ratio.unit === 'x' ? 'ratio' : ratio.unit === '%' ? 'percent' : ratio.unit === 'Â°' ? 'degrees' : ratio.unit,\n      category: ratio.category,\n      qualityTier: ratio.qualityLevel,\n      severity: ratio.severity,\n    } as MetricScoreResult;\n  }, []);\n\n  // Handle ratio click from strengths/flaws sections\n  const handleRatioClick = useCallback((ratio: ResponsibleRatio, categoryName: string) => {\n    // Find the full ratio data from frontRatios or sideRatios\n    const fullRatio = allRatios.find(\n      (r) => r.name === ratio.ratioName || r.id === ratio.ratioId\n    );\n\n    // Update the visualization first (shows on face image)\n    if (fullRatio) {\n      setSelectedVisualizationMetric(fullRatio.id);\n      setSelectedRatio(ratioToMetricResult(fullRatio));\n    } else {\n      // Create a minimal MetricScoreResult from ResponsibleRatio\n      setSelectedVisualizationMetric(ratio.ratioId);\n      setSelectedRatio({\n        metricId: ratio.ratioId,\n        name: ratio.ratioName,\n        value: ratio.value,\n        score: ratio.score,\n        standardizedScore: ratio.score,\n        idealMin: ratio.idealMin,\n        idealMax: ratio.idealMax,\n        deviation: 0,\n        deviationDirection: 'within',\n        unit: (ratio.unit as 'ratio' | 'percent' | 'degrees' | 'mm' | 'none') || 'ratio',\n        category: ratio.category || categoryName,\n        qualityTier: (typeof ratio.score === 'number' ? ratio.score : 0) >= 8 ? 'ideal' : (typeof ratio.score === 'number' ? ratio.score : 0) >= 6 ? 'excellent' : (typeof ratio.score === 'number' ? ratio.score : 0) >= 4 ? 'good' : 'below_average',\n        severity: 'optimal',\n      } as MetricScoreResult);\n    }\n    setIsModalOpen(true);\n  }, [allRatios, ratioToMetricResult, setSelectedVisualizationMetric]);\n\n  // Navigate to previous/next ratio in modal\n  const handlePreviousRatio = useCallback(() => {\n    if (currentRatioIndex > 0) {\n      const prevRatio = allRatios[currentRatioIndex - 1];\n      setSelectedRatio(ratioToMetricResult(prevRatio));\n      setSelectedVisualizationMetric(prevRatio.id);\n    }\n  }, [currentRatioIndex, allRatios, ratioToMetricResult, setSelectedVisualizationMetric]);\n\n  const handleNextRatio = useCallback(() => {\n    if (currentRatioIndex < allRatios.length - 1) {\n      const nextRatio = allRatios[currentRatioIndex + 1];\n      setSelectedRatio(ratioToMetricResult(nextRatio));\n      setSelectedVisualizationMetric(nextRatio.id);\n    }\n  }, [currentRatioIndex, allRatios, ratioToMetricResult, setSelectedVisualizationMetric]);\n\n  // Determine if selected ratio is from side profile\n  const isSideRatio = useMemo(() => {\n    if (!selectedRatio) return false;\n    const sideMetricIds = sideRatios.map(r => r.id);\n    return sideMetricIds.includes(selectedRatio.metricId);\n  }, [selectedRatio, sideRatios]);\n\n  // Memoized modal values (useMemo instead of useCallback for computed values)\n  const modalPhoto = useMemo(() => {\n    if (!selectedRatio) return frontPhoto;\n    return isSideRatio ? (sidePhoto || frontPhoto) : frontPhoto;\n  }, [selectedRatio, isSideRatio, frontPhoto, sidePhoto]);\n\n  const modalLandmarks = useMemo(() => {\n    return isSideRatio ? (sideLandmarks || []) : (frontLandmarks || []);\n  }, [isSideRatio, frontLandmarks, sideLandmarks]);\n\n  const modalProfileType = useMemo((): 'front' | 'side' => {\n    return isSideRatio ? 'side' : 'front';\n  }, [isSideRatio]);\n\n  return (\n    <TabContent\n      title=\"Overview\"\n      subtitle=\"Your complete facial harmony analysis\"\n      rightContent={\n        <div className=\"flex items-center gap-2\">\n          <ShareButton score={overallScore} frontScore={frontScore} sideScore={sideScore} />\n          <ExportButton elementId=\"results-overview\" />\n        </div>\n      }\n    >\n      {/* Main content with ID for export */}\n      <div id=\"results-overview\">\n        {/* Harmony Score */}\n        <div className=\"mb-8\">\n          <HarmonyScoreDisplay />\n        </div>\n\n        {/* Profile Scores */}\n        <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4 mb-4\">\n          <ProfileScoreCard\n            title=\"Front Profile\"\n            score={frontScore}\n            icon={<User size={24} className=\"text-neutral-600\" />}\n            photo={frontPhoto}\n            ratioCount={frontRatios.length}\n            onClick={() => setActiveTab('front-ratios')}\n          />\n          <ProfileScoreCard\n            title=\"Side Profile\"\n            score={sideScore}\n            icon={<ScanFace size={24} className=\"text-neutral-600\" />}\n            photo={sidePhoto || undefined}\n            ratioCount={sideRatios.length}\n            onClick={() => setActiveTab('side-ratios')}\n          />\n        </div>\n\n        {/* PSL Preview Card */}\n        <div className=\"mb-8\">\n          <PSLPreviewCard\n            score={pslPreviewData.score}\n            tier={pslPreviewData.tier}\n            tierColor={pslPreviewData.tierColor}\n            hasHeight={pslPreviewData.hasHeight}\n            onClick={() => setActiveTab('psl')}\n          />\n        </div>\n\n        {/* Quick Insights - Top/Bottom Metrics with Advice (from looksmax_engine.py) */}\n        <QuickInsightsSection topMetrics={topMetrics} bottomMetrics={bottomMetrics} />\n\n        {/* AI Qualitative Insights Section */}\n        <div className=\"mb-8\">\n          <VisionInsightsCard />\n        </div>\n\n        {/* Strengths & Flaws Grid - Harmony Style */}\n        <div className=\"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8\">\n          {/* Key Strengths */}\n          <KeyStrengthsSection\n            strengths={strengths}\n            onRatioClick={handleRatioClick}\n            initialShowCount={3}\n          />\n\n          {/* Areas of Improvement */}\n          <AreasOfImprovementSection\n            flaws={flaws}\n            onRatioClick={handleRatioClick}\n            initialShowCount={3}\n          />\n        </div>\n\n        {/* Call to Action */}\n        <motion.div\n          className=\"bg-gradient-to-r from-cyan-500/20 to-blue-600/20 border border-cyan-500/30 rounded-xl p-6 flex items-center justify-between\"\n          initial={{ opacity: 0 }}\n          animate={{ opacity: 1 }}\n          transition={{ delay: 0.5 }}\n        >\n          <div className=\"flex items-center gap-4\">\n            <div className=\"w-12 h-12 rounded-xl bg-cyan-500/20 flex items-center justify-center\">\n              <Sparkles size={24} className=\"text-cyan-400\" />\n            </div>\n            <div>\n              <h3 className=\"font-semibold text-white\">Unlock Your Potential</h3>\n              <p className=\"text-sm text-neutral-400\">\n                See personalized recommendations to improve your harmony score\n              </p>\n            </div>\n          </div>\n          <button\n            onClick={() => {\n              if (isUnlocked) {\n                setActiveTab('plan');\n              } else {\n                openPricingModal('overview_cta');\n              }\n            }}\n            className=\"px-4 py-2 bg-cyan-500 text-black font-medium rounded-lg hover:bg-cyan-400 transition-colors flex items-center gap-2\"\n          >\n            {isUnlocked ? 'View Plan' : 'Unlock Now'}\n            <ChevronRight size={16} />\n          </button>\n        </motion.div>\n      </div>{/* End of results-overview */}\n\n      {/* Ratio Detail Modal */}\n      <RatioDetailModal\n        isOpen={isModalOpen}\n        onClose={() => setIsModalOpen(false)}\n        ratio={selectedRatio}\n        onPrevious={handlePreviousRatio}\n        onNext={handleNextRatio}\n        hasPrevious={currentRatioIndex > 0}\n        hasNext={currentRatioIndex < allRatios.length - 1}\n        facePhoto={modalPhoto}\n        landmarks={modalLandmarks}\n        allRatios={allRatios}\n        profileType={modalProfileType}\n        gender={gender}\n        ethnicity={ethnicity}\n      />\n    </TabContent>\n  );\n}\n","numLines":727,"startLine":1,"totalLines":727}}}
{"parentUuid":"965f7684-850f-48b1-9222-a96bcc25f6b0","isSidechain":true,"userType":"external","cwd":"/Users/imorgado/LOOKSMAXX/looksmaxx-app","sessionId":"a0049bac-66d9-4690-8fe5-89aaecf06c3c","version":"2.0.76","gitBranch":"main","agentId":"a106a22","slug":"jolly-humming-thunder","message":{"model":"claude-opus-4-5-20251101","id":"msg_01NRfzzNqmTqgCbJJuiRWVyb","type":"message","role":"assistant","content":[{"type":"text","text":"Now I have a comprehensive understanding of the codebase. Let me compile the UX improvement research report:\n\n---\n\n# UX Improvement Research Report for LOOKSMAXX Dashboard\n\n## Executive Summary\n\nBased on my analysis of the current codebase and industry best practices, here are specific UX improvements for the dashboard and data visualization components.\n\n---\n\n## 1. Card Design Patterns\n\n### Current State\nThe codebase uses a consistent dark theme with cards featuring:\n- `bg-neutral-900/80` or `bg-neutral-900/60` backgrounds\n- `border-neutral-800` borders with hover states\n- Rounded corners (`rounded-xl`, `rounded-2xl`)\n- Framer Motion animations for micro-interactions\n\n### Recommended Improvements\n\n**A. Hierarchy Through Elevation**\n- Add subtle gradient overlays for primary cards (e.g., `bg-gradient-to-br from-neutral-900 to-neutral-950`)\n- Introduce shadow levels: `shadow-none` for flat, `shadow-lg` for elevated, `shadow-2xl` for focused/selected\n- Current `DailyStackCard.tsx` uses this well with `shadow-xl` on the gradient hero card\n\n**B. Interactive States**\n- Add a `ring` focus state for accessibility: `focus:ring-2 focus:ring-cyan-500/50`\n- Implement skeleton loading states beyond just `animate-pulse` (use shimmer effects)\n- Add pressed states with `active:scale-[0.98]` for all clickable cards\n\n**C. Card Density Options**\n- Consider offering compact/comfortable/spacious density options\n- Current padding varies between `p-4` and `p-6` inconsistently\n- Standardize to: Compact=`p-3`, Default=`p-4 sm:p-5`, Spacious=`p-6`\n\n---\n\n## 2. Data Presentation\n\n### Current State\n- Scores displayed with `ScoreCircle`, `ScoreBar`, and inline text\n- Color coding via `getScoreColor()` function\n- Badges for quality tiers and severity levels\n\n### Recommended Improvements\n\n**A. Score Visualization Enhancements**\n- Add trend indicators: `TrendingUp`/`TrendingDown` icons next to scores to show change from last analysis (already in `ProgressComparisonCard.tsx` but not widely used)\n- Implement \"goal vs current\" dual-progress bars for metrics\n- Add percentile context: \"You're in the top 15% for this metric\"\n\n**B. Comparative Visualizations**\n- Add overlay comparisons on the `FacialRadarChart` showing \"current vs ideal\" or \"current vs potential\"\n- Implement mini sparklines for historical trend in measurement cards\n- Consider adding distribution charts showing where user falls in population\n\n**C. Data Grouping**\n- Group related metrics with visual containers (e.g., \"Eye Cluster\", \"Jaw Cluster\")\n- Use collapsible section headers with aggregate scores\n- Current `MeasurementCard.tsx` could benefit from category-based grouping\n\n---\n\n## 3. Tab Navigation\n\n### Current State\n- 10 tabs: Overview, Front Ratios, Side Ratios, Leaderboard, PSL, Archetype, Plan, Guides, Community, Options\n- Tab content uses `TabContent` wrapper component from `ResultsLayout.tsx`\n\n### Recommended Improvements\n\n**A. Navigation Hierarchy**\n- Group tabs into logical sections with separators:\n  - Analysis: Overview, Front Ratios, Side Ratios, PSL\n  - Improvement: Plan, Guides, Archetype\n  - Social: Leaderboard, Community\n  - Settings: Options\n\n**B. Progressive Disclosure**\n- Show \"locked\" state for premium tabs with blur overlay (already done in `VisionInsightsCard.tsx`)\n- Add badge indicators for tabs with new/updated content\n- Consider adding \"recommended next step\" indicator on tabs\n\n**C. Navigation UX**\n- Add keyboard navigation (arrow keys)\n- Implement swipe gestures for mobile tab switching\n- Add progress indicator showing overall completion (e.g., \"3 of 5 sections viewed\")\n\n---\n\n## 4. Leaderboard/Ranking UI\n\n### Current State (`LeaderboardTab.tsx`)\n- Crown/Medal icons for top 3\n- User rank card with gradient background\n- Photos, strengths/improvements badges inline\n\n### Recommended Improvements\n\n**A. Enhanced Rank Display**\n- Add animated rank position changes (slide up/down animations)\n- Implement \"rank history\" mini-chart showing position over time\n- Add tier badges beyond top 3 (e.g., \"Top 10%\", \"Top 25%\")\n\n**B. Social Proof Elements**\n- Show \"users analyzed today\" counter\n- Add \"nearest competitor\" section: \"You're 0.2 points behind #45\"\n- Implement \"biggest movers\" section showing users with most improvement\n\n**C. User Profiles**\n- Expand `UserProfileModal` to show detailed comparison view\n- Add ability to \"compare with\" selected users\n- Show common strengths/flaws between users\n\n---\n\n## 5. Stats and Metrics Display\n\n### Current State\n- Individual metric cards in `MeasurementCard.tsx`\n- Category tags with color coding\n- Quality/Severity badges\n\n### Recommended Improvements\n\n**A. Summary Statistics**\n- Add hero stats section: \"X measurements analyzed\", \"Y areas optimal\", \"Z need attention\"\n- Implement \"analysis confidence\" indicator based on photo quality\n- Show \"measurement stability\" indicator for metrics affected by photo angle\n\n**B. Metric Categorization**\n- Use tabbed sub-navigation for metric categories (Eyes, Jaw, Nose, etc.)\n- Add category-level summaries before individual metrics\n- Implement \"focus mode\" showing only problem metrics\n\n**C. Ideal Range Visualization**\n- Current `IdealRangeBar` component is good - extend with:\n  - Ethnic-specific ideal range overlay\n  - Population distribution curve behind the bar\n  - \"Your potential\" marker showing achievable range\n\n---\n\n## 6. Achievement/Badge Systems\n\n### Current State\n- Quality badges: Ideal, Excellent, Good, Below Average\n- Severity badges: Optimal, Minor, Moderate, Major, Severe, Critical\n- PSL tier badges: Gigachad, Chad, Chadlite, etc.\n- Archetype classification badges\n\n### Recommended Improvements\n\n**A. Gamification Badges**\n- Add milestone achievements:\n  - \"First Analysis\" - completed first scan\n  - \"Consistency King\" - 7-day streak (foundation exists in `StreakCard.tsx`)\n  - \"Improvement Pioneer\" - +0.5 score improvement\n  - \"Perfect Profile\" - any metric at 10/10\n  - \"Category Master\" - all metrics in category above 8/10\n\n**B. Progress Unlocks**\n- Unlock guide access based on completed actions\n- Achievement-based discounts on premium features\n- \"Expert\" badge for users who've viewed all guides\n\n**C. Display Improvements**\n- Create dedicated achievements section/modal\n- Add badge rarity indicators (Common, Rare, Legendary)\n- Implement badge showcase on user profile\n\n---\n\n## 7. Gamification Elements\n\n### Current State\n- `StreakCard.tsx` - tracks consecutive daily scans with visual progress bar\n- PSL tiers create aspirational goals\n- Potential score calculation creates improvement target\n\n### Recommended Improvements\n\n**A. Progress Quests**\n- Implement \"weekly challenges\":\n  - \"Complete a side profile analysis\"\n  - \"Read 3 guides this week\"\n  - \"Try the skincare routine for 7 days\"\n- Add XP/points system for completing actions\n\n**B. Improvement Journey**\n- Create visual \"improvement roadmap\" with milestones\n- Implement \"before/after\" transformation showcase (foundation in `ProgressComparisonCard.tsx`)\n- Add estimated timeline to reach next tier\n\n**C. Social Gamification**\n- \"Challenge a friend\" to improve specific metric\n- Team/group improvement challenges\n- Weekly leaderboard resets for engagement\n\n---\n\n## 8. Specific Component Improvements\n\n### A. `OverviewTab.tsx`\n- The `HarmonyScoreDisplay` is dense - consider splitting into tabs or accordion\n- Add \"quick actions\" section: \"Take side photo\", \"Complete profile\", \"View recommendations\"\n- Move `VisionInsightsCard` above strengths/flaws if unlocked (more valuable data)\n\n### B. `PSLTab.tsx`\n- `TierComparisonChart` is effective - add animation on load\n- Consider adding \"celebrity benchmark\" comparisons at each tier\n- The formula explainer is good but could use interactive tooltips\n\n### C. `ArchetypeTab.tsx`\n- Add visual examples of each archetype category\n- Implement \"morphing\" animation showing how user could transition to target archetype\n- Add celebrity examples for each archetype\n\n### D. `GuidesTab.tsx`\n- Add reading progress tracking (persist to localStorage/API)\n- Implement \"bookmark\" functionality for guides\n- Add \"quick start\" section with most relevant guides for user's flaws\n\n### E. `LeaderboardTab.tsx`\n- Add filtering by ethnicity/age range for fairer comparison\n- Implement \"similar to you\" section showing users with comparable features\n- Add \"improvement leaderboard\" tracking biggest score gains\n\n---\n\n## 9. Micro-Interactions to Add\n\n1. **Confetti on achievements** - extend current `showConfetti` in `AnimatedScore`\n2. **Score counting animation** - already implemented, ensure consistent use\n3. **Haptic feedback** - add for mobile button presses\n4. **Sound effects** - optional, subtle sounds for level ups/achievements\n5. **Parallax effects** - subtle depth on card hover\n6. **Magnetic cursor** - buttons attract cursor slightly on hover\n\n---\n\n## 10. Performance Considerations\n\n1. **Virtualization** - for long lists in leaderboard/guides (use `react-window`)\n2. **Lazy loading** - for guide content and off-screen components\n3. **Image optimization** - already using Next.js Image, ensure all images use it\n4. **Skeleton loading** - add consistent skeleton states across all async content\n5. **Optimistic updates** - for actions like voting, bookmarking\n\n---\n\n## Priority Implementation Order\n\n1. **High Impact, Low Effort**:\n   - Add trend indicators to scores\n   - Implement achievement badges\n   - Add skeleton loading states\n\n2. **High Impact, Medium Effort**:\n   - Enhance streak system with more gamification\n   - Add progress tracking for guides\n   - Implement comparison overlays on radar chart\n\n3. **Medium Impact, Higher Effort**:\n   - Add full achievement system\n   - Implement weekly challenges\n   - Add improvement timeline visualization\n\n---\n\nThis report provides actionable UX improvements based on the current codebase structure at `/Users/imorgado/LOOKSMAXX/looksmaxx-app/`. Each recommendation builds on existing patterns and components to maintain consistency while elevating the user experience."}],"stop_reason":null,"stop_sequence":null,"usage":{"input_tokens":4420,"cache_creation_input_tokens":33098,"cache_read_input_tokens":95317,"cache_creation":{"ephemeral_5m_input_tokens":33098,"ephemeral_1h_input_tokens":0},"output_tokens":1,"service_tier":"standard"}},"requestId":"req_011CWVPu8MH6CyA39xsekFif","type":"assistant","uuid":"38976ef0-bfac-4b29-aab5-879eae51dcd9","timestamp":"2025-12-26T13:43:24.477Z"}
