   430→
   431→// ============================================================================
   432→// ENCRYPTION HELPERS FOR SENSITIVE DATA
   433→// ============================================================================
   434→
   435→/**
   436→ * Simple obfuscation for localStorage
   437→ * NOTE: This is NOT cryptographically secure, but provides basic protection
   438→ * against casual inspection of localStorage. For truly sensitive data,
   439→ * consider server-side storage or proper encryption libraries.
   440→ *
   441→ * @param {any} data - Data to encode
   442→ * @returns {string|null} Encoded string or null on error
   443→ */
   444→function encryptForStorage(data) {
   445→    try {
   446→        if (data === null || data === undefined) {
   447→            return null;
   448→        }
   449→        // Double encode to add slight obfuscation layer
   450→        const jsonStr = JSON.stringify(data);
   451→        const encoded = encodeURIComponent(jsonStr);
   452→        return btoa(encoded);
   453→    } catch (e) {
   454→        debugLog('[Config] Encryption error:', e);
   455→        return null;
   456→    }
   457→}
   458→
   459→/**
   460→ * Decode obfuscated data from localStorage
   461→ *
   462→ * @param {string} data - Encoded string
   463→ * @returns {any|null} Decoded data or null on error
   464→ */
   465→function decryptFromStorage(data) {
   466→    try {
   467→        if (!data || typeof data !== 'string') {
   468→            return null;
   469→        }
   470→        const decoded = atob(data);
   471→        const jsonStr = decodeURIComponent(decoded);
   472→        return JSON.parse(jsonStr);
   473→    } catch (e) {
   474→        // This is expected for unencrypted legacy data - don't log as warning
   475→        return null;
   476→    }
   477→}
   478→
   479→/**
   480→ * Check if a value appears to be encrypted (base64 encoded JSON)
   481→ *
   482→ * @param {any} value - Value to check
   483→ * @returns {boolean} True if value appears to be encrypted
   484→ */
   485→function isEncryptedValue(value) {
   486→    if (!value || typeof value !== 'string') {
   487→        return false;
   488→    }
   489→    // Unencrypted values typically start with known patterns
   490→    // (e.g., "cus_" for Stripe customer IDs, "SPLICE-" for license keys)
   491→    if (value.startsWith('cus_') || value.startsWith('SPLICE-')) {
   492→        return false;
   493→    }
   494→    // Check if it's a valid base64 string that decodes to valid JSON
   495→    try {
   496→        const decoded = atob(value);
   497→        const jsonStr = decodeURIComponent(decoded);
   498→        JSON.parse(jsonStr);
   499→        return true;
   500→    } catch {
   501→        return false;
   502→    }
   503→}
   504→
   505→/**
   506→ * Encrypt sensitive fields in settings object
   507→ *
   508→ * @param {Object} settings - Settings object with plaintext sensitive fields
   509→ * @returns {Object} Settings with encrypted sensitive fields
   510→ */
   511→function encryptSensitiveFields(settings) {
   512→    const encrypted = { ...settings };
   513→
   514→    for (const field of SENSITIVE_FIELDS) {
   515→        if (encrypted[field] !== null && encrypted[field] !== undefined) {
   516→            // Only encrypt if not already encrypted
   517→            if (!isEncryptedValue(encrypted[field])) {
   518→                encrypted[field] = encryptForStorage(encrypted[field]);
   519→                debugLog(`[Config] Encrypted field: ${field}`);
   520→            }
   521→        }
   522→    }
   523→
   524→    return encrypted;
   525→}
   526→
   527→/**
   528→ * Decrypt sensitive fields in settings object
   529→ *
   530→ * @param {Object} settings - Settings object with encrypted sensitive fields
   531→ * @returns {Object} Settings with decrypted sensitive fields
   532→ */
   533→function decryptSensitiveFields(settings) {
   534→    const decrypted = { ...settings };
   535→
   536→    for (const field of SENSITIVE_FIELDS) {
   537→        if (decrypted[field] !== null && decrypted[field] !== undefined) {
   538→            // Check if it looks encrypted before attempting to decrypt
   539→            if (isEncryptedValue(decrypted[field])) {
   540→                const decryptedValue = decryptFromStorage(decrypted[field]);
   541→                if (decryptedValue !== null) {
   542→                    decrypted[field] = decryptedValue;
   543→                    debugLog(`[Config] Decrypted field: ${field}`);
   544→                }
   545→            }
   546→            // If not encrypted (legacy data), keep the original value
   547→        }
   548→    }
   549→

</system-reminder>
