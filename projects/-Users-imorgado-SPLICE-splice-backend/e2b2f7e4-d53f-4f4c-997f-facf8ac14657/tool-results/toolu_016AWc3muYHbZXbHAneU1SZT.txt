The file /Users/imorgado/SPLICE/splice-backend/middleware/rateLimiter.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
    33→// =============================================================================
    34→// SECURITY: Enhanced IP-based Rate Limiting with Redis Backend
    35→// =============================================================================
    36→
    37→/**
    38→ * Rate limit configuration
    39→ * Tiered limits: authenticated users get higher limits than anonymous
    40→ *
    41→ * SECURITY FIX: Added rate limits for all expensive/AI endpoints to prevent:
    42→ * - API cost escalation (OpenAI, Replicate API abuse)
    43→ * - DoS attacks on compute-intensive endpoints
    44→ * - Brute force on referral codes
    45→ */
    46→const RATE_LIMITS = {
    47→  // Global IP limits
    48→  global: {
    49→    anonymous: { max: 100, window: 60 },      // 100 req/min for unauthenticated
    50→    authenticated: { max: 300, window: 60 }   // 300 req/min for authenticated users
    51→  },
    52→  // Endpoint-specific limits (stricter for expensive operations)
    53→  endpoints: {
    54→    // Auth endpoints - strict limits to prevent brute force
    55→    '/auth/send-code': { max: 5, window: 300 },        // 5 requests per 5 minutes
    56→    '/auth/verify-code': { max: 10, window: 300 },     // 10 requests per 5 minutes
    57→    '/auth/login': { max: 10, window: 60 },            // 10 login attempts per minute
    58→
    59→    // Music generation - expensive AI operation
    60→    '/music/generate': { max: 10, window: 60 },        // 10 requests per minute
    61→    '/music/status': { max: 60, window: 60 },          // 60 status checks per minute
    62→
    63→    // Analysis endpoints - use OpenAI/AI services
    64→    '/analyze': { max: 30, window: 60 },               // 30 requests per minute
    65→
    66→    // Transcription-heavy endpoints - expensive AI operations
    67→    '/captions/animate': { max: 15, window: 60 },      // 15 caption generations per minute
    68→    '/captions/export': { max: 30, window: 60 },       // 30 exports per minute
    69→
    70→    // Detection endpoints - compute-intensive
    71→    '/silences/detect': { max: 20, window: 60 },       // 20 silence detections per minute
    72→    '/detection/takes': { max: 20, window: 60 },       // 20 take detections per minute
    73→    '/detection/scenes': { max: 20, window: 60 },      // 20 scene detections per minute
    74→
    75→    // Multitrack analysis - expensive operation
    76→    '/multitrack/analyze': { max: 15, window: 60 },    // 15 multitrack analyses per minute
    77→
    78→    // Chapter detection - AI-powered
    79→    '/chapters/detect': { max: 15, window: 60 },       // 15 chapter detections per minute
    80→
    81→    // Reframe/social - compute-intensive
    82→    '/reframe/analyze': { max: 15, window: 60 },       // 15 reframe analyses per minute
    83→
    84→    // YouTube/Zoom generation - AI-powered content
    85→    '/youtube/generate': { max: 10, window: 60 },      // 10 YouTube generations per minute
    86→    '/zoom/generate': { max: 10, window: 60 },         // 10 Zoom generations per minute
    87→
    88→    // Text editing - AI-powered
    89→    '/text-edit/process': { max: 20, window: 60 },     // 20 text edits per minute
    90→
    91→    // Cut list generation
    92→    '/cutlist/generate': { max: 20, window: 60 },      // 20 cut lists per minute
    93→
    94→    // Export operations
    95→    '/export': { max: 30, window: 60 },                // 30 exports per minute
    96→
    97→    // Batch operations - very expensive
    98→    '/batch/start': { max: 5, window: 60 },            // 5 batch jobs per minute
    99→
   100→    // Referral code validation - prevent brute force
   101→    '/referral/validate': { max: 10, window: 60 },     // 10 validations per minute
   102→    '/referral/apply': { max: 5, window: 60 },         // 5 applications per minute
   103→
   104→    // Upload operations
   105→    'upload': { max: 20, window: 60 }                  // 20 uploads per minute
   106→  }
   107→};
   108→
   109→// In-memory fallback for when Redis is unavailable
   110→const ipRequestCounts = new Map(); // IP -> { count, windowStart }
   111→