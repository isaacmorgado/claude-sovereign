     1→/**
     2→ * SPLICE Backend Server
     3→ *
     4→ * Main entry point for the SPLICE backend API.
     5→ * Orchestrates the audio analysis pipeline.
     6→ *
     7→ * Slices:
     8→ * - Slice 4: Transcription (services/transcription.js)
     9→ * - Slice 5: Take Detection (services/takeDetection.js)
    10→ *
    11→ * Architecture: Modular routes (see routes/ directory)
    12→ */
    13→
    14→
    15→require('dotenv').config();
    16→
    17→const express = require('express');
    18→const cors = require('cors');
    19→const helmet = require('helmet');
    20→const cookieParser = require('cookie-parser');
    21→const fs = require('fs');
    22→const https = require('https');
    23→const http = require('http');
    24→const path = require('path');
    25→const crypto = require('crypto');
    26→
    27→// MEDIUM-005: Request ID Tracing Middleware
    28→const { requestIdMiddleware } = require('./middleware/requestId');
    29→
    30→// HIGH-008: Sentry Error Monitoring Integration
    31→let Sentry = null;
    32→if (process.env.SENTRY_DSN) {
    33→  try {
    34→    Sentry = require('@sentry/node');
    35→    console.log('[SPLICE] Sentry module loaded, will initialize after app creation');
    36→  } catch (_err) {
    37→    console.warn('[SPLICE] @sentry/node not installed. Run: npm install @sentry/node');
    38→  }
    39→}
    40→
    41→// Check if running in production (Railway injects RAILWAY_ENVIRONMENT)
    42→const isProduction = process.env.NODE_ENV === 'production' || process.env.RAILWAY_ENVIRONMENT;
    43→
    44→// Import services
    45→const usageTracking = require('./services/usageTracking');
    46→const { requireCredits, requireFeature, ipRateLimit } = require('./middleware/rateLimiter');
    47→const { generateToken, generateRefreshToken, verifyToken, authenticateToken, maskSensitiveData, blacklistToken } = require('./middleware/auth');
    48→const referralService = require('./services/referralService');
    49→const licenseService = require('./services/licenseService');
    50→const emailService = require('./services/emailService');
    51→const { getSupportedLanguages, getAvailableBleepSounds } = require('./services/profanityDetection');
    52→const { getSupportedFormats } = require('./services/captionExporter');
    53→
    54→// Import route modules
    55→const healthRoutes = require('./routes/health');
    56→const analyzeRoutes = require('./routes/analyze');
    57→const silencesRoutes = require('./routes/silences');
    58→const detectionRoutes = require('./routes/detection');
    59→const exportRoutes = require('./routes/export');
    60→const multitrackRoutes = require('./routes/multitrack');
    61→const cutListRoutes = require('./routes/cutList');
    62→const zoomRoutes = require('./routes/zoom');
    63→const chaptersRoutes = require('./routes/chapters');
    64→const youtubeRoutes = require('./routes/youtube');
    65→const captionsRoutes = require('./routes/captions');
    66→const textEditRoutes = require('./routes/textEdit');
    67→const reframeRoutes = require('./routes/reframe');
    68→const batchRoutes = require('./routes/batch');
    69→const authRoutes = require('./routes/auth');
    70→const billingRoutes = require('./routes/billing');
    71→const referralRoutes = require('./routes/referral');
    72→const licenseRoutes = require('./routes/license');
    73→const musicRoutes = require('./routes/music');
    74→
    75→// Music generation worker (BullMQ background processor)
    76→const { createMusicWorker, shutdownWorker } = require('./workers/musicWorker');
    77→let musicWorkerInstance = null; // Track worker for graceful shutdown
    78→
    79→// HIGH-011: API Versioning - v1 routes
    80→const v1Routes = require('./routes/v1');

</system-reminder>
