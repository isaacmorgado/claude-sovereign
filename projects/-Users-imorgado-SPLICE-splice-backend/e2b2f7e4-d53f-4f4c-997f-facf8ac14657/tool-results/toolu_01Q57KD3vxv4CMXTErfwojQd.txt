   140→    errors.push('SENDGRID_API_KEY is required when EMAIL_PROVIDER=sendgrid');
   141→  }
   142→  
   143→  // RECOMMENDED: R2 Storage (warn if missing, don't block)
   144→  if (!process.env.R2_ACCOUNT_ID || !process.env.R2_ACCESS_KEY_ID || !process.env.R2_SECRET_ACCESS_KEY) {
   145→    console.warn('[SPLICE] WARNING: R2 storage credentials not configured. Music generation uploads will fail.');
   146→  }
   147→  
   148→  return {
   149→    valid: errors.length === 0,
   150→    errors
   151→  };
   152→}
   153→
   154→// Run validation in production
   155→if (isProduction) {
   156→  const validation = validateEnvironmentVariables();
   157→  
   158→  if (!validation.valid) {
   159→    console.error('[SPLICE] ========================================');
   160→    console.error('[SPLICE] CRITICAL: Missing required environment variables');
   161→    console.error('[SPLICE] ========================================');
   162→    validation.errors.forEach(error => {
   163→      console.error(`[SPLICE]   ❌ ${error}`);
   164→    });
   165→    console.error('[SPLICE] ========================================');
   166→    console.error('[SPLICE] Server startup aborted. Please configure all required environment variables.');
   167→    console.error('[SPLICE] See .env.example for complete documentation.');
   168→    process.exit(1);
   169→  }
   170→  
   171→  console.log('[SPLICE] ✅ Environment validation passed');
   172→}
   173→
   174→const stripe = new Stripe(process.env.STRIPE_SECRET_KEY, {
   175→  apiVersion: STRIPE_API_VERSION
   176→});
   177→
   178→// =============================================================================
   179→// PERF-FIX: Static Response Cache
   180→// Cache static endpoint responses at startup to avoid repeated computation
   181→// =============================================================================
   182→
   183→// Generate ETag from content
   184→function generateETag(content) {
   185→  return `"${crypto.createHash('md5').update(JSON.stringify(content)).digest('hex')}"`;
   186→}
   187→
   188→// Static response cache - populated at startup
   189→const STATIC_RESPONSE_CACHE = {
   190→  profanityLanguages: null,
   191→  profanityBleeps: null,
   192→  exportFormats: null
   193→};
   194→
   195→// Initialize cache at startup (called after server starts)
   196→function initializeStaticCache() {
   197→  // Cache profanity languages
   198→  const languages = getSupportedLanguages();
   199→  STATIC_RESPONSE_CACHE.profanityLanguages = {
   200→    body: { success: true, languages },
   201→    etag: generateETag({ languages })
   202→  };
   203→
   204→  // Cache profanity bleeps
   205→  const sounds = getAvailableBleepSounds();
   206→  STATIC_RESPONSE_CACHE.profanityBleeps = {
   207→    body: { success: true, sounds },
   208→    etag: generateETag({ sounds })
   209→  };
   210→
   211→  // Cache export formats
   212→  const formats = getSupportedFormats();
   213→  STATIC_RESPONSE_CACHE.exportFormats = {
   214→    body: { success: true, formats },
   215→    etag: generateETag({ formats })
   216→  };
   217→
   218→  console.log('[SPLICE] Static response cache initialized');
   219→}

</system-reminder>
