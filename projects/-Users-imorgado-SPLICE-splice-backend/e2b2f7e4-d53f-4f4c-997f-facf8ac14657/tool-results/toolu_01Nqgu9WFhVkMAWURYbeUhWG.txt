     1→import { NextResponse } from "next/server";
     2→import type { NextRequest } from "next/server";
     3→
     4→// Routes that require authentication
     5→const protectedRoutes = ["/dashboard"];
     6→
     7→// Routes that should redirect to dashboard if already authenticated
     8→const authRoutes = ["/login"];
     9→
    10→export function middleware(request: NextRequest) {
    11→  const { pathname } = request.nextUrl;
    12→
    13→  // Check if the current route is protected
    14→  const isProtectedRoute = protectedRoutes.some(
    15→    (route) => pathname === route || pathname.startsWith(`${route}/`)
    16→  );
    17→
    18→  // Check if the current route is an auth route (login, register, etc.)
    19→  const isAuthRoute = authRoutes.some(
    20→    (route) => pathname === route || pathname.startsWith(`${route}/`)
    21→  );
    22→
    23→  // Check for auth status cookie (non-HttpOnly cookie set by login API)
    24→  // The actual JWT tokens are in HttpOnly cookies and can't be read here
    25→  const authStatusCookie = request.cookies.get("splice_auth_status");
    26→  const isAuthenticated = authStatusCookie?.value === "authenticated";
    27→
    28→  // For protected routes, check authentication
    29→  if (isProtectedRoute) {
    30→    // If no auth status cookie exists, redirect to login
    31→    // The actual token validation will happen server-side via /api/auth/me
    32→    if (!isAuthenticated) {
    33→      const loginUrl = new URL("/login", request.url);
    34→      loginUrl.searchParams.set("redirect", pathname);
    35→      return NextResponse.redirect(loginUrl);
    36→    }
    37→  }
    38→
    39→  // For auth routes, redirect to dashboard if already authenticated
    40→  if (isAuthRoute && isAuthenticated) {
    41→    const redirectTo = request.nextUrl.searchParams.get("redirect") || "/dashboard";
    42→    return NextResponse.redirect(new URL(redirectTo, request.url));
    43→  }
    44→
    45→  return NextResponse.next();
    46→}
    47→
    48→export const config = {
    49→  matcher: [
    50→    /*
    51→     * Match all request paths except for:
    52→     * - api routes (API routes handle their own auth)
    53→     * - _next/static (static files)
    54→     * - _next/image (image optimization files)
    55→     * - favicon.ico (favicon file)
    56→     * - public files (images, downloads, etc.)
    57→     * - files with extensions (.pkg, .exe, .ccx, etc.)
    58→     */
    59→    "/((?!api|_next/static|_next/image|favicon.ico|images|downloads|.*\\..*).*)",
    60→  ],
    61→};
    62→

</system-reminder>
