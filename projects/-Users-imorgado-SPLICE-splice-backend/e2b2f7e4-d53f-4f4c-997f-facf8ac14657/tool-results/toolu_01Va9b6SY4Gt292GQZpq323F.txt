   220→
   221→// Helper to send cached response with ETag
   222→function sendCachedResponse(req, res, cacheKey) {
   223→  const cached = STATIC_RESPONSE_CACHE[cacheKey];
   224→  if (!cached) {
   225→    return res.status(500).json({ error: 'Cache not initialized' });
   226→  }
   227→
   228→  // Check If-None-Match header for conditional GET
   229→  const clientETag = req.headers['if-none-match'];
   230→  if (clientETag === cached.etag) {
   231→    return res.status(304).end(); // Not Modified
   232→  }
   233→
   234→  // Send cached response with ETag and cache headers
   235→  res.set('ETag', cached.etag);
   236→  res.set('Cache-Control', 'public, max-age=86400'); // Cache for 24 hours
   237→  res.json(cached.body);
   238→}
   239→
   240→// =============================================================================
   241→// Server Configuration
   242→// =============================================================================
   243→
   244→const app = express();
   245→const PORT = process.env.PORT || 3847;
   246→
   247→// HIGH-008: Initialize Sentry after app creation
   248→if (Sentry && process.env.SENTRY_DSN) {
   249→  Sentry.init({
   250→    dsn: process.env.SENTRY_DSN,
   251→    environment: process.env.NODE_ENV || 'development',
   252→    release: process.env.npm_package_version || '6.0.3',
   253→    tracesSampleRate: isProduction ? 0.1 : 1.0, // 10% in prod, 100% in dev
   254→    profilesSampleRate: isProduction ? 0.1 : 0, // Profile only in production
   255→    integrations: [
   256→      // Automatically instrument HTTP requests
   257→      Sentry.httpIntegration({ tracing: true }),
   258→      // Automatically instrument Express
   259→      Sentry.expressIntegration({ app }),
   260→    ],
   261→    // Filter out sensitive data
   262→    beforeSend(event) {
   263→      // Remove sensitive headers
   264→      if (event.request && event.request.headers) {
   265→        delete event.request.headers.authorization;
   266→        delete event.request.headers['x-stripe-customer-id'];
   267→        delete event.request.headers['stripe-signature'];
   268→      }
   269→      return event;
   270→    },
   271→  });
   272→  
   273→  // Add Sentry request handler as first middleware
   274→  app.use(Sentry.Handlers.requestHandler());
   275→  app.use(Sentry.Handlers.tracingHandler());
   276→  
   277→  console.log('[SPLICE] ✅ Sentry error monitoring initialized');
   278→}
   279→
   280→// MEDIUM-005: Request ID Tracing Middleware
   281→// Add early in chain to ensure all requests have correlation IDs for logging
   282→app.use(requestIdMiddleware);
   283→
   284→// HTTPS certificates (generated by mkcert) - only for local development
   285→let httpsOptions = null;
   286→if (!isProduction) {
   287→  const keyPath = path.join(__dirname, 'localhost+1-key.pem');
   288→  const certPath = path.join(__dirname, 'localhost+1.pem');
   289→  if (fs.existsSync(keyPath) && fs.existsSync(certPath)) {
   290→    httpsOptions = {
   291→      key: fs.readFileSync(keyPath),
   292→      cert: fs.readFileSync(certPath)
   293→    };
   294→  }
   295→}
   296→
   297→// =============================================================================
   298→// Security Configuration
   299→// =============================================================================
   300→
   301→// CORS whitelist - restrict origins in production
   302→const CORS_WHITELIST = [
   303→  'http://localhost:3000',
   304→  'http://localhost:3847',
   305→  'https://localhost:3847',
   306→  'http://127.0.0.1:3000',
   307→  'http://127.0.0.1:3847',
   308→  'https://127.0.0.1:3847',
   309→  'https://splice.app',
   310→  'https://www.splice.app',
   311→  'https://splice.video',
   312→  'https://www.splice.video',
   313→  'https://spliceclips.com',
   314→  'https://www.spliceclips.com',
   315→  'https://splice-api-production.up.railway.app',
   316→  'https://splice-website.vercel.app',
   317→  'https://splice-dusky.vercel.app',
   318→  // Adobe CEP/UXP panels run from file:// or bolt://
   319→  'file://',

</system-reminder>
