The file /Users/imorgado/SPLICE/splice-backend/server.js has been updated. Here's the result of running `cat -n` on a snippet of the edited file:
   355→
   356→// IP-based rate limiting (100 requests/minute per IP)
   357→app.use(ipRateLimit);
   358→
   359→// Security headers via helmet
   360→app.use(helmet({
   361→  contentSecurityPolicy: {
   362→    directives: {
   363→      defaultSrc: ["'self'"],
   364→      scriptSrc: ["'self'"],
   365→      styleSrc: ["'self'", "'unsafe-inline'"],
   366→      imgSrc: ["'self'", 'data:', 'https:'],
   367→      connectSrc: ["'self'", 'https://api.stripe.com', 'https://api.openai.com', 'https://api.replicate.com'],
   368→      fontSrc: ["'self'"],
   369→      objectSrc: ["'none'"],
   370→      mediaSrc: ["'self'"],
   371→      frameSrc: ["'none'"]
   372→    }
   373→  },
   374→  hsts: {
   375→    maxAge: 31536000,
   376→    includeSubDomains: true,
   377→    preload: true
   378→  },
   379→  referrerPolicy: { policy: 'strict-origin-when-cross-origin' },
   380→  noSniff: true,
   381→  xssFilter: true,
   382→  hidePoweredBy: true
   383→}));
   384→
   385→// PERF-003: Response compression (gzip/deflate) - reduces payload size by 40-60%
   386→app.use(compression({
   387→  // Only compress responses > 1KB
   388→  threshold: 1024,
   389→  // Compression level (0-9), 6 is a good balance between speed and compression
   390→  level: 6,
   391→  // Skip compression if client sends x-no-compression header
   392→  filter: (req, res) => {
   393→    if (req.headers['x-no-compression']) {
   394→      return false;
   395→    }
   396→    // Use compression's default filter (compresses text-based responses)
   397→    return compression.filter(req, res);
   398→  }
   399→}));
   400→
   401→// Helper to determine tier from price ID with logging
   402→// Supports both monthly and annual pricing
   403→function getTierFromPriceId(priceId) {