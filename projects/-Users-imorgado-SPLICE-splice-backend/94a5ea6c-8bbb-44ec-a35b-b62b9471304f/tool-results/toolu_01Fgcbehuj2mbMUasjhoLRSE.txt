     1→# SPLICE Phase 6 - License Key Activation System
     2→
     3→## Status
     4→Phase 5 done. 187 tests passing. Security fixed. Referral system complete. License key activation needed.
     5→
     6→## Key Files
     7→```
     8→splice-backend/server.js                    # Add /license/activate endpoint
     9→splice-backend/services/usageTracking.js    # Has Stripe webhooks, user creation
    10→splice-backend/services/referralService.js  # Reference for key generation pattern
    11→splice-plugin/js/settings.js                # Login modal (change to license key input)
    12→splice-plugin/index.html                    # Modal HTML (customerIdInput → licenseKeyInput)
    13→splice-backend/tests/                       # Add phase6-license.test.js
    14→```
    15→
    16→## Tasks
    17→
    18→### 1. License Key Service
    19→Create `splice-backend/services/licenseService.js`:
    20→- `license_keys` table: `key VARCHAR(19) UNIQUE, stripe_customer_id, created_at, activated_at, is_active`
    21→- Key format: `SPLICE-XXXX-XXXX-XXXX` (alphanumeric, no confusing chars)
    22→- `generateLicenseKey(stripeCustomerId)` - create key on purchase
    23→- `activateLicenseKey(key)` - validate and return customer ID
    24→- `getLicenseByCustomerId(customerId)` - lookup existing key
    25→
    26→### 2. Stripe Webhook Integration
    27→In `server.js` webhook handler (`customer.subscription.created`):
    28→- Generate license key for new customer
    29→- Store in database
    30→
    31→### 3. Activation Endpoint
    32→`POST /license/activate` - Body: `{ key: "SPLICE-XXXX-XXXX-XXXX" }`
    33→- Validate key format
    34→- Look up in database
    35→- Return `{ success, customerId, tier, hoursRemaining }`
    36→
    37→### 4. Plugin UI Update
    38→In `settings.js` and `index.html`:
    39→- Change "Customer ID" → "License Key"
    40→- Update input validation (SPLICE-XXXX-XXXX-XXXX format)
    41→- Call `/license/activate` instead of directly saving customer ID
    42→
    43→## Testing Protocol
    44→
    45→After EACH feature:
    46→1. Create E2E test for the feature
    47→2. Run: `node tests/phase6-license.test.js`
    48→3. Check for bugs, bottlenecks (>5ms operations)
    49→4. If bug found → fix → retest until perfect
    50→5. Move to next feature
    51→
    52→After ALL features:
    53→1. Run ALL tests: `node tests/*.test.js`
    54→2. Verify UI wiring (modal shows, validates, activates)
    55→3. Check no regressions (187+ tests should pass)
    56→
    57→## Commands
    58→```bash
    59→cd /Users/imorgado/SPLICE/splice-backend
    60→node server.js
    61→node tests/phase6-license.test.js
    62→curl -sk https://127.0.0.1:3847/health
    63→```
    64→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
