   450→    return {
   451→      success: true,
   452→      path: folderPath,
   453→      token
   454→    };
   455→  } catch (err) {
   456→    console.error('[SPLICE] Error setting up media folder:', err);
   457→    return { success: false, error: err.message };
   458→  }
   459→}
   460→
   461→/**
   462→ * Get the media folder entry using the stored persistent token.
   463→ * Falls back to prompting if token is invalid.
   464→ *
   465→ * @returns {Promise<Object|null>} The folder entry or null
   466→ */
   467→async function getMediaFolder() {
   468→  // Return cached entry if available
   469→  if (mediaFolderEntry) {
   470→    return mediaFolderEntry;
   471→  }
   472→
   473→  const settings = getSettings();
   474→
   475→  // Try to restore from persistent token
   476→  if (settings.mediaFolderToken) {
   477→    try {
   478→      const folder = await uxpFs.getEntryForPersistentToken(settings.mediaFolderToken);
   479→      if (folder) {
   480→        mediaFolderEntry = folder;
   481→        console.log(`[SPLICE] Restored media folder from token: ${settings.mediaFolderPath}`);
   482→        return folder;
   483→      }
   484→    } catch (err) {
   485→      console.warn('[SPLICE] Could not restore media folder from token:', err.message);
   486→      // Clear invalid token
   487→      saveSettings({ mediaFolderToken: null, mediaFolderPath: null });
   488→    }
   489→  }
   490→
   491→  return null;
   492→}
   493→
   494→/**
   495→ * Check if a media folder is configured
   496→ * @returns {boolean}
   497→ */
   498→function hasMediaFolder() {
   499→  const settings = getSettings();
   500→  return !!settings.mediaFolderToken;
   501→}
   502→
   503→/**
   504→ * Get the configured media folder path (for display)
   505→ * @returns {string|null}
   506→ */
   507→function getMediaFolderPath() {
   508→  const settings = getSettings();
   509→  return settings.mediaFolderPath;
   510→}
   511→
   512→/**
   513→ * Clear the media folder configuration
   514→ */
   515→function clearMediaFolder() {
   516→  mediaFolderEntry = null;
   517→  saveSettings({
   518→    mediaFolderToken: null,
   519→    mediaFolderPath: null
   520→  });
   521→  console.log('[SPLICE] Media folder cleared');
   522→}
   523→
   524→/**
   525→ * Read a file from the media folder
   526→ * @param {string} filename - Name of the file to read
   527→ * @returns {Promise<ArrayBuffer|null>} File contents or null
   528→ */
   529→async function readMediaFile(filename) {
   530→  const folder = await getMediaFolder();
   531→  if (!folder) {
   532→    console.warn('[SPLICE] No media folder configured');
   533→    return null;
   534→  }
   535→
   536→  try {
   537→    const file = await folder.getEntry(filename);
   538→    if (!file) {
   539→      console.warn(`[SPLICE] File not found in media folder: ${filename}`);
   540→      return null;
   541→    }
   542→
   543→    const contents = await file.read({ format: uxpFs.formats.binary });
   544→    return contents;
   545→  } catch (err) {
   546→    console.error(`[SPLICE] Error reading file ${filename}:`, err);
   547→    return null;
   548→  }
   549→}
   550→
   551→// Load settings on script load
   552→loadSettings();
   553→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
