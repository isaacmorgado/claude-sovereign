     1→<!DOCTYPE html>
     2→<html lang="en">
     3→
     4→<head>
     5→    <meta charset="UTF-8">
     6→    <meta name="viewport" content="width=device-width, initial-scale=1.0">
     7→    <title>SPLICE CEP - Simulation Mode</title>
     8→    <link rel="stylesheet" href="panel/css/style.css">
     9→    <style>
    10→        /* Simulation Mode Indicator */
    11→        .simulation-banner {
    12→            position: fixed;
    13→            top: 0;
    14→            left: 0;
    15→            right: 0;
    16→            background: linear-gradient(90deg, #ff6b6b, #feca57, #48dbfb, #ff9ff3);
    17→            color: #1a1a2e;
    18→            text-align: center;
    19→            padding: 4px 10px;
    20→            font-size: 11px;
    21→            font-weight: 600;
    22→            z-index: 9999;
    23→            display: flex;
    24→            justify-content: center;
    25→            align-items: center;
    26→            gap: 15px;
    27→        }
    28→
    29→        .simulation-banner button {
    30→            background: #1a1a2e;
    31→            color: #fff;
    32→            border: none;
    33→            padding: 3px 10px;
    34→            border-radius: 4px;
    35→            cursor: pointer;
    36→            font-size: 10px;
    37→            font-weight: 600;
    38→        }
    39→
    40→        .simulation-banner button:hover {
    41→            background: #333;
    42→        }
    43→
    44→        /* Offset body for banner */
    45→        body {
    46→            margin-top: 28px !important;
    47→        }
    48→
    49→        /* Test Panel Overlay */
    50→        #test-panel {
    51→            position: fixed;
    52→            top: 28px;
    53→            right: 0;
    54→            width: 320px;
    55→            height: calc(100vh - 28px);
    56→            background: #1a1a2e;
    57→            border-left: 2px solid #00d1b2;
    58→            overflow-y: auto;
    59→            z-index: 9998;
    60→            display: none;
    61→            padding: 15px;
    62→            box-sizing: border-box;
    63→        }
    64→
    65→        #test-panel.visible {
    66→            display: block;
    67→        }
    68→
    69→        #test-panel h2 {
    70→            color: #00d1b2;
    71→            font-size: 14px;
    72→            margin: 0 0 15px 0;
    73→            padding-bottom: 10px;
    74→            border-bottom: 1px solid #333;
    75→        }
    76→
    77→        #test-panel .test-controls {
    78→            display: flex;
    79→            flex-wrap: wrap;
    80→            gap: 8px;
    81→            margin-bottom: 15px;
    82→        }
    83→
    84→        #test-panel .test-controls button {
    85→            flex: 1 1 45%;
    86→            padding: 8px;
    87→            font-size: 11px;
    88→            background: #2d2d44;
    89→            border: 1px solid #00d1b2;
    90→            color: #00d1b2;
    91→            border-radius: 4px;
    92→            cursor: pointer;
    93→        }
    94→
    95→        #test-panel .test-controls button:hover {
    96→            background: #00d1b2;
    97→            color: #1a1a2e;
    98→        }
    99→
   100→        #test-panel .test-controls button.run-all {
   101→            flex: 1 1 100%;
   102→            font-weight: bold;
   103→            font-size: 12px;
   104→        }
   105→
   106→        #test-log {
   107→            background: #0d0d15;
   108→            border: 1px solid #333;
   109→            border-radius: 4px;
   110→            padding: 10px;
   111→            font-family: 'Monaco', 'Menlo', monospace;
   112→            font-size: 10px;
   113→            max-height: 400px;
   114→            overflow-y: auto;
   115→            white-space: pre-wrap;
   116→            color: #aaa;
   117→        }
   118→
   119→        #test-log .pass {
   120→            color: #00ff00;
   121→        }
   122→
   123→        #test-log .fail {
   124→            color: #ff0000;
   125→        }
   126→
   127→        #test-log .skip {
   128→            color: #ffaa00;
   129→        }
   130→
   131→        #test-log .suite {
   132→            color: #00d1b2;
   133→            font-weight: bold;
   134→        }
   135→
   136→        /* Shrink main content when test panel is visible */
   137→        body.test-panel-open {
   138→            margin-right: 320px;
   139→        }
   140→
   141→        /* Console output styling */
   142→        #console-output {
   143→            background: #0d0d15;
   144→            border: 1px solid #333;
   145→            border-radius: 4px;
   146→            padding: 10px;
   147→            font-family: 'Monaco', 'Menlo', monospace;
   148→            font-size: 10px;
   149→            max-height: 200px;
   150→            overflow-y: auto;
   151→            margin-top: 15px;
   152→            color: #888;
   153→        }
   154→
   155→        #console-output .log {
   156→            color: #aaa;
   157→        }
   158→
   159→        #console-output .warn {
   160→            color: #ffaa00;
   161→        }
   162→
   163→        #console-output .error {
   164→            color: #ff6b6b;
   165→        }
   166→
   167→        /* Stats display */
   168→        .test-stats {
   169→            display: flex;
   170→            justify-content: space-around;
   171→            padding: 10px;
   172→            background: #2d2d44;
   173→            border-radius: 4px;
   174→            margin-bottom: 15px;
   175→        }
   176→
   177→        .test-stats .stat {
   178→            text-align: center;
   179→        }
   180→
   181→        .test-stats .stat-value {
   182→            font-size: 24px;
   183→            font-weight: bold;
   184→        }
   185→
   186→        .test-stats .stat-label {
   187→            font-size: 10px;
   188→            color: #888;
   189→        }
   190→
   191→        .test-stats .passed .stat-value {
   192→            color: #00ff00;
   193→        }
   194→
   195→        .test-stats .failed .stat-value {
   196→            color: #ff0000;
   197→        }
   198→
   199→        .test-stats .skipped .stat-value {
   200→            color: #ffaa00;
   201→        }
   202→
   203→        /* Custom Text Presets Styles - Matching CEP Design System */
   204→        .text-presets-section {
   205→            background: rgba(30, 30, 30, 0.6);
   206→            backdrop-filter: blur(10px);
   207→            border: 1px solid rgba(255, 255, 255, 0.08);
   208→            border-radius: 12px;
   209→            margin-bottom: 16px;
   210→            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
   211→        }
   212→
   213→        .text-presets-panel {
   214→            padding: 0 12px 12px;
   215→            border-top: 1px solid rgba(255, 255, 255, 0.08);
   216→        }
   217→
   218→        .text-presets-panel.collapsed {
   219→            display: none;
   220→        }
   221→
   222→        /* Presets Gallery */
   223→        .presets-gallery {
   224→            margin-bottom: 12px;
   225→        }
   226→
   227→        .presets-gallery > label {
   228→            display: block;
   229→            font-size: 10px;
   230→            color: #888;
   231→            margin-bottom: 6px;
   232→            text-transform: uppercase;
   233→            letter-spacing: 0.5px;
   234→            font-weight: 500;
   235→        }
   236→
   237→        .presets-gallery-list {
   238→            display: flex;
   239→            flex-wrap: wrap;
   240→            gap: 6px;
   241→            padding: 8px;
   242→            background: rgba(0, 0, 0, 0.3);
   243→            border-radius: 6px;
   244→            min-height: 40px;
   245→            border: 1px solid rgba(255, 255, 255, 0.05);
   246→        }
   247→
   248→        .preset-item {
   249→            display: flex;
   250→            align-items: center;
   251→            gap: 6px;
   252→            padding: 5px 10px;
   253→            background: rgba(255, 255, 255, 0.05);
   254→            border-radius: 4px;
   255→            cursor: pointer;
   256→            font-size: 10px;
   257→            border: 1px solid transparent;
   258→            transition: all 0.2s cubic-bezier(0.4, 0.0, 0.2, 1);
   259→            color: #e1e1e1;
   260→        }
   261→
   262→        .preset-item:hover {
   263→            background: rgba(255, 255, 255, 0.1);
   264→            border-color: rgba(74, 158, 255, 0.3);
   265→        }
   266→
   267→        .preset-item.active {
   268→            background: linear-gradient(135deg, #4a9eff, #a64dff);
   269→            color: #fff;
   270→            border-color: transparent;
   271→        }
   272→
   273→        .preset-item .delete-preset {
   274→            opacity: 0.4;
   275→            cursor: pointer;
   276→            font-size: 12px;
   277→            transition: all 0.2s;
   278→        }
   279→
   280→        .preset-item .delete-preset:hover {
   281→            opacity: 1;
   282→            color: #ff5252;
   283→        }
   284→
   285→        .preset-empty {
   286→            color: #666;
   287→            font-size: 10px;
   288→            padding: 8px;
   289→            text-align: center;
   290→            width: 100%;
   291→            font-style: italic;
   292→        }
   293→
   294→        /* Preset Editor */
   295→        .preset-editor {
   296→            background: rgba(0, 0, 0, 0.2);
   297→            border-radius: 8px;
   298→            padding: 12px;
   299→            margin-bottom: 12px;
   300→            border: 1px solid rgba(255, 255, 255, 0.05);
   301→        }
   302→
   303→        .preset-colors {
   304→            display: flex;
   305→            gap: 8px;
   306→            margin-bottom: 8px;
   307→        }
   308→
   309→        .preset-colors .form-group {
   310→            flex: 1;
   311→        }
   312→
   313→        .preset-colors input[type="color"] {
   314→            width: 100%;
   315→            height: 28px;
   316→            border: 1px solid rgba(255, 255, 255, 0.08);
   317→            border-radius: 4px;
   318→            cursor: pointer;
   319→            background: rgba(0, 0, 0, 0.3);
   320→            padding: 2px;
   321→        }
   322→
   323→        .preset-colors input[type="color"]:hover {
   324→            border-color: rgba(74, 158, 255, 0.5);
   325→        }
   326→
   327→        .preset-effects {
   328→            display: flex;
   329→            flex-wrap: wrap;
   330→            gap: 12px;
   331→            margin: 10px 0;
   332→            padding: 8px 0;
   333→            border-top: 1px solid rgba(255, 255, 255, 0.05);
   334→            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
   335→        }
   336→
   337→        .preset-effects .checkbox-label {
   338→            margin-bottom: 0;
   339→            font-size: 10px;
   340→        }
   341→
   342→        /* Preview Container */
   343→        .preset-preview-container {
   344→            margin-top: 12px;
   345→        }
   346→
   347→        .preset-preview-container > label {
   348→            display: block;
   349→            font-size: 10px;
   350→            color: #888;
   351→            margin-bottom: 6px;
   352→            text-transform: uppercase;
   353→            letter-spacing: 0.5px;
   354→            font-weight: 500;
   355→        }
   356→
   357→        .preset-preview {
   358→            background: linear-gradient(135deg, rgba(0,0,0,0.4) 0%, rgba(30,30,30,0.6) 100%);
   359→            border-radius: 8px;
   360→            padding: 24px 16px;
   361→            text-align: center;
   362→            min-height: 70px;
   363→            display: flex;
   364→            align-items: center;
   365→            justify-content: center;
   366→            position: relative;
   367→            overflow: hidden;
   368→            border: 1px solid rgba(255, 255, 255, 0.05);
   369→        }
   370→
   371→        .preset-preview::before {
   372→            content: 'VIDEO PREVIEW';
   373→            position: absolute;
   374→            top: 50%;
   375→            left: 50%;
   376→            transform: translate(-50%, -50%);
   377→            font-size: 10px;
   378→            color: rgba(255, 255, 255, 0.1);
   379→            letter-spacing: 2px;
   380→            font-weight: 600;
   381→        }
   382→
   383→        #preset-preview-text {
   384→            position: relative;
   385→            z-index: 1;
   386→            padding: 6px 14px;
   387→            border-radius: 4px;
   388→            transition: all 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
   389→        }
   390→
   391→        /* Action Buttons */
   392→        .preset-actions {
   393→            display: flex;
   394→            gap: 8px;
   395→            margin-bottom: 10px;
   396→        }
   397→
   398→        .preset-actions button {
   399→            flex: 1;
   400→            padding: 8px 12px;
   401→            font-size: 11px;
   402→            font-weight: 500;
   403→        }
   404→
   405→        .preset-io {
   406→            display: flex;
   407→            gap: 8px;
   408→            padding-top: 10px;
   409→            border-top: 1px solid rgba(255, 255, 255, 0.08);
   410→        }
   411→
   412→        .preset-io button {
   413→            flex: 1;
   414→            font-size: 10px;
   415→            padding: 6px 10px;
   416→        }
   417→
   418→        /* Custom Font Upload Styles */
   419→        .font-selector-row {
   420→            display: flex;
   421→            gap: 6px;
   422→            align-items: center;
   423→        }
   424→
   425→        .font-selector-row select {
   426→            flex: 1;
   427→        }
   428→
   429→        .font-selector-row button {
   430→            padding: 5px 10px;
   431→            min-width: 32px;
   432→            height: 28px;
   433→            font-size: 14px;
   434→            line-height: 1;
   435→            background: rgba(255, 255, 255, 0.05);
   436→            border: 1px solid rgba(255, 255, 255, 0.08);
   437→            border-radius: 4px;
   438→            color: #888;
   439→            cursor: pointer;
   440→            transition: all 0.2s;
   441→        }
   442→
   443→        .font-selector-row button:hover {
   444→            background: rgba(74, 158, 255, 0.2);
   445→            border-color: rgba(74, 158, 255, 0.5);
   446→            color: #4a9eff;
   447→        }
   448→
   449→        .custom-fonts-manager {
   450→            margin: 8px 0;
   451→        }
   452→
   453→        .custom-fonts-list {
   454→            display: flex;
   455→            flex-wrap: wrap;
   456→            gap: 4px;
   457→        }
   458→
   459→        .custom-font-item {
   460→            display: flex;
   461→            align-items: center;
   462→            gap: 4px;
   463→            padding: 3px 6px;
   464→            background: rgba(74, 158, 255, 0.1);
   465→            border: 1px solid rgba(74, 158, 255, 0.2);
   466→            border-radius: 3px;
   467→            font-size: 9px;
   468→            color: #4a9eff;
   469→        }
   470→
   471→        .custom-font-item .font-name {
   472→            max-width: 80px;
   473→            overflow: hidden;
   474→            text-overflow: ellipsis;
   475→            white-space: nowrap;
   476→        }
   477→
   478→        .custom-font-item .delete-font {
   479→            cursor: pointer;
   480→            opacity: 0.5;
   481→            font-size: 10px;
   482→            transition: all 0.2s;
   483→        }
   484→
   485→        .custom-font-item .delete-font:hover {
   486→            opacity: 1;
   487→            color: #ff5252;
   488→        }
   489→
   490→        .font-upload-progress {
   491→            font-size: 9px;
   492→            color: #00e676;
   493→            padding: 4px 0;
   494→            font-weight: 500;
   495→        }
   496→    </style>
   497→</head>
   498→
   499→<body>
   500→    <!-- Simulation Banner -->
   501→    <div class="simulation-banner">
   502→        <span>SIMULATION MODE - Not connected to Premiere Pro</span>
   503→        <button id="toggle-test-panel">Show Tests</button>
   504→        <button id="run-quick-test">Quick Test</button>
   505→        <button id="run-all-tests">Run All Tests</button>
   506→    </div>
   507→
   508→    <!-- Test Panel -->
   509→    <div id="test-panel">
   510→        <h2>Test Runner</h2>
   511→
   512→        <div class="test-stats">
   513→            <div class="stat passed">
   514→                <div class="stat-value" id="stat-passed">0</div>
   515→                <div class="stat-label">Passed</div>
   516→            </div>
   517→            <div class="stat failed">
   518→                <div class="stat-value" id="stat-failed">0</div>
   519→                <div class="stat-label">Failed</div>
   520→            </div>
   521→            <div class="stat skipped">
   522→                <div class="stat-value" id="stat-skipped">0</div>
   523→                <div class="stat-label">Skipped</div>
   524→            </div>
   525→        </div>
   526→
   527→        <div class="test-controls">
   528→            <button class="run-all" onclick="runAllTestsWithUI()">Run All Tests</button>
   529→            <button onclick="runSuite('quickEdit')">Quick Edit</button>
   530→            <button onclick="runSuite('multitrack')">Multitrack</button>
   531→            <button onclick="runSuite('captions')">Captions</button>
   532→            <button onclick="runSuite('textEditor')">Text Editor</button>
   533→            <button onclick="runSuite('socialReframe')">Social Reframe</button>
   534→            <button onclick="runSuite('music')">Music</button>
   535→            <button onclick="runSuite('authentication')">Auth</button>
   536→            <button onclick="runSuite('edgeCases')">Edge Cases</button>
   537→            <button onclick="runSuite('uiState')">UI State</button>
   538→            <button onclick="runSuite('jsxBridge')">JSX Bridge</button>
   539→            <button onclick="runSuite('globalState')">Global State</button>
   540→            <button onclick="runSuite('audioSource')">Audio Source</button>
   541→            <button onclick="runSuite('profanity')">Profanity</button>
   542→            <button onclick="runSuite('chapters')">Chapters</button>
   543→            <button onclick="runSuite('fillers')">Fillers</button>
   544→            <button onclick="runSuite('takes')">Takes</button>
   545→            <button onclick="runSuite('zoom')">Zoom</button>
   546→            <button onclick="runSuite('combined')">Combined</button>
   547→            <button onclick="runSuite('textPresets')">Text Presets</button>
   548→        </div>
   549→
   550→        <h3 style="color: #888; font-size: 11px; margin: 10px 0 5px;">Test Output</h3>
   551→        <div id="test-log"></div>
   552→
   553→        <h3 style="color: #888; font-size: 11px; margin: 15px 0 5px;">Console Log</h3>
   554→        <div id="console-output"></div>
   555→    </div>
   556→
   557→    <!-- Loading Overlay -->
   558→    <div id="loading-overlay">
   559→        <div class="loader-logo"></div>
   560→        <div class="loader-text">Initializing Antigravity...</div>
   561→    </div>
   562→
   563→    <!-- Header -->
   564→    <div class="header">
   565→        <h1>SPLICE</h1>
   566→        <div class="header-actions">
   567→            <div id="creditBadge" class="credit-badge login">Login</div>
   568→            <button id="helpBtn" class="icon-btn" title="Help">?</button>
   569→            <button id="settingsBtn" class="icon-btn" title="Settings">⚙</button>
   570→        </div>
   571→    </div>
   572→
   573→    <!-- Status Bar -->
   574→    <div id="status" role="status" aria-live="polite">Ready</div>
   575→
   576→    <!-- Main Action Card -->
   577→    <div class="action-card">
   578→        <h2>Quick Edit</h2>
   579→
   580→        <!-- GO Button -->
   581→        <button id="goBtn" class="go-btn" aria-label="Start detection">GO</button>
   582→
   583→        <!-- Options Toggle -->
   584→        <button id="optionsToggle" class="options-toggle" aria-expanded="false">Options</button>
   585→
   586→        <!-- Options Panel -->
   587→        <div id="optionsPanel" class="options-panel collapsed">
   588→            <!-- Preset Selector -->
   589→            <div class="form-group">
   590→                <label for="presetSelector">Preset</label>
   591→                <select id="presetSelector">
   592→                    <option value="podcast">Podcast</option>
   593→                    <option value="interview">Interview</option>
   594→                    <option value="reaction">Reaction</option>
   595→                    <option value="tutorial">Tutorial</option>
   596→                    <option value="vlog">Vlog</option>
   597→                    <option value="custom">Custom</option>
   598→                </select>
   599→            </div>
   600→
   601→            <!-- Sensitivity Slider -->
   602→            <div class="slider-container">
   603→                <label for="sensitivitySlider">Sensitivity: <span id="sensitivityValue">50</span></label>
   604→                <input type="range" id="sensitivitySlider" min="0" max="100" value="50">
   605→                <div class="slider-labels">
   606→                    <span>Less cuts</span>
   607→                    <span>More cuts</span>
   608→                </div>
   609→            </div>
   610→
   611→            <!-- Audio Source -->
   612→            <div class="audio-source-group">
   613→                <label>Audio Source</label>
   614→                <label class="checkbox-label">
   615→                    <input type="checkbox" id="sourceOriginal" checked>
   616→                    Original Audio
   617→                </label>
   618→                <label class="checkbox-label">
   619→                    <input type="checkbox" id="sourceIsolated">
   620→                    Isolated Vocals <span class="tier-badge">PRO</span>
   621→                </label>
   622→            </div>
   623→
   624→            <!-- Feature Toggles -->
   625→            <div class="feature-toggles">
   626→                <label class="checkbox-label">
   627→                    <input type="checkbox" id="enableTakesDetection" checked>
   628→                    Detect Takes
   629→                </label>
   630→
   631→                <label class="checkbox-label">
   632→                    <input type="checkbox" id="enableJCut">
   633→                    J-Cut / L-Cut
   634→                </label>
   635→                <div id="jcutSettings" class="sub-options collapsed">
   636→                    <div class="slider-container small">
   637→                        <label>Lead In: <span id="jcutLeadInValue">0.30s</span></label>
   638→                        <input type="range" id="jcutLeadIn" min="0" max="100" value="30">
   639→                    </div>
   640→                    <div class="slider-container small">
   641→                        <label>Lead Out: <span id="jcutLeadOutValue">0.20s</span></label>
   642→                        <input type="range" id="jcutLeadOut" min="0" max="100" value="20">
   643→                    </div>
   644→                </div>
   645→
   646→                <label class="checkbox-label">
   647→                    <input type="checkbox" id="enableZoom">
   648→                    Auto Zoom
   649→                </label>
   650→                <div id="zoomSettings" class="sub-options collapsed">
   651→                    <div class="form-group small">
   652→                        <label>Frequency</label>
   653→                        <select id="zoomFrequency">
   654→                            <option value="low">Low (~1/min)</option>
   655→                            <option value="medium" selected>Medium (~2/min)</option>
   656→                            <option value="high">High (~4/min)</option>
   657→                        </select>
   658→                    </div>
   659→                    <div class="form-group small">
   660→                        <label>Intensity</label>
   661→                        <select id="zoomPreset">
   662→                            <option value="subtle">Subtle (110%)</option>
   663→                            <option value="medium" selected>Medium (120%)</option>
   664→                            <option value="dramatic">Dramatic (140%)</option>
   665→                        </select>
   666→                    </div>
   667→                    <div class="form-group small">
   668→                        <label>Placement</label>
   669→                        <select id="zoomPlacement">
   670→                            <option value="sentence_start" selected>Sentence Starts</option>
   671→                            <option value="keywords">Keywords</option>
   672→                            <option value="random">Random</option>
   673→                        </select>
   674→                    </div>
   675→                </div>
   676→
   677→                <label class="checkbox-label">
   678→                    <input type="checkbox" id="enableChapters">
   679→                    Detect Chapters
   680→                </label>
   681→                <div id="chapterSettings" class="sub-options collapsed">
   682→                    <div class="form-group small">
   683→                        <label>Max Chapters</label>
   684→                        <input type="number" id="maxChapters" min="1" max="50" value="10">
   685→                    </div>
   686→                    <div class="form-group small">
   687→                        <label>Min Length (s)</label>
   688→                        <input type="number" id="minChapterLength" min="30" max="600" value="60">
   689→                    </div>
   690→                </div>
   691→
   692→                <!-- Profanity Bleeping -->
   693→                <label class="checkbox-label">
   694→                    <input type="checkbox" id="enableProfanity">
   695→                    Profanity Detection
   696→                </label>
   697→                <div id="profanitySettings" class="sub-options collapsed">
   698→                    <div class="form-group small">
   699→                        <label>Bleep Type</label>
   700→                        <select id="bleepType">
   701→                            <option value="standard">Standard (1kHz)</option>
   702→                            <option value="tv">TV Bleep</option>
   703→                            <option value="radio">Radio Bleep</option>
   704→                            <option value="duck">Duck Audio</option>
   705→                            <option value="mute">Mute</option>
   706→                        </select>
   707→                    </div>
   708→                    <div class="form-group small">
   709→                        <label>Volume</label>
   710→                        <input type="range" id="bleepVolume" min="0" max="100" value="50">
   711→                    </div>
   712→                    <label class="checkbox-label">
   713→                        <input type="checkbox" id="enableBleepInsertion">
   714→                        Auto-insert bleeps
   715→                    </label>
   716→                </div>
   717→
   718→                <!-- Filler Word Detection -->
   719→                <label class="checkbox-label">
   720→                    <input type="checkbox" id="enableFillerDetection">
   721→                    Filler Word Detection
   722→                </label>
   723→                <div id="fillerSettings" class="sub-options collapsed">
   724→                    <div class="form-group small">
   725→                        <label>Custom Fillers</label>
   726→                        <input type="text" id="customFillers" placeholder="basically, literally">
   727→                    </div>
   728→                    <button id="detectFillersBtn" class="btn btn-small">Detect Fillers</button>
   729→                    <button id="removeFillersBtn" class="btn btn-small btn-secondary" disabled>Remove Fillers</button>
   730→                </div>
   731→            </div>
   732→        </div>
   733→    </div>
   734→
   735→    <!-- Multitrack Section -->
   736→    <div id="multitrackSection" class="multitrack-section">
   737→        <div id="multitrackToggle" class="section-toggle">
   738→            <span class="toggle-icon">+</span>
   739→            <span>Multitrack / Multi-Speaker</span>
   740→        </div>
   741→        <div id="multitrackPanel" class="multitrack-panel collapsed">
   742→            <!-- Speaker Configuration -->
   743→            <div class="speaker-config">
   744→                <div class="speaker-config-header">
   745→                    <span>Speakers</span>
   746→                    <button id="addSpeakerBtn" class="btn btn-small">+ Add</button>
   747→                </div>
   748→                <div id="speakerList" class="speaker-list">
   749→                    <div class="speaker-item speaker-0" data-speaker-index="0">
   750→                        <input type="text" class="speaker-name" value="Speaker 1" placeholder="Name">
   751→                        <select class="speaker-track">
   752→                            <option value="0" selected>V1</option>
   753→                            <option value="1">V2</option>
   754→                            <option value="2">V3</option>
   755→                            <option value="3">V4</option>
   756→                        </select>
   757→                        <button class="speaker-remove-btn" title="Remove speaker" style="display: none;">x</button>
   758→                    </div>
   759→                    <div class="speaker-item speaker-1" data-speaker-index="1">
   760→                        <input type="text" class="speaker-name" value="Speaker 2" placeholder="Name">
   761→                        <select class="speaker-track">
   762→                            <option value="0">V1</option>
   763→                            <option value="1" selected>V2</option>
   764→                            <option value="2">V3</option>
   765→                            <option value="3">V4</option>
   766→                        </select>
   767→                        <button class="speaker-remove-btn" title="Remove speaker" style="display: none;">x</button>
   768→                    </div>
   769→                </div>
   770→            </div>
   771→
   772→            <!-- Parameters -->
   773→            <div class="multitrack-params">
   774→                <div class="slider-container small">
   775→                    <label>Min Shot Duration: <span id="minShotDurationValue">2.0s</span></label>
   776→                    <input type="range" id="minShotDuration" min="0.5" max="10" step="0.5" value="2">
   777→                </div>
   778→                <div class="slider-container small">
   779→                    <label>Wide Shot %: <span id="wideShotPercentValue">20%</span></label>
   780→                    <input type="range" id="wideShotPercent" min="0" max="50" step="5" value="20">
   781→                </div>
   782→                <div class="slider-container small">
   783→                    <label>Switching Frequency: <span id="switchingFrequencyValue">50</span></label>
   784→                    <input type="range" id="switchingFrequency" min="10" max="100" step="10" value="50">
   785→                </div>
   786→                <label class="checkbox-label">
   787→                    <input type="checkbox" id="enableWideShotDetection" checked>
   788→                    Enable Wide Shot Detection
   789→                </label>
   790→                <div class="form-group small">
   791→                    <label>Wide Shot Track</label>
   792→                    <select id="wideShotTrack">
   793→                        <option value="-1">None</option>
   794→                        <option value="0">V1</option>
   795→                        <option value="1">V2</option>
   796→                        <option value="2">V3</option>
   797→                        <option value="3">V4</option>
   798→                    </select>
   799→                </div>
   800→            </div>
   801→
   802→            <!-- Action Buttons -->
   803→            <div class="multitrack-actions">
   804→                <button id="analyzeMultitrackBtn" class="btn btn-primary">Analyze</button>
   805→                <button id="autoBalanceBtn" class="btn btn-secondary">Auto-Balance</button>
   806→            </div>
   807→
   808→            <!-- Results Preview -->
   809→            <div id="multitrackPreview" class="multitrack-preview hidden">
   810→                <div class="distribution-chart-container">
   811→                    <label>Speaker Distribution</label>
   812→                    <div id="distributionChart" class="distribution-chart"></div>
   813→                </div>
   814→                <div id="speakerStats" class="speaker-stats"></div>
   815→                <div class="decision-list-header">
   816→                    <span>Switching Decisions (<span id="decisionCount">0</span>)</span>
   817→                </div>
   818→                <div id="decisionList" class="decision-list"></div>
   819→                <div class="multitrack-preview-actions">
   820→                    <button id="applyMultitrackBtn" class="btn btn-primary" disabled>Apply</button>
   821→                </div>
   822→            </div>
   823→        </div>
   824→    </div>
   825→
   826→    <!-- Animated Captions Section -->
   827→    <div id="captionsSection" class="captions-section">
   828→        <div id="captionsToggle" class="section-toggle">
   829→            <span class="toggle-icon">+</span>
   830→            <span>Animated Captions</span>
   831→        </div>
   832→        <div id="captionsPanel" class="captions-panel collapsed">
   833→            <!-- Template Gallery -->
   834→            <div class="caption-templates">
   835→                <label>Template Style</label>
   836→                <div id="captionTemplateGallery" class="caption-template-gallery"></div>
   837→            </div>
   838→
   839→            <!-- Settings -->
   840→            <div class="caption-settings">
   841→                <div class="form-group small">
   842→                    <label>Words per Line</label>
   843→                    <select id="captionWordsPerLine">
   844→                        <option value="2">2 words</option>
   845→                        <option value="3">3 words</option>
   846→                        <option value="4" selected>4 words</option>
   847→                        <option value="5">5 words</option>
   848→                    </select>
   849→                </div>
   850→                <label class="checkbox-label">
   851→                    <input type="checkbox" id="captionHighlightKeywords" checked>
   852→                    Highlight Keywords
   853→                </label>
   854→                <label class="checkbox-label">
   855→                    <input type="checkbox" id="captionInsertEmojis">
   856→                    Insert Emojis
   857→                </label>
   858→                <div class="form-group small" id="emojiFrequencyGroup" style="display: none;">
   859→                    <label>Emoji Frequency</label>
   860→                    <select id="captionEmojiFrequency">
   861→                        <option value="low">Low</option>
   862→                        <option value="medium" selected>Medium</option>
   863→                        <option value="high">High</option>
   864→                    </select>
   865→                </div>
   866→            </div>
   867→
   868→            <!-- Action Buttons -->
   869→            <div class="caption-actions">
   870→                <button id="generateCaptionsBtn" class="btn btn-primary">Generate Captions</button>
   871→            </div>
   872→
   873→            <!-- Stats -->
   874→            <div id="captionStats" class="caption-stats"></div>
   875→
   876→            <!-- Status -->
   877→            <div id="captionStatus" class="caption-status"></div>
   878→
   879→            <!-- Preview -->
   880→            <div id="captionPreviewContainer" class="caption-preview-container"></div>
   881→
   882→            <!-- Export Actions -->
   883→            <div class="caption-export-actions hidden" id="captionExportActions">
   884→                <button id="exportCaptionsSrtBtn" class="btn btn-small btn-secondary">Export SRT</button>
   885→                <button id="exportCaptionsMogrtBtn" class="btn btn-small btn-secondary">Export MOGRT</button>
   886→                <button id="copyCaptionsBtn" class="btn btn-small btn-secondary">Copy</button>
   887→                <button id="applyCaptionsBtn" class="btn btn-small btn-primary">Add Markers</button>
   888→            </div>
   889→        </div>
   890→    </div>
   891→
   892→    <!-- Custom Text Presets Section (Video Branding) -->
   893→    <div id="textPresetsSection" class="text-presets-section">
   894→        <div id="textPresetsToggle" class="section-toggle">
   895→            <span class="toggle-icon">+</span>
   896→            <span>Custom Text Presets</span>
   897→            <span class="tier-badge" style="background: linear-gradient(135deg, #f59e0b, #d97706);">BRAND</span>
   898→        </div>
   899→        <div id="text-presets-panel" class="text-presets-panel collapsed">
   900→            <!-- Saved Presets Gallery -->
   901→            <div class="presets-gallery">
   902→                <label>Saved Presets</label>
   903→                <div id="presets-gallery-list" class="presets-gallery-list">
   904→                    <div class="preset-empty">No presets saved yet</div>
   905→                </div>
   906→            </div>
   907→
   908→            <!-- Preset Editor -->
   909→            <div class="preset-editor">
   910→                <div class="form-group small">
   911→                    <label for="preset-name-input">Preset Name</label>
   912→                    <input type="text" id="preset-name-input" placeholder="My Brand Style" maxlength="30">
   913→                </div>
   914→
   915→                <!-- Font Settings -->
   916→                <div class="form-group small">
   917→                    <label for="preset-font-family">Font Family</label>
   918→                    <div class="font-selector-row">
   919→                        <select id="preset-font-family">
   920→                            <optgroup label="System Fonts">
   921→                                <option value="Arial">Arial</option>
   922→                                <option value="Helvetica">Helvetica</option>
   923→                                <option value="Roboto">Roboto</option>
   924→                                <option value="Open Sans">Open Sans</option>
   925→                                <option value="Montserrat">Montserrat</option>
   926→                                <option value="Lato">Lato</option>
   927→                                <option value="Oswald">Oswald</option>
   928→                                <option value="Bebas Neue">Bebas Neue</option>
   929→                                <option value="Impact">Impact</option>
   930→                                <option value="Times New Roman">Times New Roman</option>
   931→                            </optgroup>
   932→                            <optgroup id="custom-fonts-group" label="Custom Fonts">
   933→                            </optgroup>
   934→                        </select>
   935→                        <button id="upload-font-btn" class="btn btn-small btn-secondary" title="Upload Custom Font">
   936→                            <span>+</span>
   937→                        </button>
   938→                    </div>
   939→                    <input type="file" id="custom-font-input" accept=".ttf,.otf,.woff,.woff2" style="display: none;">
   940→                </div>
   941→
   942→                <!-- Custom Fonts Manager -->
   943→                <div id="custom-fonts-manager" class="custom-fonts-manager">
   944→                    <div id="custom-fonts-list" class="custom-fonts-list"></div>
   945→                </div>
   946→
   947→                <div class="slider-container small">
   948→                    <label>Font Size: <span id="preset-font-size-value">48</span>px</label>
   949→                    <input type="range" id="preset-font-size" min="12" max="120" step="2" value="48">
   950→                </div>
   951→
   952→                <div class="form-group small">
   953→                    <label for="preset-font-weight">Font Weight</label>
   954→                    <select id="preset-font-weight">
   955→                        <option value="normal">Normal</option>
   956→                        <option value="bold" selected>Bold</option>
   957→                        <option value="900">Extra Bold</option>
   958→                    </select>
   959→                </div>
   960→
   961→                <!-- Color Settings -->
   962→                <div class="preset-colors">
   963→                    <div class="form-group small">
   964→                        <label for="preset-text-color">Text Color</label>
   965→                        <input type="color" id="preset-text-color" value="#FFFFFF">
   966→                    </div>
   967→                    <div class="form-group small">
   968→                        <label for="preset-bg-color">Background</label>
   969→                        <input type="color" id="preset-bg-color" value="#000000">
   970→                    </div>
   971→                    <div class="form-group small">
   972→                        <label for="preset-highlight-color">Highlight</label>
   973→                        <input type="color" id="preset-highlight-color" value="#FFCC00">
   974→                    </div>
   975→                </div>
   976→
   977→                <div class="slider-container small">
   978→                    <label>Background Opacity: <span id="preset-bg-opacity-value">80</span>%</label>
   979→                    <input type="range" id="preset-bg-opacity" min="0" max="100" step="5" value="80">
   980→                </div>
   981→
   982→                <!-- Position Settings -->
   983→                <div class="form-group small">
   984→                    <label for="preset-position">Position</label>
   985→                    <select id="preset-position">
   986→                        <option value="bottom-center" selected>Bottom Center</option>
   987→                        <option value="top-center">Top Center</option>
   988→                        <option value="center">Center</option>
   989→                        <option value="bottom-left">Bottom Left</option>
   990→                        <option value="bottom-right">Bottom Right</option>
   991→                        <option value="top-left">Top Left</option>
   992→                        <option value="top-right">Top Right</option>
   993→                    </select>
   994→                </div>
   995→
   996→                <!-- Animation Settings -->
   997→                <div class="form-group small">
   998→                    <label for="preset-animation">Animation</label>
   999→                    <select id="preset-animation">
  1000→                        <option value="none">None</option>
  1001→                        <option value="fade" selected>Fade</option>
  1002→                        <option value="slide-up">Slide Up</option>
  1003→                        <option value="slide-down">Slide Down</option>
  1004→                        <option value="pop">Pop</option>
  1005→                        <option value="typewriter">Typewriter</option>
  1006→                        <option value="bounce">Bounce</option>
  1007→                    </select>
  1008→                </div>
  1009→
  1010→                <!-- Text Effects -->
  1011→                <div class="preset-effects">
  1012→                    <label class="checkbox-label">
  1013→                        <input type="checkbox" id="preset-shadow-enabled" checked>
  1014→                        Drop Shadow
  1015→                    </label>
  1016→                    <label class="checkbox-label">
  1017→                        <input type="checkbox" id="preset-outline-enabled">
  1018→                        Text Outline
  1019→                    </label>
  1020→                    <label class="checkbox-label">
  1021→                        <input type="checkbox" id="preset-uppercase">
  1022→                        All Uppercase
  1023→                    </label>
  1024→                </div>
  1025→
  1026→                <!-- Preview -->
  1027→                <div class="preset-preview-container">
  1028→                    <label>Preview</label>
  1029→                    <div id="preset-preview" class="preset-preview">
  1030→                        <span id="preset-preview-text">Sample Text</span>
  1031→                    </div>
  1032→                </div>
  1033→            </div>
  1034→
  1035→            <!-- Action Buttons -->
  1036→            <div class="preset-actions">
  1037→                <button id="save-preset-btn" class="btn btn-primary" style="background: linear-gradient(135deg, #4a9eff, #a64dff); border: none;">Save Preset</button>
  1038→                <button id="apply-preset-btn" class="btn btn-secondary">Apply to Captions</button>
  1039→                <button id="reset-preset-btn" class="btn btn-ghost" style="background: transparent; border: 1px solid rgba(255,255,255,0.1); color: #888;">Reset</button>
  1040→            </div>
  1041→
  1042→            <!-- Import/Export -->
  1043→            <div class="preset-io">
  1044→                <button id="export-presets-btn" class="btn btn-small btn-secondary" style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">Export All</button>
  1045→                <button id="import-presets-btn" class="btn btn-small btn-secondary" style="background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);">Import</button>
  1046→                <input type="file" id="import-presets-file" accept=".json" style="display: none;">
  1047→            </div>
  1048→        </div>
  1049→    </div>
  1050→
  1051→    <!-- Text Editor Section -->
  1052→    <div id="textEditorSection" class="text-editor-section">
  1053→        <div id="textEditorToggle" class="section-toggle">
  1054→            <span class="toggle-icon">+</span>
  1055→            <span>Text-Based Editing</span>
  1056→        </div>
  1057→        <div id="text-editor-panel" class="text-editor-panel collapsed">
  1058→            <!-- Status Bar -->
  1059→            <div class="text-editor-bar">
  1060→                <span id="text-editor-word-count" class="text-editor-word-count">0 words</span>
  1061→                <span id="text-editor-dirty" class="text-editor-dirty" style="display: none;">*</span>
  1062→                <span id="text-editor-status" class="text-editor-status"></span>
  1063→            </div>
  1064→
  1065→            <!-- Toolbar -->
  1066→            <div class="text-editor-toolbar">
  1067→                <button id="text-editor-undo-btn" class="btn btn-small btn-icon" title="Undo (Ctrl+Z)" disabled>↶</button>
  1068→                <button id="text-editor-redo-btn" class="btn btn-small btn-icon" title="Redo (Ctrl+Y)" disabled>↷</button>
  1069→                <div class="toolbar-divider"></div>
  1070→                <button id="text-editor-reset-btn" class="btn btn-small btn-secondary">Reset</button>
  1071→            </div>
  1072→
  1073→            <!-- Editor Content -->
  1074→            <div class="text-editor-content-wrapper">
  1075→                <textarea id="text-editor-content" class="text-editor-content"
  1076→                    placeholder="Load a transcript to begin editing..."></textarea>
  1077→            </div>
  1078→
  1079→            <!-- Search & Replace -->
  1080→            <div class="text-editor-search">
  1081→                <div class="search-row">
  1082→                    <input type="text" id="text-search-input" class="search-input" placeholder="Search text...">
  1083→                    <button id="text-search-btn" class="btn btn-small">Search</button>
  1084→                    <button id="text-search-prev-btn" class="btn btn-small btn-icon" title="Previous">◀</button>
  1085→                    <button id="text-search-next-btn" class="btn btn-small btn-icon" title="Next">▶</button>
  1086→                    <span id="text-search-results" class="search-results">0/0</span>
  1087→                </div>
  1088→                <div class="replace-row">
  1089→                    <input type="text" id="text-replace-input" class="search-input" placeholder="Replace with...">
  1090→                    <button id="text-replace-btn" class="btn btn-small btn-secondary">Replace</button>
  1091→                    <button id="text-replace-all-btn" class="btn btn-small btn-secondary">Replace All</button>
  1092→                </div>
  1093→            </div>
  1094→
  1095→            <!-- Preview Panel -->
  1096→            <div id="text-editor-preview" class="text-editor-preview"></div>
  1097→
  1098→            <!-- Action Buttons -->
  1099→            <div class="text-editor-actions">
  1100→                <button id="preview-text-edits-btn" class="btn btn-secondary">Preview Changes</button>
  1101→                <button id="apply-text-edits-btn" class="btn btn-primary">Apply Edits</button>
  1102→                <button id="text-editor-build-btn" class="btn btn-primary" disabled>Build Sequence</button>
  1103→            </div>
  1104→        </div>
  1105→    </div>
  1106→
  1107→    <!-- Social Reframe Section -->
  1108→    <div id="socialReframeSection" class="social-reframe-section">
  1109→        <div id="socialReframeToggle" class="section-toggle">
  1110→            <span class="toggle-icon">+</span>
  1111→            <span>Social Reframe</span>
  1112→        </div>
  1113→        <div id="social-reframe-panel" class="social-reframe-panel collapsed">
  1114→            <!-- Platform Selector -->
  1115→            <div class="reframe-platforms">
  1116→                <label>Platform</label>
  1117→                <div id="reframe-platform-selector" class="reframe-platform-selector"></div>
  1118→            </div>
  1119→
  1120→            <!-- Aspect Ratio Selector -->
  1121→            <div class="reframe-aspects">
  1122→                <label>Aspect Ratio</label>
  1123→                <div id="reframe-aspect-selector" class="reframe-aspect-selector"></div>
  1124→            </div>
  1125→
  1126→            <!-- Settings -->
  1127→            <div class="reframe-settings">
  1128→                <div class="slider-container small">
  1129→                    <label>Motion Smoothing: <span id="smoothing-value-display">0.30</span></label>
  1130→                    <input type="range" id="motion-smoothing-slider" min="0" max="1" step="0.05" value="0.3">
  1131→                </div>
  1132→            </div>
  1133→
  1134→            <!-- Action Buttons -->
  1135→            <div class="reframe-actions">
  1136→                <button id="analyze-reframe-btn" class="btn btn-primary">Analyze Video</button>
  1137→                <button id="toggle-safe-zones-btn" class="btn btn-small btn-secondary">Safe Zones</button>
  1138→            </div>
  1139→
  1140→            <!-- Status -->
  1141→            <div id="reframe-status" class="reframe-status"></div>
  1142→
  1143→            <!-- Analysis Results -->
  1144→            <div id="reframe-analysis-results" class="reframe-analysis-results"></div>
  1145→
  1146→            <!-- Preview Canvas -->
  1147→            <div class="reframe-preview-wrapper">
  1148→                <canvas id="reframe-preview-canvas" class="reframe-preview-canvas" width="280" height="160"></canvas>
  1149→            </div>
  1150→
  1151→            <!-- Export Buttons -->
  1152→            <div class="reframe-export-actions">
  1153→                <button id="export-reframe-btn" class="btn btn-secondary">Export</button>
  1154→                <button id="export-all-formats-btn" class="btn btn-secondary">Export All</button>
  1155→            </div>
  1156→
  1157→            <!-- Export Results -->
  1158→            <div id="reframe-export-results" class="reframe-export-results"></div>
  1159→        </div>
  1160→    </div>
  1161→
  1162→    <!-- Music Section -->
  1163→    <div id="musicSection" class="music-section">
  1164→        <div id="musicToggle" class="section-toggle">
  1165→            <span class="toggle-icon">+</span>
  1166→            <span>AI Music</span>
  1167→            <span id="music-credits-badge" class="music-credits-badge"></span>
  1168→        </div>
  1169→        <div id="music-panel" class="music-panel collapsed">
  1170→            <!-- Tab Navigation -->
  1171→            <div class="music-tabs">
  1172→                <button class="music-tab active" data-tab="generate">Generate</button>
  1173→                <button class="music-tab" data-tab="identify">Identify</button>
  1174→                <button class="music-tab" data-tab="library">Library</button>
  1175→            </div>
  1176→
  1177→            <!-- Generate Tab -->
  1178→            <div id="music-tab-generate" class="music-tab-content active">
  1179→                <!-- Mood Selection -->
  1180→                <div class="music-mood-section">
  1181→                    <label>Mood</label>
  1182→                    <div id="music-mood-selector" class="music-mood-selector"></div>
  1183→                </div>
  1184→
  1185→                <!-- Instrument Selection -->
  1186→                <div class="music-instrument-section">
  1187→                    <label>Instruments</label>
  1188→                    <div id="music-instrument-selector" class="music-instrument-selector"></div>
  1189→                </div>
  1190→
  1191→                <!-- Duration Slider -->
  1192→                <div class="slider-container small">
  1193→                    <label>Duration: <span id="music-duration-value">60</span>s</label>
  1194→                    <input type="range" id="music-duration-slider" min="30" max="180" step="15" value="60">
  1195→                </div>
  1196→
  1197→                <!-- Custom Prompt -->
  1198→                <div class="form-group small">
  1199→                    <label>Custom Prompt (optional)</label>
  1200→                    <textarea id="music-custom-prompt" class="music-custom-prompt"
  1201→                        placeholder="Add specific instructions..."></textarea>
  1202→                </div>
  1203→
  1204→                <!-- Generation Options -->
  1205→                <div class="music-options">
  1206→                    <label class="checkbox-label">
  1207→                        <input type="checkbox" id="music-scene-aware">
  1208→                        Scene-Aware (uses transcript)
  1209→                    </label>
  1210→                    <span id="sceneAwareIndicator" class="scene-aware-indicator" style="display: none;">Analyzing transcript...</span>
  1211→                    <label class="checkbox-label">
  1212→                        <input type="checkbox" id="music-variations">
  1213→                        Generate 3 Variations
  1214→                    </label>
  1215→                </div>
  1216→
  1217→                <!-- Generate Button -->
  1218→                <div class="music-generate-actions">
  1219→                    <button id="music-generate-btn" class="btn btn-primary">Generate Music</button>
  1220→                    <button id="music-timeline-btn" class="btn btn-secondary">Generate Timeline</button>
  1221→                </div>
  1222→            </div>
  1223→
  1224→            <!-- Identify Tab -->
  1225→            <div id="music-tab-identify" class="music-tab-content">
  1226→                <div class="form-group">
  1227→                    <label>YouTube URL</label>
  1228→                    <input type="text" id="music-youtube-url" placeholder="https://youtube.com/watch?v=...">
  1229→                </div>
  1230→                <button id="music-identify-btn" class="btn btn-primary">Identify Song</button>
  1231→                <div id="music-identify-result" class="music-identify-result"></div>
  1232→            </div>
  1233→
  1234→            <!-- Library Tab -->
  1235→            <div id="music-tab-library" class="music-tab-content">
  1236→                <div id="music-library-list" class="music-library-list">
  1237→                    <div class="music-library-empty">No music generated yet</div>
  1238→                </div>
  1239→            </div>
  1240→
  1241→            <!-- Status -->
  1242→            <div id="music-status" class="music-status"></div>
  1243→
  1244→            <!-- Active Jobs List -->
  1245→            <div id="music-jobs-list" class="music-jobs-list"></div>
  1246→
  1247→            <!-- Progress -->
  1248→            <div id="music-progress" class="music-progress hidden">
  1249→                <div class="music-progress-bar-container">
  1250→                    <div id="music-progress-bar" class="music-progress-bar" style="width: 0%"></div>
  1251→                </div>
  1252→                <div id="music-progress-text" class="music-progress-text">Generating...</div>
  1253→            </div>
  1254→
  1255→            <!-- Variations Selection UI -->
  1256→            <div id="music-variations-panel" class="music-variations-panel hidden">
  1257→                <label>Select a Variation</label>
  1258→                <div id="music-variations-list" class="music-variations-list"></div>
  1259→            </div>
  1260→
  1261→            <!-- Audio Preview -->
  1262→            <div id="music-preview" class="music-preview hidden">
  1263→                <div class="music-preview-header">
  1264→                    <span id="music-preview-title">Preview</span>
  1265→                    <button id="music-preview-close" class="btn btn-small btn-ghost">×</button>
  1266→                </div>
  1267→                <audio id="music-audio-player" controls></audio>
  1268→                <div class="music-preview-actions">
  1269→                    <button id="music-download-btn" class="btn btn-small btn-secondary">Download</button>
  1270→                    <button id="music-import-btn" class="btn btn-small btn-primary">Import to Timeline</button>
  1271→                </div>
  1272→            </div>
  1273→
  1274→            <!-- Alignment Modal -->
  1275→            <div id="music-align-modal" class="music-align-modal hidden">
  1276→                <div class="music-align-content">
  1277→                    <div class="music-align-header">
  1278→                        <span>Align to Video</span>
  1279→                        <button id="music-align-close" class="btn btn-small btn-ghost">×</button>
  1280→                    </div>
  1281→                    <div id="music-align-info" class="music-align-info"></div>
  1282→                    <div class="form-group small">
  1283→                        <label>Target Duration (seconds)</label>
  1284→                        <input type="number" id="music-align-target" min="5" max="3600" value="60">
  1285→                        <button id="music-align-match-seq" class="btn btn-small btn-secondary">Match Sequence</button>
  1286→                    </div>
  1287→                    <div class="slider-container small">
  1288→                        <label>Fade Duration: <span id="music-fade-value">2.0</span>s</label>
  1289→                        <input type="range" id="music-fade-slider" min="0.5" max="5" step="0.5" value="2">
  1290→                    </div>
  1291→                    <label class="checkbox-label">
  1292→                        <input type="checkbox" id="music-beat-align" checked>
  1293→                        Align to nearest beat
  1294→                    </label>
  1295→                    <div class="music-align-actions">
  1296→                        <button id="music-align-btn" class="btn btn-primary">Align & Trim</button>
  1297→                    </div>
  1298→                </div>
  1299→            </div>
  1300→
  1301→            <!-- Timeline Modal -->
  1302→            <div id="music-timeline-modal" class="music-timeline-modal hidden">
  1303→                <div class="music-timeline-content">
  1304→                    <div class="music-timeline-header">
  1305→                        <span>Generate Timeline Music</span>
  1306→                        <button id="music-timeline-close" class="btn btn-small btn-ghost">×</button>
  1307→                    </div>
  1308→                    <div id="music-timeline-info" class="music-timeline-info">
  1309→                        <span>Generates mood-matched music for each chapter</span>
  1310→                    </div>
  1311→                    <div class="form-group small">
  1312→                        <label>Max Chapters</label>
  1313→                        <input type="number" id="music-timeline-max-chapters" min="1" max="20" value="10">
  1314→                    </div>
  1315→                    <div class="form-group small">
  1316→                        <label>Min Segment Length (seconds)</label>
  1317→                        <input type="number" id="music-timeline-min-length" min="15" max="120" value="30">
  1318→                    </div>
  1319→                    <div class="slider-container small">
  1320→                        <label>Crossfade: <span id="music-crossfade-value">2.0</span>s</label>
  1321→                        <input type="range" id="music-crossfade-slider" min="0.5" max="5" step="0.5" value="2">
  1322→                    </div>
  1323→                    <div class="music-timeline-actions">
  1324→                        <button id="music-timeline-generate-btn" class="btn btn-primary">Generate</button>
  1325→                    </div>
  1326→                </div>
  1327→            </div>
  1328→        </div>
  1329→    </div>
  1330→
  1331→    <!-- Results Area -->
  1332→    <div class="results-area">
  1333→        <!-- Progress -->
  1334→        <div id="progressContainer" class="progress-container hidden">
  1335→            <div class="progress-bar-container">
  1336→                <div id="progressBar" class="progress-bar" style="width: 0%"></div>
  1337→            </div>
  1338→            <div id="progressText" class="progress-text">Detecting silences...</div>
  1339→        </div>
  1340→
  1341→        <!-- Empty State -->
  1342→        <div id="resultsEmpty" class="results-empty">
  1343→            <p>Ready to save 2 hours? Open a sequence and click GO to let AI handle the rough cut.</p>
  1344→        </div>
  1345→
  1346→        <!-- Combined Preview -->
  1347→        <div id="combinedPreview" class="preview-section hidden">
  1348→            <div class="preview-header">
  1349→                <h3>Preview</h3>
  1350→                <div class="preview-counts">
  1351→                    <span><span id="silenceCount">0</span> silences</span>
  1352→                    <span><span id="takeCount">0</span> takes</span>
  1353→                </div>
  1354→            </div>
  1355→
  1356→            <div class="preview-controls">
  1357→                <label class="checkbox-label">
  1358→                    <input type="checkbox" id="selectAllSilences" checked>
  1359→                    Select All (<span id="selectedCount">0</span> selected)
  1360→                </label>
  1361→            </div>
  1362→
  1363→            <div id="previewList" class="preview-list"></div>
  1364→
  1365→            <div class="preview-actions">
  1366→                <button id="applyPreviewBtn" class="btn btn-secondary">Add Markers</button>
  1367→                <button id="buildSequenceBtn" class="btn btn-primary">Build Sequence</button>
  1368→                <button id="cancelPreviewBtn" class="btn btn-ghost">Cancel</button>
  1369→            </div>
  1370→        </div>
  1371→
  1372→        <!-- Chapter Results -->
  1373→        <div id="chapterResults" class="chapter-results hidden">
  1374→            <div class="chapter-header">
  1375→                <h3>Chapters</h3>
  1376→                <div class="chapter-actions">
  1377→                    <button id="copyYouTubeBtn" class="btn btn-small">Copy YouTube</button>
  1378→                    <button id="addChapterMarkersBtn" class="btn btn-small btn-primary">Add Markers</button>
  1379→                </div>
  1380→            </div>
  1381→            <div id="chapterList" class="chapter-list"></div>
  1382→        </div>
  1383→
  1384→        <!-- Zoom Results -->
  1385→        <div id="zoomResults" class="zoom-results hidden">
  1386→            <div class="zoom-header">
  1387→                <h3>Zoom Points</h3>
  1388→                <button id="applyZoomsBtn" class="btn btn-small btn-primary">Apply Zooms</button>
  1389→            </div>
  1390→            <div id="zoomList" class="zoom-list"></div>
  1391→        </div>
  1392→    </div>
  1393→
  1394→    <!-- Settings Modal -->
  1395→    <div id="settingsModal" class="modal hidden" role="dialog" aria-modal="true">
  1396→        <div class="modal-content">
  1397→            <div class="modal-header">
  1398→                <h2>Settings</h2>
  1399→                <button id="closeSettingsBtn" class="close-btn">&times;</button>
  1400→            </div>
  1401→            <div class="modal-body">
  1402→                <div class="form-group">
  1403→                    <label>Backend URL</label>
  1404→                    <input type="text" id="backendUrlInput" placeholder="Auto-detect">
  1405→                </div>
  1406→                <div class="form-group">
  1407→                    <label class="checkbox-label">
  1408→                        <input type="checkbox" id="rememberOptions">
  1409→                        Remember Options
  1410→                    </label>
  1411→                </div>
  1412→            </div>
  1413→        </div>
  1414→    </div>
  1415→
  1416→    <!-- Login Modal -->
  1417→    <div id="loginModal" class="modal hidden" role="dialog" aria-modal="true">
  1418→        <div class="modal-content">
  1419→            <div class="modal-header">
  1420→                <h2>Login</h2>
  1421→                <button id="closeLoginBtn" class="close-btn">&times;</button>
  1422→            </div>
  1423→            <div class="modal-body">
  1424→                <p>Enter your license key to activate SPLICE</p>
  1425→                <div class="form-group">
  1426→                    <label for="licenseKeyInput">License Key</label>
  1427→                    <input type="text" id="licenseKeyInput" placeholder="SPLICE-XXXX-XXXX-XXXX">
  1428→                </div>
  1429→                <div class="form-group">
  1430→                    <label for="lookupEmailInput">Or lookup by email</label>
  1431→                    <input type="email" id="lookupEmailInput" placeholder="your@email.com">
  1432→                    <button id="lookupLicenseBtn" class="btn btn-secondary">Lookup</button>
  1433→                </div>
  1434→                <button id="saveLoginBtn" class="btn btn-primary">Activate</button>
  1435→                <div class="login-divider">
  1436→                    <span>Don't have a license?</span>
  1437→                </div>
  1438→                <a href="https://splice.video/pricing" target="_blank" class="btn btn-secondary btn-buy-license">
  1439→                    Buy License
  1440→                </a>
  1441→            </div>
  1442→        </div>
  1443→    </div>
  1444→
  1445→    <!-- Referral Promo Footer -->
  1446→    <div id="referralPromo" class="referral-promo hidden">
  1447→        <div class="referral-promo-content">
  1448→            <span class="referral-icon">&#127873;</span>
  1449→            <span class="referral-text">Share SPLICE, get <strong>1 free hour</strong> per referral</span>
  1450→            <a href="https://splice.video/referrals" target="_blank" class="referral-link">Learn More</a>
  1451→        </div>
  1452→    </div>
  1453→
  1454→    <!-- Scripts -->
  1455→    <script src="panel/js/browser-simulation.js"></script>
  1456→    <script src="panel/js/CSInterface.js"></script>
  1457→    <script src="panel/js/config.js"></script>
  1458→    <script src="panel/js/credits.js"></script>
  1459→    <script src="panel/js/slice6-analyze.js"></script>
  1460→    <script src="panel/js/slice7-apply.js"></script>
  1461→    <script src="panel/js/slice8-silence.js"></script>
  1462→    <script src="panel/js/builder.js"></script>
  1463→    <script src="panel/js/multitrack.js"></script>
  1464→    <script src="panel/js/animatedCaptions.js"></script>
  1465→    <script src="panel/js/textEditor.js"></script>
  1466→    <script src="panel/js/socialReframe.js"></script>
  1467→    <script src="panel/js/music.js"></script>
  1468→    <script src="panel/js/main.js"></script>
  1469→    <script src="panel/js/simulation-tests.js"></script>
  1470→
  1471→    <script>
  1472→        // Test runner UI integration
  1473→        const testLogEl = document.getElementById('test-log');
  1474→        const consoleLogEl = document.getElementById('console-output');
  1475→
  1476→        // Intercept console logs for display
  1477→        const originalLog = console.log;
  1478→        const originalWarn = console.warn;
  1479→        const originalError = console.error;
  1480→
  1481→        console.log = function (...args) {
  1482→            originalLog.apply(console, args);
  1483→            appendToConsoleOutput('log', args);
  1484→        };
  1485→
  1486→        console.warn = function (...args) {
  1487→            originalWarn.apply(console, args);
  1488→            appendToConsoleOutput('warn', args);
  1489→        };
  1490→
  1491→        console.error = function (...args) {
  1492→            originalError.apply(console, args);
  1493→            appendToConsoleOutput('error', args);
  1494→        };
  1495→
  1496→        function appendToConsoleOutput(type, args) {
  1497→            if (!consoleLogEl) return;
  1498→
  1499→            const msg = args.map(a => {
  1500→                if (typeof a === 'object') {
  1501→                    try { return JSON.stringify(a); } catch { return String(a); }
  1502→                }
  1503→                return String(a);
  1504→            }).join(' ');
  1505→
  1506→            // Skip style arguments
  1507→            if (msg.startsWith('%c')) return;
  1508→            if (msg.includes('color:')) return;
  1509→
  1510→            const line = document.createElement('div');
  1511→            line.className = type;
  1512→            line.textContent = msg.substring(0, 200) + (msg.length > 200 ? '...' : '');
  1513→            consoleLogEl.appendChild(line);
  1514→            consoleLogEl.scrollTop = consoleLogEl.scrollHeight;
  1515→        }
  1516→
  1517→        // Toggle test panel
  1518→        document.getElementById('toggle-test-panel').addEventListener('click', function () {
  1519→            const panel = document.getElementById('test-panel');
  1520→            panel.classList.toggle('visible');
  1521→            document.body.classList.toggle('test-panel-open');
  1522→            this.textContent = panel.classList.contains('visible') ? 'Hide Tests' : 'Show Tests';
  1523→        });
  1524→
  1525→        // GO button click handler - triggers silences-rms API call
  1526→        document.getElementById('goBtn')?.addEventListener('click', async function () {
  1527→            console.log('[GO Button] Clicked - starting analysis');
  1528→
  1529→            // Get current settings
  1530→            const sensitivity = document.getElementById('sensitivitySlider')?.value || 50;
  1531→            const audioPath = window.spliceState?.currentVideoPath || '/mock/path/to/video.mp4';
  1532→
  1533→            // Show processing state
  1534→            this.textContent = 'Processing...';
  1535→            this.disabled = true;
  1536→
  1537→            try {
  1538→                // Call silences-rms API
  1539→                const response = await fetch('https://127.0.0.1:3847/silences-rms', {
  1540→                    method: 'POST',
  1541→                    headers: { 'Content-Type': 'application/json' },
  1542→                    body: JSON.stringify({
  1543→                        wavPath: audioPath,
  1544→                        sensitivity: parseInt(sensitivity),
  1545→                        minSilenceLength: 0.3
  1546→                    })
  1547→                });
  1548→
  1549→                const data = await response.json();
  1550→                console.log('[GO Button] Silences detected:', data);
  1551→
  1552→                // Update UI with results
  1553→                const statusEl = document.getElementById('analysisStatus');
  1554→                if (statusEl) {
  1555→                    statusEl.textContent = `Found ${data.silences?.length || 0} silences`;
  1556→                }
  1557→
  1558→            } catch (error) {
  1559→                console.error('[GO Button] Error:', error);
  1560→            } finally {
  1561→                // Reset button state
  1562→                this.textContent = 'GO';
  1563→                this.disabled = false;
  1564→            }
  1565→        });
  1566→
  1567→        // Run all tests with UI
  1568→        async function runAllTestsWithUI() {
  1569→            if (!window.spliceSimulationTests) {
  1570→                alert('Simulation tests not loaded yet');
  1571→                return;
  1572→            }
  1573→
  1574→            testLogEl.innerHTML = '<div class="suite">Running all tests...</div>';
  1575→
  1576→            const summary = await window.spliceSimulationTests.run();
  1577→
  1578→            // Update stats
  1579→            document.getElementById('stat-passed').textContent = summary.passed;
  1580→            document.getElementById('stat-failed').textContent = summary.failed;
  1581→            document.getElementById('stat-skipped').textContent = summary.skipped;
  1582→
  1583→            // Format log output
  1584→            let logHtml = '';
  1585→            let currentSuite = '';
  1586→
  1587→            summary.results.forEach(r => {
  1588→                if (r.suite !== currentSuite) {
  1589→                    currentSuite = r.suite;
  1590→                    logHtml += `<div class="suite">\n=== ${currentSuite} ===</div>\n`;
  1591→                }
  1592→
  1593→                const statusClass = r.status.toLowerCase();
  1594→                const statusSymbol = r.status === 'PASS' ? '✓' : r.status === 'FAIL' ? '✗' : '○';
  1595→                logHtml += `<span class="${statusClass}">${statusSymbol} ${r.name}</span>`;
  1596→                if (r.status === 'FAIL') {
  1597→                    logHtml += ` <span style="color: #666;">(${r.error})</span>`;
  1598→                }
  1599→                logHtml += '\n';
  1600→            });
  1601→
  1602→            testLogEl.innerHTML = logHtml;
  1603→        }
  1604→
  1605→        // Run individual suite
  1606→        async function runSuite(name) {
  1607→            if (!window.spliceSimulationTests) {
  1608→                alert('Simulation tests not loaded yet');
  1609→                return;
  1610→            }
  1611→
  1612→            const suite = window.spliceSimulationTests.suites[name];
  1613→            if (!suite) {
  1614→                alert('Suite not found: ' + name);
  1615→                return;
  1616→            }
  1617→
  1618→            window.spliceSimulationTests.TestRunner.reset();
  1619→            testLogEl.innerHTML = `<div class="suite">Running ${name}...</div>`;
  1620→
  1621→            await suite();
  1622→
  1623→            const summary = window.spliceSimulationTests.TestRunner.summary();
  1624→
  1625→            document.getElementById('stat-passed').textContent = summary.passed;
  1626→            document.getElementById('stat-failed').textContent = summary.failed;
  1627→            document.getElementById('stat-skipped').textContent = summary.skipped;
  1628→
  1629→            let logHtml = '';
  1630→            summary.results.forEach(r => {
  1631→                const statusClass = r.status.toLowerCase();
  1632→                const statusSymbol = r.status === 'PASS' ? '✓' : r.status === 'FAIL' ? '✗' : '○';
  1633→                logHtml += `<span class="${statusClass}">${statusSymbol} ${r.name}</span>`;
  1634→                if (r.status === 'FAIL') {
  1635→                    logHtml += ` <span style="color: #666;">(${r.error})</span>`;
  1636→                }
  1637→                logHtml += '\n';
  1638→            });
  1639→
  1640→            testLogEl.innerHTML = logHtml;
  1641→        }
  1642→
  1643→        // Quick test button
  1644→        document.getElementById('run-quick-test').addEventListener('click', async function () {
  1645→            if (!window.spliceSimulationTests) {
  1646→                alert('Simulation tests not loaded yet. Wait a moment.');
  1647→                return;
  1648→            }
  1649→            await runSuite('quickEdit');
  1650→        });
  1651→
  1652→        // Run all tests button
  1653→        document.getElementById('run-all-tests').addEventListener('click', runAllTestsWithUI);
  1654→
  1655→        // Auto-run if URL contains ?autotest
  1656→        if (window.location.search.includes('autotest')) {
  1657→            window.addEventListener('load', () => {
  1658→                setTimeout(runAllTestsWithUI, 2500);
  1659→            });
  1660→        }
  1661→
  1662→        console.log('%c[SPLICE] Simulation HTML loaded. Click "Show Tests" or "Run All Tests" to start.', 'color: #00d1b2; font-weight: bold;');
  1663→
  1664→        // ============================================================================
  1665→        // CUSTOM TEXT PRESETS (Video Branding)
  1666→        // ============================================================================
  1667→
  1668→        const textPresetsState = {
  1669→            presets: [],
  1670→            currentPreset: null,
  1671→            storageKey: 'splice_text_presets',
  1672→            customFonts: [],
  1673→            customFontsKey: 'splice_custom_fonts'
  1674→        };
  1675→
  1676→        // Initialize text presets module
  1677→        function initTextPresets() {
  1678→            // Toggle panel
  1679→            const toggle = document.getElementById('textPresetsToggle');
  1680→            const panel = document.getElementById('text-presets-panel');
  1681→            if (toggle && panel) {
  1682→                toggle.addEventListener('click', () => {
  1683→                    panel.classList.toggle('collapsed');
  1684→                    toggle.querySelector('.toggle-icon').textContent =
  1685→                        panel.classList.contains('collapsed') ? '+' : '−';
  1686→                });
  1687→            }
  1688→
  1689→            // Load saved presets and custom fonts
  1690→            loadPresets();
  1691→            loadCustomFonts();
  1692→
  1693→            // Set up event listeners for live preview
  1694→            setupPresetPreview();
  1695→
  1696→            // Custom font upload handlers
  1697→            document.getElementById('upload-font-btn')?.addEventListener('click', () => {
  1698→                document.getElementById('custom-font-input').click();
  1699→            });
  1700→            document.getElementById('custom-font-input')?.addEventListener('change', handleFontUpload);
  1701→
  1702→            // Button handlers
  1703→            document.getElementById('save-preset-btn')?.addEventListener('click', savePreset);
  1704→            document.getElementById('apply-preset-btn')?.addEventListener('click', applyPresetToCaptions);
  1705→            document.getElementById('reset-preset-btn')?.addEventListener('click', resetPresetForm);
  1706→            document.getElementById('export-presets-btn')?.addEventListener('click', exportAllPresets);
  1707→            document.getElementById('import-presets-btn')?.addEventListener('click', () => {
  1708→                document.getElementById('import-presets-file').click();
  1709→            });
  1710→            document.getElementById('import-presets-file')?.addEventListener('change', importPresets);
  1711→
  1712→            // Slider value displays
  1713→            document.getElementById('preset-font-size')?.addEventListener('input', (e) => {
  1714→                document.getElementById('preset-font-size-value').textContent = e.target.value;
  1715→                updatePreview();
  1716→            });
  1717→            document.getElementById('preset-bg-opacity')?.addEventListener('input', (e) => {
  1718→                document.getElementById('preset-bg-opacity-value').textContent = e.target.value;
  1719→                updatePreview();
  1720→            });
  1721→        }
  1722→
  1723→        function setupPresetPreview() {
  1724→            const controls = [
  1725→                'preset-font-family', 'preset-font-size', 'preset-font-weight',
  1726→                'preset-text-color', 'preset-bg-color', 'preset-highlight-color',
  1727→                'preset-bg-opacity', 'preset-position', 'preset-animation',
  1728→                'preset-shadow-enabled', 'preset-outline-enabled', 'preset-uppercase'
  1729→            ];
  1730→
  1731→            controls.forEach(id => {
  1732→                const el = document.getElementById(id);
  1733→                if (el) {
  1734→                    el.addEventListener('input', updatePreview);
  1735→                    el.addEventListener('change', updatePreview);
  1736→                }
  1737→            });
  1738→
  1739→            updatePreview();
  1740→        }
  1741→
  1742→        function updatePreview() {
  1743→            const previewText = document.getElementById('preset-preview-text');
  1744→            if (!previewText) return;
  1745→
  1746→            const fontFamily = document.getElementById('preset-font-family')?.value || 'Arial';
  1747→            const fontSize = document.getElementById('preset-font-size')?.value || 48;
  1748→            const fontWeight = document.getElementById('preset-font-weight')?.value || 'bold';
  1749→            const textColor = document.getElementById('preset-text-color')?.value || '#FFFFFF';
  1750→            const bgColor = document.getElementById('preset-bg-color')?.value || '#000000';
  1751→            const highlightColor = document.getElementById('preset-highlight-color')?.value || '#FFCC00';
  1752→            const bgOpacity = (document.getElementById('preset-bg-opacity')?.value || 80) / 100;
  1753→            const shadowEnabled = document.getElementById('preset-shadow-enabled')?.checked ?? true;
  1754→            const outlineEnabled = document.getElementById('preset-outline-enabled')?.checked ?? false;
  1755→            const uppercase = document.getElementById('preset-uppercase')?.checked ?? false;
  1756→
  1757→            // Apply styles
  1758→            previewText.style.fontFamily = fontFamily;
  1759→            previewText.style.fontSize = Math.min(fontSize, 36) + 'px'; // Scale down for preview
  1760→            previewText.style.fontWeight = fontWeight;
  1761→            previewText.style.color = textColor;
  1762→            previewText.style.backgroundColor = hexToRgba(bgColor, bgOpacity);
  1763→            previewText.style.textTransform = uppercase ? 'uppercase' : 'none';
  1764→
  1765→            let textShadow = 'none';
  1766→            if (shadowEnabled) {
  1767→                textShadow = '2px 2px 4px rgba(0,0,0,0.8)';
  1768→            }
  1769→            if (outlineEnabled) {
  1770→                textShadow = (shadowEnabled ? textShadow + ', ' : '') +
  1771→                    `-1px -1px 0 ${highlightColor}, 1px -1px 0 ${highlightColor}, -1px 1px 0 ${highlightColor}, 1px 1px 0 ${highlightColor}`;
  1772→            }
  1773→            previewText.style.textShadow = textShadow;
  1774→        }
  1775→
  1776→        function hexToRgba(hex, alpha) {
  1777→            const r = parseInt(hex.slice(1, 3), 16);
  1778→            const g = parseInt(hex.slice(3, 5), 16);
  1779→            const b = parseInt(hex.slice(5, 7), 16);
  1780→            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
  1781→        }
  1782→
  1783→        function getPresetFromForm() {
  1784→            return {
  1785→                id: Date.now().toString(),
  1786→                name: document.getElementById('preset-name-input')?.value || 'Untitled',
  1787→                fontFamily: document.getElementById('preset-font-family')?.value || 'Arial',
  1788→                fontSize: parseInt(document.getElementById('preset-font-size')?.value) || 48,
  1789→                fontWeight: document.getElementById('preset-font-weight')?.value || 'bold',
  1790→                textColor: document.getElementById('preset-text-color')?.value || '#FFFFFF',
  1791→                bgColor: document.getElementById('preset-bg-color')?.value || '#000000',
  1792→                highlightColor: document.getElementById('preset-highlight-color')?.value || '#FFCC00',
  1793→                bgOpacity: parseInt(document.getElementById('preset-bg-opacity')?.value) || 80,
  1794→                position: document.getElementById('preset-position')?.value || 'bottom-center',
  1795→                animation: document.getElementById('preset-animation')?.value || 'fade',
  1796→                shadowEnabled: document.getElementById('preset-shadow-enabled')?.checked ?? true,
  1797→                outlineEnabled: document.getElementById('preset-outline-enabled')?.checked ?? false,
  1798→                uppercase: document.getElementById('preset-uppercase')?.checked ?? false
  1799→            };
  1800→        }
  1801→
  1802→        function savePreset() {
  1803→            const preset = getPresetFromForm();
  1804→            if (!preset.name || preset.name === 'Untitled') {
  1805→                alert('Please enter a preset name');
  1806→                return;
  1807→            }
  1808→
  1809→            // Check for duplicate names
  1810→            const existing = textPresetsState.presets.findIndex(p => p.name === preset.name);
  1811→            if (existing >= 0) {
  1812→                textPresetsState.presets[existing] = preset;
  1813→            } else {
  1814→                textPresetsState.presets.push(preset);
  1815→            }
  1816→
  1817→            savePresetsToStorage();
  1818→            renderPresetsGallery();
  1819→            console.log('[SPLICE] Preset saved:', preset.name);
  1820→        }
  1821→
  1822→        function deletePreset(presetId) {
  1823→            textPresetsState.presets = textPresetsState.presets.filter(p => p.id !== presetId);
  1824→            savePresetsToStorage();
  1825→            renderPresetsGallery();
  1826→        }
  1827→
  1828→        function loadPresetToForm(preset) {
  1829→            if (!preset) return;
  1830→
  1831→            document.getElementById('preset-name-input').value = preset.name || '';
  1832→            document.getElementById('preset-font-family').value = preset.fontFamily || 'Arial';
  1833→            document.getElementById('preset-font-size').value = preset.fontSize || 48;
  1834→            document.getElementById('preset-font-size-value').textContent = preset.fontSize || 48;
  1835→            document.getElementById('preset-font-weight').value = preset.fontWeight || 'bold';
  1836→            document.getElementById('preset-text-color').value = preset.textColor || '#FFFFFF';
  1837→            document.getElementById('preset-bg-color').value = preset.bgColor || '#000000';
  1838→            document.getElementById('preset-highlight-color').value = preset.highlightColor || '#FFCC00';
  1839→            document.getElementById('preset-bg-opacity').value = preset.bgOpacity || 80;
  1840→            document.getElementById('preset-bg-opacity-value').textContent = preset.bgOpacity || 80;
  1841→            document.getElementById('preset-position').value = preset.position || 'bottom-center';
  1842→            document.getElementById('preset-animation').value = preset.animation || 'fade';
  1843→            document.getElementById('preset-shadow-enabled').checked = preset.shadowEnabled ?? true;
  1844→            document.getElementById('preset-outline-enabled').checked = preset.outlineEnabled ?? false;
  1845→            document.getElementById('preset-uppercase').checked = preset.uppercase ?? false;
  1846→
  1847→            textPresetsState.currentPreset = preset;
  1848→            updatePreview();
  1849→        }
  1850→
  1851→        function resetPresetForm() {
  1852→            document.getElementById('preset-name-input').value = '';
  1853→            document.getElementById('preset-font-family').value = 'Arial';
  1854→            document.getElementById('preset-font-size').value = 48;
  1855→            document.getElementById('preset-font-size-value').textContent = '48';
  1856→            document.getElementById('preset-font-weight').value = 'bold';
  1857→            document.getElementById('preset-text-color').value = '#FFFFFF';
  1858→            document.getElementById('preset-bg-color').value = '#000000';
  1859→            document.getElementById('preset-highlight-color').value = '#FFCC00';
  1860→            document.getElementById('preset-bg-opacity').value = 80;
  1861→            document.getElementById('preset-bg-opacity-value').textContent = '80';
  1862→            document.getElementById('preset-position').value = 'bottom-center';
  1863→            document.getElementById('preset-animation').value = 'fade';
  1864→            document.getElementById('preset-shadow-enabled').checked = true;
  1865→            document.getElementById('preset-outline-enabled').checked = false;
  1866→            document.getElementById('preset-uppercase').checked = false;
  1867→
  1868→            textPresetsState.currentPreset = null;
  1869→            updatePreview();
  1870→        }
  1871→
  1872→        function applyPresetToCaptions() {
  1873→            const preset = textPresetsState.currentPreset || getPresetFromForm();
  1874→
  1875→            // Store as active caption style
  1876→            window.spliceState = window.spliceState || {};
  1877→            window.spliceState.captionStyle = preset;
  1878→
  1879→            console.log('[SPLICE] Applied text preset to captions:', preset.name || 'Custom');
  1880→            alert('Preset applied! It will be used for the next caption generation.');
  1881→        }
  1882→
  1883→        function loadPresets() {
  1884→            try {
  1885→                const saved = localStorage.getItem(textPresetsState.storageKey);
  1886→                if (saved) {
  1887→                    textPresetsState.presets = JSON.parse(saved);
  1888→                }
  1889→            } catch (e) {
  1890→                console.warn('[SPLICE] Failed to load presets:', e);
  1891→                textPresetsState.presets = [];
  1892→            }
  1893→            renderPresetsGallery();
  1894→        }
  1895→
  1896→        function savePresetsToStorage() {
  1897→            try {
  1898→                localStorage.setItem(textPresetsState.storageKey, JSON.stringify(textPresetsState.presets));
  1899→            } catch (e) {
  1900→                console.warn('[SPLICE] Failed to save presets:', e);
  1901→            }
  1902→        }
  1903→
  1904→        function renderPresetsGallery() {
  1905→            const gallery = document.getElementById('presets-gallery-list');
  1906→            if (!gallery) return;
  1907→
  1908→            if (textPresetsState.presets.length === 0) {
  1909→                gallery.innerHTML = '<div class="preset-empty">No presets saved yet</div>';
  1910→                return;
  1911→            }
  1912→
  1913→            gallery.innerHTML = textPresetsState.presets.map(preset => `
  1914→                <div class="preset-item ${textPresetsState.currentPreset?.id === preset.id ? 'active' : ''}"
  1915→                     data-preset-id="${preset.id}">
  1916→                    <span class="preset-name">${escapeHtml(preset.name)}</span>
  1917→                    <span class="delete-preset" data-id="${preset.id}">×</span>
  1918→                </div>
  1919→            `).join('');
  1920→
  1921→            // Add click handlers
  1922→            gallery.querySelectorAll('.preset-item').forEach(item => {
  1923→                item.addEventListener('click', (e) => {
  1924→                    if (e.target.classList.contains('delete-preset')) {
  1925→                        e.stopPropagation();
  1926→                        const id = e.target.dataset.id;
  1927→                        if (confirm('Delete this preset?')) {
  1928→                            deletePreset(id);
  1929→                        }
  1930→                    } else {
  1931→                        const id = item.dataset.presetId;
  1932→                        const preset = textPresetsState.presets.find(p => p.id === id);
  1933→                        if (preset) {
  1934→                            loadPresetToForm(preset);
  1935→                            renderPresetsGallery();
  1936→                        }
  1937→                    }
  1938→                });
  1939→            });
  1940→        }
  1941→
  1942→        function escapeHtml(str) {
  1943→            if (!str) return '';
  1944→            const div = document.createElement('div');
  1945→            div.textContent = str;
  1946→            return div.innerHTML;
  1947→        }
  1948→
  1949→        function exportAllPresets() {
  1950→            if (textPresetsState.presets.length === 0) {
  1951→                alert('No presets to export');
  1952→                return;
  1953→            }
  1954→
  1955→            const data = JSON.stringify(textPresetsState.presets, null, 2);
  1956→            const blob = new Blob([data], { type: 'application/json' });
  1957→            const url = URL.createObjectURL(blob);
  1958→            const a = document.createElement('a');
  1959→            a.href = url;
  1960→            a.download = 'splice-text-presets.json';
  1961→            a.click();
  1962→            URL.revokeObjectURL(url);
  1963→        }
  1964→
  1965→        function importPresets(e) {
  1966→            const file = e.target.files[0];
  1967→            if (!file) return;
  1968→
  1969→            const reader = new FileReader();
  1970→            reader.onload = (event) => {
  1971→                try {
  1972→                    const imported = JSON.parse(event.target.result);
  1973→                    if (Array.isArray(imported)) {
  1974→                        textPresetsState.presets = [...textPresetsState.presets, ...imported];
  1975→                        savePresetsToStorage();
  1976→                        renderPresetsGallery();
  1977→                        console.log('[SPLICE] Imported', imported.length, 'presets');
  1978→                    }
  1979→                } catch (err) {
  1980→                    alert('Failed to import presets: ' + err.message);
  1981→                }
  1982→            };
  1983→            reader.readAsText(file);
  1984→            e.target.value = '';
  1985→        }
  1986→
  1987→        // ============================================================================
  1988→        // CUSTOM FONT UPLOAD
  1989→        // ============================================================================
  1990→
  1991→        async function handleFontUpload(e) {
  1992→            const file = e.target.files[0];
  1993→            if (!file) return;
  1994→
  1995→            // Validate file type
  1996→            const validTypes = ['.ttf', '.otf', '.woff', '.woff2'];
  1997→            const ext = '.' + file.name.split('.').pop().toLowerCase();
  1998→            if (!validTypes.includes(ext)) {
  1999→                alert('Please upload a valid font file (.ttf, .otf, .woff, .woff2)');
  2000→                return;
  2001→            }
  2002→
  2003→            // Check file size (max 5MB)
  2004→            if (file.size > 5 * 1024 * 1024) {
  2005→                alert('Font file is too large. Maximum size is 5MB.');
  2006→                return;
  2007→            }
  2008→
  2009→            // Show progress
  2010→            const manager = document.getElementById('custom-fonts-manager');
  2011→            const progressDiv = document.createElement('div');
  2012→            progressDiv.className = 'font-upload-progress';
  2013→            progressDiv.textContent = 'Loading font...';
  2014→            manager.prepend(progressDiv);
  2015→
  2016→            try {
  2017→                // Read file as base64
  2018→                const base64 = await fileToBase64(file);
  2019→
  2020→                // Generate a clean font name from filename
  2021→                const fontName = file.name.replace(/\.[^.]+$/, '').replace(/[^a-zA-Z0-9\s-]/g, '');
  2022→                const fontId = 'custom-' + Date.now();
  2023→
  2024→                // Create FontFace and load it
  2025→                const fontFace = new FontFace(fontId, `url(${base64})`);
  2026→                await fontFace.load();
  2027→                document.fonts.add(fontFace);
  2028→
  2029→                // Save to state
  2030→                const customFont = {
  2031→                    id: fontId,
  2032→                    name: fontName,
  2033→                    data: base64,
  2034→                    filename: file.name
  2035→                };
  2036→                textPresetsState.customFonts.push(customFont);
  2037→                saveCustomFonts();
  2038→
  2039→                // Update UI
  2040→                addFontToSelector(customFont);
  2041→                renderCustomFontsList();
  2042→
  2043→                // Select the new font
  2044→                document.getElementById('preset-font-family').value = fontId;
  2045→                updatePreview();
  2046→
  2047→                progressDiv.textContent = `Font "${fontName}" loaded!`;
  2048→                setTimeout(() => progressDiv.remove(), 2000);
  2049→
  2050→                console.log('[SPLICE] Custom font loaded:', fontName);
  2051→            } catch (err) {
  2052→                console.error('[SPLICE] Font upload failed:', err);
  2053→                progressDiv.textContent = 'Failed to load font: ' + err.message;
  2054→                progressDiv.style.color = '#ff6b6b';
  2055→                setTimeout(() => progressDiv.remove(), 3000);
  2056→            }
  2057→
  2058→            // Reset input
  2059→            e.target.value = '';
  2060→        }
  2061→
  2062→        function fileToBase64(file) {
  2063→            return new Promise((resolve, reject) => {
  2064→                const reader = new FileReader();
  2065→                reader.onload = () => resolve(reader.result);
  2066→                reader.onerror = reject;
  2067→                reader.readAsDataURL(file);
  2068→            });
  2069→        }
  2070→
  2071→        function addFontToSelector(font) {
  2072→            const customGroup = document.getElementById('custom-fonts-group');
  2073→            if (!customGroup) return;
  2074→
  2075→            // Check if already exists
  2076→            if (customGroup.querySelector(`option[value="${font.id}"]`)) return;
  2077→
  2078→            const option = document.createElement('option');
  2079→            option.value = font.id;
  2080→            option.textContent = font.name;
  2081→            option.style.fontFamily = font.id;
  2082→            customGroup.appendChild(option);
  2083→        }
  2084→
  2085→        function renderCustomFontsList() {
  2086→            const list = document.getElementById('custom-fonts-list');
  2087→            if (!list) return;
  2088→
  2089→            if (textPresetsState.customFonts.length === 0) {
  2090→                list.innerHTML = '';
  2091→                return;
  2092→            }
  2093→
  2094→            list.innerHTML = textPresetsState.customFonts.map(font => `
  2095→                <div class="custom-font-item" data-font-id="${font.id}">
  2096→                    <span class="font-name" style="font-family: ${font.id};" title="${font.filename}">${escapeHtml(font.name)}</span>
  2097→                    <span class="delete-font" data-id="${font.id}" title="Delete font">×</span>
  2098→                </div>
  2099→            `).join('');
  2100→
  2101→            // Add delete handlers
  2102→            list.querySelectorAll('.delete-font').forEach(btn => {
  2103→                btn.addEventListener('click', (e) => {
  2104→                    e.stopPropagation();
  2105→                    const fontId = e.target.dataset.id;
  2106→                    if (confirm('Delete this custom font?')) {
  2107→                        deleteCustomFont(fontId);
  2108→                    }
  2109→                });
  2110→            });
  2111→        }
  2112→
  2113→        function deleteCustomFont(fontId) {
  2114→            // Remove from state
  2115→            textPresetsState.customFonts = textPresetsState.customFonts.filter(f => f.id !== fontId);
  2116→            saveCustomFonts();
  2117→
  2118→            // Remove from selector
  2119→            const option = document.querySelector(`#custom-fonts-group option[value="${fontId}"]`);
  2120→            if (option) option.remove();
  2121→
  2122→            // If currently selected, switch to Arial
  2123→            const selector = document.getElementById('preset-font-family');
  2124→            if (selector && selector.value === fontId) {
  2125→                selector.value = 'Arial';
  2126→                updatePreview();
  2127→            }
  2128→
  2129→            renderCustomFontsList();
  2130→            console.log('[SPLICE] Custom font deleted:', fontId);
  2131→        }
  2132→
  2133→        function loadCustomFonts() {
  2134→            try {
  2135→                const saved = localStorage.getItem(textPresetsState.customFontsKey);
  2136→                if (saved) {
  2137→                    const fonts = JSON.parse(saved);
  2138→                    fonts.forEach(async (font) => {
  2139→                        try {
  2140→                            // Re-register the font
  2141→                            const fontFace = new FontFace(font.id, `url(${font.data})`);
  2142→                            await fontFace.load();
  2143→                            document.fonts.add(fontFace);
  2144→
  2145→                            textPresetsState.customFonts.push(font);
  2146→                            addFontToSelector(font);
  2147→                        } catch (err) {
  2148→                            console.warn('[SPLICE] Failed to load saved font:', font.name, err);
  2149→                        }
  2150→                    });
  2151→
  2152→                    // Render list after a delay to allow fonts to load
  2153→                    setTimeout(renderCustomFontsList, 500);
  2154→                }
  2155→            } catch (e) {
  2156→                console.warn('[SPLICE] Failed to load custom fonts:', e);
  2157→            }
  2158→        }
  2159→
  2160→        function saveCustomFonts() {
  2161→            try {
  2162→                localStorage.setItem(textPresetsState.customFontsKey, JSON.stringify(textPresetsState.customFonts));
  2163→            } catch (e) {
  2164→                console.warn('[SPLICE] Failed to save custom fonts:', e);
  2165→                // If storage quota exceeded, try to warn user
  2166→                if (e.name === 'QuotaExceededError') {
  2167→                    alert('Storage quota exceeded. Try deleting some custom fonts.');
  2168→                }
  2169→            }
  2170→        }
  2171→
  2172→        // Initialize on load
  2173→        document.addEventListener('DOMContentLoaded', initTextPresets);
  2174→    </script>
  2175→</body>
  2176→
  2177→</html>
  2178→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
