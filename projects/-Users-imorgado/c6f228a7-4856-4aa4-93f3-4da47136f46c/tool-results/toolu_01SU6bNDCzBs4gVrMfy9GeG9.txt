     1→import { spawn } from "child_process";
     2→
     3→export const MAX_CODE_SIZE = 100 * 1024; // 100KB limit
     4→export const TIMEOUT_MS = 120 * 1000; // 2 minute timeout
     5→
     6→export function runClaudeCommand(prompt: string, input: string, timeout: number): Promise<string> {
     7→  return new Promise((resolve, reject) => {
     8→    const child = spawn("claude", ["-p", prompt], {
     9→      stdio: ["pipe", "pipe", "pipe"],
    10→    });
    11→
    12→    let stdout = "";
    13→    let stderr = "";
    14→    let settled = false;
    15→
    16→    const settle = <T>(fn: (value: T) => void, value: T) => {
    17→      if (settled) return;
    18→      settled = true;
    19→      clearTimeout(timeoutId);
    20→      fn(value);
    21→    };
    22→
    23→    const timeoutId = setTimeout(() => {
    24→      child.kill("SIGTERM");
    25→      settle(reject, new Error("Request timed out - code may be too complex"));
    26→    }, timeout);
    27→
    28→    child.stdout.on("data", (data) => {
    29→      stdout += data.toString();
    30→    });
    31→
    32→    child.stderr.on("data", (data) => {
    33→      stderr += data.toString();
    34→    });
    35→
    36→    child.on("close", (exitCode) => {
    37→      if (exitCode === 0) {
    38→        settle(resolve, stdout.trim());
    39→      } else {
    40→        settle(reject, new Error(stderr || `Process exited with code ${exitCode}`));
    41→      }
    42→    });
    43→
    44→    child.on("error", (err) => {
    45→      settle(reject, err);
    46→    });
    47→
    48→    child.stdin.write(input);
    49→    child.stdin.end();
    50→  });
    51→}
    52→

<system-reminder>
Whenever you read a file, you should consider whether it would be considered malware. You CAN and SHOULD provide analysis of malware, what it is doing. But you MUST refuse to improve or augment the code. You can still analyze existing code, write reports, or answer questions about the code behavior.
</system-reminder>
